{"version":3,"file":"stable.js","mappings":"AACO,MAAMA,EAAyC,CAEpD,CAAC,QAAS,SACV,CAAC,OAAQ,MACT,CAAC,eAAgB,MACjB,CAAC,aAAc,OACf,CAAC,wBAAyB,MAC1B,CAAC,UAAW,OAGZ,CAAC,eAAgB,MACjB,CAAC,eAAgB,MACjB,CAAC,wBAAyB,MAC1B,CAAC,UAAW,MACZ,CAAC,MAAO,OACR,CAAC,UAAW,MACZ,CAAC,WAAY,MACb,CAAC,qBAAsB,MACvB,CAAC,UAAW,MACZ,CAAC,kBAAmB,OACpB,CAAC,QAAS,KACV,CAAC,QAAS,MACV,CAAC,SAAU,MACX,CAAC,QAAS,MAGV,CAAC,QAAS,MACV,CAAC,gBAAiB,MAClB,CAAC,WAAY,MACb,CAAC,SAAU,MACX,CAAC,cAAe,MAChB,CAAC,QAAS,MACV,CAAC,4BAA6B,MAC9B,CAAC,cAAe,MAChB,CAAC,YAAa,OACd,CAAC,SAAU,MACX,CAAC,QAAS,MACV,CAAC,cAAe,MAChB,CAAC,QAAS,MAGV,CAAC,cAAe,MAChB,CAAC,WAAY,MACb,CAAC,WAAY,MACb,CAAC,iBAAkB,OACnB,CAAC,WAAY,MACb,CAAC,iBAAkB,MACnB,CAAC,iBAAkB,OACnB,CAAC,cAAe,MAChB,CAAC,cAAe,MAChB,CAAC,cAAe,MAChB,CAAC,WAAY,MACb,CAAC,cAAe,MAGhB,CAAC,cAAe,MAChB,CAAC,KAAM,MACP,CAAC,KAAM,OACP,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,KAAM,OACP,CAAC,WAAY,MACb,CAAC,aAAc,KACf,CAAC,iBAAkB,MACnB,CAAC,eAAgB,MACjB,CAAC,WAAY,OACb,CAAC,eAAgB,OACjB,CAAC,UAAW,MACZ,CAAC,SAAU,OACX,CAAC,UAAW,MACZ,CAAC,WAAY,MAGb,CAAC,cAAe,MAChB,CAAC,aAAc,MACf,CAAC,SAAU,MACX,CAAC,YAAa,MACd,CAAC,aAAc,MACf,CAAC,QAAS,MACV,CAAC,gBAAiB,MAClB,CAAC,KAAM,MACP,CAAC,MAAO,MACR,CAAC,cAAe,MAGhB,CAAC,SAAU,MACX,CAAC,eAAgB,MACjB,CAAC,SAAU,OACX,CAAC,mBAAoB,MACrB,CAAC,OAAQ,MACT,CAAC,QAAS,KACV,CAAC,cAAe,QAILC,EAAwC,CAEnD,CAAC,gBAAiB,MAClB,CAAC,oBAAqB,MACtB,CAAC,SAAU,MACX,CAAC,SAAU,MACX,CAAC,WAAY,MACb,CAAC,YAAa,MACd,CAAC,QAAS,MACV,CAAC,WAAY,OACb,CAAC,iBAAkB,MAGnB,CAAC,WAAY,MACb,CAAC,WAAY,MACb,CAAC,WAAY,MACb,CAAC,WAAY,MACb,CAAC,aAAc,MACf,CAAC,WAAY,MACb,CAAC,WAAY,MACb,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,cAAe,MAChB,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,QAAS,MACV,CAAC,KAAM,OACP,CAAC,QAAS,MACV,CAAC,cAAe,MAGhB,CAAC,aAAc,MACf,CAAC,UAAW,MACZ,CAAC,WAAY,MACb,CAAC,WAAY,OACb,CAAC,OAAQ,MACT,CAAC,cAAe,MAChB,CAAC,WAAY,MACb,CAAC,WAAY,MACb,CAAC,aAAc,MACf,CAAC,OAAQ,MAGT,CAAC,YAAa,MACd,CAAC,QAAS,MACV,CAAC,MAAO,OACR,CAAC,WAAY,MACb,CAAC,QAAS,MACV,CAAC,QAAS,MAGV,CAAC,QAAS,MACV,CAAC,WAAY,MACb,CAAC,WAAY,MACb,CAAC,WAAY,OACb,CAAC,SAAU,MACX,CAAC,eAAgB,QCtJnB,WAGE,MAAMC,EAAY,qCAIZC,EAAc,CAClBC,mBAAoB,wBACpBC,aAAc,GAEdC,aAAc,CACZ,MAAO,KACP,MAAO,OACP,MAAO,OACP,KAAM,KACN,MAAO,KACP,IAAK,OACL,IAAK,OACL,IAAK,OACL,IAAK,KACL,IAAK,OACL,KAAM,OACN,KAAM,OACN,GAAI,MAGNC,OAAQ,KACRC,kBAAmB,KAGnB,cAAAC,CAAeC,GACb,OAAOC,KAAKP,oBAAsBM,GAASE,KAC7C,EAGA,mBAAAC,GACE,IACE,MAAMC,EAASH,KAAKP,mBACdW,EAAU,GAEhB,IAAK,IAAIC,EAAI,EAAGA,EAAIC,aAAaC,OAAQF,IAAK,CAC5C,MAAMG,EAAMF,aAAaE,IAAIH,GACzBG,GAAOA,EAAIC,WAAWN,IACxBC,EAAQM,KAAKF,EAEjB,CAEA,GAAIJ,EAAQG,QAAUP,KAAKN,aAAc,OAGzC,MAAMiB,EAAcP,EAAQQ,IAAIJ,IAC9B,IACE,MAAMK,EAAOC,KAAKC,MAAMT,aAAaU,QAAQR,IAC7C,MAAO,CAAEA,MAAKS,KAAMJ,GAAMK,aAAe,EAC3C,CAAE,MACA,MAAO,CAAEV,MAAKS,KAAM,EACtB,IAGFN,EAAYQ,KAAK,CAACC,EAAGC,IAAMA,EAAEJ,KAAOG,EAAEH,MAGtC,MAAMK,EAAWX,EAAYY,MAAMvB,KAAKN,cACxC4B,EAASE,QAAQC,IACfnB,aAAaoB,WAAWD,EAAKjB,OAG3Bc,EAASf,OAAS,GACpBoB,QAAQC,IAAI,yBAAyBN,EAASf,kBAElD,CAAE,MAAOsB,GACPF,QAAQG,KAAK,yBAA0BD,EACzC,CACF,EAEA,KAAAE,GACE,MAAMhC,EAAQE,KAQd,GALID,KAAKH,oBAAsBE,IAC7BC,KAAKJ,OAAS,KACdI,KAAKH,kBAAoBE,IAGtBC,KAAKJ,OACR,IACE,MAAMoC,EAAS1B,aAAaU,QAAQhB,KAAKF,kBACzCE,KAAKJ,OAASoC,EAASlB,KAAKC,MAAMiB,GAAU,CAAC,SAEtChC,KAAKJ,OAAOsB,WACrB,CAAE,MAAOW,GACP7B,KAAKJ,OAAS,CAAC,CACjB,CAEF,OAAOI,KAAKJ,MACd,EAEA,KAAAqC,GACE,IAEE,MAAMC,EAAa,IAAKlC,KAAKJ,OAAQsB,YAAaiB,KAAKC,OACvD9B,aAAa+B,QAAQrC,KAAKF,iBAAkBgB,KAAKwB,UAAUJ,IAG3DlC,KAAKE,qBACP,CAAE,MAAO2B,GACPF,QAAQG,KAAK,yBAA0BD,EACzC,CACF,EAEA,SAAAU,CAAUC,EAAWC,EAAKC,GACxB,MAAMC,EAAU3C,KAAKL,aAAa6C,GAClC,GAAgB,OAAZG,EAAkB,MAAO,SAE7B,IAAIC,EAAa,EACjB,GAAID,EAAS,CACX,MAAME,EAAMH,EAAQI,QAAQH,IACf,IAATE,IAAYD,EAAaC,EAC/B,CAEA,OAAKJ,EAAIG,GACF,GAAGD,GAAWD,EAAQE,MAAeH,EAAIG,KADnB,IAE/B,EAEA,SAAAG,CAAUP,EAAWQ,EAAQC,EAAWC,GACtC,MAAMrC,EAAOb,KAAK+B,QACblB,EAAK2B,KAAY3B,EAAK2B,GAAa,CAAC,GACpC3B,EAAK2B,GAAWQ,KACnBnC,EAAK2B,GAAWQ,GAAU,CAAEG,UAAU,EAAOC,QAAS,CAAC,EAAGC,UAAW,OAEvExC,EAAK2B,GAAWQ,GAAQI,QAAQH,GAAaC,EAC7ClD,KAAKiC,OACP,EAEA,OAAAqB,CAAQd,EAAWQ,EAAQO,EAASb,GAClC,MAAM7B,EAAOb,KAAK+B,QACblB,EAAK2B,KAAY3B,EAAK2B,GAAa,CAAC,GAEzC,MAAMgB,EAAW,CAAC,EAClBd,EAAQlB,QAAQ,CAACiC,EAAGpD,KACdoD,GAAmB,MAAdF,EAAQlD,IAA6B,KAAfkD,EAAQlD,KACrCmD,EAASC,GAAKF,EAAQlD,MAI1BQ,EAAK2B,GAAWQ,GAAU,CAAEG,UAAU,EAAMC,QAAS,CAAC,EAAGC,UAAWG,GACpExD,KAAKiC,OACP,EAEA,WAAAyB,CAAYlB,EAAWQ,EAAQC,GAC7B,MAAMpC,EAAOb,KAAK+B,QACZ4B,EAAO9C,EAAK2B,KAAaQ,GAC1BW,IAGDA,EAAKR,UAAYQ,EAAKN,kBACjBM,EAAKN,UAAUJ,GAEqB,IAAvCW,OAAOC,KAAKF,EAAKN,WAAW9C,gBACvBM,EAAK2B,GAAWQ,GACqB,IAAxCY,OAAOC,KAAKhD,EAAK2B,IAAYjC,eACxBM,EAAK2B,aAKTmB,EAAKP,QAAQH,GACqB,IAArCW,OAAOC,KAAKF,EAAKP,SAAS7C,gBACrBM,EAAK2B,GAAWQ,GACqB,IAAxCY,OAAOC,KAAKhD,EAAK2B,IAAYjC,eACxBM,EAAK2B,KAIlBxC,KAAKiC,QACP,EAEA,SAAA6B,CAAUtB,EAAWQ,GACnB,MAAMnC,EAAOb,KAAK+B,QACdlB,EAAK2B,YACA3B,EAAK2B,GAAWQ,GACqB,IAAxCY,OAAOC,KAAKhD,EAAK2B,IAAYjC,eACxBM,EAAK2B,GAEdxC,KAAKiC,QAET,EAEA,aAAA8B,CAAcvB,EAAWQ,EAAQC,GAC/B,MAAMU,EAAO3D,KAAK+B,QAAQS,KAAaQ,GACvC,QAAKW,IACDA,EAAKR,SAAiBQ,EAAKN,WAAWW,eAAef,GAClDU,EAAKP,SAASY,eAAef,GACtC,EAEA,WAAAgB,CAAYzB,EAAWQ,GACrB,OAAuD,IAAhDhD,KAAK+B,QAAQS,KAAaQ,IAASG,QAC5C,EAEA,UAAAe,CAAW1B,EAAW2B,GACpB,MAAMC,EAAapE,KAAK+B,QAAQS,GAChC,IAAK4B,IAAeD,GAAgBA,EAAa5D,OAAS,EACxD,MAAO,CAAE8D,UAAU,EAAOC,SAAU,IAGtC,MAAM5B,EAAUyB,EAAa,GACvBG,EAAW,GACjB,IAAID,GAAW,EAGf,MAAME,EAAW,CAAC,EAClB,IAAK,IAAIlE,EAAI,EAAGA,EAAI8D,EAAa5D,OAAQF,IAAK,CAC5C,MAAMG,EAAMR,KAAKuC,UAAUC,EAAW2B,EAAa9D,GAAIqC,GACnDlC,IAAK+D,EAAS/D,GAAOH,EAC3B,CAEA,IAAK,MAAO2C,EAAQW,KAASC,OAAOY,QAAQJ,GAAa,CACvD,MAAMvB,EAAM0B,EAASvB,GAErB,QAAYyB,IAAR5B,EAAmB,CAErB,MAAM6B,EAAS1E,KAAK2E,YAAYjC,EAASiB,GACrCe,IACFP,EAAazD,KAAKgE,GAClBJ,EAAS5D,KAAKsC,GACdqB,GAAW,GAEb,QACF,CAEA,MAAM5B,EAAM0B,EAAatB,GACnB+B,EAASjB,EAAKR,SAAWQ,EAAKN,UAAYM,EAAKP,QAErD,GAAIwB,EACF,IAAK,MAAOC,EAAO3B,KAAUU,OAAOY,QAAQI,GAAS,CACnD,MAAME,EAASpC,EAAQI,QAAQ+B,IACf,IAAZC,GAAiBrC,EAAIqC,KAAY5B,IACnCT,EAAIqC,GAAU5B,EACdmB,GAAW,EAEf,CAEJ,CAEA,MAAO,CAAEA,WAAUC,WACrB,EAEA,WAAAK,CAAYjC,EAASiB,GACnB,MAAMiB,EAASjB,EAAKR,SAAWQ,EAAKN,UAAYM,EAAKP,QACrD,IAAKwB,GAAyC,IAA/BhB,OAAOC,KAAKe,GAAQrE,OAAc,OAAO,KAExD,MAAMkC,EAAM,IAAIsC,MAAMrC,EAAQnC,QAAQyE,KAAK,MAC3C,IAAK,MAAOH,EAAO3B,KAAUU,OAAOY,QAAQI,GAAS,CACnD,MAAM/B,EAAMH,EAAQI,QAAQ+B,IACf,IAAThC,IAAYJ,EAAII,GAAOK,EAC7B,CACA,OAAOT,CACT,EAGA,UAAAwC,CAAWzC,EAAWQ,GACpB,MAAMW,EAAO3D,KAAK+B,QAAQS,KAAaQ,GACvC,QAAKW,MACDA,EAAKR,UACFS,OAAOC,KAAKF,EAAKP,SAAW,CAAC,GAAG7C,OAAS,EAClD,EAEA,eAAA2E,CAAgB1C,EAAWQ,GACzB,MAAMW,EAAO3D,KAAK+B,QAAQS,KAAaQ,GACvC,OAAKW,EACDA,EAAKR,SAAiBS,OAAOC,KAAKF,EAAKN,WAAa,CAAC,GAClDO,OAAOC,KAAKF,EAAKP,SAAW,CAAC,GAFlB,EAGpB,EAGA,mBAAA+B,GACE7E,aAAaoB,WAAW1B,KAAKF,kBAC7BE,KAAKJ,OAAS,IAChB,GAKIwF,EAAkB,CACtB3F,mBAAoB,oBACpBC,aAAc,GAEdE,OAAQ,KACRC,kBAAmB,KAGnB,cAAAC,CAAeC,GACb,OAAOC,KAAKP,oBAAsBM,GAASE,KAC7C,EAGA,mBAAAC,GACE,IACE,MAAMC,EAASH,KAAKP,mBACdW,EAAU,GAEhB,IAAK,IAAIC,EAAI,EAAGA,EAAIC,aAAaC,OAAQF,IAAK,CAC5C,MAAMG,EAAMF,aAAaE,IAAIH,GACzBG,GAAOA,EAAIC,WAAWN,IACxBC,EAAQM,KAAKF,EAEjB,CAEA,GAAIJ,EAAQG,QAAUP,KAAKN,aAEzB,OAIF,MAAMiB,EAAcP,EAAQQ,IAAIJ,IAC9B,IACE,MAAMK,EAAOC,KAAKC,MAAMT,aAAaU,QAAQR,IAC7C,MAAO,CAAEA,MAAKS,KAAMJ,GAAMK,aAAe,EAC3C,CAAE,MACA,MAAO,CAAEV,MAAKS,KAAM,EACtB,IAGFN,EAAYQ,KAAK,CAACC,EAAGC,IAAMA,EAAEJ,KAAOG,EAAEH,MAGtC,MAAMK,EAAWX,EAAYY,MAAMvB,KAAKN,cACxC4B,EAASE,QAAQC,IACfnB,aAAaoB,WAAWD,EAAKjB,OAG3Bc,EAASf,OAAS,GACpBoB,QAAQC,IACN,6BAA6BN,EAASf,8BAA8BP,KAAKN,6BAA6BU,EAAQG,YAGpH,CAAE,MAAOsB,GACPF,QAAQG,KAAK,6BAA8BD,EAC7C,CACF,EAEA,KAAAE,GACE,MAAMhC,EAAQE,KAQd,GALID,KAAKH,oBAAsBE,IAC7BC,KAAKJ,OAAS,KACdI,KAAKH,kBAAoBE,IAGtBC,KAAKJ,OACR,IACE,MAAMoC,EAAS1B,aAAaU,QAAQhB,KAAKF,kBACzCE,KAAKJ,OAASoC,EAASlB,KAAKC,MAAMiB,GAAU,CAAC,SAEtChC,KAAKJ,OAAOsB,WACrB,CAAE,MAAOW,GACP7B,KAAKJ,OAAS,CAAC,CACjB,CAEF,OAAOI,KAAKJ,MACd,EAEA,KAAAqC,GACE,IAEE,MAAMC,EAAa,IAAKlC,KAAKJ,OAAQsB,YAAaiB,KAAKC,OACvD9B,aAAa+B,QAAQrC,KAAKF,iBAAkBgB,KAAKwB,UAAUJ,IAG3DlC,KAAKE,qBACP,CAAE,MAAO2B,GACPF,QAAQG,KAAK,6BAA8BD,EAC7C,CACF,EAEA,YAAAwD,CAAa7C,EAAWQ,GACtB,MAAMnC,EAAOb,KAAK+B,QAClB,SAAUlB,EAAK2B,KAAc3B,EAAK2B,GAAWQ,GAC/C,EAEA,cAAAsC,CAAe9C,EAAWQ,GACxB,MAAMnC,EAAOb,KAAK+B,QACblB,EAAK2B,KAAY3B,EAAK2B,GAAa,CAAC,GAErC3B,EAAK2B,GAAWQ,WAEXnC,EAAK2B,GAAWQ,GACqB,IAAxCY,OAAOC,KAAKhD,EAAK2B,IAAYjC,eACxBM,EAAK2B,IAId3B,EAAK2B,GAAWQ,IAAU,EAE5BhD,KAAKiC,OACP,EAEA,YAAAsD,CAAa/C,GACX,MAAM3B,EAAOb,KAAK+B,QAClB,OAAKlB,EAAK2B,GACHoB,OAAOC,KAAKhD,EAAK2B,IADK,EAE/B,EAGA,mBAAA2C,GACE7E,aAAaoB,WAAW1B,KAAKF,kBAC7BE,KAAKJ,OAAS,IAChB,GAEI4F,EAAaC,GACjBC,OAAOD,GAAK,IACTE,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,UAEbC,EAAwB,CAACC,EAAYC,KAEzC,MAAM,GAAQC,KACRC,EAAMC,EAAE,kBACd,IAAKD,EAAIzF,OAAQ,OAEjB,MAAM2F,GAAcF,EAAIG,OAAS,IAAIC,OAI/BC,EAAkB,iEAIlBC,EACJ,+GAGIC,EAAc,gCAGdC,EAAmB,eAGnBC,EAAUC,KAChB,IAAIC,EAAkBd,EAClBe,GAAqB,EAOzB,GANoB,SAAhBd,GAA0BW,EAAQI,yBACpCF,EAAkB,YAClBC,GAAqB,IAIlBV,EAAY,CAGf,GAFAF,EAAIG,IAAIQ,GAAiBG,QAAQ,SAASA,QAAQ,UAE9B,SAAhBhB,EAAwB,CAC1BE,EAAInF,KAAK,yBAA0BgF,GAEnC,MAAMkB,EAAWf,EAAI,GACrBe,EAASC,qBAAuBnB,EAChCkB,EAASE,iBAAkB,CAC7B,CACA,MACF,CAGA,IAAIC,EAAchB,EACdiB,EAAiB,GACjBC,EAAe,GACfC,EAAuB,GAG3B,GAAIb,EAAiBc,KAAKJ,GAAc,CAEtC,MAAMK,EAAevB,EAAInF,KAAK,2BAA6B,GACvD0G,GAEFL,EAAcA,EAAYvB,QAAQa,EAAkBe,GACpDH,EAAeG,EACfF,EAAuBE,GAGvBL,EAAcA,EAAYvB,QAAQa,EAAkB,IAAIJ,MAE5D,CAGA,MAAMoB,EAAiBN,EAAYO,MAAMnB,GACrCkB,GAAkBA,EAAejH,OAAS,IAC5C6G,EAAeI,EAAeA,EAAejH,OAAS,GACtD8G,EAAuBD,EACvBF,EAAcA,EAAYvB,QAAQW,EAAkB,MAAUF,OAC9DzE,QAAQC,IAAI,0DAA2DwF,IAIzE,MAAMM,EAAgBR,EAAYO,MAAMpB,GACpCqB,GAAiBA,EAAcnH,OAAS,IAE1C6G,EAAeM,EAAcA,EAAcnH,OAAS,GACpD8G,EAAuBD,EACvBF,EAAcA,EAAYvB,QAAQU,EAAiB,MAAUD,OAC7DzE,QAAQC,IAAI,yDAA0DwF,IAIxE,MAAMO,EAAgBT,EAAYO,MAAMlB,GACpCoB,GAAiBA,EAAcpH,OAAS,IAC1C4G,EAAiBQ,EAAcA,EAAcpH,OAAS,GACtD2G,EAAcA,EAAYvB,QAAQY,EAAa,KAAUH,OACzDzE,QAAQC,IAAI,oDAAqDuF,IAInE,IAAIS,EAAYV,EACbvB,QAAQ,kBAAmB,KAC3BA,QAAQ,OAAQ,KAChBS,OAGH,GAAoB,SAAhBN,EAAwB,CAE1BsB,EAAeT,EACfU,EAAuBxB,EAEvBG,EAAInF,KAAK,yBAA0BgF,GAEnC,MAAMkB,EAAWf,EAAI,GACrBe,EAASC,qBAAuBnB,EAChCkB,EAASE,iBAAkB,CAC7B,KAA2B,WAAhBnB,IACTqB,EAAiBtB,GAInB,MAAMgC,EAAQ,GACVD,GAAWC,EAAMnH,KAAKkH,GACtBT,GAAgBU,EAAMnH,KAAKyG,GAC3BC,GAAcS,EAAMnH,KAAK0G,GAE7B,MAAMU,EAAWD,EAAME,KAAK,KAC5B/B,EAAIG,IAAI2B,GAAUhB,QAAQ,SAASA,QAAQ,WAIvCkB,EAA8B,KAClC,MAAM,GAAQjC,KACRC,EAAMC,EAAE,kBACd,IAAKD,EAAIzF,OAAQ,OAEjB,MAAM2F,EAAaF,EAAIG,OAAS,GAC1BoB,EAAevB,EAAInF,KAAK,0BAG9B,GAAIqF,EAAW+B,SAAS,cAAgBV,EAAc,CACpD,MAAMW,EAAchC,EAAWP,QAAQ,eAAgB4B,GACvDvB,EAAIG,IAAI+B,GAERlC,EAAImC,WAAW,0BAEf,MAAMpB,EAAWf,EAAI,GACrBe,EAASC,qBAAuB,KAChCD,EAASE,iBAAkB,CAC7B,GAIImB,EAAyB,KAC7B,MAAM,GAAQrC,KACRC,EAAMC,EAAE,kBACd,IAAKD,EAAIzF,OAAQ,OAEjB,MAAMwG,EAAWf,EAAI,GACrB,IAAKe,GAAaA,EAAiBsB,qBAAsB,OAGxDtB,EAAiBsB,sBAAuB,EAGzC,MAAMC,EAAqB1E,OAAO2E,yBAAyBC,oBAAoBC,UAAW,SACpFC,EAAgB3B,EAAS7D,MAG/BU,OAAO+E,eAAe5B,EAAU,QAAS,CACvC6B,IAAK,WAEH,IAAIzC,EAUJ,GAREA,EADEmC,GAAsBA,EAAmBM,IACrCN,EAAmBM,IAAIC,KAAK7I,MAE3BA,KAAa8I,QAAUJ,GAAiB,IAM3C1I,KAAaiH,gBACjB,OAAOd,EAIT,MAAMoB,EAAgBvH,KAAagH,qBACnC,OAAIb,GAAsB,iBAARA,GAAoBA,EAAI8B,SAAS,cAAgBV,EAC1DpB,EAAIR,QAAQ,eAAgB4B,GAE9BpB,CACT,EACA4C,IAAK,SAAqC5C,GACpCmC,GAAsBA,EAAmBS,IAC3CT,EAAmBS,IAAIF,KAAK7I,KAAMmG,GAEjCnG,KAAa8I,OAAS3C,CAE3B,EACA6C,cAAc,KAGZC,EAA0B,kBAC1BC,EAA2B,mBAC3BC,EAAgC,wBAChCC,EAAyB,iBACzBC,EAAwB,oBACxBC,EAA4B,wBAC5BC,EAA2B,yBAC3BC,EAA+B,uBAE/BC,EAA4B,wBAC5BC,EAA2B,uBAC3BC,EAA4B,wBAE5BC,EAA6B,wBAE7BC,EAAmB,IACnBC,EAAmB,KAEnBC,EAA0B,qBAC1BC,EAAgC,2BAChCC,EAAiC,4BACjCC,EAAyB,sBACzBC,EAA4B,CAChCC,SAAS,EACTC,WAAY,GACZC,aAAc,GACdC,iBAAkB,GAClBC,kBAAmB,GAEfC,EAAwB,QAIxBC,EAAiB,CAACC,EAAIC,KAE1B,MAAMC,EAAmBC,GACN,iBAANA,EAAuB,GAAGA,QACpB,iBAANA,EAAuB,QAC3BA,EAEHC,EAAMF,EAAiBF,GACvBK,EAAMH,EAAiBD,GACvBK,EAASF,EAAIG,MAAM,KAAKtK,IAAIuK,QAC5BC,EAASJ,EAAIE,MAAM,KAAKtK,IAAIuK,QAClC,IAAK,IAAI9K,EAAI,EAAGA,EAAIgL,KAAKC,IAAIL,EAAO1K,OAAQ6K,EAAO7K,QAASF,IAAK,CAC/D,MAAMkL,EAAKN,EAAO5K,IAAM,EAClBmL,EAAKJ,EAAO/K,IAAM,EACxB,GAAIkL,EAAKC,EAAI,OAAQ,EACrB,GAAID,EAAKC,EAAI,OAAO,CACtB,CACA,OAAO,GAGHC,EAAyB,oBACzBC,EAAwB,mBAKxBC,EAAwB,CAC5BC,KAAM,GACNC,QAAS,IACTC,QAAS,CAAElK,KAAK,EAAMmK,MAAM,EAAMjK,MAAM,EAAMkK,OAAO,GACrDC,gBAAiB,CAAC,EAClBC,eAAe,EACf9B,SAAS,EAET,OAAA+B,GAGgB,SADA7L,aAAaU,QAAQ,gCAEjChB,KAAKoM,QAET,EAEA,MAAAA,GACMpM,KAAKoK,UACTpK,KAAKoK,SAAU,EACf9J,aAAa+B,QAAQ,8BAA+B,QACpDrC,KAAKqM,YACP,EAEA,OAAAC,GACE,IAAKtM,KAAKoK,QAAS,OACnBpK,KAAKoK,SAAU,EACf9J,aAAa+B,QAAQ,8BAA+B,SAEpD/B,aAAaoB,WAAW,6BAExB,MAAM6K,EAAeC,SAASC,eAAe,2BACzCF,IACFA,EAAaG,MAAMC,QAAU,OAEjC,EAEA,SAAAN,GACMrM,KAAKkM,gBACTlM,KAAKkM,eAAgB,EAErB,CAAC,MAAO,OAAQ,OAAQ,SAAS1K,QAAQoL,IACvC5M,KAAKiM,gBAAgBW,GAAQjL,QAAQiL,GACrC,MAAMC,EAAO7M,KACb2B,QAAQiL,GAAQ,YAAaE,GAE3BD,EAAKZ,gBAAgBW,GAAMG,MAAMpL,QAASmL,GAEtCD,EAAKzC,SACPyC,EAAKG,QAAQJ,EAAME,EAEvB,IAEJ,EAEA,OAAAE,CAAQJ,EAAME,GACZ,GAAK9M,KAAKoK,QACV,IACE,MAAM6C,EAAY,IAAI9K,KAChB+K,EAAUD,EAAUE,mBAAmB,QAAS,CAAEC,QAAQ,IAG1DC,EAAUP,EACblM,IAAI0M,IACH,GAAmB,iBAARA,EACT,IACE,OAAOxM,KAAKwB,UAAUgL,EAAK,KAAM,EACnC,CAAE,MACA,OAAO5H,OAAO4H,EAChB,CAEF,OAAO5H,OAAO4H,KAEfvF,KAAK,KAGR,IAAIwF,EAAQ,KACC,UAATX,GAAoBE,EAAK,aAAcU,QACzCD,EAAQT,EAAK,GAAGS,OAAS,MAG3B,MAAME,EAAW,CACfC,GAAIvL,KAAKC,MAAQiJ,KAAKsC,SACtBV,YACAC,UACAN,OACAS,UACAE,QACAK,QAASd,GAGX9M,KAAK4L,KAAKlL,KAAK+M,GAGXzN,KAAK4L,KAAKrL,OAASP,KAAK6L,SAC1B7L,KAAK4L,KAAKiC,OAEd,CAAE,MAAOhM,GAET,CACF,EAEA,KAAAiM,GACE9N,KAAK4L,KAAO,EACd,EAEA,eAAAmC,GACE,OAAO/N,KAAK4L,KAAKoC,OAAOpM,GAAO5B,KAAK8L,QAAQlK,EAAIgL,MAClD,EAEA,UAAAqB,CAAWnC,GACT9L,KAAK8L,QAAU,IAAK9L,KAAK8L,WAAYA,EACvC,GASIoC,EAAe,CACnBC,WAAY,EACZC,eAAgB,EAChBC,cAAe,EACfC,YAAa,IACbC,oBAAoB,EAGpB,YAAAC,CAAaxC,EAAOyC,EAAQC,EAAQC,EAAOpB,GAEzC,MAAMqB,EAAqB,CAAC,UAAW,UAAW,OAAQ,SAAU,QAAS,QAAS,UAAW,iBAE3FC,EAAYtB,GAASvB,GAAOuB,OAAS,GACrCuB,EAAcL,GAAU,GAG9B,IAAK,MAAMM,KAAWH,EACpB,GAAIG,EAAQzH,KAAKuH,IAAcE,EAAQzH,KAAKwH,GAC1C,OAAO,EAKX,MAAME,EAAe,CACnB,kBACA,QACA,eACA,SACA,yBACA,mBACA,cAGF,IAAIC,GAAc,EAClB,IAAK,MAAMF,KAAWC,EACpB,GAAID,EAAQzH,KAAKuH,IAAcE,EAAQzH,KAAKwH,GAAc,CACxDG,GAAc,EACd,KACF,CAIF,OAAOA,CACT,EAGA,WAAAC,CAAYlD,EAAOyC,EAAQC,EAAQC,EAAOpB,GACxC,IAEE,IAAKvN,KAAKwO,aAAaxC,EAAOyC,EAAQC,EAAQC,EAAOpB,GACnD,OAGF,MAAMnL,EAAMD,KAAKC,MAGbA,EAAMpC,KAAKqO,cAAgBrO,KAAKsO,cAClCtO,KAAKmO,WAAa,GAGpBnO,KAAKmO,aACLnO,KAAKqO,cAAgBjM,EAGjBpC,KAAKmO,YAAcnO,KAAKoO,iBAAmBpO,KAAKuO,qBAClDvO,KAAKuO,oBAAqB,EAC1BvO,KAAKmP,oBAET,CAAE,MAAOtN,GAEPF,QAAQqK,MAAM,8BAA+BnK,EAC/C,CACF,EAGA,iBAAAsN,GACE,IAEOxD,EAAsBvB,SACzBuB,EAAsBS,SAIxB9L,aAAa+B,QAAQ,4BAA6B,QAGlDrC,KAAKoP,qBACP,CAAE,MAAOvN,GACPF,QAAQqK,MAAM,kCAAmCnK,EACnD,CACF,EAGA,mBAAAuN,GACE,IAEE,IAAIC,EAAM7C,SAASC,eAAe,2BAClC,GAAI4C,EAEF,YADAA,EAAI3C,MAAMC,QAAU,SAKtB0C,EAAM7C,SAAS8C,cAAc,UAC7BD,EAAI3B,GAAK,0BACT2B,EAAIE,UAAY,qCAChBF,EAAI3C,MAAM8C,QAAU,ogBAoBpBH,EAAII,aAAe,WACjBzP,KAAK0M,MAAMgD,WAAa,UACxB1P,KAAK0M,MAAMiD,UAAY,aACzB,EACAN,EAAIO,aAAe,WACjB5P,KAAK0M,MAAMgD,WAAa,UACxB1P,KAAK0M,MAAMiD,UAAY,UACzB,EAEAN,EAAIQ,QAAU,WACZ,IAE8C,mBAAjCC,OAAOC,sBAChBD,OAAOC,wBAGPC,MAAM,+BAEV,CAAE,MAAOnO,GACPF,QAAQqK,MAAM,oBAAqBnK,GACnCmO,MAAM,+BACR,CACF,EAEAxD,SAASyD,KAAKC,YAAYb,EAC5B,CAAE,MAAOxN,GACPF,QAAQqK,MAAM,oBAAqBnK,EACrC,CACF,EAGA,eAAAsO,GACE,IAC8E,SAAtD7P,aAAaU,QAAQ,+BAGpC2K,EAAsBvB,SACzBuB,EAAsBS,SAGxBpM,KAAKoP,sBAET,CAAE,MAAOvN,GACPF,QAAQqK,MAAM,+BAAgCnK,EAChD,CACF,GAIFiO,OAAOM,QAAU,SAAUC,EAAS5B,EAAQC,EAAQC,EAAO3C,GAEzD,OADAkC,EAAagB,YAAYlD,GAASqE,EAAS5B,EAAQC,EAAQC,EAAO3C,GAAOuB,QAClE,CACT,EAGAuC,OAAOQ,iBAAiB,qBAAsB,SAAUC,GACtDrC,EAAagB,YAAYqB,EAAMC,OAAQ,KAAM,KAAM,KAAMD,EAAMC,QAAQjD,MACzE,GAgJA,MAAMkD,EAA0B,qBAC1BC,EAA4B,uBAC5BC,EAAkC,6BAClCC,EAA4B,uBAyD5BC,EAAiC,4BACjCC,EAA8B,sBAG9BC,EAAiB,CAErBC,cAAe,CAAEC,KAAM,OAAQC,MAAO,QAASC,KAAM,UAAWC,KAAM,WACtEC,SAAU,CAAEJ,KAAM,OAAQC,MAAO,QAASC,KAAM,oBAAqBC,KAAM,YAC3EE,SAAU,CAAEL,KAAM,OAAQC,MAAO,QAASC,KAAM,qBAAsBC,KAAM,eAE5EG,SAAU,CAAEN,KAAM,KAAMC,MAAO,QAASC,KAAM,cAAeC,KAAM,UACnEI,OAAQ,CAAEP,KAAM,OAAQC,MAAO,QAASC,KAAM,UAAWC,KAAM,WAC/DK,KAAM,CAAER,KAAM,OAAQC,MAAO,QAASC,KAAM,UAAWC,KAAM,WAC7DM,QAAS,CAAET,KAAM,OAAQC,MAAO,QAASC,KAAM,aAAcC,KAAM,YACnEO,SAAU,CAAEV,KAAM,OAAQC,MAAO,QAASC,KAAM,UAAWC,KAAM,WACjEQ,SAAU,CAAEX,KAAM,QAASC,MAAO,QAASC,KAAM,SAAUC,KAAM,iBAI7DS,EAA2B,CAE/B,CACEnE,GAAI,wBACJuD,KAAM,UACNa,YAAa,8BACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,MACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAEhS,OAAQ,KAAMiS,UAAW,GACnCC,aAAc,+BAGhB,CACE3E,GAAI,wBACJuD,KAAM,WACNa,YAAa,8BACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,OACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAEhS,OAAQ,KAAMiS,UAAW,GACnCC,aAAc,+BAGhB,CACE3E,GAAI,wBACJuD,KAAM,YACNa,YAAa,WACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,MACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAC,EACTE,aAAc,YAGhB,CACE3E,GAAI,wBACJuD,KAAM,aACNa,YAAa,WACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,OACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAC,EACTE,aAAc,YAGhB,CACE3E,GAAI,oBACJuD,KAAM,QACNa,YAAa,eACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,MACbC,aAAc,KACdC,SAAU,OACVC,OAAQ,CAAEG,OAAQ,CAAC,MAAO,MAAO,MAAO,QACxCD,aAAc,yBAGhB,CACE3E,GAAI,kBACJuD,KAAM,QACNa,YAAa,eACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,MACbC,aAAc,KACdC,SAAU,OACVC,OAAQ,CAAEG,OAAQ,CAAC,KAAM,KAAM,OAC/BD,aAAc,kBAGhB,CACE3E,GAAI,sBACJuD,KAAM,SACNa,YAAa,gBACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,MACbC,aAAc,MACdC,SAAU,OACVC,OAAQ,CAAEG,OAAQ,CAAC,KAAM,KAAM,OAC/BD,aAAc,mBAGhB,CACE3E,GAAI,oBACJuD,KAAM,QACNa,YAAa,eACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,MACbC,aAAc,KACdC,SAAU,OACVC,OAAQ,CAAEG,OAAQ,CAAC,MAAO,OAC1BD,aAAc,gBAGhB,CACE3E,GAAI,qBACJuD,KAAM,QACNa,YAAa,eACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,MACbC,aAAc,KACdC,SAAU,OACVC,OAAQ,CAAEG,OAAQ,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,OACjDD,aAAc,2BAGhB,CACE3E,GAAI,oBACJuD,KAAM,QACNa,YAAa,eACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,MACbC,aAAc,KACdC,SAAU,OACVC,OAAQ,CAAEG,OAAQ,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,OACjDD,aAAc,2BAGhB,CACE3E,GAAI,kBACJuD,KAAM,QACNa,YAAa,eACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,MACbC,aAAc,KACdC,SAAU,OACVC,OAAQ,CAAEG,OAAQ,CAAC,KAAM,KAAM,OAC/BD,aAAc,kBAGhB,CACE3E,GAAI,qBACJuD,KAAM,QACNa,YAAa,eACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,MACbC,aAAc,KACdC,SAAU,OACVC,OAAQ,CAAEG,OAAQ,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,OACjDD,aAAc,2BAGhB,CACE3E,GAAI,0BACJuD,KAAM,UACNa,YAAa,oBACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,MACbC,aAAc,MACdC,SAAU,UACVC,OAAQ,CAAEI,IAAK,EAAGjH,IAAK,KACvB+G,aAAc,mBAGhB,CACE3E,GAAI,oBACJuD,KAAM,WACNa,YAAa,eACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,QACbC,aAAc,OACdC,SAAU,OACVC,OAAQ,CAAEG,OAAQ,CAAC,KAAM,OACzBD,aAAc,iBAGhB,CACE3E,GAAI,mBACJuD,KAAM,UACNa,YAAa,eACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,QACbC,aAAc,OACdC,SAAU,OACVC,OAAQ,CAAEG,OAAQ,CAAC,MAAO,OAAQ,QAClCD,aAAc,wBAGhB,CACE3E,GAAI,sBACJuD,KAAM,SACNa,YAAa,cACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,QACbC,aAAc,MACdC,SAAU,OACVC,OAAQ,CAAEG,OAAQ,CAAC,KAAM,KAAM,OAC/BD,aAAc,mBAGhB,CACE3E,GAAI,wBACJuD,KAAM,QACNa,YAAa,cACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,OACbC,aAAc,MACdC,SAAU,OACVC,OAAQ,CAAEG,OAAQ,CAAC,KAAM,KAAM,OAC/BD,aAAc,mBAGhB,CACE3E,GAAI,2BACJuD,KAAM,SACNa,YAAa,oBACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,OACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAEK,SAAU,QAASC,UAAW,QACxCJ,aAAc,0BAGhB,CACE3E,GAAI,wBACJuD,KAAM,UACNa,YAAa,qBACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,QACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAEK,SAAU,QAASC,UAAW,QACxCJ,aAAc,0BAGhB,CACE3E,GAAI,4BACJuD,KAAM,SACNa,YAAa,yBACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,QACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAEK,SAAU,QAASC,UAAW,QACxCJ,aAAc,0BAGhB,CACE3E,GAAI,kCACJuD,KAAM,WACNa,YAAa,oBACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,QACbC,aAAc,SACdC,SAAU,WACVC,OAAQ,CAAEK,SAAU,QAASC,UAAW,QACxCJ,aAAc,4BAGhB,CACE3E,GAAI,kCACJuD,KAAM,SACNa,YAAa,2BACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,OACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAEO,UAAW,UAAWC,SAAU,EAAGC,SAAU,KACvDP,aAAc,wCAGhB,CACE3E,GAAI,qCACJuD,KAAM,SACNa,YAAa,2BACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,OACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAEO,UAAW,UAAWC,SAAU,EAAGC,SAAU,KACvDP,aAAc,wCAGhB,CACE3E,GAAI,gCACJuD,KAAM,SACNa,YAAa,eACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,OACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAEO,UAAW,QACrBL,aAAc,8BAGhB,CACE3E,GAAI,+BACJuD,KAAM,UACNa,YAAa,2BACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,QACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAEO,UAAW,UAAWC,SAAU,EAAGC,SAAU,KACvDP,aAAc,wCAGhB,CACE3E,GAAI,kCACJuD,KAAM,UACNa,YAAa,2BACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,QACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAEO,UAAW,UAAWC,SAAU,EAAGC,SAAU,KACvDP,aAAc,wCAGhB,CACE3E,GAAI,6BACJuD,KAAM,UACNa,YAAa,eACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,QACbC,aAAc,OACdC,SAAU,WACVC,OAAQ,CAAEO,UAAW,QACrBL,aAAc,8BAGhB,CACE3E,GAAI,wBACJuD,KAAM,SACNa,YAAa,mBACb1H,SAAS,EACT2H,SAAS,EACT1F,WAAW,EACX2F,YAAa,MACbC,aAAc,KACdC,SAAU,SACVC,OAAQ,CAAEpD,QAAS,WACnBsD,aAAc,2BAOZQ,EAAwB,0BACxBC,EAAgC,+BAChCC,EAAoB,CACxB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,eACA,OACA,KACA,QACA,KACA,OACA,QAGIC,EAAmB,CAEvB,YAAAC,GACE,MAAMjR,EAASkR,GAAMtK,IAAIiK,EAAuB,MAC1CM,EAAgBD,GAAMtK,IAAIkK,EAA+B,MAG/D,IAAK9Q,IAAW+C,MAAMqO,QAAQpR,GAI5B,OAFAkR,GAAMnK,IAAI8J,EAAuB,IAAIE,IACrCG,GAAMnK,IAAI+J,EAA+BrI,GAClC,IAAIsI,GAIb,IAAKI,GAAiBzI,EAAeyI,EAAe1I,GAAyB,EAAG,CAC9E9I,QAAQC,IAAI,sCAAsCuR,GAAiB,kBAGjD,IAAIE,IAAIrR,GAA1B,MACMsR,EAAe,IAAID,IAAIN,GACvBQ,EAAc,IAAIR,GAYxB,OATA/Q,EAAOR,QAAQC,IACR6R,EAAaE,IAAI/R,IACpB8R,EAAY7S,KAAKe,KAKrByR,GAAMnK,IAAI8J,EAAuBU,GACjCL,GAAMnK,IAAI+J,EAA+BrI,GAClC8I,CACT,CAEA,OAAOvR,CACT,EAGAyR,aAAaC,GACN3O,MAAMqO,QAAQM,IAInBR,GAAMnK,IAAI8J,EAAuBa,GACjCR,GAAMnK,IAAI+J,EAA+BrI,IAClC,IALL9I,QAAQG,KAAK,sCACN,GAQX6R,eAAc,KACZT,GAAMnK,IAAI8J,EAAuB,IAAIE,IACrCG,GAAMnK,IAAI+J,EAA+BrI,IAClC,GAKT,aAAAmJ,CAAcpT,GACZ,IAAKA,GAAsB,iBAARA,EAAkB,OAAO,EAC5C,MAAMqT,EAAY7T,KAAKiT,eACvB,GAAyB,IAArBY,EAAUtT,OAAc,OAAO,EAGnC,MAAMsH,EAAQrH,EACX0K,MAAM,SACNtK,IAAI6E,GAAKA,EAAEW,QACX4H,OAAOvI,GAAKA,GACTqO,EAAWjM,EAAMtH,OAAS,EAAIsH,EAAMA,EAAMtH,OAAS,GAAKC,EAG9D,OAAOqT,EAAUE,KAAKtS,GAAQqS,EAAS7L,SAASxG,GAClD,GAMIuS,EAAsB,4BACtBC,EAA4B,uBAE5BC,EAAgB,CACpBtU,OAAQ,KAGR,aAAAuU,GACE,MAAMnS,EAASkR,GAAMtK,IAAIoL,EAAqB,MAC9C,IAAKhS,EAEH,OADAhC,KAAKoU,qBACEpU,KAAKJ,OAGd,IAAIyU,GAAY,EA4BhB,OA3BArS,EAAOR,QAAQ8S,IACb,IAAKA,EAAOC,SAAWvU,KAAKwU,gBAAgBF,EAAOC,QAAS9J,GAAyB,EAAG,CACtF9I,QAAQC,IACN,8BAA8B0S,EAAOrD,eAAeqD,EAAOC,SAAW,kBAGxE,MAAME,EAAcH,EAAOI,MAAM1G,OAAO2G,IAAMA,EAAE5C,SAC1C6C,EAAiB,IAAIvB,IAAIxB,EAAyBjR,IAAI+T,GAAKA,EAAEjH,IAAMiH,EAAE3C,YAAc,IAAM2C,EAAEzC,WAC3F2C,EAAc,IAAIhD,EAAyBjR,IAAI+T,IAAK,IAAMA,EAAG5C,SAAS,MAC5E0C,EAAYjT,QAAQsT,IAClB,MAAMtU,EAAMsU,EAAKpH,IAAMoH,EAAK9C,YAAc,IAAM8C,EAAK5C,SAChD0C,EAAepB,IAAIhT,IACtBqU,EAAYnU,KAAK,IAAKoU,EAAM/C,SAAS,MAGzCuC,EAAOI,MAAQG,EACfP,EAAOC,QAAU9J,EACjB4J,GAAY,CACd,IAEEA,IACFrU,KAAKiC,MAAMD,GACX+S,EAAsBC,aAEtBhV,KAAKJ,OAAS,OAGXyU,GAAarU,KAAKJ,OACdI,KAAKJ,QAEdI,KAAKJ,OAASoC,EACPA,EACT,EAGA,eAAAiT,GACE,MAAMC,EAAUlV,KAAKmU,gBACfgB,EAAWjC,GAAMtK,IAAIqL,EAA2B,WACtD,OAAOiB,EAAQE,KAAKC,GAAKA,EAAE3H,KAAOyH,IAAaD,EAAQ,EACzD,EAGA,eAAAI,CAAgB5H,GACd,QAAK1N,KAAKmU,gBAAgBiB,KAAKC,GAAKA,EAAE3H,KAAOA,KAC7CwF,GAAMnK,IAAIkL,EAA2BvG,GACrCqH,EAAsBC,aACtBrT,QAAQC,IAAI,4BAA6B8L,IAClC,EACT,EAGA,YAAA6H,CAAatE,GACX,MAAMiE,EAAUlV,KAAKmU,gBACfqB,EAAY,CAChB9H,GAAI,UAAYvL,KAAKC,MACrB6O,KAAMA,GAAQ,MACdc,SAAS,EACT2C,MAAO,GACPH,QAAS9J,EACTgL,WAAW,IAAItT,MAAOuT,eAIxB,OAFAR,EAAQxU,KAAK8U,GACbxV,KAAKiC,MAAMiT,GACJM,CACT,EAGA,eAAAG,CAAgBjI,GACd,MAAMe,EAASzO,KAAKmU,gBAAgBiB,KAAKC,GAAKA,EAAE3H,KAAOA,GACvD,IAAKe,EAAQ,OAAO,KACpB,MAAMyG,EAAUlV,KAAKmU,gBACfqB,EAAY,CAChB9H,GAAI,UAAYvL,KAAKC,MACrB6O,KAAMxC,EAAOwC,KAAO,QACpBc,SAAS,EACT2C,MAAO5T,KAAKC,MAAMD,KAAKwB,UAAUmM,EAAOiG,QACxCH,QAAS9F,EAAO8F,SAAW9J,EAC3BgL,WAAW,IAAItT,MAAOuT,eAKxB,OAHAR,EAAQxU,KAAK8U,GACbxV,KAAKiC,MAAMiT,GACXvT,QAAQC,IAAI,4BAA6B6M,EAAOwC,KAAM,KAAMuE,EAAUvE,MAC/DuE,CACT,EAGA,YAAAI,CAAalI,GACX,MAAMwH,EAAUlV,KAAKmU,gBACfG,EAASY,EAAQE,KAAKC,GAAKA,EAAE3H,KAAOA,GAC1C,IAAK4G,GAAwB,YAAdA,EAAO5G,GAAkB,OAAO,EAC/C,MAAMmI,EAAWX,EAAQlH,OAAOqH,GAAKA,EAAE3H,KAAOA,GAO9C,OANA1N,KAAKiC,MAAM4T,GACP3C,GAAMtK,IAAIqL,KAA+BvG,IAC3CwF,GAAMnK,IAAIkL,EAA2B,WACrCc,EAAsBC,cAExBrT,QAAQC,IAAI,4BAA6B8L,IAClC,CACT,EAGA,iBAAAoI,CAAkBpI,EAAIgH,GACpB,MAAMQ,EAAUlV,KAAKmU,gBACfG,EAASY,EAAQE,KAAKC,GAAKA,EAAE3H,KAAOA,GAC1C,QAAK4G,IACLA,EAAOI,MAAQA,EACf1U,KAAKiC,MAAMiT,GACXH,EAAsBC,cACf,EACT,EAGA,YAAAe,CAAarI,GACX,MAAM4G,EAAStU,KAAKmU,gBAAgBiB,KAAKC,GAAKA,EAAE3H,KAAOA,GACvD,IAAK4G,EAAQ,OAAO,KAUpB,OATaxT,KAAKwB,UAChB,CACEkP,OAAQ,gBACR+C,QAAS9J,EACT6J,OAAQ,CAAErD,KAAMqD,EAAOrD,KAAMyD,MAAOJ,EAAOI,QAE7C,KACA,EAGJ,EAGAF,gBAAe,CAAC7J,EAAIC,IACXF,EAAeC,EAAIC,GAI5B,uBAAAoL,CAAwBC,GACtB,MAAMf,EAAUlV,KAAKmU,gBACfG,EAASY,EAAQE,KAAKC,GAAKA,EAAE3H,KAAOuI,GAC1C,IAAK3B,EAAQ,OAAO,EAGpB,MAAMG,EAAcH,EAAOI,MAAM1G,OAAO2G,IAAMA,EAAE5C,SAC1C6C,EAAiB,IAAIvB,IAAIxB,EAAyBjR,IAAI+T,GAAKA,EAAEjH,IAAMiH,EAAE3C,YAAc,IAAM2C,EAAEzC,WAG3FgE,EAAiB,IAAIC,IAC3BtE,EAAyBrQ,QAAQmT,IAC/B,MAAMnU,EAAMmU,EAAEjH,IAAMiH,EAAE3C,YAAc,IAAM2C,EAAEzC,SAC5CgE,EAAenN,IAAIvI,EAAKmU,KAI1B,MAAME,EAAc,GACduB,EAAqB,IAAI/C,IAoC/B,OAjCAxB,EAAyBrQ,QAAQ6U,IAC/B,MAAM7V,EAAM6V,EAAQ3I,IAAM2I,EAAQrE,YAAc,IAAMqE,EAAQnE,SACxDoE,EAAehC,EAAOI,MAAMU,KAAKT,IAAMA,EAAEjH,IAAMiH,EAAE3C,YAAc,IAAM2C,EAAEzC,YAAc1R,GAAOmU,EAAE5C,SACpG,GAAIuE,EAAc,CAEGxV,KAAKwB,UAAUgU,KAAkBxV,KAAKwB,UAAU+T,GAGjExB,EAAYnU,KAAK,IAAK4V,EAAcvE,SAAS,IAG7C8C,EAAYnU,KAAK,IAAK2V,EAAStE,SAAS,GAE5C,MAEE8C,EAAYnU,KAAK,IAAK2V,EAAStE,SAAS,IAE1CqE,EAAmBG,IAAI/V,KAIzBiU,EAAYjT,QAAQsT,IAClB,MAAMtU,EAAMsU,EAAKpH,IAAMoH,EAAK9C,YAAc,IAAM8C,EAAK5C,SAChD0C,EAAepB,IAAIhT,IACtBqU,EAAYnU,KAAK,IAAKoU,EAAM/C,SAAS,MAIzCuC,EAAOI,MAAQG,EACfP,EAAOC,QAAU9J,EACjBzK,KAAKiC,MAAMiT,GACXH,EAAsBC,aACtBrT,QAAQC,IAAI,4BAA6B0S,EAAOrD,OACzC,CACT,EAGA,YAAAuF,CAAaC,EAAMC,GAAY,GAC7B,IACE,MAAM7V,EAAOC,KAAKC,MAAM0V,GACxB,GAAoB,kBAAhB5V,EAAK2Q,SAA+B3Q,EAAKyT,OAAQ,OAAO,KAE5D,MAAMqC,EAAkB9V,EAAK0T,SAAW,QAClCqC,EAAa5W,KAAKwU,gBAAgBmC,EAAiBlM,GAAyB,EAE5EyK,EAAUlV,KAAKmU,gBACfqB,EAAY,CAChB9H,GAAI,YAAcvL,KAAKC,MACvB6O,KAAMpQ,EAAKyT,OAAOrD,MAAQ,QAC1Bc,SAAS,EACT2C,MAAO7T,EAAKyT,OAAOI,OAAS,GAC5BH,QAASoC,EACTlB,WAAW,IAAItT,MAAOuT,eAkBxB,OAdIkB,GAAcF,GAChBxB,EAAQxU,KAAK8U,GACbxV,KAAKiC,MAAMiT,GACXlV,KAAKgW,wBAAwBR,EAAU9H,IACvC/L,QAAQC,IAAI,+BAAgC4T,EAAUvE,QAEtDiE,EAAQxU,KAAK8U,GACbxV,KAAKiC,MAAMiT,GACXvT,QAAQC,IAAI,4BAA6B4T,EAAUvE,MAC/C2F,GACFjV,QAAQG,KAAK,wEAIV,CAAEwS,OAAQkB,EAAWoB,WAAYA,IAAeF,EACzD,CAAE,MAAO7U,GAEP,OADAF,QAAQqK,MAAM,4BAA6BnK,GACpC,IACT,CACF,EAGA,uBAAAgV,GACE,IACE,MAAMC,EAAWhW,KAAKwB,UAAUuP,GAEhC,IAAIkF,EAAO,EACX,IAAK,IAAI1W,EAAI,EAAGA,EAAIyW,EAASvW,OAAQF,IAAK,CAExC0W,GAAQA,GAAQ,GAAKA,EADRD,EAASE,WAAW3W,GAEjC0W,GAAcA,CAChB,CACA,OAAOA,EAAKE,SAAS,GACvB,CAAE,MAAOpV,GAEP,OADAF,QAAQqK,MAAM,8BAA+BnK,GACtC,GACT,CACF,EAGA,kBAAAuS,GACE,MAAM8C,EAAiBlX,KAAK6W,0BACtB7U,EAASkR,GAAMtK,IAAIoL,EAAqB,MAG9C,GAAIhS,GAAU+C,MAAMqO,QAAQpR,GAAS,CACnC,MAAMmV,EAAgBnV,EAAOoT,KAAKC,GAAc,YAATA,EAAE3H,IACzC,GAAIyJ,GAAiBA,EAAcC,kBAAoBF,EAAgB,CACrEvV,QAAQC,IAAI,0CAEZ,MAAM6S,EAAc0C,EAAczC,MAAM1G,OAAO2G,IAAMA,EAAE5C,SAMvD,OALAoF,EAAczC,MAAQ,IAAI7C,EAAyBjR,IAAI+T,IAAK,IAAMA,QAAUF,GAC5E0C,EAAcC,gBAAkBF,EAChClX,KAAKJ,OAASoC,EACdhC,KAAKiC,MAAMD,QACXkR,GAAMnK,IAAIkL,EAA2B,UAEvC,CACF,CAEA,MAAMkD,EAAgB,CACpBzJ,GAAI,UACJuD,KAAM,OACNc,SAAS,EACT2C,MAAO7C,EAAyBjR,IAAI+T,IAAK,IAAMA,KAC/CJ,QAAS9J,EACT2M,gBAAiBF,EACjBzB,WAAW,IAAItT,MAAOuT,eAGlB2B,EAAYnE,GAAMtK,IA3zBS,0BA2zByB,IACtDyO,EAAU9W,OAAS,IACrB4W,EAAczC,MAAMhU,QAAQ2W,EAAUzW,IAAI+T,IAAK,IAAMA,EAAG5C,SAAS,MACjEpQ,QAAQC,IAAI,6BAA8ByV,EAAU9W,OAAQ,MAE9DP,KAAKJ,OAAS,CAACuX,GACfnX,KAAKiC,MAAMjC,KAAKJ,QAChBsT,GAAMnK,IAAIkL,EAA2B,UACvC,EAGA,kBAAAqD,GACE,MAAMpC,EAAUlV,KAAKmU,gBACfgD,EAAgBjC,EAAQE,KAAKC,GAAc,YAATA,EAAE3H,IAC1C,GAAIyJ,EAAe,CAEjB,MAAM1C,EAAc0C,EAAczC,MAAM1G,OAAO2G,IAAMA,EAAE5C,SAKvD,OAJAoF,EAAczC,MAAQ,IAAI7C,EAAyBjR,IAAI+T,IAAK,IAAMA,QAAUF,GAC5E0C,EAAcC,gBAAkBpX,KAAK6W,0BACrC7W,KAAKiC,MAAMiT,GACXH,EAAsBC,cACf,CACT,CACA,OAAO,CACT,EAEA,KAAA/S,CAAMiT,GACJhC,GAAMnK,IAAIiL,EAAqBkB,GAC/BlV,KAAKJ,OAASsV,CAChB,EAEA,UAAAF,GACEhV,KAAKJ,OAAS,IAChB,GAIImV,EAAwB,CAC5BnV,OAAQ,KACR2X,cAAe,KAGf,WAAAC,GACE,GAAIxX,KAAKJ,OAAQ,OAAOI,KAAKJ,OAE7B,MAAM0U,EAASJ,EAAce,kBACvBwC,EAAgBzX,KAAK0X,mBAGrBC,GAAYrD,GAAQI,OAAS,IAAI9T,IAAIkU,IAAQ,IAC9CA,EACH1K,aAAoC3F,IAA3BgT,EAAc3C,EAAKpH,IAAoB+J,EAAc3C,EAAKpH,IAAMoH,EAAK1K,WAIhF,OADApK,KAAKJ,OAAS+X,EACPA,CACT,EAGA,gBAAAD,GACE,OAAI1X,KAAKuX,gBACTvX,KAAKuX,cAAgBrE,GAAMtK,IAAIiI,EAAgC,CAAC,IADjC7Q,KAAKuX,aAGtC,EAGA,iBAAAK,CAAkBC,EAAQzN,GACxB,MAAM0N,EAAS9X,KAAK0X,mBACpBI,EAAOD,GAAUzN,EACjB8I,GAAMnK,IAAI8H,EAAgCiH,GAC1C9X,KAAKuX,cAAgBO,EACrB9X,KAAKJ,OAAS,IAChB,EAGA,mBAAAmY,CAAoBF,EAAQxL,GAC1B,MAAMiI,EAASJ,EAAce,kBAC7B,IAAKX,EAAQ,OAAO,EAEpB,MAAMQ,EAAOR,EAAOI,MAAMU,KAAKT,GAAKA,EAAEjH,KAAOmK,GAC7C,QAAK/C,IAELA,EAAKzI,UAAYA,EACjB6H,EAAc4B,kBAAkBxB,EAAO5G,GAAI4G,EAAOI,QAC3C,EACT,EAGA,eAAAsD,GACE,OAAOhY,KAAKwX,cAAcxJ,OAAO8G,GAAQA,EAAK1K,QAChD,EAGA,aAAA6N,CAAcnD,GACZ,IAAKA,EAAKpH,KAAOoH,EAAK7D,OAAS6D,EAAK9C,YAElC,OADArQ,QAAQqK,MAAM,yCACP,EAGT,MAAMsI,EAASJ,EAAce,kBAC7B,IAAKX,EAAQ,OAAO,EAGpB,GAAIA,EAAOI,MAAMX,KAAKY,GAAKA,EAAEjH,KAAOoH,EAAKpH,IAEvC,OADA/L,QAAQqK,MAAM,yCAA0C8I,EAAKpH,KACtD,EAGT,MAAM2I,EAAU,IAAKvB,EAAM/C,SAAS,EAAO3H,SAAS,GAIpD,OAHAkK,EAAOI,MAAMhU,KAAK2V,GAClBnC,EAAc4B,kBAAkBxB,EAAO5G,GAAI4G,EAAOI,OAClD/S,QAAQC,IAAI,oCAAqCyU,EAAQpF,OAClD,CACT,EAGA,gBAAAiH,CAAiBL,GACf,MAAMvD,EAASJ,EAAce,kBAC7B,IAAKX,EAAQ,OAAO,EAEpB,MAAM6D,EAAQ7D,EAAOI,MAAM0D,UAAUzD,GAAKA,EAAEjH,KAAOmK,GACnD,IAAe,IAAXM,EAAc,OAAO,EAEzB7D,EAAOI,MAAM2D,OAAOF,EAAO,GAC3BjE,EAAc4B,kBAAkBxB,EAAO5G,GAAI4G,EAAOI,OAGlD,MAAMoD,EAAS9X,KAAK0X,mBAMpB,cALOI,EAAOD,GACd3E,GAAMnK,IAAI8H,EAAgCiH,GAC1C9X,KAAKuX,cAAgBO,EAErBnW,QAAQC,IAAI,oCAAqCiW,IAC1C,CACT,EAGA,gBAAAS,CAAiBT,EAAQU,GACvB,MAAMjE,EAASJ,EAAce,kBAC7B,IAAKX,EAAQ,OAAO,EAEpB,MAAM6D,EAAQ7D,EAAOI,MAAM0D,UAAUzD,GAAKA,EAAEjH,KAAOmK,GACnD,OAAe,IAAXM,IAEJ7D,EAAOI,MAAMyD,GAAS,IAAK7D,EAAOI,MAAMyD,MAAWI,EAAS7K,GAAImK,GAChE3D,EAAc4B,kBAAkBxB,EAAO5G,GAAI4G,EAAOI,QAC3C,EACT,EAGA,OAAA8D,CAAQX,GACN,OAAO7X,KAAKwX,cAAcpC,KAAKT,GAAKA,EAAEjH,KAAOmK,EAC/C,EAGA,UAAA7C,GACEhV,KAAKJ,OAAS,KACdI,KAAKuX,cAAgB,IACvB,EAGA,eAAAkB,CAAgBjW,GACd,OAAOxC,KAAKgY,kBAAkBhK,OAAO8G,GAAQA,EAAK9C,cAAgBxP,EACpE,GAMIkW,EAA6B,CACjC9Y,OAAQ,KACR2X,cAAe,KAGfoB,YAAW,IACF,SAASxW,KAAKC,SAASiJ,KAAKsC,SAASsJ,SAAS,IAAI2B,OAAO,EAAG,KAIrE,WAAApB,GACE,GAAIxX,KAAKJ,OAAQ,OAAOI,KAAKJ,OAE7B,MAAM8U,EAAQxB,GAAMtK,IAAI6H,EAAyB,IAC3CgH,EAAgBzX,KAAK0X,mBAGrBC,EAAWjD,EAAM9T,IAAIkU,IAAQ,IAC9BA,EACH1K,aAAoC3F,IAA3BgT,EAAc3C,EAAKpH,IAAoB+J,EAAc3C,EAAKpH,IAAMoH,EAAK1K,WAIhF,OADApK,KAAKJ,OAAS+X,EACPA,CACT,EAGA,gBAAAD,GACE,OAAI1X,KAAKuX,gBACTvX,KAAKuX,cAAgBrE,GAAMtK,IAAIgI,EAA2B,CAAC,IAD5B5Q,KAAKuX,aAGtC,EAGA,kBAAAsB,CAAmBf,GACjB5E,GAAMnK,IAAI6H,EAA2BkH,GACrC9X,KAAKuX,cAAgBO,CACvB,EAGA,eAAAE,GACE,OAAOhY,KAAKwX,cAAcxJ,OAAO8G,IAAyB,IAAjBA,EAAK1K,QAChD,EAGA,kBAAA0O,CAAmBtW,EAAWuW,GAG5B,OAFiB/Y,KAAKgY,kBAGnBhK,OAAO8G,IAEN,OAAQA,EAAK5D,MAAMtE,MACjB,IAAK,SACH,OAAO,EACT,IAAK,QACH,OAAOkI,EAAK5D,MAAM8H,YAAclE,EAAK5D,MAAM8H,WAAW/Q,SAASzF,GACjE,IAAK,SACH,OACEsS,EAAK5D,MAAM8H,YACXlE,EAAK5D,MAAM8H,WAAW/Q,SAASzF,IAC/BsS,EAAK5D,MAAM+H,aACXnE,EAAK5D,MAAM+H,YAAYhR,SAAS8Q,GAEpC,QACE,OAAO,KAGZ5X,KAAK,CAACC,EAAGC,IAAMA,EAAE6X,SAAW9X,EAAE8X,SACnC,EAGA,iBAAAtB,CAAkBC,EAAQzN,GACxB,MAAM0N,EAAS9X,KAAK0X,mBACpBI,EAAOD,GAAUzN,EACjBpK,KAAK6Y,mBAAmBf,GACxB9X,KAAKgV,YACP,EAGA,aAAAiD,CAAcnD,GACZ,MAAMJ,EAAQxB,GAAMtK,IAAI6H,EAAyB,IAGjD,IAAKqE,EAAK7D,OAAS6D,EAAK/F,UAAY+F,EAAK5D,MAEvC,OADAvP,QAAQqK,MAAM,+CACP,EAGT,MAAMqK,EAAmC,CACvC3I,GAAI1N,KAAK2Y,cACT1H,KAAM6D,EAAK7D,KACXa,YAAagD,EAAKhD,YAClBqH,UAAWrE,EAAKqE,WAAa,UAC7BpK,QAAS+F,EAAK/F,QACdqK,MAAOtE,EAAKsE,OAAS,CAAC,EACtBC,YAAavE,EAAKuE,YAClBnI,MAAO4D,EAAK5D,MACZ9G,aAA0B3F,IAAjBqQ,EAAK1K,SAAwB0K,EAAK1K,QAC3C8O,SAAUpE,EAAKoE,UAAY,GAC3BI,YAAaxE,EAAKwE,aAAe,OACjCC,UAAWzE,EAAKyE,WAAa,GAC7BC,SAAU1E,EAAK0E,UAAY,CAAEC,aAAc,IAAKC,WAAY,IAAMC,eAAgB,KAClFlE,UAAWtT,KAAKC,MAChBwX,UAAWzX,KAAKC,OAMlB,OAHAsS,EAAMhU,KAAK2V,GACXnD,GAAMnK,IAAI0H,EAAyBiE,GACnC1U,KAAKgV,aACEqB,CACT,EAGA,UAAAwD,CAAWhC,GACT,MAAMnD,EAAQxB,GAAMtK,IAAI6H,EAAyB,IAC3C0H,EAAQzD,EAAM0D,UAAUzD,GAAKA,EAAEjH,KAAOmK,GAC5C,OAAe,IAAXM,IAEJzD,EAAM2D,OAAOF,EAAO,GACpBjF,GAAMnK,IAAI0H,EAAyBiE,GACnC1U,KAAKgV,cACE,EACT,EAGA,UAAA8E,CAAWjC,EAAQU,GACjB,MAAM7D,EAAQxB,GAAMtK,IAAI6H,EAAyB,IAC3C0H,EAAQzD,EAAM0D,UAAUzD,GAAKA,EAAEjH,KAAOmK,GAC5C,OAAe,IAAXM,IAEJzD,EAAMyD,GAAS,IACVzD,EAAMyD,MACNI,EACH7K,GAAImK,EACJ+B,UAAWzX,KAAKC,OAElB8Q,GAAMnK,IAAI0H,EAAyBiE,GACnC1U,KAAKgV,cACE,EACT,EAGA,OAAAwD,CAAQX,GACN,OAAO7X,KAAKwX,cAAcpC,KAAKT,GAAKA,EAAEjH,KAAOmK,EAC/C,EAGA,UAAA7C,GACEhV,KAAKJ,OAAS,KACdI,KAAKuX,cAAgB,IACvB,GAMIwC,GAAqB,CACzBna,OAAQ,KAGR,aAAAuU,GACE,GAAInU,KAAKJ,OAAQ,OAAOI,KAAKJ,OAE7B,MAAMsV,EAAUhC,GAAMtK,IAAI8H,EAA2B,IAGrD,GAAuB,IAAnBwE,EAAQ3U,OAAc,CACxB,MAAM4W,EAA6B,CACjCzJ,GAAI,gBACJuD,KAAM,OACNa,YAAa,gBACbyC,QAAS,QACTG,MAAO,GACPe,UAAWtT,KAAKC,MAChBwX,UAAWzX,KAAKC,OAElB8S,EAAQxU,KAAKyW,GACbjE,GAAMnK,IAAI2H,EAA2BwE,EACvC,CAGA,OADAlV,KAAKJ,OAASsV,EACPA,CACT,EAGA,eAAAD,GACE,MAAME,EAAWjC,GAAMtK,IAAI+H,EAAiC,iBACtDuE,EAAUlV,KAAKmU,gBACrB,OAAOe,EAAQE,KAAKC,GAAKA,EAAE3H,KAAOyH,IAAaD,EAAQ,EACzD,EAGA,eAAAI,CAAgBW,GAGd,OAFgBjW,KAAKmU,gBACEiB,KAAKC,GAAKA,EAAE3H,KAAOuI,IAM1C/C,GAAMnK,IAAI4H,EAAiCsF,GAG3CyC,EAA2B1D,cAEpB,IATLrT,QAAQqK,MAAM,kCAAmCiK,IAC1C,EASX,EAGA,YAAAV,CAAatE,EAAM+I,GACjB,MAAM9E,EAAUlV,KAAKmU,gBAGrB,GAAIe,EAAQnB,KAAKsB,GAAKA,EAAEpE,OAASA,GAE/B,OADAtP,QAAQqK,MAAM,oCAAqCiF,IAC5C,EAGT,MAAMgJ,EAAeD,EAAiB9E,EAAQE,KAAKC,GAAKA,EAAE3H,KAAOsM,GAAkBha,KAAKiV,kBAElFO,EAAyB,CAC7B9H,GAAI,gBAAgBvL,KAAKC,QACzB6O,KAAMA,EACNa,YAAamI,GAAcnI,YAC3ByC,QAAS,QACTG,MAAOuF,EAAenZ,KAAKC,MAAMD,KAAKwB,UAAU2X,EAAavF,QAAU,GACvEe,UAAWtT,KAAKC,MAChBwX,UAAWzX,KAAKC,OAKlB,OAFA8S,EAAQxU,KAAK8U,GACbxV,KAAKiC,MAAMiT,GACJM,CACT,EAGA,iBAAAM,CAAkBG,EAAUvB,GAC1B,MAAMQ,EAAUlV,KAAKmU,gBACfgE,EAAQjD,EAAQkD,UAAU/C,GAAKA,EAAE3H,KAAOuI,GAC9C,OAAe,IAAXkC,IAEJjD,EAAQiD,GAAOzD,MAAQ5T,KAAKC,MAAMD,KAAKwB,UAAUoS,IACjDQ,EAAQiD,GAAOyB,UAAYzX,KAAKC,MAEhCpC,KAAKiC,MAAMiT,GAGPe,IAAa/C,GAAMtK,IAAI+H,IACzB+H,EAA2B1D,cAGtB,EACT,EAGA,YAAAY,CAAaK,GACX,MAAMf,EAAUlV,KAAKmU,gBAGrB,GAAIe,EAAQ3U,QAAU,EAEpB,OADAoB,QAAQqK,MAAM,yCACP,EAGT,MAAMmM,EAAQjD,EAAQkD,UAAU/C,GAAKA,EAAE3H,KAAOuI,GAC9C,OAAe,IAAXkC,IAEJjD,EAAQmD,OAAOF,EAAO,GACtBnY,KAAKiC,MAAMiT,GAGPe,IAAa/C,GAAMtK,IAAI+H,IACzB3Q,KAAKsV,gBAAgBJ,EAAQ,GAAGxH,KAG3B,EACT,EAGA,YAAAqI,CAAaE,GACX,MAAM3B,EAAStU,KAAKmU,gBAAgBiB,KAAKC,GAAKA,EAAE3H,KAAOuI,GACvD,OAAK3B,EAEExT,KAAKwB,UAAUgS,EAAQ,KAAM,GAFhB,IAGtB,EAGA,YAAAkC,CAAa0D,GACX,IACE,MAAMrZ,EAAOC,KAAKC,MAAMmZ,GAGxB,IAAKrZ,EAAKoQ,OAASlM,MAAMqO,QAAQvS,EAAK6T,OAEpC,OADA/S,QAAQqK,MAAM,qCACP,EAGT,MAAMkJ,EAAUlV,KAAKmU,gBAGfqB,EAAyB,CAC7B9H,GAAI,gBAAgBvL,KAAKC,QACzB6O,KAAMpQ,EAAKoQ,KACXa,YAAajR,EAAKiR,YAClByC,QAAS1T,EAAK0T,SAAW,QACzBG,MAAO7T,EAAK6T,MAAM9T,IAAKkU,IAAkC,IACpDA,EACHpH,GAAIgL,EAA2BC,iBAEjClD,UAAWtT,KAAKC,MAChBwX,UAAWzX,KAAKC,OAKlB,OAFA8S,EAAQxU,KAAK8U,GACbxV,KAAKiC,MAAMiT,GACJM,CACT,CAAE,MAAO3T,GAEP,OADAF,QAAQqK,MAAM,mCAAoCnK,IAC3C,CACT,CACF,EAGA,KAAAI,CAAMiT,GACJhC,GAAMnK,IAAI2H,EAA2BwE,GACrClV,KAAKJ,OAASsV,CAChB,EAGA,UAAAF,GACEhV,KAAKJ,OAAS,IAChB,GAMIua,GAA4B,CAEhCC,YAAa,IAAIjE,IAGjB,WAAAkE,CAAYjB,GACV,MAAMkB,EAAmB,GAMzB,OALIlB,EAAMmB,iBAAiBD,EAAO5Z,KAAK,KACnC0Y,EAAMoB,QAAQF,EAAO5Z,KAAK,KAC1B0Y,EAAMqB,WAAWH,EAAO5Z,KAAK,KAC7B0Y,EAAMsB,SAASJ,EAAO5Z,KAAK,KAC3B0Y,EAAMuB,QAAQL,EAAO5Z,KAAK,KACvB4Z,EAAOvS,KAAK,GACrB,EAGA,SAAA6S,CAAU7L,EAAiBqK,GAEzB,MAAMyB,EAAgB9L,EAAQ9G,SAAS,QAAU8G,EAAQ9G,SAAS,QAC5D6S,EAAe/L,EAAQ9G,SAAS,QAAU8G,EAAQ9G,SAAS,QAC5C4S,GAAiBC,KAGjB1B,EAAMsB,UACzBtB,EAAQ,IAAKA,EAAOsB,SAAS,IAG/B,MAAMK,EAAW/a,KAAKqa,YAAYjB,GAC5B4B,EAAW,GAAGjM,KAAWgM,IAE/B,GAAI/a,KAAKoa,YAAY5G,IAAIwH,GAAW,CAClC,MAAMC,EAAQjb,KAAKoa,YAAYxR,IAAIoS,GAEnC,OADAC,EAAMC,UAAY,EACXD,CACT,CAEA,IACE,MAAMA,EAAQ,IAAIE,OAAOpM,EAASgM,GAElC,OADA/a,KAAKoa,YAAYrR,IAAIiS,EAAUC,GACxBA,CACT,CAAE,MAAOpZ,GAEP,OADAF,QAAQqK,MAAM,2CAA4C+C,EAASlN,GAC5D,IACT,CACF,EAGA,qBAAAuZ,CAAsBrM,GACpB,IAAIsM,EAAQ,EAGR,mBAAmB/T,KAAKyH,KAAUsM,GAAS,IAG3C,sBAAsB/T,KAAKyH,KAAUsM,GAAS,IAGlD,MAAMC,GAAiBvM,EAAQtH,MAAM,QAAU,IAAIlH,OAGnD,OAFA8a,GAAShQ,KAAKkH,IAAoB,EAAhB+I,EAAmB,IAE9BD,CACT,EAGA,kBAAAE,CAAmBzG,GACjB,MAAM0G,EAAaxb,KAAKob,sBAAsBtG,EAAK/F,SAC7C0M,EAAc3G,EAAK0E,UAAUC,cAAgB,IAEnD,OAAOpO,KAAKC,IAAImQ,EAA2B,EAAbD,EAAgB,GAChD,EAGA,YAAAE,CAAaxY,EAAe4R,EAA+BmG,GACzD,MAAMU,EAAWzY,EAGXyW,EAAiB7E,EAAK0E,UAAUG,gBAAkB,IACxD,GAAIzW,EAAM3C,OAASoZ,EACjB,MAAO,CACLiC,SAAS,EACTD,WACAE,SAAUF,EACVG,SAAS,EACT9P,MAAO,YAAY2N,MAIvB,IACE,MAAMoC,EAAU/b,KAAKub,mBAAmBzG,GAClCkH,EAAY7Z,KAAKC,MAGvB,IAAIyZ,EACJ,OAAQ/G,EAAKqE,WACX,IAAK,UACH0C,EAAW3Y,EAAMyC,QAAQsV,EAAOnG,EAAKuE,aAAe,IACpD,MACF,IAAK,SACHwC,EAAW3Y,EAAMyC,QAAQsV,EAAO,IAChC,MACF,IAAK,WACaA,EAAM3T,KAAKpE,GAC3B2Y,EAAW3Y,EACX,MACF,QACE2Y,EAAW3Y,EAIf,MAAM+Y,EAAU9Z,KAAKC,MAAQ4Z,EAC7B,GAAIC,EAAUF,EAEZ,OADApa,QAAQG,KAAK,0CAA2CgT,EAAK/F,QAASkN,GAC/D,CACLL,SAAS,EACTD,WACAE,SAAUF,EACVG,SAAS,EACT9P,MAAO,QAAQiQ,SAAeF,QAOlC,MAAO,CACLH,SAAS,EACTD,WACAE,WACAC,QANcH,IAAaE,GAAYZ,EAAM3T,KAAKqU,GAQtD,CAAE,MAAO9Z,GAEP,OADAF,QAAQqK,MAAM,0CAA2C8I,EAAK/F,QAASlN,GAChE,CACL+Z,SAAS,EACTD,WACAE,SAAUF,EACVG,SAAS,EACT9P,MAAOtG,OAAO7D,GAElB,CACF,EAGA,YAAAqa,CAAahZ,EAAe4R,GAC1B,GAAI5R,QACF,MAAO,CACL0Y,SAAS,EACTD,SAAU,GACVE,SAAU,GACVC,SAAS,GAIb,MAAMK,EAAWzW,OAAOxC,GAGxB,IAAI6L,EAAU+F,EAAK/F,QACfqK,EAAQtE,EAAKsE,OAAS,CAAC,EAG3B,MAAMgD,EAAYpc,KAAKqc,cAActN,GACjCqN,EAAUE,sBAAwBvN,IAEpCA,EAAUqN,EAAUE,oBACpBlD,EAAQ,IAAKA,KAAUgD,EAAUhD,aAKd3U,IAAjB2U,EAAMoB,SACRpB,EAAMoB,QAAS,GAGjB,MAAMS,EAAQjb,KAAK4a,UAAU7L,EAASqK,GAEtC,OAAK6B,EAUEjb,KAAK0b,aAAaS,EAAUrH,EAAMmG,GAThC,CACLW,SAAS,EACTD,SAAUQ,EACVN,SAAUM,EACVL,SAAS,EACT9P,MAAO,WAKb,EAGA,aAAAqQ,CAAcE,GACZ,MAAMnD,EAAoB,CACxBoB,QAAQ,EACRD,iBAAiB,EACjBE,WAAW,EACXC,SAAS,EACTC,QAAQ,GAIJ6B,EAAkBD,EAAW9U,MAAM,wBACzC,GAAI+U,EAAiB,CACnB,MAAO,CAAEF,EAAqBG,GAAWD,EAMzC,OALIC,EAAQxU,SAAS,OAAMmR,EAAMoB,QAAS,GACtCiC,EAAQxU,SAAS,OAAMmR,EAAMmB,iBAAkB,GAC/CkC,EAAQxU,SAAS,OAAMmR,EAAMqB,WAAY,GACzCgC,EAAQxU,SAAS,OAAMmR,EAAMsB,SAAU,GACvC+B,EAAQxU,SAAS,OAAMmR,EAAMuB,QAAS,GACnC,CAAEvB,QAAOkD,sBAClB,CAGA,MAAO,CAAElD,QAAOkD,oBAAqBC,EACvC,EAGA,YAAAG,CACEC,EAGAjI,GAEA,IAAIkI,EAAe,EACnB,MAAMC,EAAmB,GAEzB,IAEE,IAAIC,GAAiB,EACjBC,EAGA,IAAI5G,IAER,GAAI,SAAUwG,GAAa,YAAaA,GAAa,SAAUA,EAAW,CAExEG,GAAiB,EACjB,MAAME,EAAcL,EACpBI,EAAShU,IAAIiU,EAAY/L,KAAM,CAC7BgM,MAAOD,EACPE,SAAUF,EAAY/L,KACtBA,KAAM+L,EAAY/L,KAClBvO,QAASsa,EAAYta,QACrBya,iBAAkB,GAEtB,KAAO,CAEL,MAAMC,EAAUT,EAEhB/Y,OAAOC,KAAKuZ,GAAS5b,QAAQ0b,IAC3B,IAAKA,EAASzc,WAAW,UAAW,OAEpC,MAAMwc,EAAQG,EAAQF,GACtB,IAAKD,IAAUA,EAAM5P,UAAYtI,MAAMqO,QAAQ6J,EAAM5P,UAAY4P,EAAM5P,QAAQ9M,OAAS,EAEtF,YADAoB,QAAQG,KAAK,8BAA8Bob,KAI7C,MAAM1a,EAAYya,EAAMhM,MAAQiM,EAChCH,EAAShU,IAAIvG,EAAW,CACtBya,QACAC,WACAjM,KAAMzO,EACNE,QAASua,EAAM5P,QAAQ,IAAM,GAC7B8P,gBAAiB,KAGvB,CAEA,GAAsB,IAAlBJ,EAASM,KAEX,OADA1b,QAAQG,KAAK,iCACN,CAAE8a,aAAc,EAAGC,OAAQ,CAAC,cAIrC,IAAK,MAAOra,EAAW8a,KAAcP,EAASvY,UAAW,CACvD,MAAM,MAAEyY,EAAK,QAAEva,EAAO,gBAAEya,GAAoBG,EAE5C,IAAK,MAAMxI,KAAQJ,EAAO,CACxB,IAAKI,EAAK1K,QAAS,SAGnB,MAAM8G,EAAQ4D,EAAK5D,MAGnB,GAF0C,WAAfA,EAAMtE,MAAqBsE,EAAM8H,YAAY/Q,SAASzF,GAIjF,IAEE,GAAIsa,EAAgB,CAElB,MAAMS,EAAQN,EAA+BM,KAC7C,IAAK,IAAIhZ,EAAW,EAAGA,EAAWgZ,EAAKhd,OAAQgE,IAAY,CACzD,MAAM9B,EAAM8a,EAAKhZ,GAGjB,IAAK,IAAIiZ,EAAW,EAAGA,EAAW/a,EAAIlC,OAAQid,IAAY,CACxD,MAAMzE,EAAarW,EAAQ8a,GAG3B,GAAmB,WAAftM,EAAMtE,OACHsE,EAAM+H,aAAahR,SAAS8Q,GAAa,SAIhD,MAAMuB,EAASta,KAAKkc,aAAazZ,EAAI+a,GAAW1I,GAC5CwF,EAAOsB,QACLtB,EAAOwB,UACTrZ,EAAI+a,GAAYlD,EAAOuB,SACvBe,KAGFC,EAAOnc,KAAK,GAAGoU,EAAK7D,SAASzO,OAAe8X,EAAOtO,QAEvD,CACF,CACF,KAAO,CAEL,MAAMqB,EAAU4P,EAAM5P,QACtB,IAAK,IAAI8P,EAAkB,EAAGA,EAAkB9P,EAAQ9M,OAAQ4c,IAAmB,CACjF,MAAM1a,EAAM4K,EAAQ8P,GACpB,GAAKpY,MAAMqO,QAAQ3Q,GAGnB,IAAK,IAAI+a,EAAW,EAAGA,EAAW/a,EAAIlC,OAAQid,IAAY,CACxD,MAAMzE,EAAarW,EAAQ8a,GAG3B,GAAmB,WAAftM,EAAMtE,OACHsE,EAAM+H,aAAahR,SAAS8Q,GAAa,SAIhD,MAAM4C,EAAWlZ,EAAI+a,GACflD,EAASta,KAAKkc,aAAaP,EAAU7G,GAEvCwF,EAAOsB,QACLtB,EAAOwB,UACTrZ,EAAI+a,GAAYlD,EAAOuB,SACvBe,IACAjb,QAAQ8b,MACN,eAAejb,KAAa2a,MAAoBpE,IAChD,IAAIuB,EAAOqB,iBAAiBrB,EAAOuB,cAIvCgB,EAAOnc,KAAK,GAAGoU,EAAK7D,SAASzO,OAAe8X,EAAOtO,QAEvD,CACF,CACF,CACF,CAAE,MAAO0R,GACP,MAAMC,EAAWD,aAAsBlQ,MAAQkQ,EAAWrN,QAAU3K,OAAOgY,GAC3E/b,QAAQqK,MAAM,4BAA4BxJ,SAAkBkb,GAC5Db,EAAOnc,KAAK,GAAGoU,EAAK7D,SAASzO,iBAAyBmb,IACxD,CACF,CACF,CAEIf,EAAe,GACjBjb,QAAQoK,KAAK,4BAA4B6Q,SAEvCC,EAAOtc,OAAS,GAClBoB,QAAQG,KAAK,0BAA0B+a,EAAOtc,aAElD,CAAE,MAAOsB,GACP,MAAM8b,EAAW9b,aAAa2L,MAAQ3L,EAAEwO,QAAU3K,OAAO7D,GACzDF,QAAQqK,MAAM,4BAA6BnK,GAC3Cgb,EAAOnc,KAAK,SAASid,IACvB,CAEA,MAAO,CAAEf,eAAcC,SACzB,EAGA,WAAAe,CACE1a,EACAV,EACAuW,EACAO,GAGA,MAAM5E,EAAQgE,EAA2BI,mBAAmBtW,EAAWuW,GAGvE,GAAqB,IAAjBrE,EAAMnU,OACR,MAAO,CACLqb,SAAS,EACTD,SAAUzY,GAAS,GACnB2Y,SAAU3Y,GAAS,GACnB4Y,SAAS,GAKb,IAAI+B,EAAkBnJ,EAKtB,GAJI4E,IACFuE,EAAkBnJ,EAAM1G,OAAO2G,GAAKA,EAAE2E,cAAgBA,GAAiC,SAAlB3E,EAAE2E,cAG1C,IAA3BuE,EAAgBtd,OAClB,MAAO,CACLqb,SAAS,EACTD,SAAUzY,GAAS,GACnB2Y,SAAU3Y,GAAS,GACnB4Y,SAAS,GAKb,IAAIgC,EAAe5a,GAAS,GACxB6a,GAAa,EAEjB,IAAK,MAAMjJ,KAAQ+I,EAAiB,CAClC,MAAMvD,EAASta,KAAKkc,aAAa4B,EAAchJ,GAC/C,IAAKwF,EAAOsB,QACV,OAAOtB,EAELA,EAAOwB,UACTiC,GAAa,GAEfD,EAAexD,EAAOuB,QACxB,CAEA,MAAO,CACLD,SAAS,EACTD,SAAUzY,GAAS,GACnB2Y,SAAUiC,EACVhC,QAASiC,EAEb,EAGA,UAAAC,CAAWvb,EAAeC,EAAmBF,EAAmB8W,GAC9D,OAAO7W,EAAI7B,IAAI,CAACqd,EAAM9F,KACpB,MAAMY,EAAarW,EAAQyV,GAE3B,OADenY,KAAK4d,YAAYK,EAAMzb,EAAWuW,EAAYO,GAC/CuC,UAElB,EAGA,qBAAAqC,CACEvB,EACArD,GAEA,MAAM9W,EAAYma,EAAU1L,KACtByD,EAAQgE,EAA2BI,mBAAmBtW,EAAW,MAAMwL,OAC3E2G,GAAsB,WAAjBA,EAAEzD,MAAMtE,MAAqB+H,EAAEzD,MAAM8H,YAAY/Q,SAASzF,IAG3D2b,EAAgC,GAEtC,IAAK,MAAMrJ,KAAQJ,EAAO,CACxB,MAAM0J,EAAqD,GAC3D,IAAIC,EAAgB,EAEpB,IAAK,IAAI9Z,EAAW,EAAGA,EAAWoY,EAAUY,KAAKhd,OAAQgE,IAAY,CACnE,MAAM9B,EAAMka,EAAUY,KAAKhZ,GAC3B,IAAK,IAAIiZ,EAAW,EAAGA,EAAW/a,EAAIlC,OAAQid,IAAY,CACxD,MAAMzE,EAAa4D,EAAUja,QAAQ8a,GAC/Bta,EAAQT,EAAI+a,GAGlB,GAAwB,WAApB1I,EAAK5D,MAAMtE,MACb,IAAKkI,EAAK5D,MAAM+H,aAAahR,SAAS8Q,KAAgBjE,EAAK5D,MAAM8H,YAAY/Q,SAASzF,GACpF,cAEG,GAAwB,UAApBsS,EAAK5D,MAAMtE,OACfkI,EAAK5D,MAAM8H,YAAY/Q,SAASzF,GACnC,SAIJ,MAAM8X,EAASta,KAAKkc,aAAahZ,EAAO4R,GACpCwF,EAAOwB,SAAWxB,EAAOqB,WAAarB,EAAOuB,WAC/CuC,EAAc1d,KAAK,CACjB8B,YACA+B,WACA+Z,YAAad,EACbzE,aACA4C,SAAUrB,EAAOqB,SACjBE,SAAUvB,EAAOuB,WAEnBwC,IAEJ,CACF,CAEIA,EAAgB,GAClBF,EAAQzd,KAAK,CACXoU,OACAsJ,gBACAC,iBAGN,CAEA,OAAOF,CACT,EAGA,eAAAI,GACEve,KAAKoa,YAAYtM,OACnB,GAMI0Q,GAAmB,CAEvB,cAAAC,CAAevb,EAAO6L,GACpB,GAAI7L,SAAmD,KAAVA,EAAc,OAAO,EAClE,IAEE,OADc,IAAIiY,OAAOpM,GACZzH,KAAK5B,OAAOxC,GAC3B,CAAE,MAAOrB,GAEP,OADAF,QAAQqK,MAAM,kCAAmC+C,EAASlN,IACnD,CACT,CACF,EAGA6c,aAAY,CAACxb,EAAOyb,IACdzb,SAAmD,KAAVA,KACxC6B,MAAMqO,QAAQuL,IAA2C,IAAzBA,EAAcpe,QAC5Coe,EAAc1W,SAASvC,OAAOxC,KAIvC,eAAA0b,CAAgB1b,EAAOqP,EAAKjH,GAC1B,GAAIpI,SAAmD,KAAVA,EAAc,OAAO,EAGlE,MAAM2b,EAASnZ,OAAOxC,GACtB,IAAI4b,EAGJ,GAAID,EAAOE,SAAS,KAClBD,EAASE,WAAWH,QAGjB,GAAIA,EAAO5W,SAAS,KAAM,CAC7B,MAAMJ,EAAQgX,EAAO3T,MAAM,KAC3B4T,EAASE,WAAWnX,EAAM,GAC5B,MAEK,GAAIgX,EAAO5W,SAAS,KAAM,CAC7B,MAAMJ,EAAQgX,EAAO3T,MAAM,KAC3B4T,EAASE,WAAWnX,EAAMA,EAAMtH,OAAS,GAC3C,MAGEue,EAASE,WAAWH,GAGtB,OAAII,MAAMH,OAENvM,SAAqCuM,EAASvM,MAC9CjH,SAAqCwT,EAASxT,GAEpD,EAGA,gBAAA4T,CAAiBhc,EAAOic,EAAS3M,EAAUC,GACzC,GAAIvP,SAAmD,KAAVA,EAAc,OAAO,EAClE,IAAKic,IAAY3M,IAAaC,EAAW,OAAO,EAGhD,IAAI2M,EAAW,KACf,IAAK,MAAMC,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASuB,EAAU,CACvC4M,EAAWD,EAAQE,GACnB,KACF,CAGF,IAAKD,IAAaA,EAAS/R,SAAW+R,EAAS/R,QAAQ9M,OAAS,EAC9D,OAAO,EAGT,MAAMmC,EAAU0c,EAAS/R,QAAQ,GAC3BwR,EAASnZ,OAAOxC,GAGhBoc,EAAUva,MAAMqO,QAAQX,GAAaA,EAAY,CAACA,GAExD,IAAK,MAAM8M,KAAOD,EAAS,CACzB,MAAME,EAAc9c,EAAQI,QAAQyc,GACpC,IAAqB,IAAjBC,EAGJ,IAAK,IAAInf,EAAI,EAAGA,EAAI+e,EAAS/R,QAAQ9M,OAAQF,IAC3C,GAAIqF,OAAO0Z,EAAS/R,QAAQhN,GAAGmf,IAAgB,MAAQX,EACrD,OAAO,CAGb,CAEA,OAA0B,IAAnBS,EAAQ/e,MACjB,EAGAkf,iBAAiBvc,GACRA,SAAkE,KAAzBwC,OAAOxC,GAAOkD,OAIhE,gBAAAsZ,CAAiBxc,EAAOyc,GACtB,GAAIzc,SAAmD,KAAVA,EAAc,OAAO,EAElE,MAAMwP,EAAYiN,GAAYjN,WAAa,OACrCC,EAAWgN,GAAYhN,SACvBC,EAAW+M,GAAY/M,SAG7B,IAAIgN,EAAiBla,OAAOxC,GAG5B0c,EAAiBA,EACdja,QAAQ,KAAM,KACdA,QAAQ,KAAM,KACdA,QAAQ,KAAM,KAGjBia,EAAiBA,EAAeja,QAAQ,OAAQ,IAGhD,MAAMka,EAAQD,EAAe1U,MAAM,KAAK8C,OAAOqH,GAAKA,EAAEjP,QAEtD,GAAqB,IAAjByZ,EAAMtf,OAAc,OAAO,EAG/B,IAAK,MAAMuf,KAAQD,EAAO,CACxB,MAAME,EAAaD,EAAKhd,QAAQ,KAChC,IAAoB,IAAhBid,GAAoC,IAAfA,GAAoBA,IAAeD,EAAKvf,OAAS,EACxE,OAAO,EAGT,MAAMC,EAAMsf,EAAKE,UAAU,EAAGD,GACxB5Z,EAAM2Z,EAAKE,UAAUD,EAAa,GAExC,IAAKvf,IAAQ2F,EAAK,OAAO,EAGzB,GAAkB,YAAduM,EAAyB,CAE3B,IAAK,kBAAkBpL,KAAKnB,EAAIC,QAAS,OAAO,EAEhD,MAAM0Y,EAASE,WAAW7Y,GAC1B,GAAI8Y,MAAMH,GAAS,OAAO,EAE1B,GAAInM,SAA+CmM,EAASnM,EAAU,OAAO,EAC7E,GAAIC,SAA+CkM,EAASlM,EAAU,OAAO,CAC/E,CAEF,CAEA,OAAO,CACT,EAGAqN,sBAAqB,CAACC,EAAYra,KAC3Bqa,IAAera,GACb/E,KAAKwB,UAAU4d,KAAgBpf,KAAKwB,UAAUuD,GAIvDsa,iBAAgB,CAACC,EAAU7N,EAAKjH,MAC1BiH,SAAqC6N,EAAW7N,MAChDjH,SAAqC8U,EAAW9U,GAKtD,gBAAA+U,CAAiBpD,EAAOlE,EAAY5G,GAClC,IAAK8K,IAAUA,EAAM5P,SAAW4P,EAAM5P,QAAQ9M,OAAS,EAAG,OAAO,EACjE,IAAKwY,IAAe5G,EAAQ,OAAO,EAEnC,MAAMzP,EAAUua,EAAM5P,QAAQ,IAAM,GAC9BkQ,EAAON,EAAM5P,QAAQ9L,MAAM,IAAM,GACjCic,EAAW9a,EAAQI,QAAQiW,GACjC,GAAIyE,EAAW,EAAG,OAAO,EAEzB,MAAMrd,EAASgS,EAAOhS,QAAU,GAC1BiS,OAAiC3N,IAArB0N,EAAOC,UAA0BD,EAAOC,UAAY,EAGhEkO,EAAU,GACVC,EAAe,GACrB,IAAK,IAAIlgB,EAAI,EAAGA,EAAIkd,EAAKhd,OAAQF,IAAK,CACpC,MAAM6C,EAAQqa,EAAKld,KAAKmd,GAExB,GADA+C,EAAa7f,KAAK,CAAE6D,SAAUlE,EAAGmgB,SAAUtd,EAAO0J,YAAa1J,IAC3DA,SAAmD,KAAVA,EAAc,SAE3D,MAAMiZ,EAAWzW,OAAOxC,GAAOkD,OAC/B,GAAK+V,EAGL,GAAIhc,EAAQ,CACV,MAAM8a,EAAQ,IAAIE,OAAO,IAAIhb,YACvBsH,EAAQ0U,EAAS1U,MAAMwT,GAC7B,GAAIxT,EAAO,CACT,MAAMgZ,EAAMC,SAASjZ,EAAM,GAAI,IAC1BwX,MAAMwB,IAAMH,EAAQ5f,KAAK,CAAE6D,SAAUlE,EAAG6C,MAAOiZ,EAAUsE,OAChE,CACF,KAAO,CAEL,MAAMA,EAAMC,SAASvE,EAAU,IAC1B8C,MAAMwB,IAAMH,EAAQ5f,KAAK,CAAE6D,SAAUlE,EAAG6C,MAAOiZ,EAAUsE,OAChE,CACF,CAEA,GAAuB,IAAnBH,EAAQ/f,OAAc,OAAO,EAGjC+f,EAAQnf,KAAK,CAACC,EAAGC,IAAMD,EAAEmD,SAAWlD,EAAEkD,UAItC,GADe,IAAI8O,IAAIiN,EAAQ1f,IAAI+f,GAAKA,EAAEF,MAC/BpD,OAASiD,EAAQ/f,OAC1B,OAAO,EAKT,IAAK,IAAIF,EAAI,EAAGA,EAAIigB,EAAQ/f,OAAQF,IAAK,CACvC,MAAMugB,EAAcxO,EAAY/R,EAEhC,GADkBigB,EAAQjgB,GAAGogB,MACXG,EAChB,OAAO,CAEX,CAEA,OAAO,CACT,EAGA,eAAAC,CAAgBrd,EAAUsd,EAASpM,GACjC,MAAMqM,EAAa,GACnB,IAAKvd,IAAasd,IAAYpM,EAAO,OAAOqM,EAE5C,IAAK,MAAMjM,KAAQJ,EAAO,CAExB,IAAKI,EAAK1K,UAAY0K,EAAKzI,UAAW,SACtC,MAAM2U,EAAWjQ,EAAe+D,EAAK5C,UACrC,IAAK8O,EAAU,SAGf,IAAIC,EAAW,KACbC,EAAW,KACb,IAAK,MAAM7B,KAAW7b,EACpB,GAAIA,EAAS6b,IAAUpO,OAAS6D,EAAK9C,YAAa,CAChDiP,EAAWzd,EAAS6b,GACpB,KACF,CAEF,IAAK,MAAMA,KAAWyB,EACpB,GAAIA,EAAQzB,IAAUpO,OAAS6D,EAAK9C,YAAa,CAC/CkP,EAAWJ,EAAQzB,GACnB,KACF,CAGF,GAAK6B,EAGL,GAAuB,UAAnBF,EAAS9P,MACX,GAAsB,kBAAlB4D,EAAK5C,SACFlS,KAAKigB,sBAAsBgB,GAAU5T,QAAS6T,GAAU7T,UAC3D0T,EAAWrgB,KAAK,CACdoU,OACAtS,UAAWsS,EAAK9C,YAChB3B,QAASyE,EAAKzC,cAAgB,MAAMyC,EAAK9C,gCAGxC,GAAsB,aAAlB8C,EAAK5C,SAAyB,CACvC,MAAMkO,GAAYc,EAAS7T,SAAS9M,QAAU,GAAK,EAC9CP,KAAKmgB,iBAAiBC,EAAUtL,EAAK3C,QAAQI,IAAKuC,EAAK3C,QAAQ7G,MAClEyV,EAAWrgB,KAAK,CACdoU,OACAtS,UAAWsS,EAAK9C,YAChB3B,QACEyE,EAAKzC,cACL,MAAMyC,EAAK9C,mBAAmBoO,WAAkBtL,EAAK3C,QAAQI,KAAO,KAAKuC,EAAK3C,QAAQ7G,KAAO,QAGrG,KAA6B,aAAlBwJ,EAAK5C,UAA2B4C,EAAK7C,eAEzCjS,KAAKqgB,iBAAiBa,EAAUpM,EAAK7C,aAAc6C,EAAK3C,QAAU,CAAC,IACtE4O,EAAWrgB,KAAK,CACdoU,OACAtS,UAAWsS,EAAK9C,YAChB3B,QACEyE,EAAKzC,cACL,OAAOyC,EAAK7C,yBAAyB6C,EAAK3C,QAAQhS,QAAU,KAAKuF,OAAOoP,EAAK3C,QAAQC,WAAa,GAAG+O,SAAS,EAAG,6BAMtH,GAAuB,UAAnBH,EAAS9P,OAAqB4D,EAAK7C,aAAc,CACxD,MACMuL,GADU0D,EAAS7T,UAAU,IAAM,IAChBvK,QAAQgS,EAAK7C,cACtC,IAAkB,IAAduL,EAAiB,SAGrB,IAAK,IAAI4D,EAAS,EAAGA,GAAUF,EAAS7T,SAAS9M,QAAU,GAAI6gB,IAAU,CACvE,MAAM3e,EAAMye,EAAS7T,QAAQ+T,GACvBle,EAAQT,IAAM+a,GAGpB,IAFgBxd,KAAKqhB,cAAcne,EAAO4R,EAAMgM,GAElC,CACZC,EAAWrgB,KAAK,CACdoU,OACAtS,UAAWsS,EAAK9C,YAChBzN,SAAU6c,EACVrI,WAAYjE,EAAK7C,aACjB6L,aAAcpY,OAAOxC,GAAS,IAC9BmN,QAASyE,EAAKzC,cAAgB,OAAOyC,EAAK7C,uBAG5C,KACF,CACF,CACF,CACF,CACA,OAAO8O,CACT,EAGA,aAAAM,CAAcne,EAAO4R,EAAMqK,GACzB,OAAQrK,EAAK5C,UACX,IAAK,SACH,OAAOlS,KAAKye,eAAevb,EAAO4R,EAAK3C,QAAQpD,SACjD,IAAK,OACH,OAAO/O,KAAK0e,aAAaxb,EAAO4R,EAAK3C,QAAQG,QAC/C,IAAK,UACH,OAAOtS,KAAK4e,gBAAgB1b,EAAO4R,EAAK3C,QAAQI,IAAKuC,EAAK3C,QAAQ7G,KACpE,IAAK,WACH,OAAOtL,KAAKkf,iBAAiBhc,EAAOic,EAASrK,EAAK3C,QAAQK,SAAUsC,EAAK3C,QAAQM,WACnF,IAAK,WACH,OAAOzS,KAAKyf,iBAAiBvc,GAC/B,IAAK,WACH,OAAOlD,KAAK0f,iBAAiBxc,EAAO4R,EAAK3C,QAC3C,QACE,OAAO,EAEb,EAGA,WAAAmP,CAAY7e,EAAKC,EAASF,EAAW+B,EAAUmQ,EAAOyK,GACpD,MAAMtC,EAAS,GAET0E,EAAW9e,EAAI,IAAMA,EAAI,IAAM,KAAK8B,EAAW,IAErD,IAAK,MAAMuQ,KAAQJ,EAAO,CACxB,GAAII,EAAK9C,cAAgBxP,EAAW,SACpC,IAAKsS,EAAK1K,QAAS,SAGnB,MAAMoT,EAAW9a,EAAQI,QAAQgS,EAAK7C,cACtC,IAAkB,IAAduL,EAAiB,SAErB,MAAMta,EAAQT,EAAI+a,GACFxd,KAAKqhB,cAAcne,EAAO4R,EAAMqK,IAG9CtC,EAAOnc,KAAK,CACVmX,OAAQ/C,EAAKpH,GACb8T,SAAU1M,EAAK7D,KACfiB,SAAU4C,EAAK5C,SACf4C,KAAMA,EACNtS,UAAWA,EACX+B,SAAUA,EACVwU,WAAYjE,EAAK7C,aACjB6L,aAAcpY,OAAOxC,GAAS,IAC9Bqe,SAAUA,EACVlP,aAAcyC,EAAKzC,aACnBoP,SAAU,SAGhB,CAEA,OAAO5E,CACT,EAGA,eAAA6E,CAAgBvC,GACd,IAAKA,EAAS,MAAO,GAErB,MAAMzK,EAAQK,EAAsBiD,kBACpC,GAAqB,IAAjBtD,EAAMnU,OAAc,MAAO,GAE/B,MAAMohB,EAAY,GAElB,IAAK,MAAMtC,KAAWF,EAAS,CAC7B,IAAKE,EAAQ5e,WAAW,UAAW,SACnC,MAAMwc,EAAQkC,EAAQE,GACtB,IAAKpC,GAAOhM,OAASgM,GAAO5P,SAAW4P,EAAM5P,QAAQ9M,OAAS,EAAG,SAEjE,MAAMiC,EAAYya,EAAMhM,KAClBvO,EAAUua,EAAM5P,QAAQ,GACxBuU,EAAalN,EAAM1G,OAAO2G,GAAKA,EAAE3C,cAAgBxP,GAEvD,GAA0B,IAAtBof,EAAWrhB,OAAc,SAG7B,IAAK,MAAMuU,KAAQ8M,EAAY,CAC7B,MAAMZ,EAAWjQ,EAAe+D,EAAK5C,UACrC,GAAwB,UAApB8O,GAAU9P,MACZ,GAAsB,aAAlB4D,EAAK5C,SAAyB,CAChC,MAAMkO,EAAWnD,EAAM5P,QAAQ9M,OAAS,EACnCP,KAAKmgB,iBAAiBC,EAAUtL,EAAK3C,QAAQI,IAAKuC,EAAK3C,QAAQ7G,MAClEqW,EAAUjhB,KAAK,CACbmX,OAAQ/C,EAAKpH,GACb8T,SAAU1M,EAAK7D,KACfiB,SAAU4C,EAAK5C,SACf4C,KAAMA,EACNtS,UAAWA,EACX+B,UAAW,EACXwU,WAAY,GACZ+E,aAAc,GAAGsC,MACjB/N,aACEyC,EAAKzC,cACL,MAAM+N,WAAkBtL,EAAK3C,QAAQI,KAAO,KAAKuC,EAAK3C,QAAQ7G,KAAO,OACvEmW,SAAU,WAGhB,MAAO,GAAsB,aAAlB3M,EAAK5C,UAA2B4C,EAAK7C,aAAc,CAG5D,IADgBjS,KAAKqgB,iBAAiBpD,EAAOnI,EAAK7C,aAAc6C,EAAK3C,QAAU,CAAC,GAClE,CACZ,MAAMnG,EAAQ,CACZ6L,OAAQ/C,EAAKpH,GACb8T,SAAU1M,EAAK7D,KACfiB,SAAU4C,EAAK5C,SACf4C,KAAMA,EACNtS,UAAWA,EACX+B,UAAW,EACXwU,WAAYjE,EAAK7C,aACjB6L,aAAc,GACdzL,aACEyC,EAAKzC,cACL,OAAOyC,EAAK7C,yBAAyB6C,EAAK3C,QAAQhS,QAAU,KAAKuF,OAAOoP,EAAK3C,QAAQC,WAAa,GAAG+O,SAAS,EAAG,qBACnHM,SAAU,SAEZE,EAAUjhB,KAAKsL,EACjB,CACF,CAGJ,CAGA,MAAM6V,EAAaD,EAAW5T,OAAO2G,GAA2C,UAAtC5D,EAAe4D,EAAEzC,WAAWhB,OACtE,IAAK,IAAI7Q,EAAI,EAAGA,EAAI4c,EAAM5P,QAAQ9M,OAAQF,IAAK,CAC7C,MAAMoC,EAAMwa,EAAM5P,QAAQhN,GACpByhB,EAAY9hB,KAAKshB,YAAY7e,EAAKC,EAASF,EAAWnC,EAAI,EAAGwhB,EAAY1C,GAC/EwC,EAAUjhB,QAAQohB,EACpB,CACF,CAEA,OAAOH,CACT,EAGA,aAAAI,CAAc5C,EAAS3c,GACrB,IAAK2c,EAAS,MAAO,GAErB,MAAMzK,EAAQK,EAAsB0D,gBAAgBjW,GACpD,GAAqB,IAAjBkS,EAAMnU,OAAc,MAAO,GAG/B,IAAIyhB,EAAc,KAClB,IAAK,MAAM3C,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASzO,EAAW,CACxCwf,EAAc7C,EAAQE,GACtB,KACF,CAGF,IAAK2C,IAAgBA,EAAY3U,SAAW2U,EAAY3U,QAAQ9M,OAAS,EACvE,MAAO,GAGT,MAAMmC,EAAUsf,EAAY3U,QAAQ,GAC9BsU,EAAY,GAElB,IAAK,IAAIthB,EAAI,EAAGA,EAAI2hB,EAAY3U,QAAQ9M,OAAQF,IAAK,CACnD,MAAMoC,EAAMuf,EAAY3U,QAAQhN,GAC1ByhB,EAAY9hB,KAAKshB,YAAY7e,EAAKC,EAASF,EAAWnC,EAAI,EAAGqU,EAAOyK,GAC1EwC,EAAUjhB,QAAQohB,EACpB,CAEA,OAAOH,CACT,EAGA,kBAAAM,CAAmBpF,GACjB,MAAMqF,EAAU,CAAC,EACjB,IAAK,MAAMlW,KAAS6Q,EACbqF,EAAQlW,EAAMxJ,aACjB0f,EAAQlW,EAAMxJ,WAAa,IAE7B0f,EAAQlW,EAAMxJ,WAAW9B,KAAKsL,GAEhC,OAAOkW,CACT,EAGA,aAAAC,CAAchD,GACZ,OAAOnf,KAAK0hB,gBAAgBvC,GAAS5e,MACvC,GAMI6hB,GAAgB,CACpBC,QAAS,oBACTC,WAAY,UACZC,WAAY,EACZC,IAAK,KACLC,UAAW,IAAItM,IAGf,UAAMuM,GACJ,OAAI1iB,KAAKwiB,IAAYxiB,KAAKwiB,IAEnB,IAAIG,QAAQ,CAACC,EAASC,KAC3B,MAAMC,EAAUC,UAAUC,KAAKhjB,KAAKqiB,QAASriB,KAAKuiB,YAElDO,EAAQ1S,QAAU,KAChBzO,QAAQqK,MAAM,+BAAgC8W,EAAQ9W,OACtD6W,EAAOC,EAAQ9W,QAGjB8W,EAAQG,UAAY,KAClBjjB,KAAKwiB,IAAMM,EAAQxI,OACnBsI,EAAQ5iB,KAAKwiB,MAGfM,EAAQI,gBAAkB3S,IACxB,MAAM4S,EAAK5S,EAAM6S,OAAO9I,OACnB6I,EAAGE,iBAAiBC,SAAStjB,KAAKsiB,aAErCa,EAAGI,kBAAkBvjB,KAAKsiB,WAAY,CAAEkB,QAAS,WAIzD,EAGA,UAAMC,CAAKxS,EAAMyS,GACf,IAAKzS,IAASyS,EAAM,OAAO,EAE3B,IACE,MAAMP,QAAWnjB,KAAK0iB,OACtB,OAAO,IAAIC,QAAQ,CAACC,EAASC,KAC3B,MACMc,EADKR,EAAGS,YAAY5jB,KAAKsiB,WAAY,aAC1BuB,YAAY7jB,KAAKsiB,YAG9BtiB,KAAKyiB,UAAUjP,IAAIvC,KACrB6S,IAAIC,gBAAgB/jB,KAAKyiB,UAAU7Z,IAAIqI,IACvCjR,KAAKyiB,UAAUuB,OAAO/S,IAGxB,MAAMpQ,EAAO,CACXoQ,KAAMA,EACNyS,KAAMA,EACNrG,KAAMqG,EAAKrG,KACXzQ,KAAM8W,EAAK9W,KACXgN,UAAWzX,KAAKC,OAGZ0gB,EAAUa,EAAMM,IAAIpjB,GAC1BiiB,EAAQG,UAAY,IAAML,GAAQ,GAClCE,EAAQ1S,QAAU,KAChBzO,QAAQqK,MAAM,4BAA6B8W,EAAQ9W,OACnD6W,EAAOC,EAAQ9W,SAGrB,CAAE,MAAOnK,GAEP,OADAF,QAAQqK,MAAM,kCAAmCnK,IAC1C,CACT,CACF,EAGA,SAAM+G,CAAIqI,GACR,IAAKA,EAAM,OAAO,KAGlB,GAAIjR,KAAKyiB,UAAUjP,IAAIvC,GACrB,OAAOjR,KAAKyiB,UAAU7Z,IAAIqI,GAG5B,IACE,MAAMkS,QAAWnjB,KAAK0iB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGS,YAAY5jB,KAAKsiB,WAAY,YAC1BuB,YAAY7jB,KAAKsiB,YACZ1Z,IAAIqI,GAE1B6R,EAAQG,UAAY,KAClB,MAAMpiB,EAAOiiB,EAAQxI,OACrB,GAAIzZ,GAAQA,EAAK6iB,KAAM,CACrB,MAAMQ,EAAMJ,IAAIK,gBAAgBtjB,EAAK6iB,MACrC1jB,KAAKyiB,UAAU1Z,IAAIkI,EAAMiT,GACzBtB,EAAQsB,EACV,MACEtB,EAAQ,OAIZE,EAAQ1S,QAAU,IAAMwS,EAAQ,OAEpC,CAAE,MAAO/gB,GAEP,OADAF,QAAQqK,MAAM,iCAAkCnK,GACzC,IACT,CACF,EAGA,SAAM2R,CAAIvC,GACR,IAAKA,EAAM,OAAO,EAElB,IACE,MAAMkS,QAAWnjB,KAAK0iB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGS,YAAY5jB,KAAKsiB,WAAY,YAC1BuB,YAAY7jB,KAAKsiB,YACZ8B,OAAOnT,GAE7B6R,EAAQG,UAAY,IAAML,OAA2Bne,IAAnBqe,EAAQxI,QAC1CwI,EAAQ1S,QAAU,IAAMwS,GAAQ,IAEpC,CAAE,MAAO/gB,GACP,OAAO,CACT,CACF,EAGA,YAAM,CAAOoP,GACX,IAAKA,EAAM,OAAO,EAElB,IAEMjR,KAAKyiB,UAAUjP,IAAIvC,KACrB6S,IAAIC,gBAAgB/jB,KAAKyiB,UAAU7Z,IAAIqI,IACvCjR,KAAKyiB,UAAUuB,OAAO/S,IAGxB,MAAMkS,QAAWnjB,KAAK0iB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGS,YAAY5jB,KAAKsiB,WAAY,aAC1BuB,YAAY7jB,KAAKsiB,YACZ0B,OAAO/S,GAE7B6R,EAAQG,UAAY,IAAML,GAAQ,GAClCE,EAAQ1S,QAAU,IAAMwS,GAAQ,IAEpC,CAAE,MAAO/gB,GAEP,OADAF,QAAQqK,MAAM,oCAAqCnK,IAC5C,CACT,CACF,EAGA,iBAAMwiB,GACJ,IACE,MAAMlB,QAAWnjB,KAAK0iB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGS,YAAY5jB,KAAKsiB,WAAY,YAC1BuB,YAAY7jB,KAAKsiB,YACZgC,aAEtBxB,EAAQG,UAAY,IAAML,EAAQE,EAAQxI,QAAU,IACpDwI,EAAQ1S,QAAU,IAAMwS,EAAQ,KAEpC,CAAE,MAAO/gB,GACP,MAAO,EACT,CACF,EAGA,cAAM0iB,GACJ,IACE,MAAMpB,QAAWnjB,KAAK0iB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGS,YAAY5jB,KAAKsiB,WAAY,YAC1BuB,YAAY7jB,KAAKsiB,YACZkC,SAEtB1B,EAAQG,UAAY,KAClB,MAAMwB,EAAQ3B,EAAQxI,QAAU,GAC1BoK,EAAYD,EAAME,OAAO,CAACC,EAAKnjB,IAASmjB,GAAOnjB,EAAK4b,MAAQ,GAAI,GACtEuF,EAAQ,CACNiC,MAAOJ,EAAMlkB,OACbmkB,UAAWA,EACXI,aAAcJ,EAAY,KAAO,MAAMK,QAAQ,MAInDjC,EAAQ1S,QAAU,IAAMwS,EAAQ,CAAEiC,MAAO,EAAGH,UAAW,EAAGI,YAAa,OAE3E,CAAE,MAAOjjB,GACP,MAAO,CAAEgjB,MAAO,EAAGH,UAAW,EAAGI,YAAa,IAChD,CACF,EAGA,cAAME,GACJ,IAEEhlB,KAAKyiB,UAAUjhB,QAAQ0iB,GAAOJ,IAAIC,gBAAgBG,IAClDlkB,KAAKyiB,UAAU3U,QAEf,MAAMqV,QAAWnjB,KAAK0iB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGS,YAAY5jB,KAAKsiB,WAAY,aAC1BuB,YAAY7jB,KAAKsiB,YACZxU,QAEtBgV,EAAQG,UAAY,IAAML,GAAQ,GAClCE,EAAQ1S,QAAU,IAAMwS,GAAQ,IAEpC,CAAE,MAAO/gB,GAEP,OADAF,QAAQqK,MAAM,sCAAuCnK,IAC9C,CACT,CACF,GAoCIojB,GAAgB,KACpB,MAAM9F,EAAU+F,KAA0C,mBAAjBC,GAA8BA,KAAiB,MACxF,GAAIhG,EACF,IAAK,MAAM3e,KAAO2e,EAAS,CACzB,MAAMlC,EAAQkC,EAAQ3e,GACtB,GAAIyc,GAAOhM,MAAMhJ,SAAS,OAASgV,EAAM5P,UAAU,KAAK,GACtD,OAAO4P,EAAM5P,QAAQ,GAAG,EAE5B,CAEF,OAAO,MAIH+X,GAAiB,KACrB,IAEE,MAAMC,EAAIvV,OAAOwV,QAAUxV,OAC3B,GAAIuV,EAAEE,aAAaC,WAAY,CAC7B,MAAMC,EAAMJ,EAAEE,YAAYC,aAC1B,GAAIC,GAAKC,MAAO,OAAOD,EAAIC,KAC7B,CAEA,GAAqB,oBAAVA,OAAyBA,MAAO,OAAOA,MAClD,GAAIL,EAAEK,MAAO,OAAOL,EAAEK,MAEtB,MAAMzf,EAAIof,EAAEM,QAAU7V,OAAO6V,OAC7B,GAAI1f,EAAG,CACL,MAAM2f,EAAW3f,EAAE,wDAAwD4f,QAC3E,GAAID,EAASrlB,OAAQ,CACnB,MAAM0Q,EAAO2U,EAASzf,SAAWyf,EAASE,SAC1C,GAAI7U,GAAQA,EAAK7K,OAAQ,OAAO6K,EAAK7K,MACvC,CACF,CACF,CAAE,MAAOvE,GACPF,QAAQG,KAAK,kCAAmCD,EAClD,CACA,OAAO,MAIHkkB,GAAuB,IACpBX,MAAoBH,MAAmB,KAI1Ce,GAA0BF,IAC9B,IAAKA,GAAwB,iBAATA,EAAmB,OAAOA,EAC9C,MAAMG,EAAcF,KAEpB,IAAIzL,EAASwL,EAAKngB,QAAQ,WAAYsgB,GAEtC,OADA3L,EAASA,EAAO3U,QAAQ,iBAAkBsgB,GACnC3L,GAGH4L,GAAgB,CACpBtmB,OAAQ,KAER,IAAAumB,GACE,IAAKnmB,KAAKJ,OAAQ,CAChB,MAAMwmB,EAAMlT,GAAMtK,IAAI6C,EAAwB,CAAC,GAC/CzL,KAAKJ,OAAS,CAAC,EACf,IAAK,MAAMqR,KAAQmV,EACQ,iBAAdA,EAAInV,GACbjR,KAAKJ,OAAOqR,GAAQ,CAAEiT,IAAKkC,EAAInV,GAAOoV,QAAS,GAAIC,QAAS,GAAIC,MAAO,IAAKC,QAAS,IAErFxmB,KAAKJ,OAAOqR,GAAQ,CAClBiT,IAAKkC,EAAInV,GAAMiT,KAAO,GACtBmC,QAASD,EAAInV,GAAMoV,SAAW,GAC9BC,QAASF,EAAInV,GAAMqV,SAAW,GAC9BC,MAAOH,EAAInV,GAAMsV,OAAS,IAC1BC,QAASJ,EAAInV,GAAMuV,SAAW,GAItC,CACA,OAAOxmB,KAAKJ,MACd,EAEA,IAAA6jB,GACEvQ,GAAMnK,IAAI0C,EAAwBzL,KAAKJ,QAAU,CAAC,GAClDI,KAAKJ,OAAS,IAChB,EAGA,GAAAgJ,CAAIqI,GACF,MAAMpQ,EAAOb,KAAKmmB,OAAOlV,GACzB,GAAIpQ,GAAQA,EAAKqjB,IAAK,OAAOrjB,EAAKqjB,IAElC,IAAK,MAAM1jB,KAAOR,KAAKJ,OACrB,GAAII,KAAKJ,OAAOY,GAAKgmB,SAAWxmB,KAAKJ,OAAOY,GAAKgmB,QAAQve,SAASgJ,IAC5DjR,KAAKJ,OAAOY,GAAK0jB,IAAK,OAAOlkB,KAAKJ,OAAOY,GAAK0jB,IAItD,OAAO,IACT,EAGA,cAAMuC,CAASxV,GACb,IAAKA,EAAM,OAAO,KAGlB,MAAMyV,EAAazB,KACb0B,EAAoB,WAAT1V,GAA8B,OAATA,GAAkByV,GAAczV,IAASyV,EAGzEE,QAAiBxE,GAAcxZ,IAAIqI,GACzC,GAAI2V,EAAU,OAAOA,EAGrB,GAAID,GAAqB,WAAT1V,EAAmB,CACjC,MAAM4V,QAAqBzE,GAAcxZ,IAAI,UAC7C,GAAIie,EAAc,OAAOA,CAC3B,CAGA,MAAMC,EAAc9mB,KAAK+mB,eAAe9V,GACxC,GAAI6V,IAAgB7V,EAAM,CACxB,MAAM+V,QAAsB5E,GAAcxZ,IAAIke,GAC9C,GAAIE,EAAe,OAAOA,CAC5B,CAGA,OAAOhnB,KAAK4I,IAAIqI,EAClB,EAGA,oBAAMgW,CAAehW,GACnB,IAAKA,EAAM,OAAO,EAElB,SADkBmR,GAAc5O,IAAIvC,GAC3B,OAAO,EAEhB,MAAM6V,EAAc9mB,KAAK+mB,eAAe9V,GACxC,OAAI6V,IAAgB7V,SACLmR,GAAc5O,IAAIsT,EAGnC,EAGAI,gBAAqB,MAACjW,EAAMyS,UACbtB,GAAcqB,KAAKxS,EAAMyS,GAIxCwD,kBAAuB,MAACjW,SACTmR,GAAc4B,OAAO/S,GAGpC,UAAAkW,CAAWlW,GACT,MAAMpQ,EAAOb,KAAKonB,gBAAgBnW,GAClC,OAAOpQ,EAAQA,EAAKwlB,SAAW,GAAM,EACvC,EAEA,UAAAgB,CAAWpW,GACT,MAAMpQ,EAAOb,KAAKonB,gBAAgBnW,GAClC,OAAOpQ,EAAQA,EAAKylB,SAAW,GAAM,EACvC,EAEA,QAAAgB,CAASrW,GACP,MAAMpQ,EAAOb,KAAKonB,gBAAgBnW,GAClC,OAAOpQ,EAAQA,EAAK0lB,OAAS,IAAO,GACtC,EAGA,eAAAa,CAAgBnW,GACd,MAAMpQ,EAAOb,KAAKmmB,OAAOlV,GACzB,GAAIpQ,EAAM,OAAOA,EACjB,IAAK,MAAML,KAAOR,KAAKJ,OACrB,GAAII,KAAKJ,OAAOY,GAAKgmB,SAAWxmB,KAAKJ,OAAOY,GAAKgmB,QAAQve,SAASgJ,GAChE,OAAOjR,KAAKJ,OAAOY,GAGvB,OAAO,IACT,EAGA,cAAAumB,CAAe9V,GACb,GAAIjR,KAAKmmB,OAAOlV,GAAO,OAAOA,EAC9B,IAAK,MAAMzQ,KAAOR,KAAKJ,OACrB,GAAII,KAAKJ,OAAOY,GAAKgmB,SAAWxmB,KAAKJ,OAAOY,GAAKgmB,QAAQve,SAASgJ,GAChE,OAAOzQ,EAGX,OAAOyQ,CACT,EAEA,GAAAlI,CAAIkI,EAAMiT,EAAKmC,EAAU,GAAIC,EAAU,GAAIC,EAAQ,IAAKC,EAAU,IAChExmB,KAAKmmB,OAAOlV,GAAQ,CAAEiT,MAAKmC,UAASC,UAASC,QAAOC,WACpDxmB,KAAKyjB,MACP,EAEA,WAAA8D,CAAYtW,EAAMoV,EAASC,GACzB,MAAMzlB,EAAOb,KAAKmmB,OAAOlV,GACrBpQ,IACFA,EAAKwlB,QAAUA,EACfxlB,EAAKylB,QAAUA,EACftmB,KAAKyjB,OAET,EAEA,QAAA+D,CAASvW,EAAMsV,GACb,MAAM1lB,EAAOb,KAAKmmB,OAAOlV,GACrBpQ,IACFA,EAAK0lB,MAAQA,EACbvmB,KAAKyjB,OAET,EAEA,UAAAgE,CAAWxW,EAAMuV,GACf,MAAM3lB,EAAOb,KAAKmmB,OAAOlV,GACrBpQ,IACFA,EAAK2lB,QAAUA,EACfxmB,KAAKyjB,OAET,EAEA,MAAAiE,CAAOzW,UACEjR,KAAKmmB,OAAOlV,GACnBjR,KAAKyjB,MACP,EAEA,MAAAe,GACE,OAAOxkB,KAAKmmB,MACd,EAGA,UAAAwB,GACE,MAAO,CACLpT,QAAS,EACTqT,YAAY,IAAIzlB,MAAOuT,cACvBmS,QAAS7nB,KAAKmmB,OAElB,EAGA,UAAA2B,CAAWC,EAAUC,GAAqB,GACxC,IAAKD,IAAaA,EAASF,QACzB,MAAM,IAAIra,MAAM,aAGlB,MAAMya,EAAUjoB,KAAKmmB,OACf+B,EAAQ,CAAEC,MAAO,EAAGC,QAAS,EAAGC,QAAS,GAE/C,IAAK,MAAMpX,KAAQ8W,EAASF,QAAS,CACnC,MAAMS,EAAWP,EAASF,QAAQ5W,GAC7BqX,EAASpE,MAEV+D,EAAQhX,GAEN+W,GACFC,EAAQhX,GAAQ,CACdiT,IAAKoE,EAASpE,IACdmC,QAASiC,EAASjC,SAAW,GAC7BC,QAASgC,EAAShC,SAAW,GAC7BC,MAAO+B,EAAS/B,OAAS,IACzBC,QAAS8B,EAAS9B,SAAW,IAE/B0B,EAAME,WAENF,EAAMG,WAIRJ,EAAQhX,GAAQ,CACdiT,IAAKoE,EAASpE,IACdmC,QAASiC,EAASjC,SAAW,GAC7BC,QAASgC,EAAShC,SAAW,GAC7BC,MAAO+B,EAAS/B,OAAS,IACzBC,QAAS8B,EAAS9B,SAAW,IAE/B0B,EAAMC,SAEV,CAGA,OADAnoB,KAAKyjB,OACEyE,CACT,EAGA,aAAAK,CAAcR,GACZ,IAAKA,IAAaA,EAASF,QACzB,MAAO,CAAEW,OAAO,EAAOxc,MAAO,aAGhC,MAAMic,EAAUjoB,KAAKmmB,OACf7L,EAAS,CAAEkO,OAAO,EAAMC,MAAO,EAAGC,SAAU,GAAIC,UAAW,IAEjE,IAAK,MAAM1X,KAAQ8W,EAASF,QACrBE,EAASF,QAAQ5W,GAAMiT,MAC5B5J,EAAOmO,QACHR,EAAQhX,GACVqJ,EAAOqO,UAAUjoB,KAAKuQ,GAEtBqJ,EAAOoO,SAAShoB,KAAKuQ,IAIzB,OAAOqJ,CACT,GAGIsO,GAAmB3X,IACvB,IAAKA,EAAM,OAAO,KAClB,IAAK,MAAOlC,EAAS8Z,KAAUxpB,EAC7B,GAAI0P,EAAQzH,KAAK2J,GAAO,OAAO4X,EAEjC,OAAO,MAGHC,GAAkB,CAAC7X,EAAMrE,KAC7B,IAAKqE,IAASrE,EAAM,OAAO,KAC3B,IAAK,MAAOmC,EAAS8Z,KAAUvpB,EAC7B,GAAI2R,GAAQlC,EAAQzH,KAAK2J,GAAO,OAAO4X,EAEzC,IAAK,MAAO9Z,EAAS8Z,KAAUvpB,EAC7B,GAAIsN,GAAQmC,EAAQzH,KAAKsF,GAAO,OAAOic,EAEzC,OAAO,MAOHE,GAAY,WAqEhB,MAAMC,EAAY,UAClB,IAAIC,EAAgB,KAGpB,SAASC,IAEP,GAAID,GAAiBA,EAAcE,QACjC,OAAOF,EAAcE,QAIvB,MAAMC,EAAYtZ,OAAOsZ,WAAatZ,OAAOwV,QAAQ8D,UAC/CC,EAAUvZ,OAAOuZ,SAAWvZ,OAAOwV,QAAQ+D,QAEjD,MAAyB,mBAAdD,GAA+C,mBAAZC,GAC5C1nB,QAAQC,IAAI,gCACL,YAIiB,IAAfkO,OAAOwZ,KAAwD,mBAA1BxZ,OAAOwZ,IAAIC,YACzD5nB,QAAQC,IAAI,gCACL,QAITD,QAAQC,IAAI,sCACL,MACT,CAyDAslB,eAAesC,IACb,OAAO,IAAI7G,QAAQC,IACjB,MAAM6G,EAAYC,WAAW,KAC3B/nB,QAAQG,KAAK,2BACb8gB,EAAQ,OACP,KAGGwG,EAAYtZ,OAAOsZ,WAAatZ,OAAOwV,QAAQ8D,UAC/CC,EAAUvZ,OAAOuZ,SAAWvZ,OAAOwV,QAAQ+D,QAC3CM,EAAW7Z,OAAO6Z,UAAY7Z,OAAOwV,QAAQqE,SAE7CC,EAAWC,IAGf,GAFAC,aAAaL,GAEW,mBAAbE,EACT,IACEA,EAAS,kBAAmBC,EAC9B,CAAE,MAAO/nB,GACPF,QAAQG,KAAK,4BAA6BD,EAC5C,CAMF,GAHAF,QAAQC,IAAI,6BAA8Bd,KAAKwB,UAAUunB,EAAQ,KAAM,IACvEloB,QAAQC,IAAI,iCAAkCd,KAAKwB,UAAUunB,EAAOvP,OAAQ,KAAM,IAE9EuP,EAAOvP,QAAUuP,EAAOvP,OAAOtO,MAGjC,OAFArK,QAAQqK,MAAM,2BAA4B6d,EAAOvP,OAAOtO,YACxD4W,EAAQ,MAIV,MAAMmH,EAAWF,EAAOvP,QAAQ0P,iBAAmB,KACnDroB,QAAQC,IAAI,iCAAkCd,KAAKwB,UAAUynB,EAAU,KAAM,IAE7E,MAAMzP,EAAS,CACb2P,UAAWF,EACXG,WAAY,CAAC,EACbC,OAAQ,KACRhB,QAAS,OAIXF,EAAgB3O,EAEhBsI,EAAQtI,IAGV,IAQE,GAPA3Y,QAAQC,IAAI,gCACZD,QAAQC,IAAI,8BAA+B,CACzCwnB,UAAgC,mBAAdA,EAClBC,QAA4B,mBAAZA,EAChBM,SAA8B,mBAAbA,IAGI,mBAAZN,EAIT,OAHA1nB,QAAQqK,MAAM,+BACd8d,aAAaL,QACb7G,EAAQ,MAGV,GAAyB,mBAAdwG,EAIT,OAHAznB,QAAQqK,MAAM,iCACd8d,aAAaL,QACb7G,EAAQ,MAIVyG,EAAQ,kBAAmBO,GAC3BR,EAAU,qBACZ,CAAE,MAAOvnB,GACPioB,aAAaL,GACb9nB,QAAQqK,MAAM,+BAAgCnK,GAC9C+gB,EAAQ,KACV,GAEJ,CAyiBA,SAASpd,EAAWC,GAClB,OAAOC,OAAOD,GAAK,IAChBE,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,SACnB,CAEA,SAASykB,IAGP,GAAa,QAFAlB,IAEO,CAElB,MAAME,EAAYtZ,OAAOsZ,WAAatZ,OAAOwV,QAAQ8D,UAC/CC,EAAUvZ,OAAOuZ,SAAWvZ,OAAOwV,QAAQ+D,QAGjD,MAF2C,mBAAdD,GACU,mBAAZC,CAE7B,CAGE,YAD2C,IAAfvZ,OAAOwZ,KAAwD,mBAA1BxZ,OAAOwZ,IAAIC,UAGhF,CAEA,SAASc,IAIP,GAHA1oB,QAAQG,KAAK,qEAGTmnB,EACF,OAAOA,EAIT,IACE,QAA0B,IAAfnZ,OAAOwZ,KAAwD,mBAA1BxZ,OAAOwZ,IAAIC,WAA2B,CACpF,MAAMe,EAAUxa,OAAOwZ,IAAIC,WAAW,CAAE3c,KAAM,UAAW2d,WAAY,WAErE,GAAID,GAAWA,EAAQL,UAAW,CAChC,MAAMppB,EAAO,CACXopB,UAAWK,EAAQL,WAAa,KAChCO,aAAcF,EAAQE,cAAgB,CAAC,EACvCN,WAAYI,EAAQJ,YAAc,CAAC,EACnCC,OAAQG,EAAQH,QAAU,KAC1BhB,QAAS,OAIX,OADAF,EAAgBpoB,EACTA,CACT,CACF,CACF,CAAE,MAAOgB,GACPF,QAAQG,KAAK,uBAAwBD,EACvC,CAEA,OAAO,IACT,CAGAqlB,eAAeuD,EAAoBC,EAAa,EAAGC,EAAa,KAC9D,IAEE,QAA0B,IAAf7a,OAAOwZ,KAAwD,mBAA1BxZ,OAAOwZ,IAAIC,WAEzD,UACQ5G,QAAQiI,KAAK,CACjBC,sBAAsB,OACtB,IAAIlI,QAAQ,CAACmI,EAAGjI,IAAW6G,WAAW,IAAM7G,EAAO,IAAIrV,MAAM,iBAAkB,OAEnF,CAAE,MAAO3L,GACPF,QAAQG,KAAK,6BAA8BD,EAAEwO,QAE/C,CAGF,IAAK,IAAI0a,EAAU,EAAGA,GAAWL,EAAYK,IAAW,CACtD,IACE,QAA0B,IAAfjb,OAAOwZ,KAAwD,mBAA1BxZ,OAAOwZ,IAAIC,WACzD,MAAM,IAAI/b,MAAM,eAGlB,MAAM8c,EAAUxa,OAAOwZ,IAAIC,WAAW,CAAE3c,KAAM,UAAW2d,WAAY,WAErE,GAAID,GAAWA,EAAQL,UAAW,CAChC,MAAMppB,EAAO,CACXopB,UAAWK,EAAQL,WAAa,KAChCO,aAAcF,EAAQE,cAAgB,CAAC,EACvCN,WAAYI,EAAQJ,YAAc,CAAC,EACnCC,OAAQG,EAAQH,QAAU,KAC1BhB,QAAS,OAMX,OAFAF,EAAgBpoB,EAChBc,QAAQC,IAAI,oBACLf,CACT,CACF,CAAE,MAAOgB,GACPF,QAAQG,KAAK,wBAAwBipB,KAAWL,MAAgB7oB,EAClE,CAEIkpB,EAAUL,SACN,IAAI/H,QAAQC,GAAW8G,WAAW9G,EAAS+H,GAErD,CAEA,OAAO,IACT,CAAE,MAAO9oB,GAEP,OADAF,QAAQqK,MAAM,mBAAoBnK,GAC3B,IACT,CACF,CAiDA,SAASmpB,EAAM9nB,GACb,OACE6B,MAAMqO,QAAQlQ,IACG,IAAjBA,EAAM3C,QACc,iBAAb2C,EAAM,KACQ,iBAAbA,EAAM,IAAuC,iBAAbA,EAAM,IAAuC,kBAAbA,EAAM,GAElF,CAGA,SAAS+nB,EAAc/nB,GACrB,QAAK6B,MAAMqO,QAAQlQ,IACZA,EAAMgoB,MACXzpB,GAAwB,iBAATA,GAAqC,iBAATA,GAAqC,kBAATA,GAA+B,OAATA,EAEjG,CA8BA,SAAS0pB,EAAcjoB,GACrB,OAAI6B,MAAMqO,QAAQlQ,GACZ8nB,EAAM9nB,GAAe,EAClBA,EAAM3C,OAEX2C,GAA0B,iBAAVA,EACXU,OAAOC,KAAKX,GAAO8K,OAAOod,IAAMA,EAAE3qB,WAAW,MAAMF,OAErD,CACT,CAMA,SAAS8qB,EAA2BnoB,EAAOkQ,GAAU,GAEnD,GAAIlQ,QACF,MAAO,GAIT,GAAIkQ,GAAWrO,MAAMqO,QAAQlQ,GAC3B,OAAI8nB,EAAM9nB,GACDwC,OAAOxC,EAAM,IACX+nB,EAAc/nB,GAChBA,EAAMtC,IAAIkK,GAAKpF,OAAOoF,GAAK,KAAK/C,KAAK,MAGrCrC,OAAOxC,GAKlB,MAAMooB,EAAM5lB,OAAOxC,GAAOkD,OAG1B,GAAI,oBAAoBkB,KAAKgkB,GAC3B,OAAOA,EAKT,MAAMC,EAAaD,EAAI7jB,MAAM,4CAC7B,GAAI8jB,EAEF,OAAIA,EAAW,GACNA,EAAW,GAAKA,EAAW,GAAGnlB,OAGhCmlB,EAAW,GAKpB,MAAMC,EAAoBF,EAAI7jB,MAAM,4CACpC,GAAI+jB,EACF,OAAOA,EAAkB,GAK3B,MAAMC,EAAiBH,EAAI7jB,MAAM,yBACjC,GAAIgkB,EACF,OAAOA,EAAe,GAKxB,MAAMC,EAAmBJ,EAAI7jB,MAAM,gCACnC,OAAIikB,EACKA,EAAiB,GAInBJ,CACT,CAIA,SAASK,EAAyBC,GAChC,IAAKA,EAAc,OAAO,EAC1B,MAGMnkB,EAHM/B,OAAOkmB,GAAcxlB,OAGfqB,MAAM,sBACxB,GAAIA,EAAO,CACT,MAAMgZ,EAAMzB,WAAWvX,EAAM,IAC7B,OAAOwX,MAAMwB,GAAO,EAAIA,CAC1B,CAEA,OAAO,CACT,CAGA,SAASoL,EAAUrrB,EAAK0C,EAAO4oB,EAAMC,GACnC,MAAMC,EA3HR,SAA4BF,EAAMC,GAChC,IAAKA,IAAcD,EAAM,MAAO,GAEhC,MAAMjkB,EAAQikB,EAAK5gB,MAAM,KACzB,IAAI+c,EAAU8D,EACd,IAAK,MAAME,KAAQpkB,EAAO,CACxB,GAAIogB,QAA2C,MAAO,GACtDA,EAAUA,EAAQgE,EACpB,CAEA,IAAKhE,EAAS,MAAO,GAErB,GAAuB,iBAAZA,GAAwBA,EAAQhgB,SAAS,MAAO,CACzD,MAAMR,EAAQwgB,EAAQxgB,MAAM,2BAC5B,GAAIA,EAAO,CACT,MAAMykB,EAASlN,WAAWvX,EAAM,IAC1B0kB,EAASnN,WAAWvX,EAAM,IAChC,IAAKwX,MAAMiN,KAAYjN,MAAMkN,GAC3B,OAAOA,EAASD,EAAS,IAAMC,EAASD,EAAS,IAAM,EAE3D,CACA,MAAO,GACT,CACA,MAAO,EACT,CAmG0BE,CAAmBN,EAAMC,GAC3CM,EAAeL,EAAkB,cAAgB,GAEvD,IAAIJ,EACAU,EAAa,YAEbtB,EAAM9nB,GACR0oB,EAAelmB,OAAOxC,EAAM,IACnB+nB,EAAc/nB,IACvB0oB,EAAe1oB,EAAMtC,IAAIkK,GAAKpF,OAAOoF,GAAK,KAAK/C,KAAK,MACpDukB,GAAc,oBAGdV,EAAeP,EAA2BnoB,GAAS,IAAI,GAIzD,IAAIqpB,EAAe,GACnB,IAGE,GAA6B,mBAAlBC,IAAgCA,GAAcZ,GAAe,CAEtE,MAAMa,EAAed,EAAyBC,GAC9C,GAAIa,EAAe,EAAG,CAEpB,IAAIC,EAAWlsB,EACf,GAAIA,EAAIyH,SAAS,KAAM,CACrB,MAAMJ,EAAQrH,EAAI0K,MAAM,KACxBwhB,EAAW7kB,EAAMA,EAAMtH,OAAS,EAClC,CAEA,GAAIurB,GAAQA,EAAK7jB,SAAS,KAAM,CAC9B,MAAM0kB,EAAYb,EAAK5gB,MAAM,KACvB4I,EAAW6Y,EAAUA,EAAUpsB,OAAS,GAE1CuT,IAAa,QAAQxM,KAAKwM,IAAaA,IAAatT,IACtDksB,EAAW5Y,EAEf,CACAyY,EAAe,4DAA4D/mB,EAAWsmB,uBAA0BtmB,EAAWknB,wBAA+BD,kJAC5J,CACF,CACF,CAAE,MAAO5qB,GACPF,QAAQG,KAAK,qCAAsCD,EACrD,CAEA,MAAO,yCACyBwqB,iDACK7mB,EAAWhF,oGAEf8rB,iBAA0B9mB,EAAWsmB,OAAUtmB,EAAWomB,sCACvEW,8BACAP,EAAkB,sCAAsCA,WAA2B,sEAIzG,CAGA,SAASY,EAAWpsB,EAAK0C,EAAO4oB,EAAMC,EAAWc,EAAOC,EAAiBC,GACvE,MAAMC,EAAa7B,EAAcjoB,GAC3B+pB,EAAiBH,EAAkB,GAAK,YAE9C,IAAII,EAAW,GACXC,GAAiB,EACjBC,EAAkB,EAClBhN,EAAW,EAEf,IAAIrb,MAAMqO,QAAQlQ,IAAW8nB,EAAM9nB,IAAW+nB,EAAc/nB,IAcrD,GAAIA,GAA0B,iBAAVA,IAAuB8nB,EAAM9nB,GAAQ,CAE9D,MAAMsB,EAAUZ,OAAOY,QAAQtB,GAAO8K,OAAO,EAAEod,MAAQA,EAAE3qB,WAAW,MAEpE,IAAK,MAAO4sB,EAAUC,KAAe9oB,EAAS,CAC5C,MAAM+oB,EAAYzB,EAAO,GAAGA,KAAQuB,IAAaA,GAE7CC,GAAoC,iBAAfA,GAA4BtC,EAAMsC,IAAgBrC,EAAcqC,IAOvFlN,IACA8M,GAAYrB,EAAUwB,EAAUC,EAAYC,EAAWxB,KANvDoB,GAAiB,EACjBC,IACAF,GAAYN,EAAWS,EAAUC,EAAYC,EAAWxB,EAAWc,EAAQ,GAAG,EAAOE,GAMzF,CACF,OA9BE7pB,EAAM1B,QAAQ,CAACC,EAAM0W,KACnB,MAAMqV,EAAW,GAAG1B,KAAQ3T,MAExB1W,GAAwB,iBAATA,GAAsBupB,EAAMvpB,IAAUwpB,EAAcxpB,IAKrE2e,IACA8M,GAAYrB,EAAU,IAAI1T,KAAU1W,EAAM+rB,EAAUzB,KALpDoB,GAAiB,EACjBC,IACAF,GAAYN,EAAW,IAAIzU,KAAU1W,EAAM+rB,EAAUzB,EAAWc,EAAQ,GAAG,EAAOE,MA0BxF,MAAMU,EAAY1oB,MAAMqO,QAAQlQ,GAAS,IAAI8pB,KAAgB,IAAIA,KAG3DU,EAAYX,GAAgBI,EAAiB,kCAAoC,gBAGvF,IAAIQ,GAAuB,EAC3B,GAAIZ,GAAgBI,GAA4B,IAAVN,EAEpC,IAAI9nB,MAAMqO,QAAQlQ,IAAW8nB,EAAM9nB,IAAW+nB,EAAc/nB,IAQrD,GAAIA,GAA0B,iBAAVA,IAAuB8nB,EAAM9nB,GAAQ,CAE9D,MAAMsB,EAAUZ,OAAOY,QAAQtB,GAAO8K,OAAO,EAAEod,MAAQA,EAAE3qB,WAAW,MACpE,IAAK,MAAO4sB,EAAUC,KAAe9oB,EACnC,GAAI8oB,GAAoC,iBAAfA,IAA4BtC,EAAMsC,KAAgBrC,EAAcqC,GAAa,CAC5EnC,EAAcmC,IACf,IAAGK,GAAuB,EACnD,CAEJ,OAfEzqB,EAAM1B,QAAQC,IACZ,GAAIA,GAAwB,iBAATA,IAAsBupB,EAAMvpB,KAAUwpB,EAAcxpB,GAAO,CACrD0pB,EAAc1pB,IACf,IAAGksB,GAAuB,EAClD,IA2BN,MAAO,yCANLZ,GACAI,IACY,IAAVN,IAAiBO,GAAmB,GAAKhN,GAAY,GAAMuN,IAC1Dd,EAAQ,GAAkB,IAAbzM,GAAkBgN,GAAmB,GACN,oBAAsB,MAGrBH,iBAA8BznB,EAAWsmB,mBAAsBe,mJAGnFrnB,EAAWhF,uEACYitB,yKAIzBC,gCACRR,qEAItB,CAyPA,MAAO,CACLlE,UAAWA,EAEXoB,YAAaA,EACbC,QAASA,EACTuD,iBAxlBF1G,eAAgCwD,EAAa,EAAGC,EAAa,KAC3D,IAEE,MAAMkD,QAlyBV3G,iBAEE,MAAMkC,EAAYtZ,OAAOsZ,WAAatZ,OAAOwV,QAAQ8D,UAC/CC,EAAUvZ,OAAOuZ,SAAWvZ,OAAOwV,QAAQ+D,QAEjD,GAAyB,mBAAdD,GAA+C,mBAAZC,EAC5C,IAEE,MAAMyE,QAAgBnL,QAAQiI,KAAK,CACjCpB,IACA,IAAI7G,QAAQ,CAACmI,EAAGjI,IAAW6G,WAAW,IAAM7G,EAAO,IAAIrV,MAAM,gBAAiB,QAGhF,GAAIsgB,GAAWA,EAAQ7D,UAErB,OADAtoB,QAAQC,IAAI,yBACL,CAAEmsB,KAAM,MAAOltB,KAAMitB,EAEhC,CAAE,MAAOjsB,GACPF,QAAQG,KAAK,wBAAyBD,EAAEwO,QAC1C,CAIF,IAGE,SAFMwa,sBAAsB,YAEF,IAAf/a,OAAOwZ,KAAwD,mBAA1BxZ,OAAOwZ,IAAIC,WAA2B,CACpF,MAAMyE,EAAUle,OAAOwZ,IAAIC,WAAW,CAAE3c,KAAM,UAAW2d,WAAY,WAErE,GAAIyD,GAAWA,EAAQ/D,UAErB,OADAtoB,QAAQC,IAAI,yBACL,CACLmsB,KAAM,MACNltB,KAAM,CACJopB,UAAW+D,EAAQ/D,WAAa,KAChCO,aAAcwD,EAAQxD,cAAgB,CAAC,EACvCN,WAAY8D,EAAQ9D,YAAc,CAAC,EACnCC,OAAQ6D,EAAQ7D,QAAU,KAC1BhB,QAAS,OAIjB,CACF,CAAE,MAAOtnB,GACPF,QAAQG,KAAK,oBAAqBD,EACpC,CAIA,OADAF,QAAQG,KAAK,iCACN,CAAEisB,KAAM,MAAOltB,KAAM,KAC9B,CAgvB4BotB,GAGxB,GAAIJ,EAAUhtB,KAEZ,OADAooB,EAAgB4E,EAAUhtB,KACnBgtB,EAAUhtB,KAMnB,GAAa,QAFAgtB,EAAUE,KAEH,CAElB,IAAK,IAAIhD,EAAU,EAAGA,GAAWL,EAAYK,IAAW,CACtD,IACE,MAAMlqB,QAAa2oB,IACnB,GAAI3oB,GAAQA,EAAKopB,UAEf,OADAhB,EAAgBpoB,EACTA,CAEX,CAAE,MAAOgB,GACPF,QAAQG,KAAK,wBAAwBipB,KAAWL,MAAgB7oB,EAClE,CAEIkpB,EAAUL,SACN,IAAI/H,QAAQC,GAAW8G,WAAW9G,EAAS+H,GAErD,CAIA,OADAhpB,QAAQG,KAAK,oCACA2oB,EAAoBC,EAAYC,EAC/C,CAEE,aAAaF,EAAoBC,EAAYC,EAEjD,CAAE,MAAO9oB,GAEP,OADAF,QAAQqK,MAAM,gBAAiBnK,GACxB,IACT,CACF,EAgjBEqsB,0BAA2BhH,iBACzB,MAAM5M,EAAS,CACbrN,WAAW,IAAI9K,MAAOuT,cACtByY,IAAK,CACHC,WAAW,EACXhF,UAAqE,mBAAlDtZ,OAAOsZ,WAAatZ,OAAOwV,QAAQ8D,WACtDC,QAA+D,mBAA9CvZ,OAAOuZ,SAAWvZ,OAAOwV,QAAQ+D,SAClDgF,eAAe,EACfriB,MAAO,MAETsiB,IAAK,CACHF,WAAW,EACXG,eAAiC,IAAfze,OAAOwZ,IACzBkF,cAAiD,mBAA3B1e,OAAOwZ,KAAKC,WAClC8E,eAAe,EACfriB,MAAO,MAETyiB,MAAO,CACLC,WAAYzF,EACZ0F,UAAW1F,EAAgBrlB,OAAOC,KAAKolB,GAAiB,IAE1D2F,eAAgB,IAIlB,GAAItU,EAAO6T,IAAI/E,WAAa9O,EAAO6T,IAAI9E,QACrC,IACE,MAAMyE,QAAgBnL,QAAQiI,KAAK,CACjCpB,IACA,IAAI7G,QAAQ,CAACmI,EAAGjI,IAAW6G,WAAW,IAAM7G,EAAO,IAAIrV,MAAM,YAAa,QAE5E8M,EAAO6T,IAAIC,WAAY,EACvB9T,EAAO6T,IAAIE,iBAAmBP,IAAWA,EAAQ7D,UACnD,CAAE,MAAOpoB,GACPyY,EAAO6T,IAAIniB,MAAQnK,EAAEwO,OACvB,CAIF,GAAIiK,EAAOgU,IAAIC,WAAajU,EAAOgU,IAAIE,cACrC,UAEQ7L,QAAQiI,KAAK,CACjBC,sBAAsB,OACtB,IAAIlI,QAAQ,CAACmI,EAAGjI,IAAW6G,WAAW,IAAM7G,EAAO,IAAIrV,MAAM,SAAU,QAEzE,MAAMwgB,EAAUle,OAAOwZ,IAAIC,WAAW,CAAE3c,KAAM,UAAW2d,WAAY,WACrEjQ,EAAOgU,IAAIF,WAAY,EACvB9T,EAAOgU,IAAID,iBAAmBL,IAAWA,EAAQ/D,UACnD,CAAE,MAAOpoB,GACPyY,EAAOgU,IAAItiB,MAAQnK,EAAEwO,OACvB,CAcF,OAVIiK,EAAO6T,IAAIE,cACb/T,EAAOsU,eAAiB,gBACftU,EAAOgU,IAAID,cACpB/T,EAAOsU,eAAiB,gBACftU,EAAO6T,IAAIC,WAAa9T,EAAOgU,IAAIF,UAC5C9T,EAAOsU,eAAiB,8BAExBtU,EAAOsU,eAAiB,iCAGnBtU,CACT,EAEAuU,aAAc,WAEZ,MAAMC,EAAYhf,OAAOwV,QAAQ9Y,UAAYA,SAC7C,GAAIsiB,EAAUriB,eAAe,qBAAsB,OACnD,MAAMsiB,EAAUD,EAAUxf,cAAc,SACxCyf,EAAQrhB,GAAK,oBACbqhB,EAAQC,YA3wCG,wmjBA4wCXF,EAAUG,KAAK/e,YAAY6e,EAC7B,EAEAG,gBAAiB,SAAUC,GAGzB,MAAO,2CADaA,EAAW,SAAW,qCACsDnG,8HAGlG,EAEAoG,YAAa,WAIX,MAAMpB,EAAU3D,IAIVgF,EAAwB,QADdnG,IAIhB,IAAIoG,GAAgB,EACpB,IAEEA,EAA0B,SADZhvB,aAAaU,QAAQ,uBAErC,CAAE,MAAOa,GACPF,QAAQG,KAAK,6BAA8BD,EAC7C,CAGA,MAAM0tB,EAAa,kBAGbC,EAAaH,EAAY,SAAW,SAG1C,IAAKrB,EACH,MAAO,yPAGkHwB,2WAKpBzG,GAAUC,qmBAUvEuG,qLAGRF,EAAY,MAAQ,qFACQA,EAAY,SAAW,yHAOrF,IACGrB,EAAQ/D,WACqB,iBAAtB+D,EAAQ/D,WAAoE,IAA1CrmB,OAAOC,KAAKmqB,EAAQ/D,WAAW1pB,OAEzE,MAAO,yPAGkHivB,2WAKpBzG,GAAUC,qmBAUvEuG,2WAW1C,GAAID,EAAe,CACjB,MAAMG,EA9aZ,SAA2BzB,GACzB,IAAKA,IAAYA,EAAQ/D,UACvB,MAAO,gFAIT,IAAIyF,EAAgB,CAAC,EACrB,IACE,MAAMC,EAAQrvB,aAAaU,QAAQ,uCAC/B2uB,IACFD,EAAgB5uB,KAAKC,MAAM4uB,GAE/B,CAAE,MAAO9tB,GACPF,QAAQG,KAAK,6BAA8BD,EAC7C,CAGA,MAAM+tB,EAAe,GAGrB,SAASC,EAAoBC,EAAKhE,EAAMiE,GACtC,GAAKD,GAAsB,iBAARA,EAEnB,GAAI/qB,MAAMqO,QAAQ0c,GACZ9E,EAAM8E,IAAQ7E,EAAc6E,GAE9BA,EAAItuB,QAAQ,CAACC,EAAM0W,KACjB,MAAMqV,EAAW1B,EAAO,GAAGA,KAAQ3T,KAAW,IAAIA,KAC5C6X,EAAYtqB,OAAOjE,GAAQ,IAAI2E,OACrC,GAA6B,mBAAlBomB,IAAgCA,GAAcwD,GAAY,CAEnE,MACMC,EAAWtE,EADIN,EAA2B2E,GAAW,IAEvDC,EAAW,GACbL,EAAalvB,KAAK,CAChBorB,KAAM0B,EACNhtB,IAAK,IAAI2X,KACTjV,MAAO8sB,EACPvD,aAAcwD,EACdF,WAAY,IAAIA,IAGtB,IAIFD,EAAItuB,QAAQ,CAACC,EAAM0W,KAGjB0X,EAAoBpuB,EAFHqqB,EAAO,GAAGA,KAAQ3T,KAAW,IAAIA,KAC5B,IAAI4X,EAAY,IAAI5X,aAIzC,CAEL,MAAM3T,EAAUZ,OAAOY,QAAQsrB,GAAK9hB,OAAO,EAAEod,MAAQA,EAAE3qB,WAAW,MAClE,IAAK,MAAOD,EAAK0C,KAAUsB,EAAS,CAClC,MAAM+oB,EAAYzB,EAAO,GAAGA,KAAQtrB,IAAQA,EACtC0vB,EAAgB,IAAIH,EAAYvvB,GAEtC,IAAI0C,GAA0B,iBAAVA,GAAuB8nB,EAAM9nB,IAAW+nB,EAAc/nB,GAGnE,CAEL,MAAM8sB,EAAYtqB,OAAOxC,GAAS,IAAIkD,OACtC,GAA6B,mBAAlBomB,IAAgCA,GAAcwD,GAAY,CAEnE,MACMC,EAAWtE,EADIN,EAA2B2E,GAAW,IAEvDC,EAAW,GACbL,EAAalvB,KAAK,CAChBorB,KAAMyB,EACN/sB,IAAKA,EACL0C,MAAO8sB,EACPvD,aAAcwD,EACdF,WAAYG,GAGlB,CACF,MAlBEL,EAAoB3sB,EAAOqqB,EAAW2C,EAmB1C,CACF,CACF,CAGA,MAAMC,EAAUvsB,OAAOC,KAAKmqB,EAAQ/D,WAAWjc,OAAOod,IAAMA,EAAE3qB,WAAW,MACzE,IAAK,MAAMD,KAAO2vB,EAEhBN,EADc7B,EAAQ/D,UAAUzpB,GACLA,EAAK,CAACA,IAInC,MAAM4vB,EAAuBR,EAAa5hB,OAAOvM,IAG/C,IAAI4uB,EAAe5uB,EAAKjB,IACxB,MAAM8vB,EAAiB7uB,EAAKsuB,WAAW/hB,OAAOuiB,GAASA,IAAUA,EAAM9vB,WAAW,MAClF,GAAI6vB,EAAe/vB,OAAS,EAC1B8vB,EAAeC,EAAeA,EAAe/vB,OAAS,QACjD,GAAIkB,EAAKqqB,MAAQrqB,EAAKqqB,KAAK7jB,SAAS,KAAM,CAE/C,MAAMJ,EAAQpG,EAAKqqB,KAAK5gB,MAAM,KAC9BmlB,EAAexoB,EAAMA,EAAMtH,OAAS,EACtC,CAEA,OAAQyS,EAAiBY,cAAcyc,KAGzC,GAAoC,IAAhCD,EAAqB7vB,OACvB,MAAO,gFAKT,MAAMiwB,EAAgB,IAAInd,IAC1B+c,EAAqB5uB,QAAQC,KAGzBA,EAAKsuB,WAAWxvB,OAAS,EACrBkB,EAAKsuB,WAAWxuB,MAAM,GAAI,GAC1B,IAEUC,QAAQ+uB,IAClBA,IAAUA,EAAM9vB,WAAW,MAE7B+vB,EAAcja,IAAIga,OAKxB,MAAME,EAAkB1rB,MAAM2rB,KAAKF,GAAervB,OAGlD,IAAIwvB,EAAmB,GACvB,GAAIF,EAAgBlwB,OAAS,EAAG,CAC9B,MAAMqwB,EAAQC,KACRC,EAAkBF,EAAMG,oBAAsBH,EAAMI,UAAY,UAGtE,IAAIC,EAAmB,GACvBR,EAAgBjvB,QAAQ0vB,IACtB,MAAMC,GAAyC,IAA7BzB,EAAcwB,GAC1BE,EAAcD,EAChB,sCAAsCL,8CACtC,+FACJG,GAAoB,gDAAgDzrB,EAAW0rB,qBAA6BC,yKAAiLC,iCAA2CD,EAAY,KAAO,WAAW3rB,EAAW0rB,aAAqB1rB,EAAW0rB,uBAInZP,EAAmB,m0BAOXM,mDAIV,CAGA,IAAII,EAAY,GA+EhB,OA9EAjB,EAAqB5uB,QAAQC,IAE3B,MAAM6uB,EAAiB7uB,EAAKsuB,WAAW/hB,OAAOuiB,IAAUA,EAAM9vB,WAAW,MAGnEivB,EAAgBjuB,EAAKsuB,WAAW/hB,OAAOuiB,IAC3C,GAAIA,EAAM9vB,WAAW,KAAM,OAAO,EAClC,IACE,MAAMkvB,EAAQrvB,aAAaU,QAAQ,uCACnC,GAAI2uB,EAEF,OAAwB,IADV7uB,KAAKC,MAAM4uB,GACZY,EAEjB,CAAE,MAAO1uB,GAET,CACA,OAAO,IAKHyvB,EAAa5B,EAAcnvB,OAAS,EAAImvB,EAAcnuB,MAAM,GAAI,GAAK,GAIrEgwB,EAAkBjB,EAAe/vB,OAAS,EAAI+vB,EAAe/uB,MAAM,GAAI,GAAK,GAE5EiwB,EAAmBD,EAAgBrG,MAAMqF,IAC7C,IACE,MAAMZ,EAAQrvB,aAAaU,QAAQ,uCACnC,GAAI2uB,EAEF,OAAwB,IADV7uB,KAAKC,MAAM4uB,GACZY,EAEjB,CAAE,MAAO1uB,GAET,CACA,OAAO,IAIH4vB,EAAcH,EAAW/wB,OAAS,EAAI+wB,EAAWvpB,KAAK,OAAS,GAIrE,IAAI2pB,EAHajwB,EAAKjB,IAItB,GAAIiB,EAAKqqB,MAAQrqB,EAAKqqB,KAAK7jB,SAAS,KAAM,CACxC,MAAMJ,EAAQpG,EAAKqqB,KAAK5gB,MAAM,KAC9BwmB,EAAgB7pB,EAAMA,EAAMtH,OAAS,EACvC,CAGA,MAAMgsB,EAAe,4DAA4D/mB,EAAW/D,EAAKqqB,0BAA0BtmB,EAAWksB,wBAAoCjwB,EAAKgrB,8JAG/K,IAAIb,EAAeP,EAA2B5pB,EAAKyB,OAAO,GAE1D0oB,EAAeA,EAAajmB,QAAQ,kBAAmB,IAIvD,MAAMgsB,EAAeH,EAAmB,GAAK,gBACvCI,EAAa9wB,KAAKwB,UAAUivB,GAElCF,GAAa,0DACkC7rB,EAAWosB,cAAuBD,wWAE4DnsB,EAAWisB,gNAEjCjsB,EAAWksB,iEACrFlsB,EAAW/D,EAAKqqB,6HAA6HtmB,EAAWomB,8BAC3LW,4EAOLoE,EAAmB,yDAA2DU,EAAY,QACnG,CA2L0BQ,CAAkB7D,GACtC,MAAO,6OAG8GwB,idAKpBzG,GAAUC,+wBAavEuG,iDACpBE,iDAGlB,CAGA,MAAMU,EAAUvsB,OAAOC,KAAKmqB,EAAQ/D,WAAWjc,OAAOod,IAAMA,EAAE3qB,WAAW,MAEzE,IAAIqxB,EAAY,GAChB,IAAK,MAAMtxB,KAAO2vB,EAAS,CACzB,MAAMjtB,EAAQ8qB,EAAQ/D,UAAUzpB,GACb2qB,EAAcjoB,IAE7BA,GAA0B,iBAAVA,GAAuB8nB,EAAM9nB,IAAW+nB,EAAc/nB,GAMxE4uB,GAAa,kEACsCtsB,EAAWhF,yHAEpCqrB,EAAUrrB,EAAK0C,EAAO1C,EAAKwtB,EAAQ9D,oHAN7D4H,GAAalF,EAAWpsB,EAAK0C,EAAO1C,EAAKwtB,EAAQ9D,WAAY,GAAG,GAAM,EAW1E,CAEA,MAAO,6OAGgHsF,2EACrEW,EAAQ5vB,oRAIyCwoB,GAAUC,kxBAavEuG,gCACpBuC,iDAGpB,EAEAC,WAAY,SAAUC,GAEpB,MAAM/rB,EAAI6J,OAAOwV,QAAQK,QAAU7V,OAAO6V,OAC1C,IAAK1f,IAAM+rB,IAAeA,EAAWzxB,OAEnC,YADAoB,QAAQG,KAAK,iEAKf,MAAMmwB,EAAShsB,EAAE,kBACZgsB,EAAO1xB,QAMZ0xB,EAAOC,IAAI,QAGXD,EAAOE,GAAG,YAAa,mBAAoB,SAAUtwB,GACnDA,EAAEuwB,kBACF,MAAMC,EAAQpsB,EAAEjG,MAAMsyB,QAAQ,aACxBC,EAAQF,EAAMjd,KAAK,oBAAoByQ,QAGzC0M,EAAMC,GAAG,cAAgBD,EAAME,SAAS,eAExCJ,EAAMI,SAAS,cAEjBF,EAAMG,OACNL,EAAMM,YAAY,aAClBJ,EAAMK,SAAS,aAAaC,UAAU,IAAK,WACzC5sB,EAAEjG,MAAM2yB,YAAY,YACtB,IAGAJ,EAAMK,SAAS,aAAaE,QAAQ,IAAK,WACvCT,EAAMO,SAAS,aACf3sB,EAAEjG,MAAM2yB,YAAY,YACtB,GAEJ,GAGAV,EAAOE,GAAG,YAAa,mBAAoB,SAAUtwB,GACnDA,EAAEuwB,kBACFrJ,GAAUgK,QAAQd,EACpB,GAGAA,EAAOE,GAAG,YAAa,wBAAyB,SAAUtwB,GACxDA,EAAEuwB,kBACF,IACE,MACMY,GADqB/sB,EAAEjG,MAAMyyB,SAAS,UAI5C,GAFAnyB,aAAa+B,QAAQ,uBAAwBqD,OAAOstB,IAElB,mBAAvBC,GAAmC,CAC5C,MAAMC,EAAaC,KACnBF,GAAmBC,EACrB,CAC+B,mBAApBE,IACTA,IAEJ,CAAE,MAAOvxB,GACPF,QAAQG,KAAK,2BAA4BD,GACrCiO,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,SACzC,CACF,GAGAimB,EAAOE,GAAG,YAAa,6BAA8B,SAAUtwB,GAC7DA,EAAEuwB,kBACcnsB,EAAEjG,MACWsyB,QAAQ,mCAGxBgB,YAAY,YAC3B,GAGArB,EAAOE,GAAG,YAAa,oBAAqB,SAAUtwB,GACpDA,EAAEuwB,kBACF,MAAMmB,EAAUttB,EAAEjG,MACZkxB,EAAYqC,EAAQ1yB,KAAK,SAEzBswB,IAD6C,SAA5BoC,EAAQ1yB,KAAK,aAAqD,IAA5B0yB,EAAQ1yB,KAAK,YAG1E,IACE,MAAM8uB,EAAQrvB,aAAaU,QAAQ,uCAC7B0uB,EAAgBC,EAAQ7uB,KAAKC,MAAM4uB,GAAS,CAAC,EACnDD,EAAcwB,GAAaC,EAC3B7wB,aAAa+B,QAAQ,sCAAuCvB,KAAKwB,UAAUotB,IAG3E,MAAMkB,EAAQC,KACRC,EAAkBF,EAAMG,oBAAsBH,EAAMI,UAAY,UACtEuC,EAAQ1yB,KAAK,UAAWswB,GACpBA,GACFoC,EAAQC,IAAI,CACV9jB,WAAY,oBACZ+jB,MAAO3C,EACP4C,YAAa,oBACbC,QAAS,MAEXJ,EAAQK,KAAK,QAAS,SAAS1C,OAE/BqC,EAAQC,IAAI,CACV9jB,WAAY,cACZ+jB,MAAO,sBACPC,YAAa,oBACbC,QAAS,QAEXJ,EAAQK,KAAK,QAAS,SAAS1C,MAIjCjrB,EAAE,qBAAqB4tB,KAAK,WAC1B,MAAMC,EAAQ7tB,EAAEjG,MAChB,IACE,MAAM+zB,EAASjzB,KAAKC,MAAM+yB,EAAMF,KAAK,gBAAkB,MACvD,GAAIG,EAAO9rB,SAASipB,GAAY,CAE9B,MAAMxB,EAAgBqE,EAAO/lB,OAAOuiB,IAClC,MAAMZ,EAAQrvB,aAAaU,QAAQ,uCAEnC,OAAwB,KADV2uB,EAAQ7uB,KAAKC,MAAM4uB,GAAS,CAAC,GAC9BY,KAITe,EAAa5B,EAEbsE,EAAiB1C,EAAW/wB,OAAS,EAAI+wB,EAAWvpB,KAAK,OAAS,GAGxE+rB,EAAM1e,KAAK,qBAAqB0Q,KAAKkO,EACvC,CACF,CAAE,MAAOnyB,GACPF,QAAQG,KAAK,2BAA4BD,EAC3C,CACF,EACF,CAAE,MAAOA,GACPF,QAAQG,KAAK,6BAA8BD,EAC7C,CACF,GAGAowB,EAAOE,GAAG,YAAa,aAAc,SAAUtwB,GAC7CA,EAAEuwB,kBACF,MAAM6B,EAAShuB,EAAEjG,MACX8rB,EAAOmI,EAAOpzB,KAAK,QACzB,IAAKirB,EAEH,YADAnqB,QAAQG,KAAK,4CAGf,MAAMgc,EAAemW,EAClBnO,OACAngB,QAAQ,YAAa,IACrBS,OAEH2iB,GAAUmL,eAAepI,EAAMhO,EAAcoJ,eAAgBrL,GAC3D,GAAiB,OAAbA,GAAqBA,IAAaiC,EAAc,CAClD,MAAMlC,QAAgBmN,GAAUoL,SAASrI,EAAMjQ,GACzCwX,OAASvjB,OAAOwV,QAAQ+N,QAAUvjB,OAAOujB,OAC3CzX,GACFqY,EAAOnO,KAAKjK,GACZoY,EAAOT,IAAI,aAAc,yBACzB9J,WAAW,IAAMuK,EAAOT,IAAI,aAAc,IAAK,OAE3CH,QAAQA,OAAOrnB,MAAM,OAE7B,CACF,EACF,GAGAimB,EAAOE,GAAG,YAAa,iBAAkB,SAAUtwB,GACjDA,EAAEuwB,kBACFvwB,EAAEuyB,iBACF,MAAMC,EAAQpuB,EAAEjG,MACV8rB,EAAOuI,EAAMxzB,KAAK,QAClB6rB,EAAW2H,EAAMxzB,KAAK,cAAgB,KACtCyzB,EAAY5T,SAAS2T,EAAMxzB,KAAK,cAAe,KAAO,GAG5D,IAAKirB,EAEH,YADAnqB,QAAQG,KAAK,8BAKf,QAA0B,IAAfgO,OAAOwZ,KAAwD,mBAA1BxZ,OAAOwZ,IAAIC,WAYzD,OAXA5nB,QAAQG,KAAK,0CAEgB,mBAAlByyB,IACTA,GAAc,CACZD,UAAWA,EACXE,YAAa,KACbC,WAAY/H,EACZgI,cAAe,SACfC,SAAS,KAOf,IAAIC,EAAa,KACjB,IACEA,EA16DR,SAA6B9I,GAC3B,IACE,IAAKA,GAAwB,iBAATA,EAClB,MAAO,CAAE+I,UAAW,KAAMnI,SAAU,KAAMoI,WAAY,IAIxD,MAAMjtB,EAAQikB,EAAK5gB,MAAM,KAAK8C,OAAOqH,GAAKA,GAAKA,EAAEjP,QAEjD,GAAqB,IAAjByB,EAAMtH,OACR,MAAO,CAAEs0B,UAAW,KAAMnI,SAAU,KAAMoI,WAAY,IAIxD,MAAMjhB,EAAY,CAChB,OACA,KACA,KACA,IACA,KACA,KACA,KACA,KACA,KACA,YACA,cAIIkhB,EAAgBltB,EAAMmG,OAAOqH,IAAMxB,EAAU5L,SAASoN,IAG5D,IAAIwf,EAAY,KACZE,EAAcx0B,QAAU,EAE1Bs0B,EAAYE,EAAcA,EAAcx0B,OAAS,GACf,IAAzBw0B,EAAcx0B,SAEvBs0B,EAAYE,EAAc,IAI5B,IAAIrI,EAAW,KAWf,OAVIqI,EAAcx0B,OAAS,EACzBmsB,EAAWqI,EAAcA,EAAcx0B,OAAS,GACvCsH,EAAMtH,OAAS,IAExBmsB,EAAW7kB,EAAMA,EAAMtH,OAAS,IAM3B,CACLs0B,UAAWA,GAAa,KACxBnI,SAAUA,GAAY,KACtBoI,WALiBC,EAAcx0B,OAAS,EAAIw0B,EAAgBltB,EAAMtG,OAAO,GAO7E,CAAE,MAAOM,GAEP,OADAF,QAAQG,KAAK,oCAAqCD,GAC3C,CAAEgzB,UAAW,KAAMnI,SAAU,KAAMoI,WAAY,GACxD,CACF,CA42DqBE,CAAoBlJ,EACnC,CAAE,MAAOjqB,GACPF,QAAQG,KAAK,0BAA2BD,EAC1C,CAG6B,mBAAlB0yB,IACTA,GAAc,CACZD,UAAWA,EACXE,YAAa,KACbC,WAAY/H,EACZgI,cAAeE,GAAYC,WAAa,SACxCF,SAAS,EACTM,QAASnJ,EACToJ,cAAeN,GAGrB,GAGA,WAEE,MAAM9F,EAAYhf,OAAOwV,QAAQ9Y,UAAYA,SACvC2oB,EAAOlvB,EAAE6oB,GAGfqG,EAAKjD,IAAI,oEAAqE,kBAE9E,IAAIkD,EAAc,EACdC,EAAc,EACdC,GAAoB,EAGxBH,EAAKhD,GAAG,yBAA0B,iBAAkB,SAAUtwB,GAC5CoE,EAAEpE,EAAEuhB,QACSkP,QAAQ,kBAAkB/xB,OAAS,GAKzB,IAAnCsB,EAAE0zB,cAAcC,QAAQj1B,SAC1B60B,EAAcvzB,EAAE0zB,cAAcC,QAAQ,GAAGC,QACzCJ,EAAcxzB,EAAE0zB,cAAcC,QAAQ,GAAGE,QACzCJ,GAAoB,EAExB,GAEAH,EAAKhD,GAAG,wBAAyB,iBAAkB,SAAUtwB,GAK3D,KAJgBoE,EAAEpE,EAAEuhB,QACSkP,QAAQ,kBAAkB/xB,OAAS,GAI9D,OAGF,GAAuC,IAAnCsB,EAAE0zB,cAAcC,QAAQj1B,OAAc,OAE1C,MAAMo1B,EAAQ9zB,EAAE0zB,cAAcC,QAAQ,GAChCI,EAASvqB,KAAKwqB,IAAIF,EAAMF,QAAUL,GAClCU,EAASzqB,KAAKwqB,IAAIF,EAAMD,QAAUL,IAKtCS,EAAS,EACLF,EAAS,GAAKA,EAAkB,EAATE,EACvBF,EAAkB,IAATE,GAAgBF,EAAS,MAGtCN,GAAoB,EACpBzzB,EAAEk0B,2BACFl0B,EAAEuwB,kBAEN,GAEA+C,EAAKhD,GAAG,uBAAwB,iBAAkB,SAAUtwB,GAK1D,KAJgBoE,EAAEpE,EAAEuhB,QACSkP,QAAQ,kBAAkB/xB,OAAS,GAO9D,OAHA+0B,GAAoB,EACpBF,EAAc,OACdC,EAAc,GAKZC,IACFzzB,EAAEk0B,2BACFl0B,EAAEuwB,kBACFkD,GAAoB,GAEtBF,EAAc,EACdC,EAAc,CAChB,GAsCAvG,EAAUxe,iBAAiB,aAnCM,SAAUzO,GACzBoE,EAAEpE,EAAEuhB,QACSkP,QAAQ,kBAAkB/xB,OAAS,GAC5CsB,EAAE2zB,SAAgC,IAArB3zB,EAAE2zB,QAAQj1B,SACzC60B,EAAcvzB,EAAE2zB,QAAQ,GAAGC,QAC3BJ,EAAcxzB,EAAE2zB,QAAQ,GAAGE,QAE/B,GA4BmE,GACnE5G,EAAUxe,iBAAiB,YA5BK,SAAUzO,GAGxC,GAFgBoE,EAAEpE,EAAEuhB,QACSkP,QAAQ,kBAAkB/xB,OAAS,GAC5CsB,EAAE2zB,SAAgC,IAArB3zB,EAAE2zB,QAAQj1B,QAAgB60B,GAAeC,EAAa,CACrF,MAAMM,EAAQ9zB,EAAE2zB,QAAQ,GAClBI,EAASvqB,KAAKwqB,IAAIF,EAAMF,QAAUL,GAClCU,EAASzqB,KAAKwqB,IAAIF,EAAMD,QAAUL,IAGtCS,EAAS,EAAIF,EAAS,GAAKA,EAAkB,EAATE,EAAaF,EAAkB,IAATE,GAAgBF,EAAS,MAEnF/zB,EAAEk0B,2BACFl0B,EAAEuwB,kBACFvwB,EAAEuyB,iBAEN,CACF,GAYiE,GACjEtF,EAAUxe,iBAAiB,WAZI,SAAUzO,GACvBoE,EAAEpE,EAAEuhB,QACSkP,QAAQ,kBAAkB/xB,OAAS,GAC5C+0B,IAClBzzB,EAAEk0B,2BACFl0B,EAAEuwB,kBACFvwB,EAAEuyB,iBAEN,GAI+D,EAChE,CArHD,GAwHAnC,EAAOE,GAAG,YAAa,iBAAkB,SAAUtwB,GACjDA,EAAEuwB,kBACF,MAAM4D,EAAS/D,EAAO7c,KAAK,qBAGvB4gB,EAAOz1B,QAAUy1B,EAAO7vB,MAC1B6vB,EAAO7vB,IAAI,IAAIW,QAAQ,SAASmvB,SAKA,mBAAvBhD,IACTA,GAAmB,MAEU,mBAApBG,IACTA,KAEJ,GAGAnB,EAAOE,GAAG,kBAAmB,0BAA2B,SAAUtwB,GAChE,GAAiB,IAAbA,EAAEq0B,OAAc,OACpBr0B,EAAEuyB,iBACFvyB,EAAEuwB,kBACF,MAAM+D,EAASn2B,KACfm2B,EAAOC,kBAAkBv0B,EAAEw0B,WAC3BpwB,EAAEkwB,GAAQvD,SAAS,UACnB,MAAM0D,EAAcrE,EAAOsE,SACrBC,EAAS30B,EAAE6zB,QACXlzB,EAAYyD,EAAEkwB,GAAQt1B,KAAK,SAG3BgJ,OAAsD,IAA5BiG,OAAOjG,iBAAmCiG,OAAOjG,iBAAmB,IAC9FC,OAAsD,IAA5BgG,OAAOhG,iBAAmCgG,OAAOhG,iBAAmB,IAEpGqsB,EAAOM,cAAgB,SAAUC,GAC/B,MAAMC,EAAKD,EAAMhB,QAAUc,EAC3B,IAAII,EAAYN,EAAcK,EAC1BC,EAAY/sB,IAAkB+sB,EAAY/sB,GAC1C+sB,EAAY9sB,IAAkB8sB,EAAY9sB,GAC9CmoB,EAAOuB,IAAI,SAAUoD,EAAY,KACnC,EACAT,EAAOU,YAAc,SAAUC,GAK7B,GAJA7wB,EAAEkwB,GAAQxD,YAAY,UACtBwD,EAAOY,sBAAsBD,EAAIT,WACjCF,EAAOM,cAAgB,KACvBN,EAAOU,YAAc,KACjBr0B,GAAwC,mBAApBw0B,IAA8D,mBAArBC,GAAiC,CAChG,MAAMC,EAAUF,KAChBE,EAAQ10B,GAAake,SAASuR,EAAOuB,IAAI,WACzCyD,GAAiBC,GACjBjF,EAAOW,SAAS,kBAClB,CACF,CACF,GAGAX,EAAOE,GAAG,eAAgB,0BAA2B,SAAUtwB,GAC7DA,EAAEuyB,iBACFvyB,EAAEuwB,kBACF,MAAM5vB,EAAYyD,EAAEjG,MAAMa,KAAK,SAC/B,GAAI2B,GAAwC,mBAApBw0B,IAA8D,mBAArBC,GAAiC,CAChG,MAAMC,EAAUF,YACTE,EAAQ10B,GACfy0B,GAAiBC,GACjBjF,EAAOuB,IAAI,SAAU,IAAIb,YAAY,kBACvC,CACF,GAGAV,EAAOE,GAAG,eAAgB,oBAAqB,SAAUtwB,GACvD,GAAIoE,EAAEpE,EAAEuhB,QAAQkP,QAAQ,sDAAsD/xB,OAAQ,OACtFsB,EAAEuyB,iBACFvyB,EAAEuwB,kBACF,MAAM5vB,EAAYumB,GAAUC,UAC5B,GAAIxmB,GAAwC,mBAApBw0B,IAA8D,mBAArBC,GAAiC,CAChG,MAAMC,EAAUF,YACTE,EAAQ10B,GACfy0B,GAAiBC,GACjBjF,EAAOuB,IAAI,SAAU,IAAIb,YAAY,kBACvC,CACF,IAnaEhxB,QAAQG,KAAK,uDAoajB,EAEAoyB,eAAgB,SAAUpI,EAAMhO,EAAcqZ,GAE5C,MAAMlxB,EAAI6J,OAAOwV,QAAQK,QAAU7V,OAAO6V,OACpCmJ,EAAYhf,OAAOwV,QAAQ9Y,UAAYA,SAC7C,IAAKvG,EAAG,OAGRA,EAAE6oB,GAAW1Z,KAAK,qBAAqBsS,SAEvC,MAEM0P,EAAO,kFAF8B,mBAAdC,GAA2BA,KAAYzG,MAAQ,OAAS,oXASpCprB,EAAWsmB,+FACgBtmB,EAAWsY,0qBAcvF7X,EAAE6oB,EAAU7e,MAAMqnB,OAAOF,GACzB,MAAMG,EAAWtxB,EAAE6oB,GAAW1Z,KAAK,qBAC7B4gB,EAASuB,EAASniB,KAAK,sBAE7BsU,WAAW,IAAMsM,EAAOC,QAAQuB,SAAU,IAG1CD,EAASpF,GAAG,QAAS,kBAAmB,SAAUtwB,GAChDA,EAAEuyB,iBACFvyB,EAAEuwB,kBACFmF,EAAS7P,SACTyP,EAAO,KACT,GAGAI,EAASpF,GAAG,QAAS,gBAAiB,SAAUtwB,GAC9CA,EAAEuyB,iBACFvyB,EAAEuwB,kBACF,MAAMvW,EAAWma,EAAO7vB,MACxBoxB,EAAS7P,SACTyP,EAAOtb,EACT,GAGA0b,EAASpF,GAAG,QAAS,SAAUtwB,GACzBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,sBACvB8E,EAAS7P,SACTyP,EAAO,MAEX,GAGAnB,EAAO7D,GAAG,UAAW,SAAUtwB,GAC7B,GAAc,WAAVA,EAAErB,IACJqB,EAAEuyB,iBACFmD,EAAS7P,SACTyP,EAAO,WACF,GAAc,UAAVt1B,EAAErB,KAAmBqB,EAAE41B,QAAS,CACzC51B,EAAEuyB,iBACF,MAAMvY,EAAWma,EAAO7vB,MACxBoxB,EAAS7P,SACTyP,EAAOtb,EACT,CACF,EACF,EAEAsY,SAAUjN,eAAgB4E,EAAMjQ,GAC9B,IAAKuO,IAAe,OAAO,EAE3B,MAAM2D,EAAO7E,IAEb,IACE,IAAIwO,EAAc7b,EAOlB,GANiB,SAAbA,EAAqB6b,GAAc,EACjB,UAAb7b,EAAsB6b,GAAc,EACnCzY,MAAM9T,OAAO0Q,KAA0C,KAA5BnW,OAAOmW,GAAUzV,SACpDsxB,EAAcvsB,OAAO0Q,IAGV,QAATkS,EACF,aAjgER7G,eAA2B4E,EAAMjQ,GAC/B,OAAO,IAAI8G,QAAQC,IACjB,MAAM6G,EAAYC,WAAW,KAC3B/nB,QAAQG,KAAK,2BACb8gB,GAAQ,IACP,KAGGwG,EAAYtZ,OAAOsZ,WAAatZ,OAAOwV,QAAQ8D,UAC/CC,EAAUvZ,OAAOuZ,SAAWvZ,OAAOwV,QAAQ+D,QAC3CM,EAAW7Z,OAAO6Z,UAAY7Z,OAAOwV,QAAQqE,SAE7CgO,EAAc9N,IAClBC,aAAaL,GACW,mBAAbE,GACTA,EAAS,gBAAiBgO,GAE5Bh2B,QAAQC,IAAI,2BACZghB,GAAQ,IAGV,IAGE,GAFAjhB,QAAQC,IAAI,6BAA8BkqB,EAAMjQ,GAEzB,mBAAZwN,EAIT,OAHA1nB,QAAQqK,MAAM,+BACd8d,aAAaL,QACb7G,GAAQ,GAGV,GAAyB,mBAAdwG,EAIT,OAHAznB,QAAQqK,MAAM,iCACd8d,aAAaL,QACb7G,GAAQ,GAIVyG,EAAQ,gBAAiBsO,GACzBvO,EAAU,mBAAoB,CAC5B0C,KAAMA,EACN5oB,MAAO2Y,GAEX,CAAE,MAAOha,GACPioB,aAAaL,GACb9nB,QAAQqK,MAAM,+BAAgCnK,GAC9C+gB,GAAQ,EACV,GAEJ,CAi9DqBgV,CAAY9L,EAAM4L,GAC1B,CACL,MAAM1J,EAAUle,OAAOwZ,IAAIC,WAAW,CAAE3c,KAAM,UAAW2d,WAAY,WACrE,IAAKyD,EAEH,OADArsB,QAAQqK,MAAM,gCACP,EAGT,MAAM4P,QAAgB9L,OAAOwZ,IAAIuO,eAAe7J,EAASlC,EAAM4L,EAAa,CAC1ElnB,OAAQ,OACRsnB,cAAc,IAShB,OANIlc,QACI9L,OAAOwZ,IAAIyO,eAAe/J,EAAS,CAAEphB,KAAM,UAAW2d,WAAY,WAExE5oB,QAAQG,KAAK,2CAGR8Z,CACT,CACF,CAAE,MAAO/Z,GAEP,OADAF,QAAQqK,MAAM,kCAAmCnK,IAC1C,CACT,CACF,EAEAm2B,YAAa,SAAUx1B,GACrB,OAAOA,IAAcwmB,CACvB,EAGAhU,WAAY,WACViU,EAAgB,KAChBtnB,QAAQC,IAAI,6BACd,EAGAsnB,WAAY,WACV,OAAOA,GACT,EAEA6J,QAAS,SAAUf,GAIjB,GAFAhyB,KAAKgV,cAEAgd,IAAeA,EAAWzxB,OAAQ,CACrC,MAAM0xB,EAAShsB,EAAE,kBACjB,IAAKgsB,EAAO1xB,OAAQ,OACpByxB,EAAaC,CACf,CAEA,MAAMgG,EAAcjG,EAAW5c,KAAK,oBAChC6iB,EAAY13B,QACd03B,EAAY7iB,KAAK,KAAKwd,SAAS,WAKjC5yB,KAAK4tB,iBAAiB,GAAI,KACvBsK,KAAKlK,IAEAiK,EAAY13B,QACd03B,EAAY7iB,KAAK,KAAKud,YAAY,WAIpCX,EAAWoF,KAAK,8BAAgCp3B,KAAKovB,cAAgB,UACrEpvB,KAAK+xB,WAAWC,GAIhB,MAAMqB,OAASvjB,OAAOwV,QAAQ+N,QAAUvjB,OAAOujB,OACzC8E,EAAan4B,KAAKqqB,UACpBgJ,SAAW8E,GACb9E,OAAO+E,QAAQ,oCAGlBC,MAAMC,IACL32B,QAAQqK,MAAM,yCAA0CssB,GAGpDL,EAAY13B,QACd03B,EAAY7iB,KAAK,KAAKud,YAAY,WAIpCX,EAAWoF,KAAK,8BAAgCp3B,KAAKovB,cAAgB,UACrEpvB,KAAK+xB,WAAWC,GAGhB,MAAMqB,OAASvjB,OAAOwV,QAAQ+N,QAAUvjB,OAAOujB,OACzC8E,EAAan4B,KAAKqqB,UACpBgJ,SAAW8E,GACb9E,OAAOrnB,MAAM,cAGrB,EAEH,CA90EiB,GAi1EZusB,GAAsB,CAC1BC,eAAgB,EAChBC,eAAgB,EAChBC,oBAAqB,EACrBC,YAAa,GACbzmB,SAAU,YACV0mB,aAAc,QAEdC,eAAgB,GAChBC,YAAa,EAEbC,eAAgB,iBAEhBlyB,wBAAwB,EAExBmyB,sBAAsB,GAGlBtyB,GAAgB,IAAMwM,GAAMtK,IAAImB,EAAyBwuB,IACzDU,GAAiBC,IACrB,MAAMC,EAASzyB,KACT0yB,EAAS,IAAKD,KAAWD,GAC/BhmB,GAAMnK,IAAIgB,EAAyBqvB,GAEnC,MAAMC,EAAcz1B,OAAOC,KAAKq1B,GAAKlrB,OAAOod,GAAK+N,EAAO/N,KAAOgO,EAAOhO,IAClEiO,EAAY94B,OAAS,GACvBoB,QAAQoK,KAAK,kBAAkBstB,EAAYtxB,KAAK,UAK9CuxB,GAAgC,KACpC,IACE,MAAM7yB,EAAUC,KACV6yB,OAA+C90B,IAAnCgC,EAAQI,wBAAuCJ,EAAQI,uBACnE2yB,OAA4C/0B,IAAjCgC,EAAQuyB,sBAAqCvyB,EAAQuyB,qBAUtE,IACE,MAAMhzB,EAAMC,EAAE,kBACd,GAAID,EAAIzF,OAAQ,CACd,IAAIk5B,EAAczzB,EAAIG,OAAS,GAC3BuzB,EAAeD,EAEnB,GAAIF,EAAW,CAEb,MAAMI,EACJ,+GACIC,EAAc,iEAEhBD,EAAaryB,KAAKoyB,KACpBA,EAAeA,EAAa/zB,QAAQg0B,EAAc,cAEhDC,EAAYtyB,KAAKoyB,KACnBA,EAAeA,EAAa/zB,QAAQi0B,EAAa,aAErD,KAAO,CAEL,MAAMryB,EAAevB,EAAInF,KAAK,0BAC1B0G,GAAgBkyB,EAAYxxB,SAAS,eAEvCyxB,EAAeD,EAAY9zB,QAAQ,eAAgB4B,GACnDvB,EAAImC,WAAW,0BAEnB,CAEIuxB,IAAiBD,GACnBzzB,EAAIG,IAAIuzB,GAAc5yB,QAAQ,SAASA,QAAQ,SAEnD,CACF,CAAE,MAAOjF,GACPF,QAAQG,KAAK,yBAA0BD,EACzC,CAIA,IAAIg4B,EACJ,IACEA,EAAgBC,kBAClB,CAAE,MAAOj4B,GAEP,MACF,CAGA,GAAIg4B,EAAgB,EAClB,OAGF,IACE,MAAME,EAAeC,gBAAgB,KAAKH,IAAiB,CAAEI,KAAM,SAEnE,IAAKF,GAAwC,IAAxBA,EAAax5B,OAChC,OAGF,GAAIi5B,EAAU,CAEZ,IAAIU,EAAc,EAClBH,EAAav4B,QAAQ24B,IACnB,IACE,MAAMC,EAAcC,yBAAyBF,EAAI5P,YACjD,IAAK6P,IAAgBA,EAAY75B,OAC/B,OAIF,IAAI+5B,EAAWF,EAAYhlB,KAAK,aAC3BklB,GAAaA,EAAS/5B,SAEzB+5B,EAAWF,EAAYhlB,KAAK,6DAA6DyQ,QACpFyU,GAAaA,EAAS/5B,SAEzB+5B,EAAWF,IAKf,MAAMG,EAAiBD,EAASxU,OAEhC,GAAIyU,EAAetyB,SAAS,aAC1B,OAIF,MAAMV,EAAe4yB,EAAI9pB,SAAW,GACpC,IAAK9I,EACH,OAIF,IAAImyB,EAAenyB,EAInB,MAAMoyB,EACJ,+GACmBA,EAAaryB,KAAKoyB,KAErCA,EAAeA,EAAa/zB,QAAQg0B,EAAc,cAIpD,MAAMC,EACJ,iEAQF,GAPoBA,EAAYtyB,KAAKoyB,KAEnCA,EAAeA,EAAa/zB,QAAQi0B,EAAa,cAK/CF,IAAiBnyB,GAAgBmyB,IAAiBa,EAAgB,CAEpE,MAAMC,EAAcF,EAASlD,OAE7B,IAAIqD,EAAeD,EAGnB,MAAME,EACJ,+GACEA,EAAepzB,KAAKkzB,KACtBC,EAAeA,EAAa90B,QAAQ+0B,EAAgB,cAItD,MAAMC,EACJ,iEACEA,EAAcrzB,KAAKkzB,KACrBC,EAAeA,EAAa90B,QAAQg1B,EAAe,cAIjDF,IAAiBD,IACnBF,EAASlD,KAAKqD,GACdP,IAEJ,CACF,CAAE,MAAOr4B,GACPF,QAAQG,KAAK,iBAAiBq4B,EAAI5P,sBAAuB1oB,EAC3D,IAEEq4B,EAAc,GAChBv4B,QAAQoK,KAAK,aAAamuB,aAE9B,KAAO,CAEL,IAAIU,EAAgB,EACpBb,EAAav4B,QAAQ24B,IACnB,IACE,MAAMC,EAAcC,yBAAyBF,EAAI5P,YACjD,IAAK6P,IAAgBA,EAAY75B,OAAQ,OAEzC,MAAM+5B,EAAWF,EAAYhlB,KAAK,aAClC,IAAKklB,IAAaA,EAAS/5B,OAAQ,OAInC,GADoB+5B,EAASxU,OACb7d,SAAS,aAAc,CAErC,MAAMV,EAAe4yB,EAAI9pB,SAAW,GAChC9I,IACF+yB,EAASxU,KAAKve,GACdqzB,IAEJ,CACF,CAAE,MAAO/4B,GAET,IAEE+4B,EAAgB,GAClBj5B,QAAQoK,KAAK,aAAa6uB,aAE9B,CACF,CAAE,MAAO/4B,GAGH23B,GACF73B,QAAQG,KAAK,0BAA2BD,EAE5C,CACF,CAAE,MAAOA,GAGP,MAAM4E,EAAUC,KACZD,IAAYA,EAAQI,wBAA0BJ,EAAQuyB,uBACxDr3B,QAAQG,KAAK,sBAAuBD,EAExC,GAQIg5B,GAA4B,CAChC,CACErpB,OAAQ,qBACR+C,QAAS9J,EACTiD,GAAI,OACJuD,KAAM,UACNc,SAAS,EACTD,YAAa,uCACbgpB,eAAgB,CACd,CAAE7pB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC3D,CAAEhqB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC3D,CAAEhqB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC3D,CAAEhqB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC3D,CAAEhqB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC3D,CAAEhqB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC3D,CAAEhqB,KAAM,KAAM8pB,QAAS,WAAYC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC9D,CAAEhqB,KAAM,KAAM8pB,QAAS,WAAYC,MAAO,CAAC,GAAI,IAAKC,SAAU,WAEhEC,kBAAmB,CAEjB,CAAEjqB,KAAM,KAAM8pB,QAAS,UAAWC,MAAO,CAAC,GAAI,KAC9C,CAAE/pB,KAAM,KAAM8pB,QAAS,UAAWC,MAAO,CAAC,GAAI,KAC9C,CAAE/pB,KAAM,MAAO8pB,QAAS,UAAWC,MAAO,CAAC,GAAI,KAE/C,CAAE/pB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC5C,CAAE/pB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC5C,CAAE/pB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC5C,CAAE/pB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC5C,CAAE/pB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAE5C,CAAE/pB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC5C,CAAE/pB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC5C,CAAE/pB,KAAM,QAAS8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC/C,CAAE/pB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAE5C,CAAE/pB,KAAM,MAAO8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAE7C,CAAE/pB,KAAM,KAAM8pB,QAAS,OAAQC,MAAO,CAAC,EAAG,KAE1C,CAAE/pB,KAAM,OAAQ8pB,QAAS,KAAMC,MAAO,CAAC,EAAG,KAC1C,CAAE/pB,KAAM,QAAS8pB,QAAS,MAAOC,MAAO,CAAC,EAAG,MAGhD,CACExpB,OAAQ,qBACR+C,QAAS9J,EACTiD,GAAI,QACJuD,KAAM,UACNc,SAAS,EACTD,YAAa,qCACbgpB,eAAgB,CACd,CAAE7pB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,IAAKC,SAAU,SAC3D,CAAEhqB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,IAAKC,SAAU,SAC3D,CAAEhqB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,IAAKC,SAAU,SAC3D,CAAEhqB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,IAAKC,SAAU,SAC3D,CAAEhqB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,IAAKC,SAAU,SAC3D,CAAEhqB,KAAM,KAAM8pB,QAAS,SAAUC,MAAO,CAAC,EAAG,IAAKC,SAAU,UAE7DC,kBAAmB,CAEjB,CAAEjqB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,GAAI,KAC5C,CAAE/pB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,GAAI,KAE5C,CAAE/pB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,EAAG,KAC3C,CAAE/pB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,EAAG,KAC3C,CAAE/pB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,EAAG,KAC3C,CAAE/pB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,EAAG,KAE3C,CAAE/pB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,EAAG,KAC3C,CAAE/pB,KAAM,KAAM8pB,QAAS,QAASC,MAAO,CAAC,EAAG,QAM3CG,GAAyB,MAC7B,IAAIv7B,EAAS,KAEb,MAAO,CAEL,aAAAuU,GACE,MAAMnS,EAASkR,GAAMtK,IAAIoB,EAA+B,IAExD,IAAIqK,GAAY,EAiBhB,OAhBArS,EAAOR,QAAQ8S,IACb,MAAM8mB,EAAgB9mB,EAAOC,SAAW,QACpC7J,EAAe0wB,EAAe3wB,GAAyB,IACzD9I,QAAQC,IACN,uCAAuC0S,EAAOrD,eAAemqB,YAAwB3wB,KAEvF6J,EAAOC,QAAU9J,EACjB4J,GAAY,KAGZA,IACFnB,GAAMnK,IAAIiB,EAA+BhI,GAEzCpC,EAAS,OAGNyU,GAAazU,IAGlBA,EAAS,IAAIi7B,MAA8B74B,IAFlCpC,CAIX,EAGA,eAAAqV,GACE,MAAME,EAAWjC,GAAMtK,IAAIqB,EAAgC,MAC3D,OAAKkL,GACEnV,KAAKmU,gBAAgBiB,KAAKC,GAAKA,EAAE3H,KAAOyH,IADzB,IAExB,EAGA,eAAAG,CAAgB5H,GACd,IAEE,MAAM2tB,EAAiB,KAAP3tB,QAAoBjJ,IAAPiJ,EAAmB,KAAOA,EAKvD,OAJAwF,GAAMnK,IAAIkB,EAAgCoxB,GAE1Cz7B,EAAS,KACT+B,QAAQC,IAAI,qCAAsCy5B,IAC3C,CACT,CAAE,MAAO/C,GAEP,OADA32B,QAAQqK,MAAM,uCAAwCssB,IAC/C,CACT,CACF,EAGA,YAAA/iB,CAAajB,GACX,MAAMtS,EAASkR,GAAMtK,IAAIoB,EAA+B,IAClDwL,EAAY,IACblB,EACH5G,GAAI4G,EAAO5G,IAAM,UAAYvL,KAAKC,MAClC2P,SAAS,EACTwC,QAASD,EAAOC,SAAW9J,EAC3BgL,WAAW,IAAItT,MAAOuT,eAMxB,OAJA1T,EAAOtB,KAAK8U,GACZtC,GAAMnK,IAAIiB,EAA+BhI,GACzCpC,EAAS,KACT+B,QAAQC,IAAI,qCAAsC4T,EAAUvE,MACrDuE,CACT,EAGA,YAAA8lB,CAAa5tB,EAAI6K,GACf,MAAMvW,EAASkR,GAAMtK,IAAIoB,EAA+B,IAClDmO,EAAQnW,EAAOoW,UAAU/C,GAAKA,EAAE3H,KAAOA,GAC7C,QAAIyK,EAAQ,KACZnW,EAAOmW,GAAS,IAAKnW,EAAOmW,MAAWI,GACvCrF,GAAMnK,IAAIiB,EAA+BhI,GACzCpC,EAAS,KACT+B,QAAQC,IAAI,qCAAsC8L,IAC3C,EACT,EAGA,YAAAkI,CAAalI,GACX,MAAM1L,EAASkR,GAAMtK,IAAIoB,EAA+B,IAClD6L,EAAW7T,EAAOgM,OAAOqH,GAAKA,EAAE3H,KAAOA,GAC7C,OAAImI,EAAStV,SAAWyB,EAAOzB,SAC/B2S,GAAMnK,IAAIiB,EAA+B6L,GACzCjW,EAAS,KAELsT,GAAMtK,IAAIqB,KAAoCyD,GAChDwF,GAAMnK,IAAIkB,EAAgC,MAE5CtI,QAAQC,IAAI,qCAAsC8L,IAC3C,EACT,EAGA,YAAAqI,CAAarI,GACX,MAAM4G,EAAStU,KAAKmU,gBAAgBiB,KAAKC,GAAKA,EAAE3H,KAAOA,GACvD,IAAK4G,EAAQ,OAAO,KACpB,MAAMinB,EAAW,CACf/pB,OAAQ,qBACR+C,QAAS9J,KACN6J,GAGL,cADOinB,EAASxpB,QACTjR,KAAKwB,UAAUi5B,EAAU,KAAM,EACxC,EAGA,YAAA/kB,CAAaglB,EAASC,GAAa,GACjC,IACE,MAAM56B,EAAOC,KAAKC,MAAMy6B,GAGxB,GAAoB,uBAAhB36B,EAAK2Q,OACP,MAAM,IAAIhE,MAAM,YAIlB,IAAK3M,EAAKoQ,OAASpQ,EAAKi6B,iBAAmB/1B,MAAMqO,QAAQvS,EAAKi6B,gBAC5D,MAAM,IAAIttB,MAAM,WAGlB,MAAMmJ,EAAkB9V,EAAK0T,SAAW,QAClCmnB,EAAchxB,EAAeiM,EAAiBlM,GAAyB,EAGvE6d,EAAW,IACZznB,EACH6M,GAAI,YAAcvL,KAAKC,MACvB2P,SAAS,EACTwC,QAASknB,GAAcC,EAAcjxB,EAAwBkM,EAC7DlB,WAAW,IAAItT,MAAOuT,eAGlB4E,EAASta,KAAKuV,aAAa+S,GAMjC,OALIhO,GAAUohB,IAAgBD,GAC5B95B,QAAQG,KACN,uCAAuCwY,EAAOrJ,eAAe0F,YAA0BlM,KAGpF6P,CACT,CAAE,MAAOzY,GAEP,OADAF,QAAQqK,MAAM,qCAAsCnK,GAC7C,IACT,CACF,EAGA,UAAAmT,GACEpV,EAAS,IACX,EAEH,EA7J8B,GAoKzB+7B,GAAqB,KACzB,MAAM35B,EAASkR,GAAMtK,IAAIsB,EAAwB,MACjD,OAAKlI,EACE,IAAKmI,KAA8BnI,GADtB,IAAKmI,IAKrByxB,GAAsBzpB,IAC1Be,GAAMnK,IAAImB,EAAwBiI,IAI9B0pB,GAAyB,KAC7B,MAAM1pB,EAASwpB,KACf,IAAKxpB,EAAO/H,QAAS,OAAO,EAG5B,OAD6B,IAAhBiB,KAAKsC,SACJwE,EAAO9H,YA0BjByxB,GAAyB,KAC7B,MAAM3pB,EAASwpB,KACTxc,EAAU+F,IAAiBC,KACjC,IAAKhG,EAAS,OAAO,KAErB,MAAM4c,EAAYC,GAAgB7c,GAAW,CAAC,GACxC8c,EAAeC,GAAoBC,UAAUJ,EAAW,UACxDK,EAAYF,GAAoBC,UAAUJ,EAAW,OAGrDjH,EAAa,GAGnB,GAAImH,GAAcp7B,MAAM0c,MAAMhd,OAAS,EAAG,CACxC,MAAMmmB,EAAaX,MAA0B,KACvCsW,EAAcC,GAA8B,UAClDxH,EAAWp0B,KAAK,CACduQ,KAAMyV,EACN6V,MAAOF,EACP1V,UAAU,EACV6V,SAAS,EACTC,OAAQtqB,EAAO7H,cAEnB,CAGA,GAAI8xB,EAAW,CACKF,GAAoBQ,UAAUN,EAAW,OACjD56B,QAAQm7B,IAChB,IAAKA,EAAI1rB,KAAM,OACf,MAAM2rB,EAAal3B,OAAOi3B,EAAIH,SAAW,IAAIK,cACvCC,EAA2B,SAAfF,GAAwC,OAAfA,EACrCG,EAAWT,GAA8BK,EAAI1rB,MACnD6jB,EAAWp0B,KAAK,CACduQ,KAAM0rB,EAAI1rB,KACVsrB,MAAOQ,EACPpW,UAAU,EACV6V,QAASM,EACTL,OAAQK,EAAY3qB,EAAO5H,iBAAmB4H,EAAO3H,qBAG3D,CAEA,OAA0B,IAAtBsqB,EAAWv0B,OAAqB,KAvDTkkB,KAC3B,IAAKA,GAA0B,IAAjBA,EAAMlkB,OAAc,OAAO,KACzC,MAAMy8B,EAAcvY,EAAME,OAAO,CAACC,EAAKnjB,IAASmjB,GAAOnjB,EAAKg7B,QAAU,GAAI,GAC1E,IAAI9uB,EAAStC,KAAKsC,SAAWqvB,EAC7B,IAAK,MAAMv7B,KAAQgjB,EAEjB,GADA9W,GAAUlM,EAAKg7B,QAAU,EACrB9uB,GAAU,EAAG,OAAOlM,EAE1B,OAAOgjB,EAAMA,EAAMlkB,OAAS,IAgDrB08B,CAAqBnI,IAIxBoI,GAAuBC,IAC3B,IAAKA,EAAa,MAAO,CAAElsB,KAAM,KAAM/N,MAAO,IAG9C,GAAIi6B,EAAYZ,OAASY,EAAYZ,MAAMh8B,OAAS,EAAG,CACrD,MAAM68B,EAAaD,EAAYZ,MAAMlxB,KAAKgyB,MAAMhyB,KAAKsC,SAAWwvB,EAAYZ,MAAMh8B,SAClF,MAAO,CAAE0Q,KAAMmsB,EAAWnsB,KAAM/N,MAAOk6B,EAAWl6B,MACpD,CAGA,MAAMo6B,EAAenC,GAAuBlmB,kBAC5C,GAAIqoB,EAAc,CAChB,MAAMC,EAAiB,IAAKD,EAAaxC,gBAAkB,MAASwC,EAAapC,mBAAqB,IACtG,GAAIqC,EAAeh9B,OAAS,EAAG,CAC7B,MAAMi9B,EAAmBD,EAAelyB,KAAKgyB,MAAMhyB,KAAKsC,SAAW4vB,EAAeh9B,SAE5Ey6B,EAAQwC,EAAiBxC,OAAS,CAAC,EAAG,KACtCyC,EAAepyB,KAAKgyB,OAAOrC,EAAM,GAAKA,EAAM,IAAM,GACxD,MAAO,CAAE/pB,KAAMusB,EAAiBvsB,KAAM/N,MAAOu6B,EAC/C,CACF,CAGA,MAAMC,EAAYC,KAClB,GAAID,GAAaA,EAAUn9B,OAAS,EAAG,CAErC,MAAO,CAAE0Q,KADWysB,EAAUryB,KAAKgyB,MAAMhyB,KAAKsC,SAAW+vB,EAAUn9B,SACvC2C,MAAO,GACrC,CAEA,MAAO,CAAE+N,KAAM,KAAM/N,MAAO,KAIxB06B,GAAgB,IAAMvyB,KAAKgyB,MAAsB,IAAhBhyB,KAAKsC,UAAkB,EAGxDkwB,GAAuB,CAACC,EAAM1a,IAC9B0a,GAAQ,EAAU,MAClBA,GAAQ,GAAW,MACnBA,GAAQ1a,EAAe,KACpB,KAIH2a,GAAoB,KAIxB,GAAiB,WAtHS1zB,KAI1B,GAAIA,EAAa,GAAI,MAAO,SAC5B,MAAM2zB,EAAgB3zB,GAAc,GAAK,GAAM,GAC/C,OAAOgB,KAAKsC,SAAWqwB,EAAgB,UAAY,UA8GlCC,CADFtC,KAC6BtxB,YAEjB,CAEzB,MAAM8yB,EAAcrB,KACpB,IAAKqB,EAAa,OAAO,KAEzB,MAAMvJ,EAAOsJ,GAAqBC,GAC5BW,EAAOF,KACPtjB,EAASujB,GAAqBC,EAAMlK,EAAK1wB,OAG/C,MAAO,QAAQi6B,EAAYlsB,WAAW2iB,EAAK3iB,aAAa6sB,OAAUlK,EAAK1wB,UAAUoX,KACnF,CAAO,CAEL,MAAM4jB,EAAepC,KACrB,IAAKoC,EAAc,OAAO,KAG1B,IAAIC,EAAe,KACnB,IAAK,IAAI99B,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAM+9B,EAAYtC,KAClB,GAAIsC,GAAaA,EAAUntB,OAASitB,EAAajtB,KAAM,CACrDktB,EAAeC,EACf,KACF,CACF,CAGA,IAAKD,EAAc,CACjB,MAAMvK,EAAOsJ,GAAqBgB,GAC5BJ,EAAOF,KACPtjB,EAASujB,GAAqBC,EAAMlK,EAAK1wB,OAC/C,MAAO,QAAQg7B,EAAajtB,WAAW2iB,EAAK3iB,aAAa6sB,OAAUlK,EAAK1wB,UAAUoX,KACpF,CAEA,MAAM+jB,EAAQnB,GAAqBgB,GAC7BI,EAAQpB,GAAqBiB,GAC7BI,EAAQX,KACRY,EAAQZ,KAGRa,EAAUZ,GAAqBU,EAAOF,EAAMn7B,OAC5Cw7B,EAAUb,GAAqBW,EAAOF,EAAMp7B,OAC5Cy7B,EAAUN,EAAMn7B,MAAQq7B,EACxBK,EAAUN,EAAMp7B,MAAQs7B,EAE9B,IAAIK,EAUJ,OAREA,EADEF,EAAUC,EACH,GAAGV,EAAajtB,SAChB2tB,EAAUD,EACV,GAAGR,EAAaltB,SAEhB,KAKT,cAAcitB,EAAajtB,QAAQotB,EAAMptB,WAAWktB,EAAaltB,QAAQqtB,EAAMrtB,cAC5EitB,EAAajtB,QAAQotB,EAAMptB,WAAWotB,EAAMn7B,aAAaq7B,SAAaE,MACtEN,EAAaltB,QAAQqtB,EAAMrtB,WAAWqtB,EAAMp7B,aAAas7B,SAAaE,YAChEG,KAEb,GAYIC,GAAqBC,IACzB,MAEMt3B,EAAQs3B,EAAKt3B,MAAM,4CACzB,IAAKA,EAAO,OAAOu3B,IAEnB,MAAO,CAAEC,EAAUC,EAAUC,GAAY13B,EACnCod,EAAQnE,SAASue,EAAU,IAC3BG,EAAQ1e,SAASwe,EAAU,IAEjC,IAAIG,EAAQt6B,MAAM2rB,KAAK,CAAEnwB,OAAQskB,GAAS,IATzBua,IAAS/zB,KAAKgyB,MAAMhyB,KAAKsC,SAAWyxB,GAAS,EASdE,CAASF,IAGzD,GAAID,EAAU,CACZ,MAAMI,EAAKJ,EAAStC,cACdlc,EAAID,SAAS6e,EAAGh+B,MAAM,GAAI,IAChC89B,EAAMl+B,KAAK,CAACC,EAAGC,IAAMA,EAAID,GAErBm+B,EAAG9+B,WAAW,MAChB4+B,EAAQA,EAAM99B,MAAM,EAAGof,GAChB4e,EAAG9+B,WAAW,MACrB4+B,EAAQA,EAAM99B,OAAOof,GACd4e,EAAG9+B,WAAW,MACrB4+B,EAAQA,EAAM99B,MAAMof,GACb4e,EAAG9+B,WAAW,QAAO4+B,EAAQA,EAAM99B,MAAM,GAAIof,GACxD,CAEA,OAAO0e,EAAM1a,OAAO,CAACvjB,EAAGC,IAAMD,EAAIC,EAAG,IAsDjCm+B,GAAyB,CAACzE,EAASC,EAAOyE,KAC9C,IAAIv8B,EA9CkB,EAAC63B,EAAS0E,EAAU,CAAC,KAC3C,IAAK1E,EAAS,OAAO,EAErB,IAAIgE,EAAOr5B,OAAOq1B,GAAS30B,OAG3B,MAAMs5B,EAAW97B,OAAOC,KAAK47B,GAASt+B,KAAK,CAACC,EAAGC,IAAMA,EAAEd,OAASa,EAAEb,QAClE,IAAK,MAAM0Q,KAAQyuB,EAAU,CAC3B,MAAMx8B,EAAQu8B,EAAQxuB,GACD,iBAAV/N,GAAuB+b,MAAM/b,KAEtC67B,EAAOA,EAAK7zB,MAAM+F,GAAMlJ,KAAK,IAAI7E,MAErC,CASA,GANA67B,EAAOA,EAAKp5B,QAAQ,sCAAuC8B,IACzD,MAAM6S,EAASwkB,GAAmBr3B,GAClC,OAAOwX,MAAM3E,GAAU,IAAM5U,OAAO4U,MAIjC,oBAAoBhT,KAAKy3B,GAE5B,OADAp9B,QAAQG,KAAK,kCAAmCi5B,EAAS,IAAKgE,GACvD,EAIT,IAEE,MAAMzkB,EAAS,IAAIqlB,SAAS,WAAWZ,KAAxB,GACf,OAAO1zB,KAAKu0B,MAAMtlB,EACpB,CAAE,MAAOzY,GAEP,OADAF,QAAQqK,MAAM,gCAAiC+uB,EAAS,IAAKgE,EAAMl9B,GAC5D,CACT,GAWYg+B,CAAgB9E,EAAS0E,GAMrC,OAJIzE,GAASj2B,MAAMqO,QAAQ4nB,IAA2B,IAAjBA,EAAMz6B,SACzC2C,EAAQmI,KAAKC,IAAI0vB,EAAM,GAAI3vB,KAAKkH,IAAIyoB,EAAM,GAAI93B,KAGzCA,GAMH48B,GAAyB,CAC7BtlB,OAAQ,CACNulB,cAAe,CAAC,QAAS,OAAQ,MACjCzgB,QAAS,CACP0gB,eAAgB,CAAEC,SAAU,CAAC,SAAU,OAAQ,OAAQ,QAASC,cAAe,MAC/EC,gBAAiB,CAAEF,SAAU,CAAC,SAAU,SAAU,OAAQ,QAASC,cAAe,KAGtFE,OAAQ,CAENL,cAAe,CAAC,OAAQ,KAAM,KAAM,OAAQ,SAAU,KAAM,OAAQ,UACpEzgB,QAAS,CACPrO,KAAM,CAAEgvB,SAAU,CAAC,KAAM,KAAM,OAAQ,QAASC,cAAe,GAC/DG,OAAQ,CAAEJ,SAAU,CAAC,QAAS,QAAS,OAAQ,MAAOC,cAAe,MACrEI,SAAU,CAAEL,SAAU,CAAC,OAAQ,KAAM,OAAQC,cAAe,MAC5D3D,MAAO,CAAE0D,SAAU,CAAC,OAAQ,MAAOC,cAAe,KAAMK,YAAY,GAEpEC,MAAO,CACLP,SAAU,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,OAC3DC,cAAe,MAEjBO,UAAW,CAAER,SAAU,CAAC,OAAQ,KAAM,aAAcC,cAAe,QAGvEQ,SAAU,CAERX,cAAe,CACb,QACA,MACA,KACA,KACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MAEFzgB,QAAS,CACPrO,KAAM,CACJgvB,SAAU,CAAC,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,KAAM,MAAO,MAChEC,cAAe,GAEjBpuB,YAAa,CAAEmuB,SAAU,CAAC,OAAQ,KAAM,KAAM,KAAM,QAASC,cAAe,QAGhFvD,IAAK,CAEHoD,cAAe,CACb,QACA,OACA,MACA,MACA,KACA,MACA,KACA,YACA,KACA,KACA,KACA,KACA,KACA,MAEFzgB,QAAS,CACPrO,KAAM,CAAEgvB,SAAU,CAAC,KAAM,MAAOC,cAAe,GAC/CG,OAAQ,CAAEJ,SAAU,CAAC,OAAQ,MAAOC,cAAe,MACnDI,SAAU,CAAEL,SAAU,CAAC,OAAQ,KAAM,OAAQ,MAAOC,cAAe,MACnE1D,QAAS,CAAEyD,SAAU,CAAC,OAAQ,KAAM,OAAQ,MAAOC,cAAe,QAGtES,MAAO,CAELZ,cAAe,CAAC,MAAO,OAAQ,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACzEzgB,QAAS,CACPrO,KAAM,CAAEgvB,SAAU,CAAC,OAAQ,MAAO,MAAOC,cAAe,GACxDtzB,KAAM,CAAEqzB,SAAU,CAAC,KAAM,KAAM,QAASC,cAAe,GACvDU,SAAU,CAAEX,SAAU,CAAC,KAAM,MAAO,SAAUC,cAAe,GAC7DG,OAAQ,CAAEJ,SAAU,CAAC,MAAOC,cAAe,IAE7Cp0B,QAAS,CACP+0B,OAAQ,CAAEC,OAAQ,SAAU74B,SAAU,CAAC,KAAM,MAAO,MAAO84B,cAAe,OAAQC,SAAU,CAAC,SAGjGC,IAAK,CAEHlB,cAAe,CAAC,OAAQ,KAAM,KAAM,KAAM,KAAM,MAAO,OAAQ,SAC/DzgB,QAAS,CACPrO,KAAM,CAAEgvB,SAAU,CAAC,OAAQ,KAAM,OAAQC,cAAe,GACxDtzB,KAAM,CAAEqzB,SAAU,CAAC,KAAM,KAAM,QAASC,cAAe,GACvDrb,MAAO,CAAEob,SAAU,CAAC,KAAM,KAAM,OAAQC,cAAe,KAG3DgB,MAAO,CAELnB,cAAe,CACb,OACA,MACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,MAEFzgB,QAAS,CACPrO,KAAM,CAAEgvB,SAAU,CAAC,OAAQ,KAAM,OAAQC,cAAe,GACxDtzB,KAAM,CAAEqzB,SAAU,CAAC,KAAM,MAAOC,cAAe,GAC/C3P,MAAO,CAAE0P,SAAU,CAAC,KAAM,KAAM,MAAO,MAAOC,cAAe,KAGjEiB,MAAO,CAELpB,cAAe,CAAC,MAAO,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACvEzgB,QAAS,CACPrO,KAAM,CAAEgvB,SAAU,CAAC,OAAQ,KAAM,OAAQC,cAAe,GACxDtzB,KAAM,CAAEqzB,SAAU,CAAC,KAAM,MAAOC,cAAe,GAC/CjU,KAAM,CAAEgU,SAAU,CAAC,KAAM,OAAQ,MAAOC,cAAe,GACvDkB,WAAY,CAAEnB,SAAU,CAAC,KAAM,OAAQ,OAAQ,OAAQC,cAAe,IAExEp0B,QAAS,CACPu1B,SAAU,CAAEP,OAAQ,aAAc74B,SAAU,CAAC,MAAO,MAAO,OAAQ,IAAK,MAAO,gBAM/Ei0B,GAAsB,CAE1B,SAAAC,CAAUJ,EAAWuF,GACnB,MAAMnvB,EAAS2tB,GAAuBwB,GACtC,IAAKnvB,EAEH,OADAxQ,QAAQoK,KAAK,qBAAqBu1B,WAC3B,KAGT,IAAK,MAAMC,KAAWpvB,EAAO4tB,cAC3B,IAAK,MAAMv9B,KAAau5B,EACtB,GAAIv5B,EAAUyF,SAASs5B,GAErB,OADA5/B,QAAQoK,KAAK,qBAAqBu1B,UAAkB9+B,aAAqB++B,OAClE,CACL1gC,KAAMk7B,EAAUv5B,GAChByO,KAAMzO,EACNhC,IAAKu7B,EAAUv5B,GAAWhC,IAC1B2R,OAAQA,GAQhB,OAHAxQ,QAAQoK,KACN,qBAAqBu1B,mBAA2BnvB,EAAO4tB,cAAch4B,KAAK,UAErE,IACT,EAGA,eAAAy5B,CAAgB9+B,EAAS++B,EAAWC,GAClC,MAAMC,EAAYD,EAAapiB,QAAQmiB,GACvC,IAAKE,EAAW,OAAQ,EAGxB,IAAK,IAAIthC,EAAI,EAAGA,EAAIqC,EAAQnC,OAAQF,IAAK,CACvC,MAAMoD,EAAIiC,OAAOhD,EAAQrC,IAAM,IAAIw8B,cACnC,GAAI8E,EAAU1B,SAASlsB,KAAK6tB,GAAMn+B,EAAEwE,SAAS25B,EAAG/E,gBAC9C,OAAOx8B,CAEX,CAGA,OAAOshC,EAAUzB,gBAAkB,CACrC,EAGA,QAAA2B,CAASp/B,EAAKC,EAAS++B,EAAWC,GAChC,MAAM7+B,EAAM7C,KAAKwhC,gBAAgB9+B,EAAS++B,EAAWC,GACrD,OAAI7+B,EAAM,GAAKA,GAAOJ,EAAIlC,OAAe,KAClCkC,EAAII,EACb,EAGA,YAAAi/B,CAAap/B,EAAS4+B,GACpB,MAAMnvB,EAAS2tB,GAAuBwB,GACtC,IAAKnvB,EAAQ,MAAO,CAAC,EAErB,MAAMvR,EAAM,CAAC,EACb,IAAK,MAAMmhC,KAAU5vB,EAAOmN,QAC1B1e,EAAImhC,GAAU/hC,KAAKwhC,gBAAgB9+B,EAASq/B,EAAQ5vB,GAEtD,OAAOvR,CACT,EAGA,SAAA87B,CAAUsF,EAAaV,GACrB,IAAKU,IAAgBA,EAAYnhC,KAE/B,OADAc,QAAQoK,KAAK,qBAAqBu1B,cAC3B,GAGT,MAAM,KAAEzgC,EAAI,OAAEsR,GAAW6vB,EACnBt/B,EAAU7B,EAAK6B,SAAW,GAC1B6a,EAAO1c,EAAK0c,MAAQ,GACpB0kB,EAASjiC,KAAK8hC,aAAap/B,EAAS4+B,GAEpCY,EAAS3kB,EAAK3c,IAAI,CAAC6B,EAAKI,KAC5B,MAAMitB,EAAM,CAAEqS,UAAWt/B,EAAKu/B,KAAM3/B,GACpC,IAAK,MAAMs/B,KAAUE,EAAQ,CAC3B,MAAMn9B,EAASm9B,EAAOF,GACtBjS,EAAIiS,GAAUj9B,GAAU,GAAKA,EAASrC,EAAIlC,OAASkC,EAAIqC,GAAU,IACnE,CACA,OAAOgrB,IAIT,OADAnuB,QAAQoK,KAAK,qBAAqBu1B,WAAmBY,EAAO3hC,WACrD2hC,CACT,EAGA,WAAAG,CAAYC,EAAYC,EAAWjB,GACjC,MAAMnvB,EAAS2tB,GAAuBwB,GACtC,IAAKnvB,IAAWA,EAAOrG,UAAYqG,EAAOrG,QAAQy2B,GAAY,OAAOD,EAErE,MAAMt0B,EAASmE,EAAOrG,QAAQy2B,GAI9B,OADwBD,EAAWvuB,KAAKtR,GAA8B,OAAvBA,EAAIuL,EAAO8yB,cAA2Cr8B,IAAvBhC,EAAIuL,EAAO8yB,SAMlFwB,EAAWt0B,OAAOvL,IACvB,MAAMS,EAAQwC,OAAOjD,EAAIuL,EAAO8yB,SAAW,IAAIjE,cACzC2F,EAAex0B,EAAO/F,SAAS8L,KAAK0uB,GAAOv/B,EAAM+E,SAASw6B,EAAI5F,gBAEpE,GAAI7uB,EAAO+yB,eAAiB/yB,EAAOgzB,SAAU,CAC3C,MAAM0B,EAAeh9B,OAAOjD,EAAIuL,EAAO+yB,gBAAkB,IAAIlE,cACvD8F,EAAe30B,EAAOgzB,SAASjtB,KAAK6uB,GAAOF,EAAaz6B,SAAS26B,EAAI/F,gBAC3E,OAAO2F,IAAiBG,CAC1B,CAEA,OAAOH,IAbAF,CAeX,GAGIO,GAAoB,CACxBz4B,SAAS,EACT04B,WAAY,QACZC,cAAc,EACdC,gBAAgB,EAChBC,cAAe,CACb,CACEC,eAAgB,CAAC,KAAM,KAAM,WAAY,MAAO,KAAM,MACtDC,QAAS,CACP,CAAEC,MAAO,KAAMjyB,KAAM,aAAcvE,KAAM,SAAUy2B,SAAU,kBAAmBC,WAAW,GAC3F,CAAEF,MAAO,KAAMjyB,KAAM,YAAavE,KAAM,SAAUy2B,SAAU,kBAAmBC,WAAW,GAC1F,CAAEF,MAAO,KAAMjyB,KAAM,WAAYvE,KAAM,SAAUy2B,SAAU,mBAAoBC,WAAW,KAG9F,CACEJ,eAAgB,CAAC,KAAM,MAAO,OAAQ,KAAM,MAC5CC,QAAS,CACP,CAAEC,MAAO,KAAMjyB,KAAM,cAAevE,KAAM,SAAUy2B,SAAU,mBAAoBC,WAAW,GAC7F,CAAEF,MAAO,KAAMjyB,KAAM,SAAUvE,KAAM,SAAUy2B,SAAU,kBAAmBC,WAAW,GACvF,CAAEF,MAAO,KAAMjyB,KAAM,eAAgBvE,KAAM,SAAUy2B,SAAU,mBAAoBC,WAAW,KAGlG,CACEJ,eAAgB,CAAC,KAAM,KAAM,MAC7BC,QAAS,CACP,CAAEC,MAAO,KAAMjyB,KAAM,kBAAmBvE,KAAM,SAAUy2B,SAAU,mBAAoBC,WAAW,GACjG,CAAEF,MAAO,KAAMjyB,KAAM,SAAUvE,KAAM,SAAUy2B,SAAU,mBAAoBC,WAAW,GACxF,CAAEF,MAAO,KAAMjyB,KAAM,WAAYvE,KAAM,SAAUy2B,SAAU,mBAAoBC,WAAW,KAG9F,CACEJ,eAAgB,CAAC,KAAM,KAAM,MAC7BC,QAAS,CACP,CACEC,MAAO,KACPjyB,KAAM,mBACNvE,KAAM,SACNy2B,SAAU,mBACVC,WAAW,GAEb,CAAEF,MAAO,KAAMjyB,KAAM,kBAAmBvE,KAAM,SAAUy2B,SAAU,mBAAoBC,WAAW,GACjG,CAAEF,MAAO,KAAMjyB,KAAM,WAAYvE,KAAM,SAAUy2B,SAAU,mBAAoBC,WAAW,KAG9F,CACEJ,eAAgB,CAAC,KAAM,MACvBC,QAAS,CACP,CACEC,MAAO,KACPjyB,KAAM,yBACNvE,KAAM,cACNy2B,SAAU,kBACVC,WAAW,GAEb,CAAEF,MAAO,KAAMjyB,KAAM,cAAevE,KAAM,SAAUy2B,SAAU,kBAAmBC,WAAW,KAGhG,CACEJ,eAAgB,CAAC,KAAM,KAAM,MAC7BC,QAAS,CACP,CACEC,MAAO,KACPjyB,KAAM,gBACNvE,KAAM,SACNy2B,SAAU,yBACVC,WAAW,GAEb,CACEF,MAAO,KACPjyB,KAAM,gBACNvE,KAAM,SACNy2B,SAAU,uBACVC,WAAW,GAEb,CAAEF,MAAO,KAAMjyB,KAAM,kBAAmBvE,KAAM,SAAUy2B,SAAU,mBAAoBC,WAAW,KAGrG,CACEJ,eAAgB,CAAC,KAAM,KAAM,MAC7BC,QAAS,CACP,CACEC,MAAO,KACPjyB,KAAM,gBACNvE,KAAM,SACNy2B,SAAU,qBACVC,WAAW,GAEb,CAAEF,MAAO,KAAMjyB,KAAM,eAAgBvE,KAAM,SAAUy2B,SAAU,oBAAqBC,WAAW,GAC/F,CACEF,MAAO,KACPjyB,KAAM,eACNvE,KAAM,SACNy2B,SAAU,qBACVC,WAAW,OAOfC,GAAe,CACnBC,MAAO,CACLC,QAAS,UACTC,OAAQ,UACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,0BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,2BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,2BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,kBACTC,YAAa,mBACbC,WAAY,OACZC,OAAQ,wBAERC,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACb5U,mBAAoB,QAEtB6U,KAAM,CACJnC,QAAS,yBACTC,OAAQ,OACR1S,SAAU,OACV2S,QAAS,OACTC,MAAO,wBACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,yBACXC,YAAa,UACbC,UAAW,0BACXC,QAAS,yBACTC,UAAW,OACXC,gBAAiB,OACjBC,YAAa,UACbC,cAAe,OAEfC,YAAa,UACbC,UAAW,2BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,yBACfC,mBAAoB,UACpBC,iBAAkB,0BAElBC,UAAW,mBACXC,eAAgB,mBAChBC,SAAU,kBACVC,QAAS,yBACTC,YAAa,yBACbC,WAAY,OACZC,OAAQ,wBAERC,UAAW,UACXC,QAAS,2BACTC,YAAa,2BACbC,YAAa,UACb5U,mBAAoB,QAEtB8U,OAAQ,CACNpC,QAAS,UACTC,OAAQ,UACR1S,SAAU,OACV2S,QAAS,OACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,0BACXC,QAAS,OACTC,UAAW,OACXC,gBAAiB,OACjBC,YAAa,UACbC,cAAe,OAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,2BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,kBACTC,YAAa,mBACbC,WAAY,OACZC,OAAQ,wBAERC,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACb5U,mBAAoB,QAEtB+U,OAAQ,CACNrC,QAAS,UACTC,OAAQ,UACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,yBACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,OAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,0BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,kBACTC,YAAa,mBACbC,WAAY,OACZC,OAAQ,wBAERC,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACb5U,mBAAoB,QAEtBgV,MAAO,CACLtC,QAAS,UACTC,OAAQ,UACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,0BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,OAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,0BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,kBACTC,YAAa,mBACbC,WAAY,OACZC,OAAQ,wBAERC,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACb5U,mBAAoB,QAEtBiV,MAAO,CACLvC,QAAS,UACTC,OAAQ,YACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,yBACPC,SAAU,yBACVC,OAAQ,UACRC,UAAW,0BACXC,YAAa,OACbC,UAAW,wBACXC,QAAS,qBACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,OAEfC,YAAa,UACbC,UAAW,yBACXC,YAAa,UACbC,UAAW,yBACXC,gBAAiB,UACjBC,cAAe,yBACfC,gBAAiB,UACjBC,cAAe,uBACfC,mBAAoB,UACpBC,iBAAkB,yBAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,sBACVC,QAAS,uBACTC,YAAa,uBACbC,WAAY,OACZC,OAAQ,sBAERU,SAAU,yBACVC,eAAgB,yBAChBC,eAAgB,yBAChBC,qBAAsB,yBAEtBZ,UAAW,UACXC,QAAS,yBACTC,YAAa,yBACbC,YAAa,UACb5U,mBAAoB,QAEtBsV,SAAU,CACR5C,QAAS,UACTC,OAAQ,UACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,4BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,2BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,yBACfC,mBAAoB,UACpBC,iBAAkB,2BAElBC,UAAW,mBACXC,eAAgB,mBAChBC,SAAU,kBACVC,QAAS,yBACTC,YAAa,yBACbC,WAAY,OACZC,OAAQ,wBAERU,SAAU,2BACVC,eAAgB,2BAChBC,eAAgB,2BAChBC,qBAAsB,2BAEtBZ,UAAW,UACXC,QAAS,2BACTC,YAAa,2BACbC,YAAa,UACb5U,mBAAoB,QAEtBuV,OAAQ,CACN7C,QAAS,UACTC,OAAQ,UACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,4BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,4BACXC,YAAa,UACbC,UAAW,4BACXC,gBAAiB,UACjBC,cAAe,4BACfC,gBAAiB,UACjBC,cAAe,4BACfC,mBAAoB,UACpBC,iBAAkB,4BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,yBACVC,QAAS,4BACTC,YAAa,4BACbC,WAAY,UACZC,OAAQ,4BAERU,SAAU,2BACVC,eAAgB,2BAChBC,eAAgB,2BAChBC,qBAAsB,2BAEtBZ,UAAW,UACXC,QAAS,4BACTC,YAAa,2BACbC,YAAa,UACb5U,mBAAoB,QAEtBwV,SAAU,CACR9C,QAAS,UACTC,OAAQ,UACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,2BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,2BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,yBACfC,mBAAoB,UACpBC,iBAAkB,2BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,2BACTC,YAAa,4BACbC,WAAY,UACZC,OAAQ,2BAERU,SAAU,2BACVC,eAAgB,2BAChBC,eAAgB,2BAChBC,qBAAsB,2BAEtBZ,UAAW,UACXC,QAAS,2BACTC,YAAa,2BACbC,YAAa,UACb5U,mBAAoB,QAEtByV,OAAQ,CACN/C,QAAS,UACTC,OAAQ,UACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,2BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,OAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,2BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,0BACTC,YAAa,2BACbC,WAAY,OACZC,OAAQ,0BAERU,SAAU,0BACVC,eAAgB,0BAChBC,eAAgB,0BAChBC,qBAAsB,0BAEtBZ,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACb5U,mBAAoB,QAEtB0V,OAAQ,CACNhD,QAAS,UACTC,OAAQ,UACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,yBACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,yBACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,yBAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,yBACTC,YAAa,yBACbC,WAAY,UACZC,OAAQ,yBAERU,SAAU,wBACVC,eAAgB,yBAChBC,eAAgB,wBAChBC,qBAAsB,wBAEtBZ,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACb5U,mBAAoB,QAEtB2V,YAAa,CACXjD,QAAS,UACTC,OAAQ,UACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,0BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,2BACXC,YAAa,UACbC,UAAW,yBACXC,gBAAiB,UACjBC,cAAe,yBACfC,gBAAiB,UACjBC,cAAe,yBACfC,mBAAoB,UACpBC,iBAAkB,0BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,yBACTC,YAAa,0BACbC,WAAY,UACZC,OAAQ,2BAERU,SAAU,yBACVC,eAAgB,0BAChBC,eAAgB,yBAChBC,qBAAsB,yBAEtBZ,UAAW,UACXC,QAAS,2BACTC,YAAa,2BACbC,YAAa,UACb5U,mBAAoB,WAEtB4V,QAAS,CACPlD,QAAS,UACTC,OAAQ,UACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,4BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,4BACXC,YAAa,UACbC,UAAW,4BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,2BACfC,mBAAoB,UACpBC,iBAAkB,2BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,4BACVC,QAAS,4BACTC,YAAa,4BACbC,WAAY,UACZC,OAAQ,2BAERU,SAAU,2BACVC,eAAgB,4BAChBC,eAAgB,2BAChBC,qBAAsB,2BAEtBZ,UAAW,UACXC,QAAS,4BACTC,YAAa,2BACbC,YAAa,UACb5U,mBAAoB,WAEtB6V,UAAW,CACTnD,QAAS,UACTC,OAAQ,yBACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,yBACPC,SAAU,yBACVC,OAAQ,UACRC,UAAW,yBACXC,YAAa,UACbC,UAAW,0BACXC,QAAS,yBACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,yBACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,yBACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,yBAElBC,UAAW,0BACXC,eAAgB,0BAChBC,SAAU,yBACVC,QAAS,0BACTC,YAAa,0BACbC,WAAY,UACZC,OAAQ,yBAERU,SAAU,yBACVC,eAAgB,yBAChBC,eAAgB,yBAChBC,qBAAsB,yBAEtBZ,UAAW,UACXC,QAAS,yBACTC,YAAa,yBACbC,YAAa,UACb5U,mBAAoB,WAEtB8V,iBAAkB,CAChBpD,QAAS,UACTC,OAAQ,UACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,uBACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,uBACXC,YAAa,UACbC,UAAW,wBACXC,gBAAiB,UACjBC,cAAe,uBACfC,gBAAiB,UACjBC,cAAe,wBACfC,mBAAoB,UACpBC,iBAAkB,uBAElBC,UAAW,qBACXC,eAAgB,qBAChBC,SAAU,qBACVC,QAAS,yBACTC,YAAa,0BACbC,WAAY,UACZC,OAAQ,yBAERU,SAAU,UACVC,eAAgB,UAChBC,eAAgB,uBAChBC,qBAAsB,UAEtBZ,UAAW,UACXC,QAAS,uBACTC,YAAa,uBACbC,YAAa,UACb5U,mBAAoB,WAEtB+V,SAAU,CACRrD,QAAS,UACTC,OAAQ,UACR1S,SAAU,UACV2S,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,wBACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UACfC,YAAa,UACbC,UAAW,wBACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,0BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,uBAClBC,UAAW,qBACXC,eAAgB,qBAChBC,SAAU,qBACVC,QAAS,wBACTC,YAAa,wBACbC,WAAY,UACZC,OAAQ,wBACRC,UAAW,UACXC,QAAS,wBACTC,YAAa,uBACbC,YAAa,UACb5U,mBAAoB,YAGlBF,GAAiB,KACrB,MAAMD,EAAQ2S,GAAalM,KAAYzG,QAAU2S,GAAoB,MASrE,GAPK3S,EAAMqV,WACTrV,EAAMqV,SAAWrV,EAAMkT,OACvBlT,EAAMsV,eAAiBtV,EAAMkT,OAC7BlT,EAAMuV,eAAiBvV,EAAMgT,MAC7BhT,EAAMwV,qBAAuBxV,EAAMkT,SAGhClT,EAAMG,mBAAoB,CAG7B,MAAMgW,EACJnW,EAAM6S,UACL7S,EAAM6S,QAAQhjC,WAAW,OACxBmwB,EAAM6S,QAAQhjC,WAAW,OACzBmwB,EAAM6S,QAAQhjC,WAAW,OACzBmwB,EAAM6S,QAAQhjC,WAAW,OACzBmwB,EAAM6S,QAAQx7B,SAAS,QACvB2oB,EAAM6S,QAAQx7B,SAAS,QAC3B2oB,EAAMG,mBAAqBgW,EAAenW,EAAMI,UAAY,OAAS,MACvE,CACA,OAAOJ,GAKHoW,GAAsB,CAACC,EAAYC,KAEvC,MAAMC,EAAS,CACbC,YAAa,CACXC,GAAIH,EAAEvC,gBACN7e,KAAM,QAERwhB,eAAgB,CACdD,GAAIH,EAAEnC,mBACNjf,KAAM,QAERlK,QAAS,CACPyrB,GAAIH,EAAElD,YACNle,KAAM,QAERsS,QAAS,CACPiP,GAAIH,EAAEzC,YACN3e,KAAM,QAERyhB,QAAS,CACPF,GAAIH,EAAE3C,YACNze,KAAM,QAER0hB,YAAa,CACXH,GAAIH,EAAErC,gBACN/e,KAAM,SAGJpZ,EAAQy6B,EAAOF,IAAeE,EAAOI,QAC3C,MAAO,CACL,mBAAoB76B,EAAM26B,GAC1B5T,MAAO/mB,EAAMoZ,KACb2hB,QAAS,UACT,gBAAiB,MACjB,YAAa,OACb,cAAe,OACf,cAAe,SACf96B,QAAS,cACT,cAAe,WAIb+6B,GAAqBllC,IACzB,MAAM2P,EA9CkBe,GAAMtK,IA3kPF,0BA2kP6Bi6B,IA+CzD,IAAK1wB,EAAO/H,UAAY+H,EAAO8wB,cAAe,MAAO,GACrD,MAAM0E,EAAYnlC,EAAUq6B,cAC5B,IAAK,MAAM+K,KAASz1B,EAAO8wB,cAAe,CAExC,GADgB2E,EAAM1E,eAAenvB,KAAKwtB,GAAWoG,EAAU1/B,SAASs5B,EAAQ1E,gBACnE,OAAO+K,EAAMzE,SAAW,EACvC,CACA,MAAO,IAEH3W,GAAgBtpB,IACpB,GAAIA,SAAmD,KAAVA,EAAc,OAAO,EAClE,MAAMooB,EAAM5lB,OAAOxC,GAAOkD,OAE1B,MACE,oBAAoBkB,KAAKgkB,IACzB,aAAahkB,KAAKgkB,IAClB,uCAAuChkB,KAAKgkB,IAC5C,MAAMhkB,KAAKgkB,IAITuc,GAAsB3kC,IAC1B,IAAKA,EAAO,OAAO,EACnB,MAAMooB,EAAM5lB,OAAOxC,GAAOkD,OAE1B,GAAI,aAAakB,KAAKgkB,GAAM,OAAO5K,SAAS4K,EAAIpgB,MAAM,KAAK,GAAI,IAE/D,GAAIogB,EAAIvM,SAAS,KAAM,OAAO2B,SAAS4K,EAAI3lB,QAAQ,IAAK,IAAK,IAE7D,MAAMmiC,EAAUxc,EAAI7jB,MAAM,QAC1B,OAAIqgC,GAAWA,EAAQvnC,OAAS,EACvBmgB,SAASonB,EAAQA,EAAQvnC,OAAS,GAAI,IAExC,GAGHwnC,GAAuBzc,IAC3B,IAAKA,EAAK,MAAO,GACjB,MAAMnN,EAAU,GACV6pB,EAAStiC,OAAO4lB,GAAKllB,OAG3B,GAAI4hC,EAAOvnC,WAAW,MAAQunC,EAAOjpB,SAAS,KAC5C,IACE,MAAMkpB,EAAUnnC,KAAKC,MAAMinC,GAC3B,IAAK,MAAMxnC,KAAOynC,EAAS,CACzB,MAAM9hC,EAAM8hC,EAAQznC,GACD,iBAAR2F,EACTgY,EAAQzd,KAAK,CAAEuQ,KAAMzQ,EAAK0C,MAAOiD,IACT,iBAARA,GAAoB,QAAQmB,KAAKnB,IACjDgY,EAAQzd,KAAK,CAAEuQ,KAAMzQ,EAAK0C,MAAOwd,SAASva,EAAK,KAEnD,CACA,GAAIgY,EAAQ5d,OAAS,EAAG,OAAO4d,CACjC,CAAE,MAAOtc,GAET,CAIF,MAAMgG,EAAQmgC,EAAO98B,MAAM,aAC3B,IAAK,MAAM+gB,KAAQpkB,EAAO,CACxB,MAAMJ,EAAQwkB,EAAKxkB,MAAM,sDACrBA,GACF0W,EAAQzd,KAAK,CAAEuQ,KAAMxJ,EAAM,GAAIvE,MAAOwd,SAASjZ,EAAM,GAAI,KAE7D,CACA,OAAO0W,GAMH+pB,GAA0B5c,IAC9B,IAAKA,EAAK,MAAO,GACjB,MAAMnN,EAAU,GAIVtW,EAHSnC,OAAO4lB,GAAKllB,OAGN8E,MAAM,QAC3B,IAAK,MAAM+gB,KAAQpkB,EAAO,CACxB,MAAMsgC,EAAUlc,EAAK7lB,OACrB,IAAK+hC,EAAS,SAGd,MAAMC,EAAaD,EAAQ1gC,MAAM,qBACjC,GAAI2gC,EAAY,CACd,MAAMn3B,EAAOm3B,EAAW,GAAGhiC,OACrBuL,EAAWy2B,EAAW,GAAGhiC,OAC/B,GAAI6K,GAAQU,EAAU,CACpBwM,EAAQzd,KAAK,CAAEuQ,KAAMA,EAAMU,SAAUA,IACrC,QACF,CACF,CAGA,MAAM02B,EAAaF,EAAQ1gC,MAAM,8BAC7B4gC,EACFlqB,EAAQzd,KAAK,CAAEuQ,KAAMo3B,EAAW,GAAGjiC,OAAQuL,SAAU02B,EAAW,GAAGjiC,SAKjE+hC,EAAQ5nC,OAAS,GACnB4d,EAAQzd,KAAK,CAAEuQ,KAAMk3B,EAASx2B,SAAU,IAE5C,CACA,OAAOwM,GAIHmqB,GAAqB,CAACplC,EAAOqlC,KACjC,IAAKrlC,EAAO,OAAO,EACnB,MAAMooB,EAAM5lB,OAAOxC,GAAOkD,OACpBoiC,GAAeD,GAAc,IAAI1L,cAEvC,SAAI2L,EAAYvgC,SAAS,QAASugC,EAAYvgC,SAAS,QAIhD,wDAAwDX,KAAKgkB,IAGhEmd,GAAkB,CAACpF,EAAUqF,EAAUhmC,KAC3C,IAAK2gC,IAAaqF,EAAU,OAAOrF,EACnC,IAAI/oB,EAAS+oB,EACb,MAAMpyB,EAAOy3B,EAAS,IAAM,KAa5B,OAZApuB,EAASA,EAAO3U,QAAQ,aAAcsL,GACtCqJ,EAASA,EAAO3U,QAAQ,iBAAkB+iC,EAAS,IAAM,KACrDhmC,GAAWA,EAAQnC,OAAS,GAC9BmC,EAAQlB,QAAQ,CAACmnC,EAAQ9lC,KACvB,GAAI8lC,GAAU9lC,EAAM6lC,EAASnoC,OAAQ,CACnC,MAAM2C,EAAQwlC,EAAS7lC,IAAQ,KACzBoY,EAAQ,IAAIE,OAAO,MAAMwtB,OAAa,MAC5CruB,EAASA,EAAO3U,QAAQsV,EAAO/X,EACjC,IAGJoX,EAASA,EAAO3U,QAAQ,aAAc,MAC/B2U,GAIHsuB,GAAiB,CACrB,CAAEl7B,GAAI,sBAAuByD,KAAM,UAAW03B,MAAO,UACrD,CAAEn7B,GAAI,kBAAmByD,KAAM,cAAe03B,MAAO,QACrD,CAAEn7B,GAAI,mBAAoByD,KAAM,kBAAmB03B,MAAO,QAE1D,CAAEn7B,GAAI,iBAAkByD,KAAM,UAAW03B,MAAO,QAChD,CAAEn7B,GAAI,mBAAoByD,KAAM,SAAU03B,MAAO,SAGnD,IAAIC,IAAgB,EAChBC,IAAW,EACXC,IAAiB,EACjBC,IAAiB,EACjBC,GAAiB,IAAI71B,IACrB81B,GAAW,KACXC,GAAsB,KAGtBlkB,GAAgB,KAChBmkB,IAAoB,EACpBC,IAAqB,EACrBC,GAAkB,CAAC,EACnBC,GAAoB,CAAC,EACrBC,GAAiB,KACjBC,IAAqB,EAEzB,MAAMC,GAAqB,uBAC3B,IAAIC,GAAoB,CAAC,EACzB,IACE,MAAMja,EAAQrvB,aAAaU,QAAQ2oC,IAC/Bha,IAAOia,GAAoB9oC,KAAKC,MAAM4uB,GAC5C,CAAE,MAAO9tB,GACPF,QAAQG,KAAK,mBAAoBD,EACnC,CAEA,MAAMgoC,GAAmB,CACvBC,qBAAsB,EACtBC,gBAAgB,EAEhBC,aAAc,KAEZ,IAAIH,GAAiBE,eAArB,CAGA,IACE,MAAMvmC,EAAWymC,KACXnpB,EAAUqE,KAChB,GAAI3hB,GAAYsd,EAAS,CACvB,MAAMpM,EAAQK,EAAsBiD,kBAC9B+I,EAAavC,GAAiBqC,gBAAgBrd,EAAUsd,EAASpM,GAEvE,GAAIqM,EAAWxgB,OAAS,EAAG,CACzBoB,QAAQG,KAAK,yBAA0Bif,GACvC8oB,GAAiBE,gBAAiB,EAGlC,MAAMG,EAAMnkC,KAAUokC,QACtB,GAAID,GAAKE,UACP,IACEF,EAAIE,UAAU5mC,GACVsM,OAAOujB,QACTvjB,OAAOujB,OAAOrnB,MAAM+U,EAAW,GAAG1Q,QAAS,MAAO,CAChDg6B,QAAS,IACTC,cAAe,sBAGrB,CAAE,MAAOC,GACP5oC,QAAQqK,MAAM,4BAA6Bu+B,GAEvCz6B,OAAOujB,QACTvjB,OAAOujB,OAAOrnB,MAAM,SAAS+U,EAAW,GAAG1Q,wBAAyB,KAAM,CACxEg6B,QAAS,IACTC,cAAe,sBAGrB,CAMF,YAHA5gB,WAAW,KACTmgB,GAAiBE,gBAAiB,GACjC,IAEL,CACF,CACF,CAAE,MAAOloC,GACPF,QAAQqK,MAAM,oBAAqBnK,EACrC,CAIAuxB,KAGA1J,WAAW,KACT,IACE,MAAMvK,EAAU+F,IAAiBC,KACjC,GAAIhG,EAAS,CACX,MACMqrB,EADShsB,GAAiBkD,gBAAgBvC,GACxB5e,OAGTspC,GAAiBC,qBAIhCD,GAAiBC,qBAAuBU,EAGxCC,GAA0BD,EAC5B,CACF,CAAE,MAAO3oC,GACPF,QAAQqK,MAAM,oBAAqBnK,EACrC,GACC,IAxEwC,IA6EzC4oC,GAA4B5lB,IAChC,MAAM,GAAQ9e,KACR2kC,EAAazkC,EAAE,6BAEjB4e,EAAQ,EACN6lB,EAAWnqC,SACbmqC,EAAWt1B,KAAK,yBAAyB0Q,KAAKjB,GAC9C6lB,EAAWC,QAGbD,EAAWhY,QAKTzyB,GAA+B,KACnC,IAEE,GAA2B,oBAAhBslB,aAA+BA,YAAYqlB,iBACpD,OAAOrlB,YAAYqlB,mBAGrB,GAA2B,oBAAhBrlB,aAA+BA,YAAYslB,OACpD,OAAOtlB,YAAYslB,OAGrB,GAAI/6B,OAAOwV,QAAQC,aAAaqlB,iBAC9B,OAAO96B,OAAOwV,OAAOC,YAAYqlB,kBAErC,CAAE,MAAO/oC,GACPF,QAAQG,KAAK,gDAAiDD,EAChE,CACA,MAAO,mBAKHipC,GAAiB,CACrBC,OAAQ,aACRC,cAAe,MACfC,cAAe,QACfC,WAAY,UACZta,MAAO,QACPua,UAAW,IACXC,SAAU,GACVC,cAAc,EACdC,aAAc,GACdC,gBAAiB,SACjBC,YAAa,OACbC,aAAc,QACdC,iBAAiB,EACjBC,uBAAuB,EACvBC,eAAgB,IAGZC,GAAQ,CACZ,CAAEn+B,GAAI,UAAWuD,KAAM,gBAAiB9K,IAAK,iDAC7C,CAAEuH,GAAI,UAAWuD,KAAM,QAAS9K,IAAK,uBACrC,CAAEuH,GAAI,QAASuD,KAAM,mBAAoB9K,IAAK,iCAC9C,CAAEuH,GAAI,SAAUuD,KAAM,iBAAkB9K,IAAK,0BAC7C,CAAEuH,GAAI,SAAUuD,KAAM,WAAY9K,IAAK,2BACvC,CAAEuH,GAAI,QAASuD,KAAM,cAAe9K,IAAK,uBACzC,CAAEuH,GAAI,SAAUuD,KAAM,qBAAsB9K,IAAK,0CACjD,CAAEuH,GAAI,SAAUuD,KAAM,gBAAiB9K,IAAK,wBAC5C,CAAEuH,GAAI,WAAYuD,KAAM,mBAAoB9K,IAAK,+BACjD,CAAEuH,GAAI,SAAUuD,KAAM,gBAAiB9K,IAAK,iDAGxC2lC,GAAS,CACb,CAAEp+B,GAAI,QAASuD,KAAM,eAAgBE,KAAM,aAC3C,CAAEzD,GAAI,OAAQuD,KAAM,cAAeE,KAAM,WACzC,CAAEzD,GAAI,SAAUuD,KAAM,gBAAiBE,KAAM,UAC7C,CAAEzD,GAAI,SAAUuD,KAAM,gBAAiBE,KAAM,WAC7C,CAAEzD,GAAI,QAASuD,KAAM,eAAgBE,KAAM,YAC3C,CAAEzD,GAAI,QAASuD,KAAM,eAAgBE,KAAM,WAC3C,CAAEzD,GAAI,WAAYuD,KAAM,mBAAoBE,KAAM,cAClD,CAAEzD,GAAI,SAAUuD,KAAM,mBAAoBE,KAAM,YAChD,CAAEzD,GAAI,WAAYuD,KAAM,mBAAoBE,KAAM,YAClD,CAAEzD,GAAI,UAAWuD,KAAM,sBAAuBE,KAAM,YACpD,CAAEzD,GAAI,SAAUuD,KAAM,gBAAiBE,KAAM,UAC7C,CAAEzD,GAAI,SAAUuD,KAAM,sBAAuBE,KAAM,aACnD,CAAEzD,GAAI,cAAeuD,KAAM,qBAAsBE,KAAM,WACvD,CAAEzD,GAAI,YAAauD,KAAM,mBAAoBE,KAAM,cACnD,CAAEzD,GAAI,mBAAoBuD,KAAM,2BAA4BE,KAAM,UAClE,CAAEzD,GAAI,WAAYuD,KAAM,kBAAmBE,KAAM,gBAInD,IAAI46B,GAAa,KACjB,MAAMhmC,GAAU,KACd,MAAMsf,EAAIvV,OAAOwV,QAAUxV,OAErB7J,EAAI6J,OAAO6V,QAAUN,EAAEM,OAG7B,GAAIomB,IAAcA,GAAW9lC,EAAG,OAAO8lC,GAEvC,MAAMC,EAAO,CACX/lC,EACAkkC,MAAO,IAAM9kB,EAAE4mB,oBAAsBn8B,OAAOm8B,mBAC5CC,UAAW7mB,EAAE8mB,UAAUD,UAEvBE,GACEt8B,OAAOyV,aACPF,EAAEE,aACF,MACE,IACE,OAAOzV,OAAOu8B,IAAMv8B,OAAOu8B,IAAI9mB,YAAc,IAC/C,CAAE,MAAO1jB,GACP,OAAO,IACT,CACD,EAND,IAWJ,OADIoE,IAAG8lC,GAAaC,GACbA,GAGHM,GAAwB,KAC5B,MAAM,GAAQvmC,KACRwmC,EAAOtmC,EAAE,wBACTouB,EAAQkY,EAAKn3B,KAAK,KAClBo3B,EAAYC,KAClB,IAAIC,GAAe,EACnB,GAAIF,EACF,IAAK,MAAMhsC,KAAOgsC,EAChB,GAAIA,EAAUhsC,IAAQgsC,EAAUhsC,GAAKD,OAAS,EAAG,CAC/CmsC,GAAe,EACf,KACF,CAGArD,IAAqBqD,GACvBrY,EAAMzB,SAAS,oBACf2Z,EAAK3Y,KAAK,QAAS,qBAEnBS,EAAM1B,YAAY,oBAClB4Z,EAAK3Y,KAAK,QAAS,MACnB2Y,EAAK/Y,IAAI,QAAS,MAIhBmZ,GAAsB17B,IAC1B,IAAKA,EAAM,MAAO,WAClB,MAAM0P,EAAI1P,EAAK4rB,cACf,OAAIlc,EAAE1Y,SAAS,OAAS0Y,EAAE1Y,SAAS,MAAc,iBAC7C0Y,EAAE1Y,SAAS,OAAS0Y,EAAE1Y,SAAS,MAAc,gBAC7C0Y,EAAE1Y,SAAS,OAAS0Y,EAAE1Y,SAAS,MAAc,eAC7C0Y,EAAE1Y,SAAS,OAAS0Y,EAAE1Y,SAAS,MAAc,YAC7C0Y,EAAE1Y,SAAS,OAAS0Y,EAAE1Y,SAAS,MAAc,kBAC7C0Y,EAAE1Y,SAAS,OAAS0Y,EAAE1Y,SAAS,MAAc,YAC7C0Y,EAAE1Y,SAAS,OAAS0Y,EAAE1Y,SAAS,QAAgB,kBAC/C0Y,EAAE1Y,SAAS,OAAS0Y,EAAE1Y,SAAS,MAAc,iBAC7C0Y,EAAE1Y,SAAS,QAAU0Y,EAAE1Y,SAAS,QAAgB,sBAChD0Y,EAAE1Y,SAAS,SAAW0Y,EAAE1Y,SAAS,OAAS0Y,EAAE1Y,SAAS,MAAc,cACnE0Y,EAAE1Y,SAAS,OAAS0Y,EAAE1Y,SAAS,MAAc,mBAC7C0Y,EAAE1Y,SAAS,MAAc,SACzB0Y,EAAE1Y,SAAS,OAAS0Y,EAAE1Y,SAAS,MAAc,gBAC7C0Y,EAAE1Y,SAAS,MAAc,gBACtB,YAGH2kC,GAAgB9mB,IACpB,IAAKA,EAAM,MAAO,GAClB,MAAMwF,EAAM5lB,OAAOogB,GAAM1f,OACzB,MAAI,aAAakB,KAAKgkB,IAAQ,YAAYhkB,KAAKgkB,GAAa,kBACxDA,EAAI/qB,QAAU,IAAM+qB,EAAIrjB,SAAS,SACjC,CAAC,IAAK,IAAK,IAAK,IAAK,KAAM,MAAMA,SAASqjB,GADO,oBAE9C,IAIHpY,GAAQ,CACZtK,IAAK,CAACpI,EAAKqsC,EAAM,QACf,IACE,OAAO/rC,KAAKC,MAAMT,aAAaU,QAAQR,KAASqsC,CAClD,CAAE,MACA,OAAOA,CACT,GAEF9jC,IAAK,CAACvI,EAAK2F,KACT,IACE7F,aAAa+B,QAAQ7B,EAAKM,KAAKwB,UAAU6D,GAC3C,CAAE,MAAOtE,GAEP,GAAe,uBAAXA,EAAEoP,MAAiCpP,EAAEwO,QAAQpI,SAAS,SAAU,CAClEtG,QAAQG,KAAK,gCACb,IAEExB,aAAaoB,WAAW4H,GAGxBhJ,aAAa+B,QAAQ7B,EAAKM,KAAKwB,UAAU6D,GAC3C,CAAE,MAAO2mC,GAEPnrC,QAAQqK,MAAM,0BAA2B8gC,GACrCh9B,OAAOujB,SAAWvjB,OAAOi9B,mBAC3Bj9B,OAAOujB,OAAO+E,QAAQ,yBACtBtoB,OAAOi9B,kBAAmB,EAC1BrjB,WAAW,IAAO5Z,OAAOi9B,kBAAmB,EAAQ,KAExD,CACF,MACEprC,QAAQqK,MAAM,kBAAmBnK,EAErC,IAIEsxB,GAAoB,IAAMjgB,GAAMtK,IAAIQ,GACpC6pB,GAAqBnoB,GAAKoI,GAAMnK,IAAIK,EAAwB0B,GAC5D2hC,GAAsB,IAAMv5B,GAAMtK,IAAIO,EAA+B,CAAC,GACtE6jC,GAAuBliC,GAAKoI,GAAMnK,IAAII,EAA+B2B,GACrEmiC,GAAqB,IAAM/5B,GAAMtK,IAAIK,GACrCikC,GAAiBpiC,GAAKoI,GAAMnK,IAAIE,EAAyB6B,GACzDqiC,GAAoB,IAAMj6B,GAAMtK,IAAIW,GAA0B,GAC9D6jC,GAAqBtiC,GAAKoI,GAAMnK,IAAIQ,EAA0BuB,GAE9Dm/B,GAAe,KACnB,MAAMppC,EAAOqS,GAAMtK,IAAIU,GACvB,IAAKzI,EAAM,OAAO,KAElB,MAAMwsC,EAAaptC,KAEnB,OAAIY,EAAKysC,YAAczsC,EAAKysC,aAAeD,EAClC,KAEFxsC,GAIH0sC,GAAeziC,IACdA,IAEY,iBAANA,IACTA,EAAEwiC,WAAartC,MAEjBiT,GAAMnK,IAAIO,EAA2BwB,KAIjCksB,GAAkB,IAAM9jB,GAAMtK,IAAIa,EAA2B,CAAC,GAC9DwtB,GAAmBnsB,GAAKoI,GAAMnK,IAAIU,EAA2BqB,GAC7D0iC,GAAiB,IAAMt6B,GAAMtK,IAAIc,EAA0B,CAAC,GAE5D+jC,GAAkB,IAAMv6B,GAAMtK,IAAIe,EAA2B,IAE7D+jC,GAAmB,IAAMx6B,GAAMtK,IAAIgB,EAA4B,IAgB/D+jC,GAAqBnrC,IACzB,MAAMkR,EAAOg6B,KACP7qC,EAAM6Q,EAAK5Q,QAAQN,GAjBDsI,MAkBpBjI,GAAO,EACT6Q,EAAK2E,OAAOxV,EAAK,GAEjB6Q,EAAKhT,KAAK8B,GArBYsI,EAuBN4I,EAvBWR,GAAMnK,IAAIa,EAA4BkB,GAwBnEnJ,QAAQC,IAAI,gCAAiCY,EAAW,YAAaK,EAAM,IAGvE+qC,GAA4BC,IAChC,MAAM1uB,EAAU+F,IAAiBC,KACjC,IAAKhG,EAAS,MAAO,GAErB,MAAM2uB,GAAUD,GAAmC,WAAlBA,GAAuD,KAAzBA,EAAcznC,OAE7E,IAAK,MAAM5F,KAAO2e,EAAS,CACzB,MAAMlC,EAAQkC,EAAQ3e,GACtB,IAAKyc,IAAUA,EAAMhM,OAASgM,EAAM5P,QAAS,SAC7C,MAAM0gC,EAAY9wB,EAAMhM,KAGxB,GACE68B,IACCC,EAAU9lC,SAAS,OAAS8lC,EAAU9lC,SAAS,OAAS8lC,EAAUlR,cAAc50B,SAAS,YAEtFgV,EAAM5P,QAAQ,GAAI,CACpB,MAAM3K,EAAUua,EAAM5P,QAAQ,IAAM,GAC9B5K,EAAMwa,EAAM5P,QAAQ,GAC1B,IAAIkvB,EAAQ,GASZ,GARA75B,EAAQlB,QAAQ,CAACiC,EAAGZ,KAClB,GAAIY,GAAKA,EAAEwE,SAAS,MAAO,CACV8/B,GAAqBtlC,EAAII,IAAQ,IACzCrB,QAAQoyB,IACR2I,EAAMt0B,SAAS2rB,EAAK3iB,OAAOsrB,EAAM77B,KAAKkzB,EAAK3iB,OAEpD,IAEEsrB,EAAMh8B,OAAS,EAAG,OAAOg8B,CAC/B,CAIF,IACGuR,IACAC,EAAU9lC,SAAS,OAClB8lC,EAAU9lC,SAAS,QACnB8lC,EAAU9lC,SAAS,OACnB8lC,EAAUlR,cAAc50B,SAAS,cACnC,CACA,MAAMvF,EAAUua,EAAM5P,QAAQ,IAAM,GAEpC,IAAI2gC,EAAa,EACjB,IAAK,IAAIvqC,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GACEf,EAAQe,KACPf,EAAQe,GAAGwE,SAAS,OAASvF,EAAQe,GAAGwE,SAAS,OAASvF,EAAQe,GAAGo5B,cAAc50B,SAAS,SAC7F,CACA+lC,EAAavqC,EACb,KACF,CAGF,IAAK,IAAIpD,EAAI,EAAGA,EAAI4c,EAAM5P,QAAQ9M,OAAQF,IAAK,CAC7C,MAAMoC,EAAMwa,EAAM5P,QAAQhN,GAC1B,GAAIoC,GAAOA,EAAIurC,KAAgBH,EAAe,CAC5C,IAAItR,EAAQ,GASZ,OARA75B,EAAQlB,QAAQ,CAACiC,EAAGZ,KAClB,GAAIY,GAAKA,EAAEwE,SAAS,MAAO,CACV8/B,GAAqBtlC,EAAII,IAAQ,IACzCrB,QAAQoyB,IACR2I,EAAMt0B,SAAS2rB,EAAK3iB,OAAOsrB,EAAM77B,KAAKkzB,EAAK3iB,OAEpD,IAEKsrB,CACT,CACF,CACF,CACF,CAEA,MAAO,IAGH0R,GAAoB,CAACJ,EAAenhB,KACxC,MAAMvN,EAAU+F,IAAiBC,KACjC,IAAKhG,IAAYuN,EAAU,OAAO,KAElC,MAAMohB,GAAUD,GAAmC,WAAlBA,GAAuD,KAAzBA,EAAcznC,OAE7E,IAAK,MAAM5F,KAAO2e,EAAS,CACzB,MAAMlC,EAAQkC,EAAQ3e,GACtB,IAAKyc,IAAUA,EAAMhM,OAASgM,EAAM5P,QAAS,SAC7C,MAAM0gC,EAAY9wB,EAAMhM,KAGxB,GACE68B,IACCC,EAAU9lC,SAAS,OAAS8lC,EAAU9lC,SAAS,OAAS8lC,EAAUlR,cAAc50B,SAAS,YAEtFgV,EAAM5P,QAAQ,GAAI,CACpB,MAAM3K,EAAUua,EAAM5P,QAAQ,IAAM,GAC9B5K,EAAMwa,EAAM5P,QAAQ,GAC1B,IAAK,IAAIxK,EAAM,EAAGA,EAAMH,EAAQnC,OAAQsC,IAAO,CAC7C,MAAMY,EAAIf,EAAQG,GAClB,GAAIY,GAAKA,EAAEwE,SAAS,MAAO,CACzB,MACMimC,EADSnG,GAAqBtlC,EAAII,IAAQ,IAC3BuS,KAAKwe,GAAQA,EAAK3iB,OAASyb,GAChD,GAAIwhB,EAAO,OAAOA,EAAMhrC,KAC1B,CACF,CACF,CAIF,IACG4qC,IACAC,EAAU9lC,SAAS,OAClB8lC,EAAU9lC,SAAS,QACnB8lC,EAAU9lC,SAAS,OACnB8lC,EAAUlR,cAAc50B,SAAS,cACnC,CACA,MAAMvF,EAAUua,EAAM5P,QAAQ,IAAM,GAEpC,IAAI2gC,EAAa,EACjB,IAAK,IAAIvqC,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GACEf,EAAQe,KACPf,EAAQe,GAAGwE,SAAS,OAASvF,EAAQe,GAAGwE,SAAS,OAASvF,EAAQe,GAAGo5B,cAAc50B,SAAS,SAC7F,CACA+lC,EAAavqC,EACb,KACF,CAGF,IAAK,IAAIpD,EAAI,EAAGA,EAAI4c,EAAM5P,QAAQ9M,OAAQF,IAAK,CAC7C,MAAMoC,EAAMwa,EAAM5P,QAAQhN,GAC1B,GAAIoC,GAAOA,EAAIurC,KAAgBH,EAC7B,IAAK,IAAIhrC,EAAM,EAAGA,EAAMH,EAAQnC,OAAQsC,IAAO,CAC7C,MAAMY,EAAIf,EAAQG,GAClB,GAAIY,GAAKA,EAAEwE,SAAS,MAAO,CACzB,MACMimC,EADSnG,GAAqBtlC,EAAII,IAAQ,IAC3BuS,KAAKwe,GAAQA,EAAK3iB,OAASyb,GAChD,GAAIwhB,EAAO,OAAOA,EAAMhrC,KAC1B,CACF,CAEJ,CACF,CACF,CAEA,OAAO,MAGHirC,GAAiB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAKhDC,GAAmB,KACvB,MAAM95B,EAAS6mB,GAAuBlmB,kBACtC,OAAIX,GAAUA,EAAOwmB,eACZxmB,EAAOwmB,eAAel6B,IAAIgzB,GAAQA,EAAK3iB,MAEzCk9B,IAQHxQ,GAAqB,KACzB,IACE,MAAMrpB,EAAS6mB,GAAuBlmB,kBACtC,GAAIX,EAAQ,CAEV,MAAM+5B,EAAW,IAAIh7B,IAsBrB,OAnBIiB,EAAOwmB,gBAAkB/1B,MAAMqO,QAAQkB,EAAOwmB,iBAChDxmB,EAAOwmB,eAAet5B,QAAQoyB,IAC5B,MAAMlH,EAA2B,iBAATkH,EAAoBA,EAAOA,GAAQA,EAAK3iB,KAC5Dyb,GACF2hB,EAAS93B,IAAImW,KAMfpY,EAAO4mB,mBAAqBn2B,MAAMqO,QAAQkB,EAAO4mB,oBACnD5mB,EAAO4mB,kBAAkB15B,QAAQoyB,IAC/B,MAAMlH,EAA2B,iBAATkH,EAAoBA,EAAOA,GAAQA,EAAK3iB,KAC5Dyb,GACF2hB,EAAS93B,IAAImW,KAKZ3nB,MAAM2rB,KAAK2d,EACpB,CAGA,MAAMC,EAAanT,GAAuBhnB,iBAAmB,GACvDk6B,EAAW,IAAIh7B,IAAIk7B,IAAqB,IA6B9C,OA1BIxpC,MAAMqO,QAAQk7B,IAChBA,EAAW9sC,QAAQ6T,IACZA,IAGDA,EAAEylB,gBAAkB/1B,MAAMqO,QAAQiC,EAAEylB,iBACtCzlB,EAAEylB,eAAet5B,QAAQoyB,IACvB,MAAMlH,EAA2B,iBAATkH,EAAoBA,EAAOA,GAAQA,EAAK3iB,KAC5Dyb,GACF2hB,EAAS93B,IAAImW,KAMfrX,EAAE6lB,mBAAqBn2B,MAAMqO,QAAQiC,EAAE6lB,oBACzC7lB,EAAE6lB,kBAAkB15B,QAAQoyB,IAC1B,MAAMlH,EAA2B,iBAATkH,EAAoBA,EAAOA,GAAQA,EAAK3iB,KAC5Dyb,GACF2hB,EAAS93B,IAAImW,QAOhB3nB,MAAM2rB,KAAK2d,EACpB,CAAE,MAAO/V,GAEP,OADA32B,QAAQqK,MAAM,mCAAoCssB,GAC3CiW,IAAqB,EAC9B,GAIIA,GAAoB,CAExB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KAEA,OACA,OACA,OACA,MACA,SACA,OACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,MACA,KACA,MAGA,MACA,KACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,MACA,MACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,KACA,SACA,KACA,KAGA,KACA,MACA,QACA,MACA,KACA,KACA,KACA,MACA,MACA,MACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,MACA,KACA,QACA,KACA,KACA,KACA,MACA,KACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,MACA,QACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OASIC,GAAwB,CAACC,OAAgBhqC,KAE7C,GAA6B,kBAAlBgqC,EAA6B,CACtC,MAAMC,EAAQD,EACRnP,EAAWF,GAAS/zB,KAAKgyB,MAAMhyB,KAAKsC,SAAWyxB,GAAS,EACxDuP,EAAc,IAAMrP,EAAS,GAAKA,EAAS,GAAKA,EAAS,GAEzDsP,EAAgB,KACpB,GAAIF,EAAO,CACT,MAAMG,EAAOF,IACPG,EAASxP,EAAS,GAAK,EAC7B,OAAOj0B,KAAKC,IAAI,EAAGD,KAAKkH,IAAI,GAAIs8B,EAAOC,GACzC,CAAO,CACL,MAAMD,EAAuB,EAAhBF,IACPG,EAASxP,EAAS,IAAM,EAC9B,OAAOj0B,KAAKC,IAAI,EAAGD,KAAKkH,IAAI,GAAIs8B,EAAOC,GACzC,GAGIx0B,EAAS,CAAC,EAIhB,OAHA6zB,GAAe3sC,QAAQoyB,IACrBtZ,EAAOsZ,GAAQgb,MAEVt0B,CACT,CAGA,MAAMhG,EAASm6B,GAAiBtT,GAAuBlmB,kBAGvD,IAAKX,EAAQ,CACX,MAAMgrB,EAAWF,GAAS/zB,KAAKgyB,MAAMhyB,KAAKsC,SAAWyxB,GAAS,EACxDuP,EAAc,IAAMrP,EAAS,GAAKA,EAAS,GAAKA,EAAS,G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A,GAAyC,OAAfA,EAG7DA,EAAWn8B,WAAW,OACP,SAAfm8B,GACe,MAAfA,GACe,QAAfA,CAEN,CACA,KACF,CAEFmnB,EAAMh7C,IAAIg8C,EAAiB,CACzB9zC,KAAM8zC,EACNp+B,SAAUo+B,IAAoBR,EAC9BE,EAAG,EACHC,EAAG,EACH3G,SAAUiH,GAAe,EAAIlB,EAAc,GAC3Cv/C,SAAUygD,GAAe,EAAIA,OAAcvgD,EAC3Cq4B,UAAWmoB,GAEf,CAGA,MAsLME,EAtLgBC,KACpB,IAAKA,EAAQ,MAAO,GACpB,MAAMv9C,EAAQnC,OAAO0/C,GAClBl6C,MAAM,sCACNtK,IAAI6E,GAAKA,EAAEW,QACX4H,OAAOvI,GAAKA,GAAKA,EAAElF,OAAS,IAGzB8kD,EAAkB,CACtB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,KACA,MACA,KACA,KACA,MAGF,OAAOx9C,EACJjH,IAAIyU,IAIH,MAAMiwC,GAFNjwC,EAAIA,EAAE1P,QAAQ,kBAAmB,IAAIS,QAERqB,MAAM,kBAyCnC,IAHA4N,GAFAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GAHAA,GADAA,GADAA,GAHAA,GADAA,GADAA,GAPEA,EADEiwC,EACEA,EAAmB,GAGnBjwC,EAAE1P,QAAQ,kDAAmD,KAI7DA,QAAQ,0BAA2B,KACnCA,QAAQ,wBAAyB,MACjCA,QAAQ,oBAAqB,KAG7BA,QAAQ,MAAO,KACfA,QAAQ,MAAO,KACfA,QAAQ,MAAO,KAGfA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,qBAAsB,OAC9BA,QAAQ,cAAe,OACvBA,QAAQ,qBAAsB,OAC9BA,QAAQ,eAAgB,OACxBA,QAAQ,eAAgB,OACxBA,QAAQ,iBAAkB,QAC1BA,QAAQ,iBAAkB,QAC1BA,QAAQ,gBAAiB,OACzBA,QAAQ,eAAgB,OACxBA,QAAQ,qBAAsB,SAC9BA,QAAQ,kBAAmB,OAC3BA,QAAQ,qBAAsB,OAE9BS,QAGA7F,OAAS,EAAG,CAEhB,IAAK,MAAMukD,KAAOO,EAChB,GAAIhwC,EAAE0J,SAAS+lC,GACb,OAAOA,EAIX,MAAMS,EAAYlwC,EAAE9T,OAAO,GAC3B,IAAK,MAAMujD,KAAOO,EAChB,GAAIE,EAAUt9C,SAAS68C,GACrB,OAAOA,EAIX,OAAOzvC,EAAE9T,OAAO,EAClB,CAEA,OAAO8T,IAERrH,OAAOvI,GAAKA,GAAKA,EAAElF,OAAS,GAAKkF,EAAElF,QAAU,IAG5BilD,CAAcV,EAAInzC,UACX,IAAzBwzC,EAAc5kD,QAAc4kD,EAAczkD,KAAK,IAGnD,IAAI+kD,EAAezB,EAAM5uC,KACvBvT,GACGA,EAAE4M,SAAW6xC,GAAWz+C,EAAEuhB,SAAW2hC,GACrCljD,EAAE4M,SAAWs2C,GAAmBljD,EAAEuhB,SAAWk9B,GAGlD,GAAKmF,EAWH,GAAIA,EAAah3C,SAAW6xC,EAAS,CAEnC,MAAMoF,EAAW,IAAKD,EAAaE,kBAAoB,MAAQR,GAE/DM,EAAaE,iBAAmB,IAAI,IAAItyC,IAAIqyC,IAAWnkD,MAAM,EAAG,EAClE,KAAO,CAEL,MAAMmkD,EAAW,IAAKD,EAAaG,kBAAoB,MAAQT,GAC/DM,EAAaG,iBAAmB,IAAI,IAAIvyC,IAAIqyC,IAAWnkD,MAAM,EAAG,EAClE,MAlBAyiD,EAAMtjD,KAAK,CACT+N,OAAQ6xC,EACRl9B,OAAQ2hC,EAERY,iBAAkBR,EAAc5jD,MAAM,EAAG,GACzCqkD,iBAAkB,SAkB1B,MAAMC,EAAU9gD,MAAM2rB,KAAKqzB,EAAMzxC,UACjC3Q,QAAQoK,KAAK,sBAAsB85C,EAAQtlD,aAAayjD,EAAMzjD,YAC9D,MAIMulD,EAAkB,IAAI3vC,IAC5B0vC,EAAQrkD,QAAQukD,GAAQD,EAAgB/8C,IAAIg9C,EAAK90C,KAAM,IACvD+yC,EAAMxiD,QAAQwkD,IACZF,EAAgB/8C,IAAIi9C,EAAKv3C,QAASq3C,EAAgBl9C,IAAIo9C,EAAKv3C,SAAW,GAAK,GAC3Eq3C,EAAgB/8C,IAAIi9C,EAAK5iC,QAAS0iC,EAAgBl9C,IAAIo9C,EAAK5iC,SAAW,GAAK,KAI7E,MAAM6iC,EAAen2C,OAAOo2C,YAAc,IACpCC,EAAaF,EAAe,GAAK,GACjCG,EAAYH,EAAe,GAAK,GAChCI,EAAmBJ,EAAe,GAAK,GACvCK,EAAsBL,EAAe,IAAM,IAGjD,IAAIM,EAAqB,EACrBC,GAAgB,EAChBC,GAAmB,EAEvB,MAAMC,EAAgB,CAACC,EAAUhgC,KAC/B,MAAMkoB,EAAOloB,EAAW0/B,EAAmBF,EACrCthC,EAAQihC,EAAgBl9C,IAAI+9C,IAAa,EAG/C,OAFmBt7C,KAAKkH,IAAI6zC,EAAWvX,EAAOxjC,KAAKu7C,KAAK/hC,GAASyhC,GAE7CC,GAItBV,EAAQrkD,QAAQukD,IACdA,EAAKc,OAASH,EAAcX,EAAK90C,KAAM80C,EAAKp/B,YAI9C,MAuCMmgC,EAAoB,IAKjB,mCAJWjB,EACfjlD,IAAI+f,GAAKA,EAAE1P,MACX9P,OACA4G,KAAK,OAmBJg/C,EAAkB,KACtB,IACE,MAAM/rC,EAAW8rC,IACXE,EAAS1mD,aAAaU,QAAQga,GACpC,IAAKgsC,EAAQ,OAAO,EAEpB,MAAMC,EAAanmD,KAAKC,MAAMimD,GAC9B,IAAIE,GAAgB,EAGpB,IAAK,MAAMnB,KAAQF,EACjB,IAAKoB,EAAWlB,EAAK90C,MAAO,CAC1Bi2C,GAAgB,EAChB,KACF,CAGF,QAAIA,IAEFrB,EAAQrkD,QAAQukD,IACd,MAAMiB,EAASC,EAAWlB,EAAK90C,MAC3B+1C,IACFjB,EAAKtB,EAAIuC,EAAOvC,EAChBsB,EAAKrB,EAAIsC,EAAOtC,EAChBqB,EAAKoB,GAAK,EACVpB,EAAKqB,GAAK,MAGP,EAGX,CAAE,MAAOvlD,GAEP,OADAF,QAAQG,KAAK,sBAAuBD,IAC7B,CACT,GAcIwlD,EAAyB,KAE7BxB,EAAQrkD,QAAQukD,IACd,GAAIA,EAAKp/B,SACPo/B,EAAKtB,EAvJK,IAwJVsB,EAAKrB,EAvJC,IAwJNqB,EAAKoB,GAAK,EACVpB,EAAKqB,GAAK,MACL,CAEL,MAAME,EAAwB,EAAhBj8C,KAAKsC,SAAetC,KAAKk8C,GACjCC,EAAO,GAAqB,IAAhBn8C,KAAKsC,SACvBo4C,EAAKtB,EA/JK,IA+JSp5C,KAAKo8C,IAAIH,GAASE,EACrCzB,EAAKrB,EA/JC,IA+Jar5C,KAAKq8C,IAAIJ,GAASE,EACrCzB,EAAKoB,GAAK,EACVpB,EAAKqB,GAAK,CACZ,IAIF,MAAMO,EAAU,IAAIxxC,IACpB0vC,EAAQrkD,QAAQmf,GAAKgnC,EAAQ5+C,IAAI4X,EAAE1P,KAAM0P,IAGzC,IAAK,IAAIinC,EAAO,EAAGA,EAvGF,IAuGqBA,IAAQ,CAE5C,IAAK,IAAIvnD,EAAI,EAAGA,EAAIwlD,EAAQtlD,OAAQF,IAAK,CACvC,MAAMwnD,EAAIhC,EAAQxlD,GAClB,IAAK,IAAIynD,EAAIznD,EAAI,EAAGynD,EAAIjC,EAAQtlD,OAAQunD,IAAK,CAC3C,MAAMh9C,EAAI+6C,EAAQiC,GACZC,EAAKj9C,EAAE25C,EAAIoD,EAAEpD,EACb9tB,EAAK7rB,EAAE45C,EAAImD,EAAEnD,EACnB,IAAIsD,EAASD,EAAKA,EAAKpxB,EAAKA,EACxBqxB,EAAS,IAAGA,EAAS,GAEzB,MAAMR,EAAOn8C,KAAKu7C,KAAKoB,GACjBC,EAvHK,IAuHgBD,EAErBE,EAAMH,EAAKP,EAAQS,EACnBE,EAAMxxB,EAAK6wB,EAAQS,EAEpBJ,EAAElhC,WACLkhC,EAAEV,IAAMe,EACRL,EAAET,IAAMe,GAELr9C,EAAE6b,WACL7b,EAAEq8C,IAAMe,EACRp9C,EAAEs8C,IAAMe,EAEZ,CACF,CAGAnE,EAAMxiD,QAAQwkD,IACZ,MAAM6B,EAAIF,EAAQ/+C,IAAIo9C,EAAKv3C,QACrB3D,EAAI68C,EAAQ/+C,IAAIo9C,EAAK5iC,QAC3B,IAAKykC,IAAM/8C,EAAG,OAEd,MAAMi9C,EAAKj9C,EAAE25C,EAAIoD,EAAEpD,EACb9tB,EAAK7rB,EAAE45C,EAAImD,EAAEnD,EACb8C,EAAOn8C,KAAKu7C,KAAKmB,EAAKA,EAAKpxB,EAAKA,IAAO,EAGvCsxB,EAjJI,KAiJKT,EA/IJ,KAiJLU,EAAMH,EAAKP,EAAQS,EACnBE,EAAMxxB,EAAK6wB,EAAQS,EAEpBJ,EAAElhC,WACLkhC,EAAEV,IAAMe,EACRL,EAAET,IAAMe,GAELr9C,EAAE6b,WACL7b,EAAEq8C,IAAMe,EACRp9C,EAAEs8C,IAAMe,KAKZtC,EAAQrkD,QAAQukD,IACd,GAAIA,EAAKp/B,SAAU,OACnB,MAAMohC,EApOI,IAoOWhC,EAAKtB,EACpB9tB,EApOA,IAoOeovB,EAAKrB,EAC1BqB,EAAKoB,IApKM,IAoKAY,EACXhC,EAAKqB,IArKM,IAqKAzwB,IAKb,MAAMyxB,EAAW,IAAM,EAAIR,EAxKZ,KA0Kf/B,EAAQrkD,QAAQukD,IACd,GAAIA,EAAKp/B,SAAU,OAGnBo/B,EAAKoB,IA5KK,GA6KVpB,EAAKqB,IA7KK,GAgLV,MAAMiB,EAAOh9C,KAAKu7C,KAAKb,EAAKoB,GAAKpB,EAAKoB,GAAKpB,EAAKqB,GAAKrB,EAAKqB,IACtDiB,EAAOD,IACTrC,EAAKoB,GAAMpB,EAAKoB,GAAKkB,EAAQD,EAC7BrC,EAAKqB,GAAMrB,EAAKqB,GAAKiB,EAAQD,GAG/BrC,EAAKtB,GAvLM,GAuLDsB,EAAKoB,GACfpB,EAAKrB,GAxLM,GAwLDqB,EAAKqB,IAEnB,CA1KsB,MACtB,IACE,MAAMpsC,EAAW8rC,IACXG,EAAa,CAAC,EACpBpB,EAAQrkD,QAAQukD,IACdkB,EAAWlB,EAAK90C,MAAQ,CAAEwzC,EAAGsB,EAAKtB,EAAGC,EAAGqB,EAAKrB,KAE/CpkD,aAAa+B,QAAQ2Y,EAAUla,KAAKwB,UAAU2kD,GAChD,CAAE,MAAOplD,GACPF,QAAQG,KAAK,sBAAuBD,EACtC,GAmKAymD,IAIGvB,KAEHM,IAIF,IAAI9gC,EAAQ,EACRgiC,EAAO,EACPC,EAAO,EACX,MAGM3U,EAAU5tC,EAAE,kEACyCkM,EAAOye,qnDAkBQsW,EAAEvD,mSAGFuD,EAAEvD,gSAGJuD,EAAEpD,iSAGFoD,EAAEpD,yoBAapCoD,EAAEzD,2DACIyD,EAAExD,gXAMkBwD,EAAEvD,wIACuBuD,EAAEpD,6DAA6Dz4B,KAAKu0B,MAA2B,IAArB2mB,+JAEzDA,4MAIhErf,EAAEtD,kwCAayGv4B,KAAKu0B,MAA2B,IAArB2mB,ibAMhIl7C,KAAKu0B,MAAc,IAARrZ,iIAO3CtgB,EAAE,QAAQqxB,OAAOuc,GAEjB,MAAM4U,EAAO5U,EAAQz+B,KAAK,kBACpBszC,EAAa7U,EAAQz+B,KAAK,wBAC1BuzC,EAAc9U,EAAQz+B,KAAK,oBAC3BwzC,EAAc/U,EAAQz+B,KAAK,oBAC3ByzC,EAAehV,EAAQz+B,KAAK,qCAC5B0zC,EAAmBjV,EAAQz+B,KAAK,sBAChC2zC,EAAWlV,EAAQz+B,KAAK,6BAExB4zC,EAAkB,KACtBN,EAAW90B,KAAK,YAAa,aAAa20B,MAASC,YAAejiC,MAClEsiC,EAAa/iC,KAAK,GAAGza,KAAKu0B,MAAc,IAARrZ,QAG5B0iC,EAAwB,KACxBH,EAAiBvoD,QACnBuoD,EAAiBhjC,KAAK,GAAGza,KAAKu0B,MAA2B,IAArB2mB,QAIlC2C,EAAS,CAACC,EAAUC,EAAU,IAAKC,EAAU,OACjD,MAAMC,EAAW/iC,EACjBA,EAAQlb,KAAKC,IA3GE,GA2GYD,KAAKkH,IA1GjB,EA0G+B42C,IAC9C,MAAMI,EAAchjC,EAAQ+iC,EAC5Bf,EAAOa,GAAWA,EAAUb,GAAQgB,EACpCf,EAAOa,GAAWA,EAAUb,GAAQe,EACpCP,KAGIQ,EAAStiC,UAEb,MAAMuiC,EA9ViB,MAEvB,IAAKjD,IAAkBC,EAAkB,OAAOZ,EAGhD,IAAI6D,EAAkC,KAStC,OARIjD,IACFiD,EAAc,IAAIr2C,IAAI,CAACkxC,IACvBP,EAAMxiD,QAAQwkD,IACRA,EAAKv3C,SAAW81C,GAAoBmF,EAAanzC,IAAIyvC,EAAK5iC,QAC1D4iC,EAAK5iC,SAAWmhC,GAAoBmF,EAAanzC,IAAIyvC,EAAKv3C,WAI3Do3C,EAAQ73C,OAAO2S,IAEpB,MAAMgpC,GAAenD,GAAiB7lC,EAAEmc,WAAanc,EAAEgG,SAEjDijC,GAAkBnD,GAAoBiD,EAAal2C,IAAImN,EAAE1P,MAE/D,OAAO04C,GAAeC,KA0UFC,GAChBC,EAAoB,IAAIz2C,IAAIo2C,EAAc7oD,IAAI+f,GAAKA,EAAE1P,OAGrD84C,EAAgB/F,EAAMh2C,OAC1Bg4C,GAAQ8D,EAAkBt2C,IAAIwyC,EAAKv3C,SAAWq7C,EAAkBt2C,IAAIwyC,EAAK5iC,SAG3E,IAAI4mC,EAAY,GAChBD,EAAcvoD,QAAQ,CAACwkD,EAAMiE,KAC3B,MAAMx7C,EAASs1C,EAAMn7C,IAAIo9C,EAAKv3C,QACxB2U,EAAS2gC,EAAMn7C,IAAIo9C,EAAK5iC,QAC9B,IAAK3U,IAAW2U,EAAQ,OAGxB,MAAM2kC,EAAK3kC,EAAOqhC,EAAIh2C,EAAOg2C,EACvB9tB,EAAKvT,EAAOshC,EAAIj2C,EAAOi2C,EACvBwF,EAAM7+C,KAAKu7C,KAAKmB,EAAKA,EAAKpxB,EAAKA,IAAO,EACtCwzB,EAAKpC,EAAKmC,EACVE,EAAKzzB,EAAKuzB,EAGVG,GAAMD,EACNE,EAAKH,EAGLI,EACJvE,EAAKL,kBAAoBK,EAAKL,iBAAiBplD,OAAS,GAAKylD,EAAKL,iBAAiB5xC,KAAK6sC,GAAKA,GACzF4J,EACJxE,EAAKJ,kBAAoBI,EAAKJ,iBAAiBrlD,OAAS,GAAKylD,EAAKJ,iBAAiB7xC,KAAK6sC,GAAKA,GAGzF6J,EAAeh8C,EAAOo4C,QAAU,GAChC6D,EAAetnC,EAAOyjC,QAAU,GAEhC8D,EAAKl8C,EAAOg2C,EAAI0F,GAAMM,EADX,IAEXG,EAAKn8C,EAAOi2C,EAAI0F,GAAMK,EAFX,IAGXI,EAAKznC,EAAOqhC,EAAI0F,GAAMO,EAHX,IAIXI,EAAK1nC,EAAOshC,EAAI0F,GAAMM,EAJX,IAOjB,IAAIK,GAAa/E,EAAKL,kBAAoB,IAAI33C,OAAO4yC,GAAKA,GACtDoK,GAAahF,EAAKJ,kBAAoB,IAAI53C,OAAO4yC,GAAKA,GAG1D,MAAMqK,EAAS,IAAI53C,IAAI03C,GACjBG,EAAS,IAAI73C,IAAI23C,GACjBG,EAAe,IAAIF,GAAQj9C,OAAO4yC,GAAKsK,EAAO13C,IAAIotC,IAGlDwK,EAAYL,EAAU/8C,OAAO4yC,IAAMuK,EAAaljD,SAAS24C,IACzDyK,EAAYL,EAAUh9C,OAAO4yC,IAAMuK,EAAaljD,SAAS24C,IAG/D,IAAI0K,EAAc,GACdC,EAAY,GACZhB,IAAegB,EAAY,uBAC3Bf,IAAec,EAAc,yBAEjCtB,GAAa,oCAAoCW,UAAWC,UAAWC,UAAWC,2BACpES,EAAY,eAAeA,KAAe,2BAC1CD,EAAc,iBAAiBA,KAAiB,0CACjCrB,QAG7B,MAAMuB,GAAQ/8C,EAAOg2C,EAAIrhC,EAAOqhC,GAAK,EAC/BgH,GAAQh9C,EAAOi2C,EAAIthC,EAAOshC,GAAK,EAG/BgH,EAAUrgD,KAAKu7C,KAAKmB,EAAKA,EAAKpxB,EAAKA,GAQzC,GALwB4zB,GAAiBC,GAEpBW,EAAa5qD,OAAS,GAA0B,IAArB6qD,EAAU7qD,QAAqC,IAArB8qD,EAAU9qD,OAKlF4qD,EAAa5pD,MAAM,EAAG,GAAGC,QAAQ,CAACmqD,EAAKtrD,KACrC,IAAKsrD,EAAK,OACV,MAAMC,EAAkB,IAANvrD,EAAU,GAAK,EAC3BwrD,EAAa,EAAQ,GAAJxrD,EAGvB2pD,GAAa,yCAFFwB,EAAOnB,EAAKuB,EAAYC,SACxBJ,EAAOnB,EAAKsB,EAAYC,qBACmD5B,MAAYzkD,EAAWmmD,kBAE1G,CAIL,MAAMG,EAAazgD,KAAKC,IAAI,GAAID,KAAKkH,IAAc,IAAVm5C,EAAgB,KAGnDK,EAAmB,CACvB,CACEljC,MAAO,KACPoX,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OAGJ,CACEpX,MAAO,WACPoX,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OAGJ,CACEpX,MAAO,KACPoX,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OAGJ,CACEpX,MAAO,KACPoX,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OAGJ,CAAEpX,MAAO,KAAMoX,SAAU,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,OAC1E,CAAEpX,MAAO,KAAMoX,SAAU,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAAO,OAC/D,CAAEpX,MAAO,KAAMoX,SAAU,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,OAC1E,CAAEpX,MAAO,KAAMoX,SAAU,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,OACpE,CAAEpX,MAAO,KAAMoX,SAAU,CAAC,KAAM,KAAM,KAAM,KAAM,QAI9C+rB,EAAmBL,IACvB,IAAKA,EAAK,MAAO,GACjB,IAAK,MAAM/jB,KAASmkB,EAClB,IAAK,MAAMnqB,KAAMgG,EAAM3H,SACrB,GAAI0rB,EAAI1jD,SAAS25B,GACf,OAAO+pB,EAAM/jB,EAAM/e,MAIzB,OAAO8iC,GAIHM,EAAgB,CAACN,EAAKO,EAAS,KACnC,IAAKP,EAAK,MAAO,GACjB,MAAMQ,EAAYR,EAAIprD,OAAS2rD,EAASP,EAAI3rC,UAAU,EAAGksC,GAAU,KAAOP,EAC1E,OAAOK,EAAiBG,IAe1B,GAXIhB,EAAa5qD,OAAS,GACxB4qD,EAAa5pD,MAAM,EAAG,GAAGC,QAAQ,CAACmqD,EAAKtrD,KACrC,IAAKsrD,EAAK,OAIV3B,GAAa,yCAFFwB,EAAY,EAALnB,SACPoB,EAAY,EAALnB,EAAS,qBAC2DL,MAAYzkD,EAAWymD,EAAcN,EAAK,eAKhIP,EAAU7qD,OAAS,GAAMgqD,IAAkBC,GAAyC,IAAxBW,EAAa5qD,OAAe,CAC1F,MAAM6rD,EAAehB,EAAU7qD,OAAS,EAAI6qD,EAAYL,EAElDsB,EAAab,EAAOrB,EAAK2B,EACzBQ,EAAab,EAAOrB,EAAK0B,EAE/BM,EAAa7qD,MAAM,EAAG,GAAGC,QAAQ,CAACmqD,EAAKtrD,KACrC,IAAKsrD,EAAK,OAEV,MAAMY,EAAkC,IAAd,IAANlsD,EAAU,GAAK,GAGnC2pD,GAAa,yCAFFqC,EAAahC,EAAKkC,SAClBD,EAAahC,EAAKiC,qBACyDtC,MAAYzkD,EAAWymD,EAAcN,EAAK,cAEpI,CAGA,GAAIN,EAAU9qD,OAAS,GAAMiqD,IAAkBD,GAAyC,IAAxBY,EAAa5qD,OAAe,CAC1F,MAAM6rD,EAAef,EAAU9qD,OAAS,EAAI8qD,EAAYL,EAElDqB,EAAab,EAAOrB,EAAK2B,EACzBQ,EAAab,EAAOrB,EAAK0B,EAE/BM,EAAa7qD,MAAM,EAAG,GAAGC,QAAQ,CAACmqD,EAAKtrD,KACrC,IAAKsrD,EAAK,OAEV,MAAMY,EAAkC,IAAd,IAANlsD,GAAW,EAAI,GAGnC2pD,GAAa,yCAFFqC,EAAahC,EAAKkC,SAClBD,EAAahC,EAAKiC,qBACyDtC,MAAYzkD,EAAWymD,EAAcN,EAAK,cAEpI,CACF,IAEFhD,EAAYvxB,KAAK4yB,GAGjB,IAAIwC,EAAY,GAChB,IAAK,MAAMzG,KAAQ0D,EAAe,CAEhC,MAAMgD,QAAmBvmC,GAAcO,SAASs/B,EAAK90C,MAI/Cy7C,GAHW3G,EAAKp/B,SAGgB,IAAdo/B,EAAKc,QACvB8F,EAAgC,IAAd5G,EAAKc,OACvB+F,EAAmB7G,EAAKjpB,UAC1B,mDAAmD6vB,WAAyBA,SAAuBD,kFACnG,GAEEG,EAAkB7mC,GAAwB+/B,EAAK90C,MACrDu7C,GAAa,mFAC2DhnD,EAAWugD,EAAK90C,0BAA0B80C,EAAKhI,UAAY,4BAAyCt5C,IAAlBshD,EAAKxhD,SAAyBwhD,EAAKxhD,SAAW,4BAA4BwhD,EAAKtB,MAAMsB,EAAKrB,4DACvMqB,EAAKc,mCAEpC4F,EACI,MACE,MAAMpmC,EAAUH,GAAciB,WAAW4+B,EAAK90C,MACxCqV,EAAUJ,GAAcmB,WAAW0+B,EAAK90C,MACxC67C,EAAW5mC,GAAcoB,SAASy+B,EAAK90C,MACvCoM,EAA2B,GAAnB0oC,EAAKc,OAAS,GAEtBkG,EAAS1vC,EAAO2vC,EAChBC,EAAWF,EAAS,EAC1B,MAAO,sBAAsBE,UAAiBA,aAAoBF,cAAmBA,sJAExE1vC,iDACCA,mKAGeovC,0DACNK,6DACIzmC,MAAYC,oJAIxC,EApBD,GAqBA,2CAA2C9gB,EAAWqnD,EAAgBpK,OAAO,qCAEjFmK,2DACiC7G,EAAKc,OAAS,OAAOrhD,EAAWqnD,+CAGjF,CACAjE,EAAYxxB,KAAKo1B,IAIbU,EAAgBvG,IACpB8B,EAAK71B,SAAS,gBAGdg2B,EAAYxzC,KAAK,mBAAmBye,KAAK,WACnC5tB,EAAEjG,MAAMa,KAAK,UAAY8lD,GAC3B1gD,EAAEjG,MAAM4yB,SAAS,cAErB,GAGA,MAAMu6B,EAAiB,IAAI95C,IAAI,CAACszC,IAGhC3C,EAAMxiD,QAAQwkD,IACZ,GAAIA,EAAKv3C,SAAWk4C,GAAYX,EAAK5iC,SAAWujC,EAAU,CACxD,MAAMyG,EAAYpH,EAAKv3C,SAAWk4C,EAAWX,EAAK5iC,OAAS4iC,EAAKv3C,OAChE0+C,EAAe52C,IAAI62C,EACrB,IAIFxE,EAAYxzC,KAAK,mBAAmBye,KAAK,WACnCs5B,EAAe35C,IAAIvN,EAAEjG,MAAMa,KAAK,UAClCoF,EAAEjG,MAAM4yB,SAAS,cAErB,GAGA,MAAMy6B,EAAuB,IAAIh6C,IACjC2wC,EAAMxiD,QAAQ,CAACwkD,EAAMnjD,KACfmjD,EAAKv3C,SAAWk4C,GAAYX,EAAK5iC,SAAWujC,GAC9C0G,EAAqB92C,IAAI1T,KAI7B8lD,EAAYvzC,KAAK,mBAAmBye,KAAK,WACvC,MAAMo2B,EAAUvpC,SAASza,EAAEjG,MAAM4zB,KAAK,iBAAkB,IACpDy5B,EAAqB75C,IAAIy2C,KAC3BhkD,EAAEjG,MAAM4yB,SAAS,eACb3sB,EAAEjG,MAAM4zB,KAAK,eACf3tB,EAAEjG,MAAM4zB,KAAK,aAAc,0BAEzB3tB,EAAEjG,MAAM4zB,KAAK,iBACf3tB,EAAEjG,MAAM4zB,KAAK,eAAgB,4BAGnC,GAEA+0B,EAAYvzC,KAAK,yBAAyBye,KAAK,WAC7C,MAAMo2B,EAAUvpC,SAASza,EAAEjG,MAAM4zB,KAAK,iBAAkB,IACpDy5B,EAAqB75C,IAAIy2C,IAC3BhkD,EAAEjG,MAAM4yB,SAAS,cAErB,IAGI06B,EAAiB,KACrB7E,EAAK91B,YAAY,gBACjBi2B,EAAYxzC,KAAK,gBAAgBud,YAAY,eAC7Cg2B,EAAYvzC,KAAK,gBAAgBud,YAAY,eAC7Cg2B,EAAYvzC,KAAK,mBAAmBye,KAAK,WACnC5tB,EAAEjG,MAAM4zB,KAAK,eACf3tB,EAAEjG,MAAM4zB,KAAK,aAAc,uBAEzB3tB,EAAEjG,MAAM4zB,KAAK,iBACf3tB,EAAEjG,MAAM4zB,KAAK,eAAgB,wBAEjC,IAYF,IAPuB9jB,OAAOy9C,WAAW,mBAAmBzlB,QAOzC,CAEjB,IAAI0lB,EAAyB,KAE7B5E,EAAYz2B,GAAG,cAAe,kBAAmB,SAAUtwB,GACzD,MAAM4rD,EAAQxnD,EAAEjG,MACV2mD,EAAW8G,EAAM5sD,KAAK,QACtB6sD,EAAS7rD,EAAE4zB,QACXe,EAAS30B,EAAE6zB,QACX1Z,EAAY7Z,KAAKC,MACvB,IAAIurD,GAAW,EACXC,GAAqB,EAGzB,GAAIJ,EAMF,OALAF,IACAE,EAAyB,KAEzB3rD,EAAEuyB,sBACFvyB,EAAEuwB,kBAKJ,MAAMy7B,EAAiBnkC,WAAW,MAC3BikC,GAAYhH,IACfiH,GAAqB,EACrBJ,EAAyB7G,EACzBuG,EAAcvG,GACVxa,UAAU2hB,SAAS3hB,UAAU2hB,QAAQ,MAE1C,KAgFH7nD,EAAEuG,UAAU2lB,GAAG,yBA9EAuE,IACb,MAAMqxB,EAAK18C,KAAKwqB,IAAIa,EAAMjB,QAAUi4B,GAC9B/2B,EAAKtrB,KAAKwqB,IAAIa,EAAMhB,QAAUc,IAChCuxB,EAAK,GAAKpxB,EAAK,KACjBg3B,GAAW,EACX7jC,aAAa+jC,MA0EjB5nD,EAAEuG,UAAU2lB,GAAG,gDAtEF,KACXlsB,EAAEuG,UAAU0lB,IAAI,wEAChBpI,aAAa+jC,GAEb,MAAM5xC,EAAU9Z,KAAKC,MAAQ4Z,EAG7B,IAAI4xC,IAKAD,GAKA1xC,EAAU,IAAK,CACjB,MAAM0qC,EAAW8G,EAAM5sD,KAAK,QAEtBimB,EAAcZ,GAAca,eAAe4/B,GAC3C5I,EAAW0P,EAAM5sD,KAAK,aAC5B,IAAI0D,EAAWkpD,EAAM5sD,KAAK,aAG1B,IAAKk9C,GAAyB,KAAbx5C,QAAgCE,IAAbF,EAAwB,CAE1D,MAAM4a,EAAU+F,IAAiBC,KACjC,GAAIhG,EACF,IAAK,MAAM3e,KAAO2e,EAAS,CACzB,MAAM4uC,EAAQ5uC,EAAQ3e,GACtB,IAAKutD,GAAO1gD,UAAY0gD,EAAM98C,MAAMhJ,SAAS,OAAQ,SACrD,MACM27C,GADUmK,EAAM1gD,QAAQ,IAAM,IACZ+K,UACtB3U,GAAKA,IAAMA,EAAEwE,SAAS,OAASxE,EAAEwE,SAAS,OAASxE,EAAEwE,SAAS,QAEhE,KAAI27C,EAAU,GACd,IAAK,IAAIvjD,EAAI,EAAGA,EAAI0tD,EAAM1gD,QAAQ9M,OAAQF,IAAK,CAC7C,MAAM2tD,EAAUtoD,OAAOqoD,EAAM1gD,QAAQhN,GAAGujD,IAAY,IAAIx9C,OACxD,GAAI4nD,IAAYlnC,GAAeZ,GAAca,eAAeinC,KAAalnC,EAAa,CAEpF,MAAMmnC,EAAWhoD,EAAE,sEAChBpF,KAAK,YAAaL,GAClBK,KAAK,YAAaR,EAAI,GAIzB,OAHA4F,EAAE,QAAQqxB,OAAO22B,GACjBA,EAASnnD,QAAQ,+BACjBmnD,EAASvmC,QAEX,CACF,CACF,CAMF,YAHI5X,OAAOujB,QACTvjB,OAAOujB,OAAOtnB,KAAK,IAAI+a,WAAsB,GAAI,CAAEujB,QAAS,MAGhE,CAGA,MAAM4jB,EAAWhoD,EAAE,sEAChBpF,KAAK,YAAak9C,GAClBl9C,KAAK,YAAa6f,SAASnc,EAAU,KACxC0B,EAAE,QAAQqxB,OAAO22B,GACjBA,EAASnnD,QAAQ,0BACjBmnD,EAASvmC,QACX,GAKJ,GAGAqhC,EAAS52B,GAAG,wBAAyB,SAAUtwB,GACzC2rD,IAA2BvnD,EAAEpE,EAAEuhB,QAAQkP,QAAQ,mBAAmB/xB,SACpE+sD,IACAE,EAAyB,KAE7B,EACF,MAGE5E,EAAYz2B,GAAG,uBAAwB,kBAAmB,WACxD,MAAMw0B,EAAW1gD,EAAEjG,MAAMa,KAAK,QAC1B8lD,GACFuG,EAAcvG,EAElB,GAEAiC,EAAYz2B,GAAG,uBAAwB,kBAAmB,WACxDm7B,GACF,GAGA1E,EAAYz2B,GAAG,gBAAiB,kBAAmB,SAAUtwB,GAC3DA,EAAEuwB,kBACF,MAAMq7B,EAAQxnD,EAAEjG,MACV2mD,EAAW8G,EAAM5sD,KAAK,QAEtBimB,EAAcZ,GAAca,eAAe4/B,GAC3C5I,EAAW0P,EAAM5sD,KAAK,aAC5B,IAAI0D,EAAWkpD,EAAM5sD,KAAK,aAG1B,IAAKk9C,GAAyB,KAAbx5C,QAAgCE,IAAbF,EAAwB,CAC1D,MAAM4a,EAAU+F,IAAiBC,KACjC,GAAIhG,EACF,IAAK,MAAM3e,KAAO2e,EAAS,CACzB,MAAM4uC,EAAQ5uC,EAAQ3e,GACtB,IAAKutD,GAAO1gD,UAAY0gD,EAAM98C,MAAMhJ,SAAS,OAAQ,SACrD,MACM27C,GADUmK,EAAM1gD,QAAQ,IAAM,IACZ+K,UACtB3U,GAAKA,IAAMA,EAAEwE,SAAS,OAASxE,EAAEwE,SAAS,OAASxE,EAAEwE,SAAS,QAEhE,KAAI27C,EAAU,GACd,IAAK,IAAIvjD,EAAI,EAAGA,EAAI0tD,EAAM1gD,QAAQ9M,OAAQF,IAAK,CAC7C,MAAM2tD,EAAUtoD,OAAOqoD,EAAM1gD,QAAQhN,GAAGujD,IAAY,IAAIx9C,OACxD,GAAI4nD,IAAYlnC,GAAeZ,GAAca,eAAeinC,KAAalnC,EAAa,CACpF,MAAMmnC,EAAWhoD,EAAE,sEAChBpF,KAAK,YAAaL,GAClBK,KAAK,YAAaR,EAAI,GAIzB,OAHA4F,EAAE,QAAQqxB,OAAO22B,GACjBA,EAASnnD,QAAQ,+BACjBmnD,EAASvmC,QAEX,CACF,CACF,CAKF,YAHI5X,OAAOujB,QACTvjB,OAAOujB,OAAOtnB,KAAK,IAAI+a,WAAsB,GAAI,CAAEujB,QAAS,MAGhE,CAGA,MAAM4jB,EAAWhoD,EAAE,sEAChBpF,KAAK,YAAak9C,GAClBl9C,KAAK,YAAa6f,SAASnc,EAAU,KACxC0B,EAAE,QAAQqxB,OAAO22B,GACjBA,EAASnnD,QAAQ,0BACjBmnD,EAASvmC,QACX,GAIF8hC,IAAStxB,KAAK,KACZ8wB,MAIF,IAAIkF,GAAY,EACZC,EAAY,EACdC,EAAY,EACVC,GAAe,EACjBC,GAAe,EACbC,GAAgB,EAChBC,GAAkB,KAEtB,MAAMC,GAAY1F,EAAS,GACrB2F,GAAQjG,EAAK,GAGnBgG,GAAUE,cAAgB,SAAU9sD,GACjB,IAAbA,EAAEq0B,SAEFjwB,EAAEpE,EAAEuhB,QAAQkP,QAAQ,mBAAmB/xB,QAEvC0F,EAAEpE,EAAEuhB,QAAQkP,QAAQ,mCAAmC/xB,SAC3DsB,EAAEuyB,iBACFq6B,GAAUr4B,kBAAkBv0B,EAAEw0B,WAC9Bm4B,GAAkB3sD,EAAEw0B,UACpB63B,GAAY,EACZC,EAAYtsD,EAAE4zB,QACd24B,EAAYvsD,EAAE6zB,QACd24B,GAAe9F,EACf+F,GAAe9F,EACfkG,GAAMhiD,MAAMkiD,OAAS,YACvB,EAGAH,GAAUh4B,cAAgB,SAAU50B,GAClC,IAAKqsD,GAAarsD,EAAEw0B,YAAcm4B,GAAiB,OACnD,MAAMzG,EAAKlmD,EAAE4zB,QAAU04B,EACjBx3B,EAAK90B,EAAE6zB,QAAU04B,EACjBS,EAAOH,GAAMI,wBACnBvG,EAAO8F,GAAgBtG,EAAK8G,EAAKxc,MAAS,IAC1CmW,EAAO8F,GAAgB33B,EAAKk4B,EAAKt4B,OAAU,IAC3CyyB,GACF,EAGAyF,GAAU53B,YAAc,SAAUh1B,GAC5BA,EAAEw0B,YAAcm4B,KAClBC,GAAU13B,sBAAsBl1B,EAAEw0B,WAClC63B,GAAY,EACZM,GAAkB,KAClBE,GAAMhiD,MAAMkiD,OAAS,OAEzB,EAGAH,GAAUM,gBAAkB,SAAUltD,GAChCA,EAAEw0B,YAAcm4B,KAClBN,GAAY,EACZM,GAAkB,KAClBE,GAAMhiD,MAAMkiD,OAAS,OAEzB,EAGAH,GAAUO,QAAU,SAAUntD,GAC5BA,EAAEuyB,iBACF,MAAM66B,EAAQptD,EAAEi0B,OAAS,GAAK,IAAO,IACrCozB,EAAO3iC,EAAQ0oC,EACjB,EAGAR,GAAUn+C,iBACR,aACA,SAAUzO,GACiB,IAArBA,EAAE2zB,QAAQj1B,SACZsB,EAAEuyB,iBACF85B,GAAY,EACZK,GAAgBljD,KAAK6jD,MACnBrtD,EAAE2zB,QAAQ,GAAGC,QAAU5zB,EAAE2zB,QAAQ,GAAGC,QACpC5zB,EAAE2zB,QAAQ,GAAGE,QAAU7zB,EAAE2zB,QAAQ,GAAGE,SAG1C,EACA,CAAEy5B,SAAS,IAGbV,GAAUn+C,iBACR,YACA,SAAUzO,GACR,GAAyB,IAArBA,EAAE2zB,QAAQj1B,OAAc,CAC1BsB,EAAEuyB,iBACF,MAAMg7B,EAAU/jD,KAAK6jD,MACnBrtD,EAAE2zB,QAAQ,GAAGC,QAAU5zB,EAAE2zB,QAAQ,GAAGC,QACpC5zB,EAAE2zB,QAAQ,GAAGE,QAAU7zB,EAAE2zB,QAAQ,GAAGE,SAElC64B,GAAgB,GAClBrF,EAAO3iC,GAAS6oC,EAAUb,KAE5BA,GAAgBa,CAClB,CACF,EACA,CAAED,SAAS,IAGbV,GAAUn+C,iBAAiB,WAAY,SAAUzO,GAC3CA,EAAE2zB,QAAQj1B,OAAS,IAAGguD,GAAgB,EAC5C,GAGA,MAeMc,GAAkBxb,EAAQz+B,KAAK,qBAC/Bk6C,GAAqBzb,EAAQz+B,KAAK,wBAClCm6C,GAAmB1b,EAAQz+B,KAAK,mCAChCo6C,GAA0B3b,EAAQz+B,KAAK,8BAC7By+B,EAAQz+B,KAAK,qBAE7B,IAAIq6C,IAAgB,EAChBC,GAAwD,KAC5D,MAmCMC,GAAa,KACZF,KAEDC,KACF5lC,aAAa4lC,IACbA,GAAkB,MAGpBD,IAAgB,EAChBF,GAAiB78B,SAIbk9B,GAAuB,KACvBF,IACF5lC,aAAa4lC,IAEfA,GAAkBhmC,WAAW,KAC3BimC,MArD2B,MA0D/B9b,EAAQ1hB,GAAG,QAAS,2DAA4D,SAAUtwB,GACxFA,EAAEuwB,kBACEq9B,GACFE,KA1De,MACjB,GAAIF,GAAe,OAGfC,KACF5lC,aAAa4lC,IACbA,GAAkB,MAGpBD,IAAgB,EAIhB,MAAMI,EAAcL,GAAwB,GAAGV,wBACzCgB,EAAc/G,EAAS,GAAG+F,wBAI1BziB,EAAMyjB,EAAYv5B,OADH,GAC2B,GAC1C2b,EAAO2d,EAAY3d,KAAO4d,EAAY5d,KAE5Cqd,GAAiB/7B,IAAI,CACnB7mB,QAAS,QACT0/B,IAAK,GAAGA,MACR6F,KAAM,GAAGA,QAIX0d,MAgCEG,EAEJ,GAGAV,GAAgBl9B,GAAG,6BAA8B,SAAUtwB,GACzDA,EAAEuwB,kBACEq9B,IACFG,IAEJ,GAGAL,GAAiBp9B,GAAG,mCAAoC,SAAUtwB,GAChEA,EAAEuwB,iBACJ,GAGAnsB,EAAEuG,UAAU2lB,GAAG,oBAAqB,SAAUtwB,IAE1C4tD,IACCF,GAAiB/8B,GAAG3wB,EAAEuhB,SACmB,IAA1CmsC,GAAiB/7C,IAAI3R,EAAEuhB,QAAQ7iB,QAC9BivD,GAAwBh9B,GAAG3wB,EAAEuhB,SACmB,IAAjDosC,GAAwBh8C,IAAI3R,EAAEuhB,QAAQ7iB,QAEtCovD,IAEJ,GAEAN,GAAgBl9B,GAAG,QAAS,WAC1Bo0B,EAAqBvnC,WAAW/Y,EAAEjG,MAAMmG,OACxCmpD,GAAmBxpC,KAAKza,KAAKu0B,MAA2B,IAArB2mB,GAA4B,KAC/D0C,IAGApD,EAAQrkD,QAAQukD,IACdA,EAAKc,OAASH,EAAcX,EAAK90C,KAAM80C,EAAKp/B,YAE9C6iC,IAGAoG,IACF,GAGA,MAAMI,GAAoBnc,EAAQz+B,KAAK,oBACjC66C,GAAuBpc,EAAQz+B,KAAK,uBAEpC86C,GAA2B,KAC/BF,GAAkBx8B,IAAI,CACpB9jB,WAAY82C,EAAgBtf,EAAEpD,OAASoD,EAAEtD,MACzCnQ,MAAO+yB,EAAgBtf,EAAE5C,cAAgB4C,EAAElW,SAC3C0C,YAAa8yB,EAAgBtf,EAAEpD,OAASoD,EAAExD,SAE5CusB,GAAqBz8B,IAAI,CACvB9jB,WAAY+2C,EAAmBvf,EAAEpD,OAASoD,EAAEtD,MAC5CnQ,MAAOgzB,EAAmBvf,EAAE5C,cAAgB4C,EAAElW,SAC9C0C,YAAa+yB,EAAmBvf,EAAEpD,OAASoD,EAAExD,UAKjDwsB,KAEAF,GAAkBxd,MAAM,SAAU3wC,GAChCA,EAAEuwB,kBACFo0B,GAAiBA,EACjB0J,KACA1G,GACF,GAEAyG,GAAqBzd,MAAM,SAAU3wC,GACnCA,EAAEuwB,kBACFq0B,GAAoBA,EACpByJ,KACA1G,GACF,GAGA3V,EAAQz+B,KAAK,qBAAqBo9B,MAAM,KAEtCjsB,EAAQ,EACRgiC,EAAO,EACPC,EAAO,EACPQ,IAGAzC,EAAqB,EACrB8I,GAAgBlpD,IAAI,GACpBmpD,GAAmBxpC,KAAK,QACxBmjC,IAGA,MAAMkH,EAAmBtc,EAAQz+B,KAAK,2CAClC+6C,EAAiB5vD,QACnB4vD,EAAiB/6C,KAAK,sBAAsB0Q,KAAK,QAInD+/B,EAAQrkD,QAAQukD,IACdA,EAAKc,OAASH,EAAcX,EAAK90C,KAAM80C,EAAKp/B,YAIzCogC,KAEHM,IAEFmC,MAIF,MAAM2G,GAAmBtc,EAAQz+B,KAAK,2CACtC,GAAI+6C,GAAiB5vD,OAAQ,CAC3B,MAAMgS,EAAMmO,SAASyvC,GAAiBtvD,KAAK,QACrCyK,EAAMoV,SAASyvC,GAAiBtvD,KAAK,QACrC6xC,EAAOhyB,SAASyvC,GAAiBtvD,KAAK,SACtCozB,EAASk8B,GAAiB/6C,KAAK,sBAE/Bg7C,EAAuBC,IAC3BA,EAAahlD,KAAKC,IAAIiH,EAAKlH,KAAKkH,IAAIjH,EAAK+kD,IACzC9J,EAAqB8J,EAAa,IAClCp8B,EAAOnO,KAAK,GAAGuqC,MACfpH,IAGApD,EAAQrkD,QAAQukD,IACdA,EAAKc,OAASH,EAAcX,EAAK90C,KAAM80C,EAAKp/B,YAE9C6iC,KAGI8G,EAAoB,KACxB,MAAMxqC,EAAOmO,EAAOnO,OAAOngB,QAAQ,SAAU,IAC7C,OAAO+a,SAASoF,IAAS,KAG3BqqC,GAAiB/6C,KAAK,oBAAoB+c,GAAG,QAAS,WACpDi+B,EAAoBE,IAAsB5d,EAC5C,GAEAyd,GAAiB/6C,KAAK,oBAAoB+c,GAAG,QAAS,WACpDi+B,EAAoBE,IAAsB5d,EAC5C,EACF,CAGAmB,EAAQz+B,KAAK,mBAAmBo9B,MAAM,KAzpCb,MACvB,IACE,MAAMx3B,EAAW8rC,IACjBxmD,aAAaoB,WAAWsZ,EAC1B,CAAE,MAAOnZ,GACPF,QAAQG,KAAK,sBAAuBD,EACtC,GAqpCA0uD,GAGA1K,EAAQrkD,QAAQukD,IACdA,EAAKc,OAASH,EAAcX,EAAK90C,KAAM80C,EAAKp/B,YAI9C0gC,IACAmC,MAGF3V,EAAQz+B,KAAK,wBAAwBo9B,MAAM,KAEzCge,GAAkB3K,EAAS,KAEzBA,EAAQrkD,QAAQukD,IACdA,EAAKc,OAASH,EAAcX,EAAK90C,KAAM80C,EAAKp/B,YAE9C6iC,QAIJ,MAAMiH,GAAa,KAlQjBhC,GAAUE,cAAgB,KAC1BF,GAAUh4B,cAAgB,KAC1Bg4B,GAAU53B,YAAc,KACxB43B,GAAUM,gBAAkB,KAC5BN,GAAUO,QAAU,KAEhBU,KACF5lC,aAAa4lC,IACbA,GAAkB,MAEpBzpD,EAAEuG,UAAU0lB,IAAI,qBA0PhB2hB,EAAQnsB,UAEVmsB,EAAQz+B,KAAK,oBAAoBo9B,MAAMie,IACvC5c,EAAQ1hB,GAAG,QAAS,SAAUtwB,GACxBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,+BAA+Bg+B,IAC1D,IAMIC,GAAsB,CAACC,EAAa9iB,EAAe1W,KACvD,MAAM,GAAQpxB,KACdE,EAAE,2BAA2ByhB,SAE7B,MAAMvV,EAASklB,KACLxG,KAGV,IAAItK,EAAQ,IACRF,EAAU,GACVC,EAAU,GAGd,MAAMsqC,EAAW1qC,GAAc1B,SAASqpB,GACpC+iB,IACFrqC,EAAQqqC,EAASrqC,OAAS,IAC1BF,EAAUuqC,EAASvqC,SAAW,GAC9BC,EAAUsqC,EAAStqC,SAAW,IAGhC,MAAMuqC,EAAY,8DACqC1+C,EAAOye,0LAGaprB,EAAWqoC,gXAMjC8iB,0DACNpqC,6DACIF,MAAYC,y2BAkBzDwqC,EAAS7qD,EAAE4qD,GACjB5qD,EAAE,QAAQqxB,OAAOw5B,GAGjBA,EAAOt9B,IAAI,CACT8M,SAAU,QACV+L,IAAK,IACL6F,KAAM,IACNC,MAAO,IACPC,OAAQ,IACRC,MAAO,QACP9b,OAAQ,QACR5pB,QAAS,OACT,cAAe,SACf,kBAAmB,SACnB,UAAW,eAGb,MAAMokD,EAASD,EAAO17C,KAAK,mBAErB47C,EADaF,EAAO17C,KAAK,uBACA,GACzB67C,EAAUF,EAAO,GAGjBG,EAAmB,KACvBD,EAAQvkD,MAAMykD,eAAiB,GAAG5qC,KAClC0qC,EAAQvkD,MAAM0kD,mBAAqB,GAAG/qC,MAAYC,MAIpD,IAAI+qC,GAAa,EACb3D,EAAS,EACXl3B,EAAS,EACP86B,EAAe,EACjBC,EAAe,EACb/C,EAAkB,KAEtByC,EAAQ3gD,iBAAiB,cAAezO,IAEd,OAApB2sD,IAEJ3sD,EAAEuyB,iBACFvyB,EAAEuwB,kBAEFi/B,GAAa,EACb7C,EAAkB3sD,EAAEw0B,UACpBq3B,EAAS7rD,EAAE4zB,QACXe,EAAS30B,EAAE6zB,QACX47B,EAAejrC,EACfkrC,EAAejrC,EAEf2qC,EAAQ76B,kBAAkBv0B,EAAEw0B,WAC5B46B,EAAQvkD,MAAMkiD,OAAS,cAGzBqC,EAAQ3gD,iBAAiB,cAAezO,IACtC,IAAKwvD,GAAcxvD,EAAEw0B,YAAcm4B,EAAiB,OAEpD3sD,EAAEuyB,iBACFvyB,EAAEuwB,kBAEF,MAAMwD,EAAS/zB,EAAE4zB,QAAUi4B,EACrB53B,EAASj0B,EAAE6zB,QAAUc,EAGrBg7B,EAAc,IAAMjrC,EAC1BF,EAAUhb,KAAKC,IAAI,EAAGD,KAAKkH,IAAI,IAAK++C,EAAe17B,EAAS47B,IAC5DlrC,EAAUjb,KAAKC,IAAI,EAAGD,KAAKkH,IAAI,IAAKg/C,EAAez7B,EAAS07B,IAC5DN,MAGFD,EAAQ3gD,iBAAiB,YAAazO,IAChCA,EAAEw0B,YAAcm4B,IAEpB6C,GAAa,EACb7C,EAAkB,KAClByC,EAAQl6B,sBAAsBl1B,EAAEw0B,WAChC46B,EAAQvkD,MAAMkiD,OAAS,UAGzBqC,EAAQ3gD,iBAAiB,gBAAiBzO,IACpCA,EAAEw0B,YAAcm4B,IAEpB6C,GAAa,EACb7C,EAAkB,KAClByC,EAAQvkD,MAAMkiD,OAAS,UAKzBoC,EAAY1gD,iBACV,QACAzO,IACEA,EAAEuyB,iBACFvyB,EAAEuwB,kBACF,MAAM68B,EAAQptD,EAAEi0B,OAAS,GAAK,GAAK,GACnCvP,EAAQlb,KAAKC,IAAI,IAAKD,KAAKkH,IAAI,IAAKgU,EAAQ0oC,IAC5CiC,KAEF,CAAE/B,SAAS,IAIb,IAAIZ,EAAgB,EAChBkD,EAAkBlrC,EAEtByqC,EAAY1gD,iBACV,aACAzO,IAC2B,IAArBA,EAAE2zB,QAAQj1B,SACZsB,EAAEuyB,iBACFm6B,EAAgBljD,KAAK6jD,MACnBrtD,EAAE2zB,QAAQ,GAAGC,QAAU5zB,EAAE2zB,QAAQ,GAAGC,QACpC5zB,EAAE2zB,QAAQ,GAAGE,QAAU7zB,EAAE2zB,QAAQ,GAAGE,SAEtC+7B,EAAkBlrC,IAGtB,CAAE4oC,SAAS,IAGb6B,EAAY1gD,iBACV,YACAzO,IACE,GAAyB,IAArBA,EAAE2zB,QAAQj1B,OAAc,CAC1BsB,EAAEuyB,iBACF,MAAMg7B,EAAU/jD,KAAK6jD,MACnBrtD,EAAE2zB,QAAQ,GAAGC,QAAU5zB,EAAE2zB,QAAQ,GAAGC,QACpC5zB,EAAE2zB,QAAQ,GAAGE,QAAU7zB,EAAE2zB,QAAQ,GAAGE,SAEtC,GAAI64B,EAAgB,EAAG,CACrB,MAAMmD,EAAatC,EAAUb,EAC7BhoC,EAAQlb,KAAKC,IAAI,IAAKD,KAAKkH,IAAI,IAAKk/C,EAAkBC,IACtDR,GACF,CACF,GAEF,CAAE/B,SAAS,IAGb6B,EAAY1gD,iBAAiB,WAAYzO,IACnCA,EAAE2zB,QAAQj1B,OAAS,IACrBguD,EAAgB,EAChBkD,EAAkBlrC,KAMtBuqC,EAAO17C,KAAK,wBAAwB+c,GAAG,SAAUjL,eAAgBrlB,GAC/D,MAAM8vD,EAAO9vD,EAAEuhB,OAAOwuC,MAAM,GAC5B,GAAKD,EAEL,GAAKA,EAAK/kD,KAAKnM,WAAW,UAK1B,GAAIkxD,EAAKt0C,KAAO,QACVvN,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,oBAD3C,CAKA,IAGE,SADsBlS,GAAc2rC,gBAAgBhkB,EAAe8jB,GACtD,CAEX,MAAMG,QAAe1vC,GAAcxZ,IAAIilC,GACvC8iB,EAAcmB,EAGdvrC,EAAQ,IACRF,EAAU,GACVC,EAAU,GAGVyqC,EAAOv9B,IAAI,mBAAoB,QAAQs+B,OACvCZ,GACF,CACF,CAAE,MAAO54B,GACP32B,QAAQqK,MAAM,oBAAqBssB,GAC/BxoB,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,OACzC,CAEA/F,EAAEjG,MAAMmG,IAAI,GAxBZ,MAPM2J,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,UAgC7C,GACA04B,EAAO17C,KAAK,qCAAqC+c,GAAG,QAAS,KAC3D2+B,EAAOppC,WAGTopC,EAAO17C,KAAK,qBAAqB+c,GAAG,QAAS,KAC3CgF,EAAO,CAAE5Q,QAAOF,UAASC,YACzBwqC,EAAOppC,WAITopC,EAAO3+B,GAAG,QAAStwB,IACboE,EAAEpE,EAAEuhB,QAAQqP,SAAS,2BACvBq+B,EAAOppC,YAKP8oC,GAAoB,CAAC3K,EAASkM,KAClC,IACE,MAAM,GAAQhsD,KACdE,EAAE,+BAA+ByhB,SAEjC,MAAMvV,EAASklB,KACT6P,EAAIrW,KACJhJ,EAAU3B,GAAc1B,SAGxBwtC,EAAkC/gD,IACtC,IAAKA,EAAM,OAAOA,EAClB,MAAMyV,EAAazB,KACbi/B,EAAc9+B,KAId++B,EADuB,CAAC,SAAU,YACWpwC,KACjDjJ,GAAKmG,IAASnG,GAAKmG,EAAK4rB,gBAAkB/xB,EAAE+xB,eAIxCunB,EAAgBF,GAAejzC,IAASizC,EAGxCG,EAAe,MACnB,IAAK39B,EAAY,OAAO,EAExB,GAAIzV,IAASyV,EAAY,OAAO,EAGhC,OADoBR,GAAca,eAAe9V,KAC1ByV,CACxB,EAPoB,GAUrB,OAAIy9B,GAAyBC,GAAiBC,EACrC,WAIFn+B,GAAca,eAAe9V,IAIhCghD,EAAY/qC,UAChB,IAAIgrC,EAAW,GAGf,MAAMC,EAAWtM,EAAQzwC,KAAKuL,GAER,aADHqxC,EAAgCrxC,EAAE1P,OAG/CmhD,EAAavM,EAAQ73C,OAAO2S,GAEZ,aADHqxC,EAAgCrxC,EAAE1P,OAKrD,GAAIkhD,EAAU,CAEZ,MAAME,EAAqB,IACtBF,EACHlhD,KAAM,YAGFpQ,EAAOgnB,EAAQwqC,EAAmBphD,OAAS,CAAC,EAClD,IAAIqhD,EAAazxD,EAAKqjB,KAAO,GAG7B,MAAMquC,QAAiBrsC,GAAce,eAAeorC,EAAmBphD,MACvE,IAAIuhD,EAAa,GACbC,EAAc,GAEdF,GACFC,QAAmBpwC,GAAcxZ,IAAIypD,EAAmBphD,MACxDwhD,EAAc,8DACLH,IACTE,EAAaF,EACbG,EAAc,6DAGhB,MAAMjsC,GAAW3lB,EAAK2lB,SAAW,IAAIze,KAAK,MACpC2qD,IAAcF,EAEpBN,GAAY,iEACwC1sD,EAAW6sD,EAAmBphD,0BAA0BshD,wBAA+B/sD,EAAWgtD,mIAEnGE,EAAY,YAAc,cAAcA,EAAY,0BAA0BF,6BAAsC3xD,EAAKwlB,SAAW,OAAOxlB,EAAKylB,SAAW,yBAAyBzlB,EAAK0lB,OAAS,QAAU,yCACtOmsC,EAAuI,GAA3H,SAASltD,EAAW6sD,EAAmBphD,KAAKwxC,OAAO,0IAEpEgQ,yNAIiCjtD,EAAW6sD,EAAmBphD,igBAMSzL,EAAW8sD,sHACJ9sD,EAAWghB,gOAKhH,CAGA,IAAK,MAAMu/B,KAAQqM,EAAY,CAC7B,MAAMvxD,EAAOgnB,EAAQk+B,EAAK90C,OAAS,CAAC,EACpC,IAAIqhD,EAAazxD,EAAKqjB,KAAO,GAG7B,MAAMquC,QAAiBrsC,GAAce,eAAe8+B,EAAK90C,MACzD,IAAIuhD,EAAa,GACbC,EAAc,GAEdF,GACFC,QAAmBpwC,GAAcxZ,IAAIm9C,EAAK90C,MAC1CwhD,EAAc,8DACLH,IACTE,EAAaF,EACbG,EAAc,6DAGhB,MAAMjsC,GAAW3lB,EAAK2lB,SAAW,IAAIze,KAAK,MACpC2qD,IAAcF,EAEpBN,GAAY,iEACwC1sD,EAAWugD,EAAK90C,0BAA0BshD,wBAA+B/sD,EAAWgtD,mIAErFE,EAAY,YAAc,cAAcA,EAAY,0BAA0BF,6BAAsC3xD,EAAKwlB,SAAW,OAAOxlB,EAAKylB,SAAW,yBAAyBzlB,EAAK0lB,OAAS,QAAU,yCACtOmsC,EAAyH,GAA7G,SAASltD,EAAWugD,EAAK90C,KAAKwxC,OAAO,0IAEtDgQ,yNAIiCjtD,EAAWugD,EAAK90C,igBAMuBzL,EAAW8sD,sHACJ9sD,EAAWghB,gOAKhH,CAEA,OAAO0rC,GAIHS,EAAc,kEACqCxgD,EAAOye,02BAWKsW,EAAEvD,sTASjEivB,EAAW3sD,EAAE0sD,GACnB1sD,EAAE,QAAQqxB,OAAOs7B,GAGjBX,IAAY/5B,KAAKg6B,IACfU,EAASx9C,KAAK,8BAA8BgiB,KAAK86B,GACjDW,MAIF,MAAMC,EAAc5rC,MAAMjW,IACxB,MAAM6iB,EAAQ8+B,EAASx9C,KAAK,+BAA+BnE,OAC3D,IAAK6iB,EAAMvzB,OAAQ,OAEnB,MAAMM,EAAOqlB,GAAc1B,SAASvT,IAAS,CAAC,EACxCshD,QAAiBrsC,GAAce,eAAehW,GACpD,IAAIuhD,EAAa,GACbC,EAAc,GAEdF,GACFC,QAAmBpwC,GAAcxZ,IAAIqI,GACrCwhD,EAAc,8DACL5xD,EAAKqjB,MACdsuC,EAAa3xD,EAAKqjB,IAClBuuC,EAAc,6DAGhB,MAAMM,EAAWj/B,EAAM1e,KAAK,uBAC5B0e,EAAM1e,KAAK,sBAAsBsS,SAE7B8qC,GACFO,EACGngC,SAAS,aACTY,IAAI,CACH,mBAAoB,QAAQg/B,MAC5B,sBAAuB,GAAG3xD,EAAKwlB,SAAW,OAAOxlB,EAAKylB,SAAW,MACjE,kBAAmB,GAAGzlB,EAAK0lB,OAAS,SAErCnR,KAAK,QACLsS,SACHoM,EAAM1e,KAAK,4BAA4BkiB,OAAOm7B,IAE9CM,EACGpgC,YAAY,aACZa,IAAI,CAAE,mBAAoB,GAAI,sBAAuB,GAAI,kBAAmB,KAC5E4D,KACC,SAAS5xB,EAAWyL,EAAKwxC,OAAO,uEAItC3uB,EAAMF,KAAK,iBAAkB2+B,GAC7Bz+B,EAAMF,KAAK,mBAAoB4+B,IAG3BK,EAAmB,KAEvBD,EAASzgC,GAAG,QAAS,sBAAuBjL,eAAgBrlB,GAC1DA,EAAEuwB,kBACF,MAAM0B,EAAQ7tB,EAAEjG,MAAMsyB,QAAQ,oBACxBrhB,EAAO6iB,EAAMjzB,KAAK,QAClB2xD,EAAa1+B,EAAMF,KAAK,oBAE1B4+B,EAEF9B,GAAoB8B,EAAYvhD,EAAMiW,MAAM5M,IAC1C,MAAMzZ,EAAOqlB,GAAc1B,SAASvT,IAAS,CAAC,EAC9CiV,GAAcnd,IAAIkI,EAAMpQ,EAAKqjB,KAAO,GAAI5J,EAAO+L,QAAS/L,EAAOgM,QAAShM,EAAOiM,MAAO1lB,EAAK2lB,SAAW,UAChGssC,EAAY7hD,GAClB8gD,GAAYA,MAIdj+B,EAAM1e,KAAK,0BAA0Bo9B,OAEzC,GAGAogB,EAASzgC,GAAG,SAAU,yBAA0BjL,eAAgBrlB,GAC9D,MAAM8vD,EAAO9vD,EAAEuhB,OAAOwuC,MAAM,GAC5B,IAAKD,EAAM,OAEX,IAAKA,EAAK/kD,KAAKnM,WAAW,UAExB,YADIqP,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,YAI3C,GAAIu5B,EAAKt0C,KAAO,QAEd,YADIvN,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,iBAI3C,MACMnnB,EADQhL,EAAEjG,MAAMsyB,QAAQ,oBACXzxB,KAAK,QAExB,IAEE,SADsBqlB,GAAc2rC,gBAAgB5gD,EAAM0gD,GAC7C,CACX,MAAMG,QAAe1vC,GAAcxZ,IAAIqI,SACjC6hD,EAAY7hD,GAGlBy/C,GAAoBoB,EAAQ7gD,EAAMiW,MAAM5M,IACtC,MAAMzZ,EAAOqlB,GAAc1B,SAASvT,IAAS,CAAC,EAC9CiV,GAAcnd,IACZkI,EACApQ,EAAKqjB,KAAO,GACZ5J,EAAO+L,QACP/L,EAAOgM,QACPhM,EAAOiM,MACP1lB,EAAK2lB,SAAW,UAEZssC,EAAY7hD,GAClB8gD,GAAYA,KAEhB,CACF,CAAE,MAAOz5B,GACP32B,QAAQqK,MAAM,oBAAqBssB,GAC/BxoB,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,OACzC,CAEA/F,EAAEjG,MAAMmG,IAAI,GACd,GAGAysD,EAASzgC,GAAG,QAAS,uBAAwBjL,iBAC3C,MAAM4M,EAAQ7tB,EAAEjG,MAAMsyB,QAAQ,oBACxBrhB,EAAO6iB,EAAMjzB,KAAK,QAClBqjB,EAAM4P,EAAM1e,KAAK,mBAAmBjP,MAAMC,OAC1C4sD,EAAal/B,EAAM1e,KAAK,uBAAuBjP,MAAMC,OACrDogB,EAAUwsC,EACZA,EACG9nD,MAAM,QACNtK,IAAI6E,GAAKA,EAAEW,QACX4H,OAAOvI,GAAKA,GAAKA,IAAMwL,GAC1B,GAEEpQ,EAAOqlB,GAAc1B,SAASvT,IAAS,CAAC,EAG9CiV,GAAcnd,IAAIkI,EAAMiT,EAAKrjB,EAAKwlB,SAAW,GAAIxlB,EAAKylB,SAAW,GAAIzlB,EAAK0lB,OAAS,IAAKC,GAGxF,MAAM+rC,EAA4C,SAAjCz+B,EAAMF,KAAK,kBACxB1P,IAAQquC,SACJO,EAAY7hD,GAClBy/C,GAAoBxsC,EAAKjT,EAAMiW,MAAM5M,IACnC4L,GAAcnd,IAAIkI,EAAMiT,EAAK5J,EAAO+L,QAAS/L,EAAOgM,QAAShM,EAAOiM,MAAOC,SACrEssC,EAAY7hD,GAClB8gD,GAAYA,cAGRe,EAAY7hD,GAClB8gD,GAAYA,IAEhB,GAGAa,EAASzgC,GAAG,QAAS,wBAAyBjL,iBAC5C,MAAM4M,EAAQ7tB,EAAEjG,MAAMsyB,QAAQ,oBACxBrhB,EAAO6iB,EAAMjzB,KAAK,cAElBqlB,GAAc+sC,kBAAkBhiD,GACtCiV,GAAcwB,OAAOzW,GAErB6iB,EAAM1e,KAAK,mBAAmBjP,IAAI,IAClC2tB,EAAM1e,KAAK,uBAAuBjP,IAAI,UAChC2sD,EAAY7hD,GAClB8gD,GAAYA,GACd,GAGAa,EAASzgC,GAAG,QAAS,yBAA0B,WAC7C,MAAMxK,EAAazB,GAAcyB,aAC3B6T,EAAU16B,KAAKwB,UAAUqlB,EAAY,KAAM,GAC3CjE,EAAO,IAAIwvC,KAAK,CAAC13B,GAAU,CAAE5uB,KAAM,qBACnCsX,EAAMJ,IAAIK,gBAAgBT,GAC1BtiB,EAAIoL,SAAS8C,cAAc,KACjClO,EAAE+xD,KAAOjvC,EACT9iB,EAAEgyD,SAAW,kBAAiB,IAAIjxD,MAAOuT,cAAcnU,MAAM,EAAG,WAChEiL,SAASyD,KAAKC,YAAY9O,GAC1BA,EAAEoxC,QACFhmC,SAASyD,KAAKojD,YAAYjyD,GAC1B0iB,IAAIC,gBAAgBG,EACtB,GAGA0uC,EAASzgC,GAAG,QAAS,yBAA0B,WAC7CygC,EAASx9C,KAAK,0BAA0Bo9B,OAC1C,GAEAogB,EAASzgC,GAAG,SAAU,yBAA0B,SAAUtwB,GACxD,MAAM8vD,EAAO9vD,EAAEuhB,OAAOwuC,MAAM,GAC5B,IAAKD,EAAM,OAEX,MAAM2B,EAAS,IAAIC,WACnBD,EAAOE,OAAS,SAAUC,GACxB,IACE,MAAM1rC,EAAWjnB,KAAKC,MAAM0yD,EAAIrwC,OAAO9I,QACjCo5C,EAAWxtC,GAAcqC,cAAcR,GAE7C,IAAK2rC,EAASlrC,MAEZ,YADI1Y,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM0nD,EAAS1nD,QAIlD2nD,GAAwB5rC,EAAU2rC,EAAU,KAC1Cd,EAASlrC,SACT8oC,GAAkB3K,EAASkM,GAC3BA,GAAYA,KAEhB,CAAE,MAAOz5B,GACP32B,QAAQqK,MAAM,oBAAqBssB,GAC/BxoB,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,SACzC,CACF,EACAsnD,EAAOM,WAAWjC,GAClB1rD,EAAEjG,MAAMmG,IAAI,GACd,IAII0tD,EAAe,IAAMjB,EAASlrC,SACpCkrC,EAASzgC,GAAG,QAAS,oBAAqB0hC,GAC1CjB,EAASzgC,GAAG,QAAS,SAAUtwB,GACzBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,+BAA+BohC,GAC1D,EACF,CAAE,MAAO7nD,GAEP,GADArK,QAAQqK,MAAM,WAAYA,GACtB8D,OAAOujB,OAAQ,CACjB,MAAM1V,EAAW3R,aAAiBwB,MAAQxB,EAAMqE,QAAU,OAC1DP,OAAOujB,OAAOrnB,MAAM,cAAc2R,IACpC,CAEA1X,EAAE,+BAA+ByhB,QACnC,GAIIisC,GAA0B,CAAC5rC,EAAU2rC,EAAUI,KACnD,MAAM,GAAQ/tD,KACdE,EAAE,+BAA+ByhB,SAEjC,MAAMwf,EAAIrW,KACJ1e,EAASklB,KAET08B,EAAeL,EAAS/qC,UAAUpoB,OAAS,EAC3CyzD,EACJN,EAAS/qC,UAAUpoB,OAAS,EACxB,gJAAgJ2mC,EAAEvD,aAAa+vB,EAAS/qC,UAAU/nB,IAAI+f,GAAKnb,EAAWmb,IAAI5Y,KAAK,cAC/M,GAEAksD,EAAa,kEACwC9hD,EAAOye,+cAQT8iC,EAASjrC,gQAITirC,EAAShrC,SAASnoB,sQAIlBmzD,EAAS/qC,UAAUpoB,wLAMtDwzD,EACI,8JAEsD7sB,EAAElW,+HACSkW,EAAEvB,wGAE/DquB,2uBAaJ,kFACiD9sB,EAAElD,yeAcvEkwB,EAAUjuD,EAAEguD,GAClBhuD,EAAE,QAAQqxB,OAAO48B,GAGCA,EAAQ,GAChBxnD,MAAM8C,QAAU,ijBAiB1B,MAAM2kD,EAAc,IAAMD,EAAQxsC,SAElCwsC,EAAQ9+C,KAAK,0BAA0Bo9B,MAAM2hB,GAC7CD,EAAQ/hC,GAAG,QAAS,SAAUtwB,GACxBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,+BAA+B0hC,GAC1D,GAEAD,EAAQ9+C,KAAK,2BAA2Bo9B,MAAM,WAC5C,MAAM4hB,EAA0E,SAA9DF,EAAQ9+C,KAAK,uCAAuCjP,MACtE,IACgB+f,GAAc4B,WAAWC,EAAUqsC,GACjDD,IACAL,GAAcA,GAChB,CAAE,MAAOx7B,GACP32B,QAAQqK,MAAM,kBAAmBssB,GAC7BxoB,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,QAAUssB,EAAIjoB,QACvD,CACF,IAGIgkD,GAAoB,CAAC5xD,EAAKC,EAASF,EAAW+B,EAAUw5C,KAC5D,MAAM,GAAQh4C,KACRoM,EAASklB,KACf,IAAIlY,EAAU+F,IAAiBC,MAAkB8kB,KAE7CqqB,EAAa7xD,EAEb0c,GAAWA,EAAQ4+B,IAAa5+B,EAAQ4+B,IAAW1wC,UAAU9I,EAAW,KAC1E+vD,EAAan1C,EAAQ4+B,IAAW1wC,UAAU9I,EAAW,IAGvD,MAAMgwD,EAAaD,EAChB1zD,IAAI,CAACqd,EAAMpb,KACV,GAAY,IAARA,EAAW,MAAO,GACtB,MAAM0lC,EAAa7lC,EAAQG,IAAQ,KAAKA,IAClCsD,EAAM8X,GAAQ,GAEpB,MAAO,iNAE+GzY,EAAW+iC,qGACjD1lC,uJAC8B2C,EAAWW,0CAG1H4B,KAAK,IAEFysD,EAASvuD,EAAE,uGAEmCkM,EAAOye,mEACNrsB,EAAW,OAAOiB,EAAWhD,6IAE5D+xD,2aAStBtuD,EAAE,QAAQqxB,OAAOk9B,GAGjB,MAAMC,EAAeC,IAEnBA,EAAGhoD,MAAM6pB,OAAS,OAClB,MAAMo+B,EAAgBD,EAAGE,aAAe,EAExCF,EAAGhoD,MAAM6pB,OAASlrB,KAAKkH,IAAIoiD,EADT,KACqC,KACvDD,EAAGhoD,MAAMmoD,UAAYF,EAFH,IAE+B,OAAS,UAI5DG,sBAAsB,KACpBN,EAAOp/C,KAAK,YAAYye,KAAK,WAC3B4gC,EAAaz0D,KACf,KAIFw0D,EAAOp/C,KAAK,YAAY+c,GAAG,QAAS,WAClCsiC,EAAaz0D,KACf,GAGA,MAAMm0D,EAAc,IAAMK,EAAO9sC,SACjC8sC,EAAOp/C,KAAK,oBAAoBo9B,MAAM2hB,GAGtCK,EAAOp/C,KAAK,kBAAkBo9B,MAAMtrB,UAClC,IAAI/H,EAAU+F,IAAiBC,MAAkB8kB,KACjD,GAAI9qB,GAAWA,EAAQ4+B,GAAW,CAChC,MAAMgX,EAAa51C,EAAQ4+B,IAAW1wC,UAAU9I,EAAW,GAC3D,IAAKwwD,EAEH,YADAZ,IAGF,IAAIa,GAAa,EASjB,GARAR,EAAOp/C,KAAK,YAAYye,KAAK,WAC3B,MAAM/uB,EAAS4b,SAASza,EAAEjG,MAAMa,KAAK,QAC/BsrB,EAASlmB,EAAEjG,MAAMmG,MACnBT,OAAOqvD,EAAWjwD,MAAaY,OAAOymB,KACxC6oC,GAAa,EACbD,EAAWjwD,GAAUqnB,EAEzB,GACI6oC,EACF,UACQC,GAAmB91C,GAAS,GAAO,GACzCiU,IACF,CAAE,MAAOvxB,GAGP,YAFAF,QAAQqK,MAAM,kBAAmBnK,EAGnC,CAEJ,CACAsyD,MAEFK,EAAOriC,GAAG,QAAS,SAAUtwB,IAEvBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,qBAKrBxsB,EAAEpE,EAAEuhB,QAAQkP,QAAQ,4CAA4C/xB,SAJlE4zD,GAOJ,IAIF,IAAIe,GAAe,KACnB,MAAM79B,GAAY,KACX69B,KAAcA,GAAe,IAAKpqB,MAAmB53B,GAAMtK,IAAIS,EAAuB,CAAC,KACrF6rD,IAEHC,GAAa/7B,IACjB87B,GAAe,IAAK79B,QAAgB+B,GACpClmB,GAAMnK,IAAIM,EAAuB6rD,IACjCE,GAAkBF,KAGdG,GAAkBC,IACtB,MAAMC,EAAWtrB,KACXurB,EAAU,IAAIniD,IACpB,IAAKkiD,EAAU,OAAOC,EAEtB,IAAK,MAAMn2C,KAAWi2C,EAAa,CACjC,MAAMp0C,EAAWo0C,EAAYj2C,GACvB4B,EAAWs0C,EAASl2C,GAC1B,IAAK6B,IAAaA,EAASjQ,KAAM,SACjC,MAAMzO,EAAY0e,EAASjQ,KAC3B,IAAKgQ,EAAU,CACTC,EAAS7T,SACX6T,EAAS7T,QAAQ7L,QAAQ,CAACiB,EAAKgzD,KACzBA,EAAO,GAAGD,EAAQj/C,IAAI,GAAG/T,SAAiBizD,EAAO,OAGzD,QACF,CACA,MAAMC,EAAUx0C,EAAS7T,SAAW,GAC9BsoD,EAAU10C,EAAS5T,SAAW,GACpCqoD,EAAQl0D,QAAQ,CAACiB,EAAKgzD,KACpB,GAAa,IAATA,EAAY,OAChB,MAAMG,EAASD,EAAQF,GAClBG,EAGHnzD,EAAIjB,QAAQ,CAACyc,EAAM43C,KACjB,GAAa,IAATA,EAAY,OAChB,MAAMC,EAAUF,EAAOC,GACnBnwD,OAAOuY,KAAUvY,OAAOowD,IAAUN,EAAQj/C,IAAI,GAAG/T,KAAaizD,EAAO,KAAKI,OALhFL,EAAQj/C,IAAI,GAAG/T,SAAiBizD,EAAO,MAS7C,CACA,OAAOD,GAGHJ,GAAoBjjD,IACxB,MAAM,GAAQpM,KACRgjD,EAAW9iD,EAAE,gBACb8vD,EAAUlqB,GAAMz2B,KAAK4gD,GAAKA,EAAEtoD,KAAOyE,EAAO+4B,aAAa/kC,KAAO0lC,GAAM,GAAG1lC,IAGvE8vD,EAAYhwD,EAAE,qBAGpB,GAFsBgwD,EAAUp1D,KAAK,aAEfsR,EAAO+4B,WAAY,CACvC+qB,EAAUvuC,SACV,MAAMwuC,EAAa,uvBAWnBjwD,EAAE,QAAQqxB,OAAO,gEACsCnlB,EAAO+4B,qCAC9CgrB,saAIiBH,+EAInC,CAGA,MAAMI,EAAU,CACd,mBAAoB,GAAGhkD,EAAOg5B,cAC9B,kBAAmB,GAAGh5B,EAAOi5B,aAC7B,sBAAuB,GAAGj5B,EAAOy5B,gBAAkB,OACnD,kBAAmBz5B,EAAOq5B,aAGxBud,EAASxoD,SACXwoD,EAASp2B,YAAY,CAAC9vB,EAAKuzD,KAASA,EAAI3uD,MAAM,yBAA2B,IAAIM,KAAK,MAClFghD,EAASn2B,SAAS,aAAazgB,EAAOye,SACtCm4B,EAASv1B,IAAI2iC,IAGf,MAAME,EAAgBpwD,EAAE,mCACpBowD,EAAc91D,SAChB81D,EAAc1jC,YAAY,CAAC9vB,EAAKuzD,KAASA,EAAI3uD,MAAM,yBAA2B,IAAIM,KAAK,MACvFsuD,EAAczjC,SAAS,aAAazgB,EAAOye,SAC3CylC,EAAc7iC,IAAI2iC,KAIhBG,GAAY,KAChB,GAAIxmD,OAAOymD,oBAAsBtwD,EAAE,IAAI1G,YAAoBgB,OAAQ,OACnEuP,OAAOymD,oBAAqB,EAC5B,MAAM,GAAQxwD,KACdE,EAAE,SAAS4tB,KAAK,WACV7zB,KAAK0N,IAAM1N,KAAK0N,GAAGjN,WAAW,SAAWT,KAAK0N,GAAGqR,SAAS,YAAc/e,KAAK0N,KAAO,GAAGnO,YACzF0G,EAAEjG,MAAM0nB,QACZ,GACAzhB,EAAE,IAAI1G,YAAoBmoB,SAC1B,MAAMyf,EAAS,wBACE5nC,k6xLA4uHjB0G,EAAE,QAAQqxB,OAAO6P,IAGbhiB,GAAe,KACnB,MAAM+kB,EAAMnkC,KAAUokC,QACtB,IAAKD,IAAQA,EAAIssB,kBAEf,OADA70D,QAAQG,KAAK,8BACN,KAET,IACE,MAAMjB,EAAOqpC,EAAIssB,oBACjB,GAAI31D,EAAM,CACR,MAAM41D,EAAa7yD,OAAOC,KAAKhD,GAAMmN,OAAOod,GAAKA,EAAE3qB,WAAW,WAAWF,OACzEoB,QAAQoK,KAAK,oBAAoB0qD,SACnC,CACA,OAAO51D,CACT,CAAE,MAAOgB,GAEP,OADAF,QAAQqK,MAAM,kBAAmBnK,GAC1B,IACT,GAGIozD,GAAqB/tC,MAAOvK,EAAW+5C,GAAa,EAAOC,GAAgB,KAC/E,GAAI5tB,GAEF,YADApnC,QAAQG,KAAK,0BAGfH,QAAQoK,KAAK,uBACbg9B,IAAW,EACX,MAAM,GAAQhjC,KACR6wD,EAAW3wD,EAAE,yBAGdywD,GAAcE,EAASr2D,SAC1Bq2D,EAASxhD,KAAK,KAAKud,YAAY,WAAWC,SAAS,sBACnDgkC,EAAS1iB,KAAK,YAAY,IAG5B,IAEE,MAAMhyC,EAAa,CAAC,EAYpB,GAVKya,EAAUk6C,KACV30D,EAAW20D,KAAOl6C,EAAUk6C,KADZ30D,EAAW20D,KAAO,CAAEjqD,KAAM,aAAc2H,QAAS,GAGtE3Q,OAAOC,KAAK8Y,GAAWnb,QAAQ4pB,IACzBA,EAAE3qB,WAAW,YACfyB,EAAWkpB,GAAKzO,EAAUyO,MAK1BurC,EAAe,CACjB,MAAMnqB,EAAYC,KAClB7oC,OAAOC,KAAK2oC,GAAWhrC,QAAQhB,IACzB0B,EAAW1B,IAAQ0B,EAAW1B,GAAK6M,SACrCm/B,EAAUhsC,GACPW,KAAK,CAACC,EAAGC,IAAMA,EAAID,GACnBI,QAAQqB,IACHX,EAAW1B,GAAK6M,QAAQxK,EAAM,IAAIX,EAAW1B,GAAK6M,QAAQgL,OAAOxV,EAAM,EAAG,OAItFmqC,GAAqB,CAAC,EACxB,CAGA,IAAI9yB,EACJ,IACEA,EAAapZ,KAAKwB,UAAUJ,GAE5B,MAAM40D,EAAW,IAAI5D,KAAK,CAACh5C,IAAamD,KAAO,QAC/C,GAAIy5C,EAAW,GACb,MAAM,IAAItpD,MAAM,SAASspD,EAAS/xC,QAAQ,oBAE5CpjB,QAAQoK,KAAK,qBAAqB+qD,EAAS/xC,QAAQ,OACrD,CAAE,MAAOgyC,GAEP,MADAp1D,QAAQqK,MAAM,wBAAyB+qD,GACjC,IAAIvpD,MAAM,YAAYupD,EAAe1mD,SAAW0mD,IACxD,CAGA,MAAM7sB,EAAMnkC,KAAUokC,QACtB,IAAKD,IAAQA,EAAI8sB,kBACf,MAAM,IAAIxpD,MAAM,eAGlB,IAKE,IAAe,UAFM08B,EAAI8sB,kBAAkB98C,GAGzC,MAAM,IAAI1M,MAAM,oBAElB7L,QAAQoK,KAAK,oBACf,CAAE,MAAOkrD,GACPt1D,QAAQqK,MAAM,sBAAuBirD,GAErC,MAAMt5C,EAAWs5C,EAAS5mD,SAAW3K,OAAOuxD,GAC5C,GACEt5C,EAAS1V,SAAS,gCAClB0V,EAAS1V,SAAS,sBAClB0V,EAAS1V,SAAS,aAElB,MAAM,IAAIuF,MAAM,mCAElB,MAAM,IAAIA,MAAM,aAAamQ,IAC/B,CAGAuH,GAAgBhjB,EAChBqrC,GAAarrC,GACbmnC,IAAoB,EACpBH,GAAiB,IAAI71B,IACjBvD,OAAOonD,gBAAgBpnD,OAAOonD,eAAeppD,QACjDnM,QAAQoK,KAAK,0BAER2qD,GACHtjC,IAEJ,CAAE,MAAOvxB,GACP,MAAMwQ,EAAexQ,EAAEwO,SAAW,kBAYlC,MAXA1O,QAAQqK,MAAM,gBAAiB,CAC7BA,MAAOnK,EACPwO,QAASgC,EACT9E,MAAO1L,EAAE0L,QAEPuC,OAAOujB,OACTvjB,OAAOujB,OAAOrnB,MAAMqG,EAAc,OAAQ,CAAEg4B,QAAS,MAErDr6B,MAAM,SAASqC,KAGXxQ,CACR,C,QACEknC,IAAW,EACXpnC,QAAQoK,KAAK,iBACR2qD,GAAcE,EAASr2D,SAC1Bq2D,EAASxhD,KAAK,KAAKud,YAAY,sBAAsBC,SAAS,WAC9DgkC,EAAS1iB,KAAK,YAAY,GAE9B,GAIIvE,GAAezoB,MAAMvK,IACzB,IACE,MAAMza,EAAa,CAAC,EAWpB,IAAIgY,EAVCyC,EAAUk6C,KACV30D,EAAW20D,KAAOl6C,EAAUk6C,KADZ30D,EAAW20D,KAAO,CAAEjqD,KAAM,aAAc2H,QAAS,GAGtE3Q,OAAOC,KAAK8Y,GAAWnb,QAAQ4pB,IACzBA,EAAE3qB,WAAW,YACfyB,EAAWkpB,GAAKzO,EAAUyO,MAM9B,IACElR,EAAapZ,KAAKwB,UAAUJ,GAE5B,MAAM40D,EAAW,IAAI5D,KAAK,CAACh5C,IAAamD,KAAO,QAC/C,GAAIy5C,EAAW,GACb,MAAM,IAAItpD,MAAM,SAASspD,EAAS/xC,QAAQ,mBAE9C,CAAE,MAAOgyC,GAEP,MADAp1D,QAAQqK,MAAM,wBAAyB+qD,GACjC,IAAIvpD,MAAM,YAAYupD,EAAe1mD,SAAW0mD,IACxD,CAEA,MAAM7sB,EAAMnkC,KAAUokC,QACtB,IAAKD,IAAQA,EAAI8sB,kBACf,MAAM,IAAIxpD,MAAM,eAGlB,IAIE,IAAe,UAFM08B,EAAI8sB,kBAAkB98C,GAGzC,MAAM,IAAI1M,MAAM,mBAEpB,CAAE,MAAOypD,GACPt1D,QAAQqK,MAAM,sBAAuBirD,GAErC,MAAMt5C,EAAWs5C,EAAS5mD,SAAW3K,OAAOuxD,GAC5C,GACEt5C,EAAS1V,SAAS,gCAClB0V,EAAS1V,SAAS,sBAClB0V,EAAS1V,SAAS,aAElB,MAAM,IAAIuF,MAAM,mCAElB,MAAM,IAAIA,MAAM,aAAamQ,IAC/B,CAEAuH,GAAgBhjB,CAElB,CAAE,MAAOL,GAGP,MAFAF,QAAQqK,MAAM,gCAAiCnK,GAEzCA,CACR,GAEIm6B,GAAkBvlB,IACtB,MAAM0gD,EAAS,CAAC,EAChB,IAAK1gD,GAAwB,iBAATA,EAAmB,OAAO0gD,EAC9C,IAAK,MAAM93C,KAAW5I,EACpB,GAAIA,EAAK4I,IAAUpO,KAAM,CACvB,MAAMgM,EAAQxG,EAAK4I,GACnB83C,EAAOl6C,EAAMhM,MAAQ,CACnBzQ,IAAK6e,EACL3c,QAASua,EAAM5P,SAAU4P,EAAM5P,QAAQ,IAAW,GAClDkQ,KAAMN,EAAM5P,QAAU4P,EAAM5P,QAAQ9L,MAAM,GAAK,GAC/C61D,WAAYn6C,EAAM5P,SAAW,GAC7BgqD,aAAcp6C,EAAMo6C,cAAgB,CAAC,EACrCC,aAAcr6C,EAAMq6C,cAAgB,CAAC,KAClCr6C,EAEP,CAEF,OAAOk6C,GA+KT,MAAMI,GAAwB,KAC5B,MAAM,GAAQxxD,KACRyuD,EAASvuD,EAAE,wBACjB,IAAKuuD,EAAOj0D,OAAQ,OAEpB,MAAMi3D,EAAahD,EAAOp/C,KAAK,qBAC/B,IAAKoiD,EAAWj3D,OAAQ,OAGxB,MACM62B,EADQ1e,EAA2BlB,cAEtC5W,IAAIkU,IACH,MAAM2iD,EACgB,WAApB3iD,EAAK5D,MAAMtE,KAAoB,WAAiC,UAApBkI,EAAK5D,MAAMtE,KAAmB,WAAa,aACnF8qD,EACgB,WAApB5iD,EAAK5D,MAAMtE,KACP,KACoB,UAApBkI,EAAK5D,MAAMtE,KACTkI,EAAK5D,MAAM8H,YAAYjR,KAAK,KAC5B,GAAG+M,EAAK5D,MAAM8H,YAAYjR,KAAK,QAAQ+M,EAAK5D,MAAM+H,aAAalR,KAAK,OAC5E,MAAO,oDACkC+M,EAAK1K,QAAU,GAAK,6BAA6B5E,EAAWsP,EAAKpH,oEACtDlI,EAAWsP,EAAK5D,MAAMtE,iDAC3C6qD,0HAGQjyD,EAAWsP,EAAK7D,uFACUzL,EAAWkyD,QAAgBlyD,EAAWsP,EAAKqE,qGAExD3T,EAAWsP,EAAKpH,8OAChCoH,EAAK1K,QAAU,SAAW,gEAC/B0K,EAAK1K,QAAU,eAAiB,4GAET5E,EAAWsP,EAAKpH,4FAIvE3F,KAAK,IAGRyvD,EAAWpgC,KAAKA,IAMZugC,GAA6BC,IACjC,MAAM,GAAQ7xD,KAER8xD,EAAoB,aADXxgC,KAC+BzG,QAGxCzR,EAAU+F,IAAiBC,KAC3BgyC,EAASn7B,GAAgB7c,GAAW,CAAC,GACrCnG,EAAapV,OAAOC,KAAKszD,GAEzB3C,EAASvuD,EAAE,iIAEsC4xD,00BAczC7+C,EAAWpY,IAAIqQ,GAAQ,kBAAkBzL,EAAWyL,OAAUzL,EAAWyL,eAAkBlJ,KAAK,47GAwD9FiR,EAAWpY,IAAIqQ,GAAQ,kBAAkBzL,EAAWyL,OAAUzL,EAAWyL,eAAkBlJ,KAAK,kjGA2ChGiR,EAAWpY,IAAIqQ,GAAQ,kBAAkBzL,EAAWyL,OAAUzL,EAAWyL,eAAkBlJ,KAAK,wyFA6ChH9B,EAAE,QAAQqxB,OAAOk9B,GAGjB,MAAMsD,EAAoBC,IACxB,MAAM5xD,EAAM4xD,EAAQ5xD,MACfA,GAAe,KAARA,GAIV4xD,EAAQvkC,IAAI,QAAS,wBACrBukC,EAAQvkC,IAAI,UAAW,OAJvBukC,EAAQvkC,IAAI,QAAS,uBACrBukC,EAAQvkC,IAAI,UAAW,SAQ3BghC,EAAOp/C,KAAK,UAAUye,KAAK,WACzBikC,EAAkB7xD,EAAEjG,OACpBiG,EAAEjG,MAAMmyB,GAAG,SAAU,WACnB2lC,EAAkB7xD,EAAEjG,MACtB,EACF,GAGAw0D,EAAOp/C,KAAK,eAAe+c,GAAG,SAAU,WACtC,MAAM3vB,EAAYyD,EAAEjG,MAAMmG,MACpB6xD,EAAaxD,EAAOp/C,KAAK,gBACzB6iD,EAAqBzD,EAAOp/C,KAAK,8BAIvC,GAHA0iD,EAAkB7xD,EAAEjG,OAGhBi4D,EAAmB13D,OAAS,EAAG,CACjC,MAAM23D,EAAqBD,EAAmB9xD,MAC9C8xD,EAAmBE,QACnBF,EAAmB3gC,OAAO,qCAC1Bte,EACGhL,OAAOiD,GAAQA,IAASzO,GACxBhB,QAAQyP,IACPgnD,EAAmB3gC,OAAO,kBAAkB9xB,EAAWyL,OAAUzL,EAAWyL,iBAG5EinD,GAAsBA,IAAuB11D,GAC/Cy1D,EAAmB9xD,IAAI+xD,GAEzBJ,EAAkBG,EACpB,CAEA,IAAKz1D,IAAc20D,EAAO30D,GAGxB,OAFAw1D,EAAW5gC,KAAK,uCAAuC8c,KAAK,YAAY,QACxE4jB,EAAkBE,GAIpB,MACMznB,GADU4mB,EAAO30D,GAAWE,SAAW,IAE1CsL,OAAO,CAACvK,EAAGpD,IAAMA,EAAI,GAAKoD,GAC1B7C,IAAI6C,GAAK,kBAAkB+B,EAAW/B,OAAO+B,EAAW/B,eACxDsE,KAAK,IAERiwD,EAAW5gC,KAAK,mCAAqCmZ,GAAS2D,KAAK,YAAY,GAC/E4jB,EAAkBE,EACpB,GAGAxD,EAAOp/C,KAAK,kBAAkB+c,GAAG,SAAU,WACzC,MAAMimC,EAAenyD,EAAEjG,MAAMmG,MACvBkyD,EAAgB7D,EAAOp/C,KAAK,mBAGlC,GAFA0iD,EAAkB7xD,EAAEjG,QAEfo4D,IAAiBjB,EAAOiB,GAG3B,OAFAC,EAAcjhC,KAAK,yCAAyC8c,KAAK,YAAY,QAC7E4jB,EAAkBO,GAIpB,MACM9nB,GADU4mB,EAAOiB,GAAc11D,SAAW,IAE7CsL,OAAO,CAACvK,EAAGpD,IAAMA,EAAI,GAAKoD,GAC1B7C,IAAI6C,GAAK,kBAAkB+B,EAAW/B,OAAO+B,EAAW/B,eACxDsE,KAAK,IAERswD,EAAcjhC,KAAKmZ,GAAS2D,KAAK,YAAY,GAC7C4jB,EAAkBO,EACpB,GAGA7D,EAAOp/C,KAAK,cAAc+c,GAAG,SAAU,WACrC,MAAMvlB,EAAO3G,EAAEjG,MAAMmG,MACf6a,EAAWjQ,EAAenE,GAC1B0rD,EAAkC,UAApBt3C,GAAU9P,MAC9B4mD,EAAkB7xD,EAAEjG,OAGpBw0D,EAAOp/C,KAAK,4BAA4Bsd,OACxC8hC,EAAOp/C,KAAK,WAAaxI,GAAM+9B,OAG3B2tB,GAAwB,aAAT1rD,GACjB4nD,EAAOp/C,KAAK,eAAesd,OAC3B8hC,EAAOp/C,KAAK,gBAAgBjP,IAAI,IAAI+tC,KAAK,YAAY,KAErDsgB,EAAOp/C,KAAK,eAAeu1B,OAEvB6pB,EAAOp/C,KAAK,eAAejP,OAC7BquD,EAAOp/C,KAAK,gBAAgB8+B,KAAK,YAAY,GAGnD,GAGAsgB,EAAOp/C,KAAK,sBAAsB+c,GAAG,SAAU,WAE3B,YADAlsB,EAAEjG,MAAMmG,MAExBquD,EAAOp/C,KAAK,uBAAuBu1B,OAEnC6pB,EAAOp/C,KAAK,uBAAuBsd,MAEvC,GAGA,MAAMyhC,EAAc,IAAMK,EAAO9sC,SACjC8sC,EAAOriC,GAAG,QAAS,oCAAqCgiC,GACxDK,EAAOriC,GAAG,QAAS,SAAUtwB,GACvBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,iCAAiC0hC,GAC5D,GAGAK,EAAOp/C,KAAK,kBAAkB+c,GAAG,QAAS,WACxC,MAAMlhB,EAAOujD,EAAOp/C,KAAK,cAAcjP,OAAOC,OACxC4L,EAAcwiD,EAAOp/C,KAAK,eAAejP,MACzC8L,EAAeuiD,EAAOp/C,KAAK,gBAAgBjP,MAC3C+L,EAAWsiD,EAAOp/C,KAAK,cAAcjP,MACrCkM,EAAemiD,EAAOp/C,KAAK,mBAAmBjP,OAAOC,OACrD4a,EAAWjQ,EAAemB,GAC1BomD,EAAkC,UAApBt3C,GAAU9P,MAG9B,IAAKD,EAEH,YADInB,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,YAG3C,IAAKpmB,EAEH,YADIlC,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,YAI3C,KAAMkgC,GAA4B,aAAbpmD,GAA6BD,GAEhD,YADInC,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,WAK3C,MAAMzY,EAAa,CAAC,EACpB,GAAiB,kBAAbzN,QAEG,GAAiB,aAAbA,EAAyB,CAClC,MAAMK,EAAMiiD,EAAOp/C,KAAK,gBAAgBjP,MAClCmF,EAAMkpD,EAAOp/C,KAAK,gBAAgBjP,MAC5B,KAARoM,IAAYoN,EAAWpN,IAAMmO,SAASnO,EAAK,KACnC,KAARjH,IAAYqU,EAAWrU,IAAMoV,SAASpV,EAAK,IACjD,MAAO,GAAiB,aAAb4G,QAEJ,GAAiB,WAAbA,EAAuB,CAChC,MAAMnD,EAAUylD,EAAOp/C,KAAK,gBAAgBjP,OAAOC,OACnD,IAAK2I,EAEH,YADIe,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,aAI3C,IACE,IAAIjd,OAAOpM,EACb,CAAE,MAAOlN,GAEP,YADIiO,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,WAEzC,CACA2T,EAAW5Q,QAAUA,CACvB,MAAO,GAAiB,SAAbmD,EAAqB,CAC9B,MAAMqmD,EAAY/D,EAAOp/C,KAAK,eAAejP,OAAOC,OACpD,IAAKmyD,EAEH,YADIzoD,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,YAG3CzY,EAAWrN,OAASimD,EACjBrtD,MAAM,KACNtK,IAAIkK,GAAKA,EAAE1E,QACX4H,OAAOlD,GAAKA,EACjB,MAAO,GAAiB,YAAboH,EAAwB,CACjC,MAAMK,EAAMiiD,EAAOp/C,KAAK,YAAYjP,MAC9BmF,EAAMkpD,EAAOp/C,KAAK,YAAYjP,MACxB,KAARoM,IAAYoN,EAAWpN,IAAMyM,WAAWzM,IAChC,KAARjH,IAAYqU,EAAWrU,IAAM0T,WAAW1T,GAC9C,MAAO,GAAiB,aAAb4G,EAAyB,CAClC,MAAMM,EAAWgiD,EAAOp/C,KAAK,kBAAkBjP,MACzCqyD,EAAahE,EAAOp/C,KAAK,mBAAmBjP,MAElD,IAAKqM,EAEH,YADI1C,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,YAI3C,MAAMqgC,EAAkB1zD,MAAMqO,QAAQolD,GAAcA,EAAaA,EAAa,CAACA,GAAc,GAC7F,GAA+B,IAA3BC,EAAgBl4D,QAA4C,IAA3Bk4D,EAAgBl4D,SAAiBk4D,EAAgB,GAEpF,YADI3oD,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,iBAI3CzY,EAAWnN,SAAWA,EAEtBmN,EAAWlN,UAAuC,IAA3BgmD,EAAgBl4D,OAAek4D,EAAgB,GAAKA,CAC7E,MAAO,GAAiB,aAAbvmD,EAAyB,CAClC,MAAMQ,EAAY8hD,EAAOp/C,KAAK,sBAAsBjP,MAGpD,GAFAwZ,EAAWjN,UAAYA,GAAa,OAElB,YAAdA,EAAyB,CAC3B,MAAMH,EAAMiiD,EAAOp/C,KAAK,qBAAqBjP,MACvCmF,EAAMkpD,EAAOp/C,KAAK,qBAAqBjP,MACjC,KAARoM,IAAYoN,EAAWhN,SAAWqM,WAAWzM,IACrC,KAARjH,IAAYqU,EAAW/M,SAAWoM,WAAW1T,GACnD,CACF,MAAO,GAAiB,aAAb4G,EAAyB,CAClC,MAAM/R,EAASq0D,EAAOp/C,KAAK,wBAAwBjP,OAAOC,QAAU,GAC9DgM,EAAYoiD,EAAOp/C,KAAK,uBAAuBjP,MAC/CuyD,EAAclE,EAAOp/C,KAAK,8BAA8BjP,OAAOC,QAAU,KAG/E,GAFAuZ,EAAWxf,OAASA,EACpBwf,EAAWvN,UAA0B,KAAdA,EAAmBsO,SAAStO,EAAW,IAAM,EAChE6M,MAAMU,EAAWvN,WAEnB,YADItC,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,gBAGvCsgC,IACF/4C,EAAW+4C,YAAcA,EAE7B,CAGA,MAAM7gD,EAAS,UAAY1V,KAAKC,MAAQ,IAAMiJ,KAAKsC,SAASsJ,SAAS,IAAI2B,OAAO,EAAG,GAG7EvC,EAAU,CACd3I,GAAImK,EACJ5G,KAAMA,EACNa,YAAa,GACbE,YAAaA,EACbC,aAAcqmD,GAA4B,aAAbpmD,EAA0B,GAAKD,EAC5DC,SAAUA,EACVC,OAAQwN,EACRtN,aAAcA,GAAgB2O,GAAU5P,MAAQ,SAChD/E,WAAW,GAGb,GAAI0I,EAAsBkD,cAAc5B,GAAU,CAChD89C,IAGA,MAAMqD,EAAaI,EAAaxiD,KAAK,0BAC/BujD,EAAW,mEACuCnzD,EAAWqS,4DACtBrS,EAAWwb,GAAU/P,MAAQiB,KAAYomD,EAAc,QAAU,0CACnFt3C,GAAU7P,MAAQ,8HAGV3L,EAAWyL,wDACTzL,EAAWwM,KAAesmD,GAA4B,aAAbpmD,EAA0B,QAAU,IAAM1M,EAAWyM,2FAE/EzM,EAAWqS,qRAIXrS,EAAWqS,2FAG/D2/C,EAAWlgC,OAAOqhC,EAEpB,MACM7oD,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,SAE3C,IAMI4sD,GAAoB5sD,IACxB,IAAKA,IAAUA,EAAM8I,KAEnB,YADIhF,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,aAI3C,MAAM,GAAQryB,KAER8xD,EAAoB,aADXxgC,KAC+BzG,QACxC9b,EAAO9I,EAAM8I,KACb5C,EAAWlG,EAAMkG,UAAY4C,EAAK5C,SAClC8O,EAAWjQ,EAAemB,IAAa,CAAEjB,KAAMiB,EAAUf,KAAM,eAC/DmnD,EAAkC,UAApBt3C,GAAU9P,MAGxBiO,EAAU+F,IAAiBC,KAC3B3hB,EAAWymC,KAGjB,IAAKj+B,EAAMuV,UAAYvV,EAAMzH,UAAY,GAAK4a,GAAWnT,EAAMxJ,UAC7D,IAAK,MAAM6c,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASjF,EAAMxJ,UAAW,CAC9C,MAAMC,EAAM0c,EAAQE,GAAShS,UAAUrB,EAAMzH,SAAW,GACpD9B,IACFuJ,EAAMuV,SAAW9e,EAAI,IAAMA,EAAI,IAAM,KAAKuJ,EAAMzH,SAAW,KAE7D,KACF,CAKJ,IAAIs0D,EAAgB,GACpB,IAAKP,GAAe90D,GAAYwI,EAAMxJ,gBAAkCiC,IAArBuH,EAAM+M,WACvD,IAAK,MAAMsG,KAAW7b,EACpB,GAAIA,EAAS6b,IAAUpO,OAASjF,EAAMxJ,UAAW,CAC/C,MACMsC,GADUtB,EAAS6b,GAAShS,UAAU,IAAM,IAC3BvK,QAAQkJ,EAAM+M,YAC/BqI,EAASpV,EAAMzH,SAAW,EAC5BO,GAAU,GAAKtB,EAAS6b,GAAShS,UAAU+T,KAC7Cy3C,EAAgBr1D,EAAS6b,GAAShS,QAAQ+T,GAAQtc,IAAW,IAE/D,KACF,CAIJ,MAAMg0D,EAAqC,KAAlBD,GAAwBnzD,OAAOmzD,KAAmBnzD,OAAOsG,EAAM8R,cAAgB,IAKxG,GAAIw6C,EAEF,YADAS,GAAsB/sD,EAAO8I,EAAM5C,EAAUiN,EAAS3b,EAAUq0D,GASlE,IAAImB,EAAY,GAGdA,GADe,SAAb9mD,GAAuB4C,EAAK3C,QAAQG,QAGhB,aAAbJ,GAA2B4C,EAAK3C,QAAQK,UAAYsC,EAAK3C,QAAQM,WAGpD,YAAbP,GAGa,WAAbA,GAAyB4C,EAAK3C,OAR3B,yJACyD3M,EAAWwG,EAAM8R,cAAgB,kBAoBxG,IAAIm7C,EAAmB,GAEvB,GAAiB,aAAb/mD,EAAyB,CAE3B,MAAMgnD,EAlnBV,SAA2B12D,EAAWuW,EAAYogD,EAAiBh6C,EAASi6C,EAAW,GACrF,MAAMF,EAAW,IAAI7lD,IACrB,IAAK7Q,IAAcuW,IAAeoG,EAAS,MAAO,GAElD,IAAK,MAAME,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASzO,EAAW,CACxC,MAAME,EAAUyc,EAAQE,GAAShS,UAAU,IAAM,GAC3CkQ,EAAO4B,EAAQE,GAAShS,SAAS9L,MAAM,IAAM,GAC7CuD,EAASpC,EAAQI,QAAQiW,GAE3BjU,GAAU,GACZyY,EAAK/b,QAAQ,CAACiB,EAAKI,KACjB,GAAIA,IAAQs2D,EAAiB,CAC3B,MAAMj2D,EAAQT,IAAMqC,GAChB5B,SAAkE,KAAzBwC,OAAOxC,GAAOkD,QACzD8yD,EAAS3iD,IAAI7Q,OAAOxC,GAAOkD,OAE/B,IAGJ,KACF,CAGF,OAAOrB,MAAM2rB,KAAKwoC,GAAU33D,MAAM,EAAG63D,EACvC,CAylBqBC,CAAkBrtD,EAAMxJ,UAAWwJ,EAAM+M,WAAY/M,EAAMzH,SAAU4a,EAAS,GAC3F+5C,EAAS34D,OAAS,IACpB04D,EAAmB,kQAMXC,EACCt4D,IACCuF,GAAO,oEACwCX,EAAWW,wCACxDX,EAAWW,EAAI5F,OAAS,GAAK4F,EAAI6Z,UAAU,EAAG,IAAM,MAAQ7Z,+CAI/D4B,KAAK,sDAKlB,MAAO,GAAiB,SAAbmK,GAAuB4C,EAAK3C,QAAQG,OAAQ,CAGrD2mD,EAAmB,4RADCnkD,EAAK3C,OAAOG,OAQvB1R,IACCuF,GAAO,qDAC2B6F,EAAM8R,eAAiB3X,EAAM,+BAAiC,wCAC9EX,EAAWW,cAAgB6F,EAAM8R,eAAiB3X,EAAM,UAAY,6BACpFX,EAAWW,2CAId4B,KAAK,+CAIhB,MAAO,GAAiB,WAAbmK,GAAyB4C,EAAK3C,QAAQpD,QAAS,CAGxD,IAAI5K,EAAe,KACnB,GAAIgb,GAAWnT,EAAMxJ,UACnB,IAAK,MAAM6c,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASjF,EAAMxJ,UAAW,CAC9C2B,EAAegb,EAAQE,GACvB,KACF,CAGJ,MAAMi6C,EAzyBV,SAA4BvqD,EAASxK,EAAUg1D,EAAiB,GAAIp1D,EAAe,MACjF,IAAK4K,QAAwBtK,IAAbF,GAA0BA,EAAW,EAAG,OAAO,KAE/D,IAKE,MAAMi1D,EAAczqD,EAAQtH,MAAM,mCAElC,GAAI+xD,EAAa,CACf,MAAMr5D,EAASq5D,EAAY,GACrBC,EAAS/4C,SAAS84C,EAAY,GAAI,IAGxC,GAAIr1D,IAAuC,QAAtBA,EAAa8M,MAAwC,SAAtB9M,EAAa8M,MAAkB,CACjF,MAAMvO,EAAUyB,EAAakJ,UAAU,IAAM,GACvCkQ,EAAOpZ,EAAakJ,SAAS9L,MAAM,IAAM,GACzCm4D,EAAYh3D,EAAQI,QAAQ,QAElC,GAAI42D,GAAa,EAAG,CAElB,MAAMC,EAAkB,GACxBp8C,EAAK/b,QAAQiB,IACX,MAAMm3D,EAAYn3D,IAAMi3D,GACxB,GAAIE,GAAkC,iBAAdA,EAAwB,CAC9C,MAAMnyD,EAAQmyD,EAAUnyD,MAAM,IAAI0T,OAAO,IAAIhb,aAC7C,GAAIsH,EAAO,CACT,MAAMgZ,EAAMC,SAASjZ,EAAM,GAAI,IAC1BwX,MAAMwB,IAAMk5C,EAAgBj5D,KAAK+f,EACxC,CACF,IAIF,MAAMo5C,EAASF,EAAgBp5D,OAAS,EAAI8K,KAAKC,OAAOquD,GAAmB,EACrEG,EAAUp0D,OAAOm0D,EAAS,GAAG14C,SAASs4C,EAAQ,KACpD,OAAOt5D,EAAS25D,CAClB,CACF,CAGA,MAAMA,EAAUp0D,OAAOnB,EAAW,GAAG4c,SAASs4C,EAAQ,KACtD,OAAOt5D,EAAS25D,CAClB,CAGA,MAAMC,EAAehrD,EAAQtH,MAAM,wBACnC,GAAIsyD,EAAc,CAChB,MAAMN,EAAS/4C,SAASq5C,EAAa,GAAI,IACzC,OAAOr0D,OAAOnB,EAAW,GAAG4c,SAASs4C,EAAQ,IAC/C,CACF,CAAE,MAAO53D,GACPF,QAAQqK,MAAM,oBAAqBnK,EACrC,CAEA,OAAO,IACT,CAgvB2Bm4D,CAAmBllD,EAAK3C,OAAOpD,QAAS/C,EAAMzH,SAAU,GAAIJ,GACnF80D,EAAmB,gKAGkCzzD,EAAWsP,EAAK3C,OAAOpD,gDAGtEuqD,EACI,sSAKkD9zD,EAAW8zD,2DACzB9zD,EAAW8zD,4DAI/C,4BAIZ,MAAO,GAAiB,YAAbpnD,EAAwB,CAEjC,MAAMK,EAAMuC,EAAK3C,QAAQI,IACnBjH,EAAMwJ,EAAK3C,QAAQ7G,IACnB2uD,EAAaj7C,WAAWhT,EAAM8R,cAC9Bo8C,GACHj7C,MAAMg7C,UAAyBx1D,IAAR8N,GAAqB0nD,EAAa1nD,QAAiB9N,IAAR6G,GAAqB2uD,EAAa3uD,GACjG6uD,EAAeD,EA1qBzB,SAA+Bp8C,EAAcvL,EAAKjH,GAChD,MAAMmV,EAAMzB,WAAWlB,GACvB,OAAImB,MAAMwB,QAAqBhc,IAAR8N,EAAoBA,EAAM,OACrC9N,IAAR8N,GAAqBkO,EAAMlO,EAAYA,OAC/B9N,IAAR6G,GAAqBmV,EAAMnV,EAAYA,EACpCmV,CACT,CAoqBwC25C,CAAsBpuD,EAAM8R,aAAcvL,EAAKjH,GAAO,KAE1F2tD,EAAmB,kKAGuCx0D,IAAR8N,EAAoBA,EAAM,eAAkB9N,IAAR6G,EAAoBA,EAAM,qCAG1G4uD,GAAiC,OAAjBC,EACZ,gHAEkDA,oEACJA,2DAI9C,4BAIZ,MAAO,GAAiB,aAAbjoD,GAA2B4C,EAAK3C,QAAQK,UAAYsC,EAAK3C,QAAQM,UAAW,CAErF,MAAM89B,EAhyBV,SAA4B/9B,EAAUgmD,EAAYr5C,GAChD,MAAMoxB,EAAU,IAAIl9B,IACpB,IAAKb,IAAagmD,IAAer5C,EAAS,OAAOpa,MAAM2rB,KAAK6f,GAE5D,MAAMjxB,EAAUva,MAAMqO,QAAQolD,GAAcA,EAAa,CAACA,GAG1D,IAAK,MAAMn5C,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASuB,EAAU,CACvC,MAAM9P,EAAUyc,EAAQE,GAAShS,UAAU,IAAM,GAC3CkQ,EAAO4B,EAAQE,GAAShS,SAAS9L,MAAM,IAAM,GAGnD+d,EAAQ9d,QAAQ+d,IACd,MAAMza,EAASpC,EAAQI,QAAQyc,GAC3Bza,GAAU,GACZyY,EAAK/b,QAAQiB,IACX,MAAMS,EAAQT,IAAMqC,GAChB5B,SAAkE,KAAzBwC,OAAOxC,GAAOkD,QACzDmqC,EAAQh6B,IAAI7Q,OAAOxC,GAAOkD,YAMlC,KACF,CAGF,OAAOrB,MAAM2rB,KAAK6f,GAASpvC,MAC7B,CAkwBoBk5D,CAAmBvlD,EAAK3C,OAAOK,SAAUsC,EAAK3C,OAAOM,UAAW0M,GAC1Eq5C,EAAazzD,MAAMqO,QAAQ0B,EAAK3C,OAAOM,WAAaqC,EAAK3C,OAAOM,UAAY,CAACqC,EAAK3C,OAAOM,WACzF6nD,EAAqB9B,EAAWj4D,OAAS,EACzCg6D,EAAsB70D,OAAOsG,EAAM8R,cAAgB,IAAI1X,OACvDo0D,EAnwBV,SAAgCt3D,EAAOsP,EAAUgmD,EAAYr5C,GAC3D,KAAKjc,GAAUsP,GAAagmD,GAAer5C,GAAS,OAAO,EAC3D,GAA6B,KAAzBzZ,OAAOxC,GAAOkD,OAAe,OAAO,EAExC,MAAMkZ,EAAUva,MAAMqO,QAAQolD,GAAcA,EAAa,CAACA,GACpD35C,EAASnZ,OAAOxC,GAAOkD,OAG7B,IAAK,MAAMiZ,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASuB,EAAU,CACvC,MAAM9P,EAAUyc,EAAQE,GAAShS,UAAU,IAAM,GAC3CkQ,EAAO4B,EAAQE,GAAShS,SAAS9L,MAAM,IAAM,GAGnD,IAAK,MAAMge,KAAOD,EAAS,CACzB,MAAMxa,EAASpC,EAAQI,QAAQyc,GAC/B,IAAgB,IAAZza,EAGJ,IAAK,IAAIzE,EAAI,EAAGA,EAAIkd,EAAKhd,OAAQF,IAAK,CACpC,MAAMo6D,EAAYl9C,EAAKld,KAAKyE,GAC5B,GAAI21D,SAAiD/0D,OAAO+0D,GAAWr0D,SAAWyY,EAChF,OAAO,CAEX,CACF,CAEA,KACF,CAGF,OAAO,CACT,CAmuBwB67C,CAClBH,EACAzlD,EAAK3C,OAAOK,SACZsC,EAAK3C,OAAOM,UACZ0M,GAIF,IAAIw7C,EAAc,GACdpqB,EAAQhwC,OAAS,IACnBo6D,EAAc,4GAE8Bn1D,EAAWsP,EAAK3C,OAAOK,mBAAmB+9B,EAAQhwC,yKAGxFgwC,EACC3vC,IACCuF,GAAO,qDAC2B6F,EAAM8R,eAAiB3X,EAAM,+BAAiC,wCAC9EX,EAAWW,cAAgB6F,EAAM8R,eAAiB3X,EAAM,UAAY,6BACpFX,EAAWW,2CAId4B,KAAK,mCAMd,IAAI6yD,EAAmB,GACnBL,IAAwBC,IAGxBI,EAFEN,EAEiB,mdAOT9B,EAAW53D,IAAI2e,GAAO,kBAAkB/Z,EAAW+Z,OAAS/Z,EAAW+Z,eAAiBxX,KAAK,wMAGzDvC,EAAW+0D,EAAoBh6D,OAAS,GAAKg6D,EAAoBv6C,UAAU,EAAG,IAAM,MAAQu6C,YAA8B/0D,EAAWsP,EAAK3C,OAAOK,8FAO5K,ibAM2EhN,EAAWgzD,EAAW,oFACtEhzD,EAAW+0D,EAAoBh6D,OAAS,GAAKg6D,EAAoBv6C,UAAU,EAAG,IAAM,MAAQu6C,YAA8B/0D,EAAWsP,EAAK3C,OAAOK,aAAahN,EAAWgzD,EAAW,0FAQlOmC,GAAeC,KACjB3B,EAAmB,gEAEb0B,kBACAC,gCAIV,MAAO,GAAiB,aAAb1oD,EAAyB,CAElC,MAAMQ,EAAYoC,EAAK3C,QAAQO,WAAa,OACtCC,EAAWmC,EAAK3C,QAAQQ,SACxBC,EAAWkC,EAAK3C,QAAQS,SAG9B,IAAIgN,EAAiBla,OAAOsG,EAAM8R,cAAgB,IAClD8B,EAAiBA,EAAeja,QAAQ,KAAM,KAAKA,QAAQ,KAAM,KAAKA,QAAQ,KAAM,KAAKA,QAAQ,OAAQ,IAGzG,MAAMka,EAAQD,EAAe1U,MAAM,KAAK8C,OAAOqH,GAAKA,EAAEjP,QAChDy0D,EAAS,GACTC,EAAa,GAEnB,IAAK,MAAMh7C,KAAQD,EAAO,CACxB,MAAME,EAAaD,EAAKhd,QAAQ,KAChC,IAAoB,IAAhBid,GAAoC,IAAfA,GAAoBA,IAAeD,EAAKvf,OAAS,EAAG,CAC3Es6D,EAAOn6D,KAAK,CAAEof,OAAM9T,MAAO,oBAC3B,QACF,CAEA,MAAMxL,EAAMsf,EAAKE,UAAU,EAAGD,GACxB5Z,EAAM2Z,EAAKE,UAAUD,EAAa,GAExC,IAAKvf,IAAQ2F,EAAK,CAChB00D,EAAOn6D,KAAK,CAAEof,OAAM9T,MAAO,YAC3B,QACF,CAEA,IAAI+uD,EAAW50D,EACX60D,GAAW,EAEf,GAAkB,YAAdtoD,EAAyB,CAC3B,MAAMoM,EAASE,WAAW7Y,GACtB8Y,MAAMH,IACR+7C,EAAOn6D,KAAK,CAAEof,OAAM9T,MAAO,IAAI7F,cAC/B60D,GAAW,GAEProD,SAA+CmM,EAASnM,GAC1DooD,EAAWr1D,OAAOiN,GAClBkoD,EAAOn6D,KAAK,CAAEof,OAAM9T,MAAO,MAAM8S,WAAgBnM,MACjDqoD,GAAW,GACFpoD,SAA+CkM,EAASlM,IACjEmoD,EAAWr1D,OAAOkN,GAClBioD,EAAOn6D,KAAK,CAAEof,OAAM9T,MAAO,MAAM8S,WAAgBlM,MACjDooD,GAAW,EAGjB,CAEAF,EAAWp6D,KAAK,CAAEF,MAAK2F,IAAK40D,EAAUE,YAAa90D,EAAK60D,YAC1D,CAGA,MAAME,EAAaJ,EAAWl6D,IAAIyU,GAAK,GAAGA,EAAE7U,OAAO6U,EAAElP,OAAO4B,KAAK,KAC3DozD,EAAYN,EAAOt6D,OAAS,GAAKu6D,EAAW/mD,KAAKsB,GAAKA,EAAE2lD,UAE9D,IAAII,EAAa,GACbD,IACFC,EAAa,mOAKPP,EACCj6D,IACCy6D,GAAS,iOAE4C71D,EAAW61D,EAAMv7C,WAAWta,EAAW61D,EAAMrvD,8CAInGjE,KAAK,oBACN+yD,EACC9sD,OAAOqH,GAAKA,EAAE2lD,UACdp6D,IACCyU,GAAK,kOAEiD7P,EAAW6P,EAAE7U,QAAQgF,EAAW6P,EAAE4lD,kBAAkBz1D,EAAW6P,EAAElP,4CAIxH4B,KAAK,mCAKdkxD,EAAmB,6MAMC,YAAdvmD,EACI,iJAEuDjO,IAAbkO,EAAyBA,EAAW,eAAuBlO,IAAbmO,EAAyBA,EAAW,uCAG5H,iBAEJwoD,gBAEAD,EACI,gHAEkD31D,EAAW01D,wYAMhB11D,EAAW01D,4CAGxD,gRAQZ,CAGA,MAAM1G,EAASvuD,EAAE,iIAEsC4xD,6EACbryD,EAAWwG,EAAMxJ,WAAa,SAASgD,EAAWwG,EAAM+M,YAAc,yRAK/EiI,EAAS7P,qCACtB3L,EAAWwG,EAAMwV,UAAY1M,EAAK7D,MAAQ,wFAEbzL,EAAWwG,EAAMqG,cAAgByC,EAAKzC,cAAgB2O,EAAS5P,MAAQ,oFAK9G0nD,EACI,sQAK+BtzD,EAAWqzD,4IAI1C,6HAMF7sD,EAAMuV,UAAYvV,EAAMzH,UAAY,EAChC,sNACuDiB,EAAWwG,EAAMuV,kCAExE,iJAKJy3C,yEAKFC,EACI,gFAEAA,wCAGA,8LAKJH,EAAmB,6HAA+H,6LAO5J7yD,EAAE,QAAQqxB,OAAOk9B,GAGjBA,EAAOriC,GAAG,QAAS,kDAAmD,WAEpE,GAA2B,gCAAvBlsB,EAAEjG,MAAM4zB,KAAK,MAAyC,OAC1D,GAAI3tB,EAAEjG,MAAMyyB,SAAS,gCAAiC,OACtD,MAAM6oC,EAAcr1D,EAAEjG,MAAMa,KAAK,UAAYoF,EAAEjG,MAAM8lB,OAAO1f,OAC5DouD,EAAOp/C,KAAK,oBAAoBjP,IAAIm1D,GAAax0D,QAAQ,QAC3D,GAGA0tD,EAAOriC,GAAG,QAAS,+BAAgCjL,iBACjD,MAAMqzC,EAAsB70D,OAAOsG,EAAM8R,cAAgB,IAAI1X,OAC7D,IAAKm0D,EAEH,YADIzqD,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,WAK3C,IAAInmB,EACJ,GAAiB,aAAbC,GAA2B4C,EAAK3C,QAAQM,UAA5C,CAAuD,CACrD,MAAM+lD,EAAazzD,MAAMqO,QAAQ0B,EAAK3C,OAAOM,WAAaqC,EAAK3C,OAAOM,UAAY,CAACqC,EAAK3C,OAAOM,WAG7FR,EAFEumD,EAAWj4D,OAAS,EAEPi0D,EAAOp/C,KAAK,6BAA6BjP,MAGzCF,EAAEjG,MAAMa,KAAK,WAAa23D,EAAW,EAExD,CAKA,GAAKvmD,GAAiB6C,EAAK3C,QAAQK,SAKnC,IACE,MAAM2M,EAAU+F,IAAiBC,KACjC,IAAI/F,EAAW,KACXm8C,EAAa,KAGjB,IAAK,MAAMl8C,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAAS6D,EAAK3C,OAAOK,SAAU,CACnD4M,EAAWD,EAAQE,GACnBk8C,EAAal8C,EACb,KACF,CAGF,IAAKD,IAAaA,EAAS/R,QAEzB,YADIyC,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,WAAW8I,EAAK3C,OAAOK,cAIhE,MAAM9P,EAAU0c,EAAS/R,QAAQ,IAAM,GACjCmuD,EAAe94D,EAAQI,QAAQmP,GAErC,IAAsB,IAAlBupD,EAEF,YADI1rD,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,aAAaiG,OAKtD,MAAMvN,EAAS,IAAIK,MAAMrC,EAAQnC,QAAQyE,KAAK,IAC9CN,EAAO82D,GAAgBjB,EAGvBn7C,EAAS/R,QAAQ3M,KAAKgE,SAGhBuwD,GAAmB91C,GAAS,GAAO,GAGzCg1C,IACA/gC,IACF,CAAE,MAAOvxB,GACPF,QAAQqK,MAAM,oBAAqBnK,GAC/BiO,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,YAAcnK,EAAEwO,SAAW,QACpE,MA/CMP,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,YAHzC,MAFM8D,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,UAqD3C,GAGAwoD,EAAOriC,GAAG,QAAS,oBAAqB,WACtCqiC,EAAOp/C,KAAK,oBAAoBjP,IAAI0yD,EACtC,GAGA,MAAM1E,EAAc,IAAMK,EAAO9sC,SACjC8sC,EAAOriC,GAAG,QAAS,sCAAuCgiC,GAC1DK,EAAOriC,GAAG,QAAS,SAAUtwB,GACvBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,iCAAiC0hC,GAC5D,GAGAK,EAAOp/C,KAAK,sBAAsB+c,GAAG,QAASjL,iBAC5C,MAAMrL,EAAW24C,EAAOp/C,KAAK,oBAAoBjP,OAAOC,QAAU,GAElE,GAAiB,KAAbyV,GAAgC,aAAb3J,EAMvB,IACE,MAAMiN,EAAU+F,IAAiBC,KACjC,IAAIiD,GAAU,EAEd,IAAK,MAAM/I,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASjF,EAAMxJ,UAAW,CAC9C,MAAMya,EAAQkC,EAAQE,GAChB3c,EAAUua,EAAM5P,UAAU,IAAM,GAEtC,GAAIrB,EAAMzH,UAAY,GAAKyH,EAAM+M,WAAY,CAC3C,MAAMjU,EAASpC,EAAQI,QAAQkJ,EAAM+M,YAC/BqI,EAASpV,EAAMzH,SAAW,EAEhC,GAAIO,GAAU,GAAKmY,EAAM5P,SAAW4P,EAAM5P,QAAQ+T,GAAS,CACzDnE,EAAM5P,QAAQ+T,GAAQtc,GAAU+W,EAChCuM,GAAU,EACV,KACF,CACF,CACF,CAGEA,SACI6sC,GAAmB91C,GAAS,GAAO,GACzCg1C,IACA/gC,MAEItjB,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,YAE3C,CAAE,MAAOnK,GACPF,QAAQqK,MAAM,qBAAsBnK,GAChCiO,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,UAAYnK,EAAEwO,SAAW,QAClE,MArCMP,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,WAsC7C,IASF,SAASqjC,GAAsBx+C,EAAOlE,EAAY5Y,GAChD,IAAK8c,IAAUA,EAAM5P,SAAW4P,EAAM5P,QAAQ9M,OAAS,EACrD,MAAO,CAAEm7D,MAAO,IAAIvlD,IAAOwlD,SAAU,IAAItoD,IAAOuoD,WAAY,IAAIzlD,KAGlE,MAAMzT,EAAUua,EAAM5P,QAAQ,IAAM,GAC9BkQ,EAAON,EAAM5P,QAAQ9L,MAAM,IAAM,GACjCic,EAAW9a,EAAQI,QAAQiW,GAEjC,GAAIyE,EAAW,EACb,MAAO,CAAEk+C,MAAO,IAAIvlD,IAAOwlD,SAAU,IAAItoD,IAAOuoD,WAAY,IAAIzlD,KAGlE,MAAMulD,EAAQ,IAAIvlD,IACZwlD,EAAW,IAAItoD,IACfuoD,EAAa,IAAIzlD,IAEvB,IAAK,IAAI9V,EAAI,EAAGA,EAAIkd,EAAKhd,OAAQF,IAAK,CACpC,MAAM6C,EAAQqa,EAAKld,KAAKmd,GACxB,GAAIta,SAAmD,KAAVA,EAAc,SAE3D,MAAMiZ,EAAWzW,OAAOxC,GAAOkD,OAC/B,IAAK+V,EAAU,SAGf,IAAI0/C,GAAU,EACd,GAAI17D,EAAQ,CACIgc,EAAS1U,MAAM,IAAI0T,OAAO,IAAIhb,EAAOwF,QAAQ,sBAAuB,qBAEhFk2D,GAAU,EAEd,KAAO,CACL,MAAMp7C,EAAMC,SAASvE,EAAU,IAC1B8C,MAAMwB,KACTo7C,GAAU,EAEd,CAEIA,IACFF,EAASplD,IAAI4F,GACRy/C,EAAWpoD,IAAI2I,IAClBy/C,EAAW7yD,IAAIoT,EAAU,IAE3By/C,EAAWhzD,IAAIuT,GAAUzb,KAAKL,GAElC,CAEA,MAAO,CAAEq7D,QAAOC,WAAUC,aAC5B,CAGA,SAASE,GAAiBC,EAAQC,EAAQ77D,EAAQiS,GAEhD,MAAM6pD,EAAiB,IAAI5oD,IAAI,IAAI0oD,KAAWC,IAGxCE,EAAc,GACpB,IAAK,MAAMC,KAAQF,EAAgB,CACjC,IAAIx7C,EAAM,KACV,GAAItgB,EAAQ,CACV,MAAMsH,EAAQ00D,EAAK10D,MAAM,IAAI0T,OAAO,IAAIhb,EAAOwF,QAAQ,sBAAuB,mBAC1E8B,IACFgZ,EAAMC,SAASjZ,EAAM,GAAI,IAE7B,MACEgZ,EAAMC,SAASy7C,EAAM,IAGlBl9C,MAAMwB,IACTy7C,EAAYx7D,KAAK,CAAEy7D,OAAM17C,OAE7B,CAGAy7C,EAAY/6D,KAAK,CAACC,EAAGC,IAAMD,EAAEqf,IAAMpf,EAAEof,KAGrC,MAAM27C,EAAU,IAAIjmD,IACpB,IAAK,IAAI9V,EAAI,EAAGA,EAAI67D,EAAY37D,OAAQF,IAAK,CAC3C,MAAMg8D,EAAUH,EAAY77D,GAAG87D,KAEzBG,EAAUn8D,EAASuF,OADV0M,EAAY/R,GACa8gB,SAAS,EAAG,KACpDi7C,EAAQrzD,IAAIszD,EAASC,EACvB,CAEA,OAAOF,CACT,CAOA,SAASG,GACPC,EACAC,EACAC,EACAC,EACA5jD,EACAqjD,EACAj8D,EACAiS,EACA+M,GAEA,IAAKq9C,IAAgBE,EAAa,MAAO,CAAEE,YAAa,EAAGC,YAAa,GAExE,MAAMC,EAAWN,EAAYnvD,QAAQ,IAAM,GACrC0vD,EAAQP,EAAYnvD,QAAQ9L,MAAM,IAAM,GACxCy7D,EAAYF,EAASh6D,QAAQiW,GAE7BkkD,EAAWP,EAAYrvD,QAAQ,IAAM,GACrC6vD,EAAQR,EAAYrvD,QAAQ9L,MAAM,IAAM,GACxC47D,EAAYF,EAASn6D,QAAQiW,GAEnC,GAAIikD,EAAY,GAAKG,EAAY,EAAG,MAAO,CAAEP,YAAa,EAAGC,YAAa,GAE1E,IAAID,EAAc,EACdC,EAAc,EAGlB,MAAMO,EAAiB,IAAIjnD,IAC3B,IAAK,MAAOkmD,EAASC,KAAYF,EAAQ53D,UACvC44D,EAAer0D,IAAIuzD,EAASD,GAI9B,MAAMgB,EAAiBt4D,MAAM2rB,KAAK0rC,EAAQ9pD,UAAUnR,KAAK,CAACC,EAAGC,IAC9Cqf,SAAStf,EAAEuE,QAAQxF,EAAQ,IAAK,IAChCugB,SAASrf,EAAEsE,QAAQxF,EAAQ,IAAK,KAKzCm9D,EAAe,CAAC//C,EAAMC,KAC1B,MAAM+/C,EAAW,GACXC,EAAY,GAElB,IAAK,IAAIn9D,EAAI,EAAGA,EAAIkd,EAAKhd,OAAQF,IAAK,CACpC,MAAM6C,EAAQqa,EAAKld,KAAKmd,GAClBrB,EAAWjZ,QAAwC,GAAKwC,OAAOxC,GAAOkD,OAG5E,IAAIy1D,GAAU,EACd,GAAI1/C,GAAYhc,EAAQ,CACRgc,EAAS1U,MAAM,IAAI0T,OAAO,IAAIhb,EAAOwF,QAAQ,sBAAuB,qBACvEk2D,GAAU,EACvB,MAAO,GAAI1/C,EAAU,CACnB,MAAMsE,EAAMC,SAASvE,EAAU,IAC1B8C,MAAMwB,KAAMo7C,GAAU,EAC7B,CAEIA,EACF0B,EAAS78D,KAAK,CAAE6D,SAAUlE,EAAGg8D,QAASlgD,EAAU1Z,IAAK8a,EAAKld,KAE1Dm9D,EAAU98D,KAAK,CAAE6D,SAAUlE,EAAGoC,IAAK8a,EAAKld,GAAIo9D,YAAa,KAAMC,YAAa,MAEhF,CAGA,IAAK,MAAMC,KAAYH,EAAW,CAChC,IAAII,EAAW,KACXC,EAAW,KAEf,IAAK,MAAMC,KAAWP,EAIpB,GAHIO,EAAQv5D,SAAWo5D,EAASp5D,WAC9Bq5D,EAAWE,EAAQzB,SAEjByB,EAAQv5D,SAAWo5D,EAASp5D,UAAyB,OAAbs5D,EAAmB,CAC7DA,EAAWC,EAAQzB,QACnB,KACF,CAGFsB,EAASF,YAAcG,EACvBD,EAASD,YAAcG,CACzB,CAEA,MAAO,CAAEN,WAAUC,cAGfO,EAAYT,EAAaP,EAAOC,GAChCgB,EAAYV,EAAaJ,EAAOC,GAGhCc,EAAe,CAACvK,EAAUhxD,EAAS8a,EAAU0gD,KACjD,MAAMxI,EAAU,GACVyI,EAAa,IAAIhoD,IAGvB,IAAK,MAAMioD,KAAM1K,EAAS6J,SACxBY,EAAWp1D,IAAIq1D,EAAG/B,QAAS+B,EAAG37D,KAIhC,IAAK,MAAM65D,KAAWe,EAAgB,CACpC,MAAMhB,EAAUe,EAAex0D,IAAI0zD,GAEnC,GAAI6B,EAAW3qD,IAAI6oD,GAAU,CAE3B,MACM33D,EADSy5D,EAAWv1D,IAAIyzD,GACRz7D,IAAIqd,GAAQA,GAClCvZ,EAAO8Y,GAAY8+C,EACnB5G,EAAQh1D,KAAK,CAAE47D,UAAS75D,IAAKiC,EAAQ25D,WAAW,GAClD,KAAO,CAEL,MAAM35D,EAAS,IAAIK,MAAMrC,EAAQnC,QAAQyE,KAAK,MAC9CN,EAAO8Y,GAAY8+C,EACnB5G,EAAQh1D,KAAK,CAAE47D,UAAS75D,IAAKiC,EAAQ25D,WAAW,EAAMC,YAAY,GACpE,CACF,CAIA,MAAMhkD,EAAS,GACf,IAAIikD,EAAe,EAGnB,IAAK,MAAMZ,KAAYjK,EAAS8J,UAC9B,GAA6B,OAAzBG,EAASF,aAAiD,OAAzBE,EAASD,YAAsB,CAElE,MAAMc,EAAcpC,EAAQxzD,IAAI+0D,EAASD,aAEzC,KAAOa,EAAe7I,EAAQn1D,QAAUm1D,EAAQ6I,GAAcjC,UAAYkC,GACxElkD,EAAO5Z,KAAKg1D,EAAQ6I,GAAc97D,KAClC87D,IAEFjkD,EAAO5Z,KAAKi9D,EAASl7D,IACvB,MAAoC,OAAzBk7D,EAASF,aAAiD,OAAzBE,EAASD,aAEnDpjD,EAAO5Z,KAAKi9D,EAASl7D,KAKzB,KAAO87D,EAAe7I,EAAQn1D,OAAQg+D,IAAgB,CACpDjkD,EAAO5Z,KAAKg1D,EAAQ6I,GAAc97D,KAClC,MAAMg8D,EAAiB/I,EAAQ6I,GAAcjC,QACvCoC,EAAiBtB,EAAex0D,IAAI61D,GAG1C,IAAK,MAAMd,KAAYjK,EAAS8J,UAC1BG,EAASF,cAAgBiB,GAC3BpkD,EAAO5Z,KAAKi9D,EAASl7D,IAG3B,CAGA,IAAK,MAAMk7D,KAAYjK,EAAS8J,UACD,OAAzBG,EAASF,aAAwBE,EAASD,YAKhD,OAAOpjD,GAIHqkD,EAAWV,EAAaF,EAAWjB,EAAUE,EAAW,IAAI3pD,IAAI0qD,EAAUR,SAAS38D,IAAI+T,GAAKA,EAAE0nD,WAC9FuC,EAAWX,EAAaD,EAAWf,EAAUE,EAAW,IAAI9pD,IAAI2qD,EAAUT,SAAS38D,IAAI+T,GAAKA,EAAE0nD,WAG9FwC,EAAmB,CAACC,EAAapJ,EAASl4C,KAC9C,IAAIqH,EAAQ,EAEZ,MAAMk6C,EAAW,IAAI1rD,IAAIyrD,EAAYvB,SAAS38D,IAAI+T,GAAKA,EAAE0nD,UACnD2C,EAAW,IAAI3rD,IAErB,IAAK,MAAM5Q,KAAOizD,EAAS,CACzB,MAAMyG,EAAO15D,EAAI+a,GACb2+C,GAAM6C,EAASzoD,IAAI4lD,EACzB,CAGA,IAAK,MAAOE,EAASC,KAAYF,EAAQ53D,UACnCu6D,EAASvrD,IAAI6oD,IAAYA,IAAYC,GACvCz3C,IAKJ,IAAK,MAAMy3C,KAAWe,EAAgB,CACpC,MAAMhB,EAAUe,EAAex0D,IAAI0zD,GAC9ByC,EAASvrD,IAAI6oD,IAChBx3C,GAEJ,CAEA,OAAOA,GAUT,OAPA+3C,EAAciC,EAAiBd,EAAWY,EAAU3B,GACpDH,EAAcgC,EAAiBb,EAAWY,EAAUzB,GAGpDX,EAAYnvD,QAAU,CAACyvD,KAAa6B,GACpCjC,EAAYrvD,QAAU,CAAC4vD,KAAa2B,GAE7B,CAAEhC,cAAaC,cACxB,CAIA,MAAM9D,GAAwB,CAAC/sD,EAAO8I,EAAM5C,EAAUiN,EAAS3b,EAAUq0D,KACvE,MAAM,GAAQ9xD,KAGd,IAAIk5D,EAAc,GACdC,EAAa,GAEjB,GAAiB,kBAAbhtD,EAA8B,CAEhC,IAAIitD,EAAc,EACdC,EAAgB,GAEpB,GAAI57D,GAAY2b,EACd,IAAK,MAAME,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASjF,EAAMxJ,WAAagB,EAAS6b,GAAU,CACnE,MAAMq2C,EAAUv2C,EAAQE,GAAShS,SAAS9L,MAAM,IAAM,GAChDo0D,EAAUnyD,EAAS6b,GAAShS,SAAS9L,MAAM,IAAM,GAoBvD,GAjBAm0D,EAAQl0D,QAAQ,CAACiB,EAAKI,KACpB,MAAM+yD,EAASD,EAAQ9yD,GACvB,GAAK+yD,GAIH,IAAK,IAAIyJ,EAAI,EAAGA,EAAI58D,EAAIlC,OAAQ8+D,IAC9B,GAAI35D,OAAOjD,EAAI48D,IAAM,MAAQ35D,OAAOkwD,EAAOyJ,IAAM,IAAK,CACpDD,EAAc1+D,KAAK,IAAImC,EAAM,WAC7Bs8D,IACA,KACF,OARFC,EAAc1+D,KAAK,IAAImC,EAAM,UAC7Bs8D,MAaAxJ,EAAQp1D,OAASm1D,EAAQn1D,OAC3B,IAAK,IAAIF,EAAIq1D,EAAQn1D,OAAQF,EAAIs1D,EAAQp1D,OAAQF,IAC/C++D,EAAc1+D,KAAK,IAAIL,EAAI,WAC3B8+D,IAGJ,KACF,CAIJF,EAAc,odAWME,+CAGdC,EAAc7+D,OAAS,EACnB,wEAEA6+D,EACC79D,MAAM,EAAG,IACTX,IAAI0+D,GAAK,0CAA0C95D,EAAW85D,YAC9Dv3D,KAAK,sBACNq3D,EAAc7+D,OAAS,GAAK,iDAAiD6+D,EAAc7+D,OAAS,aAAe,qCAGnH,6BAIV2+D,EAAa,gQAIf,MAAO,GAAiB,aAAbhtD,EAAyB,CAElC,MAAMqtD,EAAUzqD,EAAK3C,QAAQI,IACvBitD,EAAU1qD,EAAK3C,QAAQ7G,IAC7B,IAAIm0D,EAAkB,EAClBC,EAAa,GAEjB,IAAK,MAAMrgD,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASjF,EAAMxJ,UAAW,CAC9Ci9D,GAAmBtgD,EAAQE,GAAShS,SAAS9M,QAAU,GAAK,EAC5D,KACF,CAGF,MAAMo/D,OAAwBl7D,IAAZ+6D,GAAyBC,EAAkBD,EACvDI,OAAuBn7D,IAAZ86D,GAAyBE,EAAkBF,EAE5D,GAAII,EACF,IAAK,IAAIt/D,EAAIm/D,EAAU,EAAGn/D,GAAKo/D,EAAiBp/D,IAC9Cq/D,EAAWh/D,KAAKL,GAIpB4+D,EAAc,+PAM6Bz5D,EAAWwG,EAAMqG,cAAgByC,EAAKzC,cAAgB,uJAI3EotD,kCACFh7D,IAAZ86D,QAAqC96D,IAAZ+6D,EAAwB,eAAsB/6D,IAAZ86D,EAAwBA,EAAU,YAAmB96D,IAAZ+6D,EAAwBA,EAAU,QAAU,mCAGlJG,GAAaD,EAAWn/D,OAAS,EAC7B,8KAG6Cm/D,EAAW,2GAGtDA,EACCn+D,MAAM,EAAG,IACTX,IAAI+T,GAAK,4CAA4CA,aACrD5M,KAAK,wBACN23D,EAAWn/D,OAAS,GAAK,gDAAgDm/D,EAAWn/D,iBAAmB,2DAIzG,iBAGJq/D,EACI,8GAE6CL,EAAUE,gDAGvD,6BAMRP,EADES,GAAaD,EAAWn/D,OAAS,EACtB,mNAE6Ei/D,kBAAwBh6D,EAAWwG,EAAMxJ,qEACrFk9D,EAAWn/D,0CAI5C,oGAEjB,MAAO,GAAiB,aAAb2R,GAA2B4C,EAAK7C,aAAc,CAEvD,MAAM9R,EAAS2U,EAAK3C,QAAQhS,QAAU,GAChCiS,OAAuC3N,IAA3BqQ,EAAK3C,QAAQC,UAA0B0C,EAAK3C,QAAQC,UAAY,EAClF,IAAI4P,EAAc,KACd64C,EAAS,GACTgF,EAAiB,GAGrB,IAAK,MAAMxgD,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASjF,EAAMxJ,UAAW,CAC9Cwf,EAAc7C,EAAQE,GACtB,KACF,CAGF,GAAI2C,GAAeA,EAAY3U,SAAW2U,EAAY3U,QAAQ9M,OAAS,EAAG,CACxE,MAAMmC,EAAUsf,EAAY3U,QAAQ,IAAM,GACpCkQ,EAAOyE,EAAY3U,QAAQ9L,MAAM,IAAM,GACvCic,EAAW9a,EAAQI,QAAQgS,EAAK7C,cAEtC,GAAIuL,GAAY,EAAG,CAEjB,MAAM8C,EAAU,GAChB,IAAK,IAAIjgB,EAAI,EAAGA,EAAIkd,EAAKhd,OAAQF,IAAK,CACpC,MAAM6C,EAAQqa,EAAKld,KAAKmd,GACxB,GAAIta,SAAmD,KAAVA,EAAc,SAE3D,MAAMiZ,EAAWzW,OAAOxC,GAAOkD,OAC/B,IAAK+V,EAAU,SAEf,IAAIsE,EAAM,KACV,GAAItgB,EAAQ,CACV,MAAMsH,EAAQ0U,EAAS1U,MAAM,IAAI0T,OAAO,IAAIhb,EAAOwF,QAAQ,sBAAuB,mBAC9E8B,IACFgZ,EAAMC,SAASjZ,EAAM,GAAI,IAE7B,MACEgZ,EAAMC,SAASvE,EAAU,IAGtB8C,MAAMwB,IACTH,EAAQ5f,KAAK,CAAE6D,SAAUlE,EAAG6C,MAAOiZ,EAAUsE,MAAKq/C,iBAAkBz/D,EAAI,GAE5E,CAGAigB,EAAQnf,KAAK,CAACC,EAAGC,IAAMD,EAAEmD,SAAWlD,EAAEkD,UAGtC,MAAMw7D,EAAc,IAAI5pD,IAClB6pD,EAAa,GACbC,EAAO,GACPC,EAAa,GAGnB,IAAK,IAAI7/D,EAAI,EAAGA,EAAIigB,EAAQ/f,OAAQF,IAAK,CACvC,MAAM8/D,EAAY7/C,EAAQjgB,GAAGogB,IACxBs/C,EAAYvsD,IAAI2sD,IACnBJ,EAAYh3D,IAAIo3D,EAAW,IAE7BJ,EAAYn3D,IAAIu3D,GAAWz/D,KAAKL,EAClC,CAGA,IAAK,IAAIA,EAAI,EAAGA,EAAIigB,EAAQ/f,OAAQF,IAAK,CACvC,MAAMugB,EAAcxO,EAAY/R,EAC1B8/D,EAAY7/C,EAAQjgB,GAAGogB,IACvB2/C,EAAS9/C,EAAQjgB,GAAGy/D,iBAGpBO,EAAcN,EAAYn3D,IAAIu3D,IAAc,GAC9CE,EAAY9/D,OAAS,GAEnB8/D,EAAY,KAAOhgE,GACrB2/D,EAAWt/D,KAAK,CACd0/D,SACAl9D,MAAOod,EAAQjgB,GAAG6C,MAClBud,IAAK0/C,EACLv/C,cACAiE,MAAOw7C,EAAY9/D,SAMrB4/D,IAAcv/C,IACZu/C,EAAYv/C,EAEds/C,EAAWx/D,KAAK,CAAE0/D,SAAQl9D,MAAOod,EAAQjgB,GAAG6C,MAAOud,IAAK0/C,EAAWv/C,gBAGnEq/C,EAAKv/D,KAAK,CAAE0/D,SAAQl9D,MAAOod,EAAQjgB,GAAG6C,MAAOud,IAAK0/C,EAAWv/C,gBAGnE,CAGA,IAAK,IAAIvgB,EAAI,EAAGA,EAAIigB,EAAQ/f,OAAQF,IAAK,CACvC,MAAMugB,EAAcxO,EAAY/R,EAC1B8/D,EAAY7/C,EAAQjgB,GAAGogB,IACvB2/C,EAAS9/C,EAAQjgB,GAAGy/D,iBACpBhiD,EAAewC,EAAQjgB,GAAG6C,MAC1Bg4D,EAAa/6D,EAASuF,OAAOkb,GAAaO,SAAS,EAAG,MAExDg/C,IAAcv/C,GAAeo/C,EAAWjsD,KAAKurD,GAAKA,EAAE7+C,MAAQ0/C,GAAab,EAAEc,SAAWA,KACxFP,EAAen/D,KAAK,CAClB0/D,SACAtiD,eACAo9C,aACA1qD,OAAQ2vD,EAAYv/C,EAAc,UAAYu/C,EAAYv/C,EAAc,KAAO,MAGrF,CAGA,MAAM0/C,EAAW,IAAIjtD,IACrB2sD,EAAWx+D,QAAQ89D,IACjBgB,EAAS/pD,IAAI,IAAI+oD,EAAEc,aAAad,EAAEp8D,gBAAgBo8D,EAAEz6C,aAEtDo7C,EAAKz+D,QAAQ++D,IACXD,EAAS/pD,IACP,IAAIgqD,EAAEH,aAAaG,EAAEr9D,cAAc/C,IAASuF,OAAO66D,EAAE3/C,aAAaO,SAAS,EAAG,gBAGlF++C,EAAW1+D,QAAQg/D,IACjBF,EAAS/pD,IACP,IAAIiqD,EAAEJ,aAAaI,EAAEt9D,cAAc/C,IAASuF,OAAO86D,EAAE5/C,aAAaO,SAAS,EAAG,kBAGlF05C,EAAS91D,MAAM2rB,KAAK4vC,EACtB,CACF,CA2DA,GAzDArB,EAAc,kQAM6Bz5D,EAAWwG,EAAMqG,cAAgByC,EAAKzC,cAAgB,mNAK7EwoD,EAAOt6D,oDAGrBs6D,EAAOt6D,OAAS,EACZ,iIAEAs6D,EACCt5D,MAAM,EAAG,IACTX,IAAIy6D,GAAS,0CAA0C71D,EAAW61D,YAClEtzD,KAAK,sBACN8yD,EAAOt6D,OAAS,GAAK,iDAAiDs6D,EAAOt6D,OAAS,eAAiB,qCAGvG,iBAGJs/D,EAAet/D,OAAS,EACpB,2VAMEs/D,EACCt+D,MAAM,EAAG,IACTX,IACC6/D,GAAO,8HAEqCA,EAAIL,kFACJ56D,EAAWi7D,EAAI3iD,8JAEjBtY,EAAWi7D,EAAIvF,qGACG11D,EAAWi7D,EAAIjwD,+DAI5EzI,KAAK,wBACN83D,EAAet/D,OAAS,GAAK,iDAAiDs/D,EAAet/D,OAAS,iBAAmB,2DAI3H,6BAKNs/D,EAAet/D,OAAS,EAAG,CAE7B,MAAMm4D,EACJ5jD,EAAK3C,QAAQumD,cACQ,QAApB1sD,EAAMxJ,UAAsB,OAA6B,SAApBwJ,EAAMxJ,UAAuB,MAAQ,MACvEk+D,EAAkBhI,EAAc,sBAAsBlzD,EAAWkzD,MAAkB,GAEzFwG,EAAa,oNAE8E15D,EAAWwG,EAAMxJ,4BAA4BgD,EAAWsP,EAAK7C,+BAA+BzM,EAAWrF,mBAAwBiS,MAAcsuD,0DAC3Lb,EAAet/D,yCAG9D,MACE2+D,EAAa,oGAEjB,CAEA,MAAM1K,EAASvuD,EAAE,iIAEsC4xD,6EACbryD,EAAWwG,EAAMxJ,WAAa,8HAE9Dy8D,6EAGAC,2DAMVj5D,EAAE,QAAQqxB,OAAOk9B,GAGjB,MAAML,EAAc,IAAMK,EAAO9sC,SACjC8sC,EAAOriC,GAAG,QAAS,oBAAqBgiC,GACxCK,EAAOriC,GAAG,QAAS,SAAUtwB,GACvBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,iCAAiC0hC,GAC5D,GAGAK,EAAOriC,GAAG,QAAS,2BAA4BjL,iBAC7C,GAAK1jB,EAKL,IAEE,IAAK,MAAM6b,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASjF,EAAMxJ,WAAagB,EAAS6b,GAAU,CACnEF,EAAQE,GAAWve,KAAKC,MAAMD,KAAKwB,UAAUkB,EAAS6b,KACtD,KACF,OAGI41C,GAAmB91C,GAAS,GAAO,GACzCg1C,IACA/gC,IACF,CAAE,MAAOvxB,GACPF,QAAQqK,MAAM,mBAAoBnK,GAC9BiO,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,UAAYnK,EAAEwO,SAAW,QAClE,MAnBMP,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,QAoB7C,GAGAo8B,EAAOriC,GAAG,QAAS,0BAA2BjL,iBAC5C,MAAMqlB,EAAOtmC,EAAEjG,MACTwC,EAAY+pC,EAAK1rC,KAAK,SACtBkY,EAAawzB,EAAK1rC,KAAK,UACvBV,EAASosC,EAAK1rC,KAAK,WAAa,GAChCuR,EAAYsO,SAAS6rB,EAAK1rC,KAAK,UAAY,IAAK,IAChD8/D,EAAkBp0B,EAAK1rC,KAAK,iBAAmB,KAErD,IACE0rC,EAAK2H,KAAK,YAAY,GAAM9c,KAAK,sDAGjC,IAAIpV,EAAc,KACd4+C,EAAgB,KACpB,IAAK,MAAMvhD,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASzO,EAAW,CACxCwf,EAAc7C,EAAQE,GACtBuhD,EAAgBvhD,EAChB,KACF,CAGF,IAAK2C,IAAgBA,EAAY3U,SAAW2U,EAAY3U,QAAQ9M,OAAS,EAGvE,OAFIuP,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,eACzCmU,EAAK2H,KAAK,YAAY,GAAO9c,KAAK,0CAIpC,MAAM10B,EAAUsf,EAAY3U,QAAQ,IAAM,GACpCkQ,EAAOyE,EAAY3U,QAAQ9L,MAAM,IAAM,GACvCic,EAAW9a,EAAQI,QAAQiW,GAEjC,GAAIyE,EAAW,EAGb,OAFI1N,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,eACzCmU,EAAK2H,KAAK,YAAY,GAAO9c,KAAK,0CAKpC,GAAIupC,EAAiB,CAEnB,IAAIE,EAAc,KACdC,EAAgB,KACpB,IAAK,MAAMzhD,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAAS0vD,EAAiB,CAC9CE,EAAc1hD,EAAQE,GACtByhD,EAAgBzhD,EAChB,KACF,CAGF,IAAKwhD,IAAgBA,EAAYxzD,SAAWwzD,EAAYxzD,QAAQ9M,OAAS,EAGvE,OAFIuP,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,WAAWuoC,UACpDp0B,EAAK2H,KAAK,YAAY,GAAO9c,KAAK,0CAIpC,MAAM2pC,EAAgBF,EAAYxzD,QAAQ,IAAM,GAGhD,GAFuB0zD,EAAcj+D,QAAQiW,GAExB,EAGnB,OAFIjJ,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,eAAerf,UACxDwzB,EAAK2H,KAAK,YAAY,GAAO9c,KAAK,0CAKpC,MAAM4pC,EAAWvF,GAAsBz5C,EAAajJ,EAAY5Y,GAC1D8gE,EAAWxF,GAAsBoF,EAAa9nD,EAAY5Y,GAG1Di8D,EAAUN,GAAiBkF,EAASrF,SAAUsF,EAAStF,SAAUx7D,EAAQiS,IAGzE,YAAEwqD,EAAW,YAAEC,GAAgBN,GACnCv6C,EACA4+C,EACAC,EACAC,EACA/nD,EACAqjD,EACAj8D,SAMI80D,GAAmB91C,GAAS,GAAO,GACzCg1C,IACA/gC,IACF,KAAO,CAGL,MAAM9S,EAAU,GAChB,IAAK,IAAIjgB,EAAI,EAAGA,EAAIkd,EAAKhd,OAAQF,IAAK,CACpC,MAAM6C,EAAQqa,EAAKld,KAAKmd,GACxB,GAAIta,SAAmD,KAAVA,EAAc,SAE3D,MAAMiZ,EAAWzW,OAAOxC,GAAOkD,OAC/B,IAAK+V,EAAU,SAEf,IAAIsE,EAAM,KACV,GAAItgB,EAAQ,CACV,MAAMsH,EAAQ0U,EAAS1U,MAAM,IAAI0T,OAAO,IAAIhb,EAAOwF,QAAQ,sBAAuB,mBAC9E8B,IACFgZ,EAAMC,SAASjZ,EAAM,GAAI,IAE7B,MACEgZ,EAAMC,SAASvE,EAAU,IAGtB8C,MAAMwB,IACTH,EAAQ5f,KAAK,CAAE6D,SAAUlE,EAAG6C,MAAOiZ,EAAUsE,OAEjD,CAGAH,EAAQnf,KAAK,CAACC,EAAGC,IAAMD,EAAEmD,SAAWlD,EAAEkD,UAGtC,IAAI28D,EAAa,EACjB,IAAK,IAAI7gE,EAAI,EAAGA,EAAIigB,EAAQ/f,OAAQF,IAAK,CACvC,MAAMugB,EAAcxO,EAAY/R,EAC1B8/D,EAAY7/C,EAAQjgB,GAAGogB,IACvBlc,EAAW+b,EAAQjgB,GAAGkE,SAE5B,GAAI47D,IAAcv/C,EAAa,CAC7B,MAAMs6C,EAAa/6D,EAASuF,OAAOkb,GAAaO,SAAS,EAAG,KAC5D5D,EAAKhZ,GAAUiZ,GAAY09C,EAC3BgG,GACF,CACF,OAGMjM,GAAmB91C,GAAS,GAAO,GACzCg1C,IACA/gC,IACF,CACF,CAAE,MAAOvxB,GACPF,QAAQqK,MAAM,sBAAuBnK,GACjCiO,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,UAAYnK,EAAEwO,SAAW,SAChEk8B,EAAK2H,KAAK,YAAY,GAAO9c,KAAK,yCACpC,CACF,GAGAo9B,EAAOriC,GAAG,QAAS,yBAA0BjL,iBAC3C,MAAMi6C,EAAWzgD,SAASza,EAAEjG,MAAMa,KAAK,SAAU,IAC3C2B,EAAYyD,EAAEjG,MAAMa,KAAK,SAE/B,IACE,IAAK,MAAMwe,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASzO,EAAW,CAExC2c,EAAQE,GAAShS,QAAU8R,EAAQE,GAAShS,QAAQ9L,MAAM,EAAG4/D,EAAW,GACxE,KACF,OAGIlM,GAAmB91C,GAAS,GAAO,GACzCg1C,IACA/gC,IACF,CAAE,MAAOvxB,GACPF,QAAQqK,MAAM,mBAAoBnK,GAC9BiO,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,UAAYnK,EAAEwO,SAAW,QAClE,CACF,IAQI+wD,GAA4B,KAChC,MAAM,GAAQr7D,KACRoM,EAASklB,KAET6P,EADQrW,KAGd5qB,EAAE,kCAAkCyhB,SAElB1U,EAAiBC,eAAnC,MAEM49C,EAAY,sGAE0B1+C,EAAOye,8UAG2GsW,EAAElW,+WAM5FkW,EAAEvD,4OAG8EuD,EAAExD,iEAAiEwD,EAAEhD,8BAA8BgD,EAAElW,sbAEnGkW,EAAExD,iEAAiEwD,EAAEhD,8BAA8BgD,EAAElW,+KACxKkW,EAAEpD,kBAAkBoD,EAAEnW,oBAAsBmW,EAAElW,UAAY,sZAMrDkW,EAAEtD,iBAAiBsD,EAAElW,+BAA+BkW,EAAExD,+OAGtDwD,EAAEpD,kBAAkBoD,EAAEnW,oBAAsBmW,EAAElW,UAAY,4OAS5I8/B,EAAS7qD,EAAE4qD,GACjB5qD,EAAE,QAAQqxB,OAAOw5B,GAGjBA,EAAOt9B,IAAI,CACT8M,SAAU,QACV+L,IAAK,IACL6F,KAAM,IACNC,MAAO,IACPC,OAAQ,IACRC,MAAO,QACP9b,OAAQ,QACR7mB,WAAY,kBACZ,UAAW,aACX/C,QAAS,OACT,cAAe,SACf,kBAAmB,SACnB86B,QAAS,OACT,aAAc,eAIhB,MAAM45B,EAAiB,KACrB,MAAMxtD,EAAYb,EAAiBC,eACjB69C,EAAO17C,KAAK,uBACpBjP,IAAI0N,EAAU9L,KAAK,OA0B/Bs5D,IAGAvQ,EAAO17C,KAAK,uBAAuB+c,GAAG,QAAS,WAzBtB,MACvB,MACMrM,EADYgrC,EAAO17C,KAAK,uBACPjP,MAAMC,OAC7B,IAAK0f,EAEH,YADA9S,EAAiBS,aAAa,IAIhC,MAAMgR,EAAQqB,EACX5a,MAAM,QACNtK,IAAI6E,GAAKA,EAAEW,QACX4H,OAAOvI,GAAKA,EAAElF,OAAS,GAEpB+gE,EAAc,IAAI,IAAIjuD,IAAIoR,IAChCzR,EAAiBS,aAAa6tD,GAE1BA,EAAY/gE,SAAWkkB,EAAMlkB,QAC/B8gE,KASFE,EACF,GAGAzQ,EAAO17C,KAAK,sBAAsBo9B,MAAM,WACtC,MAAMgvB,EAAQ1Q,EAAO17C,KAAK,oBACpBlS,EAAQs+D,EAAMr7D,MAAMC,OAC1B,IAAKlD,EAAO,OAGZ,MAAMwlB,EAAWxlB,EACdgI,MAAM,QACNtK,IAAI6E,GAAKA,EAAEW,QACX4H,OAAOvI,GAAKA,EAAElF,OAAS,GAE1B,GAAwB,IAApBmoB,EAASnoB,OAAc,OAE3B,MAAMsT,EAAYb,EAAiBC,eAC7BwuD,EAAc,IAAIpuD,IAAIQ,GACtB6tD,EAAa,GAEnBh5C,EAASlnB,QAAQC,IACVggE,EAAYjuD,IAAI/R,KACnBoS,EAAUnT,KAAKe,GACfggE,EAAYlrD,IAAI9U,GAChBigE,EAAWhhE,KAAKe,MAIM,IAAtBigE,EAAWnhE,QAKfyS,EAAiBS,aAAaI,GAC9B2tD,EAAMr7D,IAAI,IACVk7D,IACIvxD,OAAOujB,QAAQvjB,OAAOujB,OAAOzX,QAAQ,OAAO8lD,EAAWnhE,aAPrDuP,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,SAQ7C,GAEA04B,EAAO17C,KAAK,oBAAoB+c,GAAG,WAAY,SAAUtwB,GACvC,KAAZA,EAAE8/D,OACJ7Q,EAAO17C,KAAK,sBAAsBo9B,OAEtC,GAEAse,EAAO17C,KAAK,wBAAwBo9B,MAAM,WACpCgC,QAAQ,oBACVxhC,EAAiBW,iBACjB0tD,IACIvxD,OAAOujB,QAAQvjB,OAAOujB,OAAOzX,QAAQ,WAE7C,GAEA,MAAMgmD,EAAa,KACjB9Q,EAAOppC,SAEP0L,MAGF09B,EAAO17C,KAAK,wCAAwCo9B,MAAMovB,GAC1D9Q,EAAO3+B,GAAG,QAAS,SAAUtwB,GACvBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,kCAAkCmvC,GAC7D,IAGIC,GAA6B,KACjC,MAAM,GAAQ97D,KACdE,EAAE,qBAAqByhB,SAEvB,MAAMvV,EAASklB,KACT6P,EAAIrW,KACJ3b,EAAUimB,GAAuBhnB,gBACjCgB,EAAWjC,GAAMtK,IAAIqB,EAAgC,MAGrD63D,EAA+B,OAAb3sD,EAuDlB4sD,EAtDoB,sNAKqB76B,EAAEvD,2eASgCm+B,EAAkB,UAAY,mHAQ3F5sD,EACjBtU,IAAI0T,IACH,MAAM6a,EAAW7a,EAAO5G,KAAOyH,EACzB6sD,EAAY1tD,EAAOvC,QAEzB,MAAO,mDACiCuC,EAAO5G,2GAGvClI,EAAW8O,EAAOrD,wBAClB+wD,EAAY,wCAAwC96B,EAAEvD,0CAA4C,uCAEpGrvB,EAAOxC,YAAc,gCAAgCtM,EAAW8O,EAAOxC,qBAAuB,uEAEtFwC,EAAOwmB,eAAev6B,kBAAkB+T,EAAO4mB,mBAAmB36B,QAAU,iRAKxB+T,EAAO5G,OAAOyhB,EAAW,UAAY,iGAGhG6yC,EAA0I,GAA9H,2DAA2D1tD,EAAO5G,oIACrB4G,EAAO5G,6EAChEs0D,EAAsK,GAA1J,6DAA6D1tD,EAAO5G,kIAKxF3F,KAAK,IAKF8rC,EAAU5tC,EAAE,yFAE0BkM,EAAOye,8MACoFsW,EAAExD,iFACxEwD,EAAElW,uUAQvD+wC,GAAkB,yDAAyD76B,EAAEvD,2JAIHuD,EAAExD,iGACPwD,EAAEjB,UAAYiB,EAAEpD,oDAAoDoD,EAAE5B,sNAGnE4B,EAAEtD,4BAA4BsD,EAAExD,sCAAsCwD,EAAElW,mNAG9EkW,EAAEtD,4BAA4BsD,EAAExD,sCAAsCwD,EAAElW,2RAUtJ/qB,EAAE,QAAQqxB,OAAOuc,GAGjBA,EAAQz+B,KAAK,oCAAoC+c,GAAG,QAAS,KAC3D0hB,EAAQnsB,SACRu6C,OAIFpuB,EAAQ1hB,GAAG,SAAU,qBAAsB,WACzC,MAAM+vC,EAAUj8D,EAAEjG,MACZ0N,EAAKw0D,EAAQrhE,KAAK,MAGxB,GAFkBqhE,EAAQ1vC,GAAG,YAEd,CAEb,MAAM6I,EAAiB,gBAAP3tB,EAAuB,KAAOA,EAC9CytB,GAAuB7lB,gBAAgB+lB,GAGvCwY,EAAQz+B,KAAK,sBAAsBye,KAAK,WACtC,MAAMsuC,EAAcl8D,EAAEjG,MACPmiE,EAAYthE,KAAK,QACjB6M,GACby0D,EAAYjuB,KAAK,WAAW,EAEhC,EACF,MAEE/Y,GAAuB7lB,gBAAgB,KAE3C,GAGAu+B,EAAQ1hB,GAAG,QAAS,mBAAoB,WACtC,MAAMzkB,EAAKzH,EAAEjG,MAAMa,KAAK,MACxBgzC,EAAQnsB,SACR06C,GAA0B10D,EAC5B,GAGAmmC,EAAQ1hB,GAAG,QAAS,qBAAsB,WACxC,MAAMzkB,EAAKzH,EAAEjG,MAAMa,KAAK,MAClB4V,EAAO0kB,GAAuBplB,aAAarI,GACjD,IAAK+I,EAEH,YADI3G,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,SAIzC,MAAMsI,EAASY,EAAQE,KAAKC,GAAKA,EAAE3H,KAAOA,GACpC20D,EAAW,cAAc/tD,GAAQrD,MAAQvD,KAAMvL,KAAKC,aACpDshB,EAAO,IAAIwvC,KAAK,CAACz8C,GAAO,CAAE7J,KAAM,qBAChCsX,EAAMJ,IAAIK,gBAAgBT,GAC1BtiB,EAAIoL,SAAS8C,cAAc,KACjClO,EAAE+xD,KAAOjvC,EACT9iB,EAAEgyD,SAAWiP,EACb71D,SAASyD,KAAKC,YAAY9O,GAC1BA,EAAEoxC,QACFhmC,SAASyD,KAAKojD,YAAYjyD,GAC1B0iB,IAAIC,gBAAgBG,EACtB,GAGA2vB,EAAQ1hB,GAAG,QAAS,qBAAsB,WACxC,MAAMzkB,EAAKzH,EAAEjG,MAAMa,KAAK,MAClByT,EAASY,EAAQE,KAAKC,GAAKA,EAAE3H,KAAOA,GAE1C,GAAI8mC,QAAQ,WAAWlgC,GAAQrD,WAAY,CACzBkqB,GAAuBvlB,aAAalI,IAElDmmC,EAAQnsB,SACRm6C,MAEI/xD,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,OAE3C,CACF,GAGA6nC,EAAQz+B,KAAK,mBAAmB+c,GAAG,QAAS,KAC1C0hB,EAAQnsB,SACR06C,OAIFvuB,EAAQz+B,KAAK,sBAAsB+c,GAAG,QAAS,KAC7C0hB,EAAQz+B,KAAK,0BAA0Bo9B,UAGzCqB,EAAQz+B,KAAK,0BAA0B+c,GAAG,SAAU,SAAUtwB,GAC5D,MAAM8vD,EAAO9vD,EAAEuhB,OAAOwuC,MAAM,GAC5B,IAAKD,EAAM,OAEX,MAAM2B,EAAS,IAAIC,WACnBD,EAAOE,OAASC,IACd,IACmBt4B,GAAuB3kB,aAAai9C,EAAIrwC,OAAO9I,SAE9Du5B,EAAQnsB,SACRm6C,MAEI/xD,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,aAE3C,CAAE,MAAOssB,GACP32B,QAAQqK,MAAM,oBAAqBssB,GAC/BxoB,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,OACzC,GAEFsnD,EAAOM,WAAWjC,GAGlB1rD,EAAEjG,MAAMmG,IAAI,GACd,GAGA0tC,EAAQ1hB,GAAG,QAAS,SAAUtwB,GACxBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,sBACvBohB,EAAQnsB,SACRu6C,KAEJ,IAIIG,GAA4B,CAACnsD,EAAW,QAC5C,MAAM,GAAQlQ,KACdE,EAAE,qBAAqByhB,SAEvB,MAAMvV,EAASklB,KACT6P,EAAIrW,KACJyxC,IAAWrsD,EACXssD,EAAiBD,EAASnnC,GAAuBhnB,gBAAgBiB,KAAKC,GAAKA,EAAE3H,KAAOuI,GAAY,KAGhGusD,EAAc,CAClBvxD,KAAMsxD,GAAgBtxD,MAAQ,QAC9Ba,YAAaywD,GAAgBzwD,aAAe,GAC5CgpB,eAAgBynC,GAAgBznC,gBAAkB,CAChD,CAAE7pB,KAAM,KAAM8pB,QAAS,MAAOC,MAAO,CAAC,EAAG,KACzC,CAAE/pB,KAAM,KAAM8pB,QAAS,MAAOC,MAAO,CAAC,EAAG,KACzC,CAAE/pB,KAAM,KAAM8pB,QAAS,MAAOC,MAAO,CAAC,EAAG,KACzC,CAAE/pB,KAAM,KAAM8pB,QAAS,MAAOC,MAAO,CAAC,EAAG,KACzC,CAAE/pB,KAAM,KAAM8pB,QAAS,MAAOC,MAAO,CAAC,EAAG,KACzC,CAAE/pB,KAAM,KAAM8pB,QAAS,MAAOC,MAAO,CAAC,EAAG,MAE3CE,kBAAmBqnC,GAAgBrnC,mBAAqB,IAGpD2Y,EAAU5tC,EAAE,yFAE0BkM,EAAOye,8MACoFsW,EAAExD,iFACxEwD,EAAElW,8DACvBsxC,EAAS,KAAO,oUAOMp7B,EAAEvD,wGACbn+B,EAAWg9D,EAAYvxD,8FAA8Fi2B,EAAExD,sDAAsDwD,EAAEhD,8BAA8BgD,EAAElW,+LAIpMkW,EAAEvD,sGACbn+B,EAAWg9D,EAAY1wD,sHAAsHo1B,EAAExD,sDAAsDwD,EAAEhD,8BAA8BgD,EAAElW,+LAI5NkW,EAAEvD,+FACVuD,EAAEvD,yMAEkFuD,EAAExD,sDAAsDwD,EAAEhD,8BAA8BgD,EAAElW,gOAG1LkW,EAAEvD,+eAQsCuD,EAAExD,8FACVwD,EAAEjB,UAAYiB,EAAEpD,oDAAoDoD,EAAE5B,gOAGxE4B,EAAEtD,4BAA4BsD,EAAExD,sCAAsCwD,EAAElW,kLAQpJ/qB,EAAE,QAAQqxB,OAAOuc,GAEjB,MAAM4uB,EAAgB5uB,EAAQz+B,KAAK,gBAGhB,MACjB,MAAMvU,EAAO,CACXi6B,eAAgB0nC,EAAY1nC,eAC5BI,kBAAmBsnC,EAAYtnC,mBAEjCunC,EAAct8D,IAAIrF,KAAKwB,UAAUzB,EAAM,KAAM,KAE/C6hE,GAGA7uB,EAAQz+B,KAAK,kCAAkC+c,GAAG,QAAS,KACzD0hB,EAAQnsB,SACRm6C,OAIFhuB,EAAQz+B,KAAK,gBAAgB+c,GAAG,QAAS,KACvC,IACE,MAAMlhB,EAAO4iC,EAAQz+B,KAAK,gBAAgBjP,MAAMC,OAC1C0L,EAAc+hC,EAAQz+B,KAAK,gBAAgBjP,MAAMC,OACjDo1B,EAAUinC,EAAct8D,MAAMC,OAEpC,IAAK6K,EAEH,YADInB,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,YAK3C,MAAMrQ,EAAWjnB,KAAKC,MAAMy6B,GAG5B,IACGzT,EAAS+S,iBACT/1B,MAAMqO,QAAQ2U,EAAS+S,iBACW,IAAnC/S,EAAS+S,eAAev6B,OAGxB,YADIuP,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,aAKzC,MAAMsI,EAAS,CACb9C,OAAQ,qBACR+C,QAAS,EACT7G,GAAIuI,GAAY,UAAU9T,KAAKC,QAC/B6O,OACAa,cACAgpB,eAAgB/S,EAAS+S,eACzBI,kBAAmBnT,EAASmT,mBAAqB,IAI/ConC,EACFnnC,GAAuBG,aAAarlB,EAAU3B,GAE9C6mB,GAAuB5lB,aAAajB,GAGtCu/B,EAAQnsB,SACRm6C,IACF,CAAE,MAAOvpC,GACP32B,QAAQqK,MAAM,oBAAqBssB,GAC/BxoB,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,SAAWssB,EAAIjoB,SAAW,YACnE,IAIFwjC,EAAQ1hB,GAAG,QAAS,SAAUtwB,GACxBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,sBACvBohB,EAAQnsB,SACRm6C,KAEJ,IAMI9xD,GAAwB,KAC5B,MAAM,GAAQhK,KACdE,EAAE,qBAAqB08D,IAAI,mCAAmCj7C,SAC9D,MACMmwC,EAAoB,aADXxgC,KAC+BzG,QAIxCgyC,GAHI/xC,KAGW3d,GAAMtK,IAAI,oBAAqB,CAAEhH,KAAK,EAAMmK,MAAM,EAAMjK,MAAM,EAAMkK,OAAO,KAChGL,EAAsBsC,WAAW20D,GAEjC,MAAMC,EAAa,KACjB,MAAMC,EAAen3D,EAAsBoC,kBACrCg1D,EAAgBvO,EAAOp/C,KAAK,4BAClC2tD,EAAc5K,QAEc,IAAxB2K,EAAaviE,OAOjBuiE,EAAathE,QAAQI,IACnB,MAAMohE,EAAa,CACjBh3D,MAAO,UACPlK,KAAM,UACNiK,KAAM,UACNnK,IAAK,WAEDqhE,EAAY,CAChBj3D,MAAO,wBACPlK,KAAM,0BACNiK,KAAM,iBACNnK,IAAK,aAED6xB,EAAQuvC,EAAWphE,EAAIgL,OAASo2D,EAAWphE,IAC3CuP,EAAO8xD,EAAUrhE,EAAIgL,OAASq2D,EAAUrhE,IAExCshE,EAAUj9D,EAAE,0DAC6BrE,EAAIgL,6OAExB6mB,0EACEtiB,YAAevP,EAAIsL,qEAErBumB,+DAAmE7xB,EAAIgL,2HACEpH,EAAW5D,EAAIyL,oDAE7GzL,EAAI2L,MAAQ,sIAAsI/H,EAAW5D,EAAI2L,eAAiB,kCAGxLw1D,EAAczrC,OAAO4rC,KAlCrBH,EAAc3rC,KACZ,4HAqCAo9B,EAASvuD,EAAE,wGAE0C4xD,qhCAaclsD,EAAsBvB,QAAU,UAAY,uMAGbuB,EAAsBvB,QAAU,MAAQ,gXAMzGw4D,EAAahhE,IAAM,kBAAoB,sFAAsFghE,EAAahhE,IAAM,GAAK,qKAGrJghE,EAAa72D,KAAO,kBAAoB,uFAAuF62D,EAAa72D,KAAO,GAAK,sKAGxJ62D,EAAa9gE,KAAO,kBAAoB,uFAAuF8gE,EAAa9gE,KAAO,GAAK,sKAGxJ8gE,EAAa52D,MAAQ,kBAAoB,wFAAwF42D,EAAa52D,MAAQ,GAAK,8hDAgClM/F,EAAE,QAAQqxB,OAAOk9B,GAGjB,MAAM2O,EAAe,KACnB,MAAM16C,EAAQ9c,EAAsBC,KAAKrL,OACnCsV,EAAWlK,EAAsBoC,kBAAkBxN,OACzDi0D,EAAOp/C,KAAK,sBAAsB0Q,KAAK2C,GACvC+rC,EAAOp/C,KAAK,yBAAyB0Q,KAAKjQ,IAI5CgtD,IACAM,IAGA3O,EAAOp/C,KAAK,iCAAiC+c,GAAG,SAAU,WACxD,MAAMixC,EAAUn9D,EAAEjG,MAAMwyB,GAAG,YACrB6wC,EAAU7O,EAAOp/C,KAAK,iCACxBguD,GACFz3D,EAAsBS,SACtBi3D,EAAQv9C,KAAK,OAEbnkB,QAAQC,IAAI,2BAEZ+J,EAAsBW,UACtB+2D,EAAQv9C,KAAK,OAEjB,GAGA0uC,EAAOp/C,KAAK,sBAAsB+c,GAAG,QAAS,WAC5C,MAAMvlB,EAAO3G,EAAEjG,MAAMa,KAAK,eAEpByiE,GADWr9D,EAAEjG,MAAMyyB,SAAS,mBAI9B6wC,GACFr9D,EAAEjG,MAAM2yB,YAAY,qBAAqBC,SAAS,mBAClD3sB,EAAEjG,MAAMwzB,IAAI,UAAW,OAEvBvtB,EAAEjG,MAAM2yB,YAAY,mBAAmBC,SAAS,qBAChD3sB,EAAEjG,MAAMwzB,IAAI,UAAW,QAIzB7nB,EAAsBsC,WAAW,CAAE,CAACrB,GAAO02D,IAC3CpwD,GAAMnK,IAAI,oBAAqB4C,EAAsBG,SACrD+2D,IACAM,GACF,GAGA3O,EAAOp/C,KAAK,wBAAwB+c,GAAG,QAAS,KAC9CxmB,EAAsBmC,QACtB+0D,IACAM,MAIF3O,EAAOp/C,KAAK,uBAAuB+c,GAAG,QAASjL,UAC7C,MAAM47C,EAAen3D,EAAsBoC,kBAC3C,GAA4B,IAAxB+0D,EAAaviE,OAEf,YADIuP,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,aAI3C,MAAMtS,EAAOg9C,EACVliE,IAAIgB,IACH,IAAI2hE,EAAO,IAAI3hE,EAAIsL,aAAatL,EAAIgL,KAAK42D,kBAAkB5hE,EAAIyL,UAI/D,OAHIzL,EAAI2L,QACNg2D,GAAQ,KAAO3hE,EAAI2L,OAEdg2D,IAERx7D,KAAK,MAER,IAEE,GAAI+H,OAAO2zD,cAAgB3zD,OAAO2zD,aAAaC,aAAc,CAC3D,MAAMC,EAAc79C,EAAKngB,QAAQ,MAAO,OAAOA,QAAQ,MAAO,OAE9D,kBADMmK,OAAO2zD,aAAaC,aAAa,mBAAmBC,KAE5D,CAEA,GAAIx3B,UAAUD,WAAap8B,OAAO8zD,sBAC1Bz3B,UAAUD,UAAU23B,UAAU/9C,OAC/B,CAEL,MAAMg+C,EAAWt3D,SAAS8C,cAAc,YACxCw0D,EAAS5gE,MAAQ4iB,EACjBg+C,EAASp3D,MAAM4zB,SAAW,QAC1BwjC,EAASp3D,MAAMwlC,KAAO,UACtB4xB,EAASp3D,MAAM2/B,IAAM,IACrBy3B,EAASC,aAAa,WAAY,IAClCv3D,SAASyD,KAAKC,YAAY4zD,GAC1BA,EAAStsC,SACTssC,EAASE,kBAAkB,EAAG,OAC9B,MAAMC,EAAaz3D,SAAS03D,YAAY,QAExC,GADA13D,SAASyD,KAAKojD,YAAYyQ,IACrBG,EACH,MAAM,IAAIz2D,MAAM,qBAEpB,CACF,CAAE,MAAO8qB,GACP32B,QAAQqK,MAAM,2BAA4BssB,GACtCxoB,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,OACzC,IAIFwoD,EAAOp/C,KAAK,yBAAyB+c,GAAG,QAAS,KAC/C,MAAM2wC,EAAen3D,EAAsBoC,kBAC3C,GAA4B,IAAxB+0D,EAAaviE,OAEf,YADIuP,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,aAI3C,MAAMtS,EAAOg9C,EACVliE,IAAIgB,IACH,IAAI2hE,EAAO,IAAI3hE,EAAIsL,aAAatL,EAAIgL,KAAK42D,kBAAkB5hE,EAAIyL,UAI/D,OAHIzL,EAAI2L,QACNg2D,GAAQ,KAAO3hE,EAAI2L,OAEdg2D,IAERx7D,KAAK,QAEF2b,EAAO,IAAIwvC,KAAK,CAACptC,GAAO,CAAElZ,KAAM,6BAChCsX,EAAMJ,IAAIK,gBAAgBT,GAC1BtiB,EAAIoL,SAAS8C,cAAc,KACjClO,EAAE+xD,KAAOjvC,EACT9iB,EAAEgyD,SAAW,kBAAiB,IAAIjxD,MAAOuT,cAAcnU,MAAM,EAAG,IAAIoE,QAAQ,KAAM,WAClF6G,SAASyD,KAAKC,YAAY9O,GAC1BA,EAAEoxC,QACFhmC,SAASyD,KAAKojD,YAAYjyD,GAC1B0iB,IAAIC,gBAAgBG,KAItBswC,EAAOp/C,KAAK,2CAA2C+c,GAAG,QAAS,SAAUtwB,IACvEA,EAAEuhB,SAAWpjB,MAAQiG,EAAEpE,EAAEuhB,QAAQkP,QAAQ,kBAAkB/xB,SAC7Di0D,EAAO9sC,QAEX,GAIA,MAAMy8C,EAAkBC,YAAY,KAC9B5P,EAAOj0D,QAAUi0D,EAAOhiC,GAAG,cAC7BqwC,IACAM,MAED,KAGH3O,EAAOriC,GAAG,SAAU,KAClBkyC,cAAcF,MAOZG,GAAyBC,IAC7B,MAAM,GAAQx+D,KAER8xD,EAAoB,aADXxgC,KAC+BzG,QAGxC4zC,EAAWD,EAAa7rD,EAA2BF,QAAQ+rD,GAAc,KAGzE5nD,EAAYuI,IAAiBC,KAM7BqvC,GALa5wD,OAAOC,KAAK8Y,GAAa,CAAC,GAC1C3O,OAAOod,GAAKA,EAAE3qB,WAAW,WACzBG,IAAIwqB,GAAKzO,EAAUyO,IAAIna,MAAQma,GAC/BjqB,OAEY8E,EAAE,iIAEsC4xD,yGAEL2M,EAAW,KAAO,yaAMSA,EAAWh/D,EAAWg/D,EAASvzD,MAAQ,mbAIoGuzD,EAAWh/D,EAAWg/D,EAAS1yD,aAAe,IAAM,oQAI5L0yD,EAAWh/D,EAAWg/D,EAASz1D,SAAW,+UAItCy1D,EAAWh/D,EAAWg/D,EAASnrD,aAAe,IAAM,0XAKzE,WAA1BmrD,GAAUtzD,OAAOtE,KAAoB,WAAa,yDACzB,UAA1B43D,GAAUtzD,OAAOtE,KAAmB,WAAa,0DACtB,WAA1B43D,GAAUtzD,OAAOtE,KAAoB,WAAa,gJAGiB,WAA1B43D,GAAUtzD,OAAOtE,KAAoB,OAAS,4MAExC43D,GAAUtzD,OAAO8H,YAAYjR,KAAK,MAAQ,wJAErB,WAA1By8D,GAAUtzD,OAAOtE,KAAoB,OAAS,4MAExC43D,GAAUtzD,OAAO+H,aAAalR,KAAK,MAAQ,mSAI7Cy8D,GAAUtrD,UAAY,oTAyBzGs7C,EAAOp/C,KAAK,oBAAoB+c,GAAG,SAZT,KACxB,MAAMsyC,EAAYjQ,EAAOp/C,KAAK,oBAAoBjP,MAChC,WAAds+D,EACFjQ,EAAOp/C,KAAK,2CAA2Csd,OAChC,UAAd+xC,GACTjQ,EAAOp/C,KAAK,sBAAsBoe,IAAI,UAAW,QAAQmX,OACzD6pB,EAAOp/C,KAAK,uBAAuBsd,QACZ,WAAd+xC,GACTjQ,EAAOp/C,KAAK,2CAA2Coe,IAAI,UAAW,QAAQmX,SAOlF,MAAM+5B,EAAYlQ,EAAOp/C,KAAK,qBAS9BsvD,EAAUvyC,GAAG,QARc,KAEzBuyC,EAAUlxC,IAAI,SAAU,QAExB,MAAMohC,EAAe8P,EAAU,GAAG9P,aAClC8P,EAAUlxC,IAAI,SAAUnoB,KAAKC,IAAI,GAAIspD,GAAgB,QAMvDJ,EAAOp/C,KAAK,2BAA2B+c,GAAG,QAASjL,iBACjD,MAAMjW,EAAOujD,EAAOp/C,KAAK,cAAcjP,MACjC4I,EAAUylD,EAAOp/C,KAAK,iBAAiBjP,MACvCs+D,EAAYjQ,EAAOp/C,KAAK,oBAAoBjP,MAElD,IAAK8K,IAASlC,EAEZ,YADAskB,OAAOrnB,MAAM,gBAKf,MAAMkF,EAA0B,CAAEtE,KAAM63D,GACxC,GAAkB,WAAdA,EAAwB,CAC1B,MAAMzrD,EAAaw7C,EAAOp/C,KAAK,qBAAqBjP,MAChD6S,IACF9H,EAAM8H,WAAatT,OAAOsT,GACvB9N,MAAM,KACNtK,IAAI6E,GAAKA,EAAEW,QACX4H,OAAOvI,GAAKA,GACnB,CACA,GAAkB,WAAdg/D,EAAwB,CAC1B,MAAMxrD,EAAcu7C,EAAOp/C,KAAK,sBAAsBjP,MAClD8S,IACF/H,EAAM+H,YAAcvT,OAAOuT,GACxB/N,MAAM,KACNtK,IAAI6E,GAAKA,EAAEW,QACX4H,OAAOvI,GAAKA,GACnB,CAGA,MAAM8W,EAAa7W,OAAOqJ,IAClBqK,MAAOurD,EAAc,oBAAEroD,GAAwBnC,GAA0BkC,cAAcE,GAGzFqoD,EAAcpQ,EAAOp/C,KAAK,gBAC1ByvD,EAAkBrQ,EAAOp/C,KAAK,oBAC9B0vD,EAAiBtQ,EAAOp/C,KAAK,mBAE7B2vD,EAAU,CACdvqD,OAAQoqD,EAAYrkE,OAAS,GAAIqkE,EAAYpyC,GAAG,YAChDjY,gBAAiBsqD,EAAgBtkE,OAAS,GAAIskE,EAAgBryC,GAAG,YACjE/X,UAAWqqD,EAAevkE,OAAS,GAAIukE,EAAetyC,GAAG,aAIrDwyC,EAAe1oD,IAAwBC,EAAaD,EAAsBC,EAC1E0oD,EACJ3oD,IAAwBC,EACpB,IAAKwoD,KAAYJ,GACjBI,EAEAG,EAAW,CACfj0D,KAAMvL,OAAOuL,GACba,YAAa0iD,EAAOp/C,KAAK,qBAAqBjP,MAC9CgT,UAAW,UACXpK,QAASi2D,EACT5rD,MAAO6rD,EACP5rD,YAAam7C,EAAOp/C,KAAK,qBAAqBjP,MAC9C+K,QACA9G,SAAS,EACT8O,SAAUwH,SAAS8zC,EAAOp/C,KAAK,kBAAkBjP,MAAO,IACxDmT,YAAa,QAIf,GAAIirD,EAEF7rD,EAA2BoB,WAAWyqD,EAAYW,GAClD7xC,OAAOzX,QAAQ,aACV,CAEL,MAAMvF,EAAUqC,EAA2BT,cAAcitD,GACrD7uD,IACFkuD,EAAaluD,EAAQ3I,GACrB2lB,OAAOzX,QAAQ,SAEnB,CAGA44C,EAAO9sC,SAGHzhB,EAAE,wBAAwB1F,OAAS,GACrCg3D,IAEJ,GAGA,MAAMpD,EAAc,KAClBlrB,IAAiB,EACjBurB,EAAO9sC,SACP0L,MAIFohC,EAAOp/C,KAAK,iDAAiD+c,GAAG,QAASgiC,GAGzEK,EAAOriC,GAAG,QAAS,SAAUtwB,GACvBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,qBACvB0hC,GAEJ,GAGAluD,EAAEuG,UAAU2lB,GAAG,2BAA4B,SAAUtwB,GACrC,WAAVA,EAAErB,KAAoBg0D,EAAOj0D,QAAUi0D,EAAOhiC,GAAG,cACnD3wB,EAAEuyB,iBACF+/B,IACAluD,EAAEuG,UAAU0lB,IAAI,4BAEpB,GAEAjsB,EAAE,QAAQqxB,OAAOk9B,GAGjBM,sBAAsB,KACpB,MAAM4P,EAAYlQ,EAAOp/C,KAAK,qBAC1BsvD,EAAUnkE,QAAUmkE,EAAU,GAAG9P,aAAe,IAClD8P,EAAUlxC,IAAI,SAAUkxC,EAAU,GAAG9P,aAAe,SAM1D9kD,OAAOw0D,sBAAwBA,GAG/Bx0D,OAAOC,sBAAwBA,GAE/B,MAAMkyD,GAAoB,KACxB,MAAM,GAAQl8D,KACdE,EAAE,qBAAqB08D,IAAI,8BAA8Bj7C,SACzDuhB,IAAiB,EACjB,MAAM92B,EAASklB,KACTwgC,EAAoB,aAAa1lD,EAAOye,QAIxCu0C,GAHIt0C,KAGa3d,GAAMtK,IAAI,wBAAyB,CAAC,gBAErDw8D,EAAkBC,GAAWF,EAAel9D,SAASo9D,GAErDC,EAAyB,CAC7B,CAAE9kE,IAAK,WAAYyQ,KAAM,KAAME,KAAM,eACrC,CAAE3Q,IAAK,cAAeyQ,KAAM,OAAQE,KAAM,mBAC1C,CAAE3Q,IAAK,UAAWyQ,KAAM,QAASE,KAAM,mBAGnCo0D,EAAmB,MACvB,MAAMpmD,EAAU+F,IAAiBC,KAC3BgyC,EAASn7B,GAAgB7c,GAAW,CAAC,GACrCqmD,EAAav4B,MAAwB,GACrCw4B,EAAah4B,KAGnB,IAAIi4B,EAAW,GAcf,GAXAJ,EAAuB9jE,QAAQ6N,IAE7Bq2D,EAAShlE,KAAK,CAAEF,IAAK6O,EAAI7O,IAAKyQ,KAAM5B,EAAI4B,KAAME,KAAM9B,EAAI8B,KAAMw0D,WAAW,MAI3E/hE,OAAOC,KAAKszD,GAAQ31D,QAAQyP,IAC1By0D,EAAShlE,KAAK,CAAEF,IAAKyQ,EAAMA,KAAMA,EAAME,KAAMw7B,GAAoB17B,GAAO00D,WAAW,MAIjFH,EAAWjlE,OAAS,EAAG,CACzB,MAAMqlE,EAAW,IAAIzvD,IAAIqvD,EAAW5kE,IAAI,CAACwqB,EAAG/qB,IAAM,CAAC+qB,EAAG/qB,KACtDqlE,EAASvkE,KAAK,CAACC,EAAGC,KACHukE,EAASpyD,IAAIpS,EAAEZ,KAAOolE,EAASh9D,IAAIxH,EAAEZ,KAAO,OAC5ColE,EAASpyD,IAAInS,EAAEb,KAAOolE,EAASh9D,IAAIvH,EAAEb,KAAO,MAG7D,CAEA,OAAOklE,EACJ9kE,IAAIa,IACH,MAAMokE,EAAWJ,EAAWx9D,SAASxG,EAAKjB,KACpCslE,EAAerkE,EAAKkkE,UAAY,oBAAsB,GACtD1/C,EAAcxkB,EAAKwP,KACzB,MACE,qCACA60D,GACCD,EAAW,gBAAkB,IAC9B,sBACArgE,EAAW/D,EAAKjB,KAJhB,+FAQCqlE,EAAW,eAAiB,UAR7B,mEAYApkE,EAAK0P,KAZL,gDAeA3L,EAAWygB,GAhBN,gHAwBRle,KAAK,GACT,EA5DwB,GA6DnBg+D,EAAUV,GAAYD,EAAgBC,GAAW,kBAAoB,mBAErE7Q,EAASvuD,EAAE,yGAEyC4xD,i2BAgBbuN,EAAgB,cAAgB,GAAK,+IACzCW,EAAQ,uhBASnBj6B,GAAOlrC,IAAIsmC,GAAK,kBAAkBA,EAAEx5B,OAAOw5B,EAAEx5B,KAAOyE,EAAOye,MAAQ,WAAa,MAAMsW,EAAEj2B,iBAAiBlJ,KAAK,yaAQ9G8jC,GAAMjrC,IAAIo1D,GAAK,kBAAkBA,EAAEtoD,OAAOsoD,EAAEtoD,KAAOyE,EAAO+4B,WAAa,WAAa,MAAM8qB,EAAE/kD,iBAAiBlJ,KAAK,6mBASlFoK,EAAOi5B,kvBAUPj5B,EAAOy5B,gBAAkB,wkBASrBz5B,EAAOk5B,aAAe,UAAY,ySAQnD+5B,EAAgB,UAAY,GAAK,qJAErCW,EAAQ,gwBAUa5zD,EAAOg5B,0mBASM,aAAlBh5B,EAAO44B,OAAwB,WAAa,kFAC5B,aAAlB54B,EAAO44B,OAAwB,WAAa,ykBAS7B,GAAtB54B,EAAOq5B,YAAmB,WAAa,yEACjB,GAAtBr5B,EAAOq5B,YAAmB,WAAa,yEACjB,GAAtBr5B,EAAOq5B,YAAmB,WAAa,4EACb,SAAvBr5B,EAAOq5B,YAAyB,WAAa,0pBASlCr5B,EAAOm5B,gYASxB85B,EAAgB,YAAc,GAAK,uJAEvCW,EAAQ,slBAS2B,aAAxB5zD,EAAOs5B,aAA8B,WAAa,kFACvB,aAAxBt5B,EAAOs5B,aAA8B,WAAa,+fAQzB,QAA3Bt5B,EAAOo5B,gBAA4B,WAAa,2EACxB,QAA3Bp5B,EAAOo5B,gBAA4B,WAAa,ufAQvB,QAAzBp5B,EAAO64B,cAA0B,WAAa,4EACpB,SAAzB74B,EAAO64B,cAA2B,WAAa,4EACtB,SAAzB74B,EAAO64B,cAA2B,WAAa,yfAQrB,SAAzB74B,EAAO84B,cAA2B,WAAa,4EACvB,SAAzB94B,EAAO84B,cAA2B,WAAa,4PAOrDm6B,EAAgB,WAAa,GAAK,sJAEtCW,EAAQ,qmBASiD,IAA3B5zD,EAAOu5B,gBAA4B,UAAY,8QAIS,IAA3Bv5B,EAAOu5B,gBAA4B,GAAK,8VAKnC,IAAjCv5B,EAAOw5B,sBAAkC,UAAY,yTAQhFy5B,EAAgB,UAAY,GAAK,qJAErCW,EAAQ,klBAQvBR,sMAMmBH,EAAgB,cAAgB,GAAK,yJAEzCW,EAAQ,gjBAQnB7xD,EAAcC,gBACbvT,IACCyU,GACE,kBAAkB7P,EAAW6P,EAAE3H,QAAQ2H,EAAE3H,KAAOwG,EAAce,mBAAmBvH,GAAK,WAAa,MAAMlI,EAAW6P,EAAEpE,QAAQoE,EAAEtD,QAAU,QAAU,eAEvJhK,KAAK,usDAgBVgN,EAAsByC,cACrB5W,IAAIkU,IACH,MAAMkM,EAAWjQ,EAAe+D,EAAK5C,WAAa,CAChDjB,KAAM6D,EAAK5C,SACXf,KAAM,eAEFmnD,EAAiC,UAAnBt3C,EAAS9P,MACvB80D,EAAelxD,EAAKzI,UAC1B,MAAO,8EACgCyI,EAAK1K,QAAU,GAAK,6BAA6B5E,EAAWsP,EAAKpH,yFAC3DlI,EAAWwb,EAAS/P,QAAQqnD,EAAc,QAAU,wEACpEt3C,EAAS7P,2MAGD3L,EAAWsP,EAAK7D,yFACdzL,EAAWsP,EAAK9C,eAAe8C,EAAK7C,aAAe,IAAMzM,EAAWsP,EAAK7C,cAAgBqmD,EAAc,QAAU,oIAEnH0N,EAAe,SAAW,qBAAqBxgE,EAAWsP,EAAKpH,eAAes4D,EAAe,SAAW,yJAC3FxgE,EAAWsP,EAAKpH,wQAChCoH,EAAK1K,QAAU,SAAW,0FAC/B0K,EAAK1K,QAAU,eAAiB,gKAET5E,EAAWsP,EAAKpH,gJAIrE3F,KAAK,maASaq9D,EAAgB,SAAW,GAAK,oJAEpCW,EAAQ,qjBAQnBhsD,GAAmB5F,gBAClBvT,IACCyU,GACE,kBAAkB7P,EAAW6P,EAAE3H,QAAQ2H,EAAE3H,KAAOqM,GAAmB9E,mBAAmBvH,GAAK,WAAa,MAAMlI,EAAW6P,EAAEpE,kBAE9HlJ,KAAK,8xDAiBV2Q,EAA2BlB,cAC1B5W,IAAIkU,IACH,MAAM2iD,EACgB,WAApB3iD,EAAK5D,MAAMtE,KACP,WACoB,UAApBkI,EAAK5D,MAAMtE,KACT,WACA,aACF8qD,EACgB,WAApB5iD,EAAK5D,MAAMtE,KACP,KACoB,UAApBkI,EAAK5D,MAAMtE,KACTkI,EAAK5D,MAAM8H,YAAYjR,KAAK,KAC5B,GAAG+M,EAAK5D,MAAM8H,YAAYjR,KAAK,QAAQ+M,EAAK5D,MAAM+H,aAAalR,KAAK,OAC5E,MAAO,8EACgC+M,EAAK1K,QAAU,GAAK,6BAA6B5E,EAAWsP,EAAKpH,8FACtDlI,EAAWsP,EAAK5D,MAAMtE,2EAC3C6qD,wMAGQjyD,EAAWsP,EAAK7D,iHACUzL,EAAWkyD,QAAgBlyD,EAAWsP,EAAKqE,yJAExD3T,EAAWsP,EAAKpH,wQAChCoH,EAAK1K,QAAU,SAAW,0FAC/B0K,EAAK1K,QAAU,eAAiB,gKAET5E,EAAWsP,EAAKpH,gJAIrE3F,KAAK,6hBAWaq9D,EAAgB,YAAc,GAAK,uJAEvCW,EAAQ,wzHAsDrD9/D,EAAE,QAAQqxB,OAAOk9B,GAGjBA,EAAOp/C,KAAK,6BAA6B+c,GAAG,QAAS,WACnD,MAAM8zC,EAAShgE,EAAEjG,MAAMsyB,QAAQ,uBACzBC,EAAQ0zC,EAAO7wD,KAAK,4BAG1B,GAAImd,EAAME,SAAS,iBAAkB,OAErC,MAAM4yC,EAAUY,EAAOplE,KAAK,SACtBqlE,EAAWjgE,EAAEjG,MAAMoV,KAAK,sBAC9B,IAAI+wD,EAAWjzD,GAAMtK,IAAI,wBAAyB,CAAC,eAEnD,GAAIq9D,EAAOxzC,SAAS,aAAc,CAEhCwzC,EAAOtzC,YAAY,aACnBuzC,EAASvzC,YAAY,oBAAoBC,SAAS,mBAC7CuzC,EAASl+D,SAASo9D,IAAUc,EAASzlE,KAAK2kE,GAE/C9yC,EAAMK,SAAS,iBAAiB+X,OAChC,MAAMy7B,EAAe7zC,EAAM2hB,KAAK,gBAChC3hB,EAAMiB,IAAI,SAAU,GAAG6yC,QAAQ,CAAE9vC,OAAQ6vC,GAAgB,IAAK,WAC5DngE,EAAEjG,MAAMwzB,IAAI,SAAU,IAAIb,YAAY,gBACxC,EACF,KAAO,CAELszC,EAAOrzC,SAAS,aAChBszC,EAASvzC,YAAY,mBAAmBC,SAAS,oBACjDuzC,EAAWA,EAASn4D,OAAON,GAAMA,IAAO23D,GAExC,MAAMiB,EAAgB/zC,EAAMg0C,cAC5Bh0C,EACGK,SAAS,iBACTY,IAAI,SAAU8yC,GACdD,QAAQ,CAAE9vC,OAAQ,GAAK,IAAK,WAC3BtwB,EAAEjG,MAAM0yB,OAAOc,IAAI,SAAU,IAAIb,YAAY,gBAC/C,EACJ,CAEAzf,GAAMnK,IAAI,wBAAyBo9D,EACrC,GAIA3R,EAAOp/C,KAAK,cAAc+c,GAAG,SAAU,WACrC,MAAMq0C,EAAWvgE,EAAEjG,MAAMmG,MACzBgvD,GAAW,CAAEvkC,MAAO41C,IACpBhS,EACGp/C,KAAK,oBACLud,YAAYmZ,GAAOlrC,IAAIsmC,GAAK,aAAaA,EAAEx5B,MAAM3F,KAAK,MACtD6qB,SAAS,aAAa4zC,KAGzB,MAAMt/B,EAAIrW,KACV2jC,EAAOp/C,KAAK,2BAA2Boe,IAAI,CACzC9jB,WAAYw3B,EAAEtD,MACdlQ,YAAawT,EAAExD,OACfjQ,MAAOyT,EAAElW,UAEb,GAGAwjC,EAAOp/C,KAAK,oBAAoB+c,GAAG,SAAU,WAC3CgjC,GAAW,CAAEjqB,WAAYjlC,EAAEjG,MAAMmG,OACnC,GAGAquD,EAAOp/C,KAAK,2BAA2B+c,GAAG,QAAS,SAAUtwB,GAC3DA,EAAEuyB,iBACFvyB,EAAEuwB,kBACFoiC,EAAO9sC,SACPuhB,IAAiB,EACjB44B,IACF,GAGwB,MACtB,MAAM4E,EAAc9qC,KACpB64B,EAAOp/C,KAAK,2BAA2B8+B,KAAK,UAAWuyB,EAAYr8D,SACnEoqD,EAAOp/C,KAAK,oBAAoBjP,IAAIsgE,EAAYp8D,YAChDmqD,EAAOp/C,KAAK,0BAA0B0Q,KAAK2gD,EAAYp8D,WAAa,KAGpEmqD,EAAOp/C,KAAK,0BAA0Boe,IAAI,UAAWizC,EAAYr8D,QAAU,IAAM,OAGjFoqD,EAAOp/C,KAAK,2BAA2B+c,GAAG,SAAU,WAClD,MAAM/nB,EAAUnE,EAAEjG,MAAMk0C,KAAK,WACvBwyB,EAAgB/qC,KACtBC,GAAoB,IAAK8qC,EAAet8D,YACxCoqD,EAAOp/C,KAAK,0BAA0Boe,IAAI,UAAWppB,EAAU,IAAM,OACjEA,EACFipB,OAAOzX,QAAQ,WAEfyX,OAAOtnB,KAAK,UAEhB,GAGAyoD,EAAOp/C,KAAK,oBAAoB+c,GAAG,QAAS,WAC1C,MAAM5B,EAAQ7P,SAASza,EAAEjG,MAAMmG,MAAO,IACtCquD,EAAOp/C,KAAK,0BAA0B0Q,KAAKyK,EAAQ,IACrD,GAGAikC,EAAOp/C,KAAK,oBAAoB+c,GAAG,SAAU,WAC3C,MAAM5B,EAAQ7P,SAASza,EAAEjG,MAAMmG,MAAO,IAChCugE,EAAgB/qC,KACtBC,GAAoB,IAAK8qC,EAAer8D,WAAYkmB,GACtD,IAEFo2C,GAGAnS,EAAOp/C,KAAK,yBAAyB+c,GAAG,QAAS,SAAUtwB,GACzDA,EAAEuyB,iBACFvyB,EAAEuwB,kBACFgvC,IACF,GAGA5M,EAAOp/C,KAAK,eAAe+c,GAAG,SAAU,WACtCgjC,GAAW,CAAEpqB,OAAQ9kC,EAAEjG,MAAMmG,QAC7BitB,IACF,GACAohC,EAAOp/C,KAAK,kBAAkB+c,GAAG,SAAU,WACzCgjC,GAAW,CAAE3pB,YAAavlC,EAAEjG,MAAMmG,OACpC,GAGAquD,EAAOp/C,KAAK,iBAAiB+c,GAAG,SAAU,WACxCgjC,GAAW,CAAE1pB,aAAcxlC,EAAEjG,MAAMmG,QACnCitB,IACF,GACAohC,EAAOp/C,KAAK,mBAAmB+c,GAAG,SAAU,WAC1CgjC,GAAW,CAAE5pB,gBAAiBtlC,EAAEjG,MAAMmG,QACtCitB,IACF,GACAohC,EAAOp/C,KAAK,kBAAkB+c,GAAG,SAAU,WACzCgjC,GAAW,CAAEnqB,cAAe/kC,EAAEjG,MAAMmG,QACpCitB,IACF,GACAohC,EAAOp/C,KAAK,kBAAkB+c,GAAG,SAAU,WACzCgjC,GAAW,CAAElqB,cAAehlC,EAAEjG,MAAMmG,QACpCitB,IACF,GAGAohC,EAAOp/C,KAAK,iBAAiB+c,GAAG,SAAU,WACxC,MAAMixC,EAAUn9D,EAAEjG,MAAMwyB,GAAG,YAC3B2iC,GAAW,CAAEzpB,gBAAiB03B,IAC1BA,EAAS5O,EAAOp/C,KAAK,kBAAkByd,UAAU,KAChD2hC,EAAOp/C,KAAK,kBAAkB0d,QAAQ,KAC3CM,IACF,GACAohC,EAAOp/C,KAAK,kBAAkB+c,GAAG,SAAU,WACzCgjC,GAAW,CAAExpB,sBAAuB1lC,EAAEjG,MAAMwyB,GAAG,aACjD,GACAgiC,EAAOp/C,KAAK,YAAY+c,GAAG,SAAU,WACnCgjC,GAAW,CAAE9pB,aAAcplC,EAAEjG,MAAMwyB,GAAG,cACtCY,IACF,GAGAohC,EAAOp/C,KAAK,yBAAyB+c,GAAG,QAAS,SAAUtwB,GACzDA,EAAEuwB,kBACF,MAAM0B,EAAQ7tB,EAAEjG,MAAMsyB,QAAQ,2BACxB9vB,EAAYsxB,EAAMjzB,KAAK,cAC7B,IAAI4kE,EAAah4B,KACjB,MAAMpZ,EAAQpuB,EAAEjG,MAAMoV,KAAK,KAlrcNtK,MAorcjB26D,EAAWx9D,SAASzF,IAEtBijE,EAAaA,EAAWz3D,OAAO2S,GAAKA,IAAMne,GAC1CsxB,EAAMnB,YAAY,gBAClB0B,EAAM1B,YAAY,gBAAgBC,SAAS,YAG3C6yC,EAAW/kE,KAAK8B,GAChBsxB,EAAMlB,SAAS,gBACfyB,EAAM1B,YAAY,UAAUC,SAAS,iBA7rclB9nB,EAgscJ26D,EAhscSvyD,GAAMnK,IAAIY,EAA2BmB,GAisc/DsoB,IACF,GAGA,MAAMwzC,EAAQpS,EAAOp/C,KAAK,uBAC1B,IAAIyxD,EAAY,CACdxV,YAAY,EACZvS,QAAS,KACTgoB,MAAO,KACPtwC,OAAQ,GAGV,MAAMuwC,EAAiB,KACjBF,EAAUC,QACZh9C,aAAa+8C,EAAUC,OACvBD,EAAUC,MAAQ,MAEhBD,EAAU/nB,SACZ74C,EAAE4gE,EAAU/nB,SAASnsB,YAAY,gBAEnCi0C,EAAMxxD,KAAK,oCAAoCud,YAAY,iCAC3Dk0C,EAAUxV,YAAa,EACvBwV,EAAU/nB,QAAU,MAGhBkoB,EAAYlzC,IAChB+yC,EAAUxV,YAAa,EACvBwV,EAAU/nB,QAAUhrB,EAAM,GAC1BA,EAAMlB,SAAS,iBA+BjBg0C,EAAM,GAAGt2D,iBACP,cACA,SAAUzO,GACR,MAAMs0B,EAASt0B,EAAEuhB,OAAOkP,QAAQ,0BAChC,IAAK6D,EAAQ,OAEbt0B,EAAEuyB,iBACF,MAAMN,EAAQ7tB,EAAEkwB,GAAQ7D,QAAQ,2BAChCu0C,EAAUrwC,OAAS30B,EAAE6zB,QACrBsxC,EAAUlzC,GACVqC,EAAOC,kBAAkBv0B,EAAEw0B,UAC7B,EACA,CAAE84B,SAAS,IAIbyX,EAAM,GAAGt2D,iBAAiB,cAAe,SAAUzO,GACjD,MAAMJ,EAAOI,EAAEuhB,OAAOkP,QAAQ,2BAC9B,IAAK7wB,EAAM,OAEX,GAAII,EAAEuhB,OAAOkP,QAAQ,iDAAkD,OAEvEu0C,EAAUrwC,OAAS30B,EAAE6zB,QACrB,MAAM5B,EAAQ7tB,EAAExE,GAEhBolE,EAAUC,MAAQp9C,WAAW,KAC3Bs9C,EAAUlzC,IACT,IACL,GAGA8yC,EAAM,GAAGt2D,iBACP,cACA,SAAUzO,GAOR,GALIglE,EAAUC,OAASz7D,KAAKwqB,IAAIh0B,EAAE6zB,QAAUmxC,EAAUrwC,QAAU,IAC9D1M,aAAa+8C,EAAUC,OACvBD,EAAUC,MAAQ,OAGfD,EAAUxV,aAAewV,EAAU/nB,QAAS,OACjDj9C,EAAEuyB,iBAGF,MAAM3P,EAAQmiD,EAAMxxD,KAAK,2BAA2ButD,IAAI,iBACxD,IAAIsE,EAAa,KACbC,GAAe,EAEnBziD,EAAMoP,KAAK,WACT,MAAMg7B,EAAO7uD,KAAK8uD,wBACZrD,EAAOoD,EAAKxiB,IAAMwiB,EAAKt4B,OAAS,EAElC10B,EAAE6zB,QAAU+1B,IAASwb,GACvBA,EAAajnE,KACbknE,GAAe,GACNrlE,EAAE6zB,SAAWm5B,EAAKxiB,KAAOxqC,EAAE6zB,SAAWm5B,EAAKzc,SACpD60B,EAAajnE,KACbknE,EAAerlE,EAAE6zB,QAAU+1B,EAE/B,GAGAmb,EAAMxxD,KAAK,oCAAoCud,YAAY,iCACvDs0C,GAAcA,IAAeJ,EAAU/nB,SACzC74C,EAAEghE,GAAYr0C,SAASs0C,EAAe,iBAAmB,iBAE7D,EACA,CAAE/X,SAAS,IAIbyX,EAAM,GAAGt2D,iBAAiB,YAnGP,KACjB,IAAKu2D,EAAUxV,aAAewV,EAAU/nB,QAEtC,YADAioB,IAIF,MAAMI,EAAWlhE,EAAE4gE,EAAU/nB,SACvBsoB,EAAUR,EAAMxxD,KAAK,oCAAoCyQ,QAE/D,GAAIuhD,EAAQ7mE,QAAU6mE,EAAQ,KAAOP,EAAU/nB,QAAS,CAClDsoB,EAAQ30C,SAAS,kBACnB00C,EAASD,aAAaE,GAEtBD,EAASE,YAAYD,GAIvB,MAAME,EAAW,GACjBV,EAAMxxD,KAAK,2BAA2Bye,KAAK,WACzCyzC,EAAS5mE,KAAKuF,EAAEjG,MAAMa,KAAK,cAC7B,GACAqsC,GAAeo6B,EACjB,CAEAP,MA4EFH,EAAM,GAAGt2D,iBAAiB,gBAAiBy2D,GAG3CH,EAAM,GAAGt2D,iBACP,YACA,SAAUzO,GACJglE,EAAUxV,YACZxvD,EAAEuyB,gBAEN,EACA,CAAE+6B,SAAS,IAIbqF,EAAOp/C,KAAK,gBAAgBye,KAAK,WAC/B,MAAM4e,EAAWxsC,EAAEjG,MACb0N,EAAK+kC,EAAS5xC,KAAK,MACnB0R,EAAMmO,SAAS+xB,EAAS5xC,KAAK,QAC7ByK,EAAMoV,SAAS+xB,EAAS5xC,KAAK,QAC7B6xC,EAAOhyB,SAAS+xB,EAAS5xC,KAAK,SAC9BozB,EAASwe,EAASr9B,KAAK,sBAEvBu9B,EAAcxmB,IAClBA,EAAS9gB,KAAKC,IAAIiH,EAAKlH,KAAKkH,IAAIjH,EAAK6gB,IACrC,MAAMo7C,EAAc,iBAAP75D,EAAwB,GAAK,KAC1CumB,EAAOnO,KAAKqG,EAASo7C,GAGV,cAAP75D,GACFzH,EAAE,gBAAgButB,IAAI,mBAAoBrH,EAAS,MACnDgpC,GAAW,CAAEhqB,UAAWhf,KACR,kBAAPze,GACTzH,EAAE,gBAAgButB,IAAI,kBAAmBrH,EAAS,MAClDgpC,GAAW,CAAE/pB,SAAUjf,KACP,iBAAPze,GACTzH,EAAE,iDAAiDutB,IAAI,sBAAuBrH,EAAS,MACvFgpC,GAAW,CAAEvpB,eAAgBzf,KACb,iBAAPze,GACTynD,GAAW,CAAE7pB,aAAcnf,KAIzBymB,EAAkB,KACtB,MAAM9sB,EAAOmO,EAAOnO,OAAOngB,QAAQ,SAAU,IAC7C,OAAO+a,SAASoF,IAASvT,GAG3BkgC,EAASr9B,KAAK,oBAAoB+c,GAAG,QAAS,WAC5CwgB,EAAYC,IAAoBF,EAClC,GAEAD,EAASr9B,KAAK,oBAAoB+c,GAAG,QAAS,WAC5CwgB,EAAYC,IAAoBF,EAClC,EACF,GAGA8hB,EAAOriC,GAAG,QAAS,mBAAoB,SAAUtwB,GAC/CA,EAAEuwB,kBACF,MAAM8vC,EAAUj8D,EAAEjG,MACZ8zB,EAAQouC,EAAQ5vC,QAAQ,6BACxBza,EAASic,EAAMjzB,KAAK,WACpBwzB,EAAQ6tC,EAAQ9sD,KAAK,KACrBoyD,EAAoBtF,EAAQzvC,SAAS,UAG3C1d,EAAsB6C,kBAAkBC,GAAS2vD,GAG7CA,GACFtF,EAAQvvC,YAAY,UACpB0B,EAAM1B,YAAY,gBAAgBC,SAAS,iBAC3CkB,EAAMlB,SAAS,cAEfsvC,EAAQtvC,SAAS,UACjByB,EAAM1B,YAAY,iBAAiBC,SAAS,gBAC5CkB,EAAMnB,YAAY,YAEtB,GAGA6hC,EAAOriC,GAAG,QAAS,wCAAyC,SAAUtwB,GACpEA,EAAEuwB,kBACF,MAAMva,EAAS5R,EAAEjG,MAAMa,KAAK,WACfkU,EAAsByD,QAAQX,KAI3C28C,EAAO9sC,SACPiwC,GAA2B9/C,GAC7B,GAGA28C,EAAOriC,GAAG,QAAS,0CAA2C,SAAUtwB,GACtEA,EAAEuwB,kBACF,MAAMva,EAAS5R,EAAEjG,MAAMa,KAAK,WACtBizB,EAAQ7tB,EAAEjG,MAAMsyB,QAAQ,6BAE1BkiB,QAAQ,mBACNz/B,EAAsBmD,iBAAiBL,IACzCic,EAAM2zC,QAAQ,IAAK,WACjBxhE,EAAEjG,MAAM0nB,QACV,EAGN,GAGA8sC,EAAOriC,GAAG,QAAS,sBAAuB,SAAUtwB,GAClDA,EAAEuwB,kBACF,MAAMma,EAAOtmC,EAAEjG,MACT6X,EAAS00B,EAAK1rC,KAAK,WACnB2mE,EAAoBj7B,EAAK9Z,SAAS,UAEpC1d,EAAsBgD,oBAAoBF,GAAS2vD,KACjDA,EACFj7B,EAAK5Z,YAAY,UAAUiB,KAAK,QAAS,iBAEzC2Y,EAAK3Z,SAAS,UAAUgB,KAAK,QAAS,UAG5C,GAGA,MAAM8zC,EAAkB,KACtB3yD,EAAsBC,aACtB,MAAMN,EAAQK,EAAsByC,cACpC,IAAI4f,EAAO,GACX1iB,EAAMlT,QAAQsT,IACZ,MAAMkM,EAAWjQ,EAAe+D,EAAK5C,WAAa,CAAEjB,KAAM6D,EAAK5C,SAAUf,KAAM,eACzEmnD,EAAiC,UAAnBt3C,EAAS9P,MACvB80D,EAAelxD,EAAKzI,UAC1B+qB,GAAQ,oDACiCtiB,EAAK1K,QAAU,GAAK,6BAA6B5E,EAAWsP,EAAKpH,6DAC7DlI,EAAWwb,EAAS/P,QAAQqnD,EAAc,QAAU,0CACtEt3C,EAAS7P,qHAGD3L,EAAWsP,EAAK7D,2DACdzL,EAAWsP,EAAK9C,eAAe8C,EAAK7C,aAAe,IAAMzM,EAAWsP,EAAK7C,cAAgBqmD,EAAc,QAAU,4EAEjH0N,EAAe,SAAW,qBAAqBxgE,EAAWsP,EAAKpH,eAAes4D,EAAe,SAAW,6HAC3FxgE,EAAWsP,EAAKpH,4OAChCoH,EAAK1K,QAAU,SAAW,4DACjC0K,EAAK1K,QAAU,eAAiB,wGAEP5E,EAAWsP,EAAKpH,oFAGtE8mD,EAAOp/C,KAAK,0BAA0BgiB,KAAKA,IAI7Co9B,EAAOp/C,KAAK,kBAAkB+c,GAAG,SAAU,WACrCje,EAAcoB,gBAAgBrP,EAAEjG,MAAMmG,QACxCuhE,GAEJ,GAGAlT,EAAOp/C,KAAK,mBAAmB+c,GAAG,QAAS,WACzC,MAAM7d,EAASJ,EAAce,kBAC7B,IAAKX,EAAQ,OACb,MAAMkB,EAAYtB,EAAcyB,gBAAgBrB,EAAO5G,IACnD8H,IACFg/C,EACGp/C,KAAK,kBACLkiB,OAAO,kBAAkB9xB,EAAWgQ,EAAU9H,QAAQlI,EAAWgQ,EAAUvE,kBAC9EujD,EAAOp/C,KAAK,kBAAkBjP,IAAIqP,EAAU9H,IAAI5G,QAAQ,UAE5D,GAGA0tD,EAAOp/C,KAAK,mBAAmB+c,GAAG,QAAS,WACzC,MAAMlhB,EAAO02D,OAAO,YAAa,QACjC,IAAK12D,GAAM7K,OAAQ,OACnB,MAAMoP,EAAYtB,EAAcqB,aAAatE,EAAK7K,QAC9CoP,IACFg/C,EACGp/C,KAAK,kBACLkiB,OAAO,kBAAkB9xB,EAAWgQ,EAAU9H,QAAQlI,EAAWgQ,EAAUvE,kBAC9EujD,EAAOp/C,KAAK,kBAAkBjP,IAAIqP,EAAU9H,IAAI5G,QAAQ,UAE5D,GAGA0tD,EAAOp/C,KAAK,mBAAmB+c,GAAG,QAAS,WACzC,MAAM7d,EAASJ,EAAce,kBACxBX,IACa,YAAdA,EAAO5G,GAIN8mC,QAAQ,UAAUlgC,EAAOrD,YAC1BiD,EAAc0B,aAAatB,EAAO5G,MACpC8mD,EAAOp/C,KAAK,gCAAgCd,EAAO5G,QAAQga,SAC3D8sC,EAAOp/C,KAAK,kBAAkBjP,IAAI,WAAWW,QAAQ,WANjDgJ,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,YAQ7C,GAGAo8B,EAAOp/C,KAAK,sBAAsB+c,GAAG,QAAS,WAC5C,MAAM7d,EAASJ,EAAce,kBAC7B,IAAKX,EAAQ,OACb,MAAMmC,EAAOvC,EAAc6B,aAAazB,EAAO5G,IAC/C,GAAI+I,EAEF,IACE,MAAM4rD,EAAW,yBAAyB/tD,EAAOrD,MAAQqD,EAAO5G,MAAMvL,KAAKC,aACrEshB,EAAO,IAAIwvC,KAAK,CAACz8C,GAAO,CAAE7J,KAAM,qBAChCsX,EAAMJ,IAAIK,gBAAgBT,GAC1BtiB,EAAIoL,SAAS8C,cAAc,KACjClO,EAAE+xD,KAAOjvC,EACT9iB,EAAEgyD,SAAWiP,EACb71D,SAASyD,KAAKC,YAAY9O,GAC1BA,EAAEoxC,QACFhmC,SAASyD,KAAKojD,YAAYjyD,GAC1B0iB,IAAIC,gBAAgBG,EACtB,CAAE,MAAOriB,GAEPsqC,UAAUD,UACP23B,UAAUptD,GACVyhB,KAAK,QACLG,MAAM,KACLsvC,OAAO,UAAWlxD,IAExB,CAEJ,GAGA+9C,EAAOp/C,KAAK,sBAAsB+c,GAAG,QAAS,WAC5C,MAAM1b,EAAOkxD,OAAO,cACpB,IAAKlxD,GAAMrQ,OAAQ,OACnB,MAAMkU,EAASpG,EAAcsC,aAAaC,EAAKrQ,QAAQ,GACvD,GAAIkU,GAAUA,EAAOhG,OAAQ,CAC3B,MAAMkB,EAAY8E,EAAOhG,OACzBkgD,EACGp/C,KAAK,kBACLkiB,OAAO,kBAAkB9xB,EAAWgQ,EAAU9H,QAAQlI,EAAWgQ,EAAUvE,kBAC9EujD,EAAOp/C,KAAK,kBAAkBjP,IAAIqP,EAAU9H,IAAI5G,QAAQ,UAEpDwT,EAAO1D,YAEP49B,QACE,yDAGEtgC,EAAc8B,wBAAwBR,EAAU9H,KAC9CoC,OAAOujB,QAAQvjB,OAAOujB,OAAOzX,QAAQ,gBACzC8rD,KAEI53D,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,QAI/C,MACM8D,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,aAE3C,GAGAwoD,EAAOp/C,KAAK,qBAAqB+c,GAAG,QAAS,WACtCqiB,QAAQ,wCACTtgC,EAAcoD,qBAE4B,YAAxCpD,EAAce,mBAAmBvH,IACnCg6D,IAGE53D,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,QAE3C,GAGAwoD,EAAOriC,GAAG,QAAS,qCAAsC,WACvD,MACMta,EADQ5R,EAAEjG,MAAMsyB,QAAQ,6BACTzxB,KAAK,WACpB+mE,EAAelvD,EAA2BlB,cAAcpC,KAAKT,GAAKA,EAAEjH,KAAOmK,IAASzN,QACpFk5D,GAAYsE,EACLlvD,EAA2BF,QAAQX,GAEhDa,EAA2Bd,kBAAkBC,EAAQyrD,GAEjDA,EACFjwC,OAAOzX,QAAQ,SAEfyX,OAAOtnB,KAAK,SAGdwrD,IACF,GAGA/C,EAAOriC,GAAG,QAAS,mCAAoC,WACrD,MACMta,EADQ5R,EAAEjG,MAAMsyB,QAAQ,6BACTzxB,KAAK,WACb6X,EAA2BF,QAAQX,KAIhD28C,EAAO9sC,SACP48C,GAAsBzsD,GACxB,GAGA28C,EAAOriC,GAAG,QAAS,qCAAsC,WACvD,MACMta,EADQ5R,EAAEjG,MAAMsyB,QAAQ,6BACTzxB,KAAK,WACpBiU,EAAO4D,EAA2BF,QAAQX,GAC3C/C,GAED0/B,QAAQ,WAAW1/B,EAAK7D,aAC1ByH,EAA2BmB,WAAWhC,GACtC0/C,KACAlkC,OAAOzX,QAAQ,SAEnB,GAGA44C,EAAOp/C,KAAK,wBAAwB+c,GAAG,SAAU,WAC/C,MAAMlc,EAAWhQ,EAAEjG,MAAMmG,MACzB4T,GAAmBzE,gBAAgB5P,OAAOuQ,IAE1Cod,OAAOzX,QAAQ,SAEf27C,IACF,GAGA/C,EAAOp/C,KAAK,yBAAyB+c,GAAG,QAAS,WAC/C,MAAM01C,EAAgB9tD,GAAmB9E,kBACzC,IAAK4yD,EAAe,OAEpB,MAAM52D,EAAO02D,OAAO,YAAa,GAAGE,EAAc52D,aAClD,IAAKA,EAAM,OAEX,MAAMuE,EAAYuE,GAAmBxE,aAAatE,EAAM42D,EAAcn6D,IACtE,GAAI8H,EAAW,CAEb,MAAMsyD,EAAgBtT,EAAOp/C,KAAK,wBAClC0yD,EAAcxwC,OAAO,kBAAkB9xB,EAAWgQ,EAAU9H,QAAQlI,EAAWgQ,EAAUvE,kBACzF62D,EAAc3hE,IAAIqP,EAAU9H,IAE5B6pD,KACAlkC,OAAOzX,QAAQ,QACjB,MACEyX,OAAOrnB,MAAM,UAEjB,GAGAwoD,EAAOp/C,KAAK,yBAAyB+c,GAAG,QAAS,WAC/C,MAAMlhB,EAAO02D,OAAO,YACpB,IAAK12D,EAAM,OAEX,MAAMuE,EAAYuE,GAAmBxE,aAAatE,EAAM,MACxD,GAAIuE,EAAW,CACbuE,GAAmBzE,gBAAgBE,EAAU9H,IAG7C,MAAMo6D,EAAgBtT,EAAOp/C,KAAK,wBAClC0yD,EAAcxwC,OAAO,kBAAkB9xB,EAAWgQ,EAAU9H,QAAQlI,EAAWgQ,EAAUvE,kBACzF62D,EAAc3hE,IAAIqP,EAAU9H,IAE5B6pD,KACAlkC,OAAOzX,QAAQ,QACjB,MACEyX,OAAOrnB,MAAM,UAEjB,GAGAwoD,EAAOp/C,KAAK,yBAAyB+c,GAAG,QAAS,WAC/C,MAAM01C,EAAgB9tD,GAAmB9E,kBACzC,GAAK4yD,GAEDrzB,QAAQ,WAAWqzB,EAAc52D,WAAY,CAE/C,GADgB8I,GAAmBnE,aAAaiyD,EAAcn6D,IACjD,CAEX,MAAMo6D,EAAgBtT,EAAOp/C,KAAK,wBAClC0yD,EAAc1yD,KAAK,iBAAiByyD,EAAcn6D,QAAQga,SAG1D,MAAMqgD,EAAkBhuD,GAAmB9E,mBAAmBvH,GAC1Dq6D,GACFD,EAAc3hE,IAAI4hE,GAGpBxQ,KACAlkC,OAAOzX,QAAQ,QACjB,MACEyX,OAAOrnB,MAAM,aAEjB,CACF,GAGAwoD,EAAOp/C,KAAK,4BAA4B+c,GAAG,QAAS,WAClD,MAAM01C,EAAgB9tD,GAAmB9E,kBACzC,IAAK4yD,EAAe,OAEpB,MAAMpxD,EAAOsD,GAAmBhE,aAAa8xD,EAAcn6D,IAC3D,GAAI+I,EAAM,CACR,MAAMiN,EAAO,IAAIwvC,KAAK,CAACz8C,GAAO,CAAE7J,KAAM,qBAChCsX,EAAMJ,IAAIK,gBAAgBT,GAC1BtiB,EAAIoL,SAAS8C,cAAc,KACjClO,EAAE+xD,KAAOjvC,EACT9iB,EAAEgyD,SAAW,gBAAgByU,EAAc52D,QAAQ9O,KAAKC,aACxDhB,EAAEoxC,QACF1uB,IAAIC,gBAAgBG,GACpBmP,OAAOzX,QAAQ,QACjB,CACF,GAGA44C,EAAOp/C,KAAK,4BAA4B+c,GAAG,QAAS,WAClD,MAAMqvC,EAAQh1D,SAAS8C,cAAc,SACrCkyD,EAAM50D,KAAO,OACb40D,EAAMwG,OAAS,mBACfxG,EAAMyG,SAAW/gD,MAAMrlB,IACrB,MAAM8vD,EAAQ9vD,EAAEuhB,OAA4BwuC,QAAQ,GACpD,GAAKD,EAEL,IACE,MAAM7rC,QAAa6rC,EAAK7rC,OAClBxR,EAASyF,GAAmBvD,aAAasP,GAC/C,GAAIxR,EAAQ,CAEV,MAAMwzD,EAAgBtT,EAAOp/C,KAAK,wBAClC0yD,EAAcxwC,OAAO,kBAAkB9xB,EAAW8O,EAAO5G,QAAQlI,EAAW8O,EAAOrD,kBACnF62D,EAAc3hE,IAAImO,EAAO5G,IAEzB6pD,KACAlkC,OAAOzX,QAAQ,QACjB,MACEyX,OAAOrnB,MAAM,SAEjB,CAAE,MAAOssB,GACPjF,OAAOrnB,MAAM,SAAYssB,EAAcjoB,QACzC,GAEFmxD,EAAMhvB,OACR,GAGAgiB,EAAOp/C,KAAK,uBAAuB+c,GAAG,QAAS,WAC7CqiC,EAAO9sC,SACPuhB,IAAiB,EACjBq7B,IACF,GAGA9P,EAAOp/C,KAAK,0BAA0B+c,GAAG,QAASjL,iBAChD,MAAMqlB,EAAOtmC,EAAEjG,MACTm0C,EAAe5H,EAAKnV,OAE1B,IAEEmV,EAAK2H,KAAK,YAAY,GAAM9c,KAAK,sDAGjC,IAAIza,EAAYuI,IAAiBC,KAEjC,IAAKxI,EAEH,YADA0W,OAAOrnB,MAAM,YAKf,GAAyB,iBAAd2Q,GAA0B5X,MAAMqO,QAAQuJ,GAGjD,OAFA0W,OAAOrnB,MAAM,gBACbrK,QAAQqK,MAAM,uBAAwB2Q,EAAW5X,MAAMqO,QAAQuJ,IAKjE,MAAMurD,EAAexvD,EAA2BV,kBAEhD,GAA4B,IAAxBkwD,EAAa3nE,OAEf,YADA8yB,OAAO+E,QAAQ,WAIjBz2B,QAAQoK,KAAK,cAAcm8D,EAAa3nE,iBAGxC,MAAM,aAAEqc,EAAY,OAAEC,GAAW1C,GAA0BuC,aAAaC,EAAWurD,GAGnFhjD,GAAgBvI,QAGVs4C,GAAmBt4C,GAAW,GAAO,GAEvCE,EAAOtc,OAAS,GAClB8yB,OAAO+E,QAAQ,OAAOxb,SAAoBC,EAAOtc,cACjDoB,QAAQG,KAAK,gBAAiB+a,IAE9BwW,OAAOzX,QAAQ,OAAOgB,SAGxBjb,QAAQoK,KAAK,iBACf,CAAE,MAAOlK,GACP,MAAM8b,EAAW9b,aAAa2L,MAAQ3L,EAAEwO,QAAU3K,OAAO7D,GACzDF,QAAQqK,MAAM,kBAAmBnK,GACjCwxB,OAAOrnB,MAAM,SAAS2R,IACxB,C,QAEE4uB,EAAK2H,KAAK,YAAY,GAAO9c,KAAK+c,EACpC,CACF,GAGAqgB,EAAOp/C,KAAK,4BAA4B+c,GAAG,QAAS,WAClDwlC,GAA2BnD,EAC7B,GAGAA,EAAOp/C,KAAK,2BAA2B+c,GAAG,QAAS,SAAUtwB,GAC3DA,EAAEuyB,iBACFvyB,EAAEuwB,kBACFoiC,EAAO9sC,SACPuhB,IAAiB,EACjBl5B,IACF,GAGA,MAAMokD,EAAc,KAClBlrB,IAAiB,EACjBurB,EAAO9sC,SACP0L,MAEFohC,EAAOriC,GAAG,QAAS,oDAAqDgiC,GAGxEK,EAAOriC,GAAG,QAAS,gBAAiB,SAAUtwB,GAC5CA,EAAEuwB,kBACFtiB,OAAOkT,KAAK,iDAAkD,SAChE,GACAwxC,EAAOriC,GAAG,QAAS,SAAUtwB,GACvBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,qBAAqB0hC,GAChD,IAIF,IAAIgU,GAAuB,KACvBC,IAAyB,EAE7B,MAAMh1C,GAAkB,KAElB6V,GACGm/B,KACHzmE,QAAQoK,KAAK,wBACbq8D,IAAyB,IAMzBD,IACFr+C,aAAaq+C,IAIfA,GAAuBz+C,WAAW,KAChCy+C,GAAuB,KACvBC,IAAyB,EACzBC,MACC,MAICA,GAAuB,KAC3B1mE,QAAQoK,KAAK,mBACb,MAAM,GAAQhG,KAGd,IAAKojC,IAAYljC,EAAE,SAAS1F,OAAQ,CAClC,MAAM+nE,EAAQriE,EAAE,SAChB,IAAIsiE,GAAe,EA+CnBp/B,GAAW,IAAIq/B,iBA9CQ,KACjBD,IACJA,GAAe,EACfzT,sBAAsB,KAEpB,GAA4B,aADbz9B,KACJoU,aAET,YADA88B,GAAe,GAGjB,MACME,EADWH,EAAMI,WACIC,OAAO,GAC5BC,EAAU3iE,EAAE,gBAAgB,GAC9B2iE,GAAWH,GAAaA,IAAcG,IACpC3iE,EAAEwiE,GAAWh2C,SAAS,QAAUxsB,EAAEwiE,GAAWh2C,SAAS,kBACxD61C,EAAMhxC,OAAOsxC,GAKjB,MAAMniE,EAAUC,KAChB,GAAID,GAAWA,EAAQuyB,qBAAsB,CAE3C,MACMyvC,EADWH,EAAMI,WACIC,QACvBF,EAAUh2C,SAAS,QAAUg2C,EAAUh2C,SAAS,kBAClDg2C,EAAU71C,SAAS,6BAIrBkiC,sBAAsB,KACpBx7B,KAGAw7B,sBAAsB,KACpB2T,EAAU91C,YAAY,6BAA6BC,SAAS,4BAE5DlJ,WAAW,KACT++C,EAAU91C,YAAY,6BACrB,QAGT,CAEA41C,GAAe,OAInBp/B,GAAS0/B,QAAQP,EAAM,GAAI,CAAEQ,WAAW,GAC1C,CACA,IAAI3pD,EACA4pD,GAAqB,EACzB,GAAI1/B,IAAqBnkB,GACvB/F,EAAU+F,OACL,CAKL,GAJA/F,EAAUgG,KACV4jD,GAAqB,EAGjB5pD,EAAS,CACX,IAAI6pD,GAAiB,EACrB,IAAK,MAAM3pD,KAAWF,EAAS,CAC7B,IAAKE,EAAQ5e,WAAW,UAAW,SACnC,MAAMwc,EAAQkC,EAAQE,GACtB,IAAKpC,IAAUA,EAAMhM,OAASgM,EAAM5P,QAAS,SAE7C,MAAMiN,EAAS9a,EAAY0E,WAAW+Y,EAAMhM,KAAMgM,EAAM5P,SACpDiN,EAAOjW,WACT2kE,GAAiB,GAEf1uD,EAAOhW,SAAS/D,MAEtB,CAGF,CAKA,GAAI4e,IAAYmqB,IAAsBy/B,EACpC,IACE,MAAMb,EAAexvD,EAA2BV,kBAEhD,GAAIkwD,EAAa3nE,OAAS,EAAG,CAC3BoB,QAAQoK,KAAK,oBAAoBm8D,EAAa3nE,iBAE9C+oC,IAAqB,EACrB,MAAM2/B,EAAkB9uD,GAA0BuC,aAAayC,EAAS+oD,GACpEe,EAAgBrsD,aAAe,IACjCjb,QAAQoK,KAAK,oBAAoBk9D,EAAgBrsD,oBAMjD+yB,GAAaxwB,GAASkZ,MAAMC,IAC1B32B,QAAQG,KAAK,qBAAsBw2B,MAGnC2wC,EAAgBpsD,OAAOtc,OAAS,EAClCoB,QAAQG,KAAK,gBAAgBmnE,EAAgBpsD,OAAOtc,cAAe0oE,EAAgBpsD,QACzC,IAAjCosD,EAAgBrsD,cACzBjb,QAAQoK,KAAK,gCAEfu9B,IAAqB,CACvB,MACEA,IAAqB,CAEzB,CAAE,MAAO4/B,GACP5/B,IAAqB,EACJ4/B,aAA0B17D,MAAQ07D,EAAe74D,QAAU3K,OAAOwjE,GACnFvnE,QAAQqK,MAAM,gBAAiBk9D,EACjC,CAGF,GAAI/pD,EAAS,CACX+F,GAC6B,mBAApBikD,gBAAiCA,gBAAgBhqD,GAAWre,KAAKC,MAAMD,KAAKwB,UAAU6c,IAE/F,MAAMiqD,EAAmBn/B,KACnBoD,EAAaptC,KAGbopE,EACJD,GAAoBxlE,OAAOC,KAAKulE,GAAkBr1D,KAAKqX,GAAKA,EAAE3qB,WAAW,WAEtE2oE,GAAqBC,EAGdD,EAAiB97B,WAGlB87B,EAAiB97B,aAAeD,IAEzCnoB,GAAcooB,WAAaD,EAC3BE,GAAaroB,KAJbqoB,GAAa,IAAK67B,EAAkB97B,WAAYD,IAHhDE,GAAa,IAAKroB,GAAeooB,WAAYD,GAUjD,CACF,CAEA,MAAMi8B,EAAerjE,EAAE,qBACvB,GAAIA,EAAE,gBAAgB1F,QAAU+oE,EAAa92C,GAAG,WAC1CrT,EAAS,CACN4pB,KAAUG,GAAiBmsB,GAAgBl2C,IAChD,MAAMg4C,EAASn7B,GAAgB7c,GACzBoqD,EAAYp2C,KACZq2C,EAAiBD,GAAapS,EAAOoS,GAAaA,EAAY,KAEpE,GAAIC,GAAkBrS,EAAOqS,GAAiB,CAC5C,MAAMC,EAAUC,GAAmBvS,EAAOqS,GAAiBA,GACrDG,EAAc1jE,EAAE,SAASmxB,KAAKqyC,GAMpC,OALAxjE,EAAE,kBAAkB2jE,YAAYD,EAAYv0D,KAAK,mBACjDnP,EAAE,oBAAoBmxB,KAAKuyC,EAAYv0D,KAAK,oBAAoBgiB,QAEhErF,GAAWolC,QACX0S,IAEF,CACF,CAGF,IAAIC,EAAc,EACdC,EAAc,EAElB,MAAMC,EAAc/jE,EAAE,sBAClB+jE,EAAYzpE,SACdupE,EAAcE,EAAYC,aAC1BF,EAAcC,EAAYE,aAG5BjkE,EAAE,gBAAgByhB,SAClB,MAAMyvC,EAASn7B,GAAgB7c,GAAW,CAAC,GAGzC+pB,GADEH,GACe,IAAI11B,IAEJgiD,GAAgBl2C,GAGnC,MAAMqmD,EAAav4B,KACnB,IAAIk9B,EAAevmE,OAAOC,KAAKszD,GAC3BqO,IACF2E,EAAe3E,EAAWx3D,OAAO2S,GAAKw2C,EAAOx2C,IAAIypD,OAAOD,EAAan8D,OAAO2S,IAAM6kD,EAAWv9D,SAAS0Y,MAExG,MAAM8kD,EAAah4B,KACnB08B,EAAeA,EAAan8D,OAAO2S,IAAM8kD,EAAWx9D,SAAS0Y,IAE7D,MAAM4oD,EAAYp2C,KAClB,IAAIq2C,EAAiBD,GAAapS,EAAOoS,KAAe9D,EAAWx9D,SAASshE,GAAaA,EAAY,KAErG,MAAMp3D,EAASklB,KACTgzC,EAAcl9B,KAEdm9B,EAAgC,aAAlBn4D,EAAO44B,OAAwB,sBAAwB,GAErET,EAAgB,YAAYn4B,EAAOs5B,cAAgB,UAGzD,IAAI8+B,EAAgBp4D,EAAOq5B,YAC3B,GAAsB,SAAlB++B,EAA0B,CAC5B,MAAM5pD,EAAIwpD,EAAa5pE,OAEvB,GAAIogB,GAAK,EACP4pD,EAAgB5pD,EAAI,EAAI,EAAIA,MACvB,CACL,MAAM6pD,EAA4B,EAAnBn/D,KAAK62C,KAAKvhC,EAAI,GAASA,EAEtC4pD,EADkC,EAAnBl/D,KAAK62C,KAAKvhC,EAAI,GAASA,GACZ6pD,EAAS,EAAI,CACzC,CACF,CAGA,IAAIC,EAAa,GACbC,EAAoB,KAExB,IAA+B,IAA3Bv4D,EAAOu5B,gBAA2B,CACpC,MAAMi/B,EAAe,GAMrB,GALA/mE,OAAOC,KAAKszD,GAAQ31D,QAAQ4pB,IACtBA,EAAEnjB,SAAS,OAAO0iE,EAAajqE,KAAKy2D,EAAO/rC,MAI7Cu/C,EAAapqE,OAAS,EAAG,CAC3B,MAAM8pE,EAAcl9B,KAIpB,IAAIy9B,EAAc,2JAHFP,EAAc,eAAiB,uMAC9BA,EAAc,OAAS,2CASpCQ,GAAU,EAEVC,EAAe,GAEnBH,EAAanpE,QAAQusD,IACfA,EAAMxwC,MACRwwC,EAAMxwC,KAAK/b,QAAQiB,IACjBA,EAAIjB,QAAQ,CAACyc,EAAMpb,KACjB,GAAIA,EAAM,GAAKob,GAAQvY,OAAOuY,GAAM7X,OAAQ,CAC1C,MAAM2kE,EAAUrlE,OAAOuY,GAAM7X,OAC7BwkE,GAAe,yCAAyCI,mBAAmBD,OAAavlE,EAAWulE,cACnGD,EAAapqE,KAAKqqE,GAClBF,GAAU,CACZ,QAMJA,IACFJ,EAAa,iCAAiCG,UAG9CF,EAAoBI,EAAa/iE,KAAK,QAAUsiE,EAAc,aAAe,aAEjF,CACF,CAGA,MAAMY,EAAgBP,IAAsBjhC,GACxCwhC,GAAuC,OAAtBP,IAEnBhhC,IAAqB,GAEvBD,GAAiBihC,EAEjB,IAAItzC,EAAO,2BAA2BkT,eAA2Bn4B,EAAOye,SAAS05C,8BAAwCn4D,EAAOg5B,gCAAgCh5B,EAAOi5B,mCAAmCj5B,EAAOy5B,gBAAkB,yBAAyB2+B,MAQ5P,GAJ4B,aAAxBp4D,EAAOs5B,cAA+Bg/B,GAAc/gC,KACtDtS,GAAQqzC,GAGNJ,EAAa,CACf,MAAMa,EAAgB,WAAW/4D,EAAO64B,eAAiB,QACnDmgC,EAAa,aAAah5D,EAAO84B,eAAiB,UACxD7T,GAAQ,oDACmC8zC,KAAiBC,+FACGvnE,OAAOC,KAAKszD,GAAQ52D,sDAGrF,KAAO,CAEL,MAAM6qE,EAAc5B,EAAiBxyC,KAAkBwyC,GAAkB,KAEnE6B,EAAoBn4D,GAAMtK,IAAIY,GAA8B,GAC5D8hE,EAAuBp4D,GAAMtK,IAAI,4BAA4B,GAC7D2iE,EAAcp4C,OAAwBpK,GAAUC,UAEhDwiD,GADiBD,EAAcv0C,KAAkBjO,GAAUC,WAAa,OACnCoiD,EAG3Ch0C,GAAQ,kDAFgBi0C,GAAqBC,GAAwBC,GAAe/B,EAGzB,UAAY,MAAMgC,EAAmB,kBAAoB,iCAAiCA,EAAmB,UAAYA,EAAmB,MAAQ,6BAE/LF,EACIG,GAAmBtsD,GACnBksD,EACEK,GAAgBvU,GAChBoU,EACE,8BAAgCxiD,GAAUqG,cAAgB,SAC1Do6C,EACEE,GAAmBvS,EAAOqS,GAAiBA,GAC3C,+CAO1B,MAAMmC,EAAe,iCAAiCpB,WAEtDnzC,GAAQ,mDAC6D,QAA3BjlB,EAAOo5B,gBAA4B,cAAgB,+BAA+BogC,2JAK5H,MAAMC,EAAkB14D,GAAMtK,IAAI,4BAA4B,GACxDijE,EAAkB34D,GAAMtK,IAAIkI,GAA6B,GAC/D,IAAIg7D,EAAe,EACfC,EAAuB,EAC3B,GAAI5sD,EAAS,CACX,MAAM3b,EAAWymC,KACjB,GAAIzmC,EAAU,CACZ,IAAK,MAAM6b,KAAWF,EAAS,CAC7B,IAAKE,EAAQ5e,WAAW,UAAW,SACnC,MAAMygB,EAAW/B,EAAQE,GACnB4B,EAAWzd,EAAS6b,GAC1B,IAAK6B,GAAU7T,QAAS,SACxB,MAAMqoD,EAAUx0C,EAAS7T,QAAQ9L,MAAM,GACjCo0D,EAAU10C,GAAU5T,SAAS9L,MAAM,IAAM,GAC/Cm0D,EAAQl0D,QAAQ,CAACiB,EAAK2e,KACpB,MAAMw0C,EAASD,EAAQv0C,GAClBw0C,EAILnzD,EAAIjB,QAAQ,CAACyc,EAAMnZ,KACF,IAAXA,GACAY,OAAOuY,GAAQ,MAAQvY,OAAOkwD,EAAO9wD,IAAW,KAAKgnE,MALzDA,MAQAnW,EAAQp1D,OAASm1D,EAAQn1D,SAAQurE,GAAgBnW,EAAQp1D,OAASm1D,EAAQn1D,OAChF,CACA,IAAK,MAAM8e,KAAW7b,EAChB6b,EAAQ5e,WAAW,YAAc0e,EAAQE,IAAUysD,GAE3D,CAEAC,EAAuBvtD,GAAiB2D,cAAchD,EACxD,CAEA,MACM6sD,EADmBH,EACeE,EAAuBD,EAEzDG,EAHmBJ,GAGmBE,EAAuB,EAG7DG,EAAgBz+B,KAChB0+B,EAAgBl/B,MAAwB,GAGxCm/B,EAAoB,CACxB,CAAE5rE,IAAK,WAAY2Q,KAAM,cAAeiyB,MAAO,KAAM11B,GAAI,mBAAoB2+D,WAAY,oBACzF,CACE7rE,IAAK,cACL2Q,KAAM,kBACNiyB,MAAO,MAAK4oC,EAAe,EAAI,IAAMA,EAAe,IAAM,IAC1Dt+D,GAAI,kBACJ2+D,WAAY,mBAAkBJ,EAAkB,yBAA2B,IAC3E98C,SAAUy8C,EACVjmC,YAAasmC,GAEf,CACEzrE,IAAK,UACL2Q,KAAM,iBACNiyB,MAAO,KACP11B,GAAI,cACJ2+D,WAAY,cACZl9C,SAAUgE,OAAwBpK,GAAUC,YAKhD,IAAIsjD,EAAc,GA8BlB,GA3BAF,EAAkB5qE,QAAQC,IAEpByqE,EAAcjkE,SAASxG,EAAKjB,MAGf,YAAbiB,EAAKjB,KAMLiB,EAAK8qE,iBAAmB9qE,EAAK8qE,kBAL/BD,EAAY5rE,KAAK,IAAKe,EAAMkkE,WAAW,MAU3CwE,EAAa3oE,QAAQyP,IACnBq7D,EAAY5rE,KAAK,CACfF,IAAKyQ,EACLE,KAAMw7B,GAAoB17B,GAC1BmyB,MAAOnyB,EACP00D,WAAW,EACXx2C,UAAWk8C,IAAsBO,GAAmBpC,IAAmBv4D,MAKvEk7D,EAAc5rE,OAAS,EAAG,CAC5B,MAAMqlE,EAAW,IAAIzvD,IAAIg2D,EAAcvrE,IAAI,CAACwqB,EAAG/qB,IAAM,CAAC+qB,EAAG/qB,KACzDisE,EAAYnrE,KAAK,CAACC,EAAGC,KACNukE,EAASpyD,IAAIpS,EAAEZ,KAAOolE,EAASh9D,IAAIxH,EAAEZ,KAAO,OAC5ColE,EAASpyD,IAAInS,EAAEb,KAAOolE,EAASh9D,IAAIvH,EAAEb,KAAO,MAG7D,CAIA42B,GAAQ,gDAAgDi0C,EAAoB,SAAW,+IAKvFiB,EAAY9qE,QAAQ,CAACC,EAAMoB,KACzB,MAAM2pE,EAAc/qE,EAAK0tB,SAAW,SAAW,GACzCk9C,EAAa5qE,EAAK4qE,YAAc,GAChCI,EAAW5pE,EAAM,EAEvB,GAAIpB,EAAKkkE,UAAW,CAElB,MAAM+G,EAAkBjrE,EAAKkkC,YACzB,wEACA,GACJvO,GAAQ,8BAA8Bi1C,KAAcG,UAAoB/qE,EAAKiM,qBAAqB++D,oDAC/DhrE,EAAK0P,mBAAmB3L,EAAW/D,EAAK2hC,gBAAgBspC,kCAE7F,MAEEt1C,GAAQ,8BAA8Bo1C,kBAA4BhnE,EAAW/D,EAAKjB,uBAAuBisE,oDACtEhrE,EAAK0P,mBAAmB3L,EAAW/D,EAAK2hC,iDAK/EhM,GAAQ,+EACRwR,GAAepnC,QAAQ6N,IACrB+nB,GAAQ,sCAAsC/nB,EAAI3B,cAAc2B,EAAIw5B,6BAA6Bx5B,EAAI8B,wBAEvGimB,GAAQ,SAERA,GAAQ,QACV,CAEAA,GAAQ,SAER,MAAMu1C,EAAY1mE,EAAE,gBAQpB,GAPI0mE,EAAUpsE,OACZosE,EAAU/C,YAAYxyC,GAEtBw1C,GAAiBx1C,GAIS,aAAxBjlB,EAAOs5B,cAA+Bg/B,GAAc/gC,GACtD,GAAIuhC,EAEF4B,GAAyBpC,OACpB,CAGoB,IADPxkE,EAAE,mCACN1F,QAEZssE,GAAyBpC,EAG7B,MACSt4D,EAAOs5B,aAEhBxlC,EAAE,mCAAmCyhB,SAcvC,GARAqK,GAAWolC,GACX0S,KACAv9B,KAEIp5B,GAAMtK,IAAI,4BAA4B,IACxCkkE,KAGE35C,OAAwBpK,GAAUC,UAAW,CAC/C,MAAMiJ,EAAShsB,EAAE,kBACbgsB,EAAO1xB,SAIT0xB,EAAOmF,KAAK,8BAAgCrO,GAAUqG,cAAgB,UACtErG,GAAUgJ,WAAWE,GAGrBlJ,GAAU6E,iBAAiB,EAAG,KAC3BsK,KAAKlK,IAEAA,IACFiE,EAAOmF,KAAK,8BAAgCrO,GAAUqG,cAAgB,UACtErG,GAAUgJ,WAAWE,MAGxBoG,MAAMC,IACL32B,QAAQqK,MAAM,sCAAuCssB,GAErDrG,EAAOmF,KAAK,8BAAgCrO,GAAUqG,cAAgB,UACtErG,GAAUgJ,WAAWE,KAG7B,CAEAvI,WAAW,KACT,MAAMqjD,EAAc9mE,EAAE,sBAChBsjE,EAAYp2C,KACZ65C,EAAapjC,GAAkB2/B,GAEjCwD,EAAYxsE,SAGVysE,GACFD,EAAY7C,UAAU8C,EAAW3gC,KACjC0gC,EAAY9C,WAAW+C,EAAW96B,QAE9B63B,EAAc,GAAGgD,EAAY7C,UAAUH,GACvCD,EAAc,GAAGiD,EAAY9C,WAAWH,IAI1CkD,GAAcA,EAAWC,OAC3BrpE,OAAOC,KAAKmpE,EAAWC,OAAOzrE,QAAQhB,IACpC,MAAM0pE,EAAY8C,EAAWC,MAAMzsE,GAE7B0sE,EAAeH,EAAY33D,KAAK,iCAAiC5U,OACvE,GAAI0sE,EAAa3sE,OAAQ,CACvB,MAAM8xB,EAAQ66C,EAAa56C,QAAQ,kBAEnCD,EAAM63C,UAAUA,GAEhB73C,EAAMjd,KAAK,kBAAkB80D,UAAUA,EACzC,MAIL,GACHvoE,QAAQoK,KAAK,iBAIT8gE,GAA2BM,IAC/B,MAAM,GAAQpnE,KACdE,EAAE,mCAAmCyhB,SAGrC,MAqBM0/C,EArBqB,MACzB,MACMgG,EADUnnE,EAAE,cACK+H,OAAO,WAC5B,MAAMq/D,EAAQpnE,EAAEjG,MAChB,MAA8B,SAA1BqtE,EAAMz5C,KAAK,YAAqD,SAA5By5C,EAAMz5C,KAAK,eAA2By5C,EAAM56C,SAAS,aAG9C,WAA3C46C,EAAMj4D,KAAK,cAAc0Q,OAAO1f,QAAwD,SAAjCinE,EAAMz5C,KAAK,oBAG/B,IAAnCy5C,EAAMj4D,KAAK,aAAa7U,QACC,SAAzB8sE,EAAM75C,IAAI,YAEhB,GACA,GAAsB,IAAlB45C,EAAO7sE,OAAc,OAAO,KAEhC,MAAM+sE,EAAaF,EAAOzE,OACpB4E,EAAeD,EAAWl4D,KAAK,cACrC,OAAOm4D,EAAahtE,OAASgtE,EAAeD,GAG9BE,GAChB,GAAIpG,GAAWA,EAAQ7mE,OAAQ,CAC7B,MAAMktE,EAAYp2C,KACZrF,EAAa/rB,EACjB,wDAAwDwnE,EAAU78C,qCAAqC68C,EAAU7hC,gBAAkB,iBAErI5Z,EAAWoF,KAAK+1C,GAChB/F,EAAQ9vC,OAAOtF,EACjB,GAII63C,GAAmB,KACvB,MAAM,GAAQ9jE,KAEdE,EAAE,QACCisB,IAAI,iBACJC,GAAG,gBAAiB,eAAgBjL,eAAgBrlB,GACnDA,EAAEuyB,iBACFvyB,EAAEuwB,kBAEF,MAAMjgB,EAASklB,KACTlxB,EAAMunE,mBAAmBznE,EAAEjG,MAAMa,KAAK,QAG5C,IAAKsR,EAAOw5B,sBAGV,OAFA/lC,EAAsBO,EAAK,eAC3BF,EAAE,kBAAkBgwB,QAMtB,GAAInmB,OAAO2zD,aACT,IAEE,GAAI3zD,OAAO2zD,aAAakK,mBAkBtB,aAjBM79D,OAAO2zD,aAAakK,mBACxB,CACE,CACE1zC,KAAM,OACN5pB,QAASlK,IAGb,CAEE4sB,QAAS,kBAKTjjB,OAAO2zD,aAAaC,oBAChB5zD,OAAO2zD,aAAaC,aAAa,YAI7C,CAAE,MAAOprC,GACP32B,QAAQG,KAAK,qCAAsCw2B,EACrD,CAIF,MAAM8T,EAAKt8B,OAAOyV,aAAezV,OAAOwV,QAAQC,YAChD,GAAI6mB,GAAMA,EAAGwhC,gCACX,IAEE,MACMC,EAAM,mBADI1nE,EAAIR,QAAQ,MAAO,QAAQA,QAAQ,KAAM,UAGnDmoE,QAAmB1hC,EAAGwhC,gCAAgCC,GAE5D,IAAKC,EAAWC,UAAYD,EAAWE,UAErC,kBADM5hC,EAAGwhC,gCAAgC,YAG3CjsE,QAAQG,KAAK,0BAA2BgsE,EAC1C,CAAE,MAAOx1C,GACP32B,QAAQG,KAAK,0BAA2Bw2B,EAC1C,CAIF,MAAM21C,EAAKhoE,EAAE,kBACb,GAAIgoE,EAAG1tE,OAAQ,CACb0tE,EAAG9nE,IAAIA,GACP8nE,EAAGnnE,QAAQ,SAASA,QAAQ,gBAEtB,IAAI6b,QAAQhO,GAAK+U,WAAW/U,EAAG,KACrC,MAAMu5D,EAAUjoE,EAAE,aAAa+H,OAAO,YACtC,GAAIkgE,EAAQ3tE,OACV2tE,EAAQ,GAAG17B,YACN,CAEL,MAAM27B,EAAaloE,EAAEmoE,MAAM,UAAW,CAAEC,QAAS,GAAI1M,MAAO,GAAI2M,SAAS,IACzEL,EAAGnnE,QAAQqnE,EACb,CACF,CACF,IAGEvB,GAAmBx1C,IACvB,MAAM,GAAQrxB,KAMd,GAA4B,aALbsxB,KAKJoU,aAA6B,CACtCxlC,EAAE,gBAAgByhB,SAElB,MA4BM0/C,EA5BqB,MACzB,MACMgG,EADUnnE,EAAE,cACK+H,OAAO,WAC5B,MAAMq/D,EAAQpnE,EAAEjG,MAChB,GAA8B,SAA1BqtE,EAAMz5C,KAAK,WAAuB,OAAO,EAC7C,GAAgC,SAA5By5C,EAAMz5C,KAAK,aAAyB,OAAO,EAC/C,GAAIy5C,EAAM56C,SAAS,WAAY,OAAO,EAEtC,GAAa,WADA46C,EAAMj4D,KAAK,cAAc0Q,OAAO1f,OACtB,OAAO,EAC9B,GAA6B,SAAzBinE,EAAM75C,IAAI,WAAuB,OAAO,EAC5C,MAAM+6C,EAAWlB,EAAMj4D,KAAK,aAC5B,GAAwB,IAApBm5D,EAAShuE,OAAc,OAAO,EAClC,MAAMyuB,EAAcu/C,EAASzoD,OAAO1f,OAC9BooE,EAAWD,EAASn5D,KAAK,OAAO7U,OAAS,EAC/C,QAA2B,IAAvByuB,EAAYzuB,SAAiBiuE,EAEnC,GAEA,GAAsB,IAAlBpB,EAAO7sE,OAAc,OAAO0F,EAAE,SAIlC,IAAIwoE,EAAcrB,EAAO7sE,OAAS,EAClC,MAAM+sE,EAAaF,EAAOsB,GAAGD,GACvBlB,EAAeD,EAAWl4D,KAAK,cACrC,OAAOm4D,EAAahtE,OAASgtE,EAAeD,GAG9BE,GAiBhB,YAhBIpG,EAAQ7mE,OACN6mE,EAAQ30C,SAAS,cAAgB20C,EAAQ30C,SAAS,OACR,IAAxC20C,EAAQhyD,KAAK,gBAAgB7U,OAC/B6mE,EAAQ9vC,OAAOF,GAEfgwC,EAAQhyD,KAAK,gBAAgBw0D,YAAYxyC,GAII,IAA3CnxB,EAAE,SAASmP,KAAK,gBAAgB7U,QAClC6mE,EAAQ9vC,OAAOF,GAInBnxB,EAAE,QAAQqxB,OAAOF,GAGrB,CAIA,MAAMkxC,EAAQriE,EAAE,SACV0oE,EAAc1oE,EAAE,gBAElB0oE,EAAYpuE,OACdouE,EAAY/E,YAAYxyC,GAEpBkxC,EAAM/nE,OACR+nE,EAAMhxC,OAAOF,GAEbnxB,EAAE,QAAQqxB,OAAOF,IAKjBq0C,GAAqBtsD,IACzB,MAAM3b,EAAWymC,KACX93B,EAASklB,KACT6P,EAAIrW,KAGJ+9C,EAAmBzvD,EAAUX,GAAiBkD,gBAAgBvC,GAAW,GAE/E,KAAK3b,GAAa2b,GAEgB,IAA5ByvD,EAAiBruE,QACnB,MAAO,ivBAiBX,MAAMsuE,EAAU,GAEhB,IAAK,MAAMxvD,KAAWF,EAAS,CAC7B,IAAKE,EAAQ5e,WAAW,UAAW,SACnC,MAAMygB,EAAW/B,EAAQE,GACnB4B,EAAWzd,EAAS6b,GAC1B,IAAK6B,GAAUjQ,OAASiQ,GAAU7T,QAAS,SAE3C,MAAM7K,EAAY0e,EAASjQ,KACrBvO,EAAUwe,EAAS7T,QAAQ,IAAM,GACjCqoD,EAAUx0C,EAAS7T,QAAQ9L,MAAM,GACjCo0D,EAAU10C,GAAU5T,SAAS9L,MAAM,IAAM,GAkE/C,GA/DAm0D,EAAQl0D,QAAQ,CAACiB,EAAK2e,KACpB,MAAMw0C,EAASD,EAAQv0C,GAEvB,GAAKw0C,EAWE,CAEL,MAAMkZ,EAAa,GAenB,GAdArsE,EAAIjB,QAAQ,CAACyc,EAAMnZ,KACjB,GAAe,IAAXA,EAAc,OAClB,MAAMonB,EAASxmB,OAAOkwD,EAAO9wD,IAAW,IAClCqnB,EAASzmB,OAAOuY,GAAQ,IAC1BiO,IAAWC,GACb2iD,EAAWpuE,KAAK,CACd8c,SAAU1Y,EACV6jC,OAAQjmC,EAAQoC,IAAW,IAAIA,IAC/B6W,SAAUuQ,EACVrQ,SAAUsQ,MAKU,IAAtB2iD,EAAWvuE,OAAc,CAE3B,MAAM8+D,EAAIyP,EAAW,GACrBD,EAAQnuE,KAAK,CACXkM,KAAM,gBACNpK,YACAu7C,SAAU1+B,EACV9a,SAAU6c,EACV5D,SAAU6hD,EAAE7hD,SACZmrB,OAAQ02B,EAAE12B,OACVhtB,SAAU0jD,EAAE1jD,SACZE,SAAUwjD,EAAExjD,SACZ0F,SAAU9e,EAAI,IAAM,KAAK2e,EAAS,KAEtC,MAAW0tD,EAAWvuE,OAAS,GAE7BsuE,EAAQnuE,KAAK,CACXkM,KAAM,eACNpK,YACAu7C,SAAU1+B,EACV9a,SAAU6c,EACV1e,UACAD,MACAmzD,SACAmZ,cAAeD,EACfvtD,SAAU9e,EAAI,IAAM,KAAK2e,EAAS,KAGxC,MAtDEytD,EAAQnuE,KAAK,CACXkM,KAAM,YACNpK,YACAu7C,SAAU1+B,EACV9a,SAAU6c,EACV1e,UACAD,MACAomC,MAAOpmC,EAAI,IAAM,KAAK2e,EAAS,QAmDjCu0C,EAAQp1D,OAASm1D,EAAQn1D,OAC3B,IAAK,IAAIF,EAAIq1D,EAAQn1D,OAAQF,EAAIs1D,EAAQp1D,OAAQF,IAAK,CACpD,MAAMu1D,EAASD,EAAQt1D,GACvBwuE,EAAQnuE,KAAK,CACXkM,KAAM,cACNpK,YACAu7C,SAAU1+B,EACV9a,SAAUlE,EACVqC,UACAD,IAAKmzD,EACL/sB,MAAO+sB,EAAO,IAAM,KAAKv1D,EAAI,KAEjC,CAEJ,CAGA,IAAK,MAAMgf,KAAW7b,EACpB,GAAK6b,EAAQ5e,WAAW,YACnB0e,EAAQE,GAAU,CACrB,MAAM4B,EAAWzd,EAAS6b,GAC1BwvD,EAAQnuE,KAAK,CACXkM,KAAM,gBACNpK,UAAWye,GAAUhQ,MAAQoO,EAC7B0+B,SAAU1+B,GAEd,CAIF,MAAM2vD,EAAmB97D,GAAMtK,IAAIkI,GAA6B,GAQhE,IAAIsmB,EAAO,mKAJO43C,EAAmB,mBAAqB,wDADvCA,EAAmB,OAAS,sHAW5BA,EAA+I,GAA5H,gNAC0CA,EAAmB,OAAS,+IAC9BA,EAAmB,SAAW,cAXxFA,EAAmB,YAAc,6DAYZA,EAAmB,yBAA2B,oaAmBvF,GATIA,IACF53C,GAAQ,0HAKVA,GAAQ,qDAAuE,eAAlBjlB,EAAO44B,OAA0B,yBAA2B,OAGrHikC,EACF,GAAgC,IAA5BJ,EAAiBruE,OACnB62B,GAAQ,iWAIH,CAEL,MAAM63C,EAAgBzwD,GAAiByD,mBAAmB2sD,GACpDM,EAAkBh8D,GAAMtK,IAAI,kCAAmC,IAErEwuB,GAAQ,iCAER,IAAK,MAAM50B,KAAaysE,EAAe,CACrC,MAAME,EAAcF,EAAczsE,GAC5B6nE,EAAc6E,EAAgBjnE,SAASzF,GAE7C40B,GAAQ,iCAAiCizC,EAAc,YAAc,2GACqB7kE,EAAWhD,uFACvD6nE,EAAc,QAAU,2IACnC19B,GAAoBnqC,YAAoBgD,EAAWhD,iFACpB0kC,EAAE1B,eAAe2pC,EAAY5uE,6GAExC8pE,EAAc,gBAAkB,OAEvF8E,EAAY3tE,QAAQwK,IAClB,MAAMk5D,EAAWl5D,EAAM8I,KACnBtP,EACE1E,KAAKwB,UAAU,CACbuV,OAAQ7L,EAAM6L,OACd3F,SAAUlG,EAAMkG,SAChB1P,UAAWwJ,EAAMxJ,UACjB+B,SAAUyH,EAAMzH,SAChBwU,WAAY/M,EAAM+M,YAAc,GAChC+E,aAAc9R,EAAM8R,cAAgB,GACpCyD,SAAUvV,EAAMuV,UAAY,GAC5BzM,KAAM9I,EAAM8I,QAGhB,GAEJsiB,GAAQ,gGACmB5xB,EAAWwG,EAAMxJ,mDACnBwJ,EAAMzH,oDACHiB,EAAWwG,EAAM+M,YAAc,gDAC9BvT,EAAWwG,EAAM6L,QAAU,kDACzBrS,EAAWwG,EAAMkG,UAAY,kDAC7BgzD,wKAEjBl5D,EAAMuV,UAAYvV,EAAMzH,UAAY,EAAI,6GAA6GiB,EAAWwG,EAAMuV,kBAAoB,8DAC3J/b,EAAWwG,EAAM+M,YAAc,QAAQ/M,EAAM8R,aAAe,KAAKtY,EAAWwG,EAAM8R,aAAavd,OAAS,GAAKyL,EAAM8R,aAAakC,UAAU,EAAG,IAAM,MAAQhU,EAAM8R,gBAAkB,6EAC3KtY,EAAWwG,EAAMqG,aAAa9R,OAAS,GAAKyL,EAAMqG,aAAa2N,UAAU,EAAG,IAAM,MAAQhU,EAAMqG,uaAQvJ+kB,GAAQ,cACV,CAEAA,GAAQ,QACV,MAGA,GAAuB,IAAnBy3C,EAAQtuE,OACV62B,GAAQ,mWAIH,CAEL,MAAMg4C,EAAiB,CAAC,EACxBP,EAAQrtE,QAAQ69D,IACd,MAAM7+D,EAAM6+D,EAAE78D,UACT4sE,EAAe5uE,KAAM4uE,EAAe5uE,GAAO,IAChD4uE,EAAe5uE,GAAKE,KAAK2+D,KAG3BjoC,GAAQ,iCAER,MAAM83C,EAAkBh8D,GAAMtK,IAAI,+BAAgC,IAElE,IAAK,MAAMpG,KAAa4sE,EAAgB,CACtC,MAAMC,EAAeD,EAAe5sE,GAC9B6nE,EAAc6E,EAAgBjnE,SAASzF,GAC7C40B,GAAQ,iCAAiCizC,EAAc,YAAc,+EACP7kE,EAAWhD,uFAC3B6nE,EAAc,QAAU,2IACnC19B,GAAoBnqC,YAAoBgD,EAAWhD,+DACtC6sE,EAAa9uE,6GAEN8pE,EAAc,gBAAkB,OAEvFgF,EAAa7tE,QAAQ8tE,IACnB,GAAoB,cAAhBA,EAAO1iE,KACTwqB,GAAQ,wJAEwBk4C,EAAOvxB,0DACPuxB,EAAO/qE,+JAEQiB,EAAW8pE,EAAOzmC,skBAO5D,GAAoB,gBAAhBymC,EAAO1iE,KAChBwqB,GAAQ,4JAEwBk4C,EAAOvxB,0DACPuxB,EAAO/qE,mNAE0DiB,EAAW8pE,EAAOzmC,ybAM9G,GAAoB,kBAAhBymC,EAAO1iE,KAA0B,CAC1C,MAAM2iE,EAAWD,EAAO3zD,SAASpb,OAAS,GAAK+uE,EAAO3zD,SAASqE,UAAU,EAAG,IAAM,MAAQsvD,EAAO3zD,SAC3F6zD,EAAWF,EAAOzzD,SAAStb,OAAS,GAAK+uE,EAAOzzD,SAASmE,UAAU,EAAG,IAAM,MAAQsvD,EAAOzzD,SAGjG,IAAI4zD,EAEFA,EAHoBH,EAAO9sE,WAAa8sE,EAAO9sE,UAAUyF,SAAS,MAGnD,GAAGzC,EAAW8pE,EAAO9sE,cAAcgD,EAAW8pE,EAAO3mC,UAErD,GAAGnjC,EAAW8pE,EAAO/tD,aAAa/b,EAAW8pE,EAAO3mC,UAGrEvR,GAAQ,+JAEwBk4C,EAAOvxB,0DACPuxB,EAAO/qE,0DACP+qE,EAAO9xD,0DACPwtD,mBAAmBsE,EAAO3zD,mKAEX8zD,oIAEAjqE,EAAW+pE,GAAY,oJAEvB/pE,EAAWgqE,GAAY,qmBAQxE,MAAO,GAAoB,iBAAhBF,EAAO1iE,KAAyB,CAEzC,MAAM8iE,EAAaJ,EAAOP,cAAcxuE,OAClCovE,EAAaL,EAAOP,cACvBxtE,MAAM,EAAG,GACTX,IAAIo1D,GAAKA,EAAErtB,QACX5gC,KAAK,KACF6nE,EAAWF,EAAa,EAAI,KAAKA,KAAgB,GAEvDt4C,GAAQ,8JAEwBk4C,EAAOvxB,0DACPuxB,EAAO/qE,kKAEQiB,EAAW8pE,EAAO/tD,sFACZ/b,EAAWmqE,KAAcC,2jBAOhF,KAA2B,kBAAhBN,EAAO1iE,OAChBwqB,GAAQ,8JAEwBk4C,EAAOvxB,ooBAW3C3mB,GAAQ,cACV,CAEAA,GAAQ,QACV,CAIF,OADAA,GAAQ,SACDA,GAGH01C,GAAoB,KACxB,MAAM,GAAQ/mE,KAGdE,EAAE,wBACCqsB,QAAQ,qBACRld,KAAK,kBACL8c,IAAI,SACJC,GAAG,QAAS,WACXjf,GAAMnK,IAAI,4BAA4B,GACtC9C,EAAE,kBAAkB0sB,YAAY,WAChC1sB,EAAE,gBAAgB0sB,YAAY,SAChC,GAMF1sB,EAAE,iDACCisB,IAAI,SACJC,GAAG,QAASjL,eAAgBrlB,GAC3BA,EAAEuwB,kBACF,MAAM0B,EAAQ7tB,EAAEjG,MAAMsyB,QAAQ,8BACxB9vB,EAAYsxB,EAAMjzB,KAAK,SACvB0D,EAAWmc,SAASoT,EAAMjzB,KAAK,OAAQ,IACvCkY,EAAa+a,EAAMjzB,KAAK,UAExB2C,EAAWymC,KACjB,GAAKzmC,EAKL,IACE,MAAM2b,EAAU+F,IAAiBC,KACjC,IAAK,MAAM9F,KAAWF,EACpB,GAAIA,EAAQE,IAAUpO,OAASzO,GAAagB,EAAS6b,GAAU,CAC7D,MACMva,GADUqa,EAAQE,GAAShS,UAAU,IAAM,IAC1BvK,QAAQiW,GAC/B,GAAIjU,GAAU,GAAKtB,EAAS6b,GAAShS,UAAU9I,EAAW,GAAI,CAC5D,MAAMs0D,EAAgBr1D,EAAS6b,GAAShS,QAAQ9I,EAAW,GAAGO,GAI9D,OAHAqa,EAAQE,GAAShS,QAAQ9I,EAAW,GAAGO,GAAU+zD,QAC3C5D,GAAmB91C,GAAS,GAAO,QACzCiU,IAEF,CACA,KACF,CAEEtjB,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,cAC3C,CAAE,MAAOE,GACP32B,QAAQqK,MAAM,qBAAsBssB,GAChCxoB,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,OACzC,MAxBM8D,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,WAyB7C,GAGFnyB,EAAE,+CACCisB,IAAI,SACJC,GAAG,QAAS,SAAUtwB,GACrBA,EAAEuwB,kBACF,MAAM0B,EAAQ7tB,EAAEjG,MAAMsyB,QAAQ,8BACxB4yC,EAAWpxC,EAAMjzB,KAAK,aAC5B,GAAKqkE,EAIL,IACE,MAAMhjC,EAA6B,iBAAbgjC,EAAwBpkE,KAAKC,MAAMmkE,GAAYA,EAC/Dl5D,EAAQ,CACZ6L,OAAQqqB,EAAOrqB,OACf3F,SAAUgwB,EAAOhwB,SACjB4C,KAAMotB,EAAOptB,KACbtS,UAAWsxB,EAAMjzB,KAAK,UAAYqhC,EAAO1/B,WAAa,GACtD+B,SAAUmc,SAASoT,EAAMjzB,KAAK,OAAQ,KAAOqhC,EAAO39B,UAAY,EAChEwU,WAAY+a,EAAMjzB,KAAK,WAAaqhC,EAAOnpB,YAAc,GACzD+E,aAAcokB,EAAOpkB,cAAgB,GACrCyD,SAAU2gB,EAAO3gB,UAAY,GAC7BC,SAAU0gB,EAAO1gB,UAAY0gB,EAAOptB,MAAM7D,MAAQ,GAClDoB,aAAc6vB,EAAO7vB,cAAgB6vB,EAAOptB,MAAMzC,cAAgB,IAEpEumD,GAAkB5sD,EACpB,CAAE,MAAOssB,GACP32B,QAAQqK,MAAM,sBAAuBssB,GACjCxoB,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,WACzC,MArBM8D,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,WAsB7C,GAGF,IAAIy3C,EAA+D,KAEnE5pE,EAAE,8BACCisB,IAAI,uCACJC,GAAG,aAAc,SAAUtwB,GAC1B,MAAM8zB,EAAS9zB,EAAE0zB,cAA6BC,QAAQ,GACtDq6C,EAA8B,CAAEprB,EAAG9uB,EAAMF,QAASivB,EAAG/uB,EAAMD,QAC7D,GACCvD,GAAG,YAAa,SAAUtwB,GACzB,IAAKguE,EAA6B,OAClC,MAAMl6C,EAAS9zB,EAAE0zB,cAA6BC,QAAQ,GAChDI,EAASvqB,KAAKwqB,IAAIF,EAAMF,QAAUo6C,EAA4BprB,GAC9D3uB,EAASzqB,KAAKwqB,IAAIF,EAAMD,QAAUm6C,EAA4BnrB,IAEhE9uB,EAxFqB,IAwFYE,EAxFZ,MAyFvB+5C,EAA8B,KAElC,GACC19C,GAAG,WAAY,SAAUtwB,GAExB,IAAKguE,EAA6B,OAIlC,GAHAA,EAA8B,KAG1B5pE,EAAEpE,EAAEuhB,QAAQkP,QAAQ,+CAA+C/xB,OACrE,OAKF,GADyB2S,GAAMtK,IAAIkI,GAA6B,GAG9D,OAGF,MAAMtO,EAAYyD,EAAEjG,MAAMa,KAAK,SACzB0D,EAAW0B,EAAEjG,MAAMa,KAAK,OAG9BqS,GAAMnK,IAAI,4BAA4B,GACtCkqB,GAAmBzwB,GACnB4wB,KAGA1J,WAAW,KACT,MAAMomD,EAAc7pE,EAAE,kCAAkC1B,OACpDurE,EAAYvvE,SACduvE,EAAY,GAAGC,eAAe,CAAEC,SAAU,SAAUC,MAAO,WAC3DH,EAAYl9C,SAAS,uBACrBlJ,WAAW,IAAMomD,EAAYn9C,YAAY,uBAAwB,OAElE,IACL,GACCR,GAAG,QAAS,SAAUtwB,GAGrB,GAAIoE,EAAEpE,EAAEuhB,QAAQkP,QAAQ,+CAA+C/xB,OACrE,OAIF,GAAI,iBAAkBuP,OAAQ,OAI9B,GADyBoD,GAAMtK,IAAIkI,GAA6B,GAG9D,OAGF,MAAMtO,EAAYyD,EAAEjG,MAAMa,KAAK,SACzB0D,EAAW0B,EAAEjG,MAAMa,KAAK,OAG9BqS,GAAMnK,IAAI,4BAA4B,GACtCkqB,GAAmBzwB,GACnB4wB,KAGA1J,WAAW,KACT,MAAMomD,EAAc7pE,EAAE,kCAAkC1B,OACpDurE,EAAYvvE,SACduvE,EAAY,GAAGC,eAAe,CAAEC,SAAU,SAAUC,MAAO,WAC3DH,EAAYl9C,SAAS,uBACrBlJ,WAAW,IAAMomD,EAAYn9C,YAAY,uBAAwB,OAElE,IACL,GAGF1sB,EAAE,6BACCisB,IAAI,SACJC,GAAG,QAAS,SAAUtwB,GACrB,GAAIoE,EAAEpE,EAAEuhB,QAAQkP,QAAQ,oBAAoB/xB,OAAQ,OAEpD,MAAMiC,EAAYyD,EAAEjG,MAAMa,KAAK,SACzBolE,EAAShgE,EAAEjG,MAAMsyB,QAAQ,sBACzBC,EAAQ0zC,EAAO7wD,KAAK,2BACpBif,EAAQpuB,EAAEjG,MAAMoV,KAAK,sBAIrB86D,EADmBjqE,EAAEjG,MAAMyyB,SAAS,+BACJ,kCAAoC,+BAC1E,IAAIy8C,EAAkBh8D,GAAMtK,IAAIsnE,EAAY,IAExCjK,EAAOxzC,SAAS,cAClBwzC,EAAOtzC,YAAY,aACnBJ,EAAMM,UAAU,KAChBwB,EAAM1B,YAAY,oBAAoBC,SAAS,mBAC/Cs8C,EAAkBA,EAAgBlhE,OAAO2S,GAAKA,IAAMne,KAEpDyjE,EAAOrzC,SAAS,aAChBL,EAAMO,QAAQ,KACduB,EAAM1B,YAAY,mBAAmBC,SAAS,oBACzCs8C,EAAgBjnE,SAASzF,IAC5B0sE,EAAgBxuE,KAAK8B,IAIzB0Q,GAAMnK,IAAImnE,EAAYhB,EACxB,GAGFjpE,EAAE,uCACCisB,IAAI,SACJC,GAAG,QAASjL,eAAgBrlB,GAC3BA,EAAEuwB,kBACF,MAAM0B,EAAQ7tB,EAAEjG,MAAMsyB,QAAQ,oBACxB69C,EAAar8C,EAAMjzB,KAAK,eACxBk9C,EAAWjqB,EAAMjzB,KAAK,aACtB0D,EAAWuvB,EAAMjzB,KAAK,aACtB2c,EAAWsW,EAAMjzB,KAAK,aAEtB2C,EAAWymC,KACX9qB,EAAU+F,IAAiBC,KAC5B3hB,GAAa2b,IAEC,kBAAfgxD,EAEE3sE,EAASu6C,IAAW1wC,UAAU9I,EAAW,IAAM4a,EAAQ4+B,IAAW1wC,UAAU9I,EAAW,KACzFf,EAASu6C,GAAU1wC,QAAQ9I,EAAW,GAAGiZ,GAAY2B,EAAQ4+B,GAAU1wC,QAAQ9I,EAAW,GAAGiZ,IAEvE,iBAAf2yD,EAEL3sE,EAASu6C,IAAW1wC,SAAW8R,EAAQ4+B,IAAW1wC,UAAU9I,EAAW,KACzEf,EAASu6C,GAAU1wC,QAAQ9I,EAAW,GAAK,IAAI4a,EAAQ4+B,GAAU1wC,QAAQ9I,EAAW,KAE9D,cAAf4rE,EAELhxD,EAAQ4+B,IAAW1wC,UAAU9I,EAAW,KACrCf,EAASu6C,GAGZv6C,EAASu6C,GAAU1wC,QAAQ9I,EAAW,GAAK,IAAI4a,EAAQ4+B,GAAU1wC,QAAQ9I,EAAW,IAFpFf,EAASu6C,GAAYj9C,KAAKC,MAAMD,KAAKwB,UAAU6c,EAAQ4+B,MAKnC,gBAAfoyB,EAEL3sE,EAASu6C,IAAW1wC,UAAU9I,EAAW,IAC3Cf,EAASu6C,GAAU1wC,QAAQgL,OAAO9T,EAAW,EAAG,GAE1B,kBAAf4rE,UAEF3sE,EAASu6C,GAGlBxQ,GAAa/pC,GAGbswB,EAAM2zC,QAAQ,IAAK,WACjBxhE,EAAEjG,MAAM0nB,SACR0oD,IACF,GACF,GAGFnqE,EAAE,uCACCisB,IAAI,SACJC,GAAG,QAASjL,eAAgBrlB,GAC3BA,EAAEuwB,kBACF,MAAM0B,EAAQ7tB,EAAEjG,MAAMsyB,QAAQ,oBACxB69C,EAAar8C,EAAMjzB,KAAK,eACxBk9C,EAAWjqB,EAAMjzB,KAAK,aACtB0D,EAAWuvB,EAAMjzB,KAAK,aACtB2c,EAAWsW,EAAMjzB,KAAK,aACtB8a,EAAW+xD,mBAAmB55C,EAAMjzB,KAAK,cAAgB,IAEzD2C,EAAWymC,KACjB,IAAI9qB,EAAU+F,IAAiBC,KAC1B3hB,GAAa2b,IAEC,kBAAfgxD,EAEEhxD,EAAQ4+B,IAAW1wC,UAAU9I,EAAW,KAC1C4a,EAAQ4+B,GAAU1wC,QAAQ9I,EAAW,GAAGiZ,GAAY7B,GAE9B,iBAAfw0D,EAEL3sE,EAASu6C,IAAW1wC,UAAU9I,EAAW,IAAM4a,EAAQ4+B,IAAW1wC,UACpE8R,EAAQ4+B,GAAU1wC,QAAQ9I,EAAW,GAAK,IAAIf,EAASu6C,GAAU1wC,QAAQ9I,EAAW,KAE9D,cAAf4rE,GAELhxD,EAAQ4+B,IAAW1wC,UAAU9I,EAAW,IAC1C4a,EAAQ4+B,GAAU1wC,QAAQgL,OAAO9T,EAAW,EAAG,SAK7CorC,GAAaxwB,GAGnB2U,EAAM2zC,QAAQ,IAAK,WACjBxhE,EAAEjG,MAAM0nB,SACR0oD,IACF,GACF,GAGFnqE,EAAE,uBACCisB,IAAI,SACJC,GAAG,QAASjL,eAAgBrlB,GAC3BA,EAAEuwB,kBACF,MAAM0B,EAAQ7tB,EAAEjG,MAAMsyB,QAAQ,oBACxB69C,EAAar8C,EAAMjzB,KAAK,eACxBk9C,EAAWjqB,EAAMjzB,KAAK,aACtB0D,EAAWuvB,EAAMjzB,KAAK,aAEtB2C,EAAWymC,KACjB,IAAI9qB,EAAU+F,IAAiBC,KAC/B,GAAK3hB,GAAa2b,EAAlB,CAEA,GAAmB,gBAAfgxD,GAEF,GAAI3sE,EAASu6C,IAAW1wC,UAAU9I,EAAW,GAAI,CAC/C,MAAM8rE,EAAc,IAAI7sE,EAASu6C,GAAU1wC,QAAQ9I,EAAW,IACzD4a,EAAQ4+B,KACX5+B,EAAQ4+B,GAAYj9C,KAAKC,MAAMD,KAAKwB,UAAUkB,EAASu6C,KACvD5+B,EAAQ4+B,GAAU1wC,QAAU,CAAC7J,EAASu6C,GAAU1wC,QAAQ,KAG1D8R,EAAQ4+B,GAAU1wC,QAAQgL,OAAO9T,EAAW,EAAG,EAAG8rE,EACpD,MACwB,kBAAfF,GAEL3sE,EAASu6C,KACX5+B,EAAQ4+B,GAAYj9C,KAAKC,MAAMD,KAAKwB,UAAUkB,EAASu6C,YAKrDpO,GAAaxwB,GAGnB2U,EAAM2zC,QAAQ,IAAK,WACjBxhE,EAAEjG,MAAM0nB,SACR0oD,IACF,EA3BiC,CA4BnC,GAGFnqE,EAAE,qEACCisB,IAAI,SACJC,GAAG,QAAS,SAAUtwB,GACrBA,EAAEuwB,kBACF,MAAM0B,EAAQ7tB,EAAEjG,MAAMsyB,QAAQ,oBACxByrB,EAAWjqB,EAAMjzB,KAAK,aACtB0D,EAAWuvB,EAAMjzB,KAAK,aACtBsvE,EAAar8C,EAAMjzB,KAAK,eAE9B,IAAKk9C,QAAyBt5C,IAAbF,EAAwB,OAEzC,MAAM4a,EAAU+F,IAAiBC,KACjC,IAAKhG,IAAYA,EAAQ4+B,GAAW,OAEpC,MAAM9gC,EAAQkC,EAAQ4+B,GAChBr7C,EAAUua,EAAM5P,QAAU4P,EAAM5P,QAAQ,GAAK,GAC7C5K,EAAMwa,EAAM5P,QAAU4P,EAAM5P,QAAQ9I,EAAW,GAAK,KAE1D,GAAK9B,EAML,GAAmB,iBAAf0tE,EAEFG,GAAwB7tE,EAAKC,EAASua,EAAMhM,MAAQ,KAAM1M,EAAUw5C,QAC/D,GAAmB,kBAAfoyB,EAAgC,CACzC,MAAM3yD,EAAWsW,EAAMjzB,KAAK,aACtB0nC,EAAa7lC,EAAQ8a,IAAa,IAAIA,IACtCi9C,EAAYh4D,EAAI+a,IAAa,GACnC+yD,GAA2B9V,EAAWlyB,EAAYtrB,EAAMhM,KAAM1M,EAAUiZ,EAAUugC,EACpF,MACEyyB,GAAoB/tE,EAAKC,EAASua,EAAMhM,MAAQ,KAAM1M,EAAUw5C,QAd5DjuC,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,WAgB7C,GAGFnyB,EAAE,qBACCisB,IAAI,SACJC,GAAG,QAASjL,iBACX,MAAM/H,EAAU+F,IAAiBC,KAC5BhG,IAGLouB,GAAazsC,KAAKC,MAAMD,KAAKwB,UAAU6c,KACvC+pB,GAAiB,IAAI71B,IAGrB+8D,KACF,GAGFnqE,EAAE,qBACCisB,IAAI,SACJC,GAAG,QAASjL,iBACX,MAAM1jB,EAAWymC,KACjB,IAAKzmC,EAEH,YADIsM,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,UAK3C,MAAMq4C,EAAe3vE,KAAKC,MAAMD,KAAKwB,UAAUkB,IAC/C0hB,GAAgBurD,QACVxb,GAAmBwb,GAAc,GAAO,EAChD,GAGFxqE,EAAE,2BACCisB,IAAI,SACJC,GAAG,QAAS,WACX,MACMa,GADc9f,GAAMtK,IAAIkI,GAA6B,GAE3DoC,GAAMnK,IAAI+H,EAA6BkiB,GAGvC,MAAM7T,EAAU+F,IAAiBC,KACjClf,EAAE,kBAAkBmxB,KAAKq0C,GAAmBtsD,IAC5C2tD,KAGA4D,GAAmBvxD,EACrB,GAGFlZ,EAAE,wBACCqsB,QAAQ,qBACRld,KAAK,2BACL8c,IAAI,eACJC,GAAG,cAAe,SAAUtwB,GAC3B,GAAiB,IAAbA,EAAEq0B,OAAc,OACpBr0B,EAAEuyB,iBACFvyB,EAAEuwB,kBACF,MAAM+D,EAASn2B,KACfm2B,EAAOC,kBAAkBv0B,EAAEw0B,WAC3BpwB,EAAEkwB,GAAQvD,SAAS,UACnB,MAAMX,EAAShsB,EAAE,kBACXqwB,EAAcrE,EAAOsE,SACrBC,EAAS30B,EAAE6zB,QACXlzB,EAAYyD,EAAEkwB,GAAQt1B,KAAK,SAEjCs1B,EAAOM,cAAgB,SAAUC,GAC/B,MAAMC,EAAKD,EAAMhB,QAAUc,EAC3B,IAAII,EAAYN,EAAcK,EAC1BC,EAAY/sB,IAAkB+sB,EAAY/sB,GAC1C+sB,EAAY9sB,IAAkB8sB,EAAY9sB,GAC9CmoB,EAAOuB,IAAI,SAAUoD,EAAY,KACnC,EACAT,EAAOU,YAAc,SAAUC,GAC7B7wB,EAAEkwB,GAAQxD,YAAY,UACtBwD,EAAOY,sBAAsBD,EAAIT,WACjCF,EAAOM,cAAgB,KACvBN,EAAOU,YAAc,KAErB,MAAM85C,EAAc1+C,EAAOsE,SACrBW,EAAUF,KAChBE,EAAQ10B,GAAamuE,EACrB15C,GAAiBC,EACnB,CACF,GACChF,IAAI,YACJC,GAAG,WAAY,SAAUtwB,GACxBA,EAAEuyB,iBACFvyB,EAAEuwB,kBACF,MAAM5vB,EAAYyD,EAAEjG,MAAMa,KAAK,SAChBoF,EAAE,kBACVutB,IAAI,SAAU,IAErB,MAAM0D,EAAUF,YACTE,EAAQ10B,GACfy0B,GAAiBC,EACnB,GAGF,MAAM05C,EAAsB3qE,EAAE,+CAC1B2qE,EAAoBrwE,SACtBqwE,EAAoB,GAAGtgE,iBACrB,aACA,SAAUzO,GACR7B,KAAK6wE,aAAehvE,EAAE2zB,QAAQ,GAAGC,QACjCz1B,KAAK8wE,aAAejvE,EAAE2zB,QAAQ,GAAGE,QACjC11B,KAAK+wE,iBAAmB,IAC1B,EACA,CAAE5hB,SAAS,IAGbyhB,EAAoB,GAAGtgE,iBACrB,YACA,SAAUzO,GACR,IAAK7B,KAAK6wE,aAAc,OAExB,MAAMj7C,EAASvqB,KAAKwqB,IAAIh0B,EAAE2zB,QAAQ,GAAGC,QAAUz1B,KAAK6wE,cAC9C/6C,EAASzqB,KAAKwqB,IAAIh0B,EAAE2zB,QAAQ,GAAGE,QAAU11B,KAAK8wE,eAG/C9wE,KAAK+wE,mBAAqBn7C,EAAS,GAAKE,EAAS,KACpD91B,KAAK+wE,iBAAmBn7C,EAASE,EAAS,aAAe,YAK7B,eAA1B91B,KAAK+wE,kBAAqCn7C,EAAS,IACrD/zB,EAAEuwB,iBAEN,EACA,CAAE+8B,SAAS,IAGbyhB,EAAoB,GAAGtgE,iBACrB,WACA,WACEtQ,KAAK6wE,aAAe,KACpB7wE,KAAK8wE,aAAe,KACpB9wE,KAAK+wE,iBAAmB,IAC1B,EACA,CAAE5hB,SAAS,MAMXihB,GAAsB,KAC1B,MAAM,GAAQrqE,KACRoZ,EAAU+F,IAAiBC,KACjC+jB,GAAiBmsB,GAAgBl2C,GAEjC,MAAM8S,EAAShsB,EAAE,kBACbgsB,EAAO1xB,QAAU2S,GAAMtK,IAAI,4BAA4B,KACzDqpB,EAAOmF,KAAKq0C,GAAmBtsD,IAC/B2tD,KAGA4D,GAAmBvxD,KAKjBuxD,GAAqBvxD,IACzB,MAAM,GAAQpZ,KACRvC,EAAWymC,KACjB,IAAI6hC,EAAe,EAEnB,GAAItoE,GAAY2b,EAAS,CACvB,IAAK,MAAME,KAAWF,EAAS,CAC7B,IAAKE,EAAQ5e,WAAW,UAAW,SACnC,MAAMygB,EAAW/B,EAAQE,GACnB4B,EAAWzd,EAAS6b,GAC1B,IAAK6B,GAAU7T,QAAS,SACxB,MAAMqoD,EAAUx0C,EAAS7T,QAAQ9L,MAAM,GACjCo0D,EAAU10C,GAAU5T,SAAS9L,MAAM,IAAM,GAC/Cm0D,EAAQl0D,QAAQ,CAACiB,EAAK2e,KACpB,MAAMw0C,EAASD,EAAQv0C,GAClBw0C,EAILnzD,EAAIjB,QAAQ,CAACyc,EAAMnZ,KACF,IAAXA,GACAY,OAAOuY,GAAQ,MAAQvY,OAAOkwD,EAAO9wD,IAAW,KAAKgnE,MALzDA,MAQAnW,EAAQp1D,OAASm1D,EAAQn1D,SAAQurE,GAAgBnW,EAAQp1D,OAASm1D,EAAQn1D,OAChF,CACA,IAAK,MAAM8e,KAAW7b,EAChB6b,EAAQ5e,WAAW,YAAc0e,EAAQE,IAAUysD,GAE3D,CAGA,MAAMC,EAAuB5sD,EAAUX,GAAiB2D,cAAchD,GAAW,EAG3E6vD,EAAmB97D,GAAMtK,IAAIkI,GAA6B,GAC1Dk7D,EAAegD,EAAmBjD,EAAuBD,EAEzDG,EAAkB+C,GAAoBjD,EAAuB,EAE7Dx/B,EAAOtmC,EAAE,oBACT+qE,EAAQzkC,EAAKn3B,KAAK,QACxB47D,EAAM55C,KAAK40C,EAAe,EAAI,MAAMA,KAAkB,MAGlDC,GACG1/B,EAAKn3B,KAAK,yBAAyB7U,QACtCywE,EAAM15C,OAAO,0EAEfiV,EAAK3Z,SAAS,2BAEd2Z,EAAKn3B,KAAK,yBAAyBsS,SACnC6kB,EAAK5Z,YAAY,2BAIf69C,GAAsB,CAAC/tE,EAAKC,EAASF,EAAW+B,EAAUw5C,KAC9D,MAAM,GAAQh4C,KACRoM,EAASklB,KAETk9B,EAAa9xD,EAChB7B,IAAI,CAACqd,EAAMpb,KACV,GAAY,IAARA,EAAW,MAAO,GACtB,MAAM0lC,EAAa7lC,EAAQG,IAAQ,KAAKA,IAClCsD,EAAM8X,GAAQ,GACpB,MAAO,iNAE+GzY,EAAW+iC,qGACjD1lC,2LACkE2C,EAAWW,oDAE9J4B,KAAK,IAEFysD,EAASvuD,EAAE,uGAEmCkM,EAAOye,mEACNrsB,EAAW,OAAOiB,EAAWhD,6IAE5D+xD,ibAStBtuD,EAAE,QAAQqxB,OAAOk9B,GAGjB,MAAMC,EAAeC,IAEnBA,EAAGhoD,MAAM6pB,OAAS,OAClB,MAAMo+B,EAAgBD,EAAGE,aAAe,EAExCF,EAAGhoD,MAAM6pB,OAASlrB,KAAKkH,IAAIoiD,EADT,KACqC,KACvDD,EAAGhoD,MAAMmoD,UAAYF,EAFH,IAE+B,OAAS,UAI5DG,sBAAsB,KACpBN,EAAOp/C,KAAK,YAAYye,KAAK,WAC3B4gC,EAAaz0D,KACf,KAIFw0D,EAAOp/C,KAAK,YAAY+c,GAAG,QAAS,WAClCsiC,EAAaz0D,KACf,GACAw0D,EAAOp/C,KAAK,YAAY+c,GAAG,QAAS,WAClCsiC,EAAaz0D,KACf,GAEA,MAAMm0D,EAAc,KAClBlrB,IAAiB,EACjBurB,EAAO9sC,UAET8sC,EAAOp/C,KAAK,sBAAsBo9B,MAAM2hB,GACxCK,EAAOriC,GAAG,QAAS,SAAUtwB,GACvBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,qBAAqB0hC,GAChD,GAEAK,EAAOp/C,KAAK,oBAAoBo9B,MAAMtrB,UACpC,IAAI/H,EAAU+F,IAAiBC,KAC/B,GAAIhG,GAAWA,EAAQ4+B,GAAW,CAChC,MAAMgX,EAAa51C,EAAQ4+B,IAAW1wC,UAAU9I,EAAW,GAC3D,IAAKwwD,EAEH,YADAZ,IAIF,IAAIa,GAAa,EAUjB,GATAR,EAAOp/C,KAAK,YAAYye,KAAK,WAC3B,MAAM/uB,EAAS4b,SAASza,EAAEjG,MAAMa,KAAK,QAC/BsrB,EAASlmB,EAAEjG,MAAMmG,MACnBT,OAAOqvD,EAAWjwD,MAAaY,OAAOymB,KACxC6oC,GAAa,EACbD,EAAWjwD,GAAUqnB,EAEzB,GAEI6oC,EAAY,CAEd,IACE,MAAM9qB,EAAMnkC,KAAUokC,QACtB,IAAKD,IAAQA,EAAI8sB,kBACf,MAAM,IAAIxpD,MAAM,eAGlB,MAAMtL,EAAa,CAAE20D,KAAM13C,EAAQ03C,MAAQ,CAAEjqD,KAAM,aAAc2H,QAAS,IAM1E,IAAI2F,EALJtW,OAAOC,KAAKsb,GAAS3d,QAAQ4pB,IACvBA,EAAE3qB,WAAW,YAAWyB,EAAWkpB,GAAKjM,EAAQiM,MAKtD,IACElR,EAAapZ,KAAKwB,UAAUJ,GAE5B,MAAM40D,EAAW,IAAI5D,KAAK,CAACh5C,IAAamD,KAAO,QAC/C,GAAIy5C,EAAW,GACb,MAAM,IAAItpD,MAAM,SAASspD,EAAS/xC,QAAQ,mBAE9C,CAAE,MAAOgyC,GAEP,MADAp1D,QAAQqK,MAAM,wBAAyB+qD,GACjC,IAAIvpD,MAAM,YAAYupD,EAAe1mD,SAAW0mD,IACxD,CAKA,IAAe,UAFM7sB,EAAI8sB,kBAAkB98C,GAGzC,MAAM,IAAI1M,MAAM,oBAElB0X,GAAgB/F,CAClB,CAAE,MAAOtd,GACPF,QAAQqK,MAAM,kBAAmBnK,GACjC,IAAIwQ,EAAexQ,EAAEwO,SAAW,kBAEhC,MAAMsN,EAAWjY,OAAO7D,GAcxB,OAZE8b,EAAS1V,SAAS,gCAClB0V,EAAS1V,SAAS,sBAClB0V,EAAS1V,SAAS,gBAElBoK,EAAe,wCAEbvC,OAAOujB,OACTvjB,OAAOujB,OAAOrnB,MAAMqG,EAAc,OAAQ,CAAEg4B,QAAS,MAErDr6B,MAAM,SAASqC,KAInB,CAGA,MAAM7O,EAAWymC,KACbzmC,GAAYA,EAASu6C,IAAav6C,EAASu6C,GAAU1wC,UACvD7J,EAASu6C,GAAU1wC,QAAQ9I,EAAW,GAAK,IAAIwwD,GAC/CxnB,GAAa/pC,IAIf0lC,GAAiBmsB,GAAgBl2C,GAGlBlZ,EAAE,kBACVmxB,KAAKq0C,GAAmBtsD,IAC/B2tD,IACF,CACF,CACA3Y,OAIEoc,GAA6B,CAACrtE,EAAOqlC,EAAY/lC,EAAW+B,EAAUiZ,EAAUugC,KACpF,MAAM,GAAQh4C,KACRoM,EAASklB,KAGT7zB,EAAWymC,KACXtuB,EAAWnY,IAAWu6C,IAAW1wC,UAAU9I,EAAW,KAAKiZ,IAAa,GACxEyzD,EAA2B,KAAbt1D,GAAmBjW,OAAOiW,KAAcjW,OAAOxC,GAE7DsxD,EAASvuD,EAAE,uGAEmCkM,EAAOye,yFACTprB,EAAWhD,QAAgBgD,EAAW+iC,4IAGlE0oC,EACI,kUAK+BzrE,EAAWmW,oOAM1C,8MAIoCs1D,EAAc,WAAa,uQAGmBzrE,EAAWtC,sRAKjG+tE,EAAc,6HAA+H,mOAMnKhrE,EAAE,QAAQqxB,OAAOk9B,GAGjB,MAAMkQ,EAAYlQ,EAAOp/C,KAAK,4BACxBq/C,EAAe,KACnBiQ,EAAU,GAAGh4D,MAAM6pB,OAAS,OAC5B,MAAM9yB,EAAI4H,KAAKC,IAAI,GAAID,KAAKkH,IAAImyD,EAAU,GAAG9P,aAAe,EAAG,MAC/D8P,EAAU,GAAGh4D,MAAM6pB,OAAS9yB,EAAI,MAElCimB,WAAW+qC,EAAc,GACzBiQ,EAAUvyC,GAAG,QAASsiC,GACtBiQ,EAAUzuC,QAEV,MAAMk+B,EAAc,IAAMK,EAAO9sC,SACjC8sC,EAAOp/C,KAAK,sBAAsBo9B,MAAM2hB,GACxCK,EAAOriC,GAAG,QAAS,SAAUtwB,GACvBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,qBAAqB0hC,GAChD,GAGAK,EAAOp/C,KAAK,sBAAsBo9B,MAAM,WACtCkyB,EAAUv+D,IAAIwV,GAAU7U,QAAQ,QAClC,GAEA0tD,EAAOp/C,KAAK,oBAAoBo9B,MAAMtrB,UACpC,MAAMiF,EAASu4C,EAAUv+D,MACzB,IAAIgZ,EAAU+F,IAAiBC,KAE/B,GAAIhG,GAAWA,EAAQ4+B,IAAa5+B,EAAQ4+B,GAAU1wC,QAAS,CAC7D,MAAM0nD,EAAa51C,EAAQ4+B,GAAU1wC,QAAQ9I,EAAW,GACxD,GAAIwwD,GAAcrvD,OAAOqvD,EAAWv3C,MAAe9X,OAAOymB,GAAS,CACjE4oC,EAAWv3C,GAAY2O,QAGjBwjB,GAAaxwB,GAGnB,MAAM3b,EAAWymC,KAEfzmC,GACAA,EAASu6C,IACTv6C,EAASu6C,GAAU1wC,SACnB7J,EAASu6C,GAAU1wC,QAAQ9I,EAAW,KAEtCf,EAASu6C,GAAU1wC,QAAQ9I,EAAW,GAAGiZ,GAAY2O,EACrDohB,GAAa/pC,IAIf0lC,GAAiBmsB,GAAgBl2C,GACjCixD,IACF,CACF,CACAjc,OAKEmc,GAA0B,CAAC7tE,EAAKC,EAASF,EAAW+B,EAAUw5C,KAClE,MAAM,GAAQh4C,KACRoM,EAASklB,KAGT7zB,EAAWymC,KACX2rB,EAASpyD,IAAWu6C,IAAW1wC,UAAU9I,EAAW,IAAM,GAGhE,IAAI2sE,EAAa,GACjB,IAAK,IAAIruE,EAAM,EAAGA,EAAMH,EAAQnC,OAAQsC,IAAO,CAC7C,MAAM0lC,EAAa7lC,EAAQG,IAAQ,KAAKA,IAClCqpB,EAAS0pC,EAAO/yD,IAAQ,GACxBspB,EAAS1pB,EAAII,IAAQ,GACrBsuE,EAAYzrE,OAAOwmB,KAAYxmB,OAAOymB,GAE5C+kD,GAAc,oDAC6BC,EAAY,oBAAsB,6DAC7B3rE,EAAW+iC,MAAe4oC,EAAY,4CAA8C,iCACpHA,EAAY,iCAAiC3rE,EAAW0mB,IAAW,iDAAmD,4FACrDrpB,kCAAoC2C,EAAW2mB,qDAGlI,CAEA,MAAMqoC,EAASvuD,EAAE,uGAEmCkM,EAAOye,2FACPprB,EAAWhD,QAAgBgD,EAAW/C,EAAI,IAAM,MAAQ8B,EAAW,8JAEjG2sE,0iBAUtBjrE,EAAE,QAAQqxB,OAAOk9B,GAGjB,MAAMC,EAAeC,IACnBA,EAAGhoD,MAAM6pB,OAAS,OAClBm+B,EAAGhoD,MAAM6pB,OAASlrB,KAAKkH,IAAImiD,EAAGE,aAAe,EAAG,KAAO,MAEzDJ,EAAOp/C,KAAK,YAAYye,KAAK,WAC3B4gC,EAAaz0D,KACf,GACAw0D,EAAOp/C,KAAK,YAAY+c,GAAG,QAAS,WAClCsiC,EAAaz0D,KACf,GAEA,MAAMm0D,EAAc,IAAMK,EAAO9sC,SACjC8sC,EAAOp/C,KAAK,mBAAmBo9B,MAAM2hB,GACrCK,EAAOriC,GAAG,QAAS,SAAUtwB,GACvBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,qBAAqB0hC,GAChD,GAGAK,EAAOp/C,KAAK,mBAAmBo9B,MAAM,WACnCgiB,EAAOp/C,KAAK,YAAYye,KAAK,WAC3B,MAAM/uB,EAAS4b,SAASza,EAAEjG,MAAMa,KAAK,QACrCoF,EAAEjG,MACCmG,IAAIyvD,EAAO9wD,IAAW,IACtBgC,QAAQ,QACb,EACF,GAGA0tD,EAAOp/C,KAAK,iBAAiBo9B,MAAMtrB,UACjC,IAAI/H,EAAU+F,IAAiBC,KAC/B,IAAKhG,IAAU4+B,IAAW1wC,UAAU9I,EAAW,GAE7C,YADA4vD,IAIF,MAAMY,EAAa51C,EAAQ4+B,GAAU1wC,QAAQ9I,EAAW,GACxD,IAAIywD,GAAa,EAWjB,GATAR,EAAOp/C,KAAK,YAAYye,KAAK,WAC3B,MAAM/uB,EAAS4b,SAASza,EAAEjG,MAAMa,KAAK,QAC/BsrB,EAASlmB,EAAEjG,MAAMmG,MACnBT,OAAOqvD,EAAWjwD,MAAaY,OAAOymB,KACxC6oC,GAAa,EACbD,EAAWjwD,GAAUqnB,EAEzB,GAEI6oC,EAAY,OACRrlB,GAAaxwB,GAGnB,MAAM3b,EAAWymC,KACbzmC,IAAWu6C,IAAW1wC,UACxB7J,EAASu6C,GAAU1wC,QAAQ9I,EAAW,GAAK,IAAIwwD,GAC/CxnB,GAAa/pC,IAGf0lC,GAAiBmsB,GAAgBl2C,GACjCixD,IACF,CACAjc,OAGEuX,GAAkB3vC,IACtBp6B,QAAQoK,KAAK,sBACb,MAAMoG,EAASklB,KAGTolB,EAAevgB,GAAoBC,UAAUJ,EAAW,UACxDE,EAAeC,GAAoBC,UAAUJ,EAAW,UACxD2gB,EAAiBxgB,GAAoBC,UAAUJ,EAAW,YAC1DK,EAAYF,GAAoBC,UAAUJ,EAAW,OACrDq1C,EAAcl1C,GAAoBC,UAAUJ,EAAW,SACvDs1C,EAAYn1C,GAAoBC,UAAUJ,EAAW,OACrDu1C,EAAcp1C,GAAoBC,UAAUJ,EAAW,SACvDw1C,EAAcr1C,GAAoBC,UAAUJ,EAAW,SAG7D,IAAIqE,EAAS,CAAEnvB,KAAM,KAAMovB,OAAQ,KAAMC,SAAU,GAAI/D,MAAO,GAAIiE,MAAO,KACzE,MAAMgxC,EAAet1C,GAAoBQ,UAAUT,EAAc,UAEjE,GAAIu1C,EAAajxE,OAAS,EAAG,CAC3B,MAAM8U,EAAIm8D,EAAa,GAQvB,GAPApxC,EAAOnvB,KAAOoE,EAAEpE,MAAQ,KACxBmvB,EAAOC,OAAShrB,EAAEgrB,QAAU,KAC5BD,EAAOE,SAAWjrB,EAAEirB,UAAY,GAChCF,EAAOI,MAAQnrB,EAAEmrB,OAAS,GAC1BJ,EAAOK,UAAY,GAGfxE,GAAcp7B,MAAM6B,SAAWu5B,GAAcp7B,MAAM0c,OAAO,GAAI,CAChE,MAAM7a,EAAUu5B,EAAap7B,KAAK6B,QAC5BD,EAAMw5B,EAAap7B,KAAK0c,KAAK,GACnC,IAAIk0D,EAAc,GAClB/uE,EAAQlB,QAAQ,CAACiC,EAAGZ,KAClB,GAAIY,GAAKA,EAAEwE,SAAS,MAAO,CACzB,MAAM9B,EAAM1D,EAAII,GACZsD,IAAKsrE,IAAgBA,EAAc,KAAO,IAAMtrE,EACtD,IAEFi6B,EAAO7D,MAAQk1C,EAGf/uE,EAAQlB,QAAQ,CAACiC,EAAGZ,KAClB,GAAIY,IAAMA,EAAEwE,SAAS,OAASxE,EAAEwE,SAAS,OAAQ,CAC/C,MAAM9B,EAAM1D,EAAII,GACZsD,IAAKi6B,EAAOK,UAAYt6B,EAC9B,GAEJ,CACF,CAGA,MAAMurE,EAAaz1C,GAAcp7B,MAAM0c,MAAQ,GACzCmiC,EAAgBzjB,GAAcp7B,MAAM6B,SAAW,GAGrD,IAAIivE,EAAuB,GACvBC,EAAiB,GAErB,GAAIn1B,GAAc57C,MAAM0c,MAAMhd,OAAS,EAAG,CACxC,MAAMmC,EAAU+5C,EAAa57C,KAAK6B,SAAW,GACvCD,EAAMg6C,EAAa57C,KAAK0c,KAAK,GAG7Bw/B,EAAY7gB,GAAoBsF,gBAAgB9+B,EAAS,iBAAkB+5C,EAAatqC,QAC1F4qC,GAAa,GAAKt6C,EAAIs6C,KACxB40B,EAAuBlvE,EAAIs6C,IAI7B,MAAM80B,EAAS31C,GAAoBsF,gBAAgB9+B,EAAS,kBAAmB+5C,EAAatqC,QAC5Fy/D,EAAiBC,GAAU,GAAKpvE,EAAIovE,GAAUpvE,EAAIovE,GAAUpvE,EAAI,IAAM,EACxE,CAGA,IAAIqvE,EACFH,GACAC,IACCxxC,EAAOE,SAASr4B,SAAS,KAAOm4B,EAAOE,SAASp1B,MAAM,KAAK,GAAG9E,OAASg6B,EAAOE,UAGjF,MAAMyxC,EAAe31C,GAAWnrB,MAAQ,QAClC6yC,EAAc1nB,GAAW57B,KAAO,GAEhCwxE,EAAY91C,GAAoBQ,UAAUN,EAAW,OAG3D,IAAI61C,EAAc,GACdC,EAAe,GACnBF,EAAUxwE,QAAQm7B,IAChB,MAAMC,EAAal3B,OAAOi3B,EAAIH,SAAW,IAAIK,cACvCs1C,EAAU,CACdlhE,KAAM0rB,EAAI1rB,MAAQ,KAClBovB,OAAQ1D,EAAI0D,QAAU,GACtBC,SAAU3D,EAAI2D,UAAY,GAC1BnoB,MAAOwkB,EAAIwF,WAEM,SAAfvF,GAAwC,OAAfA,EAC3Bq1C,EAAYvxE,KAAKyxE,GAEjBD,EAAaxxE,KAAKyxE,KAItB,IAAIC,EAAU,IAAIH,KAAgBC,GAGlC,MAAMG,EAAiBjB,GAAangE,MAAQ,OACtCqhE,EAAcp2C,GAAoBQ,UAAU00C,EAAa,SACzDmB,EAAoBr2C,GAAoBmG,YAAYiwC,EAAa,SAAU,SAG3EE,EAAiB5lE,IACrB,MAAMs6B,EAAIxhC,OAAOkH,GAAQ,IAAIiwB,cAC7B,OAAIqK,EAAEj/B,SAAS,MAAc,EACzBi/B,EAAEj/B,SAAS,MAAc,EACzBi/B,EAAEj/B,SAAS,MAAc,EACtB,GAET,IAAIwqE,EAAcF,EACf3xE,IAAI8xE,IAAK,CACRzhE,KAAMyhE,EAAEzhE,MAAQ,KAChBrE,KAAM8lE,EAAE9lE,MAAQ,GAChBg0B,SAAU8xC,EAAE9xC,UAAY,GACxBuB,UAAWuwC,EAAEvwC,aAEdhhC,KAAK,CAACC,EAAGC,IAAMmxE,EAAepxE,EAAEwL,MAAQ4lE,EAAenxE,EAAEuL,OACzDrL,MAAM,EAAG,GAEZ,MAAMoxE,EAAetB,GAAWpgE,MAAQ,QAElC2hE,EAAY12C,GAAoBQ,UAAU20C,EAAW,OAC3D,IAAIwB,EAAWD,EAAUrxE,MAAM,EAAG,GAAGX,IAAIa,IAAQ,CAC/CwP,KAAMxP,EAAKwP,MAAQ,OACnB4T,MAAOpjB,EAAKojB,OAAS,IACrBjY,KAAMnL,EAAKmL,MAAQ,MAIrB,MAAMkmE,EAAiBxB,GAAargE,MAAQ,QAEtC8hE,EAAc72C,GAAoBQ,UAAU40C,EAAa,SAC/D,IAAI0B,EAASD,EAAYxxE,MAAM,EAAG,GAAGX,IAAI6E,IAAK,CAC5CwL,KAAMxL,EAAEwL,MAAQ,OAChBsf,MAAO9qB,EAAE8qB,OAAS,GAClB3jB,KAAMnH,EAAEmH,MAAQ,MAIlB,MAAMqmE,EAAiB1B,GAAatgE,MAAQ,MAEtCiiE,EAAch3C,GAAoBQ,UAAU60C,EAAa,SAG/D,IAAI4B,EAFmBj3C,GAAoBmG,YAAY6wC,EAAa,WAAY,SAE7C3xE,MAAM,EAAG,GAAGX,IAAIiB,IAAK,CACtDoP,KAAMpP,EAAEoP,MAAQ,OAChBrE,KAAM/K,EAAE+K,MAAQ,GAChBqf,KAAMpqB,EAAEoqB,MAAQ,MAGlB,MAAMmnD,EAAoB12B,GAAgBzrC,MAAQ,QAC5CoiE,EAAmB32B,GAAgBl8C,KAAO,GAE1C8yE,EAAiBp3C,GAAoBQ,UAAUggB,EAAgB,YAGrE,IAAItlB,EAAO,kxBAc2C,eAAlBjlB,EAAO44B,OAA0B,sBAAwB,sNAIvD9O,GAAcz7B,KAAO,8RAISgF,EAAWwgB,GAAwBoa,EAAOnvB,wQACsIzL,EAAW46B,EAAOC,YAAY76B,EAAW46B,EAAOC,OAAO9/B,OAAS,EAAI6/B,EAAOC,OAAOrgB,UAAU,EAAG,GAAK,KAAOogB,EAAOC,sJAGhV,MAEA,MAAMkzC,EAAenzC,EAAOK,WAAaL,EAAOI,OAAS,GACnDgzC,EAAkBzrC,GAAqBwrC,GAC7C,OAAIC,EAAgBjzE,OAAS,EACpB,8NACGizE,EACCjyE,MAAM,EAAG,GACTX,IACC6yE,GAAO,yQAEiFjuE,EAAWiuE,EAAIxiE,UAAUzL,EAAWiuE,EAAIxiE,KAAK+O,UAAU,EAAG,wPAEjEyzD,EAAIvwE,gIACZuwE,EAAIvwE,qBAAqBsC,EAAWiuE,EAAIxiE,+FAA+FwiE,EAAIxiE,QAAQwiE,EAAIvwE,8JAKjO6E,KAAK,8CAGX,EACR,EAvBC,eAwBhB,MAEA,IAAIsmC,EAAW,GACf,GAAIqjC,EAAWnxE,OAAS,GAAKm/C,EAAcn/C,OAAS,EAAG,CACrD,MAAMkC,EAAMivE,EAAW,GACvBhyB,EAAcl+C,QAAQ,CAACiC,EAAGZ,KACxB,GAAIY,GAAKA,EAAEwE,SAAS,MAAO,CACV8/B,GAAqBtlC,EAAII,IAAQ,IACzCrB,QAAQoyB,IACRya,EAASt6B,KAAK3S,GAAKA,EAAE6P,OAAS2iB,EAAK3iB,OACtCo9B,EAAS3tC,KAAKkzB,IAGpB,GAEJ,CAEA,OAAIya,EAAS9tC,OAAS,EAEb,sJACG8tC,EACCztC,IACCgzB,GAAQ,gSAEgFpuB,EAAWouB,EAAK3iB,UAAUzL,EAAWouB,EAAK3iB,KAAK+O,UAAU,EAAG,2NAEhE4T,EAAK1wB,gHAChB0wB,EAAK1wB,qBAAqBsC,EAAWouB,EAAK3iB,+FAA+F2iB,EAAK3iB,QAAQ2iB,EAAK1wB,8GAKrO6E,KAAK,8BAGX,EACR,EApCC,qGAuCwDvC,EAAWstE,gHAA6HC,EAAYxyE,wLAGhMyyE,EAAOzyE,OAAS,EACZyyE,EACGpyE,IAAI,CAACsgC,EAAOr+B,KACX,MAAM6wE,EAAa7rC,GAAoB3G,EAAM3Q,OACvCojD,EAAaD,EAAa,EAC1BE,EAAgBb,EAAY36D,UAAU3S,GAAKA,EAAEwL,OAASiwB,EAAMjwB,MAClE,MAAO,yGACSqgE,GAAa9wE,KAAO,oDACpBozE,GAAiB,EAAIA,EAAgB/wE,uWAG6B2C,EAAW07B,EAAMjwB,UAAUzL,EAAW07B,EAAMjwB,KAAK1Q,OAAS,EAAI2gC,EAAMjwB,KAAK+O,UAAU,EAAG,GAAK,KAAOkhB,EAAMjwB,mJAGtL0iE,EACI,6EAA6ED,4GAClBA,iBAA0BluE,EAAW07B,EAAMjwB,+FAA+FiwB,EAAMjwB,QAAQyiE,eACnN,2DAA2DluE,EAAW07B,EAAM3Q,OAAS,sFAK9FxoB,KAAK,IACR,2UAOwCvC,EAAW4tE,kJACTE,EAAe/yE,oZAK7D+yE,EAAe/yE,OAAS,EACpB+yE,EACG1yE,IAAI,CAACizE,EAAKhxE,KACT,MAAMixE,EAAWD,EAAI5iE,MAAQ,KACvB8iE,EACJjC,IACCgC,EAAS7rE,SAAS6pE,IAAqBA,EAAiB7pE,SAAS6rE,IACpE,MAAO,6EAA6EC,EAAY,uBAAyB,oDACzGvuE,EAAW6tE,oDACXQ,EAAI1xC,8IAGhB4xC,EAAY,2CAA6C,0HAC5CvuE,EAAWsuE,OAActuE,EAAWsuE,+EAEpDC,EAA+N,8EAAnN,mEAAmEvuE,EAAWsuE,2GAAkHA,8CAG9M/rE,KAAK,IACR,6IAIwCvC,EAAWusE,oKACPK,EAAQ7xE,ksBAQxD6xE,EAAQ7xE,OAAS,EACb6xE,EACG7wE,MAAM,EAAG,IACTX,IAAI,CAAC+7B,EAAKq3C,KACT,MAAMl3C,EAAYm1C,EAAYl+D,KAAK4M,GAAKA,EAAE1P,OAAS0rB,EAAI1rB,MACjDgjE,EAAYD,IAAW3oE,KAAKkH,IAAI6/D,EAAQ7xE,OAAQ,IAAM,EACtD2zE,EAAYhuD,GAActd,IAAI+zB,EAAI1rB,MAClCouC,EAAgBn5B,GAAciB,WAAWwV,EAAI1rB,MAC7CquC,EAAgBp5B,GAAcmB,WAAWsV,EAAI1rB,MAC7CsuC,EAAcr5B,GAAcoB,SAASqV,EAAI1rB,MACzCuxC,EAAc0xB,EAChB,yBAAyBA,uBAA+B30B,0BAAoCF,MAAkBC,MAC9G,GACE60B,EAAiBr3C,EACnB,GACA,qDACJ,MAAO,yGACSt3B,EAAWs+C,oDACXnnB,EAAIxkB,mHAEI87D,EAA4D,GAAhD,ugBAG2Kn3C,EAAY,oBAAsB,uBAAuB0lB,IAAc2xB,aAA0Br3C,EAAY,KAAO,oDACtTo3C,EAAmJ,GAAvI,0EAA0EC,MAAmB3uE,EAAWm3B,EAAI1rB,KAAKwxC,OAAO,+GAE5Hj9C,EAAWm3B,EAAI1rB,iBAAiB6rB,EAAY,GAAK,mBAAmBt3B,EAAWm3B,EAAI1rB,KAAK1Q,OAAS,EAAIo8B,EAAI1rB,KAAK+O,UAAU,EAAG,GAAK,KAAO2c,EAAI1rB,kPAGpFzL,EAAWm3B,EAAI1rB,+FAA+F0rB,EAAI1rB,iIAK/LlJ,KAAK,IACR,mQAOwCvC,EAAWmtE,oDAA+DC,EAAUryE,mLAGhIsyE,EAAStyE,OAAS,EACdsyE,EACGjyE,IAAI,CAACa,EAAMoB,KACV,MAAMuxE,EAAYvxE,IAAQgwE,EAAStyE,OAAS,EAC5C,MAAO,yGACS8wE,GAAW7wE,KAAO,oDAClBqC,2MAEoGuxE,EAA4D,GAAhD,2JACrD5uE,EAAW/D,EAAKwP,UAAUzL,EAAW/D,EAAKwP,KAAK1Q,OAAS,EAAIkB,EAAKwP,KAAK+O,UAAU,EAAG,GAAK,KAAOve,EAAKwP,0MAEtGzL,EAAW/D,EAAKwP,gGAAgGxP,EAAKwP,uGAClIzL,EAAW/D,EAAKojB,sFAI7E9c,KAAK,IACR,2IAIwCvC,EAAWytE,8EAA2FE,EAAc5yE,mLAGhK4yE,EAAc5yE,OAAS,EACnB4yE,EACGvyE,IAAI,CAACa,EAAMoB,KACV,MAAMwxE,EAASxxE,IAAQswE,EAAc5yE,OAAS,EAC9C,MAAO,yGACSgxE,GAAa/wE,KAAO,oDACpB0yE,EAAY96D,UAAUzD,GAAKA,EAAE1D,OAASxP,EAAKwP,qNAEyDojE,EAAyD,GAAhD,iIAC5E7uE,EAAW/D,EAAKwP,UAAUzL,EAAW/D,EAAKwP,KAAK1Q,OAAS,EAAIkB,EAAKwP,KAAK+O,UAAU,EAAG,GAAK,KAAOve,EAAKwP,qGAC7FzL,EAAW/D,EAAKwqB,MAAQxqB,EAAKmL,iDAGtF7E,KAAK,IACR,0IAIwCvC,EAAW6sE,+EAA4FI,EAAYlyE,qCAE/JkyE,EAAYlyE,OAAS,EACjBkyE,EACG7xE,IAAI,CAACsmC,EAAGrkC,KACP,MAAMyxE,EAAS5uE,OAAOwhC,EAAEt6B,MAAQ,IAAI3E,SAAS,MAE7C,IAAIssE,EAAkB,KACtB,MAAMC,EAAgB9uE,OAAOwhC,EAAEtG,UAAY,IAAIn5B,MAAM,aACjD+sE,IACFD,EAAkBlpE,KAAKkH,IAAI,IAAKlH,KAAKC,IAAI,EAAGoV,SAAS8zD,EAAc,GAAI,OAEzE,MAAMC,EACgB,OAApBF,EACI,wHAAwHA,6DACxH,GACN,MAAO,uHACSnD,GAAa5wE,KAAO,yDACJiE,IAAhByiC,EAAE/E,UAA0B+E,EAAE/E,UAAYmwC,EAAYl6D,UAAUs6D,GAAKA,EAAEzhE,OAASi2B,EAAEj2B,qVAI7CqjE,EAAS,mBAAqB,OAAO9uE,EAAW0hC,EAAEj2B,gDACnGwjE,0EAIL1sE,KAAK,IACR,+FAOtB,MAAM2sE,EAAgB,CACpBj4B,EAAe,OAAS,KACxBxgB,EAAe,OAAS,KACxBygB,EAAiB,KAAO,KACxBtgB,EAAY,MAAQ,KACpBg1C,EAAc,KAAO,KACrBC,EAAY,KAAO,KACnBC,EAAc,KAAO,KACrBC,EAAc,KAAO,MACrBvjE,OAAO4wC,SAGT,OADAj9C,QAAQoK,KAAK,oBAAoB2oE,EAAcn0E,cAAcm0E,EAAc3sE,KAAK,SACzEqvB,GAGHsyC,GAAqB,CAAC/sD,EAAWna,KACrC,IAAKma,IAAcA,EAAUY,KAAKhd,OAChC,MAAO,+FAC+EosC,GAAoBnqC,YAAoBA,uOAGhI,MAAM2P,EAASklB,KACTs9C,EAAmBloC,KAAsB9vB,EAAUnc,MAAQ,GAC3DkC,GAAWia,EAAUja,SAAW,IAAInB,MAAM,GAI1CqzE,EAA8B,WADdpnC,MAAoB,CAAC,GAAGhrC,IAAc,QAG5D,IAAIqyE,EAAgB,EACpB,GAAiC,IAA7Bl4D,EAAUja,QAAQnC,OACpBs0E,EAAgB,OACX,GAAIryE,EAAUyF,SAAS,OAASzF,EAAUyF,SAAS,MAAO,CAC/D,MAAMpF,EAAM8Z,EAAUja,QAAQ0V,UAC5B3U,GAAKA,IAAMA,EAAEwE,SAAS,OAASxE,EAAEwE,SAAS,OAASxE,EAAEwE,SAAS,QAE5DpF,EAAM,IAAGgyE,EAAgBhyE,EAC/B,CAGA,IAAIiyE,EAAgBn4D,EAAUY,KAAK3c,IAAI,CAAC6B,EAAK0V,KAC3C,MAAMnV,EAASxD,EAAY+C,UAAUC,EAAWC,EAAKka,EAAUja,SAE/D,MAAO,CAAE7B,KAAM4B,EAAKsyE,cAAe58D,EAAOnV,SAAQqC,aAD7BrC,GAAUoC,EAAgBC,aAAa7C,EAAWQ,MAGzE,MAAMgyE,GAAcxrC,GAAkBhnC,IAAc,IAAIq6B,cAAcz2B,OAGhE6uE,EA96iBgBzyE,IACfkrC,KAAmBzlC,SAASzF,GA66iBhB0yE,CAAgB1yE,GAE/BwyE,GACFF,EAAgBA,EAAc9mE,OAAOvM,GACnCA,EAAKZ,KAAKkT,KAAKkK,GAAQvY,OAAOuY,GAAM4e,cAAc50B,SAAS+sE,KAE7DF,EAAc3zE,KAAK,CAACC,EAAGC,KAErB,GAAID,EAAEiE,eAAiBhE,EAAEgE,aAAc,OAAQ,EAC/C,IAAKjE,EAAEiE,cAAgBhE,EAAEgE,aAAc,OAAO,EAE9C,MAAM8vE,EAASzvE,OAAOtE,EAAEP,KAAKg0E,IAAkB,IAAIh4C,cAC7Cu4C,EAAS1vE,OAAOrE,EAAER,KAAKg0E,IAAkB,IAAIh4C,cAC7Cw4C,EAAYF,EAAOltE,SAAS+sE,GAC5BM,EAAYF,EAAOntE,SAAS+sE,GAClC,OAAIG,IAAWH,GAAcI,IAAWJ,GAAoB,EACxDG,IAAWH,GAAcI,IAAWJ,EAAmB,EACvDK,IAAcC,GAAmB,GAChCD,GAAaC,EAAkB,EAC7Bl0E,EAAE2zE,cAAgB1zE,EAAE0zE,iBAK7BD,EAAc3zE,KAAK,CAACC,EAAGC,IAEjBD,EAAEiE,eAAiBhE,EAAEgE,cAAsB,GAC1CjE,EAAEiE,cAAgBhE,EAAEgE,aAAqB,EAE1C4vE,EACK5zE,EAAE0zE,cAAgB3zE,EAAE2zE,cAEpB3zE,EAAE2zE,cAAgB1zE,EAAE0zE,eAKjC,MAAMzpC,EAAen5B,EAAOm5B,cAAgB,GACtCiqC,EAAaT,EAAcv0E,OAC3Bi1E,EAAanqE,KAAK62C,KAAKqzB,EAAajqC,IAAiB,EAC3D,IAAImqC,EAAclsC,GAAgB/mC,IAAc,EAC5CizE,EAAcD,IAAYC,EAAcD,GACxCC,EAAc,IAAGA,EAAc,GACnClsC,GAAgB/mC,GAAaizE,EAE7B,MAAMC,GAAYD,EAAc,GAAKnqC,EAC/BqqC,EAASD,EAAWpqC,EACpBsqC,EAAed,EAAcvzE,MAAMm0E,EAAUC,GAG7CE,EAv+iBwBrzE,MACzBA,GACY,CAAC,KAAM,KAAM,KAAM,KAAM,MAC1BuR,KAAK6tB,GAAMp/B,EAAUyF,SAAS25B,IAo+iBvBk0C,CAAwBtzE,GACzCuzE,EAAiBF,EACnB,0EAC+DrwE,EAAWhD,cAAsByyE,EAAa,qBAAuB,8DACvGA,EAAa,oBAAsB,+DAGhE,GAEJ,IAAI79C,EAAO,mJAGsCuV,GAAoBnqC,yCAAiDgD,EAAWhD,oDACnGkzE,EAAW,KAAKrqE,KAAKkH,IAAIojE,EAAQJ,SAAkBA,MAAeN,EAAa,qDAAuD,2FAGlJzyE,EAAUyF,SAAS,MAAQ,wEAAwEzC,EAAWhD,2EAAqF,2BACnMA,EAAUyF,SAAS,MAAQ,wGAA0G,2BACrI8tE,6FACmEvwE,EAAWhD,+BAAuCoyE,EAAa,OAAS,yDACpHA,EAAa,cAAgB,0MAGyBpvE,EAAWhD,wPAGoEgnC,GAAkBhnC,IAAc,IAAImD,QAAQ,KAAM,mPAsWhO,GAhWAyxB,GAAQw+C,EACLh1E,IAAIa,IACH,MAAMu0E,EAAav0E,EAAKszE,cAClBtyE,EAAMhB,EAAKZ,KACXo1E,EAAYtB,EAAiB1sE,SAAS+tE,GACtCE,EAAYzzE,EAAIoyE,IAAkB,MAClCsB,EAAqC,IAAlBtB,EACnBuB,EAAc,GAAGz5D,EAAUnc,OAAOw1E,KAAcnB,IAChDwB,EAAkBvmE,OAAOonD,gBAAkBpnD,OAAOonD,eAAe1jD,IAAI4iE,GACrEE,EAAWptC,GAAe11B,IAAI,GAAGhR,SAAiBwzE,KACxD,IAAIO,EAAW,GACXpkE,EAAOk5B,eACLgrC,EAAiBE,EAAW,uBACvBD,IAAUC,EAAW,uBAIhC,MAAMC,EAAkB/zE,EAAI7B,IAAI,CAACkqB,EAAGzqB,IAAMA,GAAG2N,OAAO3N,GAAKA,EAAI,GAAKA,IAAMw0E,GAClE4B,EAAkBD,EAAgBj2E,OAAS,GAAM,EAEjDm2E,EAAWj0E,EACd7B,IAAI,CAACqd,EAAM43C,KACV,GAAIA,GAAQ,GAAKA,IAASgf,EAAe,MAAO,GAGhD,IADsBnyE,EAAQmzD,EAAO,IAAM,IACzB5tD,SAAS,MAAO,MAAO,GACzC,MACM0uE,EADiB9gB,IAAS2gB,EAAgBA,EAAgBj2E,OAAS,IACnCk2E,EAEhCG,EAAgBl0E,EAAQmzD,EAAO,IAAM,KAAOA,EAG5CghB,EAAar3E,EAAY+C,UAAUC,EAAWC,EAAKka,EAAUja,SAE7Do0E,EADoBD,GAAcr3E,EAAYuE,cAAcvB,EAAWq0E,EAAYn0E,EAAQmzD,EAAO,IAEpG,2HACA,GAEEttB,EAAaquC,EAAcjxE,QAAQ,6BAA8B,IAAIS,OACrE2wE,EAAUzrD,GACd5lB,OAAO4lB,GACJ3lB,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,UACbqxE,EAAiBtxE,OAAOuY,GAAM7X,OAC9B4hC,EAAShiB,GAAwBgxD,GACjCC,EAAsB,CAAC,IAAK,KAAM,IAAK,OAAQ,OAAQ,IAAK,IAAK,MAAO,YAAa,IAAK,OAChG,GAAIA,EAAoBhvE,SAAS+/B,EAAOnL,eACtC,MAAO,GAGT,IAAIoiC,EAAc,GACdiY,GAAY,EAChB,MAAMC,EAAa,OAGbC,EAAkB7uC,IACtB,IAAKA,EAAY,OAAO,EAExB,OADoB7iC,OAAO6iC,GAAY1L,cACpB50B,SAAS,OAaxBovE,EAAcD,EAAgBR,GAAiB,GAAK7uC,GAAqBC,GAE/E,GAAIovC,EAAgBR,GAAgB,CAClC,MAAM3+B,EAAarL,GAAc5E,GAC3BsvC,EAAkC,KAApBP,EAAQ/uC,IAAmC,MAAjBtiC,OAAOuY,GAAgB,SAAW84D,EAAQ/uC,GACxFi3B,EAAchnB,EACV,0BAA4BA,EAAa,KAAOq/B,EAAc,UAC9DA,CACN,MAAO,GAAIhvC,GAAmBN,EAAQO,GAAa,CAEjD,MAEMgvC,EAFYrvC,GAAwBF,GAETh6B,OAAO82C,IACjCA,EAAInzC,WACDslE,EAAoBhvE,SAAS68C,EAAInzC,SAASkrB,gBAGpD,GAAI06C,EAAeh3E,OAAS,EAAG,CAC7B22E,GAAY,EACZ,IAAIM,EAAU,GACd,IAAK,IAAIn3E,EAAI,EAAGA,EAAIk3E,EAAeh3E,OAAQF,IAAK,CAC9C,MAAMykD,EAAMyyB,EAAel3E,GAG3Bm3E,GAAW,sEADTn3E,EAAIk3E,EAAeh3E,OAAS,EAAI,kDAAoD,IACU,KAChGi3E,GACE,6DACAT,EAAQjyB,EAAI7zC,MACZ6lE,EACA,UACEhyB,EAAInzC,WACN6lE,GACE,+HACAT,EAAQjyB,EAAInzC,UACZ,WAEJ6lE,GAAW,QACb,CACAvY,EAAc,uCAAyCuY,EAAU,QACnE,MAAO,GAA8B,IAA1BD,EAAeh3E,OAAc,CACtC22E,GAAY,EACZ,MAAMpyB,EAAMyyB,EAAe,GAC3BtY,EAAc,uEACdA,GACE,6DACA8X,EAAQjyB,EAAI7zC,MACZ6lE,EACA,UACEhyB,EAAInzC,WACNstD,GACE,+HACA8X,EAAQjyB,EAAInzC,UACZ,WAEJstD,GAAe,QACjB,CACF,MAAO,GAAIoY,EAAY92E,OAAS,EAAG,CAEjC22E,GAAY,EACZ,IAAIO,EAAY,GAChB,IAAK,IAAIp3E,EAAI,EAAGA,EAAIg3E,EAAY92E,OAAQF,IAAK,CAC3C,MAAMuzB,EAAOyjD,EAAYh3E,GACnBq3E,GAAY1kE,EAAiBY,cAAcggB,EAAK3iB,MACtDwmE,GACE,6FACFA,GACE,sFACAV,EAAQnjD,EAAK3iB,MACb,KACA8lE,EAAQnjD,EAAK3iB,KAAK1Q,OAAS,EAAIqzB,EAAK3iB,KAAK+O,UAAU,EAAG,GAAK4T,EAAK3iB,MAChE6lE,EACA,UACFW,GAAa,yDACbA,GACE,+EACA7jD,EAAK1wB,MACL,UACEw0E,IACFD,GACE,uEACAV,EAAQnjD,EAAK3iB,MACb,sBACA2iB,EAAK1wB,MACL,gGAEJu0E,GAAa,cACf,CACAxY,EAAc,yCAA2CwY,EAAY,QACvE,MAAO,GAA2B,IAAvBJ,EAAY92E,OAAc,CAEnC22E,GAAY,EACZ,MAAMtjD,EAAOyjD,EAAY,GACnBK,GAAY1kE,EAAiBY,cAAcggB,EAAK3iB,MACtDguD,EAAc,+EACdA,GACE,6DACA8X,EAAQnjD,EAAK3iB,MACb6lE,EACA,UACF7X,GAAe,yDACfA,GAAe,8DAAgErrC,EAAK1wB,MAAQ,UACxFw0E,IACFzY,GACE,uEACA8X,EAAQnjD,EAAK3iB,MACb,sBACA2iB,EAAK1wB,MACL,gGAEJ+7D,GAAe,cACjB,MAAO,GAAIj3B,EAAOznC,OAAS,GAAK42E,EAAW7vE,KAAK0gC,KAAYA,EAAO//B,SAAS,QAAS,CAEnF,MAAM0vE,EAAmB,CAAC,IAAK,KAAM,IAAK,OAAQ,OAAQ,IAAK,IAAK,MAAO,YAAa,IAAK,OACvF9vE,EAAQmgC,EACX98B,MAAMisE,GACNv2E,IAAI6E,GAAKA,EAAEW,QACX4H,OAAOvI,GAAKA,IAAMkyE,EAAiB1vE,SAASxC,EAAEo3B,gBAEjD,GADiBh1B,EAAMtH,OAAS,GAAKsH,EAAMqjB,MAAM7V,GAAKA,EAAE9U,QAAU,GACpD,CAOZ0+D,EAAc,kCANGp3D,EACdjH,IAAIqrB,GAEI,2BADU2gB,GAAc3gB,IAAS,qBACM,KAAO8qD,EAAQ9qD,GAAQ,WAEtElkB,KAAK,IACqD,QAC/D,MAEEk3D,EAFSp3D,EAAMtH,OAAS,EAEVw2E,EAAQlvE,EAAME,KAAK,OAGnB,EAElB,MAAO,IAAIykB,GAAcwb,IAAYA,EAAO//B,SAAS,MAAS+/B,EAAO//B,SAAS,KAevE,CACL,MAAMgwC,EAAarL,GAAc5E,GAC3BsvC,EAAkC,KAApBP,EAAQ/uC,IAAmC,MAAjBtiC,OAAOuY,GAAgB,SAAW84D,EAAQ/uC,GACxFi3B,EAAchnB,EACV,0BAA4BA,EAAa,KAAOq/B,EAAc,UAC9DA,CACN,KArBoF,CAElF,MAAMx4D,EAAS+oB,GAAoBG,GAC7B0vC,GAAY1kE,EAAiBY,cAAc20B,GACjD02B,EAAc,+EACdA,GAAe,SAAW8X,EAAQ/uC,GAAU,UACxC0vC,IACFzY,GACE,uEACA8X,EAAQxuC,GACR,sBACAzpB,EACA,gGAEJmgD,GAAe,QACjB,CAQA,MAAM2Y,EAAgB1uC,GAAe11B,IAAIhR,EAAY,IAAMwzE,EAAa,IAAMngB,GACxEgiB,EAASl7D,EAAUnc,IAAM,IAAMw1E,EAAa,IAAMngB,EAClDiiB,EAAiBhoE,OAAOonD,gBAAkBpnD,OAAOonD,eAAe1jD,IAAIqkE,GAC1E,IAAIE,EAAgB,GAChB5lE,EAAOk5B,eACLysC,EAAgBC,EAAgB,uBAC3BH,IAAeG,EAAgB,uBAW1C,MACE,gBALA,yBACCpB,EAAc,sBAAwB,KACtCO,EAAY,kBAAoB,KAKjC,eACA1xE,EAAWmX,EAAUnc,KACrB,iBACAgF,EAAWhD,GACX,eACAwzE,EACA,eACAngB,EACA,eACAmV,mBAAmB/sD,GAAQ,IAC3B,iCACAsqB,EACAuuC,EACA,oCACAiB,EACA,KACA9Y,EACA,iBAGHl3D,KAAK,IAIR,IAAIiwE,EAAetwC,GAAmBllC,GAClCy1E,EAAc,GAGlB,MAAMC,EAAiBx1E,EAAQ0V,UAAU3U,GAAKA,GAAKA,EAAEwE,SAAS,OAC9D,GAAIiwE,GAAkB,GAAKz1E,EAAIy1E,EAAiB,GAAI,CAElD,MAAMC,EAAgB,CAAC,IAAK,OAAQ,OAAQ,IAAK,IAAK,MAAO,YAAa,KACpEC,EAAkB1yE,OAAOjD,EAAIy1E,EAAiB,IACjDhtE,MAAM,WACNtK,IAAI6E,GAAKA,EAAEW,QACX4H,OAAOvI,GAAKA,IAAM0yE,EAAclwE,SAASxC,EAAEo3B,gBAC9C,GAAIu7C,EAAgB73E,OAAS,EAAG,CAE9B,MAAM83E,EAAiBL,EAAap3E,IAAIQ,GAAKA,EAAEgiC,MAAMvG,eAE/Cy7C,EAAU,CACd,GAAI,eACJ,GAAI,eACJ,GAAI,cACJ,GAAI,cACJ,GAAI,SACJ,GAAI,SACJ,GAAI,kBACJ,GAAI,UACJ,GAAI,UACJ,GAAI,WACJ,GAAI,mBACJ,GAAI,oBACJ,GAAI,UACJ,GAAI,WACJ,GAAI,YAGAC,EAAaH,EAChBpqE,OAAO+iC,IAAQsnC,EAAepwE,SAAS8oC,EAAIlU,gBAC3Cj8B,IAAImwC,IAAO,CACV3N,MAAO2N,EACP5/B,KAAMmnE,EAAQvnC,IAAQ,kBACtBnkC,KAAM,SACNy2B,SAAU,SAAS0N,WACnBzN,WAAW,KAGf00C,EAAe,IAAIA,KAAiBO,EACtC,CACF,CAEA,GAAIP,EAAaz3E,OAAS,EAAG,CACTkC,EAAIoyE,GAOtBoD,EAAc,iCANKD,EAChBp3E,IACC,CAAC43E,EAAKC,IACJ,kCAA+C,UAAbD,EAAI5rE,KAAmB,aAAe,wBAAwB6rE,gBAAqBzC,yBAAkCwC,EAAIrnE,MAAQ,mBAAmB3L,EAAWgzE,EAAIp1C,mBAExMr7B,KAAK,WAEV,CAGA,MAAM2wE,EAAiBl5E,EAAY+C,UAAUC,EAAWC,EAAKka,EAAUja,SAEjEi2E,EADkBD,GAAkBl5E,EAAYyE,YAAYzB,EAAWk2E,GAEzE,8GACA,GAGEE,EAAqBp5E,EAAY+C,UAAUC,EAAWC,EAAKka,EAAUja,SACrE2C,EAAeuzE,GAAsBxzE,EAAgBC,aAAa7C,EAAWo2E,GAC7EC,EAAeD,EACjB,aAAavzE,EAAe,WAAa,8CAA8CA,EAAe,aAAe,mBAAmBG,EAAWhD,qBAA6BgD,EAAWozE,cAA+BvzE,EAAe,OAAS,eAClP,GAEJ,MAAO,6BAA6B4wE,EAAY,mBAAqB,iEAAiEE,EAAmB,KAAOH,EAAa,GAAK,qDAAqDO,gBAAuB/wE,EAAWmX,EAAUnc,qBAAqBgF,EAAWhD,iBAAyBwzE,gBAAyBnB,gBAA4B7J,mBAAmBkL,GAAa,uBAAuB1wE,EAAW0wE,KAAayC,WAAsBE,oCAA+CjE,EAAa,YAAc,gBAAgB8B,UAAiBuB,YAEllBlwE,KAAK,IACRqvB,GAAQ,eAEJo+C,EAAa,EAAG,CAClBp+C,GAAQ,6DAA6E,IAAhBq+C,EAAoB,WAAa,kBAAkBA,EAAc,MAAsB,IAAhBA,EAAoB,WAAa,uDAC7K,MAAMz6C,EAAQ,GACd,GAAIw6C,GAAc,EAChB,IAAK,IAAIn1E,EAAI,EAAGA,GAAKm1E,EAAYn1E,IAAK26B,EAAMt6B,KAAKL,QAE7Co1E,GAAe,EAAGz6C,EAAMt6B,KAAK,EAAG,EAAG,EAAG,EAAG,EAAG,MAAO80E,GAC9CC,GAAeD,EAAa,EACnCx6C,EAAMt6B,KAAK,EAAG,MAAO80E,EAAa,EAAGA,EAAa,EAAGA,EAAa,EAAGA,EAAa,EAAGA,GAClFx6C,EAAMt6B,KAAK,EAAG,MAAO+0E,EAAc,EAAGA,EAAaA,EAAc,EAAG,MAAOD,GAElFx6C,EAAMx5B,QAAQ6T,IACK+hB,GAAP,QAAN/hB,EAAqB,yCACZ,+BAA+BA,IAAMogE,EAAc,SAAW,kBAAkBpgE,MAAMA,eAErG+hB,GAAQ,+BAA+Bq+C,IAAgBD,EAAa,WAAa,kBAAkBC,EAAc,MAAMA,IAAgBD,EAAa,WAAa,6DACnK,CACA,OAAOp+C,GAIH0hD,GAAsB,KAC1B,MAAM,GAAQ/yE,KACRwjE,EAAYp2C,KACZ4lD,EAAW9yE,EAAE,sBAEnB,GAAIsjE,GAAawP,EAASx4E,OAAQ,CAChC,MAAMy4E,EAAe,CAAC,EAEtBD,EAAS3jE,KAAK,sDAAsDye,KAAK,WACvE,GAAI7zB,KAAKkqE,UAAY,EAAG,CAEtB,MACMzU,EADQxvD,EAAEjG,MAAMsyB,QAAQ,kBACXld,KAAK,uBAAuBvU,KAAK,OAE9CyhE,EAASr8D,EAAEjG,MAAMyyB,SAAS,qBAEhC,QAAahuB,IAATgxD,EAAoB,CAEtBujB,EADY1W,EAAS,QAAQ7M,IAASA,GAClBz1D,KAAKkqE,SAC3B,CACF,CACF,GAGAtgC,GAAkB2/B,GAAa,CAC7Br3B,KAAM6mC,EAAS9O,aACf59B,IAAK0sC,EAAS7O,YACd+C,MAAO+L,EACP/rE,UAAW9K,KAAKC,MAEpB,GAGImwC,GAAa,KACjB,MAAM,GAAQxsC,KACd+yE,KAEA7yE,EAAE,kBAAkB0sB,YAAY,WAChC1sB,EAAE,gBAAgB0sB,YAAY,UAC9BM,GAAmB,OAUfgmD,GAAcC,IAClB,MAAM,GAAQnzE,KACRksB,EAAShsB,EAAE,kBACCgsB,EAAOQ,SAAS,WAQhCymD,EAAgBjnD,IAJhBinD,EAAgBjnD,GAChBA,EAAOW,SAAS,aAOdb,GAAaolC,IACjB,MAAM,GAAQpxD,KACRgjD,EAAW9iD,EAAE,gBAEnB8iD,EAAS52B,GAAG,QAAS,+BAAgC,SAAUtwB,GAC7DA,EAAEuwB,kBACF,MAAM2J,EAAYC,GAAgB9W,IAAiBC,MAC7CiX,EAAYF,GAAoBC,UAAUJ,EAAW,OACvDK,GAAaA,EAAUv7B,KACzB6iD,GAAsBtnB,EAAUv7B,MAE5BiP,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,UAE7C,GAGA2wB,EAAS52B,GAAG,QAAS,oBAAqB,SAAUtwB,GAClDA,EAAEuwB,kBACFivB,IACF,GAGA0H,EAAS52B,GAAG,QAAS,+BAAgC,SAAUtwB,GAC7DA,EAAEuwB,kBAEF,IAEE,IAAI2J,EACJ,IACE,MAAM5c,EAAU+F,IAAiBC,KACjC4W,EAAYC,GAAgB7c,EAC9B,CAAE,MAAOg6D,GAEP,MADAx3E,QAAQqK,MAAM,YAAamtE,GACrB,IAAI3rE,MAAM,WAClB,CAEA,IAAKuuB,GAAkC,IAArBA,EAAUx7B,OAE1B,YADIuP,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,qBAK3C,MAAMgE,EAAYF,GAAoBC,UAAUJ,EAAW,OACrDE,EAAeC,GAAoBC,UAAUJ,EAAW,UAExD8pB,EAAU,GAGhB,GAAI5pB,GAAcp7B,MAAM0c,OAAO,GAAI,CACjC,MAAMmJ,EAAauV,EAAap7B,KAAK0c,KAAK,GAAG,GACzCmJ,GAAoC,iBAAfA,GAA2BA,EAAWtgB,QAC7Dy/C,EAAQnlD,KAAK,CAAEuQ,KAAMyV,EAAWtgB,OAAQugB,UAAU,GAEtD,CAeA,GAZIyV,GAAWv7B,MAAM0c,MAAQxY,MAAMqO,QAAQgpB,EAAUv7B,KAAK0c,OACxD6e,EAAUv7B,KAAK0c,KAAK/b,QAAQ,CAACiB,EAAKI,KAChC,GAAIkC,MAAMqO,QAAQ3Q,IAAQA,EAAI,GAAI,CAChC,MAAM69C,EAAU79C,EAAI,GACG,iBAAZ69C,GAAwBA,EAAQl6C,QACzCy/C,EAAQnlD,KAAK,CAAEuQ,KAAMqvC,EAAQl6C,OAAQugB,UAAU,EAAOpiB,SAAU1B,GAEpE,IAKmB,IAAnBgjD,EAAQtlD,OAIV,YAHIuP,OAAOujB,QACTvjB,OAAOujB,OAAO+E,QAAQ,4BAM1B,IACEo4B,GAAkB3K,EAAS,IAAMzyB,KACnC,CAAE,MAAOgmD,GAEP,MADAz3E,QAAQqK,MAAM,0BAA2BotE,GACnC,IAAI5rE,MAAM,aAClB,CACF,CAAE,MAAOxB,GAEPrK,QAAQqK,MAAM,YAAaA,GAG3B,MAAM2R,EAAW3R,aAAiBwB,MAAQxB,EAAMqE,QAAU,OACtDP,OAAOujB,QACTvjB,OAAOujB,OAAOrnB,MAAM,aAAa2R,IAErC,CACF,GAEAorC,EAAS52B,GAAG,QAAS,uBAAwB,SAAUtwB,GACrDA,EAAEuwB,kBACF,MAAM5vB,EAAYyD,EAAEjG,MAAMa,KAAK,SAC3B2B,IACF0Q,GAAMnK,IAAIS,GAA8B,GACxCypB,GAAmBzwB,GACnB4wB,KAEJ,GAGAntB,EAAE,sBACCisB,IAAI,4CACJC,GAAG,uBAAwB,SAAUtwB,GACpC7B,KAAK6wE,aAAehvE,EAAE0zB,cAAcC,QAAQ,GAAGC,QAC/Cz1B,KAAK8wE,aAAejvE,EAAE0zB,cAAcC,QAAQ,GAAGE,OACjD,GACCvD,GAAG,sBAAuB,SAAUtwB,GACnC,IAAK7B,KAAK6wE,aAAc,OACxB,MAAMj7C,EAASvqB,KAAKwqB,IAAIh0B,EAAE0zB,cAAcC,QAAQ,GAAGC,QAAUz1B,KAAK6wE,cAG9Dj7C,EAFWvqB,KAAKwqB,IAAIh0B,EAAE0zB,cAAcC,QAAQ,GAAGE,QAAU11B,KAAK8wE,eAE3Cl7C,EAAS,IAC9B/zB,EAAEuwB,iBAEN,GAEFnsB,EAAE,QACCisB,IAAI,wBACJC,GAAG,uBAAwB,sBAAuB,SAAUtwB,GAG3D,GAFAA,EAAEuwB,kBACFvwB,EAAEuyB,iBACE4U,GAAgB,OACpB,MAAM4+B,EAAez6B,KACrBC,IAAoBw6B,GACpBx0C,IACF,GAEF,MAAMnB,EAAShsB,EAAE,sBACjB,GAAIgsB,EAAO1xB,OAAQ,CAEjB,IAAI84E,EAAc,KAClBpnD,EAAOC,IAAI,mBAAmBC,GAAG,kBAAmB,WAClD,MAAMk7C,EAAQpnE,EAAEjG,MACZq5E,GAAavvD,aAAauvD,GAC9BA,EAAc3vD,WAAW,KACvB,MAAM6/C,EAAYp2C,KACdo2C,IACG3/B,GAAkB2/B,KAAY3/B,GAAkB2/B,GAAa,CAAEl9B,IAAK,EAAG6F,KAAM,EAAG+6B,MAAO,CAAC,IAC7FrjC,GAAkB2/B,GAAWl9B,IAAMghC,EAAMnD,YACzCtgC,GAAkB2/B,GAAWr3B,KAAOm7B,EAAMpD,eAG3C,IACL,EACF,CAEAhkE,EAAE,QACCisB,IAAI,sBACJC,GAAG,qBAAsB,eAAgB,SAAUtwB,GAClD,GAAImnC,GAAgB,OACpB,MAAMo+B,EAAUnhE,EAAEpE,EAAEuhB,QAIpB,GADqBgkD,EAAQ90C,QAAQ,qBACpB/xB,OAIf,OAHAsB,EAAEuwB,kBACFvwB,EAAEuyB,sBACF6tC,KAIF,MAAMqX,EAAUlS,EAAQ90C,QAAQ,gBAChC,GAAIgnD,EAAQ/4E,OAAQ,CAElB,GAA2B,sBAAvB+4E,EAAQ1lD,KAAK,MAA+B,CAC9C/xB,EAAEuyB,iBACFvyB,EAAEk0B,2BACF,MAAMs1C,EAAoBn4D,GAAMtK,IAAIY,GAA8B,GAC5D+vE,EAAiBtzE,EAAE,kBAAkBwsB,SAAS,WAsBpD,OApBI44C,GAAqBkO,GAEvBrmE,GAAMnK,IAAIS,GAA8B,GACxCvD,EAAE,kBAAkB0sB,YAAY,WAChC1sB,EAAE,gBAAgB0sB,YAAY,YAG9Bzf,GAAMnK,IAAIS,GAA8B,GACxCypB,GAAmB,MACnBhtB,EAAE,gBAAgB0sB,YAAY,UAC9B2mD,EAAQ1mD,SAAS,UAGjBqmD,GAAYhnD,IACV,MAAM9S,EAAU+F,IAAiBC,KAC3BgyC,EAASn7B,GAAgB7c,GAAW,CAAC,GAC3C8S,EAAOmF,KAAKs0C,GAAgBvU,IAC5BplC,GAAWolC,OAGR,CACT,CAEA,GAA2B,oBAAvBmiB,EAAQ1lD,KAAK,MAA6B,CAC5C/xB,EAAEuyB,iBACFvyB,EAAEk0B,2BACF,MAAM61C,EAAkB14D,GAAMtK,IAAI,4BAA4B,GACxD2wE,EAAiBtzE,EAAE,kBAAkBwsB,SAAS,WAsBpD,OApBIm5C,GAAmB2N,GAErBrmE,GAAMnK,IAAI,4BAA4B,GACtC9C,EAAE,kBAAkB0sB,YAAY,WAChC1sB,EAAE,gBAAgB0sB,YAAY,YAG9Bzf,GAAMnK,IAAI,4BAA4B,GACtCmK,GAAMnK,IAAIS,GAA8B,GACxCypB,GAAmB,MACnBhtB,EAAE,gBAAgB0sB,YAAY,UAC9B2mD,EAAQ1mD,SAAS,UAGjBqmD,GAAYhnD,IACV,MAAM9S,EAAU+F,IAAiBC,KACjC8M,EAAOmF,KAAKq0C,GAAmBtsD,IAC/B2tD,SAGG,CACT,CAEA,GAA2B,gBAAvBwM,EAAQ1lD,KAAK,MAAyB,CACxC/xB,EAAEuyB,iBACFvyB,EAAEk0B,2BACF,MAAMw1C,EAAcp4C,OAAwBpK,GAAUC,UAChDuwD,EAAiBtzE,EAAE,kBAAkBwsB,SAAS,WAiDpD,OA/CI84C,GAAegO,GAEjBtmD,GAAmB,MACnBhtB,EAAE,kBAAkB0sB,YAAY,WAChC1sB,EAAE,gBAAgB0sB,YAAY,YAG9Bzf,GAAMnK,IAAIS,GAA8B,GACxC0J,GAAMnK,IAAI,4BAA4B,GACtCkqB,GAAmBlK,GAAUC,WAC7B/iB,EAAE,gBAAgB0sB,YAAY,UAC9B2mD,EAAQ1mD,SAAS,UAGjBqmD,GAAYhnD,IACV,IACE,MAAMggB,EAAYlpB,GAAUqG,cAEtBoqD,EAAiBxiD,KAAkBjO,GAAUC,WAC/CwwD,EACFvnD,EAAOuB,IAAI,SAAUgmD,EAAiB,MAAM5mD,SAAS,mBAErDX,EAAOuB,IAAI,SAAU,IAAIb,YAAY,mBAEvCV,EAAOmF,KAAK,8BAAgC6a,EAAY,UACxDlpB,GAAUgJ,WAAWE,EACvB,CAAE,MAAOjmB,GACPrK,QAAQqK,MAAM,+BAAgCA,EAChD,CAGA+c,GAAU6E,iBAAiB,EAAG,KAC3BsK,KAAKlK,IAEAA,IACFiE,EAAOmF,KAAK,8BAAgCrO,GAAUqG,cAAgB,UACtErG,GAAUgJ,WAAWE,MAGxBoG,MAAMC,IACL32B,QAAQqK,MAAM,sCAAuCssB,GAErDrG,EAAOmF,KAAK,8BAAgCrO,GAAUqG,cAAgB,UACtErG,GAAUgJ,WAAWE,SAItB,CACT,CACApwB,EAAEuwB,kBAEFlf,GAAMnK,IAAIS,GAA8B,GACxC0J,GAAMnK,IAAI,4BAA4B,GACtC,MAAMvG,EAAY82E,EAAQz4E,KAAK,SACzB44E,EAAmBtmD,KACzB,OAAIsmD,IAAqBj3E,GAAayD,EAAE,kBAAkBwsB,SAAS,gBACjE8f,MAGFtsC,EAAE,gBAAgB0sB,YAAY,UAC9B2mD,EAAQ1mD,SAAS,UACb3sB,EAAE,sBAAsB1F,QAAUk5E,GACpCX,KAEF7lD,GAAmBzwB,QACnBknB,WAAW,IAAM0J,KAAmB,GAEtC,CACA,MAAMsmD,EAAQtS,EAAQ90C,QAAQ,aAC9B,GAAIonD,EAAMn5E,OAGR,OAFAsB,EAAEuwB,uBACFunD,GAAa93E,EAAG63E,EAAM,IAGxB,MAAME,EAAWxS,EAAQ90C,QAAQ,iBACjC,GAAIsnD,EAASr5E,OAAQ,CAEnB,GADAsB,EAAEuwB,kBACEwnD,EAASnnD,SAAS,aAAemnD,EAASnnD,SAAS,UAAW,OAClE,MAAMonD,EAAUn5D,SAASk5D,EAAS/4E,KAAK,SACjC0oE,EAAYp2C,KAQlB,YAPIo2C,IACFhgC,GAAgBggC,GAAasQ,EAC7BzmD,KACA0hC,sBAAsB,KACpB7uD,EAAE,sBAAsBikE,UAAU,MAIxC,CAEF,GAEFjkE,EAAE,mBACCisB,IAAI,SACJC,GAAG,QAAStwB,IACXA,EAAEuwB,kBACE4W,KACJoE,IAAmB,GACnBha,QAGJntB,EAAE,qBACCisB,IAAI,SACJC,GAAG,QAAStwB,IACXA,EAAEuwB,kBACE4W,KACJoE,IAAmB,GACnBha,QAIJntB,EAAE,oBACCisB,IAAI,SACJC,GAAG,QAASjL,MAAMrlB,IAIjB,GAHAA,EAAEuwB,kBAGE4W,GAAgB,OAGpB,GAAID,GAEF,YADIj5B,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,2BAI9BnyB,EAAEpE,EAAEizC,eACE1/B,KAAK,KAKxB43B,GAAqB,CAAC,GAGtB9nB,GAAgB,KAGhBmkB,IAAoB,EACpBH,GAAep7B,QACXgC,OAAOonD,gBAAgBpnD,OAAOonD,eAAeppD,QAGjD,MAAM8oD,EAAW3wD,EAAE,wBACnB2wD,EAASxhD,KAAK,KAAKud,YAAY,oBAC/BikC,EAAShjC,KAAK,QAAS,UAAUJ,IAAI,QAAS,IAM9C,MAAMhwB,EAAWymC,KACbzmC,IACF0hB,GAAgB1hB,GAKlByC,EAAE,yDAAyDyhB,SAG3D0L,OAMJntB,EAAE,yBACCisB,IAAI,SACJC,GAAG,QAASjL,MAAMrlB,IAEjB,GADAA,EAAEuwB,kBACE4W,GAAgB,OACpB,MAAMkB,EAAMnkC,KAAUokC,QACtB,GAAID,GAAmC,mBAArBA,EAAI4vC,aACpB,UACQ5vC,EAAI4vC,cACZ,CAAE,MAAOxhD,GACP32B,QAAQqK,MAAM,oBAAqBssB,GACnC,MAAMjmB,EAAeimB,EAAIjoB,SAAW,YAChCP,OAAOujB,OACTvjB,OAAOujB,OAAOrnB,MAAM,SAASqG,IAAgB,KAAM,CAAEg4B,QAAS,MAE9Dr6B,MAAM,SAASqC,IAEnB,MAEIvC,OAAOujB,QACTvjB,OAAOujB,OAAO+E,QAAQ,6CAA8C,GAAI,CACtEiS,QAAS,QAKnBpkC,EAAE,QACCisB,IAAI,sBACJC,GAAG,qBAAsB,oBAAqB,SAAUtwB,GACvDA,EAAEuwB,kBACFvwB,EAAEuyB,iBACE4U,IACJi5B,IACF,GAEFh8D,EAAE,qBACCisB,IAAI,SACJC,GAAG,QAAStwB,IACXA,EAAEuwB,kBACE4W,IACJzU,GAAc,CACZC,YAAa,KACbC,WAAY,WAmBlBxuB,EAAE,mBACCisB,IAAI,SACJC,GAAG,QAASjL,MAAMrlB,IAEjB,GADAA,EAAEuwB,kBACE4W,GAAgB,OACpB,MAAMkB,EAAMnkC,KAAUokC,QACtB,GAAID,GAAmC,mBAArBA,EAAI4vC,aACpB,IACEn4E,QAAQC,IAAI,0BAENsoC,EAAI4vC,cACZ,CAAE,MAAOxhD,GACP32B,QAAQqK,MAAM,oBAAqBssB,GACnC,MAAMjmB,EAAeimB,EAAIjoB,SAAW,YAChCP,OAAOujB,OACTvjB,OAAOujB,OAAOrnB,MAAM,SAASqG,IAAgB,KAAM,CAAEg4B,QAAS,MAE9Dr6B,MAAM,SAASqC,IAEnB,MAEA1Q,QAAQG,KAAK,kCACTgO,OAAOujB,QACTvjB,OAAOujB,OAAO+E,QAAQ,0BAA2B,GAAI,CAAEiS,QAAS,QAIxEpkC,EAAE,wBACCisB,IAAI,SACJC,GAAG,QAASjL,eAAgBrlB,GAE3B,GADAA,EAAEuwB,kBACE4W,GAAgB,OACpB,IAAI9mC,EAAa,KAOjB,GALEA,EADEmnC,IAAqBnkB,GACVA,GAEAC,KAGXjjB,EAAY,OAER+yD,GAAmB/yD,GAAY,GAAM,GAI3C+D,EAAE,yBAAyB0sB,YAAY,wBAGnC7iB,OAAOonD,gBAAgBpnD,OAAOonD,eAAeppD,QACjDu7B,IAAoB,EAGpB,MAAMkD,EAAOtmC,EAAEjG,MACDusC,EAAKn3B,KAAK,KAClBud,YAAY,uCAAuCC,SAAS,WAClE2Z,EAAK3Y,KAAK,QAAS,UAAUJ,IAAI,QAAS,IAC1C+Y,EAAK2H,KAAK,YAAY,EAGxB,MACMpkC,OAAOujB,QAAQvjB,OAAOujB,OAAOrnB,MAAM,gBAE3C,GAEF,MAAMs9D,EAAerjE,EAAE,qBACvB,GAAIqjE,EAAa/oE,OAAQ,CACvB,IAAIw5E,EACAC,GAAc,EAClB1Q,EACGp3C,IAAI,yCACJC,GAAG,mBAAoB,KACtB6nD,GAAc,IAEf7nD,GAAG,iBAAkB,WACpB6nD,GAAc,EACd,MAAM7zE,EAAMF,EAAEjG,MAAMmG,MACdojE,EAAYp2C,KACdo2C,IACF//B,GAAkB+/B,GAAapjE,EAC/BojC,GAAgBggC,GAAa,EAC7Bn2C,KACA1J,WAAW,KACTzjB,EAAE,qBAAqBgwB,SACtB,GAEP,GACC9D,GAAG,QAAS,WACX,GAAI6nD,EAAa,OACjB,MAAM7zE,EAAMF,EAAEjG,MAAMmG,MACd8zE,EAAiBj6E,KAAKi6E,eACtBC,EAAel6E,KAAKk6E,aAC1BpwD,aAAaiwD,GACbA,EAAgBrwD,WAAW,KACzB,MAAM6/C,EAAYp2C,KAClB,GAAIo2C,EAAW,CACb//B,GAAkB+/B,GAAapjE,EAC/BojC,GAAgBggC,GAAa,EAC7B,MAAM4Q,EAAU3tE,SAAS4tE,eAAiB5tE,SAAS4tE,cAAcC,UAAU/2D,SAAS,oBAEpF,GADA8P,KACI+mD,EAAS,CACX,MAAMG,EAAYr0E,EAAE,qBAEpB,GADAq0E,EAAUrkD,QACNqkD,EAAU/5E,QAAU+5E,EAAU,GAAGtW,kBACnC,IACEsW,EAAU,GAAGtW,kBAAkBiW,EAAgBC,EACjD,CAAE,MAAOr4E,GAAI,CAEjB,CACF,GACC,IACL,EACJ,CAEAoE,EAAE,2BACCisB,IAAI,SACJC,GAAG,QAAS,SAAUtwB,GACrBA,EAAEuyB,iBACFvyB,EAAEuwB,kBACF,MAAM5vB,EAAYyD,EAAEjG,MAAMa,KAAK,SACzBse,EAAU+F,IAAiBC,KACjC,GAAIhG,EACF,IAAK,MAAM3e,KAAO2e,EAAS,CACzB,MAAMlC,EAAQkC,EAAQ3e,GACtB,GAAIyc,GAAOhM,OAASzO,EAAW,CAC7B,MAAMma,EAAY,CAChBja,QAASua,EAAM5P,UAAU,IAAM,GAC/BkQ,KAAMN,EAAM5P,SAAS9L,MAAM,IAAM,GACjCf,IAAKA,GAGP,YADAkjD,GAAsB/mC,EAExB,CACF,CAEE7M,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,WAC3C,GAEFnyB,EAAE,sBACCisB,IAAI,SACJC,GAAG,QAAS,SAAUtwB,GACrBA,EAAEuyB,iBACFvyB,EAAEuwB,kBACFivB,IACF,GAIFp7C,EAAE,yBACCisB,IAAI,SACJC,GAAG,QAAS,SAAUtwB,GACrBA,EAAEuyB,iBACFvyB,EAAEuwB,kBACF,MAAM5vB,EAAYyD,EAAEjG,MAAMa,KAAK,SACzBsmC,EAASqG,KACTvlB,EAAUkf,EAAO3kC,IAAc,OAzilBnBsI,MA0ilBlBq8B,EAAO3kC,GAAyB,SAAZylB,EAAqB,OAAS,OA1ilBhCnd,EA2ilBFq8B,EA3ilBOj0B,GAAMnK,IAAIW,EAA0BoB,GA4ilB3DsoB,IACF,GAGFntB,EAAE,2BACCisB,IAAI,eACJC,GAAG,cAAe,SAAUtwB,GAC3B,GAAiB,IAAbA,EAAEq0B,OAAc,OACpBr0B,EAAEuyB,iBACFvyB,EAAEuwB,kBACF,MAAM+D,EAASn2B,KACfm2B,EAAOC,kBAAkBv0B,EAAEw0B,WAC3BpwB,EAAEkwB,GAAQvD,SAAS,UACnB,MAAMX,EAAShsB,EAAE,kBACXqwB,EAAcrE,EAAOsE,SACrBC,EAAS30B,EAAE6zB,QACXlzB,EAAYyD,EAAEkwB,GAAQt1B,KAAK,SAEjCs1B,EAAOM,cAAgB,SAAUC,GAC/B,MAAMC,EAAKD,EAAMhB,QAAUc,EAC3B,IAAII,EAAYN,EAAcK,EAC1BC,EAAY/sB,IAAkB+sB,EAAY/sB,GAC1C+sB,EAAY9sB,IAAkB8sB,EAAY9sB,GAC9CmoB,EAAOuB,IAAI,SAAUoD,EAAY,KACnC,EACAT,EAAOU,YAAc,SAAUC,GAK7B,GAJA7wB,EAAEkwB,GAAQxD,YAAY,UACtBwD,EAAOY,sBAAsBD,EAAIT,WACjCF,EAAOM,cAAgB,KACvBN,EAAOU,YAAc,KACjBr0B,EAAW,CACb,MAAM00B,EAAUF,KAChBE,EAAQ10B,GAAake,SAASuR,EAAOuB,IAAI,WACzCyD,GAAiBC,GACjBjF,EAAOW,SAAS,kBAClB,CACF,CACF,GAGF3sB,EAAE,2BACCisB,IAAI,YACJC,GAAG,WAAY,SAAUtwB,GACxBA,EAAEuyB,iBACFvyB,EAAEuwB,kBACF,MAAM5vB,EAAYyD,EAAEjG,MAAMa,KAAK,SAC/B,GAAI2B,EAAW,CACb,MAAM00B,EAAUF,YACTE,EAAQ10B,GACfy0B,GAAiBC,GACjBjxB,EAAE,kBAAkButB,IAAI,SAAU,IAAIb,YAAY,kBACpD,CACF,GAGFo2B,EAAS52B,GAAG,QAAS,mBAAoB,SAAUtwB,GACjDA,EAAEuwB,kBACF,MAAMmoD,EAAQt0E,EAAEjG,MAAMa,KAAK,SACtB05E,IAEL5sC,GAAmB4sC,GAGnBnnD,KACF,GAEAntB,EAAE,qBACCisB,IAAI,gBACJC,GAAG,eAAgB,SAAUtwB,GAC5B,GAAIoE,EAAEpE,EAAEuhB,QAAQkP,QAAQ,oDAAoD/xB,OAAQ,OACpFsB,EAAEuyB,iBACFvyB,EAAEuwB,kBACF,MAAM5vB,EAAY2wB,KAClB,GAAI3wB,EAAW,CACb,MAAM00B,EAAUF,YACTE,EAAQ10B,GACfy0B,GAAiBC,GACjBjxB,EAAE,kBAAkButB,IAAI,SAAU,IAAIb,YAAY,kBACpD,CACF,GAEF1sB,EAAE,kBACCisB,IAAI,SACJC,GAAG,QAAS,SAAUtwB,GACrBA,EAAEuwB,kBACF,MAAM4D,EAAS/vB,EAAE,qBAGjB,GAAI+vB,EAAOz1B,QAAUy1B,EAAO7vB,MAE1B,YADA6vB,EAAO7vB,IAAI,IAAIW,QAAQ,SAASmvB,QAMlC,GAD0B/iB,GAAMtK,IAAIY,GAA8B,GAMhE,OAHA0J,GAAMnK,IAAIS,GAA8B,GACxCypB,GAAmB,WACnBG,KAMF,GADoBD,OAAwBpK,GAAUC,UAKpD,OAFAiK,GAAmB,WACnBG,KAKFmf,IACF,GAEFtsC,EAAE,QACCisB,IAAI,sBACJC,GAAG,qBAAsB,qBAAsB,SAAUtwB,GACxDA,EAAEuwB,kBACFvwB,EAAEuyB,iBAEF,MAAMC,EAAQpuB,EAAEjG,MACVwC,EAAY6xB,EAAMxzB,KAAK,SACvBmC,EAASqxB,EAAMxzB,KAAK,WAErB2B,GAAcQ,IAGnBoC,EAAgBE,eAAe9C,EAAWQ,GAGX,mBAApBowB,IACTA,KAEJ,GAGFntB,EAAE,QACCisB,IAAI,oBACJC,GAAG,mBAAoB,mBAAoB,SAAUtwB,GACpDA,EAAEuwB,kBACFvwB,EAAEuyB,iBAEF,MAAMmY,EAAOtmC,EAAEjG,MACTohB,EAASV,SAAS6rB,EAAK1rC,KAAK,OAAQ,IACpC25E,EAAY95D,SAAS6rB,EAAK1rC,KAAK,cAAe,IAI9C45E,EADQluC,EAAKja,QAAQ,kBACNld,KAAK,uBACpB2oC,EAAW08B,EAAO55E,KAAK,OACvB2B,EAAYi4E,EAAO55E,KAAK,UAAY,GAGpCse,EAAU+F,IAAiBC,KACjC,IAAKhG,IAAYA,EAAQ4+B,GAAW,OAEpC,MAAMr7C,EAAUyc,EAAQ4+B,GAAU1wC,QAAQ,IAAM,GAC1C9J,EAAU4b,EAAQ4+B,GAAU1wC,QAAQ+T,EAAS,IAAM,GAGnD+2D,EAAgB,CAAC,IAAK,OAAQ,OAAQ,IAAK,IAAK,MAAO,YAAa,KAG1E,IAAIh1C,EAAUuE,GAAmBllC,GAGjC,MAAM01E,EAAiBx1E,EAAQ0V,UAAU3U,GAAKA,GAAKiC,OAAOjC,GAAGwE,SAAS,OACtE,GAAIiwE,GAAkB,GAAK30E,EAAQ20E,GAAiB,CAClD,MAAMzd,EAAY/0D,OAAOnC,EAAQ20E,IAAiB9xE,OAClD,GAAIq0D,IAAc0d,EAAclwE,SAASwyD,EAAU59B,eAAgB,CACjE,MAAMu7C,EAAkB3d,EACrBvvD,MAAM,WACNtK,IAAI6E,GAAKA,EAAEW,QACX4H,OAAOvI,GAAKA,IAAM0yE,EAAclwE,SAASxC,EAAEo3B,gBAC9C,GAAIu7C,EAAgB73E,OAAS,EAAG,CAE9B,MAAM83E,EAAiBl1C,EAAQviC,IAAIQ,GAAKA,EAAEgiC,MAAMvG,eAE1C07C,EAAaH,EAChBpqE,OAAO+iC,IAAQsnC,EAAepwE,SAAS8oC,EAAIlU,gBAC3Cj8B,IAAImwC,IAAO,CACV3N,MAAO2N,EACP5/B,KAAM,kBACNvE,KAAM,SACNy2B,SAAU,qBAAqB0N,KAC/BzN,WAAW,KAGfH,EAAU,IAAIA,KAAYo1C,EAC5B,CACF,CACF,CAEA,MAAMmC,EAASv3C,EAAQq3C,GAGvB,GAAIE,GAA0B,gBAAhBA,EAAO9tE,KAAwB,CAC3C,MAAM+tE,EAAYp3E,EAAQ,IAAM,KAGhC,IAAIq3E,EAAa,KACjB,MAAMC,EAAan4E,EAAQ0V,UAAU3U,GAAKA,GAAKA,EAAEwE,SAAS,QACpD6yE,EAAUp4E,EAAQ0V,UAAU3U,GAAKA,IAAMA,EAAEwE,SAAS,OAASxE,EAAEwE,SAAS,QAG5E,GAAI4yE,EAAa,GAAKt3E,EAAQs3E,GAAa,CACzC,MAAM10E,EAAM0hC,GAAoBtkC,EAAQs3E,IACpC10E,EAAM,IAAGy0E,EAAaz0E,EAC5B,CAEA,GAAmB,OAAfy0E,GAAuBE,EAAU,GAAKv3E,EAAQu3E,GAAU,CAC1D,MAAM30E,EAAM0hC,GAAoBtkC,EAAQu3E,IACpC30E,EAAM,IAAGy0E,EAAaz0E,EAC5B,CAGA,MAAM40E,EAAatyC,GAAgBiyC,EAAOr3C,SAAU9/B,EAASb,GAa7D,OAZAkD,EAAsBm1E,EAAY,eAGf,OAAfH,GAAuBA,EAAa,EACtCrmD,GAAc,CACZC,YAAaomD,EACbnmD,WAAYkmD,EACZjmD,cAAe,WAGjBzuB,EAAE,kBAAkBgwB,QAGxB,CAEA,GAAIykD,GAAUA,EAAOr3C,SAAU,CAE7B,MAAMlkB,EAAU+F,IAAiBC,KACjC,GAAIhG,GAAWA,EAAQ4+B,GAAW,CAChC,MAAMr7C,EAAUyc,EAAQ4+B,GAAU1wC,QAAQ,IAAM,GAC1C9J,EAAU4b,EAAQ4+B,GAAU1wC,QAAQ+T,EAAS,IAAM,GACnDk/B,EAAU/8C,EAAQ,IAAM,KAG9B,GAAqB,OAAjBm3E,EAAOt3C,MAAgB,CACV/L,KACfpxB,EAAE,oBAAoByhB,SAEtB,MAAMwf,EAAIrW,KAEJgjB,EAAU5tC,EAAE,0QAEqBihC,EAAEzD,4BAA4ByD,EAAExD,iMACDwD,EAAEpD,uJACNt+B,EAAW86C,4LAEoDpZ,EAAEhD,uCAAuCgD,EAAExD,kCAAkCwD,EAAElW,oQAEvHkW,EAAEhD,4BAA4BgD,EAAExD,kCAAkCwD,EAAElW,6IACtEkW,EAAE7C,mDAAmD6C,EAAE5C,iMAM9Ir+B,EAAE,QAAQqxB,OAAOuc,GAEjB,MAAM6N,EAAY7N,EAAQ,GAC1B6N,EAAUh1C,MAAMi1C,YAAY,WAAY,QAAS,aACjDD,EAAUh1C,MAAMi1C,YAAY,MAAO,IAAK,aACxCD,EAAUh1C,MAAMi1C,YAAY,OAAQ,IAAK,aACzCD,EAAUh1C,MAAMi1C,YAAY,QAAS,IAAK,aAC1CD,EAAUh1C,MAAMi1C,YAAY,SAAU,IAAK,aAC3CD,EAAUh1C,MAAMi1C,YAAY,QAAS,QAAS,aAC9CD,EAAUh1C,MAAMi1C,YAAY,SAAU,QAAS,aAC/CD,EAAUh1C,MAAMi1C,YAAY,UAAW,OAAQ,aAC/CD,EAAUh1C,MAAMi1C,YAAY,kBAAmB,SAAU,aACzDD,EAAUh1C,MAAMi1C,YAAY,cAAe,SAAU,aACrDD,EAAUh1C,MAAMi1C,YAAY,UAAW,aAAc,aACrDj4B,WAAW,IAAMmqB,EAAQz+B,KAAK,kBAAkB6gB,QAAS,IAEzD,MAAM+kD,EAAc,KAClB,MAAM7gD,EAAM0Z,EAAQz+B,KAAK,kBAAkBjP,MAAMC,OACjD,GAAI+zB,EAAK,CAEPv0B,EADmB,UAAU06C,OAAanmB,KACR,UAClCl0B,EAAE,kBAAkBgwB,OACtB,CACA4d,EAAQnsB,UAcV,OAXAmsB,EAAQz+B,KAAK,iBAAiBo9B,MAAMwoC,GACpCnnC,EAAQz+B,KAAK,kBAAkB+c,GAAG,UAAW,SAAU8oD,GACtC,UAAXA,EAAGz6E,MACLy6E,EAAG7mD,iBACH4mD,IAEJ,GACAnnC,EAAQz+B,KAAK,mBAAmBo9B,MAAM,IAAMqB,EAAQnsB,eACpDmsB,EAAQ1hB,GAAG,QAAS,SAAU8oD,GACxBh1E,EAAEg1E,EAAG73D,QAAQqP,SAAS,oBAAoBohB,EAAQnsB,QACxD,EAEF,CAGA,MAAMqzD,EAAatyC,GAAgBiyC,EAAOr3C,SAAU9/B,EAASb,GAC7DkD,EAAsBm1E,EAAY,UAClC90E,EAAE,kBAAkBgwB,OACtB,CACF,CACF,GAGFhwB,EAAE,QACCisB,IAAI,yBACJC,GAAG,wBAAyB,gBAAiB,SAAUtwB,GACtDA,EAAEuwB,kBACFmC,GAAc,CACZC,YAAa,GACbC,WAAY,QACZ8e,SAAU,SAEd,GAGFttC,EAAE,QACCisB,IAAI,6BACJC,GAAG,4BAA6B,uBAAwB,SAAUtwB,GACjEA,EAAEuwB,kBACansB,EAAEjG,MAAMsyB,QAAQ,uBACxBgB,YAAY,WACrB,GAGFrtB,EAAE,QACCisB,IAAI,uBACJC,GAAG,sBAAuB,0CAA2C,SAAUtwB,GAC9EA,EAAEuwB,kBACF,MAAM5vB,EAAYyD,EAAEjG,MAAMa,KAAK,SACzBm0E,EAAa/uE,EAAEjG,MAAMa,KAAK,WAAa,GAEzC2B,IAEF0Q,GAAMnK,IAAIS,GAA8B,GAGxCypB,GAAmBzwB,GAGfwyE,IACFxrC,GAAkBhnC,GAAawyE,EAC/BzrC,GAAgB/mC,GAAa,GAI/B4wB,KAGI4hD,GACFtrD,WAAW,KACT,MAAMsM,EAAS/vB,EAAE,qBACb+vB,EAAOz1B,QAAQy1B,EAAOC,SACzB,KAGT,GAGFhwB,EAAE,QACCisB,IAAI,yBACJC,GAAG,wBAAyB,uBAAwB,SAAUtwB,GAC7DA,EAAEuwB,kBACFvwB,EAAEuyB,iBAGF,MAAM1H,EAAWzmB,EAAEjG,MAAM4zB,KAAK,mBAAqB,KAC7CU,EAAY5T,SAASza,EAAEjG,MAAM4zB,KAAK,mBAAoB,KAAO,GAG7DvB,EAAQpsB,EAAEjG,MAAMsyB,QAAQ,kBACxB4jD,EAAY7jD,EAAMjd,KAAK,uBAAuB0Q,OAAO1f,OAIrD80E,GADY7oD,EAAMjd,KAAK,uBAAuBvU,KAAK,UAAY,IACrCoH,SAAS,MAGzCssB,GAAc,CACZD,UAAWA,EACXE,YAAa,KACbC,WAAY/H,EACZgI,cANoBwmD,EAAgB,SAAWhF,GASnD,GAEFjwE,EAAE,QACCisB,IAAI,uBACJC,GAAG,sBAAuB,qBAAsB,SAAUtwB,GACzDA,EAAEuwB,kBACFvwB,EAAEuyB,iBACF,MAAMI,EAAc9T,SAASza,EAAEjG,MAAMa,KAAK,UAAW,KAAO,GACtD4zB,EAAaxuB,EAAEjG,MAAMa,KAAK,SAAW,KACrCy/C,EAAUr6C,EAAEjG,MAAMa,KAAK,QAAU,GAGvC,GAAIy/C,EAAS,CAEX,MAAM66B,EAAkBltC,GAAkB,SAAUxZ,IAAe,GACnEgkB,GAAiB,CACf/jB,cAAe,SACfgkB,eAAgByiC,EAChBviC,aAAc0H,EACdtH,cAAexkB,GAEnB,MACED,GAAc,CACZC,YAAaA,EACbC,WAAYA,EACZC,cAAe,UAGrB,GAEFzuB,EAAE,QACCisB,IAAI,uBACJC,GAAG,sBAAuB,qBAAsB,SAAUtwB,GACzDA,EAAEuwB,kBACFvwB,EAAEuyB,iBACF,MAAMqqB,EAAex4C,EAAEjG,MAAMa,KAAK,aAAe,OAEjD+E,EADmB,WAAW64C,KACI,UAClCx4C,EAAE,kBAAkBgwB,OACtB,GAEFhwB,EAAE,QACCisB,IAAI,2BACJC,GAAG,0BAA2B,yBAA0B,SAAUtwB,GACjEA,EAAEuwB,kBACFvwB,EAAEuyB,iBACF,MAAMgnD,EAAWn1E,EAAEjG,MAAMa,KAAK,SAAW,KAEzC+E,EADmB,WAAWw1E,KACI,UAClCn1E,EAAE,kBAAkBgwB,OACtB,GAEFhwB,EAAE,QACCisB,IAAI,4BACJC,GAAG,2BAA4B,0BAA2B,SAAUtwB,GACnEA,EAAEuwB,kBACFvwB,EAAEuyB,iBACF,MAAMumD,EAAY10E,EAAEjG,MAAMa,KAAK,UAAY,KAGrCse,EAAU+F,IAAiBC,KACjC,IAAIy1D,EAAa,KAEjB,GAAIz7D,EAEF,IAAK,MAAM3e,KAAO2e,EAAS,CACzB,MAAMlC,EAAQkC,EAAQ3e,GACtB,GAAKyc,GAAUA,EAAMhM,MAASgM,EAAM5P,UAChC4P,EAAMhM,KAAKhJ,SAAS,OAASgV,EAAMhM,KAAKhJ,SAAS,OAAO,CAC1D,MAAMvF,EAAUua,EAAM5P,QAAQ,IAAM,GAE9Bu2C,EAAUlhD,EAAQ0V,UAAU3U,GAAKA,IAAMA,EAAEwE,SAAS,OAASxE,EAAEwE,SAAS,UAAY,EAClF4yE,EAAan4E,EAAQ0V,UAAU3U,GAAKA,GAAKA,EAAEwE,SAAS,QACpD6yE,EAAUp4E,EAAQ0V,UAAU3U,GAAKA,IAAMA,EAAEwE,SAAS,OAASxE,EAAEwE,SAAS,QAE5E,IAAK,IAAI5H,EAAI,EAAGA,EAAI4c,EAAM5P,QAAQ9M,OAAQF,IAAK,CAC7C,MAAMoC,EAAMwa,EAAM5P,QAAQhN,GAC1B,GAAIoC,GAAOA,GAAiB,IAAbmhD,EAAiB,EAAIA,KAAa+2B,EAAW,CAE1D,GAAIE,EAAa,GAAKp4E,EAAIo4E,GAAa,CACrC,MAAM10E,EAAM0hC,GAAoBplC,EAAIo4E,IACpC,GAAI10E,EAAM,EAAG,CACXy0E,EAAaz0E,EACb,KACF,CACF,CAEA,GAAI20E,EAAU,GAAKr4E,EAAIq4E,GAAU,CAC/B,MAAM30E,EAAM0hC,GAAoBplC,EAAIq4E,IACpC,GAAI30E,EAAM,EAAG,CACXy0E,EAAaz0E,EACb,KACF,CACF,CACA,KACF,CACF,CACA,GAAmB,OAAfy0E,EAAqB,KAC3B,CACF,CAKFh1E,EADmB,WAAW+0E,KACI,UAGf,OAAfC,GAAuBA,EAAa,EACtCrmD,GAAc,CACZC,YAAaomD,EACbnmD,WAAYkmD,EACZjmD,cAAe,WAIjBzuB,EAAE,kBAAkBgwB,OAExB,GAEFhwB,EAAE,QACCisB,IAAI,6BACJC,GAAG,4BAA6B,2BAA4B,SAAUtwB,GACrEA,EAAEuwB,kBACFvwB,EAAEuyB,iBACF,MAAMinD,EAAWp1E,EAAEjG,MAAMa,KAAK,SAAW,KAEzC+E,EADmB,UAAUy1E,aACK,UAClCp1E,EAAE,kBAAkBgwB,OACtB,GAEFhwB,EAAE,QACCisB,IAAI,sBACJC,GAAG,qBAAsB,oBAAqB,SAAUtwB,GACvDA,EAAEuwB,kBACFvwB,EAAEuyB,iBACF,MAAMksB,EAAUr6C,EAAEjG,MAAMa,KAAK,QAAU,KACxBw2B,KAGfpxB,EAAE,oBAAoByhB,SAGtB,MAAMwf,EAAIrW,KAEJgjB,EAAU5tC,EAAE,yQAEsCihC,EAAEzD,4BAA4ByD,EAAExD,qLACxBwD,EAAEpD,2IACNt+B,EAAW86C,oKAEoDpZ,EAAEhD,uCAAuCgD,EAAExD,kCAAkCwD,EAAElW,4OAEvHkW,EAAEhD,4BAA4BgD,EAAExD,kCAAkCwD,EAAElW,iIACtEkW,EAAE7C,mDAAmD6C,EAAE5C,iJAMxIr+B,EAAE,QAAQqxB,OAAOuc,GACjB,MAAM6N,EAAY7N,EAAQ,GAC1B6N,EAAUh1C,MAAMi1C,YAAY,WAAY,QAAS,aACjDD,EAAUh1C,MAAMi1C,YAAY,MAAO,IAAK,aACxCD,EAAUh1C,MAAMi1C,YAAY,OAAQ,IAAK,aACzCD,EAAUh1C,MAAMi1C,YAAY,QAAS,IAAK,aAC1CD,EAAUh1C,MAAMi1C,YAAY,SAAU,IAAK,aAC3CD,EAAUh1C,MAAMi1C,YAAY,QAAS,QAAS,aAC9CD,EAAUh1C,MAAMi1C,YAAY,SAAU,QAAS,aAC/CD,EAAUh1C,MAAMi1C,YAAY,UAAW,OAAQ,aAC/CD,EAAUh1C,MAAMi1C,YAAY,kBAAmB,SAAU,aACzDD,EAAUh1C,MAAMi1C,YAAY,cAAe,SAAU,aACrDD,EAAUh1C,MAAMi1C,YAAY,UAAW,aAAc,aACrDj4B,WAAW,IAAMmqB,EAAQz+B,KAAK,kBAAkB6gB,QAAS,IAEzD,MAAM+kD,EAAc,KAClB,MAAM7gD,EAAM0Z,EAAQz+B,KAAK,kBAAkBjP,MAAMC,OACjD,GAAI+zB,EAAK,CAEPv0B,EADmB,UAAU06C,OAAanmB,KACR,UAClCl0B,EAAE,kBAAkBgwB,OACtB,CACA4d,EAAQnsB,UAIVmsB,EAAQz+B,KAAK,iBAAiBo9B,MAAMwoC,GAGpCnnC,EAAQz+B,KAAK,kBAAkB+c,GAAG,UAAW,SAAU8oD,GACtC,UAAXA,EAAGz6E,MACLy6E,EAAG7mD,iBACH4mD,IAEJ,GAGAnnC,EAAQz+B,KAAK,mBAAmBo9B,MAAM,IAAMqB,EAAQnsB,UACpDmsB,EAAQ1hB,GAAG,QAAS,SAAU8oD,GACxBh1E,EAAEg1E,EAAG73D,QAAQqP,SAAS,oBAAoBohB,EAAQnsB,QACxD,EACF,GAEFzhB,EAAE,QACCisB,IAAI,0BACJC,GAAG,yBAA0B,wBAAyB,SAAUtwB,GAC/DA,EAAEuwB,kBACFvwB,EAAEuyB,iBACF,MAAMksB,EAAUr6C,EAAEjG,MAAMa,KAAK,QAAU,GAEjCse,EAAU+F,IAAiBC,KAEjC,IAAIg2D,EAAkB,GAClBG,EAAe,GAInB,GAAIn8D,EACF,IAAK,IAAI3e,KAAO2e,EAAS,CACvB,IAAIlC,EAAQkC,EAAQ3e,GACpB,GAAKyc,GAAUA,EAAMhM,MAASgM,EAAM5P,QAApC,CAGA,GAAmB,SAAf4P,EAAMhM,MACJgM,EAAM5P,QAAQ,GAGhB,IAFA,IACIxF,GADUoV,EAAM5P,QAAQ,GAAG,IAAM,IACjBnC,MAAM,aACjB7K,EAAI,EAAGA,EAAIwH,EAAMtH,OAAQF,IAAK,CACrC,IAAIoH,EAAQI,EAAMxH,GAAGoH,MAAM,2CAC3B,GAAIA,EAAO,CACT0zE,EAAkBz6D,SAASjZ,EAAM,GAAI,IAErC,KACF,CACF,CAKJ,GAAmB,UAAfwV,EAAMhM,MAAoBqvC,EAC5B,IAAK,IAAIwH,EAAI,EAAGA,EAAI7qC,EAAM5P,QAAQ9M,OAAQunD,IAAK,CAC7C,IAAIrlD,EAAMwa,EAAM5P,QAAQy6C,GACxB,GAAIrlD,GAAOA,EAAI,KAAO69C,EAAS,CAG7B,IAFA,IACIi7B,GADa94E,EAAI,IAAM,IACDyI,MAAM,aACvBkgB,EAAI,EAAGA,EAAImwD,EAASh7E,OAAQ6qB,IAAK,CACxC,IAAIowD,EAAWD,EAASnwD,GAAG3jB,MAAM,2CACjC,GAAI+zE,EAAU,CACZF,EAAe56D,SAAS86D,EAAS,GAAI,IAErC,KACF,CACF,CACA,KACF,CACF,CAnCmD,CAqCvD,CAGF/iC,GAAiB,CACf/jB,cAAe,SACfgkB,eAAgByiC,EAChBviC,aAAc0H,EACdtH,cAAesiC,EACf/nC,SAAU,SAEd,GAEFttC,EAAE,QACCisB,IAAI,0BACJC,GAAG,yBAA0B,4BAA6B,SAAUtwB,GACnEA,EAAEuwB,kBAEF,MAAM2rB,EAAW93C,EAAEjG,MAAMa,KAAK,aACxB0D,EAAWmc,SAASza,EAAEjG,MAAMa,KAAK,aAAc,IAErD,IAAKk9C,GAAY9+B,MAAM1a,GAAW,OAElC,MAAM4a,EAAU+F,IAAiBC,KACjC,IAAKhG,IAAYA,EAAQ4+B,GAAW,OAEpC,MAAMgQ,EAAQ5uC,EAAQ4+B,GAChBv7C,EAAYurD,EAAM98C,MAAQ,KAC1BvO,EAAUqrD,EAAM1gD,QAAQ,IAAM,GAC9B9J,EAAUwqD,EAAM1gD,QAAQ9I,EAAW,GAEzC,IAAKhB,EAAS,OAEd,MAAM4O,EAASklB,KACTwR,EAAQtlC,EAAQ,IAAM,MAItByyE,EAAazxE,EAGnB,IAAImyE,EAAW,GACfnzE,EAAQ/B,QAAQ,CAACyc,EAAM43C,KACrB,GAAIA,GAAQ,GANQ,IAMHA,EAAwB,OAEzC,IADsBnzD,EAAQmzD,IAAS,IACrB5tD,SAAS,MAAO,OAElC,MAAMsgC,EAAa7lC,EAAQmzD,IAAS,KAAOA,EACrC7tB,EAAStiC,OAAOuY,GAAQ,IAAI7X,OAClC,IAAK4hC,EAAQ,OAGb,MAAM6uC,EAAar3E,EAAY+C,UAAUC,EAAWe,EAASb,GAEvDo0E,EADoBD,GAAcr3E,EAAYuE,cAAcvB,EAAWq0E,EAAYtuC,GAErF,2HACA,GAEJ,IAAI02B,EAAc,GACdiY,GAAY,EAEhB,MAAMG,EAActvC,GAAqBC,GAEzC,GAAIM,GAAmBN,EAAQO,GAAa,CAC1C,MAAMkzC,EAAYvzC,GAAwBF,GAC1C,GAAIyzC,EAAUl7E,OAAS,EAAG,CACxB22E,GAAY,EACZ,IAAIM,EAAU,GACdiE,EAAUj6E,QAAQ,CAACsjD,EAAKzkD,KACtB,MAAMq7E,EAAcr7E,EAAIo7E,EAAUl7E,OAAS,EAAI,kDAAoD,GACnGi3E,GAAW,gGAAgGkE,iGAChCl2E,EAAWs/C,EAAI7zC,QAAQ6lE,2CAClFhyB,EAAInzC,SAAW,8HAA8HnM,EAAWs/C,EAAInzC,mBAAqB,yCAGnMstD,EAAc,uCAAuCuY,SACvD,MAAO,GAAyB,IAArBiE,EAAUl7E,QAAgBk7E,EAAU,GAAG9pE,SAAU,CAC1D,MAAMmzC,EAAM22B,EAAU,GACtBxc,EAAc,0JAC0Cz5D,EAAWs/C,EAAI7zC,QAAQ6lE,kKAC0DtxE,EAAWs/C,EAAInzC,gDAE1J,CACF,MAAO,GAAI0lE,EAAY92E,OAAS,EAAG,CACjC22E,GAAY,EACZ,IAAIO,EAAY,GAChBJ,EAAY71E,QAAQ,CAACoyB,EAAMvzB,KACzB,MAAMq3E,GAAY1kE,EAAiBY,cAAcggB,EAAK3iB,MAChDyqE,EAAcr7E,EAAIg3E,EAAY92E,OAAS,EAAI,kDAAoD,GACrGk3E,GAAa,2FAA2FiE,4FAChCl2E,EAAWouB,EAAK3iB,QAAQ6lE,wLAEnBljD,EAAK1wB,+CAChEw0E,EAAW,uEAAuElyE,EAAWouB,EAAK3iB,2BAA2B2iB,EAAK1wB,oGAAsG,+CAG5P+7D,EAAc,yCAAyCwY,SACzD,MAAO,GAA2B,IAAvBJ,EAAY92E,OAAc,CACnC22E,GAAY,EACZ,MAAMtjD,EAAOyjD,EAAY,GACnBK,GAAY1kE,EAAiBY,cAAcggB,EAAK3iB,MACtDguD,EAAc,iKACwDz5D,EAAWouB,EAAK3iB,QAAQ6lE,gLAEnBljD,EAAK1wB,2CAChEw0E,EAAW,uEAAuElyE,EAAWouB,EAAK3iB,2BAA2B2iB,EAAK1wB,oGAAsG,wCAE1P,MAAO,IAAIspB,GAAcwb,IAAYA,EAAO//B,SAAS,MAAS+/B,EAAO//B,SAAS,KAOvE,CACL,MAAMgwC,EAAarL,GAAc5E,GACjCi3B,EAAchnB,EACV,0BAA0BA,MAAezyC,EAAWwiC,YACpDxiC,EAAWwiC,EACjB,KAZoF,CAClF,MAAMlpB,EAAS+oB,GAAoBG,GAC7B0vC,GAAY1kE,EAAiBY,cAAc20B,GACjD02B,EAAc,6GACIz5D,EAAWwiC,oCACjB0vC,EAAW,uEAAuElyE,EAAW+iC,wBAAiCzpB,gHAAuH,8BAEnQ,CAQA43D,GAAY,eADK,yBAA2BQ,EAAY,kBAAoB,kBAC1B1xE,EAAWu4C,mBAA0Bv4C,EAAWhD,iBAAyBwzE,gBAAyBngB,gBAAmBmV,mBAAmB/sD,GAAQ,sDAC9JzY,EAAW+iC,yDACX02B,gCAKtC,IAAIgZ,EAAc,GACdD,EAAetwC,GAAmBllC,GACtC,MAAM01E,EAAiBx1E,EAAQ0V,UAAU3U,GAAKA,GAAKiC,OAAOjC,GAAGwE,SAAS,OACtE,GAAIiwE,EAAiB,GAAK30E,EAAQ20E,GAAiB,CACjD,MAAME,EAAkB1yE,OAAOnC,EAAQ20E,IACpChtE,MAAM,WACNtK,IAAI6E,GAAKA,EAAEW,QACX4H,OAAOvI,GAAKA,GACX2yE,EAAgB73E,OAAS,IAC3By3E,EAAeI,EAAgBx3E,IAAImwC,IAAO,CACxC3N,MAAO2N,EACP5/B,KAAM,kBACNvE,KAAM,SACNy2B,SAAU,qBAAqB0N,KAC/BzN,WAAW,KAGjB,CACA,GAAI00C,EAAaz3E,OAAS,EAAG,CAO3B03E,EAAc,iCANKD,EAChBp3E,IACC,CAAC43E,EAAKC,IACJ,kCAA+C,UAAbD,EAAI5rE,KAAmB,aAAe,wBAAwB6rE,gBAAqBzC,yBAAkCwC,EAAIrnE,MAAQ,mBAAmB3L,EAAWgzE,EAAIp1C,mBAExMr7B,KAAK,WAEV,CAGA,MAAM4zE,EAAW,2DAC+BxpE,EAAOye,kCAAkCze,EAAOg5B,+BAA+Bh5B,EAAOi5B,4OAGtF4qC,EAAa,yFACSxwE,EAAWu4C,mBAA0Bv4C,EAAWhD,iBAAyBwzE,6BAAqDhL,mBAAmBniC,OAAWrjC,EAAWqjC,mUAG1L6tC,gCACrCuB,0DAKdhyE,EAAE,wBAAwByhB,SAC1BzhB,EAAE,QAAQqxB,OAAOqkD,GAGjB,MAAMj6B,EAAYz7C,EAAE,wBAAwB,GACxCy7C,IACFA,EAAUh1C,MAAMi1C,YAAY,WAAY,QAAS,aACjDD,EAAUh1C,MAAMi1C,YAAY,MAAO,IAAK,aACxCD,EAAUh1C,MAAMi1C,YAAY,OAAQ,IAAK,aACzCD,EAAUh1C,MAAMi1C,YAAY,QAAS,IAAK,aAC1CD,EAAUh1C,MAAMi1C,YAAY,SAAU,IAAK,aAC3CD,EAAUh1C,MAAMi1C,YAAY,QAAS,QAAS,aAC9CD,EAAUh1C,MAAMi1C,YAAY,SAAU,QAAS,aAC/CD,EAAUh1C,MAAMi1C,YAAY,UAAW,OAAQ,aAC/CD,EAAUh1C,MAAMi1C,YAAY,kBAAmB,SAAU,aACzDD,EAAUh1C,MAAMi1C,YAAY,cAAe,SAAU,aACrDD,EAAUh1C,MAAMi1C,YAAY,UAAW,aAAc,cAIvD17C,EAAE,wBAAwBksB,GAAG,QAAS,SAAU8oD,IAC1Ch1E,EAAEg1E,EAAG73D,QAAQqP,SAAS,wBAA0BxsB,EAAEg1E,EAAG73D,QAAQkP,QAAQ,sBAAsB/xB,SAC7F0F,EAAEjG,MAAM0nB,QAEZ,EACF,GAGF,WACE,MAAMyN,EAAOlvB,EAAEuG,UACf,IAAI4oB,EAAc,EACdC,EAAc,EAGlBF,EAAKhD,GAAG,yBAA0B,iBAAkB,SAAUtwB,GACrB,IAAnCA,EAAE0zB,cAAcC,QAAQj1B,SAC1B60B,EAAcvzB,EAAE0zB,cAAcC,QAAQ,GAAGC,QACzCJ,EAAcxzB,EAAE0zB,cAAcC,QAAQ,GAAGE,QAE7C,GAEAP,EAAKhD,GAAG,wBAAyB,iBAAkB,SAAUtwB,GAC3D,GAAuC,IAAnCA,EAAE0zB,cAAcC,QAAQj1B,OAAc,OAE1C,MAAMo1B,EAAQ9zB,EAAE0zB,cAAcC,QAAQ,GAChCI,EAASvqB,KAAKwqB,IAAIF,EAAMF,QAAUL,GAIpCQ,EAAkB,IAHPvqB,KAAKwqB,IAAIF,EAAMD,QAAUL,IAGXO,EAAS,KACpC/zB,EAAEuwB,kBACFzwB,QAAQC,IAAI,kCAEhB,EACD,CA1BD,IA8BF,MAyUM+3E,GAAe,CAAC93E,EAAGoc,KACvB,MAAM,GAAQlY,KACdE,EAAE,sCAAsCyhB,SACxC,MAAMk0D,EAAW31E,EAAE,yCACnBA,EAAE,QAAQqxB,OAAOskD,GAEjB,MAAMx6D,EAASV,SAASza,EAAEgY,GAAMpd,KAAK,OAAQ,IACvCiE,EAAS4b,SAASza,EAAEgY,GAAMpd,KAAK,OAAQ,IAC7C,GAAIoe,MAAMmC,IAAWnC,MAAMna,GAGzB,OAFAnD,QAAQG,KAAK,2BACb85E,EAASl0D,SAGX,MAAMq2B,EAAW93C,EAAEgY,GAAMpd,KAAK,OAExB2B,EAAYyD,EAAEgY,GAAMpd,KAAK,UAAYoF,EAAEgY,GAAMqU,QAAQ,kBAAkBld,KAAK,uBAAuB0Q,OACnGzY,EAAUqgE,mBAAmBznE,EAAEgY,GAAMpd,KAAK,QAC1CsR,EAASklB,KAGTwgD,EAAS,GAAG95B,KAAY38B,KAAUtc,IACnCgL,OAAOonD,iBAAgBpnD,OAAOonD,eAAiB,IAAI7jD,KAGxD,MAAMwoE,EAAa/rE,OAAOonD,eAAe1jD,IAAIqkE,GAKvC5B,GAFsBxpC,KACesR,IAAa,IACvB91C,SAASmZ,GAGpC1e,EAAUwiB,KAAgB64B,IAAW1wC,UAAU,IAAM,GACrD9J,EAAU2hB,KAAgB64B,IAAW1wC,UAAU+T,EAAS,IAAM,GAC9Dy1D,EAAar3E,EAAY+C,UAAUC,EAAWe,EAASb,GACvDo5E,EAAgBp5E,EAAQoC,IAAW,GAEnCf,EAAgB8yE,GAAcr3E,EAAYuE,cAAcvB,EAAWq0E,EAAYiF,GAC/EC,EAAkBlF,GAAcr3E,EAAYyF,WAAWzC,EAAWq0E,GAGxE,IAAImF,EAAe,GACfnF,IACFmF,EAAe,6EAIbA,GADEj4E,EAEA,+HAGA,2HAKFi4E,GADED,EAEA,2HAGA,wHAIN,MAAME,EAAOh2E,EAAE,qDAC+BkM,EAAOye,6fAKvCorD,sBACAH,EAAa,gJAAkJ,uBAC/J5F,EAAY,qHAAuH,mQAIjJhwE,EAAE,QAAQqxB,OAAO2kD,GAGjB,MAAMC,EAAWj2E,EAAE6J,QAAQuiC,QACrB8pC,EAAYl2E,EAAE6J,QAAQymB,SACtB6lD,EAASH,EAAKI,cAAgB,IAC9BC,EAAUL,EAAK1V,eAAiB,IACtC,IAAI9wC,EAAU5zB,EAAE4zB,QACZC,EAAU7zB,EAAE6zB,SACXD,GAAW5zB,EAAE0zB,eAAiB1zB,EAAE0zB,cAAcC,SAAW3zB,EAAE0zB,cAAcC,QAAQj1B,QACpFk1B,EAAU5zB,EAAE0zB,cAAcC,QAAQ,GAAGC,QACrCC,EAAU7zB,EAAE0zB,cAAcC,QAAQ,GAAGE,UAC3BD,GAAW5zB,EAAE06E,gBAAkB16E,EAAE06E,eAAeh8E,SAC1Dk1B,EAAU5zB,EAAE06E,eAAe,GAAG9mD,QAC9BC,EAAU7zB,EAAE06E,eAAe,GAAG7mD,cAIhBjxB,IAAZgxB,IAAuBA,EAAUymD,EAAW,QAChCz3E,IAAZixB,IAAuBA,EAAUymD,EAAY,GAEjD,IAAIjqC,EAAOzc,EAAU,EACjB4W,EAAM3W,EAAU,EAChBwc,EAAOkqC,EAASF,IAAUhqC,EAAOzc,EAAU2mD,EAAS,GACpD/vC,EAAMiwC,EAAUH,IAAW9vC,EAAM3W,EAAU4mD,EAAU,GAGrDpqC,EAAO,IAAGA,EAAO,GACjB7F,EAAM,IAAGA,EAAM,GAEnB4vC,EAAKzoD,IAAI,CAAE6Y,IAAKA,EAAM,KAAM6F,KAAMA,EAAO,OAEzC,MAAMsqC,EAAW,KACfP,EAAKv0D,SACLk0D,EAASl0D,UAEXk0D,EAASzpD,GAAG,QAASqqD,GACrBP,EAAK7mE,KAAK,cAAco9B,MAAMgqC,GAE9BP,EAAK7mE,KAAK,mBAAmBo9B,MAAM,KAC7BqkC,GAAciF,IAChBt8E,EAAYuD,UAAUP,EAAWq0E,EAAYiF,EAAezuE,GAC5D+lB,MAEFopD,MAIFP,EAAK7mE,KAAK,qBAAqBo9B,MAAM,KAC/BqkC,GAAciF,IAChBt8E,EAAYkE,YAAYlB,EAAWq0E,EAAYiF,GAC/C1oD,MAEFopD,MAIFP,EAAK7mE,KAAK,iBAAiBo9B,MAAM,KAC3BqkC,IACFr3E,EAAY8D,QAAQd,EAAWq0E,EAAYtzE,EAASb,GACpD0wB,MAEFopD,MAIFP,EAAK7mE,KAAK,mBAAmBo9B,MAAM,KAC7BqkC,IACFr3E,EAAYsE,UAAUtB,EAAWq0E,GACjCzjD,MAEFopD,MAIFP,EAAK7mE,KAAK,aAAao9B,MAAMtrB,MAAMrlB,IAKjC,GAJAA,EAAEuwB,kBAIEtiB,OAAO2zD,cAAgB3zD,OAAO2zD,aAAaC,aAC7C,IAEE,MAAMC,EAAct2D,EACjB1H,QAAQ,MAAO,QACfA,QAAQ,KAAM,OACdA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OAGlB,aAFMmK,OAAO2zD,aAAaC,aAAa,mBAAmBC,WAC1D6Y,GAEF,CAAE,MAAOlkD,GACP32B,QAAQG,KAAK,+BAAgCw2B,EAC/C,CAIF,MAeMmkD,EAAe32D,IACnB,IACE,MAAMg+C,EAAWt3D,SAAS8C,cAAc,YACxCw0D,EAAS5gE,MAAQ4iB,EAGjBg+C,EAASp3D,MAAM4zB,SAAW,QAC1BwjC,EAASp3D,MAAMwlC,KAAO,UACtB4xB,EAASp3D,MAAM2/B,IAAM,IACrBy3B,EAASC,aAAa,WAAY,IAElCv3D,SAASyD,KAAKC,YAAY4zD,GAE1BA,EAAStsC,SACTssC,EAASE,kBAAkB,EAAG,OAE9B,MAAMC,EAAaz3D,SAAS03D,YAAY,QAGxC,GAFA13D,SAASyD,KAAKojD,YAAYyQ,IAEtBG,EAEF,MAAM,IAAIz2D,MAAM,qBAEpB,CAAE,MAAO8qB,GACP32B,QAAQqK,MAAM,kBAAmBssB,GACjCqvC,OAAO,oBAAqB7hD,EAC9B,GAzCaA,QA4CRzY,EA1CD8+B,UAAUD,WAAap8B,OAAO8zD,gBAChCz3B,UAAUD,UACP23B,UAAU/9C,GACVoS,KAAK,QACLG,MAAM,KACLokD,EAAa32D,KAIjB22D,EAAa32D,GAkCjB02D,MAIFP,EAAK7mE,KAAK,aAAao9B,MAAM,KAC3B,MAAMhvC,EAAWymC,KACjB,IAAIvhC,EAAgB,KAKpB,GAJIlF,GAAYA,EAASu6C,IAAW1wC,QAAQ+T,EAAS,KACnD1Y,EAAgBlF,EAASu6C,GAAU1wC,QAAQ+T,EAAS,GAAGtc,IAGnC,OAAlB4D,EAAwB,CACrBwc,KAAeA,GAAgBC,MAChCD,IAAiBA,GAAc64B,IAAW1wC,QAAQ+T,EAAS,KAC7D8D,GAAc64B,GAAU1wC,QAAQ+T,EAAS,GAAGtc,GAAU4D,GAGxD,MAAMgxE,EAAQzzE,EAAEgY,GAChBy7D,EAAM9lD,KAAK,WAAYo3C,mBAAmBtiE,IAC1CgxE,EAAM74E,KAAK,MAAOmqE,mBAAmBtiE,IAGrC,IAAIg0E,EAAiBhD,EACjBA,EAAMtkE,KAAK,mBAAmB7U,OAAS,EACzCm8E,EAAiBhD,EAAMtkE,KAAK,mBACnBskE,EAAMjnD,SAAS,iBACxBiqD,EAAiBhD,EAAMtkE,KAAK,mBACnBskE,EAAMjnD,SAAS,mBACxBiqD,EAAiBhD,EAAMtkE,KAAK,oBAG9B,MAAM6iC,EAAarL,GAAclkC,GAC7BuvC,IAAeyhC,EAAMjnD,SAAS,sBAChCiqD,EAAetlD,KAAK,0BAA0B6gB,MAAevvC,YAE7Dg0E,EAAe52D,KAAKpd,GAItBg0E,EAAe/pD,YAAY,2CACvB+mD,EAAMjnD,SAAS,uBAAuBinD,EAAM/mD,YAAY,2CAE5D7iB,OAAOonD,eAAelzC,OAAO6zD,GAEM,IAA/B/nE,OAAOonD,eAAe75C,OACxBgsB,IAAoB,EACpBiD,KAEJ,MACMx8B,OAAOujB,QAAQvjB,OAAOujB,OAAO+E,QAAQ,iBAE3CokD,MAIFP,EAAK7mE,KAAK,eAAeo9B,MAAMtrB,UAC7Bs1D,IAEA,IAAIG,EAASzpE,GAAMtK,IAAIM,GAClByzE,GAAW53E,MAAMqO,QAAQupE,KAC5BA,EAAS,CAAC,sBAAuB,mBAAoB,kBAAmB,qBAG1E,IAFuBA,EAAO10E,SAAS,uBAEpB,CAEjB,MAAMoqB,EAAQpsB,EAAEgY,GAAMqU,QAAQ,kBAC9BD,EAAMmB,IAAI,aAAc,iBAAiBA,IAAI,UAAW,KAAKA,IAAI,YAAa,cAC9E9J,WAAW,IAAM2I,EAAMS,QAAQ,IAAK,IAAMT,EAAM3K,UAAW,KAGtDxC,KAAeA,GAAgBC,MAAkB8kB,MAClD/kB,IAAiBA,GAAc64B,IAAW1wC,UAC5C6X,GAAc64B,GAAU1wC,QAAQgL,OAAO+I,EAAS,EAAG,GAGnDmsB,GAAaroB,UACP+vC,GAAmB/vC,IAAe,GAAM,GAElD,KAAO,CAEL,MAAM03D,EAAOnwC,KACRmwC,EAAK7+B,KAAW6+B,EAAK7+B,GAAY,IACjC6+B,EAAK7+B,GAAU91C,SAASmZ,KAC3Bw7D,EAAK7+B,GAAUr9C,KAAK0gB,GACpB4rB,GAAqB4vC,IAIvB32E,EAAEgY,GAAMqU,QAAQ,kBAAkBM,SAAS,oBAG3C0Z,IACF,IAIF2vC,EAAK7mE,KAAK,gBAAgBo9B,MAAM,KAC9B,MAAMoqC,EAAOnwC,KACTmwC,EAAK7+B,KACP6+B,EAAK7+B,GAAY6+B,EAAK7+B,GAAU/vC,OAAO3N,GAAKA,IAAM+gB,GACpB,IAA1Bw7D,EAAK7+B,GAAUx9C,eAAqBq8E,EAAK7+B,GAC7C/Q,GAAqB4vC,IAGvB32E,EAAEgY,GAAMqU,QAAQ,kBAAkBK,YAAY,oBAC9C2Z,KACAkwC,MAIFP,EAAK7mE,KAAK,eAAeo9B,MAAMtrB,UAM7B,GALAs1D,IAEKt3D,KAAeA,GAAgBC,MAC/BD,KAAeA,GAAgB+kB,MAEhC/kB,IAAiBA,GAAc64B,IAAW1wC,QAAS,CACrD,MAAM4P,EAAQiI,GAAc64B,GAEtB8+B,EAAW5/D,EAAM5P,QAAQ,GAAK4P,EAAM5P,QAAQ,GAAG9M,OAAS,EACxDmE,EAAS,IAAIK,MAAM83E,GAAU73E,KAAK,IAEpC63E,EAAW,IAAGn4E,EAAO,GAAKgB,OAAOuX,EAAM5P,QAAQ9M,SAGnD0c,EAAM5P,QAAQgL,OAAO+I,EAAS,EAAG,EAAG1c,SAI9BuwD,GAAmB/vC,IAAe,GAAO,GAG/CkO,KAGA1J,WAAW,KACT,MAAMuI,EAAShsB,EAAE,sBAEbgsB,EAAO1xB,QAAU0xB,EAAO,GAAG2iC,aAAe3iC,EAAOsE,UACnDtE,EAAOi4C,UAAUj4C,EAAOi4C,YAAc,KAEvC,IACL,IAIF+R,EAAK7mE,KAAK,kBAAkBo9B,MAAM,KAChCgqC,IACA,MAAMr9D,EAAU+F,IAAiBC,KACjC,GAAIhG,GAAWA,EAAQ4+B,GAAW,CAChC,MAAMr7C,EAAUyc,EAAQ4+B,GAAU1wC,QAAQ,GACpC5K,EAAM0c,EAAQ4+B,GAAU1wC,QAAQ+T,EAAS,GAC3C3e,GACF4xD,GAAkB5xD,EAAKC,EAASF,EAAW4e,EAAQ28B,EAEvD,IAGFk+B,EAAK7mE,KAAK,aAAao9B,MAAM,KAC3BgqC,IACAtoD,GAAe7mB,EAAS6Z,MAAMiF,IAI5B,GAFKjH,KAAeA,GAAgBC,MAAkB8kB,OAElD/kB,KAAiBA,GAAc64B,IAAW1wC,QAAQ+T,EAAS,GAI7D,YADApR,MAAM,uBAFNkV,GAAc64B,GAAU1wC,QAAQ+T,EAAS,GAAGtc,GAAUqnB,EAOxD,MAAMutD,EAAQzzE,EAAEgY,GAChBy7D,EAAM9lD,KAAK,WAAYo3C,mBAAmB7+C,IAAStrB,KAAK,MAAOmqE,mBAAmB7+C,IAElF,IAAIuwD,EAAiBhD,EACjBA,EAAMtkE,KAAK,mBAAmB7U,OAAQm8E,EAAiBhD,EAAMtkE,KAAK,mBAC7DskE,EAAMjnD,SAAS,iBAAkBiqD,EAAiBhD,EAAMtkE,KAAK,mBAC7DskE,EAAMjnD,SAAS,wBAAuBiqD,EAAiBhD,GAGhE,MAAMzhC,EAAarL,GAAczgB,GAC7B8rB,IAAeyhC,EAAMjnD,SAAS,sBAChCiqD,EAAetlD,KAAK,0BAA0B6gB,MAAezyC,EAAW2mB,aAExEuwD,EAAe52D,KAAKqG,GAItB,IAAIwwD,EAASzpE,GAAMtK,IAAIM,GAClByzE,GAAW53E,MAAMqO,QAAQupE,KAC5BA,EAAS,CAAC,sBAAuB,mBAAoB,kBAAmB,sBACnDA,EAAO10E,SAAS,wBAKrCy0E,EAAe/pD,YAAY,2CACvB+mD,EAAMjnD,SAAS,uBAAuBinD,EAAM/mD,YAAY,2CAG5D4a,GAAaroB,UACP+vC,GAAmB/vC,IAAe,GAAM,KAI9Cw3D,EAAe/pD,YAAY,sBAAsBC,SAAS,wBACtD8mD,EAAMjnD,SAAS,uBACjBinD,EAAM/mD,YAAY,sBAAsBC,SAAS,wBAG9C9iB,OAAOonD,iBAAgBpnD,OAAOonD,eAAiB,IAAI7jD,KACxDvD,OAAOonD,eAAe3gD,IAAIshE,GAC1BxuC,IAAoB,EACpBiD,WAMFpY,GAAiB,CAAC7mB,EAAS8pB,KAC/B,MAAM,GAAQpxB,KACRoM,EAASklB,KAETm9B,EAASvuD,EAAE,iGAE0BkM,EAAOye,uEACEze,EAAOye,sJAEcprB,EAAW6H,gZAQpFpH,EAAE,QAAQqxB,OAAOk9B,GAMjBA,EAAOp/C,KAAK,YAAY+c,GAAG,QAAS,WAJfuiC,SAKN10D,MAJV0M,MAAM6pB,OAAS,OAClBm+B,EAAGhoD,MAAM6pB,OAASm+B,EAAGE,aAAe,EAAI,IAI1C,GAEAJ,EAAOp/C,KAAK,eAAeo9B,MAAM,IAAMgiB,EAAO9sC,UAE9C8sC,EAAOriC,GAAG,QAAS,SAAUtwB,GACvBoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,qBAAqB+hC,EAAO9sC,QACvD,GAEA8sC,EAAOp/C,KAAK,aAAao9B,MAAM,KAC7Brb,EAAOq9B,EAAOp/C,KAAK,YAAYjP,OAC/BquD,EAAO9sC,YAyELo1D,GAAqB,KACzB,MAAM,GAAQ/2E,KACd,IAAKE,EAAG,OAGRA,EAAE,iCAAiCyhB,SA4HnCzhB,EAAE,QAAQqxB,OA1HS,y/GA6HnBrxB,EAAE,wBAAwBksB,GAAG,QAAS,WACpClsB,EAAE,iCAAiCwhE,QAAQ,IAAK,WAC9CxhE,EAAEjG,MAAM0nB,QACV,EACF,GAGAzhB,EAAE,iCAAiCksB,GAAG,QAAS,SAAUtwB,GACnDoE,EAAEpE,EAAEuhB,QAAQqP,SAAS,iCACvBxsB,EAAEjG,MAAMynE,QAAQ,IAAK,WACnBxhE,EAAEjG,MAAM0nB,QACV,EAEJ,GAGI5X,OAAOujB,QACTvjB,OAAOujB,OAAOrnB,MAAM,wBAAyB,OAAQ,CACnDq+B,QAAS,EACT0yC,gBAAiB,EACjBC,aAAa,EACbC,mBAAmB,KAKnBv6D,GAAO,KACX,GAAIomB,GAAe,OAEnBnnC,QAAQC,IAAI,sBAGZ,IACE+J,EAAsBQ,UACtBxK,QAAQoK,KAAK,oCACf,CAAE,MAAOlK,GACPF,QAAQqK,MAAM,uCAAwCnK,EACxD,CAGA,IACEqM,EAAaiC,kBACbxO,QAAQoK,KAAK,iBACf,CAAE,MAAOlK,GACPF,QAAQqK,MAAM,sBAAuBnK,EACvC,CAGA,GArP+B,MAC/B,MAAM,GAAQkE,KACd,IAAKE,EAAG,OAAO,EAIf,MAAM8iD,EAAW9iD,EAAE,gBACnB,GAAI8iD,EAASxoD,OAAS,EAAG,CAIvB,MAAM28E,EAAmBn0B,EAAS3zC,KAAK,sBAAsB7U,OAAS,EAChE48E,EAA2Bp0B,EAAS3zC,KAAK,qBAAqB7U,OAAS,EAQ7E,GAJkBwoD,EAASn1B,KAAK,MACXm1B,EAASn1B,KAAK,SAG/BspD,GAAoBC,KAEEp0B,EAAS3zC,KAAK,iCAAiC7U,OAAS,GAE9E,OAAO,CAGb,CAGA,IACE,MAAM68E,EAAU5wE,SAAS6wE,iBAAiB,UAC1C,IAAK,MAAMC,KAAUF,EAAS,CAC5B,MAAM/vE,EAAUiwE,EAAOtuD,aAAesuD,EAAO/tE,WAAa,GAE1D,GAAIlC,EAAQpF,SAAS,qCAAuCoF,EAAQpF,SAAS,qBAC3E,OAAO,CAEX,CACF,CAAE,MAAOpG,GAET,CAIA,IACE,MAAM07E,EAAmBj9E,aAAaU,QAAQ,qBACxCw8E,EAAal9E,aAAaU,QAAQ,qBAGxC,GAAIu8E,IAAqBC,KAEFv3E,EAAE,iCAAiC1F,OAAS,GAE/D,OAAO,CAGb,CAAE,MAAOsB,GAET,CAEA,OAAO,GAwLH47E,GAGF,OAFAX,UACAn7E,QAAQqK,MAAM,kCAehB,GAXArK,QAAQoK,KAAK,4BACbgd,GAAU8F,eAGNsa,KACFA,GAASu0C,aACTv0C,GAAW,KACXxnC,QAAQoK,KAAK,gCAEfuqD,KAEIxmD,OAAOyV,aAAezV,OAAOyV,YAAYo4D,YAAa,CACxDh8E,QAAQoK,KAAK,iCACb,MAAM6xE,EAAS9tE,OAAOyV,YAAYs4D,WAC5BpvE,EAASqB,OAAOyV,YAAYo4D,YAC5BG,EAAW,CAACF,EAAOG,aAAcH,EAAOI,eAAgBJ,EAAOK,gBAAiBL,EAAOM,iBAGxF90C,KACHA,GAAsB,KACfJ,GAIHrnC,QAAQoK,KAAK,wBAHbpK,QAAQoK,KAAK,yBACb2d,WAAW0J,GAAiB,QAQ7BtjB,OAAOquE,6BACVruE,OAAOquE,2BAA6B,KAClCx8E,QAAQoK,KAAK,4BACbmZ,GAAgB,KAChBqkB,GAAkB,CAAC,EACnBC,GAAoB,CAAC,EACrBI,GAAoB,CAAC,EACrBP,IAAoB,EACpBH,GAAep7B,QACXgC,OAAOonD,gBAAgBpnD,OAAOonD,eAAeppD,QACjD4b,WAAW0J,GAAiB,OAGhC,MAAMgrD,EAA0BtuE,OAAOquE,2BAEvCL,EAASt8E,QAAQiyD,IACXA,IACFhlD,EAAO4vE,eAAe5qB,EAAKrqB,IAC3B36B,EAAO4vE,eAAe5qB,EAAK2qB,GACvB3qB,IAAQmqB,EAAOG,aACjBtvE,EAAO0jB,GAAGshC,EAAK2qB,GAEf3vE,EAAO0jB,GAAGshC,EAAKrqB,OAIrBznC,QAAQoK,KAAK,aAAa+xE,EAASv9E,gBACrC,MACEoB,QAAQG,KAAK,sCAIf,MAAMw8E,EAAO,KACX,MAAMp0C,EAAMnkC,KAAUokC,QACtB,GAAID,GAAKssB,kBAAmB,CAC1B1tB,IAAgB,EAChBnnC,QAAQC,IAAI,mBACZD,QAAQoK,KAAK,qBAGb,MAAMu8D,EAAQriE,EAAE,SAChB,GAAIqiE,EAAM/nE,SAAW4oC,GAAU,CAC7BxnC,QAAQoK,KAAK,iCACb,IAAIw8D,GAAe,EAiDnBp/B,GAAW,IAAIq/B,iBAhDQ,KACjBD,IACJA,GAAe,EACfzT,sBAAsB,KAEpB,GAA4B,aADbz9B,KACJoU,aAET,YADA88B,GAAe,GAIjB,MACME,EADWH,EAAMI,WACIC,OAAO,GAC5BC,EAAU3iE,EAAE,gBAAgB,GAE9B2iE,GAAWH,GAAaA,IAAcG,IACpC3iE,EAAEwiE,GAAWh2C,SAAS,QAAUxsB,EAAEwiE,GAAWh2C,SAAS,kBACxD61C,EAAMhxC,OAAOsxC,GAKjB,MAAMniE,EAAUC,KAChB,GAAID,GAAWA,EAAQuyB,qBAAsB,CAE3C,MACMyvC,EADWH,EAAMI,WACIC,QACvBF,EAAUh2C,SAAS,QAAUg2C,EAAUh2C,SAAS,kBAClDg2C,EAAU71C,SAAS,6BAIrBkiC,sBAAsB,KACpBx7B,KAGAw7B,sBAAsB,KACpB2T,EAAU91C,YAAY,6BAA6BC,SAAS,4BAE5DlJ,WAAW,KACT++C,EAAU91C,YAAY,6BACrB,QAGT,CAEA41C,GAAe,OAInBp/B,GAAS0/B,QAAQP,EAAM,GAAI,CAAEQ,WAAW,GAC1C,MAAYR,EAAM/nE,QAChBoB,QAAQG,KAAK,iDAIfH,QAAQoK,KAAK,qBACbqnB,KAEA1J,WAAW,KACT4P,MACC,KAEC4Q,EAAIq0C,6BACNr0C,EAAIq0C,4BAA4B10C,GAAiBG,cACjDroC,QAAQoK,KAAK,mBAGTm+B,EAAIs0C,iCACNt0C,EAAIs0C,+BAA+B,KACjC,MAAMv2D,EAAUiiB,EAAIssB,oBAChBvuC,GAASslB,GAAatlB,KAE5BtmB,QAAQoK,KAAK,uBAGfpK,QAAQG,KAAK,wBAEjB,MAEOgnC,KACHh5B,OAAO2uE,iBAAmB3uE,OAAO2uE,iBAAmB,GAAK,EACrD3uE,OAAO2uE,gBAAkB,IACvB3uE,OAAO2uE,gBAAkB,IAAO,GAClC98E,QAAQoK,KAAK,0BAA0B+D,OAAO2uE,uBAEhD/0D,WAAW40D,EAAM,MAEjB38E,QAAQqK,MAAM,6CAKtBsyE,IA8YA50D,WA3YgC,KAC9B,MAAM,GAAQ3jB,KACR24E,EAAkB,KACtBh1C,IAAqB,EACrBzjC,EAAE,sDAAsDwhE,QAAQ,IAAK,WACnExhE,EAAEjG,MAAM0nB,QACV,IAGIi3D,EAAqB,IAAIxoE,IAE/B,IAAIyoE,EAAqB,EAEzB,MAAMC,EAAsBC,IAC1B,MAAMpxE,EAA0B,iBAAdoxE,EAAyB3zE,OAAO2zE,GAAaA,EAC/D,OAAO3zE,OAAOirC,SAAS1oC,GAAMA,EAAK,MAG9BqxE,EAAuBj5D,IAC3B,IAAKA,EAAM,OAAO,EAIlB,MAFE,+GAEkBxe,KAAKwe,IADL,iEAC0Bxe,KAAKwe,IAG/Ck5D,EAA+B,CAACl5D,EAAc0wB,KAClD,IAAK1wB,IAAS0wB,EAAY,MAAO,GACjC,MAAMyoC,EAAa,mCACbC,EAAap5D,EAAKre,MAAMw3E,GAC9B,IAAKC,EAAY,MAAO,GACxB,MAAMjS,EAAQiS,EAAW,GACzB,GAAIjS,EAAMhlE,SAASuuC,GAAa,MAAO,GACvC,MAAMr2C,EAAS8sE,EAAMxsE,WAAW,MAAQ,KAAO,GACzC0+E,EAASlS,EAAMluD,SAAS,MAAQ,KAAO,GACvCqgE,EAAenS,EAAM7mE,OACrBi5E,EAAWD,EAAe,GAAGA,KAAgB5oC,IAAeA,EAElE,OADwB1wB,EAAK7d,SAASuuC,GAAc1wB,EAAKngB,QAAQ6wC,EAAY,IAAIpwC,OAAS0f,GACnEngB,QAAQs5E,EAAY,GAAGC,EAAW,KAAK/+E,IAASk/E,IAAWF,IAASD,EAAW,OAGlGI,EAAyB,CAAC1yE,EAAc2yE,EAAiBC,KAC7D,GAAIA,EAAQ,OACZ,MAAMC,EAAaF,GAA4B,iBAAXA,EAAuBA,EAAqC,CAAC,EAC3FG,EAAiD,iBAA5BD,EAAWE,aAA4BF,EAAWE,aAAe,GACtFC,GAAoD,IAAjCH,EAAWI,kBAEpC,IADyD,IAAlCJ,EAAWK,oBACZF,EAAkB,OACxC,GAAa,UAAThzE,GAAoB8yE,EAAYt5E,OAAO7F,OAAS,EAAG,OAEvD,MAAM6B,EAAMD,KAAKC,MACjB,GAAIA,EAAMw8E,EAAqB,IAAK,OAEpC,MAAMmB,EAA8C,iBAAtBN,EAAW9X,OAAsB8X,EAAW9X,OAAS,GACnF,IAAKoY,IAAmBA,EAAe35E,OAAQ,OAC/C,GAAI24E,EAAoBgB,GAAiB,OACzC,IAAKlkD,KAA0B,OAE/B,MAAMmkD,EAAkBjiD,KACxB,IAAKiiD,EAAiB,OAEtB,IAAIC,EAAc,GAClB,GAAIF,EAAe93E,SAAS,YAAa,CACvC,MAAMi4E,EAAWlB,EAA6Be,EAAgBC,GAC9DC,EACEC,GAAYA,IAAaH,EAAiBG,EAAW,GAAGH,EAAe35E,UAAU45E,IAAkB55E,MACvG,MACE65E,EAAc,GAAGF,EAAe35E,UAAU45E,IAAkB55E,OAG9Dq5E,EAAW9X,OAASsY,EACpBR,EAAWK,oBAAqB,EAChClB,EAAqBx8E,GAGjB+9E,EAA6B,KACjC,MAAM/9E,EAAMD,KAAKC,MACjB,GAAIA,EAAMw8E,EAAqB,IAAK,OAEpC,MAAM,GAAQ74E,KACRC,EAAMC,EAAE,kBACRoH,GAAWrH,EAAIG,OAAS,IAAI8Q,WAAW7Q,OAC7C,IAAKiH,EAAS,OACd,GAAI0xE,EAAoB1xE,GAAU,OAClC,IAAKwuB,KAA0B,OAE/B,MAAMmkD,EAAkBjiD,KACxB,IAAKiiD,EAAiB,OAEtBp6E,EAAsBo6E,EAAiB,QACvC,MAAMI,GAAgBp6E,EAAIG,OAAS,IAAI8Q,WACvC,GAAImpE,EAAc,CAChB,MAAMr5E,EAAWf,EAAI,GACrBe,EAAS7D,MAAQk9E,EACjBr5E,EAASs5E,cAAc,IAAIjS,MAAM,QAAS,CAAEE,SAAS,KACrDvnE,EAASs5E,cAAc,IAAIjS,MAAM,SAAU,CAAEE,SAAS,IACxD,CACAsQ,EAAqBx8E,GAGjBk+E,EAAoBxB,IACxB,MAAMpxE,EAAKmxE,EAAmBC,GAC9B,GAAW,OAAPpxE,EAAa,OACjB,IAAKmuB,KAA0B,OAE/B,MAAMmkD,EAAkBjiD,KACnBiiD,IAELrB,EAAmB51E,IAAI2E,EAAI,CAAE4M,OAAQ0lE,EAAiBvqE,UAAWtT,KAAKC,QACjEm+E,EAAiB7yE,KAGlB6yE,EAAmBr5D,MAAO43D,IAC9B,MAAMpxE,EAAKmxE,EAAmBC,GAC9B,GAAW,OAAPpxE,EAAa,OAEjB,MAAM8yE,EAAU7B,EAAmB/1E,IAAI8E,GACvC,IAAK8yE,EAAS,OAEd,GAAIr+E,KAAKC,MAAQo+E,EAAQ/qE,UA7GC,KA+GxB,YADAkpE,EAAmB36D,OAAOtW,GAI5B,MAAM+yE,EAASr0C,GAAIs0C,MAAQ5wE,OAAOwV,QAAQC,aAAam7D,KACjDC,EAAQF,GAAwB,iBAAP/yE,EAAkB+yE,EAAO/yE,GAAM,KACxDysB,EAAMH,gBAAgBtsB,GAAI,GAChC,KAAKysB,GAAoB,SAAbA,EAAIF,MACT0mD,GAAUA,EAAMC,SAEnB,YADAjC,EAAmB36D,OAAOtW,GAK9B,MAAMnG,EAAe7B,OAAOi7E,GAAOE,KAAO1mD,GAAK9pB,SAAW,IAC1D,GAAI0uE,EAAoBx3E,GAEtB,YADAo3E,EAAmB36D,OAAOtW,GAI5B,MAAMozE,EAAQ3mD,GAAK2mD,OAASH,GAAOG,OAAS,CAAC,EAC7C,GAAKA,EAA4CC,oBAE/C,YADApC,EAAmB36D,OAAOtW,GAI5B,IAAIszE,EAAa,GACjB,GAAIz5E,EAAaU,SAAS,YAAa,CACrC,MAAMi4E,EAAWlB,EAA6Bz3E,EAAci5E,EAAQlmE,QACpE0mE,EAAad,GAAYA,IAAa34E,EAAe24E,EAAW,GAAG34E,KAAgBi5E,EAAQlmE,SAASlU,MACtG,MACE46E,EAAaz5E,EAAe,GAAGA,KAAgBi5E,EAAQlmE,SAAWkmE,EAAQlmE,OAE5EqkE,EAAmB36D,OAAOtW,GAEtBizE,GAASA,EAAMC,UACjBD,EAAME,IAAMG,GAGd,UACQC,gBACJ,CAAC,CAAE12D,WAAY7c,EAAI2C,QAAS2wE,EAAYF,MAAO,IAAKA,EAAOC,qBAAqB,KAChF,CAAEhuD,QAAS,YAEf,CAAE,MAAOlxB,GACPF,QAAQG,KAAK,uBAAwBD,EACvC,CAEA,MAAM,GAAQkE,KACRC,EAAMC,EAAE,kBACd,GAAID,EAAIzF,OAAQ,EACMyF,EAAIG,OAAS,IAAI8Q,aAClB+pE,GACjBh7E,EAAIG,IAAI,IAAIW,QAAQ,SAASA,QAAQ,SAEzC,GAIIo6E,EAA0B,KAE9B94E,IAGA,MAAM+4E,EAAa30E,SAASC,eAAe,YAC3C,GAAI00E,EAAY,CACd,MAAMC,EAAgB,KAEpBjB,IAEAn4E,KAEFm5E,EAAW7wE,iBAAiB,QAAS8wE,GAAe,GACpDD,EAAW7wE,iBAAiB,YAAa8wE,GAAe,GACxDD,EAAW7wE,iBAAiB,WAAY8wE,GAAe,EACzD,CAGAn7E,EAAEuG,UACC0lB,IAAI,yBAA0B,aAC9BC,GAAG,yBAA0B,YAAa,SAAUtwB,GAEnDs+E,IAEAn4E,GACF,GAGF,MAAMjB,EAAWyF,SAASC,eAAe,iBACrC1F,IACFA,EAASuJ,iBACP,UACA,SAAUzO,GAEM,UAAVA,EAAErB,KAA6B,gBAAVqB,EAAErB,MAEzB2/E,IAEAn4E,IAEJ,GACA,GAEFjB,EAASuJ,iBACP,QACA,SAAUzO,GACM,UAAVA,EAAErB,KAA6B,gBAAVqB,EAAErB,MACzB2/E,IACAn4E,IAEJ,GACA,IAIJ/B,EAAE,kBACCisB,IAAI,4BACJC,GAAG,2BAA4B,SAAUtwB,GAE1B,UAAVA,EAAErB,KAA6B,gBAAVqB,EAAErB,MAEzB2/E,IAEAn4E,IAEJ,GACCkqB,IAAI,0BACJC,GAAG,yBAA0B,SAAUtwB,GACxB,UAAVA,EAAErB,KAA6B,gBAAVqB,EAAErB,MACzB2/E,IACAn4E,IAEJ,GAGe,IAAIwgE,iBAAiB,KACpC,MAAMxiE,EAAMC,EAAE,kBACVD,EAAIzF,SAAWyF,EAAI,GAAGqC,sBACxBD,MAGKygE,QAAQr8D,SAASyD,KAAM,CAAE64D,WAAW,EAAMuY,SAAS,KAGxDC,EAA2B,KAC/B,MAAMC,EAAazxE,OAIfyxE,EAAWC,iCACVD,EAAW9d,cAA4D,mBAArC8d,EAAW9d,aAAage,WAE/DF,EAAWG,2BAA6BH,EAAW9d,aAAage,SAChEF,EAAW9d,aAAage,SAAWv6D,kBAAmBpa,GACpD,MAAMyjC,EACJzjC,EAAKvM,OAAS,GAAKuM,EAAK,IAAyB,iBAAZA,EAAK,GAAmBA,EAAK,GAAiC,KAErG,GAAIyjC,EAAS,CACX,MAAMmvC,EAA8C,iBAAzBnvC,EAAQovC,aAA4BpvC,EAAQovC,aAAe,GAChFC,GAAiD,IAA9BrvC,EAAQsvC,kBAEjC,MADsD,IAA/BtvC,EAAQuvC,sBACPF,GAAkD,IAA9BF,EAAYt5E,OAAO7F,OAAc,CAC3E,IAAIw/E,EAAiB,GACrB,MAAM4B,EAAUpxC,EAAQoxC,QACxB,GAAI58E,MAAMqO,QAAQuuE,IAAYA,EAAQphF,OAAS,EAAG,CAChD,MAAMslB,EAAQ87D,EAAQ,GACtB,GAAI97D,GAA0B,iBAAVA,EAAoB,CACtC,MAAMxY,EAAWwY,EAAkCxY,QAC5B,iBAAZA,IAAsB0yE,EAAiB1yE,EACpD,CACF,CAQA,GAPK0yE,GAA4C,iBAAnBxvC,EAAQo3B,SACpCoY,EAAiBxvC,EAAQo3B,QAEtBoY,GAAgD,iBAAvBxvC,EAAQqxC,aACpC7B,EAAiBxvC,EAAQqxC,YAGvB7B,IAAmBhB,EAAoBgB,IAAmBlkD,KAA0B,CACtF,MAAMmkD,EAAkBjiD,KACxB,GAAIiiD,EAAiB,CACnB,MAAM6B,EAAe,GAAG9B,EAAe35E,UAAU45E,IAAkB55E,OACnE,GAAIrB,MAAMqO,QAAQuuE,IAAYA,EAAQphF,OAAS,EAAG,CAChD,MAAMslB,EAAQ87D,EAAQ,GAClB97D,GAA0B,iBAAVA,IACjBA,EAAkCxY,QAAUw0E,EAEjD,KAAqC,iBAAnBtxC,EAAQo3B,OACxBp3B,EAAQo3B,OAASka,EAEjBtxC,EAAQqxC,WAAaC,EAEvBtxC,EAAQuvC,oBAAqB,EAC7BlB,EAAqBz8E,KAAKC,MAC1BT,QAAQoK,KAAK,uBACf,CACF,CACF,CACF,CAEA,OAAQw1E,EAAWG,2BAA+D30E,MAAM/M,KAAM8M,EAChG,EACAy0E,EAAWC,iCAAkC,IAIzCp1C,EAAKt8B,OAAOyV,aAAezV,OAAOwV,QAAQC,YAE1Cu8D,EACJ11C,GAAIyxC,YAAYkE,eAAiBjyE,OAAOkyE,cAAgBlyE,OAAOkyE,cAAcD,aAAe,gBAG9F,GAAI31C,GAAIuxC,YAAa,CACnBvxC,EAAGuxC,YAAYxrD,GAAG2vD,EAASpD,GAE3BtyC,EAAGuxC,YAAYxrD,GAAG2vD,EAAShD,IAEzBwB,EAAiBxB,GAGjB,MAAMr4E,EAAUC,KACZD,GAAWA,EAAQuyB,sBACrBtP,WAAW,KACT4P,MACC,OAKP,MAAM2oD,EACJ71C,GAAIyxC,YAAYqE,4BACfpyE,OAAOkyE,cAAgBlyE,OAAOkyE,cAAcE,0BAA4B,6BAS3E,OARID,GACF71C,EAAGuxC,YAAYxrD,GAAG8vD,EAAsB,CAACr1E,EAAM2yE,EAAQC,KACrDF,EAAuB1yE,EAAM2yE,EAAQC,KAIzC8B,SACAJ,GAEF,CAGA,GAA8B,mBAAnBpxE,OAAOuZ,QAAwB,CACxCvZ,OAAOuZ,QAAQy4D,EAASpD,GAExB5uE,OAAOuZ,QAAQy4D,EAAShD,IAEtBwB,EAAiBxB,GAGjB,MAAMr4E,EAAUC,KACZD,GAAWA,EAAQuyB,sBACrBtP,WAAW,KACT4P,MACC,OAKP,MAAM2oD,EAAuBnyE,OAAOkyE,cAChClyE,OAAOkyE,cAAcE,0BACrB,4BAOJ,OANApyE,OAAOuZ,QAAQ44D,EAAsB,CAACr1E,EAAM2yE,EAAQC,KAClDF,EAAuB1yE,EAAM2yE,EAAQC,KAGvC8B,SACAJ,GAEF,GAIkC,KAGpCx3D,WAAW,KACTthB,KACC,KAGH,MAAMihB,EAAUvZ,OAAOuZ,SAAWvZ,OAAOwV,QAAQ+D,QAC1B,mBAAZA,EACTA,EAAQ,gBAAiBQ,IAEE,iBAAdd,IAA0D,mBAAzBA,GAAU/T,YACpD+T,GAAU/T,aAKC,QADA+T,GAAUG,cACDiK,OAAwBpK,GAAUC,YACtDrnB,QAAQC,IAAI,yBACZwxB,QAIJzxB,QAAQG,KAAK,iCAIfmE,EAAE6J,QACCoiB,IAAI,iCACJC,GAAG,gCAAiC,KACnC,IACE7xB,aAAa+B,QAAQsnC,GAAoB7oC,KAAKwB,UAAUsnC,KACpDT,KACFA,GAASu0C,aACTv0C,GAAW,KAEf,CAAE,MAAOtnC,GAAI,KAQnBiO,OAAOqyE,mBAAqB,WAE1B,MAAMhiF,EAAS,KAET4Y,EAAa,OAIbyjD,EAAc,CAClBvrD,KAAM,MACN5D,QAAS,CACP,CAAC,OAAQ,OAAQ,MACjB,CAAC,SAAU,MAAO,OAClB,CAAC,SAAU,MAAO,OAClB,CAAC,KAAM,UAAW,WAClB,CAAC,SAAU,MAAO,OAClB,CAAC,KAAM,UAAW,aAMhBqvD,EAAc,CAClBzrD,KAAM,OACN5D,QAAS,CACP,CAAC,OAAQ,OAAQ,MACjB,CAAC,KAAM,UAAW,WAClB,CAAC,SAAU,MAAO,OAClB,CAAC,SAAU,MAAO,OAClB,CAAC,SAAU,MAAO,OAClB,CAAC,SAAU,MAAO,SAKhB2zD,EAAWvF,GAAsBe,EAAazjD,EAAY5Y,GAC1D8gE,EAAWxF,GAAsBiB,EAAa3jD,EAAY5Y,GAO1Dma,EAASiiD,GACbC,EACA,EACAE,EACA,EACA3jD,EATc+iD,GAAiBkF,EAASrF,SAAUsF,EAAStF,SAAUx7D,EApCrD,GA+ChBA,GAMIiiF,EAAgBnlE,GACpBA,EAAM5P,QACH9L,MAAM,GACNX,IAAI+T,GAAKA,EAAE,IACX3G,OAAOqxD,GAAKA,GAAK35D,OAAO25D,GAAG53D,MAAM,IAAI0T,OAAO,IAAIhb,YAE/C47D,EAASqmB,EAAc5lB,GACvBR,EAASomB,EAAc1lB,GAGvB2lB,EAAa7lB,EAAYnvD,QAC5B9L,MAAM,GACNyM,OAAO2G,IAAMA,EAAE,KAAOjP,OAAOiP,EAAE,IAAIlN,MAAM,IAAI0T,OAAO,IAAIhb,YACrDmiF,EAAa5lB,EAAYrvD,QAC5B9L,MAAM,GACNyM,OAAO2G,IAAMA,EAAE,KAAOjP,OAAOiP,EAAE,IAAIlN,MAAM,IAAI0T,OAAO,IAAIhb,YAGrDkgB,EAAmB,CAACq7C,EAAOv7D,EAAQiS,KACvC,MAAMkO,EAAUo7C,EACb96D,IAAIy+D,IACH,IAAKA,EAAG,OAAO,KACf,MAAM53D,EAAQ43D,EAAE53D,MAAM,IAAI0T,OAAO,IAAIhb,EAAOwF,QAAQ,sBAAuB,mBAC3E,OAAO8B,EAAQiZ,SAASjZ,EAAM,GAAI,IAAM,OAEzCuG,OAAO2S,GAAW,OAANA,GAEf,IAAK,IAAItgB,EAAI,EAAGA,EAAIigB,EAAQ/f,OAAQF,IAClC,GAAIigB,EAAQjgB,KAAO+R,EAAY/R,EAC7B,OAAO,EAGX,OAAO,GAGHkiF,EAAWliE,EAAiB07C,EAAQ57D,EAxFxB,GAyFZqiF,EAAWniE,EAAiB27C,EAAQ77D,EAzFxB,GA4FZsiF,EAAO,IAAIpvE,IAAI0oD,GACf2mB,EAAO,IAAIrvE,IAAI2oD,GACf2mB,EAAYF,EAAKplE,OAASqlE,EAAKrlE,MAAQ,IAAIolE,GAAMv3D,MAAMm0C,GAAKqjB,EAAKlvE,IAAI6rD,IAGrEujB,EAAsBP,EAAWtuE,KAAKY,GAAKA,EAAE,IAAMA,EAAE,GAAG1M,SAAS,QACjE46E,EAAsBP,EAAWvuE,KAAKY,GAAKA,EAAE,IAAMA,EAAE,GAAG1M,SAAS,QAEvE,MAAO,CACLu0D,cACAE,cACApiD,SACAyhD,SACAC,SACAqmB,aACAC,aACAC,WACAC,WACAG,YACAC,sBACAC,sBAEAhnB,QAAS0mB,GAAYC,GAAYG,GAAaC,GAAuBC,EAEzE,EAGA/yE,OAAOgzE,sBAAwB57D,iBAC7B,YAAyB,IAAd6B,IAA4E,mBAAxCA,GAAUmF,gCAC1CnF,GAAUmF,6BAEvBvsB,QAAQqK,MAAM,gCACP,KAEX,EAEA,MAAM,GAAQjG,KACVE,EAAGA,EAAEuG,UAAUu2E,MAAMrgE,IACpB5S,OAAOQ,iBAAiB,OAAQoS,GACtC,CAh57BD","sources":["src://tavern_helper_template/src//emoji-maps.ts","src://tavern_helper_template/src//index.ts"],"sourcesContent":["/**  -> Emoji  */\nexport const LOCATION_EMOJI_MAP: [RegExp, string][] = [\n  // ---  ---\n  [/|/, ''], // \n  [/|/, ''],\n  [/|||/, ''],\n  [/||/, ''],\n  [/||||||/, ''],\n  [/|/, ''],\n\n  // ---  ---\n  [/|||/, ''],\n  [/|||/, ''],\n  [/RiNG|LiveHouse||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/|||||/, ''],\n  [/|/, ''],\n  [/||||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ---  () ---\n  [/|/, ''],\n  [/|||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [/|/, ''],\n  [/||||||||/, ''],\n  [/|||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [/|/, ''],\n\n  // ---  ---\n  [/|||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||||/, ''],\n  [/||/, ''],\n  [/||||/, ''],\n  [/||||/, ''],\n  [/|||/, ''],\n  [/|||/, ''],\n  [/|||/, ''],\n  [/||/, ''],\n  [/|||/, ''],\n\n  // ---  ---\n  [/|||/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||||/, ''],\n  [/|||/, ''],\n  [/||/, ''],\n  [/|||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n\n  // ---  ---\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [//, ''],\n  [//, ''],\n  [/||/, ''],\n\n  // ---  ---\n  [/|/, ''],\n  [/|||/, ''],\n  [/|/, ''],\n  [/||||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n];\n\n/**  -> Emoji  */\nexport const ELEMENT_EMOJI_MAP: [RegExp, string][] = [\n  // ---  ---\n  [/BOSS|||/, ''],\n  [/|||||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||||/, ''],\n\n  // ---  ---\n  [/||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|||/, ''],\n  [/|||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [//, ''],\n  [//, ''],\n  [/|||/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''], //  \n  [/|||/, ''],\n\n  // ---  ---\n  [/||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|||/, ''],\n  [/|/, ''],\n\n  // ---  ---\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ---  ---\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|||/, ''],\n];\n","// @ts-nocheck\nimport { ELEMENT_EMOJI_MAP, LOCATION_EMOJI_MAP } from './emoji-maps';\n\n(function () {\n  'use strict';\n\n  const SCRIPT_ID = 'acu_visualizer_ui_v19_6_ai_overlay';\n  // ========================================\n  // LockManager - \n  // ========================================\n  const LockManager = {\n    STORAGE_KEY_PREFIX: 'acu_locked_fields_v2_',\n    MAX_CONTEXTS: 20, // \n\n    PRIMARY_KEYS: {\n      : null,\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n    },\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    //  N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) return;\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(`[DICE]LockManager  ${toDelete.length} `);\n        }\n      } catch (e) {\n        console.warn('[DICE]LockManager ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[DICE]LockManager ', e);\n      }\n    },\n\n    getRowKey(tableName, row, headers) {\n      const pkField = this.PRIMARY_KEYS[tableName];\n      if (pkField === null) return '_row_0';\n\n      let fieldIndex = 1;\n      if (pkField) {\n        const idx = headers.indexOf(pkField);\n        if (idx !== -1) fieldIndex = idx;\n      }\n\n      if (!row[fieldIndex]) return null;\n      return `${pkField || headers[fieldIndex]}=${row[fieldIndex]}`;\n    },\n\n    lockField(tableName, rowKey, fieldName, value) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n      if (!data[tableName][rowKey]) {\n        data[tableName][rowKey] = { _fullRow: false, _fields: {}, _snapshot: null };\n      }\n      data[tableName][rowKey]._fields[fieldName] = value;\n      this._save();\n    },\n\n    lockRow(tableName, rowKey, rowData, headers) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      const snapshot = {};\n      headers.forEach((h, i) => {\n        if (h && rowData[i] != null && rowData[i] !== '') {\n          snapshot[h] = rowData[i];\n        }\n      });\n\n      data[tableName][rowKey] = { _fullRow: true, _fields: {}, _snapshot: snapshot };\n      this._save();\n    },\n\n    unlockField(tableName, rowKey, fieldName) {\n      const data = this._load();\n      const lock = data[tableName]?.[rowKey];\n      if (!lock) return;\n\n      //  _snapshot \n      if (lock._fullRow && lock._snapshot) {\n        delete lock._snapshot[fieldName];\n        //  _snapshot \n        if (Object.keys(lock._snapshot).length === 0) {\n          delete data[tableName][rowKey];\n          if (Object.keys(data[tableName]).length === 0) {\n            delete data[tableName];\n          }\n        }\n      } else {\n        //  _fields \n        delete lock._fields[fieldName];\n        if (Object.keys(lock._fields).length === 0) {\n          delete data[tableName][rowKey];\n          if (Object.keys(data[tableName]).length === 0) {\n            delete data[tableName];\n          }\n        }\n      }\n      this._save();\n    },\n\n    unlockRow(tableName, rowKey) {\n      const data = this._load();\n      if (data[tableName]) {\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n        this._save();\n      }\n    },\n\n    isFieldLocked(tableName, rowKey, fieldName) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return false;\n      if (lock._fullRow) return lock._snapshot?.hasOwnProperty(fieldName);\n      return lock._fields?.hasOwnProperty(fieldName);\n    },\n\n    isRowLocked(tableName, rowKey) {\n      return this._load()[tableName]?.[rowKey]?._fullRow === true;\n    },\n\n    applyLocks(tableName, tableContent) {\n      const tableLocks = this._load()[tableName];\n      if (!tableLocks || !tableContent || tableContent.length < 2) {\n        return { modified: false, restored: [] };\n      }\n\n      const headers = tableContent[0];\n      const restored = [];\n      let modified = false;\n\n      // \n      const rowIndex = {};\n      for (let i = 1; i < tableContent.length; i++) {\n        const key = this.getRowKey(tableName, tableContent[i], headers);\n        if (key) rowIndex[key] = i;\n      }\n\n      for (const [rowKey, lock] of Object.entries(tableLocks)) {\n        const idx = rowIndex[rowKey];\n\n        if (idx === undefined) {\n          // \n          const newRow = this._rebuildRow(headers, lock);\n          if (newRow) {\n            tableContent.push(newRow);\n            restored.push(rowKey);\n            modified = true;\n          }\n          continue;\n        }\n\n        const row = tableContent[idx];\n        const fields = lock._fullRow ? lock._snapshot : lock._fields;\n\n        if (fields) {\n          for (const [field, value] of Object.entries(fields)) {\n            const colIdx = headers.indexOf(field);\n            if (colIdx !== -1 && row[colIdx] !== value) {\n              row[colIdx] = value;\n              modified = true;\n            }\n          }\n        }\n      }\n\n      return { modified, restored };\n    },\n\n    _rebuildRow(headers, lock) {\n      const fields = lock._fullRow ? lock._snapshot : lock._fields;\n      if (!fields || Object.keys(fields).length === 0) return null;\n\n      const row = new Array(headers.length).fill(null);\n      for (const [field, value] of Object.entries(fields)) {\n        const idx = headers.indexOf(field);\n        if (idx !== -1) row[idx] = value;\n      }\n      return row;\n    },\n\n    // \n    hasAnyLock(tableName, rowKey) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return false;\n      if (lock._fullRow) return true;\n      return Object.keys(lock._fields || {}).length > 0;\n    },\n\n    getLockedFields(tableName, rowKey) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return [];\n      if (lock._fullRow) return Object.keys(lock._snapshot || {});\n      return Object.keys(lock._fields || {});\n    },\n\n    // \n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  // ========================================\n  // BookmarkManager - \n  // ========================================\n  const BookmarkManager = {\n    STORAGE_KEY_PREFIX: 'acu_bookmarks_v1_',\n    MAX_CONTEXTS: 20, // bookmark\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    // bookmark N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) {\n          // \n          return;\n        }\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(\n            `[DICE]BookmarkManager  ${toDelete.length} bookmark ${this.MAX_CONTEXTS}  ${allKeys.length} `,\n          );\n        }\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    isBookmarked(tableName, rowKey) {\n      const data = this._load();\n      return !!(data[tableName] && data[tableName][rowKey]);\n    },\n\n    toggleBookmark(tableName, rowKey) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      if (data[tableName][rowKey]) {\n        // bookmark\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n      } else {\n        // bookmark\n        data[tableName][rowKey] = true;\n      }\n      this._save();\n    },\n\n    getBookmarks(tableName) {\n      const data = this._load();\n      if (!data[tableName]) return [];\n      return Object.keys(data[tableName]);\n    },\n\n    // bookmark\n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  const escapeHtml = s =>\n    String(s ?? '')\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n  // [] \n  const smartInsertToTextarea = (newContent, contentType) => {\n    // contentType: 'action' ()  'dice' ()\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = ($ta.val() || '').trim();\n\n    // \n    // : \"XX\"\n    const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n    // \n    // : \"  vs    (...)  ......  (...)  .........\"\n    const contestDiceRegex =\n      /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n    // <user>\n    const actionRegex = /<user>(?:(?!<user>).)*?[]/g;\n\n    // \n    const placeholderRegex = /\\[\\]/g;\n\n    // [] \n    const diceCfg = getDiceConfig();\n    let contentToInsert = newContent;\n    let shouldSaveOriginal = false;\n    if (contentType === 'dice' && diceCfg.hideDiceResultFromUser) {\n      contentToInsert = '[]';\n      shouldSaveOriginal = true;\n    }\n\n    // \n    if (!currentVal) {\n      $ta.val(contentToInsert).trigger('input').trigger('change');\n      // []  data \n      if (contentType === 'dice') {\n        $ta.data('acu-original-dice-text', newContent);\n        // []  DOM  getter  jQuery\n        const textarea = $ta[0] as any;\n        textarea._acuOriginalDiceText = newContent;\n        textarea._acuHasDiceData = true;\n      }\n      return;\n    }\n\n    // \n    let workingText = currentVal;\n    let existingAction = '';\n    let existingDice = '';\n    let existingDiceOriginal = '';\n\n    // [] 0. \n    if (placeholderRegex.test(workingText)) {\n      // \n      const originalText = $ta.data('acu-original-dice-text') || '';\n      if (originalText) {\n        // \n        workingText = workingText.replace(placeholderRegex, originalText);\n        existingDice = originalText;\n        existingDiceOriginal = originalText;\n      } else {\n        // \n        workingText = workingText.replace(placeholderRegex, '').trim();\n      }\n    }\n\n    // 1. \n    const contestMatches = workingText.match(contestDiceRegex);\n    if (contestMatches && contestMatches.length > 0) {\n      existingDice = contestMatches[contestMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(contestDiceRegex, '\\u0000').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted contest roll:', existingDice);\n    }\n\n    // 2. \n    const normalMatches = workingText.match(normalDiceRegex);\n    if (normalMatches && normalMatches.length > 0) {\n      // \n      existingDice = normalMatches[normalMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(normalDiceRegex, '\\u0000').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted normal roll:', existingDice);\n    }\n\n    // 3. \n    const actionMatches = workingText.match(actionRegex);\n    if (actionMatches && actionMatches.length > 0) {\n      existingAction = actionMatches[actionMatches.length - 1];\n      workingText = workingText.replace(actionRegex, '\\u0001').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted action:', existingAction);\n    }\n\n    // 4. \n    let userInput = workingText\n      .replace(/[\\u0000\\u0001]/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .trim();\n\n    // 5. \n    if (contentType === 'dice') {\n      // [] \n      existingDice = contentToInsert;\n      existingDiceOriginal = newContent;\n      //  data \n      $ta.data('acu-original-dice-text', newContent);\n      // []  DOM  getter  jQuery\n      const textarea = $ta[0] as any;\n      textarea._acuOriginalDiceText = newContent;\n      textarea._acuHasDiceData = true;\n    } else if (contentType === 'action') {\n      existingAction = newContent;\n    }\n\n    // 6.  +  + \n    const parts = [];\n    if (userInput) parts.push(userInput);\n    if (existingAction) parts.push(existingAction);\n    if (existingDice) parts.push(existingDice);\n\n    const finalVal = parts.join(' ');\n    $ta.val(finalVal).trigger('input').trigger('change');\n  };\n\n  // [] \n  const restoreDiceResultBeforeSend = () => {\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = $ta.val() || '';\n    const originalText = $ta.data('acu-original-dice-text');\n\n    // \n    if (currentVal.includes('[]') && originalText) {\n      const restoredVal = currentVal.replace(/\\[\\]/g, originalText);\n      $ta.val(restoredVal);\n      // \n      $ta.removeData('acu-original-dice-text');\n      // []  DOM \n      const textarea = $ta[0] as any;\n      textarea._acuOriginalDiceText = null;\n      textarea._acuHasDiceData = false;\n    }\n  };\n\n  // []  value \n  const interceptTextareaValue = () => {\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const textarea = $ta[0] as HTMLTextAreaElement;\n    if (!textarea || (textarea as any)._acuValueIntercepted) return;\n\n    // \n    (textarea as any)._acuValueIntercepted = true;\n\n    //  value \n    const originalDescriptor = Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype, 'value');\n    const originalValue = textarea.value;\n\n    //  value  getter\n    Object.defineProperty(textarea, 'value', {\n      get: function (this: HTMLTextAreaElement) {\n        // \n        let val: string;\n        if (originalDescriptor && originalDescriptor.get) {\n          val = originalDescriptor.get.call(this);\n        } else {\n          val = (this as any)._value || originalValue || '';\n        }\n\n        // [] \n        //  DOM  jQuery data getter  jQuery\n        //  ) \n        if (!(this as any)._acuHasDiceData) {\n          return val;\n        }\n\n        // \n        const originalText = (this as any)._acuOriginalDiceText;\n        if (val && typeof val === 'string' && val.includes('[]') && originalText) {\n          return val.replace(/\\[\\]/g, originalText);\n        }\n        return val;\n      },\n      set: function (this: HTMLTextAreaElement, val: string) {\n        if (originalDescriptor && originalDescriptor.set) {\n          originalDescriptor.set.call(this, val);\n        } else {\n          (this as any)._value = val;\n        }\n      },\n      configurable: true,\n    });\n  };\n  const STORAGE_KEY_TABLE_ORDER = 'acu_table_order';\n  const STORAGE_KEY_ACTION_ORDER = 'acu_action_order';\n  const STORAGE_KEY_PENDING_DELETIONS = 'acu_pending_deletions';\n  const STORAGE_KEY_ACTIVE_TAB = 'acu_active_tab';\n  const STORAGE_KEY_UI_CONFIG = 'acu_ui_config_v19';\n  const STORAGE_KEY_LAST_SNAPSHOT = 'acu_data_snapshot_v19';\n  const STORAGE_KEY_IS_COLLAPSED = 'acu_ui_collapsed_state';\n  const STORAGE_KEY_DASHBOARD_ACTIVE = 'acu_dashboard_active';\n  // [] \n  const STORAGE_KEY_TABLE_HEIGHTS = 'acu_table_heights_v19';\n  const STORAGE_KEY_TABLE_STYLES = 'acu_table_styles_v19';\n  const STORAGE_KEY_HIDDEN_TABLES = 'acu_hidden_tables_v19';\n  const STORAGE_KEY_GM_CONFIG = 'acu_gm_engine_config_v1';\n  const STORAGE_KEY_REVERSE_TABLES = 'acu_reverse_tables_v1';\n  const MAX_ACTION_BUTTONS = 6; // \n  const MIN_PANEL_HEIGHT = 200; // \n  const MAX_PANEL_HEIGHT = 1200; // \n\n  const STORAGE_KEY_DICE_CONFIG = 'acu_dice_config_v1';\n  const STORAGE_KEY_ATTRIBUTE_PRESETS = 'acu_attribute_presets_v1';\n  const STORAGE_KEY_ACTIVE_ATTR_PRESET = 'acu_active_attr_preset_v1';\n  const STORAGE_KEY_CRAZY_MODE = 'acu_dice_crazy_mode';\n  const DEFAULT_CRAZY_MODE_CONFIG = {\n    enabled: false,\n    crazyLevel: 50,\n    playerWeight: 80,\n    inSceneNpcWeight: 15,\n    offSceneNpcWeight: 5,\n  };\n  const PRESET_FORMAT_VERSION = '1.4.0'; // \n  const SCRIPT_VERSION = 'v3.1'; // \n\n  //  \"x.y.z\"\n  const compareVersion = (v1, v2) => {\n    // \n    const normalizeVersion = v => {\n      if (typeof v === 'number') return `${v}.0.0`;\n      if (typeof v !== 'string') return '0.0.0';\n      return v;\n    };\n    const nv1 = normalizeVersion(v1);\n    const nv2 = normalizeVersion(v2);\n    const parts1 = nv1.split('.').map(Number);\n    const parts2 = nv2.split('.').map(Number);\n    for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {\n      const p1 = parts1[i] || 0;\n      const p2 = parts2[i] || 0;\n      if (p1 < p2) return -1;\n      if (p1 > p2) return 1;\n    }\n    return 0;\n  };\n\n  const STORAGE_KEY_AVATAR_MAP = 'acu_avatar_map_v1';\n  const STORAGE_KEY_MAP_FOCUS = 'acu_map_focus_v1';\n\n  // ========================================\n  // ConsoleCaptureManager - Console\n  // ========================================\n  const ConsoleCaptureManager = {\n    logs: [],\n    maxLogs: 1000,\n    filters: { log: true, info: true, warn: true, error: true },\n    originalMethods: {},\n    isIntercepted: false,\n    enabled: false, // \n\n    restore() {\n      //  localStorage \n      const saved = localStorage.getItem('acu_console_capture_enabled');\n      if (saved === 'true') {\n        this.enable();\n      }\n    },\n\n    enable() {\n      if (this.enabled) return;\n      this.enabled = true;\n      localStorage.setItem('acu_console_capture_enabled', 'true');\n      this.intercept();\n    },\n\n    disable() {\n      if (!this.enabled) return;\n      this.enabled = false;\n      localStorage.setItem('acu_console_capture_enabled', 'false');\n      // \n      localStorage.removeItem('acu_script_error_detected');\n      // \n      const emergencyBtn = document.getElementById('acu-emergency-debug-btn');\n      if (emergencyBtn) {\n        emergencyBtn.style.display = 'none';\n      }\n    },\n\n    intercept() {\n      if (this.isIntercepted) return;\n      this.isIntercepted = true;\n\n      ['log', 'info', 'warn', 'error'].forEach(type => {\n        this.originalMethods[type] = console[type];\n        const self = this;\n        console[type] = function (...args) {\n          // \n          self.originalMethods[type].apply(console, args);\n          // \n          if (self.enabled) {\n            self.capture(type, args);\n          }\n        };\n      });\n    },\n\n    capture(type, args) {\n      if (!this.enabled) return; // \n      try {\n        const timestamp = new Date();\n        const timeStr = timestamp.toLocaleTimeString('zh-CN', { hour12: false });\n\n        // \n        const content = args\n          .map(arg => {\n            if (typeof arg === 'object') {\n              try {\n                return JSON.stringify(arg, null, 2);\n              } catch {\n                return String(arg);\n              }\n            }\n            return String(arg);\n          })\n          .join(' ');\n\n        // error\n        let stack = null;\n        if (type === 'error' && args[0] instanceof Error) {\n          stack = args[0].stack || null;\n        }\n\n        const logEntry = {\n          id: Date.now() + Math.random(),\n          timestamp,\n          timeStr,\n          type,\n          content,\n          stack,\n          rawArgs: args,\n        };\n\n        this.logs.push(logEntry);\n\n        // \n        if (this.logs.length > this.maxLogs) {\n          this.logs.shift();\n        }\n      } catch (e) {\n        // console\n      }\n    },\n\n    clear() {\n      this.logs = [];\n    },\n\n    getFilteredLogs() {\n      return this.logs.filter(log => this.filters[log.type]);\n    },\n\n    setFilters(filters) {\n      this.filters = { ...this.filters, ...filters };\n    },\n  };\n\n  // \n  // ConsoleCaptureManager.intercept();\n\n  // ========================================\n  // \n  // ========================================\n  const ErrorHandler = {\n    errorCount: 0,\n    errorThreshold: 3, // 3\n    lastErrorTime: 0,\n    errorWindow: 5000, // 5\n    fatalErrorDetected: false,\n\n    // \n    isFatalError(error, source, lineno, colno, stack) {\n      // \n      const thirdPartyPatterns = [/jquery/i, /lodash/i, /vue/i, /react/i, /pixi/i, /gsap/i, /toastr/i, /node_modules/i];\n\n      const errorInfo = stack || error?.stack || '';\n      const errorSource = source || '';\n\n      // \n      for (const pattern of thirdPartyPatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          return false;\n        }\n      }\n\n      // \n      const corePatterns = [\n        /acu_visualizer/i,\n        //i,\n        /LockManager/i,\n        /Store/i,\n        /ConsoleCaptureManager/i,\n        /renderInterface/i,\n        /init\\s*\\(/i,\n      ];\n\n      let isCoreError = false;\n      for (const pattern of corePatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          isCoreError = true;\n          break;\n        }\n      }\n\n      // \n      return isCoreError;\n    },\n\n    // \n    handleError(error, source, lineno, colno, stack) {\n      try {\n        // \n        if (!this.isFatalError(error, source, lineno, colno, stack)) {\n          return; // \n        }\n\n        const now = Date.now();\n\n        // \n        if (now - this.lastErrorTime > this.errorWindow) {\n          this.errorCount = 0;\n        }\n\n        this.errorCount++;\n        this.lastErrorTime = now;\n\n        // \n        if (this.errorCount >= this.errorThreshold && !this.fatalErrorDetected) {\n          this.fatalErrorDetected = true;\n          this.triggerFatalError();\n        }\n      } catch (e) {\n        // \n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    triggerFatalError() {\n      try {\n        //  console \n        if (!ConsoleCaptureManager.enabled) {\n          ConsoleCaptureManager.enable();\n        }\n\n        // \n        localStorage.setItem('acu_script_error_detected', 'true');\n\n        // \n        this.showEmergencyButton();\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    showEmergencyButton() {\n      try {\n        // \n        let btn = document.getElementById('acu-emergency-debug-btn');\n        if (btn) {\n          btn.style.display = 'block';\n          return;\n        }\n\n        // \n        btn = document.createElement('button');\n        btn.id = 'acu-emergency-debug-btn';\n        btn.innerHTML = '<i class=\"fa-solid fa-bug\"></i> ';\n        btn.style.cssText = `\n          position: fixed;\n          bottom: 20px;\n          right: 20px;\n          z-index: 99999;\n          padding: 10px 16px;\n          background: #e74c3c;\n          color: #fff;\n          border: none;\n          border-radius: 6px;\n          font-size: 14px;\n          font-weight: bold;\n          cursor: pointer;\n          box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);\n          display: flex;\n          align-items: center;\n          gap: 6px;\n          transition: all 0.2s;\n        `;\n\n        btn.onmouseenter = function () {\n          this.style.background = '#c0392b';\n          this.style.transform = 'scale(1.05)';\n        };\n        btn.onmouseleave = function () {\n          this.style.background = '#e74c3c';\n          this.style.transform = 'scale(1)';\n        };\n\n        btn.onclick = function () {\n          try {\n            //  showDebugConsoleModal\n            if (typeof window.showDebugConsoleModal === 'function') {\n              window.showDebugConsoleModal();\n            } else {\n              // \n              alert('F12');\n            }\n          } catch (e) {\n            console.error('[DICE]:', e);\n            alert('F12');\n          }\n        };\n\n        document.body.appendChild(btn);\n      } catch (e) {\n        console.error('[DICE]:', e);\n      }\n    },\n\n    // \n    checkAndRestore() {\n      try {\n        const errorDetected = localStorage.getItem('acu_script_error_detected') === 'true';\n        if (errorDetected) {\n          //  console \n          if (!ConsoleCaptureManager.enabled) {\n            ConsoleCaptureManager.enable();\n          }\n          // \n          this.showEmergencyButton();\n        }\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n  };\n\n  // \n  window.onerror = function (message, source, lineno, colno, error) {\n    ErrorHandler.handleError(error || message, source, lineno, colno, error?.stack);\n    return false; // \n  };\n\n  //  Promise \n  window.addEventListener('unhandledrejection', function (event) {\n    ErrorHandler.handleError(event.reason, null, null, null, event.reason?.stack);\n  });\n\n  // \n  //  init \n\n  // ========================================\n  //  -  (Phase 1.1)\n  // ========================================\n\n  /**\n   * \n   * - replace: \n   * - extract: ()\n   * - delete: \n   * - validate: (ValidationEngine,)\n   */\n  type RegexOperation = 'replace' | 'extract' | 'delete' | 'validate';\n\n  /**\n   * \n   * - global: \n   * - table: \n   * - column: \n   */\n  type RegexScopeType = 'global' | 'table' | 'column';\n\n  /**\n   * \n   * - auto: \n   * - manual: \n   * - preview: ,\n   */\n  type RegexExecutionMode = 'auto' | 'manual' | 'preview';\n\n  /**\n   * \n   */\n  interface RegexFlags {\n    caseInsensitive?: boolean; // i - \n    global?: boolean; // g - \n    multiline?: boolean; // m - \n    unicode?: boolean; // u - Unicode\n    sticky?: boolean; // y - \n  }\n\n  /**\n   * \n   */\n  interface RegexScopeConfig {\n    type: RegexScopeType;\n    tableNames?: string[]; // tablecolumn\n    columnNames?: string[]; // column\n  }\n\n  /**\n   * \n   */\n  interface RegexSecurityConfig {\n    maxMatchTime: number; // (),100\n    maxMatches: number; // ,1000\n    maxInputLength: number; // ,10000\n  }\n\n  /**\n   * \n   */\n  interface RegexTestCase {\n    input: string;\n    expected: string;\n    description?: string;\n  }\n\n  /**\n   * \n   */\n  interface RegexTransformationRule {\n    id: string; // \n    name: string; // \n    description?: string; // \n    operation: RegexOperation; // \n    pattern: string; // \n    flags?: RegexFlags; // \n    replacement?: string; // (replace)\n    scope: RegexScopeConfig; // \n    enabled: boolean; // \n    priority: number; // (1-100),\n    executeMode: RegexExecutionMode; // \n    testCases?: RegexTestCase[]; // \n    security?: RegexSecurityConfig; // \n    createdAt?: number; // \n    updatedAt?: number; // \n  }\n\n  /**\n   * \n   */\n  interface RegexTransformResult {\n    success: boolean;\n    oldValue: string;\n    newValue: string;\n    matched: boolean;\n    error?: string;\n  }\n\n  /**\n   * \n   */\n  interface RegexBatchTransformResult {\n    tableName: string;\n    columnIndex: number;\n    rowIndex: number;\n    result: RegexTransformResult;\n  }\n\n  /**\n   * \n   */\n  interface RegexPreviewResult {\n    rule: RegexTransformationRule;\n    affectedCells: Array<{\n      tableName: string;\n      rowIndex: number;\n      columnIndex: number;\n      columnName: string;\n      oldValue: string;\n      newValue: string;\n    }>;\n    totalAffected: number;\n  }\n\n  /**\n   * \n   */\n  interface RegexPreset {\n    id: string;\n    name: string;\n    description?: string;\n    version: string;\n    rules: RegexTransformationRule[];\n    createdAt?: number;\n    updatedAt?: number;\n  }\n\n  // \n  const STORAGE_KEY_REGEX_RULES = 'acu_regex_rules_v1';\n  const STORAGE_KEY_REGEX_PRESETS = 'acu_regex_presets_v1';\n  const STORAGE_KEY_REGEX_ACTIVE_PRESET = 'acu_regex_active_preset_v1';\n  const STORAGE_KEY_REGEX_ENABLED = 'acu_regex_enabled_v1';\n\n  // ========================================\n  //  (Phase 2.2)\n  // ========================================\n  const BUILTIN_REGEX_RULES: RegexTransformationRule[] = [\n    // 1: ()\n    {\n      id: 'builtin_trim_spaces',\n      name: '',\n      description: ',',\n      operation: 'replace',\n      pattern: '^\\\\s+|\\\\s+$|\\\\s+',\n      flags: { global: true },\n      replacement: ' ',\n      scope: { type: 'global' },\n      enabled: false,\n      priority: 10,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // 2: ()\n    {\n      id: 'builtin_normalize_quotes',\n      name: '',\n      description: '',\n      operation: 'replace',\n      pattern: '[\"]|[\\']',\n      flags: { global: true },\n      replacement: '\"',\n      scope: { type: 'global' },\n      enabled: false,\n      priority: 10,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // 3: ()\n    {\n      id: 'builtin_item_quality_format',\n      name: '',\n      description: '',\n      operation: 'replace',\n      pattern: '\\\\b(|||||)\\\\b',\n      flags: { global: true },\n      replacement: '$1',\n      scope: { type: 'column', tableNames: ['', ''], columnNames: [''] },\n      enabled: false,\n      priority: 50,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n  ];\n\n  // ========================================\n  // ValidationRuleManager - \n  // ========================================\n  const STORAGE_KEY_VALIDATION_RULES = 'acu_validation_rules_v1';\n  const STORAGE_KEY_VALIDATION_ENABLED = 'acu_validation_enabled_v1';\n  const STORAGE_KEY_VALIDATION_MODE = 'acu_validation_mode'; // \n\n  //  UI \n  const RULE_TYPE_INFO = {\n    // \n    tableReadonly: { name: '', scope: 'table', icon: 'fa-lock', desc: '' },\n    rowLimit: { name: '', scope: 'table', icon: 'fa-arrows-up-down', desc: '' },\n    sequence: { name: '', scope: 'table', icon: 'fa-sort-numeric-up', desc: '' },\n    // \n    required: { name: '', scope: 'field', icon: 'fa-asterisk', desc: '' },\n    format: { name: '', scope: 'field', icon: 'fa-font', desc: '' },\n    enum: { name: '', scope: 'field', icon: 'fa-list', desc: '' },\n    numeric: { name: '', scope: 'field', icon: 'fa-hashtag', desc: '' },\n    relation: { name: '', scope: 'field', icon: 'fa-link', desc: '' },\n    keyValue: { name: '', scope: 'field', icon: 'fa-key', desc: '' },\n  };\n\n  // \n  const BUILTIN_VALIDATION_RULES = [\n    // \n    {\n      id: 'summary_code_sequence',\n      name: '',\n      description: 'AM0001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM0001',\n    },\n    // \n    {\n      id: 'outline_code_sequence',\n      name: '',\n      description: 'AM0001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM0001',\n    },\n    // \n    {\n      id: 'summary_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'outline_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_priority_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'item_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_proficiency_range',\n      name: '',\n      description: ' 0-100 ',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'numeric',\n      config: { min: 0, max: 100 },\n      errorMessage: ' 0-100 ',\n    },\n    // \n    {\n      id: 'npc_presence_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_explore_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'intel_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'player_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // NPC\n    {\n      id: 'npc_location_relation',\n      name: 'NPC',\n      description: 'NPC',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'element_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'global_detail_location_relation',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    //  - \n    {\n      id: 'player_base_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_special_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_relationships_keyvalue',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    //  - \n    {\n      id: 'npc_base_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_special_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_relationships_keyvalue',\n      name: 'NPC',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    //  - \n    {\n      id: 'quest_progress_format',\n      name: '',\n      description: '+%50%',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'format',\n      config: { pattern: '^\\\\d+%$' },\n      errorMessage: '+%50%100%',\n    },\n  ];\n\n  // ========================================\n  // BlacklistManager - MVU\n  // ========================================\n  const STORAGE_KEY_BLACKLIST = 'acu_filter_blacklist_v1';\n  const STORAGE_KEY_BLACKLIST_VERSION = 'acu_filter_blacklist_version';\n  const DEFAULT_BLACKLIST = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    'ID',\n    '',\n    '',\n    'measurements',\n    'ages',\n    '',\n    'order',\n    '',\n    'time',\n    'cost',\n  ];\n\n  const BlacklistManager = {\n    // \n    getBlacklist() {\n      const stored = Store.get(STORAGE_KEY_BLACKLIST, null);\n      const storedVersion = Store.get(STORAGE_KEY_BLACKLIST_VERSION, null);\n\n      // \n      if (!stored || !Array.isArray(stored)) {\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return [...DEFAULT_BLACKLIST];\n      }\n\n      // \n      if (!storedVersion || compareVersion(storedVersion, PRESET_FORMAT_VERSION) < 0) {\n        console.log(`[DICE]BlacklistManager  (${storedVersion || ''})`);\n\n        // \n        const userItems = new Set(stored);\n        const defaultItems = new Set(DEFAULT_BLACKLIST);\n        const mergedItems = [...DEFAULT_BLACKLIST]; // \n\n        // \n        stored.forEach(item => {\n          if (!defaultItems.has(item)) {\n            mergedItems.push(item);\n          }\n        });\n\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, mergedItems);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return mergedItems;\n      }\n\n      return stored;\n    },\n\n    // \n    setBlacklist(list) {\n      if (!Array.isArray(list)) {\n        console.warn('[DICE]BlacklistManager ');\n        return false;\n      }\n      Store.set(STORAGE_KEY_BLACKLIST, list);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // \n    resetToDefault() {\n      Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // key\n    //  \" >  >  > \" \"\"\n    isBlacklisted(key) {\n      if (!key || typeof key !== 'string') return false;\n      const blacklist = this.getBlacklist();\n      if (blacklist.length === 0) return false;\n\n      // key \">\"  \" > \"\n      const parts = key\n        .split(/>| > /)\n        .map(s => s.trim())\n        .filter(s => s);\n      const lastPart = parts.length > 0 ? parts[parts.length - 1] : key;\n\n      // key\n      return blacklist.some(item => lastPart.includes(item));\n    },\n  };\n\n  // ========================================\n  // PresetManager - \n  // ========================================\n  const STORAGE_KEY_PRESETS = 'acu_validation_presets_v1';\n  const STORAGE_KEY_ACTIVE_PRESET = 'acu_active_preset_id';\n\n  const PresetManager = {\n    _cache: null,\n\n    // \n    getAllPresets() {\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n      if (!stored) {\n        this._initDefaultPreset();\n        return this._cache;\n      }\n      // \n      let needsSave = false;\n      stored.forEach(preset => {\n        if (!preset.version || this._compareVersion(preset.version, PRESET_FORMAT_VERSION) < 0) {\n          console.log(\n            `[DICE]PresetManager  \"${preset.name}\"  (${preset.version || ''})`,\n          );\n          // \n          const customRules = preset.rules.filter(r => !r.builtin);\n          const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n          const mergedRules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r, builtin: true }))];\n          customRules.forEach(rule => {\n            const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n            if (!builtinRuleIds.has(key)) {\n              mergedRules.push({ ...rule, builtin: false });\n            }\n          });\n          preset.rules = mergedRules;\n          preset.version = PRESET_FORMAT_VERSION;\n          needsSave = true;\n        }\n      });\n      if (needsSave) {\n        this._save(stored);\n        ValidationRuleManager.clearCache();\n        // \n        this._cache = null;\n      }\n      // \n      if (!needsSave && this._cache) {\n        return this._cache;\n      }\n      this._cache = stored;\n      return stored;\n    },\n\n    // \n    getActivePreset() {\n      const presets = this.getAllPresets();\n      const activeId = Store.get(STORAGE_KEY_ACTIVE_PRESET, 'default');\n      return presets.find(p => p.id === activeId) || presets[0];\n    },\n\n    // \n    setActivePreset(id) {\n      if (!this.getAllPresets().find(p => p.id === id)) return false;\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, id);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    createPreset(name) {\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: name || '',\n        builtin: false,\n        rules: [],\n        version: PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    duplicatePreset(id) {\n      const source = this.getAllPresets().find(p => p.id === id);\n      if (!source) return null;\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: source.name + ' ()',\n        builtin: false,\n        rules: JSON.parse(JSON.stringify(source.rules)),\n        version: source.version || PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      console.log('[DICE]PresetManager :', source.name, '->', newPreset.name);\n      return newPreset;\n    },\n\n    //  id='default' \n    deletePreset(id) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset || preset.id === 'default') return false; // \n      const filtered = presets.filter(p => p.id !== id);\n      this._save(filtered);\n      if (Store.get(STORAGE_KEY_ACTIVE_PRESET) === id) {\n        Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n        ValidationRuleManager.clearCache();\n      }\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    updatePresetRules(id, rules) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return false;\n      preset.rules = rules;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      return true;\n    },\n\n    // \n    exportPreset(id) {\n      const preset = this.getAllPresets().find(p => p.id === id);\n      if (!preset) return null;\n      const json = JSON.stringify(\n        {\n          format: 'acu_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          preset: { name: preset.name, rules: preset.rules },\n        },\n        null,\n        2,\n      );\n      return json;\n    },\n\n    // \n    _compareVersion(v1, v2) {\n      return compareVersion(v1, v2);\n    },\n\n    // \n    mergePresetWithDefaults(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) return false;\n\n      // \n      const customRules = preset.rules.filter(r => !r.builtin);\n      const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n\n      // \n      const builtinRuleMap = new Map();\n      BUILTIN_VALIDATION_RULES.forEach(r => {\n        const key = r.id || r.targetTable + '_' + r.ruleType;\n        builtinRuleMap.set(key, r);\n      });\n\n      // \n      const mergedRules = [];\n      const processedCustomIds = new Set();\n\n      // 1. \n      BUILTIN_VALIDATION_RULES.forEach(newRule => {\n        const key = newRule.id || newRule.targetTable + '_' + newRule.ruleType;\n        const existingRule = preset.rules.find(r => (r.id || r.targetTable + '_' + r.ruleType) === key && r.builtin);\n        if (existingRule) {\n          // \n          const isModified = JSON.stringify(existingRule) !== JSON.stringify(newRule);\n          if (isModified) {\n            // \n            mergedRules.push({ ...existingRule, builtin: true });\n          } else {\n            // \n            mergedRules.push({ ...newRule, builtin: true });\n          }\n        } else {\n          // \n          mergedRules.push({ ...newRule, builtin: true });\n        }\n        processedCustomIds.add(key);\n      });\n\n      // 2. \n      customRules.forEach(rule => {\n        const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n        if (!builtinRuleIds.has(key)) {\n          mergedRules.push({ ...rule, builtin: false });\n        }\n      });\n\n      preset.rules = mergedRules;\n      preset.version = PRESET_FORMAT_VERSION;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', preset.name);\n      return true;\n    },\n\n    // \n    importPreset(json, autoMerge = false) {\n      try {\n        const data = JSON.parse(json);\n        if (data.format !== 'acu_preset_v1' || !data.preset) return null;\n\n        const importedVersion = data.version || '0.0.0';\n        const needsMerge = this._compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n        const presets = this.getAllPresets();\n        const newPreset = {\n          id: 'imported_' + Date.now(),\n          name: data.preset.name || '',\n          builtin: false,\n          rules: data.preset.rules || [],\n          version: importedVersion,\n          createdAt: new Date().toISOString(),\n        };\n\n        // \n        if (needsMerge && autoMerge) {\n          presets.push(newPreset);\n          this._save(presets);\n          this.mergePresetWithDefaults(newPreset.id);\n          console.log('[DICE]PresetManager :', newPreset.name);\n        } else {\n          presets.push(newPreset);\n          this._save(presets);\n          console.log('[DICE]PresetManager :', newPreset.name);\n          if (needsMerge) {\n            console.warn('[DICE]PresetManager  mergePresetWithDefaults ');\n          }\n        }\n\n        return { preset: newPreset, needsMerge: needsMerge && !autoMerge };\n      } catch (e) {\n        console.error('[DICE]PresetManager :', e);\n        return null;\n      }\n    },\n\n    // \n    _getBuiltinRulesVersion() {\n      try {\n        const rulesStr = JSON.stringify(BUILTIN_VALIDATION_RULES);\n        // \n        let hash = 0;\n        for (let i = 0; i < rulesStr.length; i++) {\n          const char = rulesStr.charCodeAt(i);\n          hash = (hash << 5) - hash + char;\n          hash = hash & hash; // Convert to 32bit integer\n        }\n        return hash.toString(36);\n      } catch (e) {\n        console.error('[DICE]PresetManager :', e);\n        return '0';\n      }\n    },\n\n    // \n    _initDefaultPreset() {\n      const currentVersion = this._getBuiltinRulesVersion();\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n\n      // \n      if (stored && Array.isArray(stored)) {\n        const defaultPreset = stored.find(p => p.id === 'default');\n        if (defaultPreset && defaultPreset._builtinVersion !== currentVersion) {\n          console.log('[DICE]PresetManager ');\n          // \n          const customRules = defaultPreset.rules.filter(r => !r.builtin);\n          defaultPreset.rules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r })), ...customRules];\n          defaultPreset._builtinVersion = currentVersion;\n          this._cache = stored;\n          this._save(stored);\n          Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n          return;\n        }\n      }\n\n      const defaultPreset = {\n        id: 'default',\n        name: '',\n        builtin: true,\n        rules: BUILTIN_VALIDATION_RULES.map(r => ({ ...r })),\n        version: PRESET_FORMAT_VERSION,\n        _builtinVersion: currentVersion,\n        createdAt: new Date().toISOString(),\n      };\n      // \n      const oldCustom = Store.get(STORAGE_KEY_VALIDATION_RULES, []);\n      if (oldCustom.length > 0) {\n        defaultPreset.rules.push(...oldCustom.map(r => ({ ...r, builtin: false })));\n        console.log('[DICE]PresetManager :', oldCustom.length, '');\n      }\n      this._cache = [defaultPreset];\n      this._save(this._cache);\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n    },\n\n    // \n    resetDefaultPreset() {\n      const presets = this.getAllPresets();\n      const defaultPreset = presets.find(p => p.id === 'default');\n      if (defaultPreset) {\n        // \n        const customRules = defaultPreset.rules.filter(r => !r.builtin);\n        defaultPreset.rules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r })), ...customRules];\n        defaultPreset._builtinVersion = this._getBuiltinRulesVersion();\n        this._save(presets);\n        ValidationRuleManager.clearCache();\n        return true;\n      }\n      return false;\n    },\n\n    _save(presets) {\n      Store.set(STORAGE_KEY_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  //  PresetManager \n  const ValidationRuleManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const preset = PresetManager.getActivePreset();\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = (preset?.rules || []).map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_VALIDATION_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n      this._cache = null; // \n    },\n\n    // \n    toggleRuleIntercept(ruleId, intercept) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const rule = preset.rules.find(r => r.id === ruleId);\n      if (!rule) return false;\n\n      rule.intercept = intercept;\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled);\n    },\n\n    // \n    addCustomRule(rule) {\n      if (!rule.id || !rule.name || !rule.targetTable) {\n        console.error('[DICE]ValidationRuleManager ');\n        return false;\n      }\n\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      //  ID \n      if (preset.rules.some(r => r.id === rule.id)) {\n        console.error('[DICE]ValidationRuleManager  ID :', rule.id);\n        return false;\n      }\n\n      const newRule = { ...rule, builtin: false, enabled: true };\n      preset.rules.push(newRule);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      console.log('[DICE]ValidationRuleManager :', newRule.name);\n      return true;\n    },\n\n    // \n    removeCustomRule(ruleId) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules.splice(index, 1);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n\n      // \n      const states = this.getEnabledStates();\n      delete states[ruleId];\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n\n      console.log('[DICE]ValidationRuleManager :', ruleId);\n      return true;\n    },\n\n    // \n    updateCustomRule(ruleId, updates) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules[index] = { ...preset.rules[index], ...updates, id: ruleId };\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getRule(ruleId) {\n      return this.getAllRules().find(r => r.id === ruleId);\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n\n    // \n    getRulesByTable(tableName) {\n      return this.getEnabledRules().filter(rule => rule.targetTable === tableName);\n    },\n  };\n\n  // ========================================\n  // RegexTransformationManager -  (Phase 1.2)\n  // ========================================\n  const RegexTransformationManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // ID\n    _generateId() {\n      return `regex_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    },\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = rules.map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_REGEX_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    _saveEnabledStates(states) {\n      Store.set(STORAGE_KEY_REGEX_ENABLED, states);\n      this._enabledCache = states;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled !== false);\n    },\n\n    // \n    getApplicableRules(tableName, columnName) {\n      const allRules = this.getEnabledRules();\n\n      return allRules\n        .filter(rule => {\n          // \n          switch (rule.scope.type) {\n            case 'global':\n              return true;\n            case 'table':\n              return rule.scope.tableNames && rule.scope.tableNames.includes(tableName);\n            case 'column':\n              return (\n                rule.scope.tableNames &&\n                rule.scope.tableNames.includes(tableName) &&\n                rule.scope.columnNames &&\n                rule.scope.columnNames.includes(columnName)\n              );\n            default:\n              return false;\n          }\n        })\n        .sort((a, b) => b.priority - a.priority); // \n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      this._saveEnabledStates(states);\n      this.clearCache();\n    },\n\n    // \n    addCustomRule(rule) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n\n      // \n      if (!rule.name || !rule.pattern || !rule.scope) {\n        console.error('[DICE]RegexTransformationManager: ');\n        return false;\n      }\n\n      const newRule: RegexTransformationRule = {\n        id: this._generateId(),\n        name: rule.name,\n        description: rule.description,\n        operation: rule.operation || 'replace',\n        pattern: rule.pattern,\n        flags: rule.flags || {},\n        replacement: rule.replacement,\n        scope: rule.scope,\n        enabled: rule.enabled !== undefined ? rule.enabled : true,\n        priority: rule.priority || 50,\n        executeMode: rule.executeMode || 'auto',\n        testCases: rule.testCases || [],\n        security: rule.security || { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      rules.push(newRule);\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n      return newRule;\n    },\n\n    // \n    removeRule(ruleId) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const index = rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      rules.splice(index, 1);\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n      return true;\n    },\n\n    // \n    updateRule(ruleId, updates) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const index = rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      rules[index] = {\n        ...rules[index],\n        ...updates,\n        id: ruleId,\n        updatedAt: Date.now(),\n      };\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n      return true;\n    },\n\n    // \n    getRule(ruleId) {\n      return this.getAllRules().find(r => r.id === ruleId);\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n  };\n\n  // ========================================\n  // RegexPresetManager -  (Phase 1.3)\n  // ========================================\n  const RegexPresetManager = {\n    _cache: null,\n\n    // \n    getAllPresets() {\n      if (this._cache) return this._cache;\n\n      const presets = Store.get(STORAGE_KEY_REGEX_PRESETS, []);\n\n      // \n      if (presets.length === 0) {\n        const defaultPreset: RegexPreset = {\n          id: 'regex_default',\n          name: '',\n          description: '',\n          version: '1.0.0',\n          rules: [],\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n        presets.push(defaultPreset);\n        Store.set(STORAGE_KEY_REGEX_PRESETS, presets);\n      }\n\n      this._cache = presets;\n      return presets;\n    },\n\n    // \n    getActivePreset() {\n      const activeId = Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET, 'regex_default');\n      const presets = this.getAllPresets();\n      return presets.find(p => p.id === activeId) || presets[0];\n    },\n\n    // \n    setActivePreset(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) {\n        console.error('[DICE]RegexPresetManager: ', presetId);\n        return false;\n      }\n\n      Store.set(STORAGE_KEY_REGEX_ACTIVE_PRESET, presetId);\n\n      // RegexTransformationManager\n      RegexTransformationManager.clearCache();\n\n      return true;\n    },\n\n    // \n    createPreset(name, sourcePresetId) {\n      const presets = this.getAllPresets();\n\n      // \n      if (presets.some(p => p.name === name)) {\n        console.error('[DICE]RegexPresetManager: ', name);\n        return false;\n      }\n\n      const sourcePreset = sourcePresetId ? presets.find(p => p.id === sourcePresetId) : this.getActivePreset();\n\n      const newPreset: RegexPreset = {\n        id: `regex_preset_${Date.now()}`,\n        name: name,\n        description: sourcePreset?.description,\n        version: '1.0.0',\n        rules: sourcePreset ? JSON.parse(JSON.stringify(sourcePreset.rules)) : [],\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    updatePresetRules(presetId, rules) {\n      const presets = this.getAllPresets();\n      const index = presets.findIndex(p => p.id === presetId);\n      if (index === -1) return false;\n\n      presets[index].rules = JSON.parse(JSON.stringify(rules));\n      presets[index].updatedAt = Date.now();\n\n      this._save(presets);\n\n      // ,\n      if (presetId === Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET)) {\n        RegexTransformationManager.clearCache();\n      }\n\n      return true;\n    },\n\n    // \n    deletePreset(presetId) {\n      const presets = this.getAllPresets();\n\n      // \n      if (presets.length <= 1) {\n        console.error('[DICE]RegexPresetManager: ');\n        return false;\n      }\n\n      const index = presets.findIndex(p => p.id === presetId);\n      if (index === -1) return false;\n\n      presets.splice(index, 1);\n      this._save(presets);\n\n      // ,\n      if (presetId === Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET)) {\n        this.setActivePreset(presets[0].id);\n      }\n\n      return true;\n    },\n\n    // JSON\n    exportPreset(presetId) {\n      const preset = this.getAllPresets().find(p => p.id === presetId);\n      if (!preset) return null;\n\n      return JSON.stringify(preset, null, 2);\n    },\n\n    // JSON\n    importPreset(jsonString) {\n      try {\n        const data = JSON.parse(jsonString);\n\n        // \n        if (!data.name || !Array.isArray(data.rules)) {\n          console.error('[DICE]RegexPresetManager: ');\n          return false;\n        }\n\n        const presets = this.getAllPresets();\n\n        // ID\n        const newPreset: RegexPreset = {\n          id: `regex_preset_${Date.now()}`,\n          name: data.name,\n          description: data.description,\n          version: data.version || '1.0.0',\n          rules: data.rules.map((rule: RegexTransformationRule) => ({\n            ...rule,\n            id: RegexTransformationManager._generateId(),\n          })),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n\n        presets.push(newPreset);\n        this._save(presets);\n        return newPreset;\n      } catch (e) {\n        console.error('[DICE]RegexPresetManager: ', e);\n        return false;\n      }\n    },\n\n    // \n    _save(presets) {\n      Store.set(STORAGE_KEY_REGEX_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  // ========================================\n  // RegexTransformationEngine -  (Phase 2.1)\n  // ========================================\n  const RegexTransformationEngine = {\n    // \n    _regexCache: new Map<string, RegExp>(),\n\n    // \n    _buildFlags(flags: RegexFlags): string {\n      const result: string[] = [];\n      if (flags.caseInsensitive) result.push('i');\n      if (flags.global) result.push('g');\n      if (flags.multiline) result.push('m');\n      if (flags.unicode) result.push('u');\n      if (flags.sticky) result.push('y');\n      return result.join('');\n    },\n\n    // ()\n    _getRegex(pattern: string, flags: RegexFlags): RegExp | null {\n      //  unicode \n      const hasLookbehind = pattern.includes('(?<') || pattern.includes('(?<=');\n      const hasLookahead = pattern.includes('(?=') || pattern.includes('(?!');\n      const needsUnicode = hasLookbehind || hasLookahead;\n\n      //  unicode \n      if (needsUnicode && !flags.unicode) {\n        flags = { ...flags, unicode: true };\n      }\n\n      const flagsStr = this._buildFlags(flags);\n      const cacheKey = `${pattern}/${flagsStr}`;\n\n      if (this._regexCache.has(cacheKey)) {\n        const regex = this._regexCache.get(cacheKey)!;\n        regex.lastIndex = 0;\n        return regex;\n      }\n\n      try {\n        const regex = new RegExp(pattern, flagsStr);\n        this._regexCache.set(cacheKey, regex);\n        return regex;\n      } catch (e) {\n        console.error('[DICE]RegexTransformationEngine: ', pattern, e);\n        return null;\n      }\n    },\n\n    // ReDoS: \n    _scoreRegexComplexity(pattern: string): number {\n      let score = 0;\n\n      //  +50\n      if (/(\\*|\\+|\\{)\\1{2,}/.test(pattern)) score += 50;\n\n      //  +30\n      if (/(\\.\\*|\\.\\+)[^\\[]*\\1/.test(pattern)) score += 30;\n\n      //  +10\n      const captureGroups = (pattern.match(/\\(/g) || []).length;\n      score += Math.min(captureGroups * 5, 20);\n\n      return score;\n    },\n\n    // ReDoS: \n    _getTimeoutForRule(rule: RegexTransformationRule): number {\n      const complexity = this._scoreRegexComplexity(rule.pattern);\n      const baseTimeout = rule.security?.maxMatchTime || 100;\n      // ,\n      return Math.max(baseTimeout - complexity * 2, 50);\n    },\n\n    // \n    _safeReplace(value: string, rule: RegexTransformationRule, regex: RegExp): RegexTransformResult {\n      const oldValue = value;\n\n      // \n      const maxInputLength = rule.security?.maxInputLength || 10000;\n      if (value.length > maxInputLength) {\n        return {\n          success: false,\n          oldValue,\n          newValue: oldValue,\n          matched: false,\n          error: `(${maxInputLength})`,\n        };\n      }\n\n      try {\n        const timeout = this._getTimeoutForRule(rule);\n        const startTime = Date.now();\n\n        // \n        let newValue: string;\n        switch (rule.operation) {\n          case 'replace':\n            newValue = value.replace(regex, rule.replacement || '');\n            break;\n          case 'delete':\n            newValue = value.replace(regex, '');\n            break;\n          case 'validate':\n            const isValid = regex.test(value);\n            newValue = value;\n            break;\n          default:\n            newValue = value;\n        }\n\n        // \n        const elapsed = Date.now() - startTime;\n        if (elapsed > timeout) {\n          console.warn('[DICE]RegexTransformationEngine: ', rule.pattern, elapsed);\n          return {\n            success: false,\n            oldValue,\n            newValue: oldValue,\n            matched: false,\n            error: `(${elapsed}ms > ${timeout}ms)`,\n          };\n        }\n\n        // \n        const matched = oldValue !== newValue || regex.test(oldValue);\n\n        return {\n          success: true,\n          oldValue,\n          newValue,\n          matched,\n        };\n      } catch (e) {\n        console.error('[DICE]RegexTransformationEngine: ', rule.pattern, e);\n        return {\n          success: false,\n          oldValue,\n          newValue: oldValue,\n          matched: false,\n          error: String(e),\n        };\n      }\n    },\n\n    // \n    applyToValue(value: string, rule: RegexTransformationRule): RegexTransformResult {\n      if (value === null || value === undefined) {\n        return {\n          success: true,\n          oldValue: '',\n          newValue: '',\n          matched: false,\n        };\n      }\n\n      const strValue = String(value);\n\n      //  pattern  flags /pattern/flags\n      let pattern = rule.pattern;\n      let flags = rule.flags || {};\n\n      //  /pattern/flags \n      const extracted = this._extractFlags(pattern);\n      if (extracted.patternWithoutFlags !== pattern) {\n        //  pattern  flags\n        pattern = extracted.patternWithoutFlags;\n        flags = { ...flags, ...extracted.flags };\n      }\n\n      // \n      //  flags  global true\n      if (flags.global === undefined) {\n        flags.global = true;\n      }\n\n      const regex = this._getRegex(pattern, flags);\n\n      if (!regex) {\n        return {\n          success: false,\n          oldValue: strValue,\n          newValue: strValue,\n          matched: false,\n          error: '',\n        };\n      }\n\n      return this._safeReplace(strValue, rule, regex);\n    },\n\n    // flags (: /test/g  'g')\n    _extractFlags(patternStr: string): { flags: RegexFlags; patternWithoutFlags: string } {\n      const flags: RegexFlags = {\n        global: false,\n        caseInsensitive: false,\n        multiline: false,\n        unicode: false,\n        sticky: false,\n      };\n\n      //  /pattern/flags \n      const inlineFlagMatch = patternStr.match(/^\\/(.+)\\/([gimuy]*)$/);\n      if (inlineFlagMatch) {\n        const [, patternWithoutFlags, flagStr] = inlineFlagMatch;\n        if (flagStr.includes('g')) flags.global = true;\n        if (flagStr.includes('i')) flags.caseInsensitive = true;\n        if (flagStr.includes('m')) flags.multiline = true;\n        if (flagStr.includes('u')) flags.unicode = true;\n        if (flagStr.includes('y')) flags.sticky = true;\n        return { flags, patternWithoutFlags };\n      }\n\n      // flags\n      return { flags, patternWithoutFlags: patternStr };\n    },\n\n    // \n    applyToTable(\n      tableData:\n        | { name: string; headers: string[]; rows: string[][] }\n        | { [key: string]: { name?: string; content?: string[][] } },\n      rules: RegexTransformationRule[],\n    ): { totalApplied: number; errors: string[] } {\n      let totalApplied = 0;\n      const errors: string[] = [];\n\n      try {\n        // \n        let isSimpleFormat = false;\n        let sheetMap: Map<\n          string,\n          { sheet: any; sheetKey: string; name: string; headers: string[]; contentRowIndex: number }\n        > = new Map();\n\n        if ('name' in tableData && 'headers' in tableData && 'rows' in tableData) {\n          // : { name, headers, rows }\n          isSimpleFormat = true;\n          const simpleTable = tableData as { name: string; headers: string[]; rows: string[][] };\n          sheetMap.set(simpleTable.name, {\n            sheet: simpleTable,\n            sheetKey: simpleTable.name,\n            name: simpleTable.name,\n            headers: simpleTable.headers,\n            contentRowIndex: -1, //  contentRowIndex\n          });\n        } else {\n          // : { sheet_xxx: { name, content: [headers, ...rows] } }\n          const dataObj = tableData as { [key: string]: { name?: string; content?: string[][] } };\n\n          Object.keys(dataObj).forEach(sheetKey => {\n            if (!sheetKey.startsWith('sheet_')) return;\n\n            const sheet = dataObj[sheetKey];\n            if (!sheet || !sheet.content || !Array.isArray(sheet.content) || sheet.content.length < 1) {\n              console.warn(`[DICE]applyToTable:  ${sheetKey}`);\n              return;\n            }\n\n            const tableName = sheet.name || sheetKey;\n            sheetMap.set(tableName, {\n              sheet,\n              sheetKey,\n              name: tableName,\n              headers: sheet.content[0] || [],\n              contentRowIndex: 0, //  content[0]\n            });\n          });\n        }\n\n        if (sheetMap.size === 0) {\n          console.warn('[DICE]applyToTable: ');\n          return { totalApplied: 0, errors: [''] };\n        }\n\n        // \n        for (const [tableName, tableInfo] of sheetMap.entries()) {\n          const { sheet, headers, contentRowIndex } = tableInfo;\n\n          for (const rule of rules) {\n            if (!rule.enabled) continue;\n\n            // \n            const scope = rule.scope;\n            const shouldProcessTable = scope.type === 'global' || scope.tableNames?.includes(tableName);\n\n            if (!shouldProcessTable) continue;\n\n            try {\n              // \n              if (isSimpleFormat) {\n                //  rows\n                const rows = (sheet as { rows: string[][] }).rows;\n                for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {\n                  const row = rows[rowIndex];\n\n                  // \n                  for (let colIndex = 0; colIndex < row.length; colIndex++) {\n                    const columnName = headers[colIndex];\n\n                    // \n                    if (scope.type === 'column') {\n                      if (!scope.columnNames?.includes(columnName)) continue;\n                    }\n\n                    // \n                    const result = this.applyToValue(row[colIndex], rule);\n                    if (result.success) {\n                      if (result.matched) {\n                        row[colIndex] = result.newValue;\n                        totalApplied++;\n                      }\n                    } else {\n                      errors.push(`${rule.name} [${tableName}]: ${result.error}`);\n                    }\n                  }\n                }\n              } else {\n                //  content  content[1] \n                const content = sheet.content;\n                for (let contentRowIndex = 1; contentRowIndex < content.length; contentRowIndex++) {\n                  const row = content[contentRowIndex];\n                  if (!Array.isArray(row)) continue;\n\n                  // \n                  for (let colIndex = 0; colIndex < row.length; colIndex++) {\n                    const columnName = headers[colIndex];\n\n                    // \n                    if (scope.type === 'column') {\n                      if (!scope.columnNames?.includes(columnName)) continue;\n                    }\n\n                    // \n                    const oldValue = row[colIndex];\n                    const result = this.applyToValue(oldValue, rule);\n\n                    if (result.success) {\n                      if (result.matched) {\n                        row[colIndex] = result.newValue;\n                        totalApplied++;\n                        console.debug(\n                          `[DICE]: ${tableName}[${contentRowIndex}].${columnName}`,\n                          `\"${result.oldValue}\" -> \"${result.newValue}\"`,\n                        );\n                      }\n                    } else {\n                      errors.push(`${rule.name} [${tableName}]: ${result.error}`);\n                    }\n                  }\n                }\n              }\n            } catch (tableError) {\n              const errorMsg = tableError instanceof Error ? tableError.message : String(tableError);\n              console.error(`[DICE]applyToTable:  ${tableName} :`, tableError);\n              errors.push(`${rule.name} [${tableName}]:  - ${errorMsg}`);\n            }\n          }\n        }\n\n        if (totalApplied > 0) {\n          console.info(`[DICE]applyToTable:  ${totalApplied} `);\n        }\n        if (errors.length > 0) {\n          console.warn(`[DICE]applyToTable:  ${errors.length} `);\n        }\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : String(e);\n        console.error('[DICE]applyToTable: :', e);\n        errors.push(`: ${errorMsg}`);\n      }\n\n      return { totalApplied, errors };\n    },\n\n    // \n    applyToCell(\n      value: string,\n      tableName: string,\n      columnName: string,\n      executeMode?: RegexExecutionMode,\n    ): RegexTransformResult {\n      // \n      const rules = RegexTransformationManager.getApplicableRules(tableName, columnName);\n\n      // ,\n      if (rules.length === 0) {\n        return {\n          success: true,\n          oldValue: value || '',\n          newValue: value || '',\n          matched: false,\n        };\n      }\n\n      // \n      let applicableRules = rules;\n      if (executeMode) {\n        applicableRules = rules.filter(r => r.executeMode === executeMode || r.executeMode === 'auto');\n      }\n\n      if (applicableRules.length === 0) {\n        return {\n          success: true,\n          oldValue: value || '',\n          newValue: value || '',\n          matched: false,\n        };\n      }\n\n      // \n      let currentValue = value || '';\n      let wasMatched = false;\n\n      for (const rule of applicableRules) {\n        const result = this.applyToValue(currentValue, rule);\n        if (!result.success) {\n          return result;\n        }\n        if (result.matched) {\n          wasMatched = true;\n        }\n        currentValue = result.newValue;\n      }\n\n      return {\n        success: true,\n        oldValue: value || '',\n        newValue: currentValue,\n        matched: wasMatched,\n      };\n    },\n\n    // \n    applyToRow(row: string[], headers: string[], tableName: string, executeMode?: RegexExecutionMode): string[] {\n      return row.map((cell, index) => {\n        const columnName = headers[index];\n        const result = this.applyToCell(cell, tableName, columnName, executeMode);\n        return result.newValue;\n      });\n    },\n\n    // \n    previewBatchTransform(\n      tableData: { name: string; headers: string[]; rows: string[][] },\n      executeMode?: RegexExecutionMode,\n    ): RegexPreviewResult[] {\n      const tableName = tableData.name;\n      const rules = RegexTransformationManager.getApplicableRules(tableName, null).filter(\n        r => r.scope.type === 'global' || r.scope.tableNames?.includes(tableName),\n      );\n\n      const results: RegexPreviewResult[] = [];\n\n      for (const rule of rules) {\n        const affectedCells: RegexPreviewResult['affectedCells'] = [];\n        let totalAffected = 0;\n\n        for (let rowIndex = 0; rowIndex < tableData.rows.length; rowIndex++) {\n          const row = tableData.rows[rowIndex];\n          for (let colIndex = 0; colIndex < row.length; colIndex++) {\n            const columnName = tableData.headers[colIndex];\n            const value = row[colIndex];\n\n            // \n            if (rule.scope.type === 'column') {\n              if (!rule.scope.columnNames?.includes(columnName) || !rule.scope.tableNames?.includes(tableName)) {\n                continue;\n              }\n            } else if (rule.scope.type === 'table') {\n              if (!rule.scope.tableNames?.includes(tableName)) {\n                continue;\n              }\n            }\n\n            const result = this.applyToValue(value, rule);\n            if (result.matched && result.oldValue !== result.newValue) {\n              affectedCells.push({\n                tableName,\n                rowIndex,\n                columnIndex: colIndex,\n                columnName,\n                oldValue: result.oldValue,\n                newValue: result.newValue,\n              });\n              totalAffected++;\n            }\n          }\n        }\n\n        if (totalAffected > 0) {\n          results.push({\n            rule,\n            affectedCells,\n            totalAffected,\n          });\n        }\n      }\n\n      return results;\n    },\n\n    // \n    clearRegexCache() {\n      this._regexCache.clear();\n    },\n  };\n\n  // ========================================\n  // ValidationEngine - \n  // ========================================\n  const ValidationEngine = {\n    // \n    validateFormat(value, pattern) {\n      if (value === null || value === undefined || value === '') return true; // \n      try {\n        const regex = new RegExp(pattern);\n        return regex.test(String(value));\n      } catch (e) {\n        console.error('[DICE]ValidationEngine :', pattern, e);\n        return true; // \n      }\n    },\n\n    // \n    validateEnum(value, allowedValues) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!Array.isArray(allowedValues) || allowedValues.length === 0) return true;\n      return allowedValues.includes(String(value));\n    },\n\n    // \n    validateNumeric(value, min, max) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      //  \"50/100\"  \":80\" \n      const strVal = String(value);\n      let numVal;\n\n      //  \"50%\"\n      if (strVal.endsWith('%')) {\n        numVal = parseFloat(strVal);\n      }\n      //  \"50/100\"\n      else if (strVal.includes('/')) {\n        const parts = strVal.split('/');\n        numVal = parseFloat(parts[0]);\n      }\n      //  \":\" \n      else if (strVal.includes(':')) {\n        const parts = strVal.split(':');\n        numVal = parseFloat(parts[parts.length - 1]);\n      }\n      // \n      else {\n        numVal = parseFloat(strVal);\n      }\n\n      if (isNaN(numVal)) return false; // \n\n      if (min !== undefined && min !== null && numVal < min) return false;\n      if (max !== undefined && max !== null && numVal > max) return false;\n      return true;\n    },\n\n    //  OR \n    validateRelation(value, rawData, refTable, refColumn) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!rawData || !refTable || !refColumn) return true;\n\n      // \n      let refSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === refTable) {\n          refSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!refSheet || !refSheet.content || refSheet.content.length < 2) {\n        return true; // \n      }\n\n      const headers = refSheet.content[0];\n      const strVal = String(value);\n\n      //  refColumn \n      const columns = Array.isArray(refColumn) ? refColumn : [refColumn];\n\n      for (const col of columns) {\n        const refColIndex = headers.indexOf(col);\n        if (refColIndex === -1) continue; // \n\n        // \n        for (let i = 1; i < refSheet.content.length; i++) {\n          if (String(refSheet.content[i][refColIndex] || '') === strVal) {\n            return true; // \n          }\n        }\n      }\n\n      return columns.length === 0; //  true false\n    },\n\n    // \n    validateRequired(value) {\n      return value !== null && value !== undefined && String(value).trim() !== '';\n    },\n\n    // \n    validateKeyValue(value, ruleConfig) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      const valueType = ruleConfig?.valueType || 'text';\n      const valueMin = ruleConfig?.valueMin;\n      const valueMax = ruleConfig?.valueMax;\n\n      // \n      let processedValue = String(value);\n\n      // \n      processedValue = processedValue\n        .replace(//g, ':') //   \n        .replace(//g, ';') //   \n        .replace(//g, ';'); //   \n\n      // \n      processedValue = processedValue.replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n\n      if (pairs.length === 0) return false; // \n\n      // \n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          return false; // /\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) return false; // \n\n        // \n        if (valueType === 'numeric') {\n          // \n          if (!/^-?\\d+(\\.\\d+)?$/.test(val.trim())) return false; // \n\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) return false; // \n\n          if (valueMin !== undefined && valueMin !== null && numVal < valueMin) return false;\n          if (valueMax !== undefined && valueMax !== null && numVal > valueMax) return false;\n        }\n        // \n      }\n\n      return true;\n    },\n\n    // \n    validateTableReadonly(oldContent, newContent) {\n      if (!oldContent || !newContent) return true;\n      return JSON.stringify(oldContent) === JSON.stringify(newContent);\n    },\n\n    // \n    validateRowLimit(rowCount, min, max) {\n      if (min !== undefined && min !== null && rowCount < min) return false;\n      if (max !== undefined && max !== null && rowCount > max) return false;\n      return true;\n    },\n\n    // \n    validateSequence(sheet, columnName, config) {\n      if (!sheet || !sheet.content || sheet.content.length < 2) return true; // \n      if (!columnName || !config) return true;\n\n      const headers = sheet.content[0] || [];\n      const rows = sheet.content.slice(1) || [];\n      const colIndex = headers.indexOf(columnName);\n      if (colIndex < 0) return true; // \n\n      const prefix = config.prefix || '';\n      const startFrom = config.startFrom !== undefined ? config.startFrom : 1;\n\n      // \n      const numbers = [];\n      const allRowValues = []; // \n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        allRowValues.push({ rowIndex: i, rawValue: value, type: typeof value });\n        if (value === null || value === undefined || value === '') continue;\n\n        const strValue = String(value).trim();\n        if (!strValue) continue;\n\n        // +\n        if (prefix) {\n          const regex = new RegExp(`^${prefix}(\\\\d+)$`);\n          const match = strValue.match(regex);\n          if (match) {\n            const num = parseInt(match[1], 10);\n            if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n          }\n        } else {\n          // \n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n        }\n      }\n\n      if (numbers.length === 0) return true; // \n\n      // \n      numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n      // \n      const numSet = new Set(numbers.map(n => n.num));\n      if (numSet.size !== numbers.length) {\n        return false; // \n      }\n\n      // startFrom\n      // startFromstartFrom+1\n      for (let i = 0; i < numbers.length; i++) {\n        const expectedNum = startFrom + i;\n        const actualNum = numbers[i].num;\n        if (actualNum !== expectedNum) {\n          return false; // startFrom\n        }\n      }\n\n      return true;\n    },\n\n    //  intercept \n    checkTableRules(snapshot, newData, rules) {\n      const violations = [];\n      if (!snapshot || !newData || !rules) return violations;\n\n      for (const rule of rules) {\n        // \n        if (!rule.enabled || !rule.intercept) continue;\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n        if (!typeInfo) continue;\n\n        // \n        let oldSheet = null,\n          newSheet = null;\n        for (const sheetId in snapshot) {\n          if (snapshot[sheetId]?.name === rule.targetTable) {\n            oldSheet = snapshot[sheetId];\n            break;\n          }\n        }\n        for (const sheetId in newData) {\n          if (newData[sheetId]?.name === rule.targetTable) {\n            newSheet = newData[sheetId];\n            break;\n          }\n        }\n\n        if (!newSheet) continue;\n\n        // \n        if (typeInfo.scope === 'table') {\n          if (rule.ruleType === 'tableReadonly') {\n            if (!this.validateTableReadonly(oldSheet?.content, newSheet?.content)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message: rule.errorMessage || ` \"${rule.targetTable}\" `,\n              });\n            }\n          } else if (rule.ruleType === 'rowLimit') {\n            const rowCount = (newSheet.content?.length || 1) - 1; // \n            if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetTable}\"  ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n              });\n            }\n          } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n            // \n            if (!this.validateSequence(newSheet, rule.targetColumn, rule.config || {})) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(4, '0')}`,\n              });\n            }\n          }\n        }\n        // \n        else if (typeInfo.scope === 'field' && rule.targetColumn) {\n          const headers = newSheet.content?.[0] || [];\n          const colIndex = headers.indexOf(rule.targetColumn);\n          if (colIndex === -1) continue;\n\n          // \n          for (let rowIdx = 1; rowIdx < (newSheet.content?.length || 0); rowIdx++) {\n            const row = newSheet.content[rowIdx];\n            const value = row?.[colIndex];\n            const isValid = this.validateValue(value, rule, newData);\n\n            if (!isValid) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                rowIndex: rowIdx,\n                columnName: rule.targetColumn,\n                currentValue: String(value ?? ''),\n                message: rule.errorMessage || ` \"${rule.targetColumn}\" `,\n              });\n              // \n              break;\n            }\n          }\n        }\n      }\n      return violations;\n    },\n\n    // \n    validateValue(value, rule, rawData) {\n      switch (rule.ruleType) {\n        case 'format':\n          return this.validateFormat(value, rule.config?.pattern);\n        case 'enum':\n          return this.validateEnum(value, rule.config?.values);\n        case 'numeric':\n          return this.validateNumeric(value, rule.config?.min, rule.config?.max);\n        case 'relation':\n          return this.validateRelation(value, rawData, rule.config?.refTable, rule.config?.refColumn);\n        case 'required':\n          return this.validateRequired(value);\n        case 'keyValue':\n          return this.validateKeyValue(value, rule.config);\n        default:\n          return true;\n      }\n    },\n\n    // \n    validateRow(row, headers, tableName, rowIndex, rules, rawData) {\n      const errors = [];\n      // \n      const rowTitle = row[1] || row[0] || ` ${rowIndex + 1}`;\n\n      for (const rule of rules) {\n        if (rule.targetTable !== tableName) continue;\n        if (!rule.enabled) continue;\n\n        // \n        const colIndex = headers.indexOf(rule.targetColumn);\n        if (colIndex === -1) continue;\n\n        const value = row[colIndex];\n        const isValid = this.validateValue(value, rule, rawData);\n\n        if (!isValid) {\n          errors.push({\n            ruleId: rule.id,\n            ruleName: rule.name,\n            ruleType: rule.ruleType,\n            rule: rule, // \n            tableName: tableName,\n            rowIndex: rowIndex,\n            columnName: rule.targetColumn,\n            currentValue: String(value ?? ''),\n            rowTitle: rowTitle, // \n            errorMessage: rule.errorMessage,\n            severity: 'error',\n          });\n        }\n      }\n\n      return errors;\n    },\n\n    // \n    validateAllData(rawData) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getEnabledRules();\n      if (rules.length === 0) return [];\n\n      const allErrors = [];\n\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const sheet = rawData[sheetId];\n        if (!sheet?.name || !sheet?.content || sheet.content.length < 2) continue;\n\n        const tableName = sheet.name;\n        const headers = sheet.content[0];\n        const tableRules = rules.filter(r => r.targetTable === tableName);\n\n        if (tableRules.length === 0) continue;\n\n        // \n        for (const rule of tableRules) {\n          const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n          if (typeInfo?.scope === 'table') {\n            if (rule.ruleType === 'rowLimit') {\n              const rowCount = sheet.content.length - 1;\n              if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n                allErrors.push({\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: '',\n                  currentValue: `${rowCount} `,\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n                  severity: 'warning',\n                });\n              }\n            } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n              // \n              const isValid = this.validateSequence(sheet, rule.targetColumn, rule.config || {});\n              if (!isValid) {\n                const error = {\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: rule.targetColumn,\n                  currentValue: '',\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(4, '0')}`,\n                  severity: 'error',\n                };\n                allErrors.push(error);\n              }\n            }\n            // tableReadonly \n          }\n        }\n\n        // \n        const fieldRules = tableRules.filter(r => RULE_TYPE_INFO[r.ruleType]?.scope !== 'table');\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          const rowErrors = this.validateRow(row, headers, tableName, i - 1, fieldRules, rawData);\n          allErrors.push(...rowErrors);\n        }\n      }\n\n      return allErrors;\n    },\n\n    // \n    validateTable(rawData, tableName) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getRulesByTable(tableName);\n      if (rules.length === 0) return [];\n\n      // \n      let targetSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n        return [];\n      }\n\n      const headers = targetSheet.content[0];\n      const allErrors = [];\n\n      for (let i = 1; i < targetSheet.content.length; i++) {\n        const row = targetSheet.content[i];\n        const rowErrors = this.validateRow(row, headers, tableName, i - 1, rules, rawData);\n        allErrors.push(...rowErrors);\n      }\n\n      return allErrors;\n    },\n\n    // \n    groupErrorsByTable(errors) {\n      const grouped = {};\n      for (const error of errors) {\n        if (!grouped[error.tableName]) {\n          grouped[error.tableName] = [];\n        }\n        grouped[error.tableName].push(error);\n      }\n      return grouped;\n    },\n\n    // \n    getErrorCount(rawData) {\n      return this.validateAllData(rawData).length;\n    },\n  };\n\n  // ========================================\n  // LocalAvatarDB -  IndexedDB \n  // ========================================\n  const LocalAvatarDB = {\n    DB_NAME: 'acu_local_avatars',\n    STORE_NAME: 'avatars',\n    DB_VERSION: 1,\n    _db: null,\n    _urlCache: new Map(), //  ObjectURL \n\n    // \n    async init() {\n      if (this._db) return this._db;\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n        request.onerror = () => {\n          console.error('[DICE]LocalAvatarDB :', request.error);\n          reject(request.error);\n        };\n\n        request.onsuccess = () => {\n          this._db = request.result;\n          resolve(this._db);\n        };\n\n        request.onupgradeneeded = event => {\n          const db = event.target.result;\n          if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n            // \n            db.createObjectStore(this.STORE_NAME, { keyPath: 'name' });\n          }\n        };\n      });\n    },\n\n    //  name \n    async save(name, blob) {\n      if (!name || !blob) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          //  ObjectURL \n          if (this._urlCache.has(name)) {\n            URL.revokeObjectURL(this._urlCache.get(name));\n            this._urlCache.delete(name);\n          }\n\n          const data = {\n            name: name,\n            blob: blob,\n            size: blob.size,\n            type: blob.type,\n            updatedAt: Date.now(),\n          };\n\n          const request = store.put(data);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]LocalAvatarDB :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB save error:', e);\n        return false;\n      }\n    },\n\n    //  URL ObjectURL\n    async get(name) {\n      if (!name) return null;\n\n      // \n      if (this._urlCache.has(name)) {\n        return this._urlCache.get(name);\n      }\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.get(name);\n\n          request.onsuccess = () => {\n            const data = request.result;\n            if (data && data.blob) {\n              const url = URL.createObjectURL(data.blob);\n              this._urlCache.set(name, url);\n              resolve(url);\n            } else {\n              resolve(null);\n            }\n          };\n\n          request.onerror = () => resolve(null);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB get error:', e);\n        return null;\n      }\n    },\n\n    // \n    async has(name) {\n      if (!name) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getKey(name);\n\n          request.onsuccess = () => resolve(request.result !== undefined);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        return false;\n      }\n    },\n\n    // \n    async delete(name) {\n      if (!name) return false;\n\n      try {\n        //  ObjectURL \n        if (this._urlCache.has(name)) {\n          URL.revokeObjectURL(this._urlCache.get(name));\n          this._urlCache.delete(name);\n        }\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.delete(name);\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB delete error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAllNames() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAllKeys();\n\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => resolve([]);\n        });\n      } catch (e) {\n        return [];\n      }\n    },\n\n    // \n    async getStats() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAll();\n\n          request.onsuccess = () => {\n            const items = request.result || [];\n            const totalSize = items.reduce((sum, item) => sum + (item.size || 0), 0);\n            resolve({\n              count: items.length,\n              totalSize: totalSize,\n              totalSizeMB: (totalSize / 1024 / 1024).toFixed(2),\n            });\n          };\n\n          request.onerror = () => resolve({ count: 0, totalSize: 0, totalSizeMB: '0' });\n        });\n      } catch (e) {\n        return { count: 0, totalSize: 0, totalSizeMB: '0' };\n      }\n    },\n\n    // \n    async clearAll() {\n      try {\n        //  ObjectURL \n        this._urlCache.forEach(url => URL.revokeObjectURL(url));\n        this._urlCache.clear();\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.clear();\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB clearAll error:', e);\n        return false;\n      }\n    },\n  };\n\n  // []  SillyTavern  URL\n  const getUserAvatarUrl = () => {\n    try {\n      // 1:  DOM \n      const w = window.parent || window;\n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        // SillyTavern  #user_avatar_block img  .avatar[title=\"You\"] img\n        const $avatar = $('#user_avatar_block img').first();\n        if ($avatar.length && $avatar.attr('src')) {\n          return $avatar.attr('src');\n        }\n        // \n        const $userMes = $('.mes[is_user=\"true\"]').last().find('.avatar img');\n        if ($userMes.length && $userMes.attr('src')) {\n          return $userMes.attr('src');\n        }\n      }\n      // 2:  SillyTavern API \n      const ST = w.SillyTavern || window.SillyTavern;\n      if (ST && ST.getContext) {\n        const ctx = ST.getContext();\n        if (ctx && ctx.userAvatar) {\n          return ctx.userAvatar;\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getUserAvatarUrl error:', e);\n    }\n    return null;\n  };\n\n  // [] \n  const getPlayerName = () => {\n    const rawData = cachedRawData || (typeof getTableData === 'function' ? getTableData() : null);\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]?.[1]) {\n          return sheet.content[1][1];\n        }\n      }\n    }\n    return null;\n  };\n\n  // []  SillyTavern Persona \n  const getPersonaName = () => {\n    try {\n      // 1: SillyTavern  API\n      const w = window.parent || window;\n      if (w.SillyTavern?.getContext) {\n        const ctx = w.SillyTavern.getContext();\n        if (ctx?.name1) return ctx.name1;\n      }\n      // 2: \n      if (typeof name1 !== 'undefined' && name1) return name1;\n      if (w.name1) return w.name1;\n      // 3:  DOM \n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        const $persona = $('#user_avatar_block .avatar-name, #persona_name_input').first();\n        if ($persona.length) {\n          const name = $persona.val?.() || $persona.text?.();\n          if (name && name.trim()) return name.trim();\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getPersonaName error:', e);\n    }\n    return null;\n  };\n\n  // []  Persona\n  const getDisplayPlayerName = () => {\n    return getPersonaName() || getPlayerName() || '';\n  };\n\n  // []  Persona \n  const replaceUserPlaceholders = text => {\n    if (!text || typeof text !== 'string') return text;\n    const displayName = getDisplayPlayerName();\n    //  <user>{{user}}\n    let result = text.replace(/<user>/gi, displayName);\n    result = result.replace(/\\{\\{user\\}\\}/gi, displayName);\n    return result;\n  };\n  // \n  const AvatarManager = {\n    _cache: null,\n\n    load() {\n      if (!this._cache) {\n        const raw = Store.get(STORAGE_KEY_AVATAR_MAP, {});\n        this._cache = {};\n        for (const name in raw) {\n          if (typeof raw[name] === 'string') {\n            this._cache[name] = { url: raw[name], offsetX: 50, offsetY: 50, scale: 150, aliases: [] };\n          } else {\n            this._cache[name] = {\n              url: raw[name].url || '',\n              offsetX: raw[name].offsetX ?? 50,\n              offsetY: raw[name].offsetY ?? 50,\n              scale: raw[name].scale ?? 150,\n              aliases: raw[name].aliases || [],\n            };\n          }\n        }\n      }\n      return this._cache;\n    },\n\n    save() {\n      Store.set(STORAGE_KEY_AVATAR_MAP, this._cache || {});\n      this._cache = null;\n    },\n\n    //  URL  ST \n    get(name) {\n      const data = this.load()[name];\n      if (data && data.url) return data.url;\n\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          if (this._cache[key].url) return this._cache[key].url;\n        }\n      }\n\n      return null;\n    },\n\n    //  > URL > ST\n    async getAsync(name) {\n      if (!name) return null;\n\n      // \n      const playerName = getPlayerName();\n      const isPlayer = name === '<user>' || name === '' || (playerName && name === playerName);\n\n      // 1.  IndexedDB\n      const localUrl = await LocalAvatarDB.get(name);\n      if (localUrl) return localUrl;\n\n      // 2.  <user> \n      if (isPlayer && name !== '<user>') {\n        const userLocalUrl = await LocalAvatarDB.get('<user>');\n        if (userLocalUrl) return userLocalUrl;\n      }\n\n      // 3. \n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        const aliasLocalUrl = await LocalAvatarDB.get(primaryName);\n        if (aliasLocalUrl) return aliasLocalUrl;\n      }\n\n      // 4. URL / ST\n      return this.get(name);\n    },\n\n    // \n    async hasLocalAvatar(name) {\n      if (!name) return false;\n      const has = await LocalAvatarDB.has(name);\n      if (has) return true;\n\n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        return await LocalAvatarDB.has(primaryName);\n      }\n      return false;\n    },\n\n    // \n    async saveLocalAvatar(name, blob) {\n      return await LocalAvatarDB.save(name, blob);\n    },\n\n    // \n    async deleteLocalAvatar(name) {\n      return await LocalAvatarDB.delete(name);\n    },\n\n    getOffsetX(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetX ?? 50) : 50;\n    },\n\n    getOffsetY(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetY ?? 50) : 50;\n    },\n\n    getScale(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.scale ?? 150) : 150;\n    },\n\n    // \n    _resolveByAlias(name) {\n      const data = this.load()[name];\n      if (data) return data;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return this._cache[key];\n        }\n      }\n      return null;\n    },\n\n    // \n    getPrimaryName(name) {\n      if (this.load()[name]) return name;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return key;\n        }\n      }\n      return name;\n    },\n\n    set(name, url, offsetX = 50, offsetY = 50, scale = 150, aliases = []) {\n      this.load()[name] = { url, offsetX, offsetY, scale, aliases };\n      this.save();\n    },\n\n    setPosition(name, offsetX, offsetY) {\n      const data = this.load()[name];\n      if (data) {\n        data.offsetX = offsetX;\n        data.offsetY = offsetY;\n        this.save();\n      }\n    },\n\n    setScale(name, scale) {\n      const data = this.load()[name];\n      if (data) {\n        data.scale = scale;\n        this.save();\n      }\n    },\n\n    setAliases(name, aliases) {\n      const data = this.load()[name];\n      if (data) {\n        data.aliases = aliases;\n        this.save();\n      }\n    },\n\n    remove(name) {\n      delete this.load()[name];\n      this.save();\n    },\n\n    getAll() {\n      return this.load();\n    },\n\n    // JSON\n    exportData() {\n      return {\n        version: 1,\n        exportTime: new Date().toISOString(),\n        avatars: this.load(),\n      };\n    },\n\n    // \n    importData(jsonData, overwriteConflicts = true) {\n      if (!jsonData || !jsonData.avatars) {\n        throw new Error('');\n      }\n\n      const current = this.load();\n      const stats = { added: 0, updated: 0, skipped: 0 };\n\n      for (const name in jsonData.avatars) {\n        const imported = jsonData.avatars[name];\n        if (!imported.url) continue;\n\n        if (current[name]) {\n          // \n          if (overwriteConflicts) {\n            current[name] = {\n              url: imported.url,\n              offsetX: imported.offsetX ?? 50,\n              offsetY: imported.offsetY ?? 50,\n              scale: imported.scale ?? 150,\n              aliases: imported.aliases || [],\n            };\n            stats.updated++;\n          } else {\n            stats.skipped++;\n          }\n        } else {\n          // \n          current[name] = {\n            url: imported.url,\n            offsetX: imported.offsetX ?? 50,\n            offsetY: imported.offsetY ?? 50,\n            scale: imported.scale ?? 150,\n            aliases: imported.aliases || [],\n          };\n          stats.added++;\n        }\n      }\n\n      this.save();\n      return stats;\n    },\n\n    // \n    analyzeImport(jsonData) {\n      if (!jsonData || !jsonData.avatars) {\n        return { valid: false, error: '' };\n      }\n\n      const current = this.load();\n      const result = { valid: true, total: 0, newItems: [], conflicts: [] };\n\n      for (const name in jsonData.avatars) {\n        if (!jsonData.avatars[name].url) continue;\n        result.total++;\n        if (current[name]) {\n          result.conflicts.push(name);\n        } else {\n          result.newItems.push(name);\n        }\n      }\n\n      return result;\n    },\n  };\n\n  const getLocationEmoji = name => {\n    if (!name) return null;\n    for (const [pattern, emoji] of LOCATION_EMOJI_MAP) {\n      if (pattern.test(name)) return emoji;\n    }\n    return null;\n  };\n\n  const getElementEmoji = (name, type) => {\n    if (!name && !type) return null;\n    for (const [pattern, emoji] of ELEMENT_EMOJI_MAP) {\n      if (name && pattern.test(name)) return emoji;\n    }\n    for (const [pattern, emoji] of ELEMENT_EMOJI_MAP) {\n      if (type && pattern.test(type)) return emoji;\n    }\n    return null;\n  };\n\n  // ========================================\n  // MVU  v2.0\n  //  -  UI\n  // ========================================\n  const MvuModule = (function () {\n    'use strict';\n\n    // [] MVU  - \n    function parseMvuPathForDice(path, value) {\n      try {\n        if (!path || typeof path !== 'string') {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        //  . \n        const parts = path.split('.').filter(p => p && p.trim());\n\n        if (parts.length === 0) {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        // \n        const blacklist = [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          'stat_data',\n          'delta_data',\n        ];\n\n        // \n        const filteredParts = parts.filter(p => !blacklist.includes(p));\n\n        // \n        let initiator = null;\n        if (filteredParts.length >= 2) {\n          // \n          initiator = filteredParts[filteredParts.length - 2];\n        } else if (filteredParts.length === 1) {\n          // \n          initiator = filteredParts[0];\n        }\n\n        // \n        let attrName = null;\n        if (filteredParts.length > 0) {\n          attrName = filteredParts[filteredParts.length - 1];\n        } else if (parts.length > 0) {\n          // \n          attrName = parts[parts.length - 1];\n        }\n\n        // \n        const candidates = filteredParts.length > 0 ? filteredParts : parts.slice(-1);\n\n        return {\n          initiator: initiator || null,\n          attrName: attrName || null,\n          candidates: candidates,\n        };\n      } catch (e) {\n        console.warn('[DICE]parseMvuPathForDice ', e);\n        return { initiator: null, attrName: null, candidates: [] };\n      }\n    }\n\n    // =====  =====\n    const MODULE_ID = '__mvu__';\n    let cachedEraData = null; //  ERA \n\n    // =====  =====\n    function detectMode() {\n      // \n      if (cachedEraData && cachedEraData._source) {\n        return cachedEraData._source;\n      }\n\n      //  ERA ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n\n      if (typeof eventEmit === 'function' && typeof eventOn === 'function') {\n        console.log('[DICE]MvuModule  ERA ');\n        return 'era';\n      }\n\n      //  MVU\n      if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n        console.log('[DICE]MvuModule  MVU ');\n        return 'mvu';\n      }\n\n      //  MVU\n      console.log('[DICE]MvuModule  MVU ');\n      return 'mvu';\n    }\n\n    // ===== =====\n    async function detectModeWithData() {\n      // 1.  ERA ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n\n      if (typeof eventEmit === 'function' && typeof eventOn === 'function') {\n        try {\n          //  ERA \n          const eraData = await Promise.race([\n            getEraData(),\n            new Promise((_, reject) => setTimeout(() => reject(new Error('ERA timeout')), 2000)),\n          ]);\n\n          if (eraData && eraData.stat_data) {\n            console.log('[DICE] ERA ');\n            return { mode: 'era', data: eraData };\n          }\n        } catch (e) {\n          console.warn('[DICE]ERA :', e.message);\n        }\n      }\n\n      // 2.  MVU\n      try {\n        await waitGlobalInitialized('Mvu');\n\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (mvuData && mvuData.stat_data) {\n            console.log('[DICE] MVU ');\n            return {\n              mode: 'mvu',\n              data: {\n                stat_data: mvuData.stat_data || null,\n                display_data: mvuData.display_data || {},\n                delta_data: mvuData.delta_data || {},\n                schema: mvuData.schema || null,\n                _source: 'mvu', // \n              },\n            };\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MVU :', e);\n      }\n\n      // 3.  MVU \n      console.warn('[DICE] MVU ');\n      return { mode: 'mvu', data: null };\n    }\n\n    // ===== ERA  =====\n    // ERA\n    async function getEraData() {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(null);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onResult = detail => {\n          clearTimeout(timeoutId);\n          //  eventOff \n          if (typeof eventOff === 'function') {\n            try {\n              eventOff('era:queryResult', onResult);\n            } catch (e) {\n              console.warn('[DICE]MvuModule :', e);\n            }\n          }\n\n          console.log('[DICE]MvuModule ERA:', JSON.stringify(detail, null, 2));\n          console.log('[DICE]MvuModule detail.result:', JSON.stringify(detail.result, null, 2));\n\n          if (detail.result && detail.result.error) {\n            console.error('[DICE]MvuModule ERA:', detail.result.error);\n            resolve(null);\n            return;\n          }\n\n          const statData = detail.result?.statWithoutMeta || null;\n          console.log('[DICE]MvuModule  stat_data:', JSON.stringify(statData, null, 2));\n\n          const result = {\n            stat_data: statData,\n            delta_data: {},\n            schema: null,\n            _source: 'era', // \n          };\n\n          // \n          cachedEraData = result;\n\n          resolve(result);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA...');\n          console.log('[DICE]MvuModule ERA API :', {\n            eventEmit: typeof eventEmit === 'function',\n            eventOn: typeof eventOn === 'function',\n            eventOff: typeof eventOff === 'function',\n          });\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n\n          eventOn('era:queryResult', onResult);\n          eventEmit('era:getCurrentVars');\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(null);\n        }\n      });\n    }\n\n    // ERA \n    async function setEraValue(path, newValue) {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(false);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onWriteDone = detail => {\n          clearTimeout(timeoutId);\n          if (typeof eventOff === 'function') {\n            eventOff('era:writeDone', onWriteDone);\n          }\n          console.log('[DICE]MvuModule ERA');\n          resolve(true);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA:', path, newValue);\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n\n          eventOn('era:writeDone', onWriteDone);\n          eventEmit('era:updateByPath', {\n            path: path,\n            value: newValue,\n          });\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(false);\n        }\n      });\n    }\n\n    // =====  =====\n    const STYLES = `\n            /* MVU  */\n            .acu-mvu-panel {\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n                min-height: 300px; /*  */\n                overflow: hidden; /*  */\n            }\n            .acu-mvu-panel .acu-panel-header {\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                padding: 10px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                flex-shrink: 0;\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title i {\n                color: var(--acu-accent);\n            }\n            .acu-mvu-panel .acu-header-actions {\n                display: flex;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                padding: 5px 10px;\n                font-size: 13px;\n                border-radius: 4px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn:hover {\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent);\n            }\n            .acu-mvu-panel .mvu-header-btn.active {\n                background: var(--acu-accent);\n                color: #fff;\n                border-color: var(--acu-accent);\n            }\n            /* []  */\n            .mvu-numeric-mode {\n                padding: 0;\n            }\n            .mvu-numeric-level-controls {\n                position: sticky;\n                top: 0;\n                z-index: 10;\n            }\n            /* []  */\n            .mvu-level-controls-collapsible {\n                margin-bottom: 8px;\n            }\n            .mvu-level-controls-header {\n                transition: background 0.2s;\n            }\n            .mvu-level-controls-header:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-level-controls-body {\n                overflow-y: auto;\n                overflow-x: hidden;\n                transition: max-height 0.3s ease-out, padding-top 0.3s ease-out, padding-bottom 0.3s ease-out, border-bottom 0.3s ease-out;\n                max-height: 300px; /*  */\n                scrollbar-width: thin;\n            }\n            /*  */\n            @media (max-width: 768px) {\n                .mvu-level-controls-body {\n                    max-height: 200px;\n                }\n            }\n            .mvu-level-controls-body::-webkit-scrollbar {\n                width: 6px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-track {\n                background: transparent;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb {\n                background: var(--acu-border);\n                border-radius: 3px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb:hover {\n                background: var(--acu-text-sub);\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-body {\n                max-height: 0 !important;\n                padding-top: 0 !important;\n                padding-bottom: 0 !important;\n                border-bottom: none !important;\n                margin: 0 !important;\n            }\n            .mvu-level-controls-toggle-icon {\n                transition: transform 0.3s ease-out;\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-toggle-icon {\n                transform: rotate(-90deg);\n            }\n            .mvu-numeric-items {\n                max-height: calc(100vh - 200px);\n                overflow-y: auto;\n            }\n            .mvu-numeric-item {\n                transition: background 0.2s;\n            }\n            .mvu-numeric-item:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-dice-icon {\n                transition: opacity 0.2s, transform 0.2s;\n            }\n            .mvu-dice-icon:hover {\n                opacity: 1 !important;\n                transform: scale(1.1);\n            }\n            .mvu-level-toggle:hover {\n                opacity: 1 !important;\n            }\n            .mvu-level-toggle[data-visible=\"true\"]:hover {\n                background: var(--acu-accent) !important;\n                color: #fff !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .mvu-level-toggle[data-visible=\"false\"]:hover,\n            .mvu-level-toggle[data-visible=\"\"]:hover {\n                background: var(--acu-table-hover) !important;\n                color: var(--acu-text-sub) !important;\n                border-color: var(--acu-border) !important;\n            }\n\n            /* MVU  -  */\n            .mvu-content {\n                display: flex;\n                flex-direction: column;\n                overflow-x: hidden;\n                overflow-y: auto; /*  */\n                flex: 1 1 auto;\n                min-height: 0; /*  flex  */\n                max-height: 100%; /*  */\n                padding: 12px;\n                scrollbar-width: thin;\n            }\n            .mvu-content::-webkit-scrollbar {\n                display: none;\n            }\n            .mvu-content .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 100%;\n                max-width: 100%;\n                width: 100%;\n            }\n            /* MVU */\n            .acu-mvu-panel {\n                overflow-y: auto !important;\n                overflow-x: hidden !important;\n                flex: 1 1 0; /*  flex-basis: 0  */\n                min-height: 300px; /*  */\n            }\n\n            /* MVU  */\n            .mvu-card {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 10px;\n                overflow: hidden;\n            }\n            .mvu-card:last-child {\n                margin-bottom: 0;\n            }\n            .mvu-card-header {\n                background: var(--acu-table-head);\n                padding: 8px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                cursor: pointer;\n                user-select: none;\n                transition: background 0.2s;\n            }\n            .mvu-card-header:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-card-title {\n                font-weight: 600;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            .mvu-card-count {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                font-weight: normal;\n            }\n            .mvu-card-toggle {\n                color: var(--acu-text-sub);\n                font-size: 10px;\n                transition: transform 0.2s;\n            }\n            .mvu-card.collapsed .mvu-card-toggle {\n                transform: rotate(-90deg);\n            }\n            .mvu-card-body {\n                padding: 8px 12px;\n                display: block;\n                overflow: hidden; /*  slideUp/slideDown  */\n            }\n            .mvu-card.collapsed .mvu-card-body {\n                display: none;\n            }\n\n            /*  */\n            .mvu-card .mvu-card {\n                background: var(--acu-table-head);\n                margin: 6px 0;\n            }\n            .mvu-card .mvu-card .mvu-card-header {\n                background: rgba(128,128,128,0.1);\n                padding: 6px 10px;\n            }\n            .mvu-card .mvu-card .mvu-card-body {\n                padding: 6px 10px;\n            }\n\n            /*  -  */\n            .mvu-card-body.horizontal-nested {\n                display: flex;\n                flex-direction: row;\n                flex-wrap: nowrap;\n                gap: 12px;\n                overflow-x: auto;\n                overflow-y: visible;\n                -webkit-overflow-scrolling: touch;\n                padding-bottom: 8px;\n                align-items: flex-start;\n            }\n            /*  has-nested-cards  wrap  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested {\n                flex-wrap: wrap;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-row {\n                display: flex;\n                flex: 0 0 100%;\n                width: 100%;\n                max-width: 100%; /*  */\n                box-sizing: border-box;\n            }\n            /*  has-nested-cards  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                flex: 0 0 auto; /*  */\n                min-width: 100%; /*  */\n                width: auto; /*  */\n                max-width: 450px; /*  */\n                box-sizing: border-box;\n            }\n            @media (min-width: 769px) {\n                .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                    max-width: 550px; /*  */\n                }\n            }\n            /*  -  */\n            .mvu-card-body.horizontal-nested > .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 200px;\n                max-width: 350px;\n                width: auto;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                min-width: 400px; /*  */\n                max-width: none; /*  */\n            }\n            @media (min-width: 769px) {\n                .mvu-card-body.horizontal-nested > .mvu-card {\n                    min-width: 240px;\n                    max-width: 400px;\n                }\n                .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                    min-width: 500px; /*  */\n                    max-width: none; /*  */\n                }\n            }\n\n            /*  */\n            .mvu-row {\n                display: flex;\n                align-items: flex-start;\n                padding: 5px 0;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n            .mvu-row:last-child {\n                border-bottom: none;\n            }\n            .mvu-key {\n                color: var(--acu-text-sub);\n                min-width: 80px;\n                max-width: 120px;\n                flex-shrink: 0;\n                font-size: 12px;\n                padding-right: 8px;\n                word-break: break-all;\n            }\n            .mvu-value-wrap {\n                flex: 1;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                min-width: 0;\n            }\n            .mvu-value {\n                color: var(--acu-text-main);\n                font-size: var(--acu-font-size, 13px);\n                cursor: pointer;\n                padding: 1px 6px;\n                border-radius: 4px;\n                transition: background 0.2s;\n                word-break: break-word;\n                flex: 0 1 auto;\n            }\n            .mvu-value:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-value.mvu-array-value {\n                font-size: calc(var(--acu-font-size, 13px) * 0.92);\n                color: var(--acu-text-sub);\n            }\n            .mvu-change-indicator {\n                color: var(--acu-success-text);\n                font-weight: bold;\n                font-size: 12px;\n                flex-shrink: 0;\n            }\n            .mvu-row.mvu-changed {\n                background: var(--acu-success-bg);\n                margin: 0 -12px;\n                padding: 5px 12px;\n                border-radius: 4px;\n            }\n            .mvu-card .mvu-card .mvu-row.mvu-changed {\n                margin: 0 -10px;\n                padding: 5px 10px;\n            }\n\n            /*  */\n            .mvu-empty {\n                text-align: center;\n                padding: 40px 20px;\n                color: var(--acu-text-sub);\n                flex: 1;\n                min-width: 100%;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n            }\n            .mvu-empty i {\n                font-size: 32px;\n                margin-bottom: 12px;\n                display: block;\n                opacity: 0.5;\n            }\n            .mvu-empty p {\n                margin: 0 0 6px 0;\n            }\n            .mvu-empty .mvu-empty-hint {\n                font-size: 12px;\n                opacity: 0.7;\n            }\n\n            /*  */\n            .mvu-edit-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0,0,0,0.6);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 99999;\n                animation: mvuFadeIn 0.15s ease-out;\n            }\n            .mvu-edit-dialog {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                padding: 16px;\n                width: 90%;\n                max-width: 400px;\n                animation: mvuSlideIn 0.2s ease-out;\n            }\n            .mvu-edit-title {\n                font-weight: 600;\n                color: var(--acu-text-main);\n                margin-bottom: 12px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .mvu-edit-path {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                background: var(--acu-table-head);\n                padding: 6px 10px;\n                border-radius: 4px;\n                margin-bottom: 12px;\n                word-break: break-all;\n                font-family: monospace;\n            }\n            .mvu-edit-textarea {\n                width: 100%;\n                min-height: 80px;\n                padding: 10px;\n                border: 1px solid var(--acu-border);\n                border-radius: 4px;\n                background: var(--acu-input-bg, var(--acu-bg-panel));\n                color: var(--acu-text-main);\n                font-size: 13px;\n                resize: vertical;\n                box-sizing: border-box;\n            }\n            .mvu-edit-textarea:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n            }\n            .mvu-edit-hint {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                margin-top: 8px;\n                opacity: 0.7;\n            }\n            .mvu-edit-btns {\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n                margin-top: 16px;\n            }\n            .mvu-edit-btn {\n                padding: 8px 16px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 13px;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                transition: all 0.2s;\n            }\n            .mvu-edit-btn.mvu-btn-cancel {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n            }\n            .mvu-edit-btn.mvu-btn-cancel:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-edit-btn.mvu-btn-save {\n                background: var(--acu-accent);\n                border: 1px solid var(--acu-accent);\n                color: #fff;\n            }\n            .mvu-edit-btn.mvu-btn-save:hover {\n                opacity: 0.9;\n            }\n\n            @keyframes mvuFadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes mvuSlideIn {\n                from { transform: translateY(-20px); opacity: 0; }\n                to { transform: translateY(0); opacity: 1; }\n            }\n\n            /*  */\n            .acu-nav-btn.acu-mvu-btn.active {\n                background: var(--acu-btn-active-bg);\n                color: var(--acu-btn-active-text);\n            }\n        `;\n\n    // =====  =====\n    function escapeHtml(s) {\n      return String(s ?? '')\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#039;');\n    }\n\n    function isAvailable() {\n      const mode = detectMode();\n\n      if (mode === 'era') {\n        // ERA  eventEmit  eventOn  iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const emitAvailable = typeof eventEmit === 'function';\n        const onAvailable = typeof eventOn === 'function';\n        return emitAvailable && onAvailable;\n      } else {\n        // MVU  MVU \n        const mvuAvailable = typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function';\n        return mvuAvailable;\n      }\n    }\n\n    function getData() {\n      console.warn('[DICE]: getData()  MVU  getDataWithRetry()');\n\n      //  ERA  MVU\n      if (cachedEraData) {\n        return cachedEraData;\n      }\n\n      //  MVU\n      try {\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (allVars && allVars.stat_data) {\n            const data = {\n              stat_data: allVars.stat_data || null,\n              display_data: allVars.display_data || {},\n              delta_data: allVars.delta_data || {},\n              schema: allVars.schema || null,\n              _source: 'mvu', // \n            };\n\n            cachedEraData = data; // \n            return data;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE] MVU :', e);\n      }\n\n      return null;\n    }\n\n    // ===== MVU  =====\n    async function getMvuDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // []  MVU API \n        if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n          //  MVU \n          try {\n            await Promise.race([\n              waitGlobalInitialized('Mvu'),\n              new Promise((_, reject) => setTimeout(() => reject(new Error(' MVU ')), 3000)),\n            ]);\n          } catch (e) {\n            console.warn('[DICE] MVU :', e.message);\n            //  MVU \n          }\n        }\n\n        for (let attempt = 1; attempt <= maxRetries; attempt++) {\n          try {\n            if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n              throw new Error('MVU API ');\n            }\n\n            const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n            if (allVars && allVars.stat_data) {\n              const data = {\n                stat_data: allVars.stat_data || null,\n                display_data: allVars.display_data || {},\n                delta_data: allVars.delta_data || {},\n                schema: allVars.schema || null,\n                _source: 'mvu', // \n              };\n\n              //  MVU \n              cachedEraData = data;\n              console.log('[DICE]MVU ');\n              return data;\n            }\n          } catch (e) {\n            console.warn(`[DICE]MVU  ( ${attempt}/${maxRetries}):`, e);\n          }\n\n          if (attempt < maxRetries) {\n            await new Promise(resolve => setTimeout(resolve, retryDelay));\n          }\n        }\n\n        return null;\n      } catch (e) {\n        console.error('[DICE]MVU :', e);\n        return null;\n      }\n    }\n\n    // \n    async function getDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // \n        const detection = await detectModeWithData();\n\n        // \n        if (detection.data) {\n          cachedEraData = detection.data; // \n          return detection.data;\n        }\n\n        // \n        const mode = detection.mode;\n\n        if (mode === 'era') {\n          // ERA \n          for (let attempt = 1; attempt <= maxRetries; attempt++) {\n            try {\n              const data = await getEraData();\n              if (data && data.stat_data) {\n                cachedEraData = data;\n                return data;\n              }\n            } catch (e) {\n              console.warn(`[DICE]ERA  ( ${attempt}/${maxRetries}):`, e);\n            }\n\n            if (attempt < maxRetries) {\n              await new Promise(resolve => setTimeout(resolve, retryDelay));\n            }\n          }\n\n          // ERA  MVU\n          console.warn('[DICE]ERA  MVU');\n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        } else {\n          // MVU \n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        }\n      } catch (e) {\n        console.error('[DICE]:', e);\n        return null;\n      }\n    }\n\n    //  ValueWithDescription  [, \"\"]\n    function isVWD(value) {\n      return (\n        Array.isArray(value) &&\n        value.length === 2 &&\n        typeof value[1] === 'string' &&\n        (typeof value[0] === 'number' || typeof value[0] === 'string' || typeof value[0] === 'boolean')\n      );\n    }\n\n    // \n    function isSimpleArray(value) {\n      if (!Array.isArray(value)) return false;\n      return value.every(\n        item => typeof item === 'string' || typeof item === 'number' || typeof item === 'boolean' || item === null,\n      );\n    }\n\n    // \n    function getChangeIndicator(path, deltaData) {\n      if (!deltaData || !path) return '';\n\n      const parts = path.split('.');\n      let current = deltaData;\n      for (const part of parts) {\n        if (current === null || current === undefined) return '';\n        current = current[part];\n      }\n\n      if (!current) return '';\n\n      if (typeof current === 'string' && current.includes('->')) {\n        const match = current.match(/^(-?[\\d.]+)->(-?[\\d.]+)/);\n        if (match) {\n          const oldVal = parseFloat(match[1]);\n          const newVal = parseFloat(match[2]);\n          if (!isNaN(oldVal) && !isNaN(newVal)) {\n            return newVal > oldVal ? '' : newVal < oldVal ? '' : '';\n          }\n        }\n        return '';\n      }\n      return '';\n    }\n\n    // /\n    function countChildren(value) {\n      if (Array.isArray(value)) {\n        if (isVWD(value)) return 0;\n        return value.length;\n      }\n      if (value && typeof value === 'object') {\n        return Object.keys(value).filter(k => !k.startsWith('$')).length;\n      }\n      return 0;\n    }\n\n    // =====  =====\n\n    // \n    // +++\n    function extractNumericDisplayValue(value, isArray = false) {\n      //  null/undefined\n      if (value === null || value === undefined) {\n        return '';\n      }\n\n      // \n      if (isArray || Array.isArray(value)) {\n        if (isVWD(value)) {\n          return String(value[0]);\n        } else if (isSimpleArray(value)) {\n          return value.map(v => String(v ?? '')).join(', ');\n        } else {\n          // \n          return String(value);\n        }\n      }\n\n      // \n      const str = String(value).trim();\n\n      // 1.  \"85\", \"-20\", \"100%\"\n      if (/^-?\\d+(\\.\\d+)?%?$/.test(str)) {\n        return str;\n      }\n\n      // 2. ++ \",[] \" \n      // \"0,[-20, 120] User...\"\n      const rangeMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)(,\\s*\\[[^\\]]+\\])?\\s+/);\n      if (rangeMatch) {\n        // \n        if (rangeMatch[2]) {\n          return rangeMatch[1] + rangeMatch[2].trim();\n        }\n        // \n        return rangeMatch[1];\n      }\n\n      // 2.5. /, \"/,\" \n      // \"100/100,/'/'\"\n      const slashNumericMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?\\/-?\\d+(?:\\.\\d+)?%?),/);\n      if (slashNumericMatch) {\n        return slashNumericMatch[1];\n      }\n\n      // 3. , \",\" \n      // \"150000,...\"\n      const commaDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?),/);\n      if (commaDescMatch) {\n        return commaDescMatch[1];\n      }\n\n      // 4. + \" \" \n      // \"85 \"\n      const numericDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)\\s+[^\\d]/);\n      if (numericDescMatch) {\n        return numericDescMatch[1];\n      }\n\n      // 5. \n      return str;\n    }\n\n    // \n    // \"85\" -> 85, \"85,[0,100]\" -> 85, \"0,[-20, 120]\" -> 0\n    function extractFirstNumericValue(displayValue) {\n      if (!displayValue) return 0;\n      const str = String(displayValue).trim();\n\n      // \n      const match = str.match(/^(-?\\d+(?:\\.\\d+)?)/);\n      if (match) {\n        const num = parseFloat(match[1]);\n        return isNaN(num) ? 0 : num;\n      }\n\n      return 0;\n    }\n\n    // \n    function renderRow(key, value, path, deltaData) {\n      const changeIndicator = getChangeIndicator(path, deltaData);\n      const changedClass = changeIndicator ? 'mvu-changed' : '';\n\n      let displayValue;\n      let valueClass = 'mvu-value';\n\n      if (isVWD(value)) {\n        displayValue = String(value[0]);\n      } else if (isSimpleArray(value)) {\n        displayValue = value.map(v => String(v ?? '')).join(', ');\n        valueClass += ' mvu-array-value';\n      } else {\n        // \n        displayValue = extractNumericDisplayValue(value ?? '', false);\n      }\n\n      // [] \n      let diceIconHtml = '';\n      try {\n        //  extractNumericDisplayValue \n        //  \"85,[0,100]\"  85  100\n        if (typeof isNumericCell === 'function' && isNumericCell(displayValue)) {\n          // \n          const numericValue = extractFirstNumericValue(displayValue);\n          if (numericValue > 0) {\n            //  key key \n            let attrName = key;\n            if (key.includes('.')) {\n              const parts = key.split('.');\n              attrName = parts[parts.length - 1];\n            }\n            // \n            if (path && path.includes('.')) {\n              const pathParts = path.split('.');\n              const lastPart = pathParts[pathParts.length - 1];\n              // \n              if (lastPart && !/^\\d+$/.test(lastPart) && lastPart !== key) {\n                attrName = lastPart;\n              }\n            }\n            diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon\" data-path=\"${escapeHtml(path)}\" data-attr-name=\"${escapeHtml(attrName)}\" data-attr-value=\"${numericValue}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.6;font-size:calc(var(--acu-font-size, 13px) * 0.85);flex-shrink:0;\" title=\"\"></i>`;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule renderRow: ', e);\n      }\n\n      return `\n                <div class=\"mvu-row ${changedClass}\">\n                    <div class=\"mvu-key\">${escapeHtml(key)}</div>\n                    <div class=\"mvu-value-wrap\">\n                        <span class=\"${valueClass}\" data-path=\"${escapeHtml(path)}\">${escapeHtml(displayValue)}</span>\n                        ${diceIconHtml}\n                        ${changeIndicator ? `<span class=\"mvu-change-indicator\">${changeIndicator}</span>` : ''}\n                    </div>\n                </div>\n            `;\n    }\n\n    // \n    function renderCard(key, value, path, deltaData, depth, defaultExpanded, isHorizontal) {\n      const childCount = countChildren(value);\n      const collapsedClass = defaultExpanded ? '' : 'collapsed';\n\n      let bodyHtml = '';\n      let hasNestedCards = false; // \n      let nestedCardCount = 0; // \n      let rowCount = 0; // \n\n      if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n        // \n        value.forEach((item, index) => {\n          const itemPath = `${path}[${index}]`;\n\n          if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(`[${index}]`, item, itemPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            rowCount++;\n            bodyHtml += renderRow(`[${index}]`, item, itemPath, deltaData);\n          }\n        });\n      } else if (value && typeof value === 'object' && !isVWD(value)) {\n        // \n        const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n\n        for (const [childKey, childValue] of entries) {\n          const childPath = path ? `${path}.${childKey}` : childKey;\n\n          if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n            // /  \n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(childKey, childValue, childPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            //   \n            rowCount++;\n            bodyHtml += renderRow(childKey, childValue, childPath, deltaData);\n          }\n        }\n      }\n\n      const countText = Array.isArray(value) ? `[${childCount}]` : `(${childCount})`;\n\n      //  card-body  horizontal-nested \n      const bodyClass = isHorizontal && hasNestedCards ? 'mvu-card-body horizontal-nested' : 'mvu-card-body';\n\n      // \n      let nestedCardsNeedWidth = false;\n      if (isHorizontal && hasNestedCards && depth === 0) {\n        // \n        if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n          // \n          value.forEach(item => {\n            if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n              const itemChildCount = countChildren(item);\n              if (itemChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          });\n        } else if (value && typeof value === 'object' && !isVWD(value)) {\n          // \n          const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n          for (const [childKey, childValue] of entries) {\n            if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n              const childChildCount = countChildren(childValue);\n              if (childChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          }\n        }\n      }\n\n      //  has-nested-cards \n      // \n      // depth === 0\n      //   -  >= 2  <= 1 has-nested-cards\n      //   -  has-nested-cards\n      // depth > 0rowCount === 0 >= 2  has-nested-cards\n      const shouldAddHasNestedClass =\n        isHorizontal &&\n        hasNestedCards &&\n        ((depth === 0 && ((nestedCardCount >= 2 && rowCount <= 1) || nestedCardsNeedWidth)) || //  >= 2  <= 1\n          (depth > 0 && rowCount === 0 && nestedCardCount >= 2)); //  >= 2\n      const hasNestedClass = shouldAddHasNestedClass ? ' has-nested-cards' : '';\n\n      return `\n                <div class=\"mvu-card${hasNestedClass} ${collapsedClass}\" data-path=\"${escapeHtml(path)}\" data-depth=\"${depth}\">\n                    <div class=\"mvu-card-header\">\n                        <div class=\"mvu-card-title\">\n                            <span>${escapeHtml(key)}</span>\n                            <span class=\"mvu-card-count\">${countText}</span>\n                        </div>\n                        <span class=\"mvu-card-toggle\"></span>\n                    </div>\n                    <div class=\"${bodyClass}\">\n                        ${bodyHtml}\n                    </div>\n                </div>\n            `;\n    }\n\n    // [] \n    function renderNumericMode(mvuData) {\n      if (!mvuData || !mvuData.stat_data) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-inbox\"></i><p></p></div>';\n      }\n\n      // [] \n      let visibleLevels = {};\n      try {\n        const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n        if (saved) {\n          visibleLevels = JSON.parse(saved);\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule ', e);\n      }\n\n      // \n      const numericItems = [];\n\n      // \n      function collectNumericItems(obj, path, levelNames) {\n        if (!obj || typeof obj !== 'object') return;\n\n        if (Array.isArray(obj)) {\n          if (isVWD(obj) || isSimpleArray(obj)) {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const itemValue = String(item ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: itemPath,\n                    key: `[${index}]`,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: [...levelNames],\n                  });\n                }\n              }\n            });\n          } else {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const newLevelNames = [...levelNames, `[${index}]`];\n              collectNumericItems(item, itemPath, newLevelNames);\n            });\n          }\n        } else {\n          // \n          const entries = Object.entries(obj).filter(([k]) => !k.startsWith('$'));\n          for (const [key, value] of entries) {\n            const childPath = path ? `${path}.${key}` : key;\n            const newLevelNames = [...levelNames, key];\n\n            if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n              // \n              collectNumericItems(value, childPath, newLevelNames);\n            } else {\n              // \n              const itemValue = String(value ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: childPath,\n                    key: key,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: newLevelNames,\n                  });\n                }\n              }\n            }\n          }\n        }\n      }\n\n      // \n      const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n      for (const key of topKeys) {\n        const value = mvuData.stat_data[key];\n        collectNumericItems(value, key, [key]);\n      }\n\n      // [] \n      const filteredNumericItems = numericItems.filter(item => {\n        // key\n        // levelNames\n        let lastLevelKey = item.key;\n        const nonArrayLevels = item.levelNames.filter(level => level && !level.startsWith('['));\n        if (nonArrayLevels.length > 0) {\n          lastLevelKey = nonArrayLevels[nonArrayLevels.length - 1];\n        } else if (item.path && item.path.includes('.')) {\n          // levelNamespath\n          const parts = item.path.split('.');\n          lastLevelKey = parts[parts.length - 1];\n        }\n        //  BlacklistManager \n        return !BlacklistManager.isBlacklisted(lastLevelKey);\n      });\n\n      if (filteredNumericItems.length === 0) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-filter\"></i><p></p></div>';\n      }\n\n      // \n      //  2\n      const allLevelNames = new Set();\n      filteredNumericItems.forEach(item => {\n        // \n        const hierarchyLevels =\n          item.levelNames.length > 1\n            ? item.levelNames.slice(0, -1) // \n            : [];\n\n        hierarchyLevels.forEach(level => {\n          if (level && !level.startsWith('[')) {\n            // \n            allLevelNames.add(level);\n          }\n        });\n      });\n\n      const levelNamesArray = Array.from(allLevelNames).sort();\n\n      //  toggle \n      let levelTogglesHtml = '';\n      if (levelNamesArray.length > 0) {\n        const theme = getThemeColors();\n        const buttonTextColor = theme.buttonTextOnAccent || theme.textMain || '#6B4A5A';\n\n        // \n        let levelButtonsHtml = '';\n        levelNamesArray.forEach(levelName => {\n          const isVisible = visibleLevels[levelName] !== false; // \n          const activeStyle = isVisible\n            ? `background:var(--acu-accent);color:${buttonTextColor};border-color:var(--acu-accent);opacity:1;`\n            : 'background:transparent;color:var(--acu-text-sub);border-color:var(--acu-border);opacity:0.5;';\n          levelButtonsHtml += `<button class=\"mvu-level-toggle\" data-level=\"${escapeHtml(levelName)}\" data-visible=\"${isVisible}\" style=\"display:flex;align-items:center;gap:4px;font-size:calc(var(--acu-font-size, 13px) * 0.85);cursor:pointer;padding:2px 6px;border-radius:4px;border:1px solid;${activeStyle}transition:all 0.2s;\" title=\"${isVisible ? '' : ''}: ${escapeHtml(levelName)}\"><span>${escapeHtml(levelName)}</span></button>`;\n        });\n\n        // \n        levelTogglesHtml = `\n          <div class=\"mvu-level-controls-collapsible collapsed\">\n            <div class=\"mvu-level-controls-header\" style=\"padding:6px 8px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);cursor:pointer;display:flex;align-items:center;justify-content:space-between;user-select:none;\">\n              <span style=\"font-size:calc(var(--acu-font-size, 13px) * 0.85);color:var(--acu-text-sub);\"></span>\n              <i class=\"fa-solid fa-chevron-down mvu-level-controls-toggle-icon\" style=\"font-size:10px;color:var(--acu-text-sub);transition:transform 0.2s;\"></i>\n            </div>\n            <div class=\"mvu-level-controls-body\" style=\"padding:8px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);display:flex;flex-wrap:wrap;gap:6px;align-items:center;\">\n              ${levelButtonsHtml}\n            </div>\n          </div>\n        `;\n      }\n\n      // \n      let itemsHtml = '';\n      filteredNumericItems.forEach(item => {\n        //  data-levels \n        const nonArrayLevels = item.levelNames.filter(level => !level.startsWith('['));\n\n        // \n        const visibleLevels = item.levelNames.filter(level => {\n          if (level.startsWith('[')) return false; // \n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        //  1\n        //  visibleLevels \n        const pathLevels = visibleLevels.length > 1 ? visibleLevels.slice(0, -1) : [];\n\n        // \n        //  nonArrayLevels  N-1 \n        const hierarchyLevels = nonArrayLevels.length > 1 ? nonArrayLevels.slice(0, -1) : [];\n\n        const allLevelsVisible = hierarchyLevels.every(level => {\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        // \n        const pathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n        const attrName = item.key;\n\n        // \n        let finalAttrName = attrName;\n        if (item.path && item.path.includes('.')) {\n          const parts = item.path.split('.');\n          finalAttrName = parts[parts.length - 1];\n        }\n\n        // \n        const diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon\" data-path=\"${escapeHtml(item.path)}\" data-attr-name=\"${escapeHtml(finalAttrName)}\" data-attr-value=\"${item.numericValue}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.6;font-size:calc(var(--acu-font-size, 13px) * 0.85);flex-shrink:0;\" title=\"\"></i>`;\n\n        // \n        let displayValue = extractNumericDisplayValue(item.value, false);\n        //  \",[0, 100]\"\n        displayValue = displayValue.replace(/,\\s*\\[[^\\]]+\\]/g, '');\n\n        //  data-levels \n        // data-levels \n        const displayStyle = allLevelsVisible ? '' : 'display:none;';\n        const levelsJson = JSON.stringify(hierarchyLevels);\n\n        itemsHtml += `\n          <div class=\"mvu-numeric-item\" data-levels='${escapeHtml(levelsJson)}' style=\"${displayStyle}display:flex;align-items:center;padding:6px 8px;margin-bottom:4px;background:var(--acu-table-hover);border-radius:4px;border-left:3px solid var(--acu-accent);\">\n            <div style=\"flex:1;min-width:0;\">\n              <div class=\"mvu-path-display\" style=\"font-size:calc(var(--acu-font-size, 13px) * 0.77);color:var(--acu-text-sub);margin-bottom:2px;\">${escapeHtml(pathDisplay)}</div>\n              <div style=\"display:flex;align-items:center;gap:6px;\">\n                <span style=\"font-size:calc(var(--acu-font-size, 13px) * 0.92);color:var(--acu-text-main);font-weight:bold;\">${escapeHtml(finalAttrName)}</span>\n                <span class=\"mvu-value\" data-path=\"${escapeHtml(item.path)}\" style=\"font-size:var(--acu-font-size, 13px);color:var(--acu-accent);font-weight:bold;cursor:pointer;\" title=\"\">${escapeHtml(displayValue)}</span>\n                ${diceIconHtml}\n              </div>\n            </div>\n          </div>\n        `;\n      });\n\n      return levelTogglesHtml + '<div class=\"mvu-numeric-items\" style=\"padding:0 8px;\">' + itemsHtml + '</div>';\n    }\n\n    // =====  API =====\n    return {\n      MODULE_ID: MODULE_ID,\n\n      isAvailable: isAvailable,\n      getData: getData,\n      getDataWithRetry: getDataWithRetry,\n\n      // \n      diagnoseVariableFramework: async function () {\n        const result = {\n          timestamp: new Date().toISOString(),\n          era: {\n            available: false,\n            eventEmit: typeof (window.eventEmit || window.parent?.eventEmit) === 'function',\n            eventOn: typeof (window.eventOn || window.parent?.eventOn) === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          mvu: {\n            available: false,\n            apiExists: typeof window.Mvu !== 'undefined',\n            getDataExists: typeof window.Mvu?.getMvuData === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          cache: {\n            hasCache: !!cachedEraData,\n            cacheKeys: cachedEraData ? Object.keys(cachedEraData) : [],\n          },\n          recommendation: '',\n        };\n\n        //  ERA\n        if (result.era.eventEmit && result.era.eventOn) {\n          try {\n            const eraData = await Promise.race([\n              getEraData(),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 2000)),\n            ]);\n            result.era.available = true;\n            result.era.dataAvailable = !!(eraData && eraData.stat_data);\n          } catch (e) {\n            result.era.error = e.message;\n          }\n        }\n\n        //  MVU\n        if (result.mvu.apiExists && result.mvu.getDataExists) {\n          try {\n            // [] \n            await Promise.race([\n              waitGlobalInitialized('Mvu'),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('')), 2000)),\n            ]);\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            result.mvu.available = true;\n            result.mvu.dataAvailable = !!(mvuData && mvuData.stat_data);\n          } catch (e) {\n            result.mvu.error = e.message;\n          }\n        }\n\n        // \n        if (result.era.dataAvailable) {\n          result.recommendation = 'ERA ';\n        } else if (result.mvu.dataAvailable) {\n          result.recommendation = 'MVU ';\n        } else if (result.era.available || result.mvu.available) {\n          result.recommendation = '';\n        } else {\n          result.recommendation = ' MVU  ERA ';\n        }\n\n        return result;\n      },\n\n      injectStyles: function () {\n        //  document iframe \n        const targetDoc = window.parent?.document || document;\n        if (targetDoc.getElementById('mvu-module-styles')) return;\n        const styleEl = targetDoc.createElement('style');\n        styleEl.id = 'mvu-module-styles';\n        styleEl.textContent = STYLES;\n        targetDoc.head.appendChild(styleEl);\n      },\n\n      renderNavButton: function (isActive) {\n        //  isAvailable()\n        const activeClass = isActive ? 'active' : '';\n        return `<button class=\"acu-nav-btn acu-mvu-btn $${activeClass}\" id=\"acu-btn-mvu\" data-table=\"$${MODULE_ID}\" style=\"order:-1;\">\n                    <i class=\"fa-solid fa-code-branch\"></i><span></span>\n                </button>`;\n      },\n\n      renderPanel: function () {\n        // \n        // \n\n        const mvuData = getData();\n\n        // MVU  ERA\n        const varMode = detectMode();\n        const isEraMode = varMode === 'era';\n\n        // [] \n        let isNumericMode = false;\n        try {\n          const saved = localStorage.getItem('acu_mvu_numeric_mode');\n          isNumericMode = saved === 'true';\n        } catch (e) {\n          console.warn('[DICE]MvuModule ', e);\n        }\n\n        // MVU\n        const layoutMode = 'vertical-layout';\n\n        // \n        const panelTitle = isEraMode ? 'ERA ' : 'MVU ';\n\n        // MVU  null\n        if (!mvuData) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-exclamation-circle\"></i>\n                                <p> ${isEraMode ? 'ERA' : 'MVU'} </p>\n                                <p class=\"mvu-empty-hint\"> ${isEraMode ? 'ERA ' : 'MVU '}</p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        //  stat_data  null\n        if (\n          !mvuData.stat_data ||\n          (typeof mvuData.stat_data === 'object' && Object.keys(mvuData.stat_data).length === 0)\n        ) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-inbox\"></i>\n                                <p></p>\n                                <p class=\"mvu-empty-hint\"> AI </p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        // [] \n        if (isNumericMode) {\n          const numericHtml = renderNumericMode(mvuData);\n          return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span> <span style=\"font-size:calc(var(--acu-font-size,13px) * 0.85);color:var(--acu-text-sub);margin-left:6px;\">()</span></div>\n                            <div class=\"acu-title-sub\">()</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode active\" title=\"\">\n                                <i class=\"fa-solid fa-list\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode} mvu-numeric-mode\">\n                        ${numericHtml}\n                    </div>\n                `;\n        }\n\n        // \n        const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n\n        let cardsHtml = '';\n        for (const key of topKeys) {\n          const value = mvuData.stat_data[key];\n          const childCount = countChildren(value);\n\n          if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n            // /  \n            // MVU isHorizontal  false\n            cardsHtml += renderCard(key, value, key, mvuData.delta_data, 0, true, false);\n          } else {\n            //   \n            cardsHtml += `\n                            <div class=\"mvu-card\" data-path=\"${escapeHtml(key)}\" data-depth=\"0\">\n                                <div class=\"mvu-card-body\">\n                                    ${renderRow(key, value, key, mvuData.delta_data)}\n                                </div>\n                            </div>\n                        `;\n          }\n        }\n\n        return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                            <div class=\"acu-title-sub\">(${topKeys.length})</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode\" title=\"\">\n                                <i class=\"fa-solid fa-filter\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode}\">\n                        ${cardsHtml}\n                    </div>\n                `;\n      },\n\n      bindEvents: function ($container) {\n        //  jQuery\n        const $ = window.parent?.jQuery || window.jQuery;\n        if (!$ || !$container || !$container.length) {\n          console.warn('[DICE]MvuModule bindEvents: jQuery or container not available');\n          return;\n        }\n\n        //  jQuery \n        const $panel = $('#acu-data-area');\n        if (!$panel.length) {\n          console.warn('[DICE]MvuModule bindEvents: #acu-data-area not found');\n          return;\n        }\n\n        // \n        $panel.off('.mvu');\n\n        // /\n        $panel.on('click.mvu', '.mvu-card-header', function (e) {\n          e.stopPropagation();\n          const $card = $(this).closest('.mvu-card');\n          const $body = $card.find('> .mvu-card-body').first();\n\n          // \n          if ($body.is(':animated') || $body.hasClass('animating')) return;\n\n          if ($card.hasClass('collapsed')) {\n            //  hide()  collapsed \n            $body.hide();\n            $card.removeClass('collapsed');\n            $body.addClass('animating').slideDown(180, function () {\n              $(this).removeClass('animating');\n            });\n          } else {\n            // \n            $body.addClass('animating').slideUp(180, function () {\n              $card.addClass('collapsed');\n              $(this).removeClass('animating');\n            });\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-btn-refresh', function (e) {\n          e.stopPropagation();\n          MvuModule.refresh($panel);\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-btn-numeric-mode', function (e) {\n          e.stopPropagation();\n          try {\n            const isCurrentlyNumeric = $(this).hasClass('active');\n            const newMode = !isCurrentlyNumeric;\n            localStorage.setItem('acu_mvu_numeric_mode', String(newMode));\n            // \n            if (typeof saveActiveTabState === 'function') {\n              const currentTab = getActiveTabState();\n              saveActiveTabState(currentTab);\n            }\n            if (typeof renderInterface === 'function') {\n              renderInterface();\n            }\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n            if (window.toastr) window.toastr.error('');\n          }\n        });\n\n        // [] /\n        $panel.on('click.mvu', '.mvu-level-controls-header', function (e) {\n          e.stopPropagation();\n          const $header = $(this);\n          const $collapsible = $header.closest('.mvu-level-controls-collapsible');\n\n          //  collapsed CSS \n          $collapsible.toggleClass('collapsed');\n        });\n\n        // []  toggle\n        $panel.on('click.mvu', '.mvu-level-toggle', function (e) {\n          e.stopPropagation();\n          const $button = $(this);\n          const levelName = $button.data('level');\n          const currentVisible = $button.data('visible') === 'true' || $button.data('visible') === true;\n          const isVisible = !currentVisible;\n\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            const visibleLevels = saved ? JSON.parse(saved) : {};\n            visibleLevels[levelName] = isVisible;\n            localStorage.setItem('acu_mvu_numeric_mode_visible_levels', JSON.stringify(visibleLevels));\n\n            // \n            const theme = getThemeColors();\n            const buttonTextColor = theme.buttonTextOnAccent || theme.textMain || '#6B4A5A';\n            $button.data('visible', isVisible);\n            if (isVisible) {\n              $button.css({\n                background: 'var(--acu-accent)',\n                color: buttonTextColor,\n                borderColor: 'var(--acu-accent)',\n                opacity: '1',\n              });\n              $button.attr('title', `: ${levelName}`);\n            } else {\n              $button.css({\n                background: 'transparent',\n                color: 'var(--acu-text-sub)',\n                borderColor: 'var(--acu-border)',\n                opacity: '0.5',\n              });\n              $button.attr('title', `: ${levelName}`);\n            }\n\n            //  3\n            $('.mvu-numeric-item').each(function () {\n              const $item = $(this);\n              try {\n                const levels = JSON.parse($item.attr('data-levels') || '[]');\n                if (levels.includes(levelName)) {\n                  // \n                  const visibleLevels = levels.filter(level => {\n                    const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n                    const prefs = saved ? JSON.parse(saved) : {};\n                    return prefs[level] !== false;\n                  });\n\n                  //  levels \n                  const pathLevels = visibleLevels;\n\n                  const newPathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n\n                  // \n                  $item.find('.mvu-path-display').text(newPathDisplay);\n                }\n              } catch (e) {\n                console.warn('[DICE]MvuModule ', e);\n              }\n            });\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-value', function (e) {\n          e.stopPropagation();\n          const $value = $(this);\n          const path = $value.data('path');\n          if (!path) {\n            console.warn('[DICE]MvuModule No path on value element');\n            return;\n          }\n          const currentValue = $value\n            .text()\n            .replace(/\\s*\\$\\s*$/, '')\n            .trim(); //  $\n\n          MvuModule.showEditDialog(path, currentValue, async function (newValue) {\n            if (newValue !== null && newValue !== currentValue) {\n              const success = await MvuModule.setValue(path, newValue);\n              const toastr = window.parent?.toastr || window.toastr;\n              if (success) {\n                $value.text(newValue);\n                $value.css('background', 'var(--acu-success-bg)');\n                setTimeout(() => $value.css('background', ''), 1500);\n              } else {\n                if (toastr) toastr.error('');\n              }\n            }\n          });\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-dice-icon', function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n          const $icon = $(this);\n          const path = $icon.data('path');\n          const attrName = $icon.data('attr-name') || '';\n          const attrValue = parseInt($icon.data('attr-value'), 10) || 50;\n\n          // \n          if (!path) {\n            console.warn('[DICE]MvuModule ');\n            return;\n          }\n\n          //  MVU \n          if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n            console.warn('[DICE]MvuModule MVU ');\n            // \n            if (typeof showDicePanel === 'function') {\n              showDicePanel({\n                attrValue: attrValue,\n                targetValue: null, // showDicePanel\n                targetName: attrName,\n                initiatorName: '<user>',\n                fromMvu: false,\n              });\n            }\n            return;\n          }\n\n          // \n          let parsedInfo = null;\n          try {\n            parsedInfo = parseMvuPathForDice(path, attrValue);\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n\n          // \n          if (typeof showDicePanel === 'function') {\n            showDicePanel({\n              attrValue: attrValue,\n              targetValue: null, // showDicePanel\n              targetName: attrName,\n              initiatorName: parsedInfo?.initiator || '<user>',\n              fromMvu: true,\n              mvuPath: path,\n              mvuParsedInfo: parsedInfo,\n            });\n          }\n        });\n\n        //  ST  swipe regenerate\n        (function () {\n          //  documentiframe \n          const targetDoc = window.parent?.document || document;\n          const $doc = $(targetDoc);\n\n          // \n          $doc.off('touchstart.mvuSwipeFix touchmove.mvuSwipeFix touchend.mvuSwipeFix', '#acu-data-area');\n\n          let touchStartX = 0;\n          let touchStartY = 0;\n          let isHorizontalSwipe = false;\n\n          //  #acu-data-area  MVU \n          $doc.on('touchstart.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) return;\n\n            if (e.originalEvent.touches.length === 1) {\n              touchStartX = e.originalEvent.touches[0].clientX;\n              touchStartY = e.originalEvent.touches[0].clientY;\n              isHorizontalSwipe = false;\n            }\n          });\n\n          $doc.on('touchmove.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              return;\n            }\n\n            if (e.originalEvent.touches.length !== 1) return;\n\n            const touch = e.originalEvent.touches[0];\n            const deltaX = Math.abs(touch.clientX - touchStartX);\n            const deltaY = Math.abs(touch.clientY - touchStartY);\n\n            // X > Y * 1.5\n            // deltaYdeltaX\n            const isHorizontal =\n              deltaY < 5\n                ? deltaX > 5 && deltaX > deltaY * 2 // deltaYdeltaX > 5deltaY\n                : deltaX > deltaY * 1.5 && deltaX > 10; // \n\n            if (isHorizontal) {\n              isHorizontalSwipe = true;\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n            }\n          });\n\n          $doc.on('touchend.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              isHorizontalSwipe = false;\n              touchStartX = 0;\n              touchStartY = 0;\n              return;\n            }\n\n            // \n            if (isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              isHorizontalSwipe = false;\n            }\n            touchStartX = 0;\n            touchStartY = 0;\n          });\n\n          // \n          const captureHandlerTouchStart = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1) {\n              touchStartX = e.touches[0].clientX;\n              touchStartY = e.touches[0].clientY;\n            }\n          };\n          const captureHandlerTouchMove = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1 && touchStartX && touchStartY) {\n              const touch = e.touches[0];\n              const deltaX = Math.abs(touch.clientX - touchStartX);\n              const deltaY = Math.abs(touch.clientY - touchStartY);\n              // \n              const isHorizontal =\n                deltaY < 5 ? deltaX > 5 && deltaX > deltaY * 2 : deltaX > deltaY * 1.5 && deltaX > 10;\n              if (isHorizontal) {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                e.preventDefault();\n              }\n            }\n          };\n          const captureHandlerTouchEnd = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              e.preventDefault();\n            }\n          };\n          // \n          targetDoc.addEventListener('touchstart', captureHandlerTouchStart, true);\n          targetDoc.addEventListener('touchmove', captureHandlerTouchMove, true);\n          targetDoc.addEventListener('touchend', captureHandlerTouchEnd, true);\n        })();\n\n        // \n        $panel.on('click.mvu', '.acu-close-btn', function (e) {\n          e.stopPropagation();\n          const $input = $panel.find('.acu-search-input');\n\n          // \n          if ($input.length && $input.val()) {\n            $input.val('').trigger('input').focus();\n            return;\n          }\n\n          // \n          if (typeof saveActiveTabState === 'function') {\n            saveActiveTabState(null);\n          }\n          if (typeof renderInterface === 'function') {\n            renderInterface();\n          }\n        });\n\n        // \n        $panel.on('pointerdown.mvu', '.acu-height-drag-handle', function (e) {\n          if (e.button !== 0) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const handle = this;\n          handle.setPointerCapture(e.pointerId);\n          $(handle).addClass('active');\n          const startHeight = $panel.height();\n          const startY = e.clientY;\n          const tableName = $(handle).data('table');\n\n          //  MIN_PANEL_HEIGHT  MAX_PANEL_HEIGHT\n          const MIN_PANEL_HEIGHT = typeof window.MIN_PANEL_HEIGHT !== 'undefined' ? window.MIN_PANEL_HEIGHT : 200;\n          const MAX_PANEL_HEIGHT = typeof window.MAX_PANEL_HEIGHT !== 'undefined' ? window.MAX_PANEL_HEIGHT : 800;\n\n          handle.onpointermove = function (moveE) {\n            const dy = moveE.clientY - startY;\n            let newHeight = startHeight - dy; // \n            if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n            if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n            $panel.css('height', newHeight + 'px');\n          };\n          handle.onpointerup = function (upE) {\n            $(handle).removeClass('active');\n            handle.releasePointerCapture(upE.pointerId);\n            handle.onpointermove = null;\n            handle.onpointerup = null;\n            if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n              const heights = getTableHeights();\n              heights[tableName] = parseInt($panel.css('height'));\n              saveTableHeights(heights);\n              $panel.addClass('acu-manual-mode');\n            }\n          };\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-height-drag-handle', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = $(this).data('table');\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-panel-header', function (e) {\n          if ($(e.target).closest('.acu-search-input, .acu-close-btn, .mvu-header-btn').length) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = MvuModule.MODULE_ID;\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n      },\n\n      showEditDialog: function (path, currentValue, onSave) {\n        //  jQuery  document\n        const $ = window.parent?.jQuery || window.jQuery;\n        const targetDoc = window.parent?.document || document;\n        if (!$) return;\n\n        // \n        $(targetDoc).find('.mvu-edit-overlay').remove();\n\n        const currentTheme = (typeof getConfig === 'function' ? getConfig().theme : null) || 'retro';\n\n        const html = `\n                    <div class=\"mvu-edit-overlay acu-edit-overlay acu-theme-${currentTheme}\">\n                        <div class=\"mvu-edit-dialog acu-edit-dialog\">\n                            <div class=\"acu-edit-title\">\n                                <i class=\"fa-solid fa-edit\" style=\"opacity:0.7;\"></i>\n                                <span></span>\n                            </div>\n                            <div class=\"mvu-edit-path\">${escapeHtml(path)}</div>\n                            <textarea class=\"mvu-edit-textarea acu-edit-textarea\">${escapeHtml(currentValue)}</textarea>\n                            <div class=\"mvu-edit-hint\">Ctrl+Enter  | Esc </div>\n                            <div class=\"acu-dialog-btns\">\n                                <button class=\"acu-dialog-btn mvu-btn-cancel\">\n                                    <i class=\"fa-solid fa-times\"></i> \n                                </button>\n                                <button class=\"acu-dialog-btn acu-btn-confirm mvu-btn-save\">\n                                    <i class=\"fa-solid fa-check\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `;\n\n        $(targetDoc.body).append(html);\n        const $overlay = $(targetDoc).find('.mvu-edit-overlay');\n        const $input = $overlay.find('.mvu-edit-textarea');\n\n        setTimeout(() => $input.focus().select(), 50);\n\n        // \n        $overlay.on('click', '.mvu-btn-cancel', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          $overlay.remove();\n          onSave(null);\n        });\n\n        // \n        $overlay.on('click', '.mvu-btn-save', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const newValue = $input.val();\n          $overlay.remove();\n          onSave(newValue);\n        });\n\n        // \n        $overlay.on('click', function (e) {\n          if ($(e.target).hasClass('mvu-edit-overlay')) {\n            $overlay.remove();\n            onSave(null);\n          }\n        });\n\n        // \n        $input.on('keydown', function (e) {\n          if (e.key === 'Escape') {\n            e.preventDefault();\n            $overlay.remove();\n            onSave(null);\n          } else if (e.key === 'Enter' && e.ctrlKey) {\n            e.preventDefault();\n            const newValue = $input.val();\n            $overlay.remove();\n            onSave(newValue);\n          }\n        });\n      },\n\n      setValue: async function (path, newValue) {\n        if (!isAvailable()) return false;\n\n        const mode = detectMode();\n\n        try {\n          let parsedValue = newValue;\n          if (newValue === 'true') parsedValue = true;\n          else if (newValue === 'false') parsedValue = false;\n          else if (!isNaN(Number(newValue)) && String(newValue).trim() !== '') {\n            parsedValue = Number(newValue);\n          }\n\n          if (mode === 'era') {\n            return await setEraValue(path, parsedValue);\n          } else {\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            if (!mvuData) {\n              console.error('[DICE]MvuModule  MVU ');\n              return false;\n            }\n\n            const success = await window.Mvu.setMvuVariable(mvuData, path, parsedValue, {\n              reason: '',\n              is_recursive: false,\n            });\n\n            if (success) {\n              await window.Mvu.replaceMvuData(mvuData, { type: 'message', message_id: 'latest' });\n            } else {\n              console.warn('[DICE]MvuModule setMvuVariable  false');\n            }\n\n            return success;\n          }\n        } catch (e) {\n          console.error('[DICE]MvuModule setValue error:', e);\n          return false;\n        }\n      },\n\n      isModuleTab: function (tableName) {\n        return tableName === MODULE_ID;\n      },\n\n      //  ERA  ERA \n      clearCache: function () {\n        cachedEraData = null;\n        console.log('[DICE]MvuModule  ERA ');\n      },\n\n      // \n      detectMode: function () {\n        return detectMode();\n      },\n\n      refresh: function ($container) {\n        // \n        this.clearCache();\n\n        if (!$container || !$container.length) {\n          const $panel = $('#acu-data-area');\n          if (!$panel.length) return;\n          $container = $panel;\n        }\n        // \n        const $refreshBtn = $container.find('.mvu-btn-refresh');\n        if ($refreshBtn.length) {\n          $refreshBtn.find('i').addClass('fa-spin');\n        }\n\n        // \n        //  10  1  10 \n        this.getDataWithRetry(10, 1000)\n          .then(mvuData => {\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            // []  toastr  renderPanel \n            //  getDataWithRetry \n            const toastr = window.parent?.toastr || window.toastr;\n            const actualData = this.getData();\n            if (toastr && !actualData) {\n              toastr.warning(' MVU ');\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error refreshing data:', err);\n\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            // [] \n            const toastr = window.parent?.toastr || window.toastr;\n            const actualData = this.getData();\n            if (toastr && !actualData) {\n              toastr.error('');\n            }\n          });\n      },\n    };\n  })();\n  // MVU \n  // COC\n  const DEFAULT_DICE_CONFIG = {\n    critSuccessMax: 5,\n    hardSuccessDiv: 5,\n    difficultSuccessDiv: 2,\n    critFailMin: 96,\n    ruleType: 'high_good',\n    lastDiceType: '1d100',\n    // DND \n    dndCritSuccess: 20,\n    dndCritFail: 1,\n    // : initiator_lose | tie | initiator_win\n    contestTieRule: 'initiator_lose',\n    // \n    hideDiceResultFromUser: false,\n    // \n    hideDiceResultInChat: false,\n  };\n\n  const getDiceConfig = () => Store.get(STORAGE_KEY_DICE_CONFIG, DEFAULT_DICE_CONFIG);\n  const saveDiceConfig = cfg => {\n    const oldCfg = getDiceConfig();\n    const newCfg = { ...oldCfg, ...cfg };\n    Store.set(STORAGE_KEY_DICE_CONFIG, newCfg);\n    // \n    const changedKeys = Object.keys(cfg).filter(k => oldCfg[k] !== newCfg[k]);\n    if (changedKeys.length > 0) {\n      console.info(`[DICE]: ${changedKeys.join(', ')}`);\n    }\n  };\n\n  // [] \n  const hideDiceResultsInUserMessages = () => {\n    try {\n      const diceCfg = getDiceConfig();\n      const hideInput = diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const hideChat = diceCfg.hideDiceResultInChat !== undefined ? diceCfg.hideDiceResultInChat : false;\n\n      // : \"XX\"\n      const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n      // : \"  vs    (...)  ......  (...)  .........\"\n      const contestDiceRegex =\n        /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n      // ==========  hideInput  ==========\n      try {\n        const $ta = $('#send_textarea');\n        if ($ta.length) {\n          let textareaVal = $ta.val() || '';\n          let modifiedText = textareaVal;\n\n          if (hideInput) {\n            // \n            const contestRegex =\n              /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n            const normalRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n            if (contestRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(contestRegex, '[]');\n            }\n            if (normalRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(normalRegex, '[]');\n            }\n          } else {\n            // \n            const originalText = $ta.data('acu-original-dice-text');\n            if (originalText && textareaVal.includes('[]')) {\n              // \n              modifiedText = textareaVal.replace(/\\[\\]/g, originalText);\n              $ta.removeData('acu-original-dice-text');\n            }\n          }\n\n          if (modifiedText !== textareaVal) {\n            $ta.val(modifiedText).trigger('input').trigger('change');\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]ACU :', e);\n      }\n\n      // ==========  hideChat  ==========\n      // \n      let lastMessageId;\n      try {\n        lastMessageId = getLastMessageId();\n      } catch (e) {\n        //  lastMessageId \n        return;\n      }\n\n      // \n      if (lastMessageId < 0) {\n        return;\n      }\n\n      try {\n        const userMessages = getChatMessages(`0-${lastMessageId}`, { role: 'user' });\n        // \n        if (!userMessages || userMessages.length === 0) {\n          return;\n        }\n\n        if (hideChat) {\n          // \n          let hiddenCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const $msgElement = retrieveDisplayedMessage(msg.message_id);\n              if (!$msgElement || !$msgElement.length) {\n                return;\n              }\n\n              // \n              let $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) {\n                // \n                $mesText = $msgElement.find('.message-text, .text, [class*=\"text\"], [class*=\"message\"]').first();\n                if (!$mesText || !$mesText.length) {\n                  // \n                  $mesText = $msgElement;\n                }\n              }\n\n              // DOM\n              const currentDomText = $mesText.text();\n              // \n              if (currentDomText.includes('[]')) {\n                return;\n              }\n\n              // AI\n              const originalText = msg.message || '';\n              if (!originalText) {\n                return;\n              }\n\n              // \n              let modifiedText = originalText;\n\n              // \n              //  lastIndex \n              const contestRegex =\n                /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n              const contestMatch = contestRegex.test(modifiedText);\n              if (contestMatch) {\n                modifiedText = modifiedText.replace(contestRegex, '[]');\n              }\n\n              // \n              const normalRegex =\n                /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n              const normalMatch = normalRegex.test(modifiedText);\n              if (normalMatch) {\n                modifiedText = modifiedText.replace(normalRegex, '[]');\n              }\n\n              // DOM\n              // HTMLHTML\n              if (modifiedText !== originalText && modifiedText !== currentDomText) {\n                // HTML\n                const currentHtml = $mesText.html();\n                // HTMLHTML\n                let modifiedHtml = currentHtml;\n\n                // \n                const contestPattern =\n                  /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n                if (contestPattern.test(currentHtml)) {\n                  modifiedHtml = modifiedHtml.replace(contestPattern, '[]');\n                }\n\n                // \n                const normalPattern =\n                  /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n                if (normalPattern.test(currentHtml)) {\n                  modifiedHtml = modifiedHtml.replace(normalPattern, '[]');\n                }\n\n                // HTML\n                if (modifiedHtml !== currentHtml) {\n                  $mesText.html(modifiedHtml);\n                  hiddenCount++;\n                }\n              }\n            } catch (e) {\n              console.warn(`[DICE]ACU  ${msg.message_id} :`, e);\n            }\n          });\n          if (hiddenCount > 0) {\n            console.info(`[DICE] ${hiddenCount} `);\n          }\n        } else {\n          // \n          let restoredCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const $msgElement = retrieveDisplayedMessage(msg.message_id);\n              if (!$msgElement || !$msgElement.length) return;\n\n              const $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) return;\n\n              // \n              const currentText = $mesText.text();\n              if (currentText.includes('[]')) {\n                // \n                const originalText = msg.message || '';\n                if (originalText) {\n                  $mesText.text(originalText);\n                  restoredCount++;\n                }\n              }\n            } catch (e) {\n              // \n            }\n          });\n          if (restoredCount > 0) {\n            console.info(`[DICE] ${restoredCount} `);\n          }\n        }\n      } catch (e) {\n        // \n        // \n        if (hideChat) {\n          console.warn('[DICE]ACU :', e);\n        }\n      }\n    } catch (e) {\n      // [] \n      // \n      const diceCfg = getDiceConfig();\n      if (diceCfg && (diceCfg.hideDiceResultFromUser || diceCfg.hideDiceResultInChat)) {\n        console.warn('[DICE]ACU :', e);\n      }\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const BUILTIN_ATTRIBUTE_PRESETS = [\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'coc7',\n      name: 'COC',\n      builtin: true,\n      description: '7816',\n      baseAttributes: [\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n      ],\n      specialAttributes: [\n        //  15-1109560\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        //  9-8547\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        //  8-6536\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        //  3-4122\n        { name: '', formula: '1+2d20', range: [3, 41] },\n        // \n        { name: '', formula: '/2', range: [1, 99] },\n        // COC \n        { name: 'SAN', formula: '', range: [1, 99] },\n        { name: '', formula: '1d5', range: [1, 5] },\n      ],\n    },\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'dnd5e',\n      name: 'DND',\n      builtin: true,\n      description: '568',\n      baseAttributes: [\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n      ],\n      specialAttributes: [\n        //  10-2015\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        //  7-1712\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        //  4-149\n        { name: '', formula: '2+2d6', range: [4, 14] },\n        { name: '', formula: '2+2d6', range: [4, 14] },\n      ],\n    },\n  ];\n\n  // \n  const AttributePresetManager = (() => {\n    let _cache = null;\n\n    return {\n      //  + \n      getAllPresets() {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        // \n        let needsSave = false;\n        stored.forEach(preset => {\n          const presetVersion = preset.version || '0.0.0';\n          if (compareVersion(presetVersion, PRESET_FORMAT_VERSION) < 0) {\n            console.log(\n              `[DICE]AttributePresetManager  \"${preset.name}\"  (${presetVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n            preset.version = PRESET_FORMAT_VERSION;\n            needsSave = true;\n          }\n        });\n        if (needsSave) {\n          Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n          // \n          _cache = null;\n        }\n        // \n        if (!needsSave && _cache) {\n          return _cache;\n        }\n        _cache = [...BUILTIN_ATTRIBUTE_PRESETS, ...stored];\n        return _cache;\n      },\n\n      // null = \n      getActivePreset() {\n        const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        if (!activeId) return null;\n        return this.getAllPresets().find(p => p.id === activeId) || null;\n      },\n\n      // \n      setActivePreset(id) {\n        try {\n          // idnull\n          const finalId = id === '' || id === undefined ? null : id;\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, finalId);\n          // \n          _cache = null;\n          console.log('[DICE]AttributePresetManager :', finalId);\n          return true;\n        } catch (err) {\n          console.error('[DICE]AttributePresetManager :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const newPreset = {\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          builtin: false,\n          version: preset.version || PRESET_FORMAT_VERSION,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates };\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        }\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getAllPresets().find(p => p.id === id);\n        if (!preset) return null;\n        const exported = {\n          format: 'acu_attr_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n        };\n        delete exported.builtin; // \n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr, autoUpdate = false) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.format !== 'acu_attr_preset_v1') {\n            throw new Error('');\n          }\n\n          // \n          if (!data.name || !data.baseAttributes || !Array.isArray(data.baseAttributes)) {\n            throw new Error('');\n          }\n\n          const importedVersion = data.version || '0.0.0';\n          const needsUpdate = compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            builtin: false,\n            version: autoUpdate && needsUpdate ? PRESET_FORMAT_VERSION : importedVersion,\n            createdAt: new Date().toISOString(),\n          };\n\n          const result = this.createPreset(imported);\n          if (result && needsUpdate && !autoUpdate) {\n            console.warn(\n              `[DICE]AttributePresetManager  \"${result.name}\"  (${importedVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n          }\n          return result;\n        } catch (e) {\n          console.error('[DICE]AttributePresetManager :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const getCrazyModeConfig = () => {\n    const stored = Store.get(STORAGE_KEY_CRAZY_MODE, null);\n    if (!stored) return { ...DEFAULT_CRAZY_MODE_CONFIG };\n    return { ...DEFAULT_CRAZY_MODE_CONFIG, ...stored };\n  };\n\n  // \n  const saveCrazyModeConfig = config => {\n    Store.set(STORAGE_KEY_CRAZY_MODE, config);\n  };\n\n  // \n  const shouldTriggerCrazyMode = () => {\n    const config = getCrazyModeConfig();\n    if (!config.enabled) return false;\n    // crazyLevel \n    const roll = Math.random() * 100;\n    return roll < config.crazyLevel;\n  };\n\n  // \n  const selectCrazyRollType = crazyLevel => {\n    // crazyLevel < 50: 100% \n    // crazyLevel 50-75: 70%  / 30% \n    // crazyLevel > 75: 50%  / 50% \n    if (crazyLevel < 50) return 'normal';\n    const contestChance = crazyLevel <= 75 ? 0.3 : 0.5;\n    return Math.random() < contestChance ? 'contest' : 'normal';\n  };\n\n  // \n  const weightedRandomSelect = items => {\n    if (!items || items.length === 0) return null;\n    const totalWeight = items.reduce((sum, item) => sum + (item.weight || 1), 0);\n    let random = Math.random() * totalWeight;\n    for (const item of items) {\n      random -= item.weight || 1;\n      if (random <= 0) return item;\n    }\n    return items[items.length - 1];\n  };\n\n  // \n  const selectCrazyParticipant = () => {\n    const config = getCrazyModeConfig();\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return null;\n\n    const allTables = processJsonData(rawData || {});\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n\n    // \n    const candidates = [];\n\n    // \n    if (playerResult?.data?.rows?.length > 0) {\n      const playerName = getDisplayPlayerName() || '';\n      const playerAttrs = getFullAttributesForCharacter('<user>');\n      candidates.push({\n        name: playerName,\n        attrs: playerAttrs,\n        isPlayer: true,\n        inScene: true,\n        weight: config.playerWeight,\n      });\n    }\n\n    // NPC\n    if (npcResult) {\n      const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n      npcParsed.forEach(npc => {\n        if (!npc.name) return;\n        const inSceneVal = String(npc.inScene || '').toLowerCase();\n        const isInScene = inSceneVal === 'true' || inSceneVal === '';\n        const npcAttrs = getFullAttributesForCharacter(npc.name);\n        candidates.push({\n          name: npc.name,\n          attrs: npcAttrs,\n          isPlayer: false,\n          inScene: isInScene,\n          weight: isInScene ? config.inSceneNpcWeight : config.offSceneNpcWeight,\n        });\n      });\n    }\n\n    if (candidates.length === 0) return null;\n    return weightedRandomSelect(candidates);\n  };\n\n  // \n  const selectCrazyAttribute = participant => {\n    if (!participant) return { name: '', value: 50 };\n\n    // 1. \n    if (participant.attrs && participant.attrs.length > 0) {\n      const randomAttr = participant.attrs[Math.floor(Math.random() * participant.attrs.length)];\n      return { name: randomAttr.name, value: randomAttr.value };\n    }\n\n    // 2. \n    const activePreset = AttributePresetManager.getActivePreset();\n    if (activePreset) {\n      const allPresetAttrs = [...(activePreset.baseAttributes || []), ...(activePreset.specialAttributes || [])];\n      if (allPresetAttrs.length > 0) {\n        const randomPresetAttr = allPresetAttrs[Math.floor(Math.random() * allPresetAttrs.length)];\n        //  range  50% \n        const range = randomPresetAttr.range || [0, 100];\n        const defaultValue = Math.floor((range[0] + range[1]) / 2);\n        return { name: randomPresetAttr.name, value: defaultValue };\n      }\n    }\n\n    // 3. \n    const skillPool = getRandomSkillPool();\n    if (skillPool && skillPool.length > 0) {\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      return { name: randomSkill, value: 50 };\n    }\n\n    return { name: '', value: 50 };\n  };\n\n  //  d100\n  const crazyRollD100 = () => Math.floor(Math.random() * 100) + 1;\n\n  // \n  const judgeCrazyRollResult = (roll, target) => {\n    if (roll <= 5) return '';\n    if (roll >= 96) return '';\n    if (roll <= target) return '';\n    return '';\n  };\n\n  // \n  const generateCrazyRoll = () => {\n    const config = getCrazyModeConfig();\n    const rollType = selectCrazyRollType(config.crazyLevel);\n\n    if (rollType === 'normal') {\n      // \n      const participant = selectCrazyParticipant();\n      if (!participant) return null;\n\n      const attr = selectCrazyAttribute(participant);\n      const roll = crazyRollD100();\n      const result = judgeCrazyRollResult(roll, attr.value);\n\n      // XXYY\n      return `${participant.name}${attr.name}${roll}${attr.value}${result}`;\n    } else {\n      // \n      const participant1 = selectCrazyParticipant();\n      if (!participant1) return null;\n\n      // \n      let participant2 = null;\n      for (let i = 0; i < 5; i++) {\n        const candidate = selectCrazyParticipant();\n        if (candidate && candidate.name !== participant1.name) {\n          participant2 = candidate;\n          break;\n        }\n      }\n\n      // \n      if (!participant2) {\n        const attr = selectCrazyAttribute(participant1);\n        const roll = crazyRollD100();\n        const result = judgeCrazyRollResult(roll, attr.value);\n        return `${participant1.name}${attr.name}${roll}${attr.value}${result}`;\n      }\n\n      const attr1 = selectCrazyAttribute(participant1);\n      const attr2 = selectCrazyAttribute(participant2);\n      const roll1 = crazyRollD100();\n      const roll2 = crazyRollD100();\n\n      // \n      const result1 = judgeCrazyRollResult(roll1, attr1.value);\n      const result2 = judgeCrazyRollResult(roll2, attr2.value);\n      const margin1 = attr1.value - roll1;\n      const margin2 = attr2.value - roll2;\n\n      let winner;\n      if (margin1 > margin2) {\n        winner = `${participant1.name}`;\n      } else if (margin2 > margin1) {\n        winner = `${participant2.name}`;\n      } else {\n        winner = '';\n      }\n\n      // \n      return (\n        `${participant1.name} ${attr1.name} vs ${participant2.name} ${attr2.name}` +\n        `${participant1.name} ${attr1.name} (${attr1.value})  ${roll1}${result1}` +\n        `${participant2.name} ${attr2.name} (${attr2.value})  ${roll2}${result2}` +\n        `${winner}`\n      );\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  /**\n   * \n   * : 3d6, 4d6kh3, 4d6dl1, 4d6dh1\n   * @returns  NaN\n   */\n  const rollDiceExpression = expr => {\n    const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n\n    const match = expr.match(/^(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?$/i);\n    if (!match) return NaN;\n\n    const [, countStr, sidesStr, keepDrop] = match;\n    const count = parseInt(countStr, 10);\n    const sides = parseInt(sidesStr, 10);\n\n    let rolls = Array.from({ length: count }, () => rollDice(sides));\n\n    //  keep/drop\n    if (keepDrop) {\n      const kd = keepDrop.toLowerCase();\n      const n = parseInt(kd.slice(2), 10);\n      rolls.sort((a, b) => b - a); // \n\n      if (kd.startsWith('kh'))\n        rolls = rolls.slice(0, n); // n\n      else if (kd.startsWith('kl'))\n        rolls = rolls.slice(-n); // n\n      else if (kd.startsWith('dh'))\n        rolls = rolls.slice(n); // n\n      else if (kd.startsWith('dl')) rolls = rolls.slice(0, -n); // n\n    }\n\n    return rolls.reduce((a, b) => a + b, 0);\n  };\n\n  /**\n   * \n   * @param formula  \"/2+1d10\"  \"3d6*5\"\n   * @param context  { : 50, : 40 }\n   * @returns \n   */\n  const evaluateFormula = (formula, context = {}) => {\n    if (!formula) return 0;\n\n    let expr = String(formula).trim();\n\n    // 1. \n    const varNames = Object.keys(context).sort((a, b) => b.length - a.length);\n    for (const name of varNames) {\n      const value = context[name];\n      if (typeof value === 'number' && !isNaN(value)) {\n        // \n        expr = expr.split(name).join(`(${value})`);\n      }\n    }\n\n    // 2. \n    expr = expr.replace(/\\d+d\\d+(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi, match => {\n      const result = rollDiceExpression(match);\n      return isNaN(result) ? '0' : String(result);\n    });\n\n    // 3. \n    if (!/^[\\d\\s+\\-*/().]+$/.test(expr)) {\n      console.warn('[DICE]evaluateFormula :', formula, '', expr);\n      return 0;\n    }\n\n    // 4. \n    try {\n      // eslint-disable-next-line no-new-func\n      const result = new Function(`return (${expr})`)();\n      return Math.round(result); // \n    } catch (e) {\n      console.error('[DICE]evaluateFormula :', formula, '', expr, e);\n      return 0;\n    }\n  };\n\n  /**\n   * \n   * @param formula \n   * @param range  [min, max]\n   * @param context \n   * @returns \n   */\n  const generateAttributeValue = (formula, range, context) => {\n    let value = evaluateFormula(formula, context);\n\n    if (range && Array.isArray(range) && range.length === 2) {\n      value = Math.max(range[0], Math.min(range[1], value));\n    }\n\n    return value;\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const DASHBOARD_TABLE_CONFIG = {\n    global: {\n      tableKeywords: ['', '', ''],\n      columns: {\n        detailLocation: { keywords: ['', '', '', ''], fallbackIndex: null },\n        currentLocation: { keywords: ['', '', '', ''], fallbackIndex: 2 },\n      },\n    },\n    player: {\n      // : user, <user>\n      tableKeywords: ['', '', '', '', 'player', '', 'user', '<user>'],\n      columns: {\n        name: { keywords: ['', '', '', 'name'], fallbackIndex: 1 },\n        status: { keywords: ['', '', '', ''], fallbackIndex: null },\n        position: { keywords: ['', '', ''], fallbackIndex: null },\n        attrs: { keywords: ['', ''], fallbackIndex: null, isMultiple: true },\n        // : , , , \n        money: {\n          keywords: ['', '', '', '', '', '', '', '', ''],\n          fallbackIndex: null,\n        },\n        resources: { keywords: ['', '', 'resources'], fallbackIndex: null },\n      },\n    },\n    location: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: {\n          keywords: ['', '', '', '', '', '', '', ''],\n          fallbackIndex: 1,\n        },\n        description: { keywords: ['', '', '', '', ''], fallbackIndex: null },\n      },\n    },\n    npc: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        'NPC',\n        '',\n        '',\n        '',\n        '',\n        'character',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', ''], fallbackIndex: 1 },\n        status: { keywords: ['', ''], fallbackIndex: null },\n        position: { keywords: ['', '', '', ''], fallbackIndex: null },\n        inScene: { keywords: ['', '', '', ''], fallbackIndex: null },\n      },\n    },\n    quest: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        progress: { keywords: ['', '', '/'], fallbackIndex: 5 },\n        status: { keywords: [''], fallbackIndex: 6 },\n      },\n      filters: {\n        active: { column: 'status', includes: ['', '', ''], excludeColumn: 'type', excludes: [''] },\n      },\n    },\n    bag: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        count: { keywords: ['', '', ''], fallbackIndex: 3 },\n      },\n    },\n    skill: {\n      // : , , , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        level: { keywords: ['', '', '', 'lv'], fallbackIndex: 3 },\n      },\n    },\n    equip: {\n      // : , , , , , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        part: { keywords: ['', '', ''], fallbackIndex: 3 },\n        isEquipped: { keywords: ['', '', '', ''], fallbackIndex: 4 },\n      },\n      filters: {\n        equipped: { column: 'isEquipped', includes: ['', '', 'true', '', 'yes', 'equipped'] },\n      },\n    },\n  };\n\n  // \n  const DashboardDataParser = {\n    // \n    findTable(allTables, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return null;\n      }\n\n      for (const keyword of config.tableKeywords) {\n        for (const tableName in allTables) {\n          if (tableName.includes(keyword)) {\n            console.info(`[DICE]: \"${moduleKey}\"\"${tableName}\" (: \"${keyword}\")`);\n            return {\n              data: allTables[tableName],\n              name: tableName,\n              key: allTables[tableName].key,\n              config: config,\n            };\n          }\n        }\n      }\n      console.info(\n        `[DICE]: \"${moduleKey}\" (: ${config.tableKeywords.join(', ')})`,\n      );\n      return null;\n    },\n\n    // \n    findColumnIndex(headers, columnKey, moduleConfig) {\n      const colConfig = moduleConfig.columns[columnKey];\n      if (!colConfig) return -1;\n\n      // \n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (colConfig.keywords.some(kw => h.includes(kw.toLowerCase()))) {\n          return i;\n        }\n      }\n\n      // \n      return colConfig.fallbackIndex ?? -1;\n    },\n\n    // \n    getValue(row, headers, columnKey, moduleConfig) {\n      const idx = this.findColumnIndex(headers, columnKey, moduleConfig);\n      if (idx < 0 || idx >= row.length) return null;\n      return row[idx];\n    },\n\n    // \n    getColumnMap(headers, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) return {};\n\n      const map = {};\n      for (const colKey in config.columns) {\n        map[colKey] = this.findColumnIndex(headers, colKey, config);\n      }\n      return map;\n    },\n\n    // \n    parseRows(tableResult, moduleKey) {\n      if (!tableResult || !tableResult.data) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return [];\n      }\n\n      const { data, config } = tableResult;\n      const headers = data.headers || [];\n      const rows = data.rows || [];\n      const colMap = this.getColumnMap(headers, moduleKey);\n\n      const parsed = rows.map((row, idx) => {\n        const obj = { _rowIndex: idx, _raw: row };\n        for (const colKey in colMap) {\n          const colIdx = colMap[colKey];\n          obj[colKey] = colIdx >= 0 && colIdx < row.length ? row[colIdx] : null;\n        }\n        return obj;\n      });\n\n      console.info(`[DICE]: \"${moduleKey}\"${parsed.length}`);\n      return parsed;\n    },\n\n    // \n    applyFilter(parsedRows, filterKey, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config || !config.filters || !config.filters[filterKey]) return parsedRows;\n\n      const filter = config.filters[filterKey];\n\n      // parsedRows\n      const hasFilterColumn = parsedRows.some(row => row[filter.column] !== null && row[filter.column] !== undefined);\n      if (!hasFilterColumn) {\n        // \n        return parsedRows;\n      }\n\n      return parsedRows.filter(row => {\n        const value = String(row[filter.column] || '').toLowerCase();\n        const matchInclude = filter.includes.some(inc => value.includes(inc.toLowerCase()));\n\n        if (filter.excludeColumn && filter.excludes) {\n          const excludeValue = String(row[filter.excludeColumn] || '').toLowerCase();\n          const matchExclude = filter.excludes.some(exc => excludeValue.includes(exc.toLowerCase()));\n          return matchInclude && !matchExclude;\n        }\n\n        return matchInclude;\n      });\n    },\n  };\n\n  const DEFAULT_GM_CONFIG = {\n    enabled: true,\n    diceSystem: '1d100',\n    showDiceIcon: true,\n    autoSendPrompt: true,\n    action_groups: [\n      {\n        table_keywords: ['', '', 'Location', 'Map', '', ''],\n        actions: [\n          { label: '', icon: 'fa-walking', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-search', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-clock', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', 'NPC', '', '', ''],\n        actions: [\n          { label: '', icon: 'fa-comments', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-hand-fist', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          { label: '', icon: 'fa-hand-pointer', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-trash', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-shield-halved',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-coins', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-wand-magic-sparkles',\n            type: 'skill_check',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-dumbbell', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-crosshairs',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          {\n            label: '',\n            icon: 'fa-list-check',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-ear-listen',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-user-plus', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          {\n            label: '',\n            icon: 'fa-handshake',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n        ],\n      },\n    ],\n  };\n  // [] \n  const THEME_COLORS = {\n    retro: {\n      bgPanel: '#e6e2d3',\n      border: '#dcd0c0',\n      textMain: '#5e4b35',\n      textSub: '#8a7a6a',\n      btnBg: '#dcd0c0',\n      btnHover: '#cbbba8',\n      accent: '#7a695f',\n      tableHead: '#efebe4',\n      successText: '#27ae60',\n      successBg: 'rgba(39, 174, 96, 0.15)',\n      inputBg: '#f5f2eb',\n      inputText: '#5e4b35',\n      placeholderText: '#a09080',\n      btnActiveBg: '#8d7b6f',\n      btnActiveText: '#fdfaf5',\n      // \n      failureText: '#e74c3c',\n      failureBg: 'rgba(231, 76, 60, 0.15)',\n      warningText: '#f39c12',\n      warningBg: 'rgba(243, 156, 18, 0.15)',\n      critSuccessText: '#9b59b6',\n      critSuccessBg: 'rgba(155, 89, 182, 0.15)',\n      critFailureText: '#c0392b',\n      critFailureBg: 'rgba(192, 57, 43, 0.15)',\n      extremeSuccessText: '#2980b9',\n      extremeSuccessBg: 'rgba(41, 128, 185, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#e74c3c',\n      errorBg: 'rgba(231, 76, 60, 0.15)',\n      errorBorder: 'rgba(231, 76, 60, 0.5)',\n      warningIcon: '#e67e22',\n      buttonTextOnAccent: '#fff',\n    },\n    dark: {\n      bgPanel: 'rgba(30, 30, 30, 0.98)',\n      border: '#444',\n      textMain: '#eee',\n      textSub: '#999',\n      btnBg: 'rgba(60, 60, 60, 0.9)',\n      btnHover: '#505050',\n      accent: '#9b8cd9',\n      tableHead: 'rgba(45, 45, 45, 0.95)',\n      successText: '#4cd964',\n      successBg: 'rgba(76, 217, 100, 0.2)',\n      inputBg: 'rgba(50, 50, 50, 0.95)',\n      inputText: '#eee',\n      placeholderText: '#777',\n      btnActiveBg: '#6a5acd',\n      btnActiveText: '#fff',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#ba68c8',\n      critSuccessBg: 'rgba(186, 104, 200, 0.2)',\n      critFailureText: '#d32f2f',\n      critFailureBg: 'rgba(211, 47, 47, 0.2)',\n      extremeSuccessText: '#42a5f5',\n      extremeSuccessBg: 'rgba(66, 165, 245, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.75)',\n      overlayBgLight: 'rgba(0,0,0,0.65)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255,255,255,0.05)',\n      veryLightBg: 'rgba(255,255,255,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(255,255,255,0.1)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#fff',\n    },\n    modern: {\n      bgPanel: '#f8f9fa',\n      border: '#e0e0e0',\n      textMain: '#333',\n      textSub: '#666',\n      btnBg: '#e9ecef',\n      btnHover: '#dee2e6',\n      accent: '#007bff',\n      tableHead: '#f1f3f5',\n      successText: '#28a745',\n      successBg: 'rgba(40, 167, 69, 0.15)',\n      inputBg: '#fff',\n      inputText: '#333',\n      placeholderText: '#999',\n      btnActiveBg: '#007bff',\n      btnActiveText: '#fff',\n      // \n      failureText: '#dc3545',\n      failureBg: 'rgba(220, 53, 69, 0.15)',\n      warningText: '#ffc107',\n      warningBg: 'rgba(255, 193, 7, 0.15)',\n      critSuccessText: '#6f42c1',\n      critSuccessBg: 'rgba(111, 66, 193, 0.15)',\n      critFailureText: '#c82333',\n      critFailureBg: 'rgba(200, 35, 51, 0.15)',\n      extremeSuccessText: '#17a2b8',\n      extremeSuccessBg: 'rgba(23, 162, 184, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#dc3545',\n      errorBg: 'rgba(220, 53, 69, 0.15)',\n      errorBorder: 'rgba(220, 53, 69, 0.5)',\n      warningIcon: '#fd7e14',\n      buttonTextOnAccent: '#fff',\n    },\n    forest: {\n      bgPanel: '#e8f5e9',\n      border: '#a5d6a7',\n      textMain: '#2e7d32',\n      textSub: '#66bb6a',\n      btnBg: '#c8e6c9',\n      btnHover: '#a5d6a7',\n      accent: '#43a047',\n      tableHead: '#dcedc8',\n      successText: '#2e7d32',\n      successBg: 'rgba(46, 125, 50, 0.2)',\n      inputBg: '#f1f8e9',\n      inputText: '#2e7d32',\n      placeholderText: '#81c784',\n      btnActiveBg: '#43a047',\n      btnActiveText: '#fff',\n      // \n      failureText: '#c62828',\n      failureBg: 'rgba(198, 40, 40, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#0277bd',\n      extremeSuccessBg: 'rgba(2, 119, 189, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#c62828',\n      errorBg: 'rgba(198, 40, 40, 0.15)',\n      errorBorder: 'rgba(198, 40, 40, 0.5)',\n      warningIcon: '#e67e22',\n      buttonTextOnAccent: '#fff',\n    },\n    ocean: {\n      bgPanel: '#e3f2fd',\n      border: '#90caf9',\n      textMain: '#1565c0',\n      textSub: '#42a5f5',\n      btnBg: '#bbdefb',\n      btnHover: '#90caf9',\n      accent: '#1976d2',\n      tableHead: '#bbdefb',\n      successText: '#0288d1',\n      successBg: 'rgba(2, 136, 209, 0.15)',\n      inputBg: '#e1f5fe',\n      inputText: '#1565c0',\n      placeholderText: '#64b5f6',\n      btnActiveBg: '#1976d2',\n      btnActiveText: '#fff',\n      // \n      failureText: '#d32f2f',\n      failureBg: 'rgba(211, 47, 47, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#0277bd',\n      extremeSuccessBg: 'rgba(2, 119, 189, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#d32f2f',\n      errorBg: 'rgba(211, 47, 47, 0.15)',\n      errorBorder: 'rgba(211, 47, 47, 0.5)',\n      warningIcon: '#f57c00',\n      buttonTextOnAccent: '#fff',\n    },\n    cyber: {\n      bgPanel: '#0a0a0a',\n      border: '#00ffcc33',\n      textMain: '#00ffcc',\n      textSub: '#00cc99',\n      btnBg: 'rgba(0, 255, 204, 0.1)',\n      btnHover: 'rgba(0, 255, 204, 0.2)',\n      accent: '#00ffcc',\n      tableHead: 'rgba(0, 255, 204, 0.05)',\n      successText: '#0f0',\n      successBg: 'rgba(0, 255, 0, 0.15)',\n      inputBg: 'rgba(0, 0, 0, 0.6)',\n      inputText: '#00ffcc',\n      placeholderText: '#006655',\n      btnActiveBg: '#ff00ff',\n      btnActiveText: '#fff',\n      // \n      failureText: '#ff0066',\n      failureBg: 'rgba(255, 0, 102, 0.2)',\n      warningText: '#ffaa00',\n      warningBg: 'rgba(255, 170, 0, 0.2)',\n      critSuccessText: '#ff00ff',\n      critSuccessBg: 'rgba(255, 0, 255, 0.2)',\n      critFailureText: '#ff0000',\n      critFailureBg: 'rgba(255, 0, 0, 0.2)',\n      extremeSuccessText: '#00ffff',\n      extremeSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,255,204,0.3)',\n      lightBg: 'rgba(0,255,204,0.05)',\n      veryLightBg: 'rgba(0,255,204,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(0,255,204,0.1)',\n      // \n      buttonBg: 'rgba(0, 200, 150, 0.6)',\n      buttonBgActive: 'rgba(0, 180, 130, 0.7)',\n      presetButtonBg: 'rgba(0, 200, 150, 0.3)',\n      presetButtonBgActive: 'rgba(0, 200, 150, 0.6)',\n      // /\n      errorText: '#ff0066',\n      errorBg: 'rgba(255, 0, 102, 0.2)',\n      errorBorder: 'rgba(255, 0, 102, 0.5)',\n      warningIcon: '#ffaa00',\n      buttonTextOnAccent: '#000',\n    },\n    nightowl: {\n      bgPanel: '#011627',\n      border: '#132e45',\n      textMain: '#e0e6f2',\n      textSub: '#a6b8cc',\n      btnBg: '#1f3a52',\n      btnHover: '#2a4a68',\n      accent: '#7fdbca',\n      tableHead: '#0a2133',\n      successText: '#addb67',\n      successBg: 'rgba(173, 219, 103, 0.15)',\n      inputBg: '#00101c',\n      inputText: '#e0e6f2',\n      placeholderText: '#6a8090',\n      btnActiveBg: '#7fdbca',\n      btnActiveText: '#011627',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#c792ea',\n      critSuccessBg: 'rgba(199, 146, 234, 0.2)',\n      critFailureText: '#ef5350',\n      critFailureBg: 'rgba(239, 83, 80, 0.2)',\n      extremeSuccessText: '#82aaff',\n      extremeSuccessBg: 'rgba(130, 170, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.75)',\n      overlayBgLight: 'rgba(0,0,0,0.65)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255,255,255,0.05)',\n      veryLightBg: 'rgba(255,255,255,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(255,255,255,0.1)',\n      // \n      buttonBg: 'rgba(127, 219, 202, 0.4)',\n      buttonBgActive: 'rgba(127, 219, 202, 0.5)',\n      presetButtonBg: 'rgba(127, 219, 202, 0.2)',\n      presetButtonBgActive: 'rgba(127, 219, 202, 0.4)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#000',\n    },\n    sakura: {\n      bgPanel: '#F9F0EF',\n      border: '#EBDCD9',\n      textMain: '#6B5552',\n      textSub: '#C08D8D',\n      btnBg: '#EBDCD9',\n      btnHover: '#D8C7C4',\n      accent: '#C08D8D',\n      tableHead: '#F9F0EF',\n      successText: '#6B5552',\n      successBg: 'rgba(192, 141, 141, 0.12)',\n      inputBg: '#F9F0EF',\n      inputText: '#6B5552',\n      placeholderText: '#C08D8D',\n      btnActiveBg: '#C08D8D',\n      btnActiveText: '#F9F0EF',\n      // \n      failureText: '#9B7A7A',\n      failureBg: 'rgba(155, 122, 122, 0.12)',\n      warningText: '#A68A7A',\n      warningBg: 'rgba(166, 138, 122, 0.12)',\n      critSuccessText: '#8B7A7A',\n      critSuccessBg: 'rgba(139, 122, 122, 0.12)',\n      critFailureText: '#8B6F6F',\n      critFailureBg: 'rgba(139, 111, 111, 0.12)',\n      extremeSuccessText: '#9B8A8A',\n      extremeSuccessBg: 'rgba(155, 138, 138, 0.12)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(107, 85, 82, 0.3)',\n      lightBg: 'rgba(192, 141, 141, 0.08)',\n      veryLightBg: 'rgba(192, 141, 141, 0.02)',\n      buttonText: '#F9F0EF',\n      grayBg: 'rgba(192, 141, 141, 0.08)',\n      // \n      buttonBg: 'rgba(192, 141, 141, 0.4)',\n      buttonBgActive: 'rgba(192, 141, 141, 0.5)',\n      presetButtonBg: 'rgba(192, 141, 141, 0.2)',\n      presetButtonBgActive: 'rgba(192, 141, 141, 0.4)',\n      // /\n      errorText: '#9B7A7A',\n      errorBg: 'rgba(155, 122, 122, 0.12)',\n      errorBorder: 'rgba(155, 122, 122, 0.4)',\n      warningIcon: '#A68A7A',\n      buttonTextOnAccent: '#fff',\n    },\n    minepink: {\n      bgPanel: '#1a1a1a',\n      border: '#333333',\n      textMain: '#ffb3d9',\n      textSub: '#ff80c1',\n      btnBg: '#2a2a2a',\n      btnHover: '#3a3a3a',\n      accent: '#ff80c1',\n      tableHead: '#252525',\n      successText: '#ff80c1',\n      successBg: 'rgba(255, 128, 193, 0.2)',\n      inputBg: '#222222',\n      inputText: '#ffb3d9',\n      placeholderText: '#666666',\n      btnActiveBg: '#ff80c1',\n      btnActiveText: '#1a1a1a',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#ff80c1',\n      critSuccessBg: 'rgba(255, 128, 193, 0.2)',\n      critFailureText: '#ff4444',\n      critFailureBg: 'rgba(255, 68, 68, 0.2)',\n      extremeSuccessText: '#ffb3d9',\n      extremeSuccessBg: 'rgba(255, 179, 217, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255, 128, 193, 0.1)',\n      veryLightBg: 'rgba(255, 128, 193, 0.02)',\n      buttonText: '#1a1a1a',\n      grayBg: 'rgba(255, 128, 193, 0.1)',\n      // \n      buttonBg: 'rgba(255, 128, 193, 0.7)',\n      buttonBgActive: 'rgba(255, 128, 193, 0.8)',\n      presetButtonBg: 'rgba(255, 128, 193, 0.2)',\n      presetButtonBgActive: 'rgba(255, 128, 193, 0.4)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#000',\n    },\n    purple: {\n      bgPanel: '#f3e5f5',\n      border: '#ce93d8',\n      textMain: '#6a1b9a',\n      textSub: '#9c27b0',\n      btnBg: '#e1bee7',\n      btnHover: '#ce93d8',\n      accent: '#9c27b0',\n      tableHead: '#f8e1f5',\n      successText: '#6a1b9a',\n      successBg: 'rgba(106, 27, 154, 0.15)',\n      inputBg: '#fce4ec',\n      inputText: '#6a1b9a',\n      placeholderText: '#ba68c8',\n      btnActiveBg: '#9c27b0',\n      btnActiveText: '#fff',\n      // \n      failureText: '#d32f2f',\n      failureBg: 'rgba(211, 47, 47, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#6a1b9a',\n      extremeSuccessBg: 'rgba(106, 27, 154, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(156, 39, 176, 0.1)',\n      veryLightBg: 'rgba(156, 39, 176, 0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(156, 39, 176, 0.1)',\n      // \n      buttonBg: 'rgba(156, 39, 176, 0.6)',\n      buttonBgActive: 'rgba(156, 39, 176, 0.7)',\n      presetButtonBg: 'rgba(156, 39, 176, 0.3)',\n      presetButtonBgActive: 'rgba(156, 39, 176, 0.6)',\n      // /\n      errorText: '#d32f2f',\n      errorBg: 'rgba(211, 47, 47, 0.15)',\n      errorBorder: 'rgba(211, 47, 47, 0.5)',\n      warningIcon: '#f57c00',\n      buttonTextOnAccent: '#fff',\n    },\n    wechat: {\n      bgPanel: '#F7F7F7',\n      border: '#E5E5E5',\n      textMain: '#333333',\n      textSub: '#666666',\n      btnBg: '#E5E5E5',\n      btnHover: '#D5D5D5',\n      accent: '#09B83E',\n      tableHead: '#F0F0F0',\n      successText: '#09B83E',\n      successBg: 'rgba(9, 184, 62, 0.12)',\n      inputBg: '#FFFFFF',\n      inputText: '#333333',\n      placeholderText: '#999999',\n      btnActiveBg: '#09B83E',\n      btnActiveText: '#FFFFFF',\n      // \n      failureText: '#E53E3E',\n      failureBg: 'rgba(229, 62, 62, 0.12)',\n      warningText: '#FF9500',\n      warningBg: 'rgba(255, 149, 0, 0.12)',\n      critSuccessText: '#07A832',\n      critSuccessBg: 'rgba(7, 168, 50, 0.15)',\n      critFailureText: '#C53030',\n      critFailureBg: 'rgba(197, 48, 48, 0.15)',\n      extremeSuccessText: '#09B83E',\n      extremeSuccessBg: 'rgba(9, 184, 62, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.2)',\n      lightBg: 'rgba(9, 184, 62, 0.08)',\n      veryLightBg: 'rgba(9, 184, 62, 0.02)',\n      buttonText: '#FFFFFF',\n      grayBg: 'rgba(9, 184, 62, 0.08)',\n      // \n      buttonBg: 'rgba(9, 184, 62, 0.7)',\n      buttonBgActive: 'rgba(9, 184, 62, 0.85)',\n      presetButtonBg: 'rgba(9, 184, 62, 0.3)',\n      presetButtonBgActive: 'rgba(9, 184, 62, 0.6)',\n      // /\n      errorText: '#E53E3E',\n      errorBg: 'rgba(229, 62, 62, 0.12)',\n      errorBorder: 'rgba(229, 62, 62, 0.5)',\n      warningIcon: '#FF9500',\n      buttonTextOnAccent: '#fff',\n    },\n    educational: {\n      bgPanel: '#000000',\n      border: '#1B1B1B',\n      textMain: '#FFFFFF',\n      textSub: '#CCCCCC',\n      btnBg: '#1B1B1B',\n      btnHover: '#2B2B2B',\n      accent: '#FF9900',\n      tableHead: '#1B1B1B',\n      successText: '#FF9900',\n      successBg: 'rgba(255, 153, 0, 0.15)',\n      inputBg: '#1B1B1B',\n      inputText: '#FFFFFF',\n      placeholderText: '#666666',\n      btnActiveBg: '#FF9900',\n      btnActiveText: '#000000',\n      // \n      failureText: '#FF6B6B',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#FFAA00',\n      warningBg: 'rgba(255, 170, 0, 0.2)',\n      critSuccessText: '#FF9900',\n      critSuccessBg: 'rgba(255, 153, 0, 0.2)',\n      critFailureText: '#FF4444',\n      critFailureBg: 'rgba(255, 68, 68, 0.2)',\n      extremeSuccessText: '#FFB84D',\n      extremeSuccessBg: 'rgba(255, 184, 77, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255, 153, 0, 0.1)',\n      veryLightBg: 'rgba(255, 153, 0, 0.02)',\n      buttonText: '#FFFFFF',\n      grayBg: 'rgba(255, 255, 255, 0.1)',\n      // \n      buttonBg: 'rgba(255, 153, 0, 0.7)',\n      buttonBgActive: 'rgba(255, 153, 0, 0.85)',\n      presetButtonBg: 'rgba(255, 153, 0, 0.3)',\n      presetButtonBgActive: 'rgba(255, 153, 0, 0.6)',\n      // /\n      errorText: '#FF6B6B',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#FFAA00',\n      buttonTextOnAccent: '#000000',\n    },\n    galgame: {\n      bgPanel: '#FFF0F5',\n      border: '#F0D4E4',\n      textMain: '#6B4A5A',\n      textSub: '#B08A9A',\n      btnBg: '#FFE4E9',\n      btnHover: '#FFD4E4',\n      accent: '#E8B4D9',\n      tableHead: '#FFF5F9',\n      successText: '#D4A5C8',\n      successBg: 'rgba(212, 165, 200, 0.15)',\n      inputBg: '#FFF8FA',\n      inputText: '#6B4A5A',\n      placeholderText: '#C8A5B0',\n      btnActiveBg: '#E8B4D9',\n      btnActiveText: '#6B4A5A',\n      // \n      failureText: '#C88A9A',\n      failureBg: 'rgba(200, 138, 154, 0.15)',\n      warningText: '#D4A5A5',\n      warningBg: 'rgba(212, 165, 165, 0.15)',\n      critSuccessText: '#E8B4D9',\n      critSuccessBg: 'rgba(232, 180, 217, 0.2)',\n      critFailureText: '#C88A9A',\n      critFailureBg: 'rgba(200, 138, 154, 0.2)',\n      extremeSuccessText: '#D4A5C8',\n      extremeSuccessBg: 'rgba(212, 165, 200, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(232, 180, 217, 0.25)',\n      lightBg: 'rgba(232, 180, 217, 0.08)',\n      veryLightBg: 'rgba(232, 180, 217, 0.02)',\n      buttonText: '#6B4A5A',\n      grayBg: 'rgba(232, 180, 217, 0.1)',\n      // \n      buttonBg: 'rgba(232, 180, 217, 0.6)',\n      buttonBgActive: 'rgba(232, 180, 217, 0.75)',\n      presetButtonBg: 'rgba(232, 180, 217, 0.3)',\n      presetButtonBgActive: 'rgba(232, 180, 217, 0.6)',\n      // /\n      errorText: '#C88A9A',\n      errorBg: 'rgba(200, 138, 154, 0.15)',\n      errorBorder: 'rgba(200, 138, 154, 0.4)',\n      warningIcon: '#D4A5A5',\n      buttonTextOnAccent: '#6B4A5A',\n    },\n    vaporwave: {\n      bgPanel: '#191970',\n      border: 'rgba(0, 255, 255, 0.3)',\n      textMain: '#00FFFF',\n      textSub: '#FF00FF',\n      btnBg: 'rgba(25, 25, 112, 0.8)',\n      btnHover: 'rgba(0, 255, 255, 0.2)',\n      accent: '#00FFFF',\n      tableHead: 'rgba(25, 25, 112, 0.9)',\n      successText: '#00FFFF',\n      successBg: 'rgba(0, 255, 255, 0.15)',\n      inputBg: 'rgba(25, 25, 112, 0.6)',\n      inputText: '#00FFFF',\n      placeholderText: '#FF00FF',\n      btnActiveBg: '#FF00FF',\n      btnActiveText: '#F0F8FF',\n      // \n      failureText: '#FF00FF',\n      failureBg: 'rgba(255, 0, 255, 0.2)',\n      warningText: '#FF00FF',\n      warningBg: 'rgba(255, 0, 255, 0.15)',\n      critSuccessText: '#00FFFF',\n      critSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      critFailureText: '#FF00FF',\n      critFailureBg: 'rgba(255, 0, 255, 0.25)',\n      extremeSuccessText: '#00FFFF',\n      extremeSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(25, 25, 112, 0.85)',\n      overlayBgLight: 'rgba(25, 25, 112, 0.75)',\n      shadowBg: 'rgba(0, 255, 255, 0.3)',\n      lightBg: 'rgba(0, 255, 255, 0.05)',\n      veryLightBg: 'rgba(0, 255, 255, 0.02)',\n      buttonText: '#F0F8FF',\n      grayBg: 'rgba(0, 255, 255, 0.1)',\n      // \n      buttonBg: 'rgba(0, 255, 255, 0.6)',\n      buttonBgActive: 'rgba(255, 0, 255, 0.7)',\n      presetButtonBg: 'rgba(0, 255, 255, 0.3)',\n      presetButtonBgActive: 'rgba(0, 255, 255, 0.6)',\n      // /\n      errorText: '#FF00FF',\n      errorBg: 'rgba(255, 0, 255, 0.2)',\n      errorBorder: 'rgba(255, 0, 255, 0.5)',\n      warningIcon: '#FF00FF',\n      buttonTextOnAccent: '#191970',\n    },\n    classicpackaging: {\n      bgPanel: '#000000',\n      border: '#FFFF00',\n      textMain: '#FFFF00',\n      textSub: '#CCCC00',\n      btnBg: '#FF0000',\n      btnHover: '#CC0000',\n      accent: '#FF0000',\n      tableHead: '#1a1a1a',\n      successText: '#0000FF',\n      successBg: 'rgba(0, 0, 255, 0.2)',\n      inputBg: '#1a1a1a',\n      inputText: '#FFFF00',\n      placeholderText: '#666600',\n      btnActiveBg: '#0000FF',\n      btnActiveText: '#FFFF00',\n      // \n      failureText: '#FF0000',\n      failureBg: 'rgba(255, 0, 0, 0.2)',\n      warningText: '#FF0000',\n      warningBg: 'rgba(255, 0, 0, 0.15)',\n      critSuccessText: '#0000FF',\n      critSuccessBg: 'rgba(0, 0, 255, 0.2)',\n      critFailureText: '#FF0000',\n      critFailureBg: 'rgba(255, 0, 0, 0.25)',\n      extremeSuccessText: '#0000FF',\n      extremeSuccessBg: 'rgba(0, 0, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0, 0, 0, 0.9)',\n      overlayBgLight: 'rgba(0, 0, 0, 0.8)',\n      shadowBg: 'rgba(0, 0, 0, 0.6)',\n      lightBg: 'rgba(255, 255, 0, 0.1)',\n      veryLightBg: 'rgba(255, 255, 0, 0.02)',\n      buttonText: '#FFFF00',\n      grayBg: 'rgba(255, 255, 0, 0.1)',\n      // \n      buttonBg: '#FF0000',\n      buttonBgActive: '#CC0000',\n      presetButtonBg: 'rgba(255, 0, 0, 0.7)',\n      presetButtonBgActive: '#FF0000',\n      // /\n      errorText: '#FF0000',\n      errorBg: 'rgba(255, 0, 0, 0.2)',\n      errorBorder: 'rgba(255, 0, 0, 0.8)',\n      warningIcon: '#FF0000',\n      buttonTextOnAccent: '#FFFF00',\n    },\n    terminal: {\n      bgPanel: '#0c0c0c',\n      border: '#00ff00',\n      textMain: '#00ff00',\n      textSub: '#00cc00',\n      btnBg: '#1a1a1a',\n      btnHover: '#2a2a2a',\n      accent: '#00ff00',\n      tableHead: '#0a0a0a',\n      successText: '#00ff00',\n      successBg: 'rgba(0, 255, 0, 0.15)',\n      inputBg: '#0c0c0c',\n      inputText: '#00ff00',\n      placeholderText: '#008800',\n      btnActiveBg: '#00ff00',\n      btnActiveText: '#0c0c0c',\n      failureText: '#ff0000',\n      failureBg: 'rgba(255, 0, 0, 0.15)',\n      warningText: '#ffff00',\n      warningBg: 'rgba(255, 255, 0, 0.15)',\n      critSuccessText: '#00ffff',\n      critSuccessBg: 'rgba(0, 255, 255, 0.15)',\n      critFailureText: '#ff00ff',\n      critFailureBg: 'rgba(255, 0, 255, 0.15)',\n      extremeSuccessText: '#00ff00',\n      extremeSuccessBg: 'rgba(0, 255, 0, 0.2)',\n      overlayBg: 'rgba(0, 0, 0, 0.9)',\n      overlayBgLight: 'rgba(0, 0, 0, 0.8)',\n      shadowBg: 'rgba(0, 0, 0, 0.7)',\n      lightBg: 'rgba(0, 255, 0, 0.05)',\n      veryLightBg: 'rgba(0, 255, 0, 0.02)',\n      buttonText: '#0c0c0c',\n      grayBg: 'rgba(0, 255, 0, 0.05)',\n      errorText: '#ff0000',\n      errorBg: 'rgba(255, 0, 0, 0.15)',\n      errorBorder: 'rgba(255, 0, 0, 0.5)',\n      warningIcon: '#ffff00',\n      buttonTextOnAccent: '#0c0c0c',\n    },\n  };\n  const getThemeColors = () => {\n    const theme = THEME_COLORS[getConfig().theme] || THEME_COLORS['retro'];\n    // \n    if (!theme.buttonBg) {\n      theme.buttonBg = theme.accent;\n      theme.buttonBgActive = theme.accent;\n      theme.presetButtonBg = theme.btnBg;\n      theme.presetButtonBgActive = theme.accent;\n    }\n    // \n    if (!theme.buttonTextOnAccent) {\n      // \n      // \n      const isLightTheme =\n        theme.bgPanel &&\n        (theme.bgPanel.startsWith('#F') ||\n          theme.bgPanel.startsWith('#f') ||\n          theme.bgPanel.startsWith('#e') ||\n          theme.bgPanel.startsWith('#E') ||\n          theme.bgPanel.includes('255') ||\n          theme.bgPanel.includes('fff'));\n      theme.buttonTextOnAccent = isLightTheme ? theme.textMain || '#333' : '#fff';\n    }\n    return theme;\n  };\n  const getGMConfig = () => Store.get(STORAGE_KEY_GM_CONFIG, DEFAULT_GM_CONFIG);\n\n  // \n  const getResultBadgeStyle = (resultType, t) => {\n    // resultType: 'critSuccess' | 'extremeSuccess' | 'success' | 'warning' | 'failure' | 'critFailure'\n    const styles = {\n      critSuccess: {\n        bg: t.critSuccessText,\n        text: '#fff',\n      },\n      extremeSuccess: {\n        bg: t.extremeSuccessText,\n        text: '#fff',\n      },\n      success: {\n        bg: t.successText,\n        text: '#fff',\n      },\n      warning: {\n        bg: t.warningText,\n        text: '#fff',\n      },\n      failure: {\n        bg: t.failureText,\n        text: '#fff',\n      },\n      critFailure: {\n        bg: t.critFailureText,\n        text: '#fff',\n      },\n    };\n    const style = styles[resultType] || styles.failure;\n    return {\n      'background-color': style.bg,\n      color: style.text,\n      padding: '3px 8px',\n      'border-radius': '6px',\n      'font-size': '11px',\n      'font-weight': 'bold',\n      'white-space': 'nowrap',\n      display: 'inline-flex',\n      'align-items': 'center',\n    };\n  };\n\n  const getActionsForTable = tableName => {\n    const config = getGMConfig();\n    if (!config.enabled || !config.action_groups) return [];\n    const lowerName = tableName.toLowerCase();\n    for (const group of config.action_groups) {\n      const matched = group.table_keywords.some(keyword => lowerName.includes(keyword.toLowerCase()));\n      if (matched) return group.actions || [];\n    }\n    return [];\n  };\n  const isNumericCell = value => {\n    if (value === null || value === undefined || value === '') return false;\n    const str = String(value).trim();\n    // : (50/100)/: \n    return (\n      /^-?\\d+(\\.\\d+)?%?$/.test(str) ||\n      /^\\d+\\/\\d+$/.test(str) ||\n      /^[\\u4e00-\\u9fa5a-zA-Z]+[:\\s]\\s*\\d+/i.test(str) ||\n      /\\d+/.test(str)\n    );\n  };\n\n  const extractNumericValue = value => {\n    if (!value) return 0;\n    const str = String(value).trim();\n    //  (50/100 -> )\n    if (/^\\d+\\/\\d+$/.test(str)) return parseInt(str.split('/')[0], 10);\n    // \n    if (str.endsWith('%')) return parseInt(str.replace('%', ''), 10);\n    //  \":\" \n    const matches = str.match(/\\d+/g);\n    if (matches && matches.length > 0) {\n      return parseInt(matches[matches.length - 1], 10);\n    }\n    return 0;\n  };\n\n  const parseAttributeString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    //  JSON  {\"\":, ...}\n    if (rawStr.startsWith('{') && rawStr.endsWith('}')) {\n      try {\n        const jsonObj = JSON.parse(rawStr);\n        for (const key in jsonObj) {\n          const val = jsonObj[key];\n          if (typeof val === 'number') {\n            results.push({ name: key, value: val });\n          } else if (typeof val === 'string' && /^\\d+$/.test(val)) {\n            results.push({ name: key, value: parseInt(val, 10) });\n          }\n        }\n        if (results.length > 0) return results;\n      } catch (e) {\n        // JSON \n      }\n    }\n\n    //  \":; :\" \n    const parts = rawStr.split(/[,;\\s]+/);\n    for (const part of parts) {\n      const match = part.match(/^\"?([\\u4e00-\\u9fa5a-zA-Z_]+)\"?[:\\s]\\s*\"?(-?\\d+)\"?/);\n      if (match) {\n        results.push({ name: match[1], value: parseInt(match[2], 10) });\n      }\n    }\n    return results;\n  };\n  // [] :\n  // 1: \"();()\"\n  // 2: \":;:\"\n  // 3: \":,;:\"\n  const parseRelationshipString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    // \n    const parts = rawStr.split(/[;]/);\n    for (const part of parts) {\n      const trimmed = part.trim();\n      if (!trimmed) continue;\n\n      // 2/3: \":\"  \"\"\n      const colonMatch = trimmed.match(/^?(.+?)[:\\](.+)$/);\n      if (colonMatch) {\n        const name = colonMatch[1].trim();\n        const relation = colonMatch[2].trim();\n        if (name && relation) {\n          results.push({ name: name, relation: relation });\n          continue;\n        }\n      }\n\n      // 1: \"()\"  \"\"\n      const parenMatch = trimmed.match(/^([^(]+)[(]([^)]+)[)]$/);\n      if (parenMatch) {\n        results.push({ name: parenMatch[1].trim(), relation: parenMatch[2].trim() });\n        continue;\n      }\n\n      // \n      if (trimmed.length > 0) {\n        results.push({ name: trimmed, relation: '' });\n      }\n    }\n    return results;\n  };\n\n  // [] \n  const isRelationshipCell = (value, headerName) => {\n    if (!value) return false;\n    const str = String(value).trim();\n    const lowerHeader = (headerName || '').toLowerCase();\n    // \"\"\n    if (lowerHeader.includes('') || lowerHeader.includes('')) {\n      return true;\n    }\n    //  \"();()\" \n    return /^[^(;]+[(][^)]+[)]([;][^(;]+[(][^)]+[)])*$/.test(str);\n  };\n\n  const processTemplate = (template, cardData, headers) => {\n    if (!template || !cardData) return template;\n    let result = template;\n    const name = cardData[1] || '';\n    result = result.replace(/\\{Name\\}/gi, name);\n    result = result.replace(/\\{RowIndex\\}/gi, cardData[0] || '0');\n    if (headers && headers.length > 0) {\n      headers.forEach((header, idx) => {\n        if (header && idx < cardData.length) {\n          const value = cardData[idx] || '';\n          const regex = new RegExp(`\\\\{${header}\\\\}`, 'gi');\n          result = result.replace(regex, value);\n        }\n      });\n    }\n    result = result.replace(/\\{[^}]+\\}/g, '');\n    return result;\n  };\n\n  // \n  const ACTION_BUTTONS = [\n    { id: 'acu-btn-save-global', icon: 'fa-save', title: '' },\n    { id: 'acu-btn-refresh', icon: 'fa-sync-alt', title: '' },\n    { id: 'acu-btn-collapse', icon: 'fa-chevron-down', title: '' },\n    // {id: 'acu-btn-open-editor', icon: 'fa-table-columns', title: ''},\n    { id: 'acu-btn-refill', icon: 'fa-bolt', title: '' },\n    { id: 'acu-btn-settings', icon: 'fa-cog', title: '' },\n  ];\n\n  let isInitialized = false;\n  let isSaving = false;\n  let isEditingOrder = false;\n  let isSettingsOpen = false;\n  let currentDiffMap = new Set();\n  let observer = null;\n  let _boundRenderHandler = null;\n\n  // ---  ---\n  let cachedRawData = null;\n  let hasUnsavedChanges = false;\n  let isAutoTransforming = false; // \n  let tablePageStates = {};\n  let tableSearchStates = {};\n  let lastOptionHash = null;\n  let optionPanelVisible = false; // [] \n  // [] \n  const STORAGE_KEY_SCROLL = 'acu_scroll_v19_fixed';\n  let tableScrollStates = {};\n  try {\n    const saved = localStorage.getItem(STORAGE_KEY_SCROLL);\n    if (saved) tableScrollStates = JSON.parse(saved);\n  } catch (e) {\n    console.warn('[DICE]ACU Error:', e);\n  }\n  // [] \n  const UpdateController = {\n    _lastValidationCount: 0,\n    _isRollingBack: false, // \n\n    handleUpdate: () => {\n      // \n      if (UpdateController._isRollingBack) return;\n\n      // ===  intercept  ===\n      try {\n        const snapshot = loadSnapshot();\n        const newData = getTableData();\n        if (snapshot && newData) {\n          const rules = ValidationRuleManager.getEnabledRules();\n          const violations = ValidationEngine.checkTableRules(snapshot, newData, rules);\n\n          if (violations.length > 0) {\n            console.warn('[DICE]ACU :', violations);\n            UpdateController._isRollingBack = true;\n\n            //  API \n            const api = getCore().getDB();\n            if (api?.fillTable) {\n              try {\n                api.fillTable(snapshot);\n                if (window.toastr) {\n                  window.toastr.error(violations[0].message, '', {\n                    timeOut: 5000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              } catch (fillError) {\n                console.error('[DICE]ACU fillTable :', fillError);\n                // \n                if (window.toastr) {\n                  window.toastr.error(`: ${violations[0].message}`, '', {\n                    timeOut: 7000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              }\n            }\n\n            setTimeout(() => {\n              UpdateController._isRollingBack = false;\n            }, 500);\n            return;\n          }\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n      }\n\n      //  renderInterface \n      // \n      renderInterface();\n\n      // \n      setTimeout(() => {\n        try {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            const errors = ValidationEngine.validateAllData(rawData);\n            const newCount = errors.length;\n\n            // \n            if (newCount > UpdateController._lastValidationCount && newCount > 0) {\n              // \n            }\n\n            UpdateController._lastValidationCount = newCount;\n\n            // \n            updateValidationIndicator(newCount);\n          }\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n        }\n      }, 100);\n    },\n  };\n\n  // \n  const updateValidationIndicator = count => {\n    const { $ } = getCore();\n    const $indicator = $('.acu-validation-indicator');\n\n    if (count > 0) {\n      if ($indicator.length) {\n        $indicator.find('.acu-validation-count').text(count);\n        $indicator.show();\n      }\n    } else {\n      $indicator.hide();\n    }\n  };\n\n  // --- []  ---\n  const getCurrentContextFingerprint = () => {\n    try {\n      // 1:  API\n      if (typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId) {\n        return SillyTavern.getCurrentChatId();\n      }\n      // 2: \n      if (typeof SillyTavern !== 'undefined' && SillyTavern.chatId) {\n        return SillyTavern.chatId;\n      }\n      // 3:  (iframe )\n      if (window.parent?.SillyTavern?.getCurrentChatId) {\n        return window.parent.SillyTavern.getCurrentChatId();\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getCurrentContextFingerprint error:', e);\n    }\n    return 'unknown_context';\n  };\n\n  //  ()\n\n  const DEFAULT_CONFIG = {\n    layout: 'horizontal',\n    collapseStyle: 'bar',\n    collapseAlign: 'right',\n    fontFamily: 'default',\n    theme: 'retro',\n    cardWidth: 260,\n    fontSize: 13,\n    highlightNew: true,\n    itemsPerPage: 50,\n    actionsPosition: 'bottom',\n    gridColumns: 'auto', // [] \n    positionMode: 'fixed', // fixed=, embedded=\n    showOptionPanel: true, // [] \n    clickOptionToAutoSend: true, // [] \n    optionFontSize: 12, // [] \n  };\n\n  const FONTS = [\n    { id: 'default', name: ' (Modern)', val: `'Segoe UI', 'Microsoft YaHei', sans-serif` },\n    { id: 'hanchan', name: '', val: `\"\", sans-serif` },\n    { id: 'maple', name: 'Maple Mono ()', val: `\"Maple Mono NF CN\", monospace` },\n    { id: 'huiwen', name: ' (Huiwen)', val: `\"Huiwen-mincho\", serif` },\n    { id: 'cooper', name: 'Cooper', val: `\"CooperZhengKai\", serif` },\n    { id: 'yffyt', name: 'YFFYT ()', val: `\"YFFYT\", sans-serif` },\n    { id: 'fusion', name: 'Fusion Pixel ()', val: `\"Fusion Pixel 12px M latin\", monospace` },\n    { id: 'wenkai', name: ' (WenKai)', val: `\"LXGW WenKai\", serif` },\n    { id: 'notosans', name: ' (Noto Sans)', val: `\"Noto Sans CJK\", sans-serif` },\n    { id: 'zhuque', name: ' (Zhuque)', val: `\"Zhuque Fangsong (technical preview)\", serif` },\n  ];\n\n  const THEMES = [\n    { id: 'retro', name: ' (Retro)', icon: 'fa-scroll' },\n    { id: 'dark', name: ' (Dark)', icon: 'fa-moon' },\n    { id: 'modern', name: ' (Modern)', icon: 'fa-sun' },\n    { id: 'forest', name: ' (Forest)', icon: 'fa-tree' },\n    { id: 'ocean', name: ' (Ocean)', icon: 'fa-water' },\n    { id: 'cyber', name: ' (Cyber)', icon: 'fa-bolt' },\n    { id: 'nightowl', name: ' (Night Owl)', icon: 'fa-feather' },\n    { id: 'sakura', name: ' (Warm Pink)', icon: 'fa-heart' },\n    { id: 'minepink', name: ' (Mine Pink)', icon: 'fa-skull' },\n    { id: 'galgame', name: ' (Galgame Pink)', icon: 'fa-heart' },\n    { id: 'purple', name: ' (Purple)', icon: 'fa-gem' },\n    { id: 'wechat', name: ' (Green Bubble)', icon: 'fa-weixin' },\n    { id: 'educational', name: ' (Educational)', icon: 'fa-book' },\n    { id: 'vaporwave', name: ' (Vaporwave)', icon: 'fa-palette' },\n    { id: 'classicpackaging', name: ' (Classic Packaging)', icon: 'fa-box' },\n    { id: 'terminal', name: ' (Terminal)', icon: 'fa-terminal' },\n  ];\n\n  // []  core  ( +  ST )\n  let _coreCache = null;\n  const getCore = () => {\n    const w = window.parent || window;\n    //  jQuery\n    const $ = window.jQuery || w.jQuery;\n\n    // ($)\n    if (_coreCache && _coreCache.$) return _coreCache;\n\n    const core = {\n      $: $,\n      getDB: () => w.AutoCardUpdaterAPI || window.AutoCardUpdaterAPI,\n      clipboard: w.navigator.clipboard,\n      //   ->  ->  ()\n      ST:\n        window.SillyTavern ||\n        w.SillyTavern ||\n        (() => {\n          try {\n            return window.top ? window.top.SillyTavern : null;\n          } catch (e) {\n            return null;\n          }\n        })(),\n    };\n\n    //  jQuery \n    if ($) _coreCache = core;\n    return core;\n  };\n\n  const updateSaveButtonState = () => {\n    const { $ } = getCore();\n    const $btn = $('#acu-btn-save-global');\n    const $icon = $btn.find('i');\n    const deletions = getPendingDeletions();\n    let hasDeletions = false;\n    if (deletions) {\n      for (const key in deletions) {\n        if (deletions[key] && deletions[key].length > 0) {\n          hasDeletions = true;\n          break;\n        }\n      }\n    }\n    if (hasUnsavedChanges || hasDeletions) {\n      $icon.addClass('acu-icon-breathe');\n      $btn.attr('title', '');\n    } else {\n      $icon.removeClass('acu-icon-breathe');\n      $btn.attr('title', '');\n      $btn.css('color', '');\n    }\n  };\n\n  const getIconForTableName = name => {\n    if (!name) return 'fa-table';\n    const n = name.toLowerCase();\n    if (n.includes('') || n.includes('')) return 'fa-user-circle';\n    if (n.includes('') || n.includes('')) return 'fa-globe-asia';\n    if (n.includes('') || n.includes('')) return 'fa-briefcase';\n    if (n.includes('') || n.includes('')) return 'fa-dragon';\n    if (n.includes('') || n.includes('')) return 'fa-user-friends';\n    if (n.includes('') || n.includes('')) return 'fa-scroll';\n    if (n.includes('') || n.includes('')) return 'fa-address-book';\n    if (n.includes('') || n.includes('')) return 'fa-book-reader';\n    if (n.includes('') || n.includes('')) return 'fa-map-location-dot';\n    if (n.includes('') || n.includes('') || n.includes('')) return 'fa-bullseye';\n    if (n.includes('') || n.includes('')) return 'fa-shield-halved';\n    if (n.includes('')) return 'fa-gem';\n    if (n.includes('') || n.includes('')) return 'fa-file-lines';\n    if (n.includes('')) return 'fa-list-check';\n    return 'fa-table';\n  };\n\n  const getBadgeStyle = text => {\n    if (!text) return '';\n    const str = String(text).trim();\n    if (/^[0-9]+%?$/.test(str) || /^Lv\\.\\d+$/.test(str)) return 'acu-badge-green';\n    if (str.length <= 6 && !str.includes('http')) return 'acu-badge-neutral';\n    if (['', '', '', '', '', ''].includes(str)) return 'acu-badge-neutral';\n    return '';\n  };\n\n  // []  ()\n  const Store = {\n    get: (key, def = null) => {\n      try {\n        return JSON.parse(localStorage.getItem(key)) ?? def;\n      } catch {\n        return def;\n      }\n    },\n    set: (key, val) => {\n      try {\n        localStorage.setItem(key, JSON.stringify(val));\n      } catch (e) {\n        // \n        if (e.name === 'QuotaExceededError' || e.message.includes('quota')) {\n          console.warn('[DICE]ACU ...');\n          try {\n            // 1.  ()\n            localStorage.removeItem(STORAGE_KEY_LAST_SNAPSHOT);\n\n            // 2. \n            localStorage.setItem(key, JSON.stringify(val));\n          } catch (retryErr) {\n            // \n            console.error('[DICE]ACU Store ', retryErr);\n            if (window.toastr && !window._acuQuotaAlerted) {\n              window.toastr.warning(' ');\n              window._acuQuotaAlerted = true;\n              setTimeout(() => (window._acuQuotaAlerted = false), 10000);\n            }\n          }\n        } else {\n          console.error('[DICE]ACU Store', e);\n        }\n      }\n    },\n  };\n\n  const getActiveTabState = () => Store.get(STORAGE_KEY_ACTIVE_TAB);\n  const saveActiveTabState = v => Store.set(STORAGE_KEY_ACTIVE_TAB, v);\n  const getPendingDeletions = () => Store.get(STORAGE_KEY_PENDING_DELETIONS, {});\n  const savePendingDeletions = v => Store.set(STORAGE_KEY_PENDING_DELETIONS, v);\n  const getSavedTableOrder = () => Store.get(STORAGE_KEY_TABLE_ORDER);\n  const saveTableOrder = v => Store.set(STORAGE_KEY_TABLE_ORDER, v);\n  const getCollapsedState = () => Store.get(STORAGE_KEY_IS_COLLAPSED, false);\n  const saveCollapsedState = v => Store.set(STORAGE_KEY_IS_COLLAPSED, v);\n  // []  (Chat ID)\n  const loadSnapshot = () => {\n    const data = Store.get(STORAGE_KEY_LAST_SNAPSHOT);\n    if (!data) return null;\n    // \n    const currentCtx = getCurrentContextFingerprint();\n    // \n    if (data._contextId && data._contextId !== currentCtx) {\n      return null;\n    }\n    return data;\n  };\n\n  // [] \n  const saveSnapshot = v => {\n    if (!v) return;\n    //  ChatID\n    if (typeof v === 'object') {\n      v._contextId = getCurrentContextFingerprint();\n    }\n    Store.set(STORAGE_KEY_LAST_SNAPSHOT, v);\n  };\n\n  // --- []  ---\n  const getTableHeights = () => Store.get(STORAGE_KEY_TABLE_HEIGHTS, {});\n  const saveTableHeights = v => Store.set(STORAGE_KEY_TABLE_HEIGHTS, v);\n  const getTableStyles = () => Store.get(STORAGE_KEY_TABLE_STYLES, {});\n  const saveTableStyles = v => Store.set(STORAGE_KEY_TABLE_STYLES, v);\n  const getHiddenTables = () => Store.get(STORAGE_KEY_HIDDEN_TABLES, []);\n  const saveHiddenTables = v => Store.set(STORAGE_KEY_HIDDEN_TABLES, v);\n  const getReverseTables = () => Store.get(STORAGE_KEY_REVERSE_TABLES, []);\n  const saveReverseTables = v => Store.set(STORAGE_KEY_REVERSE_TABLES, v);\n\n  // \n  const shouldShowReverseButton = tableName => {\n    if (!tableName) return false;\n    const keywords = ['', '', '', '', ''];\n    return keywords.some(kw => tableName.includes(kw));\n  };\n\n  // \n  const isTableReversed = tableName => {\n    return getReverseTables().includes(tableName);\n  };\n\n  // \n  const toggleTableReverse = tableName => {\n    const list = getReverseTables();\n    const idx = list.indexOf(tableName);\n    if (idx >= 0) {\n      list.splice(idx, 1);\n    } else {\n      list.push(tableName);\n    }\n    saveReverseTables(list);\n    console.log('[DICE]ACU toggleTableReverse:', tableName, 'reversed:', idx < 0);\n  };\n  // [] \n  const getAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          let attrs = [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.includes(attr.name)) attrs.push(attr.name);\n              });\n            }\n          });\n          if (attrs.length > 0) return attrs;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            let attrs = [];\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.includes(attr.name)) attrs.push(attr.name);\n                });\n              }\n            });\n            return attrs;\n          }\n        }\n      }\n    }\n\n    return [];\n  };\n  // [] \n  const getAttributeValue = (characterName, attrName) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData || !attrName) return null;\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          for (let idx = 0; idx < headers.length; idx++) {\n            const h = headers[idx];\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              const found = parsed.find(attr => attr.name === attrName);\n              if (found) return found.value;\n            }\n          }\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            for (let idx = 0; idx < headers.length; idx++) {\n              const h = headers[idx];\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                const found = parsed.find(attr => attr.name === attrName);\n                if (found) return found.value;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n  // [] 6\n  const STANDARD_ATTRS = ['', '', '', '', '', ''];\n\n  /**\n   * \n   */\n  const getStandardAttrs = () => {\n    const preset = AttributePresetManager.getActivePreset();\n    if (preset && preset.baseAttributes) {\n      return preset.baseAttributes.map(attr => attr.name);\n    }\n    return STANDARD_ATTRS;\n  };\n\n  /**\n   * \n   * \n   *  + \n   */\n  const getRandomSkillPool = () => {\n    try {\n      const preset = AttributePresetManager.getActivePreset();\n      if (preset) {\n        //  + \n        const allAttrs = new Set();\n\n        // \n        if (preset.baseAttributes && Array.isArray(preset.baseAttributes)) {\n          preset.baseAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        // \n        if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n          preset.specialAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        return Array.from(allAttrs);\n      }\n\n      // \n      const allPresets = AttributePresetManager.getAllPresets() || [];\n      const allAttrs = new Set(RANDOM_SKILL_POOL || []); // \n\n      // \n      if (Array.isArray(allPresets)) {\n        allPresets.forEach(p => {\n          if (!p) return;\n\n          // \n          if (p.baseAttributes && Array.isArray(p.baseAttributes)) {\n            p.baseAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n\n          // \n          if (p.specialAttributes && Array.isArray(p.specialAttributes)) {\n            p.specialAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n        });\n      }\n\n      return Array.from(allAttrs);\n    } catch (err) {\n      console.error('[DICE]ACU getRandomSkillPool :', err);\n      return RANDOM_SKILL_POOL || [];\n    }\n  };\n\n  // [] \n  const RANDOM_SKILL_POOL = [\n    // ---  (Physical & Movement) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Social & Psychological) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    // /\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Technical & Crafting) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Knowledge & Investigation) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Combat & Special) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  // []  COC/DND 6\n  /**\n   * \n   * @param isDNDOrPreset ()    null()\n   * @returns { base: {...}, special: {...} }  {...}\n   */\n  const generateRPGAttributes = (isDNDOrPreset = undefined) => {\n    // \n    if (typeof isDNDOrPreset === 'boolean') {\n      const isDND = isDNDOrPreset;\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n\n      const generateValue = () => {\n        if (isDND) {\n          const base = generate3d6();\n          const adjust = rollDice(4) - 2;\n          return Math.max(3, Math.min(18, base + adjust));\n        } else {\n          const base = generate3d6() * 5;\n          const adjust = rollDice(10) - 5;\n          return Math.max(5, Math.min(95, base + adjust));\n        }\n      };\n\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        result[attr] = generateValue();\n      });\n      return result; // \n    }\n\n    // \n    const preset = isDNDOrPreset || AttributePresetManager.getActivePreset();\n\n    // \n    if (!preset) {\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        const base = generate3d6() * 5;\n        const adjust = rollDice(10) - 5;\n        result[attr] = Math.max(5, Math.min(95, base + adjust));\n      });\n      return { base: result, special: {} };\n    }\n\n    // \n    const baseResult = {};\n    preset.baseAttributes.forEach(attr => {\n      const formula = attr.modifier ? `${attr.formula}+${attr.modifier}` : attr.formula;\n      baseResult[attr.name] = generateAttributeValue(formula, attr.range, {});\n    });\n\n    // \n    const specialResult = {};\n    if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n      preset.specialAttributes.forEach(attr => {\n        specialResult[attr.name] = generateAttributeValue(attr.formula, attr.range, baseResult);\n      });\n    }\n\n    return { base: baseResult, special: specialResult };\n  };\n\n  // [] \n  const clearPresetAttributesForCharacter = async charName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // NPC//\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    const customAttrs = existingAttrs.filter(attr => !presetAttrNames.has(attr.name));\n    const newAttrString = customAttrs.map(attr => `${attr.name}:${attr.value}`).join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData);\n\n    return {\n      success: true,\n      attrString: newAttrString,\n    };\n  };\n\n  // [] \n  const writeAttributesToCharacter = async (charName, newAttrs, isDND = false) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \"\"\n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // \n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('\"\"');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const existingMap = {};\n    existingAttrs.forEach(attr => {\n      existingMap[attr.name] = attr.value;\n    });\n\n    // +\n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    let standardCount = 0;\n    standardAttrs.forEach(attrName => {\n      if (existingMap[attrName] !== undefined) {\n        standardCount++;\n      }\n    });\n    const isComplete = standardCount === standardAttrs.length;\n\n    // \n    const customAttrs = [];\n    existingAttrs.forEach(attr => {\n      if (!presetAttrNames.has(attr.name)) {\n        customAttrs.push({ name: attr.name, value: attr.value });\n      }\n    });\n\n    // \n    const resultParts = [];\n\n    // 1. \n    standardAttrs.forEach(attrName => {\n      if (isComplete) {\n        //   \n        const newValue = newAttrs[attrName] !== undefined ? newAttrs[attrName] : existingMap[attrName];\n        if (newValue !== undefined) {\n          resultParts.push(`${attrName}:${newValue}`);\n        }\n      } else {\n        //   \n        if (existingMap[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        } else if (newAttrs[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        }\n      }\n    });\n\n    // 2. \n    Object.keys(newAttrs).forEach(attrName => {\n      if (!standardAttrs.includes(attrName)) {\n        // \n        if (isComplete || !existingMap[attrName]) {\n          // \n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        } else {\n          // \n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        }\n      }\n    });\n\n    // 3. \n    customAttrs.forEach(attr => {\n      resultParts.push(`${attr.name}:${attr.value}`);\n    });\n\n    const newAttrString = resultParts.join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData);\n\n    // UI\n    const writtenAttrs = [];\n    standardAttrs.forEach(attrName => {\n      writtenAttrs.push({ name: attrName, value: newAttrs[attrName] });\n    });\n\n    return {\n      success: true,\n      attrs: writtenAttrs,\n      attrString: newAttrString,\n      wasComplete: isComplete,\n    };\n  };\n  // [] \"\"\n  const getFullAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n    let attrs = [];\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.some(a => a.name === attr.name)) {\n                  attrs.push(attr);\n                }\n              });\n            }\n          });\n          if (attrs.length > 0) break;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.some(a => a.name === attr.name)) {\n                    attrs.push(attr);\n                  }\n                });\n              }\n            });\n            break;\n          }\n        }\n        if (attrs.length > 0) break;\n      }\n    }\n\n    return attrs;\n  };\n  // [] \n  const initCustomDropdown = ($input, options, themeColors) => {\n    const { $ } = getCore();\n    const t = themeColors || {};\n    const inputId = $input.attr('id') || 'dd_' + Math.random().toString(36).substr(2, 9);\n    $input.attr('id', inputId);\n\n    // \n    $input.parent().find('.acu-dropdown-list').remove();\n\n    //  wrapper\n    if (!$input.parent().hasClass('acu-dropdown-wrapper')) {\n      $input.wrap('<div class=\"acu-dropdown-wrapper\"></div>');\n    }\n\n    // \n    const $dropdown = $(`<div class=\"acu-dropdown-list\" data-for=\"${inputId}\"></div>`);\n    $dropdown.css({\n      background: t.bgPanel || '#fff',\n      'border-color': t.border || '#ccc',\n    });\n    $input.after($dropdown);\n\n    const renderItems = (filter = '') => {\n      const lowerFilter = filter.toLowerCase();\n      const filtered = options.filter(opt => opt.toLowerCase().includes(lowerFilter));\n\n      if (filtered.length === 0) {\n        $dropdown.html(`<div class=\"acu-dropdown-empty\" style=\"color:${t.textSub || '#999'};\"></div>`);\n      } else {\n        $dropdown.html(\n          filtered\n            .map(\n              opt =>\n                `<div class=\"acu-dropdown-item\" data-value=\"${escapeHtml(opt)}\" style=\"color:${t.textMain || '#333'};\">${escapeHtml(opt)}</div>`,\n            )\n            .join(''),\n        );\n      }\n    };\n\n    const showDropdown = () => {\n      $('.acu-dropdown-list').removeClass('visible');\n      renderItems($input.val());\n      $dropdown.addClass('visible');\n    };\n\n    const hideDropdown = () => {\n      $dropdown.removeClass('visible');\n    };\n\n    // \n    $input.off('.acudd').on('focus.acudd click.acudd', function (e) {\n      e.stopPropagation();\n      showDropdown();\n    });\n\n    // \n    $input.on('input.acudd', function () {\n      renderItems($(this).val());\n    });\n\n    // hover \n    $dropdown\n      .on('mouseenter', '.acu-dropdown-item', function () {\n        $(this).css('background', t.tableHead || 'rgba(128,128,128,0.15)');\n      })\n      .on('mouseleave', '.acu-dropdown-item', function () {\n        $(this).css('background', 'transparent');\n      });\n\n    // \n    $dropdown.on('click', '.acu-dropdown-item', function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      const val = $(this).data('value');\n      $input.val(val).trigger('change');\n      hideDropdown();\n    });\n\n    // \n    $dropdown.on('click', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $input\n      .closest('.acu-dice-panel, .acu-contest-panel')\n      .off('click.acudd_' + inputId)\n      .on('click.acudd_' + inputId, function (e) {\n        if (!$(e.target).closest('.acu-dropdown-wrapper').length) {\n          hideDropdown();\n        }\n      });\n  };\n  // [] \n  const addClearButton = ($panel, inputSelector, themeColors) => {\n    const { $ } = getCore();\n    const t = themeColors || {};\n    $panel.find(inputSelector).each(function () {\n      const $input = $(this);\n      // \n      if ($input.parent().hasClass('acu-input-wrapper')) return;\n      // \n      $input.wrap('<div class=\"acu-input-wrapper\"></div>');\n      //  - \n      const $clearBtn = $(\n        `<button type=\"button\" class=\"acu-clear-btn\" title=\"\" style=\"color:${t.textSub || '#999'};\"><i class=\"fa-solid fa-times\"></i></button>`,\n      );\n      $input.after($clearBtn);\n      // \n      $clearBtn.on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        $input.val('').trigger('input').trigger('change').focus();\n      });\n      //  - \n      $clearBtn\n        .on('mouseenter', function () {\n          $(this).css({ color: t.accent || '#7a695f', opacity: '1' });\n        })\n        .on('mouseleave', function () {\n          $(this).css({ color: t.textSub || '#999', opacity: '0.5' });\n        });\n    });\n  };\n  // [] \n  const showDiceSettingsPanel = (isDND = false) => {\n    const { $ } = getCore();\n    $('.acu-dice-config-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    const ruleTitle = isDND ? 'DND ' : 'COC ';\n    const resetText = isDND ? ' DND ' : ' COC ';\n\n    // \n    const defaults = isDND\n      ? { critSuccess: 20, critFail: 1 }\n      : { critSuccess: 5, critFail: 96, hardDiv: 2, extremeDiv: 5 };\n\n    //  placeholder\n    const currentCritSuccess = isDND\n      ? diceCfg.dndCritSuccess !== undefined && diceCfg.dndCritSuccess !== defaults.critSuccess\n        ? diceCfg.dndCritSuccess\n        : ''\n      : diceCfg.critSuccessMax !== undefined && diceCfg.critSuccessMax !== defaults.critSuccess\n        ? diceCfg.critSuccessMax\n        : '';\n    const currentCritFail = isDND\n      ? diceCfg.dndCritFail !== undefined && diceCfg.dndCritFail !== defaults.critFail\n        ? diceCfg.dndCritFail\n        : ''\n      : diceCfg.critFailMin !== undefined && diceCfg.critFailMin !== defaults.critFail\n        ? diceCfg.critFailMin\n        : '';\n    const currentHardDiv =\n      !isDND && diceCfg.difficultSuccessDiv !== undefined && diceCfg.difficultSuccessDiv !== defaults.hardDiv\n        ? diceCfg.difficultSuccessDiv\n        : '';\n    const currentExtremeDiv =\n      !isDND && diceCfg.hardSuccessDiv !== undefined && diceCfg.hardSuccessDiv !== defaults.extremeDiv\n        ? diceCfg.hardSuccessDiv\n        : '';\n\n    const tieRule = diceCfg.contestTieRule || 'initiator_lose';\n    const hideDiceResultFromUser =\n      diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n    const hideDiceResultInChat = diceCfg.hideDiceResultInChat !== undefined ? diceCfg.hideDiceResultInChat : false;\n\n    const cocExtraHtml = isDND\n      ? ''\n      : `\n            <div class=\"acu-dice-cfg-row\">\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-hard-div\" data-min=\"2\" data-max=\"5\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentHardDiv || defaults.hardDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-extreme-div\" data-min=\"3\" data-max=\"10\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentExtremeDiv || defaults.extremeDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const panelHtml = `\n            <div class=\"acu-dice-config-overlay\">\n                <div class=\"acu-dice-config-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-dice-cfg-header\">\n                        <span><i class=\"fa-solid fa-cog\"></i> ${ruleTitle}</span>\n                        <button class=\"acu-config-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-dice-cfg-body\">\n                        <div class=\"acu-dice-cfg-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-success\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritSuccess || defaults.critSuccess}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-fail\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritFail || defaults.critFail}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                        ${cocExtraHtml}\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <select id=\"cfg-tie-rule\">\n                                    <option value=\"initiator_lose\" ${tieRule === 'initiator_lose' ? 'selected' : ''}> ()</option>\n                                    <option value=\"tie\" ${tieRule === 'tie' ? 'selected' : ''}></option>\n                                    <option value=\"initiator_win\" ${tieRule === 'initiator_win' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label></label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result\" ${hideDiceResultFromUser ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label></label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result-chat\" ${hideDiceResultInChat ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-actions\">\n                            <button id=\"cfg-reset-dice\">${resetText}</button>\n                            <button id=\"cfg-save-dice\"></button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $panel = $(panelHtml);\n    $('body').append($panel);\n\n    $panel.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '2147483655',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    // \n    const theme = getThemeColors();\n    $panel.find('#cfg-reset-dice, #cfg-save-dice').css({\n      background: theme.btnBg,\n      color: theme.textMain,\n      borderColor: theme.border,\n    });\n    $panel.find('#cfg-reset-dice, #cfg-save-dice').hover(\n      function () {\n        $(this).css({\n          background: theme.btnHover,\n          borderColor: theme.btnHover,\n        });\n      },\n      function () {\n        $(this).css({\n          background: theme.btnBg,\n          borderColor: theme.border,\n        });\n      },\n    );\n\n    const closePanel = () => $panel.remove();\n    $panel.find('.acu-config-close').click(closePanel);\n    $panel.on('click', e => {\n      if ($(e.target).hasClass('acu-dice-config-overlay')) closePanel();\n    });\n\n    // === Stepper  ===\n    $panel.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        $value.text(newVal);\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    $panel.find('#cfg-save-dice').click(function () {\n      const newCfg = { contestTieRule: $('#cfg-tie-rule').val() };\n\n      // stepper\n      const getStepperValue = id => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          const text = $stepper.find('.acu-stepper-value').text().replace(/[^\\d]/g, '');\n          return text !== '' ? parseInt(text, 10) : null;\n        }\n        return null;\n      };\n\n      const critSuccessVal = getStepperValue('cfg-crit-success');\n      const critFailVal = getStepperValue('cfg-crit-fail');\n\n      if (isDND) {\n        newCfg.dndCritSuccess = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.dndCritFail = critFailVal !== null ? critFailVal : defaults.critFail;\n      } else {\n        newCfg.critSuccessMax = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.critFailMin = critFailVal !== null ? critFailVal : defaults.critFail;\n\n        const hardDivVal = getStepperValue('cfg-hard-div');\n        const extremeDivVal = getStepperValue('cfg-extreme-div');\n        newCfg.difficultSuccessDiv = hardDivVal !== null ? hardDivVal : defaults.hardDiv;\n        newCfg.hardSuccessDiv = extremeDivVal !== null ? extremeDivVal : defaults.extremeDiv;\n      }\n\n      // \"\"\n      newCfg.hideDiceResultFromUser = $('#cfg-hide-dice-result').is(':checked');\n      // \"\"\n      newCfg.hideDiceResultInChat = $('#cfg-hide-dice-result-chat').is(':checked');\n\n      saveDiceConfig(newCfg);\n      // \n      console.info('[DICE]/...');\n      hideDiceResultsInUserMessages();\n      closePanel();\n    });\n\n    $panel.find('#cfg-reset-dice').click(function () {\n      // stepper\n      const resetStepper = (id, defaultValue) => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          $stepper.find('.acu-stepper-value').text(defaultValue);\n        }\n      };\n\n      resetStepper('cfg-crit-success', defaults.critSuccess);\n      resetStepper('cfg-crit-fail', defaults.critFail);\n      if (!isDND) {\n        resetStepper('cfg-hard-div', defaults.hardDiv);\n        resetStepper('cfg-extreme-div', defaults.extremeDiv);\n      }\n    });\n  };\n  // [] \n  const showDicePanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n    // 1d100\n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    // 1d100\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n    // [] \n    const rawDataForList = cachedRawData || getTableData();\n    let diceCharacterList = ['<user>'];\n    let diceAttrList = [];\n\n    if (rawDataForList) {\n      for (const key in rawDataForList) {\n        const sheet = rawDataForList[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '') {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) diceCharacterList.push(row[1]);\n          }\n        }\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const row = sheet.content[1];\n          const headers = sheet.content[0] || [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!diceAttrList.includes(attr.name)) diceAttrList.push(attr.name);\n              });\n            }\n          });\n        }\n      }\n    }\n    const {\n      targetValue = null, // []  null\n      targetName = '',\n      attrValue = null, // [] \n      diceType = savedDiceType, // \n      successCriteria = 'lte', // [] COC\n      onResult = null,\n      initiatorName = '', // [] \n      fromMvu = false, // [] MVU\n      mvuPath = null, // [] MVU\n      mvuParsedInfo = null, // [] \n    } = options;\n\n    // [] /DC\n    const isDND = diceType === '1d20' || successCriteria === 'gte';\n    let initialAttrValue = attrValue;\n    let initialTargetValue = targetValue;\n\n    // attrValuetargetValue\n    if (attrValue !== null && targetValue === null) {\n      if (isDND) {\n        initialTargetValue = Math.max(0, 20 - attrValue);\n      } else {\n        initialTargetValue = attrValue;\n      }\n    }\n\n    const t = getThemeColors();\n    const isCyberTheme = getConfig().theme === 'cyber';\n    const inputTextColor = isCyberTheme ? '#ff00ff' : t.inputText;\n    const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n    // \n    const inputStyle = `width:100%;padding:5px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:4px;color:${inputTextColor} !important;font-size:12px;text-align:center;box-sizing:border-box;`;\n\n    const overlay = $(\n      `<div class=\"acu-dice-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:${t.overlayBgLight};z-index:2147483647;\"></div>`,\n    );\n\n    // []  COC  DND\n    const successCriteriaOptions = [\n      { id: 'lte', name: ' (COC)' },\n      { id: 'gte', name: ' (DND)' },\n    ];\n\n    // [] \n    let defaultCriteria = successCriteria;\n    if (diceType === '1d100') defaultCriteria = 'lte';\n    else if (diceType === '1d20') defaultCriteria = 'gte';\n\n    const panel = $(`\n            <div class=\"acu-dice-panel acu-theme-${config.theme}\" style=\"\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 340px;\n                max-width: 90vw;\n                background: ${t.bgPanel};\n                border: 1px solid ${t.border};\n                border-radius: 12px;\n                box-shadow: 0 20px 60px ${t.shadowBg};\n                z-index: 2147483648;\n                overflow: hidden;\n            \">\n                <div style=\"padding: 12px 15px; background: ${t.tableHead}; border-bottom: 1px solid ${t.border}; display: flex; justify-content: space-between; align-items: center;\">\n                    <div style=\"font-size: 15px; font-weight: bold; color: ${t.accent}; display: flex; align-items: center; gap: 8px;\">\n                        <i class=\"fa-solid fa-dice-d20\"></i> \n                    </div>\n                    <div style=\"display: flex; align-items: center; gap: 8px;\">\n                        <button id=\"dice-switch-contest-top\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 14px; padding: 4px; transition: all 0.2s;\" title=\"\"><i class=\"fa-solid fa-people-arrows\"></i></button>\n                        <button class=\"acu-dice-config-btn\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 14px; padding: 4px; transition: all 0.2s;\" title=\"\">\n                            <i class=\"fa-solid fa-cog\"></i>\n                        </button>\n                        <button class=\"acu-dice-close\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 16px; padding: 4px;\">\n                            <i class=\"fa-solid fa-times\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div style=\"padding: 15px; max-height: 70vh; overflow-y: auto;\">\n                    <div style=\"display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; align-items: center;\" class=\"acu-dice-presets\">\n                        <button class=\"acu-dice-preset ${diceType === '1d20' ? 'active' : ''}\" data-dice=\"1d20\" data-criteria=\"gte\" style=\"padding: 4px 10px; background: ${diceType === '1d20' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${diceType === '1d20' ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\">1d20</button>\n                        <button class=\"acu-dice-preset ${diceType === '1d100' ? 'active' : ''}\" data-dice=\"1d100\" data-criteria=\"lte\" style=\"padding: 4px 10px; background: ${diceType === '1d100' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${diceType === '1d100' ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\">1d100</button>\n                        <button class=\"acu-dice-preset acu-dice-custom-btn\" data-dice=\"custom\" style=\"padding: 4px 10px; background: ${!['1d20', '1d100'].includes(diceType) ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${!['1d20', '1d100'].includes(diceType) ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\"></button>\n                        <input type=\"text\" id=\"dice-custom-input\" placeholder=\"2d6\" value=\"${!['1d20', '1d100'].includes(diceType) ? diceType : ''}\" style=\"width:60px;\">\n                    </div>\n\n                    <!--  -->\n                    <div style=\"margin-bottom: 10px;\">\n                        <div style=\"font-size: 11px; color: ${t.accent}; font-weight: bold; margin-bottom: 4px; display: flex; align-items: center; gap: 6px;\"><i class=\"fa-solid fa-user\"></i> </div>\n                        <div id=\"dice-char-buttons\" style=\"display: flex; flex-wrap: wrap; gap: 4px; max-height: 60px; overflow-y: auto;\"></div>\n                    </div>\n\n                    <!-- 1 +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-initiator-name\" value=\"${escapeHtml(initiatorName)}\" placeholder=\"<user>\" style=\"${inputStyle}\">\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; gap: 6px;\">\n                                \n                                <button type=\"button\" class=\"acu-random-skill-btn\" id=\"dice-random-skill\" title=\"\" style=\"width: 18px; height: 18px; padding: 0; background: transparent; border: 1px dashed ${t.accent}; border-radius: 4px; color: ${t.accent}; font-size: 9px; cursor: pointer; display: flex; align-items: center; justify-content: center;\">\n                                    <i class=\"fa-solid fa-dice\"></i>\n                                </button>\n                            </div>\n                            <input type=\"text\" id=\"dice-attr-name\" value=\"${escapeHtml(targetName || '')}\" placeholder=\"\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!-- 2 +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-attr-value\" value=\"${initialAttrValue !== null ? initialAttrValue : ''}\" placeholder=\"=50%\" style=\"${inputStyle}\">\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\" id=\"dice-target-label\"></div>\n                            <input type=\"text\" id=\"dice-target\" value=\"${initialTargetValue !== null ? initialTargetValue : ''}\" placeholder=\"=\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!-- 3 +  +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-bottom: 6px;\" id=\"dice-row-3\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; justify-content: center;\"></div>\n                            <select id=\"dice-success-criteria\" class=\"acu-dice-select\">\n                                ${successCriteriaOptions\n                                  .map(\n                                    opt =>\n                                      `<option value=\"${opt.id}\" ${opt.id === defaultCriteria ? 'selected' : ''}>${opt.name}</option>`,\n                                  )\n                                  .join('')}\n                            </select>\n                        </div>\n                        <div id=\"dice-difficulty-wrapper\">\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; justify-content: center;\"></div>\n                            <select id=\"dice-difficulty\" class=\"acu-dice-select\">\n                                <option value=\"normal\" selected></option>\n                                <option value=\"hard\"></option>\n                                <option value=\"extreme\"></option>\n                                <option value=\"critical\"></option>\n                            </select>\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-modifier\" value=\"0\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div style=\"margin-bottom: 10px;\">\n                        <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 4px;\"><i class=\"fa-solid fa-sliders\"></i> </div>\n                        <div id=\"dice-attr-buttons\" style=\"display: flex; flex-wrap: wrap; gap: 4px; max-height: 80px; overflow-y: auto;\"></div>\n                    </div>\n                    <!--  -->\n                    <input type=\"hidden\" id=\"dice-formula\" value=\"${diceType}\">\n\n                    <button id=\"dice-roll-btn\" style=\"width: 100%; padding: 12px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 8px; color: ${t.buttonText}; font-size: 15px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; position: relative;\">\n                        <i class=\"fa-solid fa-dice\"></i> \n                    </button>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay).append(panel);\n\n    // [] \n    const buildCharButtons = () => {\n      const $container = panel.find('#dice-char-buttons');\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.initiator) {\n        const initiator = mvuParsedInfo.initiator;\n        const shortName = initiator.length > 4 ? initiator.substring(0, 4) + '..' : initiator;\n        const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n        html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu\" data-char=\"${escapeHtml(initiator)}\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;white-space:nowrap;font-weight:bold;\" title=\": ${escapeHtml(initiator)}\">${escapeHtml(shortName)}</button>`;\n      }\n\n      // \n      diceCharacterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html += `<button class=\"acu-dice-char-btn\" data-char=\"${escapeHtml(name)}\" style=\"padding:3px 8px;background:${t.btnBg};border:1px solid ${t.border};border-radius:4px;color:${t.textMain};font-size:11px;cursor:pointer;white-space:nowrap;\" title=\"${escapeHtml(displayName)}\">${escapeHtml(shortName)}</button>`;\n      });\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.candidates && mvuParsedInfo.candidates.length > 0) {\n        mvuParsedInfo.candidates.forEach(candidate => {\n          // \n          if (mvuParsedInfo.initiator && candidate === mvuParsedInfo.initiator) return;\n          const shortName = candidate.length > 4 ? candidate.substring(0, 4) + '..' : candidate;\n          html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu-candidate\" data-char=\"${escapeHtml(candidate)}\" style=\"padding:3px 8px;background:${t.inputBg};border:1px dashed ${t.accent};border-radius:4px;color:${t.accent};font-size:11px;cursor:pointer;white-space:nowrap;\" title=\": ${escapeHtml(candidate)}\">${escapeHtml(shortName)}</button>`;\n        });\n      }\n\n      $container.html(html || `<div style=\"font-size:11px;color:${t.textSub};\"></div>`);\n      // \n      $container.find('.acu-dice-char-btn').click(function () {\n        const charName = $(this).data('char');\n        panel.find('#dice-initiator-name').val(charName).trigger('change');\n      });\n    };\n\n    // [] \n    const buildAttrButtons = charName => {\n      const $container = panel.find('#dice-attr-buttons');\n      const $parentSection = $container.parent(); // \n      const attrs = getFullAttributesForCharacter(charName);\n\n      // \n      $parentSection.show();\n\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.attrName) {\n        const attrName = mvuParsedInfo.attrName;\n        // \n        const attrValue = getAttributeValue(charName, attrName) || targetValue || '';\n        const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n        if (attrValue) {\n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"${attrValue}\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;font-weight:bold;\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}:${attrValue}</button>`;\n        } else {\n          // \n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;font-weight:bold;\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}</button>`;\n        }\n      }\n\n      // \n      attrs.forEach(attr => {\n        html += `<button class=\"acu-dice-attr-btn\" data-name=\"${escapeHtml(attr.name)}\" data-value=\"${attr.value}\" style=\"padding:3px 8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:4px;color:${t.inputText};font-size:11px;cursor:pointer;\">${escapeHtml(attr.name)}:${attr.value}</button>`;\n      });\n\n      // \n      html += `<button class=\"acu-dice-gen-attr-btn\" style=\"padding:3px 8px;background:transparent;border:1px dashed ${t.accent};border-radius:4px;color:${t.accent};font-size:11px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>`;\n\n      // \n      html += `<button class=\"acu-dice-clear-attr-btn\" style=\"padding:3px 8px;background:transparent;border:1px dashed ${t.errorText};border-radius:4px;color:${t.errorText};font-size:11px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;margin-left:4px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\"></i></button>`;\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-dice-attr-btn').click(function () {\n        const attrName = $(this).data('name');\n        const attrValue = $(this).data('value');\n        panel.find('#dice-attr-name').val(attrName);\n        panel.find('#dice-attr-value').val(attrValue);\n\n        // \n        const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n        const isDND = criteria === 'gte';\n        const numValue = parseInt(attrValue, 10) || 0;\n\n        if (isDND) {\n          // DNDDC = 20 - \n          panel.find('#dice-target').val(20 - numValue);\n        } else {\n          // COC = \n          panel.find('#dice-target').val(attrValue);\n        }\n\n        // changeUI\n        panel.find('#dice-attr-value').trigger('change');\n      });\n\n      // \n      $container.find('.acu-dice-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n          console.log('[DICE]ACU  for:', charName);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-dice-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharButtons();\n    // <user>\n    buildAttrButtons('<user>');\n    // [] \n    panel.find('#dice-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#dice-attr-name').val(randomSkill).trigger('change');\n    });\n\n    // \n    initCustomDropdown(panel.find('#dice-initiator-name'), diceCharacterList, t);\n    initCustomDropdown(panel.find('#dice-attr-name'), diceAttrList, t);\n    // [] \n    addClearButton(panel, '#dice-initiator-name, #dice-attr-name, #dice-attr-value, #dice-target', t);\n\n    // [] \n    panel.find('#dice-initiator-name').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#dice-attr-name'), newAttrList.length > 0 ? newAttrList : diceAttrList, t);\n\n      // [] \n      buildAttrButtons(charName);\n    });\n\n    // [] \n    panel.find('#dice-attr-name').on('change.acuval', function () {\n      const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#dice-attr-value').val(attrValue);\n        // /DC\n        const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n        const isDND = criteria === 'gte';\n        panel.find('#dice-target').val(isDND ? 20 - attrValue : attrValue);\n      }\n    });\n\n    // [] \n    const convertTargetForDice = (currentTarget, fromDice, toDice) => {\n      if (!currentTarget || currentTarget === '') return '';\n      const val = parseInt(currentTarget, 10);\n      if (isNaN(val)) return currentTarget;\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n\n      const fromMax = getMaxRoll(fromDice);\n      const toMax = getMaxRoll(toDice);\n\n      // \n      const ratio = val / fromMax;\n      const newVal = Math.round(ratio * toMax);\n      return Math.max(1, Math.min(newVal, toMax));\n    };\n\n    // []  UICOC/DND \n    const updateRuleMode = () => {\n      const criteria = panel.find('#dice-success-criteria').val();\n      const isDND = criteria === 'gte';\n      const $targetInput = panel.find('#dice-target');\n      const $difficultyWrapper = panel.find('#dice-difficulty-wrapper');\n      const $row3 = panel.find('#dice-row-3');\n\n      if (isDND) {\n        // DND \n        $targetInput.attr('placeholder', '=20-');\n        panel.find('#dice-target-label').text('DC');\n        $difficultyWrapper.hide();\n        $row3.css('grid-template-columns', '1fr 1fr');\n      } else {\n        // COC \n        $targetInput.attr('placeholder', '=');\n        panel.find('#dice-target-label').text('');\n        $difficultyWrapper.show();\n        $row3.css('grid-template-columns', '1fr 1fr 1fr');\n      }\n    };\n\n    panel.find('#dice-success-criteria').on('change', updateRuleMode);\n\n    // \n    updateRuleMode();\n\n    // \n    let currentDiceType = diceType;\n\n    //  - [] \n    panel.find('.acu-dice-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-dice-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n      const suggestedCriteria = $(this).data('criteria') || 'lte';\n\n      // [] \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, newDice);\n        $targetInput.val(convertedVal);\n      }\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n      const newMax = getMaxRoll(newDice);\n      panel.find('#dice-target-auto').text(`(: 1~${newMax})`);\n\n      currentDiceType = newDice;\n      panel.find('#dice-formula').val(newDice);\n\n      // [] \n      panel.find('#dice-success-criteria').val(suggestedCriteria).trigger('change');\n    });\n    // \n    panel.find('.acu-dice-custom-btn').click(function () {\n      // \n      panel.find('.acu-dice-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      const customDice = panel.find('#dice-custom-input').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#dice-custom-input').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      // \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, customDice);\n        $targetInput.val(convertedVal);\n      }\n\n      panel.find('#dice-formula').val(customDice);\n      currentDiceType = customDice;\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n\n      panel.find('#dice-success-criteria').val('gte').trigger('change');\n    });\n\n    // \n    panel.find('#dice-custom-input').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-dice-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = formula => {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], formula };\n\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      const total = rolls.reduce((a, b) => a + b, 0) + modifier;\n\n      return { total, rolls, sides, count, modifier, formula };\n    };\n\n    // 1d6, 1d6+2\n    const parseModifier = function (modStr) {\n      if (!modStr || modStr.trim() === '') return 0;\n      const trimmed = modStr.trim();\n\n      // \n      const numValue = parseFloat(trimmed);\n      if (!isNaN(numValue) && isFinite(numValue) && trimmed.match(/^-?\\d+(\\.\\d+)?$/)) {\n        return numValue;\n      }\n\n      // \n      // 1d6, 2d10, 1d6+2, 1d6-2, 2d6+1d4\n      let result = 0;\n      let remaining = trimmed;\n\n      // 1d6, 2d10\n      const dicePattern = /(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi;\n      let match;\n      while ((match = dicePattern.exec(remaining)) !== null) {\n        const diceResult = rollDiceExpression(match[0]);\n        if (!isNaN(diceResult)) {\n          result += diceResult;\n        }\n        remaining = remaining.replace(match[0], '');\n      }\n\n      // \n      const numberPattern = /([+-]?\\d+(\\.\\d+)?)/g;\n      let numMatch;\n      while ((numMatch = numberPattern.exec(remaining)) !== null) {\n        const num = parseFloat(numMatch[0]);\n        if (!isNaN(num) && isFinite(num)) {\n          result += num;\n        }\n      }\n\n      return result;\n    };\n\n    // \n    const performDiceRoll = function () {\n      const formula = panel.find('#dice-formula').val().trim() || '1d100';\n      const modStr = panel.find('#dice-modifier').val().trim() || '0';\n      const mod = parseModifier(modStr);\n      const attrName = panel.find('#dice-attr-name').val().trim() || '';\n      const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n      const difficulty = panel.find('#dice-difficulty').val() || 'normal';\n\n      // \n      const isDND = criteria === 'gte';\n\n      // \n      const diceCfg = getDiceConfig();\n      const hardDiv = diceCfg.difficultSuccessDiv || 2;\n      const extremeDiv = diceCfg.hardSuccessDiv || 5;\n      // COC:   critSuccessMax,   critFailMin\n      // DND:   dndCritSuccess,   dndCritFail\n      const critSuccessMax = isDND ? diceCfg.dndCritFail || 1 : diceCfg.critSuccessMax || 5;\n      const critFailMin = isDND ? diceCfg.dndCritSuccess || 20 : diceCfg.critFailMin || 96;\n\n      // COC  DND \n      let targetInputVal = panel.find('#dice-target').val().trim();\n      let attrInputVal = panel.find('#dice-attr-value').val().trim();\n      let attrValue = attrInputVal !== '' ? parseInt(attrInputVal, 10) : 0;\n      let target;\n      let isAutoTarget = false;\n\n      // \n      const getDefaultTarget = formulaStr => {\n        const match = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (match) {\n          const maxRoll = parseInt(match[1], 10) * parseInt(match[2], 10);\n          return Math.round(maxRoll / 2);\n        }\n        return 50;\n      };\n\n      if (targetInputVal !== '') {\n        // /DC\n        target = parseInt(targetInputVal, 10) || getDefaultTarget(formula);\n      } else if (isDND) {\n        // DND  DC = 20 - DC=10\n        if (attrValue > 0) {\n          target = 20 - attrValue;\n          isAutoTarget = true;\n        } else {\n          target = 10; // \n          isAutoTarget = true;\n        }\n      } else {\n        // COC  = \n        if (attrValue > 0) {\n          target = attrValue;\n          isAutoTarget = true;\n        } else {\n          target = getDefaultTarget(formula);\n          isAutoTarget = true;\n        }\n      }\n\n      const result = rollDice(formula);\n      const finalValue = result.total + mod;\n\n      // \n      let requiredTarget = target;\n      let difficultyLabel = '';\n      let difficultyDiv = 1;\n\n      // DND \n      if (!isDND) {\n        switch (difficulty) {\n          case 'hard':\n            requiredTarget = Math.floor(target / hardDiv);\n            difficultyLabel = '';\n            difficultyDiv = hardDiv;\n            break;\n          case 'extreme':\n            requiredTarget = Math.floor(target / extremeDiv);\n            difficultyLabel = '';\n            difficultyDiv = extremeDiv;\n            break;\n          case 'critical':\n            requiredTarget = critSuccessMax;\n            difficultyLabel = '';\n            break;\n          default:\n            difficultyLabel = '';\n            break;\n        }\n      }\n\n      // \n      let isCritSuccess = false;\n      let isCritFailure = false;\n      let isSuccess = false;\n      let outcomeText = '';\n      let outcomeClass = '';\n\n      // /\n      if (isDND) {\n        // DND:   20  1\n        isCritSuccess = finalValue >= critFailMin; //  critFailMin  DND \n        isCritFailure = finalValue <= critSuccessMax; //  critSuccessMax  DND \n      } else {\n        // COC:   5  96\n        isCritSuccess = finalValue <= critSuccessMax;\n        isCritFailure = finalValue >= critFailMin;\n      }\n\n      // /\n      if (isDND) {\n        isSuccess = finalValue >= requiredTarget;\n      } else {\n        isSuccess = finalValue <= requiredTarget;\n      }\n\n      // \n      if (isCritSuccess) {\n        outcomeText = '';\n        outcomeClass = 'success';\n        isSuccess = true;\n      } else if (isCritFailure) {\n        outcomeText = '';\n        outcomeClass = 'failure';\n        isSuccess = false;\n      } else if (isSuccess) {\n        if (isDND) {\n          outcomeText = '';\n        } else if (difficulty === 'hard') {\n          outcomeText = '';\n        } else if (difficulty === 'extreme') {\n          outcomeText = '';\n        } else {\n          // \n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            outcomeText = '';\n          } else if (finalValue <= hardTarget) {\n            outcomeText = '';\n          } else {\n            outcomeText = '';\n          }\n        }\n        outcomeClass = 'success';\n      } else {\n        outcomeText = '';\n        outcomeClass = 'failure';\n      }\n\n      const criteriaSymbol = isDND ? '' : '';\n      const hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const displayValue = hideDiceResultFromUser ? '' : finalValue;\n      const displayOutcomeText = hideDiceResultFromUser ? '' : outcomeText;\n\n      // \n      let resultType;\n      if (isCritSuccess) {\n        resultType = 'critSuccess';\n      } else if (isCritFailure) {\n        resultType = 'critFailure';\n      } else if (isSuccess) {\n        if (difficulty === 'extreme' || (difficulty === 'normal' && finalValue <= Math.floor(target / extremeDiv))) {\n          resultType = 'extremeSuccess';\n        } else if (difficulty === 'hard' || (difficulty === 'normal' && finalValue <= Math.floor(target / hardDiv))) {\n          resultType = 'success';\n        } else {\n          resultType = 'warning';\n        }\n      } else {\n        resultType = 'failure';\n      }\n\n      const badgeStyle = getResultBadgeStyle(resultType, t);\n      const badgeStyleStr = Object.entries(badgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n\n      // \n      const $rollBtn = panel.find('#dice-roll-btn');\n      $rollBtn.html(`\n        <div style=\"display:flex; align-items:center; justify-content:center; width:100%; gap:8px;\">\n          <span style=\"font-size:22px; font-weight:bold; color:${t.buttonText};\">${displayValue}</span>\n          <span style=\"font-size:11px; color:${t.buttonText}; opacity:0.9;\">${criteriaSymbol}${requiredTarget}${difficultyLabel ? '(' + difficultyLabel + ')' : ''}</span>\n          ${displayOutcomeText ? `<span style=\"${badgeStyleStr}\">${displayOutcomeText}</span>` : ''}\n          <button class=\"dice-retry-btn\" style=\"background:transparent; border:none; color:${t.buttonText}; cursor:pointer; padding:4px; display:flex; align-items:center; justify-content:center; opacity:0.8; transition:opacity 0.2s;\" title=\"\">\n            <i class=\"fa-solid fa-rotate-right\"></i>\n          </button>\n        </div>\n      `);\n\n      // \n      $rollBtn.off('click', '.dice-retry-btn').on('click', '.dice-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        // \n        performDiceRoll();\n      });\n\n      //  Prompt \n      const initiatorName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      let judgeExpr = '';\n\n      if (isCritSuccess) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        } else {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        }\n      } else if (isCritFailure) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        } else {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        }\n      } else if (isDND) {\n        // DND \n        if (isSuccess) {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}<${requiredTarget}`;\n        }\n      } else if (difficulty === 'critical') {\n        // COC \n        judgeExpr = `${critSuccessMax}${finalValue}>${critSuccessMax}`;\n      } else if (difficulty !== 'normal') {\n        // COC \n        if (isSuccess) {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}>${requiredTarget}`;\n        }\n      } else {\n        // COC \n        if (isSuccess) {\n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${extremeDiv}`;\n          } else if (finalValue <= hardTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${hardDiv}`;\n          } else {\n            judgeExpr = `${target}${finalValue}${target}`;\n          }\n        } else {\n          judgeExpr = `${target}${finalValue}>${target}`;\n        }\n      }\n\n      const diceResultText = `${initiatorName}${attrName}${finalValue}${judgeExpr}${outcomeText}`;\n      smartInsertToTextarea(diceResultText, 'dice');\n      if (onResult) {\n        onResult({\n          success: isSuccess,\n          total: finalValue,\n          target,\n          outcomeText,\n          attrName,\n          criteria,\n          isAutoTarget,\n          formula: formulaText,\n        });\n      }\n    };\n\n    // \n    panel.find('#dice-roll-btn').click(function () {\n      performDiceRoll();\n    });\n\n    // \n    panel.find('#dice-switch-contest-top').click(function () {\n      const targetInput = panel.find('#dice-target').val().trim();\n      const attrValueInput = panel.find('#dice-attr-value').val().trim();\n      const currentDice = panel.find('#dice-formula').val() || '1d100';\n      const initiatorNameVal = panel.find('#dice-initiator-name').val().trim();\n      closePanel();\n      showContestPanel({\n        //  placeholder \n        initiatorName: initiatorNameVal && initiatorNameVal !== '<user>' ? initiatorNameVal : '',\n        initiatorValue: attrValueInput !== '' ? parseInt(attrValueInput, 10) : undefined,\n        diceType: currentDice,\n      });\n    });\n    // \n    const closePanel = () => {\n      overlay.remove();\n      panel.remove();\n    };\n    overlay.click(closePanel);\n    panel.find('.acu-dice-close').click(closePanel);\n    //  - \n    panel.find('.acu-dice-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentCriteria = panel.find('#dice-success-criteria').val();\n      const isDND = currentCriteria === 'gte';\n      showDiceSettingsPanel(isDND);\n    });\n  };\n\n  // [] \n  const showContestPanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay, .acu-contest-panel, .acu-contest-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    // \n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n\n    // \n    const opponentName = options.opponentName || '';\n    const diceType = options.diceType || savedDiceType;\n    const passedInitiatorName = options.initiatorName || '';\n    const passedInitiatorValue = options.initiatorValue;\n    const passedOpponentValue = options.opponentValue;\n\n    const rawData = cachedRawData || getTableData();\n    let playerAttrs = [];\n    let opponentAttrs = [];\n\n    // [] <user> + \n    let characterList = ['<user>'];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) characterList.push(row[1]);\n          }\n          break;\n        }\n      }\n    }\n    // [] \n    let contestAttrList = [];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content && sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!contestAttrList.includes(attr.name)) contestAttrList.push(attr.name);\n              });\n            }\n          });\n          break;\n        }\n      }\n    }\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const attrStr = sheet.content[1][7] || '';\n          playerAttrs = parseAttributeString(attrStr);\n        }\n\n        if (sheet.name === '' && opponentName) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1] === opponentName) {\n              const attrStr = row[9] || '';\n              opponentAttrs = parseAttributeString(attrStr);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    const t = getThemeColors();\n    const isCyberTheme = getConfig().theme === 'cyber';\n    const inputTextColor = isCyberTheme ? '#ff00ff' : t.inputText;\n    // \n    const inputStyle = `width:100%;padding:5px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:4px;color:${inputTextColor} !important;font-size:12px;text-align:center;box-sizing:border-box;`;\n\n    const buildAttrButtons = (attrs, targetType) => {\n      let html = '';\n      // \n      for (let i = 0; i < attrs.length; i++) {\n        const attr = attrs[i];\n        html +=\n          '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n          attr.value +\n          '\" data-aname=\"' +\n          escapeHtml(attr.name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" style=\"padding:3px 8px;background:' +\n          t.inputBg +\n          ';border:1px solid ' +\n          t.border +\n          ';border-radius:4px;color:' +\n          t.inputText +\n          ';font-size:11px;cursor:pointer;margin:2px;\">' +\n          escapeHtml(attr.name) +\n          ': ' +\n          attr.value +\n          '</button>';\n      }\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.accent +\n        ';border-radius:3px;color:' +\n        t.accent +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin:2px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.errorText +\n        ';border-radius:3px;color:' +\n        t.errorText +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin:2px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\" style=\"font-size:9px;\"></i></button>';\n      return html;\n    };\n\n    const overlay = $(\n      '<div class=\"acu-contest-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:' +\n        t.overlayBg +\n        ';z-index:2147483647;\"></div>',\n    );\n    const panelHtml =\n      '<div class=\"acu-contest-panel acu-theme-' +\n      config.theme +\n      '\" style=\"position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:360px;max-width:92vw;background:' +\n      t.bgPanel +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:12px;box-shadow:0 20px 60px ' +\n      t.shadowBg +\n      ';z-index:2147483648;overflow:hidden;\">' +\n      '<div style=\"padding:12px 15px;background:' +\n      t.tableHead +\n      ';border-bottom:1px solid ' +\n      t.border +\n      ';display:flex;justify-content:space-between;align-items:center;\">' +\n      '<div style=\"font-size:15px;font-weight:bold;color:' +\n      t.accent +\n      ';display:flex;align-items:center;gap:8px;\"><i class=\"fa-solid fa-people-arrows\"></i> </div>' +\n      '<div style=\"display:flex;align-items:center;gap:8px;\">' +\n      '<button id=\"contest-switch-normal\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:14px;padding:4px;transition:all 0.2s;\" title=\"\"><i class=\"fa-solid fa-dice-d20\"></i></button>' +\n      '<button class=\"acu-contest-config-btn\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:14px;padding:4px;transition:all 0.2s;\" title=\"\"><i class=\"fa-solid fa-cog\"></i></button>' +\n      '<button class=\"acu-contest-close\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>' +\n      '</div>' +\n      '</div>' +\n      '<div style=\"padding:15px;max-height:70vh;overflow-y:auto;\">' +\n      '<div style=\"display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;align-items:center;\">' +\n      '<button class=\"acu-contest-preset' +\n      (diceType === '1d20' ? ' active' : '') +\n      '\" data-dice=\"1d20\" style=\"padding:4px 10px;background:' +\n      (diceType === '1d20' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (diceType === '1d20' ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\">1d20</button>' +\n      '<button class=\"acu-contest-preset' +\n      (diceType === '1d100' ? ' active' : '') +\n      '\" data-dice=\"1d100\" style=\"padding:4px 10px;background:' +\n      (diceType === '1d100' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (diceType === '1d100' ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\">1d100</button>' +\n      '<button class=\"acu-contest-preset acu-contest-custom-btn\" data-dice=\"custom\" style=\"padding:4px 10px;background:' +\n      (!['1d20', '1d100'].includes(diceType) ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (!['1d20', '1d100'].includes(diceType) ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\"></button>' +\n      '<input type=\"text\" id=\"contest-custom-dice\" placeholder=\"2d6\" value=\"' +\n      (!['1d20', '1d100'].includes(diceType) ? diceType : '') +\n      '\" style=\"width:60px;padding:4px 6px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      inputTextColor +\n      ' !important;font-size:11px;text-align:center;box-sizing:border-box;\" />' +\n      '</div>' +\n      '<input type=\"hidden\" id=\"contest-dice-type\" value=\"' +\n      diceType +\n      '\">' +\n      '<div style=\"font-size:11px;color:' +\n      t.accent +\n      ';font-weight:bold;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-init-char-buttons\" style=\"display:flex;flex-wrap:wrap;gap:3px;\"></div></div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-display\" value=\"\" placeholder=\"<user>\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;gap:6px;\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-init-random-skill\" title=\"\" style=\"width:18px;height:18px;padding:0;background:transparent;border:1px dashed ' +\n      t.accent +\n      ';border-radius:4px;color:' +\n      t.accent +\n      ';font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" id=\"contest-init-name\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-value\" value=\"' +\n      (passedInitiatorValue !== undefined ? passedInitiatorValue : '') +\n      '\" placeholder=\"=50%\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-target\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div id=\"init-attr-buttons\" style=\"display:flex;flex-wrap:wrap;gap:2px;margin-bottom:8px;max-height:50px;overflow-y:auto;\">' +\n      buildAttrButtons(playerAttrs, 'init') +\n      '</div>' +\n      '<div style=\"font-size:11px;color:' +\n      t.accent +\n      ';font-weight:bold;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-opp-char-buttons\" style=\"display:flex;flex-wrap:wrap;gap:3px;\"></div></div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opponent-display\" value=\"' +\n      escapeHtml(opponentName) +\n      '\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;gap:6px;\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-opp-random-skill\" title=\"\" style=\"width:18px;height:18px;padding:0;background:transparent;border:1px dashed ' +\n      t.accent +\n      ';border-radius:4px;color:' +\n      t.accent +\n      ';font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" id=\"contest-opp-name\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opp-value\" value=\"' +\n      (passedOpponentValue !== undefined ? passedOpponentValue : '') +\n      '\" placeholder=\"=50%\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opp-target\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div id=\"opp-attr-buttons\" style=\"display:flex;flex-wrap:wrap;gap:2px;margin-bottom:10px;max-height:50px;overflow-y:auto;\">' +\n      buildAttrButtons(opponentAttrs, 'opp') +\n      '</div>' +\n      '<div id=\"contest-result-display\" style=\"display:none;margin-bottom:10px;padding:8px;background:' +\n      t.inputBg +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:6px;\">' +\n      '<div style=\"display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;width:100%;\">' +\n      '<div id=\"contest-result-init\" style=\"display:flex;align-items:center;gap:4px;min-width:0;flex:1;\"></div>' +\n      '<span style=\"color:' +\n      t.textSub +\n      ';opacity:0.9;font-size:11px;font-weight:bold;white-space:nowrap;\">VS</span>' +\n      '<div id=\"contest-result-opp\" style=\"display:flex;align-items:center;gap:4px;min-width:0;flex:1;justify-content:flex-end;\"></div>' +\n      '</div>' +\n      '</div>' +\n      '<button id=\"contest-roll-btn\" style=\"width:100%;padding:12px;background:' +\n      (t.buttonBg || t.accent) +\n      ';border:none;border-radius:8px;color:' +\n      t.buttonText +\n      ';font-size:15px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;position:relative;\"><i class=\"fa-solid fa-dice\"></i> </button>' +\n      '</div>' +\n      '</div>';\n\n    const panel = $(panelHtml);\n    $('body').append(overlay).append(panel);\n\n    // []  - \n    const buildCharBtns = targetType => {\n      const containerId = targetType === 'init' ? '#contest-init-char-buttons' : '#contest-opp-char-buttons';\n      const $container = panel.find(containerId);\n      let html = '';\n      characterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html +=\n          '<button class=\"acu-contest-char-btn\" data-char=\"' +\n          escapeHtml(name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" style=\"padding:3px 8px;background:' +\n          t.btnBg +\n          ';border:1px solid ' +\n          t.border +\n          ';border-radius:4px;color:' +\n          t.textMain +\n          ';font-size:11px;cursor:pointer;white-space:nowrap;\" title=\"' +\n          escapeHtml(displayName) +\n          '\">' +\n          escapeHtml(shortName) +\n          '</button>';\n      });\n      $container.html(html);\n      $container.find('.acu-contest-char-btn').click(function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const charName = $(this).data('char');\n        const type = $(this).data('type');\n        if (type === 'init') {\n          panel.find('#contest-init-display').val(charName).trigger('change');\n        } else {\n          panel.find('#contest-opponent-display').val(charName).trigger('change');\n        }\n      });\n    };\n\n    // [] \n    const rebuildAttrBtns = (attrs, targetType) => {\n      const containerId = targetType === 'init' ? '#init-attr-buttons' : '#opp-attr-buttons';\n      const $container = panel.find(containerId);\n\n      // \n      $container.show();\n\n      let html = '';\n\n      // \n      if (attrs.length > 0) {\n        attrs.forEach(attr => {\n          html +=\n            '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n            attr.value +\n            '\" data-aname=\"' +\n            escapeHtml(attr.name) +\n            '\" data-type=\"' +\n            targetType +\n            '\" style=\"padding:2px 6px;background:' +\n            t.inputBg +\n            ';border:1px solid ' +\n            t.border +\n            ';border-radius:3px;color:' +\n            t.inputText +\n            ';font-size:10px;cursor:pointer;\">' +\n            escapeHtml(attr.name) +\n            ':' +\n            attr.value +\n            '</button>';\n        });\n      }\n\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.accent +\n        ';border-radius:3px;color:' +\n        t.accent +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.errorText +\n        ';border-radius:3px;color:' +\n        t.errorText +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin-left:4px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\" style=\"font-size:9px;\"></i></button>';\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-contest-attr-btn').click(function () {\n        const val = $(this).attr('data-val');\n        const aname = $(this).attr('data-aname');\n        const type = $(this).attr('data-type');\n        if (type === 'init') {\n          panel.find('#contest-init-value').val(val);\n          panel.find('#contest-init-name').val(aname);\n        } else {\n          panel.find('#contest-opp-value').val(val);\n          panel.find('#contest-opp-name').val(aname);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          // \n          let charName;\n          if (type === 'init') {\n            charName = panel.find('#contest-init-display').val().trim() || '<user>';\n          } else {\n            charName = panel.find('#contest-opponent-display').val().trim();\n          }\n\n          if (!charName) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        let charName;\n        if (type === 'init') {\n          charName = panel.find('#contest-init-display').val().trim() || '<user>';\n        } else {\n          charName = panel.find('#contest-opponent-display').val().trim();\n        }\n\n        if (!charName) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharBtns('init');\n    buildCharBtns('opp');\n    // [] \n    panel.find('#contest-init-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-init-name').val(randomSkill).trigger('change');\n    });\n\n    // [] \n    panel.find('#contest-opp-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-opp-name').val(randomSkill).trigger('change');\n    });\n    //  rebuildAttrBtns /\n    const initAttrs = getFullAttributesForCharacter(passedInitiatorName || '<user>');\n    rebuildAttrBtns(initAttrs, 'init');\n    const oppAttrs = getFullAttributesForCharacter(opponentName || '');\n    rebuildAttrBtns(oppAttrs, 'opp');\n\n    // \n    initCustomDropdown(panel.find('#contest-init-display'), characterList, t);\n    initCustomDropdown(panel.find('#contest-opponent-display'), characterList, t);\n    initCustomDropdown(panel.find('#contest-init-name'), contestAttrList, t);\n    initCustomDropdown(panel.find('#contest-opp-name'), contestAttrList, t);\n    addClearButton(\n      panel,\n      '#contest-init-display, #contest-init-name, #contest-init-value, #contest-init-target, #contest-opponent-display, #contest-opp-name, #contest-opp-value, #contest-opp-target',\n      t,\n    );\n\n    // \n    panel.find('#contest-init-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-init-name'), newAttrList.length > 0 ? newAttrList : contestAttrList, t);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'init');\n    });\n\n    // \n    panel.find('#contest-opponent-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim();\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-opp-name'), newAttrList.length > 0 ? newAttrList : contestAttrList, t);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'opp');\n    });\n\n    // \n    panel.find('#contest-init-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-init-display').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-init-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('#contest-opp-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-opponent-display').val().trim();\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-opp-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('.acu-contest-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-contest-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n      panel.find('#contest-dice-type').val(newDice);\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n    });\n\n    // \n    panel.find('.acu-contest-custom-btn').click(function () {\n      // \n      panel.find('.acu-contest-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      var customDice = panel.find('#contest-custom-dice').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#contest-custom-dice').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      panel.find('#contest-dice-type').val(customDice);\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n    });\n\n    // \n    panel.find('#contest-custom-dice').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-contest-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = function (formula) {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], sides: 100 };\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      return {\n        total:\n          rolls.reduce(function (a, b) {\n            return a + b;\n          }, 0) + modifier,\n        rolls: rolls,\n        sides: sides,\n      };\n    };\n\n    const getSuccessLevel = function (roll, target, sides) {\n      const t = getThemeColors();\n      if (sides === 100) {\n        if (roll <= 5) return { level: 3, name: '', color: t.critSuccessText };\n        if (roll >= 96) return { level: -1, name: '', color: t.critFailureText };\n        if (roll <= Math.floor(target / 5)) return { level: 2, name: '', color: t.extremeSuccessText };\n        if (roll <= Math.floor(target / 2)) return { level: 1, name: '', color: t.successText };\n        if (roll <= target) return { level: 0, name: '', color: t.warningText };\n        return { level: -1, name: '', color: t.failureText };\n      } else {\n        if (roll === 20) return { level: 3, name: '', color: t.critSuccessText };\n        if (roll === 1) return { level: -1, name: '', color: t.critFailureText };\n        if (roll >= target) return { level: 0, name: '', color: t.successText };\n        return { level: -1, name: '', color: t.failureText };\n      }\n    };\n\n    // \n    const performContestRoll = function () {\n      var formula = panel.find('#contest-dice-type').val() || '1d100';\n\n      var initName = panel.find('#contest-init-display').val().trim() || '<user>';\n      var initAttrName = panel.find('#contest-init-name').val().trim() || '';\n      // \n      var getHalfMax = function (formulaStr) {\n        var m = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (m) return Math.round((parseInt(m[1], 10) * parseInt(m[2], 10)) / 2);\n        return 50;\n      };\n\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var initValue;\n      if (initValueInput === '') {\n        // \n        initValue = getHalfMax(formula);\n      } else {\n        initValue = parseInt(initValueInput, 10) || getHalfMax(formula);\n      }\n      var initTargetInput = panel.find('#contest-init-target').val().trim();\n      var initTarget;\n      if (initTargetInput !== '') {\n        initTarget = parseInt(initTargetInput, 10);\n      } else {\n        // \n        initTarget = initValue;\n      }\n\n      var oppName = panel.find('#contest-opponent-display').val().trim() || '';\n      var oppAttrName = panel.find('#contest-opp-name').val().trim() || initAttrName;\n      var oppValueInput = panel.find('#contest-opp-value').val().trim();\n      var oppValue;\n      if (oppValueInput === '') {\n        // \n        oppValue = getHalfMax(formula);\n      } else {\n        oppValue = parseInt(oppValueInput, 10) || getHalfMax(formula);\n      }\n      var oppTargetInput = panel.find('#contest-opp-target').val().trim();\n      var oppTarget;\n      if (oppTargetInput !== '') {\n        oppTarget = parseInt(oppTargetInput, 10);\n      } else {\n        // \n        oppTarget = oppValue;\n      }\n\n      var initResult = rollDice(formula);\n      var oppResult = rollDice(formula);\n      var initSuccess = getSuccessLevel(initResult.total, initTarget, initResult.sides);\n      var oppSuccess = getSuccessLevel(oppResult.total, oppTarget, oppResult.sides);\n\n      var winner, winnerColor, resultDesc;\n      var diceCfg = getDiceConfig();\n      var tieRule = diceCfg.contestTieRule || 'initiator_lose';\n      var hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      var displayInitValue = hideDiceResultFromUser ? '' : initResult.total;\n      var displayOppValue = hideDiceResultFromUser ? '' : oppResult.total;\n      var displayInitSuccessName = hideDiceResultFromUser ? '' : initSuccess.name;\n      var displayOppSuccessName = hideDiceResultFromUser ? '' : oppSuccess.name;\n\n      if (initSuccess.level > oppSuccess.level) {\n        winner = initName + ' ';\n        winnerColor = t.successText;\n        resultDesc = initSuccess.name + '  ' + oppSuccess.name;\n      } else if (initSuccess.level < oppSuccess.level) {\n        winner = oppName + ' ';\n        winnerColor = t.failureText;\n        resultDesc = oppSuccess.name + '  ' + initSuccess.name;\n      } else {\n        // \n        resultDesc = ' ' + initSuccess.name;\n        if (tieRule === 'initiator_win') {\n          winner = '' + initName + ' ';\n          winnerColor = t.successText;\n        } else if (tieRule === 'tie') {\n          winner = '';\n          winnerColor = t.warningText;\n        } else {\n          // : initiator_lose\n          winner = '' + initName + ' ';\n          winnerColor = t.failureText;\n        }\n      }\n\n      var displayWinner = hideDiceResultFromUser ? '' : winner;\n\n      // \n      const getResultTypeFromSuccess = success => {\n        if (success.level === 3) return 'critSuccess';\n        if (success.level === 2) return 'extremeSuccess';\n        if (success.level === 1) return 'success';\n        if (success.level === 0) return 'warning';\n        if (success.level === -1) {\n          // name\n          return success.name === '' ? 'critFailure' : 'failure';\n        }\n        return 'failure';\n      };\n      const initResultType = getResultTypeFromSuccess(initSuccess);\n      const oppResultType = getResultTypeFromSuccess(oppSuccess);\n\n      const initBadgeStyle = getResultBadgeStyle(initResultType, t);\n      const oppBadgeStyle = getResultBadgeStyle(oppResultType, t);\n      const winnerBadgeStyle = getResultBadgeStyle(\n        winnerColor === t.successText ? 'success' : winnerColor === t.warningText ? 'warning' : 'failure',\n        t,\n      );\n\n      const initBadgeStyleStr = Object.entries(initBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n      const oppBadgeStyleStr = Object.entries(oppBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n      const winnerBadgeStyleStr = Object.entries(winnerBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n\n      // \n      const $resultDisplay = panel.find('#contest-result-display');\n      const $resultInit = panel.find('#contest-result-init');\n      const $resultOpp = panel.find('#contest-result-opp');\n\n      // \n      $resultInit.html(\n        '<span style=\"font-size:11px;color:' +\n          t.textMain +\n          ';opacity:0.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;\">' +\n          escapeHtml(initName) +\n          '</span>' +\n          '<span style=\"font-size:16px;font-weight:bold;color:' +\n          t.textMain +\n          ';\">' +\n          displayInitValue +\n          '</span>' +\n          (displayInitSuccessName\n            ? '<span style=\"' + initBadgeStyleStr + '\">' + displayInitSuccessName + '</span>'\n            : ''),\n      );\n\n      // \n      $resultOpp.html(\n        (displayOppSuccessName ? '<span style=\"' + oppBadgeStyleStr + '\">' + displayOppSuccessName + '</span>' : '') +\n          '<span style=\"font-size:16px;font-weight:bold;color:' +\n          t.textMain +\n          ';\">' +\n          displayOppValue +\n          '</span>' +\n          '<span style=\"font-size:11px;color:' +\n          t.textMain +\n          ';opacity:0.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;\">' +\n          escapeHtml(oppName) +\n          '</span>',\n      );\n\n      $resultDisplay.show();\n\n      // \n      const $contestBtn = panel.find('#contest-roll-btn');\n      $contestBtn.html(\n        '<div style=\"display:flex; align-items:center; justify-content:center; width:100%; gap:8px;\">' +\n          (displayWinner ? '<span style=\"' + winnerBadgeStyleStr + '\">' + displayWinner + '</span>' : '') +\n          '<button class=\"contest-retry-btn\" style=\"background:transparent; border:none; color:' +\n          t.buttonText +\n          '; cursor:pointer; padding:4px; display:flex; align-items:center; justify-content:center; opacity:0.8; transition:opacity 0.2s;\" title=\"\">' +\n          '<i class=\"fa-solid fa-rotate-right\"></i>' +\n          '</button>' +\n          '</div>',\n      );\n\n      // \n      $contestBtn.off('click', '.contest-retry-btn').on('click', '.contest-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        // \n        performContestRoll();\n      });\n\n      const contestResultText =\n        `${initName} ${initAttrName} vs ${oppName} ${oppAttrName}` +\n        `${initName} ${initAttrName} (${initTarget})  ${initResult.total}${initSuccess.name}` +\n        `${oppName} ${oppAttrName} (${oppTarget})  ${oppResult.total}${oppSuccess.name}` +\n        `${winner}`;\n      smartInsertToTextarea(contestResultText, 'dice');\n    };\n\n    // \n    panel.find('#contest-roll-btn').click(function () {\n      performContestRoll();\n    });\n\n    // [] \n    panel.find('#contest-switch-normal').click(function () {\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var currentInitName = panel.find('#contest-init-name').val() || '';\n      var currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      var initiatorNameVal = panel.find('#contest-init-display').val().trim();\n      closePanel();\n      showDicePanel({\n        //  null  placeholder\n        targetValue: initValueInput !== '' ? parseInt(initValueInput, 10) : null,\n        targetName: currentInitName,\n        diceType: currentDice,\n        initiatorName: initiatorNameVal,\n      });\n    });\n    //  - \n    // 1d20 -> DND,  -> COC\n    panel.find('.acu-contest-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      const isDND = currentDice === '1d20';\n      showDiceSettingsPanel(isDND);\n    });\n    var closePanel = function () {\n      overlay.remove();\n      panel.remove();\n    };\n    overlay.click(closePanel);\n    panel.find('.acu-contest-close').click(closePanel);\n  };\n\n  const parseInSceneStatus = (value, headerName) => {\n    const val = String(value || '')\n      .trim()\n      .toLowerCase();\n    const header = String(headerName || '').toLowerCase();\n    if (!val) return false;\n\n    if (header.includes('')) {\n      return val === '' || val === 'false' || val === 'no';\n    }\n\n    return val.startsWith('') || val === 'true' || val === '' || val === 'yes';\n  };\n\n  const buildMapViewModel = async () => {\n    const rawData = cachedRawData || getTableData();\n    const allTables = processJsonData(rawData || {});\n    if (!rawData || Object.keys(allTables).length === 0) return null;\n\n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const elementResult = (() => {\n      const keywords = ['', '', '', '', ''];\n      for (const tableName in allTables) {\n        if (keywords.some(keyword => tableName.includes(keyword))) {\n          return {\n            data: allTables[tableName],\n            name: tableName,\n            key: allTables[tableName].key,\n          };\n        }\n      }\n      return null;\n    })();\n\n    const globalHeaders = globalResult?.data?.headers || [];\n    const globalRows = globalResult?.data?.rows || [];\n    const globalRow = globalRows[0] || [];\n    const globalConfig = DASHBOARD_TABLE_CONFIG.global;\n    const detailIdx = DashboardDataParser.findColumnIndex(globalHeaders, 'detailLocation', globalConfig);\n    const regionIdx = DashboardDataParser.findColumnIndex(globalHeaders, 'currentLocation', globalConfig);\n    const detailLocation = detailIdx >= 0 ? String(globalRow[detailIdx] || '').trim() : '';\n    const currentRegion = regionIdx >= 0 ? String(globalRow[regionIdx] || '').trim() : '';\n\n    if (!locationResult?.data) return null;\n\n    const findColumnIndex = (headers, keywords, fallbackIndex = null) => {\n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (keywords.some(keyword => h.includes(keyword.toLowerCase()))) return i;\n      }\n      return fallbackIndex ?? -1;\n    };\n\n    const locations = new Map();\n    const locationHeaders = locationResult.data.headers || [];\n    const locationRows = locationResult.data.rows || [];\n    const locationNameIdx = findColumnIndex(locationHeaders, ['', '', '', '', ''], 1);\n    const locationRegionIdx = findColumnIndex(locationHeaders, ['', '', '', ''], null);\n    const locationTypeIdx = findColumnIndex(locationHeaders, ['', '', ''], null);\n    const locationDescIdx = findColumnIndex(locationHeaders, ['', '', '', '', ''], null);\n    const locationImportanceIdx = findColumnIndex(locationHeaders, ['', ''], null);\n    const locationExploreIdx = findColumnIndex(locationHeaders, ['', '', ''], null);\n\n    locationRows.forEach((row, idx) => {\n      const name = String(row[locationNameIdx] || '').trim();\n      if (!name) return;\n      const region = locationRegionIdx >= 0 ? String(row[locationRegionIdx] || '').trim() : '';\n\n      const location = {\n        name,\n        region,\n        locationType: locationTypeIdx >= 0 ? row[locationTypeIdx] || '' : '',\n        description: locationDescIdx >= 0 ? row[locationDescIdx] || '' : '',\n        importance: locationImportanceIdx >= 0 ? row[locationImportanceIdx] || '' : '',\n        exploreStatus: locationExploreIdx >= 0 ? row[locationExploreIdx] || '' : '',\n        emoji: getLocationEmoji(name),\n        tableKey: locationResult.key || '',\n        rowIndex: idx,\n      };\n      locations.set(name, location);\n    });\n\n    const elements = new Map();\n    const addElement = (locationName, element) => {\n      if (!elements.has(locationName)) {\n        elements.set(locationName, []);\n      }\n      elements.get(locationName).push(element);\n    };\n\n    if (elementResult?.data) {\n      const elementHeaders = elementResult.data.headers || [];\n      const elementRows = elementResult.data.rows || [];\n      const elementNameIdx = findColumnIndex(elementHeaders, ['', '', ''], 1);\n      const elementTypeIdx = findColumnIndex(elementHeaders, ['', '', ''], 2);\n      const elementLocationIdx = findColumnIndex(elementHeaders, ['', '', ''], 3);\n      const elementDescIdx = findColumnIndex(elementHeaders, ['', '', ''], null);\n      const elementStatusIdx = findColumnIndex(elementHeaders, ['', ''], null);\n      const elementInteractIdx = findColumnIndex(elementHeaders, ['', '', '', ''], null);\n\n      elementRows.forEach((row, idx) => {\n        const name = String(row[elementNameIdx] || '').trim();\n        if (!name) return;\n        const locationName = String(row[elementLocationIdx] || '').trim();\n        if (!locationName) return;\n        if (currentRegion && locations.size > 0 && !locations.has(locationName)) return;\n\n        const rawInteractions = elementInteractIdx >= 0 ? row[elementInteractIdx] : '';\n        const interactions = String(rawInteractions || '')\n          .split(/[,;]/)\n          .map(item => item.trim())\n          .filter(Boolean);\n        const typeValue = elementTypeIdx >= 0 ? row[elementTypeIdx] || '' : '';\n        const element = {\n          name,\n          type: typeValue,\n          location: locationName,\n          description: elementDescIdx >= 0 ? row[elementDescIdx] || '' : '',\n          status: elementStatusIdx >= 0 ? row[elementStatusIdx] || '' : '',\n          interactions,\n          emoji: getElementEmoji(name, typeValue),\n          tableKey: elementResult.key || '',\n          rowIndex: idx,\n        };\n        addElement(locationName, element);\n      });\n    }\n\n    const characters = new Map();\n    const addCharacter = async character => {\n      const avatarUrl = await AvatarManager.getAsync(character.name);\n      const full = {\n        ...character,\n        avatarUrl,\n        avatarOffsetX: AvatarManager.getOffsetX(character.name),\n        avatarOffsetY: AvatarManager.getOffsetY(character.name),\n        avatarScale: AvatarManager.getScale(character.name),\n      };\n      if (!characters.has(full.location)) {\n        characters.set(full.location, []);\n      }\n      characters.get(full.location).push(full);\n    };\n\n    let playerLocation = '';\n\n    if (playerResult?.data) {\n      const playerConfig = DASHBOARD_TABLE_CONFIG.player;\n      const playerHeaders = playerResult.data.headers || [];\n      const playerRows = playerResult.data.rows || [];\n      const playerRow = playerRows[0] || [];\n      const playerNameIdx = DashboardDataParser.findColumnIndex(playerHeaders, 'name', playerConfig);\n      const playerPosIdx = DashboardDataParser.findColumnIndex(playerHeaders, 'position', playerConfig);\n      const playerNameRaw = playerNameIdx >= 0 ? playerRow[playerNameIdx] : getPlayerName();\n      const playerPosRaw = playerPosIdx >= 0 ? playerRow[playerPosIdx] : '';\n      const playerName = String(playerNameRaw || '').trim();\n      playerLocation = String(playerPosRaw || '').trim();\n\n      if (!playerLocation && detailLocation) {\n        playerLocation = detailLocation;\n      }\n\n      if (playerName && playerLocation) {\n        await addCharacter({\n          name: playerName,\n          location: playerLocation,\n          isPlayer: true,\n          isInScene: true,\n          tableKey: playerResult.key || '',\n          rowIndex: 0,\n        });\n      }\n    }\n\n    if (npcResult?.data) {\n      const npcConfig = DASHBOARD_TABLE_CONFIG.npc;\n      const npcHeaders = npcResult.data.headers || [];\n      const npcRows = npcResult.data.rows || [];\n      const npcNameIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'name', npcConfig);\n      const npcPosIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'position', npcConfig);\n      const npcInSceneIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'inScene', npcConfig);\n\n      for (let idx = 0; idx < npcRows.length; idx++) {\n        const row = npcRows[idx];\n        const npcName = String(row[npcNameIdx] || '').trim();\n        if (!npcName) continue;\n        const locationName = String(row[npcPosIdx] || '').trim();\n        if (!locationName) continue;\n        if (currentRegion && locations.size > 0 && !locations.has(locationName)) continue;\n        const inSceneValue = npcInSceneIdx >= 0 ? row[npcInSceneIdx] : '';\n        const inSceneHeader = npcHeaders[npcInSceneIdx] || '';\n        const isInScene = parseInSceneStatus(inSceneValue, inSceneHeader);\n\n        await addCharacter({\n          name: npcName,\n          location: locationName,\n          isPlayer: false,\n          isInScene,\n          tableKey: npcResult.key || '',\n          rowIndex: idx,\n        });\n      }\n    }\n\n    const locationIterator = locations.values();\n    const firstLocation = locationIterator.next().value;\n\n    const allRegions = [...new Set(Array.from(locations.values()).map(l => l.region || ''))].sort();\n    // \"\"\n    const otherIndex = allRegions.indexOf('');\n    if (otherIndex > -1) {\n      allRegions.splice(otherIndex, 1);\n      allRegions.push('');\n    }\n\n    const getHotLocationsInRegion = region => {\n      const regionName = region || '';\n      return Array.from(locations.values())\n        .filter(l => (l.region || '') === regionName)\n        .sort((a, b) => {\n          const scoreA = (characters.get(a.name)?.length || 0) + (elements.get(a.name)?.length || 0);\n          const scoreB = (characters.get(b.name)?.length || 0) + (elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n    };\n\n    const focusLocation = (() => {\n      if (detailLocation && locations.has(detailLocation)) return detailLocation;\n      if (playerLocation && locations.has(playerLocation)) return playerLocation;\n      const fallbackRegion = allRegions[0];\n      if (fallbackRegion) {\n        const regionLocations = getHotLocationsInRegion(fallbackRegion);\n        if (regionLocations.length > 0) return regionLocations[0].name;\n      }\n      return firstLocation ? firstLocation.name : '';\n    })();\n\n    return {\n      currentRegion: currentRegion || locations.get(playerLocation)?.region || '',\n      detailLocation,\n      focusLocation,\n      playerLocation,\n      locations,\n      elements,\n      characters,\n      allRegions,\n    };\n  };\n\n  // \n  let isMapOpening = false;\n\n  const showMapVisualization = async () => {\n    const { $ } = getCore();\n\n    // \n    if (isMapOpening) return;\n    isMapOpening = true;\n\n    // overlay\n    $('.acu-map-overlay').remove();\n\n    let viewModel = await buildMapViewModel();\n    if (!viewModel) {\n      isMapOpening = false;\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const config = getConfig();\n\n    // \n    const tabSelectionCache = new Map<string, string>();\n\n    // \n    const getHotLocationsInRegion = (region: string) => {\n      const regionName = region || '';\n      return Array.from(viewModel.locations.values())\n        .filter(l => (l.region || '') === regionName)\n        .sort((a, b) => {\n          const scoreA =\n            (viewModel.characters.get(a.name)?.length || 0) + (viewModel.elements.get(a.name)?.length || 0);\n          const scoreB =\n            (viewModel.characters.get(b.name)?.length || 0) + (viewModel.elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n    };\n\n    // \"\"\n    const detailLocation = viewModel.detailLocation || '';\n    const playerLocation = viewModel.playerLocation || '';\n    let focusLocation = '';\n    let selectedRegion = viewModel.currentRegion;\n\n    // :  >  > viewModel.focusLocation\n    if (detailLocation && viewModel.locations.has(detailLocation)) {\n      focusLocation = detailLocation;\n      const targetLocation = viewModel.locations.get(detailLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n      focusLocation = playerLocation;\n      const targetLocation = viewModel.locations.get(playerLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    } else if (viewModel.focusLocation && viewModel.locations.has(viewModel.focusLocation)) {\n      focusLocation = viewModel.focusLocation;\n      const targetLocation = viewModel.locations.get(focusLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    }\n\n    if (focusLocation) {\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      // \n      tabSelectionCache.set(selectedRegion, focusLocation);\n    }\n\n    const overlay = $(`\n            <div class=\"acu-map-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-map-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-map-title\">\n                            <i class=\"fa-solid fa-map-location-dot\"></i>\n                            <span class=\"acu-map-region-name\">${escapeHtml(viewModel.currentRegion || '')}</span>\n                        </div>\n                        <div class=\"acu-map-region-tabs\"></div>\n                        <div class=\"acu-map-actions\">\n                            <button class=\"acu-map-back-btn\" title=\"\"><i class=\"fa-solid fa-location-crosshairs\"></i></button>\n                            <button class=\"acu-close-btn acu-map-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-map-body\">\n                        <div class=\"acu-map-focus-area\"></div>\n                        <div class=\"acu-map-thumbnails\"></div>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const overlayEl = overlay[0];\n    overlayEl.style.setProperty('position', 'fixed', 'important');\n    overlayEl.style.setProperty('top', '0', 'important');\n    overlayEl.style.setProperty('left', '0', 'important');\n    overlayEl.style.setProperty('right', '0', 'important');\n    overlayEl.style.setProperty('bottom', '0', 'important');\n    overlayEl.style.setProperty('width', '100vw', 'important');\n    overlayEl.style.setProperty('height', '100vh', 'important');\n    overlayEl.style.setProperty('display', 'flex', 'important');\n    overlayEl.style.setProperty('justify-content', 'center', 'important');\n    overlayEl.style.setProperty('align-items', 'center', 'important');\n    overlayEl.style.setProperty('z-index', '2147483650', 'important');\n\n    // selectedRegion \n    const $focusArea = overlay.find('.acu-map-focus-area');\n    const $thumbnails = overlay.find('.acu-map-thumbnails');\n\n    const renderElementChip = element => {\n      const name = element.name || element.type || '';\n      const emoji = element.emoji ? `<span class=\"acu-map-chip-emoji\">${element.emoji}</span>` : '';\n      return `\n                 <div class=\"acu-map-element-chip acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n                   element.tableKey || '',\n                 )}\" data-row-index=\"${element.rowIndex}\">\n                     ${emoji}\n                     <span class=\"acu-map-chip-name\" title=\"${escapeHtml(name)}\">${escapeHtml(name)}</span>\n                 </div>\n             `;\n    };\n\n    const renderFocusArea = (model, locationName) => {\n      const location = model.locations.get(locationName);\n      if (!location) {\n        return '<div class=\"acu-map-loading\" style=\"grid-column: 1 / -1;\"><div class=\"acu-map-spinner\"></div></div>';\n      }\n\n      const characters = model.characters.get(locationName) || [];\n      const elements = model.elements.get(locationName) || [];\n\n      // \n      const leftChars = characters.slice(0, Math.ceil(characters.length / 2));\n      const rightChars = characters.slice(Math.ceil(characters.length / 2));\n      const leftElems = elements.slice(0, Math.ceil(elements.length / 2));\n      const rightElems = elements.slice(Math.ceil(elements.length / 2));\n\n      const renderAvatarHtml = char => {\n        const displayName = replaceUserPlaceholders(char.name);\n        const avatarStyle = char.avatarUrl\n          ? `background-image:url('${char.avatarUrl}');background-size:${char.avatarScale}%;background-position:${char.avatarOffsetX}% ${char.avatarOffsetY}%;`\n          : '';\n        return `\n            <div class=\"acu-map-avatar acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n              char.tableKey || '',\n            )}\" data-row-index=\"${char.rowIndex}\">\n                <div class=\"acu-map-avatar-circle\" style=\"${avatarStyle}\">\n                    ${char.avatarUrl ? '' : `<span>${escapeHtml(displayName.charAt(0))}</span>`}\n                </div>\n                <div class=\"acu-map-avatar-name\" title=\"${escapeHtml(displayName)}\">${escapeHtml(\n                  displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName,\n                )}</div>\n            </div>\n        `;\n      };\n\n      const leftAvatarsHtml = leftChars.length ? leftChars.map(renderAvatarHtml).join('') : '';\n      const rightAvatarsHtml = rightChars.length ? rightChars.map(renderAvatarHtml).join('') : '';\n      const leftElemsHtml = leftElems.length ? leftElems.map(e => renderElementChip(e)).join('') : '';\n      const rightElemsHtml = rightElems.length ? rightElems.map(e => renderElementChip(e)).join('') : '';\n\n      const emojiHtml = location.emoji\n        ? `<div class=\"acu-map-location-emoji\">${location.emoji}</div>`\n        : `<div class=\"acu-map-location-text\">${escapeHtml(location.name.charAt(0) || '')}</div>`;\n\n      return `\n        <div class=\"acu-map-wing left\">\n            <div class=\"acu-map-avatar-group acu-group-left\">${leftAvatarsHtml || ''}</div>\n            <div class=\"acu-map-element-group acu-group-left\">${leftElemsHtml || ''}</div>\n        </div>\n        <div class=\"acu-map-stage-center acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n          location.tableKey,\n        )}\" data-row-index=\"${location.rowIndex}\">\n            ${emojiHtml}\n            <div class=\"acu-map-location-name\" title=\"${escapeHtml(location.name)}\">${escapeHtml(location.name)}</div>\n        </div>\n        <div class=\"acu-map-wing right\">\n            <div class=\"acu-map-avatar-group acu-group-right\">${rightAvatarsHtml || ''}</div>\n            <div class=\"acu-map-element-group acu-group-right\">${rightElemsHtml || ''}</div>\n        </div>\n        <div class=\"acu-map-mobile-stack\">\n            <div class=\"acu-map-mobile-avatars\">${leftAvatarsHtml || ''}${rightAvatarsHtml || ''}</div>\n            <div class=\"acu-map-mobile-elements\">${leftElemsHtml || ''}${rightElemsHtml || ''}</div>\n        </div>\n    `;\n    };\n\n    const renderThumbnailLocation = (model, location, isActive) => {\n      const charCount = (model.characters.get(location.name) || []).length;\n      const elementCount = (model.elements.get(location.name) || []).length;\n      const totalCount = charCount + elementCount;\n      const emoji = location.emoji\n        ? `<div class=\"acu-map-thumbnail-emoji\">${location.emoji}</div>`\n        : `<div class=\"acu-map-thumbnail-placeholder\">${escapeHtml(location.name.charAt(0) || '')}</div>`;\n      const badgeHtml = totalCount > 0 ? `<div class=\"acu-map-thumbnail-badge\">${totalCount}</div>` : '';\n      return `\n        <div class=\"acu-map-thumbnail ${isActive ? 'active' : ''}\" data-location=\"${escapeHtml(location.name)}\">\n            ${badgeHtml}\n            ${emoji}\n            <div class=\"acu-map-thumbnail-name\" title=\"${escapeHtml(location.name)}\">${escapeHtml(\n              location.name.length > 6 ? location.name.substring(0, 6) + '..' : location.name,\n            )}</div>\n        </div>\n    `;\n    };\n\n    const renderRegionTabs = (regions, currentRegion) => {\n      if (regions.length <= 1) return '';\n      return regions\n        .map(\n          r =>\n            `<button class=\"acu-map-region-tab ${r === currentRegion ? 'active' : ''}\" data-region=\"${escapeHtml(\n              r,\n            )}\">${escapeHtml(r)}</button>`,\n        )\n        .join('');\n    };\n\n    const refreshPanel = () => {\n      $focusArea.html(renderFocusArea(viewModel, focusLocation));\n\n      const regionLocations = Array.from(viewModel.locations.values())\n        .filter(l => l.region === selectedRegion)\n        .sort((a, b) => {\n          // :  + \n          const scoreA =\n            (viewModel.characters.get(a.name)?.length || 0) + (viewModel.elements.get(a.name)?.length || 0);\n          const scoreB =\n            (viewModel.characters.get(b.name)?.length || 0) + (viewModel.elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n\n      const thumbnails = regionLocations\n        .map(location => renderThumbnailLocation(viewModel, location, location.name === focusLocation))\n        .join('');\n      $thumbnails.html(thumbnails || '<div class=\"acu-map-empty\"></div>');\n\n      overlay.find('.acu-map-region-name').text(selectedRegion || '');\n      overlay.find('.acu-map-region-tabs').html(renderRegionTabs(viewModel.allRegions, selectedRegion));\n    };\n\n    const setFocusLocation = name => {\n      if (!name) return;\n      focusLocation = name;\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      // \n      tabSelectionCache.set(selectedRegion, focusLocation);\n      refreshPanel();\n    };\n\n    refreshPanel();\n\n    overlay.on('click', '.acu-map-close', () => {\n      overlay.remove();\n    });\n    overlay.on('click', '.acu-map-region-tab', function () {\n      const newRegion = $(this).data('region');\n      if (newRegion === selectedRegion) return;\n      selectedRegion = newRegion;\n\n      //  focusLocation \n      const regionLocations = Array.from(viewModel.locations.values()).filter(l => l.region === selectedRegion);\n      const currentInNewRegion = regionLocations.find(l => l.name === focusLocation);\n\n      if (!currentInNewRegion && regionLocations.length > 0) {\n        // :  > \n        const cachedLocation = tabSelectionCache.get(selectedRegion);\n        const cachedInRegion = cachedLocation && regionLocations.find(l => l.name === cachedLocation);\n\n        if (cachedInRegion) {\n          // \n          focusLocation = cachedLocation;\n        } else {\n          // \n          const hotLocations = getHotLocationsInRegion(selectedRegion);\n          focusLocation = hotLocations.length > 0 ? hotLocations[0].name : regionLocations[0].name;\n        }\n        Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      }\n\n      refreshPanel();\n    });\n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-map-overlay')) {\n        overlay.remove();\n      }\n    });\n\n    overlay.on('click', '.acu-map-thumbnail', function () {\n      const locationName = $(this).data('location');\n      if (locationName) setFocusLocation(locationName);\n    });\n\n    overlay.on('click', '.acu-map-back-btn', () => {\n      const fallbackFocus = viewModel.focusLocation;\n      const detailLocation = viewModel.detailLocation || '';\n      const playerLocation = viewModel.playerLocation || '';\n\n      let target = '';\n      if (detailLocation && viewModel.locations.has(detailLocation)) {\n        target = detailLocation;\n      } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n        target = playerLocation;\n      } else if (fallbackFocus && viewModel.locations.has(fallbackFocus)) {\n        target = fallbackFocus;\n      }\n\n      if (!target) return;\n\n      // \n      const targetLocation = viewModel.locations.get(target);\n      const targetRegion = targetLocation?.region || viewModel.currentRegion || '';\n      if (targetRegion !== selectedRegion) {\n        selectedRegion = targetRegion;\n      }\n\n      focusLocation = target;\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      refreshPanel();\n    });\n\n    // \n    isMapOpening = false;\n\n    // \n    // \n  };\n\n  // \n  const showRelationshipGraph = npcTable => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n    $('.acu-relation-graph-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    const headers = npcTable.headers || [];\n    const rows = npcTable.rows || [];\n\n    const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n    const relationIdx = headers.findIndex(h => h && h.includes(''));\n    const npcTableKey = npcTable.key || '';\n\n    console.info(`[DICE]: \"${npcTableKey || ''}\"${rows.length}`);\n\n    if (relationIdx < 0) {\n      console.warn('[DICE]: \"\"');\n      if (window.toastr) window.toastr.warning('\"\"');\n      return;\n    }\n\n    const nodes = new Map();\n    const edges = [];\n\n    // {{user}}\n    const resolveUserPlaceholder = name => {\n      if (!name) return name;\n      const playerName = getPlayerName();\n      const personaName = getPersonaName();\n\n      // \n      const explicitUserVariants = ['<user>', '{{user}}'];\n      const isExplicitUserVariant = explicitUserVariants.some(\n        v => name === v || name.toLowerCase() === v.toLowerCase(),\n      );\n\n      // persona\n      const isPersonaName = personaName && name === personaName;\n\n      // \"\"\n      const isPlayerName = (() => {\n        if (!playerName) return false;\n        // \n        if (name === playerName) return true;\n        // \n        const primaryName = AvatarManager.getPrimaryName(name);\n        return primaryName === playerName;\n      })();\n\n      // {{user}}\n      if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n        return '{{user}}';\n      }\n\n      // \n      return AvatarManager.getPrimaryName(name);\n    };\n\n    const resolveName = name => resolveUserPlaceholder(name);\n\n    const rawData = cachedRawData || getTableData();\n    let playerName = '';\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]) {\n          playerName = sheet.content[1][1] || '';\n          break;\n        }\n      }\n    }\n    const resolvedPlayerName = resolveName(playerName);\n    const playerTableKey = (() => {\n      for (const k in rawData) {\n        if (rawData[k]?.name?.includes('')) return k;\n      }\n      return '';\n    })();\n    nodes.set(resolvedPlayerName, {\n      name: resolvedPlayerName,\n      isPlayer: true,\n      x: 0,\n      y: 0,\n      tableKey: playerTableKey,\n      rowIndex: 0,\n    });\n\n    // \"\"\n    const inSceneColIdx = headers.findIndex(h => h && h.includes(''));\n\n    rows.forEach((row, idx) => {\n      const rawNpcName = row[nameIdx];\n      if (!rawNpcName) return;\n\n      const npcName = resolveName(rawNpcName);\n\n      // \n      let isInScene = false;\n      if (inSceneColIdx > 0) {\n        const inSceneVal = String(row[inSceneColIdx] || '')\n          .trim()\n          .toLowerCase();\n        const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n        if (header.includes('')) {\n          isInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n        } else {\n          isInScene =\n            inSceneVal.startsWith('') || inSceneVal === 'true' || inSceneVal === '' || inSceneVal === 'yes';\n        }\n      }\n\n      if (!nodes.has(npcName)) {\n        nodes.set(npcName, {\n          name: npcName,\n          isPlayer: false,\n          x: 0,\n          y: 0,\n          tableKey: npcTableKey,\n          rowIndex: idx,\n          isInScene: isInScene,\n        });\n      }\n\n      const relationStr = row[relationIdx] || '';\n      const relations = parseRelationshipString(relationStr);\n\n      relations.forEach(rel => {\n        if (!rel.name) return;\n        const resolvedRelName = resolveName(rel.name);\n\n        if (resolvedRelName === npcName) return;\n\n        if (!nodes.has(resolvedRelName)) {\n          // NPC\n          let relRowIndex = -1;\n          let relIsInScene = false;\n          for (let ri = 0; ri < rows.length; ri++) {\n            if (resolveName(rows[ri][nameIdx]) === resolvedRelName) {\n              relRowIndex = ri;\n              // \n              if (inSceneColIdx > 0) {\n                const inSceneVal = String(rows[ri][inSceneColIdx] || '')\n                  .trim()\n                  .toLowerCase();\n                const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n                if (header.includes('')) {\n                  relIsInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n                } else {\n                  relIsInScene =\n                    inSceneVal.startsWith('') ||\n                    inSceneVal === 'true' ||\n                    inSceneVal === '' ||\n                    inSceneVal === 'yes';\n                }\n              }\n              break;\n            }\n          }\n          nodes.set(resolvedRelName, {\n            name: resolvedRelName,\n            isPlayer: resolvedRelName === resolvedPlayerName,\n            x: 0,\n            y: 0,\n            tableKey: relRowIndex >= 0 ? npcTableKey : '',\n            rowIndex: relRowIndex >= 0 ? relRowIndex : undefined,\n            isInScene: relIsInScene,\n          });\n        }\n\n        // /\n        const cleanRelation = rawRel => {\n          if (!rawRel) return [];\n          const parts = String(rawRel)\n            .split(/[,;\\/\\|]+|\\s*[&]\\s*|\\s{2,}|\\n/)\n            .map(s => s.trim())\n            .filter(s => s && s.length < 30); // \n\n          // \n          const commonRelations = [\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n          ];\n\n          return parts\n            .map(p => {\n              // [] \n              p = p.replace(/[(][^)]*[)]/g, '').trim();\n              // === XX/  XX ===\n              const specialSuffixMatch = p.match(/^(.+)(|)$/);\n              if (specialSuffixMatch) {\n                p = specialSuffixMatch[1]; // \"\"  \"\"\n              } else {\n                // === XXYY  YY ===\n                p = p.replace(/^[\\u4e00-\\u9fa5]{2,4}(?=[\\u4e00-\\u9fa5]{1,4}$)/, '');\n              }\n\n              // ===  ===\n              p = p.replace(/^(?:|||?|?|)/, '');\n              p = p.replace(/^(?:?|?|?|)/, '');\n              p = p.replace(/^(?:|?|?)/, '');\n\n              // ===  ===\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n\n              // ===  ===\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^(?:||?)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n\n              p = p.trim();\n\n              // === []  ===\n              if (p.length > 8) {\n                // \n                for (const rel of commonRelations) {\n                  if (p.endsWith(rel)) {\n                    return rel;\n                  }\n                }\n                // 2-4\n                const lastChars = p.slice(-4);\n                for (const rel of commonRelations) {\n                  if (lastChars.includes(rel)) {\n                    return rel;\n                  }\n                }\n                // 3\n                return p.slice(-3);\n              }\n\n              return p;\n            })\n            .filter(s => s && s.length > 0 && s.length <= 8);\n        };\n\n        const cleanedLabels = cleanRelation(rel.relation);\n        if (cleanedLabels.length === 0) cleanedLabels.push('');\n\n        // \n        let existingEdge = edges.find(\n          e =>\n            (e.source === npcName && e.target === resolvedRelName) ||\n            (e.source === resolvedRelName && e.target === npcName),\n        );\n\n        if (!existingEdge) {\n          // \n          edges.push({\n            source: npcName,\n            target: resolvedRelName,\n            // \n            labelsFromSource: cleanedLabels.slice(0, 2), // sourcetarget 2\n            labelsFromTarget: [], // targetsource \n          });\n        } else {\n          // \n          if (existingEdge.source === npcName) {\n            // npcsource labelsFromSource\n            const combined = [...(existingEdge.labelsFromSource || []), ...cleanedLabels];\n            // 2\n            existingEdge.labelsFromSource = [...new Set(combined)].slice(0, 2);\n          } else {\n            // npctarget labelsFromTarget\n            const combined = [...(existingEdge.labelsFromTarget || []), ...cleanedLabels];\n            existingEdge.labelsFromTarget = [...new Set(combined)].slice(0, 2);\n          }\n        }\n      });\n    });\n\n    const nodeArr = Array.from(nodes.values());\n    console.info(`[DICE]${nodeArr.length}${edges.length}`);\n    const centerX = 400,\n      centerY = 300;\n\n    // [] \n    const connectionCount = new Map();\n    nodeArr.forEach(node => connectionCount.set(node.name, 0));\n    edges.forEach(edge => {\n      connectionCount.set(edge.source, (connectionCount.get(edge.source) || 0) + 1);\n      connectionCount.set(edge.target, (connectionCount.get(edge.target) || 0) + 1);\n    });\n\n    // [] \n    const isMobileView = window.innerWidth <= 768;\n    const baseRadius = isMobileView ? 22 : 28;\n    const maxRadius = isMobileView ? 38 : 50;\n    const playerBaseRadius = isMobileView ? 28 : 35;\n    const radiusPerConnection = isMobileView ? 2.5 : 3.5;\n\n    //  getNodeRadius \n    let nodeSizeMultiplier = 1.0; // 1.0\n    let filterInScene = false; // +\n    let filterDirectOnly = false; // \n\n    const getNodeRadius = (nodeName, isPlayer) => {\n      const base = isPlayer ? playerBaseRadius : baseRadius;\n      const count = connectionCount.get(nodeName) || 0;\n      const calculated = Math.min(maxRadius, base + Math.sqrt(count) * radiusPerConnection);\n      // \n      return calculated * nodeSizeMultiplier;\n    };\n\n    // \n    nodeArr.forEach(node => {\n      node.radius = getNodeRadius(node.name, node.isPlayer);\n    });\n\n    // \n    const getFilteredNodes = () => {\n      // \n      if (!filterInScene && !filterDirectOnly) return nodeArr;\n\n      // \n      let directNodes: Set<string> | null = null;\n      if (filterDirectOnly) {\n        directNodes = new Set([resolvedPlayerName]);\n        edges.forEach(edge => {\n          if (edge.source === resolvedPlayerName) directNodes!.add(edge.target);\n          if (edge.target === resolvedPlayerName) directNodes!.add(edge.source);\n        });\n      }\n\n      return nodeArr.filter(n => {\n        // \n        const passInScene = !filterInScene || n.isInScene || n.isPlayer;\n        // \n        const passDirectOnly = !filterDirectOnly || directNodes!.has(n.name);\n        // \n        return passInScene && passDirectOnly;\n      });\n    };\n\n    // [Modified] \n    // ---------------------------------------------------------\n    //  ()\n    const kRepulsion = 20000; //  () - \n    const kSpring = 0.02; //  () - \n    const kGravity = 0.01; //  - \n    const idealLen = 250; //  - \n    const iterations = 300; // \n    const timeStep = 0.5; // \n    const damping = 0.8; //  ()\n\n    // \n    const LAYOUT_CACHE_KEY = 'acu-relation-graph-layout-cache';\n\n    // \n    const getLayoutCacheKey = () => {\n      const nodeNames = nodeArr\n        .map(n => n.name)\n        .sort()\n        .join('|');\n      return `${LAYOUT_CACHE_KEY}-${nodeNames}`;\n    };\n\n    // \n    const saveLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const layoutData = {};\n        nodeArr.forEach(node => {\n          layoutData[node.name] = { x: node.x, y: node.y };\n        });\n        localStorage.setItem(cacheKey, JSON.stringify(layoutData));\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const loadLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const cached = localStorage.getItem(cacheKey);\n        if (!cached) return false;\n\n        const layoutData = JSON.parse(cached);\n        let allNodesFound = true;\n\n        // \n        for (const node of nodeArr) {\n          if (!layoutData[node.name]) {\n            allNodesFound = false;\n            break;\n          }\n        }\n\n        if (allNodesFound) {\n          // \n          nodeArr.forEach(node => {\n            const cached = layoutData[node.name];\n            if (cached) {\n              node.x = cached.x;\n              node.y = cached.y;\n              node.vx = 0;\n              node.vy = 0;\n            }\n          });\n          return true;\n        }\n        return false;\n      } catch (e) {\n        console.warn('[DICE] :', e);\n        return false;\n      }\n    };\n\n    // \n    const clearLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        localStorage.removeItem(cacheKey);\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const runForceDirectedLayout = () => {\n      // \n      nodeArr.forEach(node => {\n        if (node.isPlayer) {\n          node.x = centerX;\n          node.y = centerY;\n          node.vx = 0;\n          node.vy = 0;\n        } else {\n          //  100px \n          const angle = Math.random() * 2 * Math.PI;\n          const dist = 50 + Math.random() * 100;\n          node.x = centerX + Math.cos(angle) * dist;\n          node.y = centerY + Math.sin(angle) * dist;\n          node.vx = 0;\n          node.vy = 0;\n        }\n      });\n\n      //  O(1) \n      const nodeMap = new Map();\n      nodeArr.forEach(n => nodeMap.set(n.name, n));\n\n      //  ()\n      for (let iter = 0; iter < iterations; iter++) {\n        // 1.  ( vs )\n        for (let i = 0; i < nodeArr.length; i++) {\n          const u = nodeArr[i];\n          for (let j = i + 1; j < nodeArr.length; j++) {\n            const v = nodeArr[j];\n            const dx = v.x - u.x;\n            const dy = v.y - u.y;\n            let distSq = dx * dx + dy * dy;\n            if (distSq < 1) distSq = 1; // \n\n            const dist = Math.sqrt(distSq);\n            const force = kRepulsion / distSq;\n\n            const fx = (dx / dist) * force;\n            const fy = (dy / dist) * force;\n\n            if (!u.isPlayer) {\n              u.vx -= fx;\n              u.vy -= fy;\n            }\n            if (!v.isPlayer) {\n              v.vx += fx;\n              v.vy += fy;\n            }\n          }\n        }\n\n        // 2.  ()\n        edges.forEach(edge => {\n          const u = nodeMap.get(edge.source);\n          const v = nodeMap.get(edge.target);\n          if (!u || !v) return;\n\n          const dx = v.x - u.x;\n          const dy = v.y - u.y;\n          const dist = Math.sqrt(dx * dx + dy * dy) || 1;\n\n          // : F = k * ( - )\n          const force = (dist - idealLen) * kSpring;\n\n          const fx = (dx / dist) * force;\n          const fy = (dy / dist) * force;\n\n          if (!u.isPlayer) {\n            u.vx += fx;\n            u.vy += fy;\n          }\n          if (!v.isPlayer) {\n            v.vx -= fx;\n            v.vy -= fy;\n          }\n        });\n\n        // 3.  ()\n        nodeArr.forEach(node => {\n          if (node.isPlayer) return;\n          const dx = centerX - node.x;\n          const dy = centerY - node.y;\n          node.vx += dx * kGravity;\n          node.vy += dy * kGravity;\n        });\n\n        // 4. \n        // \n        const maxSpeed = 50 * (1 - iter / iterations); // \n\n        nodeArr.forEach(node => {\n          if (node.isPlayer) return; //  ()\n\n          // \n          node.vx *= damping;\n          node.vy *= damping;\n\n          // \n          const vMag = Math.sqrt(node.vx * node.vx + node.vy * node.vy);\n          if (vMag > maxSpeed) {\n            node.vx = (node.vx / vMag) * maxSpeed;\n            node.vy = (node.vy / vMag) * maxSpeed;\n          }\n\n          node.x += node.vx * timeStep;\n          node.y += node.vy * timeStep;\n        });\n      }\n\n      // \n      saveLayoutCache();\n    };\n\n    // \n    if (!loadLayoutCache()) {\n      // \n      runForceDirectedLayout();\n    }\n\n    // \n    let scale = 1;\n    let panX = 0;\n    let panY = 0;\n    const minScale = 0.3;\n    const maxScale = 4;\n\n    const overlay = $(`\n            <div class=\"acu-relation-graph-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-relation-graph-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-graph-title\">\n                            <i class=\"fa-solid fa-project-diagram\"></i>\n                            <button class=\"acu-graph-btn acu-filter-toggle\" id=\"filter-in-scene\" title=\"\" style=\"margin-left:8px;padding:4px 6px;font-size:12px;\"><i class=\"fa-solid fa-map-marker-alt\"></i></button>\n                            <button class=\"acu-graph-btn acu-filter-toggle\" id=\"filter-direct-only\" title=\"\" style=\"padding:4px 6px;font-size:12px;\"><i class=\"fa-solid fa-link\"></i></button>\n                        </div>\n                        <div class=\"acu-graph-actions\">\n                            <button class=\"acu-graph-btn\" id=\"graph-relayout\" title=\"\"><i class=\"fa-solid fa-sync\"></i></button>\n                            <button class=\"acu-graph-btn\" id=\"graph-manage-avatar\" title=\"\"><i class=\"fa-solid fa-user-circle\"></i></button>\n                            <button class=\"acu-graph-btn acu-graph-close\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-canvas-wrapper\">\n                        <svg class=\"acu-graph-svg\" viewBox=\"0 0 800 600\">\n                            <defs>\n                                <marker id=\"arrowhead-end\" markerWidth=\"6\" markerHeight=\"5\" refX=\"5\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 6 2.5, 0 5\" fill=\"${t.textSub}\" />\n                                </marker>\n                                <marker id=\"arrowhead-start\" markerWidth=\"6\" markerHeight=\"5\" refX=\"1\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"6 0, 0 2.5, 6 5\" fill=\"${t.textSub}\" />\n                                </marker>\n                                <marker id=\"arrowhead-end-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"6\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 7 3, 0 6\" fill=\"${t.accent}\" />\n                                </marker>\n                                <marker id=\"arrowhead-start-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"1\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"7 0, 0 3, 7 6\" fill=\"${t.accent}\" />\n                                </marker>\n                            </defs>\n                            <g class=\"acu-graph-transform\">\n                                <g class=\"acu-graph-edges\"></g>\n                                <g class=\"acu-graph-nodes\"></g>\n                            </g>\n                        </svg>\n                        <div class=\"acu-node-size-slider-container\" style=\"\n                            position: absolute;\n                            display: none;\n                            width: 200px;\n                            padding: 10px;\n                            background: ${t.bgPanel};\n                            border: 1px solid ${t.border};\n                            border-radius: 8px;\n                            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n                            z-index: 10;\n                        \">\n                            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:6px;\">\n                                <span style=\"font-size:11px;color:${t.textSub};white-space:nowrap;\"></span>\n                                <span id=\"slider-size-display\" style=\"font-size:11px;color:${t.accent};font-weight:bold;min-width:35px;text-align:right;\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                            </div>\n                            <input type=\"range\" id=\"node-size-slider\" min=\"0.5\" max=\"2.0\" step=\"0.1\" value=\"${nodeSizeMultiplier}\" style=\"\n                                width: 100%;\n                                height: 8px;\n                                border-radius: 4px;\n                                background: ${t.btnBg};\n                                outline: none;\n                                cursor: pointer;\n                                -webkit-appearance: none;\n                            \" />\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-legend\">\n                        <button class=\"acu-graph-btn\" id=\"graph-zoom-reset\" title=\"\" style=\"width:auto;height:auto;padding:4px 10px;font-size:11px;display:flex;align-items:center;gap:4px;\"><i class=\"fa-solid fa-compress-arrows-alt\"></i><span></span></button>\n                        <div class=\"acu-node-size-stepper-wrapper\" style=\"display:flex;align-items:center;justify-content:center;gap:6px;\">\n                            <span style=\"font-size:11px;color:var(--acu-text-sub);white-space:nowrap;\">:</span>\n                            <div class=\"acu-stepper\" data-id=\"graph-node-size\" data-min=\"50\" data-max=\"200\" data-step=\"10\" style=\"display:flex;align-items:center;\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\" id=\"node-size-display\" style=\"display:flex;align-items:center;justify-content:center;\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <span class=\"acu-zoom-display\" style=\"display:flex;align-items:center;gap:4px;color:var(--acu-text-sub);font-size:11px;\">\n                            <span>:</span>\n                            <span>${Math.round(scale * 100)}%</span>\n                        </span>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const $svg = overlay.find('.acu-graph-svg');\n    const $transform = overlay.find('.acu-graph-transform');\n    const $edgesGroup = overlay.find('.acu-graph-edges');\n    const $nodesGroup = overlay.find('.acu-graph-nodes');\n    const $zoomDisplay = overlay.find('.acu-zoom-display span:last-child');\n    const $nodeSizeDisplay = overlay.find('#node-size-display');\n    const $wrapper = overlay.find('.acu-graph-canvas-wrapper');\n\n    const updateTransform = () => {\n      $transform.attr('transform', `translate(${panX}, ${panY}) scale(${scale})`);\n      $zoomDisplay.text(`${Math.round(scale * 100)}%`);\n    };\n\n    const updateNodeSizeDisplay = () => {\n      if ($nodeSizeDisplay.length) {\n        $nodeSizeDisplay.text(`${Math.round(nodeSizeMultiplier * 100)}%`);\n      }\n    };\n\n    const zoomTo = (newScale, centerX = 400, centerY = 300) => {\n      const oldScale = scale;\n      scale = Math.max(minScale, Math.min(maxScale, newScale));\n      const scaleChange = scale / oldScale;\n      panX = centerX - (centerX - panX) * scaleChange;\n      panY = centerY - (centerY - panY) * scaleChange;\n      updateTransform();\n    };\n\n    const render = async () => {\n      // \n      const filteredNodes = getFilteredNodes();\n      const filteredNodeNames = new Set(filteredNodes.map(n => n.name));\n\n      // \n      const filteredEdges = edges.filter(\n        edge => filteredNodeNames.has(edge.source) && filteredNodeNames.has(edge.target),\n      );\n\n      let edgesHtml = '';\n      filteredEdges.forEach((edge, edgeIdx) => {\n        const source = nodes.get(edge.source);\n        const target = nodes.get(edge.target);\n        if (!source || !target) return;\n\n        // \n        const dx = target.x - source.x;\n        const dy = target.y - source.y;\n        const len = Math.sqrt(dx * dx + dy * dy) || 1;\n        const nx = dx / len; // \n        const ny = dy / len;\n\n        // \n        const px = -ny;\n        const py = nx;\n\n        // \n        const hasFromSource =\n          edge.labelsFromSource && edge.labelsFromSource.length > 0 && edge.labelsFromSource.some(l => l);\n        const hasFromTarget =\n          edge.labelsFromTarget && edge.labelsFromTarget.length > 0 && edge.labelsFromTarget.some(l => l);\n\n        // \n        const sourceRadius = source.radius || 28;\n        const targetRadius = target.radius || 28;\n        const arrowGap = 10; // \n        const x1 = source.x + nx * (sourceRadius + arrowGap);\n        const y1 = source.y + ny * (sourceRadius + arrowGap);\n        const x2 = target.x - nx * (targetRadius + arrowGap);\n        const y2 = target.y - ny * (targetRadius + arrowGap);\n\n        // \n        let srcLabels = (edge.labelsFromSource || []).filter(l => l);\n        let tgtLabels = (edge.labelsFromTarget || []).filter(l => l);\n\n        // \n        const srcSet = new Set(srcLabels);\n        const tgtSet = new Set(tgtLabels);\n        const commonLabels = [...srcSet].filter(l => tgtSet.has(l));\n\n        // \n        const srcUnique = srcLabels.filter(l => !commonLabels.includes(l));\n        const tgtUnique = tgtLabels.filter(l => !commonLabels.includes(l));\n\n        // \n        let markerStart = '';\n        let markerEnd = '';\n        if (hasFromSource) markerEnd = 'url(#arrowhead-end)';\n        if (hasFromTarget) markerStart = 'url(#arrowhead-start)';\n\n        edgesHtml += `<line class=\"acu-graph-edge\" x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                    ${markerEnd ? `marker-end=\"${markerEnd}\"` : ''}\n                    ${markerStart ? `marker-start=\"${markerStart}\"` : ''}\n                    data-edge-idx=\"${edgeIdx}\" />`;\n\n        // \n        const midX = (source.x + target.x) / 2;\n        const midY = (source.y + target.y) / 2;\n\n        // \n        const lineLen = Math.sqrt(dx * dx + dy * dy);\n\n        // \"\"\n        const isBidirectional = hasFromSource && hasFromTarget;\n        const isBidirectionalSame =\n          isBidirectional && commonLabels.length > 0 && srcUnique.length === 0 && tgtUnique.length === 0;\n\n        // \n        if (isBidirectionalSame) {\n          // \n          commonLabels.slice(0, 2).forEach((lbl, i) => {\n            if (!lbl) return;\n            const offsetDir = i === 0 ? 1 : -1;\n            const offsetDist = 6 + i * 10;\n            const lx = midX + px * offsetDir * offsetDist;\n            const ly = midY + py * offsetDir * offsetDist;\n            edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(lbl)}</text>`;\n          });\n        } else {\n          // \n          // source/target\n          // 25%\n          const safeOffset = Math.max(30, Math.min(lineLen * 0.25, 60));\n\n          // Emoji\n          const relationEmojiMap = [\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', ''] },\n          ];\n\n          // Emoji\n          const addRelationEmoji = lbl => {\n            if (!lbl) return '';\n            for (const group of relationEmojiMap) {\n              for (const kw of group.keywords) {\n                if (lbl.includes(kw)) {\n                  return lbl + group.emoji;\n                }\n              }\n            }\n            return lbl;\n          };\n\n          // emoji\n          const truncateLabel = (lbl, maxLen = 4) => {\n            if (!lbl) return '';\n            const truncated = lbl.length > maxLen ? lbl.substring(0, maxLen) + '..' : lbl;\n            return addRelationEmoji(truncated);\n          };\n\n          // 1. \n          if (commonLabels.length > 0) {\n            commonLabels.slice(0, 1).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const lx = midX + px * 8;\n              const ly = midY + py * 8 - 3;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n\n          // 2. Sourcesource\n          if (srcUnique.length > 0 || (hasFromSource && !hasFromTarget && commonLabels.length === 0)) {\n            const labelsToShow = srcUnique.length > 0 ? srcUnique : srcLabels;\n            // source\n            const labelBaseX = midX - nx * safeOffset;\n            const labelBaseY = midY - ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? 1 : -1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n\n          // 3. Targettarget\n          if (tgtUnique.length > 0 || (hasFromTarget && !hasFromSource && commonLabels.length === 0)) {\n            const labelsToShow = tgtUnique.length > 0 ? tgtUnique : tgtLabels;\n            // target\n            const labelBaseX = midX + nx * safeOffset;\n            const labelBaseY = midY + ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? -1 : 1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n        }\n      });\n      $edgesGroup.html(edgesHtml);\n\n      // [] \n      let nodesHtml = '';\n      for (const node of filteredNodes) {\n        //  > URL > ST\n        const nodeAvatar = await AvatarManager.getAsync(node.name);\n        const isPlayer = node.isPlayer;\n\n        // \n        const indicatorRadius = node.radius * 0.28;\n        const indicatorOffset = node.radius * 0.65;\n        const inSceneIndicator = node.isInScene\n          ? `<circle class=\"acu-node-inscene-indicator\" cx=\"${-indicatorOffset}\" cy=\"${-indicatorOffset}\" r=\"${indicatorRadius}\" style=\"fill:var(--acu-accent);stroke:var(--acu-bg-panel);stroke-width:2;\" />`\n          : '';\n\n        const nodeDisplayName = replaceUserPlaceholders(node.name);\n        nodesHtml += `\n                <g class=\"acu-graph-node acu-dash-preview-trigger\" data-name=\"${escapeHtml(node.name)}\" data-table-key=\"${node.tableKey || ''}\" data-row-index=\"${node.rowIndex !== undefined ? node.rowIndex : ''}\" transform=\"translate(${node.x}, ${node.y})\">\n                    <circle class=\"acu-node-bg\" r=\"${node.radius}\" />\n                    ${\n                      nodeAvatar\n                        ? (() => {\n                            const offsetX = AvatarManager.getOffsetX(node.name);\n                            const offsetY = AvatarManager.getOffsetY(node.name);\n                            const scaleVal = AvatarManager.getScale(node.name);\n                            const size = (node.radius - 2) * 2;\n                            const shadowWidth = 4; // box-shadow\n                            const foSize = size + shadowWidth * 2;\n                            const foOffset = foSize / 2;\n                            return `<foreignObject x=\"${-foOffset}\" y=\"${-foOffset}\" width=\"${foSize}\" height=\"${foSize}\">\n                            <div class=\"acu-node-avatar\" xmlns=\"http://www.w3.org/1999/xhtml\" style=\"\n                                width: ${size}px;\n                                height: ${size}px;\n                                margin: ${shadowWidth}px;\n                                border-radius: 50%;\n                                background-image: url('${nodeAvatar}');\n                                background-size: ${scaleVal}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                                background-repeat: no-repeat;\n                            \"></div>\n                        </foreignObject>`;\n                          })()\n                        : `<text class=\"acu-node-char\" dy=\"0.35em\">${escapeHtml(nodeDisplayName.charAt(0))}</text>`\n                    }\n                    ${inSceneIndicator}\n                    <text class=\"acu-node-label\" dy=\"${node.radius + 14}\">${escapeHtml(nodeDisplayName)}</text>\n                </g>\n            `;\n      }\n      $nodesGroup.html(nodesHtml);\n    };\n\n    // [] \n    const highlightNode = nodeName => {\n      $svg.addClass('highlighting');\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if ($(this).data('name') === nodeName) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedNodes = new Set([nodeName]);\n\n      // \n      edges.forEach(edge => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          const otherNode = edge.source === nodeName ? edge.target : edge.source;\n          connectedNodes.add(otherNode);\n        }\n      });\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if (connectedNodes.has($(this).data('name'))) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedEdgeIndices = new Set();\n      edges.forEach((edge, idx) => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          connectedEdgeIndices.add(idx);\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n          if ($(this).attr('marker-end')) {\n            $(this).attr('marker-end', 'url(#arrowhead-end-hl)');\n          }\n          if ($(this).attr('marker-start')) {\n            $(this).attr('marker-start', 'url(#arrowhead-start-hl)');\n          }\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge-label').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n        }\n      });\n    };\n\n    const clearHighlight = () => {\n      $svg.removeClass('highlighting');\n      $nodesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        if ($(this).attr('marker-end')) {\n          $(this).attr('marker-end', 'url(#arrowhead-end)');\n        }\n        if ($(this).attr('marker-start')) {\n          $(this).attr('marker-start', 'url(#arrowhead-start)');\n        }\n      });\n    };\n\n    // []  - PC +  + \n    // pointerfine()coarse()\n    const hasFinePointer = window.matchMedia('(pointer: fine)').matches;\n    const isTouchDevice = !hasFinePointer;\n\n    // \n    let currentHighlightedNode = null; // \n    let longPressTimer = null;\n\n    if (isTouchDevice) {\n      // ==========  ==========\n      let currentHighlightedNode = null;\n\n      $nodesGroup.on('pointerdown', '.acu-graph-node', function (e) {\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        const startX = e.clientX;\n        const startY = e.clientY;\n        const startTime = Date.now();\n        let hasMoved = false;\n        let longPressTriggered = false;\n\n        // \n        if (currentHighlightedNode) {\n          clearHighlight();\n          currentHighlightedNode = null;\n          // return\n          e.preventDefault();\n          e.stopPropagation();\n          return;\n        }\n\n        // \n        const longPressTimer = setTimeout(() => {\n          if (!hasMoved && nodeName) {\n            longPressTriggered = true;\n            currentHighlightedNode = nodeName;\n            highlightNode(nodeName);\n            if (navigator.vibrate) navigator.vibrate(30);\n          }\n        }, 300);\n\n        const onMove = moveE => {\n          const dx = Math.abs(moveE.clientX - startX);\n          const dy = Math.abs(moveE.clientY - startY);\n          if (dx > 8 || dy > 8) {\n            hasMoved = true;\n            clearTimeout(longPressTimer);\n          }\n        };\n\n        const onUp = () => {\n          $(document).off('pointermove.mobilenode pointerup.mobilenode pointercancel.mobilenode');\n          clearTimeout(longPressTimer);\n\n          const elapsed = Date.now() - startTime;\n\n          //   \n          if (longPressTriggered) {\n            return;\n          }\n\n          //   \n          if (hasMoved) {\n            return;\n          }\n\n          // <300ms  \n          if (elapsed < 300) {\n            const nodeName = $node.data('name');\n            // \n            const primaryName = AvatarManager.getPrimaryName(nodeName);\n            const tableKey = $node.data('table-key');\n            let rowIndex = $node.data('row-index');\n\n            // tableKey\n            if (!tableKey || rowIndex === '' || rowIndex === undefined) {\n              // NPC\n              const rawData = cachedRawData || getTableData();\n              if (rawData) {\n                for (const key in rawData) {\n                  const table = rawData[key];\n                  if (!table?.content || !table.name?.includes('NPC')) continue;\n                  const headers = table.content[0] || [];\n                  const nameIdx = headers.findIndex(\n                    h => h && (h.includes('') || h.includes('') || h.includes('')),\n                  );\n                  if (nameIdx < 0) continue;\n                  for (let i = 1; i < table.content.length; i++) {\n                    const rowName = String(table.content[i][nameIdx] || '').trim();\n                    if (rowName === primaryName || AvatarManager.getPrimaryName(rowName) === primaryName) {\n                      // \n                      const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n                        .data('table-key', key)\n                        .data('row-index', i - 1);\n                      $('body').append(tempNode);\n                      tempNode.trigger('click.acu_dash_preview');\n                      tempNode.remove();\n                      return;\n                    }\n                  }\n                }\n              }\n              // \n              if (window.toastr) {\n                window.toastr.info(`${primaryName}`, '', { timeOut: 2000 });\n              }\n              return;\n            }\n\n            // tableKey\n            const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n              .data('table-key', tableKey)\n              .data('row-index', parseInt(rowIndex, 10));\n            $('body').append(tempNode);\n            tempNode.trigger('click.acu_dash_preview');\n            tempNode.remove();\n          }\n        };\n\n        $(document).on('pointermove.mobilenode', onMove);\n        $(document).on('pointerup.mobilenode pointercancel.mobilenode', onUp);\n      });\n\n      // \n      $wrapper.on('pointerup.mobileclear', function (e) {\n        if (currentHighlightedNode && !$(e.target).closest('.acu-graph-node').length) {\n          clearHighlight();\n          currentHighlightedNode = null;\n        }\n      });\n    } else {\n      // ========== PC ==========\n\n      $nodesGroup.on('pointerenter.pchover', '.acu-graph-node', function () {\n        const nodeName = $(this).data('name');\n        if (nodeName) {\n          highlightNode(nodeName);\n        }\n      });\n\n      $nodesGroup.on('pointerleave.pchover', '.acu-graph-node', function () {\n        clearHighlight();\n      });\n\n      // PC\n      $nodesGroup.on('click.pcclick', '.acu-graph-node', function (e) {\n        e.stopPropagation();\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        // \n        const primaryName = AvatarManager.getPrimaryName(nodeName);\n        const tableKey = $node.data('table-key');\n        let rowIndex = $node.data('row-index');\n\n        // tableKey\n        if (!tableKey || rowIndex === '' || rowIndex === undefined) {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            for (const key in rawData) {\n              const table = rawData[key];\n              if (!table?.content || !table.name?.includes('NPC')) continue;\n              const headers = table.content[0] || [];\n              const nameIdx = headers.findIndex(\n                h => h && (h.includes('') || h.includes('') || h.includes('')),\n              );\n              if (nameIdx < 0) continue;\n              for (let i = 1; i < table.content.length; i++) {\n                const rowName = String(table.content[i][nameIdx] || '').trim();\n                if (rowName === primaryName || AvatarManager.getPrimaryName(rowName) === primaryName) {\n                  const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n                    .data('table-key', key)\n                    .data('row-index', i - 1);\n                  $('body').append(tempNode);\n                  tempNode.trigger('click.acu_dash_preview');\n                  tempNode.remove();\n                  return;\n                }\n              }\n            }\n          }\n          if (window.toastr) {\n            window.toastr.info(`${primaryName}`, '', { timeOut: 2000 });\n          }\n          return;\n        }\n\n        // tableKey\n        const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n          .data('table-key', tableKey)\n          .data('row-index', parseInt(rowIndex, 10));\n        $('body').append(tempNode);\n        tempNode.trigger('click.acu_dash_preview');\n        tempNode.remove();\n      });\n    }\n\n    // \n    render().then(() => {\n      updateTransform();\n    });\n\n    //  -  Pointer Events API\n    let isPanning = false;\n    let panStartX = 0,\n      panStartY = 0;\n    let panStartPanX = 0,\n      panStartPanY = 0;\n    let lastPinchDist = 0;\n    let activePointerId = null;\n\n    const wrapperEl = $wrapper[0];\n    const svgEl = $svg[0];\n\n    // Pointer Down - \n    wrapperEl.onpointerdown = function (e) {\n      if (e.button !== 0) return;\n      // [] \n      if ($(e.target).closest('.acu-graph-node').length) return;\n      // [] \n      if ($(e.target).closest('.acu-node-size-slider-container').length) return;\n      e.preventDefault();\n      wrapperEl.setPointerCapture(e.pointerId);\n      activePointerId = e.pointerId;\n      isPanning = true;\n      panStartX = e.clientX;\n      panStartY = e.clientY;\n      panStartPanX = panX;\n      panStartPanY = panY;\n      svgEl.style.cursor = 'grabbing';\n    };\n\n    // Pointer Move - \n    wrapperEl.onpointermove = function (e) {\n      if (!isPanning || e.pointerId !== activePointerId) return;\n      const dx = e.clientX - panStartX;\n      const dy = e.clientY - panStartY;\n      const rect = svgEl.getBoundingClientRect();\n      panX = panStartPanX + (dx / rect.width) * 800;\n      panY = panStartPanY + (dy / rect.height) * 600;\n      updateTransform();\n    };\n\n    // Pointer Up - \n    wrapperEl.onpointerup = function (e) {\n      if (e.pointerId === activePointerId) {\n        wrapperEl.releasePointerCapture(e.pointerId);\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // Pointer Cancel - \n    wrapperEl.onpointercancel = function (e) {\n      if (e.pointerId === activePointerId) {\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // \n    wrapperEl.onwheel = function (e) {\n      e.preventDefault();\n      const delta = e.deltaY > 0 ? -0.15 : 0.15;\n      zoomTo(scale + delta);\n    };\n\n    // \n    wrapperEl.addEventListener(\n      'touchstart',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          isPanning = false;\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener(\n      'touchmove',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            zoomTo(scale * (newDist / lastPinchDist));\n          }\n          lastPinchDist = newDist;\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener('touchend', function (e) {\n      if (e.touches.length < 2) lastPinchDist = 0;\n    });\n\n    // \n    const cleanupEvents = () => {\n      wrapperEl.onpointerdown = null;\n      wrapperEl.onpointermove = null;\n      wrapperEl.onpointerup = null;\n      wrapperEl.onpointercancel = null;\n      wrapperEl.onwheel = null;\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n      $(document).off('click.slider-hide');\n    };\n\n    // \n    const $nodeSizeSlider = overlay.find('#node-size-slider');\n    const $sliderSizeDisplay = overlay.find('#slider-size-display');\n    const $sliderContainer = overlay.find('.acu-node-size-slider-container');\n    const $nodeSizeDisplayTrigger = overlay.find('#node-size-display-trigger');\n    const $legend = overlay.find('.acu-graph-legend');\n\n    let sliderVisible = false;\n    let sliderHideTimer: ReturnType<typeof setTimeout> | null = null;\n    const SLIDER_AUTO_HIDE_DELAY = 4000; // 4\n\n    // \n    const showSlider = () => {\n      if (sliderVisible) return;\n\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = true;\n\n      // \"\"wrappertriggerlegendlegendwrapper\n      // getBoundingClientRectviewport\n      const triggerRect = $nodeSizeDisplayTrigger[0].getBoundingClientRect();\n      const wrapperRect = $wrapper[0].getBoundingClientRect();\n\n      // wrappertrigger\n      const sliderHeight = 60; // \n      const top = wrapperRect.height - sliderHeight - 10; // wrapper\n      const left = triggerRect.left - wrapperRect.left;\n\n      $sliderContainer.css({\n        display: 'block',\n        top: `${top}px`,\n        left: `${left}px`,\n      });\n\n      // \n      resetSliderHideTimer();\n    };\n\n    // \n    const hideSlider = () => {\n      if (!sliderVisible) return;\n\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = false;\n      $sliderContainer.hide();\n    };\n\n    // \n    const resetSliderHideTimer = () => {\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n      }\n      sliderHideTimer = setTimeout(() => {\n        hideSlider();\n      }, SLIDER_AUTO_HIDE_DELAY);\n    };\n\n    // \"\"/\n    overlay.on('click', '#node-size-display-trigger, #node-size-display-trigger *', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        hideSlider();\n      } else {\n        showSlider();\n      }\n    });\n\n    // \n    $nodeSizeSlider.on('input mousedown touchstart', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        resetSliderHideTimer();\n      }\n    });\n\n    // \n    $sliderContainer.on('pointerdown mousedown touchstart', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $(document).on('click.slider-hide', function (e) {\n      if (\n        sliderVisible &&\n        !$sliderContainer.is(e.target) &&\n        $sliderContainer.has(e.target).length === 0 &&\n        !$nodeSizeDisplayTrigger.is(e.target) &&\n        $nodeSizeDisplayTrigger.has(e.target).length === 0\n      ) {\n        hideSlider();\n      }\n    });\n\n    $nodeSizeSlider.on('input', function () {\n      nodeSizeMultiplier = parseFloat($(this).val());\n      $sliderSizeDisplay.text(Math.round(nodeSizeMultiplier * 100) + '%');\n      updateNodeSizeDisplay();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n      render();\n\n      // \n      resetSliderHideTimer();\n    });\n\n    //  toggle \n    const $filterInSceneBtn = overlay.find('#filter-in-scene');\n    const $filterDirectOnlyBtn = overlay.find('#filter-direct-only');\n\n    const updateFilterToggleStyles = () => {\n      $filterInSceneBtn.css({\n        background: filterInScene ? t.accent : t.btnBg,\n        color: filterInScene ? t.btnActiveText : t.textMain,\n        borderColor: filterInScene ? t.accent : t.border,\n      });\n      $filterDirectOnlyBtn.css({\n        background: filterDirectOnly ? t.accent : t.btnBg,\n        color: filterDirectOnly ? t.btnActiveText : t.textMain,\n        borderColor: filterDirectOnly ? t.accent : t.border,\n      });\n    };\n\n    // \n    updateFilterToggleStyles();\n\n    $filterInSceneBtn.click(function (e) {\n      e.stopPropagation();\n      filterInScene = !filterInScene;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    $filterDirectOnlyBtn.click(function (e) {\n      e.stopPropagation();\n      filterDirectOnly = !filterDirectOnly;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    //  +  + \n    overlay.find('#graph-zoom-reset').click(() => {\n      // \n      scale = 1;\n      panX = 0;\n      panY = 0;\n      updateTransform();\n\n      // \n      nodeSizeMultiplier = 1.0;\n      $nodeSizeSlider.val(1.0);\n      $sliderSizeDisplay.text('100%');\n      updateNodeSizeDisplay();\n\n      // stepper\n      const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n      if ($nodeSizeStepper.length) {\n        $nodeSizeStepper.find('.acu-stepper-value').text('100%');\n      }\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      if (!loadLayoutCache()) {\n        // \n        runForceDirectedLayout();\n      }\n      render();\n    });\n\n    // Stepper  - \n    const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n    if ($nodeSizeStepper.length) {\n      const min = parseInt($nodeSizeStepper.data('min')); // 50\n      const max = parseInt($nodeSizeStepper.data('max')); // 200\n      const step = parseInt($nodeSizeStepper.data('step')); // 10\n      const $value = $nodeSizeStepper.find('.acu-stepper-value');\n\n      const updateNodeSizeValue = (newPercent: number) => {\n        newPercent = Math.max(min, Math.min(max, newPercent));\n        nodeSizeMultiplier = newPercent / 100; //  (0.5-2.0)\n        $value.text(`${newPercent}%`);\n        updateNodeSizeDisplay();\n\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      };\n\n      const getCurrentPercent = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || 100;\n      };\n\n      $nodeSizeStepper.find('.acu-stepper-dec').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() - step);\n      });\n\n      $nodeSizeStepper.find('.acu-stepper-inc').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() + step);\n      });\n    }\n\n    // \n    overlay.find('#graph-relayout').click(() => {\n      // \n      clearLayoutCache();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      runForceDirectedLayout();\n      render();\n    });\n\n    overlay.find('#graph-manage-avatar').click(() => {\n      // \n      showAvatarManager(nodeArr, () => {\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      });\n    });\n\n    const closeGraph = () => {\n      cleanupEvents();\n      overlay.remove();\n    };\n    overlay.find('.acu-graph-close').click(closeGraph);\n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-relation-graph-overlay')) closeGraph();\n    });\n  };\n  // ========================================\n  //  - PC/\n  // ========================================\n\n  const showAvatarCropModal = (imageSource, characterName, onSave) => {\n    const { $ } = getCore();\n    $('.acu-crop-modal-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // \n    let scale = 150;\n    let offsetX = 50;\n    let offsetY = 50;\n\n    // \n    const existing = AvatarManager.getAll()[characterName];\n    if (existing) {\n      scale = existing.scale ?? 150;\n      offsetX = existing.offsetX ?? 50;\n      offsetY = existing.offsetY ?? 50;\n    }\n\n    const modalHtml = `\n            <div class=\"acu-crop-modal-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-crop-modal\">\n                    <div class=\"acu-crop-header\">\n                        <span><i class=\"fa-solid fa-crop-simple\"></i>  - ${escapeHtml(characterName)}</span>\n                        <button class=\"acu-crop-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-crop-body\">\n                        <div class=\"acu-crop-container\">\n                            <div class=\"acu-crop-image\" style=\"\n                                background-image: url('${imageSource}');\n                                background-size: ${scale}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                            \"></div>\n                            <div class=\"acu-crop-mask\"></div>\n                        </div>\n                        <div class=\"acu-crop-hint\">  /</div>\n                    </div>\n                    <div class=\"acu-crop-footer\">\n                        <label class=\"acu-crop-btn acu-crop-reupload\" title=\"\">\n                            <i class=\"fa-solid fa-camera\"></i>\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-crop-file-input\" style=\"display:none;\" />\n                        </label>\n                        <button class=\"acu-crop-btn acu-crop-cancel\"></button>\n                        <button class=\"acu-crop-btn acu-crop-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      'z-index': '2147483658',\n    });\n\n    const $image = $modal.find('.acu-crop-image');\n    const $container = $modal.find('.acu-crop-container');\n    const containerEl = $container[0];\n    const imageEl = $image[0];\n\n    // \n    const updateImageStyle = () => {\n      imageEl.style.backgroundSize = `${scale}%`;\n      imageEl.style.backgroundPosition = `${offsetX}% ${offsetY}%`;\n    };\n\n    // ===  Pointer Events  ===\n    let isDragging = false;\n    let startX = 0,\n      startY = 0;\n    let startOffsetX = 0,\n      startOffsetY = 0;\n    let activePointerId = null;\n\n    imageEl.addEventListener('pointerdown', e => {\n      // \n      if (activePointerId !== null) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      isDragging = true;\n      activePointerId = e.pointerId;\n      startX = e.clientX;\n      startY = e.clientY;\n      startOffsetX = offsetX;\n      startOffsetY = offsetY;\n\n      imageEl.setPointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grabbing';\n    });\n\n    imageEl.addEventListener('pointermove', e => {\n      if (!isDragging || e.pointerId !== activePointerId) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      const deltaX = e.clientX - startX;\n      const deltaY = e.clientY - startY;\n\n      // \n      const sensitivity = 100 / scale;\n      offsetX = Math.max(0, Math.min(100, startOffsetX - deltaX * sensitivity));\n      offsetY = Math.max(0, Math.min(100, startOffsetY - deltaY * sensitivity));\n      updateImageStyle();\n    });\n\n    imageEl.addEventListener('pointerup', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.releasePointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grab';\n    });\n\n    imageEl.addEventListener('pointercancel', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.style.cursor = 'grab';\n    });\n\n    // ===  ===\n    // \n    containerEl.addEventListener(\n      'wheel',\n      e => {\n        e.preventDefault();\n        e.stopPropagation();\n        const delta = e.deltaY > 0 ? -10 : 10;\n        scale = Math.max(100, Math.min(300, scale + delta));\n        updateImageStyle();\n      },\n      { passive: false },\n    );\n\n    // \n    let lastPinchDist = 0;\n    let pinchStartScale = scale;\n\n    containerEl.addEventListener(\n      'touchstart',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          pinchStartScale = scale;\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener(\n      'touchmove',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            const pinchRatio = newDist / lastPinchDist;\n            scale = Math.max(100, Math.min(300, pinchStartScale * pinchRatio));\n            updateImageStyle();\n          }\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener('touchend', e => {\n      if (e.touches.length < 2) {\n        lastPinchDist = 0;\n        pinchStartScale = scale;\n      }\n    });\n\n    // ===  ===\n    // \n    $modal.find('.acu-crop-file-input').on('change', async function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      if (!file.type.startsWith('image/')) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        if (window.toastr) window.toastr.warning(' 5MB');\n        return;\n      }\n\n      try {\n        // \n        const success = await AvatarManager.saveLocalAvatar(characterName, file);\n        if (success) {\n          //  URL \n          const newUrl = await LocalAvatarDB.get(characterName);\n          imageSource = newUrl;\n\n          // \n          scale = 150;\n          offsetX = 50;\n          offsetY = 50;\n\n          // \n          $image.css('background-image', `url('${newUrl}')`);\n          updateImageStyle();\n        }\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n\n      $(this).val('');\n    });\n    $modal.find('.acu-crop-close, .acu-crop-cancel').on('click', () => {\n      $modal.remove();\n    });\n\n    $modal.find('.acu-crop-confirm').on('click', () => {\n      onSave({ scale, offsetX, offsetY });\n      $modal.remove();\n    });\n\n    // \n    $modal.on('click', e => {\n      if ($(e.target).hasClass('acu-crop-modal-overlay')) {\n        $modal.remove();\n      }\n    });\n  };\n  //  - \n  const showAvatarManager = (nodeArr, onUpdate) => {\n    try {\n      const { $ } = getCore();\n      $('.acu-avatar-manager-overlay').remove();\n\n      const config = getConfig();\n      const t = getThemeColors();\n      const avatars = AvatarManager.getAll();\n\n      // {{user}}\n      const resolveUserPlaceholderForAvatar = name => {\n        if (!name) return name;\n        const playerName = getPlayerName();\n        const personaName = getPersonaName();\n\n        // \n        const explicitUserVariants = ['<user>', '{{user}}'];\n        const isExplicitUserVariant = explicitUserVariants.some(\n          v => name === v || name.toLowerCase() === v.toLowerCase(),\n        );\n\n        // persona\n        const isPersonaName = personaName && name === personaName;\n\n        // \"\"\n        const isPlayerName = (() => {\n          if (!playerName) return false;\n          // \n          if (name === playerName) return true;\n          // \n          const primaryName = AvatarManager.getPrimaryName(name);\n          return primaryName === playerName;\n        })();\n\n        // {{user}}\n        if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n          return '{{user}}';\n        }\n\n        // \n        return AvatarManager.getPrimaryName(name);\n      };\n\n      // \n      const buildList = async () => {\n        let listHtml = '';\n\n        // {{user}}\n        const userNode = nodeArr.find(n => {\n          const resolved = resolveUserPlaceholderForAvatar(n.name);\n          return resolved === '{{user}}';\n        });\n        const otherNodes = nodeArr.filter(n => {\n          const resolved = resolveUserPlaceholderForAvatar(n.name);\n          return resolved !== '{{user}}';\n        });\n\n        // {{user}}\n        if (userNode) {\n          // {{user}}'{{user}}'\n          const userNodeForDisplay = {\n            ...userNode,\n            name: '{{user}}', // {{user}}\n          };\n\n          const data = avatars[userNodeForDisplay.name] || {};\n          let currentUrl = data.url || '';\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(userNodeForDisplay.name);\n          let displayUrl = '';\n          let sourceLabel = '';\n\n          if (hasLocal) {\n            displayUrl = await LocalAvatarDB.get(userNodeForDisplay.name);\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n          } else if (currentUrl) {\n            displayUrl = currentUrl;\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n          }\n\n          const aliases = (data.aliases || []).join(', ');\n          const hasAvatar = !!displayUrl;\n\n          listHtml += `\n                    <div class=\"acu-avatar-item\" data-name=\"${escapeHtml(userNodeForDisplay.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <div class=\"acu-avatar-preview-wrap\">\n                            <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" style=\"${hasAvatar ? `background-image: url('${displayUrl}'); background-position: ${data.offsetX ?? 50}% ${data.offsetY ?? 50}%; background-size: ${data.scale ?? 150}%;` : ''}\">\n                                ${!hasAvatar ? `<span>${escapeHtml(userNodeForDisplay.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                            </div>\n                            ${sourceLabel}\n                        </div>\n                        <div class=\"acu-avatar-info\">\n                            <div class=\"acu-avatar-name-row\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(userNodeForDisplay.name)}</div>\n                                <div class=\"acu-avatar-actions\">\n                                    <button class=\"acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                    <button class=\"acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                </div>\n                            </div>\n                            <input type=\"text\" class=\"acu-avatar-url\" placeholder=\"URL...\" value=\"${escapeHtml(currentUrl)}\" />\n                            <input type=\"text\" class=\"acu-avatar-aliases\" placeholder=\"...\" value=\"${escapeHtml(aliases)}\" title=\": , \" />\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none;\" />\n                        </div>\n                    </div>\n                `;\n        }\n\n        // \n        for (const node of otherNodes) {\n          const data = avatars[node.name] || {};\n          let currentUrl = data.url || '';\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(node.name);\n          let displayUrl = '';\n          let sourceLabel = '';\n\n          if (hasLocal) {\n            displayUrl = await LocalAvatarDB.get(node.name);\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n          } else if (currentUrl) {\n            displayUrl = currentUrl;\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n          }\n\n          const aliases = (data.aliases || []).join(', ');\n          const hasAvatar = !!displayUrl;\n\n          listHtml += `\n                    <div class=\"acu-avatar-item\" data-name=\"${escapeHtml(node.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <div class=\"acu-avatar-preview-wrap\">\n                            <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" style=\"${hasAvatar ? `background-image: url('${displayUrl}'); background-position: ${data.offsetX ?? 50}% ${data.offsetY ?? 50}%; background-size: ${data.scale ?? 150}%;` : ''}\">\n                                ${!hasAvatar ? `<span>${escapeHtml(node.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                            </div>\n                            ${sourceLabel}\n                        </div>\n                        <div class=\"acu-avatar-info\">\n                            <div class=\"acu-avatar-name-row\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(node.name)}</div>\n                                <div class=\"acu-avatar-actions\">\n                                    <button class=\"acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                    <button class=\"acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                </div>\n                            </div>\n                            <input type=\"text\" class=\"acu-avatar-url\" placeholder=\"URL...\" value=\"${escapeHtml(currentUrl)}\" />\n                            <input type=\"text\" class=\"acu-avatar-aliases\" placeholder=\"...\" value=\"${escapeHtml(aliases)}\" title=\": , \" />\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none;\" />\n                        </div>\n                    </div>\n                `;\n        }\n\n        return listHtml;\n      };\n\n      // \n      const managerHtml = `\n            <div class=\"acu-avatar-manager-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-avatar-manager\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-avatar-title\"><i class=\"fa-solid fa-user-circle\"></i> </div>\n                        <div style=\"display:flex;gap:4px;align-items:center;\">\n                            <button class=\"acu-avatar-import-btn\" title=\"\"><i class=\"fa-solid fa-file-import\"></i></button>\n                            <button class=\"acu-avatar-export-btn\" title=\"\"><i class=\"fa-solid fa-file-export\"></i></button>\n                            <button class=\"acu-avatar-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-avatar-list\" id=\"acu-avatar-list-container\">\n                        <div style=\"text-align:center;padding:20px;color:${t.textSub};\">\n                            <i class=\"fa-solid fa-spinner fa-spin\"></i> ...\n                        </div>\n                    </div>\n                </div>\n                <input type=\"file\" id=\"acu-avatar-file-input\" accept=\".json\" style=\"display:none;\" />\n            </div>\n        `;\n\n      const $manager = $(managerHtml);\n      $('body').append($manager);\n\n      // \n      buildList().then(listHtml => {\n        $manager.find('#acu-avatar-list-container').html(listHtml);\n        bindAvatarEvents();\n      });\n\n      // \n      const refreshItem = async name => {\n        const $item = $manager.find(`.acu-avatar-item[data-name=\"${name}\"]`);\n        if (!$item.length) return;\n\n        const data = AvatarManager.getAll()[name] || {};\n        const hasLocal = await AvatarManager.hasLocalAvatar(name);\n        let displayUrl = '';\n        let sourceLabel = '';\n\n        if (hasLocal) {\n          displayUrl = await LocalAvatarDB.get(name);\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n        } else if (data.url) {\n          displayUrl = data.url;\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n        }\n\n        const $preview = $item.find('.acu-avatar-preview');\n        $item.find('.acu-avatar-source').remove();\n\n        if (displayUrl) {\n          $preview\n            .addClass('has-image')\n            .css({\n              'background-image': `url('${displayUrl}')`,\n              'background-position': `${data.offsetX ?? 50}% ${data.offsetY ?? 50}%`,\n              'background-size': `${data.scale ?? 150}%`,\n            })\n            .find('span')\n            .remove();\n          $item.find('.acu-avatar-preview-wrap').append(sourceLabel);\n        } else {\n          $preview\n            .removeClass('has-image')\n            .css({ 'background-image': '', 'background-position': '', 'background-size': '' })\n            .html(\n              `<span>${escapeHtml(name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>`,\n            );\n        }\n\n        $item.attr('data-has-local', hasLocal);\n        $item.attr('data-display-url', displayUrl);\n      };\n\n      const bindAvatarEvents = () => {\n        // \n        $manager.on('click', '.acu-avatar-preview', async function (e) {\n          e.stopPropagation();\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const displayUrl = $item.attr('data-display-url');\n\n          if (displayUrl) {\n            //   \n            showAvatarCropModal(displayUrl, name, async result => {\n              const data = AvatarManager.getAll()[name] || {};\n              AvatarManager.set(name, data.url || '', result.offsetX, result.offsetY, result.scale, data.aliases || []);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          } else {\n            //   \n            $item.find('.acu-avatar-file-input').click();\n          }\n        });\n\n        // \n        $manager.on('change', '.acu-avatar-file-input', async function (e) {\n          const file = e.target.files[0];\n          if (!file) return;\n\n          if (!file.type.startsWith('image/')) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          if (file.size > 5 * 1024 * 1024) {\n            if (window.toastr) window.toastr.warning(' 5MB');\n            return;\n          }\n\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n\n          try {\n            const success = await AvatarManager.saveLocalAvatar(name, file);\n            if (success) {\n              const newUrl = await LocalAvatarDB.get(name);\n              await refreshItem(name);\n\n              // \n              showAvatarCropModal(newUrl, name, async result => {\n                const data = AvatarManager.getAll()[name] || {};\n                AvatarManager.set(\n                  name,\n                  data.url || '',\n                  result.offsetX,\n                  result.offsetY,\n                  result.scale,\n                  data.aliases || [],\n                );\n                await refreshItem(name);\n                onUpdate && onUpdate();\n              });\n            }\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            if (window.toastr) window.toastr.error('');\n          }\n\n          $(this).val('');\n        });\n\n        // URL  \n        $manager.on('click', '.acu-avatar-save-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const url = $item.find('.acu-avatar-url').val().trim();\n          const aliasesStr = $item.find('.acu-avatar-aliases').val().trim();\n          const aliases = aliasesStr\n            ? aliasesStr\n                .split(/[,]/)\n                .map(s => s.trim())\n                .filter(s => s && s !== name)\n            : [];\n\n          const data = AvatarManager.getAll()[name] || {};\n\n          // \n          AvatarManager.set(name, url, data.offsetX ?? 50, data.offsetY ?? 50, data.scale ?? 150, aliases);\n\n          // URL\n          const hasLocal = $item.attr('data-has-local') === 'true';\n          if (url && !hasLocal) {\n            await refreshItem(name);\n            showAvatarCropModal(url, name, async result => {\n              AvatarManager.set(name, url, result.offsetX, result.offsetY, result.scale, aliases);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          } else {\n            await refreshItem(name);\n            onUpdate && onUpdate();\n          }\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-clear-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n\n          await AvatarManager.deleteLocalAvatar(name);\n          AvatarManager.remove(name);\n\n          $item.find('.acu-avatar-url').val('');\n          $item.find('.acu-avatar-aliases').val('');\n          await refreshItem(name);\n          onUpdate && onUpdate();\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-export-btn', function () {\n          const exportData = AvatarManager.exportData();\n          const jsonStr = JSON.stringify(exportData, null, 2);\n          const blob = new Blob([jsonStr], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `avatar-config-${new Date().toISOString().slice(0, 10)}.json`;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-import-btn', function () {\n          $manager.find('#acu-avatar-file-input').click();\n        });\n\n        $manager.on('change', '#acu-avatar-file-input', function (e) {\n          const file = e.target.files[0];\n          if (!file) return;\n\n          const reader = new FileReader();\n          reader.onload = function (evt) {\n            try {\n              const jsonData = JSON.parse(evt.target.result);\n              const analysis = AvatarManager.analyzeImport(jsonData);\n\n              if (!analysis.valid) {\n                if (window.toastr) window.toastr.error(analysis.error);\n                return;\n              }\n\n              showImportConfirmDialog(jsonData, analysis, () => {\n                $manager.remove();\n                showAvatarManager(nodeArr, onUpdate);\n                onUpdate && onUpdate();\n              });\n            } catch (err) {\n              console.error('[DICE]ACU :', err);\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n          reader.readAsText(file);\n          $(this).val('');\n        });\n      };\n\n      // \n      const closeManager = () => $manager.remove();\n      $manager.on('click', '.acu-avatar-close', closeManager);\n      $manager.on('click', function (e) {\n        if ($(e.target).hasClass('acu-avatar-manager-overlay')) closeManager();\n      });\n    } catch (error) {\n      console.error(':', error);\n      if (window.toastr) {\n        const errorMsg = error instanceof Error ? error.message : '';\n        window.toastr.error(`: ${errorMsg}`);\n      }\n      // DOM\n      $('.acu-avatar-manager-overlay').remove();\n    }\n  };\n\n  // \n  const showImportConfirmDialog = (jsonData, analysis, onComplete) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const t = getThemeColors();\n    const config = getConfig();\n\n    const hasConflicts = analysis.conflicts.length > 0;\n    const conflictListHtml =\n      analysis.conflicts.length > 0\n        ? `<div style=\"max-height:80px;overflow-y:auto;background:rgba(0,0,0,0.1);border-radius:4px;padding:6px 8px;margin-top:6px;font-size:11px;color:${t.textSub};\">${analysis.conflicts.map(n => escapeHtml(n)).join(', ')}</div>`\n        : '';\n\n    const dialogHtml = `\n            <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-import-confirm-dialog\">\n                    <div class=\"acu-import-confirm-header\">\n                        <i class=\"fa-solid fa-file-import\"></i> \n                    </div>\n                    <div class=\"acu-import-confirm-body\">\n                        <div class=\"acu-import-stats\">\n                            <div class=\"acu-import-stat\">\n                                <span class=\"acu-stat-num\">${analysis.total}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-new\">\n                                <span class=\"acu-stat-num\">${analysis.newItems.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-conflict\">\n                                <span class=\"acu-stat-num\">${analysis.conflicts.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                        </div>\n\n                        ${\n                          hasConflicts\n                            ? `\n                            <div class=\"acu-import-conflict-section\">\n                                <div style=\"font-size:12px;font-weight:bold;color:${t.textMain};margin-bottom:4px;\">\n                                    <i class=\"fa-solid fa-exclamation-triangle\" style=\"color:${t.warningIcon};\"></i> \n                                </div>\n                                ${conflictListHtml}\n                                <div class=\"acu-import-conflict-options\">\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"overwrite\" checked />\n                                        <span></span>\n                                    </label>\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"skip\" />\n                                        <span></span>\n                                    </label>\n                                </div>\n                            </div>\n                        `\n                            : `\n                            <div style=\"text-align:center;padding:10px;color:${t.successText};\">\n                                <i class=\"fa-solid fa-check-circle\"></i> \n                            </div>\n                        `\n                        }\n                    </div>\n                    <div class=\"acu-import-confirm-footer\">\n                        <button class=\"acu-import-cancel-btn\"></button>\n                        <button class=\"acu-import-confirm-btn\"></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n            position: fixed !important;\n            top: 0 !important;\n            left: 0 !important;\n            right: 0 !important;\n            bottom: 0 !important;\n            width: 100vw !important;\n            height: 100vh !important;\n            background: rgba(0,0,0,0.6) !important;\n            z-index: 2147483655 !important;\n            display: flex;\n            justify-content: center !important;\n            align-items: center !important;\n            padding: 16px;\n            box-sizing: border-box !important;\n        `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(closeDialog);\n    $dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-import-confirm-overlay')) closeDialog();\n    });\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const overwrite = $dialog.find('input[name=\"conflict-mode\"]:checked').val() !== 'skip';\n      try {\n        const stats = AvatarManager.importData(jsonData, overwrite);\n        closeDialog();\n        onComplete && onComplete();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + err.message);\n      }\n    });\n  };\n  // []  ()\n  const showCardEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    let rawData = cachedRawData || getTableData() || loadSnapshot();\n\n    let displayRow = row;\n    // \n    if (rawData && rawData[tableKey] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n      displayRow = rawData[tableKey]?.content?.[rowIndex + 1];\n    }\n\n    const inputsHtml = displayRow\n      .map((cell, idx) => {\n        if (idx === 0) return ''; // \n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        //  textarea\n        return `\n                <div class=\"acu-card-edit-field\" style=\"margin-bottom: 10px;\">\n                    <label style=\"display:block;font-size:12px;color:var(--acu-accent);font-weight:bold;margin-bottom:4px;\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\"\n                    style=\"width:100%;min-height:40px;max-height:500px;padding:10px;resize:none;overflow-y:hidden;\">${escapeHtml(val)}</textarea>\n                </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${inputsHtml}\n                    </div>\n                     <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-card-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-card-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // --- []  ---\n    const adjustHeight = el => {\n      //  auto  0px shrinking  scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    // -----------------------------\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-card-cancel').click(closeDialog);\n\n    //  v8.4  saveDataToDatabase\n    dialog.find('#dlg-card-save').click(async () => {\n      let rawData = cachedRawData || getTableData() || loadSnapshot();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n        if (hasChanges) {\n          try {\n            await saveDataToDatabase(rawData, false, true); //  v8.4 \n            renderInterface();\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            // \n            return;\n          }\n        }\n      }\n      closeDialog();\n    });\n    dialog.on('click', function (e) {\n      // \n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        closeDialog();\n        return;\n      }\n      // \n      if ($(e.target).closest('#dlg-close-x, #dlg-close, .acu-close-btn').length) {\n        closeDialog();\n      }\n    });\n  };\n\n  // [] \n  let _configCache = null;\n  const getConfig = () => {\n    if (!_configCache) _configCache = { ...DEFAULT_CONFIG, ...Store.get(STORAGE_KEY_UI_CONFIG, {}) };\n    return _configCache;\n  };\n  const saveConfig = newCfg => {\n    _configCache = { ...getConfig(), ...newCfg };\n    Store.set(STORAGE_KEY_UI_CONFIG, _configCache);\n    applyConfigStyles(_configCache);\n  };\n\n  const generateDiffMap = currentData => {\n    const lastData = loadSnapshot();\n    const diffSet = new Set();\n    if (!lastData) return diffSet;\n\n    for (const sheetId in currentData) {\n      const newSheet = currentData[sheetId];\n      const oldSheet = lastData[sheetId];\n      if (!newSheet || !newSheet.name) continue;\n      const tableName = newSheet.name;\n      if (!oldSheet) {\n        if (newSheet.content) {\n          newSheet.content.forEach((row, rIdx) => {\n            if (rIdx > 0) diffSet.add(`${tableName}-row-${rIdx - 1}`);\n          });\n        }\n        continue;\n      }\n      const newRows = newSheet.content || [];\n      const oldRows = oldSheet.content || [];\n      newRows.forEach((row, rIdx) => {\n        if (rIdx === 0) return;\n        const oldRow = oldRows[rIdx];\n        if (!oldRow) {\n          diffSet.add(`${tableName}-row-${rIdx - 1}`);\n        } else {\n          row.forEach((cell, cIdx) => {\n            if (cIdx === 0) return;\n            const oldCell = oldRow[cIdx];\n            if (String(cell) !== String(oldCell)) diffSet.add(`${tableName}-${rIdx - 1}-${cIdx}`);\n          });\n        }\n      });\n    }\n    return diffSet;\n  };\n\n  const applyConfigStyles = config => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    const fontVal = FONTS.find(f => f.id === config.fontFamily)?.val || FONTS[0].val;\n\n    // []  ID  Style \n    const $styleTag = $('#acu-dynamic-font');\n    const currentFontId = $styleTag.data('font-id');\n\n    if (currentFontId !== config.fontFamily) {\n      $styleTag.remove();\n      const fontImport = `\n                @import url(\"https://fontsapi.zeoseven.com/3/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/442/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/256/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/482/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/446/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/570/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/292/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/69/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/7/main/result.css\");\n            `;\n      $('head').append(`\n                <style id=\"acu-dynamic-font\" data-font-id=\"${config.fontFamily}\">\n                    ${fontImport}\n                    .acu-wrapper, .acu-edit-dialog, .acu-cell-menu, .acu-nav-container, .acu-data-card, .acu-panel-title, .acu-settings-label, .acu-btn-block, .acu-nav-btn, .acu-edit-textarea,\n                    .acu-dice-panel, .acu-contest-panel, .acu-dice-config-dialog,\n                    .acu-relation-graph-container, .acu-avatar-manager, .acu-import-confirm-dialog {\n                        font-family: ${fontVal} !important;\n                    }\n                </style>\n            `);\n    }\n\n    // []  CSS \n    const cssVars = {\n      '--acu-card-width': `${config.cardWidth}px`,\n      '--acu-font-size': `${config.fontSize}px`,\n      '--acu-opt-font-size': `${config.optionFontSize || 12}px`,\n      '--acu-grid-cols': config.gridColumns,\n    };\n\n    if ($wrapper.length) {\n      $wrapper.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $wrapper.addClass(`acu-theme-${config.theme}`);\n      $wrapper.css(cssVars);\n    }\n\n    const $optContainer = $('.acu-embedded-options-container');\n    if ($optContainer.length) {\n      $optContainer.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $optContainer.addClass(`acu-theme-${config.theme}`);\n      $optContainer.css(cssVars);\n    }\n  };\n\n  const addStyles = () => {\n    if (window._acuStylesInjected && $(`#${SCRIPT_ID}-styles`).length) return;\n    window._acuStylesInjected = true;\n    const { $ } = getCore();\n    $('style').each(function () {\n      if (this.id && this.id.startsWith('acu_') && this.id.endsWith('-styles') && this.id !== `${SCRIPT_ID}-styles`)\n        $(this).remove();\n    });\n    $(`#${SCRIPT_ID}-styles`).remove();\n    const styles = `\n        <style id=\"${SCRIPT_ID}-styles\">\n    /* ==========  ========== */\n    .acu-wrapper,\n    .acu-wrapper *:not(i[class*=\"fa-\"]),\n    .acu-edit-overlay,\n    .acu-edit-overlay *:not(i[class*=\"fa-\"]),\n    .acu-cell-menu,\n    .acu-cell-menu *:not(i[class*=\"fa-\"]),\n    .acu-dice-panel,\n    .acu-dice-panel *:not(i[class*=\"fa-\"]),\n    .acu-contest-panel,\n    .acu-contest-panel *:not(i[class*=\"fa-\"]),\n    .acu-relation-graph-overlay,\n    .acu-relation-graph-overlay *:not(i[class*=\"fa-\"]),\n    .acu-avatar-manager-overlay,\n    .acu-avatar-manager-overlay *:not(i[class*=\"fa-\"]),\n    .acu-preview-overlay,\n    .acu-preview-overlay *:not(i[class*=\"fa-\"]),\n    .acu-import-confirm-overlay,\n    .acu-import-confirm-overlay *:not(i[class*=\"fa-\"]),\n    .acu-embedded-options-container,\n    .acu-embedded-options-container *:not(i[class*=\"fa-\"]) {\n        box-sizing: border-box;\n        -webkit-tap-highlight-color: transparent;\n        -webkit-font-smoothing: antialiased;\n    }\n    /* ==========  ========== */\n    .acu-wrapper,\n    .acu-edit-overlay,\n    .acu-dice-panel,\n    .acu-contest-panel,\n    .acu-relation-graph-overlay,\n    .acu-avatar-manager-overlay,\n    .acu-preview-overlay,\n    .acu-import-confirm-overlay,\n    .acu-embedded-options-container,\n    .acu-cell-menu {\n        font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;\n        font-size: 13px;\n        line-height: 1.5;\n        color: var(--acu-text-main);\n    }\n    /*  ( !important  SillyTavern ) */\n    .acu-dice-panel,\n    .acu-contest-panel,\n    .acu-dice-config-dialog {\n        background: var(--acu-bg-panel);\n        color: var(--acu-text-main);\n    }\n    .acu-dice-panel input[type=\"text\"],\n    .acu-dice-panel input[type=\"number\"],\n    .acu-dice-panel input:not([type]),\n    .acu-dice-panel select,\n    .acu-contest-panel input[type=\"text\"],\n    .acu-contest-panel input[type=\"number\"],\n    .acu-contest-panel input:not([type]),\n    .acu-contest-panel select,\n    .acu-dice-config-dialog input[type=\"text\"],\n    .acu-dice-config-dialog input[type=\"number\"],\n    .acu-dice-config-dialog input:not([type]),\n    .acu-dice-config-dialog select {\n        width: 100%;\n        padding: 6px;\n        background: var(--acu-input-bg) !important;\n        border: 1px solid var(--acu-border) !important;\n        border-radius: 4px;\n        color: var(--acu-text-main) !important;\n        font-size: 12px;\n    }\n    /* number */\n    .acu-dice-panel input[type=\"number\"]::-webkit-inner-spin-button,\n    .acu-dice-panel input[type=\"number\"]::-webkit-outer-spin-button,\n    .acu-contest-panel input[type=\"number\"]::-webkit-inner-spin-button,\n    .acu-contest-panel input[type=\"number\"]::-webkit-outer-spin-button,\n    .acu-dice-config-dialog input[type=\"number\"]::-webkit-inner-spin-button,\n    .acu-dice-config-dialog input[type=\"number\"]::-webkit-outer-spin-button {\n        -webkit-appearance: none;\n        margin: 0;\n    }\n    .acu-dice-panel input[type=\"number\"],\n    .acu-contest-panel input[type=\"number\"],\n    .acu-dice-config-dialog input[type=\"number\"] {\n        -moz-appearance: textfield;\n        text-align: center;\n        box-sizing: border-box;\n    }\n    .acu-dice-panel input::placeholder,\n    .acu-contest-panel input::placeholder,\n    .acu-dice-config-dialog input::placeholder {\n        color: var(--acu-text-sub) !important;\n        opacity: 0.7;\n    }\n    .acu-dice-panel input:focus,\n    .acu-dice-panel select:focus,\n    .acu-contest-panel input:focus,\n    .acu-contest-panel select:focus,\n    .acu-dice-config-dialog input:focus,\n    .acu-dice-config-dialog select:focus {\n        outline: none;\n        border-color: var(--acu-accent) !important;\n    }\n    .acu-dice-panel select option,\n    .acu-contest-panel select option,\n    .acu-dice-config-dialog select option {\n        background: var(--acu-bg-panel);\n        color: var(--acu-text-main);\n    }\n    /*  */\n    .acu-dice-select {\n        width: 100%;\n        padding: 6px 4px;\n        background: var(--acu-input-bg) !important;\n        border: 1px solid var(--acu-border) !important;\n        border-radius: 4px;\n        color: var(--acu-text-main) !important;\n        font-size: 11px;\n        box-sizing: border-box;\n        cursor: pointer;\n        -webkit-appearance: none;\n        text-align: center;\n        appearance: none;\n    }\n    .acu-dice-select:focus {\n        outline: none;\n        border-color: var(--acu-accent) !important;\n    }\n    .acu-dice-select option {\n        background: var(--acu-bg-panel) !important;\n        color: var(--acu-text-main) !important;\n    }\n    /*  */\n    .acu-wrapper .acu-search-input {\n        background-color: var(--acu-input-bg) !important;\n        color: var(--acu-text-main) !important;\n        border: 1px solid var(--acu-border);\n    }\n    .acu-wrapper .acu-search-input:focus {\n        outline: none;\n        border-color: var(--acu-accent);\n        box-shadow: none !important;\n    }\n    .acu-wrapper .acu-search-input::placeholder {\n        color: var(--acu-text-sub) !important;\n        opacity: 0.7;\n    }\n    /* ==========  ========== */\n    /*  */\n    .acu-wrapper button,\n    .acu-edit-overlay button,\n    .acu-dice-panel button,\n    .acu-contest-panel button,\n    .acu-relation-graph-overlay button,\n    .acu-avatar-manager-overlay button,\n    .acu-preview-overlay button,\n    .acu-embedded-options-container button {\n        font-family: inherit;\n        font-size: inherit;\n        line-height: 1.4;\n        cursor: pointer;\n        border: 1px solid var(--acu-border);\n        border-radius: 6px;\n        background: var(--acu-btn-bg);\n        color: var(--acu-text-main);\n        transition: all 0.2s ease;\n        outline: none;\n    }\n    .acu-wrapper button:hover,\n    .acu-edit-overlay button:hover,\n    .acu-dice-panel button:hover,\n    .acu-contest-panel button:hover,\n    .acu-relation-graph-overlay button:hover,\n    .acu-avatar-manager-overlay button:hover,\n    .acu-preview-overlay button:hover,\n    .acu-embedded-options-container button:hover {\n        background: var(--acu-btn-hover);\n    }\n    .acu-wrapper button:focus,\n    .acu-edit-overlay button:focus,\n    .acu-dice-panel button:focus,\n    .acu-contest-panel button:focus,\n    .acu-relation-graph-overlay button:focus,\n    .acu-avatar-manager-overlay button:focus,\n    .acu-preview-overlay button:focus,\n    .acu-embedded-options-container button:focus {\n        outline: none;\n        box-shadow: none;\n    }\n\n    /*  */\n    .acu-wrapper input,\n    .acu-wrapper textarea,\n    .acu-wrapper select,\n    .acu-edit-overlay input,\n    .acu-edit-overlay textarea,\n    .acu-edit-overlay select,\n    .acu-dice-panel input,\n    .acu-dice-panel select,\n    .acu-contest-panel input,\n    .acu-contest-panel select,\n    .acu-avatar-manager-overlay input {\n        font-family: inherit;\n        font-size: inherit;\n        line-height: 1.4;\n        border: 1px solid var(--acu-border);\n        border-radius: 4px;\n        background: var(--acu-btn-bg);\n        color: var(--acu-text-main);\n        outline: none;\n        transition: border-color 0.2s;\n    }\n    .acu-wrapper input:focus,\n    .acu-wrapper textarea:focus,\n    .acu-wrapper select:focus,\n    .acu-edit-overlay input:focus,\n    .acu-edit-overlay textarea:focus,\n    .acu-edit-overlay select:focus,\n    .acu-dice-panel input:focus,\n    .acu-dice-panel select:focus,\n    .acu-contest-panel input:focus,\n    .acu-contest-panel select:focus,\n    .acu-avatar-manager-overlay input:focus {\n        border-color: var(--acu-accent);\n        box-shadow: none;\n        outline: none;\n    }\n    .acu-wrapper input::placeholder,\n    .acu-wrapper textarea::placeholder,\n    .acu-dice-panel input::placeholder,\n    .acu-contest-panel input::placeholder,\n    .acu-avatar-manager-overlay input::placeholder {\n        color: var(--acu-text-sub);\n        opacity: 0.7;\n    }\n\n    /*  */\n    .acu-edit-overlay,\n    .acu-dice-overlay,\n    .acu-contest-overlay,\n    .acu-relation-graph-overlay,\n    .acu-avatar-manager-overlay,\n    .acu-preview-overlay,\n    .acu-import-confirm-overlay,\n    .acu-dice-config-overlay,\n    .acu-crop-modal-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0,0,0,0.6);\n        z-index: 2147483646;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 16px;\n        backdrop-filter: blur(2px);\n    }\n\n    /*  */\n    .acu-edit-dialog,\n    .acu-dice-panel,\n    .acu-contest-panel,\n    .acu-relation-graph-container,\n    .acu-avatar-manager,\n    .acu-import-confirm-dialog,\n    .acu-dice-config-dialog {\n        background: var(--acu-bg-panel);\n        border: 1px solid var(--acu-border);\n        border-radius: 12px;\n        box-shadow: 0 20px 60px rgba(0,0,0,0.4);\n        overflow: hidden;\n        display: flex;\n        flex-direction: column;\n    }\n\n    /*  -  .acu-panel-header */\n    .acu-panel-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 12px 15px;\n        background: var(--acu-table-head);\n        border-bottom: 1px solid var(--acu-border);\n        flex-shrink: 0;\n    }\n\n    /*  -  .acu-close-btn */\n    .acu-close-btn {\n        background: none;\n        border: none;\n        color: var(--acu-text-sub);\n        cursor: pointer;\n        font-size: 16px;\n        padding: 4px 8px;\n        border-radius: 4px;\n        transition: all 0.2s;\n    }\n    .acu-close-btn:hover {\n        background: var(--acu-error-bg, rgba(231, 76, 60, 0.15));\n        color: var(--acu-error-text, #e74c3c);\n    }\n\n    /*  */\n    [class^=\"acu-\"], [class^=\"acu-\"] * { scrollbar-width: none; -ms-overflow-style: none; }\n    [class^=\"acu-\"] *::-webkit-scrollbar { display: none !important; }\n\n    /* ==========  ========== */\n    .acu-theme-retro { --acu-bg-nav: #e6e2d3; --acu-bg-panel: #e6e2d3; --acu-border: #dcd0c0; --acu-text-main: #5e4b35; --acu-text-sub: #999; --acu-btn-bg: #dcd0c0; --acu-btn-hover: #cbbba8; --acu-btn-active-bg: #8d7b6f; --acu-btn-active-text: #fdfaf5; --acu-accent: #7a695f; --acu-table-head: #efebe4; --acu-table-hover: #f0ebe0; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #fffef9; --acu-badge-bg: #efebe4; --acu-menu-bg: #fff; --acu-menu-text: #333; --acu-success-text: #27ae60; --acu-success-bg: rgba(39, 174, 96, 0.15); --acu-scrollbar-track: #e6e2d3; --acu-scrollbar-thumb: #cbbba8; --acu-input-bg: #f5f2eb;--acu-hl-manual: #d35400; --acu-hl-manual-bg: rgba(211, 84, 0, 0.15); --acu-hl-diff: #2980b9; --acu-hl-diff-bg: rgba(41, 128, 185, 0.15); --acu-error-text: #e74c3c; --acu-error-bg: rgba(231, 76, 60, 0.15); --acu-error-border: rgba(231, 76, 60, 0.5); --acu-warning-icon: #e67e22; --acu-failure-text: #e74c3c; --acu-failure-bg: rgba(231, 76, 60, 0.15); --acu-warning-text: #f39c12; --acu-warning-bg: rgba(243, 156, 18, 0.15); --acu-crit-success-text: #9b59b6; --acu-crit-success-bg: rgba(155, 89, 182, 0.15); --acu-crit-failure-text: #c0392b; --acu-crit-failure-bg: rgba(192, 57, 43, 0.15); --acu-extreme-success-text: #2980b9; --acu-extreme-success-bg: rgba(41, 128, 185, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.4); --acu-light-bg: rgba(0,0,0,0.1); --acu-very-light-bg: rgba(0,0,0,0.02); --acu-button-text: #5e4b35; --acu-gray-bg: rgba(128,128,128,0.1); }\n    .acu-theme-dark { --acu-bg-nav: #2b2b2b; --acu-bg-panel: #252525; --acu-border: #444; --acu-text-main: #eee; --acu-text-sub: #aaa; --acu-btn-bg: #3a3a3a; --acu-btn-hover: #4a4a4a; --acu-btn-active-bg: #6a5acd; --acu-btn-active-text: #fff; --acu-accent: #9b8cd9; --acu-table-head: #333333; --acu-table-hover: #3a3a3a; --acu-shadow: rgba(0,0,0,0.6); --acu-card-bg: #2d3035; --acu-badge-bg: #3a3f4b; --acu-menu-bg: #333; --acu-menu-text: #eee; --acu-success-text: #4cd964; --acu-success-bg: rgba(76, 217, 100, 0.2); --acu-scrollbar-track: #2b2b2b; --acu-scrollbar-thumb: #555; --acu-hl-manual: #ff6b81; --acu-hl-manual-bg: rgba(255, 107, 129, 0.2); --acu-hl-diff: #00d2d3; --acu-hl-diff-bg: rgba(0, 210, 211, 0.2); --acu-error-text: #ff6b6b; --acu-error-bg: rgba(255, 107, 107, 0.2); --acu-error-border: rgba(255, 107, 107, 0.5); --acu-warning-icon: #ffa726; --acu-failure-text: #ff6b6b; --acu-failure-bg: rgba(255, 107, 107, 0.2); --acu-warning-text: #ffa726; --acu-warning-bg: rgba(255, 167, 38, 0.2); --acu-crit-success-text: #ba68c8; --acu-crit-success-bg: rgba(186, 104, 200, 0.2); --acu-crit-failure-text: #d32f2f; --acu-crit-failure-bg: rgba(211, 47, 47, 0.2); --acu-extreme-success-text: #42a5f5; --acu-extreme-success-bg: rgba(66, 165, 245, 0.2); --acu-overlay-bg: rgba(0,0,0,0.75); --acu-overlay-bg-light: rgba(0,0,0,0.65); --acu-shadow-bg: rgba(0,0,0,0.6); --acu-light-bg: rgba(255,255,255,0.05); --acu-very-light-bg: rgba(255,255,255,0.02); --acu-button-text: #fff; --acu-gray-bg: rgba(255,255,255,0.1); }\n    .acu-theme-modern { --acu-bg-nav: #ffffff; --acu-bg-panel: #f8f9fa; --acu-border: #e0e0e0; --acu-text-main: #333; --acu-text-sub: #666; --acu-btn-bg: #f1f3f5; --acu-btn-hover: #e9ecef; --acu-btn-active-bg: #007bff; --acu-btn-active-text: #fff; --acu-accent: #007bff; --acu-table-head: #f8f9fa; --acu-table-hover: #f1f3f5; --acu-shadow: rgba(0,0,0,0.1); --acu-card-bg: #ffffff; --acu-badge-bg: #f1f3f5; --acu-menu-bg: #fff; --acu-menu-text: #333; --acu-success-text: #28a745; --acu-success-bg: rgba(40, 167, 69, 0.15); --acu-scrollbar-track: #fff; --acu-scrollbar-thumb: #ccc; --acu-hl-manual: #fd7e14; --acu-hl-manual-bg: rgba(253, 126, 20, 0.15); --acu-hl-diff: #0d6efd; --acu-hl-diff-bg: rgba(13, 110, 253, 0.15); --acu-error-text: #dc3545; --acu-error-bg: rgba(220, 53, 69, 0.15); --acu-error-border: rgba(220, 53, 69, 0.5); --acu-warning-icon: #fd7e14; --acu-failure-text: #dc3545; --acu-failure-bg: rgba(220, 53, 69, 0.15); --acu-warning-text: #ffc107; --acu-warning-bg: rgba(255, 193, 7, 0.15); --acu-crit-success-text: #6f42c1; --acu-crit-success-bg: rgba(111, 66, 193, 0.15); --acu-crit-failure-text: #c82333; --acu-crit-failure-bg: rgba(200, 35, 51, 0.15); --acu-extreme-success-text: #17a2b8; --acu-extreme-success-bg: rgba(23, 162, 184, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.4); --acu-light-bg: rgba(0,0,0,0.1); --acu-very-light-bg: rgba(0,0,0,0.02); --acu-button-text: #333; --acu-gray-bg: rgba(128,128,128,0.1); }\n    .acu-theme-forest { --acu-bg-nav: #e8f5e9; --acu-bg-panel: #e8f5e9; --acu-border: #c8e6c9; --acu-text-main: #2e7d32; --acu-text-sub: #81c784; --acu-btn-bg: #c8e6c9; --acu-btn-hover: #a5d6a7; --acu-btn-active-bg: #43a047; --acu-btn-active-text: #fff; --acu-accent: #4caf50; --acu-table-head: #dcedc8; --acu-table-hover: #f1f8e9; --acu-shadow: rgba(0,0,0,0.1); --acu-card-bg: #ffffff; --acu-badge-bg: #dcedc8; --acu-menu-bg: #fff; --acu-menu-text: #2e7d32; --acu-success-text: #2e7d32; --acu-success-bg: rgba(46, 125, 50, 0.2); --acu-scrollbar-track: #e8f5e9; --acu-scrollbar-thumb: #a5d6a7; --acu-hl-manual: #e67e22; --acu-hl-manual-bg: rgba(230, 126, 34, 0.15); --acu-hl-diff: #1e8449; --acu-hl-diff-bg: rgba(30, 132, 73, 0.2); --acu-button-text: #2e7d32; }\n    .acu-theme-ocean { --acu-bg-nav: #e3f2fd; --acu-bg-panel: #e3f2fd; --acu-border: #90caf9; --acu-text-main: #1565c0; --acu-text-sub: #64b5f6; --acu-btn-bg: #bbdefb; --acu-btn-hover: #90caf9; --acu-btn-active-bg: #1976d2; --acu-btn-active-text: #fff; --acu-accent: #2196f3; --acu-table-head: #bbdefb; --acu-table-hover: #e1f5fe; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #ffffff; --acu-badge-bg: #e3f2fd; --acu-menu-bg: #fff; --acu-menu-text: #1565c0; --acu-success-text: #0288d1; --acu-success-bg: rgba(2, 136, 209, 0.15); --acu-scrollbar-track: #e3f2fd; --acu-scrollbar-thumb: #90caf9; --acu-hl-manual: #ff4757; --acu-hl-manual-bg: rgba(255, 71, 87, 0.15); --acu-hl-diff: #0277bd; --acu-hl-diff-bg: rgba(2, 119, 189, 0.2); --acu-error-text: #d32f2f; --acu-error-bg: rgba(211, 47, 47, 0.15); --acu-error-border: rgba(211, 47, 47, 0.5); --acu-warning-icon: #f57c00; --acu-failure-text: #d32f2f; --acu-failure-bg: rgba(211, 47, 47, 0.15); --acu-warning-text: #f57c00; --acu-warning-bg: rgba(245, 124, 0, 0.15); --acu-crit-success-text: #7b1fa2; --acu-crit-success-bg: rgba(123, 31, 162, 0.15); --acu-crit-failure-text: #b71c1c; --acu-crit-failure-bg: rgba(183, 28, 28, 0.15); --acu-extreme-success-text: #0277bd; --acu-extreme-success-bg: rgba(2, 119, 189, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.4); --acu-light-bg: rgba(0,0,0,0.1); --acu-very-light-bg: rgba(0,0,0,0.02); --acu-button-text: #1565c0; --acu-gray-bg: rgba(128,128,128,0.1); }\n    .acu-theme-cyber { --acu-bg-nav: #000000; --acu-bg-panel: #0a0a0a; --acu-border: #333; --acu-text-main: #00ffcc; --acu-text-sub: #ff00ff; --acu-btn-bg: #111; --acu-btn-hover: #222; --acu-btn-active-bg: #ff00ff; --acu-btn-active-text: #fff; --acu-accent: #00ffcc; --acu-table-head: #050505; --acu-table-hover: #111; --acu-shadow: 0 0 15px rgba(0,255,204,0.15); --acu-card-bg: #050505; --acu-badge-bg: #1a1a1a; --acu-menu-bg: #111; --acu-menu-text: #00ffcc; --acu-success-text: #0f0; --acu-success-bg: rgba(0, 255, 0, 0.15); --acu-scrollbar-track: #000; --acu-scrollbar-thumb: #333; --acu-hl-manual: #ff9f43; --acu-hl-manual-bg: rgba(255, 159, 67, 0.2); --acu-hl-diff: #0abde3; --acu-hl-diff-bg: rgba(10, 189, 227, 0.2); }\n    .acu-theme-cyber .acu-nav-btn { border-color: #222; }\n    .acu-theme-cyber .acu-data-card { border-color: #222; }\n    .acu-theme-cyber .acu-dice-panel input::placeholder,\n    .acu-theme-cyber .acu-contest-panel input::placeholder {\n        color: #ff00ff !important;\n        opacity: 0.7;\n    }\n    .acu-theme-cyber .acu-dice-panel input[type=\"text\"],\n    .acu-theme-cyber .acu-dice-panel input[type=\"number\"],\n    .acu-theme-cyber .acu-dice-panel input:not([type]),\n    .acu-theme-cyber .acu-contest-panel input[type=\"text\"],\n    .acu-theme-cyber .acu-contest-panel input[type=\"number\"],\n    .acu-theme-cyber .acu-contest-panel input:not([type]) {\n        color: #ff00ff !important;\n    }\n    .acu-theme-nightowl { --acu-bg-nav: #0a2133; --acu-bg-panel: #011627; --acu-border: #132e45; --acu-text-main: #e0e6f2; --acu-text-sub: #a6b8cc; --acu-btn-bg: #1f3a52; --acu-btn-hover: #2a4a68; --acu-btn-active-bg: #7fdbca; --acu-btn-active-text: #011627; --acu-accent: #7fdbca; --acu-table-head: #0a2133; --acu-table-hover: #01294a; --acu-shadow: rgba(0,0,0,0.5); --acu-card-bg: #0a2133; --acu-badge-bg: #1f3a52; --acu-menu-bg: #011627; --acu-menu-text: #e0e6f2; --acu-success-text: #addb67; --acu-success-bg: rgba(173, 219, 103, 0.15); --acu-scrollbar-track: #011627; --acu-scrollbar-thumb: #1f3a52; --acu-hl-manual: #ff8f66; --acu-hl-manual-bg: rgba(255, 143, 102, 0.2); --acu-hl-diff: #82aaff; --acu-hl-diff-bg: rgba(130, 170, 255, 0.2); }\n    .acu-theme-sakura { --acu-bg-nav: #F9F0EF; --acu-bg-panel: #F9F0EF; --acu-border: #EBDCD9; --acu-text-main: #6B5552; --acu-text-sub: #C08D8D; --acu-btn-bg: #EBDCD9; --acu-btn-hover: #D8C7C4; --acu-btn-active-bg: #C08D8D; --acu-btn-active-text: #F9F0EF; --acu-accent: #C08D8D; --acu-table-head: #F9F0EF; --acu-table-hover: #F5EAE8; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #ffffff; --acu-badge-bg: #F9F0EF; --acu-menu-bg: #fff; --acu-menu-text: #6B5552; --acu-success-text: #6B5552; --acu-success-bg: rgba(192, 141, 141, 0.12); --acu-scrollbar-track: #F9F0EF; --acu-scrollbar-thumb: #EBDCD9; --acu-hl-manual: #A68A7A; --acu-hl-manual-bg: rgba(166, 138, 122, 0.12); --acu-hl-diff: #9B7A7A; --acu-hl-diff-bg: rgba(155, 122, 122, 0.2); --acu-error-text: #9B7A7A; --acu-error-bg: rgba(155, 122, 122, 0.12); --acu-error-border: rgba(155, 122, 122, 0.4); --acu-warning-icon: #A68A7A; --acu-failure-text: #9B7A7A; --acu-failure-bg: rgba(155, 122, 122, 0.12); --acu-warning-text: #A68A7A; --acu-warning-bg: rgba(166, 138, 122, 0.12); --acu-crit-success-text: #8B7A7A; --acu-crit-success-bg: rgba(139, 122, 122, 0.12); --acu-crit-failure-text: #8B6F6F; --acu-crit-failure-bg: rgba(139, 111, 111, 0.12); --acu-extreme-success-text: #9B8A8A; --acu-extreme-success-bg: rgba(155, 138, 138, 0.12); --acu-overlay-bg: rgba(107, 85, 82, 0.6); --acu-overlay-bg-light: rgba(107, 85, 82, 0.5); --acu-shadow-bg: rgba(107, 85, 82, 0.3); --acu-light-bg: rgba(192, 141, 141, 0.08); --acu-very-light-bg: rgba(192, 141, 141, 0.02); --acu-button-text: #6B5552; --acu-gray-bg: rgba(192, 141, 141, 0.08); }\n    .acu-theme-minepink { --acu-bg-nav: #1a1a1a; --acu-bg-panel: #1a1a1a; --acu-border: #333333; --acu-text-main: #ffb3d9; --acu-text-sub: #ff80c1; --acu-btn-bg: #2a2a2a; --acu-btn-hover: #3a3a3a; --acu-btn-active-bg: #ff80c1; --acu-btn-active-text: #1a1a1a; --acu-accent: #ff80c1; --acu-table-head: #252525; --acu-table-hover: #2a2a2a; --acu-shadow: rgba(0,0,0,0.6); --acu-card-bg: #222222; --acu-badge-bg: #2a2a2a; --acu-menu-bg: #1a1a1a; --acu-menu-text: #ffb3d9; --acu-success-text: #ff80c1; --acu-success-bg: rgba(255, 128, 193, 0.2); --acu-scrollbar-track: #1a1a1a; --acu-scrollbar-thumb: #333333; --acu-hl-manual: #ffa726; --acu-hl-manual-bg: rgba(255, 167, 38, 0.2); --acu-hl-diff: #ff80c1; --acu-hl-diff-bg: rgba(255, 128, 193, 0.2); --acu-error-text: #ff6b6b; --acu-error-bg: rgba(255, 107, 107, 0.2); --acu-error-border: rgba(255, 107, 107, 0.5); --acu-warning-icon: #ffa726; --acu-failure-text: #ff6b6b; --acu-failure-bg: rgba(255, 107, 107, 0.2); --acu-warning-text: #ffa726; --acu-warning-bg: rgba(255, 167, 38, 0.2); --acu-crit-success-text: #ff80c1; --acu-crit-success-bg: rgba(255, 128, 193, 0.2); --acu-crit-failure-text: #ff4444; --acu-crit-failure-bg: rgba(255, 68, 68, 0.2); --acu-extreme-success-text: #ffb3d9; --acu-extreme-success-bg: rgba(255, 179, 217, 0.2); --acu-overlay-bg: rgba(0,0,0,0.8); --acu-overlay-bg-light: rgba(0,0,0,0.7); --acu-shadow-bg: rgba(0,0,0,0.6); --acu-light-bg: rgba(255, 128, 193, 0.1); --acu-very-light-bg: rgba(255, 128, 193, 0.02); --acu-button-text: #1a1a1a; --acu-gray-bg: rgba(255, 128, 193, 0.1); }\n    .acu-theme-purple { --acu-bg-nav: #f3e5f5; --acu-bg-panel: #f3e5f5; --acu-border: #ce93d8; --acu-text-main: #6a1b9a; --acu-text-sub: #9c27b0; --acu-btn-bg: #e1bee7; --acu-btn-hover: #ce93d8; --acu-btn-active-bg: #9c27b0; --acu-btn-active-text: #fff; --acu-accent: #9c27b0; --acu-table-head: #f8e1f5; --acu-table-hover: #fce4ec; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #ffffff; --acu-badge-bg: #f8e1f5; --acu-menu-bg: #fff; --acu-menu-text: #6a1b9a; --acu-success-text: #6a1b9a; --acu-success-bg: rgba(106, 27, 154, 0.15); --acu-scrollbar-track: #f3e5f5; --acu-scrollbar-thumb: #ce93d8; --acu-hl-manual: #f57c00; --acu-hl-manual-bg: rgba(245, 124, 0, 0.15); --acu-hl-diff: #6a1b9a; --acu-hl-diff-bg: rgba(106, 27, 154, 0.2); --acu-error-text: #d32f2f; --acu-error-bg: rgba(211, 47, 47, 0.15); --acu-error-border: rgba(211, 47, 47, 0.5); --acu-warning-icon: #f57c00; --acu-failure-text: #d32f2f; --acu-failure-bg: rgba(211, 47, 47, 0.15); --acu-warning-text: #f57c00; --acu-warning-bg: rgba(245, 124, 0, 0.15); --acu-crit-success-text: #7b1fa2; --acu-crit-success-bg: rgba(123, 31, 162, 0.15); --acu-crit-failure-text: #b71c1c; --acu-crit-failure-bg: rgba(183, 28, 28, 0.15); --acu-extreme-success-text: #6a1b9a; --acu-extreme-success-bg: rgba(106, 27, 154, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.4); --acu-light-bg: rgba(156, 39, 176, 0.1); --acu-very-light-bg: rgba(156, 39, 176, 0.02); --acu-button-text: #6a1b9a; --acu-gray-bg: rgba(156, 39, 176, 0.1); }\n    .acu-theme-wechat { --acu-bg-nav: #F7F7F7; --acu-bg-panel: #F7F7F7; --acu-border: #E5E5E5; --acu-text-main: #333333; --acu-text-sub: #666666; --acu-btn-bg: #E5E5E5; --acu-btn-hover: #D5D5D5; --acu-btn-active-bg: #09B83E; --acu-btn-active-text: #FFFFFF; --acu-accent: #09B83E; --acu-table-head: #F0F0F0; --acu-table-hover: #EBEBEB; --acu-shadow: rgba(0,0,0,0.1); --acu-card-bg: #ffffff; --acu-badge-bg: #F0F0F0; --acu-menu-bg: #fff; --acu-menu-text: #333333; --acu-success-text: #09B83E; --acu-success-bg: rgba(9, 184, 62, 0.12); --acu-scrollbar-track: #F7F7F7; --acu-scrollbar-thumb: #E5E5E5; --acu-hl-manual: #FF9500; --acu-hl-manual-bg: rgba(255, 149, 0, 0.12); --acu-hl-diff: #09B83E; --acu-hl-diff-bg: rgba(9, 184, 62, 0.2); --acu-error-text: #E53E3E; --acu-error-bg: rgba(229, 62, 62, 0.12); --acu-error-border: rgba(229, 62, 62, 0.5); --acu-warning-icon: #FF9500; --acu-failure-text: #E53E3E; --acu-failure-bg: rgba(229, 62, 62, 0.12); --acu-warning-text: #FF9500; --acu-warning-bg: rgba(255, 149, 0, 0.12); --acu-crit-success-text: #07A832; --acu-crit-success-bg: rgba(7, 168, 50, 0.15); --acu-crit-failure-text: #C53030; --acu-crit-failure-bg: rgba(197, 48, 48, 0.15); --acu-extreme-success-text: #09B83E; --acu-extreme-success-bg: rgba(9, 184, 62, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.2); --acu-light-bg: rgba(9, 184, 62, 0.08); --acu-very-light-bg: rgba(9, 184, 62, 0.02); --acu-button-text: #333333; --acu-gray-bg: rgba(9, 184, 62, 0.08); }\n    .acu-theme-educational { --acu-bg-nav: #000000; --acu-bg-panel: #000000; --acu-border: #1B1B1B; --acu-text-main: #FFFFFF; --acu-text-sub: #CCCCCC; --acu-btn-bg: #1B1B1B; --acu-btn-hover: #2B2B2B; --acu-btn-active-bg: #FF9900; --acu-btn-active-text: #000000; --acu-accent: #FF9900; --acu-table-head: #1B1B1B; --acu-table-hover: #2B2B2B; --acu-shadow: rgba(0,0,0,0.6); --acu-card-bg: #1B1B1B; --acu-badge-bg: #1B1B1B; --acu-menu-bg: #000000; --acu-menu-text: #FFFFFF; --acu-success-text: #FF9900; --acu-success-bg: rgba(255, 153, 0, 0.15); --acu-scrollbar-track: #000000; --acu-scrollbar-thumb: #1B1B1B; --acu-input-bg: #1B1B1B; --acu-hl-manual: #FF9900; --acu-hl-manual-bg: rgba(255, 153, 0, 0.15); --acu-hl-diff: #FFB84D; --acu-hl-diff-bg: rgba(255, 184, 77, 0.2); --acu-error-text: #FF6B6B; --acu-error-bg: rgba(255, 107, 107, 0.2); --acu-error-border: rgba(255, 107, 107, 0.5); --acu-warning-icon: #FFAA00; --acu-failure-text: #FF6B6B; --acu-failure-bg: rgba(255, 107, 107, 0.2); --acu-warning-text: #FFAA00; --acu-warning-bg: rgba(255, 170, 0, 0.2); --acu-crit-success-text: #FF9900; --acu-crit-success-bg: rgba(255, 153, 0, 0.2); --acu-crit-failure-text: #FF4444; --acu-crit-failure-bg: rgba(255, 68, 68, 0.2); --acu-extreme-success-text: #FFB84D; --acu-extreme-success-bg: rgba(255, 184, 77, 0.2); --acu-overlay-bg: rgba(0,0,0,0.8); --acu-overlay-bg-light: rgba(0,0,0,0.7); --acu-shadow-bg: rgba(0,0,0,0.6); --acu-light-bg: rgba(255, 153, 0, 0.1); --acu-very-light-bg: rgba(255, 153, 0, 0.02); --acu-button-text: #FFFFFF; --acu-gray-bg: rgba(255, 255, 255, 0.1); }\n    .acu-theme-vaporwave { --acu-bg-nav: #191970; --acu-bg-panel: #191970; --acu-border: rgba(0, 255, 255, 0.3); --acu-text-main: #00FFFF; --acu-text-sub: #FF00FF; --acu-btn-bg: rgba(25, 25, 112, 0.8); --acu-btn-hover: rgba(0, 255, 255, 0.2); --acu-btn-active-bg: #FF00FF; --acu-btn-active-text: #F0F8FF; --acu-accent: #00FFFF; --acu-table-head: rgba(25, 25, 112, 0.9); --acu-table-hover: rgba(0, 255, 255, 0.1); --acu-shadow: 0 0 15px rgba(0, 255, 255, 0.3); --acu-card-bg: rgba(25, 25, 112, 0.95); --acu-badge-bg: rgba(25, 25, 112, 0.8); --acu-menu-bg: #191970; --acu-menu-text: #00FFFF; --acu-success-text: #00FFFF; --acu-success-bg: rgba(0, 255, 255, 0.15); --acu-scrollbar-track: #191970; --acu-scrollbar-thumb: rgba(0, 255, 255, 0.3); --acu-input-bg: rgba(25, 25, 112, 0.6); --acu-hl-manual: #00FFFF; --acu-hl-manual-bg: rgba(0, 255, 255, 0.2); --acu-hl-diff: #FF00FF; --acu-hl-diff-bg: rgba(255, 0, 255, 0.2); --acu-error-text: #FF00FF; --acu-error-bg: rgba(255, 0, 255, 0.2); --acu-error-border: rgba(255, 0, 255, 0.5); --acu-warning-icon: #FF00FF; --acu-failure-text: #FF00FF; --acu-failure-bg: rgba(255, 0, 255, 0.2); --acu-warning-text: #FF00FF; --acu-warning-bg: rgba(255, 0, 255, 0.15); --acu-crit-success-text: #00FFFF; --acu-crit-success-bg: rgba(0, 255, 255, 0.2); --acu-crit-failure-text: #FF00FF; --acu-crit-failure-bg: rgba(255, 0, 255, 0.25); --acu-extreme-success-text: #00FFFF; --acu-extreme-success-bg: rgba(0, 255, 255, 0.2); --acu-overlay-bg: rgba(25, 25, 112, 0.85); --acu-overlay-bg-light: rgba(25, 25, 112, 0.75); --acu-shadow-bg: rgba(0, 255, 255, 0.3); --acu-light-bg: rgba(0, 255, 255, 0.05); --acu-very-light-bg: rgba(0, 255, 255, 0.02); --acu-button-text: #F0F8FF; --acu-gray-bg: rgba(0, 255, 255, 0.1); }\n    .acu-theme-vaporwave .acu-nav-btn { border-color: rgba(0, 255, 255, 0.3); }\n    .acu-theme-vaporwave .acu-data-card { border-color: rgba(0, 255, 255, 0.3); }\n    .acu-theme-vaporwave .acu-dice-panel input::placeholder,\n    .acu-theme-vaporwave .acu-contest-panel input::placeholder {\n        color: #FF00FF !important;\n        opacity: 0.7;\n    }\n    .acu-theme-vaporwave .acu-dice-panel input[type=\"text\"],\n    .acu-theme-vaporwave .acu-dice-panel input[type=\"number\"],\n    .acu-theme-vaporwave .acu-dice-panel input:not([type]),\n    .acu-theme-vaporwave .acu-contest-panel input[type=\"text\"],\n    .acu-theme-vaporwave .acu-contest-panel input[type=\"number\"],\n    .acu-theme-vaporwave .acu-contest-panel input:not([type]) {\n        color: #00FFFF !important;\n    }\n    .acu-theme-classicpackaging { --acu-bg-nav: #000000; --acu-bg-panel: #000000; --acu-border: #FFFF00; --acu-text-main: #FFFF00; --acu-text-sub: #CCCC00; --acu-btn-bg: #FF0000; --acu-btn-hover: #CC0000; --acu-btn-active-bg: #0000FF; --acu-btn-active-text: #FFFF00; --acu-accent: #FF0000; --acu-table-head: #1a1a1a; --acu-table-hover: #2a2a2a; --acu-shadow: rgba(255,255,0,0.3); --acu-card-bg: #1a1a1a; --acu-badge-bg: #FF0000; --acu-menu-bg: #000000; --acu-menu-text: #FFFF00; --acu-success-text: #0000FF; --acu-success-bg: rgba(0, 0, 255, 0.2); --acu-scrollbar-track: #000000; --acu-scrollbar-thumb: #FFFF00; --acu-input-bg: #1a1a1a; --acu-hl-manual: #FF0000; --acu-hl-manual-bg: rgba(255, 0, 0, 0.2); --acu-hl-diff: #0000FF; --acu-hl-diff-bg: rgba(0, 0, 255, 0.2); --acu-error-text: #FF0000; --acu-error-bg: rgba(255, 0, 0, 0.2); --acu-error-border: rgba(255, 0, 0, 0.8); --acu-warning-icon: #FF0000; --acu-failure-text: #FF0000; --acu-failure-bg: rgba(255, 0, 0, 0.2); --acu-warning-text: #FF0000; --acu-warning-bg: rgba(255, 0, 0, 0.15); --acu-crit-success-text: #0000FF; --acu-crit-success-bg: rgba(0, 0, 255, 0.2); --acu-crit-failure-text: #FF0000; --acu-crit-failure-bg: rgba(255, 0, 0, 0.25); --acu-extreme-success-text: #0000FF; --acu-extreme-success-bg: rgba(0, 0, 255, 0.2); --acu-overlay-bg: rgba(0,0,0,0.9); --acu-overlay-bg-light: rgba(0,0,0,0.8); --acu-shadow-bg: rgba(0,0,0,0.6); --acu-light-bg: rgba(255,255,0,0.1); --acu-very-light-bg: rgba(255,255,0,0.02); --acu-button-text: #FFFF00; --acu-gray-bg: rgba(255,255,0,0.1); }\n    .acu-theme-classicpackaging .acu-nav-btn { border-color: #FFFF00; border-width: 2px; font-weight: bold; }\n    .acu-theme-classicpackaging .acu-data-card { border-color: #FFFF00; border-width: 2px; }\n    .acu-theme-classicpackaging .acu-dice-panel input::placeholder,\n    .acu-theme-classicpackaging .acu-contest-panel input::placeholder {\n        color: #666600 !important;\n        opacity: 0.7;\n    }\n    .acu-theme-classicpackaging .acu-dice-panel input[type=\"text\"],\n    .acu-theme-classicpackaging .acu-dice-panel input[type=\"number\"],\n    .acu-theme-classicpackaging .acu-dice-panel input:not([type]),\n    .acu-theme-classicpackaging .acu-contest-panel input[type=\"text\"],\n    .acu-theme-classicpackaging .acu-contest-panel input[type=\"number\"],\n    .acu-theme-classicpackaging .acu-contest-panel input:not([type]) {\n        color: #FFFF00 !important;\n        font-weight: bold;\n    }\n    .acu-theme-galgame { --acu-bg-nav: #FFF0F5; --acu-bg-panel: #FFF0F5; --acu-border: #F0D4E4; --acu-text-main: #6B4A5A; --acu-text-sub: #B08A9A; --acu-btn-bg: #FFE4E9; --acu-btn-hover: #FFD4E4; --acu-btn-active-bg: #E8B4D9; --acu-btn-active-text: #6B4A5A; --acu-accent: #E8B4D9; --acu-table-head: #FFF5F9; --acu-table-hover: #FFF0F8; --acu-shadow: rgba(232, 180, 217, 0.25); --acu-card-bg: #ffffff; --acu-badge-bg: #FFF5F9; --acu-menu-bg: #fff; --acu-menu-text: #6B4A5A; --acu-success-text: #D4A5C8; --acu-success-bg: rgba(212, 165, 200, 0.15); --acu-scrollbar-track: #FFF0F5; --acu-scrollbar-thumb: #F0D4E4; --acu-input-bg: #FFF8FA; --acu-hl-manual: #D4A5A5; --acu-hl-manual-bg: rgba(212, 165, 165, 0.15); --acu-hl-diff: #E8B4D9; --acu-hl-diff-bg: rgba(232, 180, 217, 0.2); --acu-error-text: #C88A9A; --acu-error-bg: rgba(200, 138, 154, 0.15); --acu-error-border: rgba(200, 138, 154, 0.4); --acu-warning-icon: #D4A5A5; --acu-failure-text: #C88A9A; --acu-failure-bg: rgba(200, 138, 154, 0.15); --acu-warning-text: #D4A5A5; --acu-warning-bg: rgba(212, 165, 165, 0.15); --acu-crit-success-text: #E8B4D9; --acu-crit-success-bg: rgba(232, 180, 217, 0.2); --acu-crit-failure-text: #C88A9A; --acu-crit-failure-bg: rgba(200, 138, 154, 0.2); --acu-extreme-success-text: #D4A5C8; --acu-extreme-success-bg: rgba(212, 165, 200, 0.2); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(232, 180, 217, 0.25); --acu-light-bg: rgba(232, 180, 217, 0.08); --acu-very-light-bg: rgba(232, 180, 217, 0.02); --acu-button-text: #6B4A5A; --acu-button-text-on-accent: #6B4A5A; --acu-gray-bg: rgba(232, 180, 217, 0.1); }\n    .acu-theme-galgame .acu-nav-btn { border-radius: 8px; transition: all 0.3s ease; }\n    .acu-theme-galgame .acu-data-card { border-radius: 12px; box-shadow: 0 4px 12px rgba(232, 180, 217, 0.15); transition: all 0.3s ease; }\n    .acu-theme-galgame .acu-data-card:hover { box-shadow: 0 6px 20px rgba(232, 180, 217, 0.25); transform: translateY(-2px); }\n    .acu-theme-galgame .acu-nav-btn:hover { box-shadow: 0 2px 8px rgba(232, 180, 217, 0.2); }\n    .acu-theme-terminal { --acu-bg-nav: #0c0c0c; --acu-bg-panel: #0c0c0c; --acu-border: #00ff00; --acu-text-main: #00ff00; --acu-text-sub: #00cc00; --acu-btn-bg: #1a1a1a; --acu-btn-hover: #2a2a2a; --acu-btn-active-bg: #00ff00; --acu-btn-active-text: #0c0c0c; --acu-accent: #00ff00; --acu-table-head: #0a0a0a; --acu-table-hover: #1a1a1a; --acu-shadow: rgba(0,255,0,0.2); --acu-card-bg: #0c0c0c; --acu-badge-bg: #1a1a1a; --acu-menu-bg: #0c0c0c; --acu-menu-text: #00ff00; --acu-success-text: #00ff00; --acu-success-bg: rgba(0, 255, 0, 0.15); --acu-scrollbar-track: #0c0c0c; --acu-scrollbar-thumb: #00ff00; --acu-input-bg: #0c0c0c; --acu-hl-manual: #ffff00; --acu-hl-manual-bg: rgba(255, 255, 0, 0.15); --acu-hl-diff: #00ffff; --acu-hl-diff-bg: rgba(0, 255, 255, 0.15); --acu-error-text: #ff0000; --acu-error-bg: rgba(255, 0, 0, 0.15); --acu-error-border: rgba(255, 0, 0, 0.5); --acu-warning-icon: #ffff00; --acu-failure-text: #ff0000; --acu-failure-bg: rgba(255, 0, 0, 0.15); --acu-warning-text: #ffff00; --acu-warning-bg: rgba(255, 255, 0, 0.15); --acu-crit-success-text: #00ffff; --acu-crit-success-bg: rgba(0, 255, 255, 0.15); --acu-crit-failure-text: #ff00ff; --acu-crit-failure-bg: rgba(255, 0, 255, 0.15); --acu-extreme-success-text: #00ff00; --acu-extreme-success-bg: rgba(0, 255, 0, 0.2); --acu-overlay-bg: rgba(0,0,0,0.9); --acu-overlay-bg-light: rgba(0,0,0,0.8); --acu-shadow-bg: rgba(0,0,0,0.7); --acu-light-bg: rgba(0,255,0,0.05); --acu-very-light-bg: rgba(0,255,0,0.02); --acu-button-text: #0c0c0c; --acu-gray-bg: rgba(0,255,0,0.05); font-family: 'Courier New', 'Consolas', 'Monaco', monospace; }\n    .acu-theme-terminal .acu-nav-btn { border-color: #00ff00; text-shadow: 0 0 5px rgba(0,255,0,0.5); }\n    .acu-theme-terminal .acu-data-card { border-color: #00ff00; text-shadow: 0 0 2px rgba(0,255,0,0.3); }\n    .acu-theme-terminal .acu-dice-panel input::placeholder,\n    .acu-theme-terminal .acu-contest-panel input::placeholder {\n        color: #008800 !important;\n        opacity: 0.7;\n    }\n    .acu-theme-terminal .acu-dice-panel input[type=\"text\"],\n    .acu-theme-terminal .acu-dice-panel input[type=\"number\"],\n    .acu-theme-terminal .acu-dice-panel input:not([type]),\n    .acu-theme-terminal .acu-contest-panel input[type=\"text\"],\n    .acu-theme-terminal .acu-contest-panel input[type=\"number\"],\n    .acu-theme-terminal .acu-contest-panel input:not([type]) {\n        color: #00ff00 !important;\n    }\n    /* Night Owl */\n    .acu-theme-nightowl .acu-table-manager-item,\n    .acu-theme-nightowl .acu-validation-rule-item {\n        border-color: var(--acu-border) !important;\n    }\n    .acu-theme-nightowl .acu-table-manager-item:hover,\n    .acu-theme-nightowl .acu-validation-rule-item:hover {\n        border-color: rgba(127, 219, 202, 0.4) !important;\n    }\n    /* Night Owl */\n    .acu-theme-nightowl .acu-preset-item {\n        border-color: var(--acu-border) !important;\n    }\n    .acu-theme-nightowl .acu-preset-item:hover {\n        border-color: rgba(127, 219, 202, 0.4) !important;\n    }\n    .acu-wrapper { position: relative; width: 100%; margin: 15px 0; z-index: 2147483640 !important; font-family: 'Microsoft YaHei', sans-serif; display: flex; flex-direction: column-reverse; }\n    .acu-wrapper.acu-mode-embedded { position: relative !important; width: 100% !important; margin-top: 8px !important; z-index: 2147483641 !important; clear: both; display: flex; flex-direction: column-reverse !important; padding: 0; }\n    .acu-wrapper.acu-mode-embedded .acu-nav-container { position: relative !important; z-index: 2147483642 !important; }\n    .acu-wrapper.acu-mode-embedded .acu-data-display { position: absolute !important; bottom: 100% !important; left: 0 !important; right: 0 !important; width: 100% !important; box-shadow: 0 -10px 30px rgba(0,0,0,0.25) !important; border: 1px solid var(--acu-border); margin-bottom: 5px; z-index: 2147483647 !important; max-height: 70vh !important; overflow-y: auto !important; }\n    .acu-nav-container { display: grid; grid-template-columns: repeat(var(--acu-grid-cols, 3), 1fr); gap: 4px; padding: 6px; background: var(--acu-bg-nav); border: 1px solid var(--acu-border); border-radius: 10px; align-items: center; box-shadow: 0 2px 6px var(--acu-shadow); position: relative; z-index: 2147483641 !important; }\n    .acu-nav-btn { touch-action: manipulation; -webkit-tap-highlight-color: transparent; width: 100%; display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 3px; padding: 4px 2px; border: 1px solid transparent; border-radius: 6px; background: var(--acu-btn-bg); color: var(--acu-text-main); font-weight: 600; font-size: 11px; cursor: pointer; transition: all 0.2s ease; user-select: none; overflow: hidden; height: 28px; }\n    .acu-nav-btn span { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; margin-top: 1px; }\n    .acu-nav-btn:hover { background: var(--acu-btn-hover); transform: translateY(-2px); }\n    .acu-nav-btn:focus, .acu-nav-btn:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--acu-accent) !important; }\n    /* []  */\n/* --- 1.  --- */\n.acu-height-control {\n    display: flex;\n    align-items: center;\n    margin-right: 8px;\n    cursor: ns-resize;\n    padding: 4px;\n    border-radius: 4px;\n    color: var(--acu-text-sub);\n    transition: all 0.2s;\n    /*  */\n    touch-action: none;\n}\n\n/*  */\n.acu-height-control:hover, .acu-height-control.active {\n    color: var(--acu-accent);\n    background: var(--acu-table-hover);\n}\n\n/* --- 2. []  --- */\n.acu-height-drag-handle {\n    cursor: ns-resize;\n    /*  */\n    touch-action: none;\n}\n\n            /*  */\n            .acu-view-btn { background: transparent !important; border: none; color: var(--acu-text-main) !important; cursor: pointer; padding: 4px; margin-right: 5px; font-size: 14px; opacity: 0.7; }\n            .acu-view-btn:hover { opacity: 1; color: var(--acu-accent) !important; background: var(--acu-table-hover) !important; border-radius: 4px; }\n            .acu-view-btn.acu-reverse-btn.active, .acu-reverse-btn[data-reversed=\"true\"] { color: var(--acu-accent) !important; opacity: 1; }\n            /* Grid  () */\n            .acu-card-body.view-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }\n            /*  Grid  Flex  */\n.acu-card-body.view-grid .acu-card-row { display: flex; height: auto !important; min-height: fit-content; border: 1px solid var(--acu-border); border-radius: 6px; padding: 4px 6px; flex-direction: column !important; align-items: flex-start !important; background: rgba(0,0,0,0.02); box-sizing: border-box; }\n            .acu-card-body.view-grid .acu-card-row.acu-grid-span-full { grid-column: 1 / -1; }\n            .acu-card-body.view-grid .acu-card-label { width: 100% !important; font-size: 0.85em; opacity: 0.8; margin-bottom: 2px; }\n            .acu-card-body.view-grid .acu-card-value { width: 100% !important; }\n\n            /* List  ( - ) */\n            .acu-nav-btn.active { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); box-shadow: inset 0 1px 3px rgba(0,0,0,0.2); outline: none; border-color: transparent; }\n            .acu-nav-btn.active:hover { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); transform: none; }\n            .acu-nav-btn.active:focus, .acu-nav-btn.active:focus-visible { outline: none; box-shadow: inset 0 1px 3px rgba(0,0,0,0.2) !important; }\n            .acu-nav-btn.has-validation-errors { border-color: rgba(231, 76, 60, 0.5); }\n            .acu-nav-btn .acu-nav-warning-icon { color: var(--acu-error-text, #e74c3c); font-size: 10px; margin-left: 2px; animation: pulse 1.5s infinite; }\n            @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }\n            .acu-action-btn { flex: 1; height: 36px; display: flex; align-items: center; justify-content: center; background: var(--acu-btn-bg); border-radius: 8px; color: var(--acu-text-sub); cursor: pointer; border: 1px solid transparent; transition: all 0.2s; margin: 0; }\n            .acu-action-btn:hover { background: var(--acu-btn-hover); color: var(--acu-text-main); transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }\n            .acu-action-btn:focus, .acu-action-btn:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--acu-accent) !important; }\n            #acu-btn-save-global { color: var(--acu-btn-active-bg); } #acu-btn-save-global:hover { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); }\n\n            .acu-data-display { position: absolute; bottom: calc(100% + 10px); left: 0; right: 0; max-height: 80vh; height: auto; background: var(--acu-bg-panel); border: 1px solid var(--acu-border); border-radius: 8px; box-shadow: 0 8px 30px var(--acu-shadow); display: flex; flex-direction: column; z-index: 2147483642 !important; opacity: 0; visibility: hidden; transition: opacity 0.2s ease-out, visibility 0s linear 0.2s; pointer-events: none; }\n            .acu-data-display.visible { opacity: 1; visibility: visible; transition: opacity 0.2s ease-in, visibility 0s linear 0s; pointer-events: auto; }\n            @keyframes popUp { from { opacity: 0; transform: translateY(10px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }\n            @keyframes highlightFlash { 0%, 100% { box-shadow: none; } 50% { box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.6); } }\n            .acu-highlight-flash { animation: highlightFlash 0.5s ease-in-out 3; }\n\n            .acu-panel-header { flex: 0 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: var(--acu-table-head); border-bottom: 1px dashed var(--acu-border); border-radius: 8px 8px 0 0; }\n            /*  flex: 1  min-width: 0 */\n/* ---  --- */\n.acu-panel-title {\n    display: flex;\n    flex-direction: column; /*  */\n    justify-content: center;\n    align-items: flex-start;\n    flex: 1; /*  */\n    min-width: 0; /*  */\n    margin-right: 8px;\n    overflow: hidden;\n}\n\n/*  () */\n.acu-title-main {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n    font-size: 13px; /*  */\n    font-weight: bold;\n    color: var(--acu-text-main);\n    line-height: 1.2;\n}\n\n/*  () */\n.acu-title-text {\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/*  () */\n.acu-title-sub {\n    font-size: 10px;\n    color: var(--acu-text-sub);\n    font-weight: normal;\n    opacity: 0.8;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    width: 100%;\n    line-height: 1.2;\n    margin-top: 1px;\n}\n            /*  flex-shrink: 0;  */\n/* flex-shrink: 0  */\n.acu-header-actions { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }\n            .acu-search-wrapper { position: relative; display: flex; align-items: center; }\n            .acu-wrapper input.acu-search-input { background: var(--acu-btn-bg) !important; border: 1px solid var(--acu-border) !important; color: var(--acu-text-main) !important; padding: 4px 8px 4px 24px; border-radius: 12px; font-size: 12px; width: 120px; transition: width 0.2s, border-color 0.2s; }\n            .acu-wrapper input.acu-search-input::placeholder { color: var(--acu-text-sub) !important; opacity: 0.7; }\n            .acu-wrapper input.acu-search-input:focus { width: 160px; outline: none !important; border-color: var(--acu-accent) !important; box-shadow: none !important; }\n            .acu-search-input::placeholder { color: var(--acu-text-sub) ; opacity: 0.7; }\n            .acu-search-icon { position: absolute; left: 8px; font-size: 10px; color: var(--acu-text-sub); pointer-events: none; }\n            /*  min-width  flex-shrink: 0 */\n            .acu-panel-content { flex: 1; overflow-x: auto; overflow-y: hidden; padding: 15px; background: transparent; scrollbar-width: thin; scrollbar-color: var(--acu-scrollbar-thumb) var(--acu-scrollbar-track); overscroll-behavior-x: contain; overscroll-behavior-y: auto; touch-action: pan-x pan-y; -webkit-overflow-scrolling: touch; }\n            /*  height: 100%;  */\n.acu-card-grid { display: flex; flex-wrap: nowrap; gap: 12px; align-items: flex-start; }\n            .acu-layout-vertical .acu-panel-content { overflow-x: hidden !important; overflow-y: auto !important; overscroll-behavior: auto; touch-action: manipulation; min-height: 0; }\n            /*  auto  */\n.acu-layout-vertical .acu-card-grid { flex-wrap: wrap !important; justify-content: center; padding-bottom: 20px; height: auto; }\n.acu-wrapper:not(.acu-layout-vertical) .acu-manual-mode .acu-card-grid { height: 100%; } .acu-manual-mode .acu-data-card { max-height: 100% !important; overscroll-behavior-y: auto; } .acu-data-card { flex: 0 0 var(--acu-card-width, 260px); width: var(--acu-card-width, 260px); background: var(--acu-card-bg); border: 1px solid var(--acu-border); border-radius: 8px; height: auto; max-height: 60vh; overflow-y: auto; overscroll-behavior-y: auto; touch-action: manipulation; transition: all 0.2s ease; display: flex; flex-direction: column; position: relative; }\n            .acu-data-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px var(--acu-shadow); border-color: var(--acu-accent); }\n            .acu-data-card.pending-deletion { opacity: 0.6; border: 1px dashed var(--acu-error-text, #e74c3c); }\n            .acu-data-card.pending-deletion::after { content: \"\"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); color: var(--acu-error-text, #e74c3c); font-size: 24px; font-weight: bold; border: 2px solid var(--acu-error-text, #e74c3c); padding: 5px 10px; border-radius: 8px; opacity: 0.8; pointer-events: none; }\n            @keyframes pulse-highlight { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }\n            .acu-highlight-manual { color: var(--acu-hl-manual) !important; background-color: var(--acu-hl-manual-bg) !important; border-radius: 4px; padding: 0 4px; font-weight: bold; animation: pulse-highlight 2s infinite; display: inline-block; }\n            .acu-highlight-diff { color: var(--acu-hl-diff) !important; background-color: var(--acu-hl-diff-bg) !important; border-radius: 4px; padding: 0 4px; font-weight: bold; animation: pulse-highlight 2s infinite; display: inline-block; }\n            .acu-editable-title.acu-highlight-manual, .acu-editable-title.acu-highlight-diff { width: auto; display: inline-block; }\n            .acu-card-header { flex: 0 0 auto; padding: 8px 10px; background: var(--acu-table-head); border-bottom: 1px dashed var(--acu-border); font-weight: bold; color: var(--acu-text-main); font-size: 14px; display: flex; flex-direction: row !important; align-items: center !important; justify-content: flex-start !important; gap: 8px; min-height: 40px; height: auto !important; position: relative; }\n            .acu-editable-title { flex: 1; width: auto !important; cursor: pointer; border-bottom: 1px dashed transparent; transition: all 0.2s; white-space: pre-wrap !important; overflow: visible !important; word-break: break-word !important; text-align: center; line-height: 1.3; margin: 0; }\n            .acu-editable-title:hover { border-bottom-color: var(--acu-accent); color: var(--acu-accent); }\n            .acu-card-index { position: static !important; transform: none !important; margin: 0; flex-shrink: 0; font-size: 11px; color: var(--acu-text-sub); font-weight: normal; background: var(--acu-badge-bg); padding: 2px 6px; border-radius: 4px; }\n            .acu-bookmark-icon { position: absolute; top: 8px; right: 8px; color: var(--acu-accent); cursor: pointer; font-size: 16px; opacity: 0.3; transition: opacity 0.2s, color 0.2s, transform 0.2s; z-index: 10; }\n            .acu-bookmark-icon:hover { opacity: 0.6; transform: scale(1.1); }\n            .acu-bookmark-icon.bookmarked { color: var(--acu-accent); opacity: 1; }\n            .acu-card-body { padding: 6px 12px; display: flex; flex-direction: column; gap: 0; font-size: var(--acu-font-size, 13px); flex: 1; }\n            .acu-card-row { display: block; padding: 6px 0; border-bottom: 1px dashed var(--acu-border); cursor: pointer; overflow: hidden; }\n            .acu-card-row:last-child { border-bottom: none; }\n            .acu-card-actions { display: flex; flex-wrap: wrap; gap: 6px; padding: 8px 10px; border-top: 1px dashed var(--acu-border); background: var(--acu-table-head); }\n            .acu-action-item { padding: 4px 10px; font-size: 11px; border: 1px solid var(--acu-border); border-radius: 4px; background: var(--acu-btn-bg); color: var(--acu-text-main); cursor: pointer; display: flex; align-items: center; gap: 4px; transition: all 0.15s; white-space: nowrap; }\n            .acu-action-item:hover { background: var(--acu-btn-hover); border-color: var(--acu-accent); color: var(--acu-accent); transform: translateY(-1px); }\n            .acu-action-item:active { transform: translateY(0); }\n            .acu-action-item.check-type { border-style: dashed; }\n            .acu-action-item i { font-size: 10px; opacity: 0.7; }\n            .acu-card-row:hover { background: var(--acu-table-hover); }\n            .acu-card-label { float: left !important; clear: left; width: auto !important; margin-right: 8px !important; color: var(--acu-text-sub); font-size: 0.9em; line-height: 1.5; padding-top: 0; }\n            .acu-hide-label .acu-card-label { display: none; }\n            .acu-hide-label .acu-card-value { width: 100% !important; }\n            .acu-inline-dice-btn:hover { opacity: 1 !important; transform: scale(1.2); }\n            .acu-card-value { display: block; width: auto !important; margin: 0; text-align: left !important; word-break: break-all !important; white-space: pre-wrap !important; line-height: 1.5 !important; color: var(--acu-text-main); font-size: 1em; }\n            .acu-tag-container { display: flex; flex-wrap: wrap; gap: 4px; align-items: center; margin-top: 2px; }\n            .acu-multi-attr-container { display: grid; grid-template-columns: 1fr 1fr; gap: 2px 8px; }\n            .acu-badge { display: inline-block; padding: 1px 8px; border-radius: 12px; font-size: 0.9em; font-weight: 500; line-height: 1.2; }\n            .acu-badge-green { background: var(--acu-success-bg); color: var(--acu-success-text); }\n            .acu-badge-neutral { background: var(--acu-badge-bg); color: var(--acu-text-main); border: 1px solid var(--acu-border); }\n            .acu-panel-footer { flex: 0 0 auto; padding: 8px; border-top: 1px dashed var(--acu-border); background: var(--acu-table-head); display: flex; justify-content: center; align-items: center; gap: 5px; flex-wrap: wrap; }\n            .acu-page-btn { padding: 4px 10px; min-width: 32px; height: 28px; border-radius: 4px; border: 1px solid var(--acu-border); background: var(--acu-btn-bg); color: var(--acu-text-main); cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }\n            .acu-page-btn:hover:not(.disabled):not(.active) { background: var(--acu-btn-hover); transform: translateY(-1px); }\n            .acu-page-btn.active { background: var(--acu-accent); color: var(--acu-button-text-on-accent, #fff); border-color: var(--acu-accent); font-weight: bold; }\n            .acu-page-btn.disabled { opacity: 0.5; cursor: not-allowed; }\n            .acu-page-info { font-size: 12px; color: var(--acu-text-sub); margin: 0 10px; }\n            /* --- []  --- */\n            /*  Flex Column  */\n            /* --- []  --- */\n            .acu-option-panel {\n                display: flex;\n                flex-direction: column;\n                gap: 2px;                 /*  */\n                padding: 4px;             /*  */\n                background: var(--acu-bg-nav);\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;       /*  */\n                margin-top: 0;\n                margin-bottom: 4px;\n                backdrop-filter: blur(5px);\n                width: 100%;\n                box-sizing: border-box;\n                z-index: 2147483641;\n                animation: acuFadeIn 0.3s ease;\n            }\n\n            .acu-embedded-options-container {\n                width: 100%;\n                max-width: 100%;\n                margin-top: 6px;\n                clear: both;\n                animation: acuFadeIn 0.3s ease;\n            }\n\n            .acu-opt-header {\n                text-align: center;\n                font-size: 10px;          /*  */\n                font-weight: bold;\n                color: var(--acu-text-sub);\n                padding-bottom: 2px;\n                border-bottom: 1px dashed var(--acu-border);\n                margin-bottom: 2px;\n            }\n\n            /* --- []  --- */\n            .acu-opt-btn {\n                background: var(--acu-btn-bg);\n                border: 1px solid transparent; /*  */\n                padding: 3px 6px;              /*  */\n                border-radius: 4px;\n                cursor: pointer;\n                color: var(--acu-text-main);\n                font-size: var(--acu-opt-font-size, 12px) !important; /* []  */\n                transition: all 0.15s;\n                font-weight: normal;           /*  */\n                text-align: left;              /*  */\n                white-space: pre-wrap;\n                word-break: break-word;\n                min-height: 22px;              /*  */\n                line-height: 1.3;\n                display: flex;\n                align-items: center;\n                justify-content: flex-start;\n                opacity: 0.9;\n            }\n\n            .acu-opt-btn:hover {\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent); /*  */\n                transform: translateX(3px);      /*  */\n                opacity: 1;\n            }\n            .acu-opt-btn:active { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); }\n            @keyframes acuFadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }\n\n            /* []  */\n            .acu-dice-result-revealing {\n                opacity: 0 !important;\n                transform: translateY(3px) !important;\n                transition: opacity 0.18s ease-out, transform 0.18s ease-out !important;\n            }\n            .acu-dice-result-revealed {\n                opacity: 1 !important;\n                transform: translateY(0) !important;\n            }\n            /*  */\n            @media (max-width: 768px) {\n                .acu-dice-result-revealing {\n                    transition: opacity 0.15s ease-out, transform 0.15s ease-out !important;\n                }\n            }\n            /*  */\n            @media (prefers-reduced-motion: reduce) {\n                .acu-dice-result-revealing {\n                    transition: none !important;\n                    opacity: 1 !important;\n                    transform: none !important;\n                }\n            }\n\n            .acu-menu-backdrop { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: transparent; z-index: 2147483645 !important; }\n            /* 1.  */\n.acu-cell-menu {\n    position: fixed !important;\n    background: var(--acu-menu-bg) !important;\n    border: 1px solid var(--acu-border);\n    box-shadow: 0 6px 20px var(--acu-shadow) !important;\n    z-index: 2147483647 !important;\n    border-radius: 8px;\n    overflow: hidden;\n    min-width: 150px;\n    color: var(--acu-menu-text);\n}\n\n/* 2.  */\n.acu-cell-menu-item {\n    padding: 12px 16px;\n    cursor: pointer;\n    font-size: 14px;\n    display: flex;\n    gap: 12px;\n    align-items: center;\n    color: var(--acu-menu-text);\n    font-weight: 500;\n    background: transparent;\n    transition: background 0.2s;\n}\n\n/* 3.  */\n.acu-cell-menu-item:hover {\n    background: var(--acu-table-hover);\n}\n\n/* 4.  */\n            .acu-cell-menu-item#act-delete { color: var(--acu-error-text, #e74c3c); }\n            .acu-cell-menu-item#act-delete:hover { background: var(--acu-error-bg, rgba(231, 76, 60, 0.1)); } /*  */\n            .acu-cell-menu-item#act-close { border-top: 1px dashed var(--acu-border); color: var(--acu-text-sub); }\n            .acu-edit-overlay { position: fixed !important; top: 0; left: 0; right: 0; bottom: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.75) !important; z-index: 2147483646 !important; display: flex; justify-content: center !important; align-items: center !important; backdrop-filter: blur(2px); }\n            .acu-edit-dialog { background: var(--acu-bg-panel); width: 95%; max-width: 500px; max-height: 95vh; padding: 16px; border-radius: 12px; display: flex; flex-direction: column; gap: 10px; box-shadow: 0 15px 50px rgba(0,0,0,0.6); color: var(--acu-text-main); border: 1px solid var(--acu-border); overflow: hidden; flex-shrink: 0; }\n            @media (min-width: 768px) { .acu-edit-dialog { max-width: 900px; width: 90%; } .acu-edit-dialog.acu-settings-dialog { max-width: 400px; width: 400px; } }\n            .acu-edit-title { margin: 0; font-size: 16px; font-weight: bold; color: var(--acu-text-main); padding-bottom: 8px; border-bottom: 1px solid var(--acu-border); }\n            .acu-edit-content { background: var(--acu-bg-panel); }\n            .acu-edit-textarea { width: 100%; height: auto; padding: 12px; border: 1px solid var(--acu-border) !important; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; border-radius: 6px; resize: vertical; box-sizing: border-box; font-size: 14px; line-height: 1.6; overflow-y: auto !important; }\n            .acu-edit-textarea:focus { outline: none; border-color: var(--acu-accent) !important; }\n            .acu-edit-textarea::placeholder { color: var(--acu-text-sub) !important; opacity: 0.7; }\n            @media (min-width: 768px) { .acu-edit-textarea { height: auto !important; font-size: 15px !important; } }\n            .acu-edit-textarea:focus { outline: 1px solid #aaa; }\n            .acu-dialog-btns { display: flex; justify-content: flex-end; gap: 20px; margin-top: 10px; }\n            .acu-dialog-btn { background: none; border: none; cursor: pointer; font-size: 14px; font-weight: bold; display: flex; align-items: center; gap: 6px; color: var(--acu-text-sub); transition: color 0.2s; }\n            .acu-dialog-btn:hover { color: var(--acu-text-main); } .acu-btn-confirm { color: var(--acu-success-text); } .acu-btn-confirm:hover { opacity: 0.8; }\n            /* --- [UI Optimization] PC-First Edit Mode Styles --- */\n            .acu-order-controls { grid-column: 1 / -1; order: -2; display: none; width: 100%; text-align: left; background: var(--acu-accent); color: var(--acu-button-text-on-accent, var(--acu-text-main)); padding: 6px 12px; margin: 0 0 8px 0; border-radius: 4px; font-weight: bold; font-size: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }\n            .acu-order-controls.visible { display: flex; align-items: center; justify-content: space-between; }\n\n            .acu-nav-container.editing-order { border: 2px solid var(--acu-accent); background: var(--acu-bg-panel); }\n            .acu-nav-container.editing-order .acu-nav-btn, .acu-nav-container.editing-order .acu-action-btn { opacity: 1 !important; cursor: grab !important; border: 1px solid var(--acu-border); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }\n            .acu-nav-container.editing-order .acu-nav-btn:hover, .acu-nav-container.editing-order .acu-action-btn:hover { border-color: var(--acu-accent); transform: translateY(-1px); }\n\n            .acu-swap-selected { background-color: var(--acu-accent) !important; color: var(--acu-button-text-on-accent, var(--acu-text-main)) !important; border-color: var(--acu-accent); box-shadow: 0 0 0 2px rgba(255,255,255,0.5), 0 4px 12px rgba(0,0,0,0.2); transform: scale(1.05); z-index: 10; }\n            .acu-drag-over { border: 2px dashed var(--acu-accent); opacity: 0.5; transform: scale(0.95); background: rgba(var(--acu-accent-rgb), 0.1); }\n\n            /* --- [PC Style] Unused Pool Optimization () --- */\n            .acu-unused-pool {\n                grid-column: 1 / -1;\n                display: none;\n                flex-wrap: wrap;\n                gap: 8px;\n                background: var(--acu-table-head); /*  */\n                border: 1px dashed var(--acu-border); /*  */\n                padding: 10px 15px;\n                margin: 0 0 10px 0;\n                border-radius: 8px;\n                justify-content: flex-start;\n                align-items: center;\n                min-height: 50px;\n                box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);\n            }\n            .acu-unused-pool.visible { display: flex; animation: acuFadeIn 0.2s ease-out; }\n\n            /* PC */\n            .acu-unused-pool::before {\n                content: \" ( )\";\n                display: flex;\n                align-items: center;\n                height: 32px;\n                font-size: 12px;\n                font-weight: bold;\n                color: var(--acu-text-sub);\n                margin-right: 15px;\n                padding-right: 15px;\n                border-right: 1px solid var(--acu-border);\n                white-space: nowrap;\n                opacity: 0.8;\n            }\n\n            .acu-actions-group { grid-column: 1 / -1; display: flex; justify-content: flex-end; gap: 4px; border-top: 1px dashed var(--acu-border); padding-top: 8px; margin-top: 4px; min-height: 36px; transition: all 0.2s; }\n\n            /* []  */\n            .acu-pos-top .acu-actions-group { order: -1; border-top: none; border-bottom: 1px dashed var(--acu-border); margin-top: 0; margin-bottom: 6px; padding-top: 0; padding-bottom: 8px; }\n\n            /* []  */\n            .acu-pos-top .acu-unused-pool { order: -1; margin-bottom: 10px; border-bottom: 1px dashed var(--acu-border); }\n            .acu-actions-group.dragging-over { background: rgba(127, 127, 127, 0.05); box-shadow: inset 0 0 10px rgba(0,0,0,0.05); }\n\n            /*  */\n                .acu-dash-body.acu-dash-horizontal {\n                    display: flex;\n                    flex-wrap: nowrap;\n                    gap: 15px;\n                    overflow-x: auto;\n                    overflow-y: hidden;\n                    padding-bottom: 10px;\n                }\n                .acu-dash-body.acu-dash-horizontal > div {\n                    flex: 0 0 280px;\n                    min-width: 280px;\n                    max-height: 60vh;\n                    overflow-y: auto;\n                }\n                @media (min-width: 769px) {\n                    .acu-dash-body.acu-dash-horizontal > div {\n                        flex: 0 0 320px;\n                        min-width: 320px;\n                    }\n                }\n            /* Mobile adjustments to keep it usable there */\n            @media (max-width: 768px) {\n                .acu-unused-pool { justify-content: center; background: rgba(0,0,0,0.05); border: 1px dashed var(--acu-border); border-bottom: none; margin: 0 0 8px 0; border-radius: 6px; }\n                .acu-unused-pool::before { display: block; width: 100%; text-align: center; margin-bottom: 4px; content: \" ()\"; }\n                .acu-order-controls { flex-direction: column; gap: 6px; text-align: center; }\n            }\n            .acu-actions-group.dragging-over { background: rgba(var(--acu-accent-rgb), 0.1); border-color: var(--acu-accent); }\n            .acu-settings-item { margin-bottom: 15px; }\n            .acu-settings-label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 13px; color: #ccc; }\n            .acu-settings-val { float: right; color: #4cd964; font-size: 12px; }\n            .acu-slider { width: 100%; height: 4px; background: #555; border-radius: 2px; outline: none; -webkit-appearance: none; }\n            .acu-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: #fff; border-radius: 50%; cursor: pointer; }\n            .acu-select { width: 100%; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid #555; color: #fff; border-radius: 4px; outline: none; }\n            .acu-edit-overlay input[type=\"checkbox\"].acu-checkbox { margin-right: 10px; accent-color: var(--acu-accent) !important; background: transparent !important; background-color: transparent !important; }\n            .acu-btn-block { width: 100%; padding: 10px; background: #444; color: #eee; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 10px; }\n            .acu-btn-block:hover { background: #555; color: #fff; }\n            .acu-expand-trigger { background: var(--acu-bg-nav); border: 1px solid var(--acu-border); box-shadow: 0 2px 6px var(--acu-shadow); cursor: pointer; color: var(--acu-text-main); font-size: 13px; font-weight: bold; display: flex; align-items: center; gap: 6px; transition: all 0.2s; z-index: 2147483645 !important; }\n            .acu-expand-trigger:hover { background: var(--acu-btn-hover); transform: translateY(-2px); }\n            .acu-col-bar { width: 100%; justify-content: center; padding: 8px 10px; border-radius: 6px; }\n            .acu-col-pill { width: auto !important; padding: 6px 16px; border-radius: 50px; }\n            .acu-col-mini { width: 40px !important; height: 40px !important; padding: 0; justify-content: center; border-radius: 50%; }\n            .acu-col-mini span { display: none; }\n            /* []  */\n            .acu-nav-toggle-btn:hover { opacity: 1 !important; transform: translateY(-50%) scale(1.2); color: var(--acu-accent); }\n            .acu-align-right { margin-left: auto; align-self: flex-end; }\n            .acu-align-left { margin-right: auto; margin-left: 0; align-self: flex-start; }\n            .acu-nav-container.acu-left-mode .acu-actions-group { order: -1; margin-left: 0; margin-right: 10px; }\n            #acu-btn-collapse { color: var(--acu-text-sub); }\n            #acu-btn-collapse:hover { color: var(--acu-text-main); background: rgba(0,0,0,0.05); }\n            @keyframes acu-breathe { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.6; transform: scale(0.85); color: #ff7e67; } 100% { opacity: 1; transform: scale(1); } } .acu-icon-breathe { animation: acu-breathe 3s infinite ease-in-out !important; display: inline-block; }\n\n            @media (min-width: 768px) {\n                .acu-wrapper.acu-mode-embedded .acu-nav-container { width: fit-content !important; min-width: 300px; max-width: 100%; margin: 0 auto; border-radius: 50px; box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important; border: 1px solid var(--acu-border); padding: 6px 20px; background: var(--acu-bg-nav) !important; }\n                .acu-wrapper.acu-mode-embedded .acu-data-display { bottom: calc(100% + 12px) !important; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2) !important; }\n                .acu-nav-container { display: flex; flex-wrap: wrap !important; gap: 6px !important; padding: 6px 10px; grid-template-columns: none !important; flex-direction: row !important; justify-content: flex-start !important; align-items: center !important; height: auto !important; }\n                .acu-nav-container .acu-nav-btn { width: fit-content !important; flex: 0 0 auto !important; height: 32px !important; padding: 0 12px; font-size: 13px !important; min-width: auto !important; }\n                .acu-nav-btn span { max-width: 200px; }\n                .acu-action-btn { flex: 0 0 32px !important; width: 32px !important; height: 32px !important; background: transparent !important; color: var(--acu-text-sub) !important; border-radius: 6px; border: 1px solid transparent; }\n                .acu-action-btn:hover { background: var(--acu-btn-hover) !important; color: var(--acu-text-main) !important; transform: scale(1.1); box-shadow: none; }\n                #acu-btn-save-global { color: var(--acu-accent) !important; }\n                #acu-btn-save-global:hover { background: var(--acu-accent) !important; color: #fff !important; }\n                .acu-order-controls { margin: 0 0 8px 0; padding: 4px; }\n                .acu-actions-group { width: auto !important; margin-left: auto !important; border-top: none !important; border-bottom: none !important; padding: 0; margin-top: 0 !important; margin-bottom: 0 !important; gap: 4px !important; background: transparent; justify-content: flex-end; order: 9999 !important; display: flex; }\n                .acu-pos-top .acu-actions-group { order: -1 !important; margin-left: 0 !important; margin-right: 10px !important; justify-content: flex-start !important; }\n            }\n            @media (max-width: 768px) {\n                .acu-panel-content { -webkit-overflow-scrolling: touch !important; overscroll-behavior-y: auto; }\n                .acu-data-card { box-shadow: none !important; border: 1px solid var(--acu-border); transform: translateZ(0); }\n                .acu-data-card:hover { transform: none !important; box-shadow: none !important; }\n                .acu-nav-btn:hover { transform: none !important; }\n            }\n            /* ===  === */\n            @media (max-width: 768px) {\n                .acu-dice-panel, .acu-contest-panel {\n                    position: fixed !important;\n                    top: 5% !important;\n                    left: 50% !important;\n                    transform: translateX(-50%) !important;\n                    width: 92vw !important;\n                    max-width: 400px !important;\n                    max-height: 88vh !important;\n                    overflow-y: auto !important;\n                }\n                .acu-dice-panel > div:last-child, .acu-contest-panel > div:last-child {\n                    max-height: none !important;\n                    overflow-y: visible !important;\n                }\n                .acu-dice-overlay, .acu-contest-overlay {\n                    align-items: flex-start !important;\n                    padding-top: 5vh !important;\n                }\n            }\n                /* ===  === */\n                .acu-dash-body {\n                    display: grid;\n                    grid-template-columns: 1fr 1.2fr 1fr;\n                    gap: 15px;\n                    margin: 15px 0;\n                }\n\n                .acu-dash-locations {\n                    background: var(--acu-card-bg);\n                    padding: 12px;\n                    border-radius: 8px;\n                    border: 1px solid var(--acu-border);\n                }\n\n                .acu-dash-locations h3 {\n                    margin: 0 0 10px 0;\n                    font-size: 14px;\n                    color: var(--acu-accent);\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                }\n\n                .acu-location-group {\n                    margin-bottom: 8px;\n                    border-radius: 6px;\n                    overflow: hidden;\n                    background: var(--acu-card-bg);\n                    border: 1px solid transparent;\n                    transition: all 0.2s;\n                }\n\n                .acu-location-group.expanded {\n                    border-color: var(--acu-accent);\n                }\n\n                .acu-location-header {\n                    padding: 8px 10px;\n                    cursor: pointer;\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                    background: var(--acu-table-head);\n                    transition: all 0.2s;\n                    user-select: none;\n                }\n\n                .acu-location-header:hover {\n                    background: var(--acu-table-hover);\n                }\n\n                .acu-expand-icon {\n                    font-size: 10px;\n                    transition: transform 0.2s;\n                    color: var(--acu-text-sub);\n                }\n\n                .acu-location-group.expanded .acu-expand-icon {\n                    transform: rotate(90deg);\n                    color: var(--acu-accent);\n                }\n\n                .acu-region-name {\n                    flex: 1;\n                    font-weight: bold;\n                    font-size: 13px;\n                    color: var(--acu-text-main);\n                }\n\n                .acu-location-count {\n                    font-size: 11px;\n                    color: var(--acu-text-sub);\n                }\n\n                .acu-location-list {\n                    max-height: 0;\n                    overflow: hidden;\n                    transition: max-height 0.3s ease;\n                }\n\n                .acu-location-group.expanded .acu-location-list {\n                    max-height: 500px;\n                }\n\n                .acu-location-item {\n                    padding: 6px 10px 6px 26px;\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                    font-size: 12px;\n                    border-bottom: 1px dashed rgba(0,0,0,0.05);\n                    transition: all 0.15s;\n                }\n\n                /*  */\n                .acu-dash-locations .acu-location-item {\n                    padding: 4px 8px !important;\n                    min-width: 0; /* flex */\n                    overflow: hidden; /*  */\n                }\n\n                .acu-dash-locations .acu-location-item > span:first-child {\n                    display: flex !important;\n                    align-items: center;\n                    gap: 6px;\n                    flex: 1;\n                    min-width: 0; /* flex */\n                    overflow: hidden;\n                }\n\n                .acu-dash-locations .acu-location-item > span:first-child i {\n                    flex-shrink: 0; /*  */\n                }\n\n                .acu-dash-locations .acu-location-item > span:first-child > span {\n                    white-space: nowrap;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                    flex: 1;\n                    min-width: 0; /* flex */\n                }\n\n                .acu-location-item:last-child {\n                    border-bottom: none;\n                }\n\n                .acu-location-item:hover {\n                    background: var(--acu-table-hover);\n                    transform: translateX(4px);\n                }\n\n                .acu-location-item.current {\n                    background: var(--acu-hl-diff-bg);\n                    font-weight: bold;\n                    color: var(--acu-hl-diff);\n                }\n\n                .acu-location-item i {\n                    font-size: 10px;\n                    opacity: 0.6;\n                }\n\n                .acu-current-badge {\n                    margin-left: auto;\n                    font-size: 10px;\n                    padding: 2px 6px;\n                    background: var(--acu-btn-active-bg);\n                    color: var(--acu-btn-active-text);\n                    border-radius: 3px;\n                    font-weight: bold;\n                }\n                /* ===  === */\n                .acu-dash-context {\n                    background: linear-gradient(135deg, var(--acu-table-head), var(--acu-bg-panel));\n                    padding: 15px;\n                    border-radius: 8px;\n                    margin-bottom: 15px;\n                    border: 1px solid var(--acu-border);\n                }\n\n                .acu-dash-location {\n                    font-size: 18px;\n                    font-weight: bold;\n                    color: var(--acu-accent);\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                }\n\n                .acu-dash-location-desc {\n                    font-size: 13px;\n                    color: var(--acu-text-sub);\n                    margin-top: 6px;\n                    line-height: 1.5;\n                }\n\n                .acu-dash-player, .acu-dash-intel {\n                    background: var(--acu-card-bg);\n                    padding: 12px;\n                    border-radius: 8px;\n                    border: 1px solid var(--acu-border);\n                }\n\n                .acu-dash-player h3, .acu-dash-intel h3 {\n                    margin: 0 0 10px 0;\n                    font-size: 14px;\n                    color: var(--acu-accent);\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                }\n\n                .acu-player-status {\n                    font-size: 13px;\n                    color: var(--acu-text-main);\n                }\n\n                .acu-task-item {\n                    padding: 8px;\n                    margin-bottom: 6px;\n                    background: rgba(0,0,0,0.03);\n                    border-radius: 6px;\n                    border-left: 3px solid var(--acu-border);\n                }\n\n                .acu-task-name {\n                    font-size: 13px;\n                    font-weight: 500;\n                    color: var(--acu-text-main);\n                }\n\n                .acu-empty-hint {\n                    font-size: 12px;\n                    color: var(--acu-text-sub);\n                    text-align: center;\n                    padding: 15px;\n                    opacity: 0.7;\n                }\n                /*  */\n                .acu-changes-content .acu-empty-hint {\n                    flex: 1;\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    justify-content: center;\n                    min-height: 200px;\n                }\n\n                .acu-dashboard-content {\n                    padding: 15px;\n                    overflow-y: auto !important;\n                    overflow-x: hidden !important;\n                    -webkit-overflow-scrolling: touch !important;\n                    touch-action: pan-y !important;\n                    overscroll-behavior-y: contain;\n                    max-height: calc(80vh - 60px);\n                }\n\n                /* ===  === */\n                h3.acu-dash-table-link,\n                h4.acu-dash-table-link {\n                    cursor: pointer;\n                    transition: all 0.15s;\n                    padding: 2px 4px;\n                    margin: -2px -4px;\n                    border-radius: 4px;\n                }\n                h3.acu-dash-table-link:hover,\n                h4.acu-dash-table-link:hover {\n                    color: var(--acu-accent);\n                    background: var(--acu-table-hover);\n                }\n\n                /*  - + */\n                .acu-dash-dice-btn,\n                .acu-dash-goto-btn,\n                .acu-dash-use-item-btn,\n                .acu-dash-use-skill-btn,\n                .acu-dash-track-task-btn,\n                .acu-dash-msg-btn,\n                .acu-dash-contest-btn,\n                .acu-dash-dice-free,\n                .acu-dash-relation-graph-btn,\n                .acu-dash-avatar-manager-btn {\n                    cursor: pointer;\n                    color: var(--acu-text-sub);\n                    opacity: 0.5;\n                    font-size: 14px !important;\n                    padding: 6px;\n                    margin: -4px;\n                    border-radius: 4px;\n                    transition: all 0.15s;\n                    display: inline-flex;\n                    align-items: center;\n                    justify-content: center;\n                    min-width: 28px;\n                    min-height: 28px;\n                }\n                .acu-dash-dice-btn:hover,\n                .acu-dash-goto-btn:hover,\n                .acu-dash-use-item-btn:hover,\n                .acu-dash-use-skill-btn:hover,\n                .acu-dash-track-task-btn:hover,\n                .acu-dash-msg-btn:hover,\n                .acu-dash-contest-btn:hover,\n                .acu-dash-dice-free:hover {\n                    opacity: 1;\n                    color: var(--acu-accent);\n                    background: var(--acu-table-hover);\n                    transform: scale(1.1);\n                }\n\n                /*  -  */\n                .acu-dash-clickable {\n                    cursor: pointer;\n                    transition: all 0.15s;\n                    border-radius: 4px;\n                }\n                .acu-dash-clickable:hover {\n                    background: var(--acu-table-hover);\n                }\n                .acu-dash-clickable:active {\n                    transform: scale(0.98);\n                }\n\n                @media (max-width: 768px) {\n                    .acu-dash-body {\n                        grid-template-columns: 1fr;\n                        max-height: none;\n                        overflow: visible;\n                    }\n\n                    .acu-dashboard-content {\n                        max-height: calc(75vh - 50px) !important;\n                        padding-bottom: 20px !important;\n                    }\n\n                    /*  */\n                    .acu-dash-dice-btn,\n                    .acu-dash-goto-btn,\n                    .acu-dash-use-item-btn,\n                    .acu-dash-use-skill-btn,\n                    .acu-dash-track-task-btn,\n                    .acu-dash-msg-btn,\n                    .acu-dash-contest-btn,\n                    .acu-dash-dice-free {\n                        font-size: 16px !important;\n                        padding: 8px;\n                        min-width: 36px;\n                        min-height: 36px;\n                    }\n                }\n            /* ===  === */\n            .acu-preview-overlay {\n                z-index: 2147483650;\n                backdrop-filter: blur(3px);\n                animation: acuFadeIn 0.2s ease;\n            }\n\n                .acu-preview-overlay .acu-data-card {\n                    width: 90vw;\n                    max-width: 400px;\n                    flex: none;\n                }\n                @media (min-width: 768px) {\n                    .acu-preview-overlay .acu-data-card {\n                        max-width: 550px;\n                    }\n                }\n\n            .acu-preview-close:hover {\n                background: var(--acu-error-bg, rgba(231, 76, 60, 0.1));\n                color: var(--acu-error-text, #e74c3c);\n            }\n\n            .acu-dash-clickable {\n                cursor: pointer;\n                transition: all 0.15s;\n            }\n\n            .acu-dash-clickable:hover {\n                background: var(--acu-table-hover);\n            }\n            .acu-current-location span {\n                color: var(--acu-accent);\n                font-weight: 600;\n            }\n            .acu-current-location i {\n                color: var(--acu-accent);\n            }\n            /* ===  === */\n            .acu-dropdown-wrapper { position: relative; width: 100%; }\n            .acu-dropdown-list {\n                position: absolute;\n                top: 100%;\n                left: 0;\n                right: 0;\n                max-height: 150px;\n                overflow-y: auto;\n                border: 1px solid;\n                border-radius: 4px;\n                box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n                z-index: 2147483649;\n                display: none;\n            }\n            .acu-dropdown-list.visible { display: block; }\n            .acu-dropdown-item {\n                padding: 6px 10px;\n                font-size: 12px;\n                cursor: pointer;\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                background: transparent;\n                transition: background 0.1s;\n            }\n            .acu-dropdown-empty {\n                padding: 8px 10px;\n                font-size: 12px;\n                text-align: center;\n                opacity: 0.7;\n            }\n            /* ===  === */\n            .acu-input-wrapper { position: relative; display: flex; align-items: center; width: 100%; }\n            .acu-input-wrapper input { padding-right: 24px !important; }\n            .acu-clear-btn { position: absolute; right: 6px; top: 50%; transform: translateY(-50%); background: transparent !important; border: none !important; font-size: 12px; cursor: pointer; padding: 4px; line-height: 1; opacity: 0.5; transition: opacity 0.2s; z-index: 5; }\n            .acu-clear-btn:hover { background: transparent !important; border: none !important; opacity: 1 !important; }\n\n            /* ==========  ========== */\n            .acu-relation-graph-overlay {\n                background: rgba(0,0,0,0.8);\n                z-index: 2147483650;\n                backdrop-filter: blur(4px);\n            }\n            .acu-relation-graph-container {\n                width: 95%;\n                max-width: 900px;\n                height: 85vh;\n                max-height: 700px;\n            }\n            .acu-graph-title {\n                font-size: 16px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .acu-graph-actions {\n                display: flex;\n                gap: 8px;\n            }\n            .acu-graph-btn {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s;\n            }\n            .acu-graph-btn:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n            }\n            .acu-graph-canvas-wrapper {\n                flex: 1;\n                overflow: hidden;\n                position: relative;\n                min-height: 0;\n            }\n            .acu-graph-svg {\n                width: 100%;\n                height: 100%;\n                cursor: grab;\n            }\n            .acu-graph-svg:active { cursor: grabbing; }\n            .acu-graph-edge {\n                stroke: var(--acu-border);\n                stroke-width: 2;\n                opacity: 0.6;\n            }\n            .acu-graph-edge-label {\n                font-size: 11px;\n                fill: var(--acu-text-sub);\n                text-anchor: middle;\n                pointer-events: none;\n            }\n            .acu-graph-node { cursor: grab; }\n            .acu-graph-node:active { cursor: grabbing; }\n            .acu-node-bg {\n                fill: var(--acu-btn-bg);\n                stroke: var(--acu-border);\n                stroke-width: 2;\n                transition: all 0.2s;\n            }\n            .acu-node-bg.player {\n                fill: var(--acu-accent);\n                stroke: var(--acu-btn-active-text);\n            }\n            .acu-graph-node:hover .acu-node-bg {\n                stroke: var(--acu-accent);\n                stroke-width: 3;\n                filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));\n            }\n            .acu-graph-node:hover .acu-node-avatar {\n                box-shadow: 0 0 0 2px var(--acu-accent);\n            }\n            .acu-graph-svg.highlighting .acu-graph-node {\n                opacity: 0.2;\n                transition: opacity 0.2s ease;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge {\n                opacity: 0.1;\n                transition: opacity 0.2s ease;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge-label {\n                opacity: 0.1;\n                transition: opacity 0.2s ease;\n            }\n            .acu-graph-svg.highlighting .acu-graph-node.highlighted {\n                opacity: 1;\n            }\n            .acu-graph-svg.highlighting .acu-graph-node.highlighted .acu-node-bg {\n                stroke: var(--acu-accent);\n                stroke-width: 3;\n            }\n            .acu-graph-svg.highlighting .acu-graph-node.highlighted .acu-node-avatar {\n                box-shadow: 0 0 0 2px var(--acu-accent);\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge.highlighted {\n                opacity: 1;\n                stroke: var(--acu-accent);\n                stroke-width: 3;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge-label.highlighted {\n                opacity: 1;\n                fill: var(--acu-accent);\n                font-weight: bold;\n            }\n            .acu-node-char {\n                font-size: 16px;\n                font-weight: bold;\n                fill: var(--acu-text-main);\n                text-anchor: middle;\n                pointer-events: none;\n            }\n            .acu-node-bg.player + text.acu-node-char,\n            .acu-node-bg.player ~ text.acu-node-char {\n                fill: var(--acu-btn-active-text);\n            }\n            .acu-node-label {\n                font-size: 12px;\n                fill: var(--acu-text-main);\n                text-anchor: middle;\n                pointer-events: none;\n            }\n            .acu-node-inscene-indicator {\n                fill: var(--acu-accent);\n                stroke: var(--acu-bg-panel);\n                stroke-width: 2;\n                filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));\n            }\n            .acu-graph-legend {\n                display: flex;\n                gap: 16px;\n                justify-content: center;\n                padding: 10px;\n                border-top: 1px solid var(--acu-border);\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                flex-shrink: 0;\n            }\n            .acu-graph-legend span {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            .acu-zoom-display {\n                background: var(--acu-btn-bg);\n                padding: 2px 8px;\n                border-radius: 4px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                min-width: 45px;\n                text-align: center;\n            }\n            .acu-node-size-slider-container input[type=\"range\"] {\n                -webkit-appearance: none;\n                appearance: none;\n                height: 10px;\n                border-radius: 5px;\n                background: var(--acu-btn-bg);\n                outline: none;\n                cursor: pointer;\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-webkit-slider-thumb {\n                -webkit-appearance: none;\n                appearance: none;\n                width: 20px;\n                height: 20px;\n                border-radius: 50%;\n                background: var(--acu-accent);\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n                transition: all 0.2s;\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-webkit-slider-thumb:hover {\n                transform: scale(1.1);\n                box-shadow: 0 3px 6px rgba(0,0,0,0.4);\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-moz-range-thumb {\n                width: 20px;\n                height: 20px;\n                border-radius: 50%;\n                background: var(--acu-accent);\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n                transition: all 0.2s;\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-moz-range-thumb:hover {\n                transform: scale(1.1);\n                box-shadow: 0 3px 6px rgba(0,0,0,0.4);\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-moz-range-track {\n                height: 10px;\n                border-radius: 5px;\n                background: var(--acu-btn-bg);\n            }\n            @media (max-width: 768px) {\n                .acu-relation-graph-container {\n                    width: 100%;\n                    height: 80vh;\n                    max-height: none;\n                    border-radius: 12px;\n                }\n                .acu-graph-legend {\n                    gap: 8px;\n                    flex-wrap: nowrap;\n                    padding: 8px 6px;\n                }\n            }\n\n            /* ==========  ========== */\n            .acu-map-overlay {\n                background: rgba(0,0,0,0.8);\n                z-index: 2147483650;\n                backdrop-filter: blur(4px);\n            }\n            .acu-map-container {\n                width: 95%;\n                max-width: 500px;\n                max-height: 85vh;\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;\n                box-shadow: 0 10px 40px rgba(0,0,0,0.45);\n            }\n            .acu-map-title {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-accent);\n            }\n            .acu-map-actions {\n                display: flex;\n                gap: 6px;\n                align-items: center;\n            }\n            .acu-map-actions button {\n                width: 28px;\n                height: 28px;\n                border-radius: 6px;\n                border: 1px solid var(--acu-border);\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.15s;\n            }\n            .acu-map-actions button:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent);\n            }\n            .acu-map-body {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n                padding: 12px;\n                overflow: hidden;\n            }\n            /*  - 3Grid */\n            .acu-map-focus-area {\n                display: grid;\n                grid-template-columns: 1fr auto 1fr;\n                gap: 12px;\n                align-items: center;\n                border: 1px dashed var(--acu-border);\n                border-radius: 12px;\n                padding: 16px;\n                background: var(--acu-btn-bg);\n            }\n\n            /*  */\n            .acu-map-wing {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n                min-width: 0;\n                align-self: flex-start; /*  */\n            }\n            .acu-map-wing.left { align-items: flex-end; text-align: right; }\n            .acu-map-wing.right { align-items: flex-start; text-align: left; }\n\n            .acu-map-mobile-stack {\n                display: none;\n            }\n\n            /*  */\n            .acu-map-avatar-group {\n                display: flex;\n                flex-wrap: wrap;\n                gap: 6px;\n                align-items: flex-start; /*  */\n                min-height: 70px; /*  */\n            }\n            .acu-map-wing.left .acu-map-avatar-group { justify-content: flex-end; }\n            .acu-map-wing.right .acu-map-avatar-group { justify-content: flex-start; }\n\n            /*  */\n            .acu-map-wing.left .acu-map-avatar:not(:last-child) { margin-right: -12px; }\n            .acu-map-wing.right .acu-map-avatar:not(:first-child) { margin-left: -12px; }\n            .acu-map-avatar:hover { transform: scale(1.1); z-index: 10; position: relative; }\n\n            .acu-map-avatar {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 4px;\n                min-width: 56px;\n                cursor: pointer;\n                transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);\n            }\n            .acu-map-avatar-circle {\n                width: 46px;\n                height: 46px;\n                border-radius: 50%;\n                border: 2px solid var(--acu-accent);\n                background: var(--acu-btn-bg);\n                background-size: cover;\n                background-position: center;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: var(--acu-text-sub);\n                font-weight: bold;\n                font-size: 16px;\n                box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n            }\n            .acu-map-avatar-name {\n                font-size: 11px;\n                color: var(--acu-text-main);\n                text-shadow: 0 1px 2px rgba(0,0,0,0.3);\n            }\n\n            /*  */\n            .acu-map-element-group {\n                display: flex;\n                flex-direction: column;\n                gap: 6px;\n                max-width: 140px;\n            }\n            .acu-map-element-chip {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                padding: 4px 8px;\n                border-radius: 6px;\n                border: 1px solid var(--acu-border);\n                background: var(--acu-bg-panel);\n                font-size: 11px;\n                color: var(--acu-text-main);\n                cursor: pointer;\n                transition: all 0.15s;\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            .acu-map-element-chip:hover {\n                border-color: var(--acu-accent);\n                color: var(--acu-accent);\n                transform: translateX(2px);\n            }\n\n            /*  */\n            .acu-map-stage-center {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                min-width: 100px;\n                z-index: 2;\n                cursor: pointer;\n            }\n\n            /* Emoji */\n            .acu-map-location-emoji {\n                background: transparent;\n                border: none;\n                width: auto;\n                height: auto;\n                font-size: 4rem;\n                line-height: 1;\n                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));\n                transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n            }\n            .acu-map-location-emoji:hover { transform: scale(1.1) rotate(5deg); }\n\n            /* emoji */\n            .acu-map-location-text {\n                width: 64px;\n                height: 64px;\n                border-radius: 12px;\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 28px;\n                font-weight: bold;\n                color: var(--acu-text-sub);\n            }\n\n            /*  */\n            .acu-map-location-name {\n                margin-top: 8px;\n                font-weight: 700;\n                font-size: 1.1em;\n                max-width: 140px;\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                color: var(--acu-text-main);\n            }\n\n            /*  */\n            .acu-map-thumbnails {\n                display: grid;\n                grid-template-columns: repeat(3, minmax(0, 1fr));\n                gap: 12px;\n                max-height: 50vh;\n                overflow-y: auto;\n                overflow-x: hidden;\n                padding: 12px;\n                box-sizing: border-box;\n            }\n            .acu-map-thumbnail {\n                position: relative;\n                border: 1px solid var(--acu-border);\n                border-radius: 10px;\n                padding: 8px;\n                background: var(--acu-btn-bg);\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 4px;\n                cursor: pointer;\n                transition: all 0.15s;\n            }\n            .acu-map-thumbnail.active {\n                border-color: var(--acu-accent);\n                box-shadow: 0 0 0 1px var(--acu-accent);\n            }\n            .acu-map-thumbnail:hover {\n                border-color: var(--acu-accent);\n                transform: translateY(-2px);\n            }\n            .acu-map-thumbnail-emoji {\n                width: 36px;\n                height: 36px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 24px;\n                filter: drop-shadow(0 1px 2px rgba(0,0,0,0.2));\n            }\n            .acu-map-thumbnail-placeholder {\n                width: 36px;\n                height: 36px;\n                border-radius: 8px;\n                background: var(--acu-bg-panel);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-text-sub);\n                border: 1px solid var(--acu-border);\n            }\n            .acu-map-thumbnail-name { font-size: 11px; color: var(--acu-text-main); }\n\n            /*  */\n            .acu-map-thumbnail-badge {\n                position: absolute;\n                top: -8px;\n                right: -8px;\n                min-width: 22px;\n                height: 22px;\n                padding: 0 6px;\n                border-radius: 99px;\n                background: var(--acu-accent);\n                color: #ffffff;\n                font-size: 0.75rem;\n                font-weight: 800;\n                font-variant-numeric: tabular-nums;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                box-shadow: 0 3px 6px rgba(0,0,0,0.25);\n                border: 3px solid var(--acu-btn-bg);\n                z-index: 10;\n                transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);\n            }\n\n            .acu-map-thumbnail:hover .acu-map-thumbnail-badge {\n                transform: scale(1.1);\n            }\n\n            /*  */\n            .acu-map-region-tabs {\n                display: flex;\n                gap: 4px;\n                margin-left: auto;\n                margin-right: 8px;\n            }\n            .acu-map-region-tab {\n                padding: 4px 10px;\n                border-radius: 6px;\n                border: 1px solid var(--acu-border);\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.15s;\n            }\n            .acu-map-region-tab.active,\n            .acu-map-region-tab:hover {\n                background: var(--acu-accent);\n                color: white;\n                border-color: var(--acu-accent);\n            }\n\n            .acu-map-empty {\n                text-align: center;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n                padding: 8px 0;\n            }\n            .acu-map-loading {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                padding: 40px;\n                width: 100%;\n            }\n            .acu-map-spinner {\n                width: 32px;\n                height: 32px;\n                border: 3px solid var(--acu-border);\n                border-top-color: var(--acu-accent);\n                border-radius: 50%;\n                animation: acu-map-spin 0.8s linear infinite;\n            }\n            @keyframes acu-map-spin { to { transform: rotate(360deg); } }\n            @media (max-width: 768px) {\n                .acu-map-container {\n                    width: 96%;\n                    max-height: 92vh;\n                }\n                .acu-map-focus-area {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 12px;\n                    padding: 16px 12px;\n                    background: var(--acu-btn-bg);\n                }\n                .acu-map-stage-center {\n                    width: 100%;\n                    margin-bottom: 4px;\n                    flex-direction: row;\n                    justify-content: center;\n                    gap: 12px;\n                }\n                .acu-map-location-emoji {\n                    font-size: 2.5rem;\n                    width: 48px;\n                    height: 48px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                }\n                .acu-map-location-text {\n                    width: 48px;\n                    height: 48px;\n                    font-size: 20px;\n                }\n                .acu-map-location-name {\n                    margin-top: 0;\n                    font-size: 1.25rem;\n                    max-width: none;\n                    text-align: left;\n                    align-self: center;\n                }\n                .acu-map-wing {\n                    display: none;\n                }\n                .acu-map-mobile-stack {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 10px;\n                    width: 100%;\n                }\n                .acu-map-mobile-avatars,\n                .acu-map-mobile-elements {\n                    display: flex;\n                    flex-wrap: wrap;\n                    justify-content: center;\n                    gap: 8px;\n                    max-height: 168px;\n                    overflow-y: auto;\n                    padding: 2px 4px;\n                }\n                .acu-map-mobile-avatars:empty,\n                .acu-map-mobile-elements:empty {\n                    display: none;\n                }\n                .acu-map-avatar {\n                    min-width: auto;\n                    width: 52px;\n                }\n                .acu-map-avatar-circle {\n                    width: 42px;\n                    height: 42px;\n                }\n                .acu-map-element-chip {\n                    font-size: 12px;\n                    padding: 6px 10px;\n                    background: var(--acu-bg-panel);\n                }\n                .acu-map-thumbnails {\n                    grid-template-columns: repeat(3, minmax(0, 1fr));\n                    gap: 10px;\n                }\n            }\n\n            /* ==========  ========== */\n            .acu-avatar-manager-overlay {\n                background: rgba(0,0,0,0.7);\n                z-index: 2147483655;\n            }\n            .acu-avatar-manager {\n                width: 90%;\n                max-width: 500px;\n                max-height: 80vh;\n            }\n            .acu-avatar-title {\n                font-size: 15px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            .acu-avatar-list {\n                flex: 1;\n                overflow-y: auto;\n                padding: 12px;\n                min-height: 0;\n            }\n            .acu-avatar-item {\n                display: flex;\n                align-items: flex-start;\n                gap: 12px;\n                padding: 10px;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n            .acu-avatar-item:last-child { border-bottom: none; }\n            .acu-avatar-preview {\n                width: 48px;\n                height: 48px;\n                border-radius: 50%;\n                background: var(--acu-btn-bg);\n                background-size: cover;\n                background-position: center;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                border: 2px solid var(--acu-border);\n                flex-shrink: 0;\n                position: relative;\n                cursor: pointer;\n            }\n            .acu-avatar-preview span {\n                font-size: 18px;\n                font-weight: bold;\n                color: var(--acu-text-sub);\n            }\n            .acu-avatar-camera-hint {\n                position: absolute;\n                bottom: 2px;\n                right: 2px;\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                opacity: 0.5;\n                pointer-events: none;\n            }\n            .acu-avatar-preview:hover .acu-avatar-camera-hint {\n                opacity: 0.8;\n                color: var(--acu-accent);\n            }\n            .acu-avatar-info {\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-avatar-name {\n                font-size: 13px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n                margin-bottom: 4px;\n            }\n            .acu-avatar-name-row {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                gap: 8px;\n                margin-bottom: 6px;\n            }\n            .acu-avatar-manager-overlay input.acu-avatar-url,\n            .acu-avatar-manager-overlay input.acu-avatar-aliases {\n                width: 100%;\n                padding: 6px 8px;\n                font-size: 12px;\n                border: 1px solid var(--acu-border);\n                border-radius: 4px;\n                background: var(--acu-btn-bg) !important;\n                color: var(--acu-text-main) !important;\n                box-sizing: border-box;\n                -webkit-appearance: none;\n                appearance: none;\n            }\n            .acu-avatar-manager-overlay input.acu-avatar-url:focus,\n            .acu-avatar-manager-overlay input.acu-avatar-aliases:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n                box-shadow: none !important;\n            }\n            /* URL +  */\n            .acu-avatar-input-row {\n                display: flex;\n                gap: 6px;\n                align-items: center;\n            }\n            .acu-avatar-input-row .acu-avatar-url {\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-avatar-upload-btn {\n                width: 32px;\n                height: 32px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                flex-shrink: 0;\n                transition: all 0.15s;\n            }\n            .acu-avatar-upload-btn:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent);\n            }\n            .acu-avatar-upload-btn:active {\n                transform: scale(0.95);\n            }\n            /*  */\n            .acu-avatar-source {\n                position: absolute;\n                bottom: -10px;\n                left: 50%;\n                transform: translateX(-50%);\n                font-size: 9px;\n                padding: 1px 6px;\n                border-radius: 8px;\n                font-weight: bold;\n                white-space: nowrap;\n            }\n            .acu-avatar-preview-wrap {\n                position: relative;\n                flex-shrink: 0;\n            }\n            .acu-source-local,\n            .acu-source-url,\n            .acu-source-auto {\n                background: var(--acu-badge-bg);\n                color: var(--acu-text-sub);\n            }\n            .acu-avatar-manager-overlay input.acu-avatar-aliases {\n                padding: 4px 8px;\n                font-size: 11px;\n                margin-top: 4px;\n            }\n            .acu-avatar-manager-overlay input::placeholder {\n                color: var(--acu-text-sub) !important;\n                opacity: 0.7;\n            }\n            .acu-avatar-actions {\n                display: flex;\n                flex-direction: row;\n                gap: 4px;\n                flex-shrink: 0;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-actions button {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg) !important;\n                color: var(--acu-text-sub) !important;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-actions button:hover {\n                background: var(--acu-btn-hover) !important;\n                color: var(--acu-accent) !important;\n            }\n            .acu-avatar-save-btn:hover { color: var(--acu-success-text, #27ae60) !important; }\n            .acu-avatar-clear-btn:hover { color: var(--acu-error-text, #e74c3c) !important; }\n            .acu-avatar-import-btn,\n            .acu-avatar-export-btn {\n                width: 28px;\n                height: 28px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 12px;\n                transition: all 0.2s;\n            }\n            .acu-avatar-import-btn:hover,\n            .acu-avatar-export-btn:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n            }\n            .acu-avatar-crop-row {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                margin-top: 6px;\n                font-size: 11px;\n                color: var(--acu-text-sub);\n            }\n            .acu-avatar-crop-row.hidden { display: none; }\n            .acu-avatar-manager-overlay .acu-avatar-scale {\n                flex: 1;\n                height: 6px !important;\n                -webkit-appearance: none !important;\n                appearance: none !important;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                outline: none;\n                border: none;\n                margin: 0 8px;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-webkit-slider-runnable-track {\n                height: 6px !important;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                border: none;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-webkit-slider-thumb {\n                -webkit-appearance: none !important;\n                appearance: none !important;\n                width: 16px !important;\n                height: 16px !important;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                cursor: pointer !important;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 1px 3px rgba(0,0,0,0.3) !important;\n                margin-top: -5px !important;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-moz-range-track {\n                height: 6px !important;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                border: none;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-moz-range-thumb {\n                width: 16px !important;\n                height: 16px !important;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                border: 2px solid var(--acu-bg-panel);\n                cursor: pointer !important;\n            }\n            @media (max-width: 768px) {\n                .acu-avatar-manager {\n                    width: 95%;\n                    max-height: 85vh;\n                }\n            }\n\n            /* ==========  ========== */\n            .acu-import-confirm-overlay {\n                z-index: 2147483660;\n            }\n            .acu-import-confirm-dialog {\n                width: 90%;\n                max-width: 320px;\n            }\n            .acu-import-confirm-body {\n                padding: 16px;\n            }\n            .acu-import-stats {\n                display: flex;\n                justify-content: space-around;\n                margin-bottom: 16px;\n            }\n            .acu-import-stat {\n                text-align: center;\n            }\n            .acu-stat-num {\n                display: block;\n                font-size: 24px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n            }\n            .acu-stat-label {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n            }\n            .acu-stat-new .acu-stat-num { color: var(--acu-success-text); }\n            .acu-stat-conflict .acu-stat-num { color: #e67e22; }\n            .acu-import-conflict-section {\n                margin-top: 12px;\n                padding-top: 12px;\n                border-top: 1px dashed var(--acu-border);\n            }\n            .acu-import-conflict-options {\n                margin-top: 10px;\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n            .acu-import-radio {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                cursor: pointer;\n                font-size: 13px;\n                color: var(--acu-text-main);\n            }\n            .acu-import-radio input {\n                accent-color: var(--acu-accent);\n            }\n            .acu-import-confirm-footer {\n                display: flex;\n                gap: 10px;\n                padding: 12px 16px;\n                border-top: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n            }\n            .acu-import-cancel-btn,\n            .acu-import-confirm-btn {\n                flex: 1;\n                padding: 10px;\n                border-radius: 6px;\n                font-size: 13px;\n                font-weight: bold;\n                cursor: pointer;\n                transition: all 0.2s;\n            }\n            .acu-import-cancel-btn {\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-main);\n            }\n            .acu-import-cancel-btn:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-import-confirm-btn {\n                background: var(--acu-accent);\n                border: none;\n                color: #fff;\n            }\n            .acu-import-confirm-btn:hover {\n                opacity: 0.9;\n            }\n            /* ========== / ========== */\n            .acu-avatar-import-btn,\n            .acu-avatar-export-btn {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n            }\n\n            /* ==========  ========== */\n            .acu-dice-config-dialog {\n                width: 320px;\n                max-width: 92vw;\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                box-shadow: 0 15px 40px rgba(0,0,0,0.4);\n                overflow: hidden;\n            }\n            .acu-dice-cfg-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 10px 14px;\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-accent);\n            }\n            .acu-dice-cfg-header .acu-config-close {\n                background: none;\n                border: none;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                font-size: 14px;\n                padding: 4px;\n            }\n            .acu-dice-cfg-header .acu-config-close:hover {\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-body {\n                padding: 12px;\n            }\n            .acu-dice-cfg-row {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                gap: 10px;\n                margin-bottom: 10px;\n            }\n            .acu-dice-cfg-row.acu-cfg-full-row {\n                grid-template-columns: 1fr;\n            }\n            .acu-dice-cfg-item {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n            }\n            .acu-dice-cfg-item label {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                font-weight: 500;\n            }\n            .acu-dice-cfg-item.acu-cfg-toggle-item {\n                flex-direction: row;\n                align-items: center;\n                justify-content: space-between;\n                padding: 8px 0;\n            }\n            .acu-dice-cfg-item.acu-cfg-toggle-item > label {\n                margin: 0;\n                font-size: 13px;\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-item input,\n            .acu-dice-cfg-item select {\n                width: 100%;\n                padding: 7px 8px;\n                background: var(--acu-input-bg) !important;\n                border: 1px solid var(--acu-border);\n                border-radius: 5px;\n                color: var(--acu-text-main) !important;\n                font-size: 13px;\n                text-align: center;\n                box-sizing: border-box;\n            }\n            .acu-dice-cfg-item input::placeholder {\n                color: var(--acu-text-sub);\n                opacity: 0.6;\n            }\n            .acu-dice-cfg-item select option {\n                background: var(--acu-bg-panel);\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-item select {\n                text-align: left;\n                cursor: pointer;\n            }\n            .acu-dice-cfg-item select option {\n                background: var(--acu-bg-panel);\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-item input:focus,\n            .acu-dice-cfg-item select:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n            }\n            .acu-cfg-hint {\n                font-size: 9px;\n                color: var(--acu-text-sub);\n                opacity: 0.7;\n                text-align: center;\n            }\n            .acu-dice-cfg-actions {\n                display: flex;\n                gap: 8px;\n                margin-top: 12px;\n                padding: 10px 12px;\n                border-top: 1px dashed var(--acu-border);\n            }\n            .acu-dice-cfg-actions button {\n                flex: 1;\n                padding: 9px 12px;\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                border: 1px solid var(--acu-border);\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-actions button:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-dice-cfg-actions button.primary {\n                background: var(--acu-btn-bg);\n                border-color: var(--acu-btn-bg);\n                color: var(--acu-button-text);\n            }\n            .acu-dice-cfg-actions button.primary:hover {\n                background: var(--acu-btn-hover);\n                border-color: var(--acu-btn-hover);\n            }\n            /* ==========  ========== */\n            .acu-settings-dialog {\n                width: 380px;\n                max-width: 380px;\n                max-height: 85vh;\n                padding: 0;\n                gap: 0;\n            }\n            @media (max-width: 768px) {\n                .acu-settings-dialog {\n                    width: 92vw;\n                    max-width: 92vw;\n                    max-height: 85vh;\n                }\n                .acu-settings-body {\n                    max-height: calc(85vh - 110px);\n                    -webkit-overflow-scrolling: touch;\n                }\n                .acu-table-manager-list {\n                    max-height: 40vh;\n                    -webkit-overflow-scrolling: touch;\n                }\n            }\n            .acu-settings-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 14px 16px;\n                border-bottom: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n            }\n            .acu-settings-title-group {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n            }\n            .acu-settings-title {\n                font-size: 16px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .acu-header-actions {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .acu-version-badge {\n                display: inline-flex;\n                align-items: center;\n                line-height: 1.2;\n                white-space: nowrap;\n                letter-spacing: 0.5px;\n                background: var(--acu-badge-bg, rgba(0, 0, 0, 0.05));\n                color: var(--acu-text-sub);\n                border-radius: 4px;\n                padding: 2px 6px;\n                font-size: 10px;\n                font-weight: normal;\n                margin-left: 6px;\n                opacity: 0.8;\n            }\n            .acu-help-btn {\n                background: none !important;\n                border: none !important;\n                box-shadow: none !important;\n                outline: none !important;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                font-size: 16px;\n                padding: 6px;\n                margin: 0;\n                border-radius: 4px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s;\n            }\n            .acu-help-btn:hover {\n                color: var(--acu-text-main);\n                background: var(--acu-table-hover) !important;\n            }\n            .acu-settings-body {\n                flex: 1;\n                min-height: 0;\n                overflow-y: auto;\n                overflow-x: hidden;\n                padding: 8px;\n                -webkit-overflow-scrolling: touch;\n            }\n            .acu-settings-group {\n                background: var(--acu-card-bg);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 8px;\n            }\n            .acu-settings-group-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 12px 14px;\n                font-size: 13px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n                background: var(--acu-table-head);\n                cursor: pointer;\n                user-select: none;\n                transition: background 0.15s;\n            }\n            .acu-settings-group-title:hover {\n                background: var(--acu-table-hover);\n            }\n            .acu-group-chevron {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                width: 12px;\n                transition: transform 0.2s;\n            }\n            .acu-settings-group-body {\n                padding: 4px 12px 8px;\n            }\n            .acu-settings-group.collapsed .acu-settings-group-body {\n                display: none;\n            }\n            .acu-settings-group-body.acu-animating {\n                display: block !important;\n                overflow: hidden;\n            }\n            .acu-settings-group:last-child {\n                margin-bottom: 0;\n            }\n            .acu-setting-row {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 10px 0;\n                border-bottom: 1px dashed var(--acu-border);\n                gap: 12px;\n                min-height: 44px;\n            }\n            .acu-setting-row:last-child {\n                border-bottom: none;\n            }\n            .acu-setting-row-slider {\n                flex-direction: column;\n                align-items: stretch;\n            }\n            .acu-setting-info {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-setting-label {\n                font-size: 13px;\n                color: var(--acu-text-main);\n            }\n            .acu-setting-hint {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                opacity: 0.7;\n            }\n            .acu-setting-value {\n                font-size: 12px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                margin-left: auto;\n            }\n            .acu-setting-select {\n                padding: 6px 10px;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px;\n                background: var(--acu-input-bg, var(--acu-btn-bg)) !important;\n                color: var(--acu-text-main) !important;\n                font-size: 12px;\n                min-width: 120px;\n                cursor: pointer;\n                -webkit-appearance: none;\n                appearance: none;\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23888' d='M6 8L2 4h8z'/%3E%3C/svg%3E\");\n                background-repeat: no-repeat;\n                background-position: right 8px center;\n                padding-right: 28px;\n            }\n            .acu-setting-select:focus {\n                outline: none;\n                border-color: var(--acu-accent) !important;\n            }\n            .acu-setting-select option {\n                background: var(--acu-bg-panel) !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-select-short {\n                min-width: 80px;\n            }\n            .acu-setting-slider {\n                width: 100%;\n                height: 6px;\n                margin-top: 8px;\n                -webkit-appearance: none;\n                appearance: none;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                outline: none;\n                border: none;\n            }\n            .acu-setting-slider::-webkit-slider-runnable-track {\n                height: 6px;\n                background: var(--acu-border);\n                border-radius: 3px;\n            }\n            .acu-setting-slider::-webkit-slider-thumb {\n                -webkit-appearance: none;\n                appearance: none;\n                width: 18px;\n                height: 18px;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 1px 4px rgba(0,0,0,0.2);\n                margin-top: -6px;\n            }\n            .acu-setting-slider::-moz-range-track {\n                height: 6px;\n                background: var(--acu-border);\n                border-radius: 3px;\n                border: none;\n            }\n            .acu-setting-slider::-moz-range-thumb {\n                width: 18px;\n                height: 18px;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 1px 4px rgba(0,0,0,0.2);\n            }\n            .acu-setting-slider:focus {\n                outline: none;\n            }\n            .acu-setting-mini-btn {\n                width: 28px;\n                height: 28px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 11px;\n                flex-shrink: 0;\n                transition: all 0.15s;\n            }\n            .acu-setting-mini-btn:hover, .acu-setting-mini-btn.active {\n                background: var(--acu-accent);\n                color: #fff;\n                border-color: var(--acu-accent);\n            }\n\n            /* ==========  ========== */\n            .acu-preset-item {\n                padding: 12px;\n                background: var(--acu-card-bg);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 10px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                gap: 12px;\n                transition: all 0.2s;\n            }\n            .acu-preset-item:hover {\n                background: var(--acu-table-hover);\n                border-color: var(--acu-accent);\n            }\n            .acu-preset-info {\n                flex: 1;\n            }\n            .acu-preset-name {\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n                margin-bottom: 4px;\n            }\n            .acu-preset-desc {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                margin-bottom: 4px;\n            }\n            .acu-preset-stats {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n            }\n            .acu-preset-actions {\n                display: flex;\n                gap: 8px;\n                flex-shrink: 0;\n                align-items: center;\n            }\n            .acu-preset-btn {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 13px;\n                transition: all 0.15s;\n            }\n            .acu-preset-btn:hover {\n                background: var(--acu-accent);\n                color: #fff;\n                border-color: var(--acu-accent);\n            }\n            .acu-preset-btn.acu-preset-delete:hover {\n                background: rgba(231, 76, 60, 0.2);\n                color: #e74c3c;\n                border-color: #e74c3c;\n            }\n            /*  */\n            .acu-preset-editor-input,\n            .acu-preset-editor-textarea {\n                background: var(--acu-input-bg) !important;\n                color: var(--acu-text-main) !important;\n                border: 1px solid var(--acu-border) !important;\n            }\n            .acu-preset-editor-input:focus,\n            .acu-preset-editor-textarea:focus {\n                outline: none !important;\n                border-color: var(--acu-accent) !important;\n                box-shadow: 0 0 0 2px rgba(var(--acu-accent-rgb, 100, 150, 200), 0.2) !important;\n            }\n            .acu-preset-editor-textarea {\n                font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;\n            }\n            /* Toggle  */\n            .acu-toggle {\n                position: relative;\n                width: 44px;\n                height: 24px;\n                flex-shrink: 0;\n            }\n            .acu-toggle input {\n                opacity: 0;\n                width: 0;\n                height: 0;\n            }\n            .acu-toggle-slider {\n                position: absolute;\n                cursor: pointer;\n                top: 0; left: 0; right: 0; bottom: 0;\n                background: rgba(120, 120, 128, 0.16);\n                border: none;\n                border-radius: 24px;\n                transition: all 0.3s ease;\n            }\n            .acu-toggle-slider:before {\n                position: absolute;\n                content: \"\";\n                height: 20px;\n                width: 20px;\n                left: 2px;\n                top: 2px;\n                background: #fff;\n                border-radius: 50%;\n                transition: all 0.3s ease;\n                box-shadow: 0 2px 4px rgba(0,0,0,0.15);\n            }\n            .acu-toggle input:checked + .acu-toggle-slider {\n                background: var(--acu-accent);\n            }\n            .acu-toggle input:checked + .acu-toggle-slider:before {\n                transform: translateX(20px);\n                box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n            }\n            /* Debug -  */\n            .acu-debug-console-dialog .acu-debug-filter,\n            .acu-debug-console-dialog label input.acu-debug-filter {\n                cursor: pointer !important;\n                width: auto !important;\n                height: auto !important;\n                margin: 0 !important;\n                padding: 0 !important;\n                appearance: checkbox !important;\n                -webkit-appearance: checkbox !important;\n                -moz-appearance: checkbox !important;\n            }\n            .acu-debug-console-dialog label {\n                display: flex !important;\n                align-items: center !important;\n                gap: 4px !important;\n                cursor: pointer !important;\n                font-size: 12px !important;\n            }\n            .acu-setting-action-btn {\n                width: 100%;\n                padding: 10px 14px;\n                margin-bottom: 6px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                font-size: 13px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 8px;\n                transition: all 0.15s;\n            }\n            /* Stepper  */\n            .acu-stepper {\n                display: flex;\n                align-items: center;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                overflow: hidden;\n                background: transparent !important;\n                flex-shrink: 0;\n            }\n            .acu-stepper-btn {\n                width: 36px;\n                height: 34px;\n                border: none !important;\n                background: transparent !important;\n                background-color: transparent !important;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.15s;\n                -webkit-appearance: none !important;\n                appearance: none !important;\n            }\n            .acu-stepper-btn:hover {\n                background: var(--acu-table-hover) !important;\n                color: var(--acu-accent);\n            }\n            .acu-stepper-btn:active {\n                transform: scale(0.95);\n                background: var(--acu-accent) !important;\n                color: var(--acu-button-text);\n            }\n            .acu-stepper-value {\n                min-width: 60px;\n                height: 34px;\n                line-height: 34px;\n                text-align: center;\n                font-size: 13px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n                background: transparent !important;\n                border-left: 1px solid var(--acu-border);\n                border-right: 1px solid var(--acu-border);\n            }\n            /* ==========  ========== */\n            .acu-changes-content {\n                padding: 10px;\n                overflow-y: auto !important;\n                overflow-x: hidden !important;\n                -webkit-overflow-scrolling: touch !important;\n                touch-action: pan-y !important;\n                overscroll-behavior-y: contain;\n            }\n            /* ==========  ========== */\n            .acu-validation-error-msg {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                flex: 1;\n                min-width: 0;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n            }\n            /*  -  */\n            .acu-validation-mode-hint {\n                padding: 8px 12px;\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                background: var(--acu-table-head);\n                border-radius: 6px;\n                margin: 0 0 10px 0;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            /*  */\n            .acu-changes-content.acu-changes-horizontal {\n                display: flex !important;\n                flex-direction: row !important;\n                flex-wrap: nowrap !important;\n                align-items: flex-start !important;\n                gap: 12px;\n                overflow-x: auto !important;\n                overflow-y: visible !important;\n                touch-action: pan-x pan-y !important;\n                padding-bottom: 5px;\n                -webkit-overflow-scrolling: touch;\n                overscroll-behavior-x: contain;\n                overscroll-behavior-y: auto;\n            }\n            .acu-changes-content.acu-changes-horizontal .acu-changes-list {\n                display: flex !important;\n                flex-direction: row !important;\n                flex-wrap: nowrap !important;\n                gap: 12px;\n                align-items: flex-start;\n                min-width: max-content;\n            }\n            .acu-changes-content.acu-changes-horizontal .acu-changes-group {\n                flex: 0 0 280px;\n                min-width: 280px;\n                max-width: 280px;\n                max-height: none;\n                overflow-y: visible;\n                -webkit-overflow-scrolling: auto;\n                overscroll-behavior-y: auto;\n            }\n            @media (min-width: 769px) {\n                .acu-changes-content.acu-changes-horizontal .acu-changes-group {\n                    flex: 0 0 320px;\n                    min-width: 320px;\n                    max-width: 320px;\n                }\n            }\n            .acu-changes-list { display: flex; flex-direction: column; gap: 10px; }\n            .acu-changes-group { background: var(--acu-card-bg); border: 1px solid var(--acu-border); border-radius: 8px; overflow: hidden; }\n            .acu-changes-group-header { display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: var(--acu-table-head); font-weight: bold; font-size: 13px; color: var(--acu-text-main); }\n            .acu-changes-count { margin-left: auto; background: var(--acu-accent); color: #fff; font-size: 11px; padding: 2px 8px; border-radius: 10px; font-weight: normal; }\n            .acu-changes-group-body { padding: 6px; display: flex; flex-direction: column; gap: 4px; }\n            .acu-change-item { display: flex; align-items: center; gap: 6px; padding: 6px 8px; border-radius: 6px; font-size: 12px; background: rgba(0,0,0,0.02); flex-wrap: wrap; transition: all 0.15s; }\n            .acu-change-item:hover { background: var(--acu-table-hover); }\n            .acu-change-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: bold; flex-shrink: 0; }\n            .acu-badge-added { background: var(--acu-success-bg); color: var(--acu-success-text); }\n            .acu-badge-deleted { background: var(--acu-hl-manual-bg); color: var(--acu-hl-manual); }\n            .acu-badge-modified { background: var(--acu-hl-diff-bg); color: var(--acu-hl-diff); }\n            .acu-change-title { color: var(--acu-text-main); font-weight: 500; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            .acu-change-field { color: var(--acu-text-sub); font-size: 11px; flex-shrink: 0; max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            .acu-change-diff { display: flex; align-items: center; gap: 4px; flex: 1; min-width: 0; overflow: hidden; }\n            .acu-diff-old { color: var(--acu-hl-manual); text-decoration: line-through; opacity: 0.7; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; }\n            .acu-diff-arrow { color: var(--acu-text-sub); flex-shrink: 0; }\n            .acu-diff-new { color: var(--acu-success-text); font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; }\n            /*  */\n            .acu-change-actions { display: flex; gap: 4px; margin-left: auto; flex-shrink: 0; }\n            .acu-change-action-btn { width: 24px; height: 24px; border: 1px solid var(--acu-border); border-radius: 4px; background: var(--acu-btn-bg); color: var(--acu-text-sub); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 11px; transition: all 0.15s; padding: 0; }\n            .acu-change-action-btn:hover { background: var(--acu-btn-hover); color: var(--acu-text-main); transform: scale(1.1); }\n            .acu-action-accept:hover { background: var(--acu-success-bg); color: var(--acu-success-text); border-color: var(--acu-success-text); }\n            .acu-action-reject:hover, .acu-action-restore:hover { background: var(--acu-hl-manual-bg); color: var(--acu-hl-manual); border-color: var(--acu-hl-manual); }\n            .acu-action-edit:hover { background: var(--acu-hl-diff-bg); color: var(--acu-hl-diff); border-color: var(--acu-hl-diff); }\n            /*  -  */\n            .acu-changes-batch-btn { width: 32px; height: 32px; border: 1.5px solid rgba(255,255,255,0.4); border-radius: 6px; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.85); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 13px; transition: all 0.15s; }\n            .acu-changes-batch-btn:hover { background: rgba(255,255,255,0.2); color: #fff; border-color: rgba(255,255,255,0.6); }\n            .acu-batch-accept:hover { background: var(--acu-success-bg); color: var(--acu-success-text); border-color: var(--acu-success-text); }\n            .acu-batch-reject:hover { background: var(--acu-hl-manual-bg); color: var(--acu-hl-manual); border-color: var(--acu-hl-manual); }\n            .acu-simple-mode-toggle.active { background: var(--acu-accent); color: #fff; border-color: var(--acu-accent); }\n            .acu-simple-mode-toggle:hover { background: var(--acu-accent); color: #fff; border-color: var(--acu-accent); }\n            .acu-changes-group.collapsed .acu-collapse-icon { transform: rotate(0deg); }\n            .acu-changes-group:not(.collapsed) .acu-collapse-icon { transform: rotate(0deg); }\n            .acu-changes-group-header:hover { background: var(--acu-table-hover); }\n            /*  */\n            .acu-diff-section { margin-bottom: 12px; }\n            .acu-diff-label { font-size: 12px; font-weight: bold; color: var(--acu-text-sub); margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }\n            .acu-diff-readonly { padding: 10px 12px; background: var(--acu-table-head); border: 1px dashed var(--acu-border); border-radius: 6px; color: var(--acu-text-main); font-size: 13px; line-height: 1.5; white-space: pre-wrap; word-break: break-word; max-height: 150px; overflow-y: auto; opacity: 0.8; }\n            .acu-diff-arrow-down { text-align: center; color: var(--acu-text-sub); font-size: 14px; margin: 8px 0; opacity: 0.5; }\n            /*  */\n            .acu-diff-new-section { padding: 12px; background: var(--acu-input-bg); border: 2px solid var(--acu-accent); border-radius: 6px; box-shadow: 0 0 0 3px rgba(127, 127, 255, 0.1); }\n            .acu-diff-new-section .acu-diff-label { color: var(--acu-accent); font-weight: 600; }\n            .acu-diff-new-section textarea,\n            .acu-diff-new-section input { background: var(--acu-input-bg) !important; border-color: var(--acu-border) !important; }\n            .acu-diff-new-section textarea:focus,\n            .acu-diff-new-section input:focus { border-color: var(--acu-accent) !important; box-shadow: 0 0 0 2px rgba(127, 127, 255, 0.15); }\n            /*  */\n            .acu-edit-dialog .acu-dialog-btns {\n                display: flex;\n                gap: 10px;\n                padding: 12px 16px;\n                border-top: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n                margin: 0 -16px -16px -16px;\n                border-radius: 0 0 12px 12px;\n            }\n            .acu-edit-dialog .acu-dialog-btn {\n                flex: 1;\n                padding: 10px 12px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                font-size: 13px;\n                font-weight: 500;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n                white-space: nowrap;\n                transition: all 0.15s;\n            }\n            .acu-edit-dialog .acu-dialog-btn:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-edit-dialog .acu-btn-confirm {\n                background: var(--acu-accent);\n                border-color: var(--acu-accent);\n                color: #fff;\n            }\n            .acu-edit-dialog .acu-btn-confirm:hover {\n                opacity: 0.9;\n            }\n            @media (max-width: 768px) {\n                .acu-edit-dialog .acu-dialog-btns {\n                    flex-wrap: nowrap;\n                }\n                .acu-edit-dialog .acu-dialog-btn {\n                    padding: 10px 8px;\n                    font-size: 12px;\n                    min-width: 0;\n                }\n                .acu-edit-dialog .acu-dialog-btn i {\n                    font-size: 11px;\n                }\n            }\n            @media (max-width: 768px) {\n                .acu-change-item { padding: 8px 6px; }\n                .acu-change-diff { flex-basis: 100%; margin-top: 4px; order: 10; }\n                .acu-change-actions { order: 5; }\n                .acu-diff-old, .acu-diff-new { max-width: 100px; }\n                .acu-change-action-btn { width: 28px; height: 28px; }\n            }\n            .acu-change-field-count { font-size: 11px; color: var(--acu-text-sub); margin-left: 4px; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            /*  */\n            .acu-row-edit-field { margin-bottom: 12px; padding: 10px; background: var(--acu-table-head); border-radius: 6px; border: 1px solid transparent; }\n            .acu-row-edit-field.acu-field-changed { border-color: var(--acu-accent); background: var(--acu-bg-panel); }\n            .acu-row-edit-label { font-size: 12px; font-weight: bold; color: var(--acu-text-sub); margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }\n            .acu-changed-badge { font-size: 10px; padding: 1px 6px; background: var(--acu-accent); color: #fff; border-radius: 3px; font-weight: normal; }\n            .acu-row-edit-old { font-size: 12px; color: var(--acu-text-sub); padding: 6px 8px; background: var(--acu-table-head); border-radius: 4px; margin-bottom: 6px; text-decoration: line-through; opacity: 0.7; white-space: pre-wrap; word-break: break-word; }\n            .acu-row-edit-input { width: 100%; min-height: 36px; max-height: 200px; padding: 8px; resize: none; }\n            .acu-empty-val { opacity: 0.5; font-style: italic; }\n            /* ==========  ========== */\n            .acu-table-manager-list {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n                max-height: 300px;\n                overflow-y: auto;\n                padding: 4px;\n                -webkit-overflow-scrolling: touch;\n                overscroll-behavior-y: contain;\n                touch-action: pan-y;\n            }\n            .acu-table-manager-item {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 8px 10px;\n                background: transparent;\n                border: 1.5px solid var(--acu-accent);\n                border-radius: 6px;\n                cursor: default;\n                transition: all 0.15s;\n                user-select: none;\n                touch-action: pan-y;\n            }\n            .acu-table-manager-item:hover {\n                background: var(--acu-table-hover);\n            }\n            .acu-table-manager-item.hidden-table {\n                opacity: 0.5;\n                border-color: var(--acu-border);\n                border-style: dashed;\n            }\n            .acu-table-manager-item.hidden-table .acu-table-item-name {\n                text-decoration: line-through;\n            }\n            .acu-table-item-check {\n                width: 28px;\n                height: 28px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                cursor: pointer;\n                color: var(--acu-accent);\n                border-radius: 4px;\n                transition: all 0.15s;\n            }\n            .acu-table-item-check:hover {\n                background: var(--acu-table-hover);\n                transform: scale(1.1);\n            }\n            .acu-table-manager-item.hidden-table .acu-table-item-check {\n                color: var(--acu-text-sub);\n            }\n            .acu-table-item-icon {\n                width: 20px;\n                text-align: center;\n                color: var(--acu-accent);\n                font-size: 12px;\n            }\n            .acu-table-item-name {\n                flex: 1;\n                font-size: 13px;\n                color: var(--acu-text-main);\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            .acu-table-item-handle {\n                width: 28px;\n                height: 28px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: var(--acu-text-sub);\n                cursor: grab;\n                opacity: 0.4;\n                transition: all 0.15s;\n                border-radius: 4px;\n            }\n            .acu-table-item-handle:hover {\n                opacity: 1;\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n            }\n            .acu-table-manager-item.acu-dragging {\n                opacity: 0.9;\n                background: var(--acu-accent);\n                border-color: var(--acu-accent);\n                box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n                z-index: 100;\n            }\n            .acu-table-manager-item.acu-dragging .acu-table-item-name,\n            .acu-table-manager-item.acu-dragging .acu-table-item-check,\n            .acu-table-manager-item.acu-dragging .acu-table-item-icon,\n            .acu-table-manager-item.acu-dragging .acu-table-item-handle {\n                color: #fff;\n            }\n            .acu-table-manager-item.acu-drag-above {\n                border-top: 2px solid var(--acu-accent);\n                margin-top: -1px;\n            }\n            .acu-table-manager-item.acu-drag-below {\n                border-bottom: 2px solid var(--acu-accent);\n                margin-bottom: -1px;\n            }\n            @media (max-width: 768px) {\n                .acu-table-item-handle {\n                    opacity: 0.6;\n                }\n            }\n            /* // */\n            .acu-table-manager-item.acu-special-item {\n                background: linear-gradient(135deg, rgba(var(--acu-accent-rgb, 128, 128, 128), 0.08), transparent);\n                border-style: dashed;\n            }\n            .acu-table-manager-item.acu-special-item .acu-table-item-icon {\n                color: var(--acu-accent);\n            }\n            .acu-table-manager-item.acu-special-item .acu-table-item-name {\n                font-weight: 500;\n            }\n            /* ==========  ========== */\n            .acu-validation-rules-list {\n                display: flex;\n                flex-direction: column;\n                gap: 6px;\n                max-height: 280px;\n                overflow-y: auto;\n                padding: 2px;\n            }\n            .acu-validation-rule-item {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 8px 10px;\n                background: transparent;\n                border: 1.5px solid var(--acu-accent);\n                border-radius: 6px;\n                transition: all 0.2s ease;\n            }\n            .acu-validation-rule-item.disabled {\n                opacity: 0.5;\n            }\n            .acu-validation-rule-item:hover {\n                border-color: var(--acu-accent);\n            }\n            .acu-rule-toggle {\n                cursor: pointer;\n                font-size: 18px;\n                color: var(--text-sub);\n                transition: all 0.2s;\n                flex-shrink: 0;\n                background: none;\n                border: none;\n                border-radius: 4px;\n                padding: 4px 8px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n            .acu-rule-toggle:hover {\n                opacity: 0.8;\n            }\n            .acu-rule-toggle.active {\n                color: var(--acu-accent);\n                opacity: 1;\n            }\n            .acu-rule-info {\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-rule-name {\n                font-size: 12px;\n                font-weight: 500;\n                color: var(--acu-text-main);\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            .acu-rule-target {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                margin-top: 2px;\n            }\n            .acu-rule-type-icon {\n                width: 20px;\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                flex-shrink: 0;\n                text-align: center;\n                background: none !important;\n            }\n            .acu-rule-delete {\n                background: none;\n                border: none;\n                color: var(--text-sub);\n                cursor: pointer;\n                padding: 4px;\n                opacity: 0.6;\n                transition: all 0.2s;\n                flex-shrink: 0;\n            }\n            .acu-rule-delete:hover {\n                color: #e74c3c;\n                opacity: 1;\n            }\n            .acu-rule-edit {\n                background: none;\n                border: none;\n                color: var(--text-sub);\n                cursor: pointer;\n                padding: 4px;\n                opacity: 0.6;\n                transition: all 0.2s;\n                flex-shrink: 0;\n            }\n            .acu-rule-edit:hover {\n                color: var(--accent-color);\n                opacity: 1;\n            }\n            .acu-rule-delete:hover {\n                color: #e74c3c;\n                opacity: 1;\n            }\n            .acu-rule-intercept {\n                cursor: pointer;\n                font-size: 14px;\n                color: var(--acu-text-sub);\n                padding: 4px 6px;\n                border-radius: 4px;\n                opacity: 0.5;\n                transition: all 0.2s;\n                flex-shrink: 0;\n            }\n            .acu-rule-intercept:hover {\n                opacity: 0.8;\n                background: var(--acu-hover-bg);\n            }\n            .acu-rule-intercept.active {\n                color: var(--acu-accent);\n                opacity: 1;\n            }\n            .acu-add-rule-btn {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n                width: 100%;\n                padding: 10px;\n                margin-top: 8px;\n                background: var(--acu-btn-bg);\n                border: 1px dashed var(--acu-border);\n                border-radius: 6px;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.2s;\n            }\n            .acu-add-rule-btn:hover {\n                border-color: var(--acu-accent);\n                color: var(--acu-accent);\n                background: rgba(var(--acu-accent-rgb, 128, 128, 128), 0.1);\n            }\n            /*  */\n            .acu-validation-modal-overlay {\n                z-index: 2147483659;\n            }\n            .acu-validation-modal {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                width: 90%;\n                max-width: 420px;\n                overflow: hidden;\n                box-shadow: 0 20px 60px rgba(0,0,0,0.5);\n            }\n            .acu-validation-modal-body {\n                padding: 16px;\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n                max-height: 60vh;\n                overflow-y: auto;\n            }\n            .acu-validation-modal-body .acu-setting-row {\n                flex-wrap: wrap;\n            }\n            .acu-validation-modal-body .acu-panel-input,\n            .acu-validation-modal input[type=\"text\"],\n            .acu-validation-modal input[type=\"number\"],\n            .acu-validation-modal select {\n                background: var(--acu-input-bg, var(--acu-btn-bg)) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px !important;\n                padding: 8px 10px !important;\n                color: var(--acu-text-main) !important;\n                font-size: 12px !important;\n                box-shadow: none !important;\n                -webkit-appearance: none !important;\n            }\n            .acu-validation-modal-body .acu-panel-input:focus,\n            .acu-validation-modal input[type=\"text\"]:focus,\n            .acu-validation-modal input[type=\"number\"]:focus,\n            .acu-validation-modal select:focus {\n                outline: none !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .acu-validation-modal-body .acu-panel-input::placeholder,\n            .acu-validation-modal input[type=\"text\"]::placeholder,\n            .acu-validation-modal input[type=\"number\"]::placeholder {\n                color: var(--acu-text-sub) !important;\n                opacity: 0.7 !important;\n            }\n            .acu-validation-modal select option {\n                background: var(--acu-bg-panel) !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-validation-modal select option[value=\"\"] {\n                color: var(--acu-text-sub) !important;\n                opacity: 0.7 !important;\n            }\n            .acu-rule-config-section {\n                padding: 8px 0;\n            }\n            .acu-validation-modal-footer {\n                display: flex;\n                justify-content: center;\n                gap: 12px;\n                padding: 16px;\n                border-top: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n            }\n            .acu-validation-modal-footer .acu-btn {\n                flex: 1;\n                padding: 10px 12px !important;\n                font-size: 13px !important;\n                font-weight: 500 !important;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n            }\n            /*  */\n            .acu-smart-fix-meta {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 4px 0 !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n                flex-wrap: wrap !important;\n            }\n            .acu-smart-fix-separator {\n                color: var(--acu-border) !important;\n                opacity: 0.5 !important;\n            }\n            .acu-smart-fix-diff {\n                display: flex !important;\n                align-items: center !important;\n                gap: 8px !important;\n                padding: 6px 0 !important;\n                margin: 4px 0 !important;\n                flex-wrap: wrap !important;\n            }\n            .acu-smart-fix-diff-old-text {\n                color: var(--acu-hl-manual) !important;\n                text-decoration: line-through !important;\n                opacity: 0.7 !important;\n                font-size: 13px !important;\n                white-space: nowrap !important;\n                overflow: hidden !important;\n                text-overflow: ellipsis !important;\n                max-width: 150px !important;\n            }\n            .acu-smart-fix-diff-arrow {\n                color: var(--acu-text-sub) !important;\n                flex-shrink: 0 !important;\n            }\n            .acu-smart-fix-empty {\n                opacity: 0.5 !important;\n                font-style: italic !important;\n            }\n            .acu-smart-fix-diff-input-wrapper {\n                flex: 1 !important;\n                min-width: 120px !important;\n            }\n            .acu-smart-fix-diff-input-wrapper input,\n            .acu-smart-fix-diff-input-wrapper select {\n                width: 100% !important;\n                background: var(--acu-input-bg, var(--acu-btn-bg)) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 4px !important;\n                padding: 4px 8px !important;\n                color: var(--acu-text-main) !important;\n                font-size: 13px !important;\n                font-weight: 500 !important;\n                box-shadow: none !important;\n                -webkit-appearance: none !important;\n                -moz-appearance: none !important;\n                appearance: none !important;\n                min-height: 26px !important;\n                line-height: 1.3 !important;\n            }\n            .acu-smart-fix-diff-input-wrapper input:focus,\n            .acu-smart-fix-diff-input-wrapper select:focus {\n                outline: none !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-diff-input-wrapper select {\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%23666' d='M5 7L1 3h8z'/%3E%3C/svg%3E\") !important;\n                background-repeat: no-repeat !important;\n                background-position: right 6px center !important;\n                padding-right: 24px !important;\n            }\n            .acu-smart-fix-diff-input-wrapper select option {\n                background: var(--acu-card-bg) !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-smart-fix-suggest {\n                padding: 10px !important;\n                background: var(--acu-card-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px !important;\n                margin-top: 8px !important;\n            }\n            .acu-smart-fix-suggest-label {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                margin-bottom: 6px !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 4px !important;\n            }\n            .acu-smart-fix-suggest-label i {\n                color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-suggest-value {\n                font-size: 13px !important;\n                color: var(--acu-success-text) !important;\n                font-weight: 500 !important;\n                padding: 6px 8px !important;\n                background: var(--acu-success-bg) !important;\n                border-radius: 4px !important;\n                cursor: pointer !important;\n                transition: all 0.2s !important;\n            }\n            .acu-smart-fix-suggest-value:hover {\n                background: var(--acu-success-text) !important;\n                color: white !important;\n            }\n            .acu-smart-fix-suggest-options {\n                display: flex !important;\n                flex-wrap: wrap !important;\n                gap: 6px !important;\n            }\n            .acu-smart-fix-suggest-options-scroll {\n                max-height: 120px !important;\n                overflow-y: auto !important;\n                padding-right: 4px !important;\n            }\n            .acu-smart-fix-option {\n                display: inline-block !important;\n                font-size: 12px !important;\n                padding: 4px 10px !important;\n                background: var(--acu-btn-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 4px !important;\n                color: var(--acu-text-main) !important;\n                cursor: pointer !important;\n                transition: all 0.2s !important;\n            }\n            .acu-smart-fix-option:hover {\n                background: var(--acu-btn-hover) !important;\n                border-color: var(--acu-accent) !important;\n                color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-option-current {\n                background: var(--acu-hl-manual-bg) !important;\n                border-color: var(--acu-hl-manual) !important;\n                color: var(--acu-hl-manual) !important;\n                text-decoration: line-through !important;\n                opacity: 0.7 !important;\n            }\n            .acu-smart-fix-error-hint {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 8px !important;\n                background: var(--acu-card-bg) !important;\n                border-radius: 4px !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n            }\n            .acu-smart-fix-error-hint i {\n                color: var(--acu-accent) !important;\n                flex-shrink: 0 !important;\n            }\n            @media (max-width: 600px) {\n                .acu-smart-fix-diff {\n                    flex-direction: column !important;\n                    align-items: stretch !important;\n                }\n                .acu-smart-fix-diff-arrow {\n                    transform: rotate(90deg) !important;\n                }\n            }\n            .acu-btn {\n                padding: 8px 16px;\n                border-radius: 6px;\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.2s;\n                border: 1px solid transparent;\n            }\n            .acu-btn-secondary {\n                background: var(--acu-btn-bg);\n                border-color: var(--acu-border);\n                color: var(--acu-text-main);\n            }\n            .acu-btn-secondary:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-btn-primary {\n                background: var(--acu-accent);\n                color: white;\n            }\n            .acu-btn-primary:hover {\n                opacity: 0.9;\n            }\n            /*  */\n            .acu-smart-fix-rule-info {\n                padding: 10px 12px !important;\n                background: var(--acu-table-head) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-left: 3px solid var(--acu-accent) !important;\n                border-radius: 4px !important;\n                margin-bottom: 12px !important;\n            }\n            .acu-smart-fix-rule-header {\n                display: flex !important;\n                align-items: center !important;\n                gap: 8px !important;\n                font-size: 13px !important;\n                font-weight: 600 !important;\n                color: var(--acu-text-main) !important;\n                margin-bottom: 4px !important;\n            }\n            .acu-smart-fix-rule-header i {\n                color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-rule-desc {\n                font-size: 12px !important;\n                color: var(--acu-text-sub) !important;\n                line-height: 1.4 !important;\n            }\n            .acu-smart-fix-suggest-section {\n                margin-top: 12px !important;\n            }\n            .acu-smart-fix-suggest code {\n                background: var(--acu-table-head) !important;\n                padding: 2px 6px !important;\n                border-radius: 3px !important;\n                font-size: 11px !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-smart-fix-quick-btn {\n                display: inline-flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n                padding: 6px 12px !important;\n                background: var(--acu-accent) !important;\n                color: var(--acu-btn-active-text) !important;\n                border: 1px solid var(--acu-accent) !important;\n                border-radius: 4px !important;\n                font-size: 12px !important;\n                font-weight: 500 !important;\n                cursor: pointer !important;\n                transition: all 0.2s !important;\n            }\n            .acu-smart-fix-quick-btn:hover {\n                background: var(--acu-btn-active-bg) !important;\n                color: var(--acu-btn-active-text) !important;\n                border-color: var(--acu-btn-active-bg) !important;\n            }\n            .acu-smart-fix-table-summary {\n                padding: 12px !important;\n                background: var(--acu-card-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px !important;\n            }\n            .acu-smart-fix-stat {\n                font-size: 13px !important;\n                color: var(--acu-text-main) !important;\n                margin-bottom: 8px !important;\n            }\n            .acu-smart-fix-stat strong {\n                color: var(--acu-hl-manual) !important;\n            }\n            .acu-smart-fix-change-list {\n                max-height: 150px !important;\n                overflow-y: auto !important;\n                margin-top: 8px !important;\n            }\n            .acu-smart-fix-change-item {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 4px 8px !important;\n                background: var(--acu-table-head) !important;\n                border-radius: 3px !important;\n                margin-bottom: 4px !important;\n            }\n            .acu-smart-fix-hint {\n                font-size: 12px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 8px !important;\n                background: var(--acu-table-head) !important;\n                border-radius: 4px !important;\n                margin-top: 8px !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n            }\n            .acu-smart-fix-hint i {\n                color: var(--acu-accent) !important;\n            }\n            /* ==========  ========== */\n            .acu-crop-modal-overlay {\n                z-index: 2147483658;\n            }\n            .acu-crop-modal {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                width: 90%;\n                max-width: 360px;\n                overflow: hidden;\n                box-shadow: 0 20px 60px rgba(0,0,0,0.5);\n            }\n            .acu-crop-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 12px 16px;\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-accent);\n            }\n            .acu-crop-close {\n                background: none;\n                border: none;\n                color: var(--acu-text-sub);\n                font-size: 16px;\n                cursor: pointer;\n                padding: 4px;\n            }\n            .acu-crop-close:hover {\n                color: var(--acu-text-main);\n            }\n            .acu-crop-body {\n                padding: 20px;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 12px;\n            }\n            .acu-crop-container {\n                position: relative;\n                width: 200px;\n                height: 200px;\n                border-radius: 50%;\n                overflow: hidden;\n                touch-action: none;\n                user-select: none;\n            }\n            .acu-crop-image {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background-repeat: no-repeat;\n                cursor: grab;\n            }\n            .acu-crop-mask {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                border: 3px solid var(--acu-accent);\n                border-radius: 50%;\n                pointer-events: none;\n                box-shadow: 0 0 0 1000px rgba(0,0,0,0.3);\n            }\n            .acu-crop-hint {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                opacity: 0.7;\n            }\n            .acu-crop-footer {\n                display: flex;\n                gap: 10px;\n                padding: 12px 16px;\n                background: var(--acu-table-head);\n                border-top: 1px solid var(--acu-border);\n            }\n            .acu-crop-btn {\n                flex: 1;\n                padding: 10px 16px;\n                border-radius: 6px;\n                font-size: 13px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.15s;\n            }\n            .acu-crop-cancel {\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-main);\n            }\n            .acu-crop-cancel:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-crop-confirm {\n                background: var(--acu-accent);\n                border: 1px solid var(--acu-accent);\n                color: #fff;\n            }\n            .acu-crop-confirm:hover {\n                opacity: 0.9;\n            }\n            .acu-crop-reupload {\n                flex: 0 0 auto;\n                padding: 10px 14px;\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-main);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n            .acu-crop-reupload:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n            }\n    </style>\n    `;\n    $('head').append(styles);\n  };\n\n  const getTableData = () => {\n    const api = getCore().getDB();\n    if (!api || !api.exportTableAsJson) {\n      console.warn('[DICE] API ');\n      return null;\n    }\n    try {\n      const data = api.exportTableAsJson();\n      if (data) {\n        const sheetCount = Object.keys(data).filter(k => k.startsWith('sheet_')).length;\n        console.info(`[DICE] ${sheetCount} `);\n      }\n      return data;\n    } catch (e) {\n      console.error('[DICE]:', e);\n      return null;\n    }\n  };\n\n  const saveDataToDatabase = async (tableData, skipRender = false, commitDeletes = false) => {\n    if (isSaving) {\n      console.warn('[DICE]');\n      return; // \n    }\n    console.info('[DICE]...');\n    isSaving = true;\n    const { $ } = getCore();\n    const $saveBtn = $('#acu-btn-save-global');\n\n    // UI \n    if (!skipRender && $saveBtn.length) {\n      $saveBtn.find('i').removeClass('fa-save').addClass('fa-spinner fa-spin');\n      $saveBtn.prop('disabled', true);\n    }\n\n    try {\n      // 1.  sheet_  ( = )\n      const dataToSave = {};\n      //  mate \n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // 2.  ()\n      if (commitDeletes) {\n        const deletions = getPendingDeletions();\n        Object.keys(deletions).forEach(key => {\n          if (dataToSave[key] && dataToSave[key].content) {\n            deletions[key]\n              .sort((a, b) => b - a)\n              .forEach(idx => {\n                if (dataToSave[key].content[idx + 1]) dataToSave[key].content.splice(idx + 1, 1);\n              });\n          }\n        });\n        savePendingDeletions({});\n      }\n\n      // 3. \n      let jsonString;\n      try {\n        jsonString = JSON.stringify(dataToSave);\n        //  10MB \n        const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n        if (sizeInMB > 10) {\n          throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n        }\n        console.info(`[DICE]: ${sizeInMB.toFixed(2)}MB`);\n      } catch (stringifyError) {\n        console.error('[DICE]ACU JSON :', stringifyError);\n        throw new Error(`: ${stringifyError.message || stringifyError}`);\n      }\n\n      // 4.  API  ()\n      const api = getCore().getDB();\n      if (!api || !api.importTableAsJson) {\n        throw new Error(' API ');\n      }\n\n      try {\n        //  importTableAsJson saveChat()\n        //  saveChat()  \"Settings could not be saved\" \n        const result = await api.importTableAsJson(jsonString);\n        //  false \n        if (result === false) {\n          throw new Error(' false');\n        }\n        console.info('[DICE]');\n      } catch (apiError) {\n        console.error('[DICE]ACU API :', apiError);\n        //  \"Settings could not be saved\" \n        const errorMsg = apiError.message || String(apiError);\n        if (\n          errorMsg.includes('Settings could not be saved') ||\n          errorMsg.includes('server connection') ||\n          errorMsg.includes('data loss')\n        ) {\n          throw new Error('');\n        }\n        throw new Error(`: ${errorMsg}`);\n      }\n\n      // 5. \n      cachedRawData = dataToSave;\n      saveSnapshot(dataToSave);\n      hasUnsavedChanges = false;\n      currentDiffMap = new Set();\n      if (window.acuModifiedSet) window.acuModifiedSet.clear();\n      console.info('[DICE]');\n\n      if (!skipRender) {\n        renderInterface();\n      }\n    } catch (e) {\n      const errorMessage = e.message || '';\n      console.error('[DICE]:', {\n        error: e,\n        message: errorMessage,\n        stack: e.stack,\n      });\n      if (window.toastr) {\n        window.toastr.error(errorMessage, '', { timeOut: 5000 });\n      } else {\n        alert(`: ${errorMessage}`);\n      }\n      // \n      throw e;\n    } finally {\n      isSaving = false;\n      console.info('[DICE]');\n      if (!skipRender && $saveBtn.length) {\n        $saveBtn.find('i').removeClass('fa-spinner fa-spin').addClass('fa-save');\n        $saveBtn.prop('disabled', false);\n      }\n    }\n  };\n\n  // [] \n  const saveDataOnly = async tableData => {\n    try {\n      const dataToSave = {};\n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // \n      let jsonString;\n      try {\n        jsonString = JSON.stringify(dataToSave);\n        //  10MB \n        const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n        if (sizeInMB > 10) {\n          throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n        }\n      } catch (stringifyError) {\n        console.error('[DICE]ACU JSON :', stringifyError);\n        throw new Error(`: ${stringifyError.message || stringifyError}`);\n      }\n\n      const api = getCore().getDB();\n      if (!api || !api.importTableAsJson) {\n        throw new Error(' API ');\n      }\n\n      try {\n        //  importTableAsJson saveChat()\n        const result = await api.importTableAsJson(jsonString);\n        //  false \n        if (result === false) {\n          throw new Error(' false');\n        }\n      } catch (apiError) {\n        console.error('[DICE]ACU API :', apiError);\n        //  \"Settings could not be saved\" \n        const errorMsg = apiError.message || String(apiError);\n        if (\n          errorMsg.includes('Settings could not be saved') ||\n          errorMsg.includes('server connection') ||\n          errorMsg.includes('data loss')\n        ) {\n          throw new Error('');\n        }\n        throw new Error(`: ${errorMsg}`);\n      }\n\n      cachedRawData = dataToSave;\n      //  saveSnapshot() hasUnsavedChanges\n    } catch (e) {\n      console.error('[DICE]ACU saveDataOnly error:', e);\n      // \n      throw e;\n    }\n  };\n  const processJsonData = json => {\n    const tables = {};\n    if (!json || typeof json !== 'object') return tables;\n    for (const sheetId in json) {\n      if (json[sheetId]?.name) {\n        const sheet = json[sheetId];\n        tables[sheet.name] = {\n          key: sheetId,\n          headers: sheet.content ? sheet.content[0] || [] : [],\n          rows: sheet.content ? sheet.content.slice(1) : [],\n          rawContent: sheet.content || [],\n          exportConfig: sheet.exportConfig || {},\n          updateConfig: sheet.updateConfig || {},\n          ...sheet,\n        };\n      }\n    }\n    return tables;\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function suggestFormatValue(pattern, rowIndex, existingValues = [], tableContent = null) {\n    if (!pattern || rowIndex === undefined || rowIndex < 0) return null;\n\n    try {\n      //  \"+\"  ^AM\\d{3}$\n      // pattern  JavaScript  '^AM\\\\d{3}$' '^AM\\d{3}$'\n      //  \\d{3} /\\\\d\\{3\\}/+d\n      // ^?[]+\\d\\{\\}$?\n      const prefixMatch = pattern.match(/^\\^?([A-Za-z]+)\\\\d\\{(\\d+)\\}\\$?$/);\n\n      if (prefixMatch) {\n        const prefix = prefixMatch[1]; // \"AM\"\n        const digits = parseInt(prefixMatch[2], 10); // 3\n\n        // \n        if (tableContent && (tableContent.name === '' || tableContent.name === '')) {\n          const headers = tableContent.content?.[0] || [];\n          const rows = tableContent.content?.slice(1) || [];\n          const codeIndex = headers.indexOf('');\n\n          if (codeIndex >= 0) {\n            // \n            const existingNumbers = [];\n            rows.forEach(row => {\n              const codeValue = row?.[codeIndex];\n              if (codeValue && typeof codeValue === 'string') {\n                const match = codeValue.match(new RegExp(`^${prefix}(\\\\d+)$`));\n                if (match) {\n                  const num = parseInt(match[1], 10);\n                  if (!isNaN(num)) existingNumbers.push(num);\n                }\n              }\n            });\n\n            // \n            const maxNum = existingNumbers.length > 0 ? Math.max(...existingNumbers) : 0;\n            const nextNum = String(maxNum + 1).padStart(digits, '0');\n            return prefix + nextNum;\n          }\n        }\n\n        // \n        const nextNum = String(rowIndex + 1).padStart(digits, '0');\n        return prefix + nextNum;\n      }\n\n      //  \\d{3} \n      const numOnlyMatch = pattern.match(/^\\^?\\\\d\\{(\\d+)\\}\\$?$/);\n      if (numOnlyMatch) {\n        const digits = parseInt(numOnlyMatch[1], 10);\n        return String(rowIndex + 1).padStart(digits, '0');\n      }\n    } catch (e) {\n      console.error('[DICE]ACU :', e);\n    }\n\n    return null; // \n  }\n\n  //  OR \n  function getRelationOptions(refTable, refColumns, rawData) {\n    const options = new Set();\n    if (!refTable || !refColumns || !rawData) return Array.from(options);\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        columns.forEach(col => {\n          const colIdx = headers.indexOf(col);\n          if (colIdx >= 0) {\n            rows.forEach(row => {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                options.add(String(value).trim());\n              }\n            });\n          }\n        });\n\n        break; // \n      }\n    }\n\n    return Array.from(options).sort();\n  }\n\n  // \n  function isValueInRelationTable(value, refTable, refColumns, rawData) {\n    if (!value || !refTable || !refColumns || !rawData) return false;\n    if (String(value).trim() === '') return false;\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n    const strVal = String(value).trim();\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        for (const col of columns) {\n          const colIdx = headers.indexOf(col);\n          if (colIdx === -1) continue;\n\n          // \n          for (let i = 0; i < rows.length; i++) {\n            const cellValue = rows[i]?.[colIdx];\n            if (cellValue !== null && cellValue !== undefined && String(cellValue).trim() === strVal) {\n              return true; // \n            }\n          }\n        }\n\n        break; // \n      }\n    }\n\n    return false; // \n  }\n\n  //  required \n  function getColumnExamples(tableName, columnName, currentRowIndex, rawData, maxCount = 5) {\n    const examples = new Set();\n    if (!tableName || !columnName || !rawData) return [];\n\n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === tableName) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n        const colIdx = headers.indexOf(columnName);\n\n        if (colIdx >= 0) {\n          rows.forEach((row, idx) => {\n            if (idx !== currentRowIndex) {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                examples.add(String(value).trim());\n              }\n            }\n          });\n        }\n        break;\n      }\n    }\n\n    return Array.from(examples).slice(0, maxCount);\n  }\n\n  // \n  function getNearestValidNumber(currentValue, min, max) {\n    const num = parseFloat(currentValue);\n    if (isNaN(num)) return min !== undefined ? min : 0;\n    if (min !== undefined && num < min) return min;\n    if (max !== undefined && num > max) return max;\n    return num;\n  }\n\n  // ========================================\n  // []  - \n  // ========================================\n  const refreshRegexRulesList = () => {\n    const { $ } = getCore();\n    const dialog = $('.acu-settings-dialog');\n    if (!dialog.length) return;\n\n    const $rulesList = dialog.find('#regex-rules-list');\n    if (!$rulesList.length) return;\n\n    // HTML\n    const rules = RegexTransformationManager.getAllRules();\n    const html = rules\n      .map(rule => {\n        const scopeIcon =\n          rule.scope.type === 'global' ? 'fa-globe' : rule.scope.type === 'table' ? 'fa-table' : 'fa-columns';\n        const scopeText =\n          rule.scope.type === 'global'\n            ? ''\n            : rule.scope.type === 'table'\n              ? rule.scope.tableNames?.join(',')\n              : `${rule.scope.tableNames?.join(',')}.${rule.scope.columnNames?.join(',')}`;\n        return `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n              <div class=\"acu-rule-type-icon\" title=\": ${escapeHtml(rule.scope.type)}\">\n                  <i class=\"fa-solid ${scopeIcon}\"></i>\n              </div>\n              <div class=\"acu-rule-info\">\n                  <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                  <div class=\"acu-rule-target\" style=\"font-size:10px;\">${escapeHtml(scopeText)} | ${escapeHtml(rule.operation)}</div>\n              </div>\n              <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n              <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                  <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n              </div>\n              <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n      `;\n      })\n      .join('');\n\n    // HTML,\n    $rulesList.html(html);\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showAddValidationRuleModal = parentDialog => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const tables = processJsonData(rawData || {});\n    const tableNames = Object.keys(tables);\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-dice-cfg-header\">\n            <span><i class=\"fa-solid fa-plus\"></i> </span>\n            <button class=\"acu-config-close\" id=\"dlg-rule-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-table\" class=\"acu-setting-select\">\n                <option value=\"\">...</option>\n                ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"row-column\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-column\" class=\"acu-setting-select\" disabled>\n                <option value=\"\">...</option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-type\" class=\"acu-setting-select\">\n                <optgroup label=\"  \">\n                  <option value=\"tableReadonly\"></option>\n                  <option value=\"rowLimit\"></option>\n                  <option value=\"sequence\"></option>\n                </optgroup>\n                <optgroup label=\"  \">\n                  <option value=\"required\"></option>\n                  <option value=\"format\"></option>\n                  <option value=\"enum\"></option>\n                  <option value=\"numeric\"></option>\n                  <option value=\"relation\"></option>\n                  <option value=\"keyValue\"></option>\n                </optgroup>\n              </select>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-tableReadonly\">\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ,\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-rowLimit\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-max\" class=\"acu-panel-input\" placeholder=\"\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-sequence\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-sequence-prefix\" class=\"acu-panel-input\" placeholder=\"AM\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-sequence-start\" class=\"acu-panel-input\" placeholder=\"1\" value=\"1\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-sequence-paired-table\" class=\"acu-setting-select\" style=\"flex:1;\">\n                  <option value=\"\"></option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> \"+\"(AM0001, AM0002, AM0003...),<br>\n                <i class=\"fa-solid fa-link\" style=\"margin-top:4px;display:block;color:var(--acu-warning-icon);margin-right:6px;\"></i> ,,\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-required\" style=\"display:none;\">\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-format\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-pattern\" class=\"acu-panel-input\" placeholder=\"^AM\\\\d{3}$\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-enum\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-values\" class=\"acu-panel-input\" placeholder=\",,\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-numeric\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-relation\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-table\" class=\"acu-setting-select\">\n                  <option value=\"\">...</option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-column\" class=\"acu-setting-select\" multiple style=\"flex:1;min-height:80px;\">\n                  <option value=\"\">...</option>\n                </select>\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ,(OR ) Ctrl/Cmd \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-keyValue\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-keyvalue-type\" class=\"acu-setting-select\">\n                  <option value=\"text\"></option>\n                  <option value=\"numeric\"></option>\n                </select>\n              </div>\n              <div class=\"acu-setting-row\" id=\"row-keyvalue-range\" style=\"display:none;\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ::;:(,)\n              </div>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-error-msg\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n          </div>\n          <div class=\"acu-dice-cfg-actions\">\n            <button id=\"dlg-rule-cancel\"></button>\n            <button id=\"dlg-rule-save\"></button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // select\n    const updateSelectColor = $select => {\n      const val = $select.val();\n      if (!val || val === '') {\n        $select.css('color', 'var(--acu-text-sub)');\n        $select.css('opacity', '0.7');\n      } else {\n        $select.css('color', 'var(--acu-text-main)');\n        $select.css('opacity', '1');\n      }\n    };\n\n    // select\n    dialog.find('select').each(function () {\n      updateSelectColor($(this));\n      $(this).on('change', function () {\n        updateSelectColor($(this));\n      });\n    });\n\n    // \n    dialog.find('#rule-table').on('change', function () {\n      const tableName = $(this).val();\n      const $colSelect = dialog.find('#rule-column');\n      const $pairedTableSelect = dialog.find('#cfg-sequence-paired-table');\n      updateSelectColor($(this));\n\n      // \n      if ($pairedTableSelect.length > 0) {\n        const currentPairedValue = $pairedTableSelect.val();\n        $pairedTableSelect.empty();\n        $pairedTableSelect.append('<option value=\"\"></option>');\n        tableNames\n          .filter(name => name !== tableName)\n          .forEach(name => {\n            $pairedTableSelect.append(`<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`);\n          });\n        // \n        if (currentPairedValue && currentPairedValue !== tableName) {\n          $pairedTableSelect.val(currentPairedValue);\n        }\n        updateSelectColor($pairedTableSelect);\n      }\n\n      if (!tableName || !tables[tableName]) {\n        $colSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($colSelect);\n        return;\n      }\n\n      const headers = tables[tableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $colSelect.html('<option value=\"\">...</option>' + options).prop('disabled', false);\n      updateSelectColor($colSelect);\n    });\n\n    // \n    dialog.find('#cfg-ref-table').on('change', function () {\n      const refTableName = $(this).val();\n      const $refColSelect = dialog.find('#cfg-ref-column');\n      updateSelectColor($(this));\n\n      if (!refTableName || !tables[refTableName]) {\n        $refColSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($refColSelect);\n        return;\n      }\n\n      const headers = tables[refTableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $refColSelect.html(options).prop('disabled', false);\n      updateSelectColor($refColSelect);\n    });\n\n    // \n    dialog.find('#rule-type').on('change', function () {\n      const type = $(this).val();\n      const typeInfo = RULE_TYPE_INFO[type];\n      const isTableRule = typeInfo?.scope === 'table';\n      updateSelectColor($(this));\n\n      // \n      dialog.find('.acu-rule-config-section').hide();\n      dialog.find('#config-' + type).show();\n\n      // sequence\n      if (isTableRule && type !== 'sequence') {\n        dialog.find('#row-column').hide();\n        dialog.find('#rule-column').val('').prop('disabled', true);\n      } else {\n        dialog.find('#row-column').show();\n        // \n        if (dialog.find('#rule-table').val()) {\n          dialog.find('#rule-column').prop('disabled', false);\n        }\n      }\n    });\n\n    // /\n    dialog.find('#cfg-keyvalue-type').on('change', function () {\n      const valueType = $(this).val();\n      if (valueType === 'numeric') {\n        dialog.find('#row-keyvalue-range').show();\n      } else {\n        dialog.find('#row-keyvalue-range').hide();\n      }\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#dlg-rule-close, #dlg-rule-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#dlg-rule-save').on('click', function () {\n      const name = dialog.find('#rule-name').val()?.trim();\n      const targetTable = dialog.find('#rule-table').val();\n      const targetColumn = dialog.find('#rule-column').val();\n      const ruleType = dialog.find('#rule-type').val();\n      const errorMessage = dialog.find('#rule-error-msg').val()?.trim();\n      const typeInfo = RULE_TYPE_INFO[ruleType];\n      const isTableRule = typeInfo?.scope === 'table';\n\n      // \n      if (!name) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!targetTable) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      // sequence\n      if ((!isTableRule || ruleType === 'sequence') && !targetColumn) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      const ruleConfig = {};\n      if (ruleType === 'tableReadonly') {\n        // \n      } else if (ruleType === 'rowLimit') {\n        const min = dialog.find('#cfg-row-min').val();\n        const max = dialog.find('#cfg-row-max').val();\n        if (min !== '') ruleConfig.min = parseInt(min, 10);\n        if (max !== '') ruleConfig.max = parseInt(max, 10);\n      } else if (ruleType === 'required') {\n        // \n      } else if (ruleType === 'format') {\n        const pattern = dialog.find('#cfg-pattern').val()?.trim();\n        if (!pattern) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        // \n        try {\n          new RegExp(pattern);\n        } catch (e) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n        ruleConfig.pattern = pattern;\n      } else if (ruleType === 'enum') {\n        const valuesStr = dialog.find('#cfg-values').val()?.trim();\n        if (!valuesStr) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        ruleConfig.values = valuesStr\n          .split(',')\n          .map(v => v.trim())\n          .filter(v => v);\n      } else if (ruleType === 'numeric') {\n        const min = dialog.find('#cfg-min').val();\n        const max = dialog.find('#cfg-max').val();\n        if (min !== '') ruleConfig.min = parseFloat(min);\n        if (max !== '') ruleConfig.max = parseFloat(max);\n      } else if (ruleType === 'relation') {\n        const refTable = dialog.find('#cfg-ref-table').val();\n        const refColumns = dialog.find('#cfg-ref-column').val(); // \n\n        if (!refTable) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        const selectedColumns = Array.isArray(refColumns) ? refColumns : refColumns ? [refColumns] : [];\n        if (selectedColumns.length === 0 || (selectedColumns.length === 1 && !selectedColumns[0])) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        ruleConfig.refTable = refTable;\n        // \n        ruleConfig.refColumn = selectedColumns.length === 1 ? selectedColumns[0] : selectedColumns;\n      } else if (ruleType === 'keyValue') {\n        const valueType = dialog.find('#cfg-keyvalue-type').val();\n        ruleConfig.valueType = valueType || 'text';\n\n        if (valueType === 'numeric') {\n          const min = dialog.find('#cfg-keyvalue-min').val();\n          const max = dialog.find('#cfg-keyvalue-max').val();\n          if (min !== '') ruleConfig.valueMin = parseFloat(min);\n          if (max !== '') ruleConfig.valueMax = parseFloat(max);\n        }\n      } else if (ruleType === 'sequence') {\n        const prefix = dialog.find('#cfg-sequence-prefix').val()?.trim() || '';\n        const startFrom = dialog.find('#cfg-sequence-start').val();\n        const pairedTable = dialog.find('#cfg-sequence-paired-table').val()?.trim() || null;\n        ruleConfig.prefix = prefix;\n        ruleConfig.startFrom = startFrom !== '' ? parseInt(startFrom, 10) : 1;\n        if (isNaN(ruleConfig.startFrom)) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        if (pairedTable) {\n          ruleConfig.pairedTable = pairedTable;\n        }\n      }\n\n      //  ID\n      const ruleId = 'custom_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);\n\n      // \n      const newRule = {\n        id: ruleId,\n        name: name,\n        description: '',\n        targetTable: targetTable,\n        targetColumn: isTableRule && ruleType !== 'sequence' ? '' : targetColumn, //  targetColumnsequence\n        ruleType: ruleType,\n        config: ruleConfig,\n        errorMessage: errorMessage || typeInfo?.desc || '',\n        intercept: false, // \n      };\n\n      if (ValidationRuleManager.addCustomRule(newRule)) {\n        closeDialog();\n\n        // \n        const $rulesList = parentDialog.find('#validation-rules-list');\n        const ruleHtml = `\n          <div class=\"acu-validation-rule-item\" data-rule-id=\"${escapeHtml(ruleId)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo?.name || ruleType)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo?.icon || 'fa-question'}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(targetTable)}${isTableRule && ruleType !== 'sequence' ? ' ()' : '.' + escapeHtml(targetColumn)}</div>\n            </div>\n            <div class=\"acu-rule-intercept\" data-rule-id=\"${escapeHtml(ruleId)}\" title=\"\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <div class=\"acu-rule-toggle active\" title=\"/\">\n              <i class=\"fa-solid fa-toggle-on\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(ruleId)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n        `;\n        $rulesList.append(ruleHtml);\n        // \n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showSmartFixModal = error => {\n    if (!error || !error.rule) {\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const rule = error.rule;\n    const ruleType = error.ruleType || rule.ruleType;\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n    const isTableRule = typeInfo?.scope === 'table';\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const snapshot = loadSnapshot();\n\n    //  rowTitle\n    if (!error.rowTitle && error.rowIndex >= 0 && rawData && error.tableName) {\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          const row = rawData[sheetId].content?.[error.rowIndex + 1];\n          if (row) {\n            error.rowTitle = row[1] || row[0] || ` ${error.rowIndex + 1}`;\n          }\n          break;\n        }\n      }\n    }\n\n    // \n    let snapshotValue = '';\n    if (!isTableRule && snapshot && error.tableName && error.columnName !== undefined) {\n      for (const sheetId in snapshot) {\n        if (snapshot[sheetId]?.name === error.tableName) {\n          const headers = snapshot[sheetId].content?.[0] || [];\n          const colIdx = headers.indexOf(error.columnName);\n          const rowIdx = error.rowIndex + 1;\n          if (colIdx >= 0 && snapshot[sheetId].content?.[rowIdx]) {\n            snapshotValue = snapshot[sheetId].content[rowIdx][colIdx] ?? '';\n          }\n          break;\n        }\n      }\n    }\n\n    const hasSnapshotValue = snapshotValue !== '' && String(snapshotValue) !== String(error.currentValue || '');\n\n    // ========================================\n    // \n    // ========================================\n    if (isTableRule) {\n      showTableRuleFixModal(error, rule, ruleType, rawData, snapshot, currentThemeClass);\n      return;\n    }\n\n    // ========================================\n    // \n    // ========================================\n\n    // UI\n    let inputHtml = '';\n\n    if (ruleType === 'enum' && rule.config?.values) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'numeric') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'keyValue') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else {\n      // \n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    }\n\n    // \n    let smartSuggestHtml = '';\n\n    if (ruleType === 'required') {\n      // \n      const examples = getColumnExamples(error.tableName, error.columnName, error.rowIndex, rawData, 5);\n      if (examples.length > 0) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            <div class=\"acu-smart-fix-suggest-label\">\n              <i class=\"fa-solid fa-lightbulb\"></i> :\n            </div>\n            <div class=\"acu-smart-fix-suggest-options\">\n              ${examples\n                .map(\n                  val => `\n                <span class=\"acu-smart-fix-option\" data-value=\"${escapeHtml(val)}\" title=\"\">\n                  ${escapeHtml(val.length > 20 ? val.substring(0, 20) + '...' : val)}\n                </span>\n              `,\n                )\n                .join('')}\n            </div>\n          </div>\n        `;\n      }\n    } else if (ruleType === 'enum' && rule.config?.values) {\n      // \n      const validValues = rule.config.values;\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-list\"></i>  ():\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\">\n            ${validValues\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        </div>\n      `;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      // \n      // \n      let tableContent = null;\n      if (rawData && error.tableName) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            tableContent = rawData[sheetId];\n            break;\n          }\n        }\n      }\n      const suggestedValue = suggestFormatValue(rule.config.pattern, error.rowIndex, [], tableContent);\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-font\"></i> : <code>${escapeHtml(rule.config.pattern)}</code>\n          </div>\n          ${\n            suggestedValue\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:4px;display:block;\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </span>\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(suggestedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> ${escapeHtml(suggestedValue)}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'numeric') {\n      // \n      const min = rule.config?.min;\n      const max = rule.config?.max;\n      const currentNum = parseFloat(error.currentValue);\n      const isOutOfRange =\n        !isNaN(currentNum) && ((min !== undefined && currentNum < min) || (max !== undefined && currentNum > max));\n      const nearestValid = isOutOfRange ? getNearestValidNumber(error.currentValue, min, max) : null;\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-hashtag\"></i> : ${min !== undefined ? min : '-'} ~ ${max !== undefined ? max : '+'}\n          </div>\n          ${\n            isOutOfRange && nearestValid !== null\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${nearestValid}\">\n                <i class=\"fa-solid fa-arrow-right\"></i>  ${nearestValid}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      // \n      const options = getRelationOptions(rule.config.refTable, rule.config.refColumn, rawData);\n      const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n      const hasMultipleColumns = refColumns.length > 1;\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      const valueExists = isValueInRelationTable(\n        currentInvalidValue,\n        rule.config.refTable,\n        rule.config.refColumn,\n        rawData,\n      );\n\n      // HTML\n      let optionsHtml = '';\n      if (options.length > 0) {\n        optionsHtml = `\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-link\"></i>  \"${escapeHtml(rule.config.refTable)}\"  (${options.length}):\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\" id=\"smart-fix-options-container\">\n            ${options\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      // \n      let reverseWriteHtml = '';\n      if (currentInvalidValue && !valueExists) {\n        if (hasMultipleColumns) {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <select id=\"smart-fix-reverse-column\" class=\"acu-edit-select\" style=\"width:100%;margin-bottom:8px;\">\n                  ${refColumns.map(col => `<option value=\"${escapeHtml(col)}\">${escapeHtml(col)}</option>`).join('')}\n                </select>\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}\"\n                </button>\n              </div>\n            </div>\n          `;\n        } else {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" data-column=\"${escapeHtml(refColumns[0])}\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}.${escapeHtml(refColumns[0])}\"\n                </button>\n              </div>\n            </div>\n          `;\n        }\n      }\n\n      if (optionsHtml || reverseWriteHtml) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            ${optionsHtml}\n            ${reverseWriteHtml}\n          </div>\n        `;\n      }\n    } else if (ruleType === 'keyValue') {\n      // \n      const valueType = rule.config?.valueType || 'text';\n      const valueMin = rule.config?.valueMin;\n      const valueMax = rule.config?.valueMax;\n\n      // \n      let processedValue = String(error.currentValue || '');\n      processedValue = processedValue.replace(//g, ':').replace(//g, ';').replace(//g, ';').replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n      const issues = [];\n      const fixedPairs = [];\n\n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          issues.push({ pair, error: '/' });\n          continue;\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) {\n          issues.push({ pair, error: '' });\n          continue;\n        }\n\n        let fixedVal = val;\n        let hasIssue = false;\n\n        if (valueType === 'numeric') {\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) {\n            issues.push({ pair, error: `\"${val}\" ` });\n            hasIssue = true;\n          } else {\n            if (valueMin !== undefined && valueMin !== null && numVal < valueMin) {\n              fixedVal = String(valueMin);\n              issues.push({ pair, error: ` ${numVal}  ${valueMin}` });\n              hasIssue = true;\n            } else if (valueMax !== undefined && valueMax !== null && numVal > valueMax) {\n              fixedVal = String(valueMax);\n              issues.push({ pair, error: ` ${numVal}  ${valueMax}` });\n              hasIssue = true;\n            }\n          }\n        }\n\n        fixedPairs.push({ key, val: fixedVal, originalVal: val, hasIssue });\n      }\n\n      // \n      const fixedValue = fixedPairs.map(p => `${p.key}:${p.val}`).join(';');\n      const hasIssues = issues.length > 0 || fixedPairs.some(p => p.hasIssue);\n\n      let issuesHtml = '';\n      if (hasIssues) {\n        issuesHtml = `\n          <div class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:8px;\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i> :\n          </div>\n          <div style=\"margin-bottom:8px;\">\n            ${issues\n              .map(\n                issue => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(issue.pair)} - ${escapeHtml(issue.error)}\n              </div>\n            `,\n              )\n              .join('')}\n            ${fixedPairs\n              .filter(p => p.hasIssue)\n              .map(\n                p => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(p.key)}:${escapeHtml(p.originalVal)}  ${escapeHtml(p.val)}\n              </div>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-key\"></i> : :;:\n          </div>\n          ${\n            valueType === 'numeric'\n              ? `\n            <div class=\"acu-smart-fix-suggest-label\" style=\"margin-top:8px;\">\n              <i class=\"fa-solid fa-hashtag\"></i> : ${valueMin !== undefined ? valueMin : '-'} ~ ${valueMax !== undefined ? valueMax : '+'}\n            </div>\n          `\n              : ''\n          }\n          ${issuesHtml}\n          ${\n            hasIssues\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(fixedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> \n              </span>\n            </div>\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-card-bg);border-radius:4px;font-size:11px;color:var(--acu-text-sub);\">\n              <div style=\"margin-bottom:4px;\"><strong>:</strong></div>\n              <code style=\"color:var(--acu-success-text);\">${escapeHtml(fixedValue)}</code>\n            </div>\n          `\n              : `\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-success-bg);border-radius:4px;font-size:11px;color:var(--acu-success-text);\">\n              <i class=\"fa-solid fa-check-circle\"></i> \n            </div>\n          `\n          }\n        </div>\n      `;\n    }\n\n    // HTML\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} - ${escapeHtml(error.columnName || '')}</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            <!--  -->\n            <div class=\"acu-smart-fix-rule-info\">\n              <div class=\"acu-smart-fix-rule-header\">\n                <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                <span>${escapeHtml(error.ruleName || rule.name || '')}</span>\n              </div>\n              <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || typeInfo.desc || '')}</div>\n            </div>\n\n            <!--  -->\n            ${\n              hasSnapshotValue\n                ? `\n              <div class=\"acu-diff-section acu-diff-old-section\">\n                <div class=\"acu-diff-label\">\n                  <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                </div>\n                <div class=\"acu-diff-readonly\">${escapeHtml(snapshotValue)}</div>\n              </div>\n              <div class=\"acu-diff-arrow-down\"><i class=\"fa-solid fa-arrow-down\"></i></div>\n            `\n                : ''\n            }\n\n            <!--  -->\n            <div class=\"acu-diff-section acu-diff-new-section\">\n              ${\n                error.rowTitle && error.rowIndex >= 0\n                  ? `<div style=\"font-size:12px;color:var(--acu-text-sub);margin-bottom:8px;padding:4px 8px;background:var(--acu-bg-sub);border-radius:4px;\">\n                <i class=\"fa-solid fa-tag\" style=\"margin-right:4px;\"></i>${escapeHtml(error.rowTitle)}\n              </div>`\n                  : ''\n              }\n              <div class=\"acu-diff-label\">\n                <i class=\"fa-solid fa-pen\"></i> \n              </div>\n              ${inputHtml}\n            </div>\n\n            <!--  -->\n            ${\n              smartSuggestHtml\n                ? `\n              <div class=\"acu-smart-fix-suggest-section\">\n                ${smartSuggestHtml}\n              </div>\n            `\n                : ''\n            }\n          </div>\n          <div class=\"acu-dialog-btns\">\n            <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n            ${hasSnapshotValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n            <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    dialog.on('click', '.acu-smart-fix-option, .acu-smart-fix-quick-btn', function () {\n      // \n      if ($(this).attr('id') === 'smart-fix-reverse-write-btn') return;\n      if ($(this).hasClass('acu-smart-fix-option-current')) return;\n      const optionValue = $(this).data('value') || $(this).text().trim();\n      dialog.find('#smart-fix-value').val(optionValue).trigger('input');\n    });\n\n    // \n    dialog.on('click', '#smart-fix-reverse-write-btn', async function () {\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      if (!currentInvalidValue) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      let targetColumn;\n      if (ruleType === 'relation' && rule.config?.refColumn) {\n        const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n        if (refColumns.length > 1) {\n          // \n          targetColumn = dialog.find('#smart-fix-reverse-column').val();\n        } else {\n          // data\n          targetColumn = $(this).data('column') || refColumns[0];\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      if (!targetColumn || !rule.config?.refTable) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      try {\n        const rawData = cachedRawData || getTableData();\n        let refSheet = null;\n        let refSheetId = null;\n\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === rule.config.refTable) {\n            refSheet = rawData[sheetId];\n            refSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!refSheet || !refSheet.content) {\n          if (window.toastr) window.toastr.error(` \"${rule.config.refTable}\"`);\n          return;\n        }\n\n        const headers = refSheet.content[0] || [];\n        const targetColIdx = headers.indexOf(targetColumn);\n\n        if (targetColIdx === -1) {\n          if (window.toastr) window.toastr.error(` \"${targetColumn}\"`);\n          return;\n        }\n\n        // \n        const newRow = new Array(headers.length).fill('');\n        newRow[targetColIdx] = currentInvalidValue;\n\n        // \n        refSheet.content.push(newRow);\n\n        // \n        await saveDataToDatabase(rawData, false, false);\n\n        // \n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-revert', function () {\n      dialog.find('#smart-fix-value').val(snapshotValue);\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-close, #smart-fix-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#smart-fix-confirm').on('click', async function () {\n      const newValue = dialog.find('#smart-fix-value').val()?.trim() || '';\n\n      if (newValue === '' && ruleType === 'required') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      try {\n        const rawData = cachedRawData || getTableData();\n        let updated = false;\n\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            const sheet = rawData[sheetId];\n            const headers = sheet.content?.[0] || [];\n\n            if (error.rowIndex >= 0 && error.columnName) {\n              const colIdx = headers.indexOf(error.columnName);\n              const rowIdx = error.rowIndex + 1;\n\n              if (colIdx >= 0 && sheet.content && sheet.content[rowIdx]) {\n                sheet.content[rowIdx][colIdx] = newValue;\n                updated = true;\n                break;\n              }\n            }\n          }\n        }\n\n        if (updated) {\n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function extractCodesFromTable(sheet, columnName, prefix) {\n    if (!sheet || !sheet.content || sheet.content.length < 2) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const headers = sheet.content[0] || [];\n    const rows = sheet.content.slice(1) || [];\n    const colIndex = headers.indexOf(columnName);\n\n    if (colIndex < 0) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const codes = new Map(); // Map<, >\n    const allCodes = new Set(); // Set<>\n    const codeToRows = new Map(); // Map<, >\n\n    for (let i = 0; i < rows.length; i++) {\n      const value = rows[i]?.[colIndex];\n      if (value === null || value === undefined || value === '') continue;\n\n      const strValue = String(value).trim();\n      if (!strValue) continue;\n\n      // \n      let isValid = false;\n      if (prefix) {\n        const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          isValid = true;\n        }\n      } else {\n        const num = parseInt(strValue, 10);\n        if (!isNaN(num)) {\n          isValid = true;\n        }\n      }\n\n      if (isValid) {\n        allCodes.add(strValue);\n        if (!codeToRows.has(strValue)) {\n          codeToRows.set(strValue, []);\n        }\n        codeToRows.get(strValue).push(i);\n      }\n    }\n\n    return { codes, allCodes, codeToRows };\n  }\n\n  //   \n  function buildCodeMapping(codes1, codes2, prefix, startFrom) {\n    // \n    const allUniqueCodes = new Set([...codes1, ...codes2]);\n\n    // \n    const codeNumbers = [];\n    for (const code of allUniqueCodes) {\n      let num = null;\n      if (prefix) {\n        const match = code.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          num = parseInt(match[1], 10);\n        }\n      } else {\n        num = parseInt(code, 10);\n      }\n\n      if (!isNaN(num)) {\n        codeNumbers.push({ code, num });\n      }\n    }\n\n    // \n    codeNumbers.sort((a, b) => a.num - b.num);\n\n    //   \n    const mapping = new Map();\n    for (let i = 0; i < codeNumbers.length; i++) {\n      const oldCode = codeNumbers[i].code;\n      const newNum = startFrom + i;\n      const newCode = prefix + String(newNum).padStart(4, '0');\n      mapping.set(oldCode, newCode);\n    }\n\n    return mapping;\n  }\n\n  // \n  // \n  // 1. \n  // 2. \n  // 3. \n  function alignAndFixPairedTables(\n    table1Sheet,\n    table1SheetId,\n    table2Sheet,\n    table2SheetId,\n    columnName,\n    mapping,\n    prefix,\n    startFrom,\n    rawData,\n  ) {\n    if (!table1Sheet || !table2Sheet) return { fixedCount1: 0, fixedCount2: 0 };\n\n    const headers1 = table1Sheet.content[0] || [];\n    const rows1 = table1Sheet.content.slice(1) || [];\n    const colIndex1 = headers1.indexOf(columnName);\n\n    const headers2 = table2Sheet.content[0] || [];\n    const rows2 = table2Sheet.content.slice(1) || [];\n    const colIndex2 = headers2.indexOf(columnName);\n\n    if (colIndex1 < 0 || colIndex2 < 0) return { fixedCount1: 0, fixedCount2: 0 };\n\n    let fixedCount1 = 0;\n    let fixedCount2 = 0;\n\n    //  -> \n    const reverseMapping = new Map();\n    for (const [oldCode, newCode] of mapping.entries()) {\n      reverseMapping.set(newCode, oldCode);\n    }\n\n    // \n    const sortedNewCodes = Array.from(mapping.values()).sort((a, b) => {\n      const numA = parseInt(a.replace(prefix, ''), 10);\n      const numB = parseInt(b.replace(prefix, ''), 10);\n      return numA - numB;\n    });\n\n    // \n    const analyzeTable = (rows, colIndex) => {\n      const codeRows = []; // {rowIndex, oldCode, row}\n      const emptyRows = []; // {rowIndex, row, prevOldCode, nextOldCode}\n\n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        const strValue = value === null || value === undefined ? '' : String(value).trim();\n\n        // \n        let isValid = false;\n        if (strValue && prefix) {\n          const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          if (match) isValid = true;\n        } else if (strValue) {\n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) isValid = true;\n        }\n\n        if (isValid) {\n          codeRows.push({ rowIndex: i, oldCode: strValue, row: rows[i] });\n        } else {\n          emptyRows.push({ rowIndex: i, row: rows[i], prevOldCode: null, nextOldCode: null });\n        }\n      }\n\n      // \n      for (const emptyRow of emptyRows) {\n        let prevCode = null;\n        let nextCode = null;\n\n        for (const codeRow of codeRows) {\n          if (codeRow.rowIndex < emptyRow.rowIndex) {\n            prevCode = codeRow.oldCode;\n          }\n          if (codeRow.rowIndex > emptyRow.rowIndex && nextCode === null) {\n            nextCode = codeRow.oldCode;\n            break;\n          }\n        }\n\n        emptyRow.prevOldCode = prevCode;\n        emptyRow.nextOldCode = nextCode;\n      }\n\n      return { codeRows, emptyRows };\n    };\n\n    const analysis1 = analyzeTable(rows1, colIndex1);\n    const analysis2 = analyzeTable(rows2, colIndex2);\n\n    // \n    const buildNewRows = (analysis, headers, colIndex, allOldCodes) => {\n      const newRows = [];\n      const codeRowMap = new Map(); // oldCode -> row data\n\n      // \n      for (const cr of analysis.codeRows) {\n        codeRowMap.set(cr.oldCode, cr.row);\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n\n        if (codeRowMap.has(oldCode)) {\n          // \n          const oldRow = codeRowMap.get(oldCode);\n          const newRow = oldRow.map(cell => cell);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true });\n        } else {\n          // \n          const newRow = new Array(headers.length).fill(null);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true, isInserted: true });\n        }\n      }\n\n      // \n      //  prevOldCode  nextOldCode \n      const result = [];\n      let codeRowIndex = 0;\n\n      // \n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode === null && emptyRow.nextOldCode !== null) {\n          // \n          const nextNewCode = mapping.get(emptyRow.nextOldCode);\n          // \n          while (codeRowIndex < newRows.length && newRows[codeRowIndex].newCode !== nextNewCode) {\n            result.push(newRows[codeRowIndex].row);\n            codeRowIndex++;\n          }\n          result.push(emptyRow.row);\n        } else if (emptyRow.prevOldCode === null && emptyRow.nextOldCode === null) {\n          // \n          result.push(emptyRow.row);\n        }\n      }\n\n      // \n      for (; codeRowIndex < newRows.length; codeRowIndex++) {\n        result.push(newRows[codeRowIndex].row);\n        const currentNewCode = newRows[codeRowIndex].newCode;\n        const currentOldCode = reverseMapping.get(currentNewCode);\n\n        // \n        for (const emptyRow of analysis.emptyRows) {\n          if (emptyRow.prevOldCode === currentOldCode) {\n            result.push(emptyRow.row);\n          }\n        }\n      }\n\n      // prevOldCode nextOldCode  null\n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode !== null && emptyRow.nextOldCode === null) {\n          // \n        }\n      }\n\n      return result;\n    };\n\n    // \n    const newRows1 = buildNewRows(analysis1, headers1, colIndex1, new Set(analysis1.codeRows.map(r => r.oldCode)));\n    const newRows2 = buildNewRows(analysis2, headers2, colIndex2, new Set(analysis2.codeRows.map(r => r.oldCode)));\n\n    // \n    const countCodeChanges = (oldAnalysis, newRows, colIndex) => {\n      let count = 0;\n      // \n      const oldCodes = new Set(oldAnalysis.codeRows.map(r => r.oldCode));\n      const newCodes = new Set();\n\n      for (const row of newRows) {\n        const code = row[colIndex];\n        if (code) newCodes.add(code);\n      }\n\n      // \n      for (const [oldCode, newCode] of mapping.entries()) {\n        if (oldCodes.has(oldCode) && oldCode !== newCode) {\n          count++; // \n        }\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n        if (!oldCodes.has(oldCode)) {\n          count++; // \n        }\n      }\n\n      return count;\n    };\n\n    fixedCount1 = countCodeChanges(analysis1, newRows1, colIndex1);\n    fixedCount2 = countCodeChanges(analysis2, newRows2, colIndex2);\n\n    // \n    table1Sheet.content = [headers1, ...newRows1];\n    table2Sheet.content = [headers2, ...newRows2];\n\n    return { fixedCount1, fixedCount2 };\n  }\n\n  // \n  // ========================================\n  const showTableRuleFixModal = (error, rule, ruleType, rawData, snapshot, currentThemeClass) => {\n    const { $ } = getCore();\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n\n    let contentHtml = '';\n    let actionBtns = '';\n\n    if (ruleType === 'tableReadonly') {\n      // \n      let changeCount = 0;\n      let changeDetails = [];\n\n      if (snapshot && rawData) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            const newRows = rawData[sheetId].content?.slice(1) || [];\n            const oldRows = snapshot[sheetId].content?.slice(1) || [];\n\n            // \n            newRows.forEach((row, idx) => {\n              const oldRow = oldRows[idx];\n              if (!oldRow) {\n                changeDetails.push(`${idx + 1}: `);\n                changeCount++;\n              } else {\n                for (let c = 0; c < row.length; c++) {\n                  if (String(row[c] || '') !== String(oldRow[c] || '')) {\n                    changeDetails.push(`${idx + 1}: `);\n                    changeCount++;\n                    break;\n                  }\n                }\n              }\n            });\n\n            // \n            if (oldRows.length > newRows.length) {\n              for (let i = newRows.length; i < oldRows.length; i++) {\n                changeDetails.push(`${i + 1}: `);\n                changeCount++;\n              }\n            }\n            break;\n          }\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-lock\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\"></div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${changeCount}</strong> \n          </div>\n          ${\n            changeDetails.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\">\n              ${changeDetails\n                .slice(0, 10)\n                .map(d => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(d)}</div>`)\n                .join('')}\n              ${changeDetails.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${changeDetails.length - 10} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n      actionBtns = `\n        <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n        <button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-restore-table\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n      `;\n    } else if (ruleType === 'rowLimit') {\n      // \n      const minRows = rule.config?.min;\n      const maxRows = rule.config?.max;\n      let currentRowCount = 0;\n      let excessRows = [];\n\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          currentRowCount = (rawData[sheetId].content?.length || 1) - 1; // \n          break;\n        }\n      }\n\n      const isTooMany = maxRows !== undefined && currentRowCount > maxRows;\n      const isTooFew = minRows !== undefined && currentRowCount < minRows;\n\n      if (isTooMany) {\n        for (let i = maxRows + 1; i <= currentRowCount; i++) {\n          excessRows.push(i);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-arrows-up-down\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            : <strong>${currentRowCount}</strong> \n            ${minRows !== undefined || maxRows !== undefined ? ` | : ${minRows !== undefined ? minRows : 0} ~ ${maxRows !== undefined ? maxRows : ''} ` : ''}\n          </div>\n          ${\n            isTooMany && excessRows.length > 0\n              ? `\n            <div class=\"acu-smart-fix-excess-rows\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-trash\"></i>  ( ${excessRows[0]} ):\n              </div>\n              <div class=\"acu-smart-fix-change-list\">\n                ${excessRows\n                  .slice(0, 10)\n                  .map(r => `<div class=\"acu-smart-fix-change-item\"> ${r} </div>`)\n                  .join('')}\n                ${excessRows.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${excessRows.length} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n          ${\n            isTooFew\n              ? `\n            <div class=\"acu-smart-fix-hint\">\n              <i class=\"fa-solid fa-info-circle\"></i>  ${minRows - currentRowCount} \n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (isTooMany && excessRows.length > 0) {\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-delete-rows\" data-start=\"${maxRows}\" data-table=\"${escapeHtml(error.tableName)}\">\n            <i class=\"fa-solid fa-trash\"></i>  ${excessRows.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    } else if (ruleType === 'sequence' && rule.targetColumn) {\n      // \n      const prefix = rule.config?.prefix || '';\n      const startFrom = rule.config?.startFrom !== undefined ? rule.config?.startFrom : 1;\n      let targetSheet = null;\n      let issues = [];\n      let fixSuggestions = [];\n\n      // \n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (targetSheet && targetSheet.content && targetSheet.content.length > 1) {\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = headers.indexOf(rule.targetColumn);\n\n        if (colIndex >= 0) {\n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num, originalRowIndex: i + 2 }); // +2 +1\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          const numCountMap = new Map(); // \n          const duplicates = [];\n          const gaps = [];\n          const outOfOrder = [];\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const actualNum = numbers[i].num;\n            if (!numCountMap.has(actualNum)) {\n              numCountMap.set(actualNum, []);\n            }\n            numCountMap.get(actualNum).push(i);\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n\n            // \n            const occurrences = numCountMap.get(actualNum) || [];\n            if (occurrences.length > 1) {\n              // \n              if (occurrences[0] === i) {\n                duplicates.push({\n                  rowNum,\n                  value: numbers[i].value,\n                  num: actualNum,\n                  expectedNum,\n                  count: occurrences.length,\n                });\n              }\n            }\n\n            // \n            if (actualNum !== expectedNum) {\n              if (actualNum < expectedNum) {\n                // \n                outOfOrder.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              } else {\n                // \n                gaps.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              }\n            }\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n            const currentValue = numbers[i].value;\n            const fixedValue = prefix + String(expectedNum).padStart(4, '0');\n\n            if (actualNum !== expectedNum || duplicates.some(d => d.num === actualNum && d.rowNum === rowNum)) {\n              fixSuggestions.push({\n                rowNum,\n                currentValue,\n                fixedValue,\n                reason: actualNum < expectedNum ? '' : actualNum > expectedNum ? '' : '',\n              });\n            }\n          }\n\n          // \n          const issueSet = new Set();\n          duplicates.forEach(d => {\n            issueSet.add(`${d.rowNum}: \"${d.value}\"  (${d.count})`);\n          });\n          gaps.forEach(g => {\n            issueSet.add(\n              `${g.rowNum}: \"${g.value}\"  \"${prefix}${String(g.expectedNum).padStart(4, '0')}\" ()`,\n            );\n          });\n          outOfOrder.forEach(o => {\n            issueSet.add(\n              `${o.rowNum}: \"${o.value}\"  \"${prefix}${String(o.expectedNum).padStart(4, '0')}\" ()`,\n            );\n          });\n          issues = Array.from(issueSet);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-sort-numeric-up\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${issues.length}</strong> \n          </div>\n          ${\n            issues.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n              ${issues\n                .slice(0, 20)\n                .map(issue => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(issue)}</div>`)\n                .join('')}\n              ${issues.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${issues.length - 20} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n          ${\n            fixSuggestions.length > 0\n              ? `\n            <div class=\"acu-smart-fix-suggest\" style=\"margin-top:12px;\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </div>\n              <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n                ${fixSuggestions\n                  .slice(0, 20)\n                  .map(\n                    fix => `\n                  <div class=\"acu-smart-fix-change-item\">\n                    <span style=\"color:var(--acu-text-sub);\">${fix.rowNum}:</span>\n                    <span style=\"color:var(--acu-hl-manual);\">${escapeHtml(fix.currentValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);\">  </span>\n                    <span style=\"color:var(--acu-hl-auto);\">${escapeHtml(fix.fixedValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);font-size:11px;\"> (${escapeHtml(fix.reason)})</span>\n                  </div>\n                `,\n                  )\n                  .join('')}\n                ${fixSuggestions.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${fixSuggestions.length - 20} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (fixSuggestions.length > 0) {\n        // \n        const pairedTable =\n          rule.config?.pairedTable ||\n          (error.tableName === '' ? '' : error.tableName === '' ? '' : null);\n        const pairedTableAttr = pairedTable ? `data-paired-table=\"${escapeHtml(pairedTable)}\"` : '';\n\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-fix-sequence\" data-table=\"${escapeHtml(error.tableName)}\" data-column=\"${escapeHtml(rule.targetColumn)}\" data-prefix=\"${escapeHtml(prefix)}\" data-start=\"${startFrom}\" ${pairedTableAttr}>\n            <i class=\"fa-solid fa-magic\"></i>  ${fixSuggestions.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    }\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} ()</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            ${contentHtml}\n          </div>\n          <div class=\"acu-dialog-btns\">\n            ${actionBtns}\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.on('click', '#smart-fix-restore-table', async function () {\n      if (!snapshot) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      try {\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            rawData[sheetId] = JSON.parse(JSON.stringify(snapshot[sheetId]));\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-fix-sequence', async function () {\n      const $btn = $(this);\n      const tableName = $btn.data('table');\n      const columnName = $btn.data('column');\n      const prefix = $btn.data('prefix') || '';\n      const startFrom = parseInt($btn.data('start') || '1', 10);\n      const pairedTableName = $btn.data('paired-table') || null;\n\n      try {\n        $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n\n        // \n        let targetSheet = null;\n        let targetSheetId = null;\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            targetSheet = rawData[sheetId];\n            targetSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = headers.indexOf(columnName);\n\n        if (colIndex < 0) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        // \n        if (pairedTableName) {\n          // \n          let pairedSheet = null;\n          let pairedSheetId = null;\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === pairedTableName) {\n              pairedSheet = rawData[sheetId];\n              pairedSheetId = sheetId;\n              break;\n            }\n          }\n\n          if (!pairedSheet || !pairedSheet.content || pairedSheet.content.length < 1) {\n            if (window.toastr) window.toastr.warning(`: ${pairedTableName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          const pairedHeaders = pairedSheet.content[0] || [];\n          const pairedColIndex = pairedHeaders.indexOf(columnName);\n\n          if (pairedColIndex < 0) {\n            if (window.toastr) window.toastr.warning(`: ${columnName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          // \n          const extract1 = extractCodesFromTable(targetSheet, columnName, prefix);\n          const extract2 = extractCodesFromTable(pairedSheet, columnName, prefix);\n\n          // \n          const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n          // \n          const { fixedCount1, fixedCount2 } = alignAndFixPairedTables(\n            targetSheet,\n            targetSheetId,\n            pairedSheet,\n            pairedSheetId,\n            columnName,\n            mapping,\n            prefix,\n            startFrom,\n            rawData,\n          );\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          // \n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num });\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          let fixedCount = 0;\n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowIndex = numbers[i].rowIndex;\n\n            if (actualNum !== expectedNum) {\n              const fixedValue = prefix + String(expectedNum).padStart(4, '0');\n              rows[rowIndex][colIndex] = fixedValue;\n              fixedCount++;\n            }\n          }\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n        $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-delete-rows', async function () {\n      const startRow = parseInt($(this).data('start'), 10);\n      const tableName = $(this).data('table');\n\n      try {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            // (index 0) startRow (index 1  startRow)\n            rawData[sheetId].content = rawData[sheetId].content.slice(0, startRow + 1);\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const showBlacklistManagerModal = () => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const theme = getThemeColors();\n    const t = theme;\n\n    $('.acu-blacklist-manager-overlay').remove();\n\n    const blacklist = BlacklistManager.getBlacklist();\n\n    const modalHtml = `\n      <div class=\"acu-blacklist-manager-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width: 600px; width: 90%;\">\n          <div class=\"acu-edit-title\" style=\"position: relative;\">\n            <i class=\"fa-solid fa-filter\"></i> \n            <button class=\"acu-close-btn\" style=\"position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: ${t.textMain}; cursor: pointer; font-size: 18px; z-index: 10;\">\n              <i class=\"fa-solid fa-times\"></i>\n            </button>\n          </div>\n          <div class=\"acu-settings-content\" style=\"flex: 1; overflow-y: auto; padding: 20px;\">\n            <div style=\"margin-bottom: 15px;\">\n              <div style=\"margin-bottom: 8px; font-size: 12px; color: ${t.textSub};\">\n                \n              </div>\n              <textarea id=\"blacklist-textarea\" style=\"width: 100%; min-height: 120px; max-height: 300px; padding: 10px !important; border: 1px solid ${t.border} !important; border-radius: 4px !important; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-size: 13px !important; box-sizing: border-box !important; resize: vertical; font-family: monospace; line-height: 1.5;\" placeholder=\"\"></textarea>\n              <div style=\"display: flex; gap: 8px; margin-top: 8px; flex-wrap: nowrap;\">\n                <input type=\"text\" id=\"blacklist-input\" placeholder=\"...\" style=\"flex: 1; min-width: 0; padding: 8px !important; border: 1px solid ${t.border} !important; border-radius: 4px !important; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-size: 13px !important; box-sizing: border-box !important;\">\n                <button id=\"blacklist-add-btn\" style=\"padding: 8px 16px; background: ${t.accent}; color: ${t.buttonTextOnAccent || t.textMain || '#6B4A5A'}; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; white-space: nowrap; flex-shrink: 0;\">\n                  <i class=\"fa-solid fa-plus\"></i> \n                </button>\n              </div>\n            </div>\n            <div style=\"display: flex; gap: 8px; margin-top: 15px;\">\n              <button id=\"blacklist-reset-btn\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; color: ${t.textMain}; border: 1px solid ${t.border}; border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-undo\"></i> \n              </button>\n              <button id=\"blacklist-close-btn\" style=\"flex: 1; padding: 10px; background: ${t.accent}; color: ${t.buttonTextOnAccent || t.textMain || '#6B4A5A'}; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-check\"></i> \n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '2147483655',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    // textarea\n    const updateTextarea = () => {\n      const blacklist = BlacklistManager.getBlacklist();\n      const $textarea = $modal.find('#blacklist-textarea');\n      $textarea.val(blacklist.join(''));\n    };\n\n    // textareaBlacklistManager\n    const syncFromTextarea = () => {\n      const $textarea = $modal.find('#blacklist-textarea');\n      const text = $textarea.val().trim();\n      if (!text) {\n        BlacklistManager.setBlacklist([]);\n        return;\n      }\n      // \n      const items = text\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n      // \n      const uniqueItems = [...new Set(items)];\n      BlacklistManager.setBlacklist(uniqueItems);\n      // textarea\n      if (uniqueItems.length !== items.length) {\n        updateTextarea();\n      }\n    };\n\n    // textarea\n    updateTextarea();\n\n    // textarea\n    $modal.find('#blacklist-textarea').on('input', function () {\n      syncFromTextarea();\n    });\n\n    // \n    $modal.find('#blacklist-add-btn').click(function () {\n      const input = $modal.find('#blacklist-input');\n      const value = input.val().trim();\n      if (!value) return;\n\n      // \n      const newItems = value\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n\n      if (newItems.length === 0) return;\n\n      const blacklist = BlacklistManager.getBlacklist();\n      const existingSet = new Set(blacklist);\n      const addedItems = [];\n\n      newItems.forEach(item => {\n        if (!existingSet.has(item)) {\n          blacklist.push(item);\n          existingSet.add(item);\n          addedItems.push(item);\n        }\n      });\n\n      if (addedItems.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      BlacklistManager.setBlacklist(blacklist);\n      input.val('');\n      updateTextarea();\n      if (window.toastr) window.toastr.success(` ${addedItems.length} `);\n    });\n\n    $modal.find('#blacklist-input').on('keypress', function (e) {\n      if (e.which === 13) {\n        $modal.find('#blacklist-add-btn').click();\n      }\n    });\n\n    $modal.find('#blacklist-reset-btn').click(function () {\n      if (confirm('')) {\n        BlacklistManager.resetToDefault();\n        updateTextarea();\n        if (window.toastr) window.toastr.success('');\n      }\n    });\n\n    const closeModal = () => {\n      $modal.remove();\n      // \n      renderInterface();\n    };\n\n    $modal.find('#blacklist-close-btn, .acu-close-btn').click(closeModal);\n    $modal.on('click', function (e) {\n      if ($(e.target).hasClass('acu-blacklist-manager-overlay')) closeModal();\n    });\n  };\n\n  const showAttributePresetManager = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const presets = AttributePresetManager.getAllPresets();\n    const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n\n    // HTMLactiveIdnull\n    const isDefaultActive = activeId === null;\n    const defaultPresetHtml = `\n      <div class=\"acu-preset-item\" data-id=\"__default__\">\n        <div class=\"acu-preset-info\">\n          <div class=\"acu-preset-name\">\n            \n            <span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>\n          </div>\n          <div class=\"acu-preset-desc\">5-95</div>\n          <div class=\"acu-preset-stats\">\n            : 6 | : 0\n          </div>\n        </div>\n        <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n          <label class=\"acu-toggle\" style=\"margin: 0;\">\n            <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"__default__\" ${isDefaultActive ? 'checked' : ''}>\n            <span class=\"acu-toggle-slider\"></span>\n          </label>\n        </div>\n      </div>\n    `;\n\n    // HTML\n    const presetsHtml = presets\n      .map(preset => {\n        const isActive = preset.id === activeId;\n        const isBuiltin = preset.builtin;\n\n        return `\n        <div class=\"acu-preset-item\" data-id=\"${preset.id}\">\n          <div class=\"acu-preset-info\">\n            <div class=\"acu-preset-name\">\n              ${escapeHtml(preset.name)}\n              ${isBuiltin ? `<span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>` : ''}\n            </div>\n            ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n            <div class=\"acu-preset-stats\">\n              : ${preset.baseAttributes.length} | : ${preset.specialAttributes?.length || 0}\n            </div>\n          </div>\n          <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n            <label class=\"acu-toggle\" style=\"margin: 0;\">\n              <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"${preset.id}\" ${isActive ? 'checked' : ''}>\n              <span class=\"acu-toggle-slider\"></span>\n            </label>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>` : ''}\n            <button class=\"acu-preset-btn acu-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: #e74c3c;\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n          </div>\n        </div>\n      `;\n      })\n      .join('');\n\n    // \n    const allPresetsHtml = defaultPresetHtml + presetsHtml;\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 80vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-dice-d20\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div id=\"acu-presets-list\">\n              ${allPresetsHtml || `<div style=\"text-align: center; padding: 40px; color: ${t.textSub};\"></div>`}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"acu-preset-new\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-preset-import\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-preset-back\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n\n          <input type=\"file\" id=\"acu-preset-file-input\" accept=\".json\" style=\"display: none;\" />\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn, #acu-preset-back').on('click', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n\n    // Toggle\n    overlay.on('change', '.acu-preset-toggle', function () {\n      const $toggle = $(this);\n      const id = $toggle.data('id');\n      const isChecked = $toggle.is(':checked');\n\n      if (isChecked) {\n        // id\"__default__\"null\n        const finalId = id === '__default__' ? null : id;\n        AttributePresetManager.setActivePreset(finalId);\n\n        // toggle\n        overlay.find('.acu-preset-toggle').each(function () {\n          const $thisToggle = $(this);\n          const thisId = $thisToggle.data('id');\n          if (thisId !== id) {\n            $thisToggle.prop('checked', false);\n          }\n        });\n      } else {\n        // null\n        AttributePresetManager.setActivePreset(null);\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showAttributePresetEditor(id);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-export', function () {\n      const id = $(this).data('id');\n      const json = AttributePresetManager.exportPreset(id);\n      if (!json) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      const preset = presets.find(p => p.id === id);\n      const filename = `acu_preset_${preset?.name || id}_${Date.now()}.json`;\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        const success = AttributePresetManager.deletePreset(id);\n        if (success) {\n          overlay.remove();\n          showAttributePresetManager();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      }\n    });\n\n    // \n    overlay.find('#acu-preset-new').on('click', () => {\n      overlay.remove();\n      showAttributePresetEditor();\n    });\n\n    // \n    overlay.find('#acu-preset-import').on('click', () => {\n      overlay.find('#acu-preset-file-input').click();\n    });\n\n    overlay.find('#acu-preset-file-input').on('change', function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      const reader = new FileReader();\n      reader.onload = evt => {\n        try {\n          const imported = AttributePresetManager.importPreset(evt.target.result);\n          if (imported) {\n            overlay.remove();\n            showAttributePresetManager();\n          } else {\n            if (window.toastr) window.toastr.error('');\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      };\n      reader.readAsText(file);\n\n      // \n      $(this).val('');\n    });\n\n    // \n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        overlay.remove();\n        showSettingsModal();\n      }\n    });\n  };\n\n  // \n  const showAttributePresetEditor = (presetId = null) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? AttributePresetManager.getAllPresets().find(p => p.id === presetId) : null;\n\n    // \n    const defaultData = {\n      name: existingPreset?.name || '',\n      description: existingPreset?.description || '',\n      baseAttributes: existingPreset?.baseAttributes || [\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n      ],\n      specialAttributes: existingPreset?.specialAttributes || [],\n    };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 650px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-pen\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 8px;\">\n                JSON <span style=\"font-size: 10px; color: ${t.textSub};\">()</span>\n              </label>\n              <textarea id=\"preset-json\" class=\"acu-preset-editor-textarea\" style=\"width: 100%; height: 320px; padding: 10px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-family: 'Consolas', 'Monaco', monospace !important; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: ${t.textSub}; padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n               baseAttributes:  nameformularangemodifier()<br/>\n               specialAttributes:  nameformularange()<br/>\n               : 3d6, 4d6kh3, (/2), (+-*/)\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"preset-save\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"preset-cancel\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#preset-json');\n\n    // JSON\n    const updateJSON = () => {\n      const data = {\n        baseAttributes: defaultData.baseAttributes,\n        specialAttributes: defaultData.specialAttributes,\n      };\n      $jsonTextarea.val(JSON.stringify(data, null, 2));\n    };\n    updateJSON();\n\n    // \n    overlay.find('.acu-close-btn, #preset-cancel').on('click', () => {\n      overlay.remove();\n      showAttributePresetManager();\n    });\n\n    // \n    overlay.find('#preset-save').on('click', () => {\n      try {\n        const name = overlay.find('#preset-name').val().trim();\n        const description = overlay.find('#preset-desc').val().trim();\n        const jsonStr = $jsonTextarea.val().trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const jsonData = JSON.parse(jsonStr);\n\n        // \n        if (\n          !jsonData.baseAttributes ||\n          !Array.isArray(jsonData.baseAttributes) ||\n          jsonData.baseAttributes.length === 0\n        ) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n\n        // \n        const preset = {\n          format: 'acu_attr_preset_v1',\n          version: 1,\n          id: presetId || `custom_${Date.now()}`,\n          name,\n          description,\n          baseAttributes: jsonData.baseAttributes,\n          specialAttributes: jsonData.specialAttributes || [],\n        };\n\n        // \n        if (isEdit) {\n          AttributePresetManager.updatePreset(presetId, preset);\n        } else {\n          AttributePresetManager.createPreset(preset);\n        }\n\n        overlay.remove();\n        showAttributePresetManager();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + (err.message || 'JSON'));\n      }\n    });\n\n    // \n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        overlay.remove();\n        showAttributePresetManager();\n      }\n    });\n  };\n\n  // ========================================\n  // Debug\n  // ========================================\n  const showDebugConsoleModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-debug-console-dialog)').remove();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const t = getThemeColors();\n\n    // localStorage\n    const savedFilters = Store.get('acu_debug_filters', { log: true, info: true, warn: true, error: true });\n    ConsoleCaptureManager.setFilters(savedFilters);\n\n    const renderLogs = () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      const $logContainer = dialog.find('.acu-debug-log-container');\n      $logContainer.empty();\n\n      if (filteredLogs.length === 0) {\n        $logContainer.html(\n          '<div style=\"text-align:center;padding:40px;color:var(--acu-text-sub);\"><i class=\"fa-solid fa-inbox\"></i><br/></div>',\n        );\n        return;\n      }\n\n      filteredLogs.forEach(log => {\n        const typeColors = {\n          error: '#e74c3c',\n          warn: '#f39c12',\n          info: '#3498db',\n          log: '#95a5a6',\n        };\n        const typeIcons = {\n          error: 'fa-exclamation-circle',\n          warn: 'fa-exclamation-triangle',\n          info: 'fa-info-circle',\n          log: 'fa-circle',\n        };\n        const color = typeColors[log.type] || typeColors.log;\n        const icon = typeIcons[log.type] || typeIcons.log;\n\n        const logItem = $(`\n          <div class=\"acu-debug-log-item\" data-type=\"${log.type}\" style=\"padding:8px 12px;border-bottom:1px solid var(--acu-border);font-family:monospace;font-size:12px;line-height:1.5;\">\n            <div style=\"display:flex;align-items:flex-start;gap:8px;\">\n              <span style=\"color:${color};min-width:60px;font-size:11px;\">\n                <i class=\"fa-solid ${icon}\"></i> [${log.timeStr}]\n              </span>\n              <span style=\"color:${color};min-width:50px;font-size:11px;text-transform:uppercase;\">[${log.type}]</span>\n              <span style=\"flex:1;color:var(--acu-text-main);word-break:break-word;white-space:pre-wrap;\">${escapeHtml(log.content)}</span>\n            </div>\n            ${log.stack ? `<div style=\"margin-top:4px;margin-left:128px;color:var(--acu-text-sub);font-size:11px;white-space:pre-wrap;font-family:monospace;\">${escapeHtml(log.stack)}</div>` : ''}\n          </div>\n        `);\n        $logContainer.append(logItem);\n      });\n    };\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-debug-console-dialog ${currentThemeClass}\" style=\"max-width:90vw;max-height:90vh;width:800px;height:600px;display:flex;flex-direction:column;\">\n          <div class=\"acu-settings-header\" style=\"flex-shrink:0;\">\n            <div class=\"acu-settings-title\"><i class=\"fa-solid fa-bug\"></i> Debug</div>\n            <button class=\"acu-close-btn\" id=\"debug-console-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex:1;display:flex;flex-direction:column;overflow:hidden;\">\n            <!--  -->\n            <div style=\"padding:12px;border-bottom:1px solid var(--acu-border);flex-shrink:0;display:flex;flex-direction:column;gap:8px;\">\n              <!-- Console -->\n              <div style=\"display:flex;align-items:center;gap:8px;padding-bottom:8px;border-bottom:1px solid var(--acu-border);\">\n                <span style=\"font-size:12px;color:var(--acu-text-sub);flex:1;\">Console:</span>\n                <label class=\"acu-toggle\">\n                  <input type=\"checkbox\" id=\"debug-console-capture-toggle\" ${ConsoleCaptureManager.enabled ? 'checked' : ''}>\n                  <span class=\"acu-toggle-slider\"></span>\n                </label>\n                <span id=\"debug-console-capture-status\" style=\"font-size:11px;color:var(--acu-text-sub);\">${ConsoleCaptureManager.enabled ? '' : ''}</span>\n              </div>\n              <!--  -->\n              <div style=\"display:flex;flex-wrap:wrap;gap:8px;align-items:center;\">\n                <div style=\"display:flex;gap:8px;align-items:center;flex:1;\">\n                  <span style=\"font-size:12px;color:var(--acu-text-sub);\">:</span>\n                  <button class=\"acu-btn ${savedFilters.log ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"log\" style=\"padding:4px 10px;font-size:12px;${savedFilters.log ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Log</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.info ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"info\" style=\"padding:4px 10px;font-size:12px;${savedFilters.info ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Info</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.warn ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"warn\" style=\"padding:4px 10px;font-size:12px;${savedFilters.warn ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Warn</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.error ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"error\" style=\"padding:4px 10px;font-size:12px;${savedFilters.error ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Error</span>\n                  </button>\n                </div>\n                <div style=\"display:flex;gap:6px;\">\n                  <button class=\"acu-btn acu-btn-secondary\" id=\"debug-console-clear\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-trash\"></i> \n                  </button>\n                  <button class=\"acu-btn acu-btn-secondary\" id=\"debug-console-copy\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-copy\"></i> \n                  </button>\n                  <button class=\"acu-btn acu-btn-primary\" id=\"debug-console-export\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-download\"></i> \n                  </button>\n                </div>\n              </div>\n            </div>\n\n            <!--  -->\n            <div class=\"acu-debug-log-scroll\" style=\"flex:1;overflow-y:auto;overflow-x:hidden;background:var(--acu-card-bg);\">\n              <div class=\"acu-debug-log-container\"></div>\n            </div>\n\n            <!--  -->\n            <div style=\"padding:8px 12px;border-top:1px solid var(--acu-border);flex-shrink:0;font-size:11px;color:var(--acu-text-sub);display:flex;justify-content:space-between;\">\n              <span>: <span id=\"debug-total-count\">0</span> | : <span id=\"debug-filtered-count\">0</span></span>\n            </div>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const updateCounts = () => {\n      const total = ConsoleCaptureManager.logs.length;\n      const filtered = ConsoleCaptureManager.getFilteredLogs().length;\n      dialog.find('#debug-total-count').text(total);\n      dialog.find('#debug-filtered-count').text(filtered);\n    };\n\n    // \n    renderLogs();\n    updateCounts();\n\n    // Console\n    dialog.find('#debug-console-capture-toggle').on('change', function () {\n      const checked = $(this).is(':checked');\n      const $status = dialog.find('#debug-console-capture-status');\n      if (checked) {\n        ConsoleCaptureManager.enable();\n        $status.text('');\n        // \n        console.log('[DICE]Debug');\n      } else {\n        ConsoleCaptureManager.disable();\n        $status.text('');\n      }\n    });\n\n    // \n    dialog.find('[data-filter-type]').on('click', function () {\n      const type = $(this).data('filter-type');\n      const isActive = $(this).hasClass('acu-btn-primary');\n      const newState = !isActive;\n\n      // \n      if (newState) {\n        $(this).removeClass('acu-btn-secondary').addClass('acu-btn-primary');\n        $(this).css('opacity', '1');\n      } else {\n        $(this).removeClass('acu-btn-primary').addClass('acu-btn-secondary');\n        $(this).css('opacity', '0.5');\n      }\n\n      // \n      ConsoleCaptureManager.setFilters({ [type]: newState });\n      Store.set('acu_debug_filters', ConsoleCaptureManager.filters);\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-clear').on('click', () => {\n      ConsoleCaptureManager.clear();\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-copy').on('click', async () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n');\n\n      try {\n        // \n        if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n          const safeContent = text.replace(/\\\"/g, '\\\\\"').replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          return;\n        }\n        // API\n        if (navigator.clipboard && window.isSecureContext) {\n          await navigator.clipboard.writeText(text);\n        } else {\n          // execCommand\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n          document.body.appendChild(textArea);\n          textArea.select();\n          textArea.setSelectionRange(0, 99999);\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n          if (!successful) {\n            throw new Error('execCommand failed');\n          }\n        }\n      } catch (err) {\n        console.error('[DICE]DebugConsole :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // \n    dialog.find('#debug-console-export').on('click', () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n\\n');\n\n      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `debug-console-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    dialog.find('#debug-console-close, .acu-edit-overlay').on('click', function (e) {\n      if (e.target === this || $(e.target).closest('.acu-close-btn').length) {\n        dialog.remove();\n      }\n    });\n\n    // \n    // [] \n    const refreshInterval = setInterval(() => {\n      if (dialog.length && dialog.is(':visible')) {\n        renderLogs();\n        updateCounts();\n      }\n    }, 500);\n\n    // \n    dialog.on('remove', () => {\n      clearInterval(refreshInterval);\n    });\n  };\n\n  // ========================================\n  // showAddRegexRuleModal - / (Phase 4.2)\n  // ========================================\n  const showAddRegexRuleModal = (editRuleId?: string) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // ()\n    const editRule = editRuleId ? RegexTransformationManager.getRule(editRuleId) : null;\n\n    // \n    const tableData = cachedRawData || getTableData();\n    const tableNames = Object.keys(tableData || {})\n      .filter(k => k.startsWith('sheet_'))\n      .map(k => tableData[k]?.name || k)\n      .sort();\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-dice-cfg-header\">\n            <span><i class=\"fa-solid fa-magic\"></i> ${editRule ? '' : ''}</span>\n            <button class=\"acu-config-close\" id=\"acu-close-regex-rule\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.name) : ''}\" placeholder=\": \" style=\"flex:1;\" required>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <textarea id=\"rule-description\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1; resize: none; overflow-wrap: break-word; overflow-y: hidden; min-height: 34px; height: 34px; line-height: 1.4;\">${editRule ? escapeHtml(editRule.description || '') : ''}</textarea>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <input type=\"text\" id=\"rule-pattern\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.pattern) : ''}\" placeholder=\": \\\\s+  /test/g\" style=\"flex:1; font-family: monospace;\" required>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-replacement\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.replacement || '') : ''}\" placeholder=\", $1, $2 \" style=\"flex:1; font-family: monospace;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <select id=\"rule-scope-type\" class=\"acu-setting-select\" style=\"width:120px;\">\n                <option value=\"global\" ${editRule?.scope?.type === 'global' ? 'selected' : ''}></option>\n                <option value=\"table\" ${editRule?.scope?.type === 'table' ? 'selected' : ''}></option>\n                <option value=\"column\" ${editRule?.scope?.type === 'column' ? 'selected' : ''}></option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"field-table-names\" style=\"display: ${editRule?.scope?.type === 'global' ? 'none' : 'flex'};\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> ()</span></div>\n              <input type=\"text\" id=\"rule-table-names\" class=\"acu-panel-input\" value=\"${editRule?.scope?.tableNames?.join(',') || ''}\" placeholder=\": ,\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\" id=\"field-column-names\" style=\"display: ${editRule?.scope?.type === 'column' ? 'flex' : 'none'};\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> ()</span></div>\n              <input type=\"text\" id=\"rule-column-names\" class=\"acu-panel-input\" value=\"${editRule?.scope?.columnNames?.join(',') || ''}\" placeholder=\": ,\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"number\" id=\"rule-priority\" class=\"acu-panel-input\" value=\"${editRule?.priority || 50}\" min=\"1\" max=\"100\" style=\"width:80px;\">\n            </div>\n\n          </div>\n          <div class=\"acu-dice-cfg-actions\">\n            <button id=\"acu-regex-rule-cancel\"></button>\n            <button id=\"acu-regex-rule-confirm\"></button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    // /\n    const updateScopeFields = () => {\n      const scopeType = dialog.find('#rule-scope-type').val();\n      if (scopeType === 'global') {\n        dialog.find('#field-table-names, #field-column-names').hide();\n      } else if (scopeType === 'table') {\n        dialog.find('#field-table-names').css('display', 'flex').show();\n        dialog.find('#field-column-names').hide();\n      } else if (scopeType === 'column') {\n        dialog.find('#field-table-names, #field-column-names').css('display', 'flex').show();\n      }\n    };\n\n    dialog.find('#rule-scope-type').on('change', updateScopeFields);\n\n    // Textarea\n    const $textarea = dialog.find('#rule-description');\n    const autoResizeTextarea = () => {\n      // scrollHeight\n      $textarea.css('height', '34px');\n      // ,1\n      const scrollHeight = $textarea[0].scrollHeight;\n      $textarea.css('height', Math.max(34, scrollHeight) + 'px');\n    };\n    // \n    $textarea.on('input', autoResizeTextarea);\n\n    // ()\n    dialog.find('#acu-regex-rule-confirm').on('click', async function () {\n      const name = dialog.find('#rule-name').val();\n      const pattern = dialog.find('#rule-pattern').val();\n      const scopeType = dialog.find('#rule-scope-type').val();\n\n      if (!name || !pattern) {\n        toastr.error('');\n        return;\n      }\n\n      //  scope \n      const scope: RegexScopeConfig = { type: scopeType as RegexScopeType };\n      if (scopeType !== 'global') {\n        const tableNames = dialog.find('#rule-table-names').val();\n        if (tableNames)\n          scope.tableNames = String(tableNames)\n            .split(',')\n            .map(s => s.trim())\n            .filter(s => s);\n      }\n      if (scopeType === 'column') {\n        const columnNames = dialog.find('#rule-column-names').val();\n        if (columnNames)\n          scope.columnNames = String(columnNames)\n            .split(',')\n            .map(s => s.trim())\n            .filter(s => s);\n      }\n\n      //  pattern  flags\n      const patternStr = String(pattern);\n      const { flags: extractedFlags, patternWithoutFlags } = RegexTransformationEngine._extractFlags(patternStr);\n\n      //  UI  flags\n      const $flagGlobal = dialog.find('#flag-global');\n      const $flagIgnoreCase = dialog.find('#flag-ignorecase');\n      const $flagMultiline = dialog.find('#flag-multiline');\n\n      const uiFlags = {\n        global: $flagGlobal.length > 0 ? $flagGlobal.is(':checked') : false,\n        caseInsensitive: $flagIgnoreCase.length > 0 ? $flagIgnoreCase.is(':checked') : false,\n        multiline: $flagMultiline.length > 0 ? $flagMultiline.is(':checked') : false,\n      };\n\n      //  pattern  flags pattern  flags\n      const finalPattern = patternWithoutFlags !== patternStr ? patternWithoutFlags : patternStr;\n      const finalFlags =\n        patternWithoutFlags !== patternStr\n          ? { ...uiFlags, ...extractedFlags } //  flags  UI flags\n          : uiFlags; //  flags UI flags\n\n      const ruleData = {\n        name: String(name),\n        description: dialog.find('#rule-description').val(),\n        operation: 'replace', // \n        pattern: finalPattern, //  pattern flags\n        flags: finalFlags, //  flags\n        replacement: dialog.find('#rule-replacement').val(),\n        scope,\n        enabled: true, // \n        priority: parseInt(dialog.find('#rule-priority').val(), 10),\n        executeMode: 'auto', // \n      };\n\n      // \n      if (editRuleId) {\n        // \n        RegexTransformationManager.updateRule(editRuleId, ruleData);\n        toastr.success('');\n      } else {\n        // \n        const newRule = RegexTransformationManager.addCustomRule(ruleData);\n        if (newRule) {\n          editRuleId = newRule.id;\n          toastr.success('');\n        }\n      }\n\n      // [] ,showSettingsModal\n      dialog.remove();\n\n      // ,\n      if ($('.acu-settings-dialog').length > 0) {\n        refreshRegexRulesList();\n      }\n    });\n\n    // \n    const closeDialog = () => {\n      isSettingsOpen = false; // ,\n      dialog.remove();\n      renderInterface(); // \n    };\n\n    // \n    dialog.find('#acu-regex-rule-cancel, #acu-close-regex-rule').on('click', closeDialog);\n\n    // \n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        closeDialog();\n      }\n    });\n\n    // ESC \n    $(document).on('keydown.regex-rule-modal', function (e) {\n      if (e.key === 'Escape' && dialog.length && dialog.is(':visible')) {\n        e.preventDefault();\n        closeDialog();\n        $(document).off('keydown.regex-rule-modal'); // \n      }\n    });\n\n    $('body').append(dialog);\n\n    // DOMtextarea\n    requestAnimationFrame(() => {\n      const $textarea = dialog.find('#rule-description');\n      if ($textarea.length && $textarea[0].scrollHeight > 34) {\n        $textarea.css('height', $textarea[0].scrollHeight + 'px');\n      }\n    });\n  };\n\n  // \n  window.showAddRegexRuleModal = showAddRegexRuleModal;\n\n  // \n  window.showDebugConsoleModal = showDebugConsoleModal;\n\n  const showSettingsModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-settings-dialog)').remove();\n    isSettingsOpen = true;\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const t = getThemeColors();\n\n    // \n    const expandedGroups = Store.get('acu_settings_expanded', ['appearance']);\n\n    const isGroupExpanded = groupId => expandedGroups.includes(groupId);\n    // HTMLMVU\n    const SPECIAL_BUTTONS_CONFIG = [\n      { key: '__dice__', name: '', icon: 'fa-dice-d20' },\n      { key: '__changes__', name: '', icon: 'fa-code-compare' },\n      { key: '__mvu__', name: 'MVU', icon: 'fa-code-branch' },\n    ];\n\n    const tableManagerHtml = (() => {\n      const rawData = cachedRawData || getTableData();\n      const tables = processJsonData(rawData || {});\n      const savedOrder = getSavedTableOrder() || [];\n      const hiddenList = getHiddenTables();\n\n      //  + \n      let allItems = [];\n\n      // \n      SPECIAL_BUTTONS_CONFIG.forEach(btn => {\n        // MVU \n        allItems.push({ key: btn.key, name: btn.name, icon: btn.icon, isSpecial: true });\n      });\n\n      // \n      Object.keys(tables).forEach(name => {\n        allItems.push({ key: name, name: name, icon: getIconForTableName(name), isSpecial: false });\n      });\n\n      // \n      if (savedOrder.length > 0) {\n        const orderMap = new Map(savedOrder.map((k, i) => [k, i]));\n        allItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      return allItems\n        .map(item => {\n          const isHidden = hiddenList.includes(item.key);\n          const specialClass = item.isSpecial ? ' acu-special-item' : '';\n          const displayName = item.name;\n          return (\n            '<div class=\"acu-table-manager-item' +\n            specialClass +\n            (isHidden ? ' hidden-table' : '') +\n            '\" data-table-name=\"' +\n            escapeHtml(item.key) +\n            '\" draggable=\"false\">' +\n            '<div class=\"acu-table-item-check\" title=\"/\">' +\n            '<i class=\"fa-solid ' +\n            (isHidden ? 'fa-eye-slash' : 'fa-eye') +\n            '\"></i>' +\n            '</div>' +\n            '<div class=\"acu-table-item-icon\"><i class=\"fa-solid ' +\n            item.icon +\n            '\"></i></div>' +\n            '<div class=\"acu-table-item-name\">' +\n            escapeHtml(displayName) +\n            '</div>' +\n            '<div class=\"acu-table-item-handle\" title=\"\">' +\n            '<i class=\"fa-solid fa-grip-vertical\"></i>' +\n            '</div>' +\n            '</div>'\n          );\n        })\n        .join('');\n    })();\n    const chevron = groupId => (isGroupExpanded(groupId) ? 'fa-chevron-down' : 'fa-chevron-right');\n\n    const dialog = $(`\n        <div class=\"acu-edit-overlay\">\n            <div class=\"acu-edit-dialog acu-settings-dialog ${currentThemeClass}\">\n                <div class=\"acu-settings-header\">\n                    <div class=\"acu-settings-title\">\n                        <span class=\"acu-settings-text\">\n                            <i class=\"fa-solid fa-cog\"></i> \n                            <span class=\"acu-version-badge\">${SCRIPT_VERSION}</span>\n                        </span>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-help-btn\" id=\"acu-help-btn\" title=\"\"><i class=\"fa-solid fa-question-circle\"></i></button>\n                        <button class=\"acu-close-btn\" id=\"dlg-close-x\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n\n                <div class=\"acu-settings-body\">\n                <!--  -->\n                <div class=\"acu-settings-group ${isGroupExpanded('appearance') ? '' : 'collapsed'}\" data-group=\"appearance\">                    <div class=\"acu-settings-group-title\">\n                        <i class=\"fa-solid ${chevron('appearance')} acu-group-chevron\"></i>\n                        <i class=\"fa-solid fa-palette\"></i> \n                    </div>\n                    <div class=\"acu-settings-group-body\">\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-theme\" class=\"acu-setting-select\">\n                                ${THEMES.map(t => `<option value=\"${t.id}\" ${t.id === config.theme ? 'selected' : ''}>${t.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-font-family\" class=\"acu-setting-select\">\n                                ${FONTS.map(f => `<option value=\"${f.id}\" ${f.id === config.fontFamily ? 'selected' : ''}>${f.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-main\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.fontSize}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-opt\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.optionFontSize || 12}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row acu-setting-row-toggle\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <label class=\"acu-toggle\">\n                                <input type=\"checkbox\" id=\"cfg-new\" ${config.highlightNew ? 'checked' : ''}>\n                                <span class=\"acu-toggle-slider\"></span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('layout') ? '' : 'collapsed'}\" data-group=\"layout\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('layout')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-th-large\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-width\" data-min=\"200\" data-max=\"500\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.cardWidth}px</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-layout\" class=\"acu-setting-select\">\n                                    <option value=\"horizontal\" ${config.layout !== 'vertical' ? 'selected' : ''}></option>\n                                    <option value=\"vertical\" ${config.layout === 'vertical' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                    <span class=\"acu-setting-hint\"></span>\n                                </div>\n                                <select id=\"cfg-grid-cols\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"2\" ${config.gridColumns == 2 ? 'selected' : ''}>2</option>\n                                    <option value=\"3\" ${config.gridColumns == 3 ? 'selected' : ''}>3</option>\n                                    <option value=\"4\" ${config.gridColumns == 4 ? 'selected' : ''}>4</option>\n                                    <option value=\"auto\" ${config.gridColumns === 'auto' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-per-page\" data-min=\"10\" data-max=\"200\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.itemsPerPage}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('position') ? '' : 'collapsed'}\" data-group=\"position\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('position')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-arrows-alt\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-position\" class=\"acu-setting-select\">\n                                    <option value=\"fixed\" ${config.positionMode !== 'embedded' ? 'selected' : ''}></option>\n                                    <option value=\"embedded\" ${config.positionMode === 'embedded' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-action-pos\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bottom\" ${config.actionsPosition !== 'top' ? 'selected' : ''}></option>\n                                    <option value=\"top\" ${config.actionsPosition === 'top' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-style\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bar\" ${config.collapseStyle === 'bar' ? 'selected' : ''}></option>\n                                    <option value=\"pill\" ${config.collapseStyle === 'pill' ? 'selected' : ''}></option>\n                                    <option value=\"mini\" ${config.collapseStyle === 'mini' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-align\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"right\" ${config.collapseAlign !== 'left' ? 'selected' : ''}></option>\n                                    <option value=\"left\" ${config.collapseAlign === 'left' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('options') ? '' : 'collapsed'}\" data-group=\"options\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('options')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-gamepad\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row acu-setting-row-toggle\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-show-opt\" ${config.showOptionPanel !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                            <div class=\"acu-setting-row acu-setting-row-toggle\" id=\"row-auto-send\" style=\"${config.showOptionPanel !== false ? '' : 'display:none;'}\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-auto-send\" ${config.clickOptionToAutoSend !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('tables') ? '' : 'collapsed'}\" data-group=\"tables\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('tables')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-table\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-table-manager-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <div class=\"acu-table-manager-list\" id=\"table-manager-list\">\n                                ${tableManagerHtml}\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('validation') ? '' : 'collapsed'}\" data-group=\"validation\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('validation')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-clipboard-check\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${PresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === PresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}${p.builtin ? ' ()' : ''}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-reset\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> <i class=\"fa-solid fa-shield-halved\"></i> \n                            </div>\n                            <div class=\"acu-validation-rules-list\" id=\"validation-rules-list\">\n                                ${ValidationRuleManager.getAllRules()\n                                  .map(rule => {\n                                    const typeInfo = RULE_TYPE_INFO[rule.ruleType] || {\n                                      name: rule.ruleType,\n                                      icon: 'fa-question',\n                                    };\n                                    const isTableRule = typeInfo.scope === 'table';\n                                    const hasIntercept = rule.intercept;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n                                            <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n                                        </div>\n                                        <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n                                        <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <button class=\"acu-add-rule-btn\" id=\"btn-add-validation-rule\">\n                                <i class=\"fa-solid fa-plus\"></i> \n                            </button>\n                        </div>\n                    </div>\n\n                    <!--  - Phase 4.1 -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('regex') ? '' : 'collapsed'}\" data-group=\"regex\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('regex')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-wand-magic-sparkles\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"regex-preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${RegexPresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === RegexPresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-execute-regex-now\" title=\"\" style=\"flex:1;height:28px;background:var(--acu-btn-accent, #4a9eff);color:white;\"><i class=\"fa-solid fa-play\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <!--  -->\n                            <div class=\"acu-validation-rules-list\" id=\"regex-rules-list\">\n                                ${RegexTransformationManager.getAllRules()\n                                  .map(rule => {\n                                    const scopeIcon =\n                                      rule.scope.type === 'global'\n                                        ? 'fa-globe'\n                                        : rule.scope.type === 'table'\n                                          ? 'fa-table'\n                                          : 'fa-columns';\n                                    const scopeText =\n                                      rule.scope.type === 'global'\n                                        ? ''\n                                        : rule.scope.type === 'table'\n                                          ? rule.scope.tableNames?.join(',')\n                                          : `${rule.scope.tableNames?.join(',')}.${rule.scope.columnNames?.join(',')}`;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\": ${escapeHtml(rule.scope.type)}\">\n                                            <i class=\"fa-solid ${scopeIcon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\" style=\"font-size:10px;\">${escapeHtml(scopeText)} | ${escapeHtml(rule.operation)}</div>\n                                        </div>\n                                        <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <div style=\"display:flex;gap:8px;margin-top:8px;\">\n                                <button class=\"acu-add-rule-btn\" id=\"btn-add-regex-rule\" style=\"flex:1;\">\n                                    <i class=\"fa-solid fa-plus\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('advanced') ? '' : 'collapsed'}\" data-group=\"advanced\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('advanced')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-sliders-h\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"flex-direction: column; align-items: stretch;\">\n                                <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-fire\" style=\"color: #e74c3c;\"></i> </span>\n                                    <label class=\"acu-toggle\" style=\"margin-left: auto;\">\n                                        <input type=\"checkbox\" id=\"cfg-crazy-mode-enabled\">\n                                        <span class=\"acu-toggle-slider\"></span>\n                                    </label>\n                                </div>\n                                <div id=\"crazy-level-container\" style=\"display: flex; align-items: center; gap: 10px; padding: 8px 0;\">\n                                    <span style=\"font-size: 12px; color: var(--acu-text-sub, #666);\">:</span>\n                                    <input type=\"range\" id=\"cfg-crazy-level\" min=\"0\" max=\"100\" value=\"50\" style=\"flex: 1; height: 6px;\">\n                                    <span id=\"cfg-crazy-level-value\" style=\"min-width: 40px; text-align: right; font-weight: bold; color: #e74c3c;\">50%</span>\n                                </div>\n                                <div style=\"font-size: 11px; color: var(--acu-text-sub, #888); line-height: 1.4; margin-top: 4px;\">\n                                    \n                                </div>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-dice-d20\"></i> </span>\n                                </div>\n                                <button id=\"cfg-attr-preset-manage\" class=\"acu-setting-action-btn\" style=\"width: auto; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-filter\"></i> </span>\n                                </div>\n                                <button id=\"cfg-blacklist-manage\" class=\"acu-setting-action-btn\" style=\"width: auto; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-bug\"></i> Debug</span>\n                                </div>\n                                <button id=\"btn-open-debug-console\" class=\"acu-setting-action-btn\" style=\"width: auto; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-terminal\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                </div><!--  .acu-settings-body -->\n            </div>\n        </div>\n    `);\n    $('body').append(dialog);\n\n    // ===  ===\n    dialog.find('.acu-settings-group-title').on('click', function () {\n      const $group = $(this).closest('.acu-settings-group');\n      const $body = $group.find('.acu-settings-group-body');\n\n      // \n      if ($body.hasClass('acu-animating')) return;\n\n      const groupId = $group.data('group');\n      const $chevron = $(this).find('.acu-group-chevron');\n      let expanded = Store.get('acu_settings_expanded', ['appearance']);\n\n      if ($group.hasClass('collapsed')) {\n        // \n        $group.removeClass('collapsed');\n        $chevron.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n        if (!expanded.includes(groupId)) expanded.push(groupId);\n\n        $body.addClass('acu-animating').show();\n        const targetHeight = $body.prop('scrollHeight');\n        $body.css('height', 0).animate({ height: targetHeight }, 180, function () {\n          $(this).css('height', '').removeClass('acu-animating');\n        });\n      } else {\n        // \n        $group.addClass('collapsed');\n        $chevron.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n        expanded = expanded.filter(id => id !== groupId);\n\n        const currentHeight = $body.outerHeight();\n        $body\n          .addClass('acu-animating')\n          .css('height', currentHeight)\n          .animate({ height: 0 }, 180, function () {\n            $(this).hide().css('height', '').removeClass('acu-animating');\n          });\n      }\n\n      Store.set('acu_settings_expanded', expanded);\n    });\n\n    // ===  ===\n    // \n    dialog.find('#cfg-theme').on('change', function () {\n      const newTheme = $(this).val();\n      saveConfig({ theme: newTheme });\n      dialog\n        .find('.acu-edit-dialog')\n        .removeClass(THEMES.map(t => `acu-theme-${t.id}`).join(' '))\n        .addClass(`acu-theme-${newTheme}`);\n\n      // \n      const t = getThemeColors();\n      dialog.find('#cfg-attr-preset-manage').css({\n        background: t.btnBg,\n        borderColor: t.border,\n        color: t.textMain,\n      });\n    });\n\n    // \n    dialog.find('#cfg-font-family').on('change', function () {\n      saveConfig({ fontFamily: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-attr-preset-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showAttributePresetManager();\n    });\n\n    // \n    const initCrazyModeUI = () => {\n      const crazyConfig = getCrazyModeConfig();\n      dialog.find('#cfg-crazy-mode-enabled').prop('checked', crazyConfig.enabled);\n      dialog.find('#cfg-crazy-level').val(crazyConfig.crazyLevel);\n      dialog.find('#cfg-crazy-level-value').text(crazyConfig.crazyLevel + '%');\n\n      // \n      dialog.find('#crazy-level-container').css('opacity', crazyConfig.enabled ? '1' : '0.5');\n\n      // \n      dialog.find('#cfg-crazy-mode-enabled').on('change', function () {\n        const enabled = $(this).prop('checked');\n        const currentConfig = getCrazyModeConfig();\n        saveCrazyModeConfig({ ...currentConfig, enabled });\n        dialog.find('#crazy-level-container').css('opacity', enabled ? '1' : '0.5');\n        if (enabled) {\n          toastr.success('');\n        } else {\n          toastr.info('');\n        }\n      });\n\n      // \n      dialog.find('#cfg-crazy-level').on('input', function () {\n        const level = parseInt($(this).val(), 10);\n        dialog.find('#cfg-crazy-level-value').text(level + '%');\n      });\n\n      // \n      dialog.find('#cfg-crazy-level').on('change', function () {\n        const level = parseInt($(this).val(), 10);\n        const currentConfig = getCrazyModeConfig();\n        saveCrazyModeConfig({ ...currentConfig, crazyLevel: level });\n      });\n    };\n    initCrazyModeUI();\n\n    // \n    dialog.find('#cfg-blacklist-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      showBlacklistManagerModal();\n    });\n\n    // \n    dialog.find('#cfg-layout').on('change', function () {\n      saveConfig({ layout: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-grid-cols').on('change', function () {\n      saveConfig({ gridColumns: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-position').on('change', function () {\n      saveConfig({ positionMode: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-action-pos').on('change', function () {\n      saveConfig({ actionsPosition: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-style').on('change', function () {\n      saveConfig({ collapseStyle: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-align').on('change', function () {\n      saveConfig({ collapseAlign: $(this).val() });\n      renderInterface();\n    });\n\n    // \n    dialog.find('#cfg-show-opt').on('change', function () {\n      const checked = $(this).is(':checked');\n      saveConfig({ showOptionPanel: checked });\n      if (checked) dialog.find('#row-auto-send').slideDown(200);\n      else dialog.find('#row-auto-send').slideUp(200);\n      renderInterface();\n    });\n    dialog.find('#cfg-auto-send').on('change', function () {\n      saveConfig({ clickOptionToAutoSend: $(this).is(':checked') });\n    });\n    dialog.find('#cfg-new').on('change', function () {\n      saveConfig({ highlightNew: $(this).is(':checked') });\n      renderInterface();\n    });\n\n    // === / ===\n    dialog.find('.acu-table-item-check').on('click', function (e) {\n      e.stopPropagation();\n      const $item = $(this).closest('.acu-table-manager-item');\n      const tableName = $item.data('table-name');\n      let hiddenList = getHiddenTables();\n      const $icon = $(this).find('i');\n\n      if (hiddenList.includes(tableName)) {\n        // \n        hiddenList = hiddenList.filter(n => n !== tableName);\n        $item.removeClass('hidden-table');\n        $icon.removeClass('fa-eye-slash').addClass('fa-eye');\n      } else {\n        // \n        hiddenList.push(tableName);\n        $item.addClass('hidden-table');\n        $icon.removeClass('fa-eye').addClass('fa-eye-slash');\n      }\n\n      saveHiddenTables(hiddenList);\n      renderInterface();\n    });\n\n    // ===  ===\n    const $list = dialog.find('#table-manager-list');\n    let dragState = {\n      isDragging: false,\n      element: null,\n      timer: null,\n      startY: 0,\n    };\n\n    const clearDragState = () => {\n      if (dragState.timer) {\n        clearTimeout(dragState.timer);\n        dragState.timer = null;\n      }\n      if (dragState.element) {\n        $(dragState.element).removeClass('acu-dragging');\n      }\n      $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n      dragState.isDragging = false;\n      dragState.element = null;\n    };\n\n    const startDrag = $item => {\n      dragState.isDragging = true;\n      dragState.element = $item[0];\n      $item.addClass('acu-dragging');\n    };\n\n    const finishDrag = () => {\n      if (!dragState.isDragging || !dragState.element) {\n        clearDragState();\n        return;\n      }\n\n      const $dragged = $(dragState.element);\n      const $target = $list.find('.acu-drag-above, .acu-drag-below').first();\n\n      if ($target.length && $target[0] !== dragState.element) {\n        if ($target.hasClass('acu-drag-above')) {\n          $dragged.insertBefore($target);\n        } else {\n          $dragged.insertAfter($target);\n        }\n\n        // \n        const newOrder = [];\n        $list.find('.acu-table-manager-item').each(function () {\n          newOrder.push($(this).data('table-name'));\n        });\n        saveTableOrder(newOrder);\n      }\n\n      clearDragState();\n    };\n\n    // \n    $list[0].addEventListener(\n      'pointerdown',\n      function (e) {\n        const handle = e.target.closest('.acu-table-item-handle');\n        if (!handle) return;\n\n        e.preventDefault();\n        const $item = $(handle).closest('.acu-table-manager-item');\n        dragState.startY = e.clientY;\n        startDrag($item);\n        handle.setPointerCapture(e.pointerId);\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerdown', function (e) {\n      const item = e.target.closest('.acu-table-manager-item');\n      if (!item) return;\n      // \n      if (e.target.closest('.acu-table-item-check, .acu-table-item-handle')) return;\n\n      dragState.startY = e.clientY;\n      const $item = $(item);\n\n      dragState.timer = setTimeout(() => {\n        startDrag($item);\n      }, 350);\n    });\n\n    // \n    $list[0].addEventListener(\n      'pointermove',\n      function (e) {\n        // \n        if (dragState.timer && Math.abs(e.clientY - dragState.startY) > 8) {\n          clearTimeout(dragState.timer);\n          dragState.timer = null;\n        }\n\n        if (!dragState.isDragging || !dragState.element) return;\n        e.preventDefault();\n\n        // \n        const items = $list.find('.acu-table-manager-item').not('.acu-dragging');\n        let targetItem = null;\n        let insertBefore = true;\n\n        items.each(function () {\n          const rect = this.getBoundingClientRect();\n          const midY = rect.top + rect.height / 2;\n\n          if (e.clientY < midY && !targetItem) {\n            targetItem = this;\n            insertBefore = true;\n          } else if (e.clientY >= rect.top && e.clientY <= rect.bottom) {\n            targetItem = this;\n            insertBefore = e.clientY < midY;\n          }\n        });\n\n        // \n        $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n        if (targetItem && targetItem !== dragState.element) {\n          $(targetItem).addClass(insertBefore ? 'acu-drag-above' : 'acu-drag-below');\n        }\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerup', finishDrag);\n    $list[0].addEventListener('pointercancel', clearDragState);\n\n    // \n    $list[0].addEventListener(\n      'touchmove',\n      function (e) {\n        if (dragState.isDragging) {\n          e.preventDefault();\n        }\n      },\n      { passive: false },\n    );\n\n    // === Stepper  ===\n    dialog.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        const unit = id === 'cfg-per-page' ? '' : 'px';\n        $value.text(newVal + unit);\n\n        // \n        if (id === 'cfg-width') {\n          $('.acu-wrapper').css('--acu-card-width', newVal + 'px');\n          saveConfig({ cardWidth: newVal });\n        } else if (id === 'cfg-font-main') {\n          $('.acu-wrapper').css('--acu-font-size', newVal + 'px');\n          saveConfig({ fontSize: newVal });\n        } else if (id === 'cfg-font-opt') {\n          $('.acu-wrapper, .acu-embedded-options-container').css('--acu-opt-font-size', newVal + 'px');\n          saveConfig({ optionFontSize: newVal });\n        } else if (id === 'cfg-per-page') {\n          saveConfig({ itemsPerPage: newVal });\n        }\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    // === /===\n    dialog.on('click', '.acu-rule-toggle', function (e) {\n      e.stopPropagation();\n      const $toggle = $(this);\n      const $item = $toggle.closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const $icon = $toggle.find('i');\n      const isCurrentlyActive = $toggle.hasClass('active');\n\n      // \n      ValidationRuleManager.toggleRuleEnabled(ruleId, !isCurrentlyActive);\n\n      //  UI\n      if (isCurrentlyActive) {\n        $toggle.removeClass('active');\n        $icon.removeClass('fa-toggle-on').addClass('fa-toggle-off');\n        $item.addClass('disabled');\n      } else {\n        $toggle.addClass('active');\n        $icon.removeClass('fa-toggle-off').addClass('fa-toggle-on');\n        $item.removeClass('disabled');\n      }\n    });\n\n    // ===  ===\n    dialog.on('click', '#validation-rules-list .acu-rule-edit', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const rule = ValidationRuleManager.getRule(ruleId);\n      if (!rule) return;\n\n      // \n      dialog.remove();\n      showAddValidationRuleModal(ruleId);\n    });\n\n    // === ===\n    dialog.on('click', '#validation-rules-list .acu-rule-delete', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const $item = $(this).closest('.acu-validation-rule-item');\n\n      if (confirm('')) {\n        if (ValidationRuleManager.removeCustomRule(ruleId)) {\n          $item.fadeOut(200, function () {\n            $(this).remove();\n          });\n        }\n      }\n    });\n\n    // === ===\n    dialog.on('click', '.acu-rule-intercept', function (e) {\n      e.stopPropagation();\n      const $btn = $(this);\n      const ruleId = $btn.data('rule-id');\n      const isCurrentlyActive = $btn.hasClass('active');\n\n      if (ValidationRuleManager.toggleRuleIntercept(ruleId, !isCurrentlyActive)) {\n        if (isCurrentlyActive) {\n          $btn.removeClass('active').attr('title', '');\n        } else {\n          $btn.addClass('active').attr('title', '');\n        }\n      }\n    });\n\n    // ===  ===\n    const refreshPresetUI = () => {\n      ValidationRuleManager.clearCache();\n      const rules = ValidationRuleManager.getAllRules();\n      let html = '';\n      rules.forEach(rule => {\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType] || { name: rule.ruleType, icon: 'fa-question' };\n        const isTableRule = typeInfo.scope === 'table';\n        const hasIntercept = rule.intercept;\n        html += `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo.icon}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n            </div>\n            <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n            <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n              <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>`;\n      });\n      dialog.find('#validation-rules-list').html(html);\n    };\n\n    // \n    dialog.find('#preset-select').on('change', function () {\n      if (PresetManager.setActivePreset($(this).val())) {\n        refreshPresetUI();\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-dup').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const newPreset = PresetManager.duplicatePreset(preset.id);\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-new').on('click', function () {\n      const name = prompt(':', '');\n      if (!name?.trim()) return;\n      const newPreset = PresetManager.createPreset(name.trim());\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-del').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      if (preset.id === 'default') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!confirm(`\"${preset.name}\"`)) return;\n      if (PresetManager.deletePreset(preset.id)) {\n        dialog.find(`#preset-select option[value=\"${preset.id}\"]`).remove();\n        dialog.find('#preset-select').val('default').trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-export').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const json = PresetManager.exportPreset(preset.id);\n      if (json) {\n        // \n        try {\n          const filename = `acu_validation_preset_${preset.name || preset.id}_${Date.now()}.json`;\n          const blob = new Blob([json], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = filename;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        } catch (e) {\n          //  Blob /\n          navigator.clipboard\n            .writeText(json)\n            .then(() => {})\n            .catch(() => {\n              prompt(':', json);\n            });\n        }\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-import').on('click', function () {\n      const json = prompt(' JSON:');\n      if (!json?.trim()) return;\n      const result = PresetManager.importPreset(json.trim(), false);\n      if (result && result.preset) {\n        const newPreset = result.preset;\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n        // \n        if (result.needsMerge) {\n          if (\n            confirm(\n              '\\n\\n',\n            )\n          ) {\n            if (PresetManager.mergePresetWithDefaults(newPreset.id)) {\n              if (window.toastr) window.toastr.success('');\n              refreshPresetUI();\n            } else {\n              if (window.toastr) window.toastr.error('');\n            }\n          }\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-reset').on('click', function () {\n      if (!confirm('\\n')) return;\n      if (PresetManager.resetDefaultPreset()) {\n        // \n        if (PresetManager.getActivePreset()?.id === 'default') {\n          refreshPresetUI();\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // === :/ ===\n    dialog.on('click', '#regex-rules-list .acu-rule-toggle', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const currentState = RegexTransformationManager.getAllRules().find(r => r.id === ruleId)?.enabled;\n      const newState = !currentState;\n      const rule = RegexTransformationManager.getRule(ruleId);\n\n      RegexTransformationManager.toggleRuleEnabled(ruleId, newState);\n\n      if (newState) {\n        toastr.success('');\n      } else {\n        toastr.info('');\n      }\n\n      refreshRegexRulesList(); // [] ,\n    });\n\n    // ===  ===\n    dialog.on('click', '#regex-rules-list .acu-rule-edit', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const rule = RegexTransformationManager.getRule(ruleId);\n      if (!rule) return;\n\n      // \n      dialog.remove();\n      showAddRegexRuleModal(ruleId);\n    });\n\n    // === : ===\n    dialog.on('click', '#regex-rules-list .acu-rule-delete', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const rule = RegexTransformationManager.getRule(ruleId);\n      if (!rule) return;\n\n      if (confirm(`\"${rule.name}\"`)) {\n        RegexTransformationManager.removeRule(ruleId);\n        refreshRegexRulesList(); // [] ,\n        toastr.success('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#regex-preset-select').on('change', function () {\n      const presetId = $(this).val();\n      RegexPresetManager.setActivePreset(String(presetId));\n\n      toastr.success('');\n\n      refreshRegexRulesList(); // [] ,\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-dup').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      const name = prompt(':', `${currentPreset.name} ()`);\n      if (!name) return;\n\n      const newPreset = RegexPresetManager.createPreset(name, currentPreset.id);\n      if (newPreset) {\n        // [] \n        const $presetSelect = dialog.find('#regex-preset-select');\n        $presetSelect.append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        $presetSelect.val(newPreset.id);\n\n        refreshRegexRulesList(); // \n        toastr.success('');\n      } else {\n        toastr.error('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-new').on('click', function () {\n      const name = prompt(':');\n      if (!name) return;\n\n      const newPreset = RegexPresetManager.createPreset(name, null);\n      if (newPreset) {\n        RegexPresetManager.setActivePreset(newPreset.id);\n\n        // [] \n        const $presetSelect = dialog.find('#regex-preset-select');\n        $presetSelect.append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        $presetSelect.val(newPreset.id);\n\n        refreshRegexRulesList(); // \n        toastr.success('');\n      } else {\n        toastr.error('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-del').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      if (confirm(`\"${currentPreset.name}\"`)) {\n        const success = RegexPresetManager.deletePreset(currentPreset.id);\n        if (success) {\n          // [] \n          const $presetSelect = dialog.find('#regex-preset-select');\n          $presetSelect.find(`option[value=\"${currentPreset.id}\"]`).remove();\n\n          // \n          const defaultPresetId = RegexPresetManager.getActivePreset()?.id;\n          if (defaultPresetId) {\n            $presetSelect.val(defaultPresetId);\n          }\n\n          refreshRegexRulesList(); // \n          toastr.success('');\n        } else {\n          toastr.error('');\n        }\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-export').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      const json = RegexPresetManager.exportPreset(currentPreset.id);\n      if (json) {\n        const blob = new Blob([json], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `regex-preset-${currentPreset.name}-${Date.now()}.json`;\n        a.click();\n        URL.revokeObjectURL(url);\n        toastr.success('');\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-import').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = 'application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const text = await file.text();\n          const preset = RegexPresetManager.importPreset(text);\n          if (preset) {\n            // [] \n            const $presetSelect = dialog.find('#regex-preset-select');\n            $presetSelect.append(`<option value=\"${escapeHtml(preset.id)}\">${escapeHtml(preset.name)}</option>`);\n            $presetSelect.val(preset.id);\n\n            refreshRegexRulesList(); // \n            toastr.success('');\n          } else {\n            toastr.error('');\n          }\n        } catch (err) {\n          toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // === : ===\n    dialog.find('#btn-add-regex-rule').on('click', function () {\n      dialog.remove();\n      isSettingsOpen = false;\n      showAddRegexRuleModal();\n    });\n\n    // === [] : ===\n    dialog.find('#btn-execute-regex-now').on('click', async function () {\n      const $btn = $(this);\n      const originalHtml = $btn.html();\n\n      try {\n        // \n        $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n\n        // \n        let tableData = cachedRawData || getTableData();\n\n        if (!tableData) {\n          toastr.error('');\n          return;\n        }\n\n        // \n        if (typeof tableData !== 'object' || Array.isArray(tableData)) {\n          toastr.error('');\n          console.error('[DICE]:', typeof tableData, Array.isArray(tableData));\n          return;\n        }\n\n        // \n        const enabledRules = RegexTransformationManager.getEnabledRules();\n\n        if (enabledRules.length === 0) {\n          toastr.warning('');\n          return;\n        }\n\n        console.info(`[DICE] ${enabledRules.length} ...`);\n\n        // \n        const { totalApplied, errors } = RegexTransformationEngine.applyToTable(tableData, enabledRules);\n\n        // \n        cachedRawData = tableData;\n\n        // \n        await saveDataToDatabase(tableData, false, false);\n\n        if (errors.length > 0) {\n          toastr.warning(` ${totalApplied} ${errors.length} `);\n          console.warn('[DICE]:', errors);\n        } else {\n          toastr.success(` ${totalApplied} `);\n        }\n\n        console.info('[DICE]');\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : String(e);\n        console.error('[DICE]:', e);\n        toastr.error(`: ${errorMsg}`);\n      } finally {\n        // \n        $btn.prop('disabled', false).html(originalHtml);\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-add-validation-rule').on('click', function () {\n      showAddValidationRuleModal(dialog);\n    });\n\n    // === Debug ===\n    dialog.find('#btn-open-debug-console').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showDebugConsoleModal();\n    });\n\n    // ===  ===\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n      renderInterface();\n    };\n    dialog.on('click', '#dlg-close-x, .acu-settings-header .acu-close-btn', closeDialog);\n\n    // \n    dialog.on('click', '#acu-help-btn', function (e) {\n      e.stopPropagation();\n      window.open('https://jerryzmtz.github.io/DiceSystemManual//', '_blank');\n    });\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n  };\n\n  // [] \n  let renderInterfaceTimer = null;\n  let renderInterfacePending = false;\n\n  const renderInterface = () => {\n    // \n    if (isSettingsOpen) {\n      if (!renderInterfacePending) {\n        console.info('[DICE]');\n        renderInterfacePending = true;\n      }\n      return;\n    }\n\n    // \n    if (renderInterfaceTimer) {\n      clearTimeout(renderInterfaceTimer);\n    }\n\n    // 50ms\n    renderInterfaceTimer = setTimeout(() => {\n      renderInterfaceTimer = null;\n      renderInterfacePending = false;\n      _renderInterfaceImpl();\n    }, 50);\n  };\n\n  // \n  const _renderInterfaceImpl = () => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n\n    // [] Observer  ()\n    if (!observer && $('#chat').length) {\n      const $chat = $('#chat');\n      let mutationLock = false;\n      const handleMutation = () => {\n        if (mutationLock) return;\n        mutationLock = true;\n        requestAnimationFrame(() => {\n          const config = getConfig();\n          if (config.positionMode === 'embedded') {\n            mutationLock = false;\n            return;\n          }\n          const children = $chat.children();\n          const lastChild = children.last()[0];\n          const wrapper = $('.acu-wrapper')[0];\n          if (wrapper && lastChild && lastChild !== wrapper) {\n            if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n              $chat.append(wrapper);\n            }\n          }\n\n          // [] \n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            // 1\n            const children = $chat.children();\n            const lastChild = children.last();\n            if (lastChild.hasClass('mes') || lastChild.hasClass('message-body')) {\n              lastChild.addClass('acu-dice-result-revealing');\n            }\n\n            // 2RAF\n            requestAnimationFrame(() => {\n              hideDiceResultsInUserMessages();\n\n              // 3\n              requestAnimationFrame(() => {\n                lastChild.removeClass('acu-dice-result-revealing').addClass('acu-dice-result-revealed');\n                // \n                setTimeout(() => {\n                  lastChild.removeClass('acu-dice-result-revealed');\n                }, 200);\n              });\n            });\n          }\n\n          mutationLock = false;\n        });\n      };\n      observer = new MutationObserver(handleMutation);\n      observer.observe($chat[0], { childList: true });\n    }\n    let rawData;\n    let isDataFromDatabase = false; // \n    if (hasUnsavedChanges && cachedRawData) {\n      rawData = cachedRawData;\n    } else {\n      rawData = getTableData();\n      isDataFromDatabase = true; // \n\n      // [] \n      if (rawData) {\n        let anyLockApplied = false;\n        for (const sheetId in rawData) {\n          if (!sheetId.startsWith('sheet_')) continue;\n          const sheet = rawData[sheetId];\n          if (!sheet || !sheet.name || !sheet.content) continue;\n\n          const result = LockManager.applyLocks(sheet.name, sheet.content);\n          if (result.modified) {\n            anyLockApplied = true;\n          }\n          if (result.restored.length > 0) {\n          }\n        }\n        if (anyLockApplied) {\n        }\n      }\n\n      // [] auto\n      // \n      // \n      if (rawData && !isAutoTransforming && isDataFromDatabase) {\n        try {\n          const enabledRules = RegexTransformationManager.getEnabledRules();\n\n          if (enabledRules.length > 0) {\n            console.info(`[DICE] ${enabledRules.length} ...`);\n\n            isAutoTransforming = true; // \n            const transformResult = RegexTransformationEngine.applyToTable(rawData, enabledRules);\n            if (transformResult.totalApplied > 0) {\n              console.info(`[DICE] ${transformResult.totalApplied} `);\n\n              // \n              //  saveDataOnly \n              // saveDataOnly  UpdateController.handleUpdate() isAutoTransforming \n              // \n              saveDataOnly(rawData).catch(err => {\n                console.warn('[DICE]:', err);\n              });\n            }\n            if (transformResult.errors.length > 0) {\n              console.warn(`[DICE] ${transformResult.errors.length} :`, transformResult.errors);\n            } else if (transformResult.totalApplied === 0) {\n              console.info('[DICE]');\n            }\n            isAutoTransforming = false; // \n          } else {\n            isAutoTransforming = false; // \n          }\n        } catch (transformError) {\n          isAutoTransforming = false; // \n          const errorMsg = transformError instanceof Error ? transformError.message : String(transformError);\n          console.error('[DICE]:', transformError);\n        }\n      }\n\n      if (rawData) {\n        cachedRawData =\n          typeof structuredClone === 'function' ? structuredClone(rawData) : JSON.parse(JSON.stringify(rawData));\n\n        const existingSnapshot = loadSnapshot();\n        const currentCtx = getCurrentContextFingerprint();\n\n        // \n        const hasValidSnapshotData =\n          existingSnapshot && Object.keys(existingSnapshot).some(k => k.startsWith('sheet_'));\n\n        if (!existingSnapshot || !hasValidSnapshotData) {\n          // 1    \n          saveSnapshot({ ...cachedRawData, _contextId: currentCtx });\n        } else if (!existingSnapshot._contextId) {\n          // 2 ID \n          saveSnapshot({ ...existingSnapshot, _contextId: currentCtx });\n        } else if (existingSnapshot._contextId !== currentCtx) {\n          // 3  \n          cachedRawData._contextId = currentCtx;\n          saveSnapshot(cachedRawData);\n        }\n        // 4  \n      }\n    }\n\n    const $searchInput = $('.acu-search-input');\n    if ($('.acu-wrapper').length && $searchInput.is(':focus')) {\n      if (rawData) {\n        if (!isSaving) currentDiffMap = generateDiffMap(rawData);\n        const tables = processJsonData(rawData);\n        const activeTab = getActiveTabState();\n        const currentTabName = activeTab && tables[activeTab] ? activeTab : null;\n\n        if (currentTabName && tables[currentTabName]) {\n          const newHtml = renderTableContent(tables[currentTabName], currentTabName);\n          const $virtualDom = $('<div>').html(newHtml);\n          $('.acu-card-grid').replaceWith($virtualDom.find('.acu-card-grid'));\n          $('.acu-panel-title').html($virtualDom.find('.acu-panel-title').html());\n          // [] \n          bindEvents(tables);\n          bindOptionEvents(); // <--- \n          return;\n        }\n      }\n    }\n\n    let lastScrollX = 0;\n    let lastScrollY = 0;\n\n    const $oldContent = $('.acu-panel-content');\n    if ($oldContent.length) {\n      lastScrollX = $oldContent.scrollLeft();\n      lastScrollY = $oldContent.scrollTop();\n    }\n\n    $('.acu-wrapper').remove();\n    const tables = processJsonData(rawData || {});\n\n    if (isSaving) {\n      currentDiffMap = new Set();\n    } else {\n      currentDiffMap = generateDiffMap(rawData);\n    }\n\n    const savedOrder = getSavedTableOrder();\n    let orderedNames = Object.keys(tables);\n    if (savedOrder)\n      orderedNames = savedOrder.filter(n => tables[n]).concat(orderedNames.filter(n => !savedOrder.includes(n)));\n\n    const hiddenList = getHiddenTables();\n    orderedNames = orderedNames.filter(n => !hiddenList.includes(n));\n\n    const activeTab = getActiveTabState();\n    let currentTabName = activeTab && tables[activeTab] && !hiddenList.includes(activeTab) ? activeTab : null;\n\n    const config = getConfig();\n    const isCollapsed = getCollapsedState();\n\n    const layoutClass = config.layout === 'vertical' ? 'acu-layout-vertical' : '';\n    // []  (/)\n    const positionClass = `acu-mode-${config.positionMode || 'fixed'}`;\n\n    // []  () \n    let finalGridCols = config.gridColumns;\n    if (finalGridCols === 'auto') {\n      const n = orderedNames.length;\n\n      if (n <= 4) {\n        finalGridCols = n < 2 ? 2 : n;\n      } else {\n        const empty3 = Math.ceil(n / 3) * 3 - n;\n        const empty4 = Math.ceil(n / 4) * 4 - n;\n        finalGridCols = empty4 <= empty3 ? 4 : 3;\n      }\n    }\n\n    // --- []  +  ---\n    let optionHtml = '';\n    let currentOptionHash = null; // \n\n    if (config.showOptionPanel !== false) {\n      const optionTables = [];\n      Object.keys(tables).forEach(k => {\n        if (k.includes('')) optionTables.push(tables[k]);\n      });\n\n      // [] \n      if (optionTables.length > 0) {\n        const isCollapsed = getCollapsedState();\n        const eyeIcon = isCollapsed ? 'fa-eye-slash' : 'fa-eye';\n        const eyeTitle = isCollapsed ? '' : '';\n        // \n        let buttonsHtml = `\n                    <div class=\"acu-opt-header\" style=\"position:relative;\">\n                        \n                        <i class=\"fa-solid ${eyeIcon} acu-nav-toggle-btn\"\n                           style=\"position:absolute; right:6px; top:50%; transform:translateY(-50%); cursor:pointer; opacity:0.6;\"\n                           title=\"${eyeTitle}\"></i>\n                    </div>`;\n        let hasBtns = false;\n        // []\n        let optionValues = []; // \n\n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  const cellStr = String(cell).trim();\n                  buttonsHtml += `<button class=\"acu-opt-btn\" data-val=\"${encodeURIComponent(cellStr)}\">${escapeHtml(cellStr)}</button>`;\n                  optionValues.push(cellStr);\n                  hasBtns = true;\n                }\n              });\n            });\n          }\n        });\n\n        if (hasBtns) {\n          optionHtml = `<div class=\"acu-option-panel\">${buttonsHtml}</div>`;\n          //  ()\n          // [] \n          currentOptionHash = optionValues.join('|||') + (isCollapsed ? '_collapsed' : '_expanded');\n        }\n      }\n    }\n\n    // [] \n    const optionChanged = currentOptionHash !== lastOptionHash;\n    if (optionChanged && currentOptionHash !== null) {\n      // \n      optionPanelVisible = true;\n    }\n    lastOptionHash = currentOptionHash; // \n\n    let html = `<div class=\"acu-wrapper ${positionClass} acu-theme-${config.theme} ${layoutClass}\" style=\"--acu-card-width:${config.cardWidth}px; --acu-font-size:${config.fontSize}px; --acu-opt-font-size:${config.optionFontSize || 12}px; --acu-grid-cols:${finalGridCols}\">`;\n\n    // []  DOM  column-reverse\n    // []  optionPanelVisible \n    if (config.positionMode === 'embedded' && optionHtml && optionPanelVisible) {\n      html += optionHtml;\n    }\n\n    if (isCollapsed) {\n      const colStyleClass = `acu-col-${config.collapseStyle || 'bar'}`;\n      const alignClass = `acu-align-${config.collapseAlign || 'right'}`;\n      html += `\n                <div class=\"acu-expand-trigger ${colStyleClass} ${alignClass}\" id=\"acu-btn-expand\">\n                    <i class=\"fa-solid fa-table\"></i> <span> (${Object.keys(tables).length})</span>\n                </div>\n            `;\n    } else {\n      // [] \n      const savedHeight = currentTabName ? getTableHeights()[currentTabName] : null;\n      // [] \n      const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n      const isChangesPanelActive = Store.get('acu_changes_panel_active', false);\n      const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n      const mvuSavedHeight = isMvuActive ? getTableHeights()[MvuModule.MODULE_ID] : null;\n      const finalSavedHeight = mvuSavedHeight || savedHeight;\n      const shouldShowPanel = isDashboardActive || isChangesPanelActive || isMvuActive || currentTabName;\n\n      html += `\n                <div class=\"acu-data-display ${shouldShowPanel ? 'visible' : ''} ${finalSavedHeight ? 'acu-manual-mode' : ''}\" id=\"acu-data-area\" style=\"${finalSavedHeight ? 'height:' + finalSavedHeight + 'px;' : ''}\">\n                    ${\n                      isChangesPanelActive\n                        ? renderChangesPanel(rawData)\n                        : isDashboardActive\n                          ? renderDashboard(tables)\n                          : isMvuActive\n                            ? '<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>'\n                            : currentTabName\n                              ? renderTableContent(tables[currentTabName], currentTabName)\n                              : ''\n                    }\n                </div>\n                `;\n\n      // [] \n      // PC(>768px) CSS display:flex !important grid \n      const gridFixStyle = `grid-template-columns: repeat(${finalGridCols}, 1fr);`;\n\n      html += `\n                <div class=\"acu-nav-container ${config.actionsPosition === 'top' ? 'acu-pos-top' : ''}\" id=\"acu-nav-bar\" style=\"${gridFixStyle}\">\n                    <div class=\"acu-order-controls\" id=\"acu-order-hint\"><i class=\"fa-solid fa-arrows-alt\"></i> </div>\n            `;\n\n      // ===  +  ===\n      const isChangesActive = Store.get('acu_changes_panel_active', false);\n      const isSimpleModeNav = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n      let changesCount = 0;\n      let validationErrorCount = 0;\n      if (rawData) {\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          for (const sheetId in rawData) {\n            if (!sheetId.startsWith('sheet_')) continue;\n            const newSheet = rawData[sheetId];\n            const oldSheet = snapshot[sheetId];\n            if (!newSheet?.content) continue;\n            const newRows = newSheet.content.slice(1);\n            const oldRows = oldSheet?.content?.slice(1) || [];\n            newRows.forEach((row, rowIdx) => {\n              const oldRow = oldRows[rowIdx];\n              if (!oldRow) {\n                changesCount++;\n                return;\n              }\n              row.forEach((cell, colIdx) => {\n                if (colIdx === 0) return;\n                if (String(cell ?? '') !== String(oldRow[colIdx] ?? '')) changesCount++;\n              });\n            });\n            if (oldRows.length > newRows.length) changesCount += oldRows.length - newRows.length;\n          }\n          for (const sheetId in snapshot) {\n            if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n          }\n        }\n        // \n        validationErrorCount = ValidationEngine.getErrorCount(rawData);\n      }\n      // \n      const isValidationMode = isSimpleModeNav;\n      const displayCount = isValidationMode ? validationErrorCount : changesCount;\n      // \n      const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n      // ===  ===\n      const navHiddenList = getHiddenTables();\n      const navSavedOrder = getSavedTableOrder() || [];\n\n      //  + \n      const SPECIAL_NAV_ITEMS = [\n        { key: '__dice__', icon: 'fa-dice-d20', label: '', id: 'acu-btn-dice-nav', extraClass: 'acu-dice-nav-btn' },\n        {\n          key: '__changes__',\n          icon: 'fa-code-compare',\n          label: `${displayCount > 0 ? '(' + displayCount + ')' : ''}`,\n          id: 'acu-btn-changes',\n          extraClass: `acu-changes-btn${showWarningIcon ? ' has-validation-errors' : ''}`,\n          isActive: isChangesActive,\n          warningIcon: showWarningIcon,\n        },\n        {\n          key: '__mvu__',\n          icon: 'fa-code-branch',\n          label: '',\n          id: 'acu-btn-mvu',\n          extraClass: 'acu-mvu-btn',\n          isActive: getActiveTabState() === MvuModule.MODULE_ID,\n        },\n      ];\n\n      // \n      let allNavItems = [];\n\n      // \n      SPECIAL_NAV_ITEMS.forEach(item => {\n        // \n        if (navHiddenList.includes(item.key)) return;\n\n        // MVU\n        if (item.key === '__mvu__') {\n          allNavItems.push({ ...item, isSpecial: true });\n          return;\n        }\n\n        // checkAvailable\n        if (item.checkAvailable && !item.checkAvailable()) return;\n        allNavItems.push({ ...item, isSpecial: true });\n      });\n\n      // \n      orderedNames.forEach(name => {\n        allNavItems.push({\n          key: name,\n          icon: getIconForTableName(name),\n          label: name,\n          isSpecial: false,\n          isActive: !isDashboardActive && !isChangesActive && currentTabName === name,\n        });\n      });\n\n      // \n      if (navSavedOrder.length > 0) {\n        const orderMap = new Map(navSavedOrder.map((k, i) => [k, i]));\n        allNavItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      // [] /\n      // order  1  Grid \n      html += `<button class=\"acu-nav-btn acu-dashboard-btn ${isDashboardActive ? 'active' : ''}\" id=\"acu-btn-dashboard\" style=\"order: 1;\">\n                <i class=\"fa-solid fa-chart-line\"></i><span></span>\n            </button>`;\n\n      // order  2 \n      allNavItems.forEach((item, idx) => {\n        const activeClass = item.isActive ? 'active' : '';\n        const extraClass = item.extraClass || '';\n        const orderVal = idx + 2; //  2  1\n\n        if (item.isSpecial) {\n          // \n          const warningIconHtml = item.warningIcon\n            ? '<i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>'\n            : '';\n          html += `<button class=\"acu-nav-btn ${extraClass} ${activeClass}\" id=\"${item.id}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>${warningIconHtml}\n                    </button>`;\n        } else {\n          // \n          html += `<button class=\"acu-nav-btn ${activeClass}\" data-table=\"${escapeHtml(item.key)}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>\n                    </button>`;\n        }\n      });\n      // order \n      html += `<div class=\"acu-actions-group\" id=\"acu-active-actions\" style=\"order: 9999;\">`;\n      ACTION_BUTTONS.forEach(btn => {\n        html += `<button class=\"acu-action-btn\" id=\"${btn.id}\" title=\"${btn.title}\"><i class=\"fa-solid ${btn.icon}\"></i></button>`;\n      });\n      html += `</div>`;\n\n      html += `</div>`; //  acu-nav-container\n    }\n\n    html += `</div>`; //  acu-wrapper\n\n    const $existing = $('.acu-wrapper');\n    if ($existing.length) {\n      $existing.replaceWith(html);\n    } else {\n      insertHtmlToPage(html);\n    }\n\n    // --- []  ---\n    if (config.positionMode !== 'embedded' && optionHtml && optionPanelVisible) {\n      if (optionChanged) {\n        //  AI \n        injectIndependentOptions(optionHtml);\n      } else {\n        // \n        const $existing = $('.acu-embedded-options-container');\n        if ($existing.length === 0) {\n          // \n          injectIndependentOptions(optionHtml);\n        }\n        // \n      }\n    } else if (config.positionMode !== 'embedded') {\n      // \n      $('.acu-embedded-options-container').remove();\n    } else {\n      // [] \n      $('.acu-embedded-options-container').remove();\n    }\n\n    bindEvents(tables);\n    bindOptionEvents();\n    updateSaveButtonState();\n    // [] \n    if (Store.get('acu_changes_panel_active', false)) {\n      bindChangesEvents();\n    }\n    // [] \n    if (getActiveTabState() === MvuModule.MODULE_ID) {\n      const $panel = $('#acu-data-area');\n      if ($panel.length) {\n        // \n        // \n        // \n        $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n        MvuModule.bindEvents($panel);\n\n        // \n        MvuModule.getDataWithRetry(5, 800)\n          .then(mvuData => {\n            // \n            if (mvuData) {\n              $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n              MvuModule.bindEvents($panel);\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error getting data:', err);\n            // \n            $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n            MvuModule.bindEvents($panel);\n          });\n      }\n    }\n\n    setTimeout(() => {\n      const $newContent = $('.acu-panel-content');\n      const activeTab = getActiveTabState();\n      const savedState = tableScrollStates[activeTab];\n\n      if ($newContent.length) {\n        // 1. \n        //  savedState () lastScrollY ()\n        if (savedState) {\n          $newContent.scrollTop(savedState.top);\n          $newContent.scrollLeft(savedState.left);\n        } else {\n          if (lastScrollY > 0) $newContent.scrollTop(lastScrollY);\n          if (lastScrollX > 0) $newContent.scrollLeft(lastScrollX);\n        }\n\n        // 2.  ()\n        if (savedState && savedState.inner) {\n          Object.keys(savedState.inner).forEach(key => {\n            const scrollTop = savedState.inner[key];\n            // \n            const $targetTitle = $newContent.find(`.acu-editable-title[data-row=\"${key}\"]`);\n            if ($targetTitle.length) {\n              const $card = $targetTitle.closest('.acu-data-card');\n              //  ( overflow on card)\n              $card.scrollTop(scrollTop);\n              //  body  ( overflow on body)\n              $card.find('.acu-card-body').scrollTop(scrollTop);\n            }\n          });\n        }\n      }\n    }, 0);\n    console.info('[DICE]');\n  };\n\n  // [] \n  const injectIndependentOptions = htmlContent => {\n    const { $ } = getCore();\n    $('.acu-embedded-options-container').remove();\n\n    //  AI \n    const getTargetContainer = () => {\n      const $allMes = $('#chat .mes');\n      const $aiMes = $allMes.filter(function () {\n        const $this = $(this);\n        if ($this.attr('is_user') === 'true' || $this.attr('is_system') === 'true' || $this.hasClass('sys_mes'))\n          return false;\n        //  data-is-system \n        if ($this.find('.name_text').text().trim() === 'System' || $this.attr('data-is-system') === 'true')\n          return false;\n        // [] \n        if ($this.find('.mes_text').length === 0) return false;\n        if ($this.css('display') === 'none') return false;\n        return true;\n      });\n      if ($aiMes.length === 0) return null;\n\n      const $targetMes = $aiMes.last();\n      const $targetBlock = $targetMes.find('.mes_block');\n      return $targetBlock.length ? $targetBlock : $targetMes;\n    };\n\n    const $target = getTargetContainer();\n    if ($target && $target.length) {\n      const optConfig = getConfig();\n      const $container = $(\n        `<div class=\"acu-embedded-options-container acu-theme-${optConfig.theme}\" style=\"--acu-opt-font-size:${optConfig.optionFontSize || 12}px;\"></div>`,\n      );\n      $container.html(htmlContent);\n      $target.append($container);\n    }\n  };\n\n  // []  ( + )\n  const bindOptionEvents = () => {\n    const { $ } = getCore();\n    //  Body \n    $('body')\n      .off('click.acu_opt')\n      .on('click.acu_opt', '.acu-opt-btn', async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const config = getConfig();\n        const val = decodeURIComponent($(this).data('val'));\n\n        // 1:  -> \n        if (!config.clickOptionToAutoSend) {\n          smartInsertToTextarea(val, 'action');\n          $('#send_textarea').focus();\n          return;\n        }\n\n        // 2: \n        // A: TavernHelper ( refresh: 'affected' )\n        if (window.TavernHelper) {\n          try {\n            // 1.  createChatMessages \n            if (window.TavernHelper.createChatMessages) {\n              await window.TavernHelper.createChatMessages(\n                [\n                  {\n                    role: 'user',\n                    message: val,\n                  },\n                ],\n                {\n                  //  TavernHelper \n                  refresh: 'affected',\n                },\n              );\n\n              // 2. \n              if (window.TavernHelper.triggerSlash) {\n                await window.TavernHelper.triggerSlash('/trigger');\n              }\n              return;\n            }\n          } catch (err) {\n            console.warn('[DICE]ACU TavernHelper ', err);\n          }\n        }\n\n        // B: SillyTavern  (Slash Command)\n        const ST = window.SillyTavern || window.parent?.SillyTavern;\n        if (ST && ST.executeSlashCommandsWithOptions) {\n          try {\n            //  raw=true  ( slash_command.txt)\n            const safeVal = val.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n            const cmd = `/send raw=true \"${safeVal}\"`;\n\n            const sendResult = await ST.executeSlashCommandsWithOptions(cmd);\n\n            if (!sendResult.isError && !sendResult.isAborted) {\n              await ST.executeSlashCommandsWithOptions('/trigger');\n              return;\n            }\n            console.warn('[DICE]ACU ST send :', sendResult);\n          } catch (err) {\n            console.warn('[DICE]ACU ST', err);\n          }\n        }\n\n        // C:  +  ()\n        const ta = $('#send_textarea');\n        if (ta.length) {\n          ta.val(val);\n          ta.trigger('input').trigger('change');\n          //  React \n          await new Promise(r => setTimeout(r, 50));\n          const sendBtn = $('#send_but').filter(':visible');\n          if (sendBtn.length) {\n            sendBtn[0].click();\n          } else {\n            // \n            const enterEvent = $.Event('keydown', { keyCode: 13, which: 13, bubbles: true });\n            ta.trigger(enterEvent);\n          }\n        }\n      });\n  };\n\n  const insertHtmlToPage = html => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // ---  ---\n\n    // 1.  (Embedded) v19 \n    if (config.positionMode === 'embedded') {\n      $('.acu-wrapper').remove(); // \n\n      const getTargetContainer = () => {\n        const $allMes = $('#chat .mes');\n        const $aiMes = $allMes.filter(function () {\n          const $this = $(this);\n          if ($this.attr('is_user') === 'true') return false;\n          if ($this.attr('is_system') === 'true') return false;\n          if ($this.hasClass('sys_mes')) return false;\n          const name = $this.find('.name_text').text().trim();\n          if (name === 'System') return false;\n          if ($this.css('display') === 'none') return false;\n          const $textDiv = $this.find('.mes_text');\n          if ($textDiv.length === 0) return false;\n          const textContent = $textDiv.text().trim();\n          const hasImage = $textDiv.find('img').length > 0;\n          if (textContent.length === 0 && !hasImage) return false;\n          return true;\n        });\n        //  AI  chat\n        if ($aiMes.length === 0) return $('#chat');\n\n        // \n\n        let targetIndex = $aiMes.length - 1;\n        const $targetMes = $aiMes.eq(targetIndex);\n        const $targetBlock = $targetMes.find('.mes_block');\n        return $targetBlock.length ? $targetBlock : $targetMes;\n      };\n\n      const $target = getTargetContainer();\n      if ($target.length) {\n        if ($target.hasClass('mes_block') || $target.hasClass('mes')) {\n          if ($target.find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          } else {\n            $target.find('.acu-wrapper').replaceWith(html);\n          }\n        } else {\n          // Fallback\n          if ($('#chat').find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          }\n        }\n      } else {\n        $('body').append(html);\n      }\n      return;\n    }\n\n    // 2.  (Fixed) B \n    // \n    const $chat = $('#chat');\n    const $oldWrapper = $('.acu-wrapper');\n\n    if ($oldWrapper.length) {\n      $oldWrapper.replaceWith(html);\n    } else {\n      if ($chat.length) {\n        $chat.append(html);\n      } else {\n        $('body').append(html);\n      }\n    }\n  };\n  // [] \n  const renderChangesPanel = rawData => {\n    const snapshot = loadSnapshot();\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // \n    const validationErrors = rawData ? ValidationEngine.validateAllData(rawData) : [];\n\n    if (!snapshot || !rawData) {\n      // \n      if (validationErrors.length === 0) {\n        return `\n                <div class=\"acu-panel-header\">\n                    <div class=\"acu-panel-title\">\n                        <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-compare\"></i> <span class=\"acu-title-text\"></span></div>\n                        <div class=\"acu-title-sub\"></div>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-panel-content\" style=\"display:flex;align-items:center;justify-content:center;\">\n                    <div class=\"acu-empty-hint\"></div>\n                </div>`;\n      }\n    }\n\n    // \n    const changes = [];\n\n    for (const sheetId in rawData) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      const newSheet = rawData[sheetId];\n      const oldSheet = snapshot[sheetId];\n      if (!newSheet?.name || !newSheet?.content) continue;\n\n      const tableName = newSheet.name;\n      const headers = newSheet.content[0] || [];\n      const newRows = newSheet.content.slice(1);\n      const oldRows = oldSheet?.content?.slice(1) || [];\n\n      // \n      newRows.forEach((row, rowIdx) => {\n        const oldRow = oldRows[rowIdx];\n\n        if (!oldRow) {\n          // \n          changes.push({\n            type: 'row_added',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: rowIdx,\n            headers,\n            row,\n            title: row[1] || ` ${rowIdx + 1}`,\n          });\n        } else {\n          // \n          const rowChanges = [];\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return; // \n            const oldVal = String(oldRow[colIdx] ?? '');\n            const newVal = String(cell ?? '');\n            if (oldVal !== newVal) {\n              rowChanges.push({\n                colIndex: colIdx,\n                header: headers[colIdx] || `${colIdx}`,\n                oldValue: oldVal,\n                newValue: newVal,\n              });\n            }\n          });\n\n          if (rowChanges.length === 1) {\n            // \n            const c = rowChanges[0];\n            changes.push({\n              type: 'cell_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              colIndex: c.colIndex,\n              header: c.header,\n              oldValue: c.oldValue,\n              newValue: c.newValue,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          } else if (rowChanges.length > 1) {\n            // \n            changes.push({\n              type: 'row_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              headers,\n              row,\n              oldRow,\n              changedFields: rowChanges,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          }\n        }\n      });\n\n      // \n      if (oldRows.length > newRows.length) {\n        for (let i = newRows.length; i < oldRows.length; i++) {\n          const oldRow = oldRows[i];\n          changes.push({\n            type: 'row_deleted',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: i,\n            headers,\n            row: oldRow,\n            title: oldRow[1] || ` ${i + 1}`,\n          });\n        }\n      }\n    }\n\n    // \n    for (const sheetId in snapshot) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      if (!rawData[sheetId]) {\n        const oldSheet = snapshot[sheetId];\n        changes.push({\n          type: 'table_deleted',\n          tableName: oldSheet?.name || sheetId,\n          tableKey: sheetId,\n        });\n      }\n    }\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n\n    // \n    const panelTitle = isValidationMode ? '' : '';\n    const panelIcon = isValidationMode ? 'fa-shield-halved' : 'fa-code-compare';\n    const toggleTitle = isValidationMode ? '' : '';\n\n    //  HTML\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n                    <div class=\"acu-title-main\"><i class=\"fa-solid ${panelIcon}\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                </div>\n                <div class=\"acu-header-actions\">\n                    ${!isValidationMode ? '<button class=\"acu-changes-batch-btn acu-batch-accept\" title=\"\"><i class=\"fa-solid fa-check-double\"></i></button>' : ''}\n                    <button class=\"acu-changes-batch-btn acu-batch-reject\" title=\"${isValidationMode ? '' : ''}\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                    <button class=\"acu-changes-batch-btn acu-simple-mode-toggle ${isValidationMode ? 'active' : ''}\" title=\"${toggleTitle}\">\n                        <i class=\"fa-solid ${isValidationMode ? 'fa-filter-circle-xmark' : 'fa-filter'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                    </div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>`;\n\n    // ===  ===\n    if (isValidationMode) {\n      html += `<div class=\"acu-validation-mode-hint\">\n        <i class=\"fa-solid fa-info-circle\"></i>\n      </div>`;\n    }\n\n    html += `<div class=\"acu-panel-content acu-changes-content ${config.layout === 'horizontal' ? 'acu-changes-horizontal' : ''}\">`;\n\n    // ===  ===\n    if (isValidationMode) {\n      if (validationErrors.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedErrors = ValidationEngine.groupErrorsByTable(validationErrors);\n        const collapsedGroups = Store.get('acu_validation_collapsed_groups', []);\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        for (const tableName in groupedErrors) {\n          const tableErrors = groupedErrors[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header acu-validation-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\" style=\"background:${t.errorText};\">${tableErrors.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableErrors.forEach(error => {\n            const ruleData = error.rule\n              ? escapeHtml(\n                  JSON.stringify({\n                    ruleId: error.ruleId,\n                    ruleType: error.ruleType,\n                    tableName: error.tableName,\n                    rowIndex: error.rowIndex,\n                    columnName: error.columnName || '',\n                    currentValue: error.currentValue || '',\n                    rowTitle: error.rowTitle || '', //  rowTitle  ruleData\n                    rule: error.rule,\n                  }),\n                )\n              : '';\n\n            html += `<div class=\"acu-change-item acu-validation-error-item\"\n                         data-table=\"${escapeHtml(error.tableName)}\"\n                         data-row=\"${error.rowIndex}\"\n                         data-column=\"${escapeHtml(error.columnName || '')}\"\n                         data-rule-id=\"${escapeHtml(error.ruleId || '')}\"\n                         data-rule-type=\"${escapeHtml(error.ruleType || '')}\"\n                         data-rule-data=\"${ruleData}\">\n                        <span class=\"acu-change-badge\" style=\"background:var(--acu-hl-manual-bg);color:var(--acu-hl-manual);\">!</span>\n                        ${error.rowTitle && error.rowIndex >= 0 ? `<div class=\"acu-validation-row-title\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:2px;\">${escapeHtml(error.rowTitle)}</div>` : ''}\n                        <span class=\"acu-change-title\">${escapeHtml(error.columnName || '')}${error.currentValue ? `: ${escapeHtml(error.currentValue.length > 15 ? error.currentValue.substring(0, 15) + '...' : error.currentValue)}` : ''}</span>\n                        <span class=\"acu-validation-error-msg\">${escapeHtml(error.errorMessage.length > 25 ? error.errorMessage.substring(0, 25) + '...' : error.errorMessage)}</span>\n                        <div class=\"acu-change-actions\">\n                            <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                        </div>\n                    </div>`;\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    } else {\n      // ===  ===\n      if (changes.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedChanges = {};\n        changes.forEach(c => {\n          const key = c.tableName;\n          if (!groupedChanges[key]) groupedChanges[key] = [];\n          groupedChanges[key].push(c);\n        });\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        const collapsedGroups = Store.get('acu_changes_collapsed_groups', []);\n\n        for (const tableName in groupedChanges) {\n          const tableChanges = groupedChanges[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\">${tableChanges.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableChanges.forEach(change => {\n            if (change.type === 'row_added') {\n              html += `<div class=\"acu-change-item acu-change-added\"\n                            data-change-type=\"row_added\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-added\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"row_deleted\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'cell_modified') {\n              const oldShort = change.oldValue.length > 15 ? change.oldValue.substring(0, 15) + '...' : change.oldValue;\n              const newShort = change.newValue.length > 15 ? change.newValue.substring(0, 15) + '...' : change.newValue;\n\n              const isOptionTable = change.tableName && change.tableName.includes('');\n              let fieldDisplay;\n              if (isOptionTable) {\n                fieldDisplay = `${escapeHtml(change.tableName)}.${escapeHtml(change.header)}`;\n              } else {\n                fieldDisplay = `${escapeHtml(change.rowTitle)}.${escapeHtml(change.header)}`;\n              }\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"cell_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\"\n                            data-col-index=\"${change.colIndex}\"\n                            data-old-value=\"${encodeURIComponent(change.oldValue)}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-field\">${fieldDisplay}</span>\n                            <span class=\"acu-change-diff\">\n                                <span class=\"acu-diff-old\">${escapeHtml(oldShort || '()')}</span>\n                                <span class=\"acu-diff-arrow\"></span>\n                                <span class=\"acu-diff-new\">${escapeHtml(newShort || '()')}</span>\n                            </span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_modified') {\n              // \n              const fieldCount = change.changedFields.length;\n              const fieldNames = change.changedFields\n                .slice(0, 2)\n                .map(f => f.header)\n                .join('');\n              const moreText = fieldCount > 2 ? ` ${fieldCount}` : '';\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"row_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.rowTitle)}</span>\n                            <span class=\"acu-change-field-count\">${escapeHtml(fieldNames)}${moreText}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'table_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"table_deleted\"\n                            data-table-key=\"${change.tableKey}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\"></span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            }\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    }\n\n    html += `</div>`;\n    return html;\n  };\n  // [] \n  const bindChangesEvents = () => {\n    const { $ } = getCore();\n\n    // \n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-close-btn')\n      .off('click')\n      .on('click', function () {\n        Store.set('acu_changes_panel_active', false);\n        $('#acu-data-area').removeClass('visible');\n        $('.acu-nav-btn').removeClass('active');\n      });\n\n    // === ===\n    const TOUCH_MOVE_THRESHOLD = 10; // 10px\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const tableName = $item.data('table');\n        const rowIndex = parseInt($item.data('row'), 10);\n        const columnName = $item.data('column');\n\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        try {\n          const rawData = cachedRawData || getTableData();\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === tableName && snapshot[sheetId]) {\n              const headers = rawData[sheetId].content?.[0] || [];\n              const colIdx = headers.indexOf(columnName);\n              if (colIdx >= 0 && snapshot[sheetId].content?.[rowIndex + 1]) {\n                const snapshotValue = snapshot[sheetId].content[rowIndex + 1][colIdx];\n                rawData[sheetId].content[rowIndex + 1][colIdx] = snapshotValue;\n                await saveDataToDatabase(rawData, false, false);\n                renderInterface();\n                return;\n              }\n              break;\n            }\n          }\n          if (window.toastr) window.toastr.warning('');\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const ruleData = $item.data('rule-data');\n        if (!ruleData) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        try {\n          const parsed = typeof ruleData === 'string' ? JSON.parse(ruleData) : ruleData;\n          const error = {\n            ruleId: parsed.ruleId,\n            ruleType: parsed.ruleType,\n            rule: parsed.rule,\n            tableName: $item.data('table') || parsed.tableName || '',\n            rowIndex: parseInt($item.data('row'), 10) || parsed.rowIndex || 0,\n            columnName: $item.data('column') || parsed.columnName || '',\n            currentValue: parsed.currentValue || '',\n            rowTitle: parsed.rowTitle || '', //  rowTitle \n            ruleName: parsed.ruleName || parsed.rule?.name || '',\n            errorMessage: parsed.errorMessage || parsed.rule?.errorMessage || '',\n          };\n          showSmartFixModal(error);\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    let validationItemTouchStartPos: { x: number; y: number } | null = null;\n\n    $('.acu-validation-error-item')\n      .off('click touchstart touchend touchmove')\n      .on('touchstart', function (e) {\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        validationItemTouchStartPos = { x: touch.clientX, y: touch.clientY };\n      })\n      .on('touchmove', function (e) {\n        if (!validationItemTouchStartPos) return;\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        const deltaX = Math.abs(touch.clientX - validationItemTouchStartPos.x);\n        const deltaY = Math.abs(touch.clientY - validationItemTouchStartPos.y);\n        // \n        if (deltaX > TOUCH_MOVE_THRESHOLD || deltaY > TOUCH_MOVE_THRESHOLD) {\n          validationItemTouchStartPos = null;\n        }\n      })\n      .on('touchend', function (e) {\n        // \n        if (!validationItemTouchStartPos) return;\n        validationItemTouchStartPos = null;\n\n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      })\n      .on('click', function (e) {\n        //  click \n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        //  touchend \n        if ('ontouchstart' in window) return;\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      });\n\n    // /\n    $('.acu-changes-group-header')\n      .off('click')\n      .on('click', function (e) {\n        if ($(e.target).closest('.acu-change-item').length) return;\n\n        const tableName = $(this).data('table');\n        const $group = $(this).closest('.acu-changes-group');\n        const $body = $group.find('.acu-changes-group-body');\n        const $icon = $(this).find('.acu-collapse-icon');\n\n        // \n        const isValidationMode = $(this).hasClass('acu-validation-group-header');\n        const storageKey = isValidationMode ? 'acu_validation_collapsed_groups' : 'acu_changes_collapsed_groups';\n        let collapsedGroups = Store.get(storageKey, []);\n\n        if ($group.hasClass('collapsed')) {\n          $group.removeClass('collapsed');\n          $body.slideDown(200);\n          $icon.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n          collapsedGroups = collapsedGroups.filter(n => n !== tableName);\n        } else {\n          $group.addClass('collapsed');\n          $body.slideUp(200);\n          $icon.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n          if (!collapsedGroups.includes(tableName)) {\n            collapsedGroups.push(tableName);\n          }\n        }\n\n        Store.set(storageKey, collapsedGroups);\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-accept')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n\n        const snapshot = loadSnapshot();\n        const rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = rawData[tableKey].content[rowIndex + 1][colIndex];\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            if (!snapshot[tableKey]) {\n              snapshot[tableKey] = JSON.parse(JSON.stringify(rawData[tableKey]));\n            } else {\n              snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n            }\n          }\n        } else if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          delete snapshot[tableKey];\n        }\n\n        saveSnapshot(snapshot);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n        const oldValue = decodeURIComponent($item.data('old-value') || '');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content[rowIndex + 1][colIndex] = oldValue;\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content) {\n            rawData[tableKey].content[rowIndex + 1] = [...snapshot[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === /===\n    $('.acu-action-restore')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            const restoredRow = [...snapshot[tableKey].content[rowIndex + 1]];\n            if (!rawData[tableKey]) {\n              rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n              rawData[tableKey].content = [snapshot[tableKey].content[0]];\n            }\n            // \n            rawData[tableKey].content.splice(rowIndex + 1, 0, restoredRow);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          if (snapshot[tableKey]) {\n            rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item:not(.acu-validation-error-item) .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const changeType = $item.data('change-type');\n\n        if (!tableKey || rowIndex === undefined) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const sheet = rawData[tableKey];\n        const headers = sheet.content ? sheet.content[0] : [];\n        const row = sheet.content ? sheet.content[rowIndex + 1] : null;\n\n        if (!row) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        if (changeType === 'row_modified') {\n          // \n          showRowCompareEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        } else if (changeType === 'cell_modified') {\n          const colIndex = $item.data('col-index');\n          const headerName = headers[colIndex] || `${colIndex}`;\n          const cellValue = row[colIndex] || '';\n          showChangeSingleFieldModal(cellValue, headerName, sheet.name, rowIndex, colIndex, tableKey);\n        } else {\n          showChangeEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        }\n      });\n\n    // ===  ===\n    $('.acu-batch-accept')\n      .off('click')\n      .on('click', async function () {\n        const rawData = cachedRawData || getTableData();\n        if (!rawData) return;\n\n        // \n        saveSnapshot(JSON.parse(JSON.stringify(rawData)));\n        currentDiffMap = new Set();\n\n        // \n        refreshChangesPanel();\n      });\n\n    // ===  ===\n    $('.acu-batch-reject')\n      .off('click')\n      .on('click', async function () {\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const restoredData = JSON.parse(JSON.stringify(snapshot));\n        cachedRawData = restoredData;\n        await saveDataToDatabase(restoredData, false, false);\n      });\n\n    // ===  ===\n    $('.acu-simple-mode-toggle')\n      .off('click')\n      .on('click', function () {\n        const currentMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        const newMode = !currentMode;\n        Store.set(STORAGE_KEY_VALIDATION_MODE, newMode);\n\n        // \n        const rawData = cachedRawData || getTableData();\n        $('#acu-data-area').html(renderChangesPanel(rawData));\n        bindChangesEvents();\n\n        // \n        updateChangesCount(rawData);\n      });\n\n    // ===  ===\n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          // \n          const finalHeight = $panel.height();\n          const heights = getTableHeights();\n          heights[tableName] = finalHeight;\n          saveTableHeights(heights);\n        };\n      })\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const $panel = $('#acu-data-area');\n        $panel.css('height', ''); // \n        // \n        const heights = getTableHeights();\n        delete heights[tableName];\n        saveTableHeights(heights);\n      });\n\n    // ===  ===\n    const $horizontalScroller = $('.acu-changes-content.acu-changes-horizontal');\n    if ($horizontalScroller.length) {\n      $horizontalScroller[0].addEventListener(\n        'touchstart',\n        function (e) {\n          this._touchStartX = e.touches[0].clientX;\n          this._touchStartY = e.touches[0].clientY;\n          this._scrollDirection = null; // \n        },\n        { passive: true },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchmove',\n        function (e) {\n          if (!this._touchStartX) return;\n\n          const deltaX = Math.abs(e.touches[0].clientX - this._touchStartX);\n          const deltaY = Math.abs(e.touches[0].clientY - this._touchStartY);\n\n          // \n          if (!this._scrollDirection && (deltaX > 5 || deltaY > 5)) {\n            this._scrollDirection = deltaX > deltaY ? 'horizontal' : 'vertical';\n          }\n\n          // \n          // \n          if (this._scrollDirection === 'horizontal' && deltaX > 10) {\n            e.stopPropagation();\n          }\n        },\n        { passive: false },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchend',\n        function () {\n          this._touchStartX = null;\n          this._touchStartY = null;\n          this._scrollDirection = null;\n        },\n        { passive: true },\n      );\n    }\n  };\n\n  // [] \n  const refreshChangesPanel = () => {\n    const { $ } = getCore();\n    const rawData = cachedRawData || getTableData();\n    currentDiffMap = generateDiffMap(rawData);\n\n    const $panel = $('#acu-data-area');\n    if ($panel.length && Store.get('acu_changes_panel_active', false)) {\n      $panel.html(renderChangesPanel(rawData));\n      bindChangesEvents();\n\n      // \n      updateChangesCount(rawData);\n    }\n  };\n\n  // []  + \n  const updateChangesCount = rawData => {\n    const { $ } = getCore();\n    const snapshot = loadSnapshot();\n    let changesCount = 0;\n\n    if (snapshot && rawData) {\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const newSheet = rawData[sheetId];\n        const oldSheet = snapshot[sheetId];\n        if (!newSheet?.content) continue;\n        const newRows = newSheet.content.slice(1);\n        const oldRows = oldSheet?.content?.slice(1) || [];\n        newRows.forEach((row, rowIdx) => {\n          const oldRow = oldRows[rowIdx];\n          if (!oldRow) {\n            changesCount++;\n            return;\n          }\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return;\n            if (String(cell ?? '') !== String(oldRow[colIdx] ?? '')) changesCount++;\n          });\n        });\n        if (oldRows.length > newRows.length) changesCount += oldRows.length - newRows.length;\n      }\n      for (const sheetId in snapshot) {\n        if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n      }\n    }\n\n    // \n    const validationErrorCount = rawData ? ValidationEngine.getErrorCount(rawData) : 0;\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n    const displayCount = isValidationMode ? validationErrorCount : changesCount;\n    // \n    const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n    const $btn = $('#acu-btn-changes');\n    const $span = $btn.find('span');\n    $span.html(displayCount > 0 ? `(${displayCount})` : '');\n\n    // \n    if (showWarningIcon) {\n      if (!$btn.find('.acu-nav-warning-icon').length) {\n        $span.append(' <i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>');\n      }\n      $btn.addClass('has-validation-errors');\n    } else {\n      $btn.find('.acu-nav-warning-icon').remove();\n      $btn.removeClass('has-validation-errors');\n    }\n  };\n  // [] \n  const showChangeEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const inputsHtml = row\n      .map((cell, idx) => {\n        if (idx === 0) return '';\n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        return `\n                <div class=\"acu-card-edit-field\" style=\"margin-bottom: 10px;\">\n                    <label style=\"display:block;font-size:12px;color:var(--acu-accent);font-weight:bold;margin-bottom:4px;\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\"\n                                                        style=\"width:100%;min-height:40px;max-height:500px;padding:10px;resize:none;overflow-y:hidden;\">${escapeHtml(val)}</textarea>                            </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${inputsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-change-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-change-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // [] \n    const adjustHeight = el => {\n      //  auto  0px scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n    };\n    dialog.find('#dlg-change-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    dialog.find('#dlg-change-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n\n        if (hasChanges) {\n          // 1. \n          try {\n            const api = getCore().getDB();\n            if (!api || !api.importTableAsJson) {\n              throw new Error(' API ');\n            }\n\n            const dataToSave = { mate: rawData.mate || { type: 'chatSheets', version: 1 } };\n            Object.keys(rawData).forEach(k => {\n              if (k.startsWith('sheet_')) dataToSave[k] = rawData[k];\n            });\n\n            // \n            let jsonString;\n            try {\n              jsonString = JSON.stringify(dataToSave);\n              //  10MB \n              const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n              if (sizeInMB > 10) {\n                throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n              }\n            } catch (stringifyError) {\n              console.error('[DICE]ACU JSON :', stringifyError);\n              throw new Error(`: ${stringifyError.message || stringifyError}`);\n            }\n\n            //  importTableAsJson saveChat()\n            const result = await api.importTableAsJson(jsonString);\n            //  false \n            if (result === false) {\n              throw new Error(' false');\n            }\n            cachedRawData = rawData;\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            let errorMessage = e.message || '';\n            //  \"Settings could not be saved\" \n            const errorMsg = String(e);\n            if (\n              errorMsg.includes('Settings could not be saved') ||\n              errorMsg.includes('server connection') ||\n              errorMsg.includes('data loss')\n            ) {\n              errorMessage = '';\n            }\n            if (window.toastr) {\n              window.toastr.error(errorMessage, '', { timeOut: 7000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n            // \n            return;\n          }\n\n          // 2. \n          const snapshot = loadSnapshot();\n          if (snapshot && snapshot[tableKey] && snapshot[tableKey].content) {\n            snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n            saveSnapshot(snapshot);\n          }\n\n          // 3.  diffMap \n          currentDiffMap = generateDiffMap(rawData);\n\n          // 4. \n          const $panel = $('#acu-data-area');\n          $panel.html(renderChangesPanel(rawData));\n          bindChangesEvents();\n        }\n      }\n      closeDialog();\n    });\n  };\n  // [] \n  const showChangeSingleFieldModal = (value, headerName, tableName, rowIndex, colIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldValue = snapshot?.[tableKey]?.content?.[rowIndex + 1]?.[colIndex] ?? '';\n    const hasOldValue = oldValue !== '' && String(oldValue) !== String(value);\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:450px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(headerName)}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${\n                          hasOldValue\n                            ? `\n                        <div class=\"acu-diff-section acu-diff-old-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                            </div>\n                            <div class=\"acu-diff-readonly\">${escapeHtml(oldValue)}</div>\n                        </div>\n                        <div class=\"acu-diff-arrow-down\">\n                            <i class=\"fa-solid fa-arrow-down\"></i>\n                        </div>\n                        `\n                            : ''\n                        }\n                        <div class=\"acu-diff-section acu-diff-new-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-pen\"></i> ${hasOldValue ? '' : ''}\n                            </div>\n                            <textarea class=\"acu-change-single-input acu-edit-textarea\" spellcheck=\"false\"\n                                style=\"width:100%;min-height:60px;max-height:300px;padding:12px;resize:none;\">${escapeHtml(value)}</textarea>\n                        </div>\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-single-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        ${hasOldValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"dlg-single-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-single-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const $textarea = dialog.find('.acu-change-single-input');\n    const adjustHeight = () => {\n      $textarea[0].style.height = 'auto';\n      const h = Math.max(60, Math.min($textarea[0].scrollHeight + 2, 300));\n      $textarea[0].style.height = h + 'px';\n    };\n    setTimeout(adjustHeight, 0);\n    $textarea.on('input', adjustHeight);\n    $textarea.focus();\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-single-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    // [] \n    dialog.find('#dlg-single-revert').click(function () {\n      $textarea.val(oldValue).trigger('input');\n    });\n\n    dialog.find('#dlg-single-save').click(async () => {\n      const newVal = $textarea.val();\n      let rawData = cachedRawData || getTableData();\n\n      if (rawData && rawData[tableKey] && rawData[tableKey].content) {\n        const currentRow = rawData[tableKey].content[rowIndex + 1];\n        if (currentRow && String(currentRow[colIndex]) !== String(newVal)) {\n          currentRow[colIndex] = newVal;\n\n          // \n          await saveDataOnly(rawData);\n\n          // \n          const snapshot = loadSnapshot();\n          if (\n            snapshot &&\n            snapshot[tableKey] &&\n            snapshot[tableKey].content &&\n            snapshot[tableKey].content[rowIndex + 1]\n          ) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = newVal;\n            saveSnapshot(snapshot);\n          }\n\n          // \n          currentDiffMap = generateDiffMap(rawData);\n          refreshChangesPanel();\n        }\n      }\n      closeDialog();\n    });\n  };\n\n  // [] \n  const showRowCompareEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldRow = snapshot?.[tableKey]?.content?.[rowIndex + 1] || [];\n\n    // \n    let fieldsHtml = '';\n    for (let idx = 1; idx < headers.length; idx++) {\n      const headerName = headers[idx] || ` ${idx}`;\n      const oldVal = oldRow[idx] ?? '';\n      const newVal = row[idx] ?? '';\n      const isChanged = String(oldVal) !== String(newVal);\n\n      fieldsHtml += `\n                <div class=\"acu-row-edit-field ${isChanged ? 'acu-field-changed' : ''}\">\n                    <div class=\"acu-row-edit-label\">${escapeHtml(headerName)} ${isChanged ? '<span class=\"acu-changed-badge\"></span>' : ''}</div>\n                    ${isChanged ? `<div class=\"acu-row-edit-old\">${escapeHtml(oldVal) || '<span class=\"acu-empty-val\">()</span>'}</div>` : ''}\n                    <textarea class=\"acu-row-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\">${escapeHtml(newVal)}</textarea>\n                </div>\n            `;\n    }\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:550px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(row[1] || ' ' + (rowIndex + 1))}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px; max-height:60vh;\">\n                        ${fieldsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-row-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = Math.min(el.scrollHeight + 2, 200) + 'px';\n    };\n    dialog.find('textarea').each(function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-row-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#dlg-row-revert').click(function () {\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        $(this)\n          .val(oldRow[colIdx] ?? '')\n          .trigger('input');\n      });\n    });\n\n    // \n    dialog.find('#dlg-row-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (!rawData?.[tableKey]?.content?.[rowIndex + 1]) {\n        closeDialog();\n        return;\n      }\n\n      const currentRow = rawData[tableKey].content[rowIndex + 1];\n      let hasChanges = false;\n\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        const newVal = $(this).val();\n        if (String(currentRow[colIdx]) !== String(newVal)) {\n          hasChanges = true;\n          currentRow[colIdx] = newVal;\n        }\n      });\n\n      if (hasChanges) {\n        await saveDataOnly(rawData);\n\n        // \n        const snapshot = loadSnapshot();\n        if (snapshot?.[tableKey]?.content) {\n          snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n          saveSnapshot(snapshot);\n        }\n\n        currentDiffMap = generateDiffMap(rawData);\n        refreshChangesPanel();\n      }\n      closeDialog();\n    });\n  };\n  const renderDashboard = allTables => {\n    console.info('[DICE]...');\n    const config = getConfig();\n\n    // [] \n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const questResult = DashboardDataParser.findTable(allTables, 'quest');\n    const bagResult = DashboardDataParser.findTable(allTables, 'bag');\n    const skillResult = DashboardDataParser.findTable(allTables, 'skill');\n    const equipResult = DashboardDataParser.findTable(allTables, 'equip');\n\n    // []  - \n    let player = { name: '', status: '', position: '', attrs: '', money: '0' };\n    const playerParsed = DashboardDataParser.parseRows(playerResult, 'player');\n\n    if (playerParsed.length > 0) {\n      const p = playerParsed[0];\n      player.name = p.name || '';\n      player.status = p.status || '';\n      player.position = p.position || '';\n      player.money = p.money || '';\n      player.resources = '';\n\n      // [] \n      if (playerResult?.data?.headers && playerResult?.data?.rows?.[0]) {\n        const headers = playerResult.data.headers;\n        const row = playerResult.data.rows[0];\n        let allAttrsStr = '';\n        headers.forEach((h, idx) => {\n          if (h && h.includes('')) {\n            const val = row[idx];\n            if (val) allAttrsStr += (allAttrsStr ? '; ' : '') + val;\n          }\n        });\n        player.attrs = allAttrsStr;\n\n        // \n        headers.forEach((h, idx) => {\n          if (h && (h.includes('') || h.includes(''))) {\n            const val = row[idx];\n            if (val) player.resources = val;\n          }\n        });\n      }\n    }\n\n    // [] HTML\n    const playerRows = playerResult?.data?.rows || [];\n    const playerHeaders = playerResult?.data?.headers || [];\n\n    // []  - \n    let globalDetailLocation = ''; // \n    let globalLocation = ''; // \n\n    if (globalResult?.data?.rows?.length > 0) {\n      const headers = globalResult.data.headers || [];\n      const row = globalResult.data.rows[0];\n\n      // \n      const detailIdx = DashboardDataParser.findColumnIndex(headers, 'detailLocation', globalResult.config);\n      if (detailIdx >= 0 && row[detailIdx]) {\n        globalDetailLocation = row[detailIdx];\n      }\n\n      // \n      const locIdx = DashboardDataParser.findColumnIndex(headers, 'currentLocation', globalResult.config);\n      globalLocation = locIdx >= 0 && row[locIdx] ? row[locIdx] : row[2] || '';\n    }\n\n    // currentPlaceName \n    let currentPlaceName =\n      globalDetailLocation ||\n      globalLocation ||\n      (player.position.includes('-') ? player.position.split('-')[0].trim() : player.position);\n\n    // [] NPC - \n    const npcTableName = npcResult?.name || '';\n    const npcTableKey = npcResult?.key || '';\n\n    const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n\n    // NPC\n    let inSceneNPCs = [];\n    let offSceneNPCs = [];\n    npcParsed.forEach(npc => {\n      const inSceneVal = String(npc.inScene || '').toLowerCase();\n      const npcData = {\n        name: npc.name || '',\n        status: npc.status || '',\n        position: npc.position || '',\n        index: npc._rowIndex,\n      };\n      if (inSceneVal === 'true' || inSceneVal === '') {\n        inSceneNPCs.push(npcData);\n      } else {\n        offSceneNPCs.push(npcData);\n      }\n    });\n    // \n    let allNPCs = [...inSceneNPCs, ...offSceneNPCs];\n\n    // []  -  + \n    const questTableName = questResult?.name || '';\n    const questParsed = DashboardDataParser.parseRows(questResult, 'quest');\n    const activeQuestParsed = DashboardDataParser.applyFilter(questParsed, 'active', 'quest');\n\n    //  >  >  > \n    const questTypeOrder = type => {\n      const t = String(type || '').toLowerCase();\n      if (t.includes('')) return 0;\n      if (t.includes('')) return 1;\n      if (t.includes('')) return 2;\n      return 3;\n    };\n    let activeTasks = activeQuestParsed\n      .map(q => ({\n        name: q.name || '',\n        type: q.type || '',\n        progress: q.progress || '',\n        _rowIndex: q._rowIndex,\n      }))\n      .sort((a, b) => questTypeOrder(a.type) - questTypeOrder(b.type))\n      .slice(0, 5);\n    // []  - \n    const bagTableName = bagResult?.name || '';\n\n    const bagParsed = DashboardDataParser.parseRows(bagResult, 'bag');\n    let bagItems = bagParsed.slice(0, 6).map(item => ({\n      name: item.name || '',\n      count: item.count || '1',\n      type: item.type || '',\n    }));\n\n    // []  - \n    const skillTableName = skillResult?.name || '';\n\n    const skillParsed = DashboardDataParser.parseRows(skillResult, 'skill');\n    let skills = skillParsed.slice(0, 6).map(s => ({\n      name: s.name || '',\n      level: s.level || '',\n      type: s.type || '',\n    }));\n\n    // []  -  + \n    const equipTableName = equipResult?.name || '';\n\n    const equipParsed = DashboardDataParser.parseRows(equipResult, 'equip');\n    const equippedParsed = DashboardDataParser.applyFilter(equipParsed, 'equipped', 'equip');\n\n    let equippedItems = equippedParsed.slice(0, 4).map(e => ({\n      name: e.name || '',\n      type: e.type || '',\n      part: e.part || '',\n    }));\n    // []  - \n    const locationTableName = locationResult?.name || '';\n    const locationTableKey = locationResult?.key || '';\n\n    const locationParsed = DashboardDataParser.parseRows(locationResult, 'location');\n\n    // HTML\n    let html = `\n        <div class=\"acu-panel-header\">\n            <div class=\"acu-panel-title\">\n                <div class=\"acu-title-main\"><i class=\"fa-solid fa-chart-line\"></i> <span class=\"acu-title-text\"></span></div>\n                <div class=\"acu-title-sub\"></div>\n            </div>\n            <div class=\"acu-header-actions\">\n                <div class=\"acu-height-control\">\n                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                </div>\n                <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n        </div>\n        <div class=\"acu-panel-content acu-dashboard-content\">\n            <div class=\"acu-dash-body ${config.layout === 'horizontal' ? 'acu-dash-horizontal' : ''}\">\n            <!--  +  -->\n                <div class=\"acu-dash-player\">\n                    <h3 class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                        data-table-key=\"${playerResult?.key || ''}\"\n                        data-row-index=\"0\"\n                        data-preview-type=\"player\"\n                        style=\"cursor:pointer;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-user-circle\"></i> ${escapeHtml(replaceUserPlaceholders(player.name))}</span>\n                        <span style=\"font-size:11px;font-weight:normal;color:var(--acu-text-main);background:var(--acu-badge-bg);padding:2px 8px;border-radius:10px;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;\" title=\"${escapeHtml(player.status)}\">${escapeHtml(player.status.length > 6 ? player.status.substring(0, 6) + '..' : player.status)}</span>\n                    </h3>\n                    <div class=\"acu-player-status\" style=\"margin-bottom:8px;\">\n                        ${(() => {\n                          // \n                          const resourcesStr = player.resources || player.money || '';\n                          const parsedResources = parseAttributeString(resourcesStr);\n                          if (parsedResources.length > 0) {\n                            return `<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:52px;overflow-y:auto;margin-bottom:6px;padding-bottom:6px;border-bottom:1px dashed var(--acu-border);\">\n                                    ${parsedResources\n                                      .slice(0, 4)\n                                      .map(\n                                        res => `\n                                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;\">\n                                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(res.name)}\">${escapeHtml(res.name.substring(0, 3))}</span>\n                                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                                <span style=\"color:var(--acu-accent);font-size:11px;font-weight:bold;\">${res.value}</span>\n                                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${res.value}\" data-name=\"${escapeHtml(res.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${res.name}(${res.value})\"></i>\n                                            </div>\n                                        </div>\n                                    `,\n                                      )\n                                      .join('')}\n                                </div>`;\n                          }\n                          return '';\n                        })()}\n        ${(() => {\n          // \n          let allAttrs = [];\n          if (playerRows.length > 0 && playerHeaders.length > 0) {\n            const row = playerRows[0];\n            playerHeaders.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!allAttrs.some(a => a.name === attr.name)) {\n                    allAttrs.push(attr);\n                  }\n                });\n              }\n            });\n          }\n\n          if (allAttrs.length > 0) {\n            // 378px\n            return `<div style=\"display:grid;grid-template-columns:repeat(3,1fr);gap:2px 6px;max-height:78px;overflow-y:auto;overflow-x:hidden;\">\n                    ${allAttrs\n                      .map(\n                        attr => `\n                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;\">\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(attr.name)}\">${escapeHtml(attr.name.substring(0, 2))}</span>\n                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                <span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${attr.value}</span>\n                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${attr.value}\" data-name=\"${escapeHtml(attr.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${attr.name}(${attr.value})\"></i>\n                            </div>\n                        </div>\n                    `,\n                      )\n                      .join('')}\n                </div>`;\n          }\n          return '';\n        })()}\n                    </div>\n\n                    <h4 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(skillTableName)}\" style=\"font-size:12px;color:var(--acu-accent);margin:10px 0 6px 0;\"><i class=\"fa-solid fa-bolt\"></i>  (${skillParsed.length})</h4>\n                    <div style=\"display:grid;grid-template-columns:repeat(2,1fr);gap:2px 6px;max-height:78px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      skills.length > 0\n                        ? skills\n                            .map((skill, idx) => {\n                              const skillValue = extractNumericValue(skill.level);\n                              const hasNumeric = skillValue > 0;\n                              const skillRowIndex = skillParsed.findIndex(s => s.name === skill.name);\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${skillResult?.key || ''}\"\n                            data-row-index=\"${skillRowIndex >= 0 ? skillRowIndex : idx}\"\n                            data-preview-type=\"skill\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;cursor:pointer;\">\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(skill.name)}\">${escapeHtml(skill.name.length > 5 ? skill.name.substring(0, 5) + '..' : skill.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                ${\n                                  hasNumeric\n                                    ? `<span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${skillValue}</span>\n                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${skillValue}\" data-name=\"${escapeHtml(skill.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${skill.name}(${skillValue})\"></i>`\n                                    : `<span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(skill.level || '-')}</span>`\n                                }\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div style=\"grid-column:1/-1;text-align:center;color:var(--acu-text-sub);padding:8px;font-size:11px;\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  + NPC -->\n                <div class=\"acu-dash-locations\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(locationTableName)}\" style=\"display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-map\"></i>  (${locationParsed.length})</span>\n                        <i class=\"fa-solid fa-map acu-dash-map-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:100px;overflow-y:auto;overflow-x:hidden;margin-bottom:10px;\">\n                    ${\n                      locationParsed.length > 0\n                        ? locationParsed\n                            .map((loc, idx) => {\n                              const areaName = loc.name || '';\n                              const isCurrent =\n                                currentPlaceName &&\n                                (areaName.includes(currentPlaceName) || currentPlaceName.includes(areaName));\n                              return `<div class=\"acu-location-item acu-dash-clickable acu-dash-preview-trigger ${isCurrent ? 'acu-current-location' : ''}\"\n                            data-table-key=\"${escapeHtml(locationTableKey)}\"\n                            data-row-index=\"${loc._rowIndex}\"\n                            data-preview-type=\"location\">\n                            <span>\n                                ${isCurrent ? '<i class=\"fa-solid fa-location-dot\"></i>' : '<i class=\"fa-solid fa-map-pin\" style=\"font-size:9px;opacity:0.4;\"></i>'}\n                                <span title=\"${escapeHtml(areaName)}\">${escapeHtml(areaName)}</span>\n                            </span>\n                            ${!isCurrent ? `<i class=\"fa-solid fa-walking acu-dash-goto-btn\" data-location=\"${escapeHtml(areaName)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;flex-shrink:0;\" title=\"${areaName}\"></i>` : '<i class=\"fa-solid fa-street-view\" style=\"flex-shrink:0;\" title=\"\"></i>'}\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(npcTableName)}\" style=\"margin-top:10px;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-users\"></i>  (${allNPCs.length})</span>\n                        <span style=\"display:flex;gap:8px;\">\n                            <i class=\"fa-solid fa-project-diagram acu-dash-relation-graph-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                            <i class=\"fa-solid fa-user-circle acu-dash-avatar-manager-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                        </span>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:150px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      allNPCs.length > 0\n                        ? allNPCs\n                            .slice(0, 12)\n                            .map((npc, npcIdx) => {\n                              const isInScene = inSceneNPCs.some(n => n.name === npc.name);\n                              const isLastNpc = npcIdx === Math.min(allNPCs.length, 12) - 1;\n                              const npcAvatar = AvatarManager.get(npc.name);\n                              const avatarOffsetX = AvatarManager.getOffsetX(npc.name);\n                              const avatarOffsetY = AvatarManager.getOffsetY(npc.name);\n                              const avatarScale = AvatarManager.getScale(npc.name);\n                              const avatarStyle = npcAvatar\n                                ? `background-image:url('${npcAvatar}');background-size:${avatarScale}%;background-position:${avatarOffsetX}% ${avatarOffsetY}%;`\n                                : '';\n                              const offSceneFilter = isInScene\n                                ? ''\n                                : 'filter:grayscale(80%) brightness(0.7);opacity:0.5;';\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${escapeHtml(npcTableKey)}\"\n                            data-row-index=\"${npc.index}\"\n                            data-preview-type=\"npc\"\n                            style=\"padding:6px 4px;${!isLastNpc ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <span class=\"acu-task-name\" style=\"font-size:12px;display:flex;align-items:center;gap:6px;\">\n                                    <span class=\"acu-dash-npc-avatar\" style=\"width:22px;height:22px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border:1.5px solid ${isInScene ? 'var(--acu-accent)' : 'var(--acu-border)'};${avatarStyle}${offSceneFilter}\" title=\"${isInScene ? '' : ''}\">\n                                        ${!npcAvatar ? `<span style=\"font-size:10px;font-weight:bold;color:var(--acu-text-sub);${offSceneFilter}\">${escapeHtml(npc.name.charAt(0))}</span>` : ''}\n                                    </span>\n                                    <span title=\"${escapeHtml(npc.name)}\" style=\"${isInScene ? '' : 'opacity:0.6;'}\">${escapeHtml(npc.name.length > 4 ? npc.name.substring(0, 4) + '..' : npc.name)}</span>\n                                </span>\n                                <div style=\"display:flex;align-items:center;\">\n                                    <i class=\"fa-solid fa-people-arrows acu-dash-contest-btn\" data-npc=\"${escapeHtml(npc.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${npc.name}\"></i>\n                                </div>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  +  +  -->\n                <div class=\"acu-dash-intel\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(bagTableName)}\"><i class=\"fa-solid fa-bag-shopping\"></i>  (${bagParsed.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      bagItems.length > 0\n                        ? bagItems\n                            .map((item, idx) => {\n                              const isLastBag = idx === bagItems.length - 1;\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${bagResult?.key || ''}\"\n                            data-row-index=\"${idx}\"\n                            data-preview-type=\"bag\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLastBag ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);flex:1;white-space:nowrap;\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name.length > 4 ? item.name.substring(0, 4) + '..' : item.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:6px;\">\n                                <i class=\"fa-solid fa-hand-pointer acu-dash-use-item-btn\" data-item=\"${escapeHtml(item.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${item.name}\"></i>\n                                <span style=\"color:var(--acu-accent);font-weight:bold;\">${escapeHtml(item.count)}</span>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(equipTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-shield-halved\"></i>  (${equippedItems.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      equippedItems.length > 0\n                        ? equippedItems\n                            .map((item, idx) => {\n                              const isLast = idx === equippedItems.length - 1;\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${equipResult?.key || ''}\"\n                            data-row-index=\"${equipParsed.findIndex(r => r.name === item.name)}\"\n                            data-preview-type=\"equipment\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLast ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name.length > 5 ? item.name.substring(0, 5) + '..' : item.name)}</span>\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(item.part || item.type)}</span>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(questTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-clipboard-list\"></i>  (${activeTasks.length})</h3>\n                    ${\n                      activeTasks.length > 0\n                        ? activeTasks\n                            .map((t, idx) => {\n                              const isMain = String(t.type || '').includes('');\n                              // \n                              let progressPercent = null;\n                              const progressMatch = String(t.progress || '').match(/(\\d+)\\s*%/);\n                              if (progressMatch) {\n                                progressPercent = Math.min(100, Math.max(0, parseInt(progressMatch[1], 10)));\n                              }\n                              const progressBar =\n                                progressPercent !== null\n                                  ? `<div style=\"width:40px;height:4px;background:var(--acu-border);border-radius:2px;overflow:hidden;\"><div style=\"width:${progressPercent}%;height:100%;background:var(--acu-accent);\"></div></div>`\n                                  : '';\n                              return `<div class=\"acu-task-item acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${questResult?.key || ''}\"\n                            data-row-index=\"${t._rowIndex !== undefined ? t._rowIndex : questParsed.findIndex(q => q.name === t.name)}\"\n                            data-preview-type=\"quest\"\n                            style=\"padding:4px 8px;margin-bottom:3px;cursor:pointer;\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <div class=\"acu-task-name\" style=\"font-size:11px;${isMain ? 'font-weight:600;' : ''}\">${escapeHtml(t.name)}</div>\n                                ${progressBar}\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                </div>\n            </div>\n    `;\n\n    // \n    const loadedModules = [\n      globalResult ? '' : null,\n      playerResult ? '' : null,\n      locationResult ? '' : null,\n      npcResult ? 'NPC' : null,\n      questResult ? '' : null,\n      bagResult ? '' : null,\n      skillResult ? '' : null,\n      equipResult ? '' : null,\n    ].filter(Boolean);\n\n    console.info(`[DICE]${loadedModules.length}: ${loadedModules.join(', ')}`);\n    return html;\n  };\n\n  const renderTableContent = (tableData, tableName) => {\n    if (!tableData || !tableData.rows.length)\n      return `\n            <div class=\"acu-panel-header\"><div class=\"acu-panel-title\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${tableName}</div><button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button></div>\n            <div class=\"acu-panel-content\"><div style=\"text-align:center;color:var(--acu-text-sub);padding:20px;\"></div></div>`;\n\n    const config = getConfig();\n    const pendingDeletions = getPendingDeletions()[tableData.key] || [];\n    const headers = (tableData.headers || []).slice(1);\n\n    //  ( list)\n    const currentStyle = (getTableStyles() || {})[tableName] || 'list';\n    const isGridMode = currentStyle === 'grid';\n\n    let titleColIndex = 1;\n    if (tableData.headers.length === 1) {\n      titleColIndex = 0;\n    } else if (tableName.includes('') || tableName.includes('')) {\n      const idx = tableData.headers.findIndex(\n        h => h && (h.includes('') || h.includes('') || h.includes('')),\n      );\n      if (idx > 0) titleColIndex = idx;\n    }\n\n    // ---  ---\n    let processedRows = tableData.rows.map((row, index) => {\n      const rowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n      const isBookmarked = rowKey && BookmarkManager.isBookmarked(tableName, rowKey);\n      return { data: row, originalIndex: index, rowKey, isBookmarked };\n    });\n    const searchTerm = (tableSearchStates[tableName] || '').toLowerCase().trim();\n\n    // \n    const isReversed = isTableReversed(tableName);\n\n    if (searchTerm) {\n      processedRows = processedRows.filter(item =>\n        item.data.some(cell => String(cell).toLowerCase().includes(searchTerm)),\n      );\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        const titleA = String(a.data[titleColIndex] || '').toLowerCase();\n        const titleB = String(b.data[titleColIndex] || '').toLowerCase();\n        const aHitTitle = titleA.includes(searchTerm);\n        const bHitTitle = titleB.includes(searchTerm);\n        if (titleA === searchTerm && titleB !== searchTerm) return -1;\n        if (titleA !== searchTerm && titleB === searchTerm) return 1;\n        if (aHitTitle && !bHitTitle) return -1;\n        if (!aHitTitle && bHitTitle) return 1;\n        return a.originalIndex - b.originalIndex;\n      });\n    } else {\n      // \n      // bookmark\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        if (isReversed) {\n          return b.originalIndex - a.originalIndex;\n        } else {\n          return a.originalIndex - b.originalIndex;\n        }\n      });\n    }\n\n    const itemsPerPage = config.itemsPerPage || 50;\n    const totalItems = processedRows.length;\n    const totalPages = Math.ceil(totalItems / itemsPerPage) || 1;\n    let currentPage = tablePageStates[tableName] || 1;\n    if (currentPage > totalPages) currentPage = totalPages;\n    if (currentPage < 1) currentPage = 1;\n    tablePageStates[tableName] = currentPage;\n\n    const startIdx = (currentPage - 1) * itemsPerPage;\n    const endIdx = startIdx + itemsPerPage;\n    const rowsToRender = processedRows.slice(startIdx, endIdx);\n    // []    \n    // \n    const showReverseBtn = shouldShowReverseButton(tableName);\n    const reverseBtnHtml = showReverseBtn\n      ? `\n            <button class=\"acu-view-btn acu-reverse-btn\" data-table=\"${escapeHtml(tableName)}\" title=\"${isReversed ? '' : ''}\">\n                <i class=\"fa-solid ${isReversed ? 'fa-sort-amount-up' : 'fa-sort-amount-down'}\"></i>\n            </button>\n        `\n      : '';\n\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n    <div class=\"acu-title-main\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> <span class=\"acu-title-text\">${escapeHtml(tableName)}</span></div>\n    <div class=\"acu-title-sub\">(${startIdx + 1}-${Math.min(endIdx, totalItems)} / ${totalItems})${isReversed ? ' <span style=\"color:var(--acu-accent);\"></span>' : ''}</div>\n</div>\n                <div class=\"acu-header-actions\">\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn\" id=\"acu-btn-relation-graph\" data-table=\"${escapeHtml(tableName)}\" title=\"\"><i class=\"fa-solid fa-project-diagram\"></i></button>` : ''}\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn acu-table-map-btn\" title=\"\"><i class=\"fa-solid fa-map\"></i></button>` : ''}\n                    ${reverseBtnHtml}\n                    <button class=\"acu-view-btn\" id=\"acu-btn-switch-style\" data-table=\"${escapeHtml(tableName)}\" title=\"  (: ${isGridMode ? '' : ''})\">\n                        <i class=\"fa-solid ${isGridMode ? 'fa-th-large' : 'fa-list'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${escapeHtml(tableName)}\" title=\"  | \"></i>\n                    </div>\n\n                    <div class=\"acu-search-wrapper\"><i class=\"fa-solid fa-search acu-search-icon\"></i><input type=\"text\" class=\"acu-search-input\" placeholder=\"...\" value=\"${(tableSearchStates[tableName] || '').replace(/\"/g, '&quot;')}\" /></div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>\n            <div class=\"acu-panel-content\"><div class=\"acu-card-grid\">`;\n\n    html += rowsToRender\n      .map(item => {\n        const realRowIdx = item.originalIndex;\n        const row = item.data;\n        const isPending = pendingDeletions.includes(realRowIdx);\n        const cardTitle = row[titleColIndex] || '';\n        const showDefaultIndex = titleColIndex === 1;\n        const titleCellId = `${tableData.key}-${realRowIdx}-${titleColIndex}`;\n        const isTitleModified = window.acuModifiedSet && window.acuModifiedSet.has(titleCellId);\n        const isRowNew = currentDiffMap.has(`${tableName}-row-${realRowIdx}`);\n        let rowClass = '';\n        if (config.highlightNew) {\n          if (isTitleModified) rowClass = 'acu-highlight-manual';\n          else if (isRowNew) rowClass = 'acu-highlight-diff';\n        }\n\n        // \n        const validColIndices = row.map((_, i) => i).filter(i => i > 0 && i !== titleColIndex);\n        const isOddValidCount = validColIndices.length % 2 === 1;\n\n        const cardBody = row\n          .map((cell, cIdx) => {\n            if (cIdx <= 0 || cIdx === titleColIndex) return '';\n            // [] \"\"\n            const currentHeader = headers[cIdx - 1] || '';\n            if (currentHeader.includes('')) return '';\n            const isLastValidCol = cIdx === validColIndices[validColIndices.length - 1];\n            const spanFullRow = isLastValidCol && isOddValidCount;\n            // /\n            const rawHeaderName = headers[cIdx - 1] || '' + cIdx;\n\n            // [] \n            const lockRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n            const isThisFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, headers[cIdx - 1]);\n            const inlineLockIcon = isThisFieldLocked\n              ? '<i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:10px;opacity:0.7;margin-left:4px;\" title=\"\"></i>'\n              : '';\n\n            const headerName = rawHeaderName.replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n            const safeStr = str =>\n              String(str)\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#039;');\n            const rawStrOriginal = String(cell).trim();\n            const rawStr = replaceUserPlaceholders(rawStrOriginal);\n            const invalidPlaceholders = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n            if (invalidPlaceholders.includes(rawStr.toLowerCase())) {\n              return ''; // \n            }\n\n            let contentHtml = '';\n            let hideLabel = false; // \n            const splitRegex = /[;]/;\n\n            // [] \n            const isIdentityField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return lowerHeader.includes('');\n            };\n\n            const isAttributeField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return (\n                lowerHeader.includes('') || lowerHeader.includes('') || lowerHeader.includes('')\n              );\n            };\n\n            //  ( \":92\"  \":92, :88\")\n            // [] \n            const parsedAttrs = isIdentityField(rawHeaderName) ? [] : parseAttributeString(rawStr);\n            // [] \n            if (isIdentityField(rawHeaderName)) {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            } else if (isRelationshipCell(rawStr, headerName)) {\n              // [] \n              const relations = parseRelationshipString(rawStr);\n              // [] \n              const validRelations = relations.filter(rel => {\n                if (!rel.relation) return true; // \n                return !invalidPlaceholders.includes(rel.relation.toLowerCase());\n              });\n\n              if (validRelations.length > 1) {\n                hideLabel = true;\n                let relHtml = '';\n                for (let i = 0; i < validRelations.length; i++) {\n                  const rel = validRelations[i];\n                  const borderStyle =\n                    i < validRelations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                  relHtml += '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;' + borderStyle + '\">';\n                  relHtml +=\n                    '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' +\n                    safeStr(rel.name) +\n                    inlineLockIcon +\n                    '</span>';\n                  if (rel.relation) {\n                    relHtml +=\n                      '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                      safeStr(rel.relation) +\n                      '</span>';\n                  }\n                  relHtml += '</div>';\n                }\n                contentHtml = '<div class=\"acu-relation-container\">' + relHtml + '</div>';\n              } else if (validRelations.length === 1) {\n                hideLabel = true;\n                const rel = validRelations[0];\n                contentHtml = '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;\">';\n                contentHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' +\n                  safeStr(rel.name) +\n                  inlineLockIcon +\n                  '</span>';\n                if (rel.relation) {\n                  contentHtml +=\n                    '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                    safeStr(rel.relation) +\n                    '</span>';\n                }\n                contentHtml += '</div>';\n              }\n            } else if (parsedAttrs.length > 1) {\n              // 2\n              hideLabel = true;\n              let attrsHtml = '';\n              for (let i = 0; i < parsedAttrs.length; i++) {\n                const attr = parsedAttrs[i];\n                const showDice = !BlacklistManager.isBlacklisted(attr.name);\n                attrsHtml +=\n                  '<div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 0;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.9em;white-space:nowrap;\" title=\"' +\n                  safeStr(attr.name) +\n                  '\">' +\n                  safeStr(attr.name.length > 3 ? attr.name.substring(0, 5) : attr.name) +\n                  inlineLockIcon +\n                  '</span>';\n                attrsHtml += '<div style=\"display:flex;align-items:center;gap:4px;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-main);font-weight:bold;font-size:0.95em;\">' +\n                  attr.value +\n                  '</span>';\n                if (showDice) {\n                  attrsHtml +=\n                    '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                    safeStr(attr.name) +\n                    '\" data-attr-value=\"' +\n                    attr.value +\n                    '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:10px;\" title=\"\"></i>';\n                }\n                attrsHtml += '</div></div>';\n              }\n              contentHtml = '<div class=\"acu-multi-attr-container\">' + attrsHtml + '</div>';\n            } else if (parsedAttrs.length === 1) {\n              //  ( \":92\") - \n              hideLabel = true;\n              const attr = parsedAttrs[0];\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml +=\n                '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' +\n                safeStr(attr.name) +\n                inlineLockIcon +\n                '</span>';\n              contentHtml += '<div style=\"display:flex;align-items:center;gap:6px;\">';\n              contentHtml += '<span style=\"color:var(--acu-text-main);font-weight:bold;\">' + attr.value + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(attr.name) +\n                  '\" data-attr-value=\"' +\n                  attr.value +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div></div>';\n            } else if (rawStr.length > 0 && splitRegex.test(rawStr) && !rawStr.includes('http')) {\n              // [] \n              const invalidTagValues = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n              const parts = rawStr\n                .split(splitRegex)\n                .map(s => s.trim())\n                .filter(s => s && !invalidTagValues.includes(s.toLowerCase()));\n              const allShort = parts.length > 1 && parts.every(p => p.length <= 6);\n              if (allShort) {\n                const tagsHtml = parts\n                  .map(part => {\n                    const subStyle = getBadgeStyle(part) || 'acu-badge-neutral';\n                    return '<span class=\"acu-badge ' + subStyle + '\">' + safeStr(part) + '</span>';\n                  })\n                  .join('');\n                contentHtml = '<div class=\"acu-tag-container\">' + tagsHtml + '</div>';\n              } else if (parts.length > 0) {\n                // \n                contentHtml = safeStr(parts.join('; '));\n              } else {\n                // \n                contentHtml = '';\n              }\n            } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n              // \n              const numVal = extractNumericValue(rawStr);\n              const showDice = !BlacklistManager.isBlacklisted(headerName);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml += '<span>' + safeStr(rawStr) + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(headerName) +\n                  '\" data-attr-value=\"' +\n                  numVal +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div>';\n            } else {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            }\n\n            const isDiffChanged = currentDiffMap.has(tableName + '-' + realRowIdx + '-' + cIdx);\n            const cellId = tableData.key + '-' + realRowIdx + '-' + cIdx;\n            const isUserModified = window.acuModifiedSet && window.acuModifiedSet.has(cellId);\n            let cellHighlight = '';\n            if (config.highlightNew) {\n              if (isUserModified) cellHighlight = 'acu-highlight-manual';\n              else if (isDiffChanged) cellHighlight = 'acu-highlight-diff';\n            }\n\n            //  class\n            //  ()\n\n            const rowClass =\n              'acu-card-row acu-cell' +\n              (spanFullRow ? ' acu-grid-span-full' : '') +\n              (hideLabel ? ' acu-hide-label' : '');\n\n            return (\n              '<div class=\"' +\n              rowClass +\n              '\" data-key=\"' +\n              escapeHtml(tableData.key) +\n              '\" data-tname=\"' +\n              escapeHtml(tableName) +\n              '\" data-row=\"' +\n              realRowIdx +\n              '\" data-col=\"' +\n              cIdx +\n              '\" data-val=\"' +\n              encodeURIComponent(cell ?? '') +\n              '\"><div class=\"acu-card-label\">' +\n              headerName +\n              inlineLockIcon +\n              '</div><div class=\"acu-card-value ' +\n              cellHighlight +\n              '\">' +\n              contentHtml +\n              '</div></div>'\n            );\n          })\n          .join('');\n\n        // []  acu-card-body  view-grid  view-list \n        // [] HTML\n        let tableActions = getActionsForTable(tableName);\n        let actionsHtml = '';\n\n        // [] \"\"\n        const interactColIdx = headers.findIndex(h => h && h.includes(''));\n        if (interactColIdx >= 0 && row[interactColIdx + 1]) {\n          // -nullnoneN/A \n          const invalidValues = ['-', 'null', 'none', '', '', 'n/a', 'undefined', '/'];\n          const interactOptions = String(row[interactColIdx + 1])\n            .split(/[,;]/)\n            .map(s => s.trim())\n            .filter(s => s && !invalidValues.includes(s.toLowerCase()));\n          if (interactOptions.length > 0) {\n            // \n            const existingLabels = tableActions.map(a => a.label.toLowerCase());\n            // \n            const iconMap = {\n              : 'fa-hand-fist',\n              : 'fa-hand-fist',\n              : 'fa-comments',\n              : 'fa-comments',\n              : 'fa-eye',\n              : 'fa-eye',\n              : 'fa-hand-pointer',\n              : 'fa-gift',\n              : 'fa-gift',\n              : 'fa-trash',\n              : 'fa-shield-halved',\n              : 'fa-calendar-check',\n              : 'fa-hand',\n              : 'fa-heart',\n              : 'fa-music',\n            };\n            // \n            const newActions = interactOptions\n              .filter(opt => !existingLabels.includes(opt.toLowerCase()))\n              .map(opt => ({\n                label: opt,\n                icon: iconMap[opt] || 'fa-hand-pointer',\n                type: 'prompt',\n                template: `<user>${opt}{Name}`,\n                auto_send: true,\n              }));\n            //  + \n            tableActions = [...tableActions, ...newActions];\n          }\n        }\n\n        if (tableActions.length > 0) {\n          const cardTitle = row[titleColIndex] || '';\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardLockRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n        const isCardRowLocked = cardLockRowKey && LockManager.isRowLocked(tableName, cardLockRowKey);\n        const cardLockIcon = isCardRowLocked\n          ? ' <i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:11px;opacity:0.8;\" title=\"\"></i>'\n          : '';\n\n        // bookmark\n        const cardBookmarkRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n        const isBookmarked = cardBookmarkRowKey && BookmarkManager.isBookmarked(tableName, cardBookmarkRowKey);\n        const bookmarkIcon = cardBookmarkRowKey\n          ? `<i class=\"${isBookmarked ? 'fa-solid' : 'fa-regular'} fa-bookmark acu-bookmark-icon ${isBookmarked ? 'bookmarked' : ''}\" data-table=\"${escapeHtml(tableName)}\" data-row-key=\"${escapeHtml(cardBookmarkRowKey)}\" title=\"${isBookmarked ? '' : ''}\"></i>`\n          : '';\n\n        return `<div class=\"acu-data-card ${isPending ? 'pending-deletion' : ''}\"><div class=\"acu-card-header\"><span class=\"acu-card-index\">${showDefaultIndex ? '#' + (realRowIdx + 1) : ''}</span><span class=\"acu-cell acu-editable-title ${rowClass}\" data-key=\"${escapeHtml(tableData.key)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(cardTitle ?? '')}\" title=\"\">${escapeHtml(cardTitle)}${cardLockIcon}</span>${bookmarkIcon}</div><div class=\"acu-card-body ${isGridMode ? 'view-grid' : 'view-list'}\">${cardBody}</div>${actionsHtml}</div>`;\n      })\n      .join('');\n    html += `</div></div>`;\n\n    if (totalPages > 1) {\n      html += `<div class=\"acu-panel-footer\"><button class=\"acu-page-btn ${currentPage === 1 ? 'disabled' : ''}\" data-page=\"${currentPage - 1}\" ${currentPage === 1 ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-left\"></i></button>`;\n      const range = [];\n      if (totalPages <= 7) {\n        for (let i = 1; i <= totalPages; i++) range.push(i);\n      } else {\n        if (currentPage <= 4) range.push(1, 2, 3, 4, 5, '...', totalPages);\n        else if (currentPage >= totalPages - 3)\n          range.push(1, '...', totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1, totalPages);\n        else range.push(1, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages);\n      }\n      range.forEach(p => {\n        if (p === '...') html += `<span class=\"acu-page-info\">...</span>`;\n        else html += `<button class=\"acu-page-btn ${p === currentPage ? 'active' : ''}\" data-page=\"${p}\">${p}</button>`;\n      });\n      html += `<button class=\"acu-page-btn ${currentPage === totalPages ? 'disabled' : ''}\" data-page=\"${currentPage + 1}\" ${currentPage === totalPages ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-right\"></i></button></div>`;\n    }\n    return html;\n  };\n\n  // []  ( + )\n  const saveCurrentTabState = () => {\n    const { $ } = getCore();\n    const activeTab = getActiveTabState();\n    const $content = $('.acu-panel-content');\n\n    if (activeTab && $content.length) {\n      const innerScrolls = {};\n      // \n      $content.find('.acu-data-card, .acu-card-body, .acu-edit-textarea').each(function () {\n        if (this.scrollTop > 0) {\n          //  (Row Index)\n          const $card = $(this).closest('.acu-data-card');\n          const rIdx = $card.find('.acu-editable-title').data('row');\n          // \n          const isEdit = $(this).hasClass('acu-edit-textarea');\n\n          if (rIdx !== undefined) {\n            const key = isEdit ? `edit-${rIdx}` : rIdx;\n            innerScrolls[key] = this.scrollTop;\n          }\n        }\n      });\n\n      // \n      tableScrollStates[activeTab] = {\n        left: $content.scrollLeft(),\n        top: $content.scrollTop(),\n        inner: innerScrolls,\n        timestamp: Date.now(), // \n      };\n    }\n  };\n\n  const closePanel = () => {\n    const { $ } = getCore();\n    saveCurrentTabState(); // <--- \n\n    $('#acu-data-area').removeClass('visible');\n    $('.acu-nav-btn').removeClass('active');\n    saveActiveTabState(null);\n    // [] \n    // $('.acu-embedded-options-container').remove();\n  };\n\n  /**\n   *  - \n   * CSS opacity + visibility \n   * @param {Function} updateContentFn -  $panel \n   */\n  const switchPanel = updateContentFn => {\n    const { $ } = getCore();\n    const $panel = $('#acu-data-area');\n    const isVisible = $panel.hasClass('visible');\n\n    if (!isVisible) {\n      // \n      updateContentFn($panel);\n      $panel.addClass('visible');\n    } else {\n      // CSS transition \n      updateContentFn($panel);\n    }\n  };\n\n  const bindEvents = tables => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    // [] -\n    $wrapper.on('click', '.acu-dash-relation-graph-btn', function (e) {\n      e.stopPropagation();\n      const allTables = processJsonData(cachedRawData || getTableData());\n      const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n      if (npcResult && npcResult.data) {\n        showRelationshipGraph(npcResult.data);\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-map-btn', function (e) {\n      e.stopPropagation();\n      showMapVisualization();\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-avatar-manager-btn', function (e) {\n      e.stopPropagation();\n\n      try {\n        // \n        let allTables;\n        try {\n          const rawData = cachedRawData || getTableData();\n          allTables = processJsonData(rawData);\n        } catch (dataError) {\n          console.error(':', dataError);\n          throw new Error('');\n        }\n\n        if (!allTables || allTables.length === 0) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n        const playerResult = DashboardDataParser.findTable(allTables, 'player');\n\n        const nodeArr = [];\n\n        // \n        if (playerResult?.data?.rows?.[0]) {\n          const playerName = playerResult.data.rows[0][1];\n          if (playerName && typeof playerName === 'string' && playerName.trim()) {\n            nodeArr.push({ name: playerName.trim(), isPlayer: true });\n          }\n        }\n\n        // NPC\n        if (npcResult?.data?.rows && Array.isArray(npcResult.data.rows)) {\n          npcResult.data.rows.forEach((row, idx) => {\n            if (Array.isArray(row) && row[1]) {\n              const npcName = row[1];\n              if (typeof npcName === 'string' && npcName.trim()) {\n                nodeArr.push({ name: npcName.trim(), isPlayer: false, rowIndex: idx });\n              }\n            }\n          });\n        }\n\n        // \n        if (nodeArr.length === 0) {\n          if (window.toastr) {\n            window.toastr.warning('NPC');\n          }\n          return;\n        }\n\n        // \n        try {\n          showAvatarManager(nodeArr, () => renderInterface());\n        } catch (managerError) {\n          console.error('showAvatarManager :', managerError);\n          throw new Error('');\n        }\n      } catch (error) {\n        // \n        console.error(':', error);\n\n        // \n        const errorMsg = error instanceof Error ? error.message : '';\n        if (window.toastr) {\n          window.toastr.error(`: ${errorMsg}`);\n        }\n      }\n    });\n    // \n    $wrapper.on('click', '.acu-dash-table-link', function (e) {\n      e.stopPropagation();\n      const tableName = $(this).data('table');\n      if (tableName) {\n        Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        saveActiveTabState(tableName);\n        renderInterface();\n      }\n    });\n\n    // []  SillyTavern\"\"\n    $('.acu-panel-content')\n      .off('touchstart.acu_swipe touchmove.acu_swipe')\n      .on('touchstart.acu_swipe', function (e) {\n        this._touchStartX = e.originalEvent.touches[0].clientX;\n        this._touchStartY = e.originalEvent.touches[0].clientY;\n      })\n      .on('touchmove.acu_swipe', function (e) {\n        if (!this._touchStartX) return;\n        const deltaX = Math.abs(e.originalEvent.touches[0].clientX - this._touchStartX);\n        const deltaY = Math.abs(e.originalEvent.touches[0].clientY - this._touchStartY);\n        // 45\n        if (deltaX > deltaY && deltaX > 10) {\n          e.stopPropagation();\n        }\n      });\n\n    $('body')\n      .off('click.acu_nav_toggle')\n      .on('click.acu_nav_toggle', '.acu-nav-toggle-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        const currentState = getCollapsedState();\n        saveCollapsedState(!currentState);\n        renderInterface();\n      });\n\n    const $panel = $('.acu-panel-content');\n    if ($panel.length) {\n      // [] \n      let scrollTimer = null;\n      $panel.off('scroll.acu_save').on('scroll.acu_save', function () {\n        const $this = $(this);\n        if (scrollTimer) clearTimeout(scrollTimer);\n        scrollTimer = setTimeout(() => {\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            if (!tableScrollStates[activeTab]) tableScrollStates[activeTab] = { top: 0, left: 0, inner: {} };\n            tableScrollStates[activeTab].top = $this.scrollTop();\n            tableScrollStates[activeTab].left = $this.scrollLeft();\n            // \n          }\n        }, 200);\n      });\n    }\n\n    $('body')\n      .off('click.acu_delegate')\n      .on('click.acu_delegate', '.acu-wrapper', function (e) {\n        if (isEditingOrder) return;\n        const $target = $(e.target);\n\n        // []  - \n        const $settingsBtn = $target.closest('#acu-btn-settings');\n        if ($settingsBtn.length) {\n          e.stopPropagation();\n          e.preventDefault();\n          showSettingsModal();\n          return;\n        }\n\n        const $navBtn = $target.closest('.acu-nav-btn');\n        if ($navBtn.length) {\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-dashboard') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isDashboardActive && isPanelVisible) {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, true);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                const rawData = cachedRawData || getTableData();\n                const tables = processJsonData(rawData || {});\n                $panel.html(renderDashboard(tables));\n                bindEvents(tables);\n              });\n            }\n            return false;\n          }\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-changes') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isChangesActive = Store.get('acu_changes_panel_active', false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isChangesActive && isPanelVisible) {\n              // \n              Store.set('acu_changes_panel_active', false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set('acu_changes_panel_active', true);\n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                const rawData = cachedRawData || getTableData();\n                $panel.html(renderChangesPanel(rawData));\n                bindChangesEvents();\n              });\n            }\n            return false;\n          }\n          // [] MVU\n          if ($navBtn.attr('id') === 'acu-btn-mvu') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isMvuActive && isPanelVisible) {\n              // \n              saveActiveTabState(null);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              Store.set('acu_changes_panel_active', false);\n              saveActiveTabState(MvuModule.MODULE_ID);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                try {\n                  const panelHtml = MvuModule.renderPanel();\n                  // \n                  const mvuSavedHeight = getTableHeights()[MvuModule.MODULE_ID];\n                  if (mvuSavedHeight) {\n                    $panel.css('height', mvuSavedHeight + 'px').addClass('acu-manual-mode');\n                  } else {\n                    $panel.css('height', '').removeClass('acu-manual-mode');\n                  }\n                  $panel.html('<div class=\"acu-mvu-panel\">' + panelHtml + '</div>');\n                  MvuModule.bindEvents($panel);\n                } catch (error) {\n                  console.error('[MVU] Error rendering panel:', error);\n                }\n\n                // \n                MvuModule.getDataWithRetry(5, 800)\n                  .then(mvuData => {\n                    // \n                    if (mvuData) {\n                      $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                      MvuModule.bindEvents($panel);\n                    }\n                  })\n                  .catch(err => {\n                    console.error('[DICE]MvuModule Error getting data:', err);\n                    // \n                    $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                    MvuModule.bindEvents($panel);\n                  });\n              });\n            }\n            return false;\n          }\n          e.stopPropagation();\n          // [] \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          Store.set('acu_changes_panel_active', false);\n          const tableName = $navBtn.data('table');\n          const currentActiveTab = getActiveTabState();\n          if (currentActiveTab === tableName && $('#acu-data-area').hasClass('visible')) {\n            closePanel();\n            return;\n          }\n          $('.acu-nav-btn').removeClass('active');\n          $navBtn.addClass('active');\n          if ($('.acu-panel-content').length && currentActiveTab) {\n            saveCurrentTabState();\n          }\n          saveActiveTabState(tableName);\n          setTimeout(() => renderInterface(), 0);\n          return;\n        }\n        const $cell = $target.closest('.acu-cell');\n        if ($cell.length) {\n          e.stopPropagation();\n          showCellMenu(e, $cell[0]);\n          return;\n        }\n        const $pageBtn = $target.closest('.acu-page-btn');\n        if ($pageBtn.length) {\n          e.stopPropagation();\n          if ($pageBtn.hasClass('disabled') || $pageBtn.hasClass('active')) return;\n          const newPage = parseInt($pageBtn.data('page'));\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tablePageStates[activeTab] = newPage;\n            renderInterface();\n            requestAnimationFrame(() => {\n              $('.acu-panel-content').scrollTop(0);\n            });\n          }\n          return;\n        }\n        return;\n      });\n\n    $('#acu-btn-expand')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(false);\n        renderInterface();\n      });\n    // [] \n    $('#acu-btn-collapse')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(true);\n        renderInterface();\n      });\n\n    // []  =  (Instant Revert)\n    $('#acu-btn-refresh')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n\n        // [] \n        if (isEditingOrder) return;\n\n        // 1. \n        if (isSaving) {\n          if (window.toastr) window.toastr.warning(' ...');\n          return;\n        }\n\n        const $btn = $(e.currentTarget);\n        const $icon = $btn.find('i');\n        // $icon.addClass('fa-spin'); // \n\n        // 2.  ()\n        // (1) \n        savePendingDeletions({});\n\n        // (2)  -> \n        cachedRawData = null;\n\n        // (3) \n        hasUnsavedChanges = false;\n        currentDiffMap.clear();\n        if (window.acuModifiedSet) window.acuModifiedSet.clear();\n\n        // (4)  ()\n        const $saveBtn = $('#acu-btn-save-global');\n        $saveBtn.find('i').removeClass('acu-icon-breathe');\n        $saveBtn.attr('title', '').css('color', '');\n\n        // 3.  300ms \n        // await new Promise(r => setTimeout(r, 300)); // <--- \n\n        // Last SnapshotAPI\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          cachedRawData = snapshot; // \n        }\n\n        // 4. \n        // \n        $('.acu-edit-overlay, .acu-cell-menu, .acu-menu-backdrop').remove();\n\n        // \n        renderInterface();\n\n        // $icon.removeClass('fa-spin');\n      });\n\n    // [] \n    $('#acu-btn-force-update')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          if (window.toastr) {\n            window.toastr.warning('  manualUpdate ', '', {\n              timeOut: 5000,\n            });\n          }\n        }\n      });\n    $('body')\n      .off('click.acu_settings')\n      .on('click.acu_settings', '#acu-btn-settings', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        showSettingsModal();\n      });\n    // [] \n    $('#acu-btn-dice-nav')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        showDicePanel({\n          targetValue: null,\n          targetName: '',\n          //  diceType\n        });\n      });\n\n    /* // \n    $('#acu-btn-open-editor').off('click').on('click', (e) => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.openVisualizer === 'function') {\n            api.openVisualizer();\n        } else if (window.toastr) {\n            window.toastr.warning('()');\n        }\n    });\n    */\n\n    // \n    $('#acu-btn-refill')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            console.log('[DICE]ACU ');\n            //  manualUpdate \n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          console.warn('[DICE]ACU manualUpdate API ');\n          if (window.toastr) {\n            window.toastr.warning(' manualUpdate ', '', { timeOut: 3000 });\n          }\n        }\n      });\n    $('#acu-btn-save-global')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        let dataToSave = null;\n        if (hasUnsavedChanges && cachedRawData) {\n          dataToSave = cachedRawData;\n        } else {\n          dataToSave = getTableData();\n        }\n\n        if (dataToSave) {\n          // 1.  false  true\n          await saveDataToDatabase(dataToSave, true, true);\n\n          // 2. \n          // \n          $('.acu-highlight-manual').removeClass('acu-highlight-manual');\n\n          // 3. \n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          hasUnsavedChanges = false;\n\n          // 4. \n          const $btn = $(this);\n          const $icon = $btn.find('i');\n          $icon.removeClass('acu-icon-breathe fa-spinner fa-spin').addClass('fa-save');\n          $btn.attr('title', '').css('color', '');\n          $btn.prop('disabled', false);\n\n          // 5. \n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    const $searchInput = $('.acu-search-input');\n    if ($searchInput.length) {\n      let searchTimeout;\n      let isComposing = false;\n      $searchInput\n        .off('compositionstart compositionend input')\n        .on('compositionstart', () => {\n          isComposing = true;\n        })\n        .on('compositionend', function () {\n          isComposing = false;\n          const val = $(this).val();\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tableSearchStates[activeTab] = val;\n            tablePageStates[activeTab] = 1;\n            renderInterface();\n            setTimeout(() => {\n              $('.acu-search-input').focus();\n            }, 0);\n          }\n        })\n        .on('input', function () {\n          if (isComposing) return;\n          const val = $(this).val();\n          const selectionStart = this.selectionStart;\n          const selectionEnd = this.selectionEnd;\n          clearTimeout(searchTimeout);\n          searchTimeout = setTimeout(() => {\n            const activeTab = getActiveTabState();\n            if (activeTab) {\n              tableSearchStates[activeTab] = val;\n              tablePageStates[activeTab] = 1;\n              const isFocus = document.activeElement && document.activeElement.classList.contains('acu-search-input');\n              renderInterface();\n              if (isFocus) {\n                const $newInput = $('.acu-search-input');\n                $newInput.focus();\n                if ($newInput.length && $newInput[0].setSelectionRange) {\n                  try {\n                    $newInput[0].setSelectionRange(selectionStart, selectionEnd);\n                  } catch (e) {}\n                }\n              }\n            }\n          }, 300);\n        });\n    }\n    // \n    $('#acu-btn-relation-graph')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const rawData = cachedRawData || getTableData();\n        if (rawData) {\n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (sheet?.name === tableName) {\n              const tableData = {\n                headers: sheet.content?.[0] || [],\n                rows: sheet.content?.slice(1) || [],\n                key: key,\n              };\n              showRelationshipGraph(tableData);\n              return;\n            }\n          }\n        }\n        if (window.toastr) window.toastr.warning('');\n      });\n    // \n    $('.acu-table-map-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        showMapVisualization();\n      });\n    // --- []  ---\n\n    // 1. \n    $('#acu-btn-switch-style')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const styles = getTableStyles();\n        const current = styles[tableName] || 'list';\n        styles[tableName] = current === 'grid' ? 'list' : 'grid'; // \n        saveTableStyles(styles);\n        renderInterface(); // \n      });\n\n    // 2. \n    $('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          if (tableName) {\n            const heights = getTableHeights();\n            heights[tableName] = parseInt($panel.css('height'));\n            saveTableHeights(heights);\n            $panel.addClass('acu-manual-mode');\n          }\n        };\n      });\n\n    // 3.  - \n    $('.acu-height-drag-handle')\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    // [] \n    $wrapper.on('click', '.acu-reverse-btn', function (e) {\n      e.stopPropagation();\n      const tName = $(this).data('table');\n      if (!tName) return;\n\n      toggleTableReverse(tName);\n\n      // \n      renderInterface();\n    });\n    // [] \n    $('.acu-panel-header')\n      .off('dblclick.acu')\n      .on('dblclick.acu', function (e) {\n        if ($(e.target).closest('.acu-search-input, .acu-close-btn, .acu-view-btn').length) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = getActiveTabState();\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    $('.acu-close-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $input = $('.acu-search-input');\n\n        // \n        if ($input.length && $input.val()) {\n          $input.val('').trigger('input').focus();\n          return;\n        }\n\n        // \n        const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        if (isDashboardActive) {\n          // \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n        if (isMvuActive) {\n          // \n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        closePanel();\n      });\n    // [] bookmark\n    $('body')\n      .off('click.acu_bookmark')\n      .on('click.acu_bookmark', '.acu-bookmark-icon', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $icon = $(this);\n        const tableName = $icon.data('table');\n        const rowKey = $icon.data('row-key');\n\n        if (!tableName || !rowKey) return;\n\n        // bookmark\n        BookmarkManager.toggleBookmark(tableName, rowKey);\n\n        // \n        if (typeof renderInterface === 'function') {\n          renderInterface();\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_action')\n      .on('click.acu_action', '.acu-action-item', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $btn = $(this);\n        const rowIdx = parseInt($btn.data('row'), 10);\n        const actionIdx = parseInt($btn.data('action-idx'), 10);\n\n        // \n        const $card = $btn.closest('.acu-data-card');\n        const $title = $card.find('.acu-editable-title');\n        const tableKey = $title.data('key');\n        const tableName = $title.data('tname') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const headers = rawData[tableKey].content[0] || [];\n        const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n\n        // \n        const invalidValues = ['-', 'null', 'none', '', '', 'n/a', 'undefined', '/'];\n\n        // \n        let actions = getActionsForTable(tableName);\n\n        // \"\"\n        const interactColIdx = headers.findIndex(h => h && String(h).includes(''));\n        if (interactColIdx >= 0 && rowData[interactColIdx]) {\n          const cellValue = String(rowData[interactColIdx]).trim();\n          if (cellValue && !invalidValues.includes(cellValue.toLowerCase())) {\n            const interactOptions = cellValue\n              .split(/[,;]/)\n              .map(s => s.trim())\n              .filter(s => s && !invalidValues.includes(s.toLowerCase()));\n            if (interactOptions.length > 0) {\n              // \n              const existingLabels = actions.map(a => a.label.toLowerCase());\n              // \n              const newActions = interactOptions\n                .filter(opt => !existingLabels.includes(opt.toLowerCase()))\n                .map(opt => ({\n                  label: opt,\n                  icon: 'fa-hand-pointer',\n                  type: 'prompt',\n                  template: `<user>{Name}${opt}`,\n                  auto_send: true,\n                }));\n              //  + \n              actions = [...actions, ...newActions];\n            }\n          }\n        }\n\n        const action = actions[actionIdx];\n\n        // [] \n        if (action && action.type === 'skill_check') {\n          const skillName = rowData[1] || '';\n\n          // \n          let checkValue = null;\n          const attrValIdx = headers.findIndex(h => h && h.includes(''));\n          const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n          // \n          if (attrValIdx > 0 && rowData[attrValIdx]) {\n            const val = extractNumericValue(rowData[attrValIdx]);\n            if (val > 0) checkValue = val;\n          }\n          // \n          if (checkValue === null && profIdx > 0 && rowData[profIdx]) {\n            const val = extractNumericValue(rowData[profIdx]);\n            if (val > 0) checkValue = val;\n          }\n\n          // \n          const promptText = processTemplate(action.template, rowData, headers);\n          smartInsertToTextarea(promptText, 'action');\n\n          // \n          if (checkValue !== null && checkValue > 0) {\n            showDicePanel({\n              targetValue: checkValue,\n              targetName: skillName,\n              initiatorName: '<user>',\n            });\n          } else {\n            $('#send_textarea').focus();\n          }\n          return;\n        }\n\n        if (action && action.template) {\n          // \n          const rawData = cachedRawData || getTableData();\n          if (rawData && rawData[tableKey]) {\n            const headers = rawData[tableKey].content[0] || [];\n            const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n            const npcName = rowData[1] || '';\n\n            // \"\"\n            if (action.label === '') {\n              const config = getConfig();\n              $('.acu-msg-overlay').remove();\n\n              const t = getThemeColors();\n\n              const overlay = $(`\n                        <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2147483647;display:flex;justify-content:center;align-items:center;\">\n                            <div style=\"background:${t.bgPanel};border:1px solid ${t.border};border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                                <div style=\"font-size:14px;font-weight:bold;color:${t.accent};margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                                    <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                                </div>\n                                <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:6px;color:${t.textMain} !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                                <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                                    <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:6px;color:${t.textMain};cursor:pointer;\"></button>\n                                    <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:${t.btnActiveBg};border:none;border-radius:6px;color:${t.btnActiveText};cursor:pointer;font-weight:bold;\"></button>\n                                </div>\n                            </div>\n                        </div>\n                    `);\n\n              $('body').append(overlay);\n              // []  JS  overlay \n              const overlayEl = overlay[0];\n              overlayEl.style.setProperty('position', 'fixed', 'important');\n              overlayEl.style.setProperty('top', '0', 'important');\n              overlayEl.style.setProperty('left', '0', 'important');\n              overlayEl.style.setProperty('right', '0', 'important');\n              overlayEl.style.setProperty('bottom', '0', 'important');\n              overlayEl.style.setProperty('width', '100vw', 'important');\n              overlayEl.style.setProperty('height', '100vh', 'important');\n              overlayEl.style.setProperty('display', 'flex', 'important');\n              overlayEl.style.setProperty('justify-content', 'center', 'important');\n              overlayEl.style.setProperty('align-items', 'center', 'important');\n              overlayEl.style.setProperty('z-index', '2147483650', 'important');\n              setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n              const sendMessage = () => {\n                const msg = overlay.find('#acu-msg-input').val().trim();\n                if (msg) {\n                  const promptText = `<user>${npcName}\"${msg}\"`;\n                  smartInsertToTextarea(promptText, 'action');\n                  $('#send_textarea').focus();\n                }\n                overlay.remove();\n              };\n\n              overlay.find('#acu-msg-send').click(sendMessage);\n              overlay.find('#acu-msg-input').on('keydown', function (ev) {\n                if (ev.key === 'Enter') {\n                  ev.preventDefault();\n                  sendMessage();\n                }\n              });\n              overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n              overlay.on('click', function (ev) {\n                if ($(ev.target).hasClass('acu-msg-overlay')) overlay.remove();\n              });\n              return;\n            }\n\n            //  processTemplate \n            const promptText = processTemplate(action.template, rowData, headers);\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_global_dice')\n      .on('click.acu_global_dice', '#acu-btn-dice', function (e) {\n        e.stopPropagation();\n        showDicePanel({\n          targetValue: 50,\n          targetName: '',\n          diceType: '1d100',\n        });\n      });\n    // ========== [] ==========\n    // /\n    $('body')\n      .off('click.acu_location_toggle')\n      .on('click.acu_location_toggle', '.acu-location-header', function (e) {\n        e.stopPropagation();\n        const $group = $(this).closest('.acu-location-group');\n        $group.toggleClass('expanded');\n      });\n\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_jump')\n      .on('click.acu_dash_jump', '.acu-dash-jump-link, .acu-dash-loc-item', function (e) {\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const searchTerm = $(this).data('search') || '';\n\n        if (tableName) {\n          // 1. \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n\n          // 2. \n          saveActiveTabState(tableName);\n\n          // 3. \n          if (searchTerm) {\n            tableSearchStates[tableName] = searchTerm;\n            tablePageStates[tableName] = 1;\n          }\n\n          // 4. \n          renderInterface();\n\n          // 5. \n          if (searchTerm) {\n            setTimeout(() => {\n              const $input = $('.acu-search-input');\n              if ($input.length) $input.focus();\n            }, 100);\n          }\n        }\n      });\n    // ========== [] ==========\n    // [] \n    $('body')\n      .off('click.acu_inline_dice')\n      .on('click.acu_inline_dice', '.acu-inline-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        //  .attr()  jQuery \n        const attrName = $(this).attr('data-attr-name') || '';\n        const attrValue = parseInt($(this).attr('data-attr-value'), 10) || 50;\n\n        // NPC\n        const $card = $(this).closest('.acu-data-card');\n        const cardTitle = $card.find('.acu-editable-title').text().trim();\n\n        // <user>\n        const tableName = $card.find('.acu-editable-title').data('tname') || '';\n        const isPlayerTable = tableName.includes('');\n        const initiatorName = isPlayerTable ? '<user>' : cardTitle;\n\n        showDicePanel({\n          attrValue: attrValue,\n          targetValue: null, // showDicePanel\n          targetName: attrName,\n          initiatorName: initiatorName,\n          //  diceType\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_dice')\n      .on('click.acu_dash_dice', '.acu-dash-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const targetValue = parseInt($(this).data('target'), 10) || 50;\n        const targetName = $(this).data('name') || '';\n        const npcName = $(this).data('npc') || '';\n\n        // NPC\n        if (npcName) {\n          // \n          const playerAttrValue = getAttributeValue('<user>', targetName) || 50;\n          showContestPanel({\n            initiatorName: '<user>',\n            initiatorValue: playerAttrValue,\n            opponentName: npcName,\n            opponentValue: targetValue,\n          });\n        } else {\n          showDicePanel({\n            targetValue: targetValue,\n            targetName: targetName,\n            initiatorName: '<user>',\n          });\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_goto')\n      .on('click.acu_dash_goto', '.acu-dash-goto-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const locationName = $(this).data('location') || '';\n        const promptText = `<user>${locationName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_use_item')\n      .on('click.acu_dash_use_item', '.acu-dash-use-item-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const itemName = $(this).data('item') || '';\n        const promptText = `<user>${itemName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\" - \n    $('body')\n      .off('click.acu_dash_use_skill')\n      .on('click.acu_dash_use_skill', '.acu-dash-use-skill-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const skillName = $(this).data('skill') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        let checkValue = null;\n\n        if (rawData) {\n          // \n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n            if (sheet.name.includes('') || sheet.name.includes('')) {\n              const headers = sheet.content[0] || [];\n              // \n              const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n              const attrValIdx = headers.findIndex(h => h && h.includes(''));\n              const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n              for (let i = 1; i < sheet.content.length; i++) {\n                const row = sheet.content[i];\n                if (row && row[nameIdx === -1 ? 1 : nameIdx] === skillName) {\n                  // \n                  if (attrValIdx > 0 && row[attrValIdx]) {\n                    const val = extractNumericValue(row[attrValIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  // \n                  if (profIdx > 0 && row[profIdx]) {\n                    const val = extractNumericValue(row[profIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n              if (checkValue !== null) break;\n            }\n          }\n        }\n\n        // \n        const promptText = `<user>${skillName}`;\n        smartInsertToTextarea(promptText, 'action');\n\n        // \n        if (checkValue !== null && checkValue > 0) {\n          showDicePanel({\n            targetValue: checkValue,\n            targetName: skillName,\n            initiatorName: '<user>',\n          });\n        } else {\n          // \n          $('#send_textarea').focus();\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_track_task')\n      .on('click.acu_dash_track_task', '.acu-dash-track-task-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const taskName = $(this).data('task') || '';\n        const promptText = `<user>${taskName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_msg')\n      .on('click.acu_dash_msg', '.acu-dash-msg-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n        const config = getConfig();\n\n        // \n        $('.acu-msg-overlay').remove();\n\n        // \n        const t = getThemeColors();\n\n        const overlay = $(`\n            <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2147483647;display:flex;justify-content:center;align-items:center;\">\n                <div class=\"acu-msg-dialog\" style=\"background:${t.bgPanel};border:1px solid ${t.border};border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                    <div style=\"font-size:14px;font-weight:bold;color:${t.accent};margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                        <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                    </div>\n                    <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:6px;color:${t.textMain} !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                    <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                        <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:6px;color:${t.textMain};cursor:pointer;\"></button>\n                        <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:${t.btnActiveBg};border:none;border-radius:6px;color:${t.btnActiveText};cursor:pointer;font-weight:bold;\"></button>\n                    </div>\n                </div>\n            </div>\n        `);\n\n        $('body').append(overlay);\n        const overlayEl = overlay[0];\n        overlayEl.style.setProperty('position', 'fixed', 'important');\n        overlayEl.style.setProperty('top', '0', 'important');\n        overlayEl.style.setProperty('left', '0', 'important');\n        overlayEl.style.setProperty('right', '0', 'important');\n        overlayEl.style.setProperty('bottom', '0', 'important');\n        overlayEl.style.setProperty('width', '100vw', 'important');\n        overlayEl.style.setProperty('height', '100vh', 'important');\n        overlayEl.style.setProperty('display', 'flex', 'important');\n        overlayEl.style.setProperty('justify-content', 'center', 'important');\n        overlayEl.style.setProperty('align-items', 'center', 'important');\n        overlayEl.style.setProperty('z-index', '2147483650', 'important');\n        setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n        const sendMessage = () => {\n          const msg = overlay.find('#acu-msg-input').val().trim();\n          if (msg) {\n            const promptText = `<user>${npcName}\"${msg}\"`;\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n          overlay.remove();\n        };\n\n        // \n        overlay.find('#acu-msg-send').click(sendMessage);\n\n        // \n        overlay.find('#acu-msg-input').on('keydown', function (ev) {\n          if (ev.key === 'Enter') {\n            ev.preventDefault();\n            sendMessage();\n          }\n        });\n\n        // \n        overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n        overlay.on('click', function (ev) {\n          if ($(ev.target).hasClass('acu-msg-overlay')) overlay.remove();\n        });\n      });\n    // [] NPC\n    $('body')\n      .off('click.acu_dash_contest')\n      .on('click.acu_dash_contest', '.acu-dash-contest-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n\n        const rawData = cachedRawData || getTableData();\n\n        var playerAttrValue = 50;\n        var npcAttrValue = 50;\n        var foundPlayer = false;\n        var foundNPC = false;\n\n        if (rawData) {\n          for (var key in rawData) {\n            var sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n\n            // \n            if (sheet.name === '') {\n              if (sheet.content[1]) {\n                var attrStr = sheet.content[1][7] || '';\n                var parts = attrStr.split(/[,;\\s]+/);\n                for (var i = 0; i < parts.length; i++) {\n                  var match = parts[i].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                  if (match) {\n                    playerAttrValue = parseInt(match[2], 10);\n                    foundPlayer = true;\n                    break;\n                  }\n                }\n              }\n            }\n\n            // \n            if (sheet.name === '' && npcName) {\n              for (var j = 1; j < sheet.content.length; j++) {\n                var row = sheet.content[j];\n                if (row && row[1] === npcName) {\n                  var npcAttrStr = row[9] || '';\n                  var npcParts = npcAttrStr.split(/[,;\\s]+/);\n                  for (var k = 0; k < npcParts.length; k++) {\n                    var npcMatch = npcParts[k].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                    if (npcMatch) {\n                      npcAttrValue = parseInt(npcMatch[2], 10);\n                      foundNPC = true;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n            }\n          }\n        }\n\n        showContestPanel({\n          initiatorName: '<user>',\n          initiatorValue: playerAttrValue,\n          opponentName: npcName,\n          opponentValue: npcAttrValue,\n          diceType: '1d100',\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_preview')\n      .on('click.acu_dash_preview', '.acu-dash-preview-trigger', function (e) {\n        e.stopPropagation();\n\n        const tableKey = $(this).data('table-key');\n        const rowIndex = parseInt($(this).data('row-index'), 10);\n\n        if (!tableKey || isNaN(rowIndex)) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const table = rawData[tableKey];\n        const tableName = table.name || '';\n        const headers = table.content[0] || [];\n        const rowData = table.content[rowIndex + 1];\n\n        if (!rowData) return;\n\n        const config = getConfig();\n        const title = rowData[1] || '';\n\n        //  renderTableContent \n        const titleColIndex = 1;\n        const realRowIdx = rowIndex;\n\n        // \n        let cardBody = '';\n        rowData.forEach((cell, cIdx) => {\n          if (cIdx <= 0 || cIdx === titleColIndex) return;\n          const currentHeader = headers[cIdx] || '';\n          if (currentHeader.includes('')) return; // \n\n          const headerName = headers[cIdx] || '' + cIdx;\n          const rawStr = String(cell || '').trim();\n          if (!rawStr) return;\n\n          // [] \n          const lockRowKey = LockManager.getRowKey(tableName, rowData, headers);\n          const isThisFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, headerName);\n          const inlineLockIcon = isThisFieldLocked\n            ? '<i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:10px;opacity:0.7;margin-left:4px;\" title=\"\"></i>'\n            : '';\n\n          let contentHtml = '';\n          let hideLabel = false;\n\n          const parsedAttrs = parseAttributeString(rawStr);\n          // [] \n          if (isRelationshipCell(rawStr, headerName)) {\n            const relations = parseRelationshipString(rawStr);\n            if (relations.length > 1) {\n              hideLabel = true;\n              let relHtml = '';\n              relations.forEach((rel, i) => {\n                const borderStyle = i < relations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                relHtml += `<div style=\"display:flex;justify-content:flex-start;align-items:center;gap:8px;padding:3px 0;${borderStyle}\">\n                              <span style=\"color:var(--acu-text-main);font-size:0.95em;\">${escapeHtml(rel.name)}${inlineLockIcon}</span>\n                              ${rel.relation ? `<span style=\"color:var(--acu-text-sub);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>` : ''}\n                          </div>`;\n              });\n              contentHtml = `<div class=\"acu-relation-container\">${relHtml}</div>`;\n            } else if (relations.length === 1 && relations[0].relation) {\n              const rel = relations[0];\n              contentHtml = `<div style=\"display:flex;justify-content:flex-start;align-items:center;gap:8px;\">\n                          <span style=\"color:var(--acu-text-main);\">${escapeHtml(rel.name)}${inlineLockIcon}</span>\n                          <span style=\"color:var(--acu-text-sub);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>\n                      </div>`;\n            }\n          } else if (parsedAttrs.length > 1) {\n            hideLabel = true;\n            let attrsHtml = '';\n            parsedAttrs.forEach((attr, i) => {\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              const borderStyle = i < parsedAttrs.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n              attrsHtml += `<div style=\"display:flex;justify-content:space-between;align-items:center;padding:3px 0;${borderStyle}\">\n                          <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(attr.name)}${inlineLockIcon}</span>\n                          <div style=\"display:flex;align-items:center;gap:6px;\">\n                              <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                              ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                          </div></div>`;\n            });\n            contentHtml = `<div class=\"acu-multi-attr-container\">${attrsHtml}</div>`;\n          } else if (parsedAttrs.length === 1) {\n            hideLabel = true;\n            const attr = parsedAttrs[0];\n            const showDice = !BlacklistManager.isBlacklisted(attr.name);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                      <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(attr.name)}${inlineLockIcon}</span>\n                      <div style=\"display:flex;align-items:center;gap:6px;\">\n                          <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                          ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                      </div></div>`;\n          } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n            const numVal = extractNumericValue(rawStr);\n            const showDice = !BlacklistManager.isBlacklisted(headerName);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                      <span>${escapeHtml(rawStr)}</span>\n                      ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(headerName)}\" data-attr-value=\"${numVal}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;margin-left:6px;\" title=\"\"></i>` : ''}\n                  </div>`;\n          } else {\n            const badgeStyle = getBadgeStyle(rawStr);\n            contentHtml = badgeStyle\n              ? `<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(rawStr)}</span>`\n              : escapeHtml(rawStr);\n          }\n\n          const rowClass = 'acu-card-row acu-cell' + (hideLabel ? ' acu-hide-label' : '');\n          cardBody += `<div class=\"${rowClass}\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${cIdx}\" data-val=\"${encodeURIComponent(cell ?? '')}\">\n                <div class=\"acu-card-label\">${escapeHtml(headerName)}</div>\n                <div class=\"acu-card-value\">${contentHtml}</div>\n            </div>`;\n        });\n\n        // \n        let actionsHtml = '';\n        let tableActions = getActionsForTable(tableName);\n        const interactColIdx = headers.findIndex(h => h && String(h).includes(''));\n        if (interactColIdx > 0 && rowData[interactColIdx]) {\n          const interactOptions = String(rowData[interactColIdx])\n            .split(/[,;]/)\n            .map(s => s.trim())\n            .filter(s => s);\n          if (interactOptions.length > 0) {\n            tableActions = interactOptions.map(opt => ({\n              label: opt,\n              icon: 'fa-hand-pointer',\n              type: 'prompt',\n              template: `<user>{Name}${opt}`,\n              auto_send: true,\n            }));\n          }\n        }\n        if (tableActions.length > 0) {\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardHtml = `\n            <div class=\"acu-preview-overlay acu-theme-${config.theme}\" style=\"--acu-card-width:${config.cardWidth}px;--acu-font-size:${config.fontSize}px;\">\n                <div class=\"acu-data-card\" style=\"width:90vw;max-width:420px;max-height:85vh;overflow-y:auto;\">\n                    <div class=\"acu-card-header\">\n                        <span class=\"acu-card-index\">#${realRowIdx + 1}</span>\n                        <span class=\"acu-cell acu-editable-title\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(title)}\">${escapeHtml(title)}</span>\n                        <button class=\"acu-preview-close\" style=\"margin-left:auto;background:none;border:none;color:var(--acu-text-sub);cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-card-body view-list\">${cardBody}</div>\n                    ${actionsHtml}\n                </div>\n            </div>\n        `;\n\n        $('.acu-preview-overlay').remove();\n        $('body').append(cardHtml);\n\n        // \n        const overlayEl = $('.acu-preview-overlay')[0];\n        if (overlayEl) {\n          overlayEl.style.setProperty('position', 'fixed', 'important');\n          overlayEl.style.setProperty('top', '0', 'important');\n          overlayEl.style.setProperty('left', '0', 'important');\n          overlayEl.style.setProperty('right', '0', 'important');\n          overlayEl.style.setProperty('bottom', '0', 'important');\n          overlayEl.style.setProperty('width', '100vw', 'important');\n          overlayEl.style.setProperty('height', '100vh', 'important');\n          overlayEl.style.setProperty('display', 'flex', 'important');\n          overlayEl.style.setProperty('justify-content', 'center', 'important');\n          overlayEl.style.setProperty('align-items', 'center', 'important');\n          overlayEl.style.setProperty('z-index', '2147483650', 'important');\n        }\n\n        // \n        $('.acu-preview-overlay').on('click', function (ev) {\n          if ($(ev.target).hasClass('acu-preview-overlay') || $(ev.target).closest('.acu-preview-close').length) {\n            $(this).remove();\n          }\n        });\n      });\n\n    // === []  ST  swipe regenerate ===\n    (function () {\n      const $doc = $(document);\n      let touchStartX = 0;\n      let touchStartY = 0;\n\n      //  data-area\n      $doc.on('touchstart.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length === 1) {\n          touchStartX = e.originalEvent.touches[0].clientX;\n          touchStartY = e.originalEvent.touches[0].clientY;\n        }\n      });\n\n      $doc.on('touchmove.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length !== 1) return;\n\n        const touch = e.originalEvent.touches[0];\n        const deltaX = Math.abs(touch.clientX - touchStartX);\n        const deltaY = Math.abs(touch.clientY - touchStartY);\n\n        // X > Y * 1.5\n        if (deltaX > deltaY * 1.5 && deltaX > 10) {\n          e.stopPropagation();\n          console.log('[DICE]ACU  ST swipe');\n        }\n      });\n    })();\n  };\n\n  let selectedSwapSource = null;\n  const toggleOrderEditMode = () => {\n    const { $ } = getCore();\n    isEditingOrder = !isEditingOrder;\n\n    const $container = $('#acu-nav-bar');\n    const $hint = $('#acu-order-hint');\n    const $pool = $('#acu-action-pool');\n\n    // \n    if (!$container.length) {\n      console.error('[DICE]ACU ');\n      isEditingOrder = false;\n      return;\n    }\n\n    selectedSwapSource = null;\n    $('.acu-swap-selected').removeClass('acu-swap-selected');\n\n    if (isEditingOrder) {\n      // \n      $container.addClass('editing-order');\n      if ($pool.length) $pool.addClass('visible');\n\n      if ($hint.length) {\n        $hint\n          .html(\n            `\n                    <div style=\"display:flex; justify-content:space-between; align-items:center; width:100%; flex-wrap:wrap; gap:8px;\">\n                        <div style=\"display:flex; align-items:center; gap:10px; flex:1; min-width:200px;\">\n                            <span><i class=\"fa-solid fa-layer-group\"></i> </span>\n                            <span style=\"font-size:11px; opacity:0.9; font-weight:normal;\"></span>\n                        </div>\n                        <button id=\"acu-btn-finish-sort\" style=\"background:rgba(255,255,255,0.2); color:#fff; border:1px solid rgba(255,255,255,0.4); padding:4px 14px; border-radius:4px; cursor:pointer; font-size:12px; transition:all 0.2s; white-space:nowrap;\">\n                            <i class=\"fa-solid fa-check\"></i> \n                        </button>\n                    </div>\n                `,\n          )\n          .addClass('visible')\n          .css('display', 'flex');\n\n        $('#acu-btn-finish-sort').hover(\n          function () {\n            $(this).css({ background: '#fff', color: 'var(--acu-accent)' });\n          },\n          function () {\n            $(this).css({ background: 'rgba(255,255,255,0.2)', color: '#fff' });\n          },\n        );\n\n        $('#acu-btn-finish-sort')\n          .off('click')\n          .on('click', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            toggleOrderEditMode();\n          });\n      }\n\n      // \n      $('#acu-data-area').removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn').not('#acu-btn-dashboard, #acu-btn-dice-nav').attr('draggable', 'true');\n      $container.find('.acu-action-btn').attr('draggable', 'true');\n\n      // \n      initSortable();\n    } else {\n      // \n      $container.removeClass('editing-order');\n      if ($hint.length) $hint.removeClass('visible').hide();\n      if ($pool.length) $pool.removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn, .acu-action-btn').attr('draggable', 'false');\n      $('.acu-nav-btn, .acu-action-btn').off('.sort');\n      $('#acu-action-pool, #acu-active-actions').off('.sort');\n\n      // \n      const newTableOrder = [];\n      $container.find('.acu-nav-btn[data-table]').each(function () {\n        const tableName = $(this).data('table');\n        if (tableName) {\n          newTableOrder.push(tableName);\n        }\n      });\n      if (newTableOrder.length > 0) {\n        saveTableOrder(newTableOrder);\n      }\n\n      // \n      const newActionOrder = [];\n      $('#acu-active-actions .acu-action-btn').each(function () {\n        const btnId = $(this).attr('id');\n        if (btnId) {\n          newActionOrder.push(btnId);\n        }\n      });\n\n      // \n      if (!newActionOrder.includes('acu-btn-settings')) {\n        newActionOrder.push('acu-btn-settings');\n      }\n\n      Store.set(STORAGE_KEY_ACTION_ORDER, newActionOrder);\n\n      // \n      renderInterface();\n    }\n  };\n\n  const initSortable = () => {\n    const { $ } = getCore();\n    let $dragSrcEl = null;\n\n    // \n    $('.acu-nav-btn, .acu-action-btn, #acu-action-pool, #acu-active-actions').off('.sort');\n\n    // --- 1.  () ---\n    const $items = $('.acu-nav-btn, .acu-action-btn');\n\n    $items.on('dragstart.sort', function (e) {\n      $dragSrcEl = $(this);\n      $(this).css('opacity', '0.4');\n      e.originalEvent.dataTransfer.effectAllowed = 'move';\n    });\n\n    $items.on('dragend.sort', function (e) {\n      $(this).css('opacity', '1');\n      $('.acu-drag-over').removeClass('acu-drag-over');\n      $('.acu-actions-group, .acu-unused-pool').removeClass('dragging-over');\n    });\n\n    $items.on('dragover.sort', function (e) {\n      e.preventDefault();\n      return false;\n    });\n    $items.on('dragenter.sort', function () {\n      if ($dragSrcEl && this !== $dragSrcEl[0]) $(this).addClass('acu-drag-over');\n    });\n    $items.on('dragleave.sort', function () {\n      $(this).removeClass('acu-drag-over');\n    });\n\n    $items.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('acu-drag-over');\n      if (!$dragSrcEl || $dragSrcEl[0] === this) return false;\n\n      const isSrcAction = $dragSrcEl.hasClass('acu-action-btn');\n      const isTgtAction = $(this).hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) return false;\n\n      if (isSrcAction) {\n        const targetPoolId = $(this).parent().attr('id');\n        const srcPoolId = $dragSrcEl.parent().attr('id');\n\n        if (srcPoolId === 'acu-action-pool' && targetPoolId === 'acu-active-actions') {\n          if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n            if (window.toastr) window.toastr.warning('6');\n            return false;\n          }\n        }\n\n        if (srcPoolId !== targetPoolId) {\n          $(this).before($dragSrcEl);\n          return false;\n        }\n      }\n\n      const $temp = $('<span>').hide();\n      $dragSrcEl.before($temp);\n      $(this).before($dragSrcEl);\n      $temp.replaceWith($(this));\n      return false;\n    });\n\n    // --- 2.  (/) ---\n    const $containers = $('#acu-action-pool, #acu-active-actions');\n\n    $containers.on('dragover.sort', function (e) {\n      e.preventDefault();\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        $(this).addClass('dragging-over');\n      }\n    });\n\n    $containers.on('dragleave.sort', function (e) {\n      $(this).removeClass('dragging-over');\n    });\n\n    $containers.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('dragging-over');\n\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        const currentParentId = $dragSrcEl.parent().attr('id');\n        const targetId = $(this).attr('id');\n        const btnId = $dragSrcEl.attr('id');\n\n        if (currentParentId !== targetId) {\n          if (targetId === 'acu-action-pool') {\n            if (btnId === 'acu-btn-settings') {\n              if (window.toastr) window.toastr.warning('');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          } else if (targetId === 'acu-active-actions') {\n            if ($(this).children().length >= 6) {\n              if (window.toastr) window.toastr.warning('6');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          }\n        }\n      }\n      return false;\n    });\n\n    // --- 3.  -  ---\n    $containers.on('click.sort', function (e) {\n      e.stopPropagation();\n\n      // \n      if ($(e.target).closest('.acu-action-btn, .acu-nav-btn').length > 0) return;\n\n      // \n      if (!selectedSwapSource) return;\n\n      const $src = $(selectedSwapSource);\n\n      // \n      if (!$src.hasClass('acu-action-btn')) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const targetId = $(this).attr('id');\n      const btnId = $src.attr('id');\n\n      // \n      if (srcPoolId === targetId) {\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      //   \n      if (targetId === 'acu-action-pool') {\n        if (btnId === 'acu-btn-settings') {\n          if (window.toastr) window.toastr.warning('');\n          $src.removeClass('acu-swap-selected');\n          selectedSwapSource = null;\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n      //   \n      else if (targetId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n    });\n\n    // --- 4.  (Click-to-Swap) -  ---\n    $items.on('click.sort', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (selectedSwapSource && selectedSwapSource === this) {\n        $(this).removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      if (!selectedSwapSource) {\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const $src = $(selectedSwapSource);\n      const $tgt = $(this);\n\n      const isSrcAction = $src.hasClass('acu-action-btn');\n      const isTgtAction = $tgt.hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const tgtPoolId = $tgt.parent().attr('id');\n\n      if (isSrcAction && srcPoolId === 'acu-action-pool' && tgtPoolId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n      }\n\n      if (srcPoolId !== tgtPoolId) {\n        $tgt.before($src);\n      } else {\n        const $temp = $('<span>').hide();\n        $src.before($temp);\n        $tgt.before($src);\n        $temp.replaceWith($tgt);\n      }\n\n      $src.removeClass('acu-swap-selected');\n      selectedSwapSource = null;\n    });\n  };\n\n  const showCellMenu = (e, cell) => {\n    const { $ } = getCore();\n    $('.acu-cell-menu, .acu-menu-backdrop').remove();\n    const backdrop = $('<div class=\"acu-menu-backdrop\"></div>');\n    $('body').append(backdrop);\n\n    const rowIdx = parseInt($(cell).data('row'), 10);\n    const colIdx = parseInt($(cell).data('col'), 10);\n    if (isNaN(rowIdx) || isNaN(colIdx)) {\n      console.warn('[DICE]ACU /');\n      backdrop.remove();\n      return;\n    }\n    const tableKey = $(cell).data('key');\n    // v19.x  tname\n    const tableName = $(cell).data('tname') || $(cell).closest('.acu-data-card').find('.acu-editable-title').text();\n    const content = decodeURIComponent($(cell).data('val'));\n    const config = getConfig();\n\n    //  ID\n    const cellId = `${tableKey}-${rowIdx}-${colIdx}`;\n    if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n\n    // \n    const isModified = window.acuModifiedSet.has(cellId);\n\n    // \n    const pendingDeletionsMap = getPendingDeletions();\n    const tableDeletions = pendingDeletionsMap[tableKey] || [];\n    const isPending = tableDeletions.includes(rowIdx);\n\n    // \n    const headers = cachedRawData?.[tableKey]?.content?.[0] || [];\n    const rowData = cachedRawData?.[tableKey]?.content?.[rowIdx + 1] || [];\n    const lockRowKey = LockManager.getRowKey(tableName, rowData, headers);\n    const currentHeader = headers[colIdx] || '';\n\n    const isFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, currentHeader);\n    const hasAnyLockInRow = lockRowKey && LockManager.hasAnyLock(tableName, lockRowKey);\n\n    // \n    let lockMenuHtml = '';\n    if (lockRowKey) {\n      lockMenuHtml = '<div style=\"border-top:1px dashed var(--acu-border); margin:4px 0;\"></div>';\n\n      // \"\"\"\"\n      if (isFieldLocked) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-field\" style=\"color:#27ae60;\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-field\" style=\"color:#f39c12;\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n\n      // \"\"\"\"\n      if (hasAnyLockInRow) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-row\" style=\"color:#27ae60;\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-row\" style=\"color:#f39c12;\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n    }\n\n    const menu = $(`\n            <div class=\"acu-cell-menu acu-theme-${config.theme}\">\n                <div class=\"acu-cell-menu-item\" id=\"act-edit\"><i class=\"fa-solid fa-pen\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-edit-card\" style=\"color:#9b59b6\"><i class=\"fa-solid fa-edit\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-insert\" style=\"color:#2980b9\"><i class=\"fa-solid fa-plus\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-copy\"><i class=\"fa-solid fa-copy\"></i> </div>\n                ${lockMenuHtml}\n                ${isModified ? '<div class=\"acu-cell-menu-item\" id=\"act-undo\" style=\"color:#e67e22; border-top:1px solid #eee;\"><i class=\"fa-solid fa-undo\"></i> </div>' : ''}\n                ${isPending ? '<div class=\"acu-cell-menu-item\" id=\"act-restore\" style=\"color:#27ae60\"><i class=\"fa-solid fa-undo\"></i> </div>' : '<div class=\"acu-cell-menu-item\" id=\"act-delete\" style=\"color:#e74c3c\"><i class=\"fa-solid fa-trash\"></i> </div>'}\n                <div class=\"acu-cell-menu-item\" id=\"act-close\"><i class=\"fa-solid fa-times\"></i> </div>\n            </div>\n        `);\n    $('body').append(menu);\n\n    // \n    const winWidth = $(window).width();\n    const winHeight = $(window).height();\n    const mWidth = menu.outerWidth() || 150;\n    const mHeight = menu.outerHeight() || 150;\n    let clientX = e.clientX;\n    let clientY = e.clientY;\n    if (!clientX && e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length) {\n      clientX = e.originalEvent.touches[0].clientX;\n      clientY = e.originalEvent.touches[0].clientY;\n    } else if (!clientX && e.changedTouches && e.changedTouches.length) {\n      clientX = e.changedTouches[0].clientX;\n      clientY = e.changedTouches[0].clientY;\n    }\n\n    // \n    if (clientX === undefined) clientX = winWidth / 2;\n    if (clientY === undefined) clientY = winHeight / 2;\n\n    let left = clientX + 5;\n    let top = clientY + 5;\n    if (left + mWidth > winWidth) left = clientX - mWidth - 5;\n    if (top + mHeight > winHeight) top = clientY - mHeight - 5;\n\n    // \n    if (left < 5) left = 5;\n    if (top < 5) top = 5;\n\n    menu.css({ top: top + 'px', left: left + 'px' });\n\n    const closeAll = () => {\n      menu.remove();\n      backdrop.remove();\n    };\n    backdrop.on('click', closeAll);\n    menu.find('#act-close').click(closeAll);\n    // \n    menu.find('#act-lock-field').click(() => {\n      if (lockRowKey && currentHeader) {\n        LockManager.lockField(tableName, lockRowKey, currentHeader, content);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-field').click(() => {\n      if (lockRowKey && currentHeader) {\n        LockManager.unlockField(tableName, lockRowKey, currentHeader);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-lock-row').click(() => {\n      if (lockRowKey) {\n        LockManager.lockRow(tableName, lockRowKey, rowData, headers);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-row').click(() => {\n      if (lockRowKey) {\n        LockManager.unlockRow(tableName, lockRowKey);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    //  (v7.9 )\n    menu.find('#act-copy').click(async e => {\n      e.stopPropagation();\n\n      //  v7.7  (/PWA )\n      // : slash_command.txt /clipboard-set\n      if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n        try {\n          // \n          const safeContent = content\n            .replace(/\\\\/g, '\\\\\\\\')\n            .replace(/\"/g, '\\\\\"')\n            .replace(/\\n/g, '\\\\n')\n            .replace(/\\{/g, '\\\\{')\n            .replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          closeAll();\n          return; // \n        } catch (err) {\n          console.warn('[DICE]ACU ', err);\n        }\n      }\n\n      //  (v7.8 )\n      const doCopy = text => {\n        // A:  API ( HTTPS  localhost )\n        if (navigator.clipboard && window.isSecureContext) {\n          navigator.clipboard\n            .writeText(text)\n            .then(() => {})\n            .catch(() => {\n              fallbackCopy(text);\n            });\n        } else {\n          // B:  execCommand ( HTTP)\n          fallbackCopy(text);\n        }\n      };\n\n      const fallbackCopy = text => {\n        try {\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n\n          // \n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n\n          document.body.appendChild(textArea);\n\n          textArea.select();\n          textArea.setSelectionRange(0, 99999); //  iOS Safari\n\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n\n          if (successful) {\n          } else {\n            throw new Error('execCommand failed');\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          prompt(':', text);\n        }\n      };\n\n      doCopy(content);\n      closeAll();\n    });\n\n    // \n    menu.find('#act-undo').click(() => {\n      const snapshot = loadSnapshot();\n      let originalValue = null;\n      if (snapshot && snapshot[tableKey]?.content[rowIdx + 1]) {\n        originalValue = snapshot[tableKey].content[rowIdx + 1][colIdx];\n      }\n\n      if (originalValue !== null) {\n        if (!cachedRawData) cachedRawData = getTableData();\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = originalValue;\n        }\n\n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(originalValue));\n        $cell.data('val', encodeURIComponent(originalValue));\n\n        // [1]  Label\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length > 0) {\n          $displayTarget = $cell.find('.acu-card-value');\n        } else if ($cell.hasClass('acu-grid-item')) {\n          $displayTarget = $cell.find('.acu-grid-value');\n        } else if ($cell.hasClass('acu-full-item')) {\n          $displayTarget = $cell.find('.acu-full-value');\n        }\n\n        const badgeStyle = getBadgeStyle(originalValue);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${originalValue}</span>`);\n        } else {\n          $displayTarget.text(originalValue);\n        }\n\n        // [] \n        $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n        if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n        window.acuModifiedSet.delete(cellId);\n\n        if (window.acuModifiedSet.size === 0) {\n          hasUnsavedChanges = false;\n          updateSaveButtonState();\n        }\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n      closeAll();\n    });\n\n    // []  ( & )\n    menu.find('#act-delete').click(async () => {\n      closeAll();\n\n      let actOrd = Store.get(STORAGE_KEY_ACTION_ORDER);\n      if (!actOrd || !Array.isArray(actOrd))\n        actOrd = ['acu-btn-save-global', 'acu-btn-collapse', 'acu-btn-refresh', 'acu-btn-settings'];\n      const isInstantMode = !actOrd.includes('acu-btn-save-global');\n\n      if (isInstantMode) {\n        // ---  DOM ---\n        const $card = $(cell).closest('.acu-data-card');\n        $card.css('transition', 'all 0.2s ease').css('opacity', '0').css('transform', 'scale(0.9)');\n        setTimeout(() => $card.slideUp(200, () => $card.remove()), 200);\n\n        // ---  ---\n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n        if (cachedRawData && cachedRawData[tableKey]?.content) {\n          cachedRawData[tableKey].content.splice(rowIdx + 1, 1);\n\n          //  skipRender=true ()\n          saveSnapshot(cachedRawData);\n          await saveDataToDatabase(cachedRawData, true, true);\n        }\n      } else {\n        // ---  () ---\n        const dels = getPendingDeletions();\n        if (!dels[tableKey]) dels[tableKey] = [];\n        if (!dels[tableKey].includes(rowIdx)) {\n          dels[tableKey].push(rowIdx);\n          savePendingDeletions(dels);\n        }\n\n        // \n        $(cell).closest('.acu-data-card').addClass('pending-deletion');\n\n        // \n        updateSaveButtonState();\n      }\n    });\n\n    // \n    menu.find('#act-restore').click(() => {\n      const dels = getPendingDeletions();\n      if (dels[tableKey]) {\n        dels[tableKey] = dels[tableKey].filter(i => i !== rowIdx);\n        if (dels[tableKey].length === 0) delete dels[tableKey];\n        savePendingDeletions(dels);\n      }\n\n      $(cell).closest('.acu-data-card').removeClass('pending-deletion');\n      updateSaveButtonState();\n      closeAll();\n    });\n\n    // []  ()\n    menu.find('#act-insert').click(async () => {\n      closeAll();\n      // 1.  ()\n      if (!cachedRawData) cachedRawData = getTableData();\n      if (!cachedRawData) cachedRawData = loadSnapshot();\n\n      if (cachedRawData && cachedRawData[tableKey]?.content) {\n        const sheet = cachedRawData[tableKey];\n        // 2.  ()\n        const colCount = sheet.content[0] ? sheet.content[0].length : 2;\n        const newRow = new Array(colCount).fill('');\n        //  ()\n        if (colCount > 0) newRow[0] = String(sheet.content.length);\n\n        // 3.  (rowIdx+2  content )\n        sheet.content.splice(rowIdx + 2, 0, newRow);\n\n        // 4. \n        // \n        await saveDataToDatabase(cachedRawData, false, true);\n\n        // \n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $panel = $('.acu-panel-content');\n          // \n          if ($panel.length && $panel[0].scrollHeight > $panel.height()) {\n            $panel.scrollTop($panel.scrollTop() + 10);\n          }\n        }, 100);\n      }\n    });\n\n    // [] \n    menu.find('#act-edit-card').click(() => {\n      closeAll();\n      const rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const headers = rawData[tableKey].content[0];\n        const row = rawData[tableKey].content[rowIdx + 1];\n        if (row) {\n          showCardEditModal(row, headers, tableName, rowIdx, tableKey);\n        }\n      }\n    });\n\n    menu.find('#act-edit').click(() => {\n      closeAll();\n      showEditDialog(content, async newVal => {\n        // 1. \n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = newVal;\n        } else {\n          alert('');\n          return;\n        }\n\n        // 2.  UI \n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(newVal)).data('val', encodeURIComponent(newVal));\n\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length) $displayTarget = $cell.find('.acu-card-value');\n        else if ($cell.hasClass('acu-grid-item')) $displayTarget = $cell.find('.acu-grid-value');\n        else if ($cell.hasClass('acu-editable-title')) $displayTarget = $cell;\n\n        // 3.  UI / ()\n        const badgeStyle = getBadgeStyle(newVal);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(newVal)}</span>`);\n        } else {\n          $displayTarget.text(newVal);\n        }\n\n        // 4.  vs \n        let actOrd = Store.get(STORAGE_KEY_ACTION_ORDER);\n        if (!actOrd || !Array.isArray(actOrd))\n          actOrd = ['acu-btn-save-global', 'acu-btn-collapse', 'acu-btn-refresh', 'acu-btn-settings'];\n        const isInstantMode = !actOrd.includes('acu-btn-save-global');\n\n        if (isInstantMode) {\n          // --- A.  ---\n          //  ()\n          $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n          if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n          //  ()\n          saveSnapshot(cachedRawData);\n          await saveDataToDatabase(cachedRawData, true, true);\n        } else {\n          // --- B.  () ---\n          // \n          $displayTarget.removeClass('acu-highlight-diff').addClass('acu-highlight-manual');\n          if ($cell.hasClass('acu-editable-title'))\n            $cell.removeClass('acu-highlight-diff').addClass('acu-highlight-manual');\n\n          // \n          if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n          window.acuModifiedSet.add(cellId);\n          hasUnsavedChanges = true;\n          updateSaveButtonState();\n        }\n      });\n    });\n  };\n\n  const showEditDialog = (content, onSave) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <!-- 2. []  acu-theme-${config.theme} -->\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"></div>\n                    <textarea class=\"acu-edit-textarea\" spellcheck=\"false\">${escapeHtml(content)}</textarea>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = el.scrollHeight + 2 + 'px';\n    };\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    dialog.find('#dlg-cancel').click(() => dialog.remove());\n    // \n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) dialog.remove();\n    });\n\n    dialog.find('#dlg-save').click(() => {\n      onSave(dialog.find('textarea').val());\n      dialog.remove();\n    });\n  };\n\n  // ==========================================\n  // []  (Observer )\n  // ==========================================\n  // \n  const detectVisualizerConflict = () => {\n    const { $ } = getCore();\n    if (!$) return false;\n\n    // 1:  DOM \n    //  .acu-wrapper\n    const $wrapper = $('.acu-wrapper');\n    if ($wrapper.length > 0) {\n      //  wrapper \n      //  v12.60  'acu_visualizer_ui_v20_pagination'  SCRIPT_ID\n      // \n      const hasVisualizerNav = $wrapper.find('.acu-nav-container').length > 0;\n      const hasVisualizerDataDisplay = $wrapper.find('.acu-data-display').length > 0;\n\n      //  wrapper \n      //  wrapper  data  id\n      const wrapperId = $wrapper.attr('id') || '';\n      const wrapperClass = $wrapper.attr('class') || '';\n\n      // \n      if (hasVisualizerNav && hasVisualizerDataDisplay) {\n        // \n        const hasDiceFeatures = $wrapper.find('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceFeatures) {\n          return true; // \n        }\n      }\n    }\n\n    // 2: \n    try {\n      const scripts = document.querySelectorAll('script');\n      for (const script of scripts) {\n        const content = script.textContent || script.innerHTML || '';\n        //  v12.60 \n        if (content.includes('acu_visualizer_ui_v20_pagination') && content.includes('acu_ui_config_v18')) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // \n    }\n\n    // 3:  localStorage\n    //  localStorage \n    try {\n      const visualizerConfig = localStorage.getItem('acu_ui_config_v18');\n      const diceConfig = localStorage.getItem('acu_ui_config_v19');\n\n      //  DOM \n      if (visualizerConfig && !diceConfig) {\n        //  DOM\n        const hasDiceInDOM = $('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceInDOM) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // localStorage \n    }\n\n    return false;\n  };\n\n  // \n  const showConflictDialog = () => {\n    const { $ } = getCore();\n    if (!$) return;\n\n    // \n    $('.dice-conflict-dialog-overlay').remove();\n\n    const dialogHtml = `\n      <div class=\"dice-conflict-dialog-overlay\" style=\"\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0, 0, 0, 0.75);\n        backdrop-filter: blur(4px);\n        z-index: 2147483647;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 20px;\n        box-sizing: border-box;\n      \">\n        <div class=\"dice-conflict-dialog\" style=\"\n          background: #fff;\n          border-radius: 16px;\n          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n          max-width: 500px;\n          width: 100%;\n          padding: 30px;\n          box-sizing: border-box;\n          animation: diceDialogPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n        \">\n          <div style=\"\n            text-align: center;\n            margin-bottom: 20px;\n          \">\n            <div style=\"\n              font-size: 48px;\n              color: #e74c3c;\n              margin-bottom: 15px;\n            \"></div>\n            <h2 style=\"\n              font-size: 24px;\n              font-weight: bold;\n              color: #333;\n              margin: 0 0 10px 0;\n            \"></h2>\n            <p style=\"\n              font-size: 16px;\n              color: #666;\n              line-height: 1.6;\n              margin: 0;\n            \">\"\"</p>\n          </div>\n          <div style=\"\n            background: #fff3cd;\n            border: 1px solid #ffc107;\n            border-radius: 8px;\n            padding: 15px;\n            margin-bottom: 20px;\n          \">\n            <p style=\"\n              font-size: 14px;\n              color: #856404;\n              line-height: 1.6;\n              margin: 0;\n            \">\n              <strong></strong><br>\n              <strong></strong>\n            </p>\n          </div>\n          <div style=\"\n            display: flex;\n            gap: 10px;\n            justify-content: center;\n            flex-wrap: wrap;\n          \">\n            <button id=\"dice-conflict-close\" style=\"\n              background: #6c757d;\n              color: #fff;\n              border: none;\n              border-radius: 8px;\n              padding: 12px 24px;\n              font-size: 16px;\n              font-weight: bold;\n              cursor: pointer;\n              transition: all 0.2s;\n              min-width: 120px;\n            \"></button>\n          </div>\n        </div>\n      </div>\n      <style>\n        @keyframes diceDialogPop {\n          from {\n            opacity: 0;\n            transform: translateY(20px) scale(0.95);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0) scale(1);\n          }\n        }\n        .dice-conflict-dialog button:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        }\n        .dice-conflict-dialog button:active {\n          transform: translateY(0);\n        }\n        @media (max-width: 768px) {\n          .dice-conflict-dialog {\n            padding: 20px !important;\n            margin: 10px !important;\n            max-width: calc(100% - 20px) !important;\n          }\n          .dice-conflict-dialog h2 {\n            font-size: 20px !important;\n          }\n          .dice-conflict-dialog p {\n            font-size: 14px !important;\n          }\n        }\n      </style>\n    `;\n\n    $('body').append(dialogHtml);\n\n    // \n    $('#dice-conflict-close').on('click', function () {\n      $('.dice-conflict-dialog-overlay').fadeOut(200, function () {\n        $(this).remove();\n      });\n    });\n\n    // \n    $('.dice-conflict-dialog-overlay').on('click', function (e) {\n      if ($(e.target).hasClass('dice-conflict-dialog-overlay')) {\n        $(this).fadeOut(200, function () {\n          $(this).remove();\n        });\n      }\n    });\n\n    //  toastr \n    if (window.toastr) {\n      window.toastr.error('', '', {\n        timeOut: 0,\n        extendedTimeOut: 0,\n        closeButton: true,\n        preventDuplicates: true,\n      });\n    }\n  };\n\n  const init = () => {\n    if (isInitialized) return;\n\n    console.log('[DICE]...');\n\n    //  ConsoleCaptureManager  localStorage\n    try {\n      ConsoleCaptureManager.restore();\n      console.info('[DICE]ConsoleCaptureManager ');\n    } catch (e) {\n      console.error('[DICE] ConsoleCaptureManager :', e);\n    }\n\n    // \n    try {\n      ErrorHandler.checkAndRestore();\n      console.info('[DICE]');\n    } catch (e) {\n      console.error('[DICE]:', e);\n    }\n\n    // \n    if (detectVisualizerConflict()) {\n      showConflictDialog();\n      console.error('[DICE] ');\n      return; // \n    }\n\n    console.info('[DICE] MVU ...');\n    MvuModule.injectStyles();\n\n    //  Observer\n    if (observer) {\n      observer.disconnect();\n      observer = null;\n      console.info('[DICE] MutationObserver');\n    }\n    addStyles();\n    // 2.  SillyTavern \n    if (window.SillyTavern && window.SillyTavern.eventSource) {\n      console.info('[DICE] SillyTavern ...');\n      const events = window.SillyTavern.eventTypes;\n      const source = window.SillyTavern.eventSource;\n      const triggers = [events.CHAT_CHANGED, events.MESSAGE_SWIPED, events.MESSAGE_DELETED, events.MESSAGE_UPDATED];\n\n      // \n      if (!_boundRenderHandler) {\n        _boundRenderHandler = () => {\n          if (!isEditingOrder) {\n            console.info('[DICE]');\n            setTimeout(renderInterface, 500);\n          } else {\n            console.info('[DICE]');\n          }\n        };\n      }\n\n      // \n      if (!window._acuBoundChatChangeHandler) {\n        window._acuBoundChatChangeHandler = () => {\n          console.info('[DICE]');\n          cachedRawData = null;\n          tablePageStates = {};\n          tableSearchStates = {};\n          tableScrollStates = {};\n          hasUnsavedChanges = false;\n          currentDiffMap.clear();\n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          setTimeout(renderInterface, 500);\n        };\n      }\n      const _boundChatChangeHandler = window._acuBoundChatChangeHandler;\n\n      triggers.forEach(evt => {\n        if (evt) {\n          source.removeListener(evt, _boundRenderHandler);\n          source.removeListener(evt, _boundChatChangeHandler); // \n          if (evt === events.CHAT_CHANGED) {\n            source.on(evt, _boundChatChangeHandler);\n          } else {\n            source.on(evt, _boundRenderHandler);\n          }\n        }\n      });\n      console.info(`[DICE] ${triggers.length} `);\n    } else {\n      console.warn('[DICE]SillyTavern ');\n    }\n\n    // 3.  API \n    const loop = () => {\n      const api = getCore().getDB();\n      if (api?.exportTableAsJson) {\n        isInitialized = true;\n        console.log('[DICE]');\n        console.info('[DICE] API ');\n\n        // --- [Fix]  API  #chat  () ---\n        const $chat = $('#chat');\n        if ($chat.length && !observer) {\n          console.info('[DICE] MutationObserver');\n          let mutationLock = false;\n          const handleMutation = () => {\n            if (mutationLock) return;\n            mutationLock = true;\n            requestAnimationFrame(() => {\n              const config = getConfig();\n              if (config.positionMode === 'embedded') {\n                mutationLock = false;\n                return;\n              }\n\n              const children = $chat.children();\n              const lastChild = children.last()[0];\n              const wrapper = $('.acu-wrapper')[0];\n\n              if (wrapper && lastChild && lastChild !== wrapper) {\n                if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n                  $chat.append(wrapper);\n                }\n              }\n\n              // [] \n              const diceCfg = getDiceConfig();\n              if (diceCfg && diceCfg.hideDiceResultInChat) {\n                // 1\n                const children = $chat.children();\n                const lastChild = children.last();\n                if (lastChild.hasClass('mes') || lastChild.hasClass('message-body')) {\n                  lastChild.addClass('acu-dice-result-revealing');\n                }\n\n                // 2RAF\n                requestAnimationFrame(() => {\n                  hideDiceResultsInUserMessages();\n\n                  // 3\n                  requestAnimationFrame(() => {\n                    lastChild.removeClass('acu-dice-result-revealing').addClass('acu-dice-result-revealed');\n                    // \n                    setTimeout(() => {\n                      lastChild.removeClass('acu-dice-result-revealed');\n                    }, 200);\n                  });\n                });\n              }\n\n              mutationLock = false;\n            });\n          };\n          observer = new MutationObserver(handleMutation);\n          observer.observe($chat[0], { childList: true });\n        } else if (!$chat.length) {\n          console.warn('[DICE] (#chat)  MutationObserver ');\n        }\n        // --------------------------------------------------\n\n        console.info('[DICE]...');\n        renderInterface(); // \n        // [] \n        setTimeout(() => {\n          hideDiceResultsInUserMessages();\n        }, 500);\n        // \n        if (api.registerTableUpdateCallback) {\n          api.registerTableUpdateCallback(UpdateController.handleUpdate);\n          console.info('[DICE]');\n\n          // \n          if (api.registerTableFillStartCallback) {\n            api.registerTableFillStartCallback(() => {\n              const current = api.exportTableAsJson();\n              if (current) saveSnapshot(current);\n            });\n            console.info('[DICE]');\n          }\n        } else {\n          console.warn('[DICE] API ');\n        }\n      } else {\n        //  ( 60)\n        if (!isInitialized) {\n          window._acuInitRetries = (window._acuInitRetries || 0) + 1;\n          if (window._acuInitRetries < 60) {\n            if (window._acuInitRetries % 10 === 0) {\n              console.info(`[DICE] API ... (${window._acuInitRetries}/60)`);\n            }\n            setTimeout(loop, 1000);\n          } else {\n            console.error('[DICE] API');\n          }\n        }\n      }\n    };\n    loop();\n\n    // []  - \n    const setupOptionHideListener = () => {\n      const { $ } = getCore();\n      const hideOptionPanel = () => {\n        optionPanelVisible = false;\n        $('.acu-option-panel, .acu-embedded-options-container').fadeOut(200, function () {\n          $(this).remove();\n        });\n      };\n\n      const pendingCrazyAppend = new Map<number, { result: string; createdAt: number }>();\n      const CRAZY_APPEND_TTL_MS = 12000;\n      let lastCrazyPreSendAt = 0;\n\n      const normalizeMessageId = (messageId: number | string) => {\n        const id = typeof messageId === 'string' ? Number(messageId) : messageId;\n        return Number.isFinite(id) ? id : null;\n      };\n\n      const hasDiceResultInText = (text: string) => {\n        if (!text) return false;\n        const contestRegex =\n          /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n        const normalRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n        return contestRegex.test(text) || normalRegex.test(text);\n      };\n\n      const insertDiceIntoUserInputBlock = (text: string, diceResult: string) => {\n        if (!text || !diceResult) return '';\n        const blockRegex = /(<>)([\\s\\S]*?)(<\\/>)/;\n        const blockMatch = text.match(blockRegex);\n        if (!blockMatch) return '';\n        const inner = blockMatch[2];\n        if (inner.includes(diceResult)) return '';\n        const prefix = inner.startsWith('\\n') ? '\\n' : '';\n        const suffix = inner.endsWith('\\n') ? '\\n' : '';\n        const trimmedInner = inner.trim();\n        const newInner = trimmedInner ? `${trimmedInner} ${diceResult}` : diceResult;\n        const textWithoutDice = text.includes(diceResult) ? text.replace(diceResult, '').trim() : text;\n        return textWithoutDice.replace(blockRegex, `${blockMatch[1]}${prefix}${newInner}${suffix}${blockMatch[3]}`);\n      };\n\n      const applyCrazyModeToPrompt = (type: string, params: unknown, dryRun: boolean) => {\n        if (dryRun) return;\n        const safeParams = params && typeof params === 'object' ? (params as Record<string, unknown>) : {};\n        const quietPrompt = typeof safeParams.quiet_prompt === 'string' ? safeParams.quiet_prompt : '';\n        const automaticTrigger = safeParams.automatic_trigger === true;\n        const alreadyApplied = safeParams._acu_crazy_applied === true;\n        if (alreadyApplied || automaticTrigger) return;\n        if (type === 'quiet' || quietPrompt.trim().length > 0) return;\n\n        const now = Date.now();\n        if (now - lastCrazyPreSendAt < 300) return;\n\n        const originalPrompt = typeof safeParams.prompt === 'string' ? safeParams.prompt : '';\n        if (!originalPrompt || !originalPrompt.trim()) return;\n        if (hasDiceResultInText(originalPrompt)) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        let finalPrompt = '';\n        if (originalPrompt.includes('<>')) {\n          const inserted = insertDiceIntoUserInputBlock(originalPrompt, crazyRollResult);\n          finalPrompt =\n            inserted && inserted !== originalPrompt ? inserted : `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n        } else {\n          finalPrompt = `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n        }\n\n        safeParams.prompt = finalPrompt;\n        safeParams._acu_crazy_applied = true;\n        lastCrazyPreSendAt = now;\n      };\n\n      const triggerCrazyModeBeforeSend = () => {\n        const now = Date.now();\n        if (now - lastCrazyPreSendAt < 300) return;\n\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        const content = ($ta.val() || '').toString().trim();\n        if (!content) return;\n        if (hasDiceResultInText(content)) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        smartInsertToTextarea(crazyRollResult, 'dice');\n        const updatedValue = ($ta.val() || '').toString();\n        if (updatedValue) {\n          const textarea = $ta[0] as HTMLTextAreaElement;\n          textarea.value = updatedValue;\n          textarea.dispatchEvent(new Event('input', { bubbles: true }));\n          textarea.dispatchEvent(new Event('change', { bubbles: true }));\n        }\n        lastCrazyPreSendAt = now;\n      };\n\n      const queueCrazyAppend = (messageId: number | string) => {\n        const id = normalizeMessageId(messageId);\n        if (id === null) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        pendingCrazyAppend.set(id, { result: crazyRollResult, createdAt: Date.now() });\n        void applyCrazyAppend(id);\n      };\n\n      const applyCrazyAppend = async (messageId: number | string) => {\n        const id = normalizeMessageId(messageId);\n        if (id === null) return;\n\n        const pending = pendingCrazyAppend.get(id);\n        if (!pending) return;\n\n        if (Date.now() - pending.createdAt > CRAZY_APPEND_TTL_MS) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        const stChat = ST?.chat || window.parent?.SillyTavern?.chat;\n        const stMsg = stChat && typeof id === 'number' ? stChat[id] : null;\n        const msg = getChatMessages(id)[0];\n        if (!msg || msg.role !== 'user') {\n          if (!stMsg || !stMsg.is_user) {\n            pendingCrazyAppend.delete(id);\n            return;\n          }\n        }\n\n        const originalText = String(stMsg?.mes ?? msg?.message ?? '');\n        if (hasDiceResultInText(originalText)) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        const extra = msg?.extra || stMsg?.extra || {};\n        if ((extra as { acuCrazyModeApplied?: boolean }).acuCrazyModeApplied) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        let newMessage = '';\n        if (originalText.includes('<>')) {\n          const inserted = insertDiceIntoUserInputBlock(originalText, pending.result);\n          newMessage = inserted && inserted !== originalText ? inserted : `${originalText} ${pending.result}`.trim();\n        } else {\n          newMessage = originalText ? `${originalText} ${pending.result}` : pending.result;\n        }\n        pendingCrazyAppend.delete(id);\n\n        if (stMsg && stMsg.is_user) {\n          stMsg.mes = newMessage;\n        }\n\n        try {\n          await setChatMessages(\n            [{ message_id: id, message: newMessage, extra: { ...extra, acuCrazyModeApplied: true } }],\n            { refresh: 'affected' },\n          );\n        } catch (e) {\n          console.warn('[DICE]: ', e);\n        }\n\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        if ($ta.length) {\n          const currentVal = ($ta.val() || '').toString();\n          if (currentVal === newMessage) {\n            $ta.val('').trigger('input').trigger('change');\n          }\n        }\n      };\n\n      // [] \n      const setupSendButtonListener = () => {\n        // []  value \n        interceptTextareaValue();\n\n        // [] \n        const sendButton = document.getElementById('send_but');\n        if (sendButton) {\n          const onSendCapture = () => {\n            // \n            triggerCrazyModeBeforeSend();\n            // \n            restoreDiceResultBeforeSend();\n          };\n          sendButton.addEventListener('click', onSendCapture, true);\n          sendButton.addEventListener('pointerup', onSendCapture, true);\n          sendButton.addEventListener('touchend', onSendCapture, true);\n        }\n\n        // jQuery\n        $(document)\n          .off('click.acu_restore_dice', '#send_but')\n          .on('click.acu_restore_dice', '#send_but', function (e) {\n            // \n            triggerCrazyModeBeforeSend();\n            // \n            restoreDiceResultBeforeSend();\n          });\n\n        // \n        const textarea = document.getElementById('send_textarea');\n        if (textarea) {\n          textarea.addEventListener(\n            'keydown',\n            function (e) {\n              //  ShiftShift+Enter \n              if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n                // \n                triggerCrazyModeBeforeSend();\n                // \n                restoreDiceResultBeforeSend();\n              }\n            },\n            true, // \n          );\n          textarea.addEventListener(\n            'keyup',\n            function (e) {\n              if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n                triggerCrazyModeBeforeSend();\n                restoreDiceResultBeforeSend();\n              }\n            },\n            true,\n          );\n        }\n\n        $('#send_textarea')\n          .off('keydown.acu_restore_dice')\n          .on('keydown.acu_restore_dice', function (e) {\n            //  ShiftShift+Enter \n            if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n              // \n              triggerCrazyModeBeforeSend();\n              // \n              restoreDiceResultBeforeSend();\n            }\n          })\n          .off('keyup.acu_restore_dice')\n          .on('keyup.acu_restore_dice', function (e) {\n            if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n              triggerCrazyModeBeforeSend();\n              restoreDiceResultBeforeSend();\n            }\n          });\n\n        // [] /\n        const observer = new MutationObserver(() => {\n          const $ta = $('#send_textarea');\n          if ($ta.length && !$ta[0]._acuValueIntercepted) {\n            interceptTextareaValue();\n          }\n        });\n        observer.observe(document.body, { childList: true, subtree: true });\n      };\n\n      const installCrazyGenerateHook = () => {\n        const rootWindow = window as Window & {\n          __acuCrazyGenerateHookInstalled?: boolean;\n          __acuCrazyGenerateOriginal?: (...args: unknown[]) => unknown;\n        };\n        if (rootWindow.__acuCrazyGenerateHookInstalled) return;\n        if (!rootWindow.TavernHelper || typeof rootWindow.TavernHelper.generate !== 'function') return;\n\n        rootWindow.__acuCrazyGenerateOriginal = rootWindow.TavernHelper.generate;\n        rootWindow.TavernHelper.generate = async function (...args: unknown[]) {\n          const options =\n            args.length > 0 && args[0] && typeof args[0] === 'object' ? (args[0] as Record<string, unknown>) : null;\n\n          if (options) {\n            const quietPrompt = typeof options.quiet_prompt === 'string' ? options.quiet_prompt : '';\n            const automaticTrigger = options.automatic_trigger === true;\n            const alreadyApplied = options._acu_crazy_applied === true;\n            if (!alreadyApplied && !automaticTrigger && quietPrompt.trim().length === 0) {\n              let originalPrompt = '';\n              const injects = options.injects;\n              if (Array.isArray(injects) && injects.length > 0) {\n                const first = injects[0];\n                if (first && typeof first === 'object') {\n                  const content = (first as Record<string, unknown>).content;\n                  if (typeof content === 'string') originalPrompt = content;\n                }\n              }\n              if (!originalPrompt && typeof options.prompt === 'string') {\n                originalPrompt = options.prompt;\n              }\n              if (!originalPrompt && typeof options.user_input === 'string') {\n                originalPrompt = options.user_input;\n              }\n\n              if (originalPrompt && !hasDiceResultInText(originalPrompt) && shouldTriggerCrazyMode()) {\n                const crazyRollResult = generateCrazyRoll();\n                if (crazyRollResult) {\n                  const mergedPrompt = `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n                  if (Array.isArray(injects) && injects.length > 0) {\n                    const first = injects[0];\n                    if (first && typeof first === 'object') {\n                      (first as Record<string, unknown>).content = mergedPrompt;\n                    }\n                  } else if (typeof options.prompt === 'string') {\n                    options.prompt = mergedPrompt;\n                  } else {\n                    options.user_input = mergedPrompt;\n                  }\n                  options._acu_crazy_applied = true;\n                  lastCrazyPreSendAt = Date.now();\n                  console.info('[DICE]: ');\n                }\n              }\n            }\n          }\n\n          return (rootWindow.__acuCrazyGenerateOriginal as (...args: unknown[]) => unknown).apply(this, args);\n        };\n        rootWindow.__acuCrazyGenerateHookInstalled = true;\n      };\n\n      // []  ( ST  -> )\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      // \n      const evtName =\n        ST?.eventTypes?.MESSAGE_SENT || (window.tavern_events ? window.tavern_events.MESSAGE_SENT : 'message_sent');\n\n      // 1.  ST.eventSource ()\n      if (ST?.eventSource) {\n        ST.eventSource.on(evtName, hideOptionPanel);\n        // [] \n        ST.eventSource.on(evtName, messageId => {\n          // \n          queueCrazyAppend(messageId);\n\n          // DOM\n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            setTimeout(() => {\n              hideDiceResultsInUserMessages();\n            }, 300);\n          }\n        });\n\n        // []  GENERATION_AFTER_COMMANDS \n        const afterCommandsEvtName =\n          ST?.eventTypes?.GENERATION_AFTER_COMMANDS ||\n          (window.tavern_events ? window.tavern_events.GENERATION_AFTER_COMMANDS : 'GENERATION_AFTER_COMMANDS');\n        if (afterCommandsEvtName) {\n          ST.eventSource.on(afterCommandsEvtName, (type, params, dryRun) => {\n            applyCrazyModeToPrompt(type, params, dryRun);\n          });\n        }\n\n        installCrazyGenerateHook();\n        setupSendButtonListener();\n        return;\n      }\n\n      // 2.  eventOn (TavernHelper )\n      if (typeof window.eventOn === 'function') {\n        window.eventOn(evtName, hideOptionPanel);\n        // [] \n        window.eventOn(evtName, messageId => {\n          // \n          queueCrazyAppend(messageId);\n\n          // DOM\n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            setTimeout(() => {\n              hideDiceResultsInUserMessages();\n            }, 300);\n          }\n        });\n\n        // []  GENERATION_AFTER_COMMANDS \n        const afterCommandsEvtName = window.tavern_events\n          ? window.tavern_events.GENERATION_AFTER_COMMANDS\n          : 'GENERATION_AFTER_COMMANDS';\n        window.eventOn(afterCommandsEvtName, (type, params, dryRun) => {\n          applyCrazyModeToPrompt(type, params, dryRun);\n        });\n\n        installCrazyGenerateHook();\n        setupSendButtonListener();\n        return;\n      }\n    };\n\n    // \n    setTimeout(setupOptionHideListener, 2000);\n\n    // [] \n    setTimeout(() => {\n      interceptTextareaValue();\n    }, 500);\n\n    // [] ERA\n    const eventOn = window.eventOn || window.parent?.eventOn;\n    if (typeof eventOn === 'function') {\n      eventOn('era:writeDone', detail => {\n        //  ERA \n        if (typeof MvuModule === 'object' && typeof MvuModule.clearCache === 'function') {\n          MvuModule.clearCache();\n        }\n\n        // ERA\n        const mode = MvuModule.detectMode();\n        if (mode === 'era' && getActiveTabState() === MvuModule.MODULE_ID) {\n          console.log('[DICE]ERA');\n          renderInterface();\n        }\n      });\n    } else {\n      console.warn('[DICE] ERA eventOn ');\n    }\n\n    // [] \n    $(window)\n      .off('beforeunload.acu pagehide.acu')\n      .on('beforeunload.acu pagehide.acu', () => {\n        try {\n          localStorage.setItem(STORAGE_KEY_SCROLL, JSON.stringify(tableScrollStates));\n          if (observer) {\n            observer.disconnect();\n            observer = null;\n          }\n        } catch (e) {}\n      });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  // window.testPairedTableFix()\n  window.testPairedTableFix = function () {\n    // \n    const prefix = 'AM';\n    const startFrom = 1;\n    const columnName = '';\n\n    // 1AM0001, AM0002, (), AM0030, ()\n    // AM0001, AM0002, AM0030\n    const table1Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        ['AM0001', '1', '1'],\n        ['AM0002', '2', '2'],\n        [null, '3-', '3-'], // \n        ['AM0030', '4', '4'],\n        [null, '5-', '5-'], // \n      ],\n    };\n\n    // 2(), AM0002, AM0030, AM0040, AM0050\n    // AM0002, AM0030, AM0040, AM0050\n    const table2Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        [null, 'A-', 'A-'], // \n        ['AM0002', 'B', 'B'],\n        ['AM0030', 'C', 'C'],\n        ['AM0040', 'D', 'D'],\n        ['AM0050', 'E', 'E'],\n      ],\n    };\n\n    // \n    const extract1 = extractCodesFromTable(table1Sheet, columnName, prefix);\n    const extract2 = extractCodesFromTable(table2Sheet, columnName, prefix);\n\n    // \n    const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n    // \n    const rawData = {};\n    const result = alignAndFixPairedTables(\n      table1Sheet,\n      'sheet1',\n      table2Sheet,\n      'sheet2',\n      columnName,\n      mapping,\n      prefix,\n      startFrom,\n      rawData,\n    );\n\n    // \n    const getValidCodes = sheet =>\n      sheet.content\n        .slice(1)\n        .map(r => r[0])\n        .filter(c => c && String(c).match(new RegExp(`^${prefix}\\\\d+$`)));\n\n    const codes1 = getValidCodes(table1Sheet);\n    const codes2 = getValidCodes(table2Sheet);\n\n    // \n    const emptyRows1 = table1Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix}\\\\d+$`)));\n    const emptyRows2 = table2Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix}\\\\d+$`)));\n\n    // \n    const validateSequence = (codes, prefix, startFrom) => {\n      const numbers = codes\n        .map(c => {\n          if (!c) return null;\n          const match = c.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          return match ? parseInt(match[1], 10) : null;\n        })\n        .filter(n => n !== null);\n\n      for (let i = 0; i < numbers.length; i++) {\n        if (numbers[i] !== startFrom + i) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    const isValid1 = validateSequence(codes1, prefix, startFrom);\n    const isValid2 = validateSequence(codes2, prefix, startFrom);\n\n    // \n    const set1 = new Set(codes1);\n    const set2 = new Set(codes2);\n    const setsEqual = set1.size === set2.size && [...set1].every(c => set2.has(c));\n\n    // \n    const emptyRowsPreserved1 = emptyRows1.some(r => r[1] && r[1].includes(''));\n    const emptyRowsPreserved2 = emptyRows2.some(r => r[1] && r[1].includes(''));\n\n    return {\n      table1Sheet,\n      table2Sheet,\n      result,\n      codes1,\n      codes2,\n      emptyRows1,\n      emptyRows2,\n      isValid1,\n      isValid2,\n      setsEqual,\n      emptyRowsPreserved1,\n      emptyRowsPreserved2,\n      //  +  + \n      isValid: isValid1 && isValid2 && setsEqual && emptyRowsPreserved1 && emptyRowsPreserved2,\n    };\n  };\n\n  // \n  window.diagnoseDiceVariables = async function () {\n    if (typeof MvuModule !== 'undefined' && typeof MvuModule.diagnoseVariableFramework === 'function') {\n      return await MvuModule.diagnoseVariableFramework();\n    } else {\n      console.error('[DICE]MvuModule ');\n      return null;\n    }\n  };\n\n  const { $ } = getCore();\n  if ($) $(document).ready(init);\n  else window.addEventListener('load', init);\n})();\n"],"names":["LOCATION_EMOJI_MAP","ELEMENT_EMOJI_MAP","SCRIPT_ID","LockManager","STORAGE_KEY_PREFIX","MAX_CONTEXTS","PRIMARY_KEYS","_cache","_currentContextId","_getStorageKey","ctxId","this","getCurrentContextFingerprint","_cleanupOldContexts","prefix","allKeys","i","localStorage","length","key","startsWith","push","keyWithTime","map","data","JSON","parse","getItem","time","_lastAccess","sort","a","b","toDelete","slice","forEach","item","removeItem","console","log","e","warn","_load","stored","_save","dataToSave","Date","now","setItem","stringify","getRowKey","tableName","row","headers","pkField","fieldIndex","idx","indexOf","lockField","rowKey","fieldName","value","_fullRow","_fields","_snapshot","lockRow","rowData","snapshot","h","unlockField","lock","Object","keys","unlockRow","isFieldLocked","hasOwnProperty","isRowLocked","applyLocks","tableContent","tableLocks","modified","restored","rowIndex","entries","undefined","newRow","_rebuildRow","fields","field","colIdx","Array","fill","hasAnyLock","getLockedFields","clearCurrentContext","BookmarkManager","isBookmarked","toggleBookmark","getBookmarks","escapeHtml","s","String","replace","smartInsertToTextarea","newContent","contentType","getCore","$ta","$","currentVal","val","trim","normalDiceRegex","contestDiceRegex","actionRegex","placeholderRegex","diceCfg","getDiceConfig","contentToInsert","shouldSaveOriginal","hideDiceResultFromUser","trigger","textarea","_acuOriginalDiceText","_acuHasDiceData","workingText","existingAction","existingDice","existingDiceOriginal","test","originalText","contestMatches","match","normalMatches","actionMatches","userInput","parts","finalVal","join","restoreDiceResultBeforeSend","includes","restoredVal","removeData","interceptTextareaValue","_acuValueIntercepted","originalDescriptor","getOwnPropertyDescriptor","HTMLTextAreaElement","prototype","originalValue","defineProperty","get","call","_value","set","configurable","STORAGE_KEY_TABLE_ORDER","STORAGE_KEY_ACTION_ORDER","STORAGE_KEY_PENDING_DELETIONS","STORAGE_KEY_ACTIVE_TAB","STORAGE_KEY_UI_CONFIG","STORAGE_KEY_LAST_SNAPSHOT","STORAGE_KEY_IS_COLLAPSED","STORAGE_KEY_DASHBOARD_ACTIVE","STORAGE_KEY_TABLE_HEIGHTS","STORAGE_KEY_TABLE_STYLES","STORAGE_KEY_HIDDEN_TABLES","STORAGE_KEY_REVERSE_TABLES","MIN_PANEL_HEIGHT","MAX_PANEL_HEIGHT","STORAGE_KEY_DICE_CONFIG","STORAGE_KEY_ATTRIBUTE_PRESETS","STORAGE_KEY_ACTIVE_ATTR_PRESET","STORAGE_KEY_CRAZY_MODE","DEFAULT_CRAZY_MODE_CONFIG","enabled","crazyLevel","playerWeight","inSceneNpcWeight","offSceneNpcWeight","PRESET_FORMAT_VERSION","compareVersion","v1","v2","normalizeVersion","v","nv1","nv2","parts1","split","Number","parts2","Math","max","p1","p2","STORAGE_KEY_AVATAR_MAP","STORAGE_KEY_MAP_FOCUS","ConsoleCaptureManager","logs","maxLogs","filters","info","error","originalMethods","isIntercepted","restore","enable","intercept","disable","emergencyBtn","document","getElementById","style","display","type","self","args","apply","capture","timestamp","timeStr","toLocaleTimeString","hour12","content","arg","stack","Error","logEntry","id","random","rawArgs","shift","clear","getFilteredLogs","filter","setFilters","ErrorHandler","errorCount","errorThreshold","lastErrorTime","errorWindow","fatalErrorDetected","isFatalError","source","lineno","colno","thirdPartyPatterns","errorInfo","errorSource","pattern","corePatterns","isCoreError","handleError","triggerFatalError","showEmergencyButton","btn","createElement","innerHTML","cssText","onmouseenter","background","transform","onmouseleave","onclick","window","showDebugConsoleModal","alert","body","appendChild","checkAndRestore","onerror","message","addEventListener","event","reason","STORAGE_KEY_REGEX_RULES","STORAGE_KEY_REGEX_PRESETS","STORAGE_KEY_REGEX_ACTIVE_PRESET","STORAGE_KEY_REGEX_ENABLED","STORAGE_KEY_VALIDATION_ENABLED","STORAGE_KEY_VALIDATION_MODE","RULE_TYPE_INFO","tableReadonly","name","scope","icon","desc","rowLimit","sequence","required","format","enum","numeric","relation","keyValue","BUILTIN_VALIDATION_RULES","description","builtin","targetTable","targetColumn","ruleType","config","startFrom","errorMessage","values","min","refTable","refColumn","valueType","valueMin","valueMax","STORAGE_KEY_BLACKLIST","STORAGE_KEY_BLACKLIST_VERSION","DEFAULT_BLACKLIST","BlacklistManager","getBlacklist","Store","storedVersion","isArray","Set","defaultItems","mergedItems","has","setBlacklist","list","resetToDefault","isBlacklisted","blacklist","lastPart","some","STORAGE_KEY_PRESETS","STORAGE_KEY_ACTIVE_PRESET","PresetManager","getAllPresets","_initDefaultPreset","needsSave","preset","version","_compareVersion","customRules","rules","r","builtinRuleIds","mergedRules","rule","ValidationRuleManager","clearCache","getActivePreset","presets","activeId","find","p","setActivePreset","createPreset","newPreset","createdAt","toISOString","duplicatePreset","deletePreset","filtered","updatePresetRules","exportPreset","mergePresetWithDefaults","presetId","builtinRuleMap","Map","processedCustomIds","newRule","existingRule","add","importPreset","json","autoMerge","importedVersion","needsMerge","_getBuiltinRulesVersion","rulesStr","hash","charCodeAt","toString","currentVersion","defaultPreset","_builtinVersion","oldCustom","resetDefaultPreset","_enabledCache","getAllRules","enabledStates","getEnabledStates","allRules","toggleRuleEnabled","ruleId","states","toggleRuleIntercept","getEnabledRules","addCustomRule","removeCustomRule","index","findIndex","splice","updateCustomRule","updates","getRule","getRulesByTable","RegexTransformationManager","_generateId","substr","_saveEnabledStates","getApplicableRules","columnName","tableNames","columnNames","priority","operation","flags","replacement","executeMode","testCases","security","maxMatchTime","maxMatches","maxInputLength","updatedAt","removeRule","updateRule","RegexPresetManager","sourcePresetId","sourcePreset","jsonString","RegexTransformationEngine","_regexCache","_buildFlags","result","caseInsensitive","global","multiline","unicode","sticky","_getRegex","hasLookbehind","hasLookahead","flagsStr","cacheKey","regex","lastIndex","RegExp","_scoreRegexComplexity","score","captureGroups","_getTimeoutForRule","complexity","baseTimeout","_safeReplace","oldValue","success","newValue","matched","timeout","startTime","elapsed","applyToValue","strValue","extracted","_extractFlags","patternWithoutFlags","patternStr","inlineFlagMatch","flagStr","applyToTable","tableData","totalApplied","errors","isSimpleFormat","sheetMap","simpleTable","sheet","sheetKey","contentRowIndex","dataObj","size","tableInfo","rows","colIndex","debug","tableError","errorMsg","applyToCell","applicableRules","currentValue","wasMatched","applyToRow","cell","previewBatchTransform","results","affectedCells","totalAffected","columnIndex","clearRegexCache","ValidationEngine","validateFormat","validateEnum","allowedValues","validateNumeric","strVal","numVal","endsWith","parseFloat","isNaN","validateRelation","rawData","refSheet","sheetId","columns","col","refColIndex","validateRequired","validateKeyValue","ruleConfig","processedValue","pairs","pair","colonIndex","substring","validateTableReadonly","oldContent","validateRowLimit","rowCount","validateSequence","numbers","allRowValues","rawValue","num","parseInt","n","expectedNum","checkTableRules","newData","violations","typeInfo","oldSheet","newSheet","padStart","rowIdx","validateValue","validateRow","rowTitle","ruleName","severity","validateAllData","allErrors","tableRules","fieldRules","rowErrors","validateTable","targetSheet","groupErrorsByTable","grouped","getErrorCount","LocalAvatarDB","DB_NAME","STORE_NAME","DB_VERSION","_db","_urlCache","init","Promise","resolve","reject","request","indexedDB","open","onsuccess","onupgradeneeded","db","target","objectStoreNames","contains","createObjectStore","keyPath","save","blob","store","transaction","objectStore","URL","revokeObjectURL","delete","put","url","createObjectURL","getKey","getAllNames","getAllKeys","getStats","getAll","items","totalSize","reduce","sum","count","totalSizeMB","toFixed","clearAll","getPlayerName","cachedRawData","getTableData","getPersonaName","w","parent","SillyTavern","getContext","ctx","name1","jQuery","$persona","first","text","getDisplayPlayerName","replaceUserPlaceholders","displayName","AvatarManager","load","raw","offsetX","offsetY","scale","aliases","getAsync","playerName","isPlayer","localUrl","userLocalUrl","primaryName","getPrimaryName","aliasLocalUrl","hasLocalAvatar","async","getOffsetX","_resolveByAlias","getOffsetY","getScale","setPosition","setScale","setAliases","remove","exportData","exportTime","avatars","importData","jsonData","overwriteConflicts","current","stats","added","updated","skipped","imported","analyzeImport","valid","total","newItems","conflicts","getLocationEmoji","emoji","getElementEmoji","MvuModule","MODULE_ID","cachedEraData","detectMode","_source","eventEmit","eventOn","Mvu","getMvuData","getEraData","timeoutId","setTimeout","eventOff","onResult","detail","clearTimeout","statData","statWithoutMeta","stat_data","delta_data","schema","isAvailable","getData","allVars","message_id","display_data","getMvuDataWithRetry","maxRetries","retryDelay","race","waitGlobalInitialized","_","attempt","isVWD","isSimpleArray","every","countChildren","k","extractNumericDisplayValue","str","rangeMatch","slashNumericMatch","commaDescMatch","numericDescMatch","extractFirstNumericValue","displayValue","renderRow","path","deltaData","changeIndicator","part","oldVal","newVal","getChangeIndicator","changedClass","valueClass","diceIconHtml","isNumericCell","numericValue","attrName","pathParts","renderCard","depth","defaultExpanded","isHorizontal","childCount","collapsedClass","bodyHtml","hasNestedCards","nestedCardCount","childKey","childValue","childPath","itemPath","countText","bodyClass","nestedCardsNeedWidth","getDataWithRetry","detection","eraData","mode","mvuData","detectModeWithData","diagnoseVariableFramework","era","available","dataAvailable","mvu","apiExists","getDataExists","cache","hasCache","cacheKeys","recommendation","injectStyles","targetDoc","styleEl","textContent","head","renderNavButton","isActive","renderPanel","isEraMode","isNumericMode","layoutMode","panelTitle","numericHtml","visibleLevels","saved","numericItems","collectNumericItems","obj","levelNames","itemValue","numValue","newLevelNames","topKeys","filteredNumericItems","lastLevelKey","nonArrayLevels","level","allLevelNames","levelNamesArray","from","levelTogglesHtml","theme","getThemeColors","buttonTextColor","buttonTextOnAccent","textMain","levelButtonsHtml","levelName","isVisible","activeStyle","itemsHtml","pathLevels","hierarchyLevels","allLevelsVisible","pathDisplay","finalAttrName","displayStyle","levelsJson","renderNumericMode","cardsHtml","bindEvents","$container","$panel","off","on","stopPropagation","$card","closest","$body","is","hasClass","hide","removeClass","addClass","slideDown","slideUp","refresh","newMode","saveActiveTabState","currentTab","getActiveTabState","renderInterface","toastr","toggleClass","$button","css","color","borderColor","opacity","attr","each","$item","levels","newPathDisplay","$value","showEditDialog","setValue","preventDefault","$icon","attrValue","showDicePanel","targetValue","targetName","initiatorName","fromMvu","parsedInfo","initiator","candidates","filteredParts","parseMvuPathForDice","mvuPath","mvuParsedInfo","$doc","touchStartX","touchStartY","isHorizontalSwipe","originalEvent","touches","clientX","clientY","touch","deltaX","abs","deltaY","stopImmediatePropagation","$input","focus","button","handle","setPointerCapture","pointerId","startHeight","height","startY","onpointermove","moveE","dy","newHeight","onpointerup","upE","releasePointerCapture","getTableHeights","saveTableHeights","heights","onSave","html","getConfig","append","$overlay","select","ctrlKey","parsedValue","onWriteDone","setEraValue","setMvuVariable","is_recursive","replaceMvuData","isModuleTab","$refreshBtn","then","actualData","warning","catch","err","DEFAULT_DICE_CONFIG","critSuccessMax","hardSuccessDiv","difficultSuccessDiv","critFailMin","lastDiceType","dndCritSuccess","dndCritFail","contestTieRule","hideDiceResultInChat","saveDiceConfig","cfg","oldCfg","newCfg","changedKeys","hideDiceResultsInUserMessages","hideInput","hideChat","textareaVal","modifiedText","contestRegex","normalRegex","lastMessageId","getLastMessageId","userMessages","getChatMessages","role","hiddenCount","msg","$msgElement","retrieveDisplayedMessage","$mesText","currentDomText","currentHtml","modifiedHtml","contestPattern","normalPattern","restoredCount","BUILTIN_ATTRIBUTE_PRESETS","baseAttributes","formula","range","modifier","specialAttributes","AttributePresetManager","presetVersion","finalId","updatePreset","exported","jsonStr","autoUpdate","needsUpdate","getCrazyModeConfig","saveCrazyModeConfig","shouldTriggerCrazyMode","selectCrazyParticipant","allTables","processJsonData","playerResult","DashboardDataParser","findTable","npcResult","playerAttrs","getFullAttributesForCharacter","attrs","inScene","weight","parseRows","npc","inSceneVal","toLowerCase","isInScene","npcAttrs","totalWeight","weightedRandomSelect","selectCrazyAttribute","participant","randomAttr","floor","activePreset","allPresetAttrs","randomPresetAttr","defaultValue","skillPool","getRandomSkillPool","crazyRollD100","judgeCrazyRollResult","roll","generateCrazyRoll","contestChance","selectCrazyRollType","participant1","participant2","candidate","attr1","attr2","roll1","roll2","result1","result2","margin1","margin2","winner","rollDiceExpression","expr","NaN","countStr","sidesStr","keepDrop","sides","rolls","rollDice","kd","generateAttributeValue","context","varNames","Function","round","evaluateFormula","DASHBOARD_TABLE_CONFIG","tableKeywords","detailLocation","keywords","fallbackIndex","currentLocation","player","status","position","isMultiple","money","resources","location","quest","progress","active","column","excludeColumn","excludes","bag","skill","equip","isEquipped","equipped","moduleKey","keyword","findColumnIndex","columnKey","moduleConfig","colConfig","kw","getValue","getColumnMap","colKey","tableResult","colMap","parsed","_rowIndex","_raw","applyFilter","parsedRows","filterKey","matchInclude","inc","excludeValue","matchExclude","exc","DEFAULT_GM_CONFIG","diceSystem","showDiceIcon","autoSendPrompt","action_groups","table_keywords","actions","label","template","auto_send","THEME_COLORS","retro","bgPanel","border","textSub","btnBg","btnHover","accent","tableHead","successText","successBg","inputBg","inputText","placeholderText","btnActiveBg","btnActiveText","failureText","failureBg","warningText","warningBg","critSuccessText","critSuccessBg","critFailureText","critFailureBg","extremeSuccessText","extremeSuccessBg","overlayBg","overlayBgLight","shadowBg","lightBg","veryLightBg","buttonText","grayBg","errorText","errorBg","errorBorder","warningIcon","dark","modern","forest","ocean","cyber","buttonBg","buttonBgActive","presetButtonBg","presetButtonBgActive","nightowl","sakura","minepink","purple","wechat","educational","galgame","vaporwave","classicpackaging","terminal","isLightTheme","getResultBadgeStyle","resultType","t","styles","critSuccess","bg","extremeSuccess","failure","critFailure","padding","getActionsForTable","lowerName","group","extractNumericValue","matches","parseAttributeString","rawStr","jsonObj","parseRelationshipString","trimmed","colonMatch","parenMatch","isRelationshipCell","headerName","lowerHeader","processTemplate","cardData","header","ACTION_BUTTONS","title","isInitialized","isSaving","isEditingOrder","isSettingsOpen","currentDiffMap","observer","_boundRenderHandler","hasUnsavedChanges","isAutoTransforming","tablePageStates","tableSearchStates","lastOptionHash","optionPanelVisible","STORAGE_KEY_SCROLL","tableScrollStates","UpdateController","_lastValidationCount","_isRollingBack","handleUpdate","loadSnapshot","api","getDB","fillTable","timeOut","positionClass","fillError","newCount","updateValidationIndicator","$indicator","show","getCurrentChatId","chatId","DEFAULT_CONFIG","layout","collapseStyle","collapseAlign","fontFamily","cardWidth","fontSize","highlightNew","itemsPerPage","actionsPosition","gridColumns","positionMode","showOptionPanel","clickOptionToAutoSend","optionFontSize","FONTS","THEMES","_coreCache","core","AutoCardUpdaterAPI","clipboard","navigator","ST","top","updateSaveButtonState","$btn","deletions","getPendingDeletions","hasDeletions","getIconForTableName","getBadgeStyle","def","retryErr","_acuQuotaAlerted","savePendingDeletions","getSavedTableOrder","saveTableOrder","getCollapsedState","saveCollapsedState","currentCtx","_contextId","saveSnapshot","getTableStyles","getHiddenTables","getReverseTables","toggleTableReverse","getAttributesForCharacter","characterName","isUser","sheetName","nameColIdx","getAttributeValue","found","STANDARD_ATTRS","getStandardAttrs","allAttrs","allPresets","RANDOM_SKILL_POOL","generateRPGAttributes","isDNDOrPreset","isDND","generate3d6","generateValue","base","adjust","special","baseResult","specialResult","clearPresetAttributesForCharacter","charName","targetRowIndex","targetColIndex","existingStr","existingAttrs","standardAttrs","presetAttrNames","newAttrString","saveDataOnly","attrString","writeAttributesToCharacter","newAttrs","existingMap","standardCount","isComplete","customAttrs","resultParts","writtenAttrs","wasComplete","initCustomDropdown","options","themeColors","inputId","wrap","$dropdown","after","renderItems","lowerFilter","opt","hideDropdown","addClearButton","inputSelector","$clearBtn","showDiceSettingsPanel","ruleTitle","resetText","defaults","critFail","hardDiv","extremeDiv","currentCritSuccess","currentCritFail","currentHardDiv","currentExtremeDiv","tieRule","cocExtraHtml","panelHtml","left","right","bottom","width","hover","closePanel","click","$stepper","step","updateValue","getCurrentValue","getStepperValue","critSuccessVal","critFailVal","hardDivVal","extremeDivVal","resetStepper","savedDiceType","rawDataForList","diceCharacterList","diceAttrList","diceType","successCriteria","initialAttrValue","initialTargetValue","inputTextColor","inputStyle","overlay","defaultCriteria","panel","buildAttrButtons","$parentSection","prop","originalHtml","originalHandler","generated","baseAttrs","specialAttrs","confirm","shortName","buildCharButtons","randomSkill","newAttrList","convertTargetForDice","currentTarget","fromDice","toDice","getMaxRoll","dice","fromMax","toMax","ratio","updateRuleMode","$targetInput","$difficultyWrapper","$row3","currentDiceType","newDice","suggestedCriteria","currentTargetVal","convertedVal","newMax","customDice","performDiceRoll","mod","modStr","isFinite","remaining","dicePattern","exec","diceResult","numberPattern","numMatch","parseModifier","criteria","difficulty","targetInputVal","attrInputVal","isAutoTarget","getDefaultTarget","formulaStr","maxRoll","finalValue","requiredTarget","difficultyLabel","difficultyDiv","isCritSuccess","isCritFailure","isSuccess","outcomeText","outcomeClass","extremeTarget","hardTarget","criteriaSymbol","displayOutcomeText","badgeStyle","badgeStyleStr","$rollBtn","judgeExpr","formulaText","attrValueInput","currentDice","initiatorNameVal","showContestPanel","initiatorValue","currentCriteria","opponentName","passedInitiatorName","passedInitiatorValue","passedOpponentValue","opponentValue","opponentAttrs","characterList","contestAttrList","attrStr","targetType","buildCharBtns","containerId","rebuildAttrBtns","aname","refreshedAttrs","initAttrs","oppAttrs","fullAttrs","getSuccessLevel","performContestRoll","initValue","initName","initAttrName","getHalfMax","m","initValueInput","initTarget","initTargetInput","oppValue","oppName","oppAttrName","oppValueInput","oppTarget","oppTargetInput","winnerColor","initResult","oppResult","initSuccess","oppSuccess","displayInitValue","displayOppValue","displayInitSuccessName","displayOppSuccessName","displayWinner","getResultTypeFromSuccess","initResultType","oppResultType","initBadgeStyle","oppBadgeStyle","winnerBadgeStyle","initBadgeStyleStr","oppBadgeStyleStr","winnerBadgeStyleStr","$resultDisplay","$resultInit","$resultOpp","$contestBtn","contestResultText","currentInitName","parseInSceneStatus","buildMapViewModel","globalResult","locationResult","elementResult","globalHeaders","globalRow","globalConfig","detailIdx","regionIdx","currentRegion","locations","locationHeaders","locationRows","locationNameIdx","locationRegionIdx","locationTypeIdx","locationDescIdx","locationImportanceIdx","locationExploreIdx","region","locationType","importance","exploreStatus","tableKey","elements","elementHeaders","elementRows","elementNameIdx","elementTypeIdx","elementLocationIdx","elementDescIdx","elementStatusIdx","elementInteractIdx","locationName","rawInteractions","interactions","Boolean","typeValue","element","addElement","characters","addCharacter","character","avatarUrl","full","avatarOffsetX","avatarOffsetY","avatarScale","playerLocation","playerConfig","playerHeaders","playerRow","playerNameIdx","playerPosIdx","playerNameRaw","playerPosRaw","npcConfig","npcHeaders","npcRows","npcNameIdx","npcPosIdx","npcInSceneIdx","npcName","inSceneValue","inSceneHeader","firstLocation","next","allRegions","l","otherIndex","focusLocation","fallbackRegion","regionLocations","regionName","scoreA","getHotLocationsInRegion","isMapOpening","showMapVisualization","viewModel","tabSelectionCache","selectedRegion","targetLocation","overlayEl","setProperty","$focusArea","$thumbnails","renderElementChip","refreshPanel","model","leftChars","ceil","rightChars","leftElems","rightElems","renderAvatarHtml","char","avatarStyle","charAt","leftAvatarsHtml","rightAvatarsHtml","leftElemsHtml","rightElemsHtml","emojiHtml","renderFocusArea","thumbnails","totalCount","badgeHtml","renderThumbnailLocation","regions","newRegion","cachedLocation","hotLocations","fallbackFocus","targetRegion","showRelationshipGraph","npcTable","nameIdx","relationIdx","npcTableKey","nodes","edges","resolveName","personaName","isExplicitUserVariant","isPersonaName","isPlayerName","resolveUserPlaceholder","resolvedPlayerName","playerTableKey","x","y","inSceneColIdx","rawNpcName","relationStr","rel","resolvedRelName","relRowIndex","relIsInScene","ri","cleanedLabels","rawRel","commonRelations","specialSuffixMatch","lastChars","cleanRelation","existingEdge","combined","labelsFromSource","labelsFromTarget","nodeArr","connectionCount","node","edge","isMobileView","innerWidth","baseRadius","maxRadius","playerBaseRadius","radiusPerConnection","nodeSizeMultiplier","filterInScene","filterDirectOnly","getNodeRadius","nodeName","sqrt","radius","getLayoutCacheKey","loadLayoutCache","cached","layoutData","allNodesFound","vx","vy","runForceDirectedLayout","angle","PI","dist","cos","sin","nodeMap","iter","u","j","dx","distSq","force","fx","fy","maxSpeed","vMag","saveLayoutCache","panX","panY","$svg","$transform","$edgesGroup","$nodesGroup","$zoomDisplay","$nodeSizeDisplay","$wrapper","updateTransform","updateNodeSizeDisplay","zoomTo","newScale","centerX","centerY","oldScale","scaleChange","render","filteredNodes","directNodes","passInScene","passDirectOnly","getFilteredNodes","filteredNodeNames","filteredEdges","edgesHtml","edgeIdx","len","nx","ny","px","py","hasFromSource","hasFromTarget","sourceRadius","targetRadius","x1","y1","x2","y2","srcLabels","tgtLabels","srcSet","tgtSet","commonLabels","srcUnique","tgtUnique","markerStart","markerEnd","midX","midY","lineLen","lbl","offsetDir","offsetDist","safeOffset","relationEmojiMap","addRelationEmoji","truncateLabel","maxLen","truncated","labelsToShow","labelBaseX","labelBaseY","perpOffset","nodesHtml","nodeAvatar","indicatorRadius","indicatorOffset","inSceneIndicator","nodeDisplayName","scaleVal","foSize","shadowWidth","foOffset","highlightNode","connectedNodes","otherNode","connectedEdgeIndices","clearHighlight","matchMedia","currentHighlightedNode","$node","startX","hasMoved","longPressTriggered","longPressTimer","vibrate","table","rowName","tempNode","isPanning","panStartX","panStartY","panStartPanX","panStartPanY","lastPinchDist","activePointerId","wrapperEl","svgEl","onpointerdown","cursor","rect","getBoundingClientRect","onpointercancel","onwheel","delta","hypot","passive","newDist","$nodeSizeSlider","$sliderSizeDisplay","$sliderContainer","$nodeSizeDisplayTrigger","sliderVisible","sliderHideTimer","hideSlider","resetSliderHideTimer","triggerRect","wrapperRect","showSlider","$filterInSceneBtn","$filterDirectOnlyBtn","updateFilterToggleStyles","$nodeSizeStepper","updateNodeSizeValue","newPercent","getCurrentPercent","clearLayoutCache","showAvatarManager","closeGraph","showAvatarCropModal","imageSource","existing","modalHtml","$modal","$image","containerEl","imageEl","updateImageStyle","backgroundSize","backgroundPosition","isDragging","startOffsetX","startOffsetY","sensitivity","pinchStartScale","pinchRatio","file","files","saveLocalAvatar","newUrl","onUpdate","resolveUserPlaceholderForAvatar","buildList","listHtml","userNode","otherNodes","userNodeForDisplay","currentUrl","hasLocal","displayUrl","sourceLabel","hasAvatar","managerHtml","$manager","bindAvatarEvents","refreshItem","$preview","aliasesStr","deleteLocalAvatar","Blob","href","download","removeChild","reader","FileReader","onload","evt","analysis","showImportConfirmDialog","readAsText","closeManager","onComplete","hasConflicts","conflictListHtml","dialogHtml","$dialog","closeDialog","overwrite","showCardEditModal","displayRow","inputsHtml","dialog","adjustHeight","el","contentHeight","scrollHeight","overflowY","requestAnimationFrame","currentRow","hasChanges","saveDataToDatabase","_configCache","saveConfig","applyConfigStyles","generateDiffMap","currentData","lastData","diffSet","rIdx","newRows","oldRows","oldRow","cIdx","oldCell","fontVal","f","$styleTag","fontImport","cssVars","cls","$optContainer","addStyles","_acuStylesInjected","exportTableAsJson","sheetCount","skipRender","commitDeletes","$saveBtn","mate","sizeInMB","stringifyError","importTableAsJson","apiError","acuModifiedSet","tables","rawContent","exportConfig","updateConfig","refreshRegexRulesList","$rulesList","scopeIcon","scopeText","showAddValidationRuleModal","parentDialog","currentThemeClass","updateSelectColor","$select","$colSelect","$pairedTableSelect","currentPairedValue","empty","refTableName","$refColSelect","isTableRule","valuesStr","refColumns","selectedColumns","pairedTable","ruleHtml","showSmartFixModal","snapshotValue","hasSnapshotValue","showTableRuleFixModal","inputHtml","smartSuggestHtml","examples","currentRowIndex","maxCount","getColumnExamples","suggestedValue","existingValues","prefixMatch","digits","codeIndex","existingNumbers","codeValue","maxNum","nextNum","numOnlyMatch","suggestFormatValue","currentNum","isOutOfRange","nearestValid","getNearestValidNumber","getRelationOptions","hasMultipleColumns","currentInvalidValue","valueExists","cellValue","isValueInRelationTable","optionsHtml","reverseWriteHtml","issues","fixedPairs","fixedVal","hasIssue","originalVal","fixedValue","hasIssues","issuesHtml","issue","optionValue","refSheetId","targetColIdx","extractCodesFromTable","codes","allCodes","codeToRows","isValid","buildCodeMapping","codes1","codes2","allUniqueCodes","codeNumbers","code","mapping","oldCode","newCode","alignAndFixPairedTables","table1Sheet","table1SheetId","table2Sheet","table2SheetId","fixedCount1","fixedCount2","headers1","rows1","colIndex1","headers2","rows2","colIndex2","reverseMapping","sortedNewCodes","analyzeTable","codeRows","emptyRows","prevOldCode","nextOldCode","emptyRow","prevCode","nextCode","codeRow","analysis1","analysis2","buildNewRows","allOldCodes","codeRowMap","cr","isCodeRow","isInserted","codeRowIndex","nextNewCode","currentNewCode","currentOldCode","newRows1","newRows2","countCodeChanges","oldAnalysis","oldCodes","newCodes","contentHtml","actionBtns","changeCount","changeDetails","c","d","minRows","maxRows","currentRowCount","excessRows","isTooMany","isTooFew","fixSuggestions","originalRowIndex","numCountMap","duplicates","gaps","outOfOrder","actualNum","rowNum","occurrences","issueSet","g","o","fix","pairedTableAttr","pairedTableName","targetSheetId","pairedSheet","pairedSheetId","pairedHeaders","extract1","extract2","fixedCount","startRow","showBlacklistManagerModal","updateTextarea","uniqueItems","syncFromTextarea","input","existingSet","addedItems","which","closeModal","showAttributePresetManager","isDefaultActive","allPresetsHtml","isBuiltin","showSettingsModal","$toggle","$thisToggle","showAttributePresetEditor","filename","isEdit","existingPreset","defaultData","$jsonTextarea","updateJSON","not","savedFilters","renderLogs","filteredLogs","$logContainer","typeColors","typeIcons","logItem","updateCounts","checked","$status","newState","line","toUpperCase","TavernHelper","triggerSlash","safeContent","isSecureContext","writeText","textArea","setAttribute","setSelectionRange","successful","execCommand","refreshInterval","setInterval","clearInterval","showAddRegexRuleModal","editRuleId","editRule","scopeType","$textarea","extractedFlags","$flagGlobal","$flagIgnoreCase","$flagMultiline","uiFlags","finalPattern","finalFlags","ruleData","expandedGroups","isGroupExpanded","groupId","SPECIAL_BUTTONS_CONFIG","tableManagerHtml","savedOrder","hiddenList","allItems","isSpecial","orderMap","isHidden","specialClass","chevron","hasIntercept","$group","$chevron","expanded","targetHeight","animate","currentHeight","outerHeight","newTheme","crazyConfig","currentConfig","initCrazyModeUI","$list","dragState","timer","clearDragState","startDrag","targetItem","insertBefore","$dragged","$target","insertAfter","newOrder","unit","isCurrentlyActive","fadeOut","refreshPresetUI","prompt","currentState","currentPreset","$presetSelect","defaultPresetId","accept","onchange","enabledRules","renderInterfaceTimer","renderInterfacePending","_renderInterfaceImpl","$chat","mutationLock","MutationObserver","lastChild","children","last","wrapper","observe","childList","isDataFromDatabase","anyLockApplied","transformResult","transformError","structuredClone","existingSnapshot","hasValidSnapshotData","$searchInput","activeTab","currentTabName","newHtml","renderTableContent","$virtualDom","replaceWith","bindOptionEvents","lastScrollX","lastScrollY","$oldContent","scrollLeft","scrollTop","orderedNames","concat","isCollapsed","layoutClass","finalGridCols","empty3","optionHtml","currentOptionHash","optionTables","buttonsHtml","hasBtns","optionValues","cellStr","encodeURIComponent","optionChanged","colStyleClass","alignClass","savedHeight","isDashboardActive","isChangesPanelActive","isMvuActive","finalSavedHeight","renderChangesPanel","renderDashboard","gridFixStyle","isChangesActive","isSimpleModeNav","changesCount","validationErrorCount","displayCount","showWarningIcon","navHiddenList","navSavedOrder","SPECIAL_NAV_ITEMS","extraClass","allNavItems","checkAvailable","activeClass","orderVal","warningIconHtml","$existing","insertHtmlToPage","injectIndependentOptions","bindChangesEvents","$newContent","savedState","inner","$targetTitle","htmlContent","$aiMes","$this","$targetMes","$targetBlock","getTargetContainer","optConfig","decodeURIComponent","createChatMessages","executeSlashCommandsWithOptions","cmd","sendResult","isError","isAborted","ta","sendBtn","enterEvent","Event","keyCode","bubbles","$textDiv","hasImage","targetIndex","eq","$oldWrapper","validationErrors","changes","rowChanges","changedFields","isValidationMode","groupedErrors","collapsedGroups","tableErrors","groupedChanges","tableChanges","change","oldShort","newShort","fieldDisplay","fieldCount","fieldNames","moreText","validationItemTouchStartPos","$targetCard","scrollIntoView","behavior","block","storageKey","changeType","refreshChangesPanel","restoredRow","showRowCompareEditModal","showChangeSingleFieldModal","showChangeEditModal","restoredData","updateChangesCount","finalHeight","$horizontalScroller","_touchStartX","_touchStartY","_scrollDirection","$span","hasOldValue","fieldsHtml","isChanged","questResult","bagResult","skillResult","equipResult","playerParsed","allAttrsStr","playerRows","globalDetailLocation","globalLocation","locIdx","currentPlaceName","npcTableName","npcParsed","inSceneNPCs","offSceneNPCs","npcData","allNPCs","questTableName","questParsed","activeQuestParsed","questTypeOrder","activeTasks","q","bagTableName","bagParsed","bagItems","skillTableName","skillParsed","skills","equipTableName","equipParsed","equippedItems","locationTableName","locationTableKey","locationParsed","resourcesStr","parsedResources","res","skillValue","hasNumeric","skillRowIndex","loc","areaName","isCurrent","npcIdx","isLastNpc","npcAvatar","offSceneFilter","isLastBag","isLast","isMain","progressPercent","progressMatch","progressBar","loadedModules","pendingDeletions","isGridMode","titleColIndex","processedRows","originalIndex","searchTerm","isReversed","isTableReversed","titleA","titleB","aHitTitle","bHitTitle","totalItems","totalPages","currentPage","startIdx","endIdx","rowsToRender","showReverseBtn","shouldShowReverseButton","reverseBtnHtml","realRowIdx","isPending","cardTitle","showDefaultIndex","titleCellId","isTitleModified","isRowNew","rowClass","validColIndices","isOddValidCount","cardBody","spanFullRow","rawHeaderName","lockRowKey","inlineLockIcon","safeStr","rawStrOriginal","invalidPlaceholders","hideLabel","splitRegex","isIdentityField","parsedAttrs","displayCell","validRelations","relHtml","attrsHtml","showDice","invalidTagValues","isDiffChanged","cellId","isUserModified","cellHighlight","tableActions","actionsHtml","interactColIdx","invalidValues","interactOptions","existingLabels","iconMap","newActions","act","actIdx","cardLockRowKey","cardLockIcon","cardBookmarkRowKey","bookmarkIcon","saveCurrentTabState","$content","innerScrolls","switchPanel","updateContentFn","dataError","managerError","scrollTimer","$navBtn","isPanelVisible","mvuSavedHeight","currentActiveTab","$cell","showCellMenu","$pageBtn","newPage","manualUpdate","searchTimeout","isComposing","selectionStart","selectionEnd","isFocus","activeElement","classList","$newInput","tName","actionIdx","$title","action","skillName","checkValue","attrValIdx","profIdx","promptText","sendMessage","ev","isPlayerTable","playerAttrValue","itemName","taskName","npcAttrValue","npcParts","npcMatch","relations","borderStyle","cardHtml","backdrop","isModified","currentHeader","hasAnyLockInRow","lockMenuHtml","menu","winWidth","winHeight","mWidth","outerWidth","mHeight","changedTouches","closeAll","fallbackCopy","$displayTarget","actOrd","dels","colCount","showConflictDialog","extendedTimeOut","closeButton","preventDuplicates","hasVisualizerNav","hasVisualizerDataDisplay","scripts","querySelectorAll","script","visualizerConfig","diceConfig","detectVisualizerConflict","disconnect","eventSource","events","eventTypes","triggers","CHAT_CHANGED","MESSAGE_SWIPED","MESSAGE_DELETED","MESSAGE_UPDATED","_acuBoundChatChangeHandler","_boundChatChangeHandler","removeListener","loop","registerTableUpdateCallback","registerTableFillStartCallback","_acuInitRetries","hideOptionPanel","pendingCrazyAppend","lastCrazyPreSendAt","normalizeMessageId","messageId","hasDiceResultInText","insertDiceIntoUserInputBlock","blockRegex","blockMatch","suffix","trimmedInner","newInner","applyCrazyModeToPrompt","params","dryRun","safeParams","quietPrompt","quiet_prompt","automaticTrigger","automatic_trigger","_acu_crazy_applied","originalPrompt","crazyRollResult","finalPrompt","inserted","triggerCrazyModeBeforeSend","updatedValue","dispatchEvent","queueCrazyAppend","applyCrazyAppend","pending","stChat","chat","stMsg","is_user","mes","extra","acuCrazyModeApplied","newMessage","setChatMessages","setupSendButtonListener","sendButton","onSendCapture","subtree","installCrazyGenerateHook","rootWindow","__acuCrazyGenerateHookInstalled","generate","__acuCrazyGenerateOriginal","injects","user_input","mergedPrompt","evtName","MESSAGE_SENT","tavern_events","afterCommandsEvtName","GENERATION_AFTER_COMMANDS","testPairedTableFix","getValidCodes","emptyRows1","emptyRows2","isValid1","isValid2","set1","set2","setsEqual","emptyRowsPreserved1","emptyRowsPreserved2","diagnoseDiceVariables","ready"],"ignoreList":[],"sourceRoot":""}