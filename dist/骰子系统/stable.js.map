{"version":3,"file":"stable.js","mappings":"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CA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KAEA,OACA,OACA,OACA,MACA,SACA,OACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,MACA,KACA,MAGA,MACA,KACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,MACA,MACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,KACA,SACA,KACA,KAGA,KACA,MACA,QACA,MACA,KACA,KACA,KACA,MACA,MACA,MACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,MACA,KACA,QACA,KACA,KACA,KACA,MACA,KACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,MACA,QACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OASItX,GAAwB,CAACuX,OAAgBloD,KAE7C,GAA6B,kBAAlBkoD,EAA6B,CACtC,MAAMC,EAAQD,EACRvR,EAAWC,GAASl3C,KAAKiyC,MAAMjyC,KAAKyY,SAAWy+B,GAAS,EACxDwR,EAAc,IAAMzR,EAAS,GAAKA,EAAS,GAAKA,EAAS,GAEzD0R,EAAgB,KACpB,GAAIF,EAAO,CACT,MAAMhX,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","sources":["src://tavern_helper_template/src//emoji-maps.ts","src://tavern_helper_template/src//database-ui-override.ts","src://tavern_helper_template/src//index.ts"],"sourcesContent":["/**\n * \n * \n *\n * \n * - fa:xxx   Font Awesome \n * - ti:xxx   Tabler Icons \n * - emoji  \n *\n * \n * 1. \"\"\"\"\n * 2. \"\"\"|\"\n * 3. \"\"\"|\"\n * 4. \"\"\"\"\n * 5. //\n */\nexport const EMOJI_MAP: [RegExp, string][] = [\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'ti:soup'],\n  [/ring|livehouse/, 'fa:guitar'],\n  [//, 'ti:plant'],\n  [//, 'ti:lemon'],\n  [//, 'fa:scroll'],\n  [//, 'fa:guitar'],\n  [//, 'ti:apple'],\n  [//, 'ti:salad'],\n  [//, 'ti:cup'],\n  [//, 'fa:music'],\n  [//, 'ti:lemon'],\n  [//, 'fa:volume-high'],\n  [//, 'fa:compact-disc'],\n  [//, 'fa:glasses'],\n  [//, 'ti:shirt'],\n  [//, 'fa:utensils'],\n  [//, 'fa:pencil'],\n  [//, 'ti:plant'],\n  [//, 'ti:ice-cream'],\n  [//, 'fa:apple-whole'],\n  [//, 'ti:cookie'],\n  [/|/, 'fa:palette'],\n  [/t/, 'ti:shirt'],\n  [//, 'fa:microphone'],\n  [//, 'ti:wind'],\n  [//, 'ti:apple'],\n  [//, 'fa:palette'],\n  [//, 'ti:shirt'],\n  [//, 'ti:brush'],\n  [/|/, 'fa:ribbon'],\n  [//, 'ti:palm'],\n\n  // ============================================\n  // \n  // ============================================\n  [/||/, 'fa:couch'],\n  [//, 'ti:escalator'],\n  [/||/, 'ti:armchair'],\n  [//, 'fa:chair'],\n  [/|/, 'ti:flower'],\n  [//, 'fa:book'],\n  [/|/, 'fa:monument'],\n  [//, 'fa:bed'],\n  [/|/, 'ti:flame'],\n  [//, 'ti:pool'],\n  [//, 'ti:home'],\n  [//, 'fa:hammer'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:floppy-disk'],\n  [/|/, 'fa:door-open'],\n  [/||/, 'ti:alert-triangle'],\n  [/||/, 'fa:gamepad'],\n  [/||/, 'fa:fire'],\n  [/|||/, 'ti:certificate'],\n  [//, 'ti:candle'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:plane'],\n  [/|/, 'fa:cable-car'],\n  [/|||/, 'fa:train'],\n  [/|/, 'fa:square-parking'],\n  [/||/, 'fa:road'],\n  [/||/, 'fa:bus'],\n  [//, 'fa:bus-simple'],\n\n  // ============================================\n  // \n  // ============================================\n  [//, 'ti:chef-hat'],\n  [//, 'fa:shower'],\n  [//, 'fa:bath'],\n  [/||/, 'fa:toilet'],\n  [/||/, 'ti:telescope'],\n  [/|/, 'ti:stairs-down'],\n  [/|/, 'fa:arrow-down'],\n  [//, 'fa:book-open'],\n  [/||/, 'fa:couch'],\n  [//, 'fa:ribbon'],\n  [//, 'fa:building-columns'],\n  [//, 'fa:users'],\n  [//, 'fa:music'],\n  [//, 'fa:masks-theater'],\n  [/|/, 'ti:ripple'],\n\n  // ============================================\n  // \n  // ============================================\n  [/||/, 'fa:film'],\n  [/|/, 'fa:gavel'],\n  [//, 'fa:shield-halved'],\n  [/|/, 'fa:bag-shopping'],\n  [/|/, 'ti:bath'],\n  [/||/, 'ti:cards'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:flask'],\n  [//, 'fa:hospital'],\n  [/|/, 'fa:industry'],\n  [/|/, 'fa:building-shield'],\n  [/|||/, 'fa:scale-balanced'],\n  [/|||||/, 'fa:handcuffs'],\n  [/||/, 'fa:folder'],\n  [/|/, 'fa:rocket'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:umbrella-beach'],\n  [/||/, 'fa:snowflake'],\n  [/|/, 'fa:volcano'],\n  [//, 'fa:water'],\n  [/|/, 'ti:cactus'],\n  [//, 'fa:water'],\n  [//, 'ti:fish'],\n  [/|/, 'ti:droplet'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:crown'],\n  [/|/, 'ti:horse'],\n  [//, 'ti:building-castle'],\n  [/||/, 'ti:grave'],\n  [/|/, 'ti:spider'],\n  [/|/, 'fa:swords'],\n\n  // ============================================\n  // //\n  // ============================================\n  // \n  [/|/, 'fa:mountain'],\n  [/|/, 'ti:topology-star-3'],\n  [/|/, 'fa:pills'],\n  [/|/, 'ti:flask'],\n  [/|/, 'ti:hexagon'],\n  [/|/, 'fa:mountain-sun'],\n  [/|/, 'fa:bolt'],\n  [/|/, 'ti:sword'],\n  [/|/, 'fa:swords'],\n\n  // \n  [/|/, 'ti:wand'],\n  [/|/, 'ti:flask'],\n  [/|/, 'ti:wand'],\n  [/|/, 'fa:book-open'],\n\n  // \n  [/|/, 'ti:ripple'],\n  [/|/, 'fa:book-skull'],\n  [/|/, 'ti:candle'],\n  [/||/, 'fa:eye'],\n\n  // \n  [//, 'ti:robot'],\n  [//, 'ti:device-projector'],\n  [/|/, 'fa:server'],\n  [/|/, 'fa:microchip'],\n  [/scp||/, 'fa:shield-halved'],\n  [//, 'fa:gear'],\n\n  // \n  [//, 'ti:air-balloon'],\n  [//, 'fa:gears'],\n  [/|/, 'ti:flask'],\n  [//, 'ti:clock'],\n\n  // \n  [//, 'fa:house-crack'],\n  [//, 'fa:radiation'],\n  [/|/, 'ti:home-off'],\n  [//, 'fa:recycle'],\n  [/|/, 'fa:biohazard'],\n\n  // \n  [/|/, 'fa:rocket'],\n  [//, 'fa:satellite'],\n  [/|/, 'fa:circle-notch'],\n  [//, 'ti:alien'],\n\n  // \n  [//, 'fa:clone'],\n  [/|/, 'fa:scale-balanced'],\n  [/|/, 'fa:skull'],\n  [/|/, 'ti:candle'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'ti:snowflake'],\n  [/|/, 'ti:palm'],\n  [//, 'ti:plant'],\n  [//, 'ti:deer'],\n  [//, 'ti:cactus'],\n  [//, 'ti:flower'],\n  [/||/, 'fa:cloud'],\n  [/|/, 'fa:fire'],\n  [/|/, 'ti:mushroom'],\n\n  // ============================================\n  // \n  // ============================================\n  [//, 'fa:snowflake'],\n  [//, 'fa:tornado'],\n  [//, 'fa:tornado'],\n  [//, 'ti:meteor'],\n  [/|/, 'fa:moon'],\n  [/|/, 'fa:cloud-rain'],\n  [/|/, 'ti:stars'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:hammer'],\n  [//, 'ti:sparkles'],\n  [//, 'ti:tool'],\n  [//, 'ti:flask'],\n  [//, 'ti:beer'],\n  [//, 'ti:needle'],\n  [/|/, 'ti:horse'],\n\n  // ============================================\n  //  (///)\n  // ============================================\n  // []\n  [/|||/, 'fa:key'],\n  [/|||/, 'fa:file-lines'],\n  [/||/, 'fa:magnifying-glass'],\n  [/||/, 'fa:id-card'],\n\n  // []\n  [/|||/, 'fa:skull'],\n  [/|/, 'fa:explosion'],\n  [/|/, 'ti:paw'],\n  [/|/, 'fa:skull'],\n\n  // []\n  [/|||/, 'fa:user-tie'],\n  [/||/, 'fa:user'],\n  [/|/, 'fa:shop'],\n\n  // []\n  [/||/, 'fa:monument'],\n  [/||/, 'fa:gears'],\n  [/|/, 'fa:dungeon'],\n  [/|/, 'fa:door-open'],\n\n  // ============================================\n  //  ()\n  // ============================================\n  [/|/, 'fa:fire'],\n  [/|/, 'fa:droplet'],\n  [/|/, 'fa:wind'],\n  [//, 'fa:mountain'],\n  [//, 'fa:bolt'],\n  [/|/, 'ti:sparkles'],\n  [/|/, 'fa:moon'],\n  [//, 'ti:clock'],\n\n  // ============================================\n  // \n  // ============================================\n  [//, 'ti:flower'],\n  [/|/, 'ti:leaf'],\n  [/|/, 'ti:flower'],\n  [//, 'ti:flower'],\n  [//, 'ti:flower'],\n  [//, 'ti:butterfly'],\n  [//, 'ti:bug'],\n  [//, 'ti:bat'],\n  [/|/, 'ti:feather'],\n  [/|/, 'fa:fire'],\n  [//, 'ti:feather'],\n  [//, 'ti:cat'],\n  [//, 'ti:deer'],\n\n  // ============================================\n  // \n  // ============================================\n  [/boss||/, 'ti:skull'],\n  [/|||/, 'fa:skull'],\n  [//, 'ti:paw'],\n  [/|/, 'fa:droplet'],\n  [//, 'fa:skull'],\n  [/|/, 'fa:robot'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:coins'],\n  [/|/, 'fa:gem'],\n  [//, 'fa:gem'],\n  [/|/, 'fa:flask'],\n  [/|/, 'fa:key'],\n  [//, 'fa:map'],\n  [//, 'fa:box'],\n  [/|/, 'ti:shirt'],\n  [//, 'ti:sword'],\n  [//, 'ti:bow'],\n  [//, 'fa:gun'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:droplet'],\n  [//, 'ti:shoe'],\n  [/|/, 'fa:skull-crossbones'],\n  [//, 'ti:mist'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:fire'],\n  [/|/, 'ti:snowflake'],\n  [//, 'ti:flask-off'],\n  [/|/, 'fa:droplet'],\n  [/|/, 'ti:stars'],\n  [//, 'ti:volume-off'],\n  [/|/, 'ti:mood-sad'],\n  [/|/, 'ti:mood-angry'],\n  [/|/, 'fa:ghost'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'ti:heart'],\n  [/|/, 'ti:ghost'],\n  [/|/, 'fa:heart'],\n  [/|/, 'ti:alert-triangle'],\n  [/|/, 'ti:leaf'],\n  [/|/, 'ti:flame'],\n  [/|/, 'ti:mood-sad'],\n  [/|/, 'fa:party-horn'],\n  [/|/, 'ti:mood-empty'],\n\n  // ============================================\n  // \n  // ============================================\n  // \n  [//, 'fa:floppy-disk'],\n  [/|/, 'ti:stairs'],\n  [/|/, 'ti:armchair'],\n  [/|/, 'fa:bed'],\n  [//, 'ti:hanger'],\n  [//, 'ti:table'],\n  [//, 'fa:box'],\n  [//, 'ti:wall'],\n  [/|/, 'fa:chalkboard'],\n  [/||||||/, 'fa:desktop'],\n  [//, 'fa:video'],\n  [//, 'fa:satellite-dish'],\n  [/|/, 'ti:window'],\n  [//, 'ti:escalator'],\n  [/|/, 'fa:gears'],\n  [/|/, 'fa:lock'],\n  [/|||/, 'fa:door-open'],\n\n  // \n  [/|||/, 'fa:person-walking'],\n  [//, 'ti:lane'],\n  [/|/, 'fa:bridge'],\n  [//, 'fa:square-full'],\n  [//, 'fa:flag'],\n\n  // \n  [/|||/, 'ti:shoe'],\n  [/|/, 'fa:building'],\n  [/|/, 'fa:bed'],\n  [//, 'fa:door-closed'],\n  [/|/, 'ti:plant'],\n  [//, 'fa:door-open'],\n\n  // \n  [//, 'fa:bag-shopping'],\n  [/|/, 'fa:building'],\n  [/|||/, 'fa:hotel'],\n  [/||/, 'fa:store'],\n  [/||/, 'fa:utensils'],\n  [/|/, 'fa:mug-hot'],\n  [/|/, 'fa:wine-glass'],\n  [/|/, 'fa:guitar'],\n\n  // \n  [/|/, 'fa:warehouse'],\n  [/|/, 'fa:hospital'],\n  [/|||/, 'fa:building-columns'],\n  [/||/, 'fa:briefcase'],\n\n  // \n  [/|||/, 'fa:umbrella-beach'],\n  [/|/, 'fa:water'],\n  [/||/, 'fa:droplet'],\n  [/|/, 'fa:circle-dot'],\n  [/|||/, 'fa:tree'],\n  [/||/, 'ti:plant'],\n  [/||/, 'fa:mountain'],\n  [/|/, 'fa:tree'],\n\n  // \n  [/|/, 'fa:campground'],\n  [//, 'fa:building'],\n  [/|/, 'fa:crown'],\n  [//, 'fa:building-columns'],\n  [/|/, 'fa:chess-rook'],\n  [/|/, 'fa:church'],\n  [/|||/, 'fa:place-of-worship'],\n  [/|/, 'fa:building-columns'],\n  [//, 'ti:spider'],\n  [/||/, 'ti:tower'],\n  [//, 'fa:shield-halved'],\n\n  // \n  [/|/, 'ti:wand'],\n  [/|/, 'fa:school'],\n  [//, 'fa:book'],\n  [/|/, 'fa:bell-concierge'],\n  [/||/, 'ti:run'],\n  [/||/, 'fa:building-columns'],\n  [/|||/, 'fa:school'],\n\n  // \n  [//, 'fa:eye'],\n  [/|/, 'fa:user-secret'],\n  [/|/, 'fa:coins'],\n  [/||/, 'fa:user'],\n  [/||/, 'fa:shield-halved'],\n  [/||/, 'fa:users'],\n\n  // \n  [/||/, 'ti:wheat'],\n  [/|||/, 'fa:swords'],\n  [/||/, 'ti:shirt'],\n  [/|/, 'ti:meat'],\n  [/|||/, 'fa:file'],\n  [//, 'fa:link'],\n  [/|||/, 'ti:cake'],\n  [//, 'fa:wine-glass'],\n  [//, 'ti:fish'],\n  [//, 'ti:bread'],\n  [//, 'ti:bread'],\n  [/|/, 'ti:cup'],\n  [//, 'fa:camera'],\n  [/||/, 'fa:gamepad'],\n  [//, 'fa:mobile'],\n  [//, 'fa:gift'],\n  [/|/, 'fa:book'],\n  [//, 'fa:clipboard-list'],\n  [//, 'fa:scroll'],\n  [/|/, 'fa:suitcase'],\n  [/|/, 'fa:bag-shopping'],\n  [/|/, 'fa:screwdriver-wrench'],\n\n  // \n  [/||/, 'fa:lightbulb'],\n  [/|/, 'ti:shoe'],\n  [/|/, 'ti:mist'],\n  [/|/, 'fa:shield-halved'],\n  [//, 'fa:wind'],\n  [/|/, 'fa:heart'],\n\n  // \n  [/||/, 'fa:circle-notch'],\n  [/|/, 'fa:eye'],\n  [/||||/, 'fa:city'],\n  [/|||||/, 'fa:house'],\n  [/|/, 'fa:house'],\n  [/|/, 'fa:brain'],\n  [/|/, 'fa:dna'],\n  [/|/, 'fa:magnifying-glass'],\n  [//, 'ti:walk'],\n  [/||||/, 'fa:mountain'],\n];\n\n// \nexport const LOCATION_EMOJI_MAP = EMOJI_MAP;\nexport const ELEMENT_EMOJI_MAP = EMOJI_MAP;\n\n/**\n * \n * \n *\n * index.ts  showRelationshipGraph() \n *  foreignObject  SVG  HTML \n *\n * \n * - fa:xxx   Font Awesome  ( fa:heart)\n * - ti:xxx   Tabler Icons  ( ti:swords)\n *\n * \n * 1. \n * 2.  includes() \n * 3. \n * 4.  fa fa  ti\n */\nexport const RELATION_ICON_MAP: { icon: string; keywords: string[] }[] = [\n  {\n    icon: 'fa:heart',\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n  },\n  {\n    icon: 'fa:ring',\n    keywords: ['', '', '', '', '', '', '', '', '', '', ''],\n  },\n  {\n    icon: 'fa:child',\n    keywords: ['', '', '', '', '', ''],\n  },\n  {\n    icon: 'fa:people-roof',\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n  },\n  {\n    icon: 'fa:star',\n    keywords: ['', '', '', '', '', '', '', '', '', '', '', ''],\n  },\n  {\n    icon: 'fa:user-group',\n    keywords: ['', '', '', '', '', '', '', '', '', '', '', ''],\n  },\n  { icon: 'fa:handshake-angle', keywords: ['', '', '', '', ''] },\n  { icon: 'fa:shield-heart', keywords: ['', '', '', '', '', '', ''] },\n  { icon: 'fa:house-user', keywords: ['', '', '', ''] },\n  {\n    icon: 'fa:graduation-cap',\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n  },\n  { icon: 'fa:compass', keywords: ['', '', '', '', '', ''] },\n  { icon: 'fa:file-signature', keywords: ['', '', '', '', '', '', '', '', ''] },\n  { icon: 'fa:handshake', keywords: ['', '', '', '', '', '', '', ''] },\n  {\n    icon: 'fa:gavel',\n    keywords: ['', '', '', '', '', '', '', '', '', '', '', ''],\n  },\n  { icon: 'fa:thumbs-up', keywords: ['', '', '', '', '', '', ''] },\n  { icon: 'fa:hand-holding-heart', keywords: ['', '', '', '', '', '', '', ''] },\n  { icon: 'fa:eye', keywords: ['', '', '', '', '', '', ''] },\n  {\n    icon: 'ti:swords',\n    keywords: ['', '', '', '', '', '', '', '', '', '', '', ''],\n  },\n  { icon: 'fa:skull', keywords: ['', '', '', '', '', '', '', '', '', ''] },\n  {\n    icon: 'ti:ghost',\n    keywords: ['', '', '', '', '', '', '', '', '', ''],\n  },\n  {\n    icon: 'fa:thumbs-down',\n    keywords: ['', '', '', '', '', '', '', '', '', '', ''],\n  },\n  { icon: 'fa:ban', keywords: ['', '', '', '', '', '', '', '', ''] },\n  {\n    icon: 'fa:hands-praying',\n    keywords: ['', '', '', '', '', '', '', '', '', '', ''],\n  },\n  {\n    icon: 'fa:face-meh',\n    keywords: ['', '', '', '', '', '', '', '', '', '', ''],\n  },\n  { icon: 'ti:circles-relation', keywords: ['', '', '', '', ''] },\n  { icon: 'fa:link', keywords: ['', '', '', '', '', '', ''] },\n  { icon: 'fa:crosshairs', keywords: ['', '', '', '', '', '', '', ''] },\n  { icon: 'fa:medal', keywords: ['', '', '', '', '', '', '', ''] },\n];\n","/**\n * -UI\n *\n *  index.ts \n *\n * ## \n * - index.ts \n * - \n *\n * ## \n * -  index.ts  `import { injectDatabaseStyles } from './database-ui-override'` \n * - \n *\n * ## \n * -  DATABASE_THEME_MAP  injectDatabaseStyles \n * -  `pnpm build` \n *\n * @see index.ts - injectDatabaseStyles()  9491 \n */\n\ninterface ThemeColors {\n  bgNav: string;\n  bgPanel: string;\n  border: string;\n  textMain: string;\n  textSub: string;\n  btnBg: string;\n  btnHover: string;\n  btnActiveBg: string;\n  btnActiveText: string;\n  accent: string;\n  inputBg: string;\n}\n\ntype DatabaseThemeMap = Record<string, ThemeColors>;\n\nconst DATABASE_THEME_MAP: DatabaseThemeMap = {\n  retro: {\n    bgNav: '#e6e2d3',\n    bgPanel: '#e6e2d3',\n    border: '#dcd0c0',\n    textMain: '#5e4b35',\n    textSub: '#999',\n    btnBg: '#dcd0c0',\n    btnHover: '#cbbba8',\n    btnActiveBg: '#8d7b6f',\n    btnActiveText: '#fdfaf5',\n    accent: '#7a695f',\n    inputBg: '#f5f2eb',\n  },\n  dark: {\n    bgNav: '#2b2b2b',\n    bgPanel: '#252525',\n    border: '#444',\n    textMain: '#eee',\n    textSub: '#aaa',\n    btnBg: '#3a3a3a',\n    btnHover: '#4a4a4a',\n    btnActiveBg: '#6a5acd',\n    btnActiveText: '#fff',\n    accent: '#9b8cd9',\n    inputBg: '#3a3a3a',\n  },\n  modern: {\n    bgNav: '#ffffff',\n    bgPanel: '#f8f9fa',\n    border: '#e0e0e0',\n    textMain: '#333',\n    textSub: '#666',\n    btnBg: '#f1f3f5',\n    btnHover: '#e9ecef',\n    btnActiveBg: '#007bff',\n    btnActiveText: '#fff',\n    accent: '#007bff',\n    inputBg: '#f1f3f5',\n  },\n  forest: {\n    bgNav: '#e8f5e9',\n    bgPanel: '#e8f5e9',\n    border: '#c8e6c9',\n    textMain: '#2e7d32',\n    textSub: '#81c784',\n    btnBg: '#c8e6c9',\n    btnHover: '#a5d6a7',\n    btnActiveBg: '#43a047',\n    btnActiveText: '#fff',\n    accent: '#4caf50',\n    inputBg: '#c8e6c9',\n  },\n  ocean: {\n    bgNav: '#e3f2fd',\n    bgPanel: '#e3f2fd',\n    border: '#90caf9',\n    textMain: '#1565c0',\n    textSub: '#64b5f6',\n    btnBg: '#bbdefb',\n    btnHover: '#90caf9',\n    btnActiveBg: '#1976d2',\n    btnActiveText: '#fff',\n    accent: '#2196f3',\n    inputBg: '#bbdefb',\n  },\n  cyber: {\n    bgNav: '#000000',\n    bgPanel: '#0a0a0a',\n    border: '#333',\n    textMain: '#00ffcc',\n    textSub: '#ff00ff',\n    btnBg: '#111',\n    btnHover: '#222',\n    btnActiveBg: '#ff00ff',\n    btnActiveText: '#000',\n    accent: '#00ffcc',\n    inputBg: '#111',\n  },\n  nightowl: {\n    bgNav: '#0a2133',\n    bgPanel: '#011627',\n    border: '#132e45',\n    textMain: '#e0e6f2',\n    textSub: '#a6b8cc',\n    btnBg: '#1f3a52',\n    btnHover: '#2a4a68',\n    btnActiveBg: '#7fdbca',\n    btnActiveText: '#011627',\n    accent: '#7fdbca',\n    inputBg: '#1f3a52',\n  },\n  sakura: {\n    bgNav: '#F9F0EF',\n    bgPanel: '#F9F0EF',\n    border: '#EBDCD9',\n    textMain: '#6B5552',\n    textSub: '#C08D8D',\n    btnBg: '#EBDCD9',\n    btnHover: '#D8C7C4',\n    btnActiveBg: '#C08D8D',\n    btnActiveText: '#F9F0EF',\n    accent: '#C08D8D',\n    inputBg: '#EBDCD9',\n  },\n  minepink: {\n    bgNav: '#1a1a1a',\n    bgPanel: '#1a1a1a',\n    border: '#333333',\n    textMain: '#ffb3d9',\n    textSub: '#ff80c1',\n    btnBg: '#2a2a2a',\n    btnHover: '#3a3a3a',\n    btnActiveBg: '#ff80c1',\n    btnActiveText: '#1a1a1a',\n    accent: '#ff80c1',\n    inputBg: '#2a2a2a',\n  },\n  purple: {\n    bgNav: '#f3e5f5',\n    bgPanel: '#f3e5f5',\n    border: '#ce93d8',\n    textMain: '#6a1b9a',\n    textSub: '#9c27b0',\n    btnBg: '#e1bee7',\n    btnHover: '#ce93d8',\n    btnActiveBg: '#9c27b0',\n    btnActiveText: '#fff',\n    accent: '#9c27b0',\n    inputBg: '#e1bee7',\n  },\n  wechat: {\n    bgNav: '#F7F7F7',\n    bgPanel: '#F7F7F7',\n    border: '#E5E5E5',\n    textMain: '#333333',\n    textSub: '#666666',\n    btnBg: '#E5E5E5',\n    btnHover: '#D5D5D5',\n    btnActiveBg: '#09B83E',\n    btnActiveText: '#FFFFFF',\n    accent: '#09B83E',\n    inputBg: '#E5E5E5',\n  },\n  educational: {\n    bgNav: '#000000',\n    bgPanel: '#000000',\n    border: '#1B1B1B',\n    textMain: '#FFFFFF',\n    textSub: '#CCCCCC',\n    btnBg: '#1B1B1B',\n    btnHover: '#2B2B2B',\n    btnActiveBg: '#FF9900',\n    btnActiveText: '#000000',\n    accent: '#FF9900',\n    inputBg: '#1B1B1B',\n  },\n  vaporwave: {\n    bgNav: '#191970',\n    bgPanel: '#191970',\n    border: 'rgba(0,255,255,0.3)',\n    textMain: '#00FFFF',\n    textSub: '#FF00FF',\n    btnBg: 'rgba(25,25,112,0.8)',\n    btnHover: 'rgba(0,255,255,0.2)',\n    btnActiveBg: '#FF00FF',\n    btnActiveText: '#191970',\n    accent: '#00FFFF',\n    inputBg: 'rgba(25,25,112,0.6)',\n  },\n  classicpackaging: {\n    bgNav: '#000000',\n    bgPanel: '#000000',\n    border: '#FFFF00',\n    textMain: '#FFFF00',\n    textSub: '#CCCC00',\n    btnBg: '#FF0000',\n    btnHover: '#CC0000',\n    btnActiveBg: '#0000FF',\n    btnActiveText: '#FFFF00',\n    accent: '#FF0000',\n    inputBg: '#1a1a1a',\n  },\n  galgame: {\n    bgNav: '#FFF0F5',\n    bgPanel: '#FFF0F5',\n    border: '#F0D4E4',\n    textMain: '#6B4A5A',\n    textSub: '#B08A9A',\n    btnBg: '#FFE4E9',\n    btnHover: '#FFD4E4',\n    btnActiveBg: '#E8B4D9',\n    btnActiveText: '#6B4A5A',\n    accent: '#E8B4D9',\n    inputBg: '#FFF8FA',\n  },\n  terminal: {\n    bgNav: '#0c0c0c',\n    bgPanel: '#0c0c0c',\n    border: '#00ff00',\n    textMain: '#00ff00',\n    textSub: '#00cc00',\n    btnBg: '#1a1a1a',\n    btnHover: '#2a2a2a',\n    btnActiveBg: '#00ff00',\n    btnActiveText: '#0c0c0c',\n    accent: '#00ff00',\n    inputBg: '#0c0c0c',\n  },\n  dreamcore: {\n    bgNav: '#F4F1EA',\n    bgPanel: '#F4F1EA',\n    border: '#D6D2C4',\n    textMain: '#5C5869',\n    textSub: '#9490A0',\n    btnBg: '#E6E1D5',\n    btnHover: '#DBD8CC',\n    btnActiveBg: '#8A9AC6',\n    btnActiveText: '#FFFFFF',\n    accent: '#8A9AC6',\n    inputBg: '#FFFFFF',\n  },\n  aurora: {\n    bgNav: 'linear-gradient(135deg,#0f172a,#1e293b)',\n    bgPanel: 'linear-gradient(180deg,#0f172a 0%,#334155 100%)',\n    border: '#38bdf8',\n    textMain: '#e2e8f0',\n    textSub: '#94a3b8',\n    btnBg: 'linear-gradient(135deg,#162a3d,#25224d)',\n    btnHover: 'linear-gradient(135deg,#1e3a5f,#312e81)',\n    btnActiveBg: 'linear-gradient(135deg,#38bdf8,#a855f7)',\n    btnActiveText: '#fff',\n    accent: '#38bdf8',\n    inputBg: '#0f172a',\n  },\n  chouten: {\n    bgNav: 'linear-gradient(135deg,rgba(26,10,46,0.95) 0%,rgba(45,27,78,0.95) 50%,rgba(26,10,46,0.95) 100%)',\n    bgPanel: 'rgba(26,10,46,0.95)',\n    border: '#FF7EB6',\n    textMain: '#FFFFFF',\n    textSub: '#D0BFFF',\n    btnBg: 'rgba(255,255,255,0.1)',\n    btnHover: 'rgba(255,107,157,0.3)',\n    btnActiveBg: 'linear-gradient(90deg,#FF6B9D,#B388FF)',\n    btnActiveText: '#FFFFFF',\n    accent: '#7FFFD4',\n    inputBg: 'rgba(0,0,0,0.3)',\n  },\n};\n\n/**\n * \n * @param themeId  ID\n */\nexport function injectDatabaseStyles(themeId: string, fontFamily?: string) {\n  try {\n    const getJQuery = (w: Window | null | undefined) => {\n      try {\n        return (w as any)?.jQuery as any;\n      } catch {\n        return null;\n      }\n    };\n\n    // // document\n    const targets = [getJQuery(window), getJQuery(window.parent), getJQuery(window.top)].filter(\n      (v, idx, arr) => !!v && arr.indexOf(v) === idx,\n    );\n    if (!targets.length) return;\n\n    const t = DATABASE_THEME_MAP[themeId] || DATABASE_THEME_MAP.aurora;\n    const darkThemeIds = new Set(['cyber', 'terminal', 'aurora', 'chouten', 'classicpackaging']);\n    const isDarkTheme = darkThemeIds.has(themeId);\n    const stepperSpinFilter = isDarkTheme ? 'invert(1) brightness(1.05)' : 'none';\n    const stepperSpinOpacity = isDarkTheme ? '0.85' : '0.55';\n    const stepperColorScheme = isDarkTheme ? 'dark' : 'light';\n\n    // ==========  () ==========\n    //  :is() \n    // \n    const S_POPUP = `#shujuku_v104-popup.auto-card-updater-popup, [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup`;\n    // \n    const S_MAIN = `#shujuku_v104-main-window, [id^=\"shujuku\"][id$=\"-main-window\"]`;\n    // \n    const S_VIS = `#shujuku_v104-visualizer-window, [id^=\"shujuku\"][id$=\"-visualizer-window\"]`;\n    // \n    const S_ALL_WINDOWS = `${S_POPUP}, ${S_MAIN}, ${S_VIS}`;\n    // +\n    const S_POPUP_MAIN = `${S_POPUP}, ${S_MAIN}`;\n\n    const fontCss = fontFamily\n      ? `\n        /*  / pseudo-element  */\n        html body .auto-card-updater-popup,\n        html body #shujuku_v104-main-window,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"],\n        html body #shujuku_v104-popup.auto-card-updater-popup,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup {\n          --acu-font-family: ${fontFamily};\n          font-family: var(--acu-font-family) !important;\n        }\n\n        html body .auto-card-updater-popup :is(div, p, span, label, a, button:not(.acu-window-btn), input, select, textarea, th, td, li, ul, ol, h1, h2, h3, h4, h5, h6, small, strong, em),\n        html body #shujuku_v104-main-window :is(div, p, span, label, a, button:not(.acu-window-btn), input, select, textarea, th, td, li, ul, ol, h1, h2, h3, h4, h5, h6, small, strong, em),\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] :is(div, p, span, label, a, button:not(.acu-window-btn), input, select, textarea, th, td, li, ul, ol, h1, h2, h3, h4, h5, h6, small, strong, em),\n        html body #shujuku_v104-popup.auto-card-updater-popup :is(div, p, span, label, a, button:not(.acu-window-btn), input, select, textarea, th, td, li, ul, ol, h1, h2, h3, h4, h5, h6, small, strong, em),\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup :is(div, p, span, label, a, button:not(.acu-window-btn), input, select, textarea, th, td, li, ul, ol, h1, h2, h3, h4, h5, h6, small, strong, em) {\n          font-family: var(--acu-font-family) !important;\n        }\n      `\n      : '';\n\n    const css = `\n      <style id=\"dice-db-theme-sync\">\n        ${fontCss}\n        html body .auto-card-updater-popup {\n          --acu-bg-0: ${t.bgPanel} !important;\n          --acu-bg-1: ${t.bgNav} !important;\n          --acu-bg-2: ${t.btnBg} !important;\n          --acu-border: ${t.border} !important;\n          --acu-border-2: ${t.border} !important;\n          --acu-text-1: ${t.textMain} !important;\n          --acu-text-2: ${t.textSub} !important;\n          --acu-text-3: ${t.textSub} !important;\n          --acu-accent: ${t.accent} !important;\n          --acu-accent-glow: ${t.accent}1a !important;\n        }\n        /* ==========  ========== */\n        html body .auto-card-updater-popup button,\n        html body .auto-card-updater-popup .button {\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          border-radius: 8px !important;\n          padding: 8px 16px !important;\n          font-weight: 500 !important;\n          cursor: pointer !important;\n          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\n          position: relative !important;\n        }\n        \n        /*  */\n        html body .auto-card-updater-popup button:hover,\n        html body .auto-card-updater-popup .button:hover {\n          background: ${t.btnHover} !important;\n          transform: translateY(-2px) !important;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;\n        }\n        \n        /*  */\n        html body .auto-card-updater-popup button:active,\n        html body .auto-card-updater-popup .button:active {\n          transform: translateY(0) scale(0.98) !important;\n          box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1) !important;\n          transition-duration: 0.1s !important;\n        }\n        \n        /* Primary  -  */\n        html body .auto-card-updater-popup button.primary,\n        html body .auto-card-updater-popup .button.primary {\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          border-color: ${t.btnActiveBg} !important;\n          font-weight: 600 !important;\n          box-shadow: 0 2px 8px ${t.accent}33 !important;\n        }\n        \n        /* Primary  */\n        html body .auto-card-updater-popup button.primary:hover,\n        html body .auto-card-updater-popup .button.primary:hover {\n          transform: translateY(-2px) !important;\n          box-shadow: 0 6px 20px ${t.accent}44 !important;\n          filter: brightness(1.1) !important;\n        }\n        \n        /* Primary  */\n        html body .auto-card-updater-popup button.primary:active,\n        html body .auto-card-updater-popup .button.primary:active {\n          transform: translateY(0) scale(0.98) !important;\n          box-shadow: 0 2px 8px ${t.accent}22 !important;\n          filter: brightness(0.95) !important;\n        }\n        \n        /*  */\n        html body .auto-card-updater-popup button:disabled,\n        html body .auto-card-updater-popup .button:disabled {\n          opacity: 0.5 !important;\n          cursor: not-allowed !important;\n          transform: none !important;\n          box-shadow: none !important;\n        }\n        /* button-group  -  */\n        html body :is(${S_POPUP}) .button-group.acu-data-mgmt-buttons button,\n        html body :is(${S_POPUP}) .button-group.acu-data-mgmt-buttons .button {\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n        }\n        html body :is(${S_POPUP}) .button-group.acu-data-mgmt-buttons button:hover,\n        html body :is(${S_POPUP}) .button-group.acu-data-mgmt-buttons .button:hover {\n          background: ${t.btnHover} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup code,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup code {\n          background-color: ${t.inputBg} !important;\n          background: ${t.inputBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          border-left: 2px solid ${t.accent} !important;\n        }\n        html body :is(${S_POPUP}) table thead th,\n        html body :is(${S_POPUP}) table th {\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          border-color: ${t.border} !important;\n        }\n\n        /* ==========  ========== */\n        html body :is(${S_ALL_WINDOWS}) {\n          border-radius: 16px !important;\n          box-shadow: \n            0 25px 50px -12px rgba(0, 0, 0, 0.25),\n            0 0 0 1px ${t.border},\n            0 0 40px -10px ${t.accent}33 !important;\n          animation: acu-db-popup-enter 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) !important;\n        }\n\n        @keyframes acu-db-popup-enter {\n          from {\n            opacity: 0;\n            transform: scale(0.95) translateY(10px);\n          }\n          to {\n            opacity: 1;\n            transform: scale(1) translateY(0);\n          }\n        }\n\n        /* ==========  ( :is() ) ========== */\n        html body :is(${S_POPUP_MAIN}) {\n          padding-top: 0 !important;\n        }\n\n        html body :is(${S_POPUP_MAIN}) .acu-layout {\n          margin-top: 0 !important;\n        }\n\n        html body :is(${S_ALL_WINDOWS}) .acu-window-header {\n          background: linear-gradient(135deg, ${t.bgNav} 0%, ${t.bgPanel} 100%) !important;\n          border-bottom: 1px solid ${t.border} !important;\n          color: ${t.textMain} !important;\n          padding: 14px 18px !important;\n          position: relative !important;\n          margin: 0 !important;\n          z-index: 32012 !important;\n        }\n\n        /*  */\n        html body :is(${S_ALL_WINDOWS}) .acu-window-header::after {\n          content: '' !important;\n          position: absolute !important;\n          bottom: 0 !important;\n          left: 50% !important;\n          transform: translateX(-50%) !important;\n          width: 60% !important;\n          height: 1px !important;\n          background: linear-gradient(90deg, transparent, ${t.accent}66, transparent) !important;\n        }\n\n        /*  */\n        html body :is(${S_ALL_WINDOWS}) .acu-window-title,\n        html body :is(${S_ALL_WINDOWS}) .acu-window-title span {\n          color: ${t.textMain} !important;\n          font-weight: 600 !important;\n          letter-spacing: 0.3px !important;\n        }\n\n        /*  */\n        html body :is(${S_ALL_WINDOWS}) .acu-window-title i {\n          color: ${t.accent} !important;\n          transition: transform 0.3s ease, color 0.2s ease !important;\n        }\n\n        /*  */\n        html body :is(${S_ALL_WINDOWS}) .acu-window-header:hover .acu-window-title i {\n          transform: rotate(15deg) scale(1.1) !important;\n        }\n\n        /*  */\n        html body :is(${S_ALL_WINDOWS}) .acu-window-btn {\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          border-radius: 8px !important;\n          padding: 6px 10px !important;\n          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\n        }\n\n        html body :is(${S_ALL_WINDOWS}) .acu-window-btn:hover {\n          background: ${t.btnHover} !important;\n          color: ${t.textMain} !important;\n          transform: translateY(-1px) !important;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;\n        }\n\n        html body :is(${S_ALL_WINDOWS}) .acu-window-btn.close:hover {\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          box-shadow: 0 2px 12px ${t.accent}44 !important;\n        }\n\n        html body :is(${S_POPUP}) .acu-stepper {\n          background-color: ${t.inputBg} !important;\n          border-color: ${t.border} !important;\n        }\n        html body :is(${S_POPUP}) .acu-stepper-btn {\n          background-color: ${t.btnBg} !important;\n          color: ${t.textSub} !important;\n        }\n        html body :is(${S_POPUP}) .acu-stepper-btn:hover {\n          background-color: ${t.btnHover} !important;\n          color: ${t.accent} !important;\n        }\n        html body :is(${S_POPUP}) .acu-stepper-btn:active {\n          background-color: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n        }\n        html body :is(${S_POPUP}) .acu-stepper-value {\n          background-color: ${t.inputBg} !important;\n          color: ${t.textMain} !important;\n          border-left: 1px solid ${t.border} !important;\n          border-right: 1px solid ${t.border} !important;\n        }\n        html body :is(${S_POPUP}) input[type=\"number\"] {\n          color-scheme: ${stepperColorScheme} !important;\n        }\n        html body :is(${S_POPUP}) input[type=\"number\"]::-webkit-inner-spin-button,\n        html body :is(${S_POPUP}) input[type=\"number\"]::-webkit-outer-spin-button {\n          filter: ${stepperSpinFilter} !important;\n          opacity: ${stepperSpinOpacity} !important;\n        }\n        /* ==========  ========== */\n        html body .auto-card-updater-popup :is(input, select, textarea),\n        html body :is(${S_POPUP}) :is(input, select, textarea) {\n          background-color: ${t.inputBg} !important;\n          background: ${t.inputBg} !important;\n          background-image: none !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          border-color: ${t.border} !important;\n          box-shadow: none !important;\n          text-shadow: none !important;\n          border-radius: 6px !important;\n          padding: 8px 12px !important;\n          font-size: 14px !important;\n          transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease !important;\n        }\n\n        /*  -  */\n        html body .auto-card-updater-popup :is(input, select, textarea):focus,\n        html body :is(${S_POPUP}) :is(input, select, textarea):focus {\n          border-color: ${t.accent} !important;\n          box-shadow: 0 0 0 3px ${t.accent}22, 0 2px 8px rgba(0, 0, 0, 0.08) !important;\n          outline: none !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup :is(input, select, textarea):hover:not(:focus),\n        html body :is(${S_POPUP}) :is(input, select, textarea):hover:not(:focus) {\n          border-color: ${t.accent}66 !important;\n        }\n\n        /*  placeholder  */\n        html body .auto-card-updater-popup :is(input, textarea)::placeholder,\n        html body :is(${S_POPUP}) :is(input, textarea)::placeholder {\n          color: ${t.textSub} !important;\n          opacity: 0.6 !important;\n          transition: opacity 0.2s ease !important;\n        }\n\n        /* placeholder  */\n        html body .auto-card-updater-popup :is(input, textarea):focus::placeholder,\n        html body :is(${S_POPUP}) :is(input, textarea):focus::placeholder {\n          opacity: 0.4 !important;\n        }\n\n        /* ========== Select  ========== */\n        html body .auto-card-updater-popup select,\n        html body :is(${S_POPUP}) select {\n          appearance: none !important;\n          -webkit-appearance: none !important;\n          padding-right: 36px !important;\n          cursor: pointer !important;\n          background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L1 3h10z'/%3E%3C/svg%3E\") !important;\n          background-repeat: no-repeat !important;\n          background-position: right 12px center !important;\n          background-size: 12px !important;\n        }\n\n        /* Select  */\n        html body .auto-card-updater-popup select:hover,\n        html body :is(${S_POPUP}) select:hover {\n          background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='${encodeURIComponent(t.accent)}' d='M6 8L1 3h10z'/%3E%3C/svg%3E\") !important;\n        }\n\n        /* ========== Textarea  ========== */\n        html body .auto-card-updater-popup textarea,\n        html body :is(${S_POPUP}) textarea {\n          min-height: 80px !important;\n          resize: vertical !important;\n          line-height: 1.5 !important;\n        }\n\n        /* ==========  ========== */\n        html body :is(${S_POPUP}) [id$=\"-data-isolation-input-area\"] {\n          margin-top: 12px !important;\n        }\n\n        html body :is(${S_POPUP}) [id$=\"-data-isolation-input-area\"] > div {\n          display: flex !important;\n          align-items: stretch !important;\n          gap: 12px !important;\n          margin-top: 8px !important;\n        }\n\n        html body :is(${S_POPUP}) [id$=\"-data-isolation-combo\"] {\n          position: relative !important;\n          flex: 1 1 auto !important;\n          min-width: 0 !important;\n          display: block !important;\n        }\n\n        html body :is(${S_POPUP}) [id$=\"-data-isolation-code\"] {\n          width: 100% !important;\n          min-height: 44px !important;\n          padding-right: 52px !important;\n        }\n\n        html body :is(${S_POPUP}) button[id$=\"-data-isolation-history-toggle\"] {\n          position: absolute !important;\n          right: 8px !important;\n          top: 50% !important;\n          transform: translateY(-50%) !important;\n          width: 34px !important;\n          min-width: 34px !important;\n          height: 34px !important;\n          min-height: 34px !important;\n          padding: 0 !important;\n          border-radius: 8px !important;\n          border: 1px solid ${t.border} !important;\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          line-height: 1 !important;\n          font-size: 13px !important;\n          display: inline-flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          box-shadow: none !important;\n          z-index: 2 !important;\n        }\n\n        html body :is(${S_POPUP}) button[id$=\"-data-isolation-history-toggle\"]:hover {\n          background: ${t.btnHover} !important;\n          color: ${t.accent} !important;\n          transform: translateY(-50%) !important;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.14) !important;\n        }\n\n        html body :is(${S_POPUP}) [id$=\"-data-isolation-history-list\"] {\n          margin: 0 !important;\n          padding: 6px !important;\n          border-radius: 10px !important;\n          border: 1px solid ${t.border} !important;\n          background: ${t.bgPanel} !important;\n          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.18) !important;\n          max-height: 240px !important;\n          z-index: 32030 !important;\n        }\n\n        html body :is(${S_POPUP}) [id$=\"-data-isolation-history-list\"] li {\n          color: ${t.textMain} !important;\n          border-radius: 6px !important;\n        }\n\n        html body :is(${S_POPUP}) [id$=\"-data-isolation-history-list\"] li:hover {\n          background: ${t.btnHover} !important;\n        }\n\n        /* ==========  ========== */\n        html body :is(${S_POPUP}) .acu-template-presets {\n          border: 1px solid ${t.border} !important;\n          background: ${t.bgPanel} !important;\n          border-radius: 12px !important;\n          box-shadow: 0 8px 22px rgba(0, 0, 0, 0.08) !important;\n        }\n\n        html body :is(${S_POPUP}) .acu-template-preset-toolbar {\n          display: flex !important;\n          flex-direction: column !important;\n          gap: 12px !important;\n          align-items: stretch !important;\n        }\n\n        html body :is(${S_POPUP}) .acu-template-preset-toolbar .acu-template-preset-left {\n          display: grid !important;\n          grid-template-columns: minmax(220px, 1fr) auto auto !important;\n          align-items: center !important;\n          gap: 10px !important;\n          width: 100% !important;\n        }\n\n        html body :is(${S_POPUP}) .acu-template-preset-toolbar .acu-template-preset-actions {\n          display: grid !important;\n          grid-template-columns: repeat(4, minmax(108px, 1fr)) !important;\n          gap: 10px !important;\n          width: 100% !important;\n          align-items: stretch !important;\n        }\n\n        html body :is(${S_POPUP}) .acu-template-preset-toolbar :is(select.text_pole, [id$=\"-template-preset-select\"]) {\n          min-height: 44px !important;\n        }\n\n        html body :is(${S_POPUP}) .acu-mini-btn {\n          min-height: 44px !important;\n          padding: 10px 14px !important;\n          border-radius: 10px !important;\n          border: 1px solid ${t.border} !important;\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          font-size: 15px !important;\n          font-weight: 650 !important;\n          letter-spacing: 0.1px !important;\n          display: inline-flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          gap: 8px !important;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08) !important;\n          transition: transform 0.18s ease, box-shadow 0.18s ease, background-color 0.18s ease, border-color 0.18s ease !important;\n        }\n\n        html body :is(${S_POPUP}) .acu-mini-btn:hover {\n          background: ${t.btnHover} !important;\n          border-color: ${t.accent}66 !important;\n          color: ${t.textMain} !important;\n          transform: translateY(-1px) !important;\n          box-shadow: 0 8px 18px rgba(0, 0, 0, 0.12) !important;\n        }\n\n        html body :is(${S_POPUP}) .acu-mini-btn:active {\n          transform: translateY(0) scale(0.98) !important;\n          box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1) !important;\n        }\n\n        html body :is(${S_POPUP}) .acu-mini-btn.primary {\n          background: ${t.btnActiveBg} !important;\n          border-color: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          box-shadow: 0 8px 20px ${t.accent}33 !important;\n        }\n\n        html body :is(${S_POPUP}) .acu-mini-btn.primary:hover {\n          filter: brightness(1.08) !important;\n        }\n\n        html body :is(${S_POPUP}) button[id$=\"-template-preset-delete\"].acu-mini-btn,\n        html body :is(${S_POPUP}) .acu-mini-btn.danger {\n          border-color: ${t.border} !important;\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08) !important;\n        }\n\n        html body :is(${S_POPUP}) button[id$=\"-data-isolation-save\"].primary {\n          min-height: 44px !important;\n          padding: 10px 18px !important;\n          white-space: nowrap !important;\n          border-radius: 10px !important;\n          background: ${t.textMain} !important;\n          border-color: ${t.textMain} !important;\n          color: ${t.bgPanel} !important;\n          font-weight: 700 !important;\n          box-shadow: 0 6px 16px rgba(0, 0, 0, 0.18) !important;\n        }\n\n        html body :is(${S_POPUP}) button[id$=\"-data-isolation-save\"].primary:hover {\n          background: ${t.accent} !important;\n          border-color: ${t.accent} !important;\n          color: ${t.btnActiveText} !important;\n        }\n\n        html body :is(${S_POPUP}) button[id$=\"-data-isolation-delete-entries\"] {\n          min-height: 42px !important;\n          min-width: 280px !important;\n          padding: 10px 18px !important;\n          border-radius: 10px !important;\n          border: 1px solid ${t.border} !important;\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          font-weight: 650 !important;\n          letter-spacing: 0.1px !important;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08) !important;\n        }\n\n        html body :is(${S_POPUP}) button[id$=\"-data-isolation-delete-entries\"]:hover {\n          background: ${t.btnHover} !important;\n          border-color: ${t.accent}66 !important;\n          color: ${t.textMain} !important;\n          box-shadow: 0 8px 18px rgba(0, 0, 0, 0.12) !important;\n          transform: translateY(-1px) !important;\n          filter: none !important;\n        }\n\n        html body :is(${S_POPUP}) button[id$=\"-data-isolation-delete-entries\"]:active {\n          transform: translateY(0) scale(0.98) !important;\n          box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1) !important;\n          filter: none !important;\n        }\n\n        /* Textarea resize  */\n        html body .auto-card-updater-popup textarea::-webkit-resizer,\n        html body :is(${S_POPUP}) textarea::-webkit-resizer {\n          border-width: 8px !important;\n          border-style: solid !important;\n          border-color: transparent ${t.border} ${t.border} transparent !important;\n        }\n\n        /* ==========  ========== */\n        html body .auto-card-updater-popup :is(input, select, textarea):disabled,\n        html body :is(${S_POPUP}) :is(input, select, textarea):disabled {\n          opacity: 0.5 !important;\n          cursor: not-allowed !important;\n          background-color: ${t.bgNav} !important;\n        }\n\n        /* ========== Checkbox  ========== */\n        /* Checkbox Container (Group) */\n        html body :is(${S_POPUP}) .checkbox-group {\n          background-color: transparent !important;\n          color: ${t.textMain} !important;\n        }\n\n        /* Checkbox Label */\n        html body :is(${S_POPUP}) .checkbox-group label {\n          color: ${t.textMain} !important;\n        }\n\n        /* Checkbox Input Element (/) */\n        html body :is(${S_POPUP}) input[type=\"checkbox\"],\n        html body :is(${S_POPUP}) .checkbox-group input[type=\"checkbox\"] {\n          -webkit-appearance: none !important;\n          appearance: none !important;\n          width: 18px !important;\n          height: 18px !important;\n          min-width: 18px !important;\n          min-height: 18px !important;\n          border-radius: 5px !important;\n          border: 1.5px solid ${t.border} !important;\n          background-color: ${t.inputBg} !important;\n          background-image: none !important;\n          background-repeat: no-repeat !important;\n          background-position: center !important;\n          background-size: 12px 10px !important;\n          box-shadow: none !important;\n          padding: 0 !important;\n          margin: 2px 8px 2px 0 !important;\n          cursor: pointer !important;\n          vertical-align: middle !important;\n          transition: all 0.2s ease !important;\n        }\n        html body :is(${S_POPUP}) input[type=\"checkbox\"]::before,\n        html body :is(${S_POPUP}) input[type=\"checkbox\"]::after {\n          content: none !important;\n          display: none !important;\n        }\n\n        /* Checkbox hover effect */\n        html body :is(${S_POPUP}) input[type=\"checkbox\"]:hover {\n          border-color: ${t.accent} !important;\n          box-shadow: 0 0 0 3px ${t.accent}22 !important;\n        }\n\n        /* Checked State */\n        html body :is(${S_POPUP}) input[type=\"checkbox\"]:checked {\n          background-color: ${t.accent} !important;\n          border-color: ${t.accent} !important;\n          background-image: none !important;\n        }\n\n        /*  checkbox  */\n        html body :is(${S_POPUP}) .checkbox-group {\n          display: flex !important;\n          align-items: center !important;\n          justify-content: space-between !important;\n          gap: 12px !important;\n          padding: 10px 14px !important;\n          border: 1px solid ${t.border} !important;\n          border-radius: 12px !important;\n          background: ${t.bgPanel} !important;\n        }\n\n        html body :is(${S_POPUP}) .checkbox-group > label {\n          margin: 0 !important;\n          flex: 1 1 auto !important;\n          order: 1 !important;\n          color: ${t.textMain} !important;\n          font-size: 14px !important;\n          font-weight: 650 !important;\n          line-height: 1.45 !important;\n          cursor: pointer !important;\n        }\n\n        html body :is(${S_POPUP}) .checkbox-group > input[type=\"checkbox\"] {\n          -webkit-appearance: none !important;\n          appearance: none !important;\n          order: 2 !important;\n          margin: 0 0 0 10px !important;\n          width: 42px !important;\n          min-width: 42px !important;\n          height: 24px !important;\n          min-height: 24px !important;\n          border-radius: 999px !important;\n          border: 1.5px solid ${t.border} !important;\n          background: ${t.inputBg} !important;\n          background-image: none !important;\n          position: relative !important;\n          box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08) !important;\n        }\n\n        html body :is(${S_POPUP}) .checkbox-group > input[type=\"checkbox\"]::before {\n          content: '' !important;\n          display: block !important;\n          position: absolute !important;\n          top: 2px !important;\n          left: 2px !important;\n          width: 18px !important;\n          height: 18px !important;\n          border-radius: 50% !important;\n          background: ${t.btnActiveText} !important;\n          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.22) !important;\n          transform: translateX(0) !important;\n          transition: transform 0.18s ease, background-color 0.18s ease !important;\n        }\n\n        html body :is(${S_POPUP}) .checkbox-group > input[type=\"checkbox\"]::after {\n          content: none !important;\n          display: none !important;\n        }\n\n        html body :is(${S_POPUP}) .checkbox-group > input[type=\"checkbox\"]:checked {\n          background: ${t.btnActiveBg} !important;\n          border-color: ${t.btnActiveBg} !important;\n          background-image: none !important;\n          color: transparent !important;\n          -webkit-text-fill-color: transparent !important;\n        }\n\n        html body :is(${S_POPUP}) .checkbox-group > input[type=\"checkbox\"]:checked::before {\n          transform: translateX(18px) !important;\n        }\n\n        html body :is(${S_POPUP}) .checkbox-group > input[type=\"checkbox\"]:focus-visible {\n          outline: none !important;\n          box-shadow: 0 0 0 3px ${t.accent}33 !important;\n        }\n\n        html body :is(${S_POPUP}) .checkbox-group > input[type=\"checkbox\"]:disabled {\n          opacity: 0.55 !important;\n          cursor: not-allowed !important;\n        }\n\n        html body :is(${S_POPUP}) .checkbox-group:has(> input[type=\"checkbox\"]:checked) {\n          border-color: ${t.accent}66 !important;\n          box-shadow: 0 0 0 1px ${t.accent}22 inset !important;\n        }\n\n        /* ==========  ========== */\n        html body .auto-card-updater-popup :is(th, thead th),\n        html body :is(${S_POPUP}) table thead th,\n        html body :is(${S_POPUP}) table th {\n          color: ${t.btnActiveText} !important;\n          background: linear-gradient(135deg, ${t.btnActiveBg} 0%, ${t.accent} 100%) !important;\n          background-color: ${t.btnActiveBg} !important;\n          font-weight: 600 !important;\n          text-transform: uppercase !important;\n          font-size: 12px !important;\n          letter-spacing: 0.5px !important;\n          padding: 12px 14px !important;\n          border: none !important;\n          border-bottom: 2px solid ${t.accent} !important;\n          position: relative !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table thead th:first-child,\n        html body :is(${S_POPUP}) table thead th:first-child {\n          border-top-left-radius: 8px !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table thead th:last-child,\n        html body :is(${S_POPUP}) table thead th:last-child {\n          border-top-right-radius: 8px !important;\n        }\n\n        /* ========== Status & Messages Display  ========== */\n        html body .auto-card-updater-popup span[id$=\"-status-display\"],\n        html body .auto-card-updater-popup span[id$=\"-messages-display\"],\n        html body .auto-card-updater-popup p.notes,\n        html body :is(${S_POPUP}) span[id$=\"-status-display\"],\n        html body :is(${S_POPUP}) span[id$=\"-messages-display\"],\n        html body :is(${S_POPUP}) p.notes,\n        html body span[id$=\"-card-update-status-display\"],\n        html body span[id$=\"-total-messages-display\"],\n        html body [id$=\"-status-message\"] {\n          display: block !important;\n          background-color: var(--acu-bg-2) !important;\n          color: var(--acu-text-1) !important;\n          border: 1px solid var(--acu-border) !important;\n          border-radius: 8px !important;\n          padding: 10px 14px !important;\n          margin: 10px 0 !important;\n          font-size: 13px !important;\n          line-height: 1.5 !important;\n          box-shadow: inset 0 1px 3px rgba(0,0,0,0.08) !important;\n          word-break: break-all !important;\n        }\n\n        html body .auto-card-updater-popup span[id$=\"-status-display\"] b,\n        html body :is(${S_POPUP}) span[id$=\"-status-display\"] b,\n        html body span[id$=\"-card-update-status-display\"] b {\n          color: var(--acu-accent) !important;\n          font-weight: 600 !important;\n        }\n\n        html body .auto-card-updater-popup span[id$=\"-status-display\"] *:not(b):not([style*=\"color\"]),\n        html body :is(${S_POPUP}) span[id$=\"-status-display\"] *:not(b):not([style*=\"color\"]),\n        html body span[id$=\"-card-update-status-display\"] *:not(b):not([style*=\"color\"]) {\n          color: inherit !important;\n        }\n\n        /* ==========  ========== */\n        html body .auto-card-updater-popup table tbody tr {\n          background-color: ${t.bgPanel} !important;\n          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table tbody tr:nth-child(even) {\n          background-color: ${t.bgNav} !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table tbody tr:hover {\n          background-color: ${t.btnHover} !important;\n          box-shadow: inset 3px 0 0 ${t.accent} !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table tbody td {\n          color: ${t.textMain} !important;\n          padding: 10px 14px !important;\n          border-bottom: 1px solid ${t.border} !important;\n          border-left: none !important;\n          border-right: none !important;\n          border-top: none !important;\n          vertical-align: middle !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table tbody tr:last-child td {\n          border-bottom: none !important;\n        }\n\n        /* ==========  ========== */\n        html body .auto-card-updater-popup table,\n        html body :is(${S_POPUP}) table {\n          table-layout: fixed !important;\n          width: 100% !important;\n          border-collapse: separate !important;\n          border-spacing: 0 !important;\n          max-width: 100% !important;\n          box-sizing: border-box !important;\n          border-radius: 8px !important;\n          overflow: hidden !important;\n          border: 1px solid ${t.border} !important;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;\n        }\n\n        html body .auto-card-updater-popup table :is(thead, tbody, tr),\n        html body :is(${S_POPUP}) table :is(thead, tbody, tr) {\n          width: 100% !important;\n          box-sizing: border-box !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table :is(th, td),\n        html body :is(${S_POPUP}) table :is(th, td),\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table th,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table td {\n          text-align: left !important;\n          padding: 10px 14px !important;\n          overflow: hidden !important;\n          text-overflow: ellipsis !important;\n          white-space: nowrap !important;\n          box-sizing: border-box !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table :is(th, td):first-child,\n        html body :is(${S_POPUP}) table :is(th, td):first-child {\n          text-align: left !important;\n          width: 25% !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table :is(th, td):not(:first-child):not(:last-child),\n        html body :is(${S_POPUP}) table :is(th, td):not(:first-child):not(:last-child) {\n          text-align: center !important;\n          width: calc((100% - 25%) / 4) !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table :is(th, td):last-child,\n        html body :is(${S_POPUP}) table :is(th, td):last-child {\n          text-align: center !important;\n          width: 25% !important;\n        }\n\n        /* ========== Mobile Responsive  ========== */\n        @media (max-width: 768px) {\n          html body .auto-card-updater-popup table,\n          html body :is(${S_POPUP}) table {\n            font-size: 0.85em !important;\n            box-shadow: none !important;\n          }\n\n          html body .auto-card-updater-popup table :is(th, td),\n          html body :is(${S_POPUP}) table :is(th, td) {\n            padding: 8px 10px !important;\n          }\n\n          /*  */\n          html body .auto-card-updater-popup table thead th,\n          html body :is(${S_POPUP}) table thead th {\n            padding: 10px 8px !important;\n            font-size: 11px !important;\n          }\n\n          /*  */\n          html body :is(${S_ALL_WINDOWS}) {\n            animation: acu-db-popup-enter-mobile 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;\n          }\n        }\n\n        @keyframes acu-db-popup-enter-mobile {\n          from {\n            opacity: 0;\n            transform: translateY(20px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n\n        /* ========== Radio group  ========== */\n        html body :is(${S_POPUP}) .qrf_radio_group {\n          background-color: ${t.btnBg} !important;\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          border-radius: 8px !important;\n          padding: 10px 14px !important;\n        }\n\n        html body :is(${S_POPUP}) .qrf_radio_group :is(label, span) {\n          color: ${t.textMain} !important;\n        }\n\n        html body :is(${S_POPUP}) input[type=\"radio\"] {\n          -webkit-appearance: none !important;\n          appearance: none !important;\n          box-sizing: border-box !important;\n          width: 18px !important;\n          height: 18px !important;\n          min-width: 18px !important;\n          min-height: 18px !important;\n          padding: 0 !important;\n          margin: 0 8px 0 0 !important;\n          border-radius: 50% !important;\n          border: 1.5px solid ${t.border} !important;\n          background-color: ${t.inputBg} !important;\n          box-shadow: none !important;\n          position: relative !important;\n          cursor: pointer !important;\n          flex-shrink: 0 !important;\n          vertical-align: middle !important;\n          transition: all 0.2s ease !important;\n        }\n\n        html body :is(${S_POPUP}) input[type=\"radio\"]:hover {\n          border-color: ${t.accent} !important;\n          box-shadow: 0 0 0 3px ${t.accent}22 !important;\n        }\n\n        html body :is(${S_POPUP}) input[type=\"radio\"]:checked {\n          border-color: ${t.accent} !important;\n        }\n\n        html body :is(${S_POPUP}) input[type=\"radio\"]:checked::after {\n          content: '' !important;\n          position: absolute !important;\n          width: 10px !important;\n          height: 10px !important;\n          border-radius: 50% !important;\n          background: ${t.accent} !important;\n          top: 50% !important;\n          left: 50% !important;\n          transform: translate(-50%, -50%) !important;\n        }\n\n        /* ========== Worldbook entry list  ========== */\n        html body :is(${S_POPUP}) .qrf_worldbook_entry_list,\n        html body :is(${S_POPUP}) [class*=\"worldbook-entry-list\"] {\n          background-color: ${t.btnBg} !important;\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          border-radius: 8px !important;\n        }\n\n        html body :is(${S_POPUP}) .qrf_worldbook_entry_list :is(label, span, div) {\n          color: ${t.textMain} !important;\n        }\n\n        /* ========== Plot prompt segment ========== */\n        html body :is(${S_POPUP}) :is(textarea.plot-prompt-segment-content, .plot-prompt-segment-content) {\n          background-color: ${t.inputBg} !important;\n          background: ${t.inputBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n        }\n\n        html body :is(${S_POPUP}) .plot-prompt-segment {\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          border-radius: 8px !important;\n        }\n\n        /* ==========  ========== */\n        html body :is(${S_POPUP}) #acu-tab-plot .acu-card > div:first-child {\n          display: flex !important;\n          align-items: flex-start !important;\n          justify-content: space-between !important;\n          gap: 14px !important;\n          flex-wrap: wrap !important;\n        }\n\n        html body :is(${S_POPUP}) #acu-tab-plot .acu-card > div:first-child > div:first-child {\n          flex: 1 1 360px !important;\n          min-width: 0 !important;\n        }\n\n        html body :is(${S_POPUP}) #acu-tab-plot .acu-card > div:first-child > div:first-child > p.notes {\n          display: block !important;\n          margin: 6px 0 0 0 !important;\n          padding: 0 !important;\n          border: 0 !important;\n          background: transparent !important;\n          box-shadow: none !important;\n          color: ${t.textSub} !important;\n          font-size: 13px !important;\n          line-height: 1.45 !important;\n          word-break: normal !important;\n        }\n\n        html body :is(${S_POPUP}) #acu-tab-plot .acu-card > div:first-child > div:nth-child(2) {\n          display: inline-flex !important;\n          align-items: center !important;\n          gap: 8px !important;\n          flex: 0 0 auto !important;\n          white-space: nowrap !important;\n        }\n\n        html body :is(${S_POPUP}) :is(button[id$=\"-plot-start-loop-btn\"], button[id$=\"-plot-stop-loop-btn\"]) {\n          writing-mode: horizontal-tb !important;\n          text-orientation: mixed !important;\n          white-space: nowrap !important;\n          word-break: keep-all !important;\n          min-width: 148px !important;\n          width: auto !important;\n          max-width: 100% !important;\n          padding: 12px 22px !important;\n          display: inline-flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          gap: 8px !important;\n        }\n\n        html body :is(${S_POPUP}) :is(button[id$=\"-plot-start-loop-btn\"], button[id$=\"-plot-stop-loop-btn\"]) i {\n          flex-shrink: 0 !important;\n        }\n\n        /* ========== Toggle switch ========== */\n        /*  checkbox  */\n        html body :is(${S_POPUP}) .toggle-switch input[type=\"checkbox\"] {\n          -webkit-appearance: auto !important;\n          appearance: auto !important;\n          background: transparent !important;\n          border: 0 !important;\n          box-shadow: none !important;\n          width: 0 !important;\n          height: 0 !important;\n          min-width: 0 !important;\n          min-height: 0 !important;\n          opacity: 0 !important;\n          margin: 0 !important;\n        }\n\n        /*  */\n        html body :is(${S_POPUP}) span[style*=\"lightgreen\"] {\n          color: ${t.accent} !important;\n        }\n\n        /* Toggle switch  */\n        html body :is(${S_POPUP}) .toggle-switch .slider {\n          background-color: ${t.inputBg} !important;\n          background: ${t.inputBg} !important;\n          border: 1.5px solid ${t.border} !important;\n          border-radius: 20px !important;\n          transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;\n        }\n\n        html body :is(${S_POPUP}) .toggle-switch .slider:before {\n          background-color: ${t.btnActiveText} !important;\n          border: 1px solid ${t.border} !important;\n          transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;\n        }\n\n        html body :is(${S_POPUP}) .toggle-switch input:checked + .slider {\n          background-color: ${t.btnActiveBg} !important;\n          background: ${t.btnActiveBg} !important;\n          border-color: ${t.btnActiveBg} !important;\n        }\n\n        html body :is(${S_POPUP}) .toggle-switch input:checked + .slider:before {\n          background-color: ${t.btnActiveText} !important;\n          border-color: ${t.btnActiveText} !important;\n        }\n\n        /* ========== Prompt Segment Toolbar ========== */\n        html body :is(${S_POPUP}) .prompt-segment {\n          background-color: ${t.bgPanel} !important;\n          border: 1px solid ${t.border} !important;\n          color: ${t.textMain} !important;\n          border-radius: 8px !important;\n        }\n\n        html body :is(${S_POPUP}) .prompt-segment-toolbar {\n          background-color: transparent !important;\n          color: ${t.textMain} !important;\n        }\n\n        html body :is(${S_POPUP}) .prompt-segment-toolbar :is(.prompt-segment-role, .prompt-segment-main-slot, .prompt-segment-delete-btn) {\n          background-color: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          border-radius: 6px !important;\n          transition: all 0.2s ease !important;\n        }\n\n        html body :is(${S_POPUP}) .prompt-segment-toolbar :is(.prompt-segment-role, .prompt-segment-main-slot, .prompt-segment-delete-btn):hover {\n          background-color: ${t.btnHover} !important;\n        }\n\n        /* ========== Tabs Navigation  ========== */\n        html body :is(${S_POPUP_MAIN}) .acu-tabs-nav {\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          color: ${t.textMain} !important;\n          border-bottom: 1px solid ${t.border} !important;\n          margin: 0 !important;\n          position: sticky !important;\n          top: 0 !important;\n          z-index: 32011 !important;\n          isolation: isolate !important;\n        }\n\n        html body :is(${S_POPUP_MAIN}) .acu-nav-section-title {\n          color: ${t.textSub} !important;\n          font-size: 11px !important;\n          text-transform: uppercase !important;\n          letter-spacing: 0.5px !important;\n          font-weight: 600 !important;\n        }\n\n        /* Tab Button (default state) */\n        html body :is(${S_POPUP_MAIN}) .acu-tab-button {\n          background-color: transparent !important;\n          background: transparent !important;\n          color: ${t.textSub} !important;\n          border: 1px solid transparent !important;\n          border-radius: 8px !important;\n          padding: 8px 14px !important;\n          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\n        }\n\n        /* Tab Button (hover) */\n        html body :is(${S_POPUP_MAIN}) .acu-tab-button:hover {\n          background-color: ${t.btnBg} !important;\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          transform: translateY(-1px) !important;\n        }\n\n        /* Tab Button (active state) */\n        html body :is(${S_POPUP_MAIN}) .acu-tab-button.active {\n          background-color: ${t.btnActiveBg} !important;\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          border-color: ${t.btnActiveBg} !important;\n          box-shadow: 0 2px 8px ${t.accent}33 !important;\n        }\n\n        /* ==========  ========== */\n        /* Header -  */\n        #acu-visualizer-content .acu-vis-header {\n          background: linear-gradient(135deg, ${t.bgNav} 0%, ${t.bgPanel} 100%) !important;\n          border-bottom: 1px solid ${t.border} !important;\n          color: ${t.textMain} !important;\n          position: relative !important;\n        }\n\n        /* Header  */\n        #acu-visualizer-content .acu-vis-header::after {\n          content: '' !important;\n          position: absolute !important;\n          bottom: 0 !important;\n          left: 50% !important;\n          transform: translateX(-50%) !important;\n          width: 40% !important;\n          height: 1px !important;\n          background: linear-gradient(90deg, transparent, ${t.accent}44, transparent) !important;\n        }\n\n        /* Content Area */\n        #acu-visualizer-content .acu-vis-content {\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n        }\n\n        /* Sidebar -  */\n        #acu-visualizer-content .acu-vis-sidebar {\n          background-color: ${t.bgNav} !important;\n          background: ${t.bgNav} !important;\n          border-right: 1px solid ${t.border} !important;\n          box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05) !important;\n        }\n\n        /* Main Section */\n        #acu-visualizer-content .acu-vis-main {\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          color: ${t.textMain} !important;\n        }\n\n        /* Title & Actions */\n        #acu-visualizer-content .acu-vis-title {\n          color: ${t.textMain} !important;\n          font-weight: 600 !important;\n        }\n\n        #acu-visualizer-content .acu-vis-actions {\n          color: ${t.textSub} !important;\n        }\n\n        /*  -  */\n        /* Card Grid Layout -  */\n        #acu-visualizer-content .acu-card-grid {\n          display: grid !important;\n          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)) !important;\n          gap: 20px !important;\n          padding: 20px !important;\n        }\n\n        /* Data Card Container -  */\n        #acu-visualizer-content .acu-data-card {\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          border: 1px solid ${t.border} !important;\n          border-radius: 12px !important;\n          overflow: visible !important;\n          overflow-y: auto !important;\n          max-height: 70vh !important;\n          display: flex !important;\n          flex-direction: column !important;\n          transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;\n          box-shadow: \n            0 2px 8px rgba(0, 0, 0, 0.08),\n            0 1px 2px rgba(0, 0, 0, 0.04) !important;\n          position: relative !important;\n        }\n\n        /*  */\n        #acu-visualizer-content .acu-data-card::before {\n          content: '' !important;\n          position: absolute !important;\n          top: 12px !important;\n          bottom: 12px !important;\n          left: 0 !important;\n          width: 3px !important;\n          background: ${t.accent} !important;\n          border-radius: 0 3px 3px 0 !important;\n          opacity: 0 !important;\n          transition: opacity 0.25s ease !important;\n        }\n\n        /*  */\n        #acu-visualizer-content .acu-data-card:hover {\n          transform: translateY(-6px) !important;\n          box-shadow: \n            0 12px 28px rgba(0, 0, 0, 0.15),\n            0 4px 8px rgba(0, 0, 0, 0.08),\n            0 0 0 1px ${t.accent}22 !important;\n          border-color: ${t.accent}66 !important;\n        }\n\n        /*  */\n        #acu-visualizer-content .acu-data-card:hover::before {\n          opacity: 1 !important;\n        }\n\n        /* Add Row Card -  */\n        #acu-visualizer-content #acu-vis-add-row,\n        #acu-visualizer-content .acu-data-card#acu-vis-add-row {\n          background: ${t.bgPanel} !important;\n          background-color: ${t.bgPanel} !important;\n          border: 2px dashed ${t.accent}66 !important;\n          border-color: ${t.accent}66 !important;\n          display: flex !important;\n          flex-direction: column !important;\n          align-items: center !important;\n          justify-content: center !important;\n          gap: 6px !important;\n          min-height: 48px !important;\n          padding: 6px 12px !important;\n          cursor: pointer !important;\n          transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;\n        }\n\n        /*  */\n        #acu-visualizer-content #acu-vis-add-row::before {\n          display: none !important;\n        }\n\n        #acu-visualizer-content #acu-vis-add-row i,\n        #acu-visualizer-content #acu-vis-add-row i.fa-solid,\n        #acu-visualizer-content #acu-vis-add-row i.fa-plus,\n        #acu-visualizer-content .acu-data-card#acu-vis-add-row > i,\n        #acu-vis-add-row i[style] {\n          color: ${t.accent} !important;\n          font-size: 20px !important;\n          line-height: 1 !important;\n          transition: all 0.25s ease !important;\n        }\n\n        #acu-visualizer-content #acu-vis-add-row div,\n        #acu-visualizer-content .acu-data-card#acu-vis-add-row > div,\n        #acu-vis-add-row div[style] {\n          color: ${t.accent} !important;\n          font-size: 12px !important;\n          line-height: 1.2 !important;\n          font-weight: 650 !important;\n          transition: all 0.25s ease !important;\n        }\n\n        #acu-visualizer-content #acu-vis-add-row:hover {\n          background: ${t.btnBg} !important;\n          background-color: ${t.btnBg} !important;\n          border-color: ${t.accent} !important;\n          border-style: solid !important;\n          transform: translateY(-4px) !important;\n          box-shadow: 0 8px 20px ${t.accent}22 !important;\n        }\n\n        #acu-visualizer-content #acu-vis-add-row:hover i,\n        #acu-visualizer-content #acu-vis-add-row:hover div,\n        #acu-vis-add-row:hover i[style],\n        #acu-vis-add-row:hover div[style] {\n          color: ${t.btnActiveBg} !important;\n          transform: scale(1.2) !important;\n        }\n\n        /* Card Header -  */\n        #acu-visualizer-content .acu-card-header {\n          background: linear-gradient(135deg, ${t.btnActiveBg} 0%, ${t.accent} 100%) !important;\n          background-color: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          padding: 14px 18px !important;\n          font-weight: 600 !important;\n          font-size: 14px !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: space-between !important;\n          border-bottom: none !important;\n          border-radius: 12px 12px 0 0 !important;\n          position: relative !important;\n        }\n\n        /* Card Header  */\n        #acu-visualizer-content .acu-card-header::after {\n          content: '' !important;\n          position: absolute !important;\n          bottom: 0 !important;\n          left: 0 !important;\n          right: 0 !important;\n          height: 1px !important;\n          background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent) !important;\n        }\n\n        /* Card Body -  */\n        #acu-visualizer-content .acu-card-body {\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          padding: 18px !important;\n          flex: 1 !important;\n          color: ${t.textMain} !important;\n          font-size: 14px !important;\n          line-height: 1.6 !important;\n          border-radius: 0 0 12px 12px !important;\n        }\n        /*  -  */\n        /* Lock Buttons -  */\n        #acu-visualizer-content [class*=\"acu-lock\"],\n        #acu-visualizer-content [class*=\"acu-vis-lock\"] {\n          background: ${t.btnBg} !important;\n          color: ${t.textSub} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 4px 6px !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n          /*  -  */\n          min-width: unset !important;\n          min-height: unset !important;\n          width: auto !important;\n          height: auto !important;\n          font-size: 12px !important;\n          line-height: 1 !important;\n          border-radius: 4px !important;\n          flex-shrink: 0 !important;\n        }\n\n        #acu-visualizer-content [class*=\"acu-lock\"]:hover,\n        #acu-visualizer-content [class*=\"acu-vis-lock\"]:hover {\n          background: ${t.btnHover} !important;\n          color: ${t.textMain} !important;\n        }\n\n        /* Delete Buttons (Red warning) */\n        #acu-visualizer-content .acu-vis-del-row,\n        #acu-visualizer-content .acu-vis-del-table-btn {\n          background: ${t.btnBg} !important;\n          color: ${t.textSub} !important;\n          border: 1px solid ${t.border} !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n        }\n\n        #acu-visualizer-content .acu-vis-del-row:hover,\n        #acu-visualizer-content .acu-vis-del-table-btn:hover {\n          background: #ff4444 !important;\n          color: #fff !important;\n          border-color: #cc0000 !important;\n        }\n\n        /* Add Table Button */\n        #acu-visualizer-content .acu-add-table-btn {\n          background: ${t.accent} !important;\n          color: #fff !important;\n          border: none !important;\n          padding: 10px 16px !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n        }\n\n        #acu-visualizer-content .acu-add-table-btn:hover {\n          background: ${t.btnActiveBg} !important;\n        }\n\n        /*  -  */\n        #acu-visualizer-content .acu-vis-toolbar {\n          display: flex !important;\n          align-items: center !important;\n          justify-content: space-between !important;\n          padding: 8px 12px !important;\n          background: ${t.bgNav} !important;\n          border-bottom: 1px solid ${t.border} !important;\n          flex-shrink: 0 !important;\n          flex-wrap: wrap !important;\n          gap: 8px !important;\n        }\n\n        /*  -  */\n        /* Mode Switch Container */\n        #acu-visualizer-content .acu-mode-switch {\n          display: flex !important;\n          gap: 4px !important;\n          padding: 4px !important;\n          background: ${t.bgPanel} !important;\n          border-radius: 6px !important;\n          border: 1px solid ${t.border} !important;\n          flex-shrink: 0 !important;\n        }\n\n        /* Mode Button (default) */\n        #acu-visualizer-content .acu-mode-btn {\n          background: transparent !important;\n          color: ${t.textSub} !important;\n          border: 1px solid transparent !important;\n          padding: 6px 10px !important;\n          cursor: pointer !important;\n          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\n          border-radius: 4px !important;\n          font-size: 12px !important;\n          white-space: nowrap !important;\n          min-width: unset !important;\n          min-height: unset !important;\n        }\n\n        #acu-visualizer-content .acu-mode-btn:hover {\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          transform: translateY(-1px) !important;\n        }\n\n        #acu-visualizer-content .acu-mode-btn:active {\n          transform: translateY(0) scale(0.98) !important;\n        }\n\n        /* Mode Button (active) */\n        #acu-visualizer-content .acu-mode-btn.active {\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          border-color: ${t.btnActiveBg} !important;\n          box-shadow: 0 2px 8px ${t.accent}33 !important;\n        }\n\n        /*  */\n        #acu-visualizer-content .acu-vis-actions {\n          display: flex !important;\n          gap: 6px !important;\n          flex-wrap: wrap !important;\n          justify-content: flex-end !important;\n          flex-shrink: 1 !important;\n          min-width: 0 !important;\n        }\n\n        /* Primary Button */\n        #acu-visualizer-content .acu-btn-primary {\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          border: none !important;\n          padding: 6px 12px !important;\n          border-radius: 4px !important;\n          cursor: pointer !important;\n          font-weight: 600 !important;\n          font-size: 12px !important;\n          white-space: nowrap !important;\n          min-width: unset !important;\n          min-height: unset !important;\n          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\n          box-shadow: 0 2px 6px ${t.accent}33 !important;\n        }\n\n        #acu-visualizer-content .acu-btn-primary:hover {\n          filter: brightness(1.1) !important;\n          transform: translateY(-1px) !important;\n          box-shadow: 0 4px 12px ${t.accent}44 !important;\n        }\n\n        #acu-visualizer-content .acu-btn-primary:active {\n          transform: translateY(0) scale(0.98) !important;\n          box-shadow: 0 1px 4px ${t.accent}22 !important;\n        }\n\n        /* Secondary Button */\n        #acu-visualizer-content .acu-btn-secondary {\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 6px 12px !important;\n          border-radius: 4px !important;\n          cursor: pointer !important;\n          font-size: 12px !important;\n          white-space: nowrap !important;\n          min-width: unset !important;\n          min-height: unset !important;\n          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\n        }\n\n        #acu-visualizer-content .acu-btn-secondary:hover {\n          background: ${t.btnHover} !important;\n          transform: translateY(-1px) !important;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;\n        }\n\n        #acu-visualizer-content .acu-btn-secondary:active {\n          transform: translateY(0) scale(0.98) !important;\n        }\n        /*  -  */\n        /* Field Row */\n        #acu-visualizer-content .acu-field-row {\n          display: flex !important;\n          align-items: flex-start !important;\n          gap: 12px !important;\n          padding: 10px 0 !important;\n          border-bottom: 1px solid ${t.border} !important;\n          transition: background-color 0.2s ease !important;\n        }\n\n        #acu-visualizer-content .acu-field-row:last-child {\n          border-bottom: none !important;\n        }\n\n        /* Field Label - inline stylejustify-content:space-between */\n        #acu-visualizer-content .acu-field-label {\n          color: ${t.textSub} !important;\n          font-weight: 600 !important;\n          min-width: 140px !important;\n          max-width: 200px !important;\n          font-size: 13px !important;\n          padding-top: 8px !important;\n          user-select: none !important;\n          overflow: visible !important;\n          text-overflow: ellipsis !important;\n          white-space: nowrap !important;\n          /* inline style */\n          justify-content: flex-start !important;\n        }\n\n        /* Field Value Wrapper -  */\n        #acu-visualizer-content .acu-field-value-wrap {\n          flex: 1 1 0 !important;\n          min-width: 0 !important;\n          display: flex !important;\n          flex-direction: row !important;\n          align-items: flex-start !important;\n          gap: 8px !important;\n          width: 100% !important;\n        }\n\n        /*  -  */\n        #acu-visualizer-content .acu-field-value-wrap > .acu-lock-btn {\n          flex-shrink: 0 !important;\n          padding: 4px 6px !important;\n          font-size: 12px !important;\n          border-radius: 4px !important;\n          min-width: unset !important;\n          min-height: unset !important;\n          width: auto !important;\n          height: auto !important;\n        }\n\n        /* Field Value (editable) */\n        #acu-visualizer-content .acu-field-value {\n          background-color: ${t.inputBg} !important;\n          background: ${t.inputBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 8px 12px !important;\n          border-radius: 6px !important;\n          font-size: 14px !important;\n          min-height: 38px !important;\n          /*  */\n          flex: 1 1 0 !important;\n          min-width: 0 !important;\n          width: 100% !important;\n          box-sizing: border-box !important;\n          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\n          cursor: text !important;\n          line-height: 1.5 !important;\n          /*  */\n          white-space: pre-wrap !important;\n          word-wrap: break-word !important;\n          word-break: break-word !important;\n          overflow-wrap: break-word !important;\n        }\n\n        #acu-visualizer-content .acu-field-value:hover {\n          border-color: ${t.accent} !important;\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;\n        }\n\n        #acu-visualizer-content .acu-field-value:focus {\n          border-color: ${t.accent} !important;\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          outline: none !important;\n          box-shadow: 0 0 0 3px ${t.accent}33 !important;\n        }\n\n        /*  -  */\n        /* Panel Container */\n        #acu-visualizer-content .acu-config-panel {\n          background: ${t.bgPanel} !important;\n          padding: 20px !important;\n          border-radius: 8px !important;\n        }\n\n        /* Config Section */\n        #acu-visualizer-content .acu-config-section {\n          margin-bottom: 24px !important;\n        }\n\n        #acu-visualizer-content .acu-config-section h4 {\n          color: ${t.textMain} !important;\n          font-size: 16px !important;\n          font-weight: 600 !important;\n          margin-bottom: 12px !important;\n        }\n\n        /* Form Group */\n        #acu-visualizer-content .acu-form-group {\n          margin-bottom: 16px !important;\n        }\n\n        #acu-visualizer-content .acu-form-group label {\n          color: ${t.textSub} !important;\n          display: block !important;\n          margin-bottom: 6px !important;\n          font-weight: 500 !important;\n        }\n\n        /* Form Inputs */\n        #acu-visualizer-content .acu-form-input,\n        #acu-visualizer-content .acu-form-textarea {\n          background: ${t.inputBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 8px 12px !important;\n          border-radius: 6px !important;\n          width: 100% !important;\n          font-size: 14px !important;\n          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\n        }\n\n        #acu-visualizer-content .acu-form-input:hover,\n        #acu-visualizer-content .acu-form-textarea:hover {\n          border-color: ${t.accent}66 !important;\n        }\n\n        #acu-visualizer-content .acu-form-input:focus,\n        #acu-visualizer-content .acu-form-textarea:focus {\n          border-color: ${t.accent} !important;\n          outline: none !important;\n          box-shadow: 0 0 0 3px ${t.accent}22 !important;\n        }\n\n        #acu-visualizer-content .acu-form-textarea {\n          min-height: 80px !important;\n          resize: vertical !important;\n          line-height: 1.5 !important;\n        }\n\n        /* Hint Text */\n        #acu-visualizer-content .acu-hint {\n          color: ${t.textSub} !important;\n          font-size: 12px !important;\n          opacity: 0.7 !important;\n          margin-top: 4px !important;\n        }\n\n        /* ==========  -  ========== */\n        /*  */\n        #acu-visualizer-content .acu-vis-sidebar {\n          background: ${t.bgNav} !important;\n          border-right: 1px solid ${t.border} !important;\n          padding: 8px !important;\n          overflow-y: auto !important;\n        }\n\n        /* :  -  */\n        #acu-visualizer-content .acu-vis-sidebar button,\n        #acu-visualizer-content [class*=\"acu-table-nav-\"] button,\n        #acu-visualizer-content [class*=\"acu-vis-del-\"] {\n          min-width: unset !important;\n          min-height: unset !important;\n          width: auto !important;\n          height: auto !important;\n          padding: 4px 6px !important;\n          font-size: 12px !important;\n          line-height: 1 !important;\n          border-radius: 4px !important;\n          background: ${t.btnBg} !important;\n          color: ${t.textSub} !important;\n          border: 1px solid ${t.border} !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n          flex-shrink: 0 !important;\n        }\n\n        #acu-visualizer-content .acu-vis-sidebar button:hover,\n        #acu-visualizer-content [class*=\"acu-table-nav-\"] button:hover {\n          background: ${t.btnHover} !important;\n          color: ${t.textMain} !important;\n        }\n\n        /*  */\n        #acu-visualizer-content [class*=\"acu-vis-del-\"]:hover {\n          background: #ff4444 !important;\n          color: #fff !important;\n          border-color: #cc0000 !important;\n        }\n\n        /* Table Nav Item (default) */\n        #acu-visualizer-content .acu-table-nav-item {\n          background: transparent !important;\n          color: ${t.textSub} !important;\n          border: 1px solid transparent !important;\n          padding: 6px 8px !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: space-between !important;\n          gap: 6px !important;\n          border-radius: 6px !important;\n          margin-bottom: 2px !important;\n          font-size: 16px !important;\n        }\n\n        /* Table Nav Item (hover) */\n        #acu-visualizer-content .acu-table-nav-item:hover {\n          background: ${t.btnHover} !important;\n          color: ${t.textMain} !important;\n        }\n\n        /* Table Nav Item (active) */\n        #acu-visualizer-content .acu-table-nav-item.active {\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          border-color: ${t.btnActiveBg} !important;\n        }\n\n        /*  */\n        #acu-visualizer-content .acu-table-nav-content {\n          display: flex !important;\n          align-items: center !important;\n          gap: 6px !important;\n          flex: 1 !important;\n          min-width: 0 !important;\n          overflow: hidden !important;\n        }\n\n        /*  */\n        #acu-visualizer-content .acu-table-nav-actions {\n          display: flex !important;\n          align-items: center !important;\n          gap: 4px !important;\n          flex-shrink: 0 !important;\n        }\n\n        /* Table Name */\n        #acu-visualizer-content .acu-table-name {\n          font-weight: 500 !important;\n          flex: 1 !important;\n          overflow: hidden !important;\n          text-overflow: ellipsis !important;\n          white-space: nowrap !important;\n        }\n\n        /* Table Index */\n        #acu-visualizer-content .acu-table-index {\n          font-size: 10px !important;\n          color: ${t.textSub} !important;\n          opacity: 0.7 !important;\n        }\n\n        /*  */\n        #acu-visualizer-content .acu-add-table-btn {\n          width: 100% !important;\n          margin-top: 8px !important;\n          padding: 8px 12px !important;\n          background: ${t.accent} !important;\n          color: ${t.btnActiveText} !important;\n          border: none !important;\n          border-radius: 6px !important;\n          font-size: 12px !important;\n          cursor: pointer !important;\n          min-width: unset !important;\n          min-height: unset !important;\n        }\n\n        #acu-visualizer-content .acu-add-table-btn:hover {\n          filter: brightness(1.1) !important;\n        }\n\n        /*  -  */\n        .acu-table-order-btn,\n        .acu-vis-del-table-btn,\n        .acu-vis-sidebar .acu-table-order-btn,\n        .acu-vis-sidebar .acu-vis-del-table-btn,\n        .acu-table-nav-actions .acu-table-order-btn,\n        .acu-table-nav-actions .acu-vis-del-table-btn,\n        #acu-visualizer-content .acu-table-order-btn,\n        #acu-visualizer-content .acu-vis-del-table-btn {\n          background: transparent !important;\n          background-color: transparent !important;\n          border: none !important;\n          color: ${t.textSub} !important;\n          opacity: 0.7 !important;\n        }\n\n        .acu-table-order-btn:hover,\n        .acu-vis-del-table-btn:hover,\n        .acu-vis-sidebar .acu-table-order-btn:hover,\n        .acu-vis-sidebar .acu-vis-del-table-btn:hover,\n        .acu-table-nav-actions .acu-table-order-btn:hover,\n        .acu-table-nav-actions .acu-vis-del-table-btn:hover,\n        #acu-visualizer-content .acu-table-order-btn:hover,\n        #acu-visualizer-content .acu-vis-del-table-btn:hover {\n          background: ${t.btnHover} !important;\n          background-color: ${t.btnHover} !important;\n          color: ${t.textMain} !important;\n          opacity: 1 !important;\n        }\n\n        .acu-table-order-btn:disabled,\n        #acu-visualizer-content .acu-table-order-btn:disabled {\n          opacity: 0.3 !important;\n          cursor: not-allowed !important;\n        }\n\n        /*  -  */\n        /* Scrollbar Styles */\n        #acu-visualizer-content ::-webkit-scrollbar {\n          width: 8px !important;\n          height: 8px !important;\n        }\n\n        #acu-visualizer-content ::-webkit-scrollbar-track {\n          background: ${t.bgNav} !important;\n          border-radius: 4px !important;\n        }\n\n        #acu-visualizer-content ::-webkit-scrollbar-thumb {\n          background: ${t.btnBg} !important;\n          border-radius: 4px !important;\n          border: 2px solid ${t.bgNav} !important;\n        }\n\n        #acu-visualizer-content ::-webkit-scrollbar-thumb:hover {\n          background: ${t.btnHover} !important;\n        }\n\n        /* Responsive Styles */\n        @media (max-width: 768px) {\n          /*  -  */\n          #acu-visualizer-content .acu-vis-toolbar {\n            flex-direction: column !important;\n            align-items: stretch !important;\n            padding: 6px !important;\n            gap: 4px !important;\n          }\n\n          #acu-visualizer-content .acu-mode-switch {\n            width: 100% !important;\n            justify-content: center !important;\n          }\n\n          #acu-visualizer-content .acu-mode-btn {\n            flex: 1 !important;\n            text-align: center !important;\n            padding: 6px 8px !important;\n            min-height: 32px !important;\n          }\n\n          #acu-visualizer-content .acu-vis-actions {\n            width: 100% !important;\n            justify-content: center !important;\n          }\n\n          #acu-visualizer-content .acu-btn-primary,\n          #acu-visualizer-content .acu-btn-secondary {\n            flex: 1 !important;\n            text-align: center !important;\n            padding: 6px 10px !important;\n            min-height: 32px !important;\n          }\n\n          #acu-visualizer-content .acu-vis-header {\n            flex-direction: column !important;\n            height: auto !important;\n            padding: 10px !important;\n          }\n\n          #acu-visualizer-content .acu-vis-sidebar {\n            width: 100% !important;\n            border-right: none !important;\n            border-bottom: 1px solid ${t.border} !important;\n            max-height: 200px !important;\n            overflow-y: auto !important;\n          }\n\n          #acu-visualizer-content .acu-vis-content {\n            flex-direction: column !important;\n          }\n\n          #acu-visualizer-content .acu-card-grid {\n            grid-template-columns: 1fr !important;\n            padding: 12px !important;\n            gap: 16px !important;\n          }\n\n          /*  */\n          #acu-visualizer-content .acu-data-card {\n            border-radius: 10px !important;\n          }\n\n          #acu-visualizer-content .acu-data-card:hover {\n            transform: none !important;\n          }\n\n          #acu-visualizer-content .acu-data-card::before {\n            display: none !important;\n          }\n\n          #acu-visualizer-content .acu-card-header {\n            padding: 12px 14px !important;\n            border-radius: 10px 10px 0 0 !important;\n          }\n\n          #acu-visualizer-content .acu-card-body {\n            padding: 14px !important;\n            border-radius: 0 0 10px 10px !important;\n          }\n\n          #acu-visualizer-content .acu-field-row {\n            flex-direction: column !important;\n            align-items: stretch !important;\n          }\n\n          #acu-visualizer-content .acu-field-label {\n            min-width: unset !important;\n            width: 100% !important;\n            padding-bottom: 4px !important;\n          }\n\n          #acu-visualizer-content .acu-vis-actions {\n            justify-content: center !important;\n            width: 100% !important;\n            margin-top: 10px !important;\n          }\n\n          /*  */\n          html body .auto-card-updater-popup button,\n          html body .auto-card-updater-popup .button {\n            min-height: 44px !important;\n            padding: 10px 16px !important;\n          }\n\n          /*  transform  */\n          html body .auto-card-updater-popup button:hover,\n          html body .auto-card-updater-popup .button:hover {\n            transform: none !important;\n          }\n\n          html body .auto-card-updater-popup button:active,\n          html body .auto-card-updater-popup .button:active {\n            transform: scale(0.98) !important;\n          }\n\n          html body :is(${S_POPUP}) [id$=\"-data-isolation-input-area\"] > div {\n            flex-direction: column !important;\n          }\n\n          html body :is(${S_POPUP}) button[id$=\"-data-isolation-save\"].primary {\n            width: 100% !important;\n          }\n\n          html body :is(${S_POPUP}) button[id$=\"-data-isolation-history-toggle\"] {\n            width: 36px !important;\n            min-width: 36px !important;\n            height: 36px !important;\n            min-height: 36px !important;\n          }\n\n          html body :is(${S_POPUP}) button[id$=\"-data-isolation-delete-entries\"] {\n            width: 100% !important;\n            min-width: 0 !important;\n          }\n\n          html body :is(${S_POPUP}) .acu-template-preset-toolbar .acu-template-preset-left {\n            grid-template-columns: 1fr !important;\n          }\n\n          html body :is(${S_POPUP}) .acu-template-preset-toolbar .acu-template-preset-actions {\n            grid-template-columns: 1fr 1fr !important;\n          }\n\n          html body :is(${S_POPUP}) .acu-mini-btn {\n            width: 100% !important;\n          }\n\n          html body :is(${S_POPUP}) :is(button[id$=\"-plot-start-loop-btn\"], button[id$=\"-plot-stop-loop-btn\"]) {\n            width: 100% !important;\n          }\n        }\n\n        /*  -  */\n        /* Column List */\n        #acu-visualizer-content .acu-col-list {\n          display: flex !important;\n          flex-direction: column !important;\n          gap: 8px !important;\n          padding: 8px 0 !important;\n        }\n\n        /* Column Item */\n        #acu-visualizer-content .acu-col-item {\n          background: ${t.btnBg} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 8px 12px !important;\n          border-radius: 6px !important;\n          display: flex !important;\n          align-items: center !important;\n          gap: 8px !important;\n          transition: all 0.2s ease !important;\n        }\n\n        #acu-visualizer-content .acu-col-item:hover {\n          background: ${t.btnHover} !important;\n        }\n\n        /* Column Input */\n        #acu-visualizer-content .acu-col-input {\n          background-color: ${t.inputBg} !important;\n          background: ${t.inputBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 6px 10px !important;\n          border-radius: 4px !important;\n          flex: 1 !important;\n          font-size: 13px !important;\n        }\n\n        #acu-visualizer-content .acu-col-input:focus {\n          border-color: ${t.accent} !important;\n          outline: none !important;\n        }\n\n        /* Column Delete Button */\n        #acu-visualizer-content .acu-col-btn {\n          background: ${t.btnBg} !important;\n          color: ${t.textSub} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 4px 8px !important;\n          border-radius: 4px !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n        }\n\n        #acu-visualizer-content .acu-col-btn:hover {\n          background: #ff4444 !important;\n          color: #fff !important;\n          border-color: #cc0000 !important;\n        }\n      </style>\n    `;\n\n    for (const $ of targets) {\n      $('#dice-db-theme-sync').remove();\n      $('head').append(css);\n    }\n  } catch (e) {\n    // \n  }\n}\n\nconst DB_TOAST_MUTE_STYLE_ID = 'dice-db-toast-mute';\n\nconst collectDatabaseToastDocuments = (): Document[] => {\n  const docs: Document[] = [];\n  const tryAddDoc = (w: Window | null | undefined) => {\n    try {\n      const doc = w?.document;\n      if (doc && !docs.includes(doc)) docs.push(doc);\n    } catch {\n      return;\n    }\n  };\n\n  tryAddDoc(window);\n  tryAddDoc(window.parent);\n  tryAddDoc(window.top);\n  return docs;\n};\n\nexport function setDatabaseToastMute(enabled: boolean) {\n  try {\n    const css = `\n#toast-container .acu-toast,\n.toast.acu-toast,\n.acu-toast.toast {\n  display: none !important;\n}\n`;\n    const docs = collectDatabaseToastDocuments();\n    for (const doc of docs) {\n      const existing = doc.getElementById(DB_TOAST_MUTE_STYLE_ID);\n      if (enabled) {\n        if (!existing) {\n          const style = doc.createElement('style');\n          style.id = DB_TOAST_MUTE_STYLE_ID;\n          style.textContent = css;\n          (doc.head || doc.documentElement).appendChild(style);\n        }\n        doc.querySelectorAll('.acu-toast').forEach(node => node.remove());\n      } else if (existing) {\n        existing.remove();\n      }\n    }\n  } catch {\n    return;\n  }\n}\n","// @ts-nocheck\nimport { ELEMENT_EMOJI_MAP, LOCATION_EMOJI_MAP, RELATION_ICON_MAP } from './emoji-maps';\nimport { MAIN_STYLES } from './styles';\nimport { injectDatabaseStyles, setDatabaseToastMute } from './database-ui-override';\nimport { RollResult, CustomFieldConfig, DerivedVarSpec, DiceExprPatch } from './types';\n\n(function () {\n  'use strict';\n\n  const SCRIPT_ID = 'acu_visualizer_ui_v19_6_ai_overlay';\n\n  // ========================================\n  //  ()\n  const PRIMARY_KEYS = {\n    : null,\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n  };\n\n  //  = ,  = \n  const isNpcTableName = (name: string): boolean => name === '' || name === '';\n\n  /**\n   * \n   * @param tableName \n   * @param row \n   * @param headers \n   */\n  function getRowKey(tableName, row, headers) {\n    const pkField = PRIMARY_KEYS[tableName];\n    if (pkField === null) return '_row_0';\n\n    let fieldIndex = 1;\n    if (pkField) {\n      const idx = headers.indexOf(pkField);\n      if (idx !== -1) fieldIndex = idx;\n    }\n\n    if (!row[fieldIndex]) return null;\n    return `${pkField || headers[fieldIndex]}=${row[fieldIndex]}`;\n  }\n\n  // ========================================\n  // - (LockManager -> GodDB API)\n  // ========================================\n\n  /**\n   * -API\n   * @returns APInull\n   */\n  function getDbLockAPI(): any {\n    // iframe\n    let topWindow: Window = window;\n    try {\n      while (topWindow.parent && topWindow.parent !== topWindow) {\n        topWindow = topWindow.parent;\n      }\n    } catch (e) {\n      // parentwindow\n    }\n\n    // \n    const api = (topWindow as any).AutoCardUpdaterAPI || (window as any).AutoCardUpdaterAPI;\n    return api || null;\n  }\n\n  /**\n   * sheetKey\n   * @param tableName - \"\"\n   * @returns sheetKey\"sheet_0\"null\n   */\n  function getSheetKeyByTableName(tableName: string): string | null {\n    const api = getDbLockAPI();\n    if (!api || typeof api.exportTableAsJson !== 'function') return null;\n\n    try {\n      const data = api.exportTableAsJson() as Record<string, { name: string; content: (string | number | null)[][] }>;\n      if (!data) return null;\n\n      for (const key in data) {\n        if (key.startsWith('sheet_') && data[key]?.name === tableName) {\n          return key;\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]getSheetKeyByTableName :', e);\n    }\n    return null;\n  }\n\n  /**\n   * \n   * @param sheetKey - \n   * @param tableName - \n   * @param primaryKeyValue -  \"=\" \n   * @returns 0null\n   */\n  function findRowIndexByPrimaryKey(sheetKey: string, tableName: string, primaryKeyValue: string): number | null {\n    const api = getDbLockAPI();\n    if (!api || typeof api.exportTableAsJson !== 'function') return null;\n\n    try {\n      const data = api.exportTableAsJson() as Record<string, { name: string; content: (string | number | null)[][] }>;\n      const sheet = data?.[sheetKey];\n      if (!sheet || !sheet.content || !Array.isArray(sheet.content) || sheet.content.length < 2) {\n        return null;\n      }\n\n      const headers = sheet.content[0] as string[];\n      const pkField = PRIMARY_KEYS[tableName as keyof typeof PRIMARY_KEYS];\n\n      // \n      if (pkField === null) {\n        return primaryKeyValue === '_row_0' ? 0 : null;\n      }\n\n      if (!pkField) return null;\n\n      const pkIndex = headers.indexOf(pkField);\n      if (pkIndex === -1) {\n        console.warn(`[DICE]findRowIndexByPrimaryKey:  ${tableName}  ${pkField}`);\n        return null;\n      }\n\n      //  primaryKeyValue\n      // getRowKey() : \"=\" ->  \"\"\n      let actualValue = primaryKeyValue;\n      const eqIdx = primaryKeyValue.indexOf('=');\n      if (eqIdx !== -1) {\n        actualValue = primaryKeyValue.substring(eqIdx + 1);\n      }\n\n      // 1\n      for (let i = 1; i < sheet.content.length; i++) {\n        const row = sheet.content[i];\n        if (row && String(row[pkIndex]) === String(actualValue)) {\n          // - rowIndex  0  content[1]\n          return i - 1;\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]findRowIndexByPrimaryKey :', e);\n    }\n    return null;\n  }\n\n  /**\n   * \n   * @param characterName - \n   * @param attrName - \n   * @param operation - : 'add' | 'subtract' | 'set'\n   * @param value - \n   * @param options -  { initValue?: number, min?: number, max?: number }\n   * @returns Promise<{ success: boolean, oldValue: number, newValue: number, error?: string }>\n   */\n  async function safeUpdateAttribute(\n    characterName: string,\n    attrName: string,\n    operation: 'add' | 'subtract' | 'set',\n    value: number,\n    options?: { initValue?: number; min?: number; max?: number },\n  ): Promise<{ success: boolean; oldValue: number; newValue: number; error?: string }> {\n    console.info(`[DICE]safeUpdateAttribute: ${characterName}.${attrName} ${operation} ${value}`);\n\n    try {\n      // 1.  DbLockAPI\n      const api = getDbLockAPI();\n      if (!api || typeof api.exportTableAsJson !== 'function') {\n        const error = '- API ';\n        console.error(`[DICE]safeUpdateAttribute: ${error}`);\n        return { success: false, oldValue: 0, newValue: 0, error };\n      }\n\n      // 2. \n      const data = api.exportTableAsJson() as Record<string, { name: string; content: (string | number | null)[][] }>;\n      if (!data) {\n        const error = '';\n        console.error(`[DICE]safeUpdateAttribute: ${error}`);\n        return { success: false, oldValue: 0, newValue: 0, error };\n      }\n\n      // 3. \n      let targetSheetKey: string | null = null;\n      let targetRowIndex: number | null = null;\n      let targetColIndex: number = -1;\n\n      // \n      for (const sheetKey in data) {\n        if (!sheetKey.startsWith('sheet_')) continue;\n        const sheet = data[sheetKey];\n        if (!sheet || !sheet.content || !Array.isArray(sheet.content) || sheet.content.length < 2) continue;\n\n        const headers = sheet.content[0] as string[];\n        const pkField = PRIMARY_KEYS[sheet.name as keyof typeof PRIMARY_KEYS];\n\n        // \n        if (pkField === undefined) continue;\n\n        // \n        if (pkField === null) {\n          if (characterName === '_row_0') {\n            targetSheetKey = sheetKey;\n            targetRowIndex = 0;\n            targetColIndex = headers.indexOf(attrName);\n            break;\n          }\n          continue;\n        }\n\n        // \n        const pkIndex = headers.indexOf(pkField);\n        if (pkIndex === -1) continue;\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && String(row[pkIndex]) === String(characterName)) {\n            targetSheetKey = sheetKey;\n            targetRowIndex = i - 1; // - rowIndex  0 \n            targetColIndex = headers.indexOf(attrName);\n            break;\n          }\n        }\n\n        if (targetSheetKey) break;\n      }\n\n      if (!targetSheetKey || targetRowIndex === null) {\n        const error = `: ${characterName}`;\n        console.warn(`[DICE]safeUpdateAttribute: ${error}`);\n        return { success: false, oldValue: 0, newValue: 0, error };\n      }\n\n      if (targetColIndex === -1) {\n        const error = ` ${characterName} : ${attrName}`;\n        console.warn(`[DICE]safeUpdateAttribute: ${error}`);\n        return { success: false, oldValue: 0, newValue: 0, error };\n      }\n\n      // 4. \n      const lockState = api.getTableLockState?.(targetSheetKey);\n      if (lockState) {\n        // \n        const isRowLocked = lockState.rows?.includes(targetRowIndex) ?? false;\n        if (isRowLocked) {\n          const error = ` ${characterName} `;\n          console.warn(`[DICE]safeUpdateAttribute: ${error}`);\n          return { success: false, oldValue: 0, newValue: 0, error };\n        }\n\n        // \n        // : targetColIndex - colIndex  -1\n        const cellKey = `${targetRowIndex}:${targetColIndex - 1}`;\n        const isCellLocked = lockState.cells?.includes(cellKey) ?? false;\n        if (isCellLocked) {\n          const error = ` ${characterName}.${attrName} `;\n          console.warn(`[DICE]safeUpdateAttribute: ${error}`);\n          return { success: false, oldValue: 0, newValue: 0, error };\n        }\n      }\n\n      // 5. \n      const sheet = data[targetSheetKey];\n      const currentValue = sheet.content[targetRowIndex + 1][targetColIndex]; // +1  content[0] \n      let oldValue: number;\n\n      if (currentValue === null || currentValue === undefined || currentValue === '') {\n        if (options?.initValue !== undefined) {\n          oldValue = options.initValue;\n          console.info(`[DICE]safeUpdateAttribute:  ${attrName}  ${oldValue}`);\n        } else {\n          const error = ` ${attrName}  initValue`;\n          console.warn(`[DICE]safeUpdateAttribute: ${error}`);\n          return { success: false, oldValue: 0, newValue: 0, error };\n        }\n      } else {\n        oldValue = typeof currentValue === 'number' ? currentValue : parseFloat(String(currentValue));\n        if (isNaN(oldValue)) {\n          const error = ` ${attrName}  \"${currentValue}\" `;\n          console.warn(`[DICE]safeUpdateAttribute: ${error}`);\n          return { success: false, oldValue: 0, newValue: 0, error };\n        }\n      }\n\n      // 6. \n      let newValue: number;\n      switch (operation) {\n        case 'add':\n          newValue = oldValue + value;\n          break;\n        case 'subtract':\n          newValue = oldValue - value;\n          break;\n        case 'set':\n          newValue = value;\n          break;\n        default:\n          const error = `: ${operation}`;\n          console.error(`[DICE]safeUpdateAttribute: ${error}`);\n          return { success: false, oldValue, newValue: oldValue, error };\n      }\n\n      // 7.  min/max \n      const min = options?.min ?? -Infinity;\n      const max = options?.max ?? Infinity;\n      newValue = Math.max(min, Math.min(max, newValue));\n\n      console.info(\n        `[DICE]safeUpdateAttribute: ${characterName}.${attrName} ${oldValue}  ${newValue} (${operation} ${value})`,\n      );\n\n      // 8. \n      sheet.content[targetRowIndex + 1][targetColIndex] = newValue;\n\n      // 9.  JSON.parse(JSON.stringify())  Proxy \n      const cleanData = JSON.parse(JSON.stringify(data));\n      const importResult = await api.importTableAsJson(cleanData);\n\n      if (importResult === false) {\n        const error = ' false';\n        console.error(`[DICE]safeUpdateAttribute: ${error}`);\n        return { success: false, oldValue, newValue, error };\n      }\n\n      console.info(`[DICE]safeUpdateAttribute:  ${characterName}.${attrName}`);\n      return { success: true, oldValue, newValue };\n    } catch (e) {\n      const error = `: ${e instanceof Error ? e.message : String(e)}`;\n      console.error(`[DICE]safeUpdateAttribute: ${error}`, e);\n      return { success: false, oldValue: 0, newValue: 0, error };\n    }\n  }\n\n  /**\n   * \n   *  MESSAGE_SENT \n   * @param pendingCtx \n   * @returns \n   */\n  async function executeEffects(pendingCtx: PendingEffectContext): Promise<EffectResult[]> {\n    const results: EffectResult[] = [];\n    const { preset, matchedOutcome, context } = pendingCtx;\n    const replayOperations: EffectReplayOperation[] = [];\n    const deferredSecondaryCallbacks: Array<() => void> = [];\n    const baseData = cachedRawData || getTableData();\n    if (!baseData) {\n      throw new Error('');\n    }\n    const transactionalData = JSON.parse(JSON.stringify(baseData));\n    const modifiedSheetKeys = new Set<string>();\n    const overrideMap = new Map<string, ComputedEffect>();\n    if (pendingCtx.effectOverrides && pendingCtx.effectOverrides.length > 0) {\n      pendingCtx.effectOverrides.forEach(item => {\n        overrideMap.set(item.effectId, item);\n      });\n    }\n\n    if (!matchedOutcome.effects || matchedOutcome.effects.length === 0) {\n      return results;\n    }\n\n    console.info(`[DICE] Executing ${matchedOutcome.effects.length} effects for outcome \"${matchedOutcome.name}\"`);\n\n    for (const effect of matchedOutcome.effects) {\n      // 1. \n      if (effect.condition) {\n        const condContext = {\n          $roll: context.roll,\n          $attr: context.attributeValue,\n          $mod: context.modifier,\n          $dc: context.dc,\n        };\n        const condResult = evaluateCondition(effect.condition, condContext);\n        if (!condResult.success || !condResult.value) {\n          console.info(`[DICE] Effect ${effect.id} skipped: condition \"${effect.condition}\" not met`);\n          continue;\n        }\n      }\n\n      // 2.  allowedTargets\n      if (preset.effectsConfig?.allowedTargets && preset.effectsConfig.allowedTargets.length > 0) {\n        if (!preset.effectsConfig.allowedTargets.includes(effect.target)) {\n          console.warn(`[DICE] Effect ${effect.id} blocked: target \"${effect.target}\" not in allowedTargets`);\n          continue;\n        }\n      }\n\n      // 3.  value\n      let finalValue = 0;\n      let formulaText = '';\n      let rolledValue: number | undefined;\n      const override = overrideMap.get(effect.id);\n      if (override) {\n        finalValue = Math.abs(override.computedValue);\n        formulaText = override.formula || String(effect.value || '0');\n        rolledValue = Number.isFinite(override.rolledValue) ? override.rolledValue : undefined;\n        console.info(\n          `[DICE] Effect ${effect.id}: use confirmed override \"${override.formula}\" => ${override.computedValue}`,\n        );\n      } else {\n        const parsedValue = parseEffectValueInput(effect.value, `Effect ${effect.id}`);\n        formulaText = parsedValue.formulaText;\n        finalValue = parsedValue.finalValue;\n        rolledValue = parsedValue.rolledValue;\n        if (parsedValue.valid) {\n          console.info(`[DICE] Effect ${effect.id}: rolled \"${formulaText}\" = ${finalValue}`);\n        }\n      }\n\n      // 4.  updateSingleAttribute \n      const aliasCandidates = [...(preset.effectsConfig?.allowedTargets || []), context.attributeName].filter(\n        (name, idx, arr) => Boolean(name) && arr.indexOf(name) === idx,\n      );\n\n      const updateResult = await updateSingleAttribute(\n        context.characterName,\n        effect.target,\n        effect.operation,\n        finalValue,\n        {\n          initValue: effect.initValue,\n          min: effect.min,\n          max: effect.max,\n          aliasCandidates,\n          skipSave: true,\n          dataOverride: transactionalData,\n        },\n      );\n      if (updateResult.modifiedSheetKey) modifiedSheetKeys.add(updateResult.modifiedSheetKey);\n\n      // 5. \n      const effectResult: EffectResult = {\n        effectId: effect.id,\n        success: updateResult.success,\n        oldValue: updateResult.oldValue,\n        newValue: updateResult.newValue,\n        error: updateResult.error,\n        target: updateResult.resolvedAttrName || effect.target,\n        level: 1,\n        triggerType: 'primary',\n        branchLabel: `L1/${matchedOutcome.name}`,\n        formulaText,\n        rolledValue,\n      };\n      results.push(effectResult);\n\n      if (updateResult.success) {\n        replayOperations.push({\n          characterName: context.characterName,\n          target: effect.target,\n          operation: effect.operation,\n          value: finalValue,\n          initValue: effect.initValue,\n          min: effect.min,\n          max: effect.max,\n          aliasCandidates,\n          resultRef: effectResult,\n        });\n      }\n\n      if (updateResult.success) {\n        console.info(\n          `[DICE] Effect executed: ${context.characterName}.${updateResult.resolvedAttrName || effect.target} ${effect.operation} ${finalValue} (${updateResult.oldValue}  ${updateResult.newValue})`,\n        );\n      } else {\n        console.error(`[DICE] Effect ${effect.id} failed: ${updateResult.error}`);\n      }\n    }\n\n    const secondaryResults = await executeSecondaryEffectsChain(\n      preset,\n      results,\n      {\n        characterName: context.characterName,\n        attributeName: context.attributeName,\n        attributeValue: context.attributeValue,\n      },\n      transactionalData,\n      modifiedSheetKeys,\n      replayOperations,\n      deferredSecondaryCallbacks,\n    );\n\n    const allResults = [...results, ...secondaryResults];\n    const hasFailure = allResults.some(r => !r.success);\n\n    // all-or-nothing:  transactionalData\n    if (hasFailure) {\n      return allResults.map(r =>\n        r.success\n          ? {\n              ...r,\n              success: false,\n              error: r.error || '',\n            }\n          : r,\n      );\n    }\n\n    // \n    return runInSaveQueue(async () => {\n      const latestData = cachedRawData || getTableData();\n      if (!latestData) {\n        return allResults.map(r =>\n          r.success\n            ? {\n                ...r,\n                success: false,\n                error: r.error || '',\n              }\n            : r,\n        );\n      }\n\n      const latestTransactionalData = JSON.parse(JSON.stringify(latestData));\n      const latestModifiedSheetKeys = new Set<string>();\n      for (const op of replayOperations) {\n        const replayResult = await updateSingleAttribute(op.characterName, op.target, op.operation, op.value, {\n          initValue: op.initValue,\n          min: op.min,\n          max: op.max,\n          aliasCandidates: op.aliasCandidates,\n          skipSave: true,\n          dataOverride: latestTransactionalData,\n        });\n\n        if (!replayResult.success) {\n          return allResults.map(r =>\n            r.success\n              ? {\n                  ...r,\n                  success: false,\n                  error: r.error || ` (${replayResult.error || 'unknown'})`,\n                }\n              : r,\n          );\n        }\n\n        if (replayResult.modifiedSheetKey) latestModifiedSheetKeys.add(replayResult.modifiedSheetKey);\n        op.resultRef.oldValue = replayResult.oldValue;\n        op.resultRef.newValue = replayResult.newValue;\n        op.resultRef.target = replayResult.resolvedAttrName || op.resultRef.target;\n        op.resultRef.error = undefined;\n      }\n\n      if (latestModifiedSheetKeys.size > 0) {\n        await performSaveDataOnly(latestTransactionalData, Array.from(latestModifiedSheetKeys));\n      }\n\n      deferredSecondaryCallbacks.forEach(run => run());\n\n      return allResults;\n    });\n  }\n\n  function parseEffectValueInput(\n    rawValue: unknown,\n    traceLabel: string,\n  ): {\n    formulaText: string;\n    finalValue: number;\n    rolledValue: number;\n    valid: boolean;\n  } {\n    const formulaText = String(rawValue ?? '').trim() || '0';\n    const rollResult = rollComplexDiceExpression(formulaText);\n    if (Number.isNaN(rollResult.total)) {\n      console.warn(`[DICE] ${traceLabel} : \"${formulaText}\" 0 `);\n      return {\n        formulaText,\n        finalValue: 0,\n        rolledValue: 0,\n        valid: false,\n      };\n    }\n\n    const value = Math.round(rollResult.total);\n    return {\n      formulaText,\n      finalValue: value,\n      rolledValue: value,\n      valid: true,\n    };\n  }\n\n  async function executeSecondaryEffectsChain(\n    preset: AdvancedDicePreset,\n    effectResults: EffectResult[],\n    context: { characterName: string; attributeName: string; attributeValue: number },\n    transactionalData?: Record<string, { name: string; content: (string | number | null)[][] }>,\n    modifiedSheetKeys?: Set<string>,\n    replayOperations?: EffectReplayOperation[],\n    deferredSecondaryCallbacks?: Array<() => void>,\n  ): Promise<EffectResult[]> {\n    const secondaryEffects = preset.secondaryEffects;\n    if (!secondaryEffects || secondaryEffects.length === 0) return [];\n\n    const clamp = (num: number, min: number, max: number): number => Math.max(min, Math.min(max, num));\n    const maxDepth = clamp(Number(preset.secondaryMaxDepth ?? 3), 1, 8);\n    const triggerCounts = new Map<string, number>();\n    const allGenerated: EffectResult[] = [];\n    const localDeferredCallbacks: Array<() => void> = [];\n    const callbackQueue = deferredSecondaryCallbacks || localDeferredCallbacks;\n    let currentLevelResults = effectResults.filter(r => r.success);\n\n    const buildFormulaContext = (): Record<string, number> => {\n      const currentAttrs = getFullAttributesForCharacter(context.characterName, transactionalData);\n      const formulaContext: Record<string, number> = {};\n      currentAttrs.forEach(attr => {\n        if (attr && typeof attr.name === 'string' && typeof attr.value === 'number' && !isNaN(attr.value)) {\n          formulaContext[attr.name] = attr.value;\n        }\n      });\n      return formulaContext;\n    };\n\n    const compare = (operator: SecondaryEffect['trigger']['operator'], left: number, right: number): boolean => {\n      switch (operator) {\n        case 'gt':\n          return left > right;\n        case 'gte':\n          return left >= right;\n        case 'lt':\n          return left < right;\n        case 'lte':\n          return left <= right;\n        case 'eq':\n          return left === right;\n        default:\n          return false;\n      }\n    };\n\n    const resolveThresholdValue = (value: string, result: EffectResult, depth: number): number => {\n      const rawExpr = String(value || '').trim();\n      if (!rawExpr) return 0;\n\n      //  {}/5 \n      const expr = rawExpr.replace(/\\{([^}]+)\\}/g, '$1');\n      const delta = Math.abs(result.newValue - result.oldValue);\n      const liveFormulaContext = buildFormulaContext();\n      const exprContext: Record<string, number> = {\n        ...liveFormulaContext,\n        $attr: result.newValue,\n        $old: result.oldValue,\n        $new: result.newValue,\n        $delta: delta,\n        $depth: depth,\n      };\n\n      const condResult = evaluateCondition(expr, exprContext);\n      if (condResult.success && condResult.value !== undefined) {\n        const val = typeof condResult.value === 'boolean' ? (condResult.value ? 1 : 0) : Number(condResult.value);\n        if (Number.isFinite(val)) return val;\n      }\n\n      const formulaExpr = expr.replace(/\\$[a-zA-Z_]\\w*/g, token => {\n        const val = exprContext[token];\n        return typeof val === 'number' && Number.isFinite(val) ? String(val) : '0';\n      });\n      const formulaValue = evaluateFormula(formulaExpr, liveFormulaContext);\n      if (typeof formulaValue === 'number' && Number.isFinite(formulaValue)) return formulaValue;\n\n      const fallbackNum = parseFloat(expr);\n      return Number.isFinite(fallbackNum) ? fallbackNum : 0;\n    };\n\n    const renderTemplateText = (text: string, vars: Record<string, string | number | boolean | undefined>): string => {\n      return String(text || '').replace(/\\$([a-zA-Z_]\\w*)/g, (match, key: string) => {\n        const varKey = `$${key}`;\n        const val = vars[varKey];\n        if (val === undefined || val === null) return match;\n        return String(val);\n      });\n    };\n\n    const renderTemplateTextTwice = (\n      text: string,\n      vars: Record<string, string | number | boolean | undefined>,\n    ): string => {\n      const pass1 = renderTemplateText(text, vars);\n      return renderTemplateText(pass1, vars);\n    };\n\n    const appendNamedRandomTables = (\n      outputVars: Record<string, string | number | boolean>,\n      randomTables?: SecondaryEffect['randomTables'],\n    ): void => {\n      if (!randomTables) return;\n      for (const [tableKey, tableDef] of Object.entries(randomTables)) {\n        if (!tableDef || !tableDef.dice) continue;\n        const tableRoll = rollComplexDiceExpression(tableDef.dice);\n        outputVars[`$${tableKey}Roll`] = tableRoll.total;\n        const rawResult = tableDef.entries?.[tableRoll.total] ?? String(tableRoll.total);\n        outputVars[`$${tableKey}Result`] = renderTemplateTextTwice(rawResult, outputVars);\n      }\n    };\n\n    for (let depth = 2; depth <= maxDepth + 1; depth++) {\n      if (currentLevelResults.length === 0) break;\n      const nextLevelResults: EffectResult[] = [];\n\n      const secondaryTriggerMode: 'first' | 'all' = preset.secondaryTriggerMode === 'all' ? 'all' : 'first';\n\n      for (const secEffect of secondaryEffects) {\n        if (secEffect.enabled === false) continue;\n        const maxTriggerCount = Math.max(1, secEffect.maxTriggerCount ?? 1);\n        const currentCount = triggerCounts.get(secEffect.id) || 0;\n        if (currentCount >= maxTriggerCount) continue;\n\n        const matchedCandidates: Array<{ result: EffectResult; thresholdValue: number }> = [];\n        for (const result of currentLevelResults) {\n          if (!result.success) continue;\n          const resultTarget = result.target || result.effectId;\n          if (!isSameAttributeAlias(resultTarget, secEffect.trigger.attribute)) continue;\n\n          const attrValue = result.newValue;\n          const delta = Math.abs(result.newValue - result.oldValue);\n          const thresholdValue = resolveThresholdValue(secEffect.trigger.value, result, depth);\n          const compareValue = secEffect.trigger.type === 'threshold' ? attrValue : delta;\n          const isTriggered = compare(secEffect.trigger.operator, compareValue, thresholdValue);\n          if (!isTriggered) continue;\n\n          matchedCandidates.push({ result, thresholdValue });\n          if (secondaryTriggerMode === 'first') break;\n        }\n\n        if (matchedCandidates.length === 0) continue;\n\n        const remainingTriggerCount = Math.max(0, maxTriggerCount - currentCount);\n        if (remainingTriggerCount === 0) continue;\n\n        let consumedMatches = 0;\n        const generatedByMatch: EffectResult[][] = [];\n\n        for (let candidateIndex = 0; candidateIndex < matchedCandidates.length; candidateIndex++) {\n          if (consumedMatches >= remainingTriggerCount) break;\n\n          const matched = matchedCandidates[candidateIndex];\n          const matchedResult = matched.result;\n          const matchedThresholdValue = matched.thresholdValue;\n          const attrValue = matchedResult.newValue;\n          const delta = Math.abs(matchedResult.newValue - matchedResult.oldValue);\n          const nextMatchIndex = consumedMatches + 1;\n          let callbackScheduled = false;\n\n          if (secEffect.callback) {\n            const callbackFn = (window as Record<string, unknown>)[secEffect.callback];\n            if (typeof callbackFn === 'function') {\n              const callbackPayload: Record<string, unknown> = {\n                attrValue,\n                delta,\n                context,\n                depth,\n                thresholdValue: matchedThresholdValue,\n                matchIndex: nextMatchIndex,\n                chainMode: secondaryTriggerMode,\n              };\n              callbackScheduled = true;\n              const runCallback = () => {\n                try {\n                  (callbackFn as (effect: SecondaryEffect, data: Record<string, unknown>) => void)(\n                    secEffect,\n                    callbackPayload,\n                  );\n                  console.info(\n                    `[DICE] Secondary effect callback triggered: ${secEffect.id} (depth=${depth}, mode=${secondaryTriggerMode}, match=${nextMatchIndex}, ${secEffect.trigger.type} ${secEffect.trigger.operator} ${matchedThresholdValue})`,\n                  );\n                } catch (e) {\n                  console.error(`[DICE] Secondary effect callback error:`, e);\n                }\n              };\n\n              callbackQueue.push(runCallback);\n            }\n          }\n\n          const effectsToRun: Effect[] = [...(secEffect.effects || [])];\n          const generatedForCurrentMatch: EffectResult[] = [];\n          const baseOutputVars: Record<string, string | number | boolean> = {\n            $delta: delta,\n            $old: matchedResult.oldValue,\n            $new: matchedResult.newValue,\n            $attr: attrValue,\n            $depth: depth,\n            $initiator: context.characterName,\n            $attribute: matchedResult.target || context.attributeName,\n          };\n\n          //  outputText  EffectResult\n          if (secEffect.outputText) {\n            const outputVars: Record<string, string | number | boolean> = {\n              ...baseOutputVars,\n            };\n            // :  $tableRoll  $tableResult\n            if (secEffect.randomTable) {\n              const tableRoll = rollComplexDiceExpression(secEffect.randomTable.dice);\n              outputVars.$tableRoll = tableRoll.total;\n              const rawTableResult = secEffect.randomTable.entries[tableRoll.total] || `(${tableRoll.total})`;\n              outputVars.$tableResult = renderTemplateTextTwice(rawTableResult, outputVars);\n            }\n            appendNamedRandomTables(outputVars, secEffect.randomTables);\n            const renderedText = renderTemplateTextTwice(secEffect.outputText, outputVars);\n            const infoResult: EffectResult = {\n              effectId: secEffect.id,\n              success: true,\n              oldValue: matchedResult.oldValue,\n              newValue: matchedResult.newValue,\n              target: matchedResult.target,\n              level: depth,\n              triggerType: secEffect.trigger.type,\n              triggerSourceId: secEffect.id,\n              triggerThreshold: matchedThresholdValue,\n              triggerMatchIndex: nextMatchIndex,\n              outputMessage: renderedText,\n              branchLabel: `L${depth}/${secEffect.id}`,\n            };\n            // infoResult  allGenerated generatedForCurrentMatch\n            //  nextLevelResults delta/oldValue/newValue  delta/threshold \n            allGenerated.push(infoResult);\n            generatedForCurrentMatch.push(infoResult);\n          }\n\n          if (secEffect.subCheck) {\n            const subCheck = secEffect.subCheck;\n            const subCheckCandidates = [subCheck.attribute, ...(subCheck.attributeCandidates || [])].filter(\n              (item, idx, arr) => Boolean(item) && arr.indexOf(item) === idx,\n            );\n            const subCheckLabel = subCheck.label || subCheck.attribute;\n            let subCheckAttrName = subCheck.attribute;\n            let subCheckAttrValue: number | null = null;\n            for (const candidate of subCheckCandidates) {\n              const value = getAttributeValue(context.characterName, candidate, subCheckCandidates);\n              if (typeof value === 'number' && Number.isFinite(value)) {\n                subCheckAttrName = candidate;\n                subCheckAttrValue = value;\n                break;\n              }\n            }\n\n            if (subCheckAttrValue === null) {\n              const fallbackText =\n                subCheck.missingAttributeText ||\n                ' $subCheckLabel[$subCheckAttrName]';\n              const missingVars: Record<string, string | number | boolean> = {\n                ...baseOutputVars,\n                $subCheckLabel: subCheckLabel,\n                $subCheckAttrName: subCheckAttrName,\n              };\n              const infoResult: EffectResult = {\n                effectId: `${secEffect.id}_subcheck_missing`,\n                success: true,\n                oldValue: matchedResult.oldValue,\n                newValue: matchedResult.newValue,\n                target: matchedResult.target,\n                level: depth,\n                triggerType: secEffect.trigger.type,\n                triggerSourceId: secEffect.id,\n                triggerThreshold: matchedThresholdValue,\n                triggerMatchIndex: nextMatchIndex,\n                outputMessage: renderTemplateText(fallbackText, missingVars),\n                branchLabel: `L${depth}/${secEffect.id}/${subCheckLabel}:`,\n              };\n              allGenerated.push(infoResult);\n              generatedForCurrentMatch.push(infoResult);\n            } else {\n              const subCheckDice = subCheck.dice || '1d100';\n              const subCheckRoll = rollComplexDiceExpression(subCheckDice).total;\n              const subCheckTarget =\n                typeof subCheck.targetValue === 'string' && subCheck.targetValue.trim().length > 0\n                  ? resolveThresholdValue(subCheck.targetValue, matchedResult, depth)\n                  : subCheckAttrValue;\n              const subCheckOperator = subCheck.operator || 'lte';\n              const subCheckPassed = compare(subCheckOperator, subCheckRoll, subCheckTarget);\n              const subCheckJudge = subCheckPassed ? '' : '';\n              const branch = subCheckPassed ? subCheck.success : subCheck.failure;\n              const subCheckVars: Record<string, string | number | boolean> = {\n                ...baseOutputVars,\n                $subCheckLabel: subCheckLabel,\n                $subCheckAttrName: subCheckAttrName,\n                $subCheckAttrValue: subCheckAttrValue,\n                $subCheckDice: subCheckDice,\n                $subCheckRoll: subCheckRoll,\n                $subCheckTarget: subCheckTarget,\n                $subCheckOperator: subCheckOperator,\n                $subCheckPassed: subCheckPassed ? 1 : 0,\n                $subCheckJudge: subCheckJudge,\n              };\n\n              if (branch?.randomTable) {\n                const tableRoll = rollComplexDiceExpression(branch.randomTable.dice);\n                subCheckVars.$tableRoll = tableRoll.total;\n                const rawTableResult = branch.randomTable.entries[tableRoll.total] || `(${tableRoll.total})`;\n                subCheckVars.$tableResult = renderTemplateTextTwice(rawTableResult, subCheckVars);\n              }\n              appendNamedRandomTables(\n                subCheckVars,\n                branch?.randomTables as SecondaryEffect['randomTables'] | undefined,\n              );\n\n              if (branch?.outputText) {\n                const infoResult: EffectResult = {\n                  effectId: `${secEffect.id}_subcheck_${subCheckPassed ? 'success' : 'failure'}`,\n                  success: true,\n                  oldValue: matchedResult.oldValue,\n                  newValue: matchedResult.newValue,\n                  target: matchedResult.target,\n                  level: depth,\n                  triggerType: secEffect.trigger.type,\n                  triggerSourceId: secEffect.id,\n                  triggerThreshold: matchedThresholdValue,\n                  triggerMatchIndex: nextMatchIndex,\n                  outputMessage: renderTemplateTextTwice(branch.outputText, subCheckVars),\n                  branchLabel: `L${depth}/${secEffect.id}/${subCheckLabel}:${subCheckPassed ? '' : ''}`,\n                };\n                allGenerated.push(infoResult);\n                generatedForCurrentMatch.push(infoResult);\n              }\n\n              if (branch?.effects && branch.effects.length > 0) {\n                effectsToRun.push(...branch.effects);\n              }\n            }\n          }\n\n          for (const effect of effectsToRun) {\n            if (effect.condition) {\n              const formulaContextForCondition = buildFormulaContext();\n              const condContext = {\n                $roll: 0,\n                $attr: matchedResult.newValue,\n                $old: matchedResult.oldValue,\n                $new: matchedResult.newValue,\n                $delta: delta,\n                $depth: depth,\n                $mod: 0,\n                $dc: 0,\n                ...formulaContextForCondition,\n              };\n              const condResult = evaluateCondition(effect.condition, condContext);\n              if (!condResult.success || !condResult.value) continue;\n            }\n\n            if (preset.effectsConfig?.allowedTargets && preset.effectsConfig.allowedTargets.length > 0) {\n              if (!preset.effectsConfig.allowedTargets.includes(effect.target)) continue;\n            }\n\n            const parsedValue = parseEffectValueInput(effect.value, `Secondary ${secEffect.id}/${effect.id}`);\n            const finalValue = parsedValue.finalValue;\n\n            const aliasCandidates = [...(preset.effectsConfig?.allowedTargets || []), context.attributeName].filter(\n              (name, idx, arr) => Boolean(name) && arr.indexOf(name) === idx,\n            );\n\n            const updateResult = await updateSingleAttribute(\n              context.characterName,\n              effect.target,\n              effect.operation,\n              finalValue,\n              {\n                initValue: effect.initValue,\n                min: effect.min,\n                max: effect.max,\n                aliasCandidates,\n                skipSave: Boolean(transactionalData),\n                dataOverride: transactionalData,\n              },\n            );\n            if (updateResult.modifiedSheetKey && modifiedSheetKeys)\n              modifiedSheetKeys.add(updateResult.modifiedSheetKey);\n\n            const generatedResult: EffectResult = {\n              effectId: effect.id,\n              success: updateResult.success,\n              oldValue: updateResult.oldValue,\n              newValue: updateResult.newValue,\n              error: updateResult.error,\n              target: updateResult.resolvedAttrName || effect.target,\n              level: depth,\n              triggerType: secEffect.trigger.type,\n              triggerSourceId: secEffect.id,\n              triggerThreshold: matchedThresholdValue,\n              triggerMatchIndex: nextMatchIndex,\n              branchLabel: `L${depth}/${secEffect.id}`,\n              formulaText: parsedValue.formulaText,\n              rolledValue: parsedValue.rolledValue,\n            };\n            nextLevelResults.push(generatedResult);\n            allGenerated.push(generatedResult);\n            generatedForCurrentMatch.push(generatedResult);\n\n            if (updateResult.success && replayOperations) {\n              replayOperations.push({\n                characterName: context.characterName,\n                target: effect.target,\n                operation: effect.operation,\n                value: finalValue,\n                initValue: effect.initValue,\n                min: effect.min,\n                max: effect.max,\n                aliasCandidates,\n                resultRef: generatedResult,\n              });\n            }\n          }\n\n          if (!callbackScheduled && generatedForCurrentMatch.length === 0) {\n            continue;\n          }\n\n          consumedMatches += 1;\n          generatedByMatch.push(generatedForCurrentMatch);\n        }\n\n        if (consumedMatches === 0) continue;\n\n        triggerCounts.set(secEffect.id, currentCount + consumedMatches);\n\n        for (const grouped of generatedByMatch) {\n          grouped.forEach(item => {\n            item.triggerMatchCount = consumedMatches;\n          });\n        }\n      }\n\n      currentLevelResults = nextLevelResults.filter(r => r.success);\n    }\n\n    if (!deferredSecondaryCallbacks) {\n      const hasFailure = allGenerated.some(item => !item.success);\n      if (!hasFailure) {\n        localDeferredCallbacks.forEach(run => run());\n      }\n    }\n\n    return allGenerated;\n  }\n\n  /**\n   * \n   * @param results \n   * @returns  outputContext \n   */\n  function computeEffectVariables(results: EffectResult[]): Record<string, string | number | boolean> {\n    if (!results || results.length === 0) {\n      return {\n        effectTarget: '',\n        effectOperation: '',\n        effectDelta: 0,\n        effectDeltaFormula: '',\n        effectOldValue: 0,\n        effectNewValue: 0,\n        effectSummary: '',\n        effectText: '',\n        hasEffect: false,\n        effectCount: 0,\n        effectResults: '[]',\n      };\n    }\n\n    // \n    const successResults = results.filter(r => r.success);\n    const lastSuccess =\n      successResults.length > 0 ? successResults[successResults.length - 1] : results[results.length - 1];\n\n    const delta = lastSuccess.newValue - lastSuccess.oldValue;\n    const operation = delta > 0 ? '' : delta < 0 ? '' : '';\n\n    // \n    const summaries = successResults.map(r => {\n      const d = r.newValue - r.oldValue;\n      const op = d > 0 ? '+' : '';\n      return `${r.effectId}: ${op}${d} (${r.oldValue}${r.newValue})`;\n    });\n\n    return {\n      effectTarget: lastSuccess.effectId,\n      effectOperation: operation,\n      effectDelta: Math.abs(delta),\n      effectDeltaFormula: `${Math.abs(delta)}`,\n      effectOldValue: lastSuccess.oldValue,\n      effectNewValue: lastSuccess.newValue,\n      effectSummary:\n        successResults.length > 0\n          ? `${operation} ${Math.abs(delta)} (${lastSuccess.oldValue}  ${lastSuccess.newValue})`\n          : '',\n      effectText: summaries.join('; '),\n      hasEffect: successResults.length > 0,\n      effectCount: successResults.length,\n      effectResults: JSON.stringify(results),\n    };\n  }\n\n  function buildEffectTraceLines(results: EffectResult[]): string[] {\n    if (!results || results.length === 0) return [];\n    return results.map(item => {\n      const prefix = item.branchLabel ? `[${item.branchLabel}] ` : item.level ? `[L${item.level}] ` : '';\n      const target = item.target || '-';\n      //  success:falseoutputMessage \n      if (!item.success && item.error) {\n        return `${prefix} ${target} : ${item.error}`;\n      }\n      //  secondaryEffect.outputText\n      if (item.outputMessage) {\n        return `${prefix}${item.outputMessage}`;\n      }\n      const delta = item.newValue - item.oldValue;\n      const sign = delta > 0 ? '+' : '';\n      const icon = item.success ? '' : '';\n      const formulaInfo = item.formulaText\n        ? ` :${item.formulaText}${item.rolledValue !== undefined ? ` :${item.rolledValue}` : ''}`\n        : '';\n      return `${prefix}${icon} ${target} ${item.oldValue}  ${item.newValue} (${sign}${delta})${formulaInfo}`;\n    });\n  }\n\n  function buildEffectMetaLines(\n    results: EffectResult[],\n    options?: {\n      branchReasonText?: string;\n    },\n  ): string[] {\n    if (!results || results.length === 0) return [];\n    const settledHeader = '';\n    const lines = results\n      .filter(item => item.success)\n      .map(item => {\n        if (item.outputMessage) {\n          return item.outputMessage;\n        }\n\n        const target = item.target || '';\n        const delta = item.newValue - item.oldValue;\n        const sign = delta > 0 ? '+' : '';\n        const primaryBranch = item.branchLabel?.startsWith('L1/') ? item.branchLabel.slice(3) : '';\n        const formulaDetail =\n          item.formulaText && item.rolledValue !== undefined\n            ? `${primaryBranch ? `${primaryBranch}` : ''}${item.formulaText}${item.rolledValue}`\n            : '';\n\n        const reasonPrefix = primaryBranch ? `${primaryBranch}` : '';\n        return `${reasonPrefix}${target}${item.oldValue}${item.newValue}${sign}${delta}${formulaDetail}`;\n      });\n\n    // \n    if (lines.length > 0) return [settledHeader, ...lines];\n    if (options?.branchReasonText) return [settledHeader, options.branchReasonText];\n    return [];\n  }\n\n  /**\n   * \n   * \n   * @param effects \n   * @returns  outputContext \n   */\n  function computePendingEffectVariables(effects: Effect[] | undefined): Record<string, string | number | boolean> {\n    if (!effects || effects.length === 0) {\n      return {\n        effectTarget: '',\n        effectOperation: '',\n        effectDelta: 0,\n        effectDeltaFormula: '',\n        effectOldValue: 0,\n        effectNewValue: 0,\n        effectSummary: '',\n        effectText: '',\n        hasEffect: false,\n        effectCount: 0,\n        effectResults: '[]',\n      };\n    }\n\n    // \n    const firstEffect = effects[0];\n    const operationMap: Record<string, string> = {\n      add: '',\n      subtract: '',\n      set: '',\n    };\n    const operation = operationMap[firstEffect.operation] || firstEffect.operation;\n\n    // \n    const summaries = effects.map(e => {\n      const op = operationMap[e.operation] || e.operation;\n      return `${e.target}: ${op} ${e.value}`;\n    });\n\n    return {\n      effectTarget: firstEffect.target,\n      effectOperation: operation,\n      effectDelta: 0, // \n      effectDeltaFormula: firstEffect.value,\n      effectOldValue: 0, // \n      effectNewValue: 0, // \n      effectSummary: `${firstEffect.target} ${operation} ${firstEffect.value}`,\n      effectText: summaries.join('; '),\n      hasEffect: true,\n      effectCount: effects.length,\n      effectResults: JSON.stringify(effects.map(e => ({ effectId: e.id, pending: true }))),\n    };\n  }\n\n  // ========================================\n  // BookmarkManager - \n  // ========================================\n  const BookmarkManager = {\n    STORAGE_KEY_PREFIX: 'acu_bookmarks_v1_',\n    MAX_CONTEXTS: 20, // bookmark\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    // bookmark N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) {\n          // \n          return;\n        }\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(\n            `[DICE]BookmarkManager  ${toDelete.length} bookmark ${this.MAX_CONTEXTS}  ${allKeys.length} `,\n          );\n        }\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    isBookmarked(tableName, rowKey) {\n      const data = this._load();\n      return !!(data[tableName] && data[tableName][rowKey]);\n    },\n\n    toggleBookmark(tableName, rowKey) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      if (data[tableName][rowKey]) {\n        // bookmark\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n      } else {\n        // bookmark\n        data[tableName][rowKey] = true;\n      }\n      this._save();\n    },\n\n    getBookmarks(tableName) {\n      const data = this._load();\n      if (!data[tableName]) return [];\n      return Object.keys(data[tableName]);\n    },\n\n    // bookmark\n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  const escapeHtml = s =>\n    String(s ?? '')\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n\n  const stripLoneSurrogates = (value: string): string => {\n    let sanitized = '';\n    for (let i = 0; i < value.length; i++) {\n      const code = value.charCodeAt(i);\n      if (code >= 0xd800 && code <= 0xdbff) {\n        const next = value.charCodeAt(i + 1);\n        if (next >= 0xdc00 && next <= 0xdfff) {\n          sanitized += value[i] + value[i + 1];\n          i++;\n        } else {\n          sanitized += '\\uFFFD';\n        }\n        continue;\n      }\n      if (code >= 0xdc00 && code <= 0xdfff) {\n        sanitized += '\\uFFFD';\n        continue;\n      }\n      sanitized += value[i];\n    }\n    return sanitized;\n  };\n\n  const safeEncodeURIComponent = (value: unknown): string => {\n    const text = String(value ?? '');\n    try {\n      return encodeURIComponent(text);\n    } catch {\n      return encodeURIComponent(stripLoneSurrogates(text));\n    }\n  };\n\n  const safeDecodeURIComponent = (value: unknown): string => {\n    const text = String(value ?? '');\n    try {\n      return decodeURIComponent(text);\n    } catch {\n      return stripLoneSurrogates(text);\n    }\n  };\n\n  /**\n   * \n   * - PC mousedown  mouseup \n   * - Mobile\n   * @param $overlay jQuery\n   * @param overlayClass \n   * @param onClose \n   */\n  const setupOverlayClose = ($overlay: JQuery, overlayClass: string, onClose: () => void) => {\n    const isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n\n    if (isMobile) {\n      // Mobile: \n      $overlay.on('click', function (e) {\n        if ($(e.target).hasClass(overlayClass)) {\n          onClose();\n        }\n      });\n    } else {\n      // PC:  mousedown  mouseup \n      let mouseDownOnOverlay = false;\n\n      $overlay.on('mousedown', function (e) {\n        mouseDownOnOverlay = $(e.target).hasClass(overlayClass);\n      });\n\n      $overlay.on('mouseup', function (e) {\n        if (mouseDownOnOverlay && $(e.target).hasClass(overlayClass)) {\n          onClose();\n        }\n        mouseDownOnOverlay = false;\n      });\n    }\n  };\n\n  // [] \n  const generateUniqueName = (baseName: string, existingNames: string[]): string => {\n    if (!existingNames.includes(baseName)) return baseName;\n    let counter = 2;\n    let newName = `${baseName} (${counter})`;\n    while (existingNames.includes(newName)) {\n      counter++;\n      newName = `${baseName} (${counter})`;\n    }\n    return newName;\n  };\n\n  // [] \n  const showPresetConflictDialog = (options: {\n    presetName: string;\n    presetType: string;\n    onOverwrite: () => void;\n    onRename: (newName: string) => void;\n    onCancel: () => void;\n    existingNames: string[];\n  }) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const config = getConfig();\n    const suggestedName = generateUniqueName(options.presetName, options.existingNames);\n\n    const dialogHtml = `\n      <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-import-confirm-dialog\">\n          <div class=\"acu-import-confirm-header\">\n            <i class=\"fa-solid fa-file-import\"></i> ${options.presetType}\n          </div>\n          <div class=\"acu-import-confirm-body\">\n            <div class=\"acu-import-warning-container\">\n              <i class=\"fa-solid fa-exclamation-triangle acu-import-warning-icon\"></i>\n              <div class=\"acu-import-warning-title\"></div>\n              <div class=\"acu-import-warning-message\">${escapeHtml(options.presetName)}</div>\n            </div>\n            <div class=\"acu-import-conflict-options\">\n              <label class=\"acu-import-radio\">\n                <input type=\"radio\" name=\"preset-conflict-mode\" value=\"overwrite\" checked />\n                <span></span>\n              </label>\n              <label class=\"acu-import-radio\">\n                <input type=\"radio\" name=\"preset-conflict-mode\" value=\"rename\" />\n                <span>${escapeHtml(suggestedName)}</span>\n              </label>\n            </div>\n          </div>\n          <div class=\"acu-import-confirm-footer\">\n            <button class=\"acu-import-cancel-btn\"></button>\n            <button class=\"acu-import-confirm-btn\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n      position: fixed !important;\n      top: 0 !important;\n      left: 0 !important;\n      right: 0 !important;\n      bottom: 0 !important;\n      width: 100vw !important;\n      height: 100vh !important;\n      background: rgba(0,0,0,0.6) !important;\n      z-index: 31300 !important;\n      display: flex;\n      justify-content: center !important;\n      align-items: center !important;\n      padding: 16px;\n      box-sizing: border-box !important;\n    `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(() => {\n      closeDialog();\n      options.onCancel();\n    });\n\n    setupOverlayClose($dialog, 'acu-import-confirm-overlay', () => {\n      closeDialog();\n      options.onCancel();\n    });\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const mode = $dialog.find('input[name=\"preset-conflict-mode\"]:checked').val();\n      closeDialog();\n      if (mode === 'overwrite') {\n        options.onOverwrite();\n      } else {\n        options.onRename(suggestedName);\n      }\n    });\n  };\n  // [] \n  const smartInsertToTextarea = (newContent, contentType) => {\n    // contentType: 'action' ()  'dice' ()\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const normalizeTextareaContent = (text: unknown): string => {\n      return String(text ?? '')\n        .replace(/\\r\\n?/g, '\\n')\n        .replace(/[ \\t]+\\n/g, '\\n')\n        .replace(/\\n[ \\t]+/g, '\\n')\n        .replace(/\\n{2,}/g, '\\n')\n        .trim();\n    };\n\n    const normalizedNewContent = normalizeTextareaContent(newContent);\n    const currentVal = normalizeTextareaContent($ta.val() || '');\n\n    //  <meta:>...</meta:>\n    const metaCheckResultRegex = /<meta:>[\\s\\S]*?<\\/meta:>/g;\n\n    // <user>\n    const actionRegex = /<user>(?:(?!<user>).)*?[]/g;\n\n    // \n    const placeholderRegex = /\\[\\]/g;\n\n    // [] \n    const diceCfg = getDiceConfig();\n    let contentToInsert = normalizedNewContent;\n    let shouldSaveOriginal = false;\n    if (contentType === 'dice' && diceCfg.hideDiceResultFromUser) {\n      contentToInsert = '[]';\n      shouldSaveOriginal = true;\n    }\n\n    // \n    if (!currentVal) {\n      $ta.val(contentToInsert).trigger('input').trigger('change');\n      // []  data \n      if (contentType === 'dice') {\n        $ta.data('acu-original-dice-text', normalizedNewContent);\n        // []  DOM  getter  jQuery\n        const textarea = $ta[0] as any;\n        textarea._acuOriginalDiceText = normalizedNewContent;\n        textarea._acuHasDiceData = true;\n      }\n      return;\n    }\n\n    // \n    let workingText = currentVal;\n    let existingAction = '';\n    let existingDice = '';\n    let existingDiceOriginal = '';\n\n    // [] 0. \n    if (placeholderRegex.test(workingText)) {\n      // \n      const originalText = $ta.data('acu-original-dice-text') || '';\n      if (originalText) {\n        // \n        workingText = workingText.replace(placeholderRegex, originalText);\n        existingDice = originalText;\n        existingDiceOriginal = originalText;\n      } else {\n        // \n        workingText = workingText.replace(placeholderRegex, '').trim();\n      }\n    }\n\n    // 1.  <meta:> \n    const metaMatches = workingText.match(metaCheckResultRegex);\n    if (metaMatches && metaMatches.length > 0) {\n      existingDice = metaMatches[metaMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(metaCheckResultRegex, '\\u0000').trim();\n      console.log(\n        '[DICE]ACU SmartInsert Found and extracted meta check result:',\n        existingDice.substring(0, 50) + '...',\n      );\n    }\n\n    // 2. \n    const actionMatches = workingText.match(actionRegex);\n    if (actionMatches && actionMatches.length > 0) {\n      existingAction = actionMatches[actionMatches.length - 1];\n      workingText = workingText.replace(actionRegex, '\\u0001').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted action:', existingAction);\n    }\n\n    // 3. \n    let userInput = workingText\n      .replace(/[\\u0000\\u0001]/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .trim();\n\n    // [] \n    // \" + <meta:>...\"\n    //  userInput /\n    if (contentType === 'dice' && normalizedNewContent.includes('<meta:>') && userInput) {\n      const diceBody = normalizeTextareaContent(\n        normalizedNewContent.replace(/<meta:>/g, '').replace(/<\\/meta:>/g, ''),\n      );\n      const firstLine = (diceBody.split('\\n')[0] || '').trim();\n      const normalizeFragment = (text: string): string => {\n        return String(text || '')\n          .replace(/\\s+/g, '')\n          .replace(/[:,!?.]+$/g, '')\n          .trim();\n      };\n      const userNorm = normalizeFragment(userInput);\n      const firstNorm = normalizeFragment(firstLine);\n      if (userNorm && firstNorm && (firstNorm.startsWith(userNorm) || userNorm.startsWith(firstNorm))) {\n        userInput = '';\n      }\n    }\n\n    // 4. \n    if (contentType === 'dice') {\n      // [] \n      existingDice = contentToInsert;\n      existingDiceOriginal = normalizedNewContent;\n      //  data \n      $ta.data('acu-original-dice-text', normalizedNewContent);\n      // []  DOM  getter  jQuery\n      const textarea = $ta[0] as any;\n      textarea._acuOriginalDiceText = normalizedNewContent;\n      textarea._acuHasDiceData = true;\n    } else if (contentType === 'action') {\n      existingAction = normalizedNewContent;\n    }\n\n    // 5.  +  + \n    const parts = [];\n    if (userInput) parts.push(userInput);\n    if (existingAction) parts.push(existingAction);\n    if (existingDice) parts.push(existingDice);\n\n    const finalVal = normalizeTextareaContent(parts.join(' '));\n    $ta.val(finalVal).trigger('input').trigger('change');\n  };\n\n  // [] \n  const restoreDiceResultBeforeSend = () => {\n    const { $ } = getCore();\n    const diceCfg = getDiceConfig();\n    const hideInput = diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n    if (hideInput) return;\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = $ta.val() || '';\n    const originalText = $ta.data('acu-original-dice-text');\n\n    // \n    if (currentVal.includes('[]') && originalText) {\n      const restoredVal = currentVal.replace(/\\[\\]/g, originalText);\n      $ta.val(restoredVal);\n      // \n      $ta.removeData('acu-original-dice-text');\n      // []  DOM \n      const textarea = $ta[0] as any;\n      textarea._acuOriginalDiceText = null;\n      textarea._acuHasDiceData = false;\n    }\n  };\n\n  // []  value \n  const interceptTextareaValue = () => {\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const textarea = $ta[0] as HTMLTextAreaElement;\n    if (!textarea || (textarea as any)._acuValueIntercepted) return;\n\n    // \n    (textarea as any)._acuValueIntercepted = true;\n\n    //  value \n    const originalDescriptor = Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype, 'value');\n    const originalValue = textarea.value;\n\n    //  value  getter\n    Object.defineProperty(textarea, 'value', {\n      get: function (this: HTMLTextAreaElement) {\n        // \n        let val: string;\n        if (originalDescriptor && originalDescriptor.get) {\n          val = originalDescriptor.get.call(this);\n        } else {\n          val = (this as any)._value || originalValue || '';\n        }\n\n        // [] \n        //  DOM  jQuery data getter  jQuery\n        //  ) \n        if (!(this as any)._acuHasDiceData) {\n          return val;\n        }\n\n        // \n        const originalText = (this as any)._acuOriginalDiceText;\n        if (val && typeof val === 'string' && val.includes('[]') && originalText) {\n          return val.replace(/\\[\\]/g, originalText);\n        }\n        return val;\n      },\n      set: function (this: HTMLTextAreaElement, val: string) {\n        if (originalDescriptor && originalDescriptor.set) {\n          originalDescriptor.set.call(this, val);\n        } else {\n          (this as any)._value = val;\n        }\n      },\n      configurable: true,\n    });\n  };\n  const STORAGE_KEY_TABLE_ORDER = 'acu_table_order';\n  const STORAGE_KEY_ACTION_ORDER = 'acu_action_order';\n\n  const STORAGE_KEY_ACTIVE_TAB = 'acu_active_tab';\n  const STORAGE_KEY_UI_CONFIG = 'acu_ui_config_v19';\n  const STORAGE_KEY_LAST_SNAPSHOT = 'acu_data_snapshot_v19';\n  const STORAGE_KEY_IS_COLLAPSED = 'acu_ui_collapsed_state';\n  const STORAGE_KEY_OPTIONS_COLLAPSED = 'acu_options_collapsed'; // [] \n  const STORAGE_KEY_DASHBOARD_ACTIVE = 'acu_dashboard_active';\n  // [] \n  const STORAGE_KEY_TABLE_HEIGHTS = 'acu_table_heights_v19';\n  const STORAGE_KEY_TABLE_STYLES = 'acu_table_styles_v19';\n  const STORAGE_KEY_HIDDEN_TABLES = 'acu_hidden_tables_v19';\n  const STORAGE_KEY_GM_CONFIG = 'acu_gm_engine_config_v1';\n  const STORAGE_KEY_REVERSE_TABLES = 'acu_reverse_tables_v1';\n  const MAX_ACTION_BUTTONS = 6; // \n  const MIN_PANEL_HEIGHT = 200; // \n  const MAX_PANEL_HEIGHT = 1200; // \n\n  const STORAGE_KEY_DICE_CONFIG = 'acu_dice_config_v1';\n  const STORAGE_KEY_ATTRIBUTE_PRESETS = 'acu_attribute_presets_v1';\n  const STORAGE_KEY_ACTIVE_ATTR_PRESET = 'acu_active_attr_preset_v1';\n  const STORAGE_KEY_ACTION_PRESETS = 'acu_action_presets_v1';\n  const STORAGE_KEY_ACTIVE_ACTION_PRESET = 'acu_active_action_preset_v1';\n  const STORAGE_KEY_ADVANCED_PRESETS = 'acu_advanced_presets_v1';\n  const STORAGE_KEY_BUILTIN_PRESET_VISIBILITY = 'acu_builtin_preset_visibility';\n  const STORAGE_KEY_BUILTIN_PRESET_ORDER = 'acu_builtin_preset_order';\n  const STORAGE_KEY_LAST_PRESET = 'acu_dice_last_preset';\n  const STORAGE_KEY_CRAZY_MODE = 'acu_dice_crazy_mode';\n\n  // \n  const CUSTOM_ROLL_MODE = {\n    id: '__custom__',\n    name: '',\n  } as const;\n  const DEFAULT_CRAZY_MODE_CONFIG = {\n    enabled: false,\n    crazyLevel: 50,\n    playerWeight: 80,\n    inSceneNpcWeight: 15,\n    offSceneNpcWeight: 5,\n  };\n  const PRESET_FORMAT_VERSION = '1.7.0'; // \n  const SCRIPT_VERSION = 'v4.02'; // \n\n  //  \"x.y.z\"\n  const compareVersion = (v1, v2) => {\n    // \n    const normalizeVersion = v => {\n      if (typeof v === 'number') return `${v}.0.0`;\n      if (typeof v !== 'string') return '0.0.0';\n      return v;\n    };\n    const nv1 = normalizeVersion(v1);\n    const nv2 = normalizeVersion(v2);\n    const parts1 = nv1.split('.').map(Number);\n    const parts2 = nv2.split('.').map(Number);\n    for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {\n      const p1 = parts1[i] || 0;\n      const p2 = parts2[i] || 0;\n      if (p1 < p2) return -1;\n      if (p1 > p2) return 1;\n    }\n    return 0;\n  };\n\n  const STORAGE_KEY_AVATAR_MAP = 'acu_avatar_map_v1';\n  const STORAGE_KEY_MAP_FOCUS = 'acu_map_focus_v1';\n\n  // ========================================\n  // ConsoleCaptureManager - Console\n  // ========================================\n  const ConsoleCaptureManager = {\n    logs: [],\n    maxLogs: 1000,\n    filters: { log: true, info: true, warn: true, error: true },\n    originalMethods: {},\n    isIntercepted: false,\n    enabled: false, // \n\n    restore() {\n      //  localStorage \n      const saved = localStorage.getItem('acu_console_capture_enabled');\n      if (saved === 'true') {\n        this.enable();\n      }\n    },\n\n    enable() {\n      if (this.enabled) return;\n      this.enabled = true;\n      localStorage.setItem('acu_console_capture_enabled', 'true');\n      this.intercept();\n    },\n\n    disable() {\n      if (!this.enabled) return;\n      this.enabled = false;\n      localStorage.setItem('acu_console_capture_enabled', 'false');\n      // \n      localStorage.removeItem('acu_script_error_detected');\n      // \n      const emergencyBtn = document.getElementById('acu-emergency-debug-btn');\n      if (emergencyBtn) {\n        emergencyBtn.style.display = 'none';\n      }\n    },\n\n    intercept() {\n      if (this.isIntercepted) return;\n      this.isIntercepted = true;\n\n      ['log', 'info', 'warn', 'error'].forEach(type => {\n        this.originalMethods[type] = console[type];\n        const self = this;\n        console[type] = function (...args) {\n          // \n          self.originalMethods[type].apply(console, args);\n          // \n          if (self.enabled) {\n            self.capture(type, args);\n          }\n        };\n      });\n    },\n\n    capture(type, args) {\n      if (!this.enabled) return; // \n      try {\n        const timestamp = new Date();\n        const timeStr = timestamp.toLocaleTimeString('zh-CN', { hour12: false });\n\n        // \n        const content = args\n          .map(arg => {\n            if (typeof arg === 'object') {\n              try {\n                return JSON.stringify(arg, null, 2);\n              } catch {\n                return String(arg);\n              }\n            }\n            return String(arg);\n          })\n          .join(' ');\n\n        // error\n        let stack = null;\n        if (type === 'error' && args[0] instanceof Error) {\n          stack = args[0].stack || null;\n        }\n\n        const logEntry = {\n          id: Date.now() + Math.random(),\n          timestamp,\n          timeStr,\n          type,\n          content,\n          stack,\n          rawArgs: args,\n        };\n\n        this.logs.push(logEntry);\n\n        // \n        if (this.logs.length > this.maxLogs) {\n          this.logs.shift();\n        }\n      } catch (e) {\n        // console\n      }\n    },\n\n    clear() {\n      this.logs = [];\n    },\n\n    getFilteredLogs() {\n      return this.logs.filter(log => this.filters[log.type]);\n    },\n\n    setFilters(filters) {\n      this.filters = { ...this.filters, ...filters };\n    },\n  };\n\n  // \n  // ConsoleCaptureManager.intercept();\n\n  // ========================================\n  // \n  // ========================================\n  const ErrorHandler = {\n    errorCount: 0,\n    errorThreshold: 3, // 3\n    lastErrorTime: 0,\n    errorWindow: 5000, // 5\n    fatalErrorDetected: false,\n\n    // \n    isFatalError(error, source, lineno, colno, stack) {\n      // \n      const thirdPartyPatterns = [/jquery/i, /lodash/i, /vue/i, /react/i, /pixi/i, /gsap/i, /toastr/i, /node_modules/i];\n\n      const errorInfo = stack || error?.stack || '';\n      const errorSource = source || '';\n\n      // \n      for (const pattern of thirdPartyPatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          return false;\n        }\n      }\n\n      // \n      const corePatterns = [\n        /acu_visualizer/i,\n        //i,\n        /LockManager/i,\n        /Store/i,\n        /ConsoleCaptureManager/i,\n        /renderInterface/i,\n        /init\\s*\\(/i,\n      ];\n\n      let isCoreError = false;\n      for (const pattern of corePatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          isCoreError = true;\n          break;\n        }\n      }\n\n      // \n      return isCoreError;\n    },\n\n    // \n    handleError(error, source, lineno, colno, stack) {\n      try {\n        // \n        if (!this.isFatalError(error, source, lineno, colno, stack)) {\n          return; // \n        }\n\n        const now = Date.now();\n\n        // \n        if (now - this.lastErrorTime > this.errorWindow) {\n          this.errorCount = 0;\n        }\n\n        this.errorCount++;\n        this.lastErrorTime = now;\n\n        // \n        if (this.errorCount >= this.errorThreshold && !this.fatalErrorDetected) {\n          this.fatalErrorDetected = true;\n          this.triggerFatalError();\n        }\n      } catch (e) {\n        // \n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    triggerFatalError() {\n      try {\n        //  console \n        if (!ConsoleCaptureManager.enabled) {\n          ConsoleCaptureManager.enable();\n        }\n\n        // \n        localStorage.setItem('acu_script_error_detected', 'true');\n\n        // \n        this.showEmergencyButton();\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    showEmergencyButton() {\n      try {\n        // \n        let btn = document.getElementById('acu-emergency-debug-btn');\n        if (btn) {\n          btn.style.display = 'block';\n          return;\n        }\n\n        // \n        btn = document.createElement('button');\n        btn.id = 'acu-emergency-debug-btn';\n        btn.innerHTML = '<i class=\"fa-solid fa-bug\"></i> ';\n        btn.style.cssText = `\n          position: fixed;\n          bottom: 20px;\n          right: 20px;\n          z-index: 99999;\n          padding: 10px 16px;\n          background: #e74c3c;\n          color: #fff;\n          border: none;\n          border-radius: 6px;\n          font-size: 14px;\n          font-weight: bold;\n          cursor: pointer;\n          box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);\n          display: flex;\n          align-items: center;\n          gap: 6px;\n          transition: all 0.2s;\n        `;\n\n        btn.onmouseenter = function () {\n          this.style.background = '#c0392b';\n          this.style.transform = 'scale(1.05)';\n        };\n        btn.onmouseleave = function () {\n          this.style.background = '#e74c3c';\n          this.style.transform = 'scale(1)';\n        };\n\n        btn.onclick = function () {\n          try {\n            //  showDebugConsoleModal\n            if (typeof window.showDebugConsoleModal === 'function') {\n              window.showDebugConsoleModal();\n            } else {\n              // \n              alert('F12');\n            }\n          } catch (e) {\n            console.error('[DICE]:', e);\n            alert('F12');\n          }\n        };\n\n        document.body.appendChild(btn);\n      } catch (e) {\n        console.error('[DICE]:', e);\n      }\n    },\n\n    // \n    checkAndRestore() {\n      try {\n        const errorDetected = localStorage.getItem('acu_script_error_detected') === 'true';\n        if (errorDetected) {\n          //  console \n          if (!ConsoleCaptureManager.enabled) {\n            ConsoleCaptureManager.enable();\n          }\n          // \n          this.showEmergencyButton();\n        }\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n  };\n\n  // \n  window.onerror = function (message, source, lineno, colno, error) {\n    ErrorHandler.handleError(error || message, source, lineno, colno, error?.stack);\n    return false; // \n  };\n\n  //  Promise \n  window.addEventListener('unhandledrejection', function (event) {\n    ErrorHandler.handleError(event.reason, null, null, null, event.reason?.stack);\n  });\n\n  // \n  //  init \n\n  // ========================================\n  //  -  (Phase 1.1)\n  // ========================================\n\n  /**\n   * \n   * - replace: \n   * - extract: ()\n   * - delete: \n   * - validate: (ValidationEngine,)\n   */\n  type RegexOperation = 'replace' | 'extract' | 'delete' | 'validate';\n\n  /**\n   * \n   * - global: \n   * - table: \n   * - column: \n   */\n  type RegexScopeType = 'global' | 'table' | 'column';\n\n  /**\n   * \n   * - auto: \n   * - manual: \n   * - preview: ,\n   */\n  type RegexExecutionMode = 'auto' | 'manual' | 'preview';\n\n  /**\n   * \n   */\n  interface RegexFlags {\n    caseInsensitive?: boolean; // i - \n    global?: boolean; // g - \n    multiline?: boolean; // m - \n    unicode?: boolean; // u - Unicode\n    sticky?: boolean; // y - \n  }\n\n  /**\n   * \n   */\n  interface RegexScopeConfig {\n    type: RegexScopeType;\n    tableNames?: string[]; // tablecolumn\n    columnNames?: string[]; // column\n  }\n\n  /**\n   * \n   */\n  interface RegexSecurityConfig {\n    maxMatchTime: number; // (),100\n    maxMatches: number; // ,1000\n    maxInputLength: number; // ,10000\n  }\n\n  /**\n   * \n   */\n  interface RegexTestCase {\n    input: string;\n    expected: string;\n    description?: string;\n  }\n\n  /**\n   * \n   */\n  interface RegexTransformationRule {\n    id: string; // \n    name: string; // \n    description?: string; // \n    operation: RegexOperation; // \n    pattern: string; // \n    flags?: RegexFlags; // \n    replacement?: string; // (replace)\n    scope: RegexScopeConfig; // \n    enabled: boolean; // \n    priority: number; // (1-100),\n    executeMode: RegexExecutionMode; // \n    testCases?: RegexTestCase[]; // \n    security?: RegexSecurityConfig; // \n    createdAt?: number; // \n    updatedAt?: number; // \n  }\n\n  /**\n   * \n   */\n  interface RegexTransformResult {\n    success: boolean;\n    oldValue: string;\n    newValue: string;\n    matched: boolean;\n    error?: string;\n  }\n\n  /**\n   * \n   */\n  interface RegexBatchTransformResult {\n    tableName: string;\n    columnIndex: number;\n    rowIndex: number;\n    result: RegexTransformResult;\n  }\n\n  /**\n   * \n   */\n  interface RegexPreviewResult {\n    rule: RegexTransformationRule;\n    affectedCells: Array<{\n      tableName: string;\n      rowIndex: number;\n      columnIndex: number;\n      columnName: string;\n      oldValue: string;\n      newValue: string;\n    }>;\n    totalAffected: number;\n  }\n\n  /**\n   * \n   */\n  interface RegexPreset {\n    id: string;\n    name: string;\n    description?: string;\n    version: string;\n    rules: RegexTransformationRule[];\n    createdAt?: number;\n    updatedAt?: number;\n  }\n\n  // \n  const STORAGE_KEY_REGEX_RULES = 'acu_regex_rules_v1';\n  const STORAGE_KEY_REGEX_PRESETS = 'acu_regex_presets_v1';\n  const STORAGE_KEY_REGEX_ACTIVE_PRESET = 'acu_regex_active_preset_v1';\n  const STORAGE_KEY_REGEX_ENABLED = 'acu_regex_enabled_v1';\n\n  // ========================================\n  //  (Tavern Regex Import)\n  // ========================================\n\n  /**\n   * \n   * @see https://docs.sillytavern.app/usage/core-concepts/regex/\n   */\n  interface TavernRegex {\n    id?: string;\n    scriptName: string;\n    findRegex: string;\n    replaceString: string;\n    trimStrings?: string[];\n    placement?: number[];\n    disabled?: boolean;\n    markdownOnly?: boolean;\n    promptOnly?: boolean;\n    runOnEdit?: boolean;\n    substituteRegex?: number;\n    minDepth?: number | null;\n    maxDepth?: number | null;\n  }\n\n  /**\n   *  findRegex \n   * : /pattern/flags\n   */\n  function parseTavernFindRegex(findRegex: string): { pattern: string; flags: RegexFlags } {\n    //  /pattern/flags \n    const match = findRegex.match(/^\\/(.+)\\/([gimsuy]*)$/s);\n    if (match) {\n      const [, pattern, flagStr] = match;\n      return {\n        pattern,\n        flags: {\n          global: flagStr.includes('g'),\n          caseInsensitive: flagStr.includes('i'),\n          multiline: flagStr.includes('m'),\n          unicode: flagStr.includes('u'),\n          sticky: flagStr.includes('y'),\n        },\n      };\n    }\n    // pattern\n    return { pattern: findRegex, flags: { global: true } };\n  }\n\n  /**\n   *  RegexTransformationRule\n   */\n  function convertTavernRegexToRule(tavernRegex: TavernRegex): RegexTransformationRule {\n    const { pattern, flags } = parseTavernFindRegex(tavernRegex.findRegex);\n\n    // \n    const extraInfo: string[] = [];\n    if (tavernRegex.placement?.length) extraInfo.push(`placement: [${tavernRegex.placement.join(',')}]`);\n    if (tavernRegex.markdownOnly) extraInfo.push('markdownOnly');\n    if (tavernRegex.promptOnly) extraInfo.push('promptOnly');\n    if (tavernRegex.minDepth != null) extraInfo.push(`minDepth: ${tavernRegex.minDepth}`);\n    if (tavernRegex.maxDepth != null) extraInfo.push(`maxDepth: ${tavernRegex.maxDepth}`);\n\n    const description = extraInfo.length > 0 ? `[] ${extraInfo.join(', ')}` : '[]';\n\n    return {\n      id: `tavern_import_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      name: tavernRegex.scriptName,\n      description,\n      operation: 'replace',\n      pattern,\n      flags,\n      replacement: tavernRegex.replaceString || '',\n      scope: { type: 'global' },\n      enabled: !tavernRegex.disabled,\n      priority: 50,\n      executeMode: tavernRegex.runOnEdit ? 'auto' : 'manual',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    };\n  }\n\n  // ========================================\n  //  (Phase 2.2)\n  // ========================================\n  const BUILTIN_REGEX_RULES: RegexTransformationRule[] = [\n    // \n    {\n      id: 'builtin_clear_extreme_words',\n      name: '',\n      description: 'AI',\n      operation: 'replace',\n      pattern: '||||||||',\n      flags: { global: false, caseInsensitive: false, multiline: false },\n      replacement: '',\n      scope: { type: 'global' },\n      enabled: true,\n      priority: 50,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // \n    {\n      id: 'builtin_remove_cliche',\n      name: '',\n      description: 'AI',\n      operation: 'replace',\n      pattern:\n        '(+)|(?)([]?)|(?)(|)(|)([]?)|(|)(||)([]?)|([^]*?)(||)(.*?)|([^]*?)(|)(.*?)([^]*?)(?=[])|||',\n      flags: { global: false, caseInsensitive: false, multiline: false },\n      replacement: '',\n      scope: { type: 'global' },\n      enabled: true,\n      priority: 50,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // \n    {\n      id: 'builtin_replace_user',\n      name: '',\n      description: '',\n      operation: 'replace',\n      pattern: '|<user>|{{user}}',\n      flags: { global: false, caseInsensitive: false, multiline: false },\n      replacement: '',\n      scope: { type: 'global' },\n      enabled: false,\n      priority: 50,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // \n    {\n      id: 'builtin_remove_negative_traits',\n      name: '',\n      description: '',\n      operation: 'replace',\n      pattern:\n        '[^;:\\\\s]*(||||NTR|||||||||||)[^;:\\\\s]*[:]\\\\d+;?\\\\s?',\n      flags: { global: false, caseInsensitive: false, multiline: false },\n      replacement: '',\n      scope: { type: 'table', tableNames: ['', '', ''] },\n      enabled: true,\n      priority: 50,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n  ];\n\n  // ========================================\n  // ValidationRuleManager - \n  // ========================================\n  const STORAGE_KEY_VALIDATION_RULES = 'acu_validation_rules_v1';\n  const STORAGE_KEY_VALIDATION_ENABLED = 'acu_validation_enabled_v1';\n  const STORAGE_KEY_VALIDATION_MODE = 'acu_validation_mode'; // \n\n  //  UI \n  const RULE_TYPE_INFO = {\n    // \n    tableReadonly: { name: '', scope: 'table', icon: 'fa-lock', desc: '' },\n    rowLimit: { name: '', scope: 'table', icon: 'fa-arrows-up-down', desc: '' },\n    sequence: { name: '', scope: 'table', icon: 'fa-sort-numeric-up', desc: '' },\n    // \n    required: { name: '', scope: 'field', icon: 'fa-asterisk', desc: '' },\n    format: { name: '', scope: 'field', icon: 'fa-font', desc: '' },\n    enum: { name: '', scope: 'field', icon: 'fa-list', desc: '' },\n    numeric: { name: '', scope: 'field', icon: 'fa-hashtag', desc: '' },\n    relation: { name: '', scope: 'field', icon: 'fa-link', desc: '' },\n    keyValue: { name: '', scope: 'field', icon: 'fa-key', desc: '' },\n  };\n\n  // \n  const BUILTIN_VALIDATION_RULES = [\n    // \n    {\n      id: 'summary_code_sequence',\n      name: '',\n      description: 'AM0001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM0001',\n    },\n    // \n    {\n      id: 'outline_code_sequence',\n      name: '',\n      description: 'AM0001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM0001',\n    },\n    // \n    {\n      id: 'summary_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'outline_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '(Enum Tag)',\n      ruleType: 'enum',\n      config: { values: ['', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_priority_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_progress_format',\n      name: '',\n      description: '0%~100%',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '(%)',\n      ruleType: 'format',\n      config: { pattern: '^(100|[1-9]?\\\\d)%$' },\n      errorMessage: '0%~100%0%50%100%',\n    },\n    // \n    {\n      id: 'equip_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'item_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_proficiency_range',\n      name: '',\n      description: ' 0-100 ',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'numeric',\n      config: { min: 0, max: 100 },\n      errorMessage: ' 0-100 ',\n    },\n    // \n    {\n      id: 'npc_presence_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_explore_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'intel_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'player_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // NPC\n    {\n      id: 'npc_location_relation',\n      name: 'NPC',\n      description: 'NPC',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'element_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'global_detail_location_relation',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    //  - \n    {\n      id: 'player_base_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_special_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_relationships_keyvalue',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    //  - \n    {\n      id: 'npc_base_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_special_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_relationships_keyvalue',\n      name: 'NPC',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    // \n    {\n      id: 'option_table_single_row',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: null,\n      ruleType: 'rowLimit',\n      config: { min: 0, max: 1 },\n      errorMessage: '',\n    },\n  ];\n\n  // ========================================\n  // BlacklistManager - MVU\n  // ========================================\n  const STORAGE_KEY_BLACKLIST = 'acu_filter_blacklist_v1';\n  const STORAGE_KEY_BLACKLIST_VERSION = 'acu_filter_blacklist_version';\n  const DEFAULT_BLACKLIST = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    'ID',\n    '',\n    '',\n    'measurements',\n    'ages',\n    '',\n    'order',\n    '',\n    'time',\n    'cost',\n    'chapter',\n    'location',\n    'calendar',\n    'day',\n    'year',\n    'month',\n  ];\n\n  const BlacklistManager = {\n    // \n    getBlacklist() {\n      const stored = Store.get(STORAGE_KEY_BLACKLIST, null);\n      const storedVersion = Store.get(STORAGE_KEY_BLACKLIST_VERSION, null);\n\n      // \n      if (!stored || !Array.isArray(stored)) {\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return [...DEFAULT_BLACKLIST];\n      }\n\n      // \n      if (!storedVersion || compareVersion(storedVersion, PRESET_FORMAT_VERSION) < 0) {\n        console.log(`[DICE]BlacklistManager  (${storedVersion || ''})`);\n\n        // \n        const userItems = new Set(stored);\n        const defaultItems = new Set(DEFAULT_BLACKLIST);\n        const mergedItems = [...DEFAULT_BLACKLIST]; // \n\n        // \n        stored.forEach(item => {\n          if (!defaultItems.has(item)) {\n            mergedItems.push(item);\n          }\n        });\n\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, mergedItems);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return mergedItems;\n      }\n\n      return stored;\n    },\n\n    // \n    setBlacklist(list) {\n      if (!Array.isArray(list)) {\n        console.warn('[DICE]BlacklistManager ');\n        return false;\n      }\n      Store.set(STORAGE_KEY_BLACKLIST, list);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // \n    resetToDefault() {\n      Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // key\n    //  \" >  >  > \" \"\"\n    isBlacklisted(key) {\n      if (!key || typeof key !== 'string') return false;\n      const blacklist = this.getBlacklist();\n      if (blacklist.length === 0) return false;\n\n      // key \">\"  \" > \"\n      const parts = key\n        .split(/>| > /)\n        .map(s => s.trim())\n        .filter(s => s);\n      const lastPart = parts.length > 0 ? parts[parts.length - 1] : key;\n\n      // key\n      return blacklist.some(item => lastPart.includes(item));\n    },\n  };\n\n  // ========================================\n  // PresetManager - \n  // ========================================\n  const STORAGE_KEY_PRESETS = 'acu_validation_presets_v1';\n  const STORAGE_KEY_ACTIVE_PRESET = 'acu_active_preset_id';\n\n  const PresetManager = {\n    _cache: null,\n\n    // \n    getAllPresets() {\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n      if (!stored) {\n        this._initDefaultPreset();\n        return this._cache;\n      }\n\n      let needsSave = false;\n      stored.forEach(preset => {\n        if (!preset.version || this._compareVersion(preset.version, PRESET_FORMAT_VERSION) < 0) {\n          console.log(\n            `[DICE]PresetManager  \"${preset.name}\"  (${preset.version || ''})`,\n          );\n\n          if (preset.id === 'default') {\n            // \n            const customRules = preset.rules.filter(r => !r.builtin);\n            // \n            const existingBuiltinMap = new Map();\n            preset.rules\n              .filter(r => r.builtin)\n              .forEach(r => {\n                const key = r.id || r.targetTable + '_' + r.ruleType;\n                existingBuiltinMap.set(key, { enabled: r.enabled, intercept: r.intercept });\n              });\n            // \n            preset.rules = [\n              ...BUILTIN_VALIDATION_RULES.map(r => {\n                const key = r.id || r.targetTable + '_' + r.ruleType;\n                const existing = existingBuiltinMap.get(key);\n                return {\n                  ...r,\n                  builtin: true,\n                  ...(existing ? { enabled: existing.enabled, intercept: existing.intercept } : {}),\n                };\n              }),\n              ...customRules,\n            ];\n          } else {\n            // \n            this._mergeBuiltinRules(preset);\n          }\n\n          preset.version = PRESET_FORMAT_VERSION;\n          needsSave = true;\n        }\n      });\n\n      if (needsSave) {\n        this._save(stored);\n        ValidationRuleManager.clearCache();\n        this._cache = null;\n      }\n\n      if (!needsSave && this._cache) {\n        return this._cache;\n      }\n      this._cache = stored;\n      return stored;\n    },\n\n    // \n    getActivePreset() {\n      const presets = this.getAllPresets();\n      const activeId = Store.get(STORAGE_KEY_ACTIVE_PRESET, 'default');\n      return presets.find(p => p.id === activeId) || presets[0];\n    },\n\n    // \n    setActivePreset(id) {\n      if (!this.getAllPresets().find(p => p.id === id)) return false;\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, id);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    createPreset(name) {\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: name || '',\n        builtin: false,\n        rules: [],\n        version: PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    duplicatePreset(id) {\n      const source = this.getAllPresets().find(p => p.id === id);\n      if (!source) return null;\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: source.name + ' ()',\n        builtin: false,\n        rules: JSON.parse(JSON.stringify(source.rules)),\n        version: source.version || PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      console.log('[DICE]PresetManager :', source.name, '->', newPreset.name);\n      return newPreset;\n    },\n\n    //  id='default' \n    deletePreset(id) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset || preset.id === 'default') return false; // \n      const filtered = presets.filter(p => p.id !== id);\n      this._save(filtered);\n      if (Store.get(STORAGE_KEY_ACTIVE_PRESET) === id) {\n        Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n        ValidationRuleManager.clearCache();\n      }\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    updatePresetRules(id, rules) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return false;\n      preset.rules = rules;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      return true;\n    },\n\n    // \n    exportPreset(id) {\n      const preset = this.getAllPresets().find(p => p.id === id);\n      if (!preset) return null;\n      const json = JSON.stringify(\n        {\n          format: 'acu_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          preset: { name: preset.name, rules: preset.rules },\n        },\n        null,\n        2,\n      );\n      return json;\n    },\n\n    // \n    _compareVersion(v1, v2) {\n      return compareVersion(v1, v2);\n    },\n\n    // \n    mergePresetWithDefaults(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) return false;\n\n      // \n      const customRules = preset.rules.filter(r => !r.builtin);\n      const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n\n      // \n      const builtinRuleMap = new Map();\n      BUILTIN_VALIDATION_RULES.forEach(r => {\n        const key = r.id || r.targetTable + '_' + r.ruleType;\n        builtinRuleMap.set(key, r);\n      });\n\n      // \n      const mergedRules = [];\n      const processedCustomIds = new Set();\n\n      // 1. \n      BUILTIN_VALIDATION_RULES.forEach(newRule => {\n        const key = newRule.id || newRule.targetTable + '_' + newRule.ruleType;\n        const existingRule = preset.rules.find(r => (r.id || r.targetTable + '_' + r.ruleType) === key && r.builtin);\n        if (existingRule) {\n          // \n          const isModified = JSON.stringify(existingRule) !== JSON.stringify(newRule);\n          if (isModified) {\n            // \n            mergedRules.push({ ...existingRule, builtin: true });\n          } else {\n            // \n            mergedRules.push({ ...newRule, builtin: true });\n          }\n        } else {\n          // \n          mergedRules.push({ ...newRule, builtin: true });\n        }\n        processedCustomIds.add(key);\n      });\n\n      // 2. \n      customRules.forEach(rule => {\n        const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n        if (!builtinRuleIds.has(key)) {\n          mergedRules.push({ ...rule, builtin: false });\n        }\n      });\n\n      preset.rules = mergedRules;\n      preset.version = PRESET_FORMAT_VERSION;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', preset.name);\n      return true;\n    },\n\n    // \n    importPreset(json, autoMerge = false) {\n      try {\n        const data = JSON.parse(json);\n        if (data.format !== 'acu_preset_v1' || !data.preset) return null;\n\n        const importedVersion = data.version || '0.0.0';\n        const needsMerge = this._compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n        const presets = this.getAllPresets();\n        const newPreset = {\n          id: 'imported_' + Date.now(),\n          name: data.preset.name || '',\n          builtin: false,\n          rules: data.preset.rules || [],\n          version: importedVersion,\n          createdAt: new Date().toISOString(),\n        };\n\n        // \n        if (needsMerge && autoMerge) {\n          presets.push(newPreset);\n          this._save(presets);\n          this.mergePresetWithDefaults(newPreset.id);\n          console.log('[DICE]PresetManager :', newPreset.name);\n        } else {\n          presets.push(newPreset);\n          this._save(presets);\n          console.log('[DICE]PresetManager :', newPreset.name);\n          if (needsMerge) {\n            console.warn('[DICE]PresetManager  mergePresetWithDefaults ');\n          }\n        }\n\n        return { preset: newPreset, needsMerge: needsMerge && !autoMerge };\n      } catch (e) {\n        console.error('[DICE]PresetManager :', e);\n        return null;\n      }\n    },\n\n    // \n    _initDefaultPreset() {\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n\n      //  getAllPresets \n      if (stored && Array.isArray(stored)) {\n        this._cache = stored;\n        return;\n      }\n\n      // \n      const defaultPreset = {\n        id: 'default',\n        name: '',\n        builtin: true,\n        rules: BUILTIN_VALIDATION_RULES.map(r => ({ ...r })),\n        version: PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n\n      // \n      const oldCustom = Store.get(STORAGE_KEY_VALIDATION_RULES, []);\n      if (oldCustom.length > 0) {\n        defaultPreset.rules.push(...oldCustom.map(r => ({ ...r, builtin: false })));\n        console.log('[DICE]PresetManager :', oldCustom.length, '');\n      }\n\n      this._cache = [defaultPreset];\n      this._save(this._cache);\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n    },\n\n    // \n    resetDefaultPreset() {\n      const presets = this.getAllPresets();\n      const defaultPreset = presets.find(p => p.id === 'default');\n      if (defaultPreset) {\n        // \n        const customRules = defaultPreset.rules.filter(r => !r.builtin);\n        defaultPreset.rules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r })), ...customRules];\n        defaultPreset.version = PRESET_FORMAT_VERSION;\n        this._save(presets);\n        ValidationRuleManager.clearCache();\n        return true;\n      }\n      return false;\n    },\n\n    // \n    _mergeBuiltinRules(preset) {\n      const customRules = preset.rules.filter(r => !r.builtin);\n      const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n\n      // \n      const existingBuiltinMap = new Map();\n      preset.rules\n        .filter(r => r.builtin)\n        .forEach(r => {\n          const key = r.id || r.targetTable + '_' + r.ruleType;\n          existingBuiltinMap.set(key, r);\n        });\n\n      const mergedRules = [];\n\n      // \n      BUILTIN_VALIDATION_RULES.forEach(newRule => {\n        const key = newRule.id || newRule.targetTable + '_' + newRule.ruleType;\n        const existing = existingBuiltinMap.get(key);\n        if (existing) {\n          // \n          mergedRules.push({\n            ...newRule,\n            enabled: existing.enabled,\n            intercept: existing.intercept,\n            errorMessage: existing.errorMessage,\n            builtin: true,\n          });\n        } else {\n          mergedRules.push({ ...newRule, builtin: true });\n        }\n      });\n\n      // ID\n      customRules.forEach(rule => {\n        const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n        if (!builtinRuleIds.has(key)) {\n          mergedRules.push({ ...rule, builtin: false });\n        }\n      });\n\n      preset.rules = mergedRules;\n    },\n\n    _save(presets) {\n      Store.set(STORAGE_KEY_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  //  PresetManager \n  const ValidationRuleManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const preset = PresetManager.getActivePreset();\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = (preset?.rules || []).map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_VALIDATION_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n      this._cache = null; // \n    },\n\n    // \n    toggleRuleIntercept(ruleId, intercept) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const rule = preset.rules.find(r => r.id === ruleId);\n      if (!rule) return false;\n\n      rule.intercept = intercept;\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled);\n    },\n\n    // \n    addCustomRule(rule) {\n      if (!rule.id || !rule.name || !rule.targetTable) {\n        console.error('[DICE]ValidationRuleManager ');\n        return false;\n      }\n\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      //  ID \n      if (preset.rules.some(r => r.id === rule.id)) {\n        console.error('[DICE]ValidationRuleManager  ID :', rule.id);\n        return false;\n      }\n\n      const newRule = { ...rule, builtin: false, enabled: true };\n      preset.rules.push(newRule);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      console.log('[DICE]ValidationRuleManager :', newRule.name);\n      return true;\n    },\n\n    // \n    removeCustomRule(ruleId) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules.splice(index, 1);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n\n      // \n      const states = this.getEnabledStates();\n      delete states[ruleId];\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n\n      console.log('[DICE]ValidationRuleManager :', ruleId);\n      return true;\n    },\n\n    // \n    updateCustomRule(ruleId, updates) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules[index] = { ...preset.rules[index], ...updates, id: ruleId };\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getRule(ruleId) {\n      return this.getAllRules().find(r => r.id === ruleId);\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n\n    // \n    getRulesByTable(tableName) {\n      return this.getEnabledRules().filter(\n        rule => rule.targetTable === tableName || (isNpcTableName(rule.targetTable) && isNpcTableName(tableName)),\n      );\n    },\n  };\n\n  // ========================================\n  // RegexTransformationManager -  (Phase 1.2)\n  // ========================================\n  const RegexTransformationManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // ID\n    _generateId() {\n      return `regex_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    },\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      //  enabled  enabledStates \n      // \n      this._cache = rules;\n      return rules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_REGEX_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    _saveEnabledStates(states) {\n      Store.set(STORAGE_KEY_REGEX_ENABLED, states);\n      this._enabledCache = states;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled !== false);\n    },\n\n    // \n    getApplicableRules(tableName, columnName) {\n      const allRules = this.getEnabledRules();\n\n      return allRules\n        .filter(rule => {\n          // \n          switch (rule.scope.type) {\n            case 'global':\n              return true;\n            case 'table':\n              return rule.scope.tableNames && rule.scope.tableNames.includes(tableName);\n            case 'column':\n              return (\n                rule.scope.tableNames &&\n                rule.scope.tableNames.includes(tableName) &&\n                rule.scope.columnNames &&\n                rule.scope.columnNames.includes(columnName)\n              );\n            default:\n              return false;\n          }\n        })\n        .sort((a, b) => b.priority - a.priority); // \n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      //  STORAGE_KEY_REGEX_RULES \n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const ruleIndex = rules.findIndex(r => r.id === ruleId);\n      if (ruleIndex !== -1) {\n        rules[ruleIndex].enabled = enabled;\n        Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      }\n\n      // \n      const activePreset = RegexPresetManager.getActivePreset();\n      if (activePreset) {\n        RegexPresetManager.updatePresetRules(activePreset.id, rules);\n      }\n\n      this.clearCache();\n    },\n\n    // \n    addCustomRule(rule) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n\n      // \n      if (!rule.name || !rule.pattern || !rule.scope) {\n        console.error('[DICE]RegexTransformationManager: ');\n        return false;\n      }\n\n      const newRule: RegexTransformationRule = {\n        id: this._generateId(),\n        name: rule.name,\n        description: rule.description,\n        operation: rule.operation || 'replace',\n        pattern: rule.pattern,\n        flags: rule.flags || {},\n        replacement: rule.replacement,\n        scope: rule.scope,\n        enabled: rule.enabled !== undefined ? rule.enabled : true,\n        priority: rule.priority || 50,\n        executeMode: rule.executeMode || 'auto',\n        testCases: rule.testCases || [],\n        security: rule.security || { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      rules.push(newRule);\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n\n      // \n      this._syncRulesToActivePreset();\n\n      return newRule;\n    },\n\n    // \n    _syncRulesToActivePreset() {\n      const activePreset = RegexPresetManager.getActivePreset();\n      if (activePreset) {\n        const allRules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n        RegexPresetManager.updatePresetRules(activePreset.id, allRules);\n      }\n    },\n\n    // \n    removeRule(ruleId) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const index = rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      rules.splice(index, 1);\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n\n      // \n      this._syncRulesToActivePreset();\n\n      return true;\n    },\n\n    // \n    updateRule(ruleId, updates) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const index = rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      rules[index] = {\n        ...rules[index],\n        ...updates,\n        id: ruleId,\n        updatedAt: Date.now(),\n      };\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n\n      // \n      this._syncRulesToActivePreset();\n\n      return true;\n    },\n\n    // \n    getRule(ruleId) {\n      return this.getAllRules().find(r => r.id === ruleId);\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n  };\n\n  // ========================================\n  // RegexPresetManager -  (Phase 1.3)\n  // ========================================\n  const RegexPresetManager = {\n    _cache: null,\n\n    //  compareVersion\n    _compareVersion(v1, v2) {\n      return compareVersion(v1, v2);\n    },\n\n    // \n    getAllPresets() {\n      const stored = Store.get(STORAGE_KEY_REGEX_PRESETS, null);\n\n      // \n      if (!stored || stored.length === 0) {\n        const defaultPreset: RegexPreset = {\n          id: 'regex_default',\n          name: '',\n          description: '',\n          version: PRESET_FORMAT_VERSION,\n          rules: BUILTIN_REGEX_RULES.map(r => ({ ...r, builtin: true })),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n        this._cache = [defaultPreset];\n        Store.set(STORAGE_KEY_REGEX_PRESETS, this._cache);\n        return this._cache;\n      }\n\n      // \n      let needsSave = false;\n      stored.forEach(preset => {\n        if (!preset.version || this._compareVersion(preset.version, PRESET_FORMAT_VERSION) < 0) {\n          console.log(\n            `[DICE]RegexPresetManager  \"${preset.name}\"  (${preset.version || ''})`,\n          );\n\n          if (preset.id === 'regex_default') {\n            // \n            const customRules = (preset.rules || []).filter(r => !r.builtin);\n            // \n            const existingBuiltinMap = new Map();\n            (preset.rules || [])\n              .filter(r => r.builtin)\n              .forEach(r => {\n                existingBuiltinMap.set(r.id, { enabled: r.enabled });\n              });\n            // \n            preset.rules = [\n              ...BUILTIN_REGEX_RULES.map(r => {\n                const existing = existingBuiltinMap.get(r.id);\n                return {\n                  ...r,\n                  builtin: true,\n                  ...(existing ? { enabled: existing.enabled } : {}),\n                };\n              }),\n              ...customRules,\n            ];\n          } else {\n            // \n            this._mergeBuiltinRules(preset);\n          }\n\n          preset.version = PRESET_FORMAT_VERSION;\n          preset.updatedAt = Date.now();\n          needsSave = true;\n        }\n      });\n\n      if (needsSave) {\n        this._save(stored);\n        RegexTransformationManager.clearCache();\n        this._cache = null;\n      }\n\n      if (!needsSave && this._cache) {\n        return this._cache;\n      }\n      this._cache = stored;\n      return stored;\n    },\n\n    // \n    _mergeBuiltinRules(preset) {\n      const customRules = (preset.rules || []).filter(r => !r.builtin);\n      const builtinRuleIds = new Set(BUILTIN_REGEX_RULES.map(r => r.id));\n\n      // \n      const existingBuiltinMap = new Map();\n      (preset.rules || [])\n        .filter(r => r.builtin)\n        .forEach(r => {\n          existingBuiltinMap.set(r.id, r);\n        });\n\n      const mergedRules = [];\n\n      // \n      BUILTIN_REGEX_RULES.forEach(newRule => {\n        const existing = existingBuiltinMap.get(newRule.id);\n        if (existing) {\n          // \n          mergedRules.push({\n            ...newRule,\n            enabled: existing.enabled,\n            builtin: true,\n          });\n        } else {\n          mergedRules.push({ ...newRule, builtin: true });\n        }\n      });\n\n      // ID\n      customRules.forEach(rule => {\n        if (!builtinRuleIds.has(rule.id)) {\n          mergedRules.push({ ...rule, builtin: false });\n        }\n      });\n\n      preset.rules = mergedRules;\n    },\n\n    // \n    getActivePreset() {\n      const activeId = Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET, 'regex_default');\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === activeId) || presets[0];\n\n      // \n      // \n      const storedRules: RegexTransformationRule[] = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      if (preset && preset.rules && preset.rules.length > 0) {\n        //  builtin \n        const storedRuleIds = new Set(storedRules.map(r => r.id));\n        const missingBuiltinRules = preset.rules.filter(r => r.builtin && !storedRuleIds.has(r.id));\n\n        if (missingBuiltinRules.length > 0) {\n          // \n          const mergedRules = [...missingBuiltinRules, ...storedRules];\n          Store.set(STORAGE_KEY_REGEX_RULES, mergedRules);\n          RegexTransformationManager.clearCache();\n          console.log(`[DICE]RegexPresetManager:  ${missingBuiltinRules.length} `);\n        }\n      }\n\n      return preset;\n    },\n\n    // \n    setActivePreset(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) {\n        console.error('[DICE]RegexPresetManager: ', presetId);\n        return false;\n      }\n\n      Store.set(STORAGE_KEY_REGEX_ACTIVE_PRESET, presetId);\n\n      // \n      Store.set(STORAGE_KEY_REGEX_RULES, preset.rules || []);\n\n      // RegexTransformationManager\n      RegexTransformationManager.clearCache();\n\n      return true;\n    },\n\n    // \n    createPreset(name, sourcePresetId) {\n      const presets = this.getAllPresets();\n\n      // \n      if (presets.some(p => p.name === name)) {\n        console.error('[DICE]RegexPresetManager: ', name);\n        return false;\n      }\n\n      const sourcePreset = sourcePresetId ? presets.find(p => p.id === sourcePresetId) : this.getActivePreset();\n\n      const newPreset: RegexPreset = {\n        id: `regex_preset_${Date.now()}`,\n        name: name,\n        description: sourcePreset?.description,\n        version: PRESET_FORMAT_VERSION,\n        rules: sourcePreset ? JSON.parse(JSON.stringify(sourcePreset.rules)) : [],\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    updatePresetRules(presetId, rules) {\n      const presets = this.getAllPresets();\n      const index = presets.findIndex(p => p.id === presetId);\n      if (index === -1) return false;\n\n      presets[index].rules = JSON.parse(JSON.stringify(rules));\n      presets[index].updatedAt = Date.now();\n\n      this._save(presets);\n\n      // ,\n      if (presetId === Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET)) {\n        RegexTransformationManager.clearCache();\n      }\n\n      return true;\n    },\n\n    // \n    deletePreset(presetId) {\n      const presets = this.getAllPresets();\n\n      // \n      if (presets.length <= 1) {\n        console.error('[DICE]RegexPresetManager: ');\n        return false;\n      }\n\n      const index = presets.findIndex(p => p.id === presetId);\n      if (index === -1) return false;\n\n      presets.splice(index, 1);\n      this._save(presets);\n\n      // ,\n      if (presetId === Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET)) {\n        this.setActivePreset(presets[0].id);\n      }\n\n      return true;\n    },\n\n    // JSON\n    exportPreset(presetId) {\n      const preset = this.getAllPresets().find(p => p.id === presetId);\n      if (!preset) return null;\n\n      // \n      const activePreset = this.getActivePreset();\n      const isActivePreset = activePreset && activePreset.id === presetId;\n      const rules = isActivePreset ? Store.get(STORAGE_KEY_REGEX_RULES, []) : preset.rules;\n\n      const exportData = {\n        ...preset,\n        rules: rules,\n      };\n\n      return JSON.stringify(exportData, null, 2);\n    },\n\n    // JSON\n    importPreset(jsonString) {\n      try {\n        const data = JSON.parse(jsonString);\n\n        // \n        if (!data.name || !Array.isArray(data.rules)) {\n          console.error('[DICE]RegexPresetManager: ');\n          return false;\n        }\n\n        const presets = this.getAllPresets();\n\n        // ID\n        const newPreset: RegexPreset = {\n          id: `regex_preset_${Date.now()}`,\n          name: data.name,\n          description: data.description,\n          version: data.version || PRESET_FORMAT_VERSION,\n          rules: data.rules.map((rule: RegexTransformationRule) => ({\n            ...rule,\n            id: RegexTransformationManager._generateId(),\n          })),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n\n        presets.push(newPreset);\n        this._save(presets);\n        return newPreset;\n      } catch (e) {\n        console.error('[DICE]RegexPresetManager: ', e);\n        return false;\n      }\n    },\n\n    // \n    _save(presets) {\n      Store.set(STORAGE_KEY_REGEX_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  // ========================================\n  // RegexTransformationEngine -  (Phase 2.1)\n  // ========================================\n  const RegexTransformationEngine = {\n    // \n    _regexCache: new Map<string, RegExp>(),\n\n    // \n    _buildFlags(flags: RegexFlags): string {\n      const result: string[] = [];\n      if (flags.caseInsensitive) result.push('i');\n      if (flags.global) result.push('g');\n      if (flags.multiline) result.push('m');\n      if (flags.unicode) result.push('u');\n      if (flags.sticky) result.push('y');\n      return result.join('');\n    },\n\n    // ()\n    _getRegex(pattern: string, flags: RegexFlags): RegExp | null {\n      //  unicode \n      const hasLookbehind = pattern.includes('(?<') || pattern.includes('(?<=');\n      const hasLookahead = pattern.includes('(?=') || pattern.includes('(?!');\n      const needsUnicode = hasLookbehind || hasLookahead;\n\n      //  unicode \n      if (needsUnicode && !flags.unicode) {\n        flags = { ...flags, unicode: true };\n      }\n\n      const flagsStr = this._buildFlags(flags);\n      const cacheKey = `${pattern}/${flagsStr}`;\n\n      if (this._regexCache.has(cacheKey)) {\n        const regex = this._regexCache.get(cacheKey)!;\n        regex.lastIndex = 0;\n        return regex;\n      }\n\n      try {\n        const regex = new RegExp(pattern, flagsStr);\n        this._regexCache.set(cacheKey, regex);\n        return regex;\n      } catch (e) {\n        console.error('[DICE]RegexTransformationEngine: ', pattern, e);\n        return null;\n      }\n    },\n\n    // ReDoS: \n    _scoreRegexComplexity(pattern: string): number {\n      let score = 0;\n\n      //  +50\n      if (/(\\*|\\+|\\{)\\1{2,}/.test(pattern)) score += 50;\n\n      //  +30\n      if (/(\\.\\*|\\.\\+)[^\\[]*\\1/.test(pattern)) score += 30;\n\n      //  +10\n      const captureGroups = (pattern.match(/\\(/g) || []).length;\n      score += Math.min(captureGroups * 5, 20);\n\n      return score;\n    },\n\n    // ReDoS: \n    _getTimeoutForRule(rule: RegexTransformationRule): number {\n      const complexity = this._scoreRegexComplexity(rule.pattern);\n      const baseTimeout = rule.security?.maxMatchTime || 100;\n      // ,\n      return Math.max(baseTimeout - complexity * 2, 50);\n    },\n\n    // \n    _safeReplace(value: string, rule: RegexTransformationRule, regex: RegExp): RegexTransformResult {\n      const oldValue = value;\n\n      // \n      const maxInputLength = rule.security?.maxInputLength || 10000;\n      if (value.length > maxInputLength) {\n        return {\n          success: false,\n          oldValue,\n          newValue: oldValue,\n          matched: false,\n          error: `(${maxInputLength})`,\n        };\n      }\n\n      try {\n        const timeout = this._getTimeoutForRule(rule);\n        const startTime = Date.now();\n\n        // \n        let newValue: string;\n        switch (rule.operation) {\n          case 'replace':\n            newValue = value.replace(regex, rule.replacement || '');\n            break;\n          case 'delete':\n            newValue = value.replace(regex, '');\n            break;\n          case 'validate':\n            const isValid = regex.test(value);\n            newValue = value;\n            break;\n          default:\n            newValue = value;\n        }\n\n        // \n        const elapsed = Date.now() - startTime;\n        if (elapsed > timeout) {\n          console.warn('[DICE]RegexTransformationEngine: ', rule.pattern, elapsed);\n          return {\n            success: false,\n            oldValue,\n            newValue: oldValue,\n            matched: false,\n            error: `(${elapsed}ms > ${timeout}ms)`,\n          };\n        }\n\n        // \n        const matched = oldValue !== newValue || regex.test(oldValue);\n\n        return {\n          success: true,\n          oldValue,\n          newValue,\n          matched,\n        };\n      } catch (e) {\n        console.error('[DICE]RegexTransformationEngine: ', rule.pattern, e);\n        return {\n          success: false,\n          oldValue,\n          newValue: oldValue,\n          matched: false,\n          error: String(e),\n        };\n      }\n    },\n\n    // \n    applyToValue(value: string, rule: RegexTransformationRule): RegexTransformResult {\n      if (value === null || value === undefined) {\n        return {\n          success: true,\n          oldValue: '',\n          newValue: '',\n          matched: false,\n        };\n      }\n\n      const strValue = String(value);\n\n      //  pattern  flags /pattern/flags\n      let pattern = rule.pattern;\n      let flags = rule.flags || {};\n\n      //  /pattern/flags \n      const extracted = this._extractFlags(pattern);\n      if (extracted.patternWithoutFlags !== pattern) {\n        //  pattern  flags\n        pattern = extracted.patternWithoutFlags;\n        flags = { ...flags, ...extracted.flags };\n      }\n\n      // \n      //  flags  global true\n      if (flags.global === undefined) {\n        flags.global = true;\n      }\n\n      const regex = this._getRegex(pattern, flags);\n\n      if (!regex) {\n        return {\n          success: false,\n          oldValue: strValue,\n          newValue: strValue,\n          matched: false,\n          error: '',\n        };\n      }\n\n      return this._safeReplace(strValue, rule, regex);\n    },\n\n    // flags (: /test/g  'g')\n    _extractFlags(patternStr: string): { flags: RegexFlags; patternWithoutFlags: string } {\n      const flags: RegexFlags = {\n        global: false,\n        caseInsensitive: false,\n        multiline: false,\n        unicode: false,\n        sticky: false,\n      };\n\n      //  /pattern/flags \n      const inlineFlagMatch = patternStr.match(/^\\/(.+)\\/([gimuy]*)$/);\n      if (inlineFlagMatch) {\n        const [, patternWithoutFlags, flagStr] = inlineFlagMatch;\n        if (flagStr.includes('g')) flags.global = true;\n        if (flagStr.includes('i')) flags.caseInsensitive = true;\n        if (flagStr.includes('m')) flags.multiline = true;\n        if (flagStr.includes('u')) flags.unicode = true;\n        if (flagStr.includes('y')) flags.sticky = true;\n        return { flags, patternWithoutFlags };\n      }\n\n      // flags\n      return { flags, patternWithoutFlags: patternStr };\n    },\n\n    // \n    applyToTable(\n      tableData:\n        | { name: string; headers: string[]; rows: string[][] }\n        | { [key: string]: { name?: string; content?: string[][] } },\n      rules: RegexTransformationRule[],\n    ): { totalApplied: number; errors: string[]; modifiedSheetKeys: string[] } {\n      let totalApplied = 0;\n      const errors: string[] = [];\n      const modifiedSheetKeys: string[] = [];\n\n      try {\n        // \n        let isSimpleFormat = false;\n        let sheetMap: Map<\n          string,\n          { sheet: any; sheetKey: string; name: string; headers: string[]; contentRowIndex: number }\n        > = new Map();\n\n        if ('name' in tableData && 'headers' in tableData && 'rows' in tableData) {\n          // : { name, headers, rows }\n          isSimpleFormat = true;\n          const simpleTable = tableData as { name: string; headers: string[]; rows: string[][] };\n          sheetMap.set(simpleTable.name, {\n            sheet: simpleTable,\n            sheetKey: simpleTable.name,\n            name: simpleTable.name,\n            headers: simpleTable.headers,\n            contentRowIndex: -1, //  contentRowIndex\n          });\n        } else {\n          // : { sheet_xxx: { name, content: [headers, ...rows] } }\n          const dataObj = tableData as { [key: string]: { name?: string; content?: string[][] } };\n\n          Object.keys(dataObj).forEach(sheetKey => {\n            if (!sheetKey.startsWith('sheet_')) return;\n\n            const sheet = dataObj[sheetKey];\n            if (!sheet || !sheet.content || !Array.isArray(sheet.content) || sheet.content.length < 1) {\n              console.warn(`[DICE]applyToTable:  ${sheetKey}`);\n              return;\n            }\n\n            const tableName = sheet.name || sheetKey;\n            sheetMap.set(tableName, {\n              sheet,\n              sheetKey,\n              name: tableName,\n              headers: sheet.content[0] || [],\n              contentRowIndex: 0, //  content[0]\n            });\n          });\n        }\n\n        if (sheetMap.size === 0) {\n          console.warn('[DICE]applyToTable: ');\n          return { totalApplied: 0, errors: [''], modifiedSheetKeys: [] };\n        }\n\n        // \n        for (const [tableName, tableInfo] of sheetMap.entries()) {\n          const { sheet, headers, sheetKey } = tableInfo;\n          let tableModified = false;\n\n          for (const rule of rules) {\n            if (!rule.enabled) continue;\n\n            // \n            const scope = rule.scope;\n            const shouldProcessTable = scope.type === 'global' || scope.tableNames?.includes(tableName);\n\n            if (!shouldProcessTable) continue;\n\n            try {\n              // \n              if (isSimpleFormat) {\n                //  rows\n                const rows = (sheet as { rows: string[][] }).rows;\n                for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {\n                  const row = rows[rowIndex];\n\n                  // \n                  for (let colIndex = 0; colIndex < row.length; colIndex++) {\n                    const columnName = headers[colIndex];\n\n                    // \n                    if (scope.type === 'column') {\n                      if (!scope.columnNames?.includes(columnName)) continue;\n                    }\n\n                    // \n                    const result = this.applyToValue(row[colIndex], rule);\n                    if (result.success) {\n                      if (result.matched) {\n                        row[colIndex] = result.newValue;\n                        totalApplied++;\n                        tableModified = true;\n                      }\n                    } else {\n                      errors.push(`${rule.name} [${tableName}]: ${result.error}`);\n                    }\n                  }\n                }\n              } else {\n                //  content  content[1] \n                const content = sheet.content;\n                for (let contentRowIndex = 1; contentRowIndex < content.length; contentRowIndex++) {\n                  const row = content[contentRowIndex];\n                  if (!Array.isArray(row)) continue;\n\n                  // \n                  for (let colIndex = 0; colIndex < row.length; colIndex++) {\n                    const columnName = headers[colIndex];\n\n                    // \n                    if (scope.type === 'column') {\n                      if (!scope.columnNames?.includes(columnName)) continue;\n                    }\n\n                    // \n                    const oldValue = row[colIndex];\n                    const result = this.applyToValue(oldValue, rule);\n\n                    if (result.success) {\n                      if (result.matched) {\n                        row[colIndex] = result.newValue;\n                        totalApplied++;\n                        tableModified = true;\n                        console.debug(\n                          `[DICE]: ${tableName}[${contentRowIndex}].${columnName}`,\n                          `\"${result.oldValue}\" -> \"${result.newValue}\"`,\n                        );\n                      }\n                    } else {\n                      errors.push(`${rule.name} [${tableName}]: ${result.error}`);\n                    }\n                  }\n                }\n              }\n            } catch (tableError) {\n              const errorMsg = tableError instanceof Error ? tableError.message : String(tableError);\n              console.error(`[DICE]applyToTable:  ${tableName} :`, tableError);\n              errors.push(`${rule.name} [${tableName}]:  - ${errorMsg}`);\n            }\n          }\n          if (tableModified && sheetKey) {\n            modifiedSheetKeys.push(sheetKey);\n          }\n        }\n\n        if (totalApplied > 0) {\n          console.info(`[DICE]applyToTable:  ${totalApplied} `);\n        }\n        if (errors.length > 0) {\n          console.warn(`[DICE]applyToTable:  ${errors.length} `);\n        }\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : String(e);\n        console.error('[DICE]applyToTable: :', e);\n        errors.push(`: ${errorMsg}`);\n      }\n\n      return { totalApplied, errors, modifiedSheetKeys };\n    },\n\n    // \n    applyToCell(\n      value: string,\n      tableName: string,\n      columnName: string,\n      executeMode?: RegexExecutionMode,\n    ): RegexTransformResult {\n      // \n      const rules = RegexTransformationManager.getApplicableRules(tableName, columnName);\n\n      // ,\n      if (rules.length === 0) {\n        return {\n          success: true,\n          oldValue: value || '',\n          newValue: value || '',\n          matched: false,\n        };\n      }\n\n      // \n      let applicableRules = rules;\n      if (executeMode) {\n        applicableRules = rules.filter(r => r.executeMode === executeMode || r.executeMode === 'auto');\n      }\n\n      if (applicableRules.length === 0) {\n        return {\n          success: true,\n          oldValue: value || '',\n          newValue: value || '',\n          matched: false,\n        };\n      }\n\n      // \n      let currentValue = value || '';\n      let wasMatched = false;\n\n      for (const rule of applicableRules) {\n        const result = this.applyToValue(currentValue, rule);\n        if (!result.success) {\n          return result;\n        }\n        if (result.matched) {\n          wasMatched = true;\n        }\n        currentValue = result.newValue;\n      }\n\n      return {\n        success: true,\n        oldValue: value || '',\n        newValue: currentValue,\n        matched: wasMatched,\n      };\n    },\n\n    // \n    applyToRow(row: string[], headers: string[], tableName: string, executeMode?: RegexExecutionMode): string[] {\n      return row.map((cell, index) => {\n        const columnName = headers[index];\n        const result = this.applyToCell(cell, tableName, columnName, executeMode);\n        return result.newValue;\n      });\n    },\n\n    // \n    previewBatchTransform(\n      tableData: { name: string; headers: string[]; rows: string[][] },\n      executeMode?: RegexExecutionMode,\n    ): RegexPreviewResult[] {\n      const tableName = tableData.name;\n      const rules = RegexTransformationManager.getApplicableRules(tableName, null).filter(\n        r => r.scope.type === 'global' || r.scope.tableNames?.includes(tableName),\n      );\n\n      const results: RegexPreviewResult[] = [];\n\n      for (const rule of rules) {\n        const affectedCells: RegexPreviewResult['affectedCells'] = [];\n        let totalAffected = 0;\n\n        for (let rowIndex = 0; rowIndex < tableData.rows.length; rowIndex++) {\n          const row = tableData.rows[rowIndex];\n          for (let colIndex = 0; colIndex < row.length; colIndex++) {\n            const columnName = tableData.headers[colIndex];\n            const value = row[colIndex];\n\n            // \n            if (rule.scope.type === 'column') {\n              if (!rule.scope.columnNames?.includes(columnName) || !rule.scope.tableNames?.includes(tableName)) {\n                continue;\n              }\n            } else if (rule.scope.type === 'table') {\n              if (!rule.scope.tableNames?.includes(tableName)) {\n                continue;\n              }\n            }\n\n            const result = this.applyToValue(value, rule);\n            if (result.matched && result.oldValue !== result.newValue) {\n              affectedCells.push({\n                tableName,\n                rowIndex,\n                columnIndex: colIndex,\n                columnName,\n                oldValue: result.oldValue,\n                newValue: result.newValue,\n              });\n              totalAffected++;\n            }\n          }\n        }\n\n        if (totalAffected > 0) {\n          results.push({\n            rule,\n            affectedCells,\n            totalAffected,\n          });\n        }\n      }\n\n      return results;\n    },\n\n    // \n    clearRegexCache() {\n      this._regexCache.clear();\n    },\n  };\n\n  // ========================================\n  // ValidationEngine - \n  // ========================================\n  const ValidationEngine = {\n    //  fallback\n    //  fallback \"\"\n    findColumnIndex(headers: (string | null)[], targetColumn: string): number {\n      // 1. \n      const exactIndex = headers.indexOf(targetColumn);\n      if (exactIndex !== -1) return exactIndex;\n\n      // 2.  fallback\n      for (let i = 0; i < headers.length; i++) {\n        const header = headers[i];\n        if (header && header.includes(targetColumn)) {\n          return i;\n        }\n      }\n\n      return -1; // \n    },\n\n    // \n    validateFormat(value, pattern) {\n      if (value === null || value === undefined || value === '') return true; // \n      try {\n        const regex = new RegExp(pattern);\n        return regex.test(String(value));\n      } catch (e) {\n        console.error('[DICE]ValidationEngine :', pattern, e);\n        return true; // \n      }\n    },\n\n    // \n    validateEnum(value, allowedValues) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!Array.isArray(allowedValues) || allowedValues.length === 0) return true;\n      return allowedValues.includes(String(value));\n    },\n\n    // \n    validateNumeric(value, min, max) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      //  \"50/100\"  \":80\" \n      const strVal = String(value);\n      let numVal;\n\n      //  \"50%\"\n      if (strVal.endsWith('%')) {\n        numVal = parseFloat(strVal);\n      }\n      //  \"50/100\"\n      else if (strVal.includes('/')) {\n        const parts = strVal.split('/');\n        numVal = parseFloat(parts[0]);\n      }\n      //  \":\" \n      else if (strVal.includes(':')) {\n        const parts = strVal.split(':');\n        numVal = parseFloat(parts[parts.length - 1]);\n      }\n      // \n      else {\n        numVal = parseFloat(strVal);\n      }\n\n      if (isNaN(numVal)) return false; // \n\n      if (min !== undefined && min !== null && numVal < min) return false;\n      if (max !== undefined && max !== null && numVal > max) return false;\n      return true;\n    },\n\n    //  OR \n    validateRelation(value, rawData, refTable, refColumn) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!rawData || !refTable || !refColumn) return true;\n\n      // \n      let refSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === refTable) {\n          refSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!refSheet || !refSheet.content || refSheet.content.length < 2) {\n        return true; // \n      }\n\n      const headers = refSheet.content[0];\n      const strVal = String(value);\n\n      //  refColumn \n      const columns = Array.isArray(refColumn) ? refColumn : [refColumn];\n\n      for (const col of columns) {\n        const refColIndex = headers.indexOf(col);\n        if (refColIndex === -1) continue; // \n\n        // \n        for (let i = 1; i < refSheet.content.length; i++) {\n          if (String(refSheet.content[i][refColIndex] || '') === strVal) {\n            return true; // \n          }\n        }\n      }\n\n      return columns.length === 0; //  true false\n    },\n\n    // \n    validateRequired(value) {\n      return value !== null && value !== undefined && String(value).trim() !== '';\n    },\n\n    // \n    validateKeyValue(value, ruleConfig) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      const valueType = ruleConfig?.valueType || 'text';\n      const valueMin = ruleConfig?.valueMin;\n      const valueMax = ruleConfig?.valueMax;\n\n      // \n      let processedValue = String(value);\n\n      // \n      processedValue = processedValue\n        .replace(//g, ':') //   \n        .replace(//g, ';') //   \n        .replace(//g, ';'); //   \n\n      // \n      processedValue = processedValue.replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n\n      if (pairs.length === 0) return false; // \n\n      // \n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          return false; // /\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) return false; // \n\n        // \n        if (valueType === 'numeric') {\n          // \n          if (!/^-?\\d+(\\.\\d+)?$/.test(val.trim())) return false; // \n\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) return false; // \n\n          if (valueMin !== undefined && valueMin !== null && numVal < valueMin) return false;\n          if (valueMax !== undefined && valueMax !== null && numVal > valueMax) return false;\n        }\n        // \n      }\n\n      return true;\n    },\n\n    // \n    validateTableReadonly(oldContent, newContent) {\n      if (!oldContent || !newContent) return true;\n      return JSON.stringify(oldContent) === JSON.stringify(newContent);\n    },\n\n    // \n    validateRowLimit(rowCount, min, max) {\n      if (min !== undefined && min !== null && rowCount < min) return false;\n      if (max !== undefined && max !== null && rowCount > max) return false;\n      return true;\n    },\n\n    // \n    validateSequence(sheet, columnName, config) {\n      if (!sheet || !sheet.content || sheet.content.length < 2) return true; // \n      if (!columnName || !config) return true;\n\n      const headers = sheet.content[0] || [];\n      const rows = sheet.content.slice(1) || [];\n      const colIndex = headers.indexOf(columnName);\n      if (colIndex < 0) return true; // \n\n      const prefix = config.prefix || '';\n      const startFrom = config.startFrom !== undefined ? config.startFrom : 1;\n\n      // \n      const numbers = [];\n      const allRowValues = []; // \n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        allRowValues.push({ rowIndex: i, rawValue: value, type: typeof value });\n        if (value === null || value === undefined || value === '') continue;\n\n        const strValue = String(value).trim();\n        if (!strValue) continue;\n\n        // +\n        if (prefix) {\n          const escapedPrefix = prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n          const regex = new RegExp(`^${escapedPrefix}(\\\\d+)$`);\n          const match = strValue.match(regex);\n          if (match) {\n            const num = parseInt(match[1], 10);\n            if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n          }\n        } else {\n          // \n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n        }\n      }\n\n      if (numbers.length === 0) return true; // \n\n      // \n      numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n      // \n      const numSet = new Set(numbers.map(n => n.num));\n      if (numSet.size !== numbers.length) {\n        return false; // \n      }\n\n      // startFrom\n      // startFromstartFrom+1\n      for (let i = 0; i < numbers.length; i++) {\n        const expectedNum = startFrom + i;\n        const actualNum = numbers[i].num;\n        if (actualNum !== expectedNum) {\n          return false; // startFrom\n        }\n      }\n\n      return true;\n    },\n\n    //  intercept \n    checkTableRules(snapshot, newData, rules) {\n      const violations = [];\n      if (!snapshot || !newData || !rules) return violations;\n\n      for (const rule of rules) {\n        // \n        if (!rule.enabled || !rule.intercept) continue;\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n        if (!typeInfo) continue;\n\n        // \n        let oldSheet = null,\n          newSheet = null;\n        for (const sheetId in snapshot) {\n          if (\n            snapshot[sheetId]?.name === rule.targetTable ||\n            (isNpcTableName(snapshot[sheetId]?.name) && isNpcTableName(rule.targetTable))\n          ) {\n            oldSheet = snapshot[sheetId];\n            break;\n          }\n        }\n        for (const sheetId in newData) {\n          if (\n            newData[sheetId]?.name === rule.targetTable ||\n            (isNpcTableName(newData[sheetId]?.name) && isNpcTableName(rule.targetTable))\n          ) {\n            newSheet = newData[sheetId];\n            break;\n          }\n        }\n\n        //  rowLimit  0 \n        if (!newSheet) {\n          if (rule.ruleType === 'rowLimit' && rule.config?.min && rule.config.min > 0) {\n            violations.push({\n              rule,\n              tableName: rule.targetTable,\n              message: rule.errorMessage || ` \"${rule.targetTable}\"  ( ${rule.config.min} )`,\n            });\n          }\n          continue;\n        }\n\n        // \n        if (typeInfo.scope === 'table') {\n          if (rule.ruleType === 'tableReadonly') {\n            if (!this.validateTableReadonly(oldSheet?.content, newSheet?.content)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message: rule.errorMessage || ` \"${rule.targetTable}\" `,\n              });\n            }\n          } else if (rule.ruleType === 'rowLimit') {\n            const rowCount = (newSheet.content?.length || 1) - 1; // \n            if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetTable}\"  ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n              });\n            }\n          } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n            // \n            if (!this.validateSequence(newSheet, rule.targetColumn, rule.config || {})) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(4, '0')}`,\n              });\n            }\n          }\n        }\n        // \n        else if (typeInfo.scope === 'field' && rule.targetColumn) {\n          const headers = newSheet.content?.[0] || [];\n          const colIndex = this.findColumnIndex(headers, rule.targetColumn);\n          if (colIndex === -1) continue;\n\n          // \n          for (let rowIdx = 1; rowIdx < (newSheet.content?.length || 0); rowIdx++) {\n            const row = newSheet.content[rowIdx];\n            const value = row?.[colIndex];\n            const isValid = this.validateValue(value, rule, newData);\n\n            if (!isValid) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                rowIndex: rowIdx,\n                columnName: rule.targetColumn,\n                currentValue: String(value ?? ''),\n                message: rule.errorMessage || ` \"${rule.targetColumn}\" `,\n              });\n              // \n              break;\n            }\n          }\n        }\n      }\n      return violations;\n    },\n\n    // \n    validateValue(value, rule, rawData) {\n      switch (rule.ruleType) {\n        case 'format':\n          return this.validateFormat(value, rule.config?.pattern);\n        case 'enum':\n          return this.validateEnum(value, rule.config?.values);\n        case 'numeric':\n          return this.validateNumeric(value, rule.config?.min, rule.config?.max);\n        case 'relation':\n          return this.validateRelation(value, rawData, rule.config?.refTable, rule.config?.refColumn);\n        case 'required':\n          return this.validateRequired(value);\n        case 'keyValue':\n          return this.validateKeyValue(value, rule.config);\n        default:\n          return true;\n      }\n    },\n\n    // \n    validateRow(row, headers, tableName, rowIndex, rules, rawData) {\n      const errors = [];\n      // \n      const rowTitle = row[1] || row[0] || ` ${rowIndex + 1}`;\n\n      for (const rule of rules) {\n        if (rule.targetTable !== tableName && !(isNpcTableName(rule.targetTable) && isNpcTableName(tableName)))\n          continue;\n        if (!rule.enabled) continue;\n\n        // \n        const colIndex = this.findColumnIndex(headers, rule.targetColumn);\n        if (colIndex === -1) continue;\n\n        const value = row[colIndex];\n        const isValid = this.validateValue(value, rule, rawData);\n\n        if (!isValid) {\n          errors.push({\n            ruleId: rule.id,\n            ruleName: rule.name,\n            ruleType: rule.ruleType,\n            rule: rule, // \n            tableName: tableName,\n            rowIndex: rowIndex,\n            columnName: rule.targetColumn,\n            currentValue: String(value ?? ''),\n            rowTitle: rowTitle, // \n            errorMessage: rule.errorMessage,\n            severity: 'error',\n          });\n        }\n      }\n\n      return errors;\n    },\n\n    // \n    validateAllData(rawData) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getEnabledRules();\n      if (rules.length === 0) return [];\n\n      const allErrors = [];\n\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const sheet = rawData[sheetId];\n        if (!sheet?.name || !sheet?.content) continue;\n\n        const tableName = sheet.name;\n        const headers = sheet.content[0];\n        const tableRules = rules.filter(r => r.targetTable === tableName);\n\n        if (tableRules.length === 0) continue;\n\n        //  \n        for (const rule of tableRules) {\n          const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n          if (typeInfo?.scope === 'table') {\n            if (rule.ruleType === 'rowLimit') {\n              const rowCount = sheet.content.length - 1;\n              if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n                allErrors.push({\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: '',\n                  currentValue: `${rowCount} `,\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n                  severity: 'warning',\n                });\n              }\n            } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n              // \n              const isValid = this.validateSequence(sheet, rule.targetColumn, rule.config || {});\n              if (!isValid) {\n                const error = {\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: rule.targetColumn,\n                  currentValue: '',\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(4, '0')}`,\n                  severity: 'error',\n                };\n                allErrors.push(error);\n              }\n            }\n            // tableReadonly \n          }\n        }\n\n        // \n        const fieldRules = tableRules.filter(r => RULE_TYPE_INFO[r.ruleType]?.scope !== 'table');\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          const rowErrors = this.validateRow(row, headers, tableName, i - 1, fieldRules, rawData);\n          allErrors.push(...rowErrors);\n        }\n      }\n\n      return allErrors;\n    },\n\n    // \n    validateTable(rawData, tableName) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getRulesByTable(tableName);\n      if (rules.length === 0) return [];\n\n      // \n      let targetSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n        return [];\n      }\n\n      const headers = targetSheet.content[0];\n      const allErrors = [];\n\n      for (let i = 1; i < targetSheet.content.length; i++) {\n        const row = targetSheet.content[i];\n        const rowErrors = this.validateRow(row, headers, tableName, i - 1, rules, rawData);\n        allErrors.push(...rowErrors);\n      }\n\n      return allErrors;\n    },\n\n    // \n    groupErrorsByTable(errors) {\n      const grouped = {};\n      for (const error of errors) {\n        if (!grouped[error.tableName]) {\n          grouped[error.tableName] = [];\n        }\n        grouped[error.tableName].push(error);\n      }\n      return grouped;\n    },\n\n    // \n    getErrorCount(rawData) {\n      return this.validateAllData(rawData).length;\n    },\n  };\n\n  // ========================================\n  // LocalAvatarDB -  IndexedDB \n  // ========================================\n  const LocalAvatarDB = {\n    DB_NAME: 'acu_local_avatars',\n    STORE_NAME: 'avatars',\n    DB_VERSION: 1,\n    _db: null,\n    _urlCache: new Map(), //  ObjectURL \n\n    // \n    async init() {\n      if (this._db) return this._db;\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n        request.onerror = () => {\n          console.error('[DICE]LocalAvatarDB :', request.error);\n          reject(request.error);\n        };\n\n        request.onsuccess = () => {\n          this._db = request.result;\n          resolve(this._db);\n        };\n\n        request.onupgradeneeded = event => {\n          const db = event.target.result;\n          if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n            // \n            db.createObjectStore(this.STORE_NAME, { keyPath: 'name' });\n          }\n        };\n      });\n    },\n\n    //  name \n    async save(name, blob) {\n      if (!name || !blob) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          //  ObjectURL \n          if (this._urlCache.has(name)) {\n            URL.revokeObjectURL(this._urlCache.get(name));\n            this._urlCache.delete(name);\n          }\n\n          const data = {\n            name: name,\n            blob: blob,\n            size: blob.size,\n            type: blob.type,\n            updatedAt: Date.now(),\n          };\n\n          const request = store.put(data);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]LocalAvatarDB :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB save error:', e);\n        return false;\n      }\n    },\n\n    //  URL ObjectURL\n    async get(name) {\n      if (!name) return null;\n\n      // \n      if (this._urlCache.has(name)) {\n        return this._urlCache.get(name);\n      }\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.get(name);\n\n          request.onsuccess = () => {\n            const data = request.result;\n            if (data && data.blob) {\n              const url = URL.createObjectURL(data.blob);\n              this._urlCache.set(name, url);\n              resolve(url);\n            } else {\n              resolve(null);\n            }\n          };\n\n          request.onerror = () => resolve(null);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB get error:', e);\n        return null;\n      }\n    },\n\n    // \n    async has(name) {\n      if (!name) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getKey(name);\n\n          request.onsuccess = () => resolve(request.result !== undefined);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        return false;\n      }\n    },\n\n    // \n    async delete(name) {\n      if (!name) return false;\n\n      try {\n        //  ObjectURL \n        if (this._urlCache.has(name)) {\n          URL.revokeObjectURL(this._urlCache.get(name));\n          this._urlCache.delete(name);\n        }\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.delete(name);\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB delete error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAllNames() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAllKeys();\n\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => resolve([]);\n        });\n      } catch (e) {\n        return [];\n      }\n    },\n\n    // \n    async getStats() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAll();\n\n          request.onsuccess = () => {\n            const items = request.result || [];\n            const totalSize = items.reduce((sum, item) => sum + (item.size || 0), 0);\n            resolve({\n              count: items.length,\n              totalSize: totalSize,\n              totalSizeMB: (totalSize / 1024 / 1024).toFixed(2),\n            });\n          };\n\n          request.onerror = () => resolve({ count: 0, totalSize: 0, totalSizeMB: '0' });\n        });\n      } catch (e) {\n        return { count: 0, totalSize: 0, totalSizeMB: '0' };\n      }\n    },\n\n    // \n    async clearAll() {\n      try {\n        //  ObjectURL \n        this._urlCache.forEach(url => URL.revokeObjectURL(url));\n        this._urlCache.clear();\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.clear();\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB clearAll error:', e);\n        return false;\n      }\n    },\n  };\n\n  // ========================================\n  // FavoritesDB -  IndexedDB \n  // ========================================\n  /**\n   * @typedef {Object} FavoriteItem\n   * @property {string} id - UUID\n   * @property {string[]} header -  (null)\n   * @property {(string|number)[]} rowData -  (header)\n   * @property {string[]} tags - \n   * @property {number} createdAt - \n   * @property {number} updatedAt - \n   * @property {{tableUid: string, tableName: string, chatId: string}} [sourceInfo] - \n   */\n  interface FavoriteItem {\n    id: string;\n    header: string[];\n    rowData: (string | number)[];\n    tags: string[];\n    createdAt: number;\n    updatedAt: number;\n    sourceInfo?: {\n      tableUid: string;\n      tableName: string;\n      chatId: string;\n    };\n  }\n\n  const FavoritesDB = {\n    DB_NAME: 'acu_favorites',\n    STORE_NAME: 'items',\n    DB_VERSION: 1,\n    _db: null as IDBDatabase | null,\n\n    // \n    async init(): Promise<IDBDatabase> {\n      if (this._db) return this._db;\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n        request.onerror = () => {\n          console.error('[DICE]FavoritesDB :', request.error);\n          reject(request.error);\n        };\n\n        request.onsuccess = () => {\n          this._db = request.result;\n          resolve(this._db);\n        };\n\n        request.onupgradeneeded = event => {\n          const db = (event.target as IDBOpenDBRequest).result;\n          if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n            //  id (UUID)\n            db.createObjectStore(this.STORE_NAME, { keyPath: 'id' });\n          }\n        };\n      });\n    },\n\n    // \n    async add(item: FavoriteItem): Promise<boolean> {\n      if (!item || !item.id) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          const request = store.add(item);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]FavoritesDB add :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB add error:', e);\n        return false;\n      }\n    },\n\n    // ID\n    async get(id: string): Promise<FavoriteItem | null> {\n      if (!id) return null;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.get(id);\n\n          request.onsuccess = () => {\n            resolve(request.result || null);\n          };\n\n          request.onerror = () => resolve(null);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB get error:', e);\n        return null;\n      }\n    },\n\n    //  ()\n    async update(id: string, updates: Partial<FavoriteItem>): Promise<boolean> {\n      if (!id) return false;\n\n      try {\n        const existing = await this.get(id);\n        if (!existing) return false;\n\n        const updated = {\n          ...existing,\n          ...updates,\n          id: existing.id, //  id \n          updatedAt: Date.now(),\n        };\n\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          const request = store.put(updated);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]FavoritesDB update :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB update error:', e);\n        return false;\n      }\n    },\n\n    // \n    async delete(id: string): Promise<boolean> {\n      if (!id) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.delete(id);\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB delete error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAll(): Promise<FavoriteItem[]> {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAll();\n\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => resolve([]);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB getAll error:', e);\n        return [];\n      }\n    },\n\n    // \n    async getAllTags(): Promise<string[]> {\n      try {\n        const items = await this.getAll();\n        const tagSet = new Set<string>();\n        for (const item of items) {\n          if (item.tags && Array.isArray(item.tags)) {\n            for (const tag of item.tags) {\n              if (tag) tagSet.add(tag);\n            }\n          }\n        }\n        return Array.from(tagSet).sort();\n      } catch (e) {\n        console.error('[DICE]FavoritesDB getAllTags error:', e);\n        return [];\n      }\n    },\n\n    // \n    async getByTag(tag: string): Promise<FavoriteItem[]> {\n      if (!tag) return [];\n\n      try {\n        const items = await this.getAll();\n        return items.filter(item => item.tags && item.tags.includes(tag));\n      } catch (e) {\n        console.error('[DICE]FavoritesDB getByTag error:', e);\n        return [];\n      }\n    },\n\n    // \n    async clear(): Promise<boolean> {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.clear();\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB clear error:', e);\n        return false;\n      }\n    },\n\n    // \n    async count(): Promise<number> {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.count();\n\n          request.onsuccess = () => resolve(request.result || 0);\n          request.onerror = () => resolve(0);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB count error:', e);\n        return 0;\n      }\n    },\n  };\n\n  type DiceHistoryEventType = 'check' | 'contest';\n\n  interface DiceHistoryStatRecord {\n    id?: number;\n    eventType: DiceHistoryEventType;\n    timestamp: number;\n    chatId: string;\n    characterId: string;\n    success: boolean;\n    attrName: string;\n    formula: string;\n    total: number;\n    target: number;\n    outcomeText: string;\n  }\n\n  interface DiceHistoryStatsSummary {\n    total: number;\n    checks: number;\n    contests: number;\n    checkSuccess: number;\n    checkSuccessRate: number;\n  }\n\n  const DiceHistoryStatsDB = {\n    DB_NAME: 'acu_dice_history_stats',\n    STORE_NAME: 'records',\n    DB_VERSION: 1,\n    _db: null as IDBDatabase | null,\n\n    async init(): Promise<IDBDatabase> {\n      if (this._db) return this._db;\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n        request.onerror = () => {\n          console.error('[DICE]DiceHistoryStatsDB :', request.error);\n          reject(request.error);\n        };\n\n        request.onsuccess = () => {\n          this._db = request.result;\n          resolve(this._db);\n        };\n\n        request.onupgradeneeded = event => {\n          const db = (event.target as IDBOpenDBRequest).result;\n          if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n            const store = db.createObjectStore(this.STORE_NAME, {\n              keyPath: 'id',\n              autoIncrement: true,\n            });\n            store.createIndex('eventType', 'eventType', { unique: false });\n            store.createIndex('timestamp', 'timestamp', { unique: false });\n            store.createIndex('chatId', 'chatId', { unique: false });\n            store.createIndex('characterId', 'characterId', { unique: false });\n            store.createIndex('chatCharacter', ['chatId', 'characterId'], { unique: false });\n          }\n        };\n      });\n    },\n\n    async add(record: DiceHistoryStatRecord): Promise<void> {\n      try {\n        const db = await this.init();\n        await new Promise<void>(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          tx.oncomplete = () => resolve();\n          tx.onerror = () => {\n            console.warn('[DICE]DiceHistoryStatsDB add :', tx.error);\n            resolve();\n          };\n          tx.objectStore(this.STORE_NAME).add(record);\n        });\n      } catch (error) {\n        console.warn('[DICE]DiceHistoryStatsDB add error:', error);\n      }\n    },\n\n    async getAll(): Promise<DiceHistoryStatRecord[]> {\n      try {\n        const db = await this.init();\n        return await new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const request = tx.objectStore(this.STORE_NAME).getAll();\n          request.onsuccess = () => resolve((request.result || []) as DiceHistoryStatRecord[]);\n          request.onerror = () => resolve([]);\n        });\n      } catch (error) {\n        console.warn('[DICE]DiceHistoryStatsDB getAll error:', error);\n        return [];\n      }\n    },\n\n    async clear(): Promise<void> {\n      try {\n        const db = await this.init();\n        await new Promise<void>(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          tx.oncomplete = () => resolve();\n          tx.onerror = () => resolve();\n          tx.objectStore(this.STORE_NAME).clear();\n        });\n      } catch (error) {\n        console.warn('[DICE]DiceHistoryStatsDB clear error:', error);\n      }\n    },\n\n    async recordEvent(event: string, payload: unknown): Promise<void> {\n      if (event !== 'check' && event !== 'contest') return;\n\n      const context = getDiceStatsContext();\n      const record = payload as Record<string, unknown>;\n      const now = Date.now();\n      const timestampRaw = Number(record.timestamp);\n      const timestamp = Number.isFinite(timestampRaw) ? timestampRaw : now;\n\n      const entry: DiceHistoryStatRecord = {\n        eventType: event,\n        timestamp,\n        chatId: context.chatId,\n        characterId: context.characterId,\n        success: false,\n        attrName: '',\n        formula: '',\n        total: 0,\n        target: 0,\n        outcomeText: '',\n      };\n\n      if (event === 'check') {\n        entry.success = Boolean(record.success);\n        entry.attrName = String(record.attrName || '');\n        entry.formula = String(record.formula || '');\n        entry.total = Number(record.total) || 0;\n        entry.target = Number(record.target) || 0;\n        entry.outcomeText = String(record.outcomeText || (entry.success ? '' : ''));\n      } else {\n        const winner = String(record.winner || 'tie');\n        entry.success = winner !== 'tie';\n        const left = (record.left || {}) as Record<string, unknown>;\n        const right = (record.right || {}) as Record<string, unknown>;\n        entry.attrName = `${String(left.attribute || '')} vs ${String(right.attribute || '')}`.trim() || '';\n        entry.formula = 'contest';\n        entry.total = Number(left.roll) || 0;\n        entry.target = Number(left.target) || 0;\n        entry.outcomeText = String(record.message || (winner === 'tie' ? '' : ''));\n      }\n\n      await this.add(entry);\n    },\n\n    summarize(records: DiceHistoryStatRecord[]): DiceHistoryStatsSummary {\n      const checks = records.filter(item => item.eventType === 'check');\n      const contests = records.filter(item => item.eventType === 'contest');\n      const checkSuccess = checks.filter(item => item.success).length;\n      const checkSuccessRate = checks.length > 0 ? Number(((checkSuccess / checks.length) * 100).toFixed(1)) : 0;\n      return {\n        total: records.length,\n        checks: checks.length,\n        contests: contests.length,\n        checkSuccess,\n        checkSuccessRate,\n      };\n    },\n\n    async getDashboardStats(): Promise<Record<DiceStatsScope, DiceHistoryStatsSummary>> {\n      const all = await this.getAll();\n      const context = getDiceStatsContext();\n      const hasChatScope = context.chatId !== 'unknown_chat';\n      const hasCharacterScope = context.characterId !== 'unknown_character';\n\n      const chatRecords = hasChatScope\n        ? all.filter(item => item.chatId === context.chatId && item.chatId !== 'unknown_chat')\n        : [];\n      const characterRecords = hasCharacterScope\n        ? all.filter(item => item.characterId === context.characterId && item.characterId !== 'unknown_character')\n        : [];\n\n      return {\n        chat: this.summarize(chatRecords),\n        character: this.summarize(characterRecords),\n        global: this.summarize(all),\n      };\n    },\n  };\n\n  // ========================================\n  // FavoritesManager - \n  // ========================================\n\n  interface TableCompatibility {\n    tableUid: string;\n    tableName: string;\n    mode: 'strict' | 'loose' | 'incompatible';\n    matchedCols: string[];\n    unmatchedCols: string[];\n    matchRatio: number;\n  }\n\n  const FavoritesManager = {\n    // \n    async addFavorite(\n      tableUid: string,\n      tableName: string,\n      header: string[],\n      rowData: (string | number)[],\n      tags: string[] = [],\n    ): Promise<FavoriteItem | null> {\n      try {\n        const chatId = SillyTavern.getCurrentChatId() || '';\n        const item: FavoriteItem = {\n          id: crypto.randomUUID(),\n          header: header,\n          rowData: rowData,\n          tags: tags,\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n          sourceInfo: {\n            tableUid,\n            tableName,\n            chatId,\n          },\n        };\n\n        const success = await FavoritesDB.add(item);\n        if (success) {\n          console.log('[DICE]FavoritesManager :', item.id);\n          return item;\n        }\n        return null;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager addFavorite error:', e);\n        return null;\n      }\n    },\n\n    // \n    async updateFavorite(id: string, updates: Partial<FavoriteItem>): Promise<boolean> {\n      try {\n        const success = await FavoritesDB.update(id, updates);\n        if (success) {\n          console.log('[DICE]FavoritesManager :', id);\n        }\n        return success;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager updateFavorite error:', e);\n        return false;\n      }\n    },\n\n    // \n    async duplicateFavorite(id: string): Promise<FavoriteItem | null> {\n      try {\n        const original = await FavoritesDB.get(id);\n        if (!original) return null;\n\n        const copy: FavoriteItem = {\n          ...original,\n          id: crypto.randomUUID(),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n\n        const success = await FavoritesDB.add(copy);\n        if (success) {\n          console.log('[DICE]FavoritesManager :', id, '->', copy.id);\n          return copy;\n        }\n        return null;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager duplicateFavorite error:', e);\n        return null;\n      }\n    },\n\n    // \n    async deleteFavorite(id: string): Promise<boolean> {\n      try {\n        const success = await FavoritesDB.delete(id);\n        if (success) {\n          console.log('[DICE]FavoritesManager :', id);\n        }\n        return success;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager deleteFavorite error:', e);\n        return false;\n      }\n    },\n\n    // \n    async addTag(id: string, tag: string): Promise<boolean> {\n      try {\n        const item = await FavoritesDB.get(id);\n        if (!item) return false;\n\n        if (!item.tags.includes(tag)) {\n          item.tags.push(tag);\n          return await FavoritesDB.update(id, { tags: item.tags });\n        }\n        return true;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager addTag error:', e);\n        return false;\n      }\n    },\n\n    // \n    async removeTag(id: string, tag: string): Promise<boolean> {\n      try {\n        const item = await FavoritesDB.get(id);\n        if (!item) return false;\n\n        const index = item.tags.indexOf(tag);\n        if (index > -1) {\n          item.tags.splice(index, 1);\n          return await FavoritesDB.update(id, { tags: item.tags });\n        }\n        return true;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager removeTag error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAllTags(): Promise<string[]> {\n      return await FavoritesDB.getAllTags();\n    },\n\n    // \n    async getAll(): Promise<FavoriteItem[]> {\n      return await FavoritesDB.getAll();\n    },\n\n    // \n    async getByTag(tag: string): Promise<FavoriteItem[]> {\n      return await FavoritesDB.getByTag(tag);\n    },\n\n    // ID\n    async getById(id: string): Promise<FavoriteItem | null> {\n      return await FavoritesDB.get(id);\n    },\n\n    // \n    findCompatibleTables(favorite: FavoriteItem, currentTables: Record<string, any>): TableCompatibility[] {\n      const results: TableCompatibility[] = [];\n\n      for (const uid in currentTables) {\n        const table = currentTables[uid];\n        if (!table || !table.content || !table.content[0]) continue;\n\n        // null\n        const tableHeader: string[] = table.content[0].slice(1).map((h: any) => String(h || ''));\n\n        // \n        const isStrict =\n          favorite.header.length === tableHeader.length && favorite.header.every((h, i) => h === tableHeader[i]);\n\n        // \n        const matchedCols = favorite.header.filter(h => tableHeader.includes(h));\n        const unmatchedCols = favorite.header.filter(h => !tableHeader.includes(h));\n        const matchRatio = favorite.header.length > 0 ? matchedCols.length / favorite.header.length : 0;\n\n        if (isStrict) {\n          results.push({\n            tableUid: uid,\n            tableName: table.name || uid,\n            mode: 'strict',\n            matchedCols,\n            unmatchedCols,\n            matchRatio: 1,\n          });\n        } else if (matchRatio > 0) {\n          results.push({\n            tableUid: uid,\n            tableName: table.name || uid,\n            mode: 'loose',\n            matchedCols,\n            unmatchedCols,\n            matchRatio,\n          });\n        }\n      }\n\n      // strictmatchRatio\n      return results.sort((a, b) => {\n        if (a.mode === 'strict' && b.mode !== 'strict') return -1;\n        if (a.mode !== 'strict' && b.mode === 'strict') return 1;\n        return b.matchRatio - a.matchRatio;\n      });\n    },\n\n    // \n    mapRowToTable(favorite: FavoriteItem, targetHeader: string[]): (string | number | null)[] {\n      const newRow: (string | number | null)[] = [null]; // null\n      for (const col of targetHeader) {\n        const srcIndex = favorite.header.indexOf(col);\n        newRow.push(srcIndex >= 0 ? favorite.rowData[srcIndex] : '');\n      }\n      return newRow;\n    },\n\n    // \n    async exportFavorites(): Promise<string> {\n      try {\n        const items = await FavoritesDB.getAll();\n        const exportData = {\n          version: 1,\n          exportedAt: Date.now(),\n          items: items,\n        };\n        return JSON.stringify(exportData, null, 2);\n      } catch (e) {\n        console.error('[DICE]FavoritesManager exportFavorites error:', e);\n        return '';\n      }\n    },\n\n    // \n    async importFavorites(jsonStr: string): Promise<{ added: number; updated: number } | null> {\n      try {\n        const data = JSON.parse(jsonStr);\n        if (!data || !data.items || !Array.isArray(data.items)) {\n          console.error('[DICE]FavoritesManager ');\n          return null;\n        }\n\n        let added = 0;\n        let updated = 0;\n\n        for (const item of data.items) {\n          if (!item.id || !item.header || !item.rowData) continue;\n\n          const existing = await FavoritesDB.get(item.id);\n          if (existing) {\n            // \n            await FavoritesDB.update(item.id, {\n              header: item.header,\n              rowData: item.rowData,\n              tags: item.tags || [],\n              updatedAt: Date.now(),\n              sourceInfo: item.sourceInfo,\n            });\n            updated++;\n          } else {\n            // \n            const newItem: FavoriteItem = {\n              id: item.id,\n              header: item.header,\n              rowData: item.rowData,\n              tags: item.tags || [],\n              createdAt: item.createdAt || Date.now(),\n              updatedAt: Date.now(),\n              sourceInfo: item.sourceInfo,\n            };\n            await FavoritesDB.add(newItem);\n            added++;\n          }\n        }\n\n        console.log('[DICE]FavoritesManager :', added, ',', updated, '');\n        return { added, updated };\n      } catch (e) {\n        console.error('[DICE]FavoritesManager importFavorites error:', e);\n        return null;\n      }\n    },\n  };\n\n  // []  SillyTavern  URL\n  const getUserAvatarUrl = () => {\n    try {\n      // 1:  DOM \n      const w = window.parent || window;\n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        // SillyTavern  #user_avatar_block img  .avatar[title=\"You\"] img\n        const $avatar = $('#user_avatar_block img').first();\n        if ($avatar.length && $avatar.attr('src')) {\n          return $avatar.attr('src');\n        }\n        // \n        const $userMes = $('.mes[is_user=\"true\"]').last().find('.avatar img');\n        if ($userMes.length && $userMes.attr('src')) {\n          return $userMes.attr('src');\n        }\n      }\n      // 2:  SillyTavern API \n      const ST = w.SillyTavern || window.SillyTavern;\n      if (ST && ST.getContext) {\n        const ctx = ST.getContext();\n        if (ctx && ctx.userAvatar) {\n          return ctx.userAvatar;\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getUserAvatarUrl error:', e);\n    }\n    return null;\n  };\n\n  // [] \n  const getPlayerName = () => {\n    const rawData = cachedRawData || (typeof getTableData === 'function' ? getTableData() : null);\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]?.[1]) {\n          return getDisplayName(sheet.content[1][1]);\n        }\n      }\n    }\n    return null;\n  };\n\n  // []  SillyTavern Persona \n  const getPersonaName = () => {\n    try {\n      // 1: SillyTavern  API\n      const w = window.parent || window;\n      if (w.SillyTavern?.getContext) {\n        const ctx = w.SillyTavern.getContext();\n        if (ctx?.name1) return ctx.name1;\n      }\n      // 2: \n      if (typeof name1 !== 'undefined' && name1) return name1;\n      if (w.name1) return w.name1;\n      // 3:  DOM \n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        const $persona = $('#user_avatar_block .avatar-name, #persona_name_input').first();\n        if ($persona.length) {\n          const name = $persona.val?.() || $persona.text?.();\n          if (name && name.trim()) return name.trim();\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getPersonaName error:', e);\n    }\n    return null;\n  };\n\n  // []  Persona\n  const getDisplayPlayerName = () => {\n    return getPersonaName() || getPlayerName() || '';\n  };\n\n  // []  Persona \n  const replaceUserPlaceholders = text => {\n    if (!text || typeof text !== 'string') return text;\n    const displayName = getDisplayPlayerName();\n    //  <user>{{user}}\n    let result = text.replace(/<user>/gi, displayName);\n    result = result.replace(/\\{\\{user\\}\\}/gi, displayName);\n    return result;\n  };\n\n  type DiceStatsScope = 'chat' | 'character' | 'global';\n\n  interface DiceStatsContext {\n    chatId: string;\n    characterId: string;\n  }\n\n  const getDiceStatsContext = (): DiceStatsContext => {\n    const ST = SillyTavern;\n    let chatId = 'unknown_chat';\n    let characterId = 'unknown_character';\n\n    try {\n      if (typeof getCurrentChatId === 'function') {\n        const directChatId = getCurrentChatId();\n        if (directChatId !== null && directChatId !== undefined) {\n          const parsed = String(directChatId).trim();\n          if (parsed) chatId = parsed;\n        }\n      }\n      if (typeof ST?.getCurrentChatId === 'function') {\n        const currentChatId = ST.getCurrentChatId();\n        if (currentChatId !== null && currentChatId !== undefined) {\n          const parsed = String(currentChatId).trim();\n          if (parsed) chatId = parsed;\n        }\n      }\n    } catch {\n      // ignore\n    }\n\n    try {\n      if (typeof getCharData === 'function') {\n        const currentChar = getCharData('current', true);\n        const avatarId = String(currentChar?.avatar || '').trim();\n        if (avatarId) {\n          characterId = avatarId;\n        }\n      }\n\n      if (characterId === 'unknown_character') {\n        const cid = ST?.characterId;\n        const chars = ST?.characters;\n        const idx = Number.parseInt(String(cid ?? ''), 10);\n        if (!Number.isNaN(idx) && idx >= 0 && Array.isArray(chars) && idx < chars.length) {\n          const avatarId = String(chars[idx]?.avatar || '').trim();\n          if (avatarId) {\n            characterId = avatarId;\n          }\n        }\n      }\n    } catch {\n      // ignore\n    }\n\n    return { chatId, characterId };\n  };\n  // \n  const AvatarManager = {\n    _cache: null,\n\n    load() {\n      if (!this._cache) {\n        const raw = Store.get(STORAGE_KEY_AVATAR_MAP, {});\n        this._cache = {};\n        for (const name in raw) {\n          if (typeof raw[name] === 'string') {\n            this._cache[name] = { url: raw[name], offsetX: 50, offsetY: 50, scale: 150, aliases: [], createdAt: 0 };\n          } else {\n            this._cache[name] = {\n              url: raw[name].url || '',\n              offsetX: raw[name].offsetX ?? 50,\n              offsetY: raw[name].offsetY ?? 50,\n              scale: raw[name].scale ?? 150,\n              aliases: raw[name].aliases || [],\n              createdAt: raw[name].createdAt ?? 0,\n            };\n          }\n        }\n      }\n      return this._cache;\n    },\n\n    save() {\n      Store.set(STORAGE_KEY_AVATAR_MAP, this._cache || {});\n      this._cache = null;\n    },\n\n    //  URL  ST \n    get(name) {\n      const data = this.load()[name];\n      if (data && data.url) return data.url;\n\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          if (this._cache[key].url) return this._cache[key].url;\n        }\n      }\n\n      return null;\n    },\n\n    //  > URL > ST\n    async getAsync(name) {\n      if (!name) return null;\n\n      // \n      const playerName = getPlayerName();\n      const isPlayer = name === '<user>' || name === '' || (playerName && name === playerName);\n\n      // 1.  IndexedDB\n      const localUrl = await LocalAvatarDB.get(name);\n      if (localUrl) return localUrl;\n\n      // 2.  <user> \n      if (isPlayer && name !== '<user>') {\n        const userLocalUrl = await LocalAvatarDB.get('<user>');\n        if (userLocalUrl) return userLocalUrl;\n      }\n\n      // 3. \n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        const aliasLocalUrl = await LocalAvatarDB.get(primaryName);\n        if (aliasLocalUrl) return aliasLocalUrl;\n      }\n\n      // 4. URL / ST\n      return this.get(name);\n    },\n\n    // \n    async hasLocalAvatar(name) {\n      if (!name) return false;\n      const has = await LocalAvatarDB.has(name);\n      if (has) return true;\n\n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        return await LocalAvatarDB.has(primaryName);\n      }\n      return false;\n    },\n\n    // \n    async saveLocalAvatar(name, blob) {\n      return await LocalAvatarDB.save(name, blob);\n    },\n\n    // \n    async deleteLocalAvatar(name) {\n      return await LocalAvatarDB.delete(name);\n    },\n\n    getOffsetX(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetX ?? 50) : 50;\n    },\n\n    getOffsetY(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetY ?? 50) : 50;\n    },\n\n    getScale(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.scale ?? 150) : 150;\n    },\n\n    // \n    _resolveByAlias(name) {\n      const data = this.load()[name];\n      if (data) return data;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return this._cache[key];\n        }\n      }\n      return null;\n    },\n\n    // \n    getPrimaryName(name) {\n      if (this.load()[name]) return name;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return key;\n        }\n      }\n      return name;\n    },\n\n    set(name, url, offsetX = 50, offsetY = 50, scale = 150, aliases = []) {\n      const existing = this.load()[name];\n      const createdAt = existing ? (existing.createdAt ?? 0) : Date.now();\n      this.load()[name] = { url, offsetX, offsetY, scale, aliases, createdAt };\n      this.save();\n    },\n\n    setPosition(name, offsetX, offsetY) {\n      const data = this.load()[name];\n      if (data) {\n        data.offsetX = offsetX;\n        data.offsetY = offsetY;\n        this.save();\n      }\n    },\n\n    setScale(name, scale) {\n      const data = this.load()[name];\n      if (data) {\n        data.scale = scale;\n        this.save();\n      }\n    },\n\n    setAliases(name, aliases) {\n      const data = this.load()[name];\n      if (data) {\n        data.aliases = aliases;\n        this.save();\n      }\n    },\n\n    remove(name) {\n      delete this.load()[name];\n      this.save();\n    },\n\n    getAll() {\n      return this.load();\n    },\n\n    // JSON\n    exportData() {\n      return {\n        version: 1,\n        exportTime: new Date().toISOString(),\n        avatars: this.load(),\n      };\n    },\n\n    // \n    importData(jsonData, overwriteConflicts = true) {\n      if (!jsonData || !jsonData.avatars) {\n        throw new Error('');\n      }\n\n      const current = this.load();\n      const stats = { added: 0, updated: 0, skipped: 0 };\n\n      for (const name in jsonData.avatars) {\n        const imported = jsonData.avatars[name];\n        if (!imported.url) continue;\n\n        if (current[name]) {\n          // \n          if (overwriteConflicts) {\n            current[name] = {\n              url: imported.url,\n              offsetX: imported.offsetX ?? 50,\n              offsetY: imported.offsetY ?? 50,\n              scale: imported.scale ?? 150,\n              aliases: imported.aliases || [],\n              createdAt: imported.createdAt ?? 0,\n            };\n            stats.updated++;\n          } else {\n            stats.skipped++;\n          }\n        } else {\n          // \n          current[name] = {\n            url: imported.url,\n            offsetX: imported.offsetX ?? 50,\n            offsetY: imported.offsetY ?? 50,\n            scale: imported.scale ?? 150,\n            aliases: imported.aliases || [],\n            createdAt: imported.createdAt ?? 0,\n          };\n          stats.added++;\n        }\n      }\n\n      this.save();\n      return stats;\n    },\n\n    // \n    analyzeImport(jsonData) {\n      if (!jsonData || !jsonData.avatars) {\n        return { valid: false, error: '' };\n      }\n\n      const current = this.load();\n      const result = { valid: true, total: 0, newItems: [], conflicts: [] };\n\n      for (const name in jsonData.avatars) {\n        if (!jsonData.avatars[name].url) continue;\n        result.total++;\n        if (current[name]) {\n          result.conflicts.push(name);\n        } else {\n          result.newItems.push(name);\n        }\n      }\n\n      return result;\n    },\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  /**\n   * display name\n   * key\n   * \",,\"  { displayName: \"\", aliases: [\"\", \"\"] }\n   * \"\"  { displayName: \"\", aliases: [\"\", \"\"] }\n   */\n  const parseCharacterName = (rawName: string): { displayName: string; aliases: string[] } => {\n    if (!rawName) return { displayName: '', aliases: [] };\n    const trimmed = String(rawName).trim();\n    const parts = trimmed\n      .split(/[,]/)\n      .map(s => s.trim())\n      .filter(Boolean);\n    if (parts.length <= 1) return { displayName: trimmed, aliases: [] };\n\n    // key\n    let bestIdx = 0;\n    for (let i = 1; i < parts.length; i++) {\n      if (parts[i].length > parts[bestIdx].length) bestIdx = i;\n    }\n    const displayName = parts[bestIdx];\n    const aliases = parts.filter((_, i) => i !== bestIdx);\n    return { displayName, aliases };\n  };\n\n  /**\n   * key\n   * \n   * \n   */\n  const getDisplayName = (rawName: string): string => {\n    return parseCharacterName(rawName).displayName;\n  };\n\n  /**\n   * NPC\n   *  getDisplayName\n   */\n  const isCharacterTable = (tableName: string): boolean => {\n    const keywords = ['', '', '', 'NPC', '', '', '', '', '', 'player', 'character'];\n    return keywords.some(kw => tableName.toLowerCase().includes(kw.toLowerCase()));\n  };\n\n  /**\n   * \n   * \n   *  AvatarManager \n   */\n  const NameAliasRegistry = {\n    // alias  primaryName\n    _autoAliases: new Map<string, string>(),\n    // alias  [primaryName1, primaryName2, ...]\n    _conflicts: new Map<string, string[]>(),\n    //   \n    _displayNames: new Map<string, string>(),\n\n    /**\n     * \n     * \n     * \n     */\n    rebuild(allTables: Record<string, { headers: string[]; rows: (string | number | null)[][]; key?: string }>) {\n      this._autoAliases.clear();\n      this._conflicts.clear();\n      this._displayNames.clear();\n\n      // alias  \n      const aliasOwners = new Map<string, string[]>();\n\n      for (const tableName in allTables) {\n        if (!isCharacterTable(tableName)) continue;\n        const table = allTables[tableName];\n        const headers = table.headers || [];\n        const rows = table.rows || [];\n\n        // \n        let nameIdx = headers.findIndex(h => h && (String(h).includes('') || String(h).includes('')));\n        if (nameIdx < 0) nameIdx = 1; // \n\n        rows.forEach(row => {\n          const rawName = String(row[nameIdx] || '').trim();\n          if (!rawName) return;\n          const { displayName, aliases } = parseCharacterName(rawName);\n          if (!displayName) return;\n\n          //  displayName  rawName \n          this._displayNames.set(displayName, rawName);\n\n          if (aliases.length === 0) return;\n\n          for (const alias of aliases) {\n            if (!aliasOwners.has(alias)) aliasOwners.set(alias, []);\n            const owners = aliasOwners.get(alias)!;\n            if (!owners.includes(displayName)) owners.push(displayName);\n          }\n        });\n      }\n\n      //   _autoAliases  _conflicts\n      for (const [alias, owners] of aliasOwners) {\n        if (owners.length === 1) {\n          this._autoAliases.set(alias, owners[0]);\n        } else {\n          this._conflicts.set(alias, [...owners]);\n        }\n      }\n\n      if (this._autoAliases.size > 0) {\n        console.info(\n          `[DICE]:  ${this._autoAliases.size} ` +\n            (this._conflicts.size > 0 ? `, ${this._conflicts.size} ` : ''),\n        );\n      }\n    },\n\n    /**\n     * display name\n     *  > AvatarManager >  > \n     */\n    resolve(name: string): string {\n      if (!name) return name;\n\n      // 1. \n      if (name.includes(',') || name.includes('')) {\n        return getDisplayName(name);\n      }\n\n      // 2.  AvatarManager \n      const manualPrimary = AvatarManager.getPrimaryName(name);\n      if (manualPrimary !== name) return manualPrimary;\n\n      // 3. \n      const autoPrimary = this._autoAliases.get(name);\n      if (autoPrimary) return autoPrimary;\n\n      return name;\n    },\n\n    /**\n     *  + AvatarManager\n     */\n    getAliases(primaryName: string): string[] {\n      const result: string[] = [];\n\n      // \n      for (const [alias, owner] of this._autoAliases) {\n        if (owner === primaryName && !result.includes(alias)) result.push(alias);\n      }\n\n      // AvatarManager \n      const manualAliases = AvatarManager.load()[primaryName]?.aliases || [];\n      for (const a of manualAliases) {\n        if (!result.includes(a)) result.push(a);\n      }\n\n      return result;\n    },\n\n    /**\n     * \n     */\n    getConflicts(): Map<string, string[]> {\n      return new Map(this._conflicts);\n    },\n\n    /**\n     * \n     */\n    isDisplayName(name: string): boolean {\n      return this._displayNames.has(name);\n    },\n  };\n\n  //  fa:xxx emoji\n  const renderIcon = (icon: string | null): string => {\n    if (!icon) return '';\n    if (icon.startsWith('fa:')) {\n      const name = icon.slice(3);\n      return `<i class=\"fa-solid fa-${name} acu-icon\"></i>`;\n    }\n    return icon; // emoji\n  };\n\n  const getLocationEmoji = name => {\n    if (!name) return null;\n    const lowerName = name.toLowerCase();\n    for (const [pattern, emoji] of LOCATION_EMOJI_MAP) {\n      if (pattern.test(lowerName)) return emoji;\n    }\n    return null;\n  };\n\n  // emoji\n  const getEmojiCandidates = (name: string): string[] => {\n    if (!name) return [];\n    const lowerName = name.toLowerCase();\n    const candidates: string[] = [];\n    for (const [pattern, emoji] of LOCATION_EMOJI_MAP) {\n      if (pattern.test(lowerName)) {\n        candidates.push(emoji);\n      }\n    }\n    return candidates;\n  };\n\n  // emoji\n  const resolveBatchLocationEmojis = (names: string[]): Map<string, string | null> => {\n    // 1. \n    const candidatesMap = new Map<string, string[]>();\n    for (const name of names) {\n      candidatesMap.set(name, getEmojiCandidates(name));\n    }\n\n    // 2. \n    const sortedNames = [...names].sort((a, b) => {\n      if (a.length !== b.length) return a.length - b.length;\n      return a.localeCompare(b);\n    });\n\n    // 3. \n    const usedEmojis = new Set<string>();\n    const result = new Map<string, string | null>();\n\n    for (const name of sortedNames) {\n      const candidates = candidatesMap.get(name) || [];\n      const available = candidates.find(e => !usedEmojis.has(e));\n      if (available) {\n        result.set(name, available);\n        usedEmojis.add(available);\n      } else {\n        // \n        result.set(name, candidates.length > 0 ? candidates[0] : null);\n      }\n    }\n\n    return result;\n  };\n\n  const getElementEmoji = (name, type) => {\n    if (!name && !type) return null;\n    const lowerName = name?.toLowerCase();\n    const lowerType = type?.toLowerCase();\n    for (const [pattern, emoji] of ELEMENT_EMOJI_MAP) {\n      if (lowerName && pattern.test(lowerName)) return emoji;\n    }\n    for (const [pattern, emoji] of ELEMENT_EMOJI_MAP) {\n      if (lowerType && pattern.test(lowerType)) return emoji;\n    }\n    return null;\n  };\n\n  // ========================================\n  // MVU  v2.0\n  //  -  UI\n  // ========================================\n  const MvuModule = (function () {\n    'use strict';\n\n    // [] MVU  - \n    function parseMvuPathForDice(path, value) {\n      try {\n        if (!path || typeof path !== 'string') {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        //  . \n        const parts = path.split('.').filter(p => p && p.trim());\n\n        if (parts.length === 0) {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        // \n        const blacklist = [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          'stat_data',\n          'delta_data',\n        ];\n\n        // \n        const filteredParts = parts.filter(p => !blacklist.includes(p));\n\n        // \n        let initiator = null;\n        if (filteredParts.length >= 2) {\n          // \n          initiator = filteredParts[filteredParts.length - 2];\n        } else if (filteredParts.length === 1) {\n          // \n          initiator = filteredParts[0];\n        }\n\n        // \n        let attrName = null;\n        if (filteredParts.length > 0) {\n          attrName = filteredParts[filteredParts.length - 1];\n        } else if (parts.length > 0) {\n          // \n          attrName = parts[parts.length - 1];\n        }\n\n        // \n        const candidates = filteredParts.length > 0 ? filteredParts : parts.slice(-1);\n\n        return {\n          initiator: initiator || null,\n          attrName: attrName || null,\n          candidates: candidates,\n        };\n      } catch (e) {\n        console.warn('[DICE]parseMvuPathForDice ', e);\n        return { initiator: null, attrName: null, candidates: [] };\n      }\n    }\n\n    // =====  =====\n    const MODULE_ID = '__mvu__';\n    let cachedEraData = null; //  ERA \n    let cachedEraDataChatId: string | null = null;\n\n    function getCurrentChatIdSafe(): string | null {\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      try {\n        return typeof ST?.getCurrentChatId === 'function' ? ST.getCurrentChatId() : null;\n      } catch {\n        return null;\n      }\n    }\n\n    function clearMvuCacheIfChatChanged() {\n      const chatId = getCurrentChatIdSafe();\n      if (!cachedEraData) return;\n      if (!chatId) return;\n      if (cachedEraDataChatId && cachedEraDataChatId !== chatId) {\n        cachedEraData = null;\n        cachedEraDataChatId = null;\n      }\n    }\n\n    function isLwbChatContext(): boolean {\n      const lwbGuard = globalThis.LWB_Guard || window.LWB_Guard || window.parent?.LWB_Guard;\n      if (typeof lwbGuard !== 'object' || lwbGuard === null) return false;\n\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      const chatMetadata = ST?.chatMetadata;\n      if (typeof chatMetadata !== 'object' || chatMetadata === null) return false;\n\n      //  ERA  ERA  ERA  LWB\n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n      if (typeof eventEmit === 'function' && typeof eventOn === 'function') {\n        const variablesUnknown = (chatMetadata as { variables?: unknown }).variables;\n        if (typeof variablesUnknown === 'object' && variablesUnknown !== null) {\n          const variables = variablesUnknown as Record<string, unknown>;\n          //  ERA  ERA \n          if (variables.ERAMetaData !== undefined || variables.stat_data !== undefined) {\n            return false;\n          }\n        }\n      }\n\n      //  MVU  MVU  LWB\n      // MVU  chatMetadata.variables \n      //  chatMetadata  LWB_*  MVU\n      if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n        // MVU  MVU \n        try {\n          const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n          //  MVU  stat_data  MVU \n          if (mvuData !== null && mvuData !== undefined) {\n            return false;\n          }\n        } catch {\n          // MVU  LWB\n        }\n      }\n\n      // LWB_Guard \n      //  LWB  LWB \n\n      //  chatMetadata  LWB_* \n      const hasLwbMetaKey = Object.keys(chatMetadata).some(k => k.startsWith('LWB_') || k.startsWith('lwb_'));\n      if (hasLwbMetaKey) return true;\n\n      const variablesUnknown = (chatMetadata as { variables?: unknown }).variables;\n      if (typeof variablesUnknown !== 'object' || variablesUnknown === null) return false;\n\n      const variables = variablesUnknown as Record<string, unknown>;\n\n      //  variables  LWB_* \n      const hasLwbVarKey = Object.keys(variables).some(k => k.startsWith('LWB_') || k.startsWith('lwb_'));\n      if (hasLwbVarKey) return true;\n\n      //  LWB  LWB\n      // JSON  MVU \n      // MVU  chatMetadata.variables \n      //  LWB_*  LWB \n      return false;\n    }\n\n    // =====  ERA  =====\n    function hasEraDataInCurrentChat(): boolean {\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      const chatMetadata = ST?.chatMetadata;\n      if (typeof chatMetadata !== 'object' || chatMetadata === null) return false;\n\n      const variablesUnknown = (chatMetadata as { variables?: unknown }).variables;\n      if (typeof variablesUnknown !== 'object' || variablesUnknown === null) return false;\n\n      const variables = variablesUnknown as Record<string, unknown>;\n      // ERA  ERAMetaData  stat_data \n      return variables.ERAMetaData !== undefined || variables.stat_data !== undefined;\n    }\n\n    // =====  =====\n    function detectMode() {\n      clearMvuCacheIfChatChanged();\n\n      // \n      if (cachedEraData && cachedEraData._source) {\n        return cachedEraData._source;\n      }\n\n      // []  LWB (X) LWB \n      if (isLwbChatContext()) {\n        console.log('[DICE]MvuModule  LWB (X) ');\n        return 'lwb';\n      }\n\n      //  ERA   ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n      const eraFrameworkExists = typeof eventEmit === 'function' && typeof eventOn === 'function';\n\n      if (eraFrameworkExists && hasEraDataInCurrentChat()) {\n        console.log('[DICE]MvuModule  ERA  ERA ');\n        return 'era';\n      }\n\n      //  MVU\n      if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n        console.log('[DICE]MvuModule  MVU ');\n        return 'mvu';\n      }\n\n      //  ERA  ERA\n      if (eraFrameworkExists) {\n        console.log('[DICE]MvuModule  ERA ');\n        return 'era';\n      }\n\n      //  MVU\n      console.log('[DICE]MvuModule  MVU ');\n      return 'mvu';\n    }\n\n    // ===== =====\n    async function detectModeWithData() {\n      // [] 1.  LWB\n      if (isLwbChatContext()) {\n        const lwbData = getLwbData();\n        console.log('[DICE] LWB :', Object.keys(lwbData.stat_data).length);\n        return { mode: 'lwb', data: lwbData };\n      }\n\n      // 2.  ERA   ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n      const eraFrameworkExists = typeof eventEmit === 'function' && typeof eventOn === 'function';\n\n      if (eraFrameworkExists && hasEraDataInCurrentChat()) {\n        try {\n          //  ERA \n          const eraData = await Promise.race([\n            getEraData(),\n            new Promise((_, reject) => setTimeout(() => reject(new Error('ERA timeout')), 2000)),\n          ]);\n\n          if (eraData && eraData.stat_data) {\n            console.log('[DICE] ERA ');\n            return { mode: 'era', data: eraData };\n          }\n        } catch (e) {\n          console.warn('[DICE]ERA :', e.message);\n        }\n      }\n\n      // 3.  MVU\n      try {\n        await waitGlobalInitialized('Mvu');\n\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (mvuData && mvuData.stat_data) {\n            console.log('[DICE] MVU ');\n            return {\n              mode: 'mvu',\n              data: {\n                stat_data: mvuData.stat_data || null,\n                display_data: mvuData.display_data || {},\n                delta_data: mvuData.delta_data || {},\n                schema: mvuData.schema || null,\n                _source: 'mvu', // \n              },\n            };\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MVU :', e);\n      }\n\n      // 3.  MVU \n      console.warn('[DICE] MVU ');\n      return { mode: 'mvu', data: null };\n    }\n\n    // ===== LWB (X)  =====\n    // JSON LWB \n    // LWB  JSON.parse\n    function parseJsonSafe(value: unknown): unknown {\n      if (typeof value !== 'string') return value;\n\n      const trimmed = value.trim();\n      if (!trimmed.startsWith('{') && !trimmed.startsWith('[')) return value;\n\n      try {\n        return JSON.parse(trimmed) as unknown;\n      } catch {\n        return value;\n      }\n    }\n\n    // X\n    function getLwbData() {\n      try {\n        // iframe  SillyTavern \n        const ST = window.SillyTavern || window.parent?.SillyTavern;\n        const variables = ST?.chatMetadata?.variables || {};\n        const stat_data: Record<string, unknown> = {};\n\n        for (const [key, value] of Object.entries(variables)) {\n          // X\n          if (key.startsWith('LWB_') || key.startsWith('lwb_')) continue;\n\n          //  parseJsonSafe  JSON \n          const parsed = parseJsonSafe(value);\n\n          // plot-log\n          if (typeof parsed === 'object' && parsed !== null) {\n            stat_data[key] = parsed;\n          }\n        }\n\n        //  stat_data \n        //  _source: 'lwb'  detectMode()  'lwb'\n        //  cachedEraData\n        return {\n          stat_data,\n          display_data: {},\n          delta_data: {},\n          _source: 'lwb',\n        };\n      } catch (e) {\n        console.warn('[DICE]LWB:', e);\n        //  LWB \n        return {\n          stat_data: {},\n          display_data: {},\n          delta_data: {},\n          _source: 'lwb',\n        };\n      }\n    }\n\n    // ===== ERA  =====\n    // ERA\n    async function getEraData() {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(null);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onResult = detail => {\n          clearTimeout(timeoutId);\n          //  eventOff \n          if (typeof eventOff === 'function') {\n            try {\n              eventOff('era:queryResult', onResult);\n            } catch (e) {\n              console.warn('[DICE]MvuModule :', e);\n            }\n          }\n\n          // console.log('[DICE]MvuModule ERA:', JSON.stringify(detail, null, 2));\n          // console.log('[DICE]MvuModule detail.result:', JSON.stringify(detail.result, null, 2));\n\n          if (detail.result && detail.result.error) {\n            console.error('[DICE]MvuModule ERA:', detail.result.error);\n            resolve(null);\n            return;\n          }\n\n          const statData = detail.result?.statWithoutMeta || null;\n          // console.log('[DICE]MvuModule  stat_data:', JSON.stringify(statData, null, 2));\n\n          const result = {\n            stat_data: statData,\n            delta_data: {},\n            schema: null,\n            _source: 'era', // \n          };\n\n          // \n          cachedEraData = result;\n          cachedEraDataChatId = getCurrentChatIdSafe();\n\n          resolve(result);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA...');\n          console.log('[DICE]MvuModule ERA API :', {\n            eventEmit: typeof eventEmit === 'function',\n            eventOn: typeof eventOn === 'function',\n            eventOff: typeof eventOff === 'function',\n          });\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n\n          eventOn('era:queryResult', onResult);\n          eventEmit('era:getCurrentVars');\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(null);\n        }\n      });\n    }\n\n    // ERA \n    async function setEraValue(path, newValue) {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(false);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onWriteDone = detail => {\n          clearTimeout(timeoutId);\n          if (typeof eventOff === 'function') {\n            eventOff('era:writeDone', onWriteDone);\n          }\n          console.log('[DICE]MvuModule ERA');\n          resolve(true);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA:', path, newValue);\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n\n          eventOn('era:writeDone', onWriteDone);\n          eventEmit('era:updateByPath', {\n            path: path,\n            value: newValue,\n          });\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(false);\n        }\n      });\n    }\n\n    // =====  =====\n    const STYLES = `\n            /* MVU  */\n            .acu-mvu-panel {\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n                min-height: 300px; /*  */\n                overflow: hidden; /*  */\n            }\n            .acu-mvu-panel .acu-panel-header {\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                padding: 10px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                flex-shrink: 0;\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title i {\n                color: var(--acu-accent);\n            }\n            .acu-mvu-panel .acu-header-actions {\n                display: flex;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn {\n                background: transparent;\n                border: none;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                padding: 4px;\n                font-size: 14px;\n                border-radius: 4px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn:hover {\n                background: transparent;\n                color: var(--acu-accent);\n            }\n            .acu-mvu-panel .mvu-header-btn.active {\n                background: transparent;\n                color: var(--acu-accent);\n                font-weight: bold;\n            }\n            /* []  */\n            .mvu-numeric-mode {\n                padding: 0;\n            }\n            .mvu-numeric-level-controls {\n                position: sticky;\n                top: 0;\n                z-index: 10;\n            }\n            /* []  */\n            .mvu-level-controls-collapsible {\n                margin-bottom: 8px;\n            }\n            .mvu-level-controls-header {\n                transition: background 0.2s;\n            }\n            .mvu-level-controls-header:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-level-controls-body {\n                overflow-y: auto;\n                overflow-x: hidden;\n                transition: max-height 0.3s ease-out, padding-top 0.3s ease-out, padding-bottom 0.3s ease-out, border-bottom 0.3s ease-out;\n                max-height: 300px; /*  */\n                scrollbar-width: thin;\n            }\n            /*  */\n            @media (max-width: 768px) {\n                .mvu-level-controls-body {\n                    max-height: 200px;\n                }\n            }\n            .mvu-level-controls-body::-webkit-scrollbar {\n                width: 6px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-track {\n                background: transparent;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb {\n                background: var(--acu-border);\n                border-radius: 3px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb:hover {\n                background: var(--acu-text-sub);\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-body {\n                max-height: 0 !important;\n                padding-top: 0 !important;\n                padding-bottom: 0 !important;\n                border-bottom: none !important;\n                margin: 0 !important;\n            }\n            .mvu-level-controls-toggle-icon {\n                transition: transform 0.3s ease-out;\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-toggle-icon {\n                transform: rotate(-90deg);\n            }\n            .mvu-numeric-items {\n                max-height: calc(100vh - 200px);\n                overflow-y: auto;\n            }\n            .mvu-numeric-item {\n                transition: background 0.2s;\n            }\n            .mvu-numeric-item:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-dice-icon {\n                transition: opacity 0.2s, transform 0.2s;\n            }\n            .mvu-dice-icon:hover {\n                opacity: 1 !important;\n                transform: scale(1.1);\n            }\n            .mvu-level-toggle:hover {\n                opacity: 1 !important;\n            }\n            .mvu-level-toggle[data-visible=\"true\"]:hover {\n                background: var(--acu-accent) !important;\n                color: var(--acu-btn-active-text) !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .mvu-level-toggle[data-visible=\"false\"]:hover,\n            .mvu-level-toggle[data-visible=\"\"]:hover {\n                background: var(--acu-table-hover) !important;\n                color: var(--acu-text-sub) !important;\n                border-color: var(--acu-border) !important;\n            }\n\n            /* MVU  -  */\n            .mvu-content {\n                display: flex;\n                flex-direction: column;\n                overflow-x: hidden;\n                overflow-y: auto; /*  */\n                flex: 1 1 auto;\n                min-height: 0; /*  flex  */\n                max-height: 100%; /*  */\n                padding: 12px;\n                scrollbar-width: thin;\n            }\n            .mvu-content::-webkit-scrollbar {\n                display: none;\n            }\n            .mvu-content .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 100%;\n                max-width: 100%;\n                width: 100%;\n            }\n            /* MVU */\n            .acu-mvu-panel {\n                overflow-y: auto !important;\n                overflow-x: hidden !important;\n                flex: 1 1 0; /*  flex-basis: 0  */\n                min-height: 300px; /*  */\n            }\n\n            /* MVU  */\n            .mvu-card {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 10px;\n                overflow: hidden;\n            }\n            .mvu-card:last-child {\n                margin-bottom: 0;\n            }\n            .mvu-card-header {\n                background: var(--acu-table-head);\n                padding: 8px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                cursor: pointer;\n                user-select: none;\n                transition: background 0.2s;\n            }\n            .mvu-card-header:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-card-title {\n                font-weight: 600;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            .mvu-card-count {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                font-weight: normal;\n            }\n            .mvu-card-toggle {\n                color: var(--acu-text-sub);\n                font-size: 10px;\n                transition: transform 0.2s;\n            }\n            .mvu-card.collapsed .mvu-card-toggle {\n                transform: rotate(-90deg);\n            }\n            .mvu-card-body {\n                padding: 8px 12px;\n                display: block;\n                overflow: hidden; /*  slideUp/slideDown  */\n            }\n            .mvu-card.collapsed .mvu-card-body {\n                display: none;\n            }\n\n            /*  */\n            .mvu-card .mvu-card {\n                background: var(--acu-table-head);\n                margin: 6px 0;\n            }\n            .mvu-card .mvu-card .mvu-card-header {\n                background: rgba(128,128,128,0.1);\n                padding: 6px 10px;\n            }\n            .mvu-card .mvu-card .mvu-card-body {\n                padding: 6px 10px;\n            }\n\n            /*  -  */\n            .mvu-card-body.horizontal-nested {\n                display: flex;\n                flex-direction: row;\n                flex-wrap: nowrap;\n                gap: 12px;\n                overflow-x: auto;\n                overflow-y: visible;\n                -webkit-overflow-scrolling: touch;\n                padding-bottom: 8px;\n                align-items: flex-start;\n            }\n            /*  has-nested-cards  wrap  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested {\n                flex-wrap: wrap;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-row {\n                display: flex;\n                flex: 0 0 100%;\n                width: 100%;\n                max-width: 100%; /*  */\n                box-sizing: border-box;\n            }\n            /*  has-nested-cards  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                flex: 0 0 auto; /*  */\n                min-width: 100%; /*  */\n                width: auto; /*  */\n                max-width: 450px; /*  */\n                box-sizing: border-box;\n            }\n            @media (min-width: 769px) {\n                .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                    max-width: 550px; /*  */\n                }\n            }\n            /*  -  */\n            .mvu-card-body.horizontal-nested > .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 200px;\n                max-width: 350px;\n                width: auto;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                min-width: 400px; /*  */\n                max-width: none; /*  */\n            }\n            @media (min-width: 769px) {\n                .mvu-card-body.horizontal-nested > .mvu-card {\n                    min-width: 240px;\n                    max-width: 400px;\n                }\n                .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                    min-width: 500px; /*  */\n                    max-width: none; /*  */\n                }\n            }\n\n            /*  */\n            .mvu-row {\n                display: flex;\n                align-items: flex-start;\n                padding: 5px 0;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n            .mvu-row:last-child {\n                border-bottom: none;\n            }\n            .mvu-key {\n                color: var(--acu-text-sub);\n                min-width: 80px;\n                max-width: 120px;\n                flex-shrink: 0;\n                font-size: 12px;\n                padding-right: 8px;\n                word-break: break-all;\n            }\n            .mvu-value-wrap {\n                flex: 1;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                min-width: 0;\n            }\n            .mvu-value {\n                color: var(--acu-text-main);\n                font-size: var(--acu-font-size, 13px);\n                cursor: pointer;\n                padding: 1px 6px;\n                border-radius: 4px;\n                transition: background 0.2s;\n                word-break: break-word;\n                flex: 0 1 auto;\n            }\n            .mvu-value:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-value.mvu-array-value {\n                font-size: calc(var(--acu-font-size, 13px) * 0.92);\n                color: var(--acu-text-sub);\n            }\n            .mvu-change-indicator {\n                color: var(--acu-success-text);\n                font-weight: bold;\n                font-size: 12px;\n                flex-shrink: 0;\n            }\n            .mvu-row.mvu-changed {\n                background: var(--acu-success-bg);\n                margin: 0 -12px;\n                padding: 5px 12px;\n                border-radius: 4px;\n            }\n            .mvu-card .mvu-card .mvu-row.mvu-changed {\n                margin: 0 -10px;\n                padding: 5px 10px;\n            }\n\n            /*  */\n            .mvu-empty {\n                text-align: center;\n                padding: 40px 20px;\n                color: var(--acu-text-sub);\n                flex: 1;\n                min-width: 100%;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n            }\n            .mvu-empty i {\n                font-size: 32px;\n                margin-bottom: 12px;\n                display: block;\n                opacity: 0.5;\n            }\n            .mvu-empty p {\n                margin: 0 0 6px 0;\n            }\n            .mvu-empty .mvu-empty-hint {\n                font-size: 12px;\n                opacity: 0.7;\n            }\n\n            /*  */\n            .mvu-edit-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0,0,0,0.6);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 99999;\n                animation: mvuFadeIn 0.15s ease-out;\n            }\n            .mvu-edit-dialog {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                padding: 16px;\n                width: 90%;\n                max-width: 400px;\n                animation: mvuSlideIn 0.2s ease-out;\n            }\n            .mvu-edit-title {\n                font-weight: 600;\n                color: var(--acu-text-main);\n                margin-bottom: 12px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .mvu-edit-path {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                background: var(--acu-table-head);\n                padding: 6px 10px;\n                border-radius: 4px;\n                margin-bottom: 12px;\n                word-break: break-all;\n                font-family: monospace;\n            }\n            .mvu-edit-textarea {\n                width: 100%;\n                min-height: 80px;\n                padding: 10px;\n                border: 1px solid var(--acu-border);\n                border-radius: 4px;\n                background: var(--acu-input-bg, var(--acu-bg-panel));\n                color: var(--acu-text-main);\n                font-size: 13px;\n                resize: vertical;\n                box-sizing: border-box;\n            }\n            .mvu-edit-textarea:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n            }\n            .mvu-edit-hint {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                margin-top: 8px;\n                opacity: 0.7;\n            }\n            .mvu-edit-btns {\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n                margin-top: 16px;\n            }\n            .mvu-edit-btn {\n                padding: 8px 16px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 13px;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                transition: all 0.2s;\n            }\n            .mvu-edit-btn.mvu-btn-cancel {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n            }\n            .mvu-edit-btn.mvu-btn-cancel:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-edit-btn.mvu-btn-save {\n                background: var(--acu-accent);\n                border: 1px solid var(--acu-accent);\n                color: var(--acu-btn-active-text);\n            }\n            .mvu-edit-btn.mvu-btn-save:hover {\n                opacity: 0.9;\n            }\n\n            @keyframes mvuFadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes mvuSlideIn {\n                from { transform: translateY(-20px); opacity: 0; }\n                to { transform: translateY(0); opacity: 1; }\n            }\n\n            /*  */\n            .acu-nav-btn.acu-mvu-btn.active {\n                background: var(--acu-btn-active-bg);\n                color: var(--acu-btn-active-text);\n            }\n        `;\n\n    // =====  =====\n    function escapeHtml(s) {\n      return String(s ?? '')\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#039;');\n    }\n\n    function isAvailable() {\n      const mode = detectMode();\n\n      if (mode === 'era') {\n        // ERA  eventEmit  eventOn  iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const emitAvailable = typeof eventEmit === 'function';\n        const onAvailable = typeof eventOn === 'function';\n        return emitAvailable && onAvailable;\n      } else if (mode === 'lwb') {\n        // [] LWB  chatMetadata.variables \n        const ST = window.SillyTavern || window.parent?.SillyTavern;\n        return ST?.chatMetadata !== undefined;\n      } else {\n        // MVU  MVU \n        const mvuAvailable = typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function';\n        return mvuAvailable;\n      }\n    }\n\n    function getData() {\n      console.warn('[DICE]: getData()  MVU  getDataWithRetry()');\n\n      clearMvuCacheIfChatChanged();\n\n      //  ERA  MVU\n      if (cachedEraData) {\n        return cachedEraData;\n      }\n\n      // []  LWB\n      if (isLwbChatContext()) {\n        const lwbData = getLwbData();\n        cachedEraData = lwbData;\n        cachedEraDataChatId = getCurrentChatIdSafe();\n        console.log('[DICE]LWB ');\n        return lwbData;\n      }\n\n      //  MVU\n      try {\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (allVars && allVars.stat_data) {\n            const data = {\n              stat_data: allVars.stat_data || null,\n              display_data: allVars.display_data || {},\n              delta_data: allVars.delta_data || {},\n              schema: allVars.schema || null,\n              _source: 'mvu', // \n            };\n\n            cachedEraData = data; // \n            cachedEraDataChatId = getCurrentChatIdSafe();\n            return data;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE] MVU :', e);\n      }\n\n      return null;\n    }\n\n    // ===== MVU  =====\n    async function getMvuDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // []  MVU API \n        if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n          //  MVU \n          try {\n            await Promise.race([\n              waitGlobalInitialized('Mvu'),\n              new Promise((_, reject) => setTimeout(() => reject(new Error(' MVU ')), 3000)),\n            ]);\n          } catch (e) {\n            console.warn('[DICE] MVU :', e.message);\n            //  MVU \n          }\n        }\n\n        for (let attempt = 1; attempt <= maxRetries; attempt++) {\n          try {\n            if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n              throw new Error('MVU API ');\n            }\n\n            const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n            if (allVars && allVars.stat_data) {\n              const data = {\n                stat_data: allVars.stat_data || null,\n                display_data: allVars.display_data || {},\n                delta_data: allVars.delta_data || {},\n                schema: allVars.schema || null,\n                _source: 'mvu', // \n              };\n\n              //  MVU \n              cachedEraData = data;\n              cachedEraDataChatId = getCurrentChatIdSafe();\n              console.log('[DICE]MVU ');\n              return data;\n            }\n          } catch (e) {\n            console.warn(`[DICE]MVU  ( ${attempt}/${maxRetries}):`, e);\n          }\n\n          if (attempt < maxRetries) {\n            await new Promise(resolve => setTimeout(resolve, retryDelay));\n          }\n        }\n\n        return null;\n      } catch (e) {\n        console.error('[DICE]MVU :', e);\n        return null;\n      }\n    }\n\n    // \n    async function getDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // \n        const detection = await detectModeWithData();\n\n        // \n        if (detection.data) {\n          cachedEraData = detection.data; // \n          cachedEraDataChatId = getCurrentChatIdSafe();\n          return detection.data;\n        }\n\n        // \n        const mode = detection.mode;\n\n        if (mode === 'era') {\n          // ERA \n          for (let attempt = 1; attempt <= maxRetries; attempt++) {\n            try {\n              const data = await getEraData();\n              if (data && data.stat_data) {\n                cachedEraData = data;\n                cachedEraDataChatId = getCurrentChatIdSafe();\n                return data;\n              }\n            } catch (e) {\n              console.warn(`[DICE]ERA  ( ${attempt}/${maxRetries}):`, e);\n            }\n\n            if (attempt < maxRetries) {\n              await new Promise(resolve => setTimeout(resolve, retryDelay));\n            }\n          }\n\n          // ERA  MVU\n          console.warn('[DICE]ERA  MVU');\n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        } else if (mode === 'lwb') {\n          // [] LWB \n          const lwbData = getLwbData();\n          cachedEraData = lwbData;\n          cachedEraDataChatId = getCurrentChatIdSafe();\n          return lwbData;\n        } else {\n          // MVU \n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        }\n      } catch (e) {\n        console.error('[DICE]:', e);\n        return null;\n      }\n    }\n\n    //  ValueWithDescription  [, \"\"]\n    function isVWD(value) {\n      return (\n        Array.isArray(value) &&\n        value.length === 2 &&\n        typeof value[1] === 'string' &&\n        (typeof value[0] === 'number' || typeof value[0] === 'string' || typeof value[0] === 'boolean')\n      );\n    }\n\n    // \n    function isSimpleArray(value) {\n      if (!Array.isArray(value)) return false;\n      return value.every(\n        item => typeof item === 'string' || typeof item === 'number' || typeof item === 'boolean' || item === null,\n      );\n    }\n\n    // \n    function getChangeIndicator(path, deltaData) {\n      if (!deltaData || !path) return '';\n\n      const parts = path.split('.');\n      let current = deltaData;\n      for (const part of parts) {\n        if (current === null || current === undefined) return '';\n        current = current[part];\n      }\n\n      if (!current) return '';\n\n      if (typeof current === 'string' && current.includes('->')) {\n        const match = current.match(/^(-?[\\d.]+)->(-?[\\d.]+)/);\n        if (match) {\n          const oldVal = parseFloat(match[1]);\n          const newVal = parseFloat(match[2]);\n          if (!isNaN(oldVal) && !isNaN(newVal)) {\n            return newVal > oldVal ? '' : newVal < oldVal ? '' : '';\n          }\n        }\n        return '';\n      }\n      return '';\n    }\n\n    // /\n    function countChildren(value) {\n      if (Array.isArray(value)) {\n        if (isVWD(value)) return 0;\n        return value.length;\n      }\n      if (value && typeof value === 'object') {\n        return Object.keys(value).filter(k => !k.startsWith('$')).length;\n      }\n      return 0;\n    }\n\n    // =====  =====\n\n    // \n    // +++\n    function extractNumericDisplayValue(value, isArray = false) {\n      //  null/undefined\n      if (value === null || value === undefined) {\n        return '';\n      }\n\n      // \n      if (isArray || Array.isArray(value)) {\n        if (isVWD(value)) {\n          return String(value[0]);\n        } else if (isSimpleArray(value)) {\n          return value.map(v => String(v ?? '')).join(', ');\n        } else {\n          // \n          return String(value);\n        }\n      }\n\n      // \n      const str = String(value).trim();\n\n      // 1.  \"85\", \"-20\", \"100%\"\n      if (/^-?\\d+(\\.\\d+)?%?$/.test(str)) {\n        return str;\n      }\n\n      // 2. ++ \",[] \" \n      // \"0,[-20, 120] User...\"\n      const rangeMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)(,\\s*\\[[^\\]]+\\])?\\s+/);\n      if (rangeMatch) {\n        // \n        if (rangeMatch[2]) {\n          return rangeMatch[1] + rangeMatch[2].trim();\n        }\n        // \n        return rangeMatch[1];\n      }\n\n      // 2.5. /, \"/,\" \n      // \"100/100,/'/'\"\n      const slashNumericMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?\\/-?\\d+(?:\\.\\d+)?%?),/);\n      if (slashNumericMatch) {\n        return slashNumericMatch[1];\n      }\n\n      // 3. , \",\" \n      // \"150000,...\"\n      const commaDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?),/);\n      if (commaDescMatch) {\n        return commaDescMatch[1];\n      }\n\n      // 4. + \" \" \n      // \"85 \"\n      const numericDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)\\s+[^\\d]/);\n      if (numericDescMatch) {\n        return numericDescMatch[1];\n      }\n\n      // 5. \n      return str;\n    }\n\n    // \n    // \"85\" -> 85, \"85,[0,100]\" -> 85, \"0,[-20, 120]\" -> 0\n    function extractFirstNumericValue(displayValue) {\n      if (!displayValue) return 0;\n      const str = String(displayValue).trim();\n\n      // \n      const match = str.match(/^(-?\\d+(?:\\.\\d+)?)/);\n      if (match) {\n        const num = parseFloat(match[1]);\n        return isNaN(num) ? 0 : num;\n      }\n\n      return 0;\n    }\n\n    // \n    function renderRow(key, value, path, deltaData) {\n      const changeIndicator = getChangeIndicator(path, deltaData);\n      const changedClass = changeIndicator ? 'mvu-changed' : '';\n\n      let displayValue;\n      let valueClass = 'mvu-value';\n\n      if (isVWD(value)) {\n        displayValue = String(value[0]);\n      } else if (isSimpleArray(value)) {\n        displayValue = value.map(v => String(v ?? '')).join(', ');\n        valueClass += ' mvu-array-value';\n      } else {\n        // \n        displayValue = extractNumericDisplayValue(value ?? '', false);\n      }\n\n      // [] \n      let diceIconHtml = '';\n      try {\n        //  extractNumericDisplayValue \n        //  \"85,[0,100]\"  85  100\n        if (typeof isNumericCell === 'function' && isNumericCell(displayValue)) {\n          // \n          const numericValue = extractFirstNumericValue(displayValue);\n          if (numericValue > 0) {\n            //  key key \n            let attrName = key;\n            if (key.includes('.')) {\n              const parts = key.split('.');\n              attrName = parts[parts.length - 1];\n            }\n            // \n            if (path && path.includes('.')) {\n              const pathParts = path.split('.');\n              const lastPart = pathParts[pathParts.length - 1];\n              // \n              if (lastPart && !/^\\d+$/.test(lastPart) && lastPart !== key) {\n                attrName = lastPart;\n              }\n            }\n            diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon acu-mvu-dice-icon\" data-path=\"${escapeHtml(path)}\" data-attr-name=\"${escapeHtml(attrName)}\" data-attr-value=\"${numericValue}\" title=\"\"></i>`;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule renderRow: ', e);\n      }\n\n      return `\n                <div class=\"mvu-row ${changedClass}\">\n                    <div class=\"mvu-key\">${escapeHtml(key)}</div>\n                    <div class=\"mvu-value-wrap\">\n                        <span class=\"${valueClass}\" data-path=\"${escapeHtml(path)}\">${escapeHtml(displayValue)}</span>\n                        ${diceIconHtml}\n                        ${changeIndicator ? `<span class=\"mvu-change-indicator\">${changeIndicator}</span>` : ''}\n                    </div>\n                </div>\n            `;\n    }\n\n    // \n    function renderCard(key, value, path, deltaData, depth, defaultExpanded, isHorizontal) {\n      const childCount = countChildren(value);\n      const collapsedClass = defaultExpanded ? '' : 'collapsed';\n\n      let bodyHtml = '';\n      let hasNestedCards = false; // \n      let nestedCardCount = 0; // \n      let rowCount = 0; // \n\n      if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n        // \n        value.forEach((item, index) => {\n          const itemPath = `${path}[${index}]`;\n\n          if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(`[${index}]`, item, itemPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            rowCount++;\n            bodyHtml += renderRow(`[${index}]`, item, itemPath, deltaData);\n          }\n        });\n      } else if (value && typeof value === 'object' && !isVWD(value)) {\n        // \n        const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n\n        for (const [childKey, childValue] of entries) {\n          const childPath = path ? `${path}.${childKey}` : childKey;\n\n          if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n            // /  \n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(childKey, childValue, childPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            //   \n            rowCount++;\n            bodyHtml += renderRow(childKey, childValue, childPath, deltaData);\n          }\n        }\n      }\n\n      const countText = Array.isArray(value) ? `[${childCount}]` : `(${childCount})`;\n\n      //  card-body  horizontal-nested \n      const bodyClass = isHorizontal && hasNestedCards ? 'mvu-card-body horizontal-nested' : 'mvu-card-body';\n\n      // \n      let nestedCardsNeedWidth = false;\n      if (isHorizontal && hasNestedCards && depth === 0) {\n        // \n        if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n          // \n          value.forEach(item => {\n            if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n              const itemChildCount = countChildren(item);\n              if (itemChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          });\n        } else if (value && typeof value === 'object' && !isVWD(value)) {\n          // \n          const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n          for (const [childKey, childValue] of entries) {\n            if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n              const childChildCount = countChildren(childValue);\n              if (childChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          }\n        }\n      }\n\n      //  has-nested-cards \n      // \n      // depth === 0\n      //   -  >= 2  <= 1 has-nested-cards\n      //   -  has-nested-cards\n      // depth > 0rowCount === 0 >= 2  has-nested-cards\n      const shouldAddHasNestedClass =\n        isHorizontal &&\n        hasNestedCards &&\n        ((depth === 0 && ((nestedCardCount >= 2 && rowCount <= 1) || nestedCardsNeedWidth)) || //  >= 2  <= 1\n          (depth > 0 && rowCount === 0 && nestedCardCount >= 2)); //  >= 2\n      const hasNestedClass = shouldAddHasNestedClass ? ' has-nested-cards' : '';\n\n      return `\n                <div class=\"mvu-card${hasNestedClass} ${collapsedClass}\" data-path=\"${escapeHtml(path)}\" data-depth=\"${depth}\">\n                    <div class=\"mvu-card-header\">\n                        <div class=\"mvu-card-title\">\n                            <span>${escapeHtml(key)}</span>\n                            <span class=\"mvu-card-count\">${countText}</span>\n                        </div>\n                        <span class=\"mvu-card-toggle\"></span>\n                    </div>\n                    <div class=\"${bodyClass}\">\n                        ${bodyHtml}\n                    </div>\n                </div>\n            `;\n    }\n\n    // [] \n    function renderNumericMode(mvuData) {\n      if (!mvuData || !mvuData.stat_data) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-inbox\"></i><p></p></div>';\n      }\n\n      // [] \n      let visibleLevels = {};\n      try {\n        const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n        if (saved) {\n          visibleLevels = JSON.parse(saved);\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule ', e);\n      }\n\n      // \n      const numericItems = [];\n\n      // \n      function collectNumericItems(obj, path, levelNames) {\n        if (!obj || typeof obj !== 'object') return;\n\n        if (Array.isArray(obj)) {\n          if (isVWD(obj) || isSimpleArray(obj)) {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const itemValue = String(item ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: itemPath,\n                    key: `[${index}]`,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: [...levelNames],\n                  });\n                }\n              }\n            });\n          } else {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const newLevelNames = [...levelNames, `[${index}]`];\n              collectNumericItems(item, itemPath, newLevelNames);\n            });\n          }\n        } else {\n          // \n          const entries = Object.entries(obj).filter(([k]) => !k.startsWith('$'));\n          for (const [key, value] of entries) {\n            const childPath = path ? `${path}.${key}` : key;\n            const newLevelNames = [...levelNames, key];\n\n            if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n              // \n              collectNumericItems(value, childPath, newLevelNames);\n            } else {\n              // \n              const itemValue = String(value ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: childPath,\n                    key: key,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: newLevelNames,\n                  });\n                }\n              }\n            }\n          }\n        }\n      }\n\n      // \n      const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n      for (const key of topKeys) {\n        const value = mvuData.stat_data[key];\n        collectNumericItems(value, key, [key]);\n      }\n\n      // [] \n      const filteredNumericItems = numericItems.filter(item => {\n        // \n        const nonArrayLevels = item.levelNames.filter(level => level && !level.startsWith('['));\n        // \n        // \n        for (const levelKey of nonArrayLevels) {\n          if (BlacklistManager.isBlacklisted(levelKey)) {\n            return false;\n          }\n        }\n        return true;\n      });\n\n      if (filteredNumericItems.length === 0) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-filter\"></i><p></p></div>';\n      }\n\n      // \n      //  2\n      const allLevelNames = new Set();\n      filteredNumericItems.forEach(item => {\n        // \n        const hierarchyLevels =\n          item.levelNames.length > 1\n            ? item.levelNames.slice(0, -1) // \n            : [];\n\n        hierarchyLevels.forEach(level => {\n          if (level && !level.startsWith('[')) {\n            // \n            allLevelNames.add(level);\n          }\n        });\n      });\n\n      const levelNamesArray = Array.from(allLevelNames).sort();\n\n      //  toggle \n      let levelTogglesHtml = '';\n      if (levelNamesArray.length > 0) {\n        // \n        let levelButtonsHtml = '';\n        levelNamesArray.forEach(levelName => {\n          const isVisible = visibleLevels[levelName] !== false; // \n          const activeClass = isVisible ? 'active' : '';\n          levelButtonsHtml += `<button class=\"mvu-level-toggle acu-mvu-level-toggle ${activeClass}\" data-level=\"${escapeHtml(levelName)}\" data-visible=\"${isVisible}\" title=\"${isVisible ? '' : ''}: ${escapeHtml(levelName)}\"><span>${escapeHtml(levelName)}</span></button>`;\n        });\n\n        // \n        levelTogglesHtml = `\n          <div class=\"mvu-level-controls-collapsible collapsed\">\n            <div class=\"mvu-level-controls-header acu-mvu-header\">\n              <span class=\"acu-mvu-header-text\"></span>\n              <i class=\"fa-solid fa-chevron-down mvu-level-controls-toggle-icon acu-mvu-toggle-icon\"></i>\n            </div>\n            <div class=\"mvu-level-controls-body acu-mvu-body\">\n              ${levelButtonsHtml}\n            </div>\n          </div>\n        `;\n      }\n\n      // \n      let itemsHtml = '';\n      filteredNumericItems.forEach(item => {\n        //  data-levels \n        const nonArrayLevels = item.levelNames.filter(level => !level.startsWith('['));\n\n        // \n        const visibleLevels = item.levelNames.filter(level => {\n          if (level.startsWith('[')) return false; // \n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        //  1\n        //  visibleLevels \n        const pathLevels = visibleLevels.length > 1 ? visibleLevels.slice(0, -1) : [];\n\n        // \n        //  nonArrayLevels  N-1 \n        const hierarchyLevels = nonArrayLevels.length > 1 ? nonArrayLevels.slice(0, -1) : [];\n\n        const allLevelsVisible = hierarchyLevels.every(level => {\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        // \n        const pathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n        const attrName = item.key;\n\n        // \n        let finalAttrName = attrName;\n        if (item.path && item.path.includes('.')) {\n          const parts = item.path.split('.');\n          finalAttrName = parts[parts.length - 1];\n        }\n\n        // \n        const diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon acu-mvu-dice-icon\" data-path=\"${escapeHtml(item.path)}\" data-attr-name=\"${escapeHtml(finalAttrName)}\" data-attr-value=\"${item.numericValue}\" title=\"\"></i>`;\n\n        // \n        let displayValue = extractNumericDisplayValue(item.value, false);\n        //  \",[0, 100]\"\n        displayValue = displayValue.replace(/,\\s*\\[[^\\]]+\\]/g, '');\n\n        //  data-levels \n        // data-levels \n        const displayStyle = allLevelsVisible ? '' : 'display:none;';\n        const levelsJson = JSON.stringify(hierarchyLevels);\n\n        itemsHtml += `\n          <div class=\"mvu-numeric-item acu-mvu-item\" data-levels='${escapeHtml(levelsJson)}' style=\"${displayStyle}\">\n            <div class=\"acu-mvu-item-content\">\n              <div class=\"mvu-path-display acu-mvu-path\">${escapeHtml(pathDisplay)}</div>\n              <div class=\"acu-mvu-item-row\">\n                <span class=\"acu-mvu-attr-name\">${escapeHtml(finalAttrName)}</span>\n                <span class=\"mvu-value acu-mvu-val\" data-path=\"${escapeHtml(item.path)}\" title=\"\">${escapeHtml(displayValue)}</span>\n                ${diceIconHtml}\n              </div>\n            </div>\n          </div>\n        `;\n      });\n\n      return levelTogglesHtml + '<div class=\"mvu-numeric-items acu-mvu-list\">' + itemsHtml + '</div>';\n    }\n\n    // =====  API =====\n    return {\n      MODULE_ID: MODULE_ID,\n\n      isAvailable: isAvailable,\n      getData: getData,\n      getDataWithRetry: getDataWithRetry,\n\n      // \n      diagnoseVariableFramework: async function () {\n        const result = {\n          timestamp: new Date().toISOString(),\n          era: {\n            available: false,\n            eventEmit: typeof (window.eventEmit || window.parent?.eventEmit) === 'function',\n            eventOn: typeof (window.eventOn || window.parent?.eventOn) === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          mvu: {\n            available: false,\n            apiExists: typeof window.Mvu !== 'undefined',\n            getDataExists: typeof window.Mvu?.getMvuData === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          cache: {\n            hasCache: !!cachedEraData,\n            cacheKeys: cachedEraData ? Object.keys(cachedEraData) : [],\n          },\n          recommendation: '',\n        };\n\n        //  ERA\n        if (result.era.eventEmit && result.era.eventOn) {\n          try {\n            const eraData = await Promise.race([\n              getEraData(),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 2000)),\n            ]);\n            result.era.available = true;\n            result.era.dataAvailable = !!(eraData && eraData.stat_data);\n          } catch (e) {\n            result.era.error = e.message;\n          }\n        }\n\n        //  MVU\n        if (result.mvu.apiExists && result.mvu.getDataExists) {\n          try {\n            // [] \n            await Promise.race([\n              waitGlobalInitialized('Mvu'),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('')), 2000)),\n            ]);\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            result.mvu.available = true;\n            result.mvu.dataAvailable = !!(mvuData && mvuData.stat_data);\n          } catch (e) {\n            result.mvu.error = e.message;\n          }\n        }\n\n        // \n        if (result.era.dataAvailable) {\n          result.recommendation = 'ERA ';\n        } else if (result.mvu.dataAvailable) {\n          result.recommendation = 'MVU ';\n        } else if (result.era.available || result.mvu.available) {\n          result.recommendation = '';\n        } else {\n          result.recommendation = ' MVU  ERA ';\n        }\n\n        return result;\n      },\n\n      injectStyles: function () {\n        //  document iframe \n        const targetDoc = window.parent?.document || document;\n        if (targetDoc.getElementById('mvu-module-styles')) return;\n        const styleEl = targetDoc.createElement('style');\n        styleEl.id = 'mvu-module-styles';\n        styleEl.textContent = STYLES;\n        targetDoc.head.appendChild(styleEl);\n      },\n\n      renderNavButton: function (isActive) {\n        //  isAvailable()\n        const activeClass = isActive ? 'active' : '';\n        return `<button class=\"acu-nav-btn acu-mvu-btn $${activeClass}\" id=\"acu-btn-mvu\" data-table=\"$${MODULE_ID}\" style=\"order:-1;\">\n                    <i class=\"fa-solid fa-code-branch\"></i><span></span>\n                </button>`;\n      },\n\n      renderPanel: function () {\n        // \n        // \n\n        const mvuData = getData();\n\n        // MVU  ERA\n        const varMode = (mvuData && mvuData._source) || detectMode();\n        const isEraMode = varMode === 'era';\n\n        // [] \n        let isNumericMode = false;\n        try {\n          const saved = localStorage.getItem('acu_mvu_numeric_mode');\n          isNumericMode = saved === 'true';\n        } catch (e) {\n          console.warn('[DICE]MvuModule ', e);\n        }\n\n        // MVU\n        const layoutMode = 'vertical-layout';\n\n        // \n        const panelTitle = varMode === 'lwb' ? 'LWB ' : varMode === 'era' ? 'ERA ' : 'MVU ';\n\n        // MVU  null\n        if (!mvuData) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-exclamation-circle\"></i>\n                                <p> ${isEraMode ? 'ERA' : 'MVU'} </p>\n                                <p class=\"mvu-empty-hint\"> ${isEraMode ? 'ERA ' : 'MVU '}</p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        //  stat_data  null\n        if (\n          !mvuData.stat_data ||\n          (typeof mvuData.stat_data === 'object' && Object.keys(mvuData.stat_data).length === 0)\n        ) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-inbox\"></i>\n                                <p></p>\n                                <p class=\"mvu-empty-hint\">${varMode === 'lwb' ? ' AI  plot-log ' : ' AI '}</p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        // [] \n        if (isNumericMode) {\n          const numericHtml = renderNumericMode(mvuData);\n          return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span> <span style=\"font-size:calc(var(--acu-font-size,13px) * 0.85);color:var(--acu-text-sub);margin-left:6px;\">()</span></div>\n                            <div class=\"acu-title-sub\">()</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode active\" title=\"\">\n                                <i class=\"fa-solid fa-list\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode} mvu-numeric-mode\">\n                        ${numericHtml}\n                    </div>\n                `;\n        }\n\n        // \n        const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n\n        let cardsHtml = '';\n        for (const key of topKeys) {\n          const value = mvuData.stat_data[key];\n          const childCount = countChildren(value);\n\n          if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n            // /  \n            // MVU isHorizontal  false\n            cardsHtml += renderCard(key, value, key, mvuData.delta_data, 0, true, false);\n          } else {\n            //   \n            cardsHtml += `\n                            <div class=\"mvu-card\" data-path=\"${escapeHtml(key)}\" data-depth=\"0\">\n                                <div class=\"mvu-card-body\">\n                                    ${renderRow(key, value, key, mvuData.delta_data)}\n                                </div>\n                            </div>\n                        `;\n          }\n        }\n\n        return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                            <div class=\"acu-title-sub\">(${topKeys.length})</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode\" title=\"\">\n                                <i class=\"fa-solid fa-filter\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode}\">\n                        ${cardsHtml}\n                    </div>\n                `;\n      },\n\n      bindEvents: function ($container) {\n        //  jQuery\n        const $ = window.parent?.jQuery || window.jQuery;\n        if (!$ || !$container || !$container.length) {\n          console.warn('[DICE]MvuModule bindEvents: jQuery or container not available');\n          return;\n        }\n\n        //  jQuery \n        const $panel = $('#acu-data-area');\n        if (!$panel.length) {\n          console.warn('[DICE]MvuModule bindEvents: #acu-data-area not found');\n          return;\n        }\n\n        // \n        $panel.off('.mvu');\n\n        // /\n        $panel.on('click.mvu', '.mvu-card-header', function (e) {\n          e.stopPropagation();\n          const $card = $(this).closest('.mvu-card');\n          const $body = $card.find('> .mvu-card-body').first();\n\n          // \n          if ($body.is(':animated') || $body.hasClass('animating')) return;\n\n          if ($card.hasClass('collapsed')) {\n            //  hide()  collapsed \n            $body.hide();\n            $card.removeClass('collapsed');\n            $body.addClass('animating').slideDown(180, function () {\n              $(this).removeClass('animating');\n            });\n          } else {\n            // \n            $body.addClass('animating').slideUp(180, function () {\n              $card.addClass('collapsed');\n              $(this).removeClass('animating');\n            });\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-btn-refresh', function (e) {\n          e.stopPropagation();\n          MvuModule.refresh($panel);\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-btn-numeric-mode', function (e) {\n          e.stopPropagation();\n          try {\n            const isCurrentlyNumeric = $(this).hasClass('active');\n            const newMode = !isCurrentlyNumeric;\n            localStorage.setItem('acu_mvu_numeric_mode', String(newMode));\n            // \n            if (typeof saveActiveTabState === 'function') {\n              const currentTab = getActiveTabState();\n              saveActiveTabState(currentTab);\n            }\n            if (typeof renderInterface === 'function') {\n              renderInterface();\n            }\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n            if (window.toastr) window.toastr.error('');\n          }\n        });\n\n        // [] /\n        $panel.on('click.mvu', '.mvu-level-controls-header', function (e) {\n          e.stopPropagation();\n          const $header = $(this);\n          const $collapsible = $header.closest('.mvu-level-controls-collapsible');\n\n          //  collapsed CSS \n          $collapsible.toggleClass('collapsed');\n        });\n\n        // []  toggle\n        $panel.on('click.mvu', '.mvu-level-toggle', function (e) {\n          e.stopPropagation();\n          const $button = $(this);\n          const levelName = $button.data('level');\n          const currentVisible = $button.data('visible') === 'true' || $button.data('visible') === true;\n          const isVisible = !currentVisible;\n\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            const visibleLevels = saved ? JSON.parse(saved) : {};\n            visibleLevels[levelName] = isVisible;\n            localStorage.setItem('acu_mvu_numeric_mode_visible_levels', JSON.stringify(visibleLevels));\n\n            // \n            $button.data('visible', isVisible);\n            if (isVisible) {\n              $button.css({\n                background: 'var(--acu-accent)',\n                color: 'var(--acu-btn-active-text)',\n                borderColor: 'var(--acu-accent)',\n                opacity: '1',\n              });\n              $button.attr('title', `: ${levelName}`);\n            } else {\n              $button.css({\n                background: 'transparent',\n                color: 'var(--acu-text-sub)',\n                borderColor: 'var(--acu-border)',\n                opacity: '0.5',\n              });\n              $button.attr('title', `: ${levelName}`);\n            }\n\n            //  3\n            $('.mvu-numeric-item').each(function () {\n              const $item = $(this);\n              try {\n                const levels = JSON.parse($item.attr('data-levels') || '[]');\n                if (levels.includes(levelName)) {\n                  // \n                  const visibleLevels = levels.filter(level => {\n                    const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n                    const prefs = saved ? JSON.parse(saved) : {};\n                    return prefs[level] !== false;\n                  });\n\n                  //  levels \n                  const pathLevels = visibleLevels;\n\n                  const newPathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n\n                  // \n                  $item.find('.mvu-path-display').text(newPathDisplay);\n                }\n              } catch (e) {\n                console.warn('[DICE]MvuModule ', e);\n              }\n            });\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-value', function (e) {\n          e.stopPropagation();\n          const $value = $(this);\n          const path = $value.data('path');\n          if (!path) {\n            console.warn('[DICE]MvuModule No path on value element');\n            return;\n          }\n          const currentValue = $value\n            .text()\n            .replace(/\\s*\\$\\s*$/, '')\n            .trim(); //  $\n\n          MvuModule.showEditDialog(path, currentValue, async function (newValue) {\n            if (newValue !== null && newValue !== currentValue) {\n              const success = await MvuModule.setValue(path, newValue);\n              const toastr = window.parent?.toastr || window.toastr;\n              if (success) {\n                $value.text(newValue);\n                $value.css('background', 'var(--acu-success-bg)');\n                setTimeout(() => $value.css('background', ''), 1500);\n              } else {\n                if (toastr) toastr.error('');\n              }\n            }\n          });\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-dice-icon', function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n          const $icon = $(this);\n          const path = $icon.data('path');\n          const attrName = $icon.data('attr-name') || '';\n          const attrValue = parseInt($icon.data('attr-value'), 10) || 50;\n\n          // \n          if (!path) {\n            console.warn('[DICE]MvuModule ');\n            return;\n          }\n\n          //  MVU \n          if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n            console.warn('[DICE]MvuModule MVU ');\n            // \n            if (typeof showDicePanel === 'function') {\n              showDicePanel({\n                attrValue: attrValue,\n                targetValue: null, // showDicePanel\n                targetName: attrName,\n                initiatorName: '<user>',\n                fromMvu: false,\n              });\n            }\n            return;\n          }\n\n          // \n          let parsedInfo = null;\n          try {\n            parsedInfo = parseMvuPathForDice(path, attrValue);\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n\n          // \n          if (typeof showDicePanel === 'function') {\n            showDicePanel({\n              attrValue: attrValue,\n              targetValue: null, // showDicePanel\n              targetName: attrName,\n              initiatorName: parsedInfo?.initiator || '<user>',\n              fromMvu: true,\n              mvuPath: path,\n              mvuParsedInfo: parsedInfo,\n            });\n          }\n        });\n\n        //  ST  swipe regenerate\n        (function () {\n          //  documentiframe \n          const targetDoc = window.parent?.document || document;\n          const $doc = $(targetDoc);\n\n          // \n          $doc.off('touchstart.mvuSwipeFix touchmove.mvuSwipeFix touchend.mvuSwipeFix', '#acu-data-area');\n\n          let touchStartX = 0;\n          let touchStartY = 0;\n          let isHorizontalSwipe = false;\n\n          //  #acu-data-area  MVU \n          $doc.on('touchstart.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) return;\n\n            if (e.originalEvent.touches.length === 1) {\n              touchStartX = e.originalEvent.touches[0].clientX;\n              touchStartY = e.originalEvent.touches[0].clientY;\n              isHorizontalSwipe = false;\n            }\n          });\n\n          $doc.on('touchmove.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              return;\n            }\n\n            if (e.originalEvent.touches.length !== 1) return;\n\n            const touch = e.originalEvent.touches[0];\n            const deltaX = Math.abs(touch.clientX - touchStartX);\n            const deltaY = Math.abs(touch.clientY - touchStartY);\n\n            // X > Y * 1.5\n            // deltaYdeltaX\n            const isHorizontal =\n              deltaY < 5\n                ? deltaX > 5 && deltaX > deltaY * 2 // deltaYdeltaX > 5deltaY\n                : deltaX > deltaY * 1.5 && deltaX > 10; // \n\n            if (isHorizontal) {\n              isHorizontalSwipe = true;\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n            }\n          });\n\n          $doc.on('touchend.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              isHorizontalSwipe = false;\n              touchStartX = 0;\n              touchStartY = 0;\n              return;\n            }\n\n            // \n            if (isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              isHorizontalSwipe = false;\n            }\n            touchStartX = 0;\n            touchStartY = 0;\n          });\n\n          // \n          const captureHandlerTouchStart = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1) {\n              touchStartX = e.touches[0].clientX;\n              touchStartY = e.touches[0].clientY;\n            }\n          };\n          const captureHandlerTouchMove = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1 && touchStartX && touchStartY) {\n              const touch = e.touches[0];\n              const deltaX = Math.abs(touch.clientX - touchStartX);\n              const deltaY = Math.abs(touch.clientY - touchStartY);\n              // \n              const isHorizontal =\n                deltaY < 5 ? deltaX > 5 && deltaX > deltaY * 2 : deltaX > deltaY * 1.5 && deltaX > 10;\n              if (isHorizontal) {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                e.preventDefault();\n              }\n            }\n          };\n          const captureHandlerTouchEnd = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              e.preventDefault();\n            }\n          };\n          // \n          targetDoc.addEventListener('touchstart', captureHandlerTouchStart, true);\n          targetDoc.addEventListener('touchmove', captureHandlerTouchMove, true);\n          targetDoc.addEventListener('touchend', captureHandlerTouchEnd, true);\n        })();\n\n        // \n        $panel.on('click.mvu', '.acu-close-btn', function (e) {\n          e.stopPropagation();\n          const $input = $panel.find('.acu-search-input');\n\n          // \n          if ($input.length && $input.val()) {\n            $input.val('').trigger('input').focus();\n            return;\n          }\n\n          // \n          if (typeof saveActiveTabState === 'function') {\n            saveActiveTabState(null);\n          }\n          if (typeof renderInterface === 'function') {\n            renderInterface();\n          }\n        });\n\n        // \n        $panel.on('pointerdown.mvu', '.acu-height-drag-handle', function (e) {\n          if (e.button !== 0) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const handle = this;\n          handle.setPointerCapture(e.pointerId);\n          $(handle).addClass('active');\n          const startHeight = $panel.height();\n          const startY = e.clientY;\n          const tableName = $(handle).data('table');\n\n          //  MIN_PANEL_HEIGHT  MAX_PANEL_HEIGHT\n          const MIN_PANEL_HEIGHT = typeof window.MIN_PANEL_HEIGHT !== 'undefined' ? window.MIN_PANEL_HEIGHT : 200;\n          const MAX_PANEL_HEIGHT = typeof window.MAX_PANEL_HEIGHT !== 'undefined' ? window.MAX_PANEL_HEIGHT : 800;\n\n          handle.onpointermove = function (moveE) {\n            const dy = moveE.clientY - startY;\n            let newHeight = startHeight - dy; // \n            if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n            if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n            $panel.css('height', newHeight + 'px');\n          };\n          handle.onpointerup = function (upE) {\n            $(handle).removeClass('active');\n            handle.releasePointerCapture(upE.pointerId);\n            handle.onpointermove = null;\n            handle.onpointerup = null;\n            if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n              const heights = getTableHeights();\n              heights[tableName] = parseInt($panel.css('height'));\n              saveTableHeights(heights);\n              $panel.addClass('acu-manual-mode');\n            }\n          };\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-height-drag-handle', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = $(this).data('table');\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-panel-header', function (e) {\n          if ($(e.target).closest('.acu-search-input, .acu-close-btn, .mvu-header-btn').length) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = MvuModule.MODULE_ID;\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n      },\n\n      showEditDialog: function (path, currentValue, onSave) {\n        //  jQuery  document\n        const $ = window.parent?.jQuery || window.jQuery;\n        const targetDoc = window.parent?.document || document;\n        if (!$) return;\n\n        // \n        $(targetDoc).find('.mvu-edit-overlay').remove();\n\n        const currentTheme = (typeof getConfig === 'function' ? getConfig().theme : null) || 'retro';\n\n        const html = `\n                    <div class=\"mvu-edit-overlay acu-edit-overlay acu-theme-${currentTheme}\">\n                        <div class=\"mvu-edit-dialog acu-edit-dialog\">\n                            <div class=\"acu-edit-title\">\n                                <i class=\"fa-solid fa-edit acu-edit-icon-muted\"></i>\n                                <span></span>\n                            </div>\n                            <div class=\"mvu-edit-path\">${escapeHtml(path)}</div>\n                            <textarea class=\"mvu-edit-textarea acu-edit-textarea\">${escapeHtml(currentValue)}</textarea>\n                            <div class=\"mvu-edit-hint\">Ctrl+Enter  | Esc </div>\n                            <div class=\"acu-dialog-btns\">\n                                <button class=\"acu-dialog-btn mvu-btn-cancel\">\n                                    <i class=\"fa-solid fa-times\"></i> \n                                </button>\n                                <button class=\"acu-dialog-btn acu-btn-confirm mvu-btn-save\">\n                                    <i class=\"fa-solid fa-check\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `;\n\n        $(targetDoc.body).append(html);\n        const $overlay = $(targetDoc).find('.mvu-edit-overlay');\n        const $input = $overlay.find('.mvu-edit-textarea');\n\n        setTimeout(() => $input.focus().select(), 50);\n\n        // \n        $overlay.on('click', '.mvu-btn-cancel', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          $overlay.remove();\n          onSave(null);\n        });\n\n        // \n        $overlay.on('click', '.mvu-btn-save', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const newValue = $input.val();\n          $overlay.remove();\n          onSave(newValue);\n        });\n\n        // \n        setupOverlayClose($overlay, 'mvu-edit-overlay', () => {\n          $overlay.remove();\n          onSave(null);\n        });\n\n        // \n        $input.on('keydown', function (e) {\n          if (e.key === 'Escape') {\n            e.preventDefault();\n            $overlay.remove();\n            onSave(null);\n          } else if (e.key === 'Enter' && e.ctrlKey) {\n            e.preventDefault();\n            const newValue = $input.val();\n            $overlay.remove();\n            onSave(newValue);\n          }\n        });\n      },\n\n      // ===== LWB  =====\n      //  \".\"  \"[0].\" \n      parsePath: function (path: string): { rootName: string; subPath: string } {\n        const match = path.match(/^([^.\\[]+)/);\n        const rootName = match ? match[1] : path;\n\n        let subPath = path.slice(rootName.length);\n        if (subPath.startsWith('.')) subPath = subPath.slice(1);\n\n        return { rootName, subPath };\n      },\n\n      // LWB \n      setLwbValue: function (path: string, value: unknown) {\n        try {\n          const ST = window.SillyTavern || window.parent?.SillyTavern;\n          if (!ST?.chatMetadata) {\n            console.error('[DICE] chatMetadata');\n            return;\n          }\n\n          if (!ST.chatMetadata.variables) {\n            ST.chatMetadata.variables = {};\n          }\n\n          const { rootName, subPath } = this.parsePath(path);\n\n          if (!subPath) {\n            // \n            ST.chatMetadata.variables[rootName] =\n              typeof value === 'object' && value !== null ? JSON.stringify(value) : String(value ?? '');\n          } else {\n            // \n            const currentRaw = ST.chatMetadata.variables[rootName];\n            let current = parseJsonSafe(currentRaw);\n\n            if (typeof current !== 'object' || current === null) {\n              current = {};\n            }\n\n            // lodash _.set  \"a[0].b\" \n            _.set(current as object, subPath, value);\n\n            ST.chatMetadata.variables[rootName] = JSON.stringify(current);\n          }\n\n          // \n          ST.saveMetadata?.();\n\n          // \n          cachedEraData = null;\n          cachedEraDataChatId = null;\n\n          console.log('[DICE]LWB :', path, '=', value);\n        } catch (e) {\n          console.error('[DICE]LWB :', e);\n        }\n      },\n\n      setValue: async function (path, newValue) {\n        if (!isAvailable()) return false;\n\n        const mode = detectMode();\n\n        try {\n          let parsedValue = newValue;\n          if (newValue === 'true') parsedValue = true;\n          else if (newValue === 'false') parsedValue = false;\n          else if (!isNaN(Number(newValue)) && String(newValue).trim() !== '') {\n            parsedValue = Number(newValue);\n          }\n\n          if (mode === 'era') {\n            return await setEraValue(path, parsedValue);\n          } else if (mode === 'lwb') {\n            // [] LWB  chatMetadata.variables\n            this.setLwbValue(path, parsedValue);\n            return true;\n          } else {\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            if (!mvuData) {\n              console.error('[DICE]MvuModule  MVU ');\n              return false;\n            }\n\n            const success = await window.Mvu.setMvuVariable(mvuData, path, parsedValue, {\n              reason: '',\n              is_recursive: false,\n            });\n\n            if (success) {\n              await window.Mvu.replaceMvuData(mvuData, { type: 'message', message_id: 'latest' });\n            } else {\n              console.warn('[DICE]MvuModule setMvuVariable  false');\n            }\n\n            return success;\n          }\n        } catch (e) {\n          console.error('[DICE]MvuModule setValue error:', e);\n          return false;\n        }\n      },\n\n      isModuleTab: function (tableName) {\n        return tableName === MODULE_ID;\n      },\n\n      //  ERA  ERA \n      clearCache: function () {\n        cachedEraData = null;\n        cachedEraDataChatId = null;\n        console.log('[DICE]MvuModule  ERA ');\n      },\n\n      // \n      detectMode: function () {\n        return detectMode();\n      },\n\n      refresh: function ($container) {\n        // \n        this.clearCache();\n\n        if (!$container || !$container.length) {\n          const $panel = $('#acu-data-area');\n          if (!$panel.length) return;\n          $container = $panel;\n        }\n        // \n        const $refreshBtn = $container.find('.mvu-btn-refresh');\n        if ($refreshBtn.length) {\n          $refreshBtn.find('i').addClass('fa-spin');\n        }\n\n        // \n        //  10  1  10 \n        this.getDataWithRetry(10, 1000)\n          .then(mvuData => {\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            // [] \n            if (!canWriteMvuPanel()) return;\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            // []  toastr  renderPanel \n            //  getDataWithRetry \n            const toastr = window.parent?.toastr || window.toastr;\n            const actualData = this.getData();\n            if (toastr && !actualData) {\n              toastr.warning(' MVU ');\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error refreshing data:', err);\n\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            // [] \n            if (!canWriteMvuPanel()) return;\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            // [] \n            const toastr = window.parent?.toastr || window.toastr;\n            const actualData = this.getData();\n            if (toastr && !actualData) {\n              toastr.error('');\n            }\n          });\n      },\n    };\n  })();\n  // MVU \n  // COC\n  const DEFAULT_DICE_CONFIG = {\n    critSuccessMax: 5,\n    hardSuccessDiv: 5,\n    difficultSuccessDiv: 2,\n    critFailMin: 96,\n    ruleType: 'high_good',\n    lastDiceType: '1d100',\n    // DND \n    dndCritSuccess: 20,\n    dndCritFail: 1,\n    // : initiator_lose | tie | initiator_win\n    contestTieRule: 'initiator_lose',\n    // \n    hideDiceResultFromUser: false,\n    // \n    hideDiceResultInChat: false,\n    autoMergeProtagonist: true,\n  };\n\n  const getDiceConfig = () => Store.get(STORAGE_KEY_DICE_CONFIG, DEFAULT_DICE_CONFIG);\n  const saveDiceConfig = cfg => {\n    const oldCfg = getDiceConfig();\n    const newCfg = { ...oldCfg, ...cfg };\n    Store.set(STORAGE_KEY_DICE_CONFIG, newCfg);\n    // \n    const changedKeys = Object.keys(cfg).filter(k => oldCfg[k] !== newCfg[k]);\n    if (changedKeys.length > 0) {\n      console.info(`[DICE]: ${changedKeys.join(', ')}`);\n    }\n  };\n\n  // [] \n  const hideDiceResultsInUserMessages = () => {\n    try {\n      const diceCfg = getDiceConfig();\n      const hideInput = diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const hideChat = diceCfg.hideDiceResultInChat !== undefined ? diceCfg.hideDiceResultInChat : false;\n\n      //  <meta:>...</meta:>\n      const metaCheckResultRegex = /<meta:>[\\s\\S]*?<\\/meta:>/g;\n\n      // ==========  hideInput  ==========\n      try {\n        const $ta = $('#send_textarea');\n        if ($ta.length) {\n          let textareaVal = $ta.val() || '';\n          let modifiedText = textareaVal;\n\n          if (hideInput) {\n            // \n            if (metaCheckResultRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(metaCheckResultRegex, '[]');\n            }\n          } else {\n            // \n            const originalText = $ta.data('acu-original-dice-text');\n            if (originalText && textareaVal.includes('[]')) {\n              // \n              modifiedText = textareaVal.replace(/\\[\\]/g, originalText);\n              $ta.removeData('acu-original-dice-text');\n            }\n          }\n\n          if (modifiedText !== textareaVal) {\n            $ta.val(modifiedText).trigger('input').trigger('change');\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]ACU :', e);\n      }\n\n      // ==========  hideChat  ==========\n      // \n      let lastMessageId;\n      try {\n        lastMessageId = getLastMessageId();\n      } catch (e) {\n        //  lastMessageId \n        return;\n      }\n\n      // \n      if (lastMessageId < 0) {\n        return;\n      }\n\n      try {\n        const userMessages = getChatMessages(`0-${lastMessageId}`, { role: 'user' });\n        // \n        if (!userMessages || userMessages.length === 0) {\n          return;\n        }\n\n        if (hideChat) {\n          // \n          let hiddenCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const getMessageElement = (messageId: number | string) => {\n                if (typeof retrieveDisplayedMessage === 'function') {\n                  try {\n                    const $el = retrieveDisplayedMessage(messageId);\n                    if ($el && $el.length) return $el;\n                  } catch (e) {\n                    // fallback to DOM selector\n                  }\n                }\n                const idText = String(messageId);\n                const $chat = $('#chat');\n                if (!$chat.length) return $();\n                const $byMesId = $chat.find(\n                  `.mes[mesid=\"${idText}\"], .mes[data-message-id=\"${idText}\"], .mes#mes_${idText}, .message-body[data-message-id=\"${idText}\"]`,\n                );\n                return $byMesId.first();\n              };\n\n              const $msgElement = getMessageElement(msg.message_id);\n              if (!$msgElement || !$msgElement.length) {\n                return;\n              }\n\n              // \n              let $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) {\n                // \n                $mesText = $msgElement.find('.message-text, .text, [class*=\"text\"], [class*=\"message\"]').first();\n                if (!$mesText || !$mesText.length) {\n                  // \n                  $mesText = $msgElement;\n                }\n              }\n\n              // DOM\n              const currentDomText = $mesText.text();\n              // \n              if (currentDomText.includes('[]')) {\n                return;\n              }\n\n              // AI\n              const originalText = msg.message || '';\n              if (!originalText) {\n                return;\n              }\n\n              // HTML\n              const currentHtml = $mesText.html() || '';\n              let modifiedHtml = currentHtml;\n\n              //  <meta:> HTML\n              // HTML\n              modifiedHtml = modifiedHtml.replace(\n                /(&lt;|<)meta:(&gt;|>)[\\s\\S]*?(&lt;|<)\\/meta:(&gt;|>)/g,\n                '[]',\n              );\n              if (modifiedHtml === currentHtml) {\n                modifiedHtml = modifiedHtml.replace(/<meta:>[\\s\\S]*?<\\/meta:>/g, '[]');\n              }\n\n              if (modifiedHtml !== currentHtml) {\n                $mesText.html(modifiedHtml);\n                hiddenCount++;\n                return;\n              }\n\n              // HTML \n              const metaRegex = /<meta:>[\\s\\S]*?<\\/meta:>/g;\n              const replacedText = currentDomText.replace(metaRegex, '[]');\n              if (replacedText !== currentDomText) {\n                $mesText.text(replacedText);\n                hiddenCount++;\n                return;\n              }\n\n              // DOM \n              const replacedFromOriginal = originalText.replace(metaRegex, '[]');\n              if (replacedFromOriginal !== originalText && replacedFromOriginal !== currentDomText) {\n                if (typeof formatAsDisplayedMessage === 'function') {\n                  $mesText.html(formatAsDisplayedMessage(replacedFromOriginal));\n                } else {\n                  $mesText.text(replacedFromOriginal);\n                }\n                hiddenCount++;\n              }\n            } catch (e) {\n              console.warn(`[DICE]ACU  ${msg.message_id} :`, e);\n            }\n          });\n          if (hiddenCount === 0) {\n            const $chat = $('#chat');\n            if ($chat.length) {\n              $chat.find('.mes, .message-body').each((_, elem) => {\n                const $elem = $(elem);\n                const $target = $elem.find('.mes_text').length ? $elem.find('.mes_text') : $elem;\n                const html = $target.html() || '';\n                let replaced = html.replace(\n                  /(&lt;|<)meta:(&gt;|>)[\\s\\S]*?(&lt;|<)\\/meta:(&gt;|>)/g,\n                  '[]',\n                );\n                if (replaced === html) {\n                  replaced = html.replace(/<meta:>[\\s\\S]*?<\\/meta:>/g, '[]');\n                }\n                if (replaced !== html) {\n                  $target.html(replaced);\n                  hiddenCount++;\n                }\n              });\n            }\n          }\n          if (hiddenCount > 0) {\n            console.info(`[DICE] ${hiddenCount} `);\n          }\n        } else {\n          // \n          let restoredCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const getMessageElement = (messageId: number | string) => {\n                if (typeof retrieveDisplayedMessage === 'function') {\n                  try {\n                    const $el = retrieveDisplayedMessage(messageId);\n                    if ($el && $el.length) return $el;\n                  } catch (e) {\n                    // fallback to DOM selector\n                  }\n                }\n                const idText = String(messageId);\n                const $chat = $('#chat');\n                if (!$chat.length) return $();\n                const $byMesId = $chat.find(\n                  `.mes[mesid=\"${idText}\"], .mes[data-message-id=\"${idText}\"], .mes#mes_${idText}, .message-body[data-message-id=\"${idText}\"]`,\n                );\n                return $byMesId.first();\n              };\n\n              const $msgElement = getMessageElement(msg.message_id);\n              if (!$msgElement || !$msgElement.length) return;\n\n              const $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) return;\n\n              // \n              const currentText = $mesText.text();\n              if (currentText.includes('[]')) {\n                // \n                const originalText = msg.message || '';\n                if (originalText) {\n                  $mesText.text(originalText);\n                  restoredCount++;\n                }\n              }\n            } catch (e) {\n              // \n            }\n          });\n          if (restoredCount > 0) {\n            console.info(`[DICE] ${restoredCount} `);\n          }\n        }\n      } catch (e) {\n        // \n        // \n        if (hideChat) {\n          console.warn('[DICE]ACU :', e);\n        }\n      }\n    } catch (e) {\n      // [] \n      // \n      const diceCfg = getDiceConfig();\n      if (diceCfg && (diceCfg.hideDiceResultFromUser || diceCfg.hideDiceResultInChat)) {\n        console.warn('[DICE]ACU :', e);\n      }\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  /**  */\n  interface OutcomeLevel {\n    id: string; // \n    name: string; //  ( \"\")\n    condition: string; //  ( evaluateCondition )\n    priority: number; //  ()\n    contestRank?: number; //  ()\n    outputText?: string; //  ()\n    displayExpr?: string; //  (, condition)\n    style?: {\n      color?: string;\n    };\n    /**  */\n    effects?: Effect[];\n  }\n\n  /**  */\n  interface ContestRule {\n    /**  PbtA  */\n    disabled?: boolean;\n    mode?: 'rank' | 'value' | 'margin' | 'custom'; // \n    tieBreakers?: string[]; // \n    tieBreaker?: string; // ()\n    customExpr?: string; //  (mode='custom' )\n    hideDc?: boolean; // DC\n    hideMod?: boolean; // \n    hideSkillMod?: boolean; // \n  }\n\n  /**  */\n  interface Effect {\n    /**  */\n    id: string;\n    /**  */\n    target: string;\n    /**  */\n    operation: 'add' | 'subtract' | 'set';\n    /**  () */\n    value: string;\n    /**  () */\n    condition?: string;\n    /**  () */\n    initValue?: number;\n    /**  () */\n    min?: number;\n    /**  () */\n    max?: number;\n    /**  () */\n    outputText?: string;\n    /**  true () */\n    needsConfirm?: boolean;\n    /**  \"\" () */\n    label?: string;\n    /**  () */\n    inputPlaceholder?: string;\n  }\n\n  /**  */\n  interface EffectsConfig {\n    /**  () */\n    triggerPatterns: string[];\n    /**  */\n    allowedTargets: string[];\n    /**  () */\n    outcomes?: {\n      [outcomeName: string]: Effect[];\n    };\n    /**  () */\n    defaultValues?: {\n      [outcomeName: string]: string;\n    };\n  }\n\n  /**  (Lucky Burner ) */\n  interface ResourceBurner {\n    /**  */\n    id: string;\n    /**  */\n    resourceName: string;\n    /** / ( \"$roll > $attr\" ) */\n    condition?: string;\n    /** : roll=, mod=, dc=, attribute= */\n    target: 'roll' | 'mod' | 'dc' | 'attribute';\n    /**  ( 1 = 1) */\n    ratio: number;\n    /**  (increase=, decrease=) */\n    direction: 'increase' | 'decrease';\n    /** : subtract=/(), add=/ */\n    resourceOperation?: 'subtract' | 'add';\n    /**  ( \"$roll.total - $attr\"\"\") */\n    suggestedAmount?: string;\n    /**  () */\n    selector?: CheckSelector;\n    /** UI  */\n    ui?: {\n      icon?: string;\n      color?: string;\n      tooltip?: string;\n    };\n  }\n\n  interface QuickActionBase {\n    /**  */\n    id: string;\n    /**  (fa- ) */\n    icon?: string;\n    /**  */\n    tooltip?: string;\n    /**  */\n    condition?: string;\n  }\n\n  interface WorkflowQuickAction extends QuickActionBase {\n    kind: 'workflow_shortcut';\n    config: {\n      /** ID */\n      presetId: string;\n      /**  */\n      carryInitiator?: boolean;\n      carryAttrName?: boolean;\n      carryAttrValue?: boolean;\n      carryTarget?: boolean;\n      carryModifier?: boolean;\n      carrySkillMod?: boolean;\n      /**  */\n      attrName?: string;\n      /**  */\n      customFieldValues?: Record<string, string | number | boolean>;\n    };\n  }\n\n  interface AttrShortcutQuickAction extends QuickActionBase {\n    kind: 'attr_shortcut';\n    config: {\n      /**  */\n      presetId: string;\n      /**  */\n      attrAliasCandidates: string[];\n      /**  */\n      fallbackAttrName?: string;\n      /**  */\n      carryInitiator?: boolean;\n      /**  */\n      carryAttrValue?: boolean;\n      /**  */\n      carryTarget?: boolean;\n      /**  */\n      carryModifier?: boolean;\n      /**  */\n      carrySkillMod?: boolean;\n    };\n  }\n\n  type PresetQuickAction = WorkflowQuickAction | AttrShortcutQuickAction;\n\n  interface CurrentAttrAutoUpdate {\n    /**  */\n    enabled?: boolean;\n    /**  */\n    when?: 'success' | 'failure' | 'always';\n    /**  */\n    operation: 'add' | 'subtract' | 'set';\n    /**  */\n    valueExpr: string;\n    /**  */\n    initValue?: number;\n    /**  */\n    min?: number;\n    /**  */\n    max?: number;\n    /**  */\n    aliasCandidates?: string[];\n    /** // */\n    changeLabel?: string;\n    /** $attr, $attrPlain, $old, $new, $delta, $expr, $rolled, $operation, $changeLabel */\n    outputTextTemplate?: string;\n  }\n\n  /**  ( Effects  ResourceBurner ) */\n  interface CheckSelector {\n    /**  */\n    namePatterns?: {\n      /**  ['*']  */\n      include?: string[];\n      /**  include []  */\n      exclude?: string[];\n    };\n    /**  ( damage/pushed/luck) */\n    tags?: {\n      /**  */\n      include?: string[];\n      /**  */\n      exclude?: string[];\n    };\n  }\n\n  /**  */\n  interface EffectResult {\n    /**  ID */\n    effectId: string;\n    /**  */\n    success: boolean;\n    /**  */\n    oldValue: number;\n    /**  */\n    newValue: number;\n    /**  */\n    error?: string;\n    /**  */\n    target?: string;\n    /** 1= */\n    level?: number;\n    /** ID */\n    triggerSourceId?: string;\n    /**  */\n    triggerThreshold?: number;\n    /** threshold/delta/primary */\n    triggerType?: 'threshold' | 'delta' | 'primary';\n    /** all  */\n    triggerMatchIndex?: number;\n    /** all  */\n    triggerMatchCount?: number;\n    /**  secondaryEffect.outputText  */\n    outputMessage?: string;\n    /** UI */\n    branchLabel?: string;\n    /**  4d4 / 1d6 / 3 */\n    formulaText?: string;\n    /**  */\n    rolledValue?: number;\n  }\n\n  /**\n   *  ()\n   */\n  interface ComputedEffect {\n    /** ID */\n    effectId: string;\n    /**  */\n    target: string;\n    /**  */\n    resolvedTarget?: string;\n    /**  */\n    computedValue: number;\n    /**  */\n    rolledValue: number;\n    /**  */\n    formula: string;\n    /** , \"1d6  3\" */\n    displayText: string;\n    /**  */\n    beforeValue?: number | null;\n    /**  */\n    afterValue?: number | null;\n    /**  */\n    conditionExpr?: string;\n    /**  */\n    resolvedConditionExpr?: string;\n    /**  */\n    conditionPassed?: boolean;\n    /**  */\n    conditionSummary?: string;\n  }\n\n  interface EffectConfirmUiConfig {\n    /**  */\n    title?: string;\n    /**  */\n    effectListTitle?: string;\n    /**  */\n    branchReasonLabel?: string;\n  }\n\n  /**\n   * \n   *  AcuDice.CheckResult \n   */\n  interface CheckHistoryExtension {\n    /**  */\n    effectStatus?: 'planned' | 'confirmed' | 'committed' | 'failed' | 'cancelled';\n    /**  */\n    effectResults?: EffectResult[];\n    /** ID */\n    effectRunId?: string;\n    /**  */\n    effectError?: string;\n    /**  */\n    effectTrace?: string[];\n    /**  */\n    effectEventSeq?: number;\n    /** Pushed Roll */\n    isPushed?: boolean;\n    /** ID */\n    detailId?: string;\n    /**  */\n    detailLines?: string[];\n    /**  */\n    initiatorName?: string;\n    /**  */\n    historyType?: 'check' | 'contest';\n  }\n\n  interface EffectRunEventPayload {\n    seq: number;\n    runId: string;\n    status: 'planned' | 'confirmed' | 'committed' | 'failed' | 'cancelled';\n    characterName: string;\n    attributeName: string;\n    historyIndex: number;\n    effectResults: EffectResult[];\n    effectTrace: string[];\n    chainMode?: 'first' | 'all';\n    error?: string;\n    timestamp: number;\n  }\n\n  interface EffectReplayOperation {\n    characterName: string;\n    target: string;\n    operation: 'add' | 'subtract' | 'set';\n    value: number;\n    initValue?: number;\n    min?: number;\n    max?: number;\n    aliasCandidates: string[];\n    resultRef: EffectResult;\n  }\n\n  /**\n   *  ()\n   * \n   */\n  interface SecondaryEffect {\n    /**  */\n    id: string;\n    /**  */\n    trigger: {\n      /** : threshold=, delta= */\n      type: 'threshold' | 'delta';\n      /**  */\n      attribute: string;\n      /**  */\n      operator: 'gt' | 'gte' | 'lt' | 'lte' | 'eq';\n      /**  \"{}/5\" */\n      value: string;\n    };\n    /**  () */\n    callback?: string;\n    /**  */\n    effects?: Effect[];\n    /**  (: $delta, $old, $new, $attr, $depth, $tableRoll, $tableResult) */\n    outputText?: string;\n    /** :  $tableRoll/$tableResult  outputText  */\n    randomTable?: {\n      /**  ( '1d10') */\n      dice: string;\n      /** : key=, value= */\n      entries: Record<number, string>;\n    };\n    /**  $<key>Roll / $<key>Result */\n    randomTables?: Record<\n      string,\n      {\n        /**  ( '1d10') */\n        dice: string;\n        /**  $<key>Result  */\n        entries?: Record<number, string>;\n      }\n    >;\n    /**  INT  */\n    subCheck?: {\n      /**  */\n      label?: string;\n      /**  */\n      attribute: string;\n      /** / */\n      attributeCandidates?: string[];\n      /**  1d100 */\n      dice?: string;\n      /**  lte */\n      operator?: 'gt' | 'gte' | 'lt' | 'lte' | 'eq';\n      /**  */\n      targetValue?: string;\n      /**  */\n      missingAttributeText?: string;\n      /**  */\n      success?: {\n        outputText?: string;\n        randomTable?: {\n          dice: string;\n          entries: Record<number, string>;\n        };\n        randomTables?: Record<\n          string,\n          {\n            dice: string;\n            entries?: Record<number, string>;\n          }\n        >;\n        effects?: Effect[];\n      };\n      /**  */\n      failure?: {\n        outputText?: string;\n        randomTable?: {\n          dice: string;\n          entries: Record<number, string>;\n        };\n        randomTables?: Record<\n          string,\n          {\n            dice: string;\n            entries?: Record<number, string>;\n          }\n        >;\n        effects?: Effect[];\n      };\n    };\n    /**  true */\n    enabled?: boolean;\n    /**  1 */\n    maxTriggerCount?: number;\n  }\n\n  /**  */\n  interface FieldConfig {\n    /**  */\n    label?: string;\n    /**  placeholder  */\n    placeholder?: string;\n    /** ,() */\n    defaultValue: number | string;\n    /**  */\n    hidden?: boolean;\n  }\n\n  interface AdvancedDicePreset {\n    kind: 'advanced';\n    id: string;\n    name: string;\n    description?: string;\n    version: string;\n    builtin: boolean;\n    visible?: boolean;\n    order?: number;\n    createdAt?: string;\n\n    // \n    diceExpression: string;\n\n    // /\n    attributeName?: FieldConfig;\n\n    // \n    attribute: FieldConfig & {\n      key?: string; // \n    };\n\n    // DC\n    dc: FieldConfig;\n\n    // \n    mod?: FieldConfig;\n\n    //  attribute/mod  DND5e \n    skillMod?: FieldConfig;\n\n    /**\n     * \n     * - key:  ID ('attribute' | 'skillMod' | 'mod' | customField.id)\n     * - value: \n     * -  fallback  'attribute'\n     */\n    attrTargetMapping?: Record<string, string[]>;\n\n    // \n    customFields?: CustomFieldConfig[];\n\n    // \n    derivedVars?: DerivedVarSpec[];\n\n    // \n    dicePatches?: DiceExprPatch[];\n\n    // \n    outcomes: OutcomeLevel[];\n\n    // \n    contestRule?: ContestRule;\n\n    // \n    outputTemplate?: string;\n\n    //  outputTemplate \n    contestOutputTemplate?: string;\n\n    // \n    outcomePolicy?: OutcomePolicy;\n\n    /**  */\n    effectsConfig?: EffectsConfig;\n    /**  */\n    effectConfirmUi?: EffectConfirmUiConfig;\n    /**  */\n    resourceBurners?: ResourceBurner[];\n    /**  */\n    quickActions?: PresetQuickAction[];\n    /**  */\n    currentAttrAutoUpdate?: CurrentAttrAutoUpdate;\n    /** / */\n    secondaryEffects?: SecondaryEffect[];\n    /**  3 */\n    secondaryMaxDepth?: number;\n    /** first=all= */\n    secondaryTriggerMode?: 'first' | 'all';\n\n    /**  (COC7) */\n    pushedRoll?: {\n      /**  */\n      enabled: boolean;\n      /** pushoutcome ID (outcomepush)\n       *  :  isSuccess === false  */\n      pushableOutcomes?: string[];\n      /** pushoutcome ID (pushableOutcomes) */\n      blockedOutcomes?: string[];\n      /**  (, 'SAN*','**') */\n      excludePatterns?: string[];\n      /** @deprecated  blockedOutcomes: ['crit_failure']  */\n      blockOnCritFailure?: boolean;\n      /** pushoutcome\n       *  key: outcome ID  '*'()\n       *  value:  */\n      outcomeLabels?: Record<string, string>;\n    };\n\n    // \n    errorHandling?: {\n      undefinedVariable: 'zero' | 'error';\n      parseError: 'fail' | 'warn';\n    };\n  }\n\n  interface PendingEffectContext {\n    runId: string;\n    historyIndex: number;\n    messageId?: string;\n    expiresAt?: number;\n    preset: AdvancedDicePreset;\n    matchedOutcome: OutcomeLevel;\n    context: {\n      characterName: string;\n      attributeName: string;\n      attributeValue: number;\n      roll: number;\n      modifier: number;\n      dc: number;\n    };\n    effectOverrides?: ComputedEffect[];\n    /**  */\n    branchReasonText?: string;\n    timestamp: number;\n  }\n\n  // \n  const BUILTIN_ADVANCED_PRESETS: AdvancedDicePreset[] = [\n    // CoC7 : 1d100 <= \n    {\n      kind: 'advanced',\n      id: 'coc7_check',\n      name: 'CoC7',\n      description: '7: 1d100 <= ',\n      version: PRESET_FORMAT_VERSION,\n      builtin: true,\n      diceExpression: '1d100',\n      attribute: {\n        label: '',\n        placeholder: '=50',\n        defaultValue: 50,\n        key: '',\n      },\n      dc: {\n        hidden: true,\n        defaultValue: 0,\n      },\n      mod: {\n        hidden: true,\n        defaultValue: 0,\n      },\n      customFields: [\n        {\n          id: 'bonusPenalty',\n          type: 'number',\n          label: '',\n          defaultValue: '',\n          placeholder: '+1 , -1 ',\n        },\n        {\n          id: 'requiredRank',\n          type: 'select',\n          label: '',\n          defaultValue: 1,\n          options: [\n            { label: '', value: 1 },\n            { label: '', value: 2 },\n            { label: '', value: 3 },\n          ],\n          contestOverride: { hidden: true },\n        },\n      ],\n      derivedVars: [{ id: 'absBp', expr: 'abs($bonusPenalty)' }],\n      dicePatches: [\n        { when: '$bonusPenalty > 0', op: 'append', template: 'b$absBp' },\n        { when: '$bonusPenalty < 0', op: 'append', template: 'p$absBp' },\n      ],\n      effectsConfig: {\n        triggerPatterns: ['SAN*', 'SAN*', '**', '*sanity*', '*Sanity*'],\n        allowedTargets: ['SAN', 'SAN', '', 'Sanity', 'san'],\n      },\n      // CoC7 /SAN/\n      pushedRoll: {\n        enabled: true,\n        pushableOutcomes: ['warning', 'failure'], // /push\n        blockedOutcomes: ['crit_failure'], // push\n        excludePatterns: ['SAN*', 'SAN*', '**', '*sanity*', '*Sanity*', '**', '*dodge*', '*Dodge*'],\n        outcomeLabels: {\n          crit_success: '   ',\n          extreme_success: '   ',\n          success: ' ',\n          '*': ' ',\n        },\n      },\n      // CoC7 \n      //  SAN\n      resourceBurners: [\n        {\n          id: 'coc7_luck_burn',\n          resourceName: '',\n          target: 'roll',\n          ratio: 1, // 1 = 1\n          direction: 'decrease', // CoC \n          suggestedAmount: '$roll.total - $attr', //  <= \n          condition: '$roll.total > $attr && $isPushed == 0', // \n          selector: {\n            namePatterns: {\n              include: ['*'], // \n              exclude: [\n                'SAN*',\n                'SAN*',\n                '**',\n                '*sanity*',\n                '*Sanity*', // SAN \n                '*',\n                '*Luck*',\n                '*luck*', // \n              ],\n            },\n          },\n          ui: {\n            icon: 'fa-clover',\n            color: 'var(--acu-accent)',\n            tooltip: ' (1:1)',\n          },\n        },\n      ],\n      quickActions: [\n        {\n          id: 'to_san_check',\n          kind: 'attr_shortcut',\n          icon: 'fa-brain',\n          tooltip: 'SAN',\n          config: {\n            presetId: 'coc7_check',\n            carryInitiator: true,\n            carryAttrValue: false,\n            carryTarget: false,\n            carryModifier: false,\n            carrySkillMod: false,\n            attrAliasCandidates: ['SAN', 'SAN', '', 'sanity', 'Sanity', 'san'],\n            fallbackAttrName: 'SAN',\n          },\n        },\n        {\n          id: 'to_skill_growth',\n          kind: 'workflow_shortcut',\n          icon: 'fa-seedling',\n          tooltip: '',\n          config: {\n            presetId: 'coc7_growth_check',\n            carryInitiator: true,\n            carryAttrName: true,\n            carryAttrValue: true,\n          },\n        },\n      ],\n      outcomes: [\n        {\n          id: 'crit_success',\n          name: '',\n          condition: '$roll.total === 1',\n          priority: 1,\n          rank: 4,\n          contestRank: 100, // \n          outputText: '',\n        },\n        {\n          id: 'extreme_success',\n          name: '',\n          condition: '$roll.total <= $attr / 5',\n          priority: 10,\n          rank: 3,\n          contestRank: 100, // \n          outputText: '',\n        },\n        {\n          id: 'hard_success',\n          name: '',\n          condition: '$roll.total <= $attr / 2',\n          priority: 20,\n          rank: 2,\n          contestRank: 80, // \n          outputText: '',\n        },\n        {\n          id: 'success',\n          name: '',\n          condition: '$roll.total <= $attr',\n          priority: 30,\n          rank: 1,\n          contestRank: 60, // \n          outputText: '',\n          effects: [\n            {\n              id: 'san_loss_success',\n              target: 'SAN',\n              operation: 'subtract',\n              value: '1',\n              outputText: 'SAN  $effectDelta ()',\n            },\n          ],\n        },\n        {\n          id: 'failure',\n          name: '',\n          condition: '$roll.total > $attr',\n          displayExpr: '$roll.total <= $attr', // \"\"\n          priority: 50,\n          rank: 0,\n          contestRank: 40, // \n          outputText: '',\n          effects: [\n            {\n              id: 'san_loss_fail',\n              target: 'SAN',\n              operation: 'subtract',\n              value: '1d6',\n              outputText: 'SAN  $effectDelta',\n            },\n          ],\n        },\n        {\n          id: 'crit_failure',\n          name: '',\n          condition: '($attr < 50 && $roll.total >= 96) || ($attr >= 50 && $roll.total === 100)',\n          priority: 5,\n          rank: -1,\n          contestRank: 20, // \n          outputText: '',\n          effects: [\n            {\n              id: 'san_loss_fumble',\n              target: 'SAN',\n              operation: 'subtract',\n              value: '1d10',\n              outputText: 'SAN  $effectDelta ()',\n            },\n          ],\n        },\n        {\n          id: 'unmet',\n          name: '',\n          condition: 'false',\n          priority: 999,\n          rank: -2,\n        },\n      ],\n      outcomePolicy: {\n        kind: 'minRank',\n        requiredRankVarId: 'requiredRank',\n        unmetOutcomeId: 'unmet',\n        keepActualOutcome: true,\n      },\n      // CoC7 SANSANSAN\n      secondaryEffects: [\n        {\n          id: 'coc7_temp_insanity',\n          trigger: { type: 'delta', attribute: 'SAN', operator: 'gte', value: '5' },\n          outputText: ' SAN$delta(5)INT',\n          subCheck: {\n            label: 'INT',\n            attribute: 'INT',\n            attributeCandidates: ['', '', ''],\n            dice: '1d100',\n            operator: 'lte',\n            success: {\n              outputText:\n                ' $subCheckLabel$subCheckDice=$subCheckRoll $subCheckRoll <= $subCheckTarget$subCheckJudge$initiator \\n$symptomResult\\n$durationImmediateRoll$durationSummaryRoll',\n              randomTables: {\n                durationImmediate: { dice: '1d10' },\n                durationSummary: { dice: '1d10' },\n                symptom: {\n                  dice: '1d10',\n                  entries: {\n                    1: '$initiator ',\n                    2: '$initiator ',\n                    3: '$initiator ',\n                    4: '$initiator ',\n                    5: '$initiator ',\n                    6: '$initiator ',\n                    7: '$initiator ',\n                    8: '$initiator ',\n                    9: '$initiator KP',\n                    10: '$initiator KP',\n                  },\n                },\n              },\n            },\n            failure: {\n              outputText:\n                ' $subCheckLabel$subCheckDice=$subCheckRoll $subCheckRoll <= $subCheckTarget$subCheckJudge$initiator ',\n            },\n          },\n          enabled: true,\n          maxTriggerCount: 1,\n        },\n        {\n          id: 'coc7_permanent_insanity',\n          trigger: { type: 'threshold', attribute: 'SAN', operator: 'lte', value: '0' },\n          outputText: ' SAN$newKPNPC',\n          enabled: true,\n          maxTriggerCount: 1,\n        },\n      ],\n      contestRule: {\n        mode: 'rank', // \n        tieBreakers: ['higher_attr', 'initiator_wins'], // \n      },\n      outputTemplate:\n        '<meta:>\\n$outcomeText\\n$initiator  $attrName $formula=$roll $conditionExpr$judgeResult$outcomeName\\n</meta:>',\n    },\n    {\n      kind: 'advanced',\n      id: 'coc7_growth_check',\n      name: 'CoC7-',\n      description: '',\n      version: PRESET_FORMAT_VERSION,\n      builtin: true,\n      visible: false,\n      diceExpression: '1d100',\n      attribute: {\n        label: '',\n        placeholder: '=50',\n        defaultValue: 50,\n        key: '',\n      },\n      dc: {\n        hidden: true,\n        defaultValue: 0,\n      },\n      mod: {\n        hidden: true,\n        defaultValue: 0,\n      },\n      customFields: [\n        {\n          id: 'growthGain',\n          type: 'text',\n          label: '',\n          defaultValue: '1d10',\n          placeholder: ' 1d10',\n        },\n      ],\n      outcomes: [\n        {\n          id: 'growth_success',\n          name: '',\n          condition: '$roll.total > $attr',\n          priority: 30,\n          rank: 1,\n          outputText: '',\n        },\n        {\n          id: 'growth_failure',\n          name: '',\n          condition: '$roll.total <= $attr',\n          displayExpr: '$roll.total > $attr',\n          priority: 60,\n          rank: 0,\n          outputText: '',\n        },\n      ],\n      currentAttrAutoUpdate: {\n        enabled: true,\n        when: 'success',\n        operation: 'add',\n        valueExpr: '$growthGain',\n        min: 0,\n        changeLabel: '',\n        outputTextTemplate: '$attr$expr=$rolled$attrPlain$old$new',\n      },\n      outputTemplate:\n        '<meta:>\\n$initiator $attrName$formula=$roll $conditionExpr$judgeResult$outcomeName\\n</meta:>',\n    },\n    // DND5e : 1d20 +  >= DC ( = floor((-10)/2))\n    {\n      kind: 'advanced',\n      id: 'dnd5e_check',\n      name: 'DND5e',\n      description: 'D&D: 1d20 +  >= DC ()',\n      version: PRESET_FORMAT_VERSION,\n      builtin: true,\n      diceExpression: '1d20',\n      attribute: {\n        label: '',\n        placeholder: '=10',\n        defaultValue: 10,\n        key: '',\n        // DND\n        computeModifier: 'floor(($attr - 10) / 2)',\n      },\n      dc: {\n        label: '(DC)',\n        placeholder: '=10',\n        defaultValue: 10,\n      },\n      mod: {\n        label: '',\n        placeholder: '=0',\n        defaultValue: 0,\n      },\n      // DND5e \n      skillMod: {\n        label: '',\n        placeholder: '=0',\n        defaultValue: 0,\n      },\n      //  skillMod attribute\n      attrTargetMapping: {\n        skillMod: [\n          // DND5e 18\n          '', // \n          '',\n          '',\n          '', // \n          '',\n          '',\n          '',\n          '',\n          '', // \n          '',\n          '',\n          '',\n          '',\n          '', // \n          '',\n          '',\n          '',\n          '', // \n        ],\n      },\n      customFields: [\n        {\n          id: 'advantage',\n          type: 'select',\n          label: '/',\n          defaultValue: 0,\n          options: [\n            { label: '', value: 0 },\n            { label: '', value: 1 },\n            { label: '', value: -1 },\n          ],\n        },\n      ],\n      dicePatches: [\n        { when: '$advantage > 0', op: 'replace', template: '2d20kh1' }, // \n        { when: '$advantage < 0', op: 'replace', template: '2d20kl1' }, // \n      ],\n      outcomes: [\n        {\n          id: 'crit_success',\n          name: '',\n          condition: \"$roll.hasTag('nat20')\",\n          priority: 1,\n          outputText: '',\n        },\n        {\n          id: 'success',\n          name: '',\n          // $attrMod $skillMod \n          condition: '$roll.total + $attrMod + $skillMod + $mod >= $dc',\n          priority: 30,\n          outputText: '',\n        },\n        {\n          id: 'failure',\n          name: '',\n          condition: 'true',\n          displayExpr: '$roll.total + $attrMod + $skillMod + $mod >= $dc', // \"\"\n          priority: 50,\n          outputText: '',\n        },\n        {\n          id: 'crit_failure',\n          name: '',\n          condition: \"$roll.hasTag('nat1')\",\n          priority: 2,\n          outputText: '',\n        },\n      ],\n      contestRule: {\n        mode: 'value', // \n        tieBreakers: ['status_quo'], // \n        hideDc: true, // DC\n        // hideMod: false - \n      },\n      // DNDDC\n      contestOutputTemplate: `<meta:>\n $initiator $initAttrName vs $opponent $oppAttrName\n $initiator $initAttrName$formula=$initRoll$initAttrModText$initSkillModText$initModText=$initTotal\n $opponent $oppAttrName$formula=$oppRoll$oppAttrModText$oppSkillModText$oppModText=$oppTotal\n $winner\n </meta:>`,\n      outputTemplate:\n        '<meta:>\\n$outcomeText\\n$initiator  $attrName $attrValue$attrModText$skillModText$formula=$roll $conditionExpr$judgeResult$outcomeName\\n</meta:>',\n    },\n    {\n      kind: 'advanced',\n      id: 'fate',\n      name: 'Fate',\n      description: 'Fate: 4dF +  +  >= ',\n      version: PRESET_FORMAT_VERSION,\n      builtin: true,\n      diceExpression: '4dF',\n      attributeName: {\n        label: '/',\n        placeholder: '',\n      },\n      attribute: {\n        label: '',\n        placeholder: '=0',\n        defaultValue: 0,\n        key: '',\n      },\n      dc: {\n        label: '',\n        placeholder: '=0',\n        defaultValue: 0,\n      },\n      mod: {\n        label: '',\n        placeholder: '=0',\n        defaultValue: 0,\n      },\n      outcomes: [\n        {\n          id: 'succeed_with_style',\n          name: '',\n          condition: '$roll.total + $attr + $mod >= $dc + 3',\n          priority: 1,\n          outputText: 'Fate: 3',\n        },\n        {\n          id: 'success',\n          name: '',\n          condition: '$roll.total + $attr + $mod >= $dc',\n          priority: 10,\n          outputText: 'Fate: ',\n        },\n        {\n          id: 'tie',\n          name: '',\n          condition: '$roll.total + $attr + $mod === $dc - 1',\n          priority: 20,\n          outputText: 'Fate: ',\n        },\n        {\n          id: 'failure',\n          name: '',\n          condition: '$roll.total + $attr + $mod < $dc',\n          priority: 99,\n          outputText: 'Fate: ',\n        },\n      ],\n      contestRule: {\n        mode: 'margin', // \n        hideDc: true, // \n      },\n      outputTemplate:\n        '<meta:>\\n$outcomeText\\n$initiator  $attrName $attrValue$mod$formula=$roll=$roll+$attr+$mod $conditionExpr$judgeResult$outcomeName\\n</meta:>',\n      contestOutputTemplate: `<meta:>\n $initiator $initAttrName vs $opponent $oppAttrNameFate\n $initiator $initAttrName$formula=$initRoll$initAttr+$initMod=$initTotal\n $opponent $oppAttrName$formula=$oppRoll$oppAttr+$oppMod=$oppTotal\n (Shifts)$margin$initiator$opponent\n $winner\n </meta:>`,\n    },\n    // PbtA : 2d6 + , 6-/7-9/10+\n    {\n      kind: 'advanced',\n      id: 'pbta_move',\n      name: 'PbtA',\n      description: 'Powered by the Apocalypse: 2d6+, 6-/7-9/10+',\n      version: PRESET_FORMAT_VERSION,\n      builtin: true,\n      diceExpression: '2d6',\n      attribute: {\n        label: '',\n        placeholder: '=0',\n        defaultValue: 0,\n        key: '',\n      },\n      dc: {\n        hidden: true,\n        defaultValue: 0,\n      },\n      mod: {\n        label: '',\n        placeholder: '=0',\n        defaultValue: 0,\n      },\n      outcomes: [\n        {\n          id: 'strong_hit',\n          name: '',\n          condition: '$roll.total + $attr + $mod >= 10',\n          priority: 1,\n          outputText: 'PbtA:!',\n        },\n        {\n          id: 'weak_hit',\n          name: '',\n          condition: '$roll.total + $attr + $mod >= 7',\n          priority: 20,\n          outputText: 'PbtA:',\n        },\n        {\n          id: 'miss',\n          name: '',\n          condition: '$roll.total + $attr + $mod < 7',\n          priority: 99,\n          outputText: 'PbtA:...',\n        },\n      ],\n      contestRule: {\n        disabled: true, // PbtA \n      },\n      outputTemplate:\n        '<meta:>\\n$outcomeText\\n$initiator  $attrName $attrValue$mod$formula=$roll=$roll+$attr+$mod $conditionExpr$judgeResult$outcomeName\\n</meta:>',\n    },\n    // : 6d43\n    {\n      kind: 'advanced',\n      id: 'triangle_agency',\n      name: '',\n      description: '6d43333',\n      version: PRESET_FORMAT_VERSION,\n      builtin: true,\n      diceExpression: '6d4=3',\n      attribute: {\n        hidden: true,\n        defaultValue: 0,\n      },\n      dc: {\n        hidden: true,\n        defaultValue: 0,\n      },\n      mod: {\n        hidden: true,\n        defaultValue: 0,\n      },\n      derivedVars: [{ id: 'chaos', expr: '6 - $roll.total' }],\n      outcomes: [\n        {\n          id: 'triple_success',\n          name: '',\n          condition: '$roll.total === 3',\n          priority: 1,\n          rank: 3,\n          outputText: '3',\n        },\n        {\n          id: 'success',\n          name: '',\n          condition: '$roll.total >= 1',\n          priority: 10,\n          rank: 1,\n          outputText: '3',\n        },\n        {\n          id: 'failure',\n          name: '',\n          condition: '$roll.total === 0',\n          priority: 50,\n          rank: 0,\n          outputText: '3',\n        },\n      ],\n      contestRule: {\n        disabled: true, // \n      },\n      outputTemplate:\n        '<meta:>\\n$outcomeText\\n$initiator $formula=$roll3$roll.totalGM$chaos$outcomeName\\n</meta:>',\n    },\n  ];\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const BUILTIN_ATTRIBUTE_PRESETS = [\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'coc7',\n      name: 'COC',\n      builtin: true,\n      description: '7918',\n      baseAttributes: [\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n      ],\n      specialAttributes: [\n        //  15-1109560\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        //  9-8547\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        //  8-6536\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        //  3-4122\n        { name: '', formula: '1+2d20', range: [3, 41] },\n        // \n        { name: '', formula: '/2', range: [1, 99] },\n        // COC \n        { name: 'SAN', formula: '', range: [1, 99] },\n        { name: '', formula: '1d5', range: [1, 5] },\n      ],\n    },\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'dnd5e',\n      name: 'DND',\n      builtin: true,\n      description:\n        '5619/0+10',\n      baseAttributes: [\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n      ],\n      specialAttributes: [\n        // DND5e 18 -  NdMkl1-X \n        // \n        //  4d8kl1-3:  -2  +5 -2~+1 +5\n\n        // \n        { name: '', formula: '4d8kl1-3', range: [-2, 5] }, //  -2  +5\n        // \n        { name: '', formula: '4d8kl1-3', range: [-2, 5] },\n        { name: '', formula: '4d8kl1-3', range: [-2, 5] },\n        { name: '', formula: '5d10kl1-4', range: [-3, 6] }, // \n        // \n        { name: '', formula: '3d6kl1-2', range: [-1, 4] }, // \n        { name: '', formula: '3d6kl1-2', range: [-1, 4] },\n        { name: '', formula: '4d8kl1-3', range: [-2, 5] },\n        { name: '', formula: '3d6kl1-2', range: [-1, 4] },\n        { name: '', formula: '3d6kl1-2', range: [-1, 4] },\n        // \n        { name: '', formula: '3d6kl1-2', range: [-1, 4] },\n        { name: '', formula: '5d10kl1-4', range: [-3, 6] }, // \n        { name: '', formula: '3d6kl1-2', range: [-1, 4] },\n        { name: '', formula: '5d10kl1-4', range: [-3, 6] }, // \n        { name: '', formula: '3d6kl1-2', range: [-1, 4] },\n        // \n        { name: '', formula: '4d8kl1-3', range: [-2, 5] },\n        { name: '', formula: '4d8kl1-3', range: [-2, 5] },\n        { name: '', formula: '3d6kl1-2', range: [-1, 4] },\n        { name: '', formula: '4d8kl1-3', range: [-2, 5] },\n        // \n        { name: '', formula: 'floor((-10)/2)', range: [-4, 4] },\n      ],\n    },\n  ];\n\n  // \n  const AttributePresetManager = (() => {\n    let _cache = null;\n\n    return {\n      //  + \n      getAllPresets() {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        // \n        let needsSave = false;\n        stored.forEach(preset => {\n          const presetVersion = preset.version || '0.0.0';\n          if (compareVersion(presetVersion, PRESET_FORMAT_VERSION) < 0) {\n            console.log(\n              `[DICE]AttributePresetManager  \"${preset.name}\"  (${presetVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n            preset.version = PRESET_FORMAT_VERSION;\n            needsSave = true;\n          }\n        });\n        if (needsSave) {\n          Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n          // \n          _cache = null;\n        }\n        // \n        if (!needsSave && _cache) {\n          return _cache;\n        }\n        _cache = [...BUILTIN_ATTRIBUTE_PRESETS, ...stored];\n        return _cache;\n      },\n\n      // null = \n      getActivePreset() {\n        const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        if (!activeId) return null;\n        return this.getAllPresets().find(p => p.id === activeId) || null;\n      },\n\n      // \n      setActivePreset(id) {\n        try {\n          // idnull\n          const finalId = id === '' || id === undefined ? null : id;\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, finalId);\n          // \n          _cache = null;\n          console.log('[DICE]AttributePresetManager :', finalId);\n          //  AttributePresetManager \n          setTimeout(() => {\n            if (typeof updateTemplateForActivePreset === 'function') {\n              updateTemplateForActivePreset(finalId);\n            }\n          }, 0);\n          return true;\n        } catch (err) {\n          console.error('[DICE]AttributePresetManager :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const newPreset = {\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          builtin: false,\n          version: preset.version || PRESET_FORMAT_VERSION,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates };\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        }\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getAllPresets().find(p => p.id === id);\n        if (!preset) return null;\n        const exported = {\n          format: 'acu_attr_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n        };\n        delete exported.builtin; // \n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr, autoUpdate = false) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.format !== 'acu_attr_preset_v1') {\n            throw new Error('');\n          }\n\n          // \n          if (!data.name || !data.baseAttributes || !Array.isArray(data.baseAttributes)) {\n            throw new Error('');\n          }\n\n          const importedVersion = data.version || '0.0.0';\n          const needsUpdate = compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            builtin: false,\n            version: autoUpdate && needsUpdate ? PRESET_FORMAT_VERSION : importedVersion,\n            createdAt: new Date().toISOString(),\n          };\n\n          const result = this.createPreset(imported);\n          if (result && needsUpdate && !autoUpdate) {\n            console.warn(\n              `[DICE]AttributePresetManager  \"${result.name}\"  (${importedVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n          }\n          return result;\n        } catch (e) {\n          console.error('[DICE]AttributePresetManager :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  const STORAGE_KEY_ACTIVE_ADVANCED_PRESET = 'acu_active_advanced_preset';\n\n  // \n  const AdvancedDicePresetManager = (() => {\n    let _cache = null;\n\n    const getBuiltinPresetVisibilityMap = (): Record<string, boolean> => {\n      const stored = Store.get(STORAGE_KEY_BUILTIN_PRESET_VISIBILITY, {});\n      if (!stored || typeof stored !== 'object') return {};\n      return stored as Record<string, boolean>;\n    };\n\n    const getBuiltinPresetOrderMap = (): Record<string, number> => {\n      const stored = Store.get(STORAGE_KEY_BUILTIN_PRESET_ORDER, {});\n      if (!stored || typeof stored !== 'object') return {};\n      return stored as Record<string, number>;\n    };\n\n    return {\n      //  + \n      getAllPresets() {\n        const stored = Store.get(STORAGE_KEY_ADVANCED_PRESETS, []);\n        // \n        let needsSave = false;\n        stored.forEach(preset => {\n          const presetVersion = preset.version || '0.0.0';\n          if (compareVersion(presetVersion, PRESET_FORMAT_VERSION) < 0) {\n            console.log(\n              `[DICE]AdvancedDicePresetManager  \"${preset.name}\"  (${presetVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n            preset.version = PRESET_FORMAT_VERSION;\n            needsSave = true;\n          }\n        });\n        if (needsSave) {\n          Store.set(STORAGE_KEY_ADVANCED_PRESETS, stored);\n          _cache = null;\n        }\n        // \n        if (!needsSave && _cache) {\n          return _cache;\n        }\n\n        // \n        const builtinVisibilityMap = getBuiltinPresetVisibilityMap();\n        const builtinOrderMap = getBuiltinPresetOrderMap();\n        const processedBuiltin = BUILTIN_ADVANCED_PRESETS.map((p, index) => ({\n          ...p,\n          visible: builtinVisibilityMap[p.id] ?? p.visible ?? true,\n          order: builtinOrderMap[p.id] ?? p.order ?? index,\n        }));\n\n        const processedCustom = stored.map(p => ({\n          ...p,\n          visible: p.visible ?? false,\n          order: p.order ?? 999,\n        }));\n\n        _cache = [...processedBuiltin, ...processedCustom];\n        return _cache;\n      },\n\n      // null = \n      getActivePreset() {\n        const activeId = Store.get(STORAGE_KEY_ACTIVE_ADVANCED_PRESET, null);\n        if (!activeId) return null;\n        return this.getAllPresets().find(p => p.id === activeId) || null;\n      },\n\n      // \n      setActivePreset(id) {\n        try {\n          const finalId = id === '' || id === undefined ? null : id;\n          Store.set(STORAGE_KEY_ACTIVE_ADVANCED_PRESET, finalId);\n          _cache = null;\n          console.log('[DICE]AdvancedDicePresetManager :', finalId);\n          return true;\n        } catch (err) {\n          console.error('[DICE]AdvancedDicePresetManager :', err);\n          return false;\n        }\n      },\n\n      setBuiltinPresetVisibility(id, visible) {\n        try {\n          const map = getBuiltinPresetVisibilityMap();\n          map[id] = visible;\n          Store.set(STORAGE_KEY_BUILTIN_PRESET_VISIBILITY, map);\n          _cache = null;\n          return true;\n        } catch (err) {\n          console.error('[DICE]AdvancedDicePresetManager :', err);\n          return false;\n        }\n      },\n\n      setPresetOrder(id, order) {\n        try {\n          if (BUILTIN_ADVANCED_PRESETS.some(p => p.id === id)) {\n            const map = getBuiltinPresetOrderMap();\n            map[id] = order;\n            Store.set(STORAGE_KEY_BUILTIN_PRESET_ORDER, map);\n            _cache = null;\n            return true;\n          }\n          return this.updatePreset(id, { order });\n        } catch (err) {\n          console.error('[DICE]AdvancedDicePresetManager :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ADVANCED_PRESETS, []);\n        const newPreset = {\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          kind: 'advanced',\n          builtin: false,\n          version: preset.version || PRESET_FORMAT_VERSION,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ADVANCED_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AdvancedDicePresetManager :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        // \n        if (BUILTIN_ADVANCED_PRESETS.some(p => p.id === id)) {\n          console.error('[DICE]AdvancedDicePresetManager :', id);\n          throw new Error('');\n        }\n        const stored = Store.get(STORAGE_KEY_ADVANCED_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates, id }; // ID\n        Store.set(STORAGE_KEY_ADVANCED_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AdvancedDicePresetManager :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        // \n        if (BUILTIN_ADVANCED_PRESETS.some(p => p.id === id)) {\n          console.error('[DICE]AdvancedDicePresetManager :', id);\n          throw new Error('');\n        }\n        const stored = Store.get(STORAGE_KEY_ADVANCED_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ADVANCED_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ADVANCED_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ADVANCED_PRESET, null);\n        }\n        console.log('[DICE]AdvancedDicePresetManager :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getAllPresets().find(p => p.id === id);\n        if (!preset) return null;\n        const exported = {\n          kind: 'advanced',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n        };\n        delete exported.builtin; // \n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.kind !== 'advanced') {\n            throw new Error('');\n          }\n\n          // \n          if (!data.name || !data.diceExpression) {\n            throw new Error(': ');\n          }\n\n          //  outcomes\n          if (!Array.isArray(data.outcomes) || data.outcomes.length === 0) {\n            throw new Error(':  outcomes ');\n          }\n\n          const importedVersion = data.version || '0.0.0';\n          const needsUpdate = compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n          //  UI \n          if (data.ui) {\n            if (data.ui.attributeLabel && data.attribute) data.attribute.label = data.ui.attributeLabel;\n            if (data.ui.dcLabel && data.dc) data.dc.label = data.ui.dcLabel;\n            delete data.ui;\n          }\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            kind: 'advanced',\n            builtin: false,\n            version: PRESET_FORMAT_VERSION,\n            createdAt: new Date().toISOString(),\n          };\n\n          const result = this.createPreset(imported);\n          if (result && needsUpdate) {\n            console.warn(\n              `[DICE]AdvancedDicePresetManager  \"${result.name}\"  (${importedVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n          }\n          return result;\n        } catch (e) {\n          console.error('[DICE]AdvancedDicePresetManager :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n\n      /**\n       * \n       * @param preset ID\n       * @returns true false \n       */\n      supportsContest(preset: AdvancedDicePreset | string | null | undefined): boolean {\n        if (!preset) return true; // \n\n        const presetObj = typeof preset === 'string' ? this.getAllPresets().find(p => p.id === preset) : preset;\n        if (!presetObj) return true; // \n\n        //  contestRule.disabled \n        return !(presetObj.contestRule?.disabled === true);\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  /**\n   * \n   * 6/////\n   * @param min \n   * @param max \n   * @returns \n   */\n  const generateAttributeScale = (min: number, max: number): string => {\n    const range = max - min;\n\n    // \n    const threshold1 = Math.floor(min + range * 0.1); // \n    const threshold2 = Math.floor(min + range * 0.4); // \n    const threshold3 = Math.floor(min + range * 0.6); // \n    const threshold4 = Math.floor(min + range * 0.8); // \n    const threshold5 = Math.floor(min + range * 0.9); // \n\n    //  \"3-3\" \n    const formatRange = (start: number, end: number): string => {\n      if (start === end) return `${start}`;\n      return `${start}-${end}`;\n    };\n\n    const scales = [\n      `${formatRange(min, threshold1)}:`,\n      `${formatRange(threshold1 + 1, threshold2)}:`,\n      `${formatRange(threshold2 + 1, threshold3)}:`,\n      `${formatRange(threshold3 + 1, threshold4)}:`,\n      `${formatRange(threshold4 + 1, threshold5)}:`,\n      `${formatRange(threshold5 + 1, max)}:`,\n    ];\n\n    const scaleStr = scales.join(' | ');\n\n    // \n    // \"40-60\"  \n    // \"90+\"  \n    // \"0-10\"  \n    // \"80\"  \n    const avgStart = threshold2 + 1;\n    const avgEnd = threshold3;\n    const rareThreshold = threshold5 + 1; // \n    const debuffRange = formatRange(min, threshold1); // \n    const buffRange = formatRange(threshold4 + 1, threshold5); // \n\n    const baseDescription = `: (${avgStart}-${avgEnd}${rareThreshold}+)[][]:${debuffRange}; ${buffRange}`;\n\n    return `${scaleStr}${baseDescription}`;\n  };\n\n  // \n  const DEFAULT_SPECIAL_ATTR_TEMPLATE = {\n    // \n    range: [0, 100] as [number, number],\n    // \n    example: ':85; :70; :90',\n  };\n\n  // \n  const DEFAULT_VIRTUAL_PRESET = {\n    id: '__default__',\n    name: '',\n    baseAttributes: ['', '', '', '', '', ''].map(name => ({\n      name,\n      formula: '3d6*5',\n      range: [5, 95] as [number, number],\n      modifier: '1d10-5',\n    })),\n    specialAttributes: [] as { name: string; formula: string; range: [number, number]; modifier: string }[],\n  };\n\n  /**\n   * \n   * @param text \n   * @param tag  \"\"\n   * @param content \n   */\n  const replaceTag = (text: string, tag: string, content: string): string => {\n    //  [\\s\\S]* \n    const regex = new RegExp(`<${tag}>[\\\\s\\\\S]*?</${tag}>`, 'g');\n    return text.replace(regex, `<${tag}>\\n${content}\\n</${tag}>`);\n  };\n\n  /**\n   * \n   * @param presetId IDnull \n   */\n  const updateTemplateForActivePreset = (presetId: string | null): void => {\n    // 1. \n    type AttributePreset = (typeof BUILTIN_ATTRIBUTE_PRESETS)[number];\n    let preset: AttributePreset;\n    if (presetId === null || presetId === '__default__') {\n      // \n      preset = DEFAULT_VIRTUAL_PRESET as AttributePreset;\n    } else {\n      const found = AttributePresetManager.getAllPresets().find((p: AttributePreset) => p.id === presetId);\n      preset = found || (DEFAULT_VIRTUAL_PRESET as AttributePreset);\n    }\n\n    // 2. \n    //  null  generateRPGAttributes \n    const attrs = generateRPGAttributes(presetId === null || presetId === '__default__' ? null : preset);\n    // attrs = { base: {...}, special: {...} }\n\n    // 3.  preset \n    let baseRangeMin = 0;\n    let baseRangeMax = 100;\n    let specialRangeMin = 0;\n    let specialRangeMax = 100;\n\n    //  baseAttributes.range  min/max\n    if (preset.baseAttributes && preset.baseAttributes.length > 0) {\n      const baseRanges = preset.baseAttributes.map(attr => attr.range);\n      baseRangeMin = Math.min(...baseRanges.map(r => r[0]));\n      baseRangeMax = Math.max(...baseRanges.map(r => r[1]));\n    }\n    //  specialAttributes.range  min/max\n    if (preset.specialAttributes && preset.specialAttributes.length > 0) {\n      const specialRanges = preset.specialAttributes.map(attr => attr.range);\n      specialRangeMin = Math.min(...specialRanges.map(r => r[0]));\n      specialRangeMax = Math.max(...specialRanges.map(r => r[1]));\n    }\n\n    // 4. \n    const baseEntries = Object.entries(attrs.base as Record<string, number>);\n    const specialEntries = Object.entries(attrs.special as Record<string, number>);\n\n    // 5.  API \n    const dbApi = getCore().getDB();\n    if (!dbApi || typeof dbApi.getTableTemplate !== 'function') {\n      console.warn('[DICE] updateTemplateForActivePreset:  API ');\n      return;\n    }\n\n    const template = dbApi.getTableTemplate();\n    if (!template) {\n      console.warn('[DICE] updateTemplateForActivePreset: ');\n      return;\n    }\n\n    // 6. \n    const attributeScaleStr = generateAttributeScale(baseRangeMin, baseRangeMax);\n\n    // 7.  <> \n    const baseRangeStr = `[${baseRangeMin},${baseRangeMax}]`;\n    const specialRangeStr =\n      specialEntries.length > 0\n        ? `[${specialRangeMin},${specialRangeMax}]`\n        : `[${DEFAULT_SPECIAL_ATTR_TEMPLATE.range[0]},${DEFAULT_SPECIAL_ATTR_TEMPLATE.range[1]}]`;\n\n    // \n    const baseExampleStr =\n      baseEntries.length > 0\n        ? baseEntries.map(([name, value]) => `${name}:${value}`).join('; ')\n        : ':35; :50; :52; :35; :40; :64';\n\n    // \n    const specialExampleStr =\n      specialEntries.length > 0\n        ? specialEntries.map(([name, value]) => `${name}:${value}`).join('; ')\n        : DEFAULT_SPECIAL_ATTR_TEMPLATE.example;\n\n    // \n    const attributeRulesContent = `: \"{}:{}\"${baseRangeStr}\n: \"${baseExampleStr}\"\n\n: \n: \"{}:{}\"${specialRangeStr}\n: \"${specialExampleStr}\"\n\n\n${attributeScaleStr}`;\n\n    let modified = false;\n\n    // 7.5  <> \n    const checkTemplateFormat = (note: string | undefined, sheetName: string): void => {\n      if (!note) return;\n      if (!note.includes('<>')) {\n        console.warn(\n          `[DICE] ${sheetName}  <> ` +\n            ` <>...</> `,\n        );\n      }\n    };\n    checkTemplateFormat(template.sheet_protagonist?.sourceData?.note as string, '');\n    checkTemplateFormat(template.sheet_important_npc?.sourceData?.note as string, '');\n\n    // 8.  sheet_protagonist  note <> \n    const protagonistSheet = template.sheet_protagonist;\n    if (protagonistSheet?.sourceData?.note) {\n      let note = protagonistSheet.sourceData.note as string;\n      const originalNote = note;\n\n      note = replaceTag(note, '', attributeRulesContent);\n\n      if (note !== originalNote) {\n        protagonistSheet.sourceData.note = note;\n        modified = true;\n      }\n    }\n\n    // 9.  sheet_important_npc  note <> \n    const npcSheet = template.sheet_important_npc;\n    if (npcSheet?.sourceData?.note) {\n      let note = npcSheet.sourceData.note as string;\n      const originalNote = note;\n\n      note = replaceTag(note, '', attributeRulesContent);\n\n      if (note !== originalNote) {\n        npcSheet.sourceData.note = note;\n        modified = true;\n      }\n    }\n\n    // 10.  API \n    if (modified && typeof dbApi.importTemplateFromData === 'function') {\n      dbApi\n        .importTemplateFromData(template)\n        .then((result: { success: boolean; message: string }) => {\n          if (result.success) {\n            console.log('[DICE] updateTemplateForActivePreset :', presetId);\n          } else {\n            console.error('[DICE] updateTemplateForActivePreset :', result.message);\n          }\n        })\n        .catch((err: Error) => {\n          console.error('[DICE] updateTemplateForActivePreset :', err);\n        });\n    } else if (!modified) {\n      console.log('[DICE] updateTemplateForActivePreset :', presetId);\n    } else {\n      console.warn('[DICE] updateTemplateForActivePreset: importTemplateFromData ');\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // ActionPresetManager  JS \n  // interface ActionGroupPreset {\n  //   format: 'acu_action_preset_v1';\n  //   version: string;\n  //   id: string;\n  //   name: string;\n  //   builtin: boolean;\n  //   description?: string;\n  //   rules: ActionRule[];\n  // }\n  // interface ActionRule {\n  //   table_keywords: string[];\n  //   actions: ActionItem[];\n  // }\n  // interface ActionItem {\n  //   label: string;\n  //   icon?: string;\n  //   template?: string;\n  // }\n\n  // \n  const BUILTIN_ACTION_PRESETS = [\n    {\n      format: 'acu_action_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: '__builtin_default__',\n      name: '',\n      builtin: true,\n      description: '',\n      rules: [\n        {\n          table_keywords: ['', '', 'Location', 'Map', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', 'NPC', '', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n      ],\n    },\n  ];\n\n  const ActionPresetManager = (() => {\n    let _cache = null;\n\n    return {\n      //  + \n      getAllPresets() {\n        if (_cache) return _cache;\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        _cache = [...BUILTIN_ACTION_PRESETS, ...stored];\n        return _cache;\n      },\n\n      // ID\n      getPresetById(id) {\n        return this.getAllPresets().find(p => p.id === id) || null;\n      },\n\n      // ID\n      getActivePresetId() {\n        const stored = Store.get(STORAGE_KEY_ACTIVE_ACTION_PRESET, '__builtin_default__');\n        return stored === null ? '__builtin_default__' : stored;\n      },\n\n      // \n      getActivePreset() {\n        const activeId = this.getActivePresetId();\n        if (!activeId || activeId === '__none__') return null;\n        return this.getPresetById(activeId);\n      },\n\n      // '__none__' \n      setActivePresetId(id) {\n        try {\n          const finalId = id === '' || id === undefined || id === null ? '__none__' : id;\n          Store.set(STORAGE_KEY_ACTIVE_ACTION_PRESET, finalId);\n          _cache = null;\n          console.log('[DICE]ActionPresetManager :', finalId);\n          return true;\n        } catch (err) {\n          console.error('[DICE]ActionPresetManager :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        const newPreset = {\n          format: 'acu_action_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          builtin: false,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ACTION_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]ActionPresetManager :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates, version: PRESET_FORMAT_VERSION };\n        Store.set(STORAGE_KEY_ACTION_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]ActionPresetManager :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ACTION_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ACTION_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ACTION_PRESET, null);\n        }\n        console.log('[DICE]ActionPresetManager :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getPresetById(id);\n        if (!preset) return null;\n        const exported = {\n          format: 'acu_action_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n        };\n        delete exported.builtin;\n        delete exported.createdAt;\n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.format !== 'acu_action_preset_v1') {\n            throw new Error(' acu_action_preset_v1');\n          }\n\n          // \n          if (!data.name || !data.rules || !Array.isArray(data.rules)) {\n            throw new Error(' name  rules ');\n          }\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            builtin: false,\n            version: PRESET_FORMAT_VERSION,\n            createdAt: new Date().toISOString(),\n          };\n\n          const result = this.createPreset(imported);\n          return result;\n        } catch (e) {\n          console.error('[DICE]ActionPresetManager :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const getCrazyModeConfig = () => {\n    const stored = Store.get(STORAGE_KEY_CRAZY_MODE, null);\n    if (!stored) return { ...DEFAULT_CRAZY_MODE_CONFIG };\n    return { ...DEFAULT_CRAZY_MODE_CONFIG, ...stored };\n  };\n\n  // \n  const saveCrazyModeConfig = config => {\n    Store.set(STORAGE_KEY_CRAZY_MODE, config);\n  };\n\n  // \n  const shouldTriggerCrazyMode = () => {\n    const config = getCrazyModeConfig();\n    if (!config.enabled) return false;\n    // crazyLevel \n    const roll = Math.random() * 100;\n    return roll < config.crazyLevel;\n  };\n\n  // \n  const selectCrazyRollType = crazyLevel => {\n    // crazyLevel < 50: 100% \n    // crazyLevel 50-75: 70%  / 30% \n    // crazyLevel > 75: 50%  / 50% \n    if (crazyLevel < 50) return 'normal';\n    const contestChance = crazyLevel <= 75 ? 0.3 : 0.5;\n    return Math.random() < contestChance ? 'contest' : 'normal';\n  };\n\n  // \n  const weightedRandomSelect = items => {\n    if (!items || items.length === 0) return null;\n    const totalWeight = items.reduce((sum, item) => sum + (item.weight || 1), 0);\n    let random = Math.random() * totalWeight;\n    for (const item of items) {\n      random -= item.weight || 1;\n      if (random <= 0) return item;\n    }\n    return items[items.length - 1];\n  };\n\n  // \n  const selectCrazyParticipant = () => {\n    const config = getCrazyModeConfig();\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return null;\n\n    const allTables = processJsonData(rawData || {});\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n\n    // \n    const candidates = [];\n\n    // \n    if (playerResult?.data?.rows?.length > 0) {\n      const playerName = getDisplayPlayerName() || '';\n      const playerAttrs = getFullAttributesForCharacter('<user>');\n      candidates.push({\n        name: playerName,\n        attrs: playerAttrs,\n        isPlayer: true,\n        inScene: true,\n        weight: config.playerWeight,\n      });\n    }\n\n    // NPC\n    if (npcResult) {\n      const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n      npcParsed.forEach(npc => {\n        if (!npc.name) return;\n        const inSceneVal = String(npc.inScene || '').toLowerCase();\n        const isInScene = inSceneVal === 'true' || inSceneVal === '';\n        const npcAttrs = getFullAttributesForCharacter(npc.name);\n        candidates.push({\n          name: npc.name,\n          attrs: npcAttrs,\n          isPlayer: false,\n          inScene: isInScene,\n          weight: isInScene ? config.inSceneNpcWeight : config.offSceneNpcWeight,\n        });\n      });\n    }\n\n    if (candidates.length === 0) return null;\n    return weightedRandomSelect(candidates);\n  };\n\n  // \n  const selectCrazyAttribute = participant => {\n    if (!participant) return { name: '', value: 50 };\n\n    // 1. \n    if (participant.attrs && participant.attrs.length > 0) {\n      const randomAttr = participant.attrs[Math.floor(Math.random() * participant.attrs.length)];\n      return { name: randomAttr.name, value: randomAttr.value };\n    }\n\n    // 2. \n    const activePreset = AttributePresetManager.getActivePreset();\n    if (activePreset) {\n      const allPresetAttrs = [...(activePreset.baseAttributes || []), ...(activePreset.specialAttributes || [])];\n      if (allPresetAttrs.length > 0) {\n        const randomPresetAttr = allPresetAttrs[Math.floor(Math.random() * allPresetAttrs.length)];\n        //  range  50% \n        const range = randomPresetAttr.range || [0, 100];\n        const defaultValue = Math.floor((range[0] + range[1]) / 2);\n        return { name: randomPresetAttr.name, value: defaultValue };\n      }\n    }\n\n    // 3. \n    const skillPool = getRandomSkillPool();\n    if (skillPool && skillPool.length > 0) {\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      return { name: randomSkill, value: 50 };\n    }\n\n    return { name: '', value: 50 };\n  };\n\n  // \n  const crazyRollWithPreset = (preset: AdvancedDicePreset | null, attrValue: number) => {\n    if (!preset) {\n      //  d100 \n      const roll = Math.floor(Math.random() * 100) + 1;\n      let result = '';\n      if (roll <= 5) result = '';\n      else if (roll >= 96) result = '';\n      else if (roll <= attrValue) result = '';\n      return { roll, result, formula: '1d100' };\n    }\n\n    // \n    const diceExpr = preset.diceExpression || '1d100';\n    const rollResult = rollComplexDiceExpression(diceExpr);\n    const rollTotal = rollResult.total;\n\n    //  outcomes \n    if (preset.outcomes && preset.outcomes.length > 0) {\n      // \n      const presetId = preset.id;\n\n      if (presetId === 'dnd5e_check') {\n        // DND5e: 1d20 +  >= DC\n        //  = floor((-10)/2)\n        const attrMod = Math.floor((attrValue - 10) / 2);\n        const dc = 10; // DC\n        const total = rollTotal + attrMod;\n\n        if (rollResult.rawDice && rollResult.rawDice[0] === 20) {\n          return { roll: rollTotal, result: '', formula: diceExpr, total, dc, attrMod };\n        } else if (rollResult.rawDice && rollResult.rawDice[0] === 1) {\n          return { roll: rollTotal, result: '', formula: diceExpr, total, dc, attrMod };\n        } else if (total >= dc) {\n          return { roll: rollTotal, result: '', formula: diceExpr, total, dc, attrMod };\n        } else {\n          return { roll: rollTotal, result: '', formula: diceExpr, total, dc, attrMod };\n        }\n      } else if (presetId === 'coc7_check') {\n        // CoC7: 1d100 <= \n        if (rollTotal === 1) {\n          return { roll: rollTotal, result: '', formula: diceExpr };\n        } else if ((attrValue < 50 && rollTotal >= 96) || (attrValue >= 50 && rollTotal === 100)) {\n          return { roll: rollTotal, result: '', formula: diceExpr };\n        } else if (rollTotal <= Math.floor(attrValue / 5)) {\n          return { roll: rollTotal, result: '', formula: diceExpr };\n        } else if (rollTotal <= Math.floor(attrValue / 2)) {\n          return { roll: rollTotal, result: '', formula: diceExpr };\n        } else if (rollTotal <= attrValue) {\n          return { roll: rollTotal, result: '', formula: diceExpr };\n        } else {\n          return { roll: rollTotal, result: '', formula: diceExpr };\n        }\n      } else if (presetId === 'fate_check') {\n        // : 4dF + \n        const total = rollTotal + attrValue;\n        const dc = 0; // DC\n        if (total >= dc + 3) {\n          return { roll: rollTotal, result: '', formula: diceExpr, total };\n        } else if (total >= dc) {\n          return { roll: rollTotal, result: '', formula: diceExpr, total };\n        } else if (total >= dc - 2) {\n          return { roll: rollTotal, result: '', formula: diceExpr, total };\n        } else {\n          return { roll: rollTotal, result: '', formula: diceExpr, total };\n        }\n      } else if (presetId === 'pbta_check') {\n        // PbtA: 2d6 + \n        const total = rollTotal + attrValue;\n        if (total >= 10) {\n          return { roll: rollTotal, result: '', formula: diceExpr, total };\n        } else if (total >= 7) {\n          return { roll: rollTotal, result: '', formula: diceExpr, total };\n        } else {\n          return { roll: rollTotal, result: '', formula: diceExpr, total };\n        }\n      }\n    }\n\n    // \n    if (diceExpr.includes('d100') || diceExpr.includes('D100')) {\n      // d100 :  <=  \n      if (rollTotal <= 5) return { roll: rollTotal, result: '', formula: diceExpr };\n      if (rollTotal >= 96) return { roll: rollTotal, result: '', formula: diceExpr };\n      if (rollTotal <= attrValue) return { roll: rollTotal, result: '', formula: diceExpr };\n      return { roll: rollTotal, result: '', formula: diceExpr };\n    } else if (diceExpr.includes('d20') || diceExpr.includes('D20')) {\n      // d20 :  +  >= DC \n      const dc = 10;\n      if (rollTotal === 20) return { roll: rollTotal, result: '', formula: diceExpr };\n      if (rollTotal === 1) return { roll: rollTotal, result: '', formula: diceExpr };\n      if (rollTotal + attrValue >= dc) return { roll: rollTotal, result: '', formula: diceExpr };\n      return { roll: rollTotal, result: '', formula: diceExpr };\n    } else {\n      // : \n      const midValue = attrValue;\n      if (rollTotal >= midValue) return { roll: rollTotal, result: '', formula: diceExpr };\n      return { roll: rollTotal, result: '', formula: diceExpr };\n    }\n  };\n\n  //  ()\n  const judgeCrazyRollResult = (roll, target) => {\n    if (roll <= 5) return '';\n    if (roll >= 96) return '';\n    if (roll <= target) return '';\n    return '';\n  };\n\n  // \n  const generateCrazyRoll = () => {\n    const config = getCrazyModeConfig();\n    const rollType = selectCrazyRollType(config.crazyLevel);\n\n    // \n    const activePreset = AdvancedDicePresetManager.getActivePreset();\n\n    if (rollType === 'normal') {\n      // \n      const participant = selectCrazyParticipant();\n      if (!participant) return null;\n\n      const attr = selectCrazyAttribute(participant);\n      const rollData = crazyRollWithPreset(activePreset, attr.value);\n\n      // \n      if (activePreset) {\n        const presetName = activePreset.name;\n        if (activePreset.id === 'dnd5e_check' && rollData.attrMod !== undefined) {\n          return `<meta:>\\n${participant.name}${attr.name}(${presetName})${rollData.formula}=${rollData.roll}${rollData.attrMod >= 0 ? '+' : ''}${rollData.attrMod}${rollData.total}DC${rollData.dc}${rollData.result}\\n</meta:>`;\n        } else if (rollData.total !== undefined) {\n          return `<meta:>\\n${participant.name}${attr.name}(${presetName})${rollData.formula}=${rollData.roll}${rollData.total}${rollData.result}\\n</meta:>`;\n        } else {\n          return `<meta:>\\n${participant.name}${attr.name}(${presetName})${rollData.formula}=${rollData.roll}${attr.value}${rollData.result}\\n</meta:>`;\n        }\n      }\n\n      // \n      return `<meta:>\\n${participant.name}${attr.name}${rollData.roll}${attr.value}${rollData.result}\\n</meta:>`;\n    } else {\n      // \n      const participant1 = selectCrazyParticipant();\n      if (!participant1) return null;\n\n      // \n      let participant2 = null;\n      for (let i = 0; i < 5; i++) {\n        const candidate = selectCrazyParticipant();\n        if (candidate && candidate.name !== participant1.name) {\n          participant2 = candidate;\n          break;\n        }\n      }\n\n      // \n      if (!participant2) {\n        const attr = selectCrazyAttribute(participant1);\n        const rollData = crazyRollWithPreset(activePreset, attr.value);\n        if (activePreset) {\n          return `<meta:>\\n${participant1.name}${attr.name}(${activePreset.name})${rollData.formula}=${rollData.roll}${attr.value}${rollData.result}\\n</meta:>`;\n        }\n        return `<meta:>\\n${participant1.name}${attr.name}${rollData.roll}${attr.value}${rollData.result}\\n</meta:>`;\n      }\n\n      const attr1 = selectCrazyAttribute(participant1);\n      const attr2 = selectCrazyAttribute(participant2);\n      const rollData1 = crazyRollWithPreset(activePreset, attr1.value);\n      const rollData2 = crazyRollWithPreset(activePreset, attr2.value);\n\n      // \n      const result1 = rollData1.result;\n      const result2 = rollData2.result;\n\n      // \n      let winner;\n      if (\n        activePreset &&\n        (activePreset.id === 'dnd5e_check' || activePreset.id === 'pbta_check' || activePreset.id === 'fate_check')\n      ) {\n        // : \n        const total1 = rollData1.total !== undefined ? rollData1.total : rollData1.roll + attr1.value;\n        const total2 = rollData2.total !== undefined ? rollData2.total : rollData2.roll + attr2.value;\n        if (total1 > total2) {\n          winner = `${participant1.name}`;\n        } else if (total2 > total1) {\n          winner = `${participant2.name}`;\n        } else {\n          winner = '';\n        }\n      } else {\n        // d100:  ( - )\n        const margin1 = attr1.value - rollData1.roll;\n        const margin2 = attr2.value - rollData2.roll;\n        if (margin1 > margin2) {\n          winner = `${participant1.name}`;\n        } else if (margin2 > margin1) {\n          winner = `${participant2.name}`;\n        } else {\n          winner = '';\n        }\n      }\n\n      // \n      const presetLabel = activePreset ? `(${activePreset.name})` : '';\n      return (\n        `<meta:>\\n` +\n        `${participant1.name} ${attr1.name} vs ${participant2.name} ${attr2.name}${presetLabel}` +\n        `${participant1.name} ${attr1.name} (${attr1.value}) ${rollData1.formula}=${rollData1.roll}${result1}` +\n        `${participant2.name} ${attr2.name} (${attr2.value}) ${rollData2.formula}=${rollData2.roll}${result2}` +\n        `${winner}\\n` +\n        `</meta:>`\n      );\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  /**\n   * \n   * : 3d6, 4d6kh3, 4d6dl1, 4d6dh1\n   * @returns  RollResult total  NaN\n   */\n  const rollDiceExpression = (expr: string): RollResult => {\n    const formula = String(expr);\n    const rollDice = (sides: number) => Math.floor(Math.random() * sides) + 1;\n\n    //  XdY  XdF /\n    const match = formula.match(\n      /^(\\d*)d(\\d+|F)([bp]\\d+)?(r[o]?(?:[><!=]+)?\\d*)?(!!?(?:[><!=]+\\d+)?)?(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?((?:[><!=]+)\\d+)?$/i,\n    );\n    if (!match) {\n      return {\n        total: Number.NaN,\n        rawDice: [],\n        keptDice: [],\n        formula,\n        breakdown: formula ? `${formula}=NaN` : 'NaN',\n        tags: [],\n      };\n    }\n\n    const [, countStr, sidesOrF, cocPart, rerollPart, explodePart, keepDrop, successPart] = match;\n    const count = countStr ? parseInt(countStr, 10) : 1;\n    const isFate = sidesOrF.toUpperCase() === 'F';\n    const sides = isFate ? 0 : parseInt(sidesOrF, 10);\n\n    let rolls: number[] = [];\n    if (isFate) {\n      // FATE :  [-1, 0, 1]\n      rolls = Array.from({ length: count }, () => Math.floor(Math.random() * 3) - 1);\n    } else {\n      // \n\n      // \n      let rerollType = null;\n      let rerollCompare = '=';\n      let rerollValue = 1;\n\n      if (rerollPart) {\n        const m = rerollPart.match(/^(r[o]?)([><!=]+)?(\\d+)?$/i);\n        if (m) {\n          rerollType = m[1].toLowerCase();\n          if (m[2]) rerollCompare = m[2];\n          if (m[3]) rerollValue = parseInt(m[3], 10);\n          else if (!m[2]) rerollValue = 1; //  r  ro  1\n        }\n      }\n\n      const checkReroll = (val: number) => {\n        if (!rerollType) return false;\n        switch (rerollCompare) {\n          case '>=':\n            return val >= rerollValue;\n          case '<=':\n            return val <= rerollValue;\n          case '=':\n          case '==':\n            return val === rerollValue;\n          case '>':\n            return val > rerollValue;\n          case '<':\n            return val < rerollValue;\n          case '!=':\n          case '<>':\n            return val !== rerollValue;\n          default:\n            return val === rerollValue;\n        }\n      };\n\n      // \n      let explodeType = null;\n      let explodeCompare = '=';\n      let explodeValue = sides;\n\n      if (explodePart) {\n        const m = explodePart.match(/^(!!?)([><=!]+)?(\\d+)?$/);\n        if (m) {\n          explodeType = m[1];\n          if (m[2]) explodeCompare = m[2];\n          if (m[3]) explodeValue = parseInt(m[3], 10);\n        }\n      }\n\n      const checkExplode = (val: number) => {\n        if (!explodeType) return false;\n        switch (explodeCompare) {\n          case '>=':\n            return val >= explodeValue;\n          case '<=':\n            return val <= explodeValue;\n          case '=':\n          case '==':\n            return val === explodeValue;\n          case '>':\n            return val > explodeValue;\n          case '<':\n            return val < explodeValue;\n          case '!=':\n          case '<>':\n            return val !== explodeValue;\n          default:\n            return val === sides;\n        }\n      };\n\n      //  CoC / ( d100 )\n      let cocType = null;\n      let cocCount = 0;\n      if (cocPart && sides === 100) {\n        const m = cocPart.match(/^([bp])(\\d+)$/i);\n        if (m) {\n          cocType = m[1].toLowerCase();\n          cocCount = parseInt(m[2], 10);\n        }\n      }\n\n      for (let i = 0; i < count; i++) {\n        let val = rollDice(sides);\n\n        // CoC /\n        if (cocType) {\n          const tens = Math.floor((val === 100 ? 0 : val) / 10);\n          const units = val % 10;\n          const additionalTens = Array.from({ length: cocCount }, () => Math.floor(Math.random() * 10));\n          const allTens = [tens, ...additionalTens];\n          let finalTens;\n          if (cocType === 'b') {\n            finalTens = Math.min(...allTens);\n          } else {\n            finalTens = Math.max(...allTens);\n          }\n          const result = finalTens * 10 + units;\n          val = result === 0 ? 100 : result;\n        }\n\n        //  ()\n        if (rerollType) {\n          let rerollCount = 0;\n          while (checkReroll(val) && rerollCount < 100) {\n            rerollCount++;\n            val = rollDice(sides);\n            if (rerollType === 'ro') break; // ro \n          }\n        }\n\n        if (explodeType) {\n          let currentVal = val;\n          let nextToCheck = val;\n          let explodeCount = 0;\n          while (checkExplode(nextToCheck) && explodeCount < 100) {\n            explodeCount++;\n            nextToCheck = rollDice(sides);\n            if (explodeType === '!') {\n              rolls.push(currentVal);\n              currentVal = nextToCheck;\n            } else {\n              currentVal += nextToCheck;\n            }\n          }\n          rolls.push(currentVal);\n        } else {\n          rolls.push(val);\n        }\n      }\n    }\n\n    const rawDice = [...rolls];\n    let keptDice = [...rolls];\n\n    //  keep/drop\n    if (keepDrop) {\n      const kd = keepDrop.toLowerCase();\n      const n = parseInt(kd.slice(2), 10);\n      const sorted = [...keptDice].sort((a, b) => b - a); // \n\n      if (kd.startsWith('kh'))\n        keptDice = sorted.slice(0, n); // n\n      else if (kd.startsWith('kl'))\n        keptDice = sorted.slice(-n); // n\n      else if (kd.startsWith('dh'))\n        keptDice = sorted.slice(n); // n\n      else if (kd.startsWith('dl')) keptDice = sorted.slice(0, -n); // n\n    }\n\n    let total = keptDice.reduce((a, b) => a + b, 0);\n\n    //  ()\n    if (successPart) {\n      const sm = successPart.match(/^([><!=]+)(\\d+)$/);\n      if (sm) {\n        const op = sm[1];\n        const val = parseInt(sm[2], 10);\n        const isSuccess = (roll: number) => {\n          switch (op) {\n            case '>=':\n              return roll >= val;\n            case '<=':\n              return roll <= val;\n            case '=':\n            case '==':\n              return roll === val;\n            case '>':\n              return roll > val;\n            case '<':\n              return roll < val;\n            case '!=':\n            case '<>':\n              return roll !== val;\n            default:\n              return false;\n          }\n        };\n        total = keptDice.filter(isSuccess).length;\n      }\n    }\n\n    const tags: string[] = [];\n    if (!isFate && sides === 20) {\n      const diceToCheck = keptDice.length > 0 ? keptDice : rawDice;\n      if (diceToCheck.some(roll => roll === 20)) tags.push('nat20');\n      if (diceToCheck.some(roll => roll === 1)) tags.push('nat1');\n    }\n\n    const totalText = Number.isNaN(total) ? 'NaN' : String(total);\n    const diceList = rawDice.length > 0 ? `[${rawDice.join(',')}]` : '[]';\n    const showList = rawDice.length !== 1 || Boolean(keepDrop) || Boolean(successPart);\n    const breakdown = showList ? `${formula}=${diceList}${totalText}` : `${formula}=${totalText}`;\n\n    return {\n      total,\n      rawDice,\n      keptDice,\n      formula,\n      breakdown,\n      tags,\n    };\n  };\n\n  // \n  const calculateDiceExpectedValue = (diceExpr: string): number => {\n    const formula = String(diceExpr).replace(/\\s+/g, '');\n    if (!formula) return Number.NaN;\n\n    const parts = formula.match(/[+-]?[^+-]+/g);\n    if (!parts) return Number.NaN;\n\n    let total = 0;\n    for (const part of parts) {\n      if (!part) continue;\n      const sign = part.startsWith('-') ? -1 : 1;\n      const body = part.replace(/^[+-]/, '');\n      if (!body) continue;\n\n      const diceMatch = body.match(\n        /^(\\d*)d(\\d+|F)([bp]\\d+)?(r[o]?(?:[><!=]+)?\\d*)?(!!?(?:[><!=]+\\d+)?)?(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?((?:[><!=]+)\\d+)?$/i,\n      );\n\n      if (diceMatch) {\n        const [, countStr, sidesOrF, , , , keepDrop] = diceMatch;\n        const count = countStr ? parseInt(countStr, 10) : 1;\n        const isFate = sidesOrF.toUpperCase() === 'F';\n        const sides = isFate ? 0 : parseInt(sidesOrF, 10);\n        const expectedPerDie = isFate ? 0 : (1 + sides) / 2;\n\n        let keptCount = count;\n        if (keepDrop) {\n          const keepDropType = keepDrop.slice(0, 2);\n          const keepDropValue = parseInt(keepDrop.slice(2), 10);\n          if (!Number.isNaN(keepDropValue)) {\n            if (keepDropType === 'kh' || keepDropType === 'kl') {\n              keptCount = Math.min(count, keepDropValue);\n            } else if (keepDropType === 'dh' || keepDropType === 'dl') {\n              keptCount = Math.max(0, count - keepDropValue);\n            }\n          }\n        }\n\n        total += sign * keptCount * expectedPerDie;\n        continue;\n      }\n\n      const numericValue = Number(body);\n      if (Number.isNaN(numericValue)) {\n        return Number.NaN;\n      }\n      total += sign * numericValue;\n    }\n\n    return total;\n  };\n\n  //  2d6+33 \n  const rollComplexDiceExpression = (expr: string): RollResult => {\n    const formula = String(expr).replace(/\\s+/g, '');\n    if (!formula) {\n      return { total: Number.NaN, rawDice: [], keptDice: [], formula: '', breakdown: 'NaN', tags: [] };\n    }\n\n    // \n    const simpleResult = rollDiceExpression(formula);\n    if (!Number.isNaN(simpleResult.total)) {\n      return simpleResult;\n    }\n\n    //  2d6+33, d20-5\n    const parts = formula.match(/[+-]?[^+-]+/g);\n    if (!parts) {\n      return { total: Number.NaN, rawDice: [], keptDice: [], formula, breakdown: `${formula}=NaN`, tags: [] };\n    }\n\n    let total = 0;\n    const allRawDice: number[] = [];\n    const allKeptDice: number[] = [];\n    const breakdownParts: string[] = [];\n    const allTags: string[] = [];\n\n    for (const part of parts) {\n      if (!part) continue;\n      const sign = part.startsWith('-') ? -1 : 1;\n      const body = part.replace(/^[+-]/, '');\n      if (!body) continue;\n\n      // \n      const diceResult = rollDiceExpression(body);\n      if (!Number.isNaN(diceResult.total)) {\n        total += sign * diceResult.total;\n        allRawDice.push(...diceResult.rawDice);\n        allKeptDice.push(...diceResult.keptDice);\n        breakdownParts.push(\n          sign === -1\n            ? `-${diceResult.breakdown}`\n            : breakdownParts.length > 0\n              ? `+${diceResult.breakdown}`\n              : diceResult.breakdown,\n        );\n        allTags.push(...diceResult.tags);\n        continue;\n      }\n\n      // \n      const numericValue = Number(body);\n      if (!Number.isNaN(numericValue)) {\n        total += sign * numericValue;\n        const signedValue = sign * numericValue;\n        breakdownParts.push(signedValue >= 0 && breakdownParts.length > 0 ? `+${signedValue}` : String(signedValue));\n        continue;\n      }\n\n      // \n      return { total: Number.NaN, rawDice: [], keptDice: [], formula, breakdown: `${formula}=NaN`, tags: [] };\n    }\n\n    return {\n      total,\n      rawDice: allRawDice,\n      keptDice: allKeptDice,\n      formula,\n      breakdown: `${breakdownParts.join('')}=${total}`,\n      tags: allTags,\n    };\n  };\n\n  /**\n   * \n   * @param formula  \"/2+1d10\"  \"3d6*5\"\n   * @param context  { : 50, : 40 }\n   * @returns \n   */\n  const evaluateFormula = (formula, context = {}) => {\n    if (!formula) return 0;\n\n    let expr = String(formula).trim();\n\n    // 1. \n    const varNames = Object.keys(context).sort((a, b) => b.length - a.length);\n    for (const name of varNames) {\n      const value = context[name];\n      if (typeof value === 'number' && !isNaN(value)) {\n        // \n        expr = expr.split(name).join(`(${value})`);\n      }\n    }\n\n    // 2. \n    expr = expr.replace(\n      /\\d*d(?:\\d+|F)(?:[bp]\\d+)?(?:r[o]?(?:[><!=]+)?\\d*)?(?:!!?(?:[><!=]+\\d+)?)?(?:kh\\d+|kl\\d+|dh\\d+|dl\\d+)?(?:(?:[><!=]+)\\d+)?/gi,\n      match => {\n        const result = rollDiceExpression(match);\n        return Number.isNaN(result.total) ? '0' : String(result.total);\n      },\n    );\n\n    // 3. \n    if (!/^[\\d\\s+\\-*/().]+$/.test(expr)) {\n      console.warn('[DICE]evaluateFormula :', formula, '', expr);\n      return 0;\n    }\n\n    // 4. \n    try {\n      // eslint-disable-next-line no-new-func\n      const result = new Function(`return (${expr})`)();\n      return Math.round(result); // \n    } catch (e) {\n      console.error('[DICE]evaluateFormula :', formula, '', expr, e);\n      return 0;\n    }\n  };\n\n  /**\n   * \n   * @param {string} formula \n   * @param {Record<string, number>} context \n   * @returns {{success: boolean, value?: number | boolean, error?: string}}\n   */\n  const evaluateCondition = (formula, context = {}) => {\n    if (!formula || typeof formula !== 'string') return { success: true, value: 0 };\n\n    const functionHandlers: Record<string, { minArgs: number; maxArgs: number; apply: (args: number[]) => number }> = {\n      abs: { minArgs: 1, maxArgs: 1, apply: args => Math.abs(args[0]) },\n      floor: { minArgs: 1, maxArgs: 1, apply: args => Math.floor(args[0]) },\n      min: { minArgs: 2, maxArgs: Number.POSITIVE_INFINITY, apply: args => Math.min(...args) },\n      max: { minArgs: 2, maxArgs: Number.POSITIVE_INFINITY, apply: args => Math.max(...args) },\n    };\n\n    //  $roll.hasTag(\"tag\")\n    if (context && context.$roll && typeof context.$roll === 'object') {\n      const roll = context.$roll as RollResult;\n      functionHandlers['$roll.hastag'] = {\n        minArgs: 1,\n        maxArgs: 1,\n        apply: (args: any[]) => {\n          const tag = String(args[0]);\n          return (roll.tags ?? []).includes(tag) ? 1 : 0;\n        },\n      };\n    }\n\n    function evaluateExpression(expression: string): { success: boolean; value?: number | boolean; error?: string } {\n      // 2. \n      // \n      const illegal = expression.match(/[^0-9+\\-*/()><=!&| .]/g);\n      if (illegal) {\n        return { success: false, error: `: ${illegal.join('')}` };\n      }\n\n      // 3.  (Tokenization)\n      // : >=, <=, ==, !=, &&, ||\n      const tokens = [];\n      let i = 0;\n      while (i < expression.length) {\n        const char = expression[i];\n        if (/\\s/.test(char)) {\n          i++;\n          continue;\n        }\n        if (/\\d/.test(char)) {\n          let num = '';\n          while (i < expression.length && /[\\d.]/.test(expression[i])) {\n            num += expression[i++];\n          }\n          tokens.push({ type: 'NUMBER', value: parseFloat(num) });\n          continue;\n        }\n\n        //  (===, !==)\n        const threeChar = expression.substring(i, i + 3);\n        if (['===', '!=='].includes(threeChar)) {\n          tokens.push({ type: 'OPERATOR', value: threeChar });\n          i += 3;\n          continue;\n        }\n\n        // \n        const twoChar = expression.substring(i, i + 2);\n        if (['>=', '<=', '==', '!=', '&&', '||'].includes(twoChar)) {\n          tokens.push({ type: 'OPERATOR', value: twoChar });\n          i += 2;\n          continue;\n        }\n\n        // \n        if (['+', '-', '*', '/', '%', '>', '<', '(', ')'].includes(char)) {\n          //  '-' /\n          if (char === '-' || char === '+') {\n            const lastToken = tokens[tokens.length - 1];\n            const isUnary = !lastToken || lastToken.type === 'OPERATOR' || lastToken.value === '(';\n            if (isUnary) {\n              // \n              let num = char;\n              i++;\n              while (i < expression.length && /[\\d.]/.test(expression[i])) {\n                num += expression[i++];\n              }\n              if (num.length > 1) {\n                tokens.push({ type: 'NUMBER', value: parseFloat(num) });\n                continue;\n              }\n              //  '-' \n              i--;\n            }\n          }\n          if (char === '>' || char === '<') {\n            const nextChar = expression[i + 1];\n            if (nextChar === char) {\n              //  >>  <<\n              return { success: false, error: `:  \"${char}${char}\"` };\n            }\n          }\n          tokens.push({ type: 'OPERATOR', value: char });\n          i++;\n          continue;\n        }\n\n        // \n        if (['=', '!', '&', '|'].includes(char)) {\n          return { success: false, error: `:  \"${char}\"` };\n        }\n        return { success: false, error: `:  \"${char}\"` };\n      }\n\n      // 4. Shunting-yard \n      const ops = {\n        '||': { prec: 1, assoc: 'L' },\n        '&&': { prec: 2, assoc: 'L' },\n        '==': { prec: 3, assoc: 'L' },\n        '!=': { prec: 3, assoc: 'L' },\n        '===': { prec: 3, assoc: 'L' },\n        '!==': { prec: 3, assoc: 'L' },\n        '>': { prec: 4, assoc: 'L' },\n        '<': { prec: 4, assoc: 'L' },\n        '>=': { prec: 4, assoc: 'L' },\n        '<=': { prec: 4, assoc: 'L' },\n        '+': { prec: 5, assoc: 'L' },\n        '-': { prec: 5, assoc: 'L' },\n        '*': { prec: 6, assoc: 'L' },\n        '/': { prec: 6, assoc: 'L' },\n        '%': { prec: 6, assoc: 'L' },\n      };\n\n      const outputQueue = [];\n      const operatorStack = [];\n\n      for (const token of tokens) {\n        if (token.type === 'NUMBER') {\n          outputQueue.push(token);\n        } else if (token.value === '(') {\n          operatorStack.push(token);\n        } else if (token.value === ')') {\n          while (operatorStack.length > 0 && operatorStack[operatorStack.length - 1].value !== '(') {\n            outputQueue.push(operatorStack.pop());\n          }\n          if (operatorStack.length === 0) return { success: false, error: '' };\n          operatorStack.pop(); //  '('\n        } else {\n          const o1 = token.value;\n          while (operatorStack.length > 0) {\n            const o2 = operatorStack[operatorStack.length - 1].value;\n            if (o2 === '(') break;\n            if (ops[o2].prec > ops[o1].prec || (ops[o2].prec === ops[o1].prec && ops[o1].assoc === 'L')) {\n              outputQueue.push(operatorStack.pop());\n            } else {\n              break;\n            }\n          }\n          operatorStack.push(token);\n        }\n      }\n\n      while (operatorStack.length > 0) {\n        const op = operatorStack.pop();\n        if (op.value === '(') return { success: false, error: '' };\n        outputQueue.push(op);\n      }\n\n      // 5. \n      const evalStack = [];\n      for (const token of outputQueue) {\n        if (token.type === 'NUMBER') {\n          evalStack.push(token.value);\n        } else {\n          const b = evalStack.pop();\n          const a = evalStack.pop();\n          let res;\n          switch (token.value) {\n            case '+':\n              res = a + b;\n              break;\n            case '-':\n              res = a - b;\n              break;\n            case '*':\n              res = a * b;\n              break;\n            case '/':\n              res = a / b;\n              break;\n            case '%':\n              res = a % b;\n              break;\n            case '>':\n              res = a > b;\n              break;\n            case '<':\n              res = a < b;\n              break;\n            case '>=':\n              res = a >= b;\n              break;\n            case '<=':\n              res = a <= b;\n              break;\n            case '==':\n              res = a == b;\n              break;\n            case '!=':\n              res = a != b;\n              break;\n            case '===':\n              res = a === b;\n              break;\n            case '!==':\n              res = a !== b;\n              break;\n            case '&&':\n              res = a && b ? 1 : 0;\n              break;\n            case '||':\n              res = a || b ? 1 : 0;\n              break;\n            default:\n              return { success: false, error: `: ${token.value}` };\n          }\n          evalStack.push(res);\n        }\n      }\n\n      if (evalStack.length !== 1) return { success: false, error: '' };\n      return { success: true, value: evalStack[0] };\n    }\n\n    function normalizeNumberLiteral(value: number): string {\n      const text = String(value);\n      if (value < 0) return `(0${text})`;\n      return `(${text})`;\n    }\n\n    function splitArguments(argsText: string): string[] {\n      const args: string[] = [];\n      let depth = 0;\n      let start = 0;\n      let inQuote = false;\n      for (let index = 0; index < argsText.length; index++) {\n        const char = argsText[index];\n        if (char === '\"' || char === \"'\") {\n          inQuote = !inQuote;\n        }\n        if (inQuote) continue;\n\n        if (char === '(') {\n          depth++;\n        } else if (char === ')') {\n          depth--;\n        } else if (char === ',' && depth === 0) {\n          args.push(argsText.slice(start, index).trim());\n          start = index + 1;\n        }\n      }\n      args.push(argsText.slice(start).trim());\n      return args;\n    }\n\n    function findMatchingParen(source: string, startIndex: number): number {\n      let depth = 0;\n      for (let index = startIndex; index < source.length; index++) {\n        const char = source[index];\n        if (char === '(') depth++;\n        if (char === ')') {\n          depth--;\n          if (depth === 0) return index;\n        }\n      }\n      return -1;\n    }\n\n    function evaluateArgumentValue(argExpr: string): { success: boolean; value?: any; error?: string } {\n      const trimmed = argExpr.trim();\n      if (!trimmed) return { success: false, error: '' };\n\n      // \n      if ((trimmed.startsWith('\"') && trimmed.endsWith('\"')) || trimmed.startsWith(\"'\")) {\n        return { success: true, value: trimmed.slice(1, -1) };\n      }\n\n      // [] \n      let exprWithVars = trimmed;\n      const varPattern = /\\$[a-zA-Z_]\\w*/g;\n      exprWithVars = exprWithVars.replace(varPattern, match => {\n        const val = context[match];\n        return typeof val === 'number' && !isNaN(val) ? String(val) : '0';\n      });\n\n      const resolved = resolveFunctions(exprWithVars);\n      if (!resolved.success || resolved.expr === undefined) {\n        return { success: false, error: resolved.error ?? '' };\n      }\n\n      const dicePattern = /\\d*d(?:\\d+|F)/i;\n      if (dicePattern.test(resolved.expr)) {\n        const formulaValue = evaluateFormula(resolved.expr, context);\n        if (typeof formulaValue === 'number' && Number.isFinite(formulaValue)) {\n          return { success: true, value: formulaValue };\n        }\n      }\n\n      const evalResult = evaluateExpression(resolved.expr);\n      if (!evalResult.success || evalResult.value === undefined) {\n        return { success: false, error: evalResult.error ?? '' };\n      }\n      const value = typeof evalResult.value === 'boolean' ? (evalResult.value ? 1 : 0) : evalResult.value;\n      if (typeof value !== 'number' || Number.isNaN(value)) {\n        return { success: false, error: '' };\n      }\n      return { success: true, value };\n    }\n\n    function resolveFunctions(source: string): { success: boolean; expr?: string; error?: string } {\n      let result = '';\n      let index = 0;\n      const isIdentifierStart = (char: string): boolean => /[a-zA-Z_]/.test(char);\n      const isIdentifierChar = (char: string): boolean => /[a-zA-Z0-9_]/.test(char);\n\n      while (index < source.length) {\n        const char = source[index];\n        if (isIdentifierStart(char)) {\n          let name = char;\n          index++;\n          while (index < source.length && (isIdentifierChar(source[index]) || source[index] === '.')) {\n            name += source[index];\n            index++;\n          }\n\n          //  true/false \n          const nameLower = name.toLowerCase();\n          if (nameLower === 'true') {\n            result += '1';\n            continue;\n          }\n          if (nameLower === 'false') {\n            result += '0';\n            continue;\n          }\n\n          let nextIndex = index;\n          while (nextIndex < source.length && /\\s/.test(source[nextIndex])) {\n            nextIndex++;\n          }\n\n          if (source[nextIndex] !== '(') {\n            return { success: false, error: `: ${name}` };\n          }\n\n          const closeIndex = findMatchingParen(source, nextIndex);\n          if (closeIndex === -1) return { success: false, error: '' };\n\n          const argsText = source.slice(nextIndex + 1, closeIndex);\n          const args = splitArguments(argsText);\n          const key = name.toLowerCase();\n          const handler = functionHandlers[key];\n          if (!handler) return { success: false, error: `: ${name}` };\n          if (args.length < handler.minArgs || args.length > handler.maxArgs) {\n            return { success: false, error: ` ${name} ` };\n          }\n\n          const values: number[] = [];\n          for (const arg of args) {\n            if (!arg) return { success: false, error: ` ${name} ` };\n            const valueResult = evaluateArgumentValue(arg);\n            if (!valueResult.success || valueResult.value === undefined) {\n              return { success: false, error: valueResult.error ?? ` ${name} ` };\n            }\n            values.push(valueResult.value);\n          }\n\n          const fnResult = handler.apply(values);\n          if (!Number.isFinite(fnResult)) {\n            return { success: false, error: ` ${name} ` };\n          }\n          result += normalizeNumberLiteral(fnResult);\n          index = closeIndex + 1;\n          continue;\n        }\n\n        result += char;\n        index++;\n      }\n\n      return { success: true, expr: result };\n    }\n\n    // 1. \n    // : $roll.total, $attr, $dc, $mod ,0\n    //  $roll \n    if (context && context.$roll && typeof context.$roll === 'object') {\n      const roll = context.$roll as RollResult;\n      formula = formula.replace(/\\$roll\\.total/g, String(roll.total));\n      //  $roll.hasTag('tagName') \n      formula = formula.replace(/\\$roll\\.hasTag\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*\\)/gi, (_match, tag) => {\n        return (roll.tags ?? []).includes(tag) ? '1' : '0';\n      });\n    }\n\n    const varPattern = /\\$[a-zA-Z_]\\w*/g;\n    let expr = formula.trim().replace(varPattern, match => {\n      const val = context[match];\n      return typeof val === 'number' && !isNaN(val) ? String(val) : '0';\n    });\n\n    const resolved = resolveFunctions(expr);\n    if (!resolved.success || resolved.expr === undefined) {\n      return { success: false, error: resolved.error ?? '' };\n    }\n    expr = resolved.expr;\n\n    return evaluateExpression(expr);\n  };\n\n  /**\n   *  ( &&  ||)\n   * @param expr - \n   * @returns  &&  ||  true,  false\n   */\n  const isComplexCondition = (expr: string): boolean => {\n    return /(\\&\\&|\\|\\|)/.test(expr);\n  };\n\n  /**\n   * \n   * @param outcomes - outcomes  ()\n   * @param context -  {$roll, $attr, $dc, $mod, ...}\n   * @returns  outcome (, outcome)\n   */\n  const evaluateOutcomes = (outcomes: OutcomeLevel[], context: Record<string, number>) => {\n    if (!outcomes || outcomes.length === 0) {\n      console.warn('[DICE] outcomes ,');\n      return { id: 'default', name: '', condition: 'true', priority: 99 };\n    }\n    const sorted = [...outcomes].sort((a, b) => a.priority - b.priority);\n\n    for (const outcome of sorted) {\n      try {\n        const conditionResult: { success: boolean; value?: number | boolean; error?: string } = evaluateCondition(\n          outcome.condition,\n          context,\n        );\n        if (!conditionResult.success) {\n          if (conditionResult.error) {\n            console.warn(`[DICE] outcome \"${outcome.name}\" :`, conditionResult.error);\n          }\n          continue;\n        }\n        const isMatch =\n          typeof conditionResult.value === 'number' ? conditionResult.value !== 0 : Boolean(conditionResult.value);\n        if (isMatch) {\n          return outcome;\n        }\n      } catch (error) {\n        console.warn(`[DICE] outcome \"${outcome.name}\" :`, error);\n        continue;\n      }\n    }\n\n    return sorted[sorted.length - 1];\n  };\n\n  // \n  const DEFAULT_OUTPUT_TEMPLATE = `<meta:>\n$outcomeText\n$initiator  $attrName $formula=$roll $conditionExpr$judgeResult$outcomeName\n</meta:>`;\n\n  // \n  const DEFAULT_CONTEST_OUTPUT_TEMPLATE = `<meta:>\n$initiator $initAttrName vs $opponent $oppAttrName\n$initiator $initAttrName$formula=$initRoll $initConditionExpr$initJudgeResult$initSuccessName\n$opponent $oppAttrName$formula=$oppRoll $oppConditionExpr$oppJudgeResult$oppSuccessName\n$winner\n</meta:>`;\n\n  /**\n   * \n   * @param template - \n   * @param context - \n   * @returns \n   */\n  const formatOutputTemplate = (template: string, context: Record<string, string | number | undefined>): string => {\n    const missingKeys = new Set<string>();\n\n    // []  $roll.total $roll\n    //  $roll.total  \"3.total\"\n    let result = template.replace(/\\$([a-zA-Z_]\\w*\\.[a-zA-Z_]\\w*)/g, match => {\n      const key = match.slice(1); //  $  \"roll.total\"\n      const value = context[key];\n      if (value === undefined || value === null) {\n        if (!missingKeys.has(key)) {\n          missingKeys.add(key);\n          console.warn(`[DICE] formatOutputTemplate:  $${key}`);\n        }\n        return '';\n      }\n      return String(value);\n    });\n\n    // \n    result = result.replace(/\\$([a-zA-Z_]\\w*)(?=\\W|$)/g, match => {\n      const key = match.slice(1);\n      const value = context[key];\n      if (value === undefined || value === null) {\n        if (!missingKeys.has(key)) {\n          missingKeys.add(key);\n          console.warn(`[DICE] formatOutputTemplate:  $${key}`);\n        }\n        return '';\n      }\n      return String(value);\n    });\n    // \n    return result.replace(/\\n\\s*\\n/g, '\\n');\n  };\n\n  /**\n   * \n   * @param formula \n   * @param range  [min, max]\n   * @param context \n   * @returns \n   */\n  const generateAttributeValue = (formula, range, context) => {\n    let value = evaluateFormula(formula, context);\n\n    if (range && Array.isArray(range) && range.length === 2) {\n      value = Math.max(range[0], Math.min(range[1], value));\n    }\n\n    return value;\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const DASHBOARD_TABLE_CONFIG = {\n    global: {\n      tableKeywords: ['', '', ''],\n      columns: {\n        detailLocation: { keywords: ['', '', '', ''], fallbackIndex: null },\n        currentLocation: { keywords: ['', '', '', ''], fallbackIndex: 2 },\n      },\n    },\n    player: {\n      // : user, <user>\n      tableKeywords: ['', '', '', '', 'player', '', 'user', '<user>'],\n      columns: {\n        name: { keywords: ['', '', '', 'name'], fallbackIndex: 1 },\n        status: { keywords: ['', '', '', ''], fallbackIndex: null },\n        position: { keywords: ['', '', ''], fallbackIndex: null },\n        attrs: { keywords: ['', ''], fallbackIndex: null, isMultiple: true },\n        // : , , , \n        money: {\n          keywords: ['', '', '', '', '', '', '', '', ''],\n          fallbackIndex: null,\n        },\n        resources: { keywords: ['', '', 'resources'], fallbackIndex: null },\n      },\n    },\n    location: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: {\n          keywords: ['', '', '', '', '', '', '', ''],\n          fallbackIndex: 1,\n        },\n        description: { keywords: ['', '', '', '', ''], fallbackIndex: null },\n      },\n    },\n    npc: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        'NPC',\n        '',\n        '',\n        '',\n        '',\n        'character',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', ''], fallbackIndex: 1 },\n        status: { keywords: ['', ''], fallbackIndex: null },\n        position: { keywords: ['', '', '', ''], fallbackIndex: null },\n        inScene: { keywords: ['', '', '', ''], fallbackIndex: null },\n      },\n    },\n    quest: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        progress: { keywords: ['', '', '/'], fallbackIndex: 5 },\n        status: { keywords: [''], fallbackIndex: 6 },\n      },\n      filters: {\n        active: { column: 'status', includes: ['', '', ''], excludeColumn: 'type', excludes: [''] },\n      },\n    },\n    bag: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        count: { keywords: ['', '', ''], fallbackIndex: 3 },\n      },\n    },\n    skill: {\n      // : , , , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        level: { keywords: ['', '', '', 'lv'], fallbackIndex: 3 },\n      },\n    },\n    equip: {\n      // : , , , , , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        part: { keywords: ['', '', ''], fallbackIndex: 3 },\n        isEquipped: { keywords: ['', '', '', ''], fallbackIndex: 4 },\n      },\n      filters: {\n        equipped: { column: 'isEquipped', includes: ['', '', 'true', '', 'yes', 'equipped'] },\n      },\n    },\n  };\n\n  // \n  const DashboardDataParser = {\n    // \n    findTable(allTables, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return null;\n      }\n\n      for (const keyword of config.tableKeywords) {\n        for (const tableName in allTables) {\n          if (tableName.includes(keyword)) {\n            console.info(`[DICE]: \"${moduleKey}\"\"${tableName}\" (: \"${keyword}\")`);\n            return {\n              data: allTables[tableName],\n              name: tableName,\n              key: allTables[tableName].key,\n              config: config,\n            };\n          }\n        }\n      }\n      console.info(\n        `[DICE]: \"${moduleKey}\" (: ${config.tableKeywords.join(', ')})`,\n      );\n      return null;\n    },\n\n    // \n    findColumnIndex(headers, columnKey, moduleConfig) {\n      const colConfig = moduleConfig.columns[columnKey];\n      if (!colConfig) return -1;\n\n      // \n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (colConfig.keywords.some(kw => h.includes(kw.toLowerCase()))) {\n          return i;\n        }\n      }\n\n      // \n      return colConfig.fallbackIndex ?? -1;\n    },\n\n    // \n    getValue(row, headers, columnKey, moduleConfig) {\n      const idx = this.findColumnIndex(headers, columnKey, moduleConfig);\n      if (idx < 0 || idx >= row.length) return null;\n      return row[idx];\n    },\n\n    // \n    getColumnMap(headers, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) return {};\n\n      const map = {};\n      for (const colKey in config.columns) {\n        map[colKey] = this.findColumnIndex(headers, colKey, config);\n      }\n      return map;\n    },\n\n    // \n    parseRows(tableResult, moduleKey) {\n      if (!tableResult || !tableResult.data) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return [];\n      }\n\n      const { data, config } = tableResult;\n      const headers = data.headers || [];\n      const rows = data.rows || [];\n      const colMap = this.getColumnMap(headers, moduleKey);\n\n      const parsed = rows.map((row, idx) => {\n        const obj = { _rowIndex: idx, _raw: row };\n        for (const colKey in colMap) {\n          const colIdx = colMap[colKey];\n          obj[colKey] = colIdx >= 0 && colIdx < row.length ? row[colIdx] : null;\n        }\n        return obj;\n      });\n\n      console.info(`[DICE]: \"${moduleKey}\"${parsed.length}`);\n      return parsed;\n    },\n\n    // \n    applyFilter(parsedRows, filterKey, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config || !config.filters || !config.filters[filterKey]) return parsedRows;\n\n      const filter = config.filters[filterKey];\n\n      // parsedRows\n      const hasFilterColumn = parsedRows.some(row => row[filter.column] !== null && row[filter.column] !== undefined);\n      if (!hasFilterColumn) {\n        // \n        return parsedRows;\n      }\n\n      return parsedRows.filter(row => {\n        const value = String(row[filter.column] || '').toLowerCase();\n        const matchInclude = filter.includes.some(inc => value.includes(inc.toLowerCase()));\n\n        if (filter.excludeColumn && filter.excludes) {\n          const excludeValue = String(row[filter.excludeColumn] || '').toLowerCase();\n          const matchExclude = filter.excludes.some(exc => excludeValue.includes(exc.toLowerCase()));\n          return matchInclude && !matchExclude;\n        }\n\n        return matchInclude;\n      });\n    },\n  };\n\n  const DEFAULT_GM_CONFIG = {\n    enabled: true,\n    diceSystem: '1d100',\n    showDiceIcon: true,\n    autoSendPrompt: true,\n    action_groups: [\n      {\n        table_keywords: ['', '', 'Location', 'Map', '', ''],\n        actions: [\n          { label: '', icon: 'fa-walking', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-search', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-clock', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', 'NPC', '', '', ''],\n        actions: [\n          { label: '', icon: 'fa-comments', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-hand-fist', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          { label: '', icon: 'fa-hand-pointer', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-trash', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-shield-halved',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-coins', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-wand-magic-sparkles',\n            type: 'skill_check',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-dumbbell', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-crosshairs',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          {\n            label: '',\n            icon: 'fa-list-check',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-ear-listen',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-user-plus', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          {\n            label: '',\n            icon: 'fa-handshake',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n        ],\n      },\n    ],\n  };\n  const getGMConfig = () => {\n    const baseConfig = Store.get(STORAGE_KEY_GM_CONFIG, DEFAULT_GM_CONFIG);\n\n    // \n    const activePresetId = ActionPresetManager.getActivePresetId();\n    if (activePresetId === '__none__') {\n      return {\n        ...baseConfig,\n        action_rules_disabled: true, // \n      };\n    }\n\n    // \n    const activePreset = ActionPresetManager.getActivePreset();\n    if (activePreset && activePreset.rules && activePreset.rules.length > 0) {\n      //  custom_action_groups \n      const customActionGroups = activePreset.rules.map(rule => ({\n        table_keywords: rule.table_keywords || [],\n        actions: (rule.actions || []).map(action => ({\n          label: action.label,\n          icon: action.icon || ACTION_ICON_MAP[action.label] || 'fa-circle',\n          type: 'prompt',\n          template: action.template || `<user>{Name}:${action.label}`,\n          auto_send: false,\n        })),\n      }));\n\n      return {\n        ...baseConfig,\n        custom_action_groups: customActionGroups,\n      };\n    }\n\n    return baseConfig;\n  };\n\n  //  -  CSS \n  const getResultBadgeClass = resultType => {\n    // resultType: 'critSuccess' | 'extremeSuccess' | 'success' | 'warning' | 'failure' | 'critFailure'\n    const classMap = {\n      critSuccess: 'acu-result-badge acu-result-badge-crit-success',\n      extremeSuccess: 'acu-result-badge acu-result-badge-extreme-success',\n      success: 'acu-result-badge acu-result-badge-success',\n      warning: 'acu-result-badge acu-result-badge-warning',\n      failure: 'acu-result-badge acu-result-badge-failure',\n      critFailure: 'acu-result-badge acu-result-badge-crit-failure',\n    };\n    return classMap[resultType] || classMap.failure;\n  };\n\n  // [] \n  const ACTION_ICON_MAP: Record<string, string> = {\n    // \n    : 'fa-hand-fist',\n    : 'fa-hand-fist',\n    : 'fa-shield',\n    : 'fa-person-running',\n    // \n    : 'fa-comments',\n    : 'fa-comments',\n    : 'fa-hand',\n    : 'fa-heart',\n    : 'fa-calendar-check',\n    : 'fa-gift',\n    : 'fa-gift',\n    // \n    : 'fa-eye',\n    : 'fa-eye',\n    : 'fa-magnifying-glass',\n    // \n    : 'fa-hand-pointer',\n    : 'fa-trash',\n    : 'fa-shield-halved',\n    : 'fa-circle-xmark',\n    : 'fa-coins',\n    : 'fa-shopping-cart',\n    // \n    : 'fa-walking',\n    : 'fa-search',\n    : 'fa-clock',\n    : 'fa-door-open',\n    // \n    : 'fa-dumbbell',\n    : 'fa-wand-magic-sparkles',\n    : 'fa-fire',\n    // \n    : 'fa-crosshairs',\n    : 'fa-list-check',\n    : 'fa-circle-xmark',\n    : 'fa-check',\n    // \n    : 'fa-ear-listen',\n    : 'fa-user-plus',\n    : 'fa-handshake',\n    // \n    : 'fa-music',\n    : 'fa-guitar',\n    : 'fa-microphone',\n  };\n\n  /**\n   * \n   *\n   * []  > \n   *  config.custom_action_groups \n   * \"\"\"\"\"\"\n   *\n   * @param tableName \n   * @returns \n   */\n  const getActionsForTable = (tableName: string) => {\n    const config = getGMConfig();\n    if (!config.enabled) return [];\n\n    // \n    if ((config as any).action_rules_disabled) return [];\n\n    const lowerName = tableName.toLowerCase();\n\n    // [] \n    const customRules = (config as any).custom_action_groups || [];\n    for (const group of customRules) {\n      const matched = group.table_keywords.some((keyword: string) => lowerName.includes(keyword.toLowerCase()));\n      if (matched) return [...(group.actions || [])]; // \n    }\n\n    // \n    const builtinRules = config.action_groups || [];\n    for (const group of builtinRules) {\n      const matched = group.table_keywords.some((keyword: string) => lowerName.includes(keyword.toLowerCase()));\n      if (matched) return [...(group.actions || [])]; // \n    }\n\n    return [];\n  };\n\n  /**\n   * \n   *  + AI\n   *\n   * @param tableName \n   * @param headers \n   * @param rowData \n   * @returns \n   */\n  const getInteractOptionsForRow = (tableName: string, headers: any[], rowData: any[]) => {\n    // 1. \n    const defaultActions = [...getActionsForTable(tableName)];\n\n    // 2. \"\"\n    const interactColIdx = headers.findIndex(h => h && String(h).includes(''));\n    if (interactColIdx < 0 || !rowData[interactColIdx]) {\n      return defaultActions;\n    }\n\n    // 3. \n    const invalidValues = ['-', 'null', 'none', '', '', 'n/a', 'undefined', '/'];\n    const cellValue = String(rowData[interactColIdx]).trim();\n    if (!cellValue || invalidValues.includes(cellValue.toLowerCase())) {\n      return defaultActions;\n    }\n\n    // 4. \n    const interactOptions = cellValue\n      .split(/[,;]/)\n      .map(s => s.trim())\n      .filter(s => s && !invalidValues.includes(s.toLowerCase()));\n\n    if (interactOptions.length === 0) {\n      return defaultActions;\n    }\n\n    // 5. \n    const existingLabels = defaultActions.map(a => a.label.toLowerCase());\n\n    // 6. \n    const newActions = interactOptions\n      .filter(opt => !existingLabels.includes(opt.toLowerCase()))\n      .map(opt => ({\n        label: opt,\n        icon: ACTION_ICON_MAP[opt] || 'fa-hand-pointer',\n        type: 'prompt',\n        template: `<user>{Name}:${opt}`,\n        auto_send: true,\n      }));\n\n    // 7.  + \n    return [...defaultActions, ...newActions];\n  };\n\n  const isNumericCell = value => {\n    if (value === null || value === undefined || value === '') return false;\n    const str = String(value).trim();\n    // : (50/100)/: \n    return (\n      /^-?\\d+(\\.\\d+)?%?$/.test(str) ||\n      /^\\d+\\/\\d+$/.test(str) ||\n      /^[\\u4e00-\\u9fa5a-zA-Z]+[:\\s]\\s*\\d+/i.test(str) ||\n      /\\d+/.test(str)\n    );\n  };\n\n  const extractNumericValue = value => {\n    if (!value) return 0;\n    const str = String(value).trim();\n    //  (50/100 -> )\n    if (/^\\d+\\/\\d+$/.test(str)) return parseInt(str.split('/')[0], 10);\n    // \n    if (str.endsWith('%')) return parseInt(str.replace('%', ''), 10);\n    //  \":\" \n    const matches = str.match(/\\d+/g);\n    if (matches && matches.length > 0) {\n      return parseInt(matches[matches.length - 1], 10);\n    }\n    return 0;\n  };\n\n  const parseAttributeString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    //  JSON  {\"\":, ...}\n    if (rawStr.startsWith('{') && rawStr.endsWith('}')) {\n      try {\n        const jsonObj = JSON.parse(rawStr);\n        for (const key in jsonObj) {\n          const val = jsonObj[key];\n          if (typeof val === 'number') {\n            results.push({ name: key, value: val });\n          } else if (typeof val === 'string' && /^\\d+$/.test(val)) {\n            results.push({ name: key, value: parseInt(val, 10) });\n          }\n        }\n        if (results.length > 0) return results;\n      } catch (e) {\n        // JSON \n      }\n    }\n\n    //  \":; :\" \n    const parts = rawStr.split(/[,;\\s]+/);\n    for (const part of parts) {\n      const match = part.match(/^\"?([\\u4e00-\\u9fa5a-zA-Z_]+)\"?[:\\s]\\s*\"?(-?\\d+)\"?/);\n      if (match) {\n        results.push({ name: match[1], value: parseInt(match[2], 10) });\n      }\n    }\n    return results;\n  };\n  // [] :\n  // 1: \"();()\"\n  // 2: \":;:\"\n  // 3: \":,;:\"\n  const parseRelationshipString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    // \n    const parts = rawStr.split(/[;]/);\n    for (const part of parts) {\n      const trimmed = part.trim();\n      if (!trimmed) continue;\n\n      // 2/3: \":\"  \"\"\n      const colonMatch = trimmed.match(/^?(.+?)[:\\](.+)$/);\n      if (colonMatch) {\n        const name = colonMatch[1].trim();\n        const relation = colonMatch[2].trim();\n        if (name && relation) {\n          results.push({ name: name, relation: relation });\n          continue;\n        }\n      }\n\n      // 1: \"()\"  \"\"\n      const parenMatch = trimmed.match(/^([^(]+)[(]([^)]+)[)]$/);\n      if (parenMatch) {\n        results.push({ name: parenMatch[1].trim(), relation: parenMatch[2].trim() });\n        continue;\n      }\n\n      // \n      if (trimmed.length > 0) {\n        results.push({ name: trimmed, relation: '' });\n      }\n    }\n    return results;\n  };\n\n  // [] \n  const isRelationshipCell = (value, headerName) => {\n    if (!value) return false;\n    const str = String(value).trim();\n    const lowerHeader = (headerName || '').toLowerCase();\n    // \"\"\n    if (lowerHeader.includes('') || lowerHeader.includes('')) {\n      return true;\n    }\n    //  \"();()\" \n    return /^[^(;]+[(][^)]+[)]([;][^(;]+[(][^)]+[)])*$/.test(str);\n  };\n\n  const processTemplate = (template, cardData, headers) => {\n    if (!template || !cardData) return template;\n    let result = template;\n    const name = cardData[1] || '';\n    result = result.replace(/\\{Name\\}/gi, name);\n    result = result.replace(/\\{RowIndex\\}/gi, cardData[0] || '0');\n    if (headers && headers.length > 0) {\n      headers.forEach((header, idx) => {\n        if (header && idx < cardData.length) {\n          const value = cardData[idx] || '';\n          const regex = new RegExp(`\\\\{${header}\\\\}`, 'gi');\n          result = result.replace(regex, value);\n        }\n      });\n    }\n    result = result.replace(/\\{[^}]+\\}/g, '');\n    return result;\n  };\n\n  // \n  // /\n  const ACTION_BUTTONS = [\n    // { id: 'acu-btn-save-global', icon: 'fa-save', title: '' }, // \n    { id: 'acu-btn-open-editor', icon: 'fa-database', title: '-' },\n    { id: 'acu-btn-open-visualizer', icon: 'fa-table-columns', title: '' },\n    { id: 'acu-btn-collapse', icon: 'fa-chevron-down', title: '' },\n    { id: 'acu-btn-refill', icon: 'fa-bolt', title: '' },\n    { id: 'acu-btn-settings', icon: 'fa-cog', title: '' },\n  ];\n\n  let isInitialized = false;\n  let isSaving = false;\n  let saveQueue: Promise<void> = Promise.resolve(); // \n  let isEditingOrder = false;\n  let isSettingsOpen = false;\n\n  // ===  ===\n  // \n  type ModalEntry = {\n    name: string;\n    show: () => void;\n  };\n  const modalStack: ModalEntry[] = [];\n\n  /**\n   * \n   * @param name \n   * @param show \n   */\n  const pushModal = (name: string, show: () => void) => {\n    modalStack.push({ name, show });\n  };\n\n  /**\n   * \n   * @returns \n   */\n  const popModal = (): boolean => {\n    modalStack.pop(); // \n    const prev = modalStack.pop(); // \n    if (prev) {\n      prev.show(); // \n      return true;\n    }\n    return false;\n  };\n\n  /**\n   * \n   */\n  const clearModalStack = () => {\n    modalStack.length = 0;\n  };\n\n  let currentDiffMap = new Set();\n  let observer = null;\n  let _boundRenderHandler = null;\n\n  // ---  ---\n  let cachedRawData = null;\n  let hasUnsavedChanges = false;\n  // [] \n  let pendingDeletions: Record<string, number[]> = {};\n  const getPendingDeletions = () => pendingDeletions;\n  const clearPendingDeletions = () => {\n    pendingDeletions = {};\n  };\n  let isAutoTransforming = false; // \n  let tablePageStates = {};\n  let tableSearchStates = {};\n  let lastOptionHash = null;\n  let optionPanelVisible = false; // [] \n  // [] \n  const STORAGE_KEY_SCROLL = 'acu_scroll_v19_fixed';\n  let tableScrollStates = {};\n  try {\n    const saved = localStorage.getItem(STORAGE_KEY_SCROLL);\n    if (saved) tableScrollStates = JSON.parse(saved);\n  } catch (e) {\n    console.warn('[DICE]ACU Error:', e);\n  }\n  // [] \n  const UpdateController = {\n    _lastValidationCount: 0,\n    _isRollingBack: false, // \n\n    handleUpdate: () => {\n      // \n      if (UpdateController._isRollingBack) return;\n\n      // ===  intercept  ===\n      try {\n        const snapshot = loadSnapshot();\n        const newData = getTableData();\n        if (snapshot && newData) {\n          const rules = ValidationRuleManager.getEnabledRules();\n          const violations = ValidationEngine.checkTableRules(snapshot, newData, rules);\n\n          if (violations.length > 0) {\n            console.warn('[DICE]ACU :', violations);\n            UpdateController._isRollingBack = true;\n\n            //  API \n            const api = getCore().getDB();\n            if (api?.fillTable) {\n              try {\n                api.fillTable(snapshot);\n                if (window.toastr) {\n                  window.toastr.error(violations[0].message, '', {\n                    timeOut: 5000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              } catch (fillError) {\n                console.error('[DICE]ACU fillTable :', fillError);\n                // \n                if (window.toastr) {\n                  window.toastr.error(`: ${violations[0].message}`, '', {\n                    timeOut: 7000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              }\n            }\n\n            setTimeout(() => {\n              UpdateController._isRollingBack = false;\n            }, 500);\n            return;\n          }\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n      }\n\n      //  renderInterface \n      // \n      renderInterface();\n\n      // \n      setTimeout(() => {\n        try {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            const errors = ValidationEngine.validateAllData(rawData);\n            const newCount = errors.length;\n\n            // \n            if (newCount > UpdateController._lastValidationCount && newCount > 0) {\n              // \n            }\n\n            UpdateController._lastValidationCount = newCount;\n\n            // \n            updateValidationIndicator(newCount);\n          }\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n        }\n      }, 100);\n    },\n  };\n\n  // \n  const updateValidationIndicator = count => {\n    const { $ } = getCore();\n    const $indicator = $('.acu-validation-indicator');\n\n    if (count > 0) {\n      if ($indicator.length) {\n        $indicator.find('.acu-validation-count').text(count);\n        $indicator.show();\n      }\n    } else {\n      $indicator.hide();\n    }\n  };\n\n  // --- []  ---\n  const getCurrentContextFingerprint = () => {\n    try {\n      // 1:  API\n      if (typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId) {\n        return SillyTavern.getCurrentChatId();\n      }\n      // 2: \n      if (typeof SillyTavern !== 'undefined' && SillyTavern.chatId) {\n        return SillyTavern.chatId;\n      }\n      // 3:  (iframe )\n      if (window.parent?.SillyTavern?.getCurrentChatId) {\n        return window.parent.SillyTavern.getCurrentChatId();\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getCurrentContextFingerprint error:', e);\n    }\n    return 'unknown_context';\n  };\n\n  //  ()\n\n  const DEFAULT_CONFIG = {\n    layout: 'horizontal',\n    collapseStyle: 'bar',\n    collapseAlign: 'right',\n    fontFamily: 'default',\n    theme: 'retro',\n    cardWidth: 260,\n    fontSize: 13,\n    highlightNew: true,\n    itemsPerPage: 50,\n    actionsPosition: 'bottom',\n    gridColumns: 'auto', // [] \n    positionMode: 'fixed', // fixed=, embedded=\n    showOptionPanel: true, // [] \n    clickOptionToAutoSend: true, // [] \n    optionFontSize: 12, // [] \n    muteDatabaseToasts: false,\n  };\n\n  const FONTS = [\n    { id: 'default', name: ' (Modern)', val: `'Segoe UI', 'Microsoft YaHei', sans-serif` },\n    { id: 'hanchan', name: '', val: `\"\", sans-serif` },\n    { id: 'maple', name: 'Maple Mono ()', val: `\"Maple Mono NF CN\", monospace` },\n    { id: 'huiwen', name: ' (Huiwen)', val: `\"Huiwen-mincho\", serif` },\n    { id: 'cooper', name: 'Cooper', val: `\"CooperZhengKai\", serif` },\n    { id: 'yffyt', name: 'YFFYT ()', val: `\"YFFYT\", sans-serif` },\n    { id: 'fusion', name: 'Fusion Pixel ()', val: `\"Fusion Pixel 12px M latin\", monospace` },\n    { id: 'wenkai', name: ' (WenKai)', val: `\"LXGW WenKai\", serif` },\n    { id: 'notosans', name: ' (Noto Sans)', val: `\"Noto Sans CJK\", sans-serif` },\n    { id: 'zhuque', name: ' (Zhuque)', val: `\"Zhuque Fangsong (technical preview)\", serif` },\n  ];\n\n  const THEMES = [\n    { id: 'retro', name: ' (Retro)', icon: 'fa-scroll' },\n    { id: 'dark', name: ' (Dark)', icon: 'fa-moon' },\n    { id: 'modern', name: ' (Modern)', icon: 'fa-sun' },\n    { id: 'forest', name: ' (Forest)', icon: 'fa-tree' },\n    { id: 'ocean', name: ' (Ocean)', icon: 'fa-water' },\n    { id: 'cyber', name: ' (Cyber)', icon: 'fa-bolt' },\n    { id: 'nightowl', name: ' (Night Owl)', icon: 'fa-feather' },\n    { id: 'sakura', name: ' (Warm Pink)', icon: 'fa-heart' },\n    { id: 'minepink', name: ' (Mine Pink)', icon: 'fa-skull' },\n    { id: 'galgame', name: ' (Galgame Pink)', icon: 'fa-heart' },\n    { id: 'purple', name: ' (Purple)', icon: 'fa-gem' },\n    { id: 'wechat', name: ' (Green Bubble)', icon: 'fa-weixin' },\n    { id: 'educational', name: ' (Educational)', icon: 'fa-book' },\n    { id: 'vaporwave', name: ' (Vaporwave)', icon: 'fa-palette' },\n    { id: 'classicpackaging', name: ' (Classic Packaging)', icon: 'fa-box' },\n    { id: 'terminal', name: ' (Terminal)', icon: 'fa-terminal' },\n    { id: 'dreamcore', name: ' (Dreamcore)', icon: 'fa-cloud-moon' },\n    { id: 'aurora', name: ' (Aurora)', icon: 'fa-snowflake' },\n    { id: 'chouten', name: ' (Cyber Kawaii)', icon: 'fa-star' },\n  ];\n\n  // []  core  ( +  ST )\n  let _coreCache = null;\n  const getCore = () => {\n    const w = window.parent || window;\n    //  jQuery\n    const $ = window.jQuery || w.jQuery;\n\n    // ($)\n    if (_coreCache && _coreCache.$) return _coreCache;\n\n    const core = {\n      $: $,\n      getDB: () => w.AutoCardUpdaterAPI || window.AutoCardUpdaterAPI,\n      clipboard: w.navigator.clipboard,\n      //   ->  ->  ()\n      ST:\n        window.SillyTavern ||\n        w.SillyTavern ||\n        (() => {\n          try {\n            return window.top ? window.top.SillyTavern : null;\n          } catch (e) {\n            return null;\n          }\n        })(),\n    };\n\n    //  jQuery \n    if ($) _coreCache = core;\n    return core;\n  };\n\n  const updateSaveButtonState = () => {\n    const { $ } = getCore();\n    const $btn = $('#acu-btn-save-global');\n    const $icon = $btn.find('i');\n    const deletions = getPendingDeletions();\n    let hasDeletions = false;\n    if (deletions) {\n      for (const key in deletions) {\n        if (deletions[key] && deletions[key].length > 0) {\n          hasDeletions = true;\n          break;\n        }\n      }\n    }\n    if (hasUnsavedChanges || hasDeletions) {\n      $icon.addClass('acu-icon-breathe');\n      $btn.attr('title', '');\n    } else {\n      $icon.removeClass('acu-icon-breathe');\n      $btn.attr('title', '');\n      $btn.css('color', '');\n    }\n  };\n\n  const getIconForTableName = name => {\n    if (!name) return 'fa-table';\n    const n = name.toLowerCase();\n    if (n.includes('') || n.includes('')) return 'fa-user-circle';\n    if (n.includes('') || n.includes('')) return 'fa-globe-asia';\n    if (n.includes('') || n.includes('')) return 'fa-briefcase';\n    if (n.includes('') || n.includes('')) return 'fa-dragon';\n    if (n.includes('') || n.includes('')) return 'fa-user-friends';\n    if (n.includes('') || n.includes('')) return 'fa-scroll';\n    if (n.includes('') || n.includes('')) return 'fa-address-book';\n    if (n.includes('') || n.includes('')) return 'fa-book-reader';\n    if (n.includes('') || n.includes('')) return 'fa-map-location-dot';\n    if (n.includes('') || n.includes('') || n.includes('')) return 'fa-bullseye';\n    if (n.includes('') || n.includes('')) return 'fa-shield-halved';\n    if (n.includes('')) return 'fa-gem';\n    if (n.includes('') || n.includes('')) return 'fa-file-lines';\n    if (n.includes('')) return 'fa-list-check';\n    return 'fa-table';\n  };\n\n  const getBadgeStyle = text => {\n    if (!text) return '';\n    const str = String(text).trim();\n    if (/^[0-9]+%?$/.test(str) || /^Lv\\.\\d+$/.test(str)) return 'acu-badge-green';\n    if (str.length <= 6 && !str.includes('http')) return 'acu-badge-neutral';\n    if (['', '', '', '', '', ''].includes(str)) return 'acu-badge-neutral';\n    return '';\n  };\n\n  // []  ()\n  const Store = {\n    get: (key, def = null) => {\n      try {\n        return JSON.parse(localStorage.getItem(key)) ?? def;\n      } catch {\n        return def;\n      }\n    },\n    set: (key, val) => {\n      try {\n        localStorage.setItem(key, JSON.stringify(val));\n      } catch (e) {\n        // \n        if (e.name === 'QuotaExceededError' || e.message.includes('quota')) {\n          console.warn('[DICE]ACU ...');\n          try {\n            // 1.  ()\n            localStorage.removeItem(STORAGE_KEY_LAST_SNAPSHOT);\n\n            // 2. \n            localStorage.setItem(key, JSON.stringify(val));\n          } catch (retryErr) {\n            // \n            console.error('[DICE]ACU Store ', retryErr);\n            if (window.toastr && !window._acuQuotaAlerted) {\n              window.toastr.warning(' ');\n              window._acuQuotaAlerted = true;\n              setTimeout(() => (window._acuQuotaAlerted = false), 10000);\n            }\n          }\n        } else {\n          console.error('[DICE]ACU Store', e);\n        }\n      }\n    },\n  };\n\n  const getActiveTabState = () => Store.get(STORAGE_KEY_ACTIVE_TAB);\n  const saveActiveTabState = v => Store.set(STORAGE_KEY_ACTIVE_TAB, v);\n\n  // [] \n  const clearAllPanelStates = () => {\n    Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n    Store.set('acu_changes_panel_active', false);\n    Store.set('acu_favorites_panel_active', false);\n    saveActiveTabState(null);\n  };\n\n  // [] MVU  MVU \n  function canWriteMvuPanel() {\n    if (getActiveTabState() !== MvuModule.MODULE_ID) return false;\n    if (Store.get('acu_changes_panel_active', false)) return false;\n    if (Store.get('acu_favorites_panel_active', false)) return false;\n    if (Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false)) return false;\n    return true;\n  }\n\n  const getSavedTableOrder = () => Store.get(STORAGE_KEY_TABLE_ORDER);\n  const saveTableOrder = v => Store.set(STORAGE_KEY_TABLE_ORDER, v);\n  const getCollapsedState = () => Store.get(STORAGE_KEY_IS_COLLAPSED, false);\n  const saveCollapsedState = v => Store.set(STORAGE_KEY_IS_COLLAPSED, v);\n  // [] \n  const getOptionsCollapsedState = () => Store.get(STORAGE_KEY_OPTIONS_COLLAPSED, false);\n  const saveOptionsCollapsedState = v => Store.set(STORAGE_KEY_OPTIONS_COLLAPSED, v);\n  // []  (Chat ID)\n  const loadSnapshot = () => {\n    const data = Store.get(STORAGE_KEY_LAST_SNAPSHOT);\n    if (!data) return null;\n    // \n    const currentCtx = getCurrentContextFingerprint();\n    // \n    if (data._contextId && data._contextId !== currentCtx) {\n      return null;\n    }\n    return data;\n  };\n\n  // [] \n  const saveSnapshot = v => {\n    if (!v) return;\n    //  ChatID\n    if (typeof v === 'object') {\n      v._contextId = getCurrentContextFingerprint();\n    }\n    Store.set(STORAGE_KEY_LAST_SNAPSHOT, v);\n  };\n\n  // --- []  ---\n  const getTableHeights = () => Store.get(STORAGE_KEY_TABLE_HEIGHTS, {});\n  const saveTableHeights = v => Store.set(STORAGE_KEY_TABLE_HEIGHTS, v);\n  const getTableStyles = () => Store.get(STORAGE_KEY_TABLE_STYLES, {});\n  const saveTableStyles = v => Store.set(STORAGE_KEY_TABLE_STYLES, v);\n  const getHiddenTables = () => Store.get(STORAGE_KEY_HIDDEN_TABLES, []);\n  const saveHiddenTables = v => Store.set(STORAGE_KEY_HIDDEN_TABLES, v);\n  const getReverseTables = () => Store.get(STORAGE_KEY_REVERSE_TABLES, []);\n  const saveReverseTables = v => Store.set(STORAGE_KEY_REVERSE_TABLES, v);\n\n  // \n  const shouldShowReverseButton = tableName => {\n    if (!tableName) return false;\n    const keywords = ['', '', '', '', ''];\n    return keywords.some(kw => tableName.includes(kw));\n  };\n\n  // \n  const isTableReversed = tableName => {\n    return getReverseTables().includes(tableName);\n  };\n\n  // \n  const toggleTableReverse = tableName => {\n    const list = getReverseTables();\n    const idx = list.indexOf(tableName);\n    if (idx >= 0) {\n      list.splice(idx, 1);\n    } else {\n      list.push(tableName);\n    }\n    saveReverseTables(list);\n    console.log('[DICE]ACU toggleTableReverse:', tableName, 'reversed:', idx < 0);\n  };\n  // [] \n  const getAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> \n      if (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player')) {\n        if (sheet.content[1]) {\n          // <user>characterName\n          if (!isUser) {\n            const protagonistName = getDisplayName(String(sheet.content[1][1] || ''));\n            if (protagonistName !== getDisplayName(characterName)) continue;\n          }\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          let attrs = [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.includes(attr.name)) attrs.push(attr.name);\n              });\n            }\n          });\n          if (attrs.length > 0) return attrs;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && getDisplayName(String(row[nameColIdx] || '')) === getDisplayName(characterName)) {\n            let attrs = [];\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.includes(attr.name)) attrs.push(attr.name);\n                });\n              }\n            });\n            return attrs;\n          }\n        }\n      }\n    }\n\n    return [];\n  };\n  const normalizeAttributeName = (name: string): string => {\n    if (!name) return '';\n    return String(name)\n      .trim()\n      .toLowerCase()\n      .replace(/[\\s_:\\-]/g, '')\n      .replace(/$/u, '');\n  };\n\n  const resolveAttributeAliasName = (\n    characterName: string,\n    targetName: string,\n    aliasCandidates: string[] = [],\n  ): { name: string | null; reason?: string } => {\n    const allAttrs = getFullAttributesForCharacter(characterName)\n      .map(attr => attr.name)\n      .filter(Boolean);\n    if (allAttrs.length === 0) {\n      return { name: targetName || null };\n    }\n\n    const orderedCandidates = [targetName, ...aliasCandidates]\n      .map(n => String(n || '').trim())\n      .filter(Boolean)\n      .filter((n, idx, arr) => arr.indexOf(n) === idx);\n    if (orderedCandidates.length === 0) {\n      return { name: null, reason: '' };\n    }\n\n    for (const candidate of orderedCandidates) {\n      if (allAttrs.includes(candidate)) {\n        return { name: candidate };\n      }\n    }\n\n    const lowerMap = new Map<string, string>();\n    allAttrs.forEach(name => {\n      const lower = name.toLowerCase();\n      if (!lowerMap.has(lower)) lowerMap.set(lower, name);\n    });\n    for (const candidate of orderedCandidates) {\n      const matched = lowerMap.get(candidate.toLowerCase());\n      if (matched) {\n        return { name: matched };\n      }\n    }\n\n    const normalizedGroups = new Map<string, string[]>();\n    allAttrs.forEach(name => {\n      const key = normalizeAttributeName(name);\n      if (!key) return;\n      const list = normalizedGroups.get(key) || [];\n      list.push(name);\n      normalizedGroups.set(key, list);\n    });\n\n    for (const candidate of orderedCandidates) {\n      const normalized = normalizeAttributeName(candidate);\n      if (!normalized) continue;\n      const matched = normalizedGroups.get(normalized) || [];\n      if (matched.length === 1) {\n        return { name: matched[0] };\n      }\n      if (matched.length > 1) {\n        return {\n          name: null,\n          reason: `: ${candidate}  ${matched.join(', ')}`,\n        };\n      }\n    }\n\n    return {\n      name: null,\n      reason: `: ${targetName}`,\n    };\n  };\n\n  const isSameAttributeAlias = (left: string, right: string): boolean => {\n    const a = normalizeAttributeName(left);\n    const b = normalizeAttributeName(right);\n    return Boolean(a) && Boolean(b) && a === b;\n  };\n\n  // [] \n  const getAttributeValue = (characterName, attrName, aliasCandidates: string[] = []) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData || !attrName) return null;\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n    const resolved = resolveAttributeAliasName(characterName, attrName, aliasCandidates);\n    if (!resolved.name) return null;\n    const resolvedAttrName = resolved.name;\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> \n      if (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player')) {\n        if (sheet.content[1]) {\n          // <user>characterName\n          if (!isUser) {\n            const protagonistName = getDisplayName(String(sheet.content[1][1] || ''));\n            if (protagonistName !== getDisplayName(characterName)) continue;\n          }\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          for (let idx = 0; idx < headers.length; idx++) {\n            const h = headers[idx];\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              const found = parsed.find(attr => attr.name === resolvedAttrName);\n              if (found) return found.value;\n            }\n          }\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && getDisplayName(String(row[nameColIdx] || '')) === getDisplayName(characterName)) {\n            for (let idx = 0; idx < headers.length; idx++) {\n              const h = headers[idx];\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                const found = parsed.find(attr => attr.name === resolvedAttrName);\n                if (found) return found.value;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n  // [] 6\n  const STANDARD_ATTRS = ['', '', '', '', '', ''];\n\n  /**\n   * \n   */\n  const getStandardAttrs = () => {\n    const preset = AttributePresetManager.getActivePreset();\n    if (preset && preset.baseAttributes) {\n      return preset.baseAttributes.map(attr => attr.name);\n    }\n    return STANDARD_ATTRS;\n  };\n\n  /**\n   * \n   * \n   *  + \n   */\n  const getRandomSkillPool = () => {\n    try {\n      const preset = AttributePresetManager.getActivePreset();\n      if (preset) {\n        //  + \n        const allAttrs = new Set();\n\n        // \n        if (preset.baseAttributes && Array.isArray(preset.baseAttributes)) {\n          preset.baseAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        // \n        if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n          preset.specialAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        return Array.from(allAttrs);\n      }\n\n      // \n      const allPresets = AttributePresetManager.getAllPresets() || [];\n      const allAttrs = new Set(RANDOM_SKILL_POOL || []); // \n\n      // \n      if (Array.isArray(allPresets)) {\n        allPresets.forEach(p => {\n          if (!p) return;\n\n          // \n          if (p.baseAttributes && Array.isArray(p.baseAttributes)) {\n            p.baseAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n\n          // \n          if (p.specialAttributes && Array.isArray(p.specialAttributes)) {\n            p.specialAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n        });\n      }\n\n      return Array.from(allAttrs);\n    } catch (err) {\n      console.error('[DICE]ACU getRandomSkillPool :', err);\n      return RANDOM_SKILL_POOL || [];\n    }\n  };\n\n  // [] \n  const RANDOM_SKILL_POOL = [\n    // ---  (Physical & Movement) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Social & Psychological) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    // /\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Technical & Crafting) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Knowledge & Investigation) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Combat & Special) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  // []  COC/DND 6\n  /**\n   * \n   * @param isDNDOrPreset ()    null()\n   * @returns { base: {...}, special: {...} }  {...}\n   */\n  const generateRPGAttributes = (isDNDOrPreset = undefined) => {\n    // \n    if (typeof isDNDOrPreset === 'boolean') {\n      const isDND = isDNDOrPreset;\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n\n      const generateValue = () => {\n        if (isDND) {\n          const base = generate3d6();\n          const adjust = rollDice(4) - 2;\n          return Math.max(3, Math.min(18, base + adjust));\n        } else {\n          const base = generate3d6() * 5;\n          const adjust = rollDice(10) - 5;\n          return Math.max(5, Math.min(95, base + adjust));\n        }\n      };\n\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        result[attr] = generateValue();\n      });\n      return result; // \n    }\n\n    // \n    const preset = isDNDOrPreset || AttributePresetManager.getActivePreset();\n\n    // \n    if (!preset) {\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        const base = generate3d6() * 5;\n        const adjust = rollDice(10) - 5;\n        result[attr] = Math.max(5, Math.min(95, base + adjust));\n      });\n      return { base: result, special: {} };\n    }\n\n    // \n    const baseResult = {};\n    preset.baseAttributes.forEach(attr => {\n      const formula = attr.modifier ? `${attr.formula}+${attr.modifier}` : attr.formula;\n      baseResult[attr.name] = generateAttributeValue(formula, attr.range, {});\n    });\n\n    // \n    const specialResult = {};\n    if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n      preset.specialAttributes.forEach(attr => {\n        specialResult[attr.name] = generateAttributeValue(attr.formula, attr.range, baseResult);\n      });\n    }\n\n    return { base: baseResult, special: specialResult };\n  };\n\n  // [] \n  const clearPresetAttributesForCharacter = async charName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let baseColIndex = -1; // \n    let specialColIndex = -1; // \n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player')) {\n        if (sheet.content[1]) {\n          // <user>charName\n          if (!isUser) {\n            const protagonistName = getDisplayName(String(sheet.content[1][1] || ''));\n            if (protagonistName !== getDisplayName(charName)) continue;\n          }\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              baseColIndex = h;\n            } else if (headers[h] && headers[h].includes('')) {\n              specialColIndex = h;\n            }\n          }\n          // \n          if (baseColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('') && !headers[h].includes('')) {\n                baseColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // NPC//\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && getDisplayName(String(row[nameColIdx] || '')) === getDisplayName(charName)) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                baseColIndex = h;\n              } else if (headers[h] && headers[h].includes('')) {\n                specialColIndex = h;\n              }\n            }\n            // \n            if (baseColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('') && !headers[h].includes('')) {\n                  baseColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (baseColIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    // \n    targetSheet.content[targetRowIndex][baseColIndex] = '';\n\n    // \n    if (specialColIndex >= 0) {\n      targetSheet.content[targetRowIndex][specialColIndex] = '';\n    }\n\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData, [sheetKey]);\n\n    return {\n      success: true,\n    };\n  };\n\n  // [] \n  // [] \n  const writeAttributesToCharacter = async (\n    charName,\n    newAttrs,\n    isDND = false,\n    specialAttrs: Record<string, number> | null = null,\n  ) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let baseColIndex = -1; // \n    let specialColIndex = -1; // \n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player')) {\n        if (sheet.content[1]) {\n          // <user>charName\n          if (!isUser) {\n            const protagonistName = getDisplayName(String(sheet.content[1][1] || ''));\n            if (protagonistName !== getDisplayName(charName)) continue;\n          }\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              baseColIndex = h;\n            } else if (headers[h] && headers[h].includes('')) {\n              specialColIndex = h;\n            }\n          }\n          // \n          if (baseColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('') && !headers[h].includes('')) {\n                baseColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // \n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && getDisplayName(String(row[nameColIdx] || '')) === getDisplayName(charName)) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                baseColIndex = h;\n              } else if (headers[h] && headers[h].includes('')) {\n                specialColIndex = h;\n              }\n            }\n            // \n            if (baseColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('') && !headers[h].includes('')) {\n                  baseColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (baseColIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('\"\"');\n      return { success: false };\n    }\n\n    // \n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetSpecialAttrNames = new Set<string>();\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetSpecialAttrNames.add(attr.name));\n    }\n\n    // ==========  ==========\n    const existingBaseStr = targetSheet.content[targetRowIndex][baseColIndex] || '';\n    const existingBaseAttrs = parseAttributeString(existingBaseStr);\n\n    // \n    const existingBaseMap = {};\n    existingBaseAttrs.forEach(attr => {\n      existingBaseMap[attr.name] = attr.value;\n    });\n\n    // \n    let standardCount = 0;\n    standardAttrs.forEach(attrName => {\n      if (existingBaseMap[attrName] !== undefined) {\n        standardCount++;\n      }\n    });\n    const isComplete = standardCount === standardAttrs.length;\n\n    // \n    const customBaseAttrs: Array<{ name: string; value: number }> = [];\n    existingBaseAttrs.forEach(attr => {\n      if (!standardAttrs.includes(attr.name) && !presetSpecialAttrNames.has(attr.name)) {\n        customBaseAttrs.push({ name: attr.name, value: attr.value });\n      }\n    });\n\n    // \n    const baseResultParts: string[] = [];\n\n    // \n    standardAttrs.forEach(attrName => {\n      if (isComplete) {\n        //   \n        const newValue = newAttrs[attrName] !== undefined ? newAttrs[attrName] : existingBaseMap[attrName];\n        if (newValue !== undefined) {\n          baseResultParts.push(`${attrName}:${newValue}`);\n        }\n      } else {\n        //   \n        if (existingBaseMap[attrName] !== undefined) {\n          baseResultParts.push(`${attrName}:${existingBaseMap[attrName]}`);\n        } else if (newAttrs[attrName] !== undefined) {\n          baseResultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        }\n      }\n    });\n\n    // \n    if (specialColIndex < 0 && specialAttrs) {\n      Object.keys(specialAttrs).forEach(attrName => {\n        if (isComplete || !existingBaseMap[attrName]) {\n          baseResultParts.push(`${attrName}:${specialAttrs[attrName]}`);\n        } else {\n          baseResultParts.push(`${attrName}:${existingBaseMap[attrName]}`);\n        }\n      });\n    }\n\n    // \n    customBaseAttrs.forEach(attr => {\n      baseResultParts.push(`${attr.name}:${attr.value}`);\n    });\n\n    const newBaseAttrString = baseResultParts.join(';');\n\n    // \n    targetSheet.content[targetRowIndex][baseColIndex] = newBaseAttrString;\n\n    // ==========  ==========\n    let newSpecialAttrString = '';\n    if (specialColIndex >= 0 && specialAttrs && Object.keys(specialAttrs).length > 0) {\n      const existingSpecialStr = targetSheet.content[targetRowIndex][specialColIndex] || '';\n      const existingSpecialAttrs = parseAttributeString(existingSpecialStr);\n\n      // \n      const existingSpecialMap = {};\n      existingSpecialAttrs.forEach(attr => {\n        existingSpecialMap[attr.name] = attr.value;\n      });\n\n      // \n      const customSpecialAttrs: Array<{ name: string; value: number }> = [];\n      existingSpecialAttrs.forEach(attr => {\n        if (!presetSpecialAttrNames.has(attr.name)) {\n          customSpecialAttrs.push({ name: attr.name, value: attr.value });\n        }\n      });\n\n      // \n      const specialResultParts: string[] = [];\n\n      // \n      if (preset && preset.specialAttributes) {\n        preset.specialAttributes.forEach(attrDef => {\n          const attrName = attrDef.name;\n          if (specialAttrs[attrName] !== undefined) {\n            if (isComplete || !existingSpecialMap[attrName]) {\n              specialResultParts.push(`${attrName}:${specialAttrs[attrName]}`);\n            } else {\n              specialResultParts.push(`${attrName}:${existingSpecialMap[attrName]}`);\n            }\n          } else if (existingSpecialMap[attrName] !== undefined) {\n            specialResultParts.push(`${attrName}:${existingSpecialMap[attrName]}`);\n          }\n        });\n      }\n\n      // \n      customSpecialAttrs.forEach(attr => {\n        specialResultParts.push(`${attr.name}:${attr.value}`);\n      });\n\n      newSpecialAttrString = specialResultParts.join(';');\n\n      // \n      targetSheet.content[targetRowIndex][specialColIndex] = newSpecialAttrString;\n    }\n\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData, [sheetKey]);\n\n    // UI\n    const writtenAttrs: Array<{ name: string; value: number }> = [];\n    standardAttrs.forEach(attrName => {\n      writtenAttrs.push({ name: attrName, value: newAttrs[attrName] });\n    });\n\n    return {\n      success: true,\n      attrs: writtenAttrs,\n      attrString: newBaseAttrString,\n      specialAttrString: newSpecialAttrString,\n      wasComplete: isComplete,\n    };\n  };\n\n  // [] \n  const updateSingleAttribute = async (\n    charName: string,\n    attrName: string,\n    operation: 'add' | 'subtract' | 'set',\n    value: number,\n    options?: {\n      initValue?: number;\n      min?: number;\n      max?: number;\n      aliasCandidates?: string[];\n      skipSave?: boolean;\n      dataOverride?: Record<string, { name: string; content: (string | number | null)[][] }>;\n    },\n  ): Promise<{\n    success: boolean;\n    oldValue: number;\n    newValue: number;\n    error?: string;\n    resolvedAttrName?: string;\n    modifiedSheetKey?: string;\n  }> => {\n    const rawData = options?.dataOverride || cachedRawData || getTableData();\n    if (!rawData) {\n      const error = '';\n      console.error(`[DICE] updateSingleAttribute: ${error}`);\n      return { success: false, oldValue: 0, newValue: 0, error };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet: { name: string; content: (string | number | null)[][] } | null = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let fallbackAttrColIndex = -1;\n    let attrColIndices: number[] = [];\n    let sheetKey: string | null = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n      const collectAttrCols = (): number[] => {\n        const cols: number[] = [];\n        for (let h = 0; h < headers.length; h++) {\n          if (headers[h] && String(headers[h]).includes('')) {\n            cols.push(h);\n          }\n        }\n        return cols;\n      };\n      const pickFallbackAttrCol = (cols: number[]): number => {\n        if (cols.length === 0) return -1;\n        for (const col of cols) {\n          if (String(headers[col]).includes('')) return col;\n        }\n        for (const col of cols) {\n          if (String(headers[col]).includes('')) return col;\n        }\n        return cols[0];\n      };\n\n      // \n      if (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player')) {\n        if (sheet.content[1]) {\n          // <user>charName\n          if (!isUser) {\n            const protagonistName = getDisplayName(String(sheet.content[1][1] || ''));\n            if (protagonistName !== getDisplayName(charName)) continue;\n          }\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n          attrColIndices = collectAttrCols();\n          fallbackAttrColIndex = pickFallbackAttrCol(attrColIndices);\n          targetColIndex = fallbackAttrColIndex;\n          break;\n        }\n      }\n\n      // \n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (String(headers[h]).includes('') ||\n              String(headers[h]).includes('') ||\n              String(headers[h]).toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && getDisplayName(String(row[nameColIdx] || '')) === getDisplayName(charName)) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n            attrColIndices = collectAttrCols();\n            fallbackAttrColIndex = pickFallbackAttrCol(attrColIndices);\n            targetColIndex = fallbackAttrColIndex;\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      const error = `: ${charName || '<user>'}`;\n      console.error(`[DICE] updateSingleAttribute: ${error}`);\n      return { success: false, oldValue: 0, newValue: 0, error };\n    }\n\n    if (targetColIndex < 0) {\n      const error = '\"\"';\n      console.error(`[DICE] updateSingleAttribute: ${error}`);\n      return { success: false, oldValue: 0, newValue: 0, error };\n    }\n\n    const resolved = resolveAttributeAliasName(charName, attrName, options?.aliasCandidates || []);\n    if (!resolved.name) {\n      const error = resolved.reason || ` ${attrName} `;\n      console.warn(`[DICE] updateSingleAttribute: ${error}`);\n      return { success: false, oldValue: 0, newValue: 0, error };\n    }\n    const targetAttrName = resolved.name;\n\n    // \n    for (const colIdx of attrColIndices) {\n      const cellStr = String(targetSheet.content[targetRowIndex][colIdx] || '');\n      const parsed = parseAttributeString(cellStr);\n      if (parsed.some(attr => attr.name === targetAttrName)) {\n        targetColIndex = colIdx;\n        break;\n      }\n    }\n    if (targetColIndex < 0) {\n      targetColIndex = fallbackAttrColIndex;\n    }\n\n    // \n    const existingStr = String(targetSheet.content[targetRowIndex][targetColIndex] || '');\n    const existingAttrs = parseAttributeString(existingStr);\n    const existingMap: Record<string, number> = {};\n    existingAttrs.forEach(attr => {\n      existingMap[attr.name] = attr.value;\n    });\n\n    // \n    let oldValue: number;\n    if (existingMap[targetAttrName] !== undefined) {\n      oldValue = existingMap[targetAttrName];\n    } else if (options?.initValue !== undefined) {\n      oldValue = options.initValue;\n      console.info(`[DICE] updateSingleAttribute:  ${targetAttrName}  ${oldValue}`);\n    } else {\n      const error = ` ${targetAttrName} `;\n      console.warn(`[DICE] updateSingleAttribute: ${error}`);\n      return { success: false, oldValue: 0, newValue: 0, error };\n    }\n\n    // \n    let newValue: number;\n    switch (operation) {\n      case 'add':\n        newValue = oldValue + value;\n        break;\n      case 'subtract':\n        newValue = oldValue - value;\n        break;\n      case 'set':\n        newValue = value;\n        break;\n      default:\n        const error = `: ${operation}`;\n        console.error(`[DICE] updateSingleAttribute: ${error}`);\n        return { success: false, oldValue, newValue: oldValue, error };\n    }\n\n    //  min/max \n    const min = options?.min ?? 0; // 0\n    const max = options?.max ?? Infinity;\n    newValue = Math.max(min, Math.min(max, newValue));\n\n    console.info(\n      `[DICE] updateSingleAttribute: ${charName}.${targetAttrName} ${oldValue}  ${newValue} (${operation} ${value})`,\n    );\n\n    // \n    existingMap[targetAttrName] = newValue;\n\n    // \n    const resultParts: string[] = [];\n    const processedNames = new Set<string>();\n\n    // \n    existingAttrs.forEach(attr => {\n      const val = existingMap[attr.name];\n      if (val !== undefined) {\n        resultParts.push(`${attr.name}:${val}`);\n        processedNames.add(attr.name);\n      }\n    });\n\n    // \n    if (!processedNames.has(targetAttrName)) {\n      resultParts.push(`${targetAttrName}:${newValue}`);\n    }\n\n    const newAttrString = resultParts.join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    if (!options?.skipSave) {\n      cachedRawData = rawData;\n      await saveDataOnly(rawData, [sheetKey!]);\n    }\n\n    console.info(`[DICE] updateSingleAttribute:  ${charName}.${targetAttrName}`);\n    return { success: true, oldValue, newValue, resolvedAttrName: targetAttrName, modifiedSheetKey: sheetKey! };\n  };\n\n  // [] \"\"\n  const getFullAttributesForCharacter = (\n    characterName,\n    dataOverride?: Record<string, { name: string; content: (string | number | null)[][] }>,\n  ) => {\n    const rawData = dataOverride || cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n    let attrs = [];\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> \n      if (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player')) {\n        if (sheet.content[1]) {\n          // <user>characterName\n          if (!isUser) {\n            const protagonistName = getDisplayName(String(sheet.content[1][1] || ''));\n            if (protagonistName !== getDisplayName(characterName)) continue;\n          }\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.some(a => a.name === attr.name)) {\n                  attrs.push(attr);\n                }\n              });\n            }\n          });\n          if (attrs.length > 0) break;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && getDisplayName(String(row[nameColIdx] || '')) === getDisplayName(characterName)) {\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.some(a => a.name === attr.name)) {\n                    attrs.push(attr);\n                  }\n                });\n              }\n            });\n            break;\n          }\n        }\n        if (attrs.length > 0) break;\n      }\n    }\n\n    return attrs;\n  };\n  // [] \n  const initCustomDropdown = ($input, options) => {\n    const { $ } = getCore();\n    const inputId = $input.attr('id') || 'dd_' + Math.random().toString(36).substr(2, 9);\n    $input.attr('id', inputId);\n\n    // \n    $input.parent().find('.acu-dropdown-list').remove();\n\n    //  wrapper\n    if (!$input.parent().hasClass('acu-dropdown-wrapper')) {\n      $input.wrap('<div class=\"acu-dropdown-wrapper\"></div>');\n    }\n\n    //  -  CSS \n    const $dropdown = $(`<div class=\"acu-dropdown-list\" data-for=\"${inputId}\"></div>`);\n    $input.after($dropdown);\n\n    const renderItems = (filter = '') => {\n      const lowerFilter = filter.toLowerCase();\n      const filtered = options.filter(opt => opt.toLowerCase().includes(lowerFilter));\n\n      if (filtered.length === 0) {\n        $dropdown.html(`<div class=\"acu-dropdown-empty\"></div>`);\n      } else {\n        $dropdown.html(\n          filtered\n            .map(opt => `<div class=\"acu-dropdown-item\" data-value=\"${escapeHtml(opt)}\">${escapeHtml(opt)}</div>`)\n            .join(''),\n        );\n      }\n    };\n\n    const showDropdown = () => {\n      $('.acu-dropdown-list').removeClass('visible');\n      renderItems($input.val());\n      $dropdown.addClass('visible');\n    };\n\n    const hideDropdown = () => {\n      $dropdown.removeClass('visible');\n    };\n\n    // \n    $input.off('.acudd').on('focus.acudd click.acudd', function (e) {\n      e.stopPropagation();\n      showDropdown();\n    });\n\n    // \n    $input.on('input.acudd', function () {\n      renderItems($(this).val());\n    });\n\n    // hover  CSS :hover  JS\n\n    // \n    $dropdown.on('click', '.acu-dropdown-item', function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      const val = $(this).data('value');\n      $input.val(val).trigger('change');\n      hideDropdown();\n    });\n\n    // \n    $dropdown.on('click', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $input\n      .closest('.acu-dice-panel, .acu-contest-panel')\n      .off('click.acudd_' + inputId)\n      .on('click.acudd_' + inputId, function (e) {\n        if (!$(e.target).closest('.acu-dropdown-wrapper').length) {\n          hideDropdown();\n        }\n      });\n  };\n  // [] \n  const addClearButton = ($panel, inputSelector) => {\n    const { $ } = getCore();\n    $panel.find(inputSelector).each(function () {\n      const $input = $(this);\n      // \n      if ($input.parent().hasClass('acu-input-wrapper')) return;\n      // \n      $input.wrap('<div class=\"acu-input-wrapper\"></div>');\n      //  -  CSS \n      const $clearBtn = $(\n        `<button type=\"button\" class=\"acu-clear-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>`,\n      );\n      $input.after($clearBtn);\n      // \n      $clearBtn.on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        $input.val('').trigger('input').trigger('change').focus();\n      });\n      // hover  CSS :hover  JS\n    });\n  };\n  // [] \n  /**\n   * @deprecated  showAdvancedPresetManager() \n   */\n  const showDiceSettingsPanel = (isDND = false) => {\n    const { $ } = getCore();\n    $('.acu-dice-config-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    const ruleTitle = isDND ? 'DND ' : 'COC ';\n    const resetText = isDND ? ' DND ' : ' COC ';\n\n    // \n    const defaults = isDND\n      ? { critSuccess: 20, critFail: 1 }\n      : { critSuccess: 5, critFail: 96, hardDiv: 2, extremeDiv: 5 };\n\n    //  placeholder\n    const currentCritSuccess = isDND\n      ? diceCfg.dndCritSuccess !== undefined && diceCfg.dndCritSuccess !== defaults.critSuccess\n        ? diceCfg.dndCritSuccess\n        : ''\n      : diceCfg.critSuccessMax !== undefined && diceCfg.critSuccessMax !== defaults.critSuccess\n        ? diceCfg.critSuccessMax\n        : '';\n    const currentCritFail = isDND\n      ? diceCfg.dndCritFail !== undefined && diceCfg.dndCritFail !== defaults.critFail\n        ? diceCfg.dndCritFail\n        : ''\n      : diceCfg.critFailMin !== undefined && diceCfg.critFailMin !== defaults.critFail\n        ? diceCfg.critFailMin\n        : '';\n    const currentHardDiv =\n      !isDND && diceCfg.difficultSuccessDiv !== undefined && diceCfg.difficultSuccessDiv !== defaults.hardDiv\n        ? diceCfg.difficultSuccessDiv\n        : '';\n    const currentExtremeDiv =\n      !isDND && diceCfg.hardSuccessDiv !== undefined && diceCfg.hardSuccessDiv !== defaults.extremeDiv\n        ? diceCfg.hardSuccessDiv\n        : '';\n\n    const tieRule = diceCfg.contestTieRule || 'initiator_lose';\n    const hideDiceResultFromUser =\n      diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n    const hideDiceResultInChat = diceCfg.hideDiceResultInChat !== undefined ? diceCfg.hideDiceResultInChat : false;\n\n    const cocExtraHtml = isDND\n      ? ''\n      : `\n            <div class=\"acu-dice-cfg-row\">\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-hard-div\" data-min=\"2\" data-max=\"5\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentHardDiv || defaults.hardDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-extreme-div\" data-min=\"3\" data-max=\"10\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentExtremeDiv || defaults.extremeDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const panelHtml = `\n            <div class=\"acu-dice-config-overlay\">\n                <div class=\"acu-dice-config-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-dice-cfg-header\">\n                        <span><i class=\"fa-solid fa-cog\"></i> ${ruleTitle}</span>\n                        <button class=\"acu-config-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-dice-cfg-body\">\n                        <div class=\"acu-dice-cfg-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-success\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritSuccess || defaults.critSuccess}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-fail\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritFail || defaults.critFail}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                        ${cocExtraHtml}\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <select id=\"cfg-tie-rule\">\n                                    <option value=\"initiator_lose\" ${tieRule === 'initiator_lose' ? 'selected' : ''}> ()</option>\n                                    <option value=\"tie\" ${tieRule === 'tie' ? 'selected' : ''}></option>\n                                    <option value=\"initiator_win\" ${tieRule === 'initiator_win' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label></label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result\" ${hideDiceResultFromUser ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label></label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result-chat\" ${hideDiceResultInChat ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-actions\">\n                            <button id=\"cfg-reset-dice\">${resetText}</button>\n                            <button id=\"cfg-save-dice\"></button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $panel = $(panelHtml);\n    $('body').append($panel);\n\n    $panel.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '31300',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    const closePanel = () => $panel.remove();\n    $panel.find('.acu-config-close').click(closePanel);\n    setupOverlayClose($panel, 'acu-dice-config-overlay', closePanel);\n\n    // === Stepper  ===\n    $panel.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        $value.text(newVal);\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    $panel.find('#cfg-save-dice').click(function () {\n      const newCfg = { contestTieRule: $('#cfg-tie-rule').val() };\n\n      // stepper\n      const getStepperValue = id => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          const text = $stepper.find('.acu-stepper-value').text().replace(/[^\\d]/g, '');\n          return text !== '' ? parseInt(text, 10) : null;\n        }\n        return null;\n      };\n\n      const critSuccessVal = getStepperValue('cfg-crit-success');\n      const critFailVal = getStepperValue('cfg-crit-fail');\n\n      if (isDND) {\n        newCfg.dndCritSuccess = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.dndCritFail = critFailVal !== null ? critFailVal : defaults.critFail;\n      } else {\n        newCfg.critSuccessMax = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.critFailMin = critFailVal !== null ? critFailVal : defaults.critFail;\n\n        const hardDivVal = getStepperValue('cfg-hard-div');\n        const extremeDivVal = getStepperValue('cfg-extreme-div');\n        newCfg.difficultSuccessDiv = hardDivVal !== null ? hardDivVal : defaults.hardDiv;\n        newCfg.hardSuccessDiv = extremeDivVal !== null ? extremeDivVal : defaults.extremeDiv;\n      }\n\n      // \"\"\n      newCfg.hideDiceResultFromUser = $('#cfg-hide-dice-result').is(':checked');\n      // \"\"\n      newCfg.hideDiceResultInChat = $('#cfg-hide-dice-result-chat').is(':checked');\n\n      saveDiceConfig(newCfg);\n      // \n      console.info('[DICE]/...');\n      hideDiceResultsInUserMessages();\n      closePanel();\n    });\n\n    $panel.find('#cfg-reset-dice').click(function () {\n      // stepper\n      const resetStepper = (id, defaultValue) => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          $stepper.find('.acu-stepper-value').text(defaultValue);\n        }\n      };\n\n      resetStepper('cfg-crit-success', defaults.critSuccess);\n      resetStepper('cfg-crit-fail', defaults.critFail);\n      if (!isDND) {\n        resetStepper('cfg-hard-div', defaults.hardDiv);\n        resetStepper('cfg-extreme-div', defaults.extremeDiv);\n      }\n    });\n  };\n  // [] \n  const showDicePanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n    // 1d100\n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    // 1d100\n    if (Number.isNaN(rollComplexDiceExpression(savedDiceType).total)) {\n      savedDiceType = '1d100';\n    }\n    // [] \n    const rawDataForList = cachedRawData || getTableData();\n    let diceCharacterList: string[] = [];\n    let diceAttrList = [];\n\n    if (rawDataForList) {\n      for (const key in rawDataForList) {\n        const sheet = rawDataForList[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (isNpcTableName(sheet.name)) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) diceCharacterList.push(row[1]);\n          }\n        }\n\n        if (sheet.name?.includes('') && sheet.content[1]) {\n          const row = sheet.content[1];\n          // \n          if (row[1]) diceCharacterList.unshift(getDisplayName(String(row[1])));\n          const headers = sheet.content[0] || [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!diceAttrList.includes(attr.name)) diceAttrList.push(attr.name);\n              });\n            }\n          });\n        }\n      }\n    }\n    const {\n      targetValue = null, // []  null\n      targetName = '', //  placeholder  ''\n      attrValue = null, // [] \n      diceType = savedDiceType, // \n      successCriteria = 'lte', // [] COC\n      onResult = null,\n      initiatorName = '', // [] \n      fromMvu = false, // [] MVU\n      mvuPath = null, // [] MVU\n      mvuParsedInfo = null, // [] \n    } = options;\n\n    // [] /DC\n    const isDND = diceType === '1d20' || successCriteria === 'gte';\n    let initialAttrValue = attrValue;\n    let initialTargetValue = targetValue;\n\n    // attrValuetargetValue\n    if (attrValue !== null && targetValue === null) {\n      if (isDND) {\n        initialTargetValue = Math.max(0, 20 - attrValue);\n      } else {\n        initialTargetValue = attrValue;\n      }\n    }\n\n    const overlay = $(`<div class=\"acu-dice-overlay\"></div>`);\n\n    // []  COC  DND\n    const successCriteriaOptions = [\n      { id: 'lte', name: ' (COC)' },\n      { id: 'gte', name: ' (DND)' },\n    ];\n\n    // [] \n    let defaultCriteria = successCriteria;\n    if (diceType === '1d100') defaultCriteria = 'lte';\n    else if (diceType === '1d20') defaultCriteria = 'gte';\n\n    // [] \n    const quickPresetsHtml = (() => {\n      const presets = AdvancedDicePresetManager.getAllPresets()\n        .filter(p => p.visible !== false) // \n        .sort((a, b) => (a.order || 0) - (b.order || 0));\n\n      let html = `<div class=\"acu-dice-quick-section\" style=\"margin-bottom: 8px;\">`;\n      html += `<div class=\"acu-dice-section-title\"><span><i class=\"fa-solid fa-sliders\"></i> <div id=\"dice-preset-quick-actions\" class=\"acu-dice-preset-quick-actions\"></div></span></div>`;\n\n      // 1. \n      html += `<div class=\"acu-dice-quick-presets\" id=\"dice-normal-presets\">`;\n      // \n      html += `<button class=\"acu-dice-quick-preset-btn\" data-id=\"__custom__\"></button>`;\n\n      presets.forEach(p => {\n        html += `<button class=\"acu-dice-quick-preset-btn\" data-id=\"${escapeHtml(p.id)}\">${escapeHtml(p.name)}</button>`;\n      });\n      html += `</div>`;\n\n      // 2. \n      html += `<div id=\"dice-workflow-return-container\" style=\"display: none;\">\n        <button class=\"acu-dice-return-btn\" id=\"dice-return-normal-btn\">\n            <i class=\"fa-solid fa-arrow-left\"></i> \n        </button>\n      </div>`;\n\n      html += `</div>`;\n      return html;\n    })();\n\n    const panel = $(`\n            <div class=\"acu-dice-panel acu-theme-${config.theme}\">\n                <div class=\"acu-dice-panel-header\">\n                    <div class=\"acu-dice-panel-title\">\n                        <i class=\"fa-solid fa-dice-d20\"></i> \n                    </div>\n                    <div class=\"acu-dice-panel-actions\">\n                        <button id=\"dice-switch-contest-top\" title=\"\"><i class=\"fa-solid fa-people-arrows\"></i></button>\n                        <button id=\"dice-history-btn\" title=\"\"><i class=\"fa-solid fa-history\"></i></button>\n                        <button class=\"acu-dice-config-btn\" title=\"\">\n                            <i class=\"fa-solid fa-cog\"></i>\n                        </button>\n                        <button class=\"acu-dice-close\">\n                            <i class=\"fa-solid fa-times\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div class=\"acu-dice-panel-body\">\n                    ${quickPresetsHtml}\n\n                    <!--  -->\n                    <div class=\"acu-dice-quick-section\">\n                        <div class=\"acu-dice-section-title\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"dice-char-buttons\" class=\"acu-dice-quick-inline\"></div></div>\n                    </div>\n\n                    <!-- 1 +  -->\n                    <div class=\"acu-dice-form-row cols-2\" id=\"dice-row-1\">\n                        <div id=\"dice-name-wrapper\">\n                            <div class=\"acu-dice-form-label\"></div>\n                            <input type=\"text\" id=\"dice-initiator-name\" class=\"acu-dice-input\" value=\"${escapeHtml(initiatorName)}\" placeholder=\"<user>\">\n                        </div>\n                        <div id=\"dice-attr-name-wrapper\">\n                            <div class=\"acu-dice-form-label\" id=\"dice-attr-name-label\">\n                                <span class=\"dice-attr-name-text\"></span>\n                                <button type=\"button\" class=\"acu-random-skill-btn\" id=\"dice-random-skill\" title=\"\">\n                                    <i class=\"fa-solid fa-dice\"></i>\n                                </button>\n                            </div>\n                            <input type=\"text\" id=\"dice-attr-name\" class=\"acu-dice-input\" value=\"${escapeHtml(targetName || '')}\" placeholder=\"\">\n                        </div>\n                    </div>\n\n                    <!-- 2 +  +  -->\n                    <div class=\"acu-dice-form-row cols-2\" id=\"dice-row-2\">\n                        <div id=\"dice-attr-wrapper\">\n                            <div class=\"acu-dice-form-label\" id=\"dice-attr-label\"></div>\n                            <input type=\"text\" id=\"dice-attr-value\" class=\"acu-dice-input\" value=\"${initialAttrValue !== null ? initialAttrValue : ''}\" placeholder=\"=50%\">\n                        </div>\n                        <div id=\"dice-skill-mod-wrapper\" style=\"display: none;\">\n                            <div class=\"acu-dice-form-label\" id=\"dice-skill-mod-label\"></div>\n                            <input type=\"text\" id=\"dice-skill-mod\" class=\"acu-dice-input\" placeholder=\"=0\">\n                        </div>\n                        <div id=\"dice-target-wrapper\">\n                            <div class=\"acu-dice-form-label\" id=\"dice-target-label\"></div>\n                            <input type=\"text\" id=\"dice-target\" class=\"acu-dice-input\" value=\"${initialTargetValue !== null ? initialTargetValue : ''}\" placeholder=\"=\">\n                        </div>\n                    </div>\n\n                    <!-- 3 +  +  () -->\n                    <div class=\"acu-dice-form-row cols-3\" id=\"dice-row-3\">\n                        <div>\n                            <div class=\"acu-dice-form-label centered\"></div>\n                            <select id=\"dice-success-criteria\" class=\"acu-dice-select\">\n                                ${successCriteriaOptions\n                                  .map(\n                                    opt =>\n                                      `<option value=\"${opt.id}\" ${opt.id === defaultCriteria ? 'selected' : ''}>${opt.name}</option>`,\n                                  )\n                                  .join('')}\n                            </select>\n                        </div>\n                        <div id=\"dice-difficulty-wrapper\">\n                            <div class=\"acu-dice-form-label centered\"></div>\n                            <select id=\"dice-difficulty\" class=\"acu-dice-select\">\n                                <option value=\"normal\" selected></option>\n                                <option value=\"hard\"></option>\n                                <option value=\"extreme\"></option>\n                                <option value=\"critical\"></option>\n                            </select>\n                        </div>\n                        <div id=\"dice-mod-wrapper\">\n                            <div class=\"acu-dice-form-label\" id=\"dice-mod-label\"></div>\n                            <input type=\"text\" id=\"dice-modifier\" class=\"acu-dice-input\" placeholder=\"=0\">\n                        </div>\n                    </div>\n\n                    <!-- []  () -->\n                    <div id=\"dice-custom-fields-area\"></div>\n\n                    <!-- []  -->\n                    <div id=\"acu-dice-custom-mode-fields\" style=\"display: none; margin-top: 8px;\">\n                        <div class=\"acu-dice-form-row cols-3\">\n                            <div>\n                                <div class=\"acu-dice-form-label\"></div>\n                                <input type=\"text\" id=\"custom-dice-expr\" class=\"acu-dice-input\" value=\"${escapeHtml(diceCfg.customDiceExpr || '')}\" placeholder=\"1d100,2d6+3...\">\n                            </div>\n                            <div>\n                                <div class=\"acu-dice-form-label\"></div>\n                                <select id=\"custom-judge-mode\" class=\"acu-dice-select\">\n                                    <option value=\">=\">>=</option>\n                                    <option value=\"<=\" selected><=</option>\n                                    <option value=\">\">&gt;</option>\n                                    <option value=\"<\">&lt;</option>\n                                    <option value=\"none\"></option>\n                                </select>\n                            </div>\n                            <div>\n                                <div class=\"acu-dice-form-label\"></div>\n                                <input type=\"text\" id=\"custom-target-value\" class=\"acu-dice-input\" placeholder=\"=50%\">\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div id=\"dice-attr-buttons\" class=\"acu-dice-quick-compact\"></div>\n\n                    <!--  -->\n                    <input type=\"hidden\" id=\"dice-formula\" value=\"${diceType}\">\n\n                    <button id=\"dice-roll-btn\" class=\"acu-dice-roll-btn\">\n                        <i class=\"fa-solid fa-dice\"></i> \n                    </button>\n                </div>\n            </div>\n        `);\n\n    overlay.append(panel);\n    $('body').append(overlay);\n    const effectRunCleanerTimerKey = '__acuEffectRunCleanerTimer';\n\n    const expandedTraceRunIds = new Set<string>();\n    let historyFilterStatus = 'all';\n    let historyKeyword = '';\n    let historyStatsScope: DiceStatsScope = 'chat';\n\n    const renderDiceHistoryItems = (): string => {\n      type HistoryItem =\n        | (CheckHistoryEntry & { historyType: 'check' })\n        | ((AcuDice.ContestResult & { timestamp: number; detailId?: string; detailLines?: string[] }) & {\n            historyType: 'contest';\n          });\n\n      const mergedItems: HistoryItem[] = [\n        ...checkHistory.map(item => ({ ...item, historyType: 'check' as const })),\n        ...contestHistory.map(item => ({ ...item, historyType: 'contest' as const })),\n      ]\n        .sort((a, b) => b.timestamp - a.timestamp)\n        .filter(item => {\n          if (historyFilterStatus !== 'all') {\n            const status = String((item as Record<string, unknown>).effectStatus || '');\n            if (!status || status !== historyFilterStatus) return false;\n          }\n          const keyword = historyKeyword.trim().toLowerCase();\n          if (!keyword) return true;\n          const raw = item as Record<string, unknown>;\n          const haystack = [\n            raw.attrName,\n            raw.message,\n            raw.outcomeText,\n            raw.effectStatus,\n            raw.initiatorName,\n            raw['left'] && typeof raw['left'] === 'object' ? (raw['left'] as Record<string, unknown>).name : undefined,\n            raw['right'] && typeof raw['right'] === 'object'\n              ? (raw['right'] as Record<string, unknown>).name\n              : undefined,\n          ]\n            .map(text => String(text || '').toLowerCase())\n            .join(' ');\n          return haystack.includes(keyword);\n        })\n        .slice(0, 80);\n\n      if (mergedItems.length === 0) {\n        return `<div style=\"padding: 24px 12px; color: var(--acu-text-sub); text-align: center; display:flex; flex-direction:column; align-items:center; gap:8px;\"><i class=\"fa-solid fa-dice-d20\" style=\"font-size:22px; opacity:.35;\"></i><span></span></div>`;\n      }\n\n      const statusTextMap: Record<string, string> = {\n        planned: '',\n        confirmed: '',\n        committed: '',\n        failed: '',\n        cancelled: '',\n      };\n      const statusColorMap: Record<string, string> = {\n        planned: 'var(--acu-text-sub)',\n        confirmed: 'var(--acu-accent)',\n        committed: 'var(--acu-success-text)',\n        failed: 'var(--acu-error-text)',\n        cancelled: 'var(--acu-text-sub)',\n      };\n\n      return mergedItems\n        .map(item => {\n          const raw = item as Record<string, unknown>;\n          const isContest = item.historyType === 'contest';\n          const status = String(raw.effectStatus || '');\n          const statusText = status ? statusTextMap[status] || status : '';\n          const statusColor = status ? statusColorMap[status] || 'var(--acu-text-sub)' : 'var(--acu-text-sub)';\n\n          const detailId = String(\n            raw.detailId ||\n              raw.effectRunId ||\n              `${item.historyType}-${item.timestamp}-${String(raw.attrName || raw.message || '')}`,\n          );\n          const traceLines = Array.isArray(raw.effectTrace) ? (raw.effectTrace as string[]) : [];\n          const detailLines = Array.isArray(raw.detailLines) ? (raw.detailLines as string[]) : [];\n          const canExpand = detailLines.length > 0 || traceLines.length > 0;\n          const isExpanded = canExpand && expandedTraceRunIds.has(detailId);\n\n          let title = String(raw.attrName || '');\n          let subtitle = '';\n          let resultColor = raw.success ? 'var(--acu-success-text)' : 'var(--acu-error-text)';\n          let rollText = `${String(raw.total ?? '-')}/${String(raw.target ?? '-')}`;\n          let metaTag = isContest ? '' : '';\n\n          if (isContest) {\n            const left = (raw.left || {}) as Record<string, unknown>;\n            const right = (raw.right || {}) as Record<string, unknown>;\n            title = `${String(left.name || '')} vs ${String(right.name || '')}`;\n            subtitle = String(raw.message || '');\n            const winner = String(raw.winner || 'tie');\n            resultColor = winner === 'tie' ? 'var(--acu-text-sub)' : 'var(--acu-accent)';\n            rollText = `${String(left.roll ?? '-')}:${String(right.roll ?? '-')}`;\n          } else {\n            const initiatorName = String(raw.initiatorName || '').trim();\n            if (initiatorName) {\n              title = `${initiatorName}  ${title}`;\n            }\n            subtitle = String(raw.outcomeText || (raw.success ? '' : ''));\n          }\n\n          const pushedBadge = raw.isPushed\n            ? '<i class=\"fa-solid fa-skull\" style=\"font-size:10px;color:var(--acu-text-sub);margin-left:4px;\" title=\"\"></i>'\n            : '';\n          const expandBtn = canExpand\n            ? `<button class=\"acu-history-trace-toggle\" data-run-id=\"${escapeHtml(detailId)}\" style=\"border:none;background:transparent;color:var(--acu-text-sub);cursor:pointer;padding:2px 4px;font-size:13px;\" title=\"${isExpanded ? '' : ''}\">${isExpanded ? '' : ''}</button>`\n            : '';\n          const detailHtml =\n            canExpand && isExpanded\n              ? `<div style=\"margin-top:8px; padding:9px 10px; background: color-mix(in srgb, var(--acu-card-bg) 70%, transparent); border:1px solid var(--acu-border); border-radius:6px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:11px; line-height:1.5; color:var(--acu-text-sub); white-space: pre-wrap;\">\n                   ${detailLines.length > 0 ? `<div style=\"font-weight:700; color:var(--acu-text-main); margin-bottom:4px;\"></div>${detailLines.map(line => escapeHtml(line)).join('<br>')}` : ''}\n                   ${detailLines.length > 0 && traceLines.length > 0 ? '<div style=\"height:1px; background:var(--acu-border); margin:7px 0;\"></div>' : ''}\n                   ${traceLines.length > 0 ? `<div style=\"font-weight:700; color:var(--acu-text-main); margin-bottom:4px;\"></div>${traceLines.map(line => escapeHtml(line)).join('<br>')}` : ''}\n                 </div>`\n              : '';\n\n          return `\n            <div style=\"padding: 10px 12px; border:1px solid var(--acu-border); border-radius:8px; margin-bottom:8px; background:var(--acu-bg-panel);\">\n              <div style=\"display:flex; justify-content:space-between; align-items:flex-start; gap:8px;\">\n                <div style=\"min-width:0; flex:1;\">\n                  <div style=\"display:flex; align-items:center; gap:6px;\">\n                    <span style=\"font-size:10px; color:var(--acu-text-sub); border:1px solid var(--acu-border); border-radius:999px; padding:1px 6px;\">${metaTag}</span>\n                    <span style=\"font-weight:700; color:var(--acu-text-main); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;\">${escapeHtml(title)}${pushedBadge}</span>\n                  </div>\n                  <div style=\"margin-top:6px; display:flex; align-items:center; gap:8px; flex-wrap:wrap; font-size:12px;\">\n                    <span style=\"color:${resultColor}; font-weight:700;\">${escapeHtml(subtitle)}</span>\n                    <span style=\"color:var(--acu-text-sub); font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;\">${escapeHtml(rollText)}</span>\n                    ${statusText ? `<span style=\"color:${statusColor}; border:1px solid color-mix(in srgb, ${statusColor} 40%, transparent); border-radius:999px; padding:1px 7px; font-size:11px;\">:${statusText}</span>` : ''}\n                  </div>\n                </div>\n                <div style=\"display:flex; align-items:center; gap:4px; flex-shrink:0;\">\n                  <span style=\"font-size:12px; color:var(--acu-text-sub);\">${new Date(item.timestamp).toLocaleTimeString('zh-CN', { hour12: false })}</span>\n                  ${expandBtn}\n                </div>\n              </div>\n              ${detailHtml}\n            </div>\n          `;\n        })\n        .join('');\n    };\n\n    const showDiceHistoryDialog = () => {\n      $('.acu-dice-history-overlay').remove();\n      const currentThemeClass = `acu-theme-${config.theme}`;\n      const dialog = $(`\n        <div class=\"acu-edit-overlay acu-dice-history-overlay\">\n          <div class=\"acu-edit-dialog ${currentThemeClass}\" style=\"max-width: 600px; width: min(94vw,600px); max-height: 82vh; display:flex; flex-direction:column; padding:14px;\">\n            <div style=\"display:flex; justify-content:space-between; align-items:center; padding-bottom:8px; border-bottom:1px solid var(--acu-border);\">\n              <div style=\"font-size: 19px; color: var(--acu-text-main); font-weight:700; display:flex; align-items:center; gap:8px;\"><i class=\"fa-solid fa-clock-rotate-left\" style=\"color:var(--acu-accent);\"></i> </div>\n              <button class=\"acu-close-btn acu-history-close\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n            <div style=\"display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:8px; margin-top:10px; align-items:center;\">\n              <select id=\"acu-history-scope-filter\" class=\"acu-dice-select\" style=\"width:100%; min-width:0;\">\n                <option value=\"chat\"></option>\n                <option value=\"character\"></option>\n                <option value=\"global\"></option>\n              </select>\n              <select id=\"acu-history-status-filter\" class=\"acu-dice-select\" style=\"width:100%; min-width:0;\">\n                <option value=\"all\"></option>\n                <option value=\"planned\"></option>\n                <option value=\"confirmed\"></option>\n                <option value=\"committed\"></option>\n                <option value=\"failed\"></option>\n                <option value=\"cancelled\"></option>\n              </select>\n              <div style=\"position:relative; min-width:0;\">\n                <i class=\"fa-solid fa-search\" style=\"position:absolute; left:10px; top:50%; transform:translateY(-50%); font-size:12px; color:var(--acu-text-sub);\"></i>\n                <input id=\"acu-history-search\" class=\"acu-dice-input\" style=\"width:100%; padding-left:28px;\" placeholder=\"\" value=\"${escapeHtml(historyKeyword)}\">\n              </div>\n            </div>\n            <div id=\"acu-dice-history-stats\" style=\"margin-top:8px; padding:10px; border:1px solid var(--acu-border); border-radius:8px; background:var(--acu-card-bg);\">\n              <div style=\"color:var(--acu-text-sub); font-size:12px;\">...</div>\n            </div>\n            <div id=\"acu-dice-history-list\" style=\"margin-top:8px; overflow-y:auto; flex:1; min-height:220px; max-height:52vh; -webkit-overflow-scrolling:touch; overscroll-behavior:contain; touch-action:pan-y;\">\n              ${renderDiceHistoryItems()}\n            </div>\n            <div style=\"display:flex; justify-content:space-between; gap:8px; padding-top:10px; border-top:1px solid var(--acu-border); margin-top:8px;\">\n              <button class=\"acu-dialog-btn\" id=\"acu-history-clear\" style=\"background:var(--acu-btn-bg); border-color:var(--acu-border);\"><i class=\"fa-solid fa-trash\"></i> </button>\n              <button class=\"acu-dialog-btn acu-history-close\"><i class=\"fa-solid fa-times\"></i> </button>\n            </div>\n          </div>\n        </div>\n      `);\n      $('body').append(dialog);\n\n      const renderHistoryStats = async () => {\n        const $stats = dialog.find('#acu-dice-history-stats');\n        if ($stats.length === 0) return;\n\n        const allStats = await DiceHistoryStatsDB.getDashboardStats();\n        const activeStats = allStats[historyStatsScope];\n        const context = getDiceStatsContext();\n        const scopeLabelMap: Record<DiceStatsScope, string> = {\n          chat: '',\n          character: '',\n          global: '',\n        };\n        const scopeUnavailable =\n          (historyStatsScope === 'chat' && context.chatId === 'unknown_chat') ||\n          (historyStatsScope === 'character' && context.characterId === 'unknown_character');\n\n        $stats.html(`\n          <div style=\"display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:8px; margin-bottom:8px;\">\n            <div style=\"padding:8px; border:1px solid var(--acu-border); border-radius:6px;\">\n              <div style=\"font-size:11px; color:var(--acu-text-sub);\"></div>\n              <div style=\"font-size:18px; font-weight:700; color:var(--acu-text-main);\">${allStats.chat.total}</div>\n            </div>\n            <div style=\"padding:8px; border:1px solid var(--acu-border); border-radius:6px;\">\n              <div style=\"font-size:11px; color:var(--acu-text-sub);\"></div>\n              <div style=\"font-size:18px; font-weight:700; color:var(--acu-text-main);\">${allStats.character.total}</div>\n            </div>\n            <div style=\"padding:8px; border:1px solid var(--acu-border); border-radius:6px;\">\n              <div style=\"font-size:11px; color:var(--acu-text-sub);\"></div>\n              <div style=\"font-size:18px; font-weight:700; color:var(--acu-text-main);\">${allStats.global.total}</div>\n            </div>\n          </div>\n          <div style=\"display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; font-size:12px;\">\n            <div style=\"color:var(--acu-text-sub);\">${scopeLabelMap[historyStatsScope]}</div>\n            <div style=\"display:flex; gap:10px; flex-wrap:wrap;\">\n              <span style=\"color:var(--acu-text-main);\"><b>${activeStats.total}</b></span>\n              <span style=\"color:var(--acu-text-main);\"><b>${activeStats.checks}</b></span>\n              <span style=\"color:var(--acu-text-main);\"><b>${activeStats.contests}</b></span>\n              <span style=\"color:var(--acu-text-main);\"><b style=\"color:var(--acu-success-text);\">${activeStats.checkSuccessRate}%</b></span>\n            </div>\n          </div>\n          ${scopeUnavailable ? '<div style=\"margin-top:6px; font-size:11px; color:var(--acu-text-sub);\">ID</div>' : ''}\n        `);\n      };\n\n      const rerender = () => {\n        dialog.find('#acu-dice-history-list').html(renderDiceHistoryItems());\n        void renderHistoryStats();\n      };\n      dialog.find('#acu-history-status-filter').val(historyFilterStatus);\n      dialog.find('#acu-history-scope-filter').val(historyStatsScope);\n\n      const refreshByEvent = () => rerender();\n      const canListen = Boolean(window.AcuDice && typeof window.AcuDice.on === 'function');\n      if (canListen) {\n        window.AcuDice.on('check', refreshByEvent);\n        window.AcuDice.on('contest', refreshByEvent);\n        window.AcuDice.on('effect_run', refreshByEvent);\n      }\n\n      void renderHistoryStats();\n\n      dialog.on('change', '#acu-history-scope-filter', function () {\n        const val = String($(this).val() || 'chat') as DiceStatsScope;\n        historyStatsScope = val === 'character' || val === 'global' ? val : 'chat';\n        void renderHistoryStats();\n      });\n\n      dialog.on('change', '#acu-history-status-filter', function () {\n        historyFilterStatus = String($(this).val() || 'all');\n        rerender();\n      });\n\n      dialog.on('input', '#acu-history-search', function () {\n        historyKeyword = String($(this).val() || '');\n        rerender();\n      });\n\n      dialog.on('touchstart touchmove', '#acu-dice-history-list', function (e) {\n        e.stopPropagation();\n      });\n\n      dialog.on('click', '.acu-history-trace-toggle', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const runId = String($(this).data('run-id') || '');\n        if (!runId) return;\n        if (expandedTraceRunIds.has(runId)) expandedTraceRunIds.delete(runId);\n        else expandedTraceRunIds.add(runId);\n        rerender();\n      });\n\n      dialog.on('click', '#acu-history-clear', async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const ok = window.confirm('');\n        if (!ok) return;\n\n        checkHistory.length = 0;\n        contestHistory.length = 0;\n        expandedTraceRunIds.clear();\n        await DiceHistoryStatsDB.clear();\n        rerender();\n        if (window.toastr) window.toastr.success('');\n      });\n\n      const closeDialog = () => {\n        if (canListen) {\n          window.AcuDice.off('check', refreshByEvent);\n          window.AcuDice.off('contest', refreshByEvent);\n          window.AcuDice.off('effect_run', refreshByEvent);\n        }\n        dialog.remove();\n      };\n      dialog.on('click', '.acu-history-close', closeDialog);\n      setupOverlayClose(dialog, 'acu-dice-history-overlay', closeDialog);\n    };\n\n    // [] \n    const buildCharButtons = () => {\n      const $container = panel.find('#dice-char-buttons');\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.initiator) {\n        const initiator = mvuParsedInfo.initiator;\n        const shortName = initiator.length > 4 ? initiator.substring(0, 4) + '..' : initiator;\n        html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu\" data-char=\"${escapeHtml(initiator)}\" title=\": ${escapeHtml(initiator)}\">${escapeHtml(shortName)}</button>`;\n      }\n\n      //  <user>\n      diceCharacterList.forEach(name => {\n        const resolvedName = NameAliasRegistry.resolve(String(name));\n        const displayName = replaceUserPlaceholders(String(resolvedName));\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html += `<button class=\"acu-dice-char-btn\" data-char=\"${escapeHtml(String(resolvedName))}\" title=\"${escapeHtml(displayName)}\">${escapeHtml(shortName)}</button>`;\n      });\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.candidates && mvuParsedInfo.candidates.length > 0) {\n        mvuParsedInfo.candidates.forEach(candidate => {\n          // \n          if (mvuParsedInfo.initiator && candidate === mvuParsedInfo.initiator) return;\n          const shortName = candidate.length > 4 ? candidate.substring(0, 4) + '..' : candidate;\n          html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu-candidate\" data-char=\"${escapeHtml(candidate)}\" title=\": ${escapeHtml(candidate)}\">${escapeHtml(shortName)}</button>`;\n        });\n      }\n\n      $container.html(html || `<div class=\"acu-dice-empty-hint\"></div>`);\n      // \n      $container.find('.acu-dice-char-btn').click(function () {\n        const charName = $(this).data('char');\n        panel.find('#dice-initiator-name').val(charName).trigger('change');\n      });\n    };\n\n    // [] \n    const buildAttrButtons = charName => {\n      const $container = panel.find('#dice-attr-buttons');\n      const $parentSection = $container.parent(); // \n      const attrs = getFullAttributesForCharacter(charName);\n\n      // \n      $parentSection.show();\n\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.attrName) {\n        const attrName = mvuParsedInfo.attrName;\n        // \n        const attrValue = getAttributeValue(charName, attrName) || targetValue || '';\n        if (attrValue) {\n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"${attrValue}\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}:${attrValue}</button>`;\n        } else {\n          // \n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}</button>`;\n        }\n      }\n\n      // \n      attrs.forEach(attr => {\n        html += `<button class=\"acu-dice-attr-btn\" data-name=\"${escapeHtml(attr.name)}\" data-value=\"${attr.value}\">${escapeHtml(attr.name)}:${attr.value}</button>`;\n      });\n\n      // \n      html += `<button class=\"acu-dice-gen-attr-btn\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>`;\n\n      // \n      html += `<button class=\"acu-dice-clear-attr-btn\" title=\"\"><i class=\"fa-solid fa-trash-alt\"></i></button>`;\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-dice-attr-btn').click(function () {\n        const attrName = $(this).data('name');\n        const attrValue = $(this).data('value');\n\n        // \n        //  change \n        const $attrNameInput = panel.find('#dice-attr-name');\n        $attrNameInput.val(attrName).trigger('change');\n\n        // []  attrTargetMapping \n        let targetField = '#dice-attr-value'; // \n        if (currentAdvancedPreset?.attrTargetMapping) {\n          for (const [fieldId, names] of Object.entries(currentAdvancedPreset.attrTargetMapping)) {\n            if (Array.isArray(names) && names.includes(attrName)) {\n              if (fieldId === 'skillMod') {\n                targetField = '#dice-skill-mod';\n              } else if (fieldId === 'mod') {\n                targetField = '#dice-modifier';\n              } else if (fieldId === 'attribute') {\n                targetField = '#dice-attr-value';\n              }\n              //  customField.id \n              break;\n            }\n          }\n        }\n\n        panel.find(targetField).val(attrValue);\n\n        // [] ,\n        if (panel.find('#acu-dice-custom-mode-fields').is(':visible')) {\n          panel.find('#custom-target-value').val(attrValue);\n        }\n\n        // [] DC\n        // DCdefaultValue\n        // - COCDC = \n        // - DNDDC = 10\n\n        // changeUI\n        panel.find(targetField).trigger('change');\n      });\n\n      // \n      $container.find('.acu-dice-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n          console.log('[DICE]ACU  for:', charName);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // [] \n          const result = await writeAttributesToCharacter(charName, baseAttrs, false, specialAttrs);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-dice-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharButtons();\n    // \n    buildAttrButtons(diceCharacterList[0] || '<user>');\n    // [] \n    panel.find('#dice-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#dice-attr-name').val(randomSkill).trigger('change');\n    });\n\n    // \n    initCustomDropdown(panel.find('#dice-initiator-name'), diceCharacterList);\n    initCustomDropdown(panel.find('#dice-attr-name'), diceAttrList);\n    // [] \n    addClearButton(\n      panel,\n      '#dice-initiator-name, #dice-attr-name, #dice-attr-value, #dice-skill-mod, #dice-target, #dice-modifier, #custom-dice-expr, #custom-target-value',\n    );\n\n    // [] \n    panel.find('#dice-initiator-name').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#dice-attr-name'), newAttrList.length > 0 ? newAttrList : diceAttrList);\n\n      // [] \n      buildAttrButtons(charName);\n    });\n\n    // [] \n    panel.find('#dice-attr-name').on('change.acuval', function () {\n      const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#dice-attr-value').val(attrValue);\n        // [] DCdefaultValue\n      }\n    });\n\n    // [] \n    const convertTargetForDice = (currentTarget, fromDice, toDice) => {\n      if (!currentTarget || currentTarget === '') return '';\n      const val = parseInt(currentTarget, 10);\n      if (isNaN(val)) return currentTarget;\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n\n      const fromMax = getMaxRoll(fromDice);\n      const toMax = getMaxRoll(toDice);\n\n      // \n      const ratio = val / fromMax;\n      const newVal = Math.round(ratio * toMax);\n      return Math.max(0, Math.min(newVal, toMax));\n    };\n\n    // []  UICOC/DND \n    const updateRuleMode = () => {\n      const criteria = panel.find('#dice-success-criteria').val();\n      const isDND = criteria === 'gte';\n      const $targetInput = panel.find('#dice-target');\n      const $difficultyWrapper = panel.find('#dice-difficulty-wrapper');\n      const $row3 = panel.find('#dice-row-3');\n\n      if (isDND) {\n        // DND \n        $targetInput.attr('placeholder', '=10');\n        panel.find('#dice-target-label').text('DC');\n        $difficultyWrapper.hide();\n        $row3.css('grid-template-columns', '1fr 1fr');\n      } else {\n        // COC \n        $targetInput.attr('placeholder', '=');\n        panel.find('#dice-target-label').text('');\n        $difficultyWrapper.show();\n        $row3.css('grid-template-columns', '1fr 1fr 1fr');\n      }\n    };\n\n    panel.find('#dice-success-criteria').on('change', updateRuleMode);\n\n    // \n    updateRuleMode();\n\n    // []  ()\n    let currentAdvancedPreset: AdvancedDicePreset | LegacyAdvancedDicePreset | null = null;\n    let lastVisiblePresetId: string | null = null;\n    let pendingEffectRuns: PendingEffectContext[] = [];\n    let activeConfirmEffectRun: PendingEffectContext | null = null;\n    let effectRunRetryTimer: ReturnType<typeof setTimeout> | null = null;\n    let effectRunEventSeq = 0;\n    const EFFECT_RUN_TTL_MS = 60_000;\n    const EFFECT_RUN_FALLBACK_WINDOW_MS = 2_500;\n    const messageMutationQueues = new Map<number, Promise<unknown>>();\n\n    const getPresetQuickActions = (\n      preset: AdvancedDicePreset | LegacyAdvancedDicePreset | null,\n    ): PresetQuickAction[] => {\n      if (!preset || !('quickActions' in preset) || !Array.isArray(preset.quickActions)) return [];\n      return preset.quickActions.filter((action): action is PresetQuickAction =>\n        Boolean(action && typeof action.id === 'string' && typeof action.kind === 'string'),\n      );\n    };\n\n    const buildQuickActionContext = (): Record<string, number> => {\n      const attrRaw = String(panel.find('#dice-attr-value').val() || '').trim();\n      const modRaw = String(panel.find('#dice-modifier').val() || '').trim();\n      const targetRaw = String(panel.find('#dice-target').val() || '').trim();\n      const attr = attrRaw === '' ? 0 : parseFloat(attrRaw) || 0;\n      const mod = modRaw === '' ? 0 : parseFloat(modRaw) || 0;\n      const dc = targetRaw === '' ? 0 : parseFloat(targetRaw) || 0;\n      return {\n        $attr: attr,\n        $mod: mod,\n        $dc: dc,\n      };\n    };\n\n    const isQuickActionVisible = (action: PresetQuickAction): boolean => {\n      if (!action.condition) return true;\n      const evalResult = evaluateCondition(action.condition, buildQuickActionContext());\n      if (!evalResult.success) return false;\n      return typeof evalResult.value === 'number' ? evalResult.value !== 0 : Boolean(evalResult.value);\n    };\n\n    const renderPresetQuickActions = (preset: AdvancedDicePreset | LegacyAdvancedDicePreset | null): void => {\n      const $container = panel.find('#dice-preset-quick-actions');\n      if (!$container.length) return;\n      const actions = getPresetQuickActions(preset).filter(isQuickActionVisible);\n      if (actions.length === 0) {\n        $container.empty().hide();\n        return;\n      }\n      let html = '';\n      actions.forEach(action => {\n        const icon = action.icon || 'fa-bolt';\n        const tooltip = action.tooltip || action.id;\n        html += `<button type=\"button\" class=\"acu-dice-preset-action-btn\" data-action-id=\"${escapeHtml(action.id)}\" title=\"${escapeHtml(tooltip)}\"><i class=\"fa-solid ${escapeHtml(icon)}\"></i></button>`;\n      });\n      $container.html(html).show();\n    };\n\n    const waitMs = (ms: number): Promise<void> => {\n      return new Promise(resolve => {\n        setTimeout(resolve, ms);\n      });\n    };\n\n    const enqueueMessageMutation = async <T>(messageId: number, task: () => Promise<T>): Promise<T> => {\n      const prev = messageMutationQueues.get(messageId) || Promise.resolve();\n      const next: Promise<T> = prev.catch(() => undefined).then(task);\n      messageMutationQueues.set(messageId, next);\n      try {\n        return await next;\n      } finally {\n        if (messageMutationQueues.get(messageId) === next) {\n          messageMutationQueues.delete(messageId);\n        }\n      }\n    };\n\n    const injectEffectLinesIntoMeta = async (messageId: number, runId: string, lines: string[]): Promise<boolean> => {\n      if (lines.length === 0) return false;\n      console.info(`[DICE][META] inject start: run=${runId}, message=${messageId}, lines=${lines.length}`);\n      return enqueueMessageMutation(messageId, async () => {\n        const retryDelays = [0, 120, 280, 500, 900];\n        for (let attempt = 0; attempt < retryDelays.length; attempt++) {\n          const delay = retryDelays[attempt];\n          if (delay > 0) await waitMs(delay);\n\n          const msgs = getChatMessages(messageId);\n          if (msgs.length === 0) {\n            console.info(\n              `[DICE][META] inject retry=${attempt + 1}/${retryDelays.length}: message not found, run=${runId}, message=${messageId}`,\n            );\n            continue;\n          }\n\n          const msg = msgs[0];\n          const msgRole = (msg as { role?: string }).role || 'unknown';\n          const extraObj: Record<string, unknown> =\n            msg.extra && typeof msg.extra === 'object' ? (msg.extra as Record<string, unknown>) : {};\n          const injectedRunsRaw = extraObj.acuEffectInjectedRuns;\n          const injectedRuns = Array.isArray(injectedRunsRaw)\n            ? injectedRunsRaw.filter((v): v is string => typeof v === 'string')\n            : [];\n          if (injectedRuns.includes(runId)) {\n            console.info(`[DICE][META] inject skipped duplicated run: run=${runId}, message=${messageId}`);\n            return true;\n          }\n\n          const original = String(msg.message || '');\n          const closingCandidates = ['</meta:>', '&lt;/meta:&gt;', '&amp;lt;/meta:&amp;gt;'];\n          let closingIdx = -1;\n          let closingTag = '';\n          for (const candidate of closingCandidates) {\n            const idx = original.lastIndexOf(candidate);\n            if (idx > closingIdx) {\n              closingIdx = idx;\n              closingTag = candidate;\n            }\n          }\n          if (closingIdx === -1) {\n            const hasRawOpen = original.includes('<meta:>');\n            const hasRawClose = original.includes('</meta:>');\n            const hasEscapedOpen = original.includes('&lt;meta:&gt;');\n            const hasEscapedClose = original.includes('&lt;/meta:&gt;');\n            console.info(\n              `[DICE][META] inject retry=${attempt + 1}/${retryDelays.length}: closing tag not found, run=${runId}, message=${messageId}, role=${msgRole}, length=${original.length}, rawOpen=${hasRawOpen}, rawClose=${hasRawClose}, escapedOpen=${hasEscapedOpen}, escapedClose=${hasEscapedClose}`,\n            );\n            continue;\n          }\n\n          const beforeClose = original.slice(0, closingIdx);\n          const needsLeadingNewline = beforeClose.length > 0 && !beforeClose.endsWith('\\n');\n          const effectBlock = `${needsLeadingNewline ? '\\n' : ''}${lines.join('\\n')}`;\n          const updatedMsg = beforeClose + effectBlock + '\\n' + original.slice(closingIdx);\n          console.info(\n            `[DICE][META] inject apply: run=${runId}, message=${messageId}, role=${msgRole}, attempt=${attempt + 1}, oldLen=${original.length}, newLen=${updatedMsg.length}, closingIdx=${closingIdx}, closingTag=${closingTag}`,\n          );\n          await setChatMessages(\n            [\n              {\n                message_id: messageId,\n                message: updatedMsg,\n                extra: {\n                  ...extraObj,\n                  acuEffectInjectedRuns: [...injectedRuns, runId],\n                },\n              },\n            ],\n            { refresh: 'affected' },\n          );\n          const verifyMsg = getChatMessages(messageId)[0];\n          const verifyText = String(verifyMsg?.message || '');\n          const lineHitCount = lines.filter(line => verifyText.includes(line)).length;\n          console.info(\n            `[DICE][META] inject done: run=${runId}, message=${messageId}, lineHit=${lineHitCount}/${lines.length}, finalLen=${verifyText.length}`,\n          );\n          return true;\n        }\n\n        console.warn(\n          `[DICE][META] inject failed: run=${runId}, message=${messageId}, reason=message_not_ready_or_meta_missing`,\n        );\n        return false;\n      });\n    };\n\n    const injectEffectLinesIntoTextarea = (runId: string, lines: string[]): boolean => {\n      if (lines.length === 0) return false;\n      try {\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        if ($ta.length === 0) return false;\n        const raw = String($ta.val() || '');\n        if (!raw.includes('meta:')) return false;\n        const missingLines = lines.filter(line => !raw.includes(line));\n        if (missingLines.length === 0) {\n          console.info(`[DICE][META] textarea inject skipped duplicated run=${runId}`);\n          return true;\n        }\n\n        const closingCandidates = ['</meta:>', '&lt;/meta:&gt;', '&amp;lt;/meta:&amp;gt;'];\n        let closingIdx = -1;\n        let closingTag = '';\n        for (const candidate of closingCandidates) {\n          const idx = raw.lastIndexOf(candidate);\n          if (idx > closingIdx) {\n            closingIdx = idx;\n            closingTag = candidate;\n          }\n        }\n        if (closingIdx === -1) {\n          console.warn(`[DICE][META] textarea inject failed: closing tag missing, run=${runId}`);\n          return false;\n        }\n\n        const beforeClose = raw.slice(0, closingIdx);\n        const needsLeadingNewline = beforeClose.length > 0 && !beforeClose.endsWith('\\n');\n        const effectBlock = `${needsLeadingNewline ? '\\n' : ''}${missingLines.join('\\n')}`;\n        const updated = beforeClose + effectBlock + '\\n' + raw.slice(closingIdx);\n        $ta.val(updated).trigger('input').trigger('change');\n        console.info(\n          `[DICE][META] textarea inject done: run=${runId}, lines=${missingLines.length}, closingTag=${closingTag}`,\n        );\n        return true;\n      } catch (e) {\n        console.warn(`[DICE][META] textarea inject error: run=${runId}`, e);\n        return false;\n      }\n    };\n\n    const hasMetaInTextarea = (): boolean => {\n      try {\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        if ($ta.length === 0) return false;\n        const raw = String($ta.val() || '');\n        return raw.includes('meta:');\n      } catch {\n        return false;\n      }\n    };\n\n    const normalizeMessageId = (payload: unknown): string | undefined => {\n      if (payload === null || payload === undefined) return undefined;\n      if (typeof payload === 'string' || typeof payload === 'number') return String(payload);\n      if (typeof payload === 'object') {\n        const record = payload as Record<string, unknown>;\n        const candidates = [record.messageId, record.message_id, record.id, record.mid];\n        const hit = candidates.find(v => v !== undefined && v !== null && String(v).trim() !== '');\n        if (hit !== undefined && hit !== null) return String(hit);\n      }\n      return undefined;\n    };\n\n    const emitEffectRun = (payload: Omit<EffectRunEventPayload, 'seq'>): number => {\n      effectRunEventSeq += 1;\n      const fullPayload: EffectRunEventPayload = {\n        ...payload,\n        seq: effectRunEventSeq,\n      };\n      emitEvent('effect_run', fullPayload);\n      return effectRunEventSeq;\n    };\n\n    const getSecondaryTriggerMode = (preset?: AdvancedDicePreset): 'first' | 'all' => {\n      return preset?.secondaryTriggerMode === 'all' ? 'all' : 'first';\n    };\n\n    const findHistoryIndexByRunId = (runId?: string): number => {\n      if (!runId) return -1;\n      for (let index = checkHistory.length - 1; index >= 0; index--) {\n        const item = checkHistory[index] as CheckHistoryEntry;\n        if (item.effectRunId === runId) return index;\n      }\n      return -1;\n    };\n\n    const isValidEffectStatusTransition = (\n      fromStatus: CheckHistoryExtension['effectStatus'],\n      toStatus: CheckHistoryExtension['effectStatus'],\n    ): boolean => {\n      if (!fromStatus || !toStatus) return true;\n      if (fromStatus === toStatus) return true;\n      const transitions: Record<string, string[]> = {\n        planned: ['confirmed', 'cancelled', 'failed'],\n        confirmed: ['committed', 'failed', 'cancelled'],\n        committed: [],\n        failed: [],\n        cancelled: [],\n      };\n      const allowed = transitions[fromStatus] || [];\n      return allowed.includes(toStatus);\n    };\n\n    const setHistoryEffectState = (\n      historyIndex: number,\n      patch: Partial<CheckHistoryExtension>,\n    ): CheckHistoryEntry | null => {\n      if (historyIndex < 0 || historyIndex >= checkHistory.length) return null;\n      const historyEntry = checkHistory[historyIndex] as CheckHistoryEntry;\n      const nextPatch = { ...patch };\n      if (\n        nextPatch.effectStatus &&\n        historyEntry.effectStatus &&\n        !isValidEffectStatusTransition(historyEntry.effectStatus, nextPatch.effectStatus)\n      ) {\n        console.warn(\n          `[DICE] Invalid effect status transition blocked: ${historyEntry.effectStatus} -> ${nextPatch.effectStatus}`,\n        );\n        delete nextPatch.effectStatus;\n      }\n      Object.assign(historyEntry, nextPatch);\n      return historyEntry;\n    };\n\n    const setHistoryEffectStateByRun = (\n      run: PendingEffectContext,\n      patch: Partial<CheckHistoryExtension>,\n    ): CheckHistoryEntry | null => {\n      const byRunId = findHistoryIndexByRunId(run.runId);\n      if (byRunId >= 0) return setHistoryEffectState(byRunId, patch);\n      console.warn(`[DICE] setHistoryEffectStateByRun skipped: runId not found (${run.runId})`);\n      return null;\n    };\n\n    const resolveLatestMetaUserMessageId = (): number | undefined => {\n      try {\n        const lastId = getLastMessageId();\n        if (!Number.isFinite(lastId) || lastId < 0) return undefined;\n        const from = Math.max(0, lastId - 12);\n        const msgs = getChatMessages(`${from}-${lastId}`, { role: 'user' }) as Array<{\n          message_id: number;\n          message: string;\n        }>;\n        for (let i = msgs.length - 1; i >= 0; i--) {\n          const text = String(msgs[i].message || '');\n          if (text.includes('meta:')) {\n            return msgs[i].message_id;\n          }\n        }\n      } catch {\n        // ignore\n      }\n      return undefined;\n    };\n\n    const scheduleEffectRunRetry = (): void => {\n      if (effectRunRetryTimer) return;\n      effectRunRetryTimer = setTimeout(() => {\n        effectRunRetryTimer = null;\n        void processPendingEffectRuns();\n      }, 220);\n    };\n\n    const enqueueEffectRun = (run: PendingEffectContext): void => {\n      if (!run.expiresAt) {\n        run.expiresAt = Date.now() + EFFECT_RUN_TTL_MS;\n      }\n      pendingEffectRuns.push(run);\n      console.info(\n        `[DICE] Effect run queued: ${run.runId}, message=${run.messageId || 'pending'}, expiresAt=${run.expiresAt}, pending=${pendingEffectRuns.length}`,\n      );\n    };\n\n    const processPendingEffectRuns = async (payload?: unknown): Promise<void> => {\n      const incomingMessageId = normalizeMessageId(payload);\n      if (incomingMessageId) {\n        console.info(`[DICE][META] MESSAGE_SENT captured id=${incomingMessageId}`);\n      }\n\n      //  messageId  run \n      //  MESSAGE_SENT run \n      if (incomingMessageId && activeConfirmEffectRun && !activeConfirmEffectRun.messageId) {\n        activeConfirmEffectRun.messageId = incomingMessageId;\n        console.info(\n          `[DICE][META] bind activeConfirm run=${activeConfirmEffectRun.runId} message=${incomingMessageId}`,\n        );\n      }\n\n      if (pendingEffectRuns.length === 0) return;\n\n      const now = Date.now();\n      const nextPending: PendingEffectContext[] = [];\n      const executableRuns: PendingEffectContext[] = [];\n      let consumedByMessage = false;\n      let consumedByFallback = false;\n\n      for (const run of pendingEffectRuns) {\n        const expired = Boolean(run.expiresAt && run.expiresAt < now);\n        if (expired) {\n          const errMsg = '';\n          setHistoryEffectStateByRun(run, {\n            effectStatus: 'cancelled',\n            effectError: errMsg,\n            effectTrace: [''],\n          });\n          const seq = emitEffectRun({\n            runId: run.runId,\n            status: 'cancelled',\n            characterName: run.context.characterName,\n            attributeName: run.context.attributeName,\n            historyIndex: run.historyIndex,\n            effectResults: [],\n            effectTrace: [''],\n            chainMode: getSecondaryTriggerMode(run.preset),\n            error: errMsg,\n            timestamp: now,\n          });\n          setHistoryEffectStateByRun(run, { effectEventSeq: seq });\n          continue;\n        }\n\n        if (incomingMessageId) {\n          if (run.messageId && run.messageId !== incomingMessageId) {\n            nextPending.push(run);\n            continue;\n          }\n\n          if (!consumedByMessage) {\n            if (!run.messageId) {\n              run.messageId = incomingMessageId;\n              console.info(`[DICE][META] bind queued run=${run.runId} message=${incomingMessageId}`);\n            }\n            executableRuns.push(run);\n            consumedByMessage = true;\n          } else {\n            nextPending.push(run);\n          }\n          continue;\n        }\n\n        //  messageId \n        const withinFallbackWindow = now - run.timestamp <= EFFECT_RUN_FALLBACK_WINDOW_MS;\n        if (withinFallbackWindow && !consumedByFallback) {\n          if (!run.messageId) {\n            const guessedMsgId = resolveLatestMetaUserMessageId();\n            if (guessedMsgId !== undefined) {\n              run.messageId = String(guessedMsgId);\n              console.warn(`[DICE][META] fallback guessed messageId: run=${run.runId}, message=${run.messageId}`);\n            }\n          }\n          if (run.messageId) {\n            console.warn(`[DICE] Effect run ${run.runId}: fallback commit with bound messageId=${run.messageId}`);\n            executableRuns.push(run);\n            consumedByFallback = true;\n          } else if (hasMetaInTextarea()) {\n            console.warn(`[DICE][META] fallback commit by textarea meta presence: run=${run.runId}`);\n            executableRuns.push(run);\n            consumedByFallback = true;\n          } else {\n            console.warn(`[DICE][META] fallback skipped: run=${run.runId} has no messageId yet`);\n            nextPending.push(run);\n          }\n        } else if (!withinFallbackWindow && !consumedByFallback) {\n          console.warn(`[DICE][META] timeout fallback commit without messageId: run=${run.runId}`);\n          executableRuns.push(run);\n          consumedByFallback = true;\n        } else {\n          nextPending.push(run);\n        }\n      }\n\n      if (executableRuns.length === 0) {\n        pendingEffectRuns = nextPending;\n        if (pendingEffectRuns.length > 0) {\n          scheduleEffectRunRetry();\n        }\n        return;\n      }\n\n      pendingEffectRuns = nextPending;\n      for (const run of executableRuns) {\n        try {\n          const results = await executeEffects(run);\n          const hasFailure = results.some(r => !r.success);\n          if (!hasFailure) {\n            const succeeded = results.filter(r => r.success);\n            const latestAttrResult = succeeded\n              .slice()\n              .reverse()\n              .find(r => r.target && isSameAttributeAlias(r.target, run.context.attributeName));\n            if (latestAttrResult) {\n              panel.find('#dice-attr-value').val(String(latestAttrResult.newValue));\n            }\n            buildAttrButtons(run.context.characterName);\n          }\n\n          setHistoryEffectStateByRun(run, {\n            effectStatus: hasFailure ? 'failed' : 'committed',\n            effectResults: results,\n            effectError: hasFailure ? '' : undefined,\n            effectTrace: buildEffectTraceLines(results),\n          });\n\n          const seq = emitEffectRun({\n            runId: run.runId,\n            status: hasFailure ? 'failed' : 'committed',\n            characterName: run.context.characterName,\n            attributeName: run.context.attributeName,\n            historyIndex: run.historyIndex,\n            effectResults: results,\n            effectTrace: buildEffectTraceLines(results),\n            chainMode: getSecondaryTriggerMode(run.preset),\n            error: hasFailure ? '' : undefined,\n            timestamp: Date.now(),\n          });\n          setHistoryEffectStateByRun(run, { effectEventSeq: seq });\n\n          if (hasFailure && window.toastr) {\n            window.toastr.warning('', '');\n          }\n\n          console.info(\n            `[DICE] Effect run committed: ${run.runId}, total=${results.length}, success=${results.filter(r => r.success).length}`,\n          );\n\n          //  outputMessage  <meta:> \n          if (!hasFailure) {\n            const metaLines = buildEffectMetaLines(results, {\n              branchReasonText: run.branchReasonText,\n            });\n            if (metaLines.length > 0) {\n              try {\n                if (run.messageId) {\n                  const msgId = parseInt(run.messageId, 10);\n                  if (!isNaN(msgId) && msgId >= 0) {\n                    const injected = await injectEffectLinesIntoMeta(msgId, run.runId, metaLines);\n                    if (injected) {\n                      console.info(\n                        `[DICE] Effect results injected into meta: ${metaLines.length} line(s) in message ${msgId}`,\n                      );\n                    } else {\n                      console.warn(\n                        `[DICE][META] inject returned false: run=${run.runId}, rawMessageId=${run.messageId}, lines=${metaLines.length}`,\n                      );\n                    }\n                  } else {\n                    console.warn(\n                      `[DICE][META] invalid messageId for injection: run=${run.runId}, rawMessageId=${run.messageId}`,\n                    );\n                  }\n                } else {\n                  const textareaInjected = injectEffectLinesIntoTextarea(run.runId, metaLines);\n                  if (!textareaInjected) {\n                    console.warn(`[DICE][META] no messageId and textarea inject failed: run=${run.runId}`);\n                  }\n                }\n              } catch (injectErr) {\n                console.error('[DICE] Failed to inject effect results into meta:', injectErr);\n              }\n            }\n          }\n        } catch (error) {\n          const errMsg = error instanceof Error ? error.message : String(error);\n          setHistoryEffectStateByRun(run, {\n            effectStatus: 'failed',\n            effectError: errMsg,\n            effectTrace: [`${errMsg}`],\n          });\n          const seq = emitEffectRun({\n            runId: run.runId,\n            status: 'failed',\n            characterName: run.context.characterName,\n            attributeName: run.context.attributeName,\n            historyIndex: run.historyIndex,\n            effectResults: [],\n            effectTrace: [`${errMsg}`],\n            chainMode: getSecondaryTriggerMode(run.preset),\n            error: errMsg,\n            timestamp: Date.now(),\n          });\n          setHistoryEffectStateByRun(run, { effectEventSeq: seq });\n          console.error(`[DICE] Effect run failed: ${run.runId}`, error);\n        }\n      }\n    };\n\n    const cleanupExpiredEffectRuns = (): void => {\n      if (pendingEffectRuns.length === 0) return;\n      const now = Date.now();\n      const nextPending: PendingEffectContext[] = [];\n      for (const run of pendingEffectRuns) {\n        const expired = Boolean(run.expiresAt && run.expiresAt < now);\n        if (!expired) {\n          nextPending.push(run);\n          continue;\n        }\n\n        const errMsg = '';\n        setHistoryEffectStateByRun(run, {\n          effectStatus: 'cancelled',\n          effectError: errMsg,\n          effectTrace: [''],\n        });\n        const seq = emitEffectRun({\n          runId: run.runId,\n          status: 'cancelled',\n          characterName: run.context.characterName,\n          attributeName: run.context.attributeName,\n          historyIndex: run.historyIndex,\n          effectResults: [],\n          effectTrace: [''],\n          chainMode: getSecondaryTriggerMode(run.preset),\n          error: errMsg,\n          timestamp: now,\n        });\n        setHistoryEffectStateByRun(run, { effectEventSeq: seq });\n      }\n      pendingEffectRuns = nextPending;\n    };\n    const existingCleaner = (window as Record<string, unknown>)[effectRunCleanerTimerKey];\n    if (typeof existingCleaner === 'number') {\n      window.clearInterval(existingCleaner);\n    }\n    (window as Record<string, unknown>)[effectRunCleanerTimerKey] = window.setInterval(() => {\n      cleanupExpiredEffectRuns();\n    }, 2000);\n\n    // : \n    const applyFieldConfig = function (\n      $input: JQuery,\n      $label: JQuery,\n      config: FieldConfig | undefined,\n      defaults: { label: string; placeholder: string },\n    ) {\n      // labelinputwrapper div\n      // DOM: <div> <label/> <div.acu-input-wrapper> <input/> </div> </div>\n      // labelinput-wrapper\n      const $wrapper = $label.parent();\n\n      if (config?.hidden) {\n        $wrapper.hide();\n        return;\n      }\n\n      $wrapper.show();\n      $input.attr('placeholder', config?.placeholder || defaults.placeholder).prop('readonly', false);\n      $label.text(config?.label || defaults.label);\n    };\n\n    /**\n     * []  CheckSelector\n     * @param attrName - \n     * @param selector - \n     * @returns true=false=\n     */\n    const matchesCheckSelector = (attrName: string, selector?: CheckSelector): boolean => {\n      //  selector\n      if (!selector) return true;\n\n      const normalizedName = attrName.trim().toLowerCase();\n\n      // \n      const wildcardToRegex = (pattern: string): RegExp => {\n        const escaped = pattern\n          .replace(/[.+^${}()|[\\]\\\\]/g, '\\\\$&') // \n          .replace(/\\*/g, '.*') // * -> .*\n          .replace(/\\?/g, '.'); // ? -> .\n        return new RegExp(`^${escaped}$`, 'i');\n      };\n\n      // \n      const matchesAnyPattern = (name: string, patterns: string[]): boolean => {\n        return patterns.some(pattern => {\n          const regex = wildcardToRegex(pattern);\n          return regex.test(name);\n        });\n      };\n\n      // 1.  namePatterns.exclude include\n      if (selector.namePatterns?.exclude && selector.namePatterns.exclude.length > 0) {\n        if (matchesAnyPattern(normalizedName, selector.namePatterns.exclude)) {\n          return false; // \n        }\n      }\n\n      // 2.  namePatterns.include\n      if (selector.namePatterns?.include && selector.namePatterns.include.length > 0) {\n        //  include  ['*']\n        const isWildcardOnly = selector.namePatterns.include.length === 1 && selector.namePatterns.include[0] === '*';\n        if (!isWildcardOnly && !matchesAnyPattern(normalizedName, selector.namePatterns.include)) {\n          return false; // \n        }\n      }\n\n      // 3.  tags tags \n      //  tags.include/exclude\n\n      return true;\n    };\n\n    // [] \n    const renderEffectInputs = (preset: AdvancedDicePreset, attrName: string): string[] => {\n      if (!preset.effectsConfig) return [];\n\n      // \n      const isMatched = matchesCheckSelector(attrName, {\n        namePatterns: { include: preset.effectsConfig.triggerPatterns },\n      });\n\n      if (!isMatched) return [];\n\n      const items: string[] = [];\n\n      //  preset.outcomes \n      //  preset.outcomes[].effects  effectsConfig.outcomes\n      if (preset.outcomes && Array.isArray(preset.outcomes)) {\n        const outcomesWithEffects = preset.outcomes.filter(outcome => outcome.effects && outcome.effects.length > 0);\n\n        outcomesWithEffects.forEach(outcome => {\n          //  effectsConfig.defaultValues  effects[0].value\n          const defaultVal =\n            preset.effectsConfig?.defaultValues?.[outcome.name] || (outcome.effects && outcome.effects[0]?.value) || '';\n          const label = outcome.name; // \n\n          items.push(`\n            <div class=\"acu-effect-input-group\">\n              <div class=\"acu-effect-input-label\">\n                <span>${escapeHtml(label)}</span>\n                <span class=\"acu-effect-preview-text\" id=\"effect-preview-${escapeHtml(outcome.name)}\"></span>\n              </div>\n              <input type=\"text\"\n                     class=\"acu-dice-input acu-effect-value-input\"\n                     data-outcome=\"${escapeHtml(outcome.name)}\"\n                     value=\"\"\n                     placeholder=\"${escapeHtml(String(defaultVal || ' ( 1d6)'))}\">\n            </div>\n          `);\n        });\n      }\n\n      return items;\n    };\n\n    const applyAdvancedPreset = (presetId: string | null) => {\n      // DOM\n      const $modWrapper = panel.find('#dice-mod-wrapper');\n      const $row1 = panel.find('#dice-row-1');\n      const $row2 = panel.find('#dice-row-2');\n      const $row3 = panel.find('#dice-row-3');\n      const $customArea = panel.find('#dice-custom-fields-area');\n      const $attrWrapper = panel.find('#dice-attr-wrapper');\n      const $targetWrapper = panel.find('#dice-target-wrapper');\n      const $skillModWrapper = panel.find('#dice-skill-mod-wrapper');\n      const $nameWrapper = panel.find('#dice-name-wrapper');\n      const $attrNameWrapper = panel.find('#dice-attr-name-wrapper');\n\n      // :  Row 1 \n      const restoreRow1 = () => {\n        if ($nameWrapper.parent().attr('id') !== 'dice-row-1') {\n          $nameWrapper.detach().prependTo($row1);\n        }\n        if ($attrNameWrapper.parent().attr('id') !== 'dice-row-1') {\n          $attrNameWrapper.detach().appendTo($row1);\n        }\n        $nameWrapper.show();\n        $attrNameWrapper.show();\n        $row1.show();\n        // 2\n        $row1.removeClass('cols-2 cols-3').addClass('cols-2');\n      };\n\n      // : \n      const restoreModifier = () => {\n        if ($modWrapper.parent().attr('id') !== 'dice-row-3') {\n          $modWrapper.detach().appendTo($row3);\n        }\n        $modWrapper.show();\n        panel.find('#dice-mod-label').text(''); // \n        panel.find('#dice-modifier').attr('placeholder', '=0');\n      };\n\n      // :  Row 2 \n      const restoreRow2 = () => {\n        if ($attrWrapper.parent().attr('id') !== 'dice-row-2') {\n          $attrWrapper.detach().prependTo($row2);\n        }\n        if ($skillModWrapper.parent().attr('id') !== 'dice-row-2') {\n          $skillModWrapper.detach().insertAfter($attrWrapper);\n        }\n        if ($targetWrapper.parent().attr('id') !== 'dice-row-2') {\n          $targetWrapper.detach().appendTo($row2);\n        }\n        $attrWrapper.show();\n        $skillModWrapper.hide(); // \n        $targetWrapper.show();\n        $row2.show();\n      };\n\n      if (!presetId || presetId === '__custom__') {\n        //  ()\n        currentAdvancedPreset = null;\n        lastVisiblePresetId = null;\n\n        // [] ,\n        panel.find('#acu-dice-custom-mode-fields').show();\n\n        //  Row 1Row 2  Row 3  Row 2/3 ()\n        restoreRow1();\n        restoreRow2();\n        restoreModifier();\n        $row2.hide();\n        $row3.hide();\n        panel.find('#dice-difficulty-wrapper').hide();\n        panel.find('#dice-success-criteria').closest('div').hide();\n\n        // \n        $customArea.empty();\n\n        // \"\"\n        panel.find('.dice-attr-name-text').text('');\n\n        // \n        applyFieldConfig(panel.find('#dice-attr-value'), panel.find('#dice-attr-label'), undefined, {\n          label: '',\n          placeholder: '=50%',\n        });\n\n        applyFieldConfig(panel.find('#dice-target'), panel.find('#dice-target-label'), undefined, {\n          label: '',\n          placeholder: '=',\n        });\n\n        // \n        panel.find('.acu-dice-quick-preset-btn').removeClass('active');\n        panel.find('.acu-dice-quick-preset-btn[data-id=\"__custom__\"]').addClass('active');\n\n        panel.find('#dice-normal-presets').show();\n        panel.find('#dice-workflow-return-container').hide();\n\n        updateRuleMode();\n        renderPresetQuickActions(null);\n        return;\n      }\n\n      const preset = AdvancedDicePresetManager.getAllPresets().find(p => p.id === presetId);\n      if (!preset) {\n        console.warn('[DICE] :', presetId);\n        // \n        applyAdvancedPreset('__custom__');\n        return;\n      }\n\n      currentAdvancedPreset = preset;\n      if (preset.visible !== false) {\n        lastVisiblePresetId = preset.id;\n      }\n\n      // \n      panel.find('.acu-dice-quick-preset-btn').removeClass('active');\n      panel.find(`.acu-dice-quick-preset-btn[data-id=\"${escapeHtml(preset.id)}\"]`).addClass('active');\n\n      // \n      // [] \n      panel.find('#acu-dice-custom-mode-fields').hide();\n\n      // \n      panel.find('#dice-formula').val(preset.diceExpression);\n\n      // \"\"Fate\"/\"\n      panel.find('.dice-attr-name-text').text(preset.attributeName?.label || '');\n\n      //  Row 1Row 2  Row 3 ( customArea )\n      restoreRow1();\n      restoreRow2();\n      restoreModifier();\n      $row1.hide();\n      $row2.hide();\n      $row3.hide();\n\n      // \n      $customArea.empty();\n\n      // [] \n      const gridItems: (JQuery | string)[] = [];\n\n      // 0.  ()\n      gridItems.push($nameWrapper);\n\n      // 0.5  ()\n      gridItems.push($attrNameWrapper);\n\n      // 1.  ()\n      if (!preset.attribute?.hidden) {\n        applyFieldConfig(panel.find('#dice-attr-value'), panel.find('#dice-attr-label'), preset.attribute, {\n          label: '',\n          placeholder: '=50%',\n        });\n        gridItems.push($attrWrapper);\n      }\n\n      // 1.5  ( skillMod )\n      if (preset.skillMod && !preset.skillMod.hidden) {\n        applyFieldConfig(panel.find('#dice-skill-mod'), panel.find('#dice-skill-mod-label'), preset.skillMod, {\n          label: '',\n          placeholder: '=0',\n        });\n        gridItems.push($skillModWrapper);\n      }\n\n      // [] \n      const attrName = panel.find('#dice-attr-name').val().trim();\n      const effectInputItems = renderEffectInputs(preset, attrName);\n      if (effectInputItems.length > 0) {\n        gridItems.push(...effectInputItems);\n      }\n\n      // 2. /DC ()\n      if (!preset.dc?.hidden) {\n        applyFieldConfig(panel.find('#dice-target'), panel.find('#dice-target-label'), preset.dc, {\n          label: '',\n          placeholder: '=',\n        });\n        gridItems.push($targetWrapper);\n      }\n\n      // 3.  ()\n      if (!preset.mod?.hidden) {\n        if (preset.mod?.label) {\n          panel.find('#dice-mod-label').text(preset.mod.label);\n        }\n        //  placeholder \n        const modDefault = preset.mod?.defaultValue;\n        if (modDefault !== undefined && modDefault !== 0) {\n          panel.find('#dice-modifier').attr('placeholder', `=${modDefault}`);\n        } else {\n          panel.find('#dice-modifier').attr('placeholder', '=0');\n        }\n        gridItems.push($modWrapper);\n      }\n\n      // 4. \n      if ('customFields' in preset && Array.isArray(preset.customFields) && preset.customFields.length > 0) {\n        const visibleFields = preset.customFields.filter(f => !f.hidden);\n\n        visibleFields.forEach(field => {\n          let html = '<div>';\n\n          // \n          if (field.type !== 'toggle') {\n            html += `<div class=\"acu-dice-form-label\">${escapeHtml(field.label || field.id)}</div>`;\n          } else {\n            html += '<div class=\"acu-dice-form-label\">&nbsp;</div>'; // \n          }\n\n          // \n          if (field.type === 'select' && field.options) {\n            html += `<select class=\"acu-dice-select acu-dice-custom-field\" data-id=\"${escapeHtml(field.id)}\">`;\n            field.options.forEach(opt => {\n              const isSelected = opt.value === field.defaultValue ? 'selected' : '';\n              html += `<option value=\"${escapeHtml(String(opt.value))}\" ${isSelected}>${escapeHtml(opt.label)}</option>`;\n            });\n            html += '</select>';\n          } else if (field.type === 'toggle') {\n            const isChecked = field.defaultValue ? 'checked' : '';\n            html += `<label style=\"display: flex; align-items: center; cursor: pointer; height: 32px;\">\n              <input type=\"checkbox\" class=\"acu-dice-custom-field\" data-id=\"${escapeHtml(field.id)}\" ${isChecked} style=\"margin-right: 8px;\">\n              ${escapeHtml(field.label || field.id)}\n            </label>`;\n          } else {\n            const type = field.type === 'number' ? 'number' : 'text';\n            // []  placeholder  value \n            const defaultVal = field.defaultValue;\n            const placeholderText =\n              field.placeholder || (defaultVal !== undefined && defaultVal !== '' ? `=${defaultVal}` : '');\n            html += `<input type=\"${type}\" class=\"acu-dice-input acu-dice-custom-field\" data-id=\"${escapeHtml(field.id)}\"\n              placeholder=\"${escapeHtml(placeholderText)}\">`;\n          }\n\n          html += '</div>';\n          gridItems.push(html);\n        });\n      }\n\n      // 5. \n      // 32\n      // - 42+2\n      // - 52+3\n      // - 63+3\n      // - 72+2+3\n      // - 82+3+3\n      // - 93+3+3\n      const appendItem = ($row: JQuery, item: JQuery | string) => {\n        if (typeof item === 'string') {\n          $row.append(item);\n        } else {\n          item.detach().appendTo($row);\n          item.show();\n        }\n      };\n\n      // 3\n      const computeRowLayout = (total: number): number[] => {\n        if (total <= 0) return [];\n        if (total <= 2) return [2]; // 2 cols-1\n        if (total === 3) return [3];\n        if (total === 4) return [2, 2];\n        if (total === 5) return [2, 3];\n        if (total === 6) return [3, 3];\n        // 7+ 3\n        return [...computeRowLayout(total - 3), 3];\n      };\n\n      //  gridItems \n      const gridRowLayout = computeRowLayout(gridItems.length);\n\n      let itemIndex = 0;\n      for (const colCount of gridRowLayout) {\n        const $row = $(`<div class=\"acu-dice-form-row cols-${colCount}\"></div>`);\n        for (let j = 0; j < colCount; j++) {\n          if (itemIndex < gridItems.length) {\n            appendItem($row, gridItems[itemIndex]);\n            itemIndex++;\n          } else {\n            $row.append('<div></div>');\n          }\n        }\n        $customArea.append($row);\n      }\n\n      // []  customFields \n      addClearButton($customArea, '.acu-dice-custom-field[type=\"text\"], .acu-dice-custom-field[type=\"number\"]');\n\n      renderPresetQuickActions(preset);\n\n      // []  UI \n      // visible: false\n      // \n      const isWorkMode = preset.visible === false;\n      const $normalPresets = panel.find('#dice-normal-presets');\n      const $workflowReturn = panel.find('#dice-workflow-return-container');\n\n      if (isWorkMode) {\n        $normalPresets.hide();\n        $workflowReturn.show();\n        $workflowReturn\n          .find('button')\n          .html(`<i class=\"fa-solid fa-arrow-left\"></i> ${escapeHtml(preset.name)}`);\n      } else {\n        $normalPresets.show();\n        $workflowReturn.hide();\n      }\n\n      console.log('[DICE] :', preset.name, isWorkMode ? '()' : '');\n    };\n\n    // [] \n    panel.find('#dice-attr-name').on('change', function () {\n      if (!currentAdvancedPreset) return;\n      // \n      //  gridItems  applyAdvancedPreset \n      // \n      if (panel.data('updating-preset')) return;\n      panel.data('updating-preset', true);\n      applyAdvancedPreset(currentAdvancedPreset.id);\n      panel.data('updating-preset', false);\n    });\n\n    // \n    panel.find('#custom-dice-expr').on('input change', function () {\n      if (!panel.find('#acu-dice-custom-mode-fields').is(':visible')) return;\n      const customExpr = ($(this).val() || '').toString().trim();\n      saveDiceConfig({ customDiceExpr: customExpr });\n    });\n\n    // \n    panel.find('.acu-dice-quick-preset-btn').click(function () {\n      const presetId = $(this).data('id') as string;\n\n      //  last preset\n      if (presetId === '__custom__') {\n        AdvancedDicePresetManager.setActivePreset(null);\n        localStorage.setItem(STORAGE_KEY_LAST_PRESET, '__custom__');\n      } else {\n        AdvancedDicePresetManager.setActivePreset(presetId);\n        localStorage.setItem(STORAGE_KEY_LAST_PRESET, presetId);\n      }\n\n      applyAdvancedPreset(presetId);\n    });\n\n    // [] \n    panel.on('click', '#dice-return-normal-btn', function (e) {\n      e.preventDefault();\n      // \n      let targetPresetId: string | null = lastVisiblePresetId;\n\n      //  targetPresetId \n      const allPresets = AdvancedDicePresetManager.getAllPresets();\n      const targetPreset = allPresets.find(p => p.id === targetPresetId);\n      if (!targetPreset || targetPreset.visible === false) {\n        // \n        const firstVisible = allPresets.find(p => p.visible !== false);\n        targetPresetId = firstVisible ? firstVisible.id : '__custom__';\n      }\n\n      // \n      if (targetPresetId === '__custom__') {\n        AdvancedDicePresetManager.setActivePreset(null);\n      } else {\n        AdvancedDicePresetManager.setActivePreset(targetPresetId);\n      }\n      //  localStorage\n      localStorage.setItem(STORAGE_KEY_LAST_PRESET, targetPresetId || '__custom__');\n\n      applyAdvancedPreset(targetPresetId);\n    });\n\n    panel.on('click', '.acu-dice-preset-action-btn', async function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const actionId = String($(this).data('action-id') || '').trim();\n      if (!actionId) return;\n      const $btn = $(this);\n      if ($btn.prop('disabled')) return;\n      $btn.prop('disabled', true).addClass('disabled');\n      try {\n        await executePresetQuickAction(actionId);\n      } finally {\n        $btn.prop('disabled', false).removeClass('disabled');\n        renderPresetQuickActions(currentAdvancedPreset);\n      }\n    });\n\n    panel.find('#dice-attr-value, #dice-modifier, #dice-target').on('input change', function () {\n      renderPresetQuickActions(currentAdvancedPreset);\n    });\n\n    // \n    const savedPresetId = localStorage.getItem(STORAGE_KEY_LAST_PRESET);\n    //  ActivePresetManager \n    const activePreset = AdvancedDicePresetManager.getActivePreset();\n\n    if (activePreset) {\n      applyAdvancedPreset(activePreset.id);\n    } else if (savedPresetId && savedPresetId !== '__custom__') {\n      applyAdvancedPreset(savedPresetId);\n    } else {\n      applyAdvancedPreset('__custom__');\n    }\n\n    //  -  rollComplexDiceExpression \n    const rollDice = formula => {\n      const rollResult = rollComplexDiceExpression(formula);\n      const total = rollResult.total;\n      if (Number.isNaN(total)) {\n        return { total: 0, rolls: [], formula };\n      }\n      // \n      const basicMatch = formula.match(/^(\\d*)d(\\d+|F)/i);\n      const count = basicMatch && basicMatch[1] ? parseInt(basicMatch[1], 10) : 1;\n      const sidesStr = basicMatch ? basicMatch[2] : '100';\n      const sides = sidesStr.toUpperCase() === 'F' ? 3 : parseInt(sidesStr, 10);\n      //  rolls \n      return { total, rolls: [], sides, count, modifier: 0, formula };\n    };\n\n    // 1d6, 1d6+2\n    const parseModifier = function (modStr) {\n      if (!modStr || modStr.trim() === '') return 0;\n      const trimmed = modStr.trim();\n\n      // \n      const numValue = parseFloat(trimmed);\n      if (!isNaN(numValue) && isFinite(numValue) && trimmed.match(/^-?\\d+(\\.\\d+)?$/)) {\n        return numValue;\n      }\n\n      // \n      const rollResult = rollComplexDiceExpression(trimmed);\n      if (!Number.isNaN(rollResult.total)) return rollResult.total;\n      return 0;\n    };\n\n    const resolveExpressionWithContext = (expr: string, context: Record<string, string | number | boolean>): string => {\n      let resolved = String(expr || '0');\n      Object.entries(context).forEach(([key, value]) => {\n        const safeKey = key.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n        resolved = resolved.replace(new RegExp(safeKey, 'g'), String(value));\n      });\n      return resolved;\n    };\n\n    const activatePresetQuickAction = (action: WorkflowQuickAction): void => {\n      const presetId = String(action.config.presetId || '').trim();\n      if (!presetId) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      const targetPreset = AdvancedDicePresetManager.getAllPresets().find(item => item.id === presetId);\n      if (!targetPreset) {\n        if (window.toastr) window.toastr.warning(`: ${presetId}`);\n        return;\n      }\n\n      const carryInitiator = action.config.carryInitiator !== false;\n      const carryAttrName = action.config.carryAttrName !== false;\n      const carryAttrValue = action.config.carryAttrValue !== false;\n      const carryTarget = action.config.carryTarget === true;\n      const carryModifier = action.config.carryModifier === true;\n      const carrySkillMod = action.config.carrySkillMod === true;\n\n      const previousState = {\n        initiatorName: String(panel.find('#dice-initiator-name').val() || '').trim(),\n        attrName: String(panel.find('#dice-attr-name').val() || '').trim(),\n        attrValue: String(panel.find('#dice-attr-value').val() || '').trim(),\n        target: String(panel.find('#dice-target').val() || '').trim(),\n        modifier: String(panel.find('#dice-modifier').val() || '').trim(),\n        skillMod: String(panel.find('#dice-skill-mod').val() || '').trim(),\n      };\n\n      AdvancedDicePresetManager.setActivePreset(presetId);\n      localStorage.setItem(STORAGE_KEY_LAST_PRESET, presetId);\n      applyAdvancedPreset(presetId);\n\n      if (carryInitiator) {\n        panel.find('#dice-initiator-name').val(previousState.initiatorName);\n      }\n      if (carryAttrName) {\n        panel.find('#dice-attr-name').val(previousState.attrName);\n      } else if (action.config.attrName !== undefined) {\n        panel.find('#dice-attr-name').val(action.config.attrName);\n      }\n      if (carryAttrValue) {\n        panel.find('#dice-attr-value').val(previousState.attrValue);\n      }\n      if (carryTarget) {\n        panel.find('#dice-target').val(previousState.target);\n      }\n      if (carryModifier) {\n        panel.find('#dice-modifier').val(previousState.modifier);\n      }\n      if (carrySkillMod) {\n        panel.find('#dice-skill-mod').val(previousState.skillMod);\n      }\n\n      if (action.config.customFieldValues) {\n        Object.entries(action.config.customFieldValues).forEach(([fieldId, rawValue]) => {\n          const $field = panel\n            .find('.acu-dice-custom-field')\n            .filter((_index, element) => String($(element).data('id') || '') === fieldId);\n          if (!$field.length) return;\n          if ($field.is(':checkbox')) {\n            $field.prop('checked', Boolean(rawValue));\n            return;\n          }\n          $field.val(String(rawValue));\n        });\n      }\n\n      panel.find('#dice-attr-name').trigger('change');\n      panel.find('#dice-attr-value, #dice-target, #dice-modifier, #dice-skill-mod').trigger('change');\n    };\n\n    const executeAttrShortcutQuickAction = (action: AttrShortcutQuickAction): void => {\n      const presetId = String(action.config.presetId || '').trim();\n      if (!presetId) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const allPresets = AdvancedDicePresetManager.getAllPresets();\n      const configuredTargetPreset = allPresets.find(item => item.id === presetId);\n      if (!configuredTargetPreset) {\n        if (window.toastr) window.toastr.warning(`: ${presetId}`);\n        return;\n      }\n\n      // \n      if (configuredTargetPreset.visible === false) {\n        if (window.toastr) {\n          window.toastr.warning(`: ${configuredTargetPreset.name}`);\n        }\n        return;\n      }\n\n      const presetAllowedTargets = Array.isArray(configuredTargetPreset.effectsConfig?.allowedTargets)\n        ? configuredTargetPreset.effectsConfig?.allowedTargets\n        : [];\n      const mergedCandidates = Array.from(\n        new Set(\n          [...(action.config.attrAliasCandidates || []), ...presetAllowedTargets]\n            .map(name => String(name || '').trim())\n            .filter(Boolean),\n        ),\n      );\n\n      const workflowAction: WorkflowQuickAction = {\n        id: action.id,\n        kind: 'workflow_shortcut',\n        icon: action.icon,\n        tooltip: action.tooltip,\n        condition: action.condition,\n        config: {\n          presetId,\n          carryInitiator: action.config.carryInitiator,\n          carryAttrName: false,\n          carryAttrValue: action.config.carryAttrValue,\n          carryTarget: action.config.carryTarget,\n          carryModifier: action.config.carryModifier,\n          carrySkillMod: action.config.carrySkillMod,\n        },\n      };\n      activatePresetQuickAction(workflowAction);\n\n      const charName = String(panel.find('#dice-initiator-name').val() || '').trim() || '<user>';\n      const candidates = mergedCandidates;\n      const fallbackName = String(action.config.fallbackAttrName || '').trim() || candidates[0] || '';\n      if (!fallbackName) return;\n\n      const resolved = resolveAttributeAliasName(charName, fallbackName, candidates);\n      const resolvedAttrName = resolved.name || fallbackName;\n      panel.find('#dice-attr-name').val(resolvedAttrName).trigger('change');\n    };\n\n    const executePresetQuickAction = async (actionId: string): Promise<void> => {\n      const preset = currentAdvancedPreset;\n      if (!preset) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      const action = getPresetQuickActions(preset).find(item => item.id === actionId);\n      if (!action) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (action.kind === 'workflow_shortcut') {\n        activatePresetQuickAction(action);\n        return;\n      }\n      if (action.kind === 'attr_shortcut') {\n        executeAttrShortcutQuickAction(action);\n        return;\n      }\n      if (window.toastr) window.toastr.warning('');\n    };\n\n    // [] \n    const renderResourceBurnerButtons = (\n      preset: AdvancedDicePreset,\n      context: Record<string, number>,\n      matchedOutcome?: OutcomeLevel,\n      attrName?: string,\n    ): string => {\n      if (!preset.resourceBurners || !Array.isArray(preset.resourceBurners) || preset.resourceBurners.length === 0) {\n        return '';\n      }\n\n      let html = '';\n      preset.resourceBurners.forEach(burner => {\n        // 1.  selector \n        if (attrName && burner.selector) {\n          const selectorMatch = matchesCheckSelector(attrName, burner.selector);\n          if (!selectorMatch) {\n            return; //  selector \n          }\n        }\n\n        // 2.  condition\n        if (burner.condition) {\n          const evalResult = evaluateCondition(burner.condition, context);\n          if (\n            !evalResult.success ||\n            (typeof evalResult.value === 'number' ? evalResult.value === 0 : !evalResult.value)\n          ) {\n            return;\n          }\n        }\n        const icon = burner.ui?.icon || 'fa-fire';\n        const tooltip = burner.ui?.tooltip || ` ${burner.resourceName}`;\n\n        html += `<button class=\"acu-dice-burner-btn\" data-id=\"${escapeHtml(burner.id)}\" title=\"${escapeHtml(tooltip)}\">\n          <i class=\"fa-solid ${escapeHtml(icon)}\"></i>\n        </button>`;\n      });\n\n      return html ? `<div class=\"acu-dice-burners\">${html}</div>` : '';\n    };\n\n    // [] \n    const handleResourceBurnerClick = (burner: ResourceBurner, context: Record<string, number>) => {\n      // \n      const rawInitiatorName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      const displayName = replaceUserPlaceholders(rawInitiatorName);\n\n      //  getAttributeValue \n      let currentResource = getAttributeValue(rawInitiatorName, burner.resourceName);\n\n      // \n      if (currentResource === undefined || currentResource === null) {\n        if (burner.resourceName === '' || burner.resourceName.toLowerCase() === 'luck') {\n          // CoC7 3D6  5\n          const d1 = Math.floor(Math.random() * 6) + 1;\n          const d2 = Math.floor(Math.random() * 6) + 1;\n          const d3 = Math.floor(Math.random() * 6) + 1;\n          const initialLuck = (d1 + d2 + d3) * 5;\n\n          if (window.toastr) {\n            window.toastr.info(`: ${d1}+${d2}+${d3}=${d1 + d2 + d3}  5 = ${initialLuck}`);\n          }\n\n          // \n          updateSingleAttribute(rawInitiatorName, burner.resourceName, 'set', initialLuck, {\n            initValue: initialLuck,\n          }).then(result => {\n            if (result.success) {\n              // \n              handleResourceBurnerClick(burner, context);\n            } else {\n              if (window.toastr) window.toastr.error(`: ${result.error}`);\n            }\n          });\n          return;\n        } else {\n          if (window.toastr) window.toastr.error(`: ${burner.resourceName}`);\n          return;\n        }\n      }\n\n      currentResource = currentResource || 0;\n\n      // \n      showBurnerInputDialog(burner, rawInitiatorName, currentResource, context);\n    };\n\n    // [] \n    const showBurnerInputDialog = (\n      burner: ResourceBurner,\n      rawCharName: string, //  <user>\n      currentResource: number,\n      context: Record<string, number>,\n    ) => {\n      const currentThemeClass = `acu-theme-${config.theme}`;\n\n      // \n      $('.acu-burner-overlay').remove();\n\n      //  suggestedAmount \n      let suggestedValue = 1; // 1\n      let suggestedHint = '';\n      if (burner.suggestedAmount) {\n        const evalResult = evaluateCondition(burner.suggestedAmount, context);\n        if (evalResult.success && typeof evalResult.value === 'number' && evalResult.value > 0) {\n          // ratio\n          const rawNeeded = Math.ceil(evalResult.value / burner.ratio);\n          if (burner.resourceOperation === 'add') {\n            suggestedValue = Math.max(1, rawNeeded);\n            suggestedHint = `: ${suggestedValue} ()`;\n          } else {\n            const capped = Math.min(Math.max(1, rawNeeded), currentResource);\n            suggestedValue = capped;\n            if (rawNeeded > currentResource) {\n              suggestedHint = `: ${suggestedValue} ()`;\n            } else {\n              suggestedHint = `: ${suggestedValue} ()`;\n            }\n          }\n        }\n      }\n\n      const isAddMode = burner.resourceOperation === 'add';\n      const actionVerb = isAddMode ? '' : '';\n      const maxAttr = isAddMode ? '' : `max=\"${currentResource}\"`;\n\n      //  context \n      const rollTotal = (context['$roll.total'] ?? context['$roll'] ?? 0) as number;\n      const attrValue = (context['$attr'] ?? 0) as number;\n\n      const dialog = $(`\n        <div class=\"acu-edit-overlay acu-burner-overlay\">\n          <div class=\"acu-edit-dialog ${currentThemeClass}\" style=\"max-width:350px;\">\n            <div class=\"acu-edit-title\">\n              <i class=\"fa-solid ${escapeHtml(burner.ui?.icon || 'fa-fire')}\" style=\"color:${escapeHtml(burner.ui?.color || 'var(--acu-accent)')}\"></i>\n              ${escapeHtml(actionVerb)} ${escapeHtml(burner.resourceName)}\n            </div>\n            <div class=\"acu-settings-content\" style=\"padding:15px;\">\n              <div style=\"display:flex;align-items:center;gap:12px;margin-bottom:16px;\">\n                <div style=\"flex:1;\">\n                  <label style=\"display:block;font-size:11px;color:var(--acu-text-sub);margin-bottom:4px;\">${escapeHtml(actionVerb)}</label>\n                  <input type=\"number\" id=\"burner-amount\" class=\"acu-input\" value=\"${suggestedValue}\" min=\"1\" ${maxAttr} style=\"width:100%;\">\n                  ${suggestedHint ? `<div style=\"font-size:10px;color:var(--acu-accent);margin-top:2px;\">${escapeHtml(suggestedHint)}</div>` : ''}\n                </div>\n                <div style=\"flex:1;\">\n                  <label style=\"display:block;font-size:11px;color:var(--acu-text-sub);margin-bottom:4px;\">${isAddMode ? '' : ''}</label>\n                  <div style=\"font-size:18px;font-weight:bold;color:var(--acu-success-text);\">${currentResource}</div>\n                </div>\n              </div>\n              <div id=\"burner-preview\" style=\"padding:10px;background:var(--acu-card-bg);border-radius:6px;font-size:12px;\">\n                <div id=\"burner-before\" style=\"color:var(--acu-text-sub);margin-bottom:6px;\"></div>\n                <div id=\"burner-after\" style=\"font-weight:bold;\"></div>\n              </div>\n            </div>\n            <div class=\"acu-dialog-btns\">\n              <button class=\"acu-dialog-btn\" id=\"burner-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n              <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"burner-confirm\"><i class=\"fa-solid fa-check\"></i> ${escapeHtml(actionVerb)}</button>\n            </div>\n          </div>\n        </div>\n      `);\n\n      $('body').append(dialog);\n\n      // \n      const updatePreview = () => {\n        const amount = parseInt(dialog.find('#burner-amount').val() as string, 10) || 0;\n        const effectValue = amount * burner.ratio;\n        // \n        let newRoll = rollTotal;\n        let newAttr = attrValue;\n        if (burner.target === 'roll') {\n          newRoll = burner.direction === 'decrease' ? rollTotal - effectValue : rollTotal + effectValue;\n        } else if (burner.target === 'attribute') {\n          newAttr = burner.direction === 'increase' ? attrValue + effectValue : attrValue - effectValue;\n        }\n        const beforePass = rollTotal <= attrValue;\n        const afterPass = newRoll <= newAttr;\n        const beforeColor = beforePass ? 'var(--acu-success-text)' : 'var(--acu-error-text)';\n        const afterColor = afterPass ? 'var(--acu-success-text)' : 'var(--acu-error-text)';\n        dialog\n          .find('#burner-before')\n          .html(\n            `: <span style=\"color:${beforeColor};font-weight:bold;\">${rollTotal} &lt;= ${attrValue}  ${beforePass ? '' : ''}</span>`,\n          );\n        dialog\n          .find('#burner-after')\n          .html(\n            `: <span style=\"color:${afterColor}\">${newRoll} &lt;= ${newAttr}  ${afterPass ? '' : ''}</span>` +\n              `<span style=\"color:var(--acu-text-sub);font-weight:normal;margin-left:8px;\">(${actionVerb} ${amount} ${burner.resourceName})</span>`,\n          );\n      };\n      updatePreview();\n\n      dialog.find('#burner-amount').on('input', updatePreview);\n\n      // \n      dialog.on('click', '#burner-cancel', () => {\n        dialog.remove();\n      });\n\n      // \n      dialog.on('click', '.acu-burner-overlay', e => {\n        if ($(e.target).hasClass('acu-burner-overlay')) {\n          dialog.remove();\n        }\n      });\n\n      // \n      dialog.on('click', '#burner-confirm', () => {\n        const amount = parseInt(dialog.find('#burner-amount').val() as string, 10);\n\n        if (isNaN(amount) || amount <= 0) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // subtract add \n        if (!isAddMode && amount > currentResource) {\n          if (window.toastr) window.toastr.error(`:  ${amount},  ${currentResource}`);\n          return;\n        }\n\n        dialog.remove();\n\n        const op: 'add' | 'subtract' = isAddMode ? 'add' : 'subtract';\n        // \n        updateSingleAttribute(rawCharName, burner.resourceName, op, amount).then(result => {\n          if (!result.success) {\n            if (window.toastr) window.toastr.error(`${actionVerb}: ${result.error}`);\n            return;\n          }\n\n          if (window.toastr) window.toastr.success(`${actionVerb} ${amount}  ${burner.resourceName}`);\n\n          // \n          buildAttrButtons(rawCharName);\n\n          // \n          applyBurnerEffect(burner, amount);\n        });\n      });\n\n      // \n      dialog.find('#burner-amount').trigger('focus').trigger('select');\n    };\n\n    // [] \n    const showEffectConfirmDialog = (options: {\n      preset: AdvancedDicePreset;\n      outcomeLabel: string;\n      branchReasonText?: string;\n      effects: ComputedEffect[];\n      onConfirm: () => void;\n      onCancel: () => void;\n    }) => {\n      const { preset, outcomeLabel, branchReasonText, effects, onConfirm, onCancel } = options;\n      const currentThemeClass = `acu-theme-${config.theme}`;\n      const uiCfg = preset.effectConfirmUi || {};\n      const dialogTitle = uiCfg.title || '';\n      const effectListTitle = uiCfg.effectListTitle || ':';\n      const branchReasonLabel = uiCfg.branchReasonLabel || '';\n\n      // \n      $('.acu-confirm-overlay').remove();\n\n      const dialog = $(`\n        <div class=\"acu-edit-overlay acu-confirm-overlay\">\n          <div class=\"acu-edit-dialog ${currentThemeClass}\" style=\"max-width:350px;\">\n            <div class=\"acu-edit-title\">\n              <i class=\"fa-solid fa-clipboard-check\" style=\"color:var(--acu-accent)\"></i>\n              ${escapeHtml(dialogTitle)}\n            </div>\n            <div class=\"acu-settings-content\" style=\"padding:15px;\">\n              <div style=\"margin-bottom:12px;font-weight:bold;font-size:14px;text-align:center;color:var(--acu-text-main);\">\n                ${escapeHtml(outcomeLabel)}\n              </div>\n              ${\n                branchReasonText\n                  ? `<div style=\"margin-bottom:12px;padding:8px 10px;background:var(--acu-card-bg);border-radius:6px;font-size:12px;line-height:1.45;color:var(--acu-text-sub);\"><span style=\"color:var(--acu-text-main);font-weight:bold;\">${escapeHtml(branchReasonLabel)}:</span> ${escapeHtml(branchReasonText)}</div>`\n                  : ''\n              }\n\n              <div style=\"background:var(--acu-card-bg);border-radius:6px;padding:10px;margin-bottom:15px;max-height:200px;overflow-y:auto;\">\n                <div style=\"font-size:12px;color:var(--acu-text-sub);margin-bottom:8px;\">${escapeHtml(effectListTitle)}</div>\n                ${effects\n                  .map(\n                    e => `\n                  <div style=\"padding:8px 0;border-bottom:1px solid var(--acu-border);font-size:13px;display:grid;grid-template-columns:1fr auto;gap:6px 10px;align-items:start;\">\n                    <div style=\"font-weight:bold;color:var(--acu-text-main);min-width:0;\">${escapeHtml(e.resolvedTarget || e.target)}</div>\n                    <div style=\"color:${e.computedValue >= 0 ? 'var(--acu-success-text)' : 'var(--acu-error-text)'};font-weight:bold;text-align:right;white-space:nowrap;\">\n                      ${e.computedValue > 0 ? '+' : ''}${e.computedValue}\n                    </div>\n                    <div style=\"grid-column:1 / -1;font-size:11px;color:var(--acu-text-sub);line-height:1.45;\">\n                      : ${escapeHtml(e.formula)}  : ${escapeHtml(String(e.rolledValue))}<br>\n                      : ${e.beforeValue === null || e.beforeValue === undefined ? '' : escapeHtml(String(e.beforeValue))}\n                      \n                      ${e.afterValue === null || e.afterValue === undefined ? '' : escapeHtml(String(e.afterValue))}\n                      ${e.conditionSummary ? `<br>: ${escapeHtml(e.conditionSummary)}` : ''}\n                    </div>\n                  </div>\n                `,\n                  )\n                  .join('')}\n              </div>\n            </div>\n            <div class=\"acu-dialog-btns\">\n              <button class=\"acu-dialog-btn\" id=\"confirm-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n              <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"confirm-ok\"><i class=\"fa-solid fa-check\"></i> </button>\n            </div>\n          </div>\n        </div>\n      `);\n\n      $('body').append(dialog);\n\n      // \n      dialog.on('click', '#confirm-cancel', () => {\n        dialog.remove();\n        onCancel();\n      });\n\n      //  ()\n      dialog.on('click', '.acu-confirm-overlay', e => {\n        if ($(e.target).hasClass('acu-confirm-overlay')) {\n          dialog.remove();\n          onCancel();\n        }\n      });\n\n      // \n      dialog.on('click', '#confirm-ok', () => {\n        dialog.remove();\n        onConfirm();\n      });\n\n      // ,\n      dialog.find('#confirm-ok').focus();\n    };\n\n    /**\n     * [] \n     * @param outcomeName  ()\n     * @param defaultFormula \n     * @returns ComputedEffect \n     */\n    const resolveEffectConditionPreview = (\n      effect: Effect,\n      effectContext: PendingEffectContext['context'],\n      outcomeName: string,\n    ): Pick<ComputedEffect, 'conditionExpr' | 'resolvedConditionExpr' | 'conditionPassed' | 'conditionSummary'> => {\n      if (!effect.condition || effect.condition.trim() === '') {\n        return {\n          conditionExpr: '',\n          resolvedConditionExpr: '',\n          conditionPassed: true,\n          conditionSummary: `${outcomeName}`,\n        };\n      }\n\n      const rawExpr = effect.condition.trim();\n      const condContext: Record<string, number> = {\n        $roll: effectContext.roll,\n        '$roll.total': effectContext.roll,\n        $attr: effectContext.attributeValue,\n        $mod: effectContext.modifier,\n        $dc: effectContext.dc,\n      };\n      const condResult = evaluateCondition(rawExpr, condContext);\n      const passed =\n        condResult.success &&\n        (typeof condResult.value === 'number' ? condResult.value !== 0 : Boolean(condResult.value));\n\n      const resolvedExpr = rawExpr\n        .replace(/\\$roll\\.total/g, String(effectContext.roll))\n        .replace(/\\$roll/g, String(effectContext.roll))\n        .replace(/\\$attr/g, String(effectContext.attributeValue))\n        .replace(/\\$mod/g, String(effectContext.modifier))\n        .replace(/\\$dc/g, String(effectContext.dc));\n\n      const summary = `${outcomeName} ${resolvedExpr}:${rawExpr}${passed ? '' : ''}`;\n      return {\n        conditionExpr: rawExpr,\n        resolvedConditionExpr: resolvedExpr,\n        conditionPassed: passed,\n        conditionSummary: summary,\n      };\n    };\n\n    const computeEffectsFromInputs = (\n      outcomeName: string,\n      effects: Effect[],\n      effectContext: PendingEffectContext['context'],\n    ): ComputedEffect[] => {\n      const results: ComputedEffect[] = [];\n\n      // \n      const $inputGroup = panel.find(`.acu-effect-value-input[data-outcome=\"${outcomeName}\"]`);\n      const inputValue = $inputGroup.val()?.toString().trim() || '';\n\n      for (const effect of effects) {\n        // ,;\n        const formula = inputValue || String(effect.value || '0');\n        const parsedValue = parseEffectValueInput(formula, `Confirm ${outcomeName}/${effect.id}`);\n        let computedValue = parsedValue.finalValue;\n        const rolledValue = parsedValue.rolledValue;\n        const displayText = parsedValue.valid\n          ? `${parsedValue.formulaText}  ${rolledValue}`\n          : `${parsedValue.formulaText}  (0)`;\n\n        // \n        if (effect.operation === 'subtract') {\n          computedValue = -Math.abs(computedValue);\n        }\n\n        const conditionPreview = resolveEffectConditionPreview(effect, effectContext, outcomeName);\n\n        results.push({\n          effectId: effect.id,\n          target: effect.target,\n          computedValue,\n          rolledValue,\n          formula: parsedValue.formulaText,\n          displayText,\n          ...conditionPreview,\n        });\n      }\n\n      return results;\n    };\n\n    /**\n     * [] \n     * ,\n     */\n    const handleEffectConfirmation = async (pendingCtx: PendingEffectContext): Promise<void> => {\n      const { preset, matchedOutcome, context: effectContext } = pendingCtx;\n      if (!matchedOutcome.effects || matchedOutcome.effects.length === 0) {\n        return;\n      }\n\n      if (activeConfirmEffectRun && activeConfirmEffectRun.runId !== pendingCtx.runId) {\n        const staleRun = activeConfirmEffectRun;\n        setHistoryEffectStateByRun(staleRun, {\n          effectStatus: 'cancelled',\n          effectError: '',\n          effectTrace: [''],\n        });\n        const seq = emitEffectRun({\n          runId: staleRun.runId,\n          status: 'cancelled',\n          characterName: staleRun.context.characterName,\n          attributeName: staleRun.context.attributeName,\n          historyIndex: staleRun.historyIndex,\n          effectResults: [],\n          effectTrace: [''],\n          chainMode: getSecondaryTriggerMode(staleRun.preset),\n          error: '',\n          timestamp: Date.now(),\n        });\n        setHistoryEffectStateByRun(staleRun, { effectEventSeq: seq });\n      }\n      activeConfirmEffectRun = pendingCtx;\n\n      //  ( needsConfirm=true)\n      const needsConfirmEffects = matchedOutcome.effects.filter(e => e.needsConfirm !== false);\n      if (needsConfirmEffects.length === 0) {\n        // , MESSAGE_SENT \n        return;\n      }\n\n      // \n      const aliasCandidates = [...(preset.effectsConfig?.allowedTargets || []), effectContext.attributeName].filter(\n        (name, idx, arr) => Boolean(name) && arr.indexOf(name) === idx,\n      );\n      const computedEffects = computeEffectsFromInputs(matchedOutcome.name, needsConfirmEffects, effectContext).map(\n        eff => {\n          const resolvedTarget = resolveAttributeAliasName(\n            effectContext.characterName,\n            eff.target,\n            aliasCandidates,\n          ).name;\n          const beforeValue = getAttributeValue(effectContext.characterName, eff.target, aliasCandidates);\n          const afterValue = beforeValue === null || beforeValue === undefined ? null : beforeValue + eff.computedValue;\n          return {\n            ...eff,\n            resolvedTarget: resolvedTarget || undefined,\n            beforeValue,\n            afterValue,\n          };\n        },\n      );\n      if (computedEffects.length === 0) {\n        return;\n      }\n\n      // \n      showEffectConfirmDialog({\n        preset,\n        outcomeLabel: `${effectContext.attributeName} : ${matchedOutcome.name}`,\n        branchReasonText: pendingCtx.branchReasonText,\n        effects: computedEffects,\n        onConfirm: async () => {\n          const confirmedRun: PendingEffectContext = {\n            ...pendingCtx,\n            effectOverrides: computedEffects,\n            timestamp: Date.now(),\n          };\n\n          enqueueEffectRun(confirmedRun);\n          setHistoryEffectStateByRun(pendingCtx, {\n            effectStatus: 'confirmed',\n          });\n          const seq = emitEffectRun({\n            runId: pendingCtx.runId,\n            status: 'confirmed',\n            characterName: effectContext.characterName,\n            attributeName: effectContext.attributeName,\n            historyIndex: pendingCtx.historyIndex,\n            effectResults: [],\n            effectTrace: [''],\n            chainMode: getSecondaryTriggerMode(pendingCtx.preset),\n            timestamp: Date.now(),\n          });\n          setHistoryEffectStateByRun(pendingCtx, { effectEventSeq: seq });\n          if (activeConfirmEffectRun?.runId === pendingCtx.runId) {\n            activeConfirmEffectRun = null;\n          }\n          console.info(`[DICE] Effect run confirmed: ${pendingCtx.runId}`);\n\n          // MESSAGE_SENT \n          if (confirmedRun.messageId) {\n            await processPendingEffectRuns(confirmedRun.messageId);\n          } else {\n            console.info(`[DICE][META] confirm waiting MESSAGE_SENT for run=${confirmedRun.runId}`);\n            await processPendingEffectRuns();\n          }\n        },\n        onCancel: () => {\n          setHistoryEffectStateByRun(pendingCtx, { effectStatus: 'cancelled' });\n          const seq = emitEffectRun({\n            runId: pendingCtx.runId,\n            status: 'cancelled',\n            characterName: effectContext.characterName,\n            attributeName: effectContext.attributeName,\n            historyIndex: pendingCtx.historyIndex,\n            effectResults: [],\n            effectTrace: [''],\n            chainMode: getSecondaryTriggerMode(pendingCtx.preset),\n            timestamp: Date.now(),\n          });\n          setHistoryEffectStateByRun(pendingCtx, { effectEventSeq: seq });\n          if (activeConfirmEffectRun?.runId === pendingCtx.runId) {\n            activeConfirmEffectRun = null;\n          }\n          console.info('[DICE] Effect execution cancelled by user');\n        },\n      });\n    };\n\n    /**\n     * [] \n     * \n     */\n    const checkSecondaryEffects = async (\n      preset: AdvancedDicePreset,\n      effectResults: EffectResult[],\n      context: { characterName: string; attributeName: string; attributeValue: number },\n    ): Promise<EffectResult[]> => {\n      return executeSecondaryEffectsChain(preset, effectResults, context);\n    };\n\n    // []  UI\n    const applyBurnerEffect = (burner: ResourceBurner, amount: number) => {\n      const effectValue = amount * burner.ratio;\n      const sign = burner.direction === 'increase' ? 1 : -1;\n      const totalChange = effectValue * sign;\n\n      // \n      // :  roll \n      // \n      //  target (roll),  evaluateOutcomes\n      //  evaluateOutcomes  outcomes  rollTotal\n      //  modifier  ( mod )  target  ( dc )\n      //  roll  modifier\n\n      //  mod  dc \n      if (burner.target === 'mod') {\n        const $modInput = panel.find('#dice-modifier');\n        const currentMod = parseModifier($modInput.val().trim());\n        const newMod = currentMod + totalChange;\n        $modInput.val(newMod >= 0 ? `+${newMod}` : String(newMod));\n        //  (? performAdvancedCheck )\n        //  performAdvancedCheck\n        // \n        // \"\"\"\"\n        // \n        // : \"\" ()\n        // \"\"\n        performAdvancedCheck();\n      } else if (burner.target === 'dc') {\n        const $dcInput = panel.find('#dice-target');\n        const currentDc = parseInt($dcInput.val().trim() || '0', 10);\n        const newDc = currentDc + totalChange;\n        $dcInput.val(newDc);\n        performAdvancedCheck();\n      } else if (burner.target === 'attribute') {\n        // \n        const $attrInput = panel.find('#dice-attr-value');\n        const currentAttr = parseInt($attrInput.val().trim() || '0', 10);\n        const newAttr = currentAttr + totalChange;\n        $attrInput.val(newAttr);\n        performAdvancedCheck();\n      } else if (burner.target === 'roll') {\n        //  roll  modifier \n        // \n        const $modInput = panel.find('#dice-modifier');\n        const currentMod = parseModifier($modInput.val().trim());\n        const newMod = currentMod + totalChange;\n        $modInput.val(newMod >= 0 ? `+${newMod}` : String(newMod));\n        performAdvancedCheck();\n      }\n    };\n\n    // [] \n    const performAdvancedCheck = async function (options?: { isPushed?: boolean }) {\n      if (!currentAdvancedPreset) return;\n\n      const preset = currentAdvancedPreset;\n      const initiatorName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      const attrName = panel.find('#dice-attr-name').val().trim() || '';\n\n      // []  defaultValue ()\n      const resolveDefaultValue = function (\n        defaultValue: number | string | undefined,\n        context: Record<string, number>,\n      ): number {\n        if (defaultValue === undefined) return 0;\n        if (typeof defaultValue === 'number') return defaultValue;\n        // , evaluateFormula \n        const result = evaluateFormula(defaultValue, context);\n        if (result === 0 && defaultValue !== '0' && String(defaultValue) !== '0') {\n          if (window.toastr) {\n            window.toastr.warning(` \"${defaultValue}\" , 0`);\n          }\n        }\n        return result || 0;\n      };\n\n      // 1.  (, defaultValue)\n      let attrValue = 0;\n      const attrInputVal = panel.find('#dice-attr-value').val().trim();\n      if (attrInputVal !== '') {\n        attrValue = parseInt(attrInputVal, 10) || 0;\n      } else if (preset.attribute?.mode === 'fixed' && preset.attribute?.key) {\n        // \n        attrValue = getAttributeValue(initiatorName, preset.attribute.key) || 0;\n      } else {\n        attrValue = resolveDefaultValue(preset.attribute?.defaultValue, {});\n      }\n\n      // 2. DC (hidden , ,  defaultValue)\n      let dc = 0;\n      if (!preset.dc?.hidden) {\n        const dcInputVal = panel.find('#dice-target').val().trim();\n        if (dcInputVal !== '') {\n          dc = parseInt(dcInputVal, 10) || 0;\n        } else if (preset.dc?.mode === 'fixed' && preset.dc?.value !== undefined) {\n          dc = preset.dc.value;\n        } else {\n          dc = resolveDefaultValue(preset.dc?.defaultValue, { $attr: attrValue });\n        }\n      }\n\n      // 3.  (hidden , ,  defaultValue)\n      let mod = 0;\n      if (!preset.mod?.hidden) {\n        const modStr = panel.find('#dice-modifier').val().trim();\n        if (modStr !== '') {\n          mod = parseModifier(modStr);\n        } else {\n          mod = resolveDefaultValue(preset.mod?.defaultValue, { $attr: attrValue });\n        }\n      }\n\n      // 3.3  (hidden )\n      let skillMod = 0;\n      if (preset.skillMod && !preset.skillMod.hidden) {\n        const skillModStr = panel.find('#dice-skill-mod').val().trim();\n        if (skillModStr !== '') {\n          skillMod = parseModifier(skillModStr);\n        } else {\n          skillMod = resolveDefaultValue(preset.skillMod?.defaultValue, { $attr: attrValue });\n        }\n      }\n\n      // 3.5  (DND5e)\n      let attrMod = 0;\n      if ('attribute' in preset && preset.attribute?.computeModifier) {\n        //  computeModifier \n        const modFormula = preset.attribute.computeModifier;\n        //  DND5e : floor(($attr - 10) / 2)\n        if (modFormula.includes('floor') && modFormula.includes('$attr')) {\n          attrMod = Math.floor((attrValue - 10) / 2);\n        } else {\n          attrMod = resolveDefaultValue(modFormula, { $attr: attrValue });\n        }\n      }\n\n      // [] \n      const customValues: Record<string, number | string | boolean> = {};\n      if ('customFields' in preset && Array.isArray(preset.customFields) && preset.customFields.length > 0) {\n        const $customFields = panel.find('.acu-dice-custom-field');\n        $customFields.each(function () {\n          const $el = $(this);\n          const id = $el.data('id');\n          // \n          const fieldConfig = preset.customFields.find(f => f.id === id);\n          if (!fieldConfig) return;\n\n          let val: string | number | boolean;\n          if (fieldConfig.type === 'toggle') {\n            val = $el.prop('checked');\n          } else if (fieldConfig.type === 'number') {\n            const num = parseFloat($el.val() as string);\n            val = isNaN(num) ? (fieldConfig.defaultValue as number) : num;\n          } else if (fieldConfig.type === 'select') {\n            // [] select \n            const rawVal = $el.val() as string;\n            const num = parseFloat(rawVal);\n            val = isNaN(num) ? rawVal : num;\n          } else {\n            const rawVal = String($el.val() ?? '').trim();\n            if (rawVal === '' && fieldConfig.defaultValue !== undefined && fieldConfig.defaultValue !== '') {\n              val = fieldConfig.defaultValue as string | number | boolean;\n            } else {\n              val = rawVal;\n            }\n          }\n          customValues['$' + id] = val; //  $ \n        });\n      }\n\n      // []  ()\n      const baseContext = {\n        $attr: attrValue,\n        $attrMod: attrMod,\n        $skillMod: skillMod,\n        $dc: dc,\n        $mod: mod,\n        ...customValues,\n      };\n      const derivedValues: Record<string, number> = {};\n      if ('derivedVars' in preset && Array.isArray(preset.derivedVars) && preset.derivedVars.length > 0) {\n        preset.derivedVars.forEach(spec => {\n          const id = spec?.id?.trim();\n          if (!id) return;\n          const varName = id.startsWith('$') ? id : `$${id}`;\n          const evalResult = evaluateCondition(spec.expr, { ...baseContext, ...derivedValues });\n          if (!evalResult.success) {\n            console.warn(`[DICE]  ${varName} :`, evalResult.error);\n            derivedValues[varName] = 0;\n            return;\n          }\n          const rawValue = evalResult.value;\n          const numericValue = typeof rawValue === 'number' && Number.isFinite(rawValue) ? rawValue : rawValue ? 1 : 0;\n          derivedValues[varName] = numericValue;\n        });\n      }\n      const extraValues = { ...customValues, ...derivedValues };\n\n      let diceExpression = preset.diceExpression;\n      if ('dicePatches' in preset && Array.isArray(preset.dicePatches) && preset.dicePatches.length > 0) {\n        const patchContext = { ...baseContext, ...derivedValues };\n        const replacePatchTemplate = (template: string): string => {\n          const varPattern = /\\$[a-zA-Z_]\\w*/g;\n          return template.replace(varPattern, match => {\n            const value = patchContext[match];\n            return typeof value === 'number' && Number.isFinite(value) ? String(value) : '0';\n          });\n        };\n\n        preset.dicePatches.forEach(patch => {\n          if (!patch) return;\n          if (patch.when) {\n            const conditionResult = evaluateCondition(patch.when, patchContext);\n            if (!conditionResult.success) {\n              console.warn('[DICE] dicePatches :', conditionResult.error);\n              return;\n            }\n            const shouldApply =\n              typeof conditionResult.value === 'number' ? conditionResult.value !== 0 : Boolean(conditionResult.value);\n            if (!shouldApply) return;\n          }\n\n          const resolvedTemplate = replacePatchTemplate(patch.template ?? '');\n          switch (patch.op) {\n            case 'append':\n              diceExpression = `${diceExpression}${resolvedTemplate}`;\n              break;\n            case 'prepend':\n              diceExpression = `${resolvedTemplate}${diceExpression}`;\n              break;\n            case 'replace':\n              diceExpression = resolvedTemplate;\n              break;\n          }\n        });\n      }\n\n      // 4. \n      const rollResult = rollComplexDiceExpression(diceExpression);\n      const rollTotal = rollResult.total;\n\n      // []  $roll.total  chaos = 6 - $roll.total\n      const postRollDerivedValues: Record<string, number> = {};\n      if ('derivedVars' in preset && Array.isArray(preset.derivedVars) && preset.derivedVars.length > 0) {\n        const postRollContext = {\n          $roll: rollResult,\n          '$roll.total': rollTotal, //  $roll.total \n          ...baseContext,\n          ...customValues,\n        };\n        preset.derivedVars.forEach(spec => {\n          const id = spec?.id?.trim();\n          if (!id) return;\n          const varName = id.startsWith('$') ? id : `$${id}`;\n          const evalResult = evaluateCondition(spec.expr, { ...postRollContext, ...postRollDerivedValues });\n          if (!evalResult.success) {\n            console.warn(`[DICE]  ${varName} () :`, evalResult.error);\n            postRollDerivedValues[varName] = 0;\n            return;\n          }\n          const rawValue = evalResult.value;\n          const numericValue = typeof rawValue === 'number' && Number.isFinite(rawValue) ? rawValue : rawValue ? 1 : 0;\n          postRollDerivedValues[varName] = numericValue;\n        });\n      }\n\n      // 5. \n      const isPushed = options?.isPushed ?? false;\n      const context = {\n        $roll: rollResult, // \n        '$roll.total': rollTotal, //  $roll.total\n        $isPushed: isPushed ? 1 : 0, //  (1=,0=)\n        ...baseContext,\n        ...postRollDerivedValues, // \n      };\n\n      // :  outcomes \n      let outcomeText: string;\n      let resultType: string;\n      let isSuccess = false;\n      let matchedOutcome: OutcomeLevel | undefined;\n      let conditionExpr = '';\n      let displayExprResult = true; // displayExpr \"/\"\n      let branchReasonText = '';\n\n      if ('outcomes' in preset && Array.isArray(preset.outcomes) && preset.outcomes.length > 0) {\n        // :  evaluateOutcomes\n        matchedOutcome = evaluateOutcomes(preset.outcomes, context);\n        // []  unmet\n        const originalOutcome = matchedOutcome;\n        // []  outcome\n        let requiredOutcome: OutcomeLevel | undefined;\n\n        //  outcomePolicy\n        if (preset.outcomePolicy?.kind === 'minRank') {\n          const requiredRankVarId = preset.outcomePolicy.requiredRankVarId;\n          // [] customFields  context  $ \n          //  requiredRankVarId='requiredRank' context  '$requiredRank'\n          const varKey = requiredRankVarId.startsWith('$') ? requiredRankVarId : `$${requiredRankVarId}`;\n          const requiredRank = context[varKey] ?? 0;\n          // []  rank0-4 contestRank20-100\n          // rank: 0=, 1=, 2=, 3=, 4=\n          // requiredRank: 0=, 1=, 2=, 3=\n          const actualRank = matchedOutcome.rank ?? 0;\n\n          // []  outcome\n          if (requiredRank > 0) {\n            requiredOutcome = preset.outcomes.find(o => o.rank === requiredRank);\n          }\n\n          // []  rank 1-3//\n          // (rank=4)(rank=-1)(rank=0) \n          if (actualRank >= 1 && actualRank < requiredRank) {\n            const unmetOutcomeId = preset.outcomePolicy.unmetOutcomeId;\n            const fallbackOutcome = preset.outcomes.find(o => o.id === unmetOutcomeId);\n            if (fallbackOutcome) {\n              matchedOutcome = fallbackOutcome;\n            }\n          }\n        }\n\n        outcomeText = matchedOutcome.name || '';\n        //  displayExpr condition \n        // []  unmet \"\"\n        // \"\"\n        const isUnmet = matchedOutcome !== originalOutcome;\n        const displaySourceOutcome = isUnmet && requiredOutcome ? requiredOutcome : matchedOutcome;\n        const displayExpr = displaySourceOutcome.displayExpr ?? displaySourceOutcome.condition;\n\n        // []  ()\n        conditionExpr = displayExpr;\n        //  $roll.hasTag()  ( $roll )\n        if (context.$roll && typeof context.$roll === 'object') {\n          const roll = context.$roll as RollResult;\n          conditionExpr = conditionExpr.replace(/\\$roll\\.hasTag\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*\\)/gi, (_match, tag) => {\n            return (roll.tags ?? []).includes(tag) ? '' : '';\n          });\n        }\n        //  (: $roll.total  $roll )\n        conditionExpr = conditionExpr\n          .replace(/\\$roll\\.total/g, String(rollTotal))\n          .replace(/\\$roll/g, String(rollTotal))\n          .replace(/\\$attrMod/g, String(attrMod))\n          .replace(/\\$skillMod/g, String(skillMod))\n          .replace(/\\$attr/g, String(attrValue))\n          .replace(/\\$dc/g, String(dc))\n          .replace(/\\$mod/g, String(mod));\n\n        // \n        Object.keys(extraValues).forEach(key => {\n          //  ( $ )\n          const safeKey = key.replace('$', '\\\\$');\n          const regex = new RegExp(safeKey, 'g');\n          conditionExpr = conditionExpr.replace(regex, String(extraValues[key]));\n        });\n\n        // []  \"+ 0\" \n        //  \"3 + 2 + 13 + 0 >= 10\" -> \"3 + 2 + 13 >= 10\"\n        conditionExpr = conditionExpr\n          .replace(/\\s*\\+\\s*0(?=\\s*[+\\->=<]|\\s*$)/g, '') //  \"+ 0\" ()\n          .replace(/^\\s*0\\s*\\+\\s*/g, ''); //  \"0 +\"\n\n        //  displayExpr \"/\"\n        const displayExprEvalResult = evaluateCondition(displayExpr, context);\n        displayExprResult =\n          displayExprEvalResult.success &&\n          (typeof displayExprEvalResult.value === 'number'\n            ? displayExprEvalResult.value !== 0\n            : Boolean(displayExprEvalResult.value));\n        branchReasonText = `${matchedOutcome.name} ${conditionExpr || displayExpr}${displayExprResult ? '' : ''}`;\n        //  priority  resultType  isSuccess ( CSS )\n        if (matchedOutcome.priority <= 10) {\n          resultType = 'critSuccess';\n          isSuccess = true;\n        } else if (matchedOutcome.priority <= 30) {\n          resultType = 'extremeSuccess';\n          isSuccess = true;\n        } else if (matchedOutcome.priority < 50) {\n          resultType = 'success';\n          isSuccess = true;\n        } else if (matchedOutcome.priority === 50) {\n          resultType = 'warning';\n          isSuccess = false;\n        } else if (matchedOutcome.priority < 90) {\n          resultType = 'failure';\n          isSuccess = false;\n        } else {\n          resultType = 'critFailure';\n          isSuccess = false;\n        }\n      } else {\n        // : \n        outcomeText = '';\n        resultType = 'warning';\n        branchReasonText = '';\n        console.warn('[DICE]  outcomes');\n      }\n\n      // 5. \n      const finalValue = rollTotal + attrValue + skillMod + mod;\n\n      //  ( outcome.style.color, CSS )\n      const badgeClass = getResultBadgeClass(resultType);\n      const diceCfg = getDiceConfig();\n      const hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const displayValue = hideDiceResultFromUser ? '' : rollTotal;\n      const displayOutcomeText = hideDiceResultFromUser ? '' : outcomeText;\n\n      // \n      // :  conditionExpr ( 21 <= 64)\n      // : \n      // : \n      const exprDisplay = isComplexCondition(conditionExpr) ? '' : conditionExpr;\n      const displayExpr = hideDiceResultFromUser ? '' : exprDisplay;\n\n      // \n      const $rollBtn = panel.find('#dice-roll-btn');\n      $rollBtn.html(`\n        <div class=\"acu-dice-result-display\">\n          <span class=\"acu-dice-result-value\">${displayValue}</span>\n          <span class=\"acu-dice-result-target\" style=\"font-size: 11px;\">${escapeHtml(displayExpr)}</span>\n          ${displayOutcomeText ? `<span class=\"${badgeClass}\">${displayOutcomeText}</span>` : ''}\n          <button class=\"dice-retry-btn acu-dice-retry-btn\" title=\"\">\n            <i class=\"fa-solid fa-rotate-right\"></i>\n          </button>\n        </div>\n      `);\n\n      // \n      $rollBtn.off('click', '.dice-retry-btn').on('click', '.dice-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        performAdvancedCheck();\n      });\n\n      // []  ()\n      if (preset.resourceBurners && preset.resourceBurners.length > 0) {\n        // \n        const burnerContext = {\n          ...context, //  context ( $roll, $roll.total, $attr )\n        };\n\n        const burnersHtml = renderResourceBurnerButtons(preset, burnerContext, matchedOutcome, attrName);\n        if (burnersHtml) {\n          // \n          const $burners = $(burnersHtml);\n          $rollBtn.find('.acu-dice-result-display').append($burners);\n\n          // \n          $burners.find('.acu-dice-burner-btn').on('click', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            const burnerId = $(this).data('id');\n            const burner = preset.resourceBurners?.find(b => b.id === burnerId);\n            if (burner) {\n              handleResourceBurnerClick(burner, burnerContext);\n            }\n          });\n        }\n      }\n\n      // []  (Pushed Roll)   outcome ID  isSuccess \n      if (\n        preset.pushedRoll?.enabled &&\n        !isPushed && // push\n        matchedOutcome &&\n        !matchesCheckSelector(attrName, {\n          namePatterns: { include: preset.pushedRoll.excludePatterns ?? [] },\n        }) // \n      ) {\n        const outcomeId = matchedOutcome.id;\n        // : blockedOutcomes > pushableOutcomes > legacy fallback (!isSuccess)\n        const blockedOutcomes =\n          preset.pushedRoll.blockedOutcomes ?? (preset.pushedRoll.blockOnCritFailure !== false ? ['crit_failure'] : []);\n        const isBlocked = blockedOutcomes.includes(outcomeId);\n        const isPushable = preset.pushedRoll.pushableOutcomes\n          ? preset.pushedRoll.pushableOutcomes.includes(outcomeId)\n          : !isSuccess; // legacy fallback\n        if (isPushable && !isBlocked) {\n          const $pushBtn = $(`\n           <button class=\"acu-dice-burner-btn\" title=\"\">\n             <i class=\"fa-solid fa-skull\"></i>\n           </button>\n         `);\n          //  burners \n          let $burnersContainer = $rollBtn.find('.acu-dice-burners');\n          if (!$burnersContainer.length) {\n            $burnersContainer = $('<span class=\"acu-dice-burners\"></span>');\n            $rollBtn.find('.acu-dice-result-display').append($burnersContainer);\n          }\n          $burnersContainer.append($pushBtn);\n          $pushBtn.on('click', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            performAdvancedCheck({ isPushed: true });\n          });\n        }\n      }\n\n      //  ()\n      // judgeResultText  displayExpr \n      const judgeResultText = displayExprResult ? '' : '';\n      const template =\n        'outputTemplate' in preset && preset.outputTemplate ? preset.outputTemplate : DEFAULT_OUTPUT_TEMPLATE;\n      // pushed:  outcome ID  outcomeLabelsfallback  '*' \n      const pushedLabel =\n        isPushed && matchedOutcome\n          ? (preset.pushedRoll?.outcomeLabels?.[matchedOutcome.id] ?? preset.pushedRoll?.outcomeLabels?.['*'] ?? '')\n          : '';\n      const outcomeTextRaw = (pushedLabel ? pushedLabel + '\\n' : '') + (matchedOutcome?.outputText ?? '');\n      // attrMod ( +3  -1)\n      const attrModStr = attrMod >= 0 ? `+${attrMod}` : String(attrMod);\n      // skillMod\n      const skillModStr = skillMod >= 0 ? `+${skillMod}` : String(skillMod);\n\n      // [] 0\n      // skillModText: skillMod0 \"++N\"\n      const skillModText = skillMod !== 0 ? `+${skillModStr}` : '';\n      // modText: mod0 \"++N\"\n      const modText = mod !== 0 ? `+${mod >= 0 ? '+' + mod : mod}` : '';\n      // attrModText: attrMod0 \"(+N)\"\n      const attrModText = attrMod !== 0 ? `(${attrModStr})` : '';\n\n      // []  outputContext  $ \n      const derivedOutputVars: Record<string, number> = {};\n      Object.entries(postRollDerivedValues).forEach(([key, value]) => {\n        const cleanKey = key.startsWith('$') ? key.slice(1) : key;\n        derivedOutputVars[cleanKey] = value;\n      });\n      const customOutputVars: Record<string, string | number | boolean> = {};\n      Object.entries(customValues).forEach(([key, value]) => {\n        const cleanKey = key.startsWith('$') ? key.slice(1) : key;\n        customOutputVars[cleanKey] = value;\n      });\n\n      // [] \n      const effectVars = computePendingEffectVariables(matchedOutcome?.effects);\n\n      const outputContext = {\n        initiator: initiatorName,\n        attrName: `${attrName}`,\n        attrValue: attrValue,\n        attrMod: attrModStr,\n        skillMod: skillModStr,\n        // [] \n        skillModText: skillModText,\n        modText: modText,\n        attrModText: attrModText,\n        formula: diceExpression,\n        roll: rollTotal,\n        'roll.total': rollTotal, // []  $roll.total \n        dc: dc,\n        mod: mod,\n        attr: attrValue,\n        conditionExpr: conditionExpr,\n        judgeResult: judgeResultText,\n        outcomeName: outcomeText,\n        outcomeText: outcomeTextRaw,\n        ...customOutputVars,\n        ...derivedOutputVars, // []  chaos\n        ...effectVars, // [] \n      };\n      // []  outcomeText $growthGain\n      outputContext.outcomeText = formatOutputTemplate(String(outputContext.outcomeText || ''), outputContext);\n      const diceResultText = formatOutputTemplate(template, outputContext);\n      smartInsertToTextarea(diceResultText, 'dice');\n\n      // \n      const checkResult: AcuDice.CheckResult = {\n        success: isSuccess,\n        total: rollTotal,\n        target: dc,\n        outcomeText,\n        attrName,\n        criteria: 'advanced',\n        isAutoTarget: false,\n        formula: diceExpression,\n      };\n\n      // \n      const detailId = `check_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n      const checkResultWithTimestamp = {\n        ...checkResult,\n        timestamp: Date.now(),\n        detailId,\n        initiatorName,\n        historyType: 'check' as const,\n        detailLines: [\n          `: ${initiatorName}`,\n          `: ${attrName} (=${attrValue})`,\n          `: ${diceExpression}`,\n          `: ${rollTotal}`,\n          `: ${dc}`,\n          `: attrMod=${attrModStr}, skillMod=${skillModStr}, mod=${mod >= 0 ? '+' + mod : mod}`,\n          `: ${judgeResultText || outcomeText}`,\n          `: ${outcomeText}`,\n        ],\n        ...(isPushed ? { isPushed: true } : {}),\n      };\n      checkHistory.push(checkResultWithTimestamp);\n      if (checkHistory.length > MAX_HISTORY) {\n        checkHistory.shift();\n      }\n\n      // \n      emitEvent('check', checkResultWithTimestamp);\n\n      // \n      // []  effectsConfig.triggerPatterns\n      const shouldTriggerEffects =\n        preset.effectsConfig &&\n        matchedOutcome &&\n        matchedOutcome.effects &&\n        matchedOutcome.effects.length > 0 &&\n        matchesCheckSelector(attrName, {\n          namePatterns: { include: preset.effectsConfig.triggerPatterns },\n        });\n\n      if (shouldTriggerEffects) {\n        const historyIndex = checkHistory.length - 1;\n        const runId = `effect_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n        const effectContext = {\n          characterName: initiatorName,\n          attributeName: attrName,\n          attributeValue: attrValue,\n          roll: rollResult.total,\n          modifier: mod,\n          dc,\n        };\n\n        const pendingCtx: PendingEffectContext = {\n          runId,\n          historyIndex,\n          preset,\n          matchedOutcome,\n          context: effectContext,\n          branchReasonText,\n          timestamp: Date.now(),\n        };\n\n        setHistoryEffectState(historyIndex, {\n          effectStatus: 'planned',\n          effectRunId: runId,\n          effectResults: [],\n          effectError: undefined,\n          effectTrace: undefined,\n        });\n        const plannedSeq = emitEffectRun({\n          runId,\n          status: 'planned',\n          characterName: initiatorName,\n          attributeName: attrName,\n          historyIndex,\n          effectResults: [],\n          effectTrace: [''],\n          chainMode: getSecondaryTriggerMode(preset),\n          timestamp: Date.now(),\n        });\n        setHistoryEffectState(historyIndex, { effectEventSeq: plannedSeq });\n\n        // [] \n        const hasConfirmableEffects = matchedOutcome.effects.some(e => e.needsConfirm !== false);\n\n        if (hasConfirmableEffects) {\n          // , ()\n          handleEffectConfirmation(pendingCtx);\n          console.info(\n            `[DICE] ${matchedOutcome.effects.length} effects pending user confirmation for ${initiatorName}`,\n          );\n        } else {\n          // ,\n          enqueueEffectRun(pendingCtx);\n          setHistoryEffectState(historyIndex, {\n            effectStatus: 'confirmed',\n          });\n          const confirmedSeq = emitEffectRun({\n            runId,\n            status: 'confirmed',\n            characterName: initiatorName,\n            attributeName: attrName,\n            historyIndex,\n            effectResults: [],\n            effectTrace: [''],\n            chainMode: getSecondaryTriggerMode(preset),\n            timestamp: Date.now(),\n          });\n          setHistoryEffectState(historyIndex, { effectEventSeq: confirmedSeq });\n          console.info(`[DICE] Queued ${matchedOutcome.effects.length} auto-execute effects for ${initiatorName}`);\n        }\n      }\n\n      if (preset.currentAttrAutoUpdate && preset.currentAttrAutoUpdate.enabled !== false) {\n        const autoUpdate = preset.currentAttrAutoUpdate;\n        const when = autoUpdate.when || 'always';\n        const shouldApply =\n          when === 'always' || (when === 'success' && isSuccess) || (when === 'failure' && !isSuccess);\n        if (shouldApply) {\n          const autoContext: Record<string, string | number | boolean> = {\n            $roll: rollTotal,\n            '$roll.total': rollTotal,\n            $attr: attrValue,\n            $dc: dc,\n            $mod: mod,\n            $success: isSuccess ? 1 : 0,\n            ...customValues,\n          };\n          const resolvedExpr = resolveExpressionWithContext(autoUpdate.valueExpr, autoContext);\n          const changeValue = parseModifier(resolvedExpr);\n          const aliasCandidates = autoUpdate.aliasCandidates || [];\n          const resolvedAlias = resolveAttributeAliasName(initiatorName, attrName, aliasCandidates).name;\n          const targetAttr = resolvedAlias || attrName;\n          const beforeValueRaw = getAttributeValue(initiatorName, attrName, aliasCandidates);\n          const beforeValue =\n            beforeValueRaw === null || beforeValueRaw === undefined ? (autoUpdate.initValue ?? 0) : beforeValueRaw;\n\n          let previewAfterValue = beforeValue;\n          if (autoUpdate.operation === 'add') {\n            previewAfterValue = beforeValue + changeValue;\n          } else if (autoUpdate.operation === 'subtract') {\n            previewAfterValue = beforeValue - changeValue;\n          } else {\n            previewAfterValue = changeValue;\n          }\n          const minValue = autoUpdate.min ?? 0;\n          const maxValue = autoUpdate.max ?? Infinity;\n          previewAfterValue = Math.max(minValue, Math.min(maxValue, previewAfterValue));\n          const previewDelta = previewAfterValue - beforeValue;\n\n          const computedAutoEffect: ComputedEffect = {\n            effectId: `auto_${autoUpdate.operation}`,\n            target: attrName,\n            resolvedTarget: targetAttr,\n            computedValue: previewDelta,\n            rolledValue: changeValue,\n            formula: resolvedExpr || '0',\n            displayText: `${resolvedExpr || '0'}  ${changeValue}`,\n            beforeValue,\n            afterValue: previewAfterValue,\n            conditionSummary: `${matchedOutcome?.name || outcomeText}`,\n          };\n\n          const confirmed = await new Promise<boolean>(resolve => {\n            showEffectConfirmDialog({\n              preset,\n              outcomeLabel: `${attrName} : ${matchedOutcome?.name || outcomeText}`,\n              branchReasonText,\n              effects: [computedAutoEffect],\n              onConfirm: () => resolve(true),\n              onCancel: () => resolve(false),\n            });\n          });\n\n          if (confirmed) {\n            const updateResult = await updateSingleAttribute(\n              initiatorName,\n              attrName,\n              autoUpdate.operation,\n              changeValue,\n              {\n                initValue: autoUpdate.initValue,\n                min: autoUpdate.min,\n                max: autoUpdate.max,\n                aliasCandidates,\n              },\n            );\n            if (updateResult.success) {\n              const finalAttr = updateResult.resolvedAttrName || attrName;\n              const delta = updateResult.newValue - updateResult.oldValue;\n              const changeLabel =\n                String(autoUpdate.changeLabel || '').trim() ||\n                (autoUpdate.operation === 'add' ? '' : autoUpdate.operation === 'subtract' ? '' : '');\n              const exprRaw = String(resolvedExpr || '').trim();\n              const rolledText = String(changeValue);\n              const exprNormalized = exprRaw.replace(/\\s+/g, '');\n              const exprWithRoll =\n                exprRaw && exprNormalized !== rolledText ? `${exprRaw}=${rolledText}` : exprRaw || rolledText;\n\n              const settledContext: Record<string, string | number | undefined> = {\n                attr: `${finalAttr}`,\n                attrPlain: finalAttr,\n                old: updateResult.oldValue,\n                new: updateResult.newValue,\n                delta,\n                expr: exprRaw || rolledText,\n                rolled: changeValue,\n                operation: autoUpdate.operation,\n                changeLabel,\n              };\n\n              const settledTemplate = String(autoUpdate.outputTextTemplate || '').trim();\n              const settledLine =\n                settledTemplate !== ''\n                  ? formatOutputTemplate(settledTemplate, settledContext).trim()\n                  : `${finalAttr}${updateResult.oldValue}${updateResult.newValue}${changeLabel}${exprWithRoll}`;\n\n              const autoRunId = `autoupdate_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n              const injected = injectEffectLinesIntoTextarea(autoRunId, [settledLine]);\n              if (!injected) {\n                smartInsertToTextarea(settledLine, 'dice');\n              }\n\n              //  + \n              const currentAttrName = String(panel.find('#dice-attr-name').val() || '').trim();\n              if (currentAttrName === attrName || currentAttrName === finalAttr) {\n                panel.find('#dice-attr-value').val(String(updateResult.newValue)).trigger('change');\n              }\n              buildAttrButtons(initiatorName);\n\n              if (window.toastr) {\n                window.toastr.success(\n                  ` ${finalAttr}: ${updateResult.oldValue} -> ${updateResult.newValue}`,\n                );\n              }\n            } else if (window.toastr) {\n              window.toastr.warning(`: ${updateResult.error || ''}`);\n            }\n          } else if (window.toastr) {\n            window.toastr.info('');\n          }\n        }\n      }\n\n      if (onResult) {\n        onResult(checkResult);\n      }\n    };\n\n    // [] \n    const performCustomRoll = function () {\n      const $btn = panel.find('#dice-roll-btn');\n\n      // \n      const diceExpr = panel.find('#custom-dice-expr').val().trim() || '1d100';\n      const judgeMode = panel.find('#custom-judge-mode').val() as string;\n      const targetValueStr = panel.find('#custom-target-value').val().trim();\n      const initiatorName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      const attrName = panel.find('#dice-attr-name').val().trim() || '';\n\n      // \n      const expectedValue = calculateDiceExpectedValue(diceExpr);\n      const autoTargetValue = Number.isFinite(expectedValue) ? Math.floor(expectedValue) : null;\n      const targetValue = targetValueStr !== '' ? parseInt(targetValueStr, 10) : autoTargetValue;\n      const hasJudgement = judgeMode !== 'none' && targetValue !== null && !isNaN(targetValue);\n\n      //  -  rollComplexDiceExpression  2d6+33\n      const rollResult = rollComplexDiceExpression(diceExpr);\n      if (isNaN(rollResult.total)) {\n        if (window.toastr) window.toastr.error(`: ${diceExpr}`);\n        return;\n      }\n\n      const rollTotal = rollResult.total;\n\n      // \n      let isSuccess = false;\n      let judgeResultText = '';\n\n      if (hasJudgement) {\n        switch (judgeMode) {\n          case '>=':\n            isSuccess = rollTotal >= targetValue;\n            judgeResultText = isSuccess ? '' : '';\n            break;\n          case '<=':\n            isSuccess = rollTotal <= targetValue;\n            judgeResultText = isSuccess ? '' : '';\n            break;\n          case '>':\n            isSuccess = rollTotal > targetValue;\n            judgeResultText = isSuccess ? '' : '';\n            break;\n          case '<':\n            isSuccess = rollTotal < targetValue;\n            judgeResultText = isSuccess ? '' : '';\n            break;\n          default:\n            judgeResultText = '';\n        }\n      }\n\n      //  -  meta \n      const displayInitiator = replaceUserPlaceholders(initiatorName);\n      const displayAttrName = attrName || '';\n      let outputText: string;\n\n      if (hasJudgement) {\n        const conditionExpr = `${rollTotal} ${judgeMode} ${targetValue}`;\n        const judgeResultCN = isSuccess ? '' : '';\n        outputText = `<meta:>\\n${displayInitiator}  ${displayAttrName} ${diceExpr}=${rollTotal} ${conditionExpr}${judgeResultCN}${judgeResultText}\\n</meta:>`;\n      } else {\n        // \n        outputText = `<meta:>\\n${displayInitiator}  ${displayAttrName} ${diceExpr}=${rollTotal}\\n</meta:>`;\n      }\n\n      // \n      smartInsertToTextarea(outputText, 'dice');\n\n      // \n      const badgeClass = hasJudgement\n        ? isSuccess\n          ? 'acu-dice-result-badge success'\n          : 'acu-dice-result-badge failure'\n        : '';\n      const diceCfg = getDiceConfig();\n      const hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const displayValue = hideDiceResultFromUser ? '' : rollTotal;\n      const displayOutcome = hideDiceResultFromUser ? '' : judgeResultText;\n\n      // \n      $btn.html(`\n        <div class=\"acu-dice-result-display\">\n          <span class=\"acu-dice-result-value\">${displayValue}</span>\n          ${hasJudgement && displayOutcome ? `<span class=\"${badgeClass}\">${displayOutcome}</span>` : ''}\n          <button class=\"dice-retry-btn acu-dice-retry-btn\" title=\"\">\n            <i class=\"fa-solid fa-rotate-right\"></i>\n          </button>\n        </div>\n      `);\n\n      // \n      $btn.off('click', '.dice-retry-btn').on('click', '.dice-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        performCustomRoll();\n      });\n\n      // \n      const checkResult: AcuDice.CheckResult = {\n        success: isSuccess,\n        total: rollTotal,\n        target: targetValue ?? 0,\n        outcomeText: judgeResultText,\n        attrName,\n        criteria: 'custom',\n        isAutoTarget: false,\n        formula: diceExpr,\n      };\n\n      // \n      const detailId = `check_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n      const checkResultWithTimestamp = {\n        ...checkResult,\n        timestamp: Date.now(),\n        detailId,\n        initiatorName,\n        historyType: 'check' as const,\n        detailLines: [\n          `: ${initiatorName}`,\n          `: ${attrName}`,\n          `: ${diceExpr}`,\n          `: ${rollTotal}`,\n          hasJudgement ? `: ${rollTotal} ${judgeMode} ${targetValue}` : ': ',\n          hasJudgement ? `: ${judgeResultText}` : ': ',\n        ],\n      };\n      checkHistory.push(checkResultWithTimestamp);\n      if (checkHistory.length > MAX_HISTORY) {\n        checkHistory.shift();\n      }\n\n      // \n      emitEvent('check', checkResultWithTimestamp);\n\n      if (onResult) {\n        onResult(checkResult);\n      }\n    };\n\n    let lastDiceRollAt = 0;\n    // \n    const performDiceRoll = function () {\n      const $btn = panel.find('#dice-roll-btn');\n      const now = Date.now();\n      if (now - lastDiceRollAt < 100) return;\n      lastDiceRollAt = now;\n      if ($btn.prop('disabled')) return;\n\n      // \n      $btn.prop('disabled', true).addClass('disabled');\n      setTimeout(() => {\n        $btn.prop('disabled', false).removeClass('disabled');\n      }, 100);\n\n      // [] ,\n      if (currentAdvancedPreset) {\n        performAdvancedCheck();\n        return;\n      }\n\n      // [] ,\n      if (panel.find('#acu-dice-custom-mode-fields').is(':visible')) {\n        performCustomRoll();\n        return;\n      }\n\n      const formula = panel.find('#dice-formula').val().trim() || '1d100';\n      const modStr = panel.find('#dice-modifier').val().trim() || '0';\n      const mod = parseModifier(modStr);\n      const attrName = panel.find('#dice-attr-name').val().trim() || '';\n      const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n      const difficulty = panel.find('#dice-difficulty').val() || 'normal';\n\n      // \n      const isDND = criteria === 'gte';\n\n      // \n      const diceCfg = getDiceConfig();\n      const hardDiv = diceCfg.difficultSuccessDiv || 2;\n      const extremeDiv = diceCfg.hardSuccessDiv || 5;\n      // COC:   critSuccessMax,   critFailMin\n      // DND:   dndCritSuccess,   dndCritFail\n      const critSuccessMax = isDND ? diceCfg.dndCritFail || 1 : diceCfg.critSuccessMax || 5;\n      const critFailMin = isDND ? diceCfg.dndCritSuccess || 20 : diceCfg.critFailMin || 96;\n\n      // COC  DND \n      let targetInputVal = panel.find('#dice-target').val().trim();\n      let attrInputVal = panel.find('#dice-attr-value').val().trim();\n      let attrValue = attrInputVal !== '' ? parseInt(attrInputVal, 10) : 0;\n      let target;\n      let isAutoTarget = false;\n\n      // \n      const getDefaultTarget = formulaStr => {\n        const match = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (match) {\n          const maxRoll = parseInt(match[1], 10) * parseInt(match[2], 10);\n          return Math.round(maxRoll / 2);\n        }\n        return 50;\n      };\n\n      if (targetInputVal !== '') {\n        // /DC\n        const parsedTarget = parseInt(targetInputVal, 10);\n        target = !Number.isNaN(parsedTarget) ? parsedTarget : getDefaultTarget(formula);\n      } else if (isDND) {\n        // DND  DC = 10\n        target = 10;\n        isAutoTarget = true;\n      } else {\n        // COC  = \n        if (attrValue > 0) {\n          target = attrValue;\n          isAutoTarget = true;\n        } else {\n          target = getDefaultTarget(formula);\n          isAutoTarget = true;\n        }\n      }\n\n      const result = rollDice(formula);\n      const finalValue = result.total + mod;\n\n      // \n      let requiredTarget = target;\n      let difficultyLabel = '';\n      let difficultyDiv = 1;\n\n      // DND \n      if (!isDND) {\n        switch (difficulty) {\n          case 'hard':\n            requiredTarget = Math.floor(target / hardDiv);\n            difficultyLabel = '';\n            difficultyDiv = hardDiv;\n            break;\n          case 'extreme':\n            requiredTarget = Math.floor(target / extremeDiv);\n            difficultyLabel = '';\n            difficultyDiv = extremeDiv;\n            break;\n          case 'critical':\n            requiredTarget = critSuccessMax;\n            difficultyLabel = '';\n            break;\n          default:\n            difficultyLabel = '';\n            break;\n        }\n      }\n\n      // \n      let isCritSuccess = false;\n      let isCritFailure = false;\n      let isSuccess = false;\n      let outcomeText = '';\n      let outcomeClass = '';\n\n      // /\n      if (isDND) {\n        // DND:   20  1\n        isCritSuccess = finalValue >= critFailMin; //  critFailMin  DND \n        isCritFailure = finalValue <= critSuccessMax; //  critSuccessMax  DND \n      } else {\n        // COC:   5  96\n        isCritSuccess = finalValue <= critSuccessMax;\n        isCritFailure = finalValue >= critFailMin;\n      }\n\n      // /\n      if (isDND) {\n        isSuccess = finalValue >= requiredTarget;\n      } else {\n        isSuccess = finalValue <= requiredTarget;\n      }\n\n      // \n      if (isCritSuccess) {\n        outcomeText = '';\n        outcomeClass = 'success';\n        isSuccess = true;\n      } else if (isCritFailure) {\n        outcomeText = '';\n        outcomeClass = 'failure';\n        isSuccess = false;\n      } else if (isSuccess) {\n        if (isDND) {\n          outcomeText = '';\n        } else if (difficulty === 'hard') {\n          outcomeText = '';\n        } else if (difficulty === 'extreme') {\n          outcomeText = '';\n        } else {\n          // \n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            outcomeText = '';\n          } else if (finalValue <= hardTarget) {\n            outcomeText = '';\n          } else {\n            outcomeText = '';\n          }\n        }\n        outcomeClass = 'success';\n      } else {\n        outcomeText = '';\n        outcomeClass = 'failure';\n      }\n\n      const criteriaSymbol = isDND ? '' : '';\n      const hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const displayValue = hideDiceResultFromUser ? '' : finalValue;\n      const displayOutcomeText = hideDiceResultFromUser ? '' : outcomeText;\n\n      // \n      let resultType;\n      if (isCritSuccess) {\n        resultType = 'critSuccess';\n      } else if (isCritFailure) {\n        resultType = 'critFailure';\n      } else if (isSuccess) {\n        if (difficulty === 'extreme' || (difficulty === 'normal' && finalValue <= Math.floor(target / extremeDiv))) {\n          resultType = 'extremeSuccess';\n        } else if (difficulty === 'hard' || (difficulty === 'normal' && finalValue <= Math.floor(target / hardDiv))) {\n          resultType = 'success';\n        } else {\n          resultType = 'warning';\n        }\n      } else {\n        resultType = 'failure';\n      }\n\n      const badgeClass = getResultBadgeClass(resultType);\n\n      // \n      const displayConditionExpr = hideDiceResultFromUser ? '' : conditionExpr;\n\n      // \n      const $rollBtn = panel.find('#dice-roll-btn');\n      $rollBtn.html(`\n        <div class=\"acu-dice-result-display\">\n          <span class=\"acu-dice-result-value\">${displayValue}</span>\n          ${displayConditionExpr ? `<span class=\"acu-dice-result-target\">${displayConditionExpr}</span>` : ''}\n          ${displayOutcomeText ? `<span class=\"${badgeClass}\">${displayOutcomeText}</span>` : ''}\n          <button class=\"dice-retry-btn acu-dice-retry-btn\" title=\"\">\n            <i class=\"fa-solid fa-rotate-right\"></i>\n          </button>\n        </div>\n      `);\n\n      // \n      $rollBtn.off('click', '.dice-retry-btn').on('click', '.dice-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        // \n        performDiceRoll();\n      });\n\n      //  Prompt \n      const initiatorName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n      // \n      let conditionExpr = '';\n      if (isCritSuccess) {\n        if (isDND) {\n          conditionExpr = `${finalValue}${critFailMin}`;\n        } else {\n          conditionExpr = `${finalValue}${critSuccessMax}`;\n        }\n      } else if (isCritFailure) {\n        if (isDND) {\n          conditionExpr = `${finalValue}${critSuccessMax}`;\n        } else {\n          conditionExpr = `${finalValue}${critFailMin}`;\n        }\n      } else if (isDND) {\n        conditionExpr = `${finalValue}${requiredTarget}`;\n      } else {\n        conditionExpr = `${finalValue}${requiredTarget}`;\n      }\n\n      // \n      let judgeExpr = '';\n      if (isCritSuccess) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        } else {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        }\n      } else if (isCritFailure) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        } else {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        }\n      } else if (isDND) {\n        // DND \n        if (isSuccess) {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}<${requiredTarget}`;\n        }\n      } else if (difficulty === 'critical') {\n        // COC \n        judgeExpr = `${critSuccessMax}${finalValue}>${critSuccessMax}`;\n      } else if (difficulty !== 'normal') {\n        // COC \n        if (isSuccess) {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}>${requiredTarget}`;\n        }\n      } else {\n        // COC \n        if (isSuccess) {\n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${extremeDiv}`;\n          } else if (finalValue <= hardTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${hardDiv}`;\n          } else {\n            judgeExpr = `${target}${finalValue}${target}`;\n          }\n        } else {\n          judgeExpr = `${target}${finalValue}>${target}`;\n        }\n      }\n\n      // \n      const metaContent = `${initiatorName}${attrName}${finalValue}${judgeExpr}${outcomeText}`;\n      const diceResultText = `<meta:>\\n${metaContent}\\n</meta:>`;\n      smartInsertToTextarea(diceResultText, 'dice');\n\n      // \n      const checkResult: AcuDice.CheckResult = {\n        success: isSuccess,\n        total: finalValue,\n        target,\n        outcomeText,\n        attrName,\n        criteria,\n        isAutoTarget,\n        formula,\n      };\n\n      // \n      const detailId = `check_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n      const checkResultWithTimestamp = {\n        ...checkResult,\n        timestamp: Date.now(),\n        detailId,\n        initiatorName,\n        historyType: 'check' as const,\n        detailLines: [\n          `: ${initiatorName}`,\n          `: ${attrName}`,\n          `: ${formula}`,\n          `+: ${result.total} ${mod >= 0 ? '+' : ''}${mod} = ${finalValue}`,\n          `: ${requiredTarget} (${isAutoTarget ? '' : ''})`,\n          `: ${criteria === 'gte' ? '>=' : '<='}${requiredTarget}`,\n          difficultyLabel ? `: ${difficultyLabel}` : ': ',\n          `: ${judgeExpr}`,\n          `: ${outcomeText}`,\n        ],\n      };\n      checkHistory.push(checkResultWithTimestamp);\n      if (checkHistory.length > MAX_HISTORY) {\n        checkHistory.shift();\n      }\n\n      // \n      emitEvent('check', checkResultWithTimestamp);\n\n      if (onResult) {\n        onResult(checkResult);\n      }\n    };\n\n    // \n    panel.find('#dice-roll-btn').click(function () {\n      performDiceRoll();\n    });\n\n    // \n    panel.find('#dice-switch-contest-top').click(function () {\n      const targetInput = panel.find('#dice-target').val().trim();\n      const attrValueInput = panel.find('#dice-attr-value').val().trim();\n      const currentDice = panel.find('#dice-formula').val() || '1d100';\n      const initiatorNameVal = panel.find('#dice-initiator-name').val().trim();\n      closePanel();\n      showContestPanel({\n        //  placeholder \n        initiatorName: initiatorNameVal && initiatorNameVal !== '<user>' ? initiatorNameVal : '',\n        initiatorValue: attrValueInput !== '' ? parseInt(attrValueInput, 10) : undefined,\n        diceType: currentDice,\n      });\n    });\n    panel.find('#dice-history-btn').click(function (e) {\n      e.stopPropagation();\n      showGlobalDiceHistoryDialog();\n    });\n    // \n    const closePanel = () => {\n      overlay.remove();\n      panel.remove();\n    };\n    panel.on('click', e => {\n      e.stopPropagation();\n    });\n    overlay.click(closePanel);\n    panel.find('.acu-dice-close').click(closePanel);\n    //  - \n    panel.find('.acu-dice-config-btn').click(function (e) {\n      e.stopPropagation();\n      showAdvancedPresetManager({ fromDicePanel: true });\n    });\n  };\n\n  //  API contest() \n  const getSuccessLevel = function (roll: number, target: number, sides: number) {\n    if (sides === 100) {\n      if (roll <= 5) return { level: 3, name: '', color: 'var(--acu-crit-success-text)' };\n      if (roll >= 96) return { level: -1, name: '', color: 'var(--acu-crit-failure-text)' };\n      if (roll <= Math.floor(target / 5))\n        return { level: 2, name: '', color: 'var(--acu-extreme-success-text)' };\n      if (roll <= Math.floor(target / 2)) return { level: 1, name: '', color: 'var(--acu-success-text)' };\n      if (roll <= target) return { level: 0, name: '', color: 'var(--acu-warning-text)' };\n      return { level: -1, name: '', color: 'var(--acu-failure-text)' };\n    } else {\n      if (roll === 20) return { level: 3, name: '', color: 'var(--acu-crit-success-text)' };\n      if (roll === 1) return { level: -1, name: '', color: 'var(--acu-crit-failure-text)' };\n      if (roll >= target) return { level: 0, name: '', color: 'var(--acu-success-text)' };\n      return { level: -1, name: '', color: 'var(--acu-failure-text)' };\n    }\n  };\n\n  // [] \n  const showContestPanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay, .acu-contest-panel, .acu-contest-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    // \n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    if (Number.isNaN(rollComplexDiceExpression(savedDiceType).total)) {\n      savedDiceType = '1d100';\n    }\n\n    // \n    const opponentName = options.opponentName || '';\n    const diceType = options.diceType || savedDiceType;\n    const passedInitiatorName = options.initiatorName || '';\n    const passedInitiatorValue = options.initiatorValue;\n    const passedOpponentValue = options.opponentValue;\n\n    const rawData = cachedRawData || getTableData();\n    let playerAttrs = [];\n    let opponentAttrs = [];\n\n    // []  + \n    let characterList: string[] = [];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n        if (isNpcTableName(sheet.name)) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) characterList.push(row[1]);\n          }\n        }\n        if (sheet.name?.includes('') && sheet.content[1]) {\n          const row = sheet.content[1];\n          if (row[1]) characterList.unshift(getDisplayName(String(row[1])));\n        }\n      }\n    }\n    // [] \n    let contestAttrList = [];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name?.includes('') && sheet.content && sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!contestAttrList.includes(attr.name)) contestAttrList.push(attr.name);\n              });\n            }\n          });\n          break;\n        }\n      }\n    }\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name?.includes('') && sheet.content[1]) {\n          const attrStr = sheet.content[1][7] || '';\n          playerAttrs = parseAttributeString(attrStr);\n        }\n\n        if (isNpcTableName(sheet.name) && opponentName) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1] === opponentName) {\n              const attrStr = row[9] || '';\n              opponentAttrs = parseAttributeString(attrStr);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    const buildAttrButtons = (attrs, targetType) => {\n      let html = '';\n      // \n      for (let i = 0; i < attrs.length; i++) {\n        const attr = attrs[i];\n        html +=\n          '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n          attr.value +\n          '\" data-aname=\"' +\n          escapeHtml(attr.name) +\n          '\" data-type=\"' +\n          targetType +\n          '\">' +\n          escapeHtml(attr.name) +\n          ': ' +\n          attr.value +\n          '</button>';\n      }\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" title=\"\"><i class=\"fa-solid fa-trash-alt\"></i></button>';\n      return html;\n    };\n\n    // [] \n    const contestAvailablePresets = AdvancedDicePresetManager.getAllPresets()\n      .filter(p => p.visible !== false)\n      .filter(p => AdvancedDicePresetManager.supportsContest(p))\n      .sort((a, b) => (a.order || 0) - (b.order || 0));\n    const currentActivePreset = AdvancedDicePresetManager.getActivePreset();\n    const activePresetId =\n      currentActivePreset && AdvancedDicePresetManager.supportsContest(currentActivePreset)\n        ? currentActivePreset.id\n        : null;\n\n    const overlay = $('<div class=\"acu-contest-overlay\"></div>');\n    const panelHtml =\n      '<div class=\"acu-contest-panel acu-theme-' +\n      config.theme +\n      '\">' +\n      '<div class=\"acu-dice-panel-header\">' +\n      '<div class=\"acu-dice-panel-title\"><i class=\"fa-solid fa-people-arrows\"></i> </div>' +\n      '<div class=\"acu-dice-panel-actions\">' +\n      '<button id=\"contest-switch-normal\" class=\"acu-dice-panel-action-btn\" title=\"\"><i class=\"fa-solid fa-dice-d20\"></i></button>' +\n      '<button id=\"contest-history-btn\" class=\"acu-dice-panel-action-btn\" title=\"\"><i class=\"fa-solid fa-history\"></i></button>' +\n      '<button class=\"acu-contest-config-btn acu-dice-panel-action-btn\" title=\"\"><i class=\"fa-solid fa-cog\"></i></button>' +\n      '<button class=\"acu-contest-close acu-dice-panel-action-btn\"><i class=\"fa-solid fa-times\"></i></button>' +\n      '</div>' +\n      '</div>' +\n      '<div class=\"acu-dice-panel-body\">' +\n      // [] \"\"\n      '<div class=\"acu-dice-section-title\"><span><i class=\"fa-solid fa-sliders\"></i> </span></div>' +\n      '<div class=\"acu-dice-presets\">' +\n      '<button class=\"acu-dice-quick-preset-btn\" data-dice=\"custom\" style=\"order: -999;\"></button>' +\n      contestAvailablePresets\n        .map(\n          p =>\n            '<button class=\"acu-dice-quick-preset-btn' +\n            // [] activePresetIddiceExpressionactive\n            (p.id === activePresetId ? ' active' : '') +\n            '\" data-dice=\"' +\n            escapeHtml(p.diceExpression || '1d100') +\n            '\" data-criteria=\"' +\n            escapeHtml(p.successCriteria || 'lte') +\n            '\" data-preset-id=\"' +\n            escapeHtml(p.id) +\n            '\">' +\n            escapeHtml(p.name) +\n            '</button>',\n        )\n        .join('') +\n      '</div>' +\n      '<input type=\"hidden\" id=\"contest-dice-type\" value=\"' +\n      diceType +\n      '\">' +\n      '<div class=\"acu-dice-section-title\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-init-char-buttons\" class=\"acu-dice-quick-inline\"></div></div>' +\n      '<div id=\"contest-init-primary-row\" class=\"acu-dice-form-row cols-2\">' +\n      '<div><div class=\"acu-dice-form-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-init-display\" value=\"\" placeholder=\"<user>\"></div>' +\n      '<div><div class=\"acu-dice-form-label\"><span class=\"contest-attr-name-text\"></span><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-init-random-skill\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-init-name\" value=\"\" placeholder=\"\"></div>' +\n      '</div>' +\n      // []  ()\n      '<div id=\"contest-init-dice-syntax-row\" class=\"acu-dice-form-row cols-2\" style=\"display: none;\">' +\n      '<div><div class=\"acu-dice-form-label\"></div><input type=\"text\" id=\"contest-custom-dice-init\" class=\"acu-dice-input\" value=\"\" placeholder=\"=1d100, 1d20+5...\"></div>' +\n      '<div></div>' +\n      '</div>' +\n      '<div id=\"contest-init-values-row\" class=\"acu-dice-form-row cols-3\">' +\n      '<div id=\"contest-init-attr-wrapper\"><div class=\"acu-dice-form-label\" id=\"contest-init-attr-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-init-value\" value=\"' +\n      (passedInitiatorValue !== undefined ? passedInitiatorValue : '') +\n      '\" placeholder=\"=50%\"></div>' +\n      '<div id=\"contest-init-skill-mod-wrapper\" style=\"display:none;\"><div class=\"acu-dice-form-label\" id=\"contest-init-skill-mod-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-init-skill-mod\" placeholder=\"=0\"></div>' +\n      '<div id=\"contest-init-mod-wrapper\"><div class=\"acu-dice-form-label\" id=\"contest-init-mod-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-init-mod\" placeholder=\"=0\"></div>' +\n      '<div id=\"contest-init-target-wrapper\"><div class=\"acu-dice-form-label\" id=\"contest-init-target-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-init-target\" value=\"\" placeholder=\"\"></div>' +\n      '</div>' +\n      '<div id=\"contest-init-custom-fields\"></div>' +\n      '<div id=\"init-attr-buttons\" class=\"acu-dice-quick-compact\">' +\n      buildAttrButtons(playerAttrs, 'init') +\n      '</div>' +\n      '<div class=\"acu-dice-section-title\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-opp-char-buttons\" class=\"acu-dice-quick-inline\"></div></div>' +\n      '<div id=\"contest-opp-primary-row\" class=\"acu-dice-form-row cols-2\">' +\n      '<div><div class=\"acu-dice-form-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-opponent-display\" value=\"' +\n      escapeHtml(opponentName) +\n      '\" placeholder=\"\"></div>' +\n      '<div><div class=\"acu-dice-form-label\"><span class=\"contest-attr-name-text\"></span><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-opp-random-skill\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-opp-name\" value=\"\" placeholder=\"\"></div>' +\n      '</div>' +\n      // []  ()\n      '<div id=\"contest-opp-dice-syntax-row\" class=\"acu-dice-form-row cols-2\" style=\"display: none;\">' +\n      '<div><div class=\"acu-dice-form-label\"></div><input type=\"text\" id=\"contest-custom-dice-opp\" class=\"acu-dice-input\" value=\"\" placeholder=\"=\"></div>' +\n      '<div></div>' +\n      '</div>' +\n      '<div id=\"contest-opp-values-row\" class=\"acu-dice-form-row cols-3\">' +\n      '<div id=\"contest-opp-attr-wrapper\"><div class=\"acu-dice-form-label\" id=\"contest-opp-attr-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-opp-value\" value=\"' +\n      (passedOpponentValue !== undefined ? passedOpponentValue : '') +\n      '\" placeholder=\"=50%\"></div>' +\n      '<div id=\"contest-opp-skill-mod-wrapper\" style=\"display:none;\"><div class=\"acu-dice-form-label\" id=\"contest-opp-skill-mod-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-opp-skill-mod\" placeholder=\"=0\"></div>' +\n      '<div id=\"contest-opp-mod-wrapper\"><div class=\"acu-dice-form-label\" id=\"contest-opp-mod-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-opp-mod\" placeholder=\"=0\"></div>' +\n      '<div id=\"contest-opp-target-wrapper\"><div class=\"acu-dice-form-label\" id=\"contest-opp-target-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-opp-target\" value=\"\" placeholder=\"\"></div>' +\n      '</div>' +\n      '<div id=\"contest-opp-custom-fields\"></div>' +\n      '<div id=\"opp-attr-buttons\" class=\"acu-dice-quick-compact\">' +\n      buildAttrButtons(opponentAttrs, 'opp') +\n      '</div>' +\n      // []  ()\n      '<div id=\"contest-custom-judge-row\" class=\"acu-dice-form-row cols-2\" style=\"display: none; margin-top: 8px;\">' +\n      '<div><div class=\"acu-dice-form-label\"></div><select id=\"contest-custom-judge-rule\" class=\"acu-dice-select\">' +\n      '<option value=\"higher\"></option>' +\n      '<option value=\"lower\"></option>' +\n      '<option value=\"rank\"></option>' +\n      '<option value=\"none\"></option>' +\n      '</select></div>' +\n      '<div><div class=\"acu-dice-form-label\"></div><select id=\"contest-custom-tie-rule\" class=\"acu-dice-select\">' +\n      '<option value=\"initiator_lose\"></option>' +\n      '<option value=\"tie\" selected></option>' +\n      '<option value=\"initiator_win\"></option>' +\n      '</select></div>' +\n      '</div>' +\n      '<div id=\"contest-result-display\" class=\"acu-contest-result-display\">' +\n      '<div class=\"acu-contest-result-inner\">' +\n      '<div id=\"contest-result-init\" class=\"acu-contest-result-side\"></div>' +\n      '<span class=\"acu-contest-vs\">VS</span>' +\n      '<div id=\"contest-result-opp\" class=\"acu-contest-result-side right\"></div>' +\n      '</div>' +\n      '</div>' +\n      '<button id=\"contest-roll-btn\" class=\"acu-dice-roll-btn\"><i class=\"fa-solid fa-dice\"></i> </button>' +\n      '</div>' +\n      '</div>';\n\n    const panel = $(panelHtml);\n    overlay.append(panel);\n    $('body').append(overlay);\n\n    // []  - \n    const buildCharBtns = targetType => {\n      const containerId = targetType === 'init' ? '#contest-init-char-buttons' : '#contest-opp-char-buttons';\n      const $container = panel.find(containerId);\n      let html = '';\n      characterList.forEach(name => {\n        const resolvedName = NameAliasRegistry.resolve(String(name));\n        const displayName = replaceUserPlaceholders(String(resolvedName));\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html +=\n          '<button class=\"acu-dice-char-btn\" data-char=\"' +\n          escapeHtml(String(resolvedName)) +\n          '\" data-type=\"' +\n          targetType +\n          '\" title=\"' +\n          escapeHtml(displayName) +\n          '\">' +\n          escapeHtml(shortName) +\n          '</button>';\n      });\n      $container.html(html);\n      $container.find('.acu-dice-char-btn').click(function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const charName = $(this).data('char');\n        const type = $(this).data('type');\n        if (type === 'init') {\n          panel.find('#contest-init-display').val(charName).trigger('change');\n        } else {\n          panel.find('#contest-opponent-display').val(charName).trigger('change');\n        }\n      });\n    };\n\n    // [] \n    const rebuildAttrBtns = (attrs, targetType) => {\n      const containerId = targetType === 'init' ? '#init-attr-buttons' : '#opp-attr-buttons';\n      const $container = panel.find(containerId);\n\n      // \n      $container.show();\n\n      let html = '';\n\n      // \n      if (attrs.length > 0) {\n        attrs.forEach(attr => {\n          html +=\n            '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n            attr.value +\n            '\" data-aname=\"' +\n            escapeHtml(attr.name) +\n            '\" data-type=\"' +\n            targetType +\n            '\">' +\n            escapeHtml(attr.name) +\n            ':' +\n            attr.value +\n            '</button>';\n        });\n      }\n\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" title=\"\"><i class=\"fa-solid fa-trash-alt\"></i></button>';\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-contest-attr-btn').click(function () {\n        const val = $(this).attr('data-val');\n        const aname = $(this).attr('data-aname');\n        const type = $(this).attr('data-type');\n\n        if (type === 'init') {\n          const targetInput = getContestAttrTargetInput('init', aname || '');\n          panel.find(targetInput).val(val);\n          panel.find('#contest-init-name').val(aname);\n          panel.find(targetInput).trigger('change');\n        } else {\n          const targetInput = getContestAttrTargetInput('opp', aname || '');\n          panel.find(targetInput).val(val);\n          panel.find('#contest-opp-name').val(aname);\n          panel.find(targetInput).trigger('change');\n        }\n      });\n\n      // \n      $container.find('.acu-contest-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          // \n          let charName;\n          if (type === 'init') {\n            charName = panel.find('#contest-init-display').val().trim() || '<user>';\n          } else {\n            charName = panel.find('#contest-opponent-display').val().trim();\n          }\n\n          if (!charName) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // [] \n          const result = await writeAttributesToCharacter(charName, baseAttrs, false, specialAttrs);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        let charName;\n        if (type === 'init') {\n          charName = panel.find('#contest-init-display').val().trim() || '<user>';\n        } else {\n          charName = panel.find('#contest-opponent-display').val().trim();\n        }\n\n        if (!charName) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharBtns('init');\n    buildCharBtns('opp');\n    // [] \n    panel.find('#contest-init-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-init-name').val(randomSkill).trigger('change');\n    });\n\n    // [] \n    panel.find('#contest-opp-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-opp-name').val(randomSkill).trigger('change');\n    });\n    //  rebuildAttrBtns /\n    const initAttrs = getFullAttributesForCharacter(passedInitiatorName || characterList[0] || '<user>');\n    rebuildAttrBtns(initAttrs, 'init');\n    const oppAttrs = getFullAttributesForCharacter(opponentName || '');\n    rebuildAttrBtns(oppAttrs, 'opp');\n\n    // \n    initCustomDropdown(panel.find('#contest-init-display'), characterList);\n    initCustomDropdown(panel.find('#contest-opponent-display'), characterList);\n    initCustomDropdown(panel.find('#contest-init-name'), contestAttrList);\n    initCustomDropdown(panel.find('#contest-opp-name'), contestAttrList);\n    addClearButton(\n      panel,\n      '#contest-init-display, #contest-init-name, #contest-init-value, #contest-init-skill-mod, #contest-init-mod, #contest-init-target, #contest-opponent-display, #contest-opp-name, #contest-opp-value, #contest-opp-skill-mod, #contest-opp-mod, #contest-opp-target, #contest-custom-dice-init, #contest-custom-dice-opp',\n    );\n\n    // [] \n    let currentContestAdvancedPreset: AdvancedDicePreset | LegacyAdvancedDicePreset | null = null;\n\n    const getContestAttrTargetInput = (party: 'init' | 'opp', attrName: string): string => {\n      let target = party === 'init' ? '#contest-init-value' : '#contest-opp-value';\n      const mapping = currentContestAdvancedPreset?.attrTargetMapping;\n      if (!mapping || !attrName) return target;\n      for (const [fieldId, names] of Object.entries(mapping)) {\n        if (!Array.isArray(names) || !names.includes(attrName)) continue;\n        if (fieldId === 'skillMod') {\n          target = party === 'init' ? '#contest-init-skill-mod' : '#contest-opp-skill-mod';\n        } else if (fieldId === 'mod') {\n          target = party === 'init' ? '#contest-init-mod' : '#contest-opp-mod';\n        } else if (fieldId === 'attribute') {\n          target = party === 'init' ? '#contest-init-value' : '#contest-opp-value';\n        }\n        break;\n      }\n      return target;\n    };\n\n    const applyContestAdvancedPreset = (presetId: string | null) => {\n      // DOM - wrapper ID\n      const $initValuesRow = panel.find('#contest-init-values-row');\n      const $oppValuesRow = panel.find('#contest-opp-values-row');\n      const $initPrimaryRow = panel.find('#contest-init-primary-row');\n      const $oppPrimaryRow = panel.find('#contest-opp-primary-row');\n      const $initCustomFields = panel.find('#contest-init-custom-fields');\n      const $oppCustomFields = panel.find('#contest-opp-custom-fields');\n\n      const $initAttrWrapper = panel.find('#contest-init-attr-wrapper');\n      const $initSkillModWrapper = panel.find('#contest-init-skill-mod-wrapper');\n      const $initModWrapper = panel.find('#contest-init-mod-wrapper');\n      const $initTargetWrapper = panel.find('#contest-init-target-wrapper');\n      const $oppAttrWrapper = panel.find('#contest-opp-attr-wrapper');\n      const $oppSkillModWrapper = panel.find('#contest-opp-skill-mod-wrapper');\n      const $oppModWrapper = panel.find('#contest-opp-mod-wrapper');\n      const $oppTargetWrapper = panel.find('#contest-opp-target-wrapper');\n\n      const $initAttrLabel = panel.find('#contest-init-attr-label');\n      const $initSkillModLabel = panel.find('#contest-init-skill-mod-label');\n      const $oppAttrLabel = panel.find('#contest-opp-attr-label');\n      const $oppSkillModLabel = panel.find('#contest-opp-skill-mod-label');\n      const $initTargetLabel = panel.find('#contest-init-target-label');\n      const $oppTargetLabel = panel.find('#contest-opp-target-label');\n      const $initModLabel = panel.find('#contest-init-mod-label');\n      const $oppModLabel = panel.find('#contest-opp-mod-label');\n\n      const $initAttrInput = panel.find('#contest-init-value');\n      const $oppAttrInput = panel.find('#contest-opp-value');\n      const $initSkillModInput = panel.find('#contest-init-skill-mod');\n      const $oppSkillModInput = panel.find('#contest-opp-skill-mod');\n      const $initModInput = panel.find('#contest-init-mod');\n      const $oppModInput = panel.find('#contest-opp-mod');\n\n      // \n      const updateRowColumns = ($row: JQuery, visibleCount: number) => {\n        $row.removeClass('cols-2 cols-3');\n        if (visibleCount <= 2) {\n          $row.addClass('cols-2');\n        } else {\n          $row.addClass('cols-3');\n        }\n      };\n\n      const buildContestCustomFieldCell = (\n        field: Record<string, unknown>,\n        party: 'init' | 'opp',\n        extraClass = '',\n      ): JQuery => {\n        const fieldId = String(field.id || '');\n        const fieldLabel = String(field.label || fieldId);\n        const fieldType = String(field.type || 'text');\n        let html = `<div class=\"${extraClass}\">`;\n\n        if (fieldType !== 'toggle') {\n          html += `<div class=\"acu-dice-form-label\">${escapeHtml(fieldLabel)}</div>`;\n        } else {\n          html += '<div class=\"acu-dice-form-label\">&nbsp;</div>';\n        }\n\n        if (fieldType === 'select' && Array.isArray(field.options)) {\n          html += `<select class=\"acu-dice-select acu-dice-custom-field-contest\" data-id=\"${escapeHtml(fieldId)}\" data-party=\"${party}\">`;\n          field.options.forEach(option => {\n            const opt = option as Record<string, unknown>;\n            const optValue = opt.value;\n            const isSelected = optValue === field.defaultValue ? 'selected' : '';\n            html += `<option value=\"${escapeHtml(String(optValue ?? ''))}\" ${isSelected}>${escapeHtml(String(opt.label ?? optValue ?? ''))}</option>`;\n          });\n          html += '</select>';\n        } else if (fieldType === 'toggle') {\n          const isChecked = field.defaultValue ? 'checked' : '';\n          html += `<label style=\"display: flex; align-items: center; cursor: pointer; height: 32px;\">\n            <input type=\"checkbox\" class=\"acu-dice-custom-field-contest\" data-id=\"${escapeHtml(fieldId)}\" data-party=\"${party}\" ${isChecked} style=\"margin-right: 8px;\">\n            ${escapeHtml(fieldLabel)}\n          </label>`;\n        } else {\n          const inputType = fieldType === 'number' ? 'number' : 'text';\n          const defaultVal = field.defaultValue;\n          const placeholderText =\n            String(field.placeholder || '') ||\n            (defaultVal !== undefined && defaultVal !== '' ? `=${defaultVal}` : '');\n          html += `<input type=\"${inputType}\" class=\"acu-dice-input acu-dice-custom-field-contest\" data-id=\"${escapeHtml(fieldId)}\" data-party=\"${party}\" placeholder=\"${escapeHtml(placeholderText)}\">`;\n        }\n\n        html += '</div>';\n        return $(html);\n      };\n\n      // customFields\n      const renderCustomFields = (\n        $container: JQuery,\n        party: 'init' | 'opp',\n        preset: AdvancedDicePreset | LegacyAdvancedDicePreset,\n      ) => {\n        $container.empty();\n\n        if (!('customFields' in preset) || !Array.isArray(preset.customFields) || preset.customFields.length === 0) {\n          return;\n        }\n\n        //  contestOverride \n        const visibleFields = preset.customFields.map(f => ({ ...f, ...f.contestOverride })).filter(f => !f.hidden);\n        if (visibleFields.length === 0) return;\n\n        const gridItems: string[] = visibleFields.map(field =>\n          buildContestCustomFieldCell(field, party).prop('outerHTML'),\n        );\n\n        // \n        // 32\n        // - 42+2\n        // - 52+3\n        // - 63+3\n        // - 72+2+3\n        // - 82+3+3\n        // - 93+3+3\n        const computeRowLayout = (total: number): number[] => {\n          if (total <= 0) return [];\n          if (total <= 2) return [2]; // 2 cols-1\n          if (total === 3) return [3];\n          if (total === 4) return [2, 2];\n          if (total === 5) return [2, 3];\n          if (total === 6) return [3, 3];\n          // 7+ 3\n          return [...computeRowLayout(total - 3), 3];\n        };\n\n        const rowLayout = computeRowLayout(gridItems.length);\n        let itemIndex = 0;\n        for (const colCount of rowLayout) {\n          const $row = $(`<div class=\"acu-dice-form-row cols-${colCount}\"></div>`);\n          for (let j = 0; j < colCount; j++) {\n            if (itemIndex < gridItems.length) {\n              $row.append(gridItems[itemIndex]);\n              itemIndex++;\n            } else {\n              $row.append('<div></div>');\n            }\n          }\n          $container.append($row);\n        }\n      };\n\n      const restoreDefaults = () => {\n        // \n        $initAttrLabel.text('');\n        $oppAttrLabel.text('');\n        $initSkillModLabel.text('');\n        $oppSkillModLabel.text('');\n        $initTargetLabel.text('');\n        $oppTargetLabel.text('');\n        $initModLabel.text('');\n        $oppModLabel.text('');\n\n        // \"\"\n        panel.find('.contest-attr-name-text').text('');\n\n        // \n        $initAttrWrapper.show();\n        $oppAttrWrapper.show();\n        $initSkillModWrapper.hide();\n        $oppSkillModWrapper.hide();\n        $initTargetWrapper.show();\n        $oppTargetWrapper.show();\n        $initModWrapper.show();\n        $oppModWrapper.show();\n\n        // placeholder\n        $initAttrInput.attr('placeholder', '=50%');\n        $oppAttrInput.attr('placeholder', '=50%');\n        $initSkillModInput.attr('placeholder', '=0');\n        $oppSkillModInput.attr('placeholder', '=0');\n        $initModInput.attr('placeholder', '=0');\n        $oppModInput.attr('placeholder', '=0');\n\n        // customFields\n        const rebuildDefaultRow = (\n          $row: JQuery,\n          $attrWrapper: JQuery,\n          $skillWrapper: JQuery,\n          $modWrapper: JQuery,\n          $targetWrapper: JQuery,\n        ) => {\n          // wrapper\n          $row.children().not($attrWrapper).not($skillWrapper).not($modWrapper).not($targetWrapper).remove();\n          // wrapper\n          if ($attrWrapper.parent()[0] !== $row[0]) $attrWrapper.detach().appendTo($row);\n          if ($skillWrapper.parent()[0] !== $row[0]) $skillWrapper.detach().appendTo($row);\n          if ($modWrapper.parent()[0] !== $row[0]) $modWrapper.detach().appendTo($row);\n          if ($targetWrapper.parent()[0] !== $row[0]) $targetWrapper.detach().appendTo($row);\n          // \n          $row.append($attrWrapper.detach());\n          $row.append($skillWrapper.detach());\n          $row.append($modWrapper.detach());\n          $row.append($targetWrapper.detach());\n        };\n\n        rebuildDefaultRow($initValuesRow, $initAttrWrapper, $initSkillModWrapper, $initModWrapper, $initTargetWrapper);\n        rebuildDefaultRow($oppValuesRow, $oppAttrWrapper, $oppSkillModWrapper, $oppModWrapper, $oppTargetWrapper);\n\n        // 3\n        updateRowColumns($initValuesRow, 3);\n        updateRowColumns($oppValuesRow, 3);\n\n        // customFields\n        $initPrimaryRow.find('.acu-contest-inline-custom').remove();\n        $oppPrimaryRow.find('.acu-contest-inline-custom').remove();\n        updateRowColumns($initPrimaryRow, 2);\n        updateRowColumns($oppPrimaryRow, 2);\n        $initCustomFields.empty();\n        $oppCustomFields.empty();\n      };\n\n      if (!presetId) {\n        currentContestAdvancedPreset = null;\n        restoreDefaults();\n        return;\n      }\n\n      const preset = AdvancedDicePresetManager.getAllPresets().find(p => p.id === presetId);\n      if (!preset) {\n        console.warn('[DICE] :', presetId);\n        restoreDefaults();\n        return;\n      }\n\n      currentContestAdvancedPreset = preset;\n\n      // [] \n      restoreDefaults();\n\n      // placeholder\n      const attrLabel = preset.attribute?.label || '';\n      const skillModLabel = preset.skillMod?.label || '';\n      const dcLabel = preset.dc?.label || '';\n      const modLabel = preset.mod?.label || '';\n      const attrPlaceholder = preset.attribute?.placeholder || '=50%';\n      const skillModPlaceholder = preset.skillMod?.placeholder || '=0';\n      const modPlaceholder = preset.mod?.placeholder || '=0';\n\n      // \n      $initAttrLabel.text(attrLabel);\n      $oppAttrLabel.text(attrLabel);\n      $initSkillModLabel.text(skillModLabel);\n      $oppSkillModLabel.text(skillModLabel);\n      $initTargetLabel.text(dcLabel);\n      $oppTargetLabel.text(dcLabel);\n      $initModLabel.text(modLabel);\n      $oppModLabel.text(modLabel);\n\n      // \"\"Fate\"/\"\n      panel.find('.contest-attr-name-text').text(preset.attributeName?.label || '');\n\n      // placeholder\n      $initAttrInput.attr('placeholder', attrPlaceholder);\n      $oppAttrInput.attr('placeholder', attrPlaceholder);\n      $initSkillModInput.attr('placeholder', skillModPlaceholder);\n      $oppSkillModInput.attr('placeholder', skillModPlaceholder);\n      $initModInput.attr('placeholder', modPlaceholder);\n      $oppModInput.attr('placeholder', modPlaceholder);\n\n      // \n      const hideDcInContest = preset.contestRule?.hideDc === true || preset.dc?.hidden === true;\n      const hideModInContest = preset.contestRule?.hideMod === true || preset.mod?.hidden === true;\n      const hideSkillModInContest =\n        !preset.skillMod || preset.contestRule?.hideSkillMod === true || preset.skillMod.hidden === true;\n\n      // \n      $initAttrWrapper.show();\n      $oppAttrWrapper.show();\n\n      // \n      if (hideSkillModInContest) {\n        $initSkillModWrapper.hide();\n        $oppSkillModWrapper.hide();\n      } else {\n        $initSkillModWrapper.show();\n        $oppSkillModWrapper.show();\n      }\n\n      // \n      if (hideDcInContest) {\n        $initTargetWrapper.hide();\n        $oppTargetWrapper.hide();\n      } else {\n        $initTargetWrapper.show();\n        $oppTargetWrapper.show();\n      }\n\n      // \n      if (hideModInContest) {\n        $initModWrapper.hide();\n        $oppModWrapper.hide();\n      } else {\n        $initModWrapper.show();\n        $oppModWrapper.show();\n      }\n\n      // [] customFields\n      // customFields contestOverride\n      const visibleContestFields =\n        'customFields' in preset && Array.isArray(preset.customFields)\n          ? preset.customFields.map(f => ({ ...f, ...f.contestOverride })).filter(f => !f.hidden)\n          : [];\n      const customFieldCount = visibleContestFields.length;\n\n      // \n      let baseVisibleCount = 1; // \n      if (!hideSkillModInContest) baseVisibleCount++;\n      if (!hideModInContest) baseVisibleCount++;\n      if (!hideDcInContest) baseVisibleCount++;\n\n      // \n      const totalFields = baseVisibleCount + customFieldCount;\n\n      const useThreeByThreeWithPrimaryRow = customFieldCount === 1 && baseVisibleCount === 3;\n\n      if (useThreeByThreeWithPrimaryRow) {\n        const customField = visibleContestFields[0];\n        const renderPrimaryInlineField = ($row: JQuery, party: 'init' | 'opp') => {\n          $row.find('.acu-contest-inline-custom').remove();\n          updateRowColumns($row, 3);\n          $row.append(buildContestCustomFieldCell(customField, party, 'acu-contest-inline-custom'));\n        };\n\n        renderPrimaryInlineField($initPrimaryRow, 'init');\n        renderPrimaryInlineField($oppPrimaryRow, 'opp');\n        updateRowColumns($initValuesRow, 3);\n        updateRowColumns($oppValuesRow, 3);\n        $initCustomFields.empty();\n        $oppCustomFields.empty();\n      } else {\n        $initPrimaryRow.find('.acu-contest-inline-custom').remove();\n        $oppPrimaryRow.find('.acu-contest-inline-custom').remove();\n        updateRowColumns($initPrimaryRow, 2);\n        updateRowColumns($oppPrimaryRow, 2);\n\n        //  <= 4\n        //  COC7: 1 () + 3 (//) = 4\n        //  FATE: 2 (/) + 0 = 2\n        //  DND5e: 3 (//DC) + 1 (/) = 4\n        if (totalFields <= 4 && customFieldCount > 0 && baseVisibleCount < 3) {\n          //  customFields \n          //  customFields \n          $initCustomFields.empty();\n          $oppCustomFields.empty();\n\n          //  customFields\n          const buildIntegratedRow = ($row: JQuery, party: 'init' | 'opp') => {\n            //  wrapper\n            const $attrWrapper = party === 'init' ? $initAttrWrapper : $oppAttrWrapper;\n            const $modWrapper = party === 'init' ? $initModWrapper : $oppModWrapper;\n            const $targetWrapper = party === 'init' ? $initTargetWrapper : $oppTargetWrapper;\n\n            // \n            const visibleItems: JQuery[] = [];\n\n            //  wrapper empty() \n            const $skillWrapper = party === 'init' ? $initSkillModWrapper : $oppSkillModWrapper;\n\n            [$attrWrapper, $skillWrapper, $modWrapper, $targetWrapper].forEach($base => {\n              if ($base.length > 0 && $base.parent().length > 0) {\n                $base.detach();\n              }\n            });\n\n            // \n            visibleItems.push($attrWrapper);\n\n            // \n            if (!hideSkillModInContest) {\n              visibleItems.push($skillWrapper);\n            }\n\n            // \n            if (!hideModInContest) {\n              visibleItems.push($modWrapper);\n            }\n\n            // \n            if (!hideDcInContest) {\n              visibleItems.push($targetWrapper);\n            }\n\n            //  customFields contestOverride\n            if ('customFields' in preset && Array.isArray(preset.customFields)) {\n              const visibleFields = preset.customFields\n                .map(f => ({ ...f, ...f.contestOverride }))\n                .filter(f => !f.hidden);\n              visibleFields.forEach(field => {\n                let html = '<div>';\n\n                // \n                if (field.type !== 'toggle') {\n                  html += `<div class=\"acu-dice-form-label\">${escapeHtml(field.label || field.id)}</div>`;\n                } else {\n                  html += '<div class=\"acu-dice-form-label\">&nbsp;</div>';\n                }\n\n                // \n                if (field.type === 'select' && field.options) {\n                  html += `<select class=\"acu-dice-select acu-dice-custom-field-contest\" data-id=\"${escapeHtml(field.id)}\" data-party=\"${party}\">`;\n                  field.options.forEach(opt => {\n                    const isSelected = opt.value === field.defaultValue ? 'selected' : '';\n                    html += `<option value=\"${escapeHtml(String(opt.value))}\" ${isSelected}>${escapeHtml(opt.label)}</option>`;\n                  });\n                  html += '</select>';\n                } else if (field.type === 'toggle') {\n                  const isChecked = field.defaultValue ? 'checked' : '';\n                  html += `<label style=\"display: flex; align-items: center; cursor: pointer; height: 32px;\">\n                  <input type=\"checkbox\" class=\"acu-dice-custom-field-contest\" data-id=\"${escapeHtml(field.id)}\" data-party=\"${party}\" ${isChecked} style=\"margin-right: 8px;\">\n                  ${escapeHtml(field.label || field.id)}\n                </label>`;\n                } else {\n                  const type = field.type === 'number' ? 'number' : 'text';\n                  // []  placeholder  value \n                  const defaultVal = field.defaultValue;\n                  const placeholderText =\n                    field.placeholder || (defaultVal !== undefined && defaultVal !== '' ? `=${defaultVal}` : '');\n                  html += `<input type=\"${type}\" class=\"acu-dice-input acu-dice-custom-field-contest\" data-id=\"${escapeHtml(field.id)}\" data-party=\"${party}\"\n                  placeholder=\"${escapeHtml(placeholderText)}\">`;\n                }\n\n                html += '</div>';\n                visibleItems.push($(html) as JQuery);\n              });\n            }\n\n            //  customFields \n            $row.empty();\n            const $customContainer = party === 'init' ? $initCustomFields : $oppCustomFields;\n            $customContainer.empty();\n\n            // \n            // 32\n            // - 42+2\n            // - 52+3\n            // - 63+3\n            // - 72+2+3\n            // - 82+3+3\n            // - 93+3+3\n            const computeRowLayout = (total: number): number[] => {\n              if (total <= 0) return [];\n              if (total <= 2) return [2]; // 2 cols-1\n              if (total === 3) return [3];\n              if (total === 4) return [2, 2];\n              if (total === 5) return [2, 3];\n              if (total === 6) return [3, 3];\n              // 7+ 3\n              return [...computeRowLayout(total - 3), 3];\n            };\n\n            const appendItemTo = ($target: JQuery, $item: JQuery) => {\n              if ($item.parent().length > 0) {\n                $item.detach().appendTo($target);\n              } else {\n                $target.append($item);\n              }\n            };\n\n            const rowLayout = computeRowLayout(visibleItems.length);\n            let itemIndex = 0;\n\n            //  $row \n            if (rowLayout.length > 0) {\n              const firstRowCols = rowLayout[0];\n              for (let j = 0; j < firstRowCols; j++) {\n                if (itemIndex < visibleItems.length) {\n                  appendItemTo($row, visibleItems[itemIndex]);\n                  itemIndex++;\n                } else {\n                  $row.append('<div></div>');\n                }\n              }\n              updateRowColumns($row, firstRowCols);\n\n              //  $customContainer \n              for (let rowIdx = 1; rowIdx < rowLayout.length; rowIdx++) {\n                const colCount = rowLayout[rowIdx];\n                const $gridRow = $(`<div class=\"acu-dice-form-row cols-${colCount}\"></div>`);\n                for (let j = 0; j < colCount; j++) {\n                  if (itemIndex < visibleItems.length) {\n                    appendItemTo($gridRow, visibleItems[itemIndex]);\n                    itemIndex++;\n                  } else {\n                    $gridRow.append('<div></div>');\n                  }\n                }\n                $customContainer.append($gridRow);\n              }\n            }\n\n            //  DOM \n            if (hideSkillModInContest) {\n              if ($skillWrapper.parent().length === 0 || $skillWrapper.parent()[0] !== $row[0]) {\n                $skillWrapper.detach().appendTo($row);\n              }\n              $skillWrapper.hide();\n            }\n            if (hideModInContest) {\n              if ($modWrapper.parent().length === 0 || $modWrapper.parent()[0] !== $row[0]) {\n                $modWrapper.detach().appendTo($row);\n              }\n              $modWrapper.hide();\n            }\n            if (hideDcInContest) {\n              if ($targetWrapper.parent().length === 0 || $targetWrapper.parent()[0] !== $row[0]) {\n                $targetWrapper.detach().appendTo($row);\n              }\n              $targetWrapper.hide();\n            }\n          };\n\n          buildIntegratedRow($initValuesRow, 'init');\n          buildIntegratedRow($oppValuesRow, 'opp');\n        } else {\n          // customFields \n          updateRowColumns($initValuesRow, baseVisibleCount);\n          updateRowColumns($oppValuesRow, baseVisibleCount);\n\n          //  customFields \n          renderCustomFields($initCustomFields, 'init', preset);\n          renderCustomFields($oppCustomFields, 'opp', preset);\n        }\n      }\n\n      // \n      if (!hideSkillModInContest) {\n        if ($initSkillModWrapper.parent().length === 0) {\n          $initSkillModWrapper.appendTo($initValuesRow);\n        }\n        if ($oppSkillModWrapper.parent().length === 0) {\n          $oppSkillModWrapper.appendTo($oppValuesRow);\n        }\n        $initSkillModWrapper.show();\n        $oppSkillModWrapper.show();\n      }\n\n      if (!hideModInContest) {\n        if ($initModWrapper.parent().length === 0) {\n          $initModWrapper.appendTo($initValuesRow);\n        }\n        if ($oppModWrapper.parent().length === 0) {\n          $oppModWrapper.appendTo($oppValuesRow);\n        }\n        $initModWrapper.show();\n        $oppModWrapper.show();\n      }\n\n      // \n      panel.find('#contest-dice-type').val(preset.diceExpression);\n      panel.find('#contest-custom-dice-init').val(preset.diceExpression);\n      panel.find('#contest-custom-dice-opp').val('');\n      panel.find('.acu-dice-quick-preset-btn').removeClass('active');\n      // []  presetId  custom \n      if (presetId) {\n        panel.find(`.acu-dice-quick-preset-btn[data-preset-id=\"${presetId}\"]`).addClass('active');\n      }\n\n      // []  customFields \n      addClearButton(\n        $initCustomFields,\n        '.acu-dice-custom-field-contest[type=\"text\"], .acu-dice-custom-field-contest[type=\"number\"]',\n      );\n      addClearButton(\n        $oppCustomFields,\n        '.acu-dice-custom-field-contest[type=\"text\"], .acu-dice-custom-field-contest[type=\"number\"]',\n      );\n      addClearButton(\n        $initValuesRow,\n        '.acu-dice-custom-field-contest[type=\"text\"], .acu-dice-custom-field-contest[type=\"number\"]',\n      );\n      addClearButton(\n        $oppValuesRow,\n        '.acu-dice-custom-field-contest[type=\"text\"], .acu-dice-custom-field-contest[type=\"number\"]',\n      );\n      addClearButton(\n        $initPrimaryRow,\n        '.acu-dice-custom-field-contest[type=\"text\"], .acu-dice-custom-field-contest[type=\"number\"]',\n      );\n      addClearButton(\n        $oppPrimaryRow,\n        '.acu-dice-custom-field-contest[type=\"text\"], .acu-dice-custom-field-contest[type=\"number\"]',\n      );\n\n      console.log(\n        '[DICE] :',\n        preset.name,\n        ':',\n        totalFields,\n        ':',\n        baseVisibleCount,\n        'customFields:',\n        customFieldCount,\n      );\n    };\n\n    // [UI] \n    const savedContestPreset = AdvancedDicePresetManager.getActivePreset();\n    const savedSupportedContestPreset =\n      savedContestPreset && AdvancedDicePresetManager.supportsContest(savedContestPreset) ? savedContestPreset : null;\n    const defaultContestPresetId = contestAvailablePresets.length > 0 ? contestAvailablePresets[0].id : null;\n    const savedPresetId = localStorage.getItem(STORAGE_KEY_LAST_PRESET);\n\n    if (savedPresetId === '__custom__') {\n      // [] UI\n      panel.find('.acu-dice-quick-preset-btn').removeClass('active');\n      panel.find('.acu-dice-quick-preset-btn[data-dice=\"custom\"]').addClass('active');\n      panel.find('#contest-init-dice-syntax-row').show();\n      panel.find('#contest-opp-dice-syntax-row').show();\n      panel.find('#contest-custom-judge-row').show();\n      panel.find('#contest-init-values-row, #contest-opp-values-row').hide();\n      panel.find('#contest-init-custom-fields, #contest-opp-custom-fields').hide();\n      // [] \n      applyContestAdvancedPreset(null);\n    } else if (savedSupportedContestPreset) {\n      // \n      panel.find('.acu-dice-quick-preset-btn').removeClass('active');\n      const $matchedBtn = panel.find(`.acu-dice-quick-preset-btn[data-preset-id=\"${savedSupportedContestPreset.id}\"]`);\n      if ($matchedBtn.length) {\n        $matchedBtn.addClass('active');\n      }\n      applyContestAdvancedPreset(savedSupportedContestPreset.id);\n    } else if (defaultContestPresetId) {\n      // \n      panel.find('.acu-dice-quick-preset-btn').removeClass('active');\n      const $defaultBtn = panel.find(`.acu-dice-quick-preset-btn[data-preset-id=\"${defaultContestPresetId}\"]`);\n      if ($defaultBtn.length) {\n        $defaultBtn.addClass('active');\n        panel.find('#contest-dice-type').val(($defaultBtn.data('dice') as string) || '1d100');\n      }\n      applyContestAdvancedPreset(defaultContestPresetId);\n    }\n\n    // \n    panel.find('#contest-init-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-init-name'), newAttrList.length > 0 ? newAttrList : contestAttrList);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'init');\n    });\n\n    // \n    panel.find('#contest-opponent-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim();\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-opp-name'), newAttrList.length > 0 ? newAttrList : contestAttrList);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'opp');\n    });\n\n    // \n    panel.find('#contest-init-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-init-display').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        const targetInput = getContestAttrTargetInput('init', attrName);\n        panel.find(targetInput).val(attrValue).trigger('change');\n      }\n    });\n\n    // \n    panel.find('#contest-opp-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-opponent-display').val().trim();\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        const targetInput = getContestAttrTargetInput('opp', attrName);\n        panel.find(targetInput).val(attrValue).trigger('change');\n      }\n    });\n\n    // \n    panel.find('.acu-dice-quick-preset-btn').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      // [] \n      const presetId = $(this).data('preset-id') as string | undefined;\n      if (presetId && !AdvancedDicePresetManager.supportsContest(presetId)) {\n        const preset = AdvancedDicePresetManager.getAllPresets().find(p => p.id === presetId);\n        toastr.warning(`${preset?.name || presetId} `);\n        return; // \n      }\n\n      panel.find('.acu-dice-quick-preset-btn').removeClass('active');\n      $(this).addClass('active');\n      panel.find('#contest-dice-type').val(newDice);\n\n      // [] ID\n      panel.find('#contest-init-dice-syntax-row').hide();\n      panel.find('#contest-opp-dice-syntax-row').hide();\n      panel.find('#contest-custom-judge-row').hide();\n      panel.find('#contest-init-values-row, #contest-opp-values-row').show();\n      panel.find('#contest-init-custom-fields, #contest-opp-custom-fields').show();\n\n      // [UI]  data-preset-id\n      if (presetId) {\n        AdvancedDicePresetManager.setActivePreset(presetId);\n        applyContestAdvancedPreset(presetId);\n      } else {\n        // ID\n        AdvancedDicePresetManager.setActivePreset(null);\n        applyContestAdvancedPreset(null);\n      }\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n    });\n\n    // \n    panel.find('.acu-dice-quick-preset-btn[data-dice=\"custom\"]').click(function () {\n      // \n      panel.find('.acu-dice-quick-preset-btn').removeClass('active');\n      $(this).addClass('active');\n\n      // [] \n      AdvancedDicePresetManager.setActivePreset(null);\n      localStorage.setItem(STORAGE_KEY_LAST_PRESET, '__custom__');\n\n      // [] \n      applyContestAdvancedPreset(null);\n\n      // [] ID\n      panel.find('#contest-init-dice-syntax-row').show();\n      panel.find('#contest-opp-dice-syntax-row').show();\n      panel.find('#contest-custom-judge-row').show();\n      panel.find('#contest-init-values-row, #contest-opp-values-row').hide();\n      panel.find('#contest-init-custom-fields, #contest-opp-custom-fields').hide();\n    });\n\n    //  -  rollComplexDiceExpression \n    const rollDice = function (formula) {\n      const rollResult = rollComplexDiceExpression(formula);\n      const total = rollResult.total;\n      if (Number.isNaN(total)) return { total: 0, rolls: [], sides: 100 };\n      // \n      const basicMatch = formula.match(/^(\\d*)d(\\d+|F)/i);\n      const sidesStr = basicMatch ? basicMatch[2] : '100';\n      const sides = sidesStr.toUpperCase() === 'F' ? 3 : parseInt(sidesStr, 10);\n      return { total, rolls: [], sides };\n    };\n\n    const resolveContest = function (\n      preset: AdvancedDicePreset,\n      initOutcome: OutcomeLevel,\n      oppOutcome: OutcomeLevel,\n      initValue: number,\n      oppValue: number,\n      initAttr: number,\n      oppAttr: number,\n    ): 'initiator' | 'opponent' | 'tie' {\n      const contestRule = preset.contestRule;\n\n      if (!contestRule) {\n        if (initValue > oppValue) return 'initiator';\n        if (oppValue > initValue) return 'opponent';\n        return 'tie';\n      }\n\n      let winner: 'initiator' | 'opponent' | 'tie' = 'tie';\n      const contestMode = contestRule.mode ?? 'custom'; // \n\n      switch (contestMode) {\n        case 'rank': {\n          const initRank = initOutcome.contestRank ?? 50;\n          const oppRank = oppOutcome.contestRank ?? 50;\n          if (initRank > oppRank) winner = 'initiator';\n          else if (oppRank > initRank) winner = 'opponent';\n          break;\n        }\n        case 'value':\n        case 'margin': {\n          //  value \n          if (initValue > oppValue) winner = 'initiator';\n          else if (oppValue > initValue) winner = 'opponent';\n          break;\n        }\n        case 'custom': {\n          if (contestRule.customExpr) {\n            const context = {\n              $initValue: initValue,\n              $oppValue: oppValue,\n              $initRank: initOutcome.contestRank ?? 50,\n              $oppRank: oppOutcome.contestRank ?? 50,\n            };\n            const conditionResult: { success: boolean; value?: number | boolean; error?: string } = evaluateCondition(\n              contestRule.customExpr,\n              context,\n            );\n            if (conditionResult.success) {\n              const isMatch =\n                typeof conditionResult.value === 'number'\n                  ? conditionResult.value !== 0\n                  : Boolean(conditionResult.value);\n              winner = isMatch ? 'initiator' : 'opponent';\n            } else {\n              console.warn('[DICE] :', conditionResult.error);\n            }\n          }\n          break;\n        }\n      }\n\n      const tieBreakers =\n        Array.isArray(contestRule.tieBreakers) && contestRule.tieBreakers.length > 0\n          ? contestRule.tieBreakers\n          : contestRule.tieBreaker\n            ? [contestRule.tieBreaker]\n            : [];\n\n      if (winner === 'tie' && tieBreakers.length > 0) {\n        // \n        for (const tieBreaker of tieBreakers) {\n          if (winner !== 'tie') break;\n          switch (tieBreaker) {\n            case 'higher_attr':\n              if (initAttr > oppAttr) winner = 'initiator';\n              else if (oppAttr > initAttr) winner = 'opponent';\n              break;\n            case 'initiator_wins':\n              winner = 'initiator';\n              break;\n            case 'reroll':\n              // \n              break;\n          }\n        }\n      }\n\n      return winner;\n    };\n\n    // [] \n    const performCustomContestRoll = function () {\n      const $btn = panel.find('#contest-roll-btn');\n\n      // \n      const initDiceExpr = panel.find('#contest-custom-dice-init').val().trim() || '1d100';\n      const oppDiceExpr = panel.find('#contest-custom-dice-opp').val().trim() || initDiceExpr;\n      const judgeRule = panel.find('#contest-custom-judge-rule').val() as string;\n      const tieRule = (panel.find('#contest-custom-tie-rule').val() as string) ?? 'tie';\n\n      // \n      try {\n        const rawDataForAlias = cachedRawData || getTableData();\n        if (rawDataForAlias) {\n          NameAliasRegistry.rebuild(processJsonData(rawDataForAlias || {}));\n        }\n      } catch (error) {\n        console.warn('[DICE] :', error);\n      }\n      const initNameRaw = panel.find('#contest-init-display').val().trim() || '<user>';\n      const initName = initNameRaw === '<user>' ? initNameRaw : NameAliasRegistry.resolve(initNameRaw);\n      const initAttrName = panel.find('#contest-init-name').val().trim() || '';\n      const oppNameRaw = panel.find('#contest-opponent-display').val().trim() || '';\n      const oppName = oppNameRaw === '<user>' ? oppNameRaw : NameAliasRegistry.resolve(oppNameRaw);\n      const oppAttrName = panel.find('#contest-opp-name').val().trim() || initAttrName;\n\n      // \n      const initRoll = rollComplexDiceExpression(initDiceExpr);\n      const oppRoll = rollComplexDiceExpression(oppDiceExpr);\n\n      if (isNaN(initRoll.total) || isNaN(oppRoll.total)) {\n        if (window.toastr) {\n          const errorExpr = isNaN(initRoll.total) ? initDiceExpr : oppDiceExpr;\n          window.toastr.error(`: ${errorExpr}`);\n        }\n        return;\n      }\n\n      const initTotal = initRoll.total;\n      const oppTotal = oppRoll.total;\n\n      // \n      let winner: 'initiator' | 'opponent' | 'tie' = 'tie';\n      switch (judgeRule) {\n        case 'higher':\n          if (initTotal > oppTotal) winner = 'initiator';\n          else if (oppTotal > initTotal) winner = 'opponent';\n          else {\n            //  tieRule\n            if (tieRule === 'initiator_win') winner = 'initiator';\n            else if (tieRule === 'initiator_lose') winner = 'opponent';\n            // tieRule === 'tie'  winner = 'tie'\n          }\n          break;\n        case 'lower':\n          if (initTotal < oppTotal) winner = 'initiator';\n          else if (oppTotal < initTotal) winner = 'opponent';\n          else {\n            if (tieRule === 'initiator_win') winner = 'initiator';\n            else if (tieRule === 'initiator_lose') winner = 'opponent';\n          }\n          break;\n        case 'rank':\n          if (initTotal > oppTotal) winner = 'initiator';\n          else if (oppTotal > initTotal) winner = 'opponent';\n          else {\n            if (tieRule === 'initiator_win') winner = 'initiator';\n            else if (tieRule === 'initiator_lose') winner = 'opponent';\n          }\n          break;\n        case 'none':\n          break;\n      }\n\n      const winnerText =\n        winner === 'initiator'\n          ? `${replaceUserPlaceholders(initName)} `\n          : winner === 'opponent'\n            ? `${replaceUserPlaceholders(oppName)} `\n            : judgeRule === 'none'\n              ? ''\n              : '';\n\n      const contestTitle = initAttrName === oppAttrName ? initAttrName : `${initAttrName} vs ${oppAttrName}`;\n      const compareSymbol = judgeRule === 'lower' ? '<' : '>';\n      let compareExpr = `${initTotal} ${compareSymbol} ${oppTotal}`;\n      if (winner === 'tie' || judgeRule === 'none') {\n        compareExpr = `${initTotal} = ${oppTotal}`;\n      }\n\n      // \n      const outputText = `<meta:>${contestTitle}${replaceUserPlaceholders(initName)}(${initDiceExpr})=${initTotal}${replaceUserPlaceholders(oppName)}(${oppDiceExpr})=${oppTotal} ${compareExpr}${winnerText}</meta:>`;\n\n      // \n      smartInsertToTextarea(outputText, 'dice');\n\n      // \n      const diceCfg = getDiceConfig();\n      const hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n\n      const initDisplayRoll = hideDiceResultFromUser ? '' : initTotal;\n      const oppDisplayRoll = hideDiceResultFromUser ? '' : oppTotal;\n      const showOutcome = judgeRule !== 'none' && !hideDiceResultFromUser;\n      const initOutcomeText = showOutcome ? (winner === 'tie' ? '' : winner === 'initiator' ? '' : '') : '';\n      const oppOutcomeText = showOutcome ? (winner === 'tie' ? '' : winner === 'opponent' ? '' : '') : '';\n\n      panel.find('#contest-result-init').html(`\n        <div class=\"acu-contest-result-name\">${escapeHtml(replaceUserPlaceholders(initName))}</div>\n        <div class=\"acu-contest-result-roll\">${initDisplayRoll}</div>\n        ${showOutcome ? `<div class=\"acu-contest-result-outcome\">${initOutcomeText}</div>` : ''}\n      `);\n\n      panel.find('#contest-result-opp').html(`\n        <div class=\"acu-contest-result-name\">${escapeHtml(replaceUserPlaceholders(oppName))}</div>\n        <div class=\"acu-contest-result-roll\">${oppDisplayRoll}</div>\n        ${showOutcome ? `<div class=\"acu-contest-result-outcome\">${oppOutcomeText}</div>` : ''}\n      `);\n\n      // \n      panel.find('#contest-result-init').removeClass('winner loser');\n      panel.find('#contest-result-opp').removeClass('winner loser');\n      if (!hideDiceResultFromUser && judgeRule !== 'none') {\n        if (winner === 'initiator') {\n          panel.find('#contest-result-init').addClass('winner');\n          panel.find('#contest-result-opp').addClass('loser');\n        } else if (winner === 'opponent') {\n          panel.find('#contest-result-init').addClass('loser');\n          panel.find('#contest-result-opp').addClass('winner');\n        }\n      }\n\n      // \n      panel.find('#contest-result-display').show();\n\n      // \n      $btn.html(`\n        <div class=\"acu-dice-result-display\">\n          <span>${hideDiceResultFromUser ? '' : winnerText}</span>\n          <button class=\"dice-retry-btn acu-dice-retry-btn\" title=\"\">\n            <i class=\"fa-solid fa-rotate-right\"></i>\n          </button>\n        </div>\n      `);\n\n      // \n      $btn.off('click', '.dice-retry-btn').on('click', '.dice-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        performCustomContestRoll();\n      });\n\n      const winnerSide: 'left' | 'right' | 'tie' =\n        winner === 'initiator' ? 'left' : winner === 'opponent' ? 'right' : 'tie';\n      const customContestResult: AcuDice.ContestResult = {\n        left: {\n          name: initName,\n          attribute: initAttrName,\n          roll: initTotal,\n          target: 0,\n          successLevel: winner === 'initiator' ? 1 : winner === 'tie' ? 0 : -1,\n        },\n        right: {\n          name: oppName,\n          attribute: oppAttrName,\n          roll: oppTotal,\n          target: 0,\n          successLevel: winner === 'opponent' ? 1 : winner === 'tie' ? 0 : -1,\n        },\n        winner: winnerSide,\n        message: winnerText,\n      };\n\n      const customContestWithTimestamp = {\n        ...customContestResult,\n        timestamp: Date.now(),\n        detailId: `contest_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,\n        detailLines: [\n          `: ${initName} / : ${oppName}`,\n          `: ${initAttrName} vs ${oppAttrName}`,\n          `: ${initDiceExpr} vs ${oppDiceExpr}`,\n          `: ${initTotal} vs ${oppTotal}`,\n          `: ${judgeRule}`,\n          `: ${tieRule}`,\n          `: ${compareExpr}`,\n          `: ${winnerText}`,\n        ],\n      };\n      contestHistory.push(customContestWithTimestamp);\n      if (contestHistory.length > MAX_HISTORY) {\n        contestHistory.shift();\n      }\n      emitEvent('contest', customContestWithTimestamp);\n    };\n\n    let lastContestRollAt = 0;\n    // \n    const performContestRoll = function () {\n      const $btn = panel.find('#contest-roll-btn');\n      const $row = panel.find('.acu-contest-result-row');\n      const now = Date.now();\n      if (now - lastContestRollAt < 100) return;\n      lastContestRollAt = now;\n\n      // \n      if ($btn.prop('disabled') || $row.hasClass('disabled')) return;\n\n      const lockUI = () => {\n        $btn.prop('disabled', true).addClass('disabled');\n        $row.addClass('disabled').css('pointer-events', 'none');\n      };\n      const unlockUI = () => {\n        $btn.prop('disabled', false).removeClass('disabled');\n        $row.removeClass('disabled').css('pointer-events', '');\n      };\n\n      lockUI();\n      setTimeout(unlockUI, 100);\n\n      // [] ,\n      // \n      if (panel.find('#contest-init-dice-syntax-row').is(':visible')) {\n        performCustomContestRoll();\n        return;\n      }\n\n      var formula = panel.find('#contest-dice-type').val() || '1d100';\n      const activePreset = currentContestAdvancedPreset || AdvancedDicePresetManager.getActivePreset();\n      const hasAdvancedPreset =\n        !!activePreset &&\n        'outcomes' in activePreset &&\n        Array.isArray(activePreset.outcomes) &&\n        activePreset.outcomes.length > 0;\n\n      try {\n        const rawDataForAlias = cachedRawData || getTableData();\n        if (rawDataForAlias) {\n          NameAliasRegistry.rebuild(processJsonData(rawDataForAlias || {}));\n        }\n      } catch (error) {\n        console.warn('[DICE] :', error);\n      }\n\n      var initNameRaw = (panel.find('#contest-init-display').val() || '').toString().trim() || '<user>';\n      var initName = initNameRaw === '<user>' ? initNameRaw : NameAliasRegistry.resolve(initNameRaw);\n      var initAttrName = (panel.find('#contest-init-name').val() || '').toString().trim() || '';\n      // \n      var getHalfMax = function (formulaStr) {\n        var m = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (m) return Math.round((parseInt(m[1], 10) * parseInt(m[2], 10)) / 2);\n        return 50;\n      };\n      const resolveDefaultValue = function (\n        defaultValue: number | string | undefined,\n        context: Record<string, number>,\n      ): number {\n        if (defaultValue === undefined) return 0;\n        if (typeof defaultValue === 'number') return defaultValue;\n        const result = evaluateFormula(defaultValue, context);\n        if (result === 0 && defaultValue !== '0' && String(defaultValue) !== '0') {\n          if (window.toastr) {\n            window.toastr.warning(` \"${defaultValue}\" , 0`);\n          }\n        }\n        return result || 0;\n      };\n\n      // \n      const parseModifier = function (modStr: string): number {\n        if (!modStr || modStr.trim() === '') return 0;\n        const trimmed = modStr.trim();\n\n        // \n        const numValue = parseFloat(trimmed);\n        if (!isNaN(numValue) && isFinite(numValue) && trimmed.match(/^-?\\d+(\\.\\d+)?$/)) {\n          return numValue;\n        }\n\n        const rollResult = rollComplexDiceExpression(trimmed);\n        if (!Number.isNaN(rollResult.total)) return rollResult.total;\n        return 0;\n      };\n\n      var initValueInput = (panel.find('#contest-init-value').val() || '').toString().trim();\n      var initValue;\n      if (initValueInput === '') {\n        // \n        if (hasAdvancedPreset && activePreset && 'attribute' in activePreset) {\n          initValue = resolveDefaultValue(activePreset.attribute?.defaultValue, {});\n        } else {\n          initValue = getHalfMax(formula);\n        }\n      } else {\n        initValue = parseInt(initValueInput, 10) || getHalfMax(formula);\n      }\n      var initTargetInput = (panel.find('#contest-init-target').val() || '').toString().trim();\n      var initTarget;\n      if (initTargetInput !== '') {\n        initTarget = parseInt(initTargetInput, 10);\n      } else {\n        // \n        if (hasAdvancedPreset && activePreset && 'dc' in activePreset) {\n          initTarget = resolveDefaultValue(activePreset.dc?.defaultValue, { $attr: initValue });\n        } else {\n          initTarget = initValue;\n        }\n      }\n\n      var oppNameRaw = (panel.find('#contest-opponent-display').val() || '').toString().trim() || '';\n      var oppName = oppNameRaw === '<user>' ? oppNameRaw : NameAliasRegistry.resolve(oppNameRaw);\n      var oppAttrName = (panel.find('#contest-opp-name').val() || '').toString().trim() || initAttrName;\n      var oppValueInput = (panel.find('#contest-opp-value').val() || '').toString().trim();\n      var oppValue;\n      if (oppValueInput === '') {\n        // \n        if (hasAdvancedPreset && activePreset && 'attribute' in activePreset) {\n          oppValue = resolveDefaultValue(activePreset.attribute?.defaultValue, {});\n        } else {\n          oppValue = getHalfMax(formula);\n        }\n      } else {\n        oppValue = parseInt(oppValueInput, 10) || getHalfMax(formula);\n      }\n      var oppTargetInput = (panel.find('#contest-opp-target').val() || '').toString().trim();\n      var oppTarget;\n      if (oppTargetInput !== '') {\n        oppTarget = parseInt(oppTargetInput, 10);\n      } else {\n        // \n        if (hasAdvancedPreset && activePreset && 'dc' in activePreset) {\n          oppTarget = resolveDefaultValue(activePreset.dc?.defaultValue, { $attr: oppValue });\n        } else {\n          oppTarget = oppValue;\n        }\n      }\n\n      var initModInput = (panel.find('#contest-init-mod').val() || '').toString().trim();\n      var oppModInput = (panel.find('#contest-opp-mod').val() || '').toString().trim();\n      var initSkillModInput = (panel.find('#contest-init-skill-mod').val() || '').toString().trim();\n      var oppSkillModInput = (panel.find('#contest-opp-skill-mod').val() || '').toString().trim();\n      var initMod = initModInput !== '' ? parseModifier(initModInput) : 0;\n      var oppMod = oppModInput !== '' ? parseModifier(oppModInput) : 0;\n\n      //  skillMod\n      var initSkillMod = 0;\n      var oppSkillMod = 0;\n\n      const allPresets = AdvancedDicePresetManager.getAllPresets();\n      const fallbackPresetId = /d100/i.test(formula) ? 'coc7_check' : 'dnd5e_check';\n      const fallbackPreset = allPresets.find(p => p.id === fallbackPresetId);\n      const preset =\n        activePreset &&\n        'outcomes' in activePreset &&\n        Array.isArray(activePreset.outcomes) &&\n        activePreset.outcomes.length > 0\n          ? activePreset\n          : fallbackPreset;\n\n      if (!preset || !Array.isArray(preset.outcomes) || preset.outcomes.length === 0) {\n        console.warn('[DICE]  outcomes');\n        return;\n      }\n\n      if (preset.mod?.hidden) {\n        initMod = 0;\n        oppMod = 0;\n      }\n\n      if (preset.dc?.hidden) {\n        initTarget = resolveDefaultValue(preset.dc?.defaultValue, { $attr: initValue });\n        oppTarget = resolveDefaultValue(preset.dc?.defaultValue, { $attr: oppValue });\n      }\n\n      const hideSkillModInContest =\n        !preset.skillMod || preset.contestRule?.hideSkillMod === true || preset.skillMod.hidden === true;\n      if (!hideSkillModInContest && preset.skillMod) {\n        if (initSkillModInput !== '') {\n          initSkillMod = parseModifier(initSkillModInput);\n        } else {\n          initSkillMod = resolveDefaultValue(preset.skillMod.defaultValue, { $attr: initValue });\n        }\n\n        if (oppSkillModInput !== '') {\n          oppSkillMod = parseModifier(oppSkillModInput);\n        } else {\n          oppSkillMod = resolveDefaultValue(preset.skillMod.defaultValue, { $attr: oppValue });\n        }\n      }\n\n      // []  customFields\n      const collectContestCustomFields = (party: 'init' | 'opp'): Record<string, number | string | boolean> => {\n        const customValues: Record<string, number | string | boolean> = {};\n        if (!('customFields' in preset) || !Array.isArray(preset.customFields) || preset.customFields.length === 0) {\n          return customValues;\n        }\n\n        const $customFields = panel.find(`.acu-dice-custom-field-contest[data-party=\"${party}\"]`);\n        $customFields.each(function () {\n          const $el = $(this);\n          const id = $el.data('id');\n          const fieldConfig = preset.customFields.find(f => f.id === id);\n          if (!fieldConfig) return;\n\n          let val: string | number | boolean;\n          if (fieldConfig.type === 'toggle') {\n            val = $el.prop('checked');\n          } else if (fieldConfig.type === 'number') {\n            const num = parseFloat($el.val() as string);\n            val = isNaN(num) ? (fieldConfig.defaultValue as number) : num;\n          } else if (fieldConfig.type === 'select') {\n            const rawVal = $el.val() as string;\n            const num = parseFloat(rawVal);\n            val = isNaN(num) ? rawVal : num;\n          } else {\n            const rawVal = String($el.val() ?? '').trim();\n            if (rawVal === '' && fieldConfig.defaultValue !== undefined && fieldConfig.defaultValue !== '') {\n              val = fieldConfig.defaultValue as string | number | boolean;\n            } else {\n              val = rawVal;\n            }\n          }\n          customValues['$' + id] = val;\n        });\n        return customValues;\n      };\n\n      // [] \n      const computeDerivedVars = (\n        customValues: Record<string, number | string | boolean>,\n        attrValue: number,\n        modValue: number,\n        dcValue: number,\n      ): Record<string, number> => {\n        const derivedValues: Record<string, number> = {};\n        if (!('derivedVars' in preset) || !Array.isArray(preset.derivedVars) || preset.derivedVars.length === 0) {\n          return derivedValues;\n        }\n\n        const baseContext = {\n          $attr: attrValue,\n          $dc: dcValue,\n          $mod: modValue,\n          ...customValues,\n        };\n\n        preset.derivedVars.forEach(spec => {\n          const id = spec?.id?.trim();\n          if (!id) return;\n          const varName = id.startsWith('$') ? id : `$${id}`;\n          const evalResult = evaluateCondition(spec.expr, { ...baseContext, ...derivedValues });\n          if (!evalResult.success) {\n            console.warn(`[DICE]  ${varName} :`, evalResult.error);\n            derivedValues[varName] = 0;\n            return;\n          }\n          const rawValue = evalResult.value;\n          const numericValue = typeof rawValue === 'number' && Number.isFinite(rawValue) ? rawValue : rawValue ? 1 : 0;\n          derivedValues[varName] = numericValue;\n        });\n        return derivedValues;\n      };\n\n      // []  dicePatches\n      const applyDicePatches = (\n        baseFormula: string,\n        customValues: Record<string, number | string | boolean>,\n        derivedValues: Record<string, number>,\n        attrValue: number,\n        modValue: number,\n        dcValue: number,\n      ): string => {\n        if (!('dicePatches' in preset) || !Array.isArray(preset.dicePatches) || preset.dicePatches.length === 0) {\n          return baseFormula;\n        }\n\n        const patchContext = {\n          $attr: attrValue,\n          $dc: dcValue,\n          $mod: modValue,\n          ...customValues,\n          ...derivedValues,\n        };\n\n        const replacePatchTemplate = (template: string): string => {\n          const varPattern = /\\$[a-zA-Z_]\\w*/g;\n          return template.replace(varPattern, match => {\n            const value = patchContext[match];\n            return typeof value === 'number' && Number.isFinite(value) ? String(value) : '0';\n          });\n        };\n\n        let diceExpression = baseFormula;\n        preset.dicePatches.forEach(patch => {\n          if (!patch) return;\n          if (patch.when) {\n            const conditionResult = evaluateCondition(patch.when, patchContext);\n            if (!conditionResult.success) {\n              console.warn('[DICE]  dicePatches :', conditionResult.error);\n              return;\n            }\n            const shouldApply =\n              typeof conditionResult.value === 'number' ? conditionResult.value !== 0 : Boolean(conditionResult.value);\n            if (!shouldApply) return;\n          }\n\n          const resolvedTemplate = replacePatchTemplate(patch.template ?? '');\n          switch (patch.op) {\n            case 'append':\n              diceExpression = `${diceExpression}${resolvedTemplate}`;\n              break;\n            case 'prepend':\n              diceExpression = `${resolvedTemplate}${diceExpression}`;\n              break;\n            case 'replace':\n              diceExpression = resolvedTemplate;\n              break;\n          }\n        });\n        return diceExpression;\n      };\n\n      //  customFields \n      const initCustomValues = collectContestCustomFields('init');\n      const initDerivedValues = computeDerivedVars(initCustomValues, initValue, initMod, initTarget);\n      const initFormula = applyDicePatches(\n        formula,\n        initCustomValues,\n        initDerivedValues,\n        initValue,\n        initMod,\n        initTarget,\n      );\n\n      //  customFields \n      const oppCustomValues = collectContestCustomFields('opp');\n      const oppDerivedValues = computeDerivedVars(oppCustomValues, oppValue, oppMod, oppTarget);\n      const oppFormula = applyDicePatches(formula, oppCustomValues, oppDerivedValues, oppValue, oppMod, oppTarget);\n\n      // \n      var initResult = rollDice(initFormula);\n      var oppResult = rollDice(oppFormula);\n      var initRollTotal = initResult.total;\n      var oppRollTotal = oppResult.total;\n\n      console.log('[DICE]  - :', initFormula, ':', oppFormula);\n\n      //  attrMod computeModifier\n      let initAttrMod = 0;\n      let oppAttrMod = 0;\n      if ('attribute' in preset && preset.attribute?.computeModifier) {\n        const modFormula = preset.attribute.computeModifier;\n        if (modFormula === 'floor(($attr - 10) / 2)') {\n          // DND5e \n          initAttrMod = Math.floor((initValue - 10) / 2);\n          oppAttrMod = Math.floor((oppValue - 10) / 2);\n        } else {\n          initAttrMod = resolveDefaultValue(modFormula, { $attr: initValue });\n          oppAttrMod = resolveDefaultValue(modFormula, { $attr: oppValue });\n        }\n      }\n\n      const initContext = {\n        $roll: initResult,\n        $attr: initValue,\n        $attrMod: initAttrMod,\n        $skillMod: initSkillMod,\n        $dc: initTarget,\n        $mod: initMod,\n        ...initCustomValues,\n        ...initDerivedValues,\n      };\n      const oppContext = {\n        $roll: oppResult,\n        $attr: oppValue,\n        $attrMod: oppAttrMod,\n        $skillMod: oppSkillMod,\n        $dc: oppTarget,\n        $mod: oppMod,\n        ...oppCustomValues,\n        ...oppDerivedValues,\n      };\n\n      const initOutcome = evaluateOutcomes(preset.outcomes, initContext);\n      const oppOutcome = evaluateOutcomes(preset.outcomes, oppContext);\n      const winnerSide = resolveContest(\n        preset,\n        initOutcome,\n        oppOutcome,\n        initRollTotal + initAttrMod + initSkillMod + initMod,\n        oppRollTotal + oppAttrMod + oppSkillMod + oppMod,\n        initValue,\n        oppValue,\n      );\n\n      let winnerText = '';\n      let winnerResultType = 'warning';\n      if (winnerSide === 'initiator') {\n        winnerText = initName + ' ';\n        winnerResultType = 'success';\n      } else if (winnerSide === 'opponent') {\n        winnerText = oppName + ' ';\n        winnerResultType = 'failure';\n      }\n\n      var diceCfg = getDiceConfig();\n      var hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      var displayInitValue = hideDiceResultFromUser ? '' : initRollTotal;\n      var displayOppValue = hideDiceResultFromUser ? '' : oppRollTotal;\n      var displayInitSuccessName = hideDiceResultFromUser ? '' : initOutcome.name;\n      var displayOppSuccessName = hideDiceResultFromUser ? '' : oppOutcome.name;\n      var displayWinner = hideDiceResultFromUser ? '' : winnerText;\n\n      const getResultTypeFromOutcome = (outcome: OutcomeLevel) => {\n        if (outcome.priority <= 10) return 'critSuccess';\n        if (outcome.priority <= 30) return 'extremeSuccess';\n        if (outcome.priority < 50) return 'success';\n        if (outcome.priority === 50) return 'warning';\n        if (outcome.priority < 90) return 'failure';\n        return 'critFailure';\n      };\n\n      const initResultType = getResultTypeFromOutcome(initOutcome);\n      const oppResultType = getResultTypeFromOutcome(oppOutcome);\n\n      const initBadgeClass = getResultBadgeClass(initResultType);\n      const oppBadgeClass = getResultBadgeClass(oppResultType);\n      // \n      const winnerColorClass =\n        winnerResultType === 'success'\n          ? 'acu-contest-winner-success'\n          : winnerResultType === 'warning'\n            ? 'acu-contest-winner-warning'\n            : 'acu-contest-winner-failure';\n\n      // \n      const $resultDisplay = panel.find('#contest-result-display');\n      const $resultInit = panel.find('#contest-result-init');\n      const $resultOpp = panel.find('#contest-result-opp');\n\n      // \n      $resultInit.html(\n        '<span class=\"acu-contest-result-name\">' +\n          escapeHtml(initName) +\n          '</span>' +\n          '<span class=\"acu-contest-result-value\">' +\n          displayInitValue +\n          '</span>' +\n          (displayInitSuccessName ? '<span class=\"' + initBadgeClass + '\">' + displayInitSuccessName + '</span>' : ''),\n      );\n\n      // \n      $resultOpp.html(\n        (displayOppSuccessName ? '<span class=\"' + oppBadgeClass + '\">' + displayOppSuccessName + '</span>' : '') +\n          '<span class=\"acu-contest-result-value\">' +\n          displayOppValue +\n          '</span>' +\n          '<span class=\"acu-contest-result-name\">' +\n          escapeHtml(oppName) +\n          '</span>',\n      );\n\n      // roll\n      $resultDisplay.html(\n        '<div class=\"acu-contest-result-container\" title=\"\">' +\n          // \n          '<div class=\"acu-contest-result-row\">' +\n          '<div class=\"acu-contest-result-inner\">' +\n          '<div id=\"contest-result-init\" class=\"acu-contest-result-side\">' +\n          '<span class=\"acu-contest-result-name\">' +\n          escapeHtml(initName) +\n          '</span>' +\n          '<span class=\"acu-contest-result-value\">' +\n          displayInitValue +\n          '</span>' +\n          (displayInitSuccessName ? '<span class=\"' + initBadgeClass + '\">' + displayInitSuccessName + '</span>' : '') +\n          '</div>' +\n          '<span class=\"acu-contest-vs\">VS</span>' +\n          '<div id=\"contest-result-opp\" class=\"acu-contest-result-side right\">' +\n          (displayOppSuccessName ? '<span class=\"' + oppBadgeClass + '\">' + displayOppSuccessName + '</span>' : '') +\n          '<span class=\"acu-contest-result-value\">' +\n          displayOppValue +\n          '</span>' +\n          '<span class=\"acu-contest-result-name\">' +\n          escapeHtml(oppName) +\n          '</span>' +\n          '</div>' +\n          '</div>' +\n          '</div>' +\n          //  + roll\n          '<div class=\"acu-contest-result-winner-row\">' +\n          '<span class=\"acu-contest-winner-text ' +\n          winnerColorClass +\n          '\">' +\n          displayWinner +\n          '</span>' +\n          '<i class=\"fa-solid fa-rotate-right acu-contest-reroll-icon\"></i>' +\n          '</div>' +\n          '</div>',\n      );\n      $resultDisplay.show();\n\n      // \n      $resultDisplay.off('click').on('click', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        performContestRoll();\n      });\n\n      // \n      const $contestBtn = panel.find('#contest-roll-btn');\n      $contestBtn.hide();\n\n      //  ()\n      const template = preset.contestOutputTemplate || DEFAULT_CONTEST_OUTPUT_TEMPLATE;\n      //  displayExpr condition \n      const initDisplayExpr = initOutcome.displayExpr ?? initOutcome.condition;\n      const oppDisplayExpr = oppOutcome.displayExpr ?? oppOutcome.condition;\n      //  $roll.hasTag() \n      let initConditionExpr = initDisplayExpr.replace(\n        /\\$roll\\.hasTag\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*\\)/gi,\n        (_match, tag) => {\n          return (initResult.tags ?? []).includes(tag) ? '' : '';\n        },\n      );\n      initConditionExpr = initConditionExpr\n        .replace(/\\$roll\\.total/g, String(initRollTotal)) //  $roll.total\n        .replace(/\\$roll/g, String(initRollTotal))\n        .replace(/\\$attrMod/g, String(initAttrMod))\n        .replace(/\\$skillMod/g, String(initSkillMod))\n        .replace(/\\$attr/g, String(initValue))\n        .replace(/\\$dc/g, String(initTarget))\n        .replace(/\\$mod/g, String(initMod));\n      let oppConditionExpr = oppDisplayExpr.replace(/\\$roll\\.hasTag\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*\\)/gi, (_match, tag) => {\n        return (oppResult.tags ?? []).includes(tag) ? '' : '';\n      });\n      oppConditionExpr = oppConditionExpr\n        .replace(/\\$roll\\.total/g, String(oppRollTotal)) //  $roll.total\n        .replace(/\\$roll/g, String(oppRollTotal))\n        .replace(/\\$attrMod/g, String(oppAttrMod))\n        .replace(/\\$skillMod/g, String(oppSkillMod))\n        .replace(/\\$attr/g, String(oppValue))\n        .replace(/\\$dc/g, String(oppTarget))\n        .replace(/\\$mod/g, String(oppMod));\n      //  displayExpr \"/\"\n      //  initContext  oppContext\n      const initDisplayExprResult = evaluateCondition(initDisplayExpr, initContext);\n      const oppDisplayExprResult = evaluateCondition(oppDisplayExpr, oppContext);\n      const initJudgeResult =\n        initDisplayExprResult.success &&\n        (typeof initDisplayExprResult.value === 'number'\n          ? initDisplayExprResult.value !== 0\n          : Boolean(initDisplayExprResult.value))\n          ? ''\n          : '';\n      const oppJudgeResult =\n        oppDisplayExprResult.success &&\n        (typeof oppDisplayExprResult.value === 'number'\n          ? oppDisplayExprResult.value !== 0\n          : Boolean(oppDisplayExprResult.value))\n          ? ''\n          : '';\n      const initOutcomeText = initOutcome.outputText || initOutcome.name || '';\n      const oppOutcomeText = oppOutcome.outputText || oppOutcome.name || '';\n      //  +  +  + \n      const initTotal = initRollTotal + initAttrMod + initSkillMod + initMod;\n      const oppTotal = oppRollTotal + oppAttrMod + oppSkillMod + oppMod;\n      const margin = initTotal - oppTotal;\n\n      // [] 0\n      // \n      const initAttrModStr = initAttrMod >= 0 ? `+${initAttrMod}` : String(initAttrMod);\n      const initSkillModStr = initSkillMod >= 0 ? `+${initSkillMod}` : String(initSkillMod);\n      const initAttrModText = initAttrMod !== 0 ? `${initAttrModStr}` : '';\n      const initSkillModText = initSkillMod !== 0 ? `+${initSkillModStr}` : '';\n      const initModText = initMod !== 0 ? `+${initMod >= 0 ? '+' + initMod : initMod}` : '';\n      // \n      const oppAttrModStr = oppAttrMod >= 0 ? `+${oppAttrMod}` : String(oppAttrMod);\n      const oppSkillModStr = oppSkillMod >= 0 ? `+${oppSkillMod}` : String(oppSkillMod);\n      const oppAttrModText = oppAttrMod !== 0 ? `${oppAttrModStr}` : '';\n      const oppSkillModText = oppSkillMod !== 0 ? `+${oppSkillModStr}` : '';\n      const oppModText = oppMod !== 0 ? `+${oppMod >= 0 ? '+' + oppMod : oppMod}` : '';\n\n      const contestOutputContext = {\n        initiator: initName,\n        opponent: oppName,\n        initAttrName: initAttrName,\n        oppAttrName: oppAttrName,\n        initRoll: initRollTotal,\n        oppRoll: oppRollTotal,\n        initTarget: initTarget,\n        oppTarget: oppTarget,\n        initSuccessName: initOutcome.name,\n        oppSuccessName: oppOutcome.name,\n        winner: winnerText, // \"XXX \"  \"\"\n        outcomeText: initOutcomeText,\n        outcomeName: initOutcome.name,\n        conditionExpr: initConditionExpr,\n        judgeResult: initJudgeResult,\n        formula: formula,\n        roll: initRollTotal,\n        dc: initTarget,\n        mod: initMod,\n        attr: initValue,\n        attrName: `${initAttrName}`,\n        initOutcomeText: initOutcomeText,\n        oppOutcomeText: oppOutcomeText,\n        initConditionExpr: initConditionExpr,\n        oppConditionExpr: oppConditionExpr,\n        initJudgeResult: initJudgeResult,\n        oppJudgeResult: oppJudgeResult,\n        //  DND \n        initAttrMod: initAttrMod,\n        oppAttrMod: oppAttrMod,\n        //  DND \n        initSkillMod: initSkillMod,\n        oppSkillMod: oppSkillMod,\n        initMod: initMod,\n        oppMod: oppMod,\n        // [] \n        initAttrModText: initAttrModText,\n        oppAttrModText: oppAttrModText,\n        initSkillModText: initSkillModText,\n        oppSkillModText: oppSkillModText,\n        initModText: initModText,\n        oppModText: oppModText,\n        //  DND/Fate \n        initTotal: initTotal,\n        oppTotal: oppTotal,\n        margin: margin,\n        shifts: margin, // Fate \n        // [] \n        initAttr: initValue,\n        oppAttr: oppValue,\n      };\n      const contestResultText = formatOutputTemplate(template, contestOutputContext);\n      smartInsertToTextarea(contestResultText, 'dice');\n\n      // \n      const getOutcomeLevel = (outcome: OutcomeLevel) => {\n        if (outcome.priority <= 10) return 3;\n        if (outcome.priority <= 30) return 2;\n        if (outcome.priority < 50) return 1;\n        if (outcome.priority === 50) return 0;\n        return -1;\n      };\n      const contestResult: AcuDice.ContestResult = {\n        left: {\n          name: initName,\n          attribute: initAttrName,\n          roll: initRollTotal,\n          target: initTarget,\n          successLevel: getOutcomeLevel(initOutcome),\n        },\n        right: {\n          name: oppName,\n          attribute: oppAttrName,\n          roll: oppRollTotal,\n          target: oppTarget,\n          successLevel: getOutcomeLevel(oppOutcome),\n        },\n        winner: winnerSide === 'initiator' ? 'left' : winnerSide === 'opponent' ? 'right' : 'tie',\n        message: winnerText,\n      };\n\n      // \n      const contestDetailId = `contest_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n      const contestResultWithTimestamp = {\n        ...contestResult,\n        timestamp: Date.now(),\n        detailId: contestDetailId,\n        historyType: 'contest' as const,\n        detailLines: [\n          `: ${initName} / : ${oppName}`,\n          `: ${initAttrName} vs ${oppAttrName}`,\n          `: ${initFormula} vs ${oppFormula}`,\n          `: ${initRollTotal} vs ${oppRollTotal}`,\n          `: ${initTotal} vs ${oppTotal}`,\n          `: ${initConditionExpr} | ${oppConditionExpr}`,\n          `: ${winnerText}`,\n        ],\n      };\n      contestHistory.push(contestResultWithTimestamp);\n      if (contestHistory.length > MAX_HISTORY) {\n        contestHistory.shift();\n      }\n\n      // \n      emitEvent('contest', contestResultWithTimestamp);\n    };\n\n    // \n    panel.find('#contest-roll-btn').click(function () {\n      performContestRoll();\n    });\n\n    // [] \n    panel.find('#contest-switch-normal').click(function () {\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var currentInitName = panel.find('#contest-init-name').val() || '';\n      var currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      var initiatorNameVal = panel.find('#contest-init-display').val().trim();\n      closePanel();\n      showDicePanel({\n        //  null  placeholder\n        attrValue: initValueInput !== '' ? parseInt(initValueInput, 10) : null,\n        targetValue: null,\n        targetName: currentInitName,\n        diceType: currentDice,\n        initiatorName: initiatorNameVal,\n      });\n    });\n    panel.find('#contest-history-btn').click(function (e) {\n      e.stopPropagation();\n      showGlobalDiceHistoryDialog();\n    });\n    //  - \n    // 1d20 -> DND,  -> COC\n    panel.find('.acu-contest-config-btn').click(function (e) {\n      e.stopPropagation();\n      // [] \n      // const currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      // const isDND = currentDice === '1d20';\n      // showDiceSettingsPanel(isDND);\n      showAdvancedPresetManager({ fromDicePanel: true });\n    });\n    var closePanel = function () {\n      overlay.remove();\n      panel.remove();\n    };\n    panel.on('click', function (e) {\n      e.stopPropagation();\n    });\n    overlay.click(closePanel);\n    panel.find('.acu-contest-close').click(closePanel);\n  };\n\n  const parseInSceneStatus = (value, headerName) => {\n    const val = String(value || '')\n      .trim()\n      .toLowerCase();\n    const header = String(headerName || '').toLowerCase();\n    if (!val) return false;\n\n    if (header.includes('')) {\n      return val === '' || val === 'false' || val === 'no';\n    }\n\n    return val.startsWith('') || val === 'true' || val === '' || val === 'yes';\n  };\n\n  const buildMapViewModel = async () => {\n    const rawData = cachedRawData || getTableData();\n    const allTables = processJsonData(rawData || {});\n    NameAliasRegistry.rebuild(allTables);\n    if (!rawData || Object.keys(allTables).length === 0) return null;\n\n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const elementResult = (() => {\n      const keywords = ['', '', '', '', ''];\n      for (const tableName in allTables) {\n        if (keywords.some(keyword => tableName.includes(keyword))) {\n          return {\n            data: allTables[tableName],\n            name: tableName,\n            key: allTables[tableName].key,\n          };\n        }\n      }\n      return null;\n    })();\n\n    const globalHeaders = globalResult?.data?.headers || [];\n    const globalRows = globalResult?.data?.rows || [];\n    const globalRow = globalRows[0] || [];\n    const globalConfig = DASHBOARD_TABLE_CONFIG.global;\n    const detailIdx = DashboardDataParser.findColumnIndex(globalHeaders, 'detailLocation', globalConfig);\n    const regionIdx = DashboardDataParser.findColumnIndex(globalHeaders, 'currentLocation', globalConfig);\n    const detailLocation = detailIdx >= 0 ? String(globalRow[detailIdx] || '').trim() : '';\n    const currentRegion = regionIdx >= 0 ? String(globalRow[regionIdx] || '').trim() : '';\n\n    if (!locationResult?.data) return null;\n\n    const findColumnIndex = (headers, keywords, fallbackIndex = null) => {\n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (keywords.some(keyword => h.includes(keyword.toLowerCase()))) return i;\n      }\n      return fallbackIndex ?? -1;\n    };\n\n    const locations = new Map();\n    const locationHeaders = locationResult.data.headers || [];\n    const locationRows = locationResult.data.rows || [];\n    const locationNameIdx = findColumnIndex(locationHeaders, ['', '', '', '', ''], 1);\n    const locationRegionIdx = findColumnIndex(locationHeaders, ['', '', '', ''], null);\n    const locationTypeIdx = findColumnIndex(locationHeaders, ['', '', ''], null);\n    const locationDescIdx = findColumnIndex(locationHeaders, ['', '', '', '', ''], null);\n    const locationImportanceIdx = findColumnIndex(locationHeaders, ['', ''], null);\n    const locationExploreIdx = findColumnIndex(locationHeaders, ['', '', ''], null);\n\n    // emoji\n    const allLocationNames: string[] = [];\n    locationRows.forEach(row => {\n      const name = String(row[locationNameIdx] || '')\n        .trim()\n        .replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n      if (name) allLocationNames.push(name);\n    });\n    const emojiMap = resolveBatchLocationEmojis(allLocationNames);\n\n    locationRows.forEach((row, idx) => {\n      const name = String(row[locationNameIdx] || '')\n        .trim()\n        .replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n      if (!name) return;\n      const region = locationRegionIdx >= 0 ? String(row[locationRegionIdx] || '').trim() : '';\n\n      const location = {\n        name,\n        region,\n        locationType: locationTypeIdx >= 0 ? row[locationTypeIdx] || '' : '',\n        description: locationDescIdx >= 0 ? row[locationDescIdx] || '' : '',\n        importance: locationImportanceIdx >= 0 ? row[locationImportanceIdx] || '' : '',\n        exploreStatus: locationExploreIdx >= 0 ? row[locationExploreIdx] || '' : '',\n        emoji: emojiMap.get(name) ?? null,\n        tableKey: locationResult.key || '',\n        rowIndex: idx,\n      };\n      locations.set(name, location);\n    });\n\n    const elements = new Map();\n    const addElement = (locationName, element) => {\n      if (!elements.has(locationName)) {\n        elements.set(locationName, []);\n      }\n      elements.get(locationName).push(element);\n    };\n\n    if (elementResult?.data) {\n      const elementHeaders = elementResult.data.headers || [];\n      const elementRows = elementResult.data.rows || [];\n      const elementNameIdx = findColumnIndex(elementHeaders, ['', '', ''], 1);\n      const elementTypeIdx = findColumnIndex(elementHeaders, ['', '', ''], 2);\n      const elementLocationIdx = findColumnIndex(elementHeaders, ['', '', ''], 3);\n      const elementDescIdx = findColumnIndex(elementHeaders, ['', '', ''], null);\n      const elementStatusIdx = findColumnIndex(elementHeaders, ['', ''], null);\n      const elementInteractIdx = findColumnIndex(elementHeaders, ['', '', '', ''], null);\n\n      elementRows.forEach((row, idx) => {\n        const name = String(row[elementNameIdx] || '').trim();\n        if (!name) return;\n        const locationName = String(row[elementLocationIdx] || '').trim();\n        if (!locationName) return;\n        if (currentRegion && locations.size > 0 && !locations.has(locationName)) return;\n\n        const rawInteractions = elementInteractIdx >= 0 ? row[elementInteractIdx] : '';\n        const interactions = String(rawInteractions || '')\n          .split(/[,;]/)\n          .map(item => item.trim())\n          .filter(Boolean);\n        const typeValue = elementTypeIdx >= 0 ? row[elementTypeIdx] || '' : '';\n        const element = {\n          name,\n          type: typeValue,\n          location: locationName,\n          description: elementDescIdx >= 0 ? row[elementDescIdx] || '' : '',\n          status: elementStatusIdx >= 0 ? row[elementStatusIdx] || '' : '',\n          interactions,\n          emoji: getElementEmoji(name, typeValue),\n          tableKey: elementResult.key || '',\n          rowIndex: idx,\n        };\n        addElement(locationName, element);\n      });\n    }\n\n    const characters = new Map();\n    const addCharacter = async character => {\n      const avatarUrl = await AvatarManager.getAsync(character.name);\n      const full = {\n        ...character,\n        avatarUrl,\n        avatarOffsetX: AvatarManager.getOffsetX(character.name),\n        avatarOffsetY: AvatarManager.getOffsetY(character.name),\n        avatarScale: AvatarManager.getScale(character.name),\n      };\n      if (!characters.has(full.location)) {\n        characters.set(full.location, []);\n      }\n      characters.get(full.location).push(full);\n    };\n\n    let playerLocation = '';\n\n    if (playerResult?.data) {\n      const playerConfig = DASHBOARD_TABLE_CONFIG.player;\n      const playerHeaders = playerResult.data.headers || [];\n      const playerRows = playerResult.data.rows || [];\n      const playerRow = playerRows[0] || [];\n      const playerNameIdx = DashboardDataParser.findColumnIndex(playerHeaders, 'name', playerConfig);\n      const playerPosIdx = DashboardDataParser.findColumnIndex(playerHeaders, 'position', playerConfig);\n      const playerNameRaw = playerNameIdx >= 0 ? playerRow[playerNameIdx] : getPlayerName();\n      const playerPosRaw = playerPosIdx >= 0 ? playerRow[playerPosIdx] : '';\n      const playerName = getDisplayName(String(playerNameRaw || '').trim());\n      playerLocation = String(playerPosRaw || '').trim();\n\n      if (!playerLocation && detailLocation) {\n        playerLocation = detailLocation;\n      }\n\n      if (playerName && playerLocation) {\n        await addCharacter({\n          name: playerName,\n          location: playerLocation,\n          isPlayer: true,\n          isInScene: true,\n          tableKey: playerResult.key || '',\n          rowIndex: 0,\n        });\n      }\n    }\n\n    if (npcResult?.data) {\n      const npcConfig = DASHBOARD_TABLE_CONFIG.npc;\n      const npcHeaders = npcResult.data.headers || [];\n      const npcRows = npcResult.data.rows || [];\n      const npcNameIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'name', npcConfig);\n      const npcPosIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'position', npcConfig);\n      const npcInSceneIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'inScene', npcConfig);\n\n      for (let idx = 0; idx < npcRows.length; idx++) {\n        const row = npcRows[idx];\n        const npcName = getDisplayName(String(row[npcNameIdx] || '').trim());\n        if (!npcName) continue;\n        const locationName = String(row[npcPosIdx] || '').trim();\n        if (!locationName) continue;\n        if (currentRegion && locations.size > 0 && !locations.has(locationName)) continue;\n        const inSceneValue = npcInSceneIdx >= 0 ? row[npcInSceneIdx] : '';\n        const inSceneHeader = npcHeaders[npcInSceneIdx] || '';\n        const isInScene = parseInSceneStatus(inSceneValue, inSceneHeader);\n\n        await addCharacter({\n          name: npcName,\n          location: locationName,\n          isPlayer: false,\n          isInScene,\n          tableKey: npcResult.key || '',\n          rowIndex: idx,\n        });\n      }\n    }\n\n    const locationIterator = locations.values();\n    const firstLocation = locationIterator.next().value;\n\n    const allRegions = [...new Set(Array.from(locations.values()).map(l => l.region || ''))].sort();\n    // \"\"\n    const otherIndex = allRegions.indexOf('');\n    if (otherIndex > -1) {\n      allRegions.splice(otherIndex, 1);\n      allRegions.push('');\n    }\n\n    const getHotLocationsInRegion = region => {\n      const regionName = region || '';\n      return Array.from(locations.values())\n        .filter(l => (l.region || '') === regionName)\n        .sort((a, b) => {\n          const scoreA = (characters.get(a.name)?.length || 0) + (elements.get(a.name)?.length || 0);\n          const scoreB = (characters.get(b.name)?.length || 0) + (elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n    };\n\n    const focusLocation = (() => {\n      if (detailLocation && locations.has(detailLocation)) return detailLocation;\n      if (playerLocation && locations.has(playerLocation)) return playerLocation;\n      const fallbackRegion = allRegions[0];\n      if (fallbackRegion) {\n        const regionLocations = getHotLocationsInRegion(fallbackRegion);\n        if (regionLocations.length > 0) return regionLocations[0].name;\n      }\n      return firstLocation ? firstLocation.name : '';\n    })();\n\n    return {\n      currentRegion: currentRegion || locations.get(playerLocation)?.region || '',\n      detailLocation,\n      focusLocation,\n      playerLocation,\n      locations,\n      elements,\n      characters,\n      allRegions,\n    };\n  };\n\n  // \n  let isMapOpening = false;\n\n  const showMapVisualization = async () => {\n    const { $ } = getCore();\n\n    // \n    if (isMapOpening) return;\n    isMapOpening = true;\n\n    // overlay\n    $('.acu-map-overlay').remove();\n\n    let viewModel = await buildMapViewModel();\n    if (!viewModel) {\n      isMapOpening = false;\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const config = getConfig();\n\n    // \n    const tabSelectionCache = new Map<string, string>();\n\n    // \n    const getHotLocationsInRegion = (region: string) => {\n      const regionName = region || '';\n      return Array.from(viewModel.locations.values())\n        .filter(l => (l.region || '') === regionName)\n        .sort((a, b) => {\n          const scoreA =\n            (viewModel.characters.get(a.name)?.length || 0) + (viewModel.elements.get(a.name)?.length || 0);\n          const scoreB =\n            (viewModel.characters.get(b.name)?.length || 0) + (viewModel.elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n    };\n\n    // \"\"\n    const detailLocation = viewModel.detailLocation || '';\n    const playerLocation = viewModel.playerLocation || '';\n    let focusLocation = '';\n    let selectedRegion = viewModel.currentRegion;\n\n    // :  >  > viewModel.focusLocation\n    if (detailLocation && viewModel.locations.has(detailLocation)) {\n      focusLocation = detailLocation;\n      const targetLocation = viewModel.locations.get(detailLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n      focusLocation = playerLocation;\n      const targetLocation = viewModel.locations.get(playerLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    } else if (viewModel.focusLocation && viewModel.locations.has(viewModel.focusLocation)) {\n      focusLocation = viewModel.focusLocation;\n      const targetLocation = viewModel.locations.get(focusLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    }\n\n    if (focusLocation) {\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      // \n      tabSelectionCache.set(selectedRegion, focusLocation);\n    }\n\n    const overlay = $(`\n            <div class=\"acu-map-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-map-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-map-title\">\n                            <i class=\"fa-solid fa-map-location-dot\"></i>\n                            <span class=\"acu-map-region-name\"></span>\n                        </div>\n                        <div class=\"acu-map-region-tabs\"></div>\n                        <div class=\"acu-map-actions\">\n                            <button class=\"acu-map-back-btn\" title=\"\"><i class=\"fa-solid fa-location-crosshairs\"></i></button>\n                            <button class=\"acu-close-btn acu-map-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-map-body\">\n                        <div class=\"acu-map-focus-area\"></div>\n                        <div class=\"acu-map-thumbnails\"></div>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const overlayEl = overlay[0];\n    overlayEl.style.setProperty('position', 'fixed', 'important');\n    overlayEl.style.setProperty('top', '0', 'important');\n    overlayEl.style.setProperty('left', '0', 'important');\n    overlayEl.style.setProperty('right', '0', 'important');\n    overlayEl.style.setProperty('bottom', '0', 'important');\n    overlayEl.style.setProperty('width', '100vw', 'important');\n    overlayEl.style.setProperty('height', '100vh', 'important');\n    overlayEl.style.setProperty('display', 'flex', 'important');\n    overlayEl.style.setProperty('justify-content', 'center', 'important');\n    overlayEl.style.setProperty('align-items', 'center', 'important');\n    overlayEl.style.setProperty('z-index', '31100', 'important');\n\n    // selectedRegion \n    const $focusArea = overlay.find('.acu-map-focus-area');\n    const $thumbnails = overlay.find('.acu-map-thumbnails');\n\n    //  fa:xxx / ti:xxx emoji\n    const renderIconContent = (icon: string): string => {\n      if (icon.startsWith('fa:')) {\n        const name = icon.slice(3);\n        return `<i class=\"fa-solid fa-${name} acu-theme-icon\"></i>`;\n      }\n      if (icon.startsWith('ti:')) {\n        const name = icon.slice(3);\n        return `<i class=\"ti ti-${name} acu-theme-icon\"></i>`;\n      }\n      return icon;\n    };\n\n    const renderElementChip = element => {\n      const name = element.name || element.type || '';\n      const emoji = element.emoji ? `<span class=\"acu-map-chip-emoji\">${renderIconContent(element.emoji)}</span>` : '';\n      return `\n                 <div class=\"acu-map-element-chip acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n                   element.tableKey || '',\n                 )}\" data-row-index=\"${element.rowIndex}\">\n                     ${emoji}\n                     <span class=\"acu-map-chip-name\" title=\"${escapeHtml(name)}\">${escapeHtml(name)}</span>\n                 </div>\n             `;\n    };\n\n    const renderFocusArea = (model, locationName) => {\n      const location = model.locations.get(locationName);\n      if (!location) {\n        return '<div class=\"acu-map-loading\" style=\"grid-column: 1 / -1;\"><div class=\"acu-map-spinner\"></div></div>';\n      }\n\n      const characters = model.characters.get(locationName) || [];\n      const elements = model.elements.get(locationName) || [];\n\n      // \n      const leftChars = characters.slice(0, Math.ceil(characters.length / 2));\n      const rightChars = characters.slice(Math.ceil(characters.length / 2));\n      const leftElems = elements.slice(0, Math.ceil(elements.length / 2));\n      const rightElems = elements.slice(Math.ceil(elements.length / 2));\n\n      const renderAvatarHtml = char => {\n        const displayName = replaceUserPlaceholders(char.name);\n        const avatarStyle = char.avatarUrl\n          ? `background-image:url('${char.avatarUrl}');background-size:${char.avatarScale}%;background-position:${char.avatarOffsetX}% ${char.avatarOffsetY}%;`\n          : '';\n        return `\n            <div class=\"acu-map-avatar acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n              char.tableKey || '',\n            )}\" data-row-index=\"${char.rowIndex}\">\n                <div class=\"acu-map-avatar-circle\" style=\"${avatarStyle}\">\n                    ${char.avatarUrl ? '' : `<span>${escapeHtml(displayName.charAt(0))}</span>`}\n                </div>\n                <div class=\"acu-map-avatar-name\" title=\"${escapeHtml(displayName)}\">${escapeHtml(\n                  displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName,\n                )}</div>\n            </div>\n        `;\n      };\n\n      const leftAvatarsHtml = leftChars.length ? leftChars.map(renderAvatarHtml).join('') : '';\n      const rightAvatarsHtml = rightChars.length ? rightChars.map(renderAvatarHtml).join('') : '';\n      const leftElemsHtml = leftElems.length ? leftElems.map(e => renderElementChip(e)).join('') : '';\n      const rightElemsHtml = rightElems.length ? rightElems.map(e => renderElementChip(e)).join('') : '';\n\n      const emojiHtml = location.emoji\n        ? `<div class=\"acu-map-location-emoji\">${renderIconContent(location.emoji)}</div>`\n        : `<div class=\"acu-map-location-text\">${escapeHtml(location.name.charAt(0) || '')}</div>`;\n\n      return `\n        <div class=\"acu-map-wing left\">\n            <div class=\"acu-map-avatar-group acu-group-left\">${leftAvatarsHtml || ''}</div>\n            <div class=\"acu-map-element-group acu-group-left\">${leftElemsHtml || ''}</div>\n        </div>\n        <div class=\"acu-map-stage-center acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n          location.tableKey,\n        )}\" data-row-index=\"${location.rowIndex}\">\n            ${emojiHtml}\n            <div class=\"acu-map-location-name\" title=\"${escapeHtml(location.name)}\">${escapeHtml(location.name)}</div>\n        </div>\n        <div class=\"acu-map-wing right\">\n            <div class=\"acu-map-avatar-group acu-group-right\">${rightAvatarsHtml || ''}</div>\n            <div class=\"acu-map-element-group acu-group-right\">${rightElemsHtml || ''}</div>\n        </div>\n        <div class=\"acu-map-mobile-stack\">\n            <div class=\"acu-map-mobile-avatars\">${leftAvatarsHtml || ''}${rightAvatarsHtml || ''}</div>\n            <div class=\"acu-map-mobile-elements\">${leftElemsHtml || ''}${rightElemsHtml || ''}</div>\n        </div>\n    `;\n    };\n\n    const renderThumbnailLocation = (model, location, isActive) => {\n      const charCount = (model.characters.get(location.name) || []).length;\n      const elementCount = (model.elements.get(location.name) || []).length;\n      const totalCount = charCount + elementCount;\n      const emoji = location.emoji\n        ? `<div class=\"acu-map-thumbnail-emoji\">${renderIconContent(location.emoji)}</div>`\n        : `<div class=\"acu-map-thumbnail-placeholder\">${escapeHtml(location.name.charAt(0) || '')}</div>`;\n      const badgeHtml = totalCount > 0 ? `<div class=\"acu-map-thumbnail-badge\">${totalCount}</div>` : '';\n      return `\n        <div class=\"acu-map-thumbnail ${isActive ? 'active' : ''}\" data-location=\"${escapeHtml(location.name)}\">\n            ${badgeHtml}\n            ${emoji}\n            <div class=\"acu-map-thumbnail-name\" title=\"${escapeHtml(location.name)}\">${escapeHtml(\n              location.name.length > 6 ? location.name.substring(0, 6) + '..' : location.name,\n            )}</div>\n        </div>\n    `;\n    };\n\n    const renderRegionTabs = (regions, currentRegion) => {\n      if (regions.length <= 1) return '';\n      return regions\n        .map(\n          r =>\n            `<button class=\"acu-map-region-tab ${r === currentRegion ? 'active' : ''}\" data-region=\"${escapeHtml(\n              r,\n            )}\">${escapeHtml(r)}</button>`,\n        )\n        .join('');\n    };\n\n    const refreshPanel = () => {\n      $focusArea.html(renderFocusArea(viewModel, focusLocation));\n\n      const regionLocations = Array.from(viewModel.locations.values())\n        .filter(l => (l.region || '') === selectedRegion)\n        .sort((a, b) => {\n          // :  + \n          const scoreA =\n            (viewModel.characters.get(a.name)?.length || 0) + (viewModel.elements.get(a.name)?.length || 0);\n          const scoreB =\n            (viewModel.characters.get(b.name)?.length || 0) + (viewModel.elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n\n      const thumbnails = regionLocations\n        .map(location => renderThumbnailLocation(viewModel, location, location.name === focusLocation))\n        .join('');\n      $thumbnails.html(thumbnails || '<div class=\"acu-map-empty\"></div>');\n\n      overlay.find('.acu-map-region-tabs').html(renderRegionTabs(viewModel.allRegions, selectedRegion));\n    };\n\n    const setFocusLocation = name => {\n      if (!name) return;\n      focusLocation = name;\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      // \n      tabSelectionCache.set(selectedRegion, focusLocation);\n      refreshPanel();\n    };\n\n    refreshPanel();\n\n    // [] \n    overlay.data('refreshMapData', async () => {\n      const newViewModel = await buildMapViewModel();\n      if (newViewModel) {\n        viewModel = newViewModel;\n\n        // [] \n        if (!viewModel.locations.has(focusLocation)) {\n          // [] \n          const detailLocation = viewModel.detailLocation || '';\n          const playerLocation = viewModel.playerLocation || '';\n\n          let newFocus = '';\n          let newRegion = selectedRegion;\n\n          // 1: \n          const regionLocs = Array.from(viewModel.locations.values()).filter(\n            l => (l.region || '') === selectedRegion,\n          );\n          if (regionLocs.length > 0) {\n            newFocus = regionLocs[0].name;\n          } else if (detailLocation && viewModel.locations.has(detailLocation)) {\n            // 2: detailLocation\n            newFocus = detailLocation;\n            const loc = viewModel.locations.get(detailLocation);\n            newRegion = loc?.region || newRegion;\n          } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n            // 3: playerLocation\n            newFocus = playerLocation;\n            const loc = viewModel.locations.get(playerLocation);\n            newRegion = loc?.region || newRegion;\n          } else if (viewModel.focusLocation && viewModel.locations.has(viewModel.focusLocation)) {\n            // 4: focusLocation\n            newFocus = viewModel.focusLocation;\n            const loc = viewModel.locations.get(newFocus);\n            newRegion = loc?.region || newRegion;\n          } else {\n            // \n            const firstLoc = Array.from(viewModel.locations.values())[0];\n            if (firstLoc) {\n              newFocus = firstLoc.name;\n              newRegion = firstLoc.region || '';\n            }\n          }\n\n          if (newFocus) {\n            focusLocation = newFocus;\n            selectedRegion = newRegion;\n            // Store\n            Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n            // tab\n            tabSelectionCache.set(selectedRegion, focusLocation);\n          }\n        }\n\n        refreshPanel();\n      }\n    });\n\n    // [] \n    const $closeBtn = overlay.find('.acu-map-close');\n    $closeBtn.on('click', e => {\n      e.preventDefault();\n      e.stopPropagation();\n      e.stopImmediatePropagation();\n      overlay.remove();\n    });\n    overlay.on('click', '.acu-map-region-tab', function () {\n      const newRegion = $(this).data('region');\n      if (newRegion === selectedRegion) return;\n      selectedRegion = newRegion;\n\n      //  focusLocation \n      const regionLocations = Array.from(viewModel.locations.values()).filter(\n        l => (l.region || '') === selectedRegion,\n      );\n      const currentInNewRegion = regionLocations.find(l => l.name === focusLocation);\n\n      if (!currentInNewRegion && regionLocations.length > 0) {\n        // :  > \n        const cachedLocation = tabSelectionCache.get(selectedRegion);\n        const cachedInRegion = cachedLocation && regionLocations.find(l => l.name === cachedLocation);\n\n        if (cachedInRegion) {\n          // \n          focusLocation = cachedLocation;\n        } else {\n          // \n          const hotLocations = getHotLocationsInRegion(selectedRegion);\n          focusLocation = hotLocations.length > 0 ? hotLocations[0].name : regionLocations[0].name;\n        }\n        Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      }\n\n      refreshPanel();\n    });\n    setupOverlayClose(overlay, 'acu-map-overlay', () => {\n      overlay.remove();\n    });\n\n    overlay.on('click', '.acu-map-thumbnail', function () {\n      const locationName = $(this).data('location');\n      if (locationName) setFocusLocation(locationName);\n    });\n\n    overlay.on('click', '.acu-map-back-btn', () => {\n      const fallbackFocus = viewModel.focusLocation;\n      const detailLocation = viewModel.detailLocation || '';\n      const playerLocation = viewModel.playerLocation || '';\n\n      let target = '';\n      if (detailLocation && viewModel.locations.has(detailLocation)) {\n        target = detailLocation;\n      } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n        target = playerLocation;\n      } else if (fallbackFocus && viewModel.locations.has(fallbackFocus)) {\n        target = fallbackFocus;\n      }\n\n      if (!target) return;\n\n      // \n      const targetLocation = viewModel.locations.get(target);\n      const targetRegion = targetLocation?.region || viewModel.currentRegion || '';\n      if (targetRegion !== selectedRegion) {\n        selectedRegion = targetRegion;\n      }\n\n      focusLocation = target;\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      refreshPanel();\n    });\n\n    // \n    isMapOpening = false;\n\n    // \n    // \n  };\n\n  // \n  const showRelationshipGraph = npcTable => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n    $('.acu-relation-graph-overlay').remove();\n\n    const config = getConfig();\n\n    const headers = npcTable.headers || [];\n    const rows = npcTable.rows || [];\n\n    const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n    const relationIdx = headers.findIndex(h => h && h.includes(''));\n    const npcTableKey = npcTable.key || '';\n\n    console.info(`[DICE]: \"${npcTableKey || ''}\"${rows.length}`);\n\n    if (relationIdx < 0) {\n      console.warn('[DICE]: \"\"');\n      if (window.toastr) window.toastr.warning('\"\"');\n      return;\n    }\n\n    const nodes = new Map();\n    const edges = [];\n\n    // {{user}}\n    const resolveUserPlaceholder = name => {\n      if (!name) return name;\n      const playerName = getPlayerName();\n      const personaName = getPersonaName();\n\n      // \n      const diceCfg = getDiceConfig();\n      const explicitUserVariants = ['<user>', '{{user}}'];\n      if (diceCfg.autoMergeProtagonist !== false) {\n        explicitUserVariants.push('');\n      }\n      const isExplicitUserVariant = explicitUserVariants.some(\n        v => name === v || name.toLowerCase() === v.toLowerCase(),\n      );\n\n      // persona\n      const isPersonaName = personaName && name === personaName;\n\n      // \"\"\n      //  autoMergeProtagonist  {{user}}\n      const isPlayerName = (() => {\n        if (!playerName) return false;\n        if (diceCfg.autoMergeProtagonist === false) return false;\n        // \n        if (name === playerName) return true;\n        // \n        const primaryName = AvatarManager.getPrimaryName(name);\n        return primaryName === playerName;\n      })();\n\n      // {{user}}\n      if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n        return '{{user}}';\n      }\n\n      // \n      return AvatarManager.getPrimaryName(name);\n    };\n\n    const resolveName = name => resolveUserPlaceholder(getDisplayName(name));\n\n    const rawData = cachedRawData || getTableData();\n    // \n    NameAliasRegistry.rebuild(processJsonData(rawData || {}));\n    let playerName = '';\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]) {\n          playerName = getDisplayName(sheet.content[1][1] || '');\n          break;\n        }\n      }\n    }\n    const resolvedPlayerName = resolveName(playerName);\n    const playerTableKey = (() => {\n      for (const k in rawData) {\n        if (rawData[k]?.name?.includes('')) return k;\n      }\n      return '';\n    })();\n    nodes.set(resolvedPlayerName, {\n      name: resolvedPlayerName,\n      isPlayer: true,\n      x: 0,\n      y: 0,\n      tableKey: playerTableKey,\n      rowIndex: 0,\n    });\n\n    // \"\"\n    const inSceneColIdx = headers.findIndex(h => h && h.includes(''));\n\n    rows.forEach((row, idx) => {\n      const rawNpcName = row[nameIdx];\n      if (!rawNpcName) return;\n\n      const npcName = resolveName(rawNpcName);\n\n      // \n      let isInScene = false;\n      if (inSceneColIdx > 0) {\n        const inSceneVal = String(row[inSceneColIdx] || '')\n          .trim()\n          .toLowerCase();\n        const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n        if (header.includes('')) {\n          isInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n        } else {\n          isInScene =\n            inSceneVal.startsWith('') || inSceneVal === 'true' || inSceneVal === '' || inSceneVal === 'yes';\n        }\n      }\n\n      if (!nodes.has(npcName)) {\n        nodes.set(npcName, {\n          name: npcName,\n          isPlayer: false,\n          x: 0,\n          y: 0,\n          tableKey: npcTableKey,\n          rowIndex: idx,\n          isInScene: isInScene,\n        });\n      }\n\n      const relationStr = row[relationIdx] || '';\n      const relations = parseRelationshipString(relationStr);\n\n      relations.forEach(rel => {\n        if (!rel.name) return;\n        const resolvedRelName = resolveName(rel.name);\n\n        if (resolvedRelName === npcName) return;\n\n        if (!nodes.has(resolvedRelName)) {\n          // NPC\n          let relRowIndex = -1;\n          let relIsInScene = false;\n          for (let ri = 0; ri < rows.length; ri++) {\n            if (resolveName(rows[ri][nameIdx]) === resolvedRelName) {\n              relRowIndex = ri;\n              // \n              if (inSceneColIdx > 0) {\n                const inSceneVal = String(rows[ri][inSceneColIdx] || '')\n                  .trim()\n                  .toLowerCase();\n                const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n                if (header.includes('')) {\n                  relIsInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n                } else {\n                  relIsInScene =\n                    inSceneVal.startsWith('') ||\n                    inSceneVal === 'true' ||\n                    inSceneVal === '' ||\n                    inSceneVal === 'yes';\n                }\n              }\n              break;\n            }\n          }\n          nodes.set(resolvedRelName, {\n            name: resolvedRelName,\n            isPlayer: resolvedRelName === resolvedPlayerName,\n            x: 0,\n            y: 0,\n            tableKey: relRowIndex >= 0 ? npcTableKey : '',\n            rowIndex: relRowIndex >= 0 ? relRowIndex : undefined,\n            isInScene: relIsInScene,\n          });\n        }\n\n        // /\n        const cleanRelation = rawRel => {\n          if (!rawRel) return [];\n          const parts = String(rawRel)\n            .split(/[,;\\/\\|]+|\\s*[&]\\s*|\\s{2,}|\\n/)\n            .map(s => s.trim())\n            .filter(s => s && s.length < 30); // \n\n          // \n          const commonRelations = [\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n          ];\n\n          return parts\n            .map(p => {\n              // [] \n              p = p.replace(/[(][^)]*[)]/g, '').trim();\n              // === XX/  XX ===\n              const specialSuffixMatch = p.match(/^(.+)(|)$/);\n              if (specialSuffixMatch) {\n                p = specialSuffixMatch[1]; // \"\"  \"\"\n              } else {\n                // === XXYY  YY ===\n                p = p.replace(/^[\\u4e00-\\u9fa5]{2,4}(?=[\\u4e00-\\u9fa5]{1,4}$)/, '');\n              }\n\n              // ===  ===\n              p = p.replace(/^(?:|||?|?|)/, '');\n              p = p.replace(/^(?:?|?|?|)/, '');\n              p = p.replace(/^(?:|?|?)/, '');\n\n              // ===  ===\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n\n              // ===  ===\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^(?:||?)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n\n              p = p.trim();\n\n              // === []  ===\n              if (p.length > 8) {\n                // \n                for (const rel of commonRelations) {\n                  if (p.endsWith(rel)) {\n                    return rel;\n                  }\n                }\n                // 2-4\n                const lastChars = p.slice(-4);\n                for (const rel of commonRelations) {\n                  if (lastChars.includes(rel)) {\n                    return rel;\n                  }\n                }\n                // 3\n                return p.slice(-3);\n              }\n\n              return p;\n            })\n            .filter(s => s && s.length > 0 && s.length <= 8);\n        };\n\n        const cleanedLabels = cleanRelation(rel.relation);\n        if (cleanedLabels.length === 0) cleanedLabels.push('');\n\n        // \n        let existingEdge = edges.find(\n          e =>\n            (e.source === npcName && e.target === resolvedRelName) ||\n            (e.source === resolvedRelName && e.target === npcName),\n        );\n\n        if (!existingEdge) {\n          // \n          edges.push({\n            source: npcName,\n            target: resolvedRelName,\n            // \n            labelsFromSource: cleanedLabels.slice(0, 2), // sourcetarget 2\n            labelsFromTarget: [], // targetsource \n          });\n        } else {\n          // \n          if (existingEdge.source === npcName) {\n            // npcsource labelsFromSource\n            const combined = [...(existingEdge.labelsFromSource || []), ...cleanedLabels];\n            // 2\n            existingEdge.labelsFromSource = [...new Set(combined)].slice(0, 2);\n          } else {\n            // npctarget labelsFromTarget\n            const combined = [...(existingEdge.labelsFromTarget || []), ...cleanedLabels];\n            existingEdge.labelsFromTarget = [...new Set(combined)].slice(0, 2);\n          }\n        }\n      });\n    });\n\n    // [] \n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name === '' && sheet.content?.[1]) {\n          const playerHeaders = sheet.content[0] || [];\n          const playerRow = sheet.content[1];\n          const playerRelIdx = playerHeaders.findIndex(h => h && h.includes(''));\n          if (playerRelIdx > 0 && playerRow[playerRelIdx]) {\n            const playerRelations = parseRelationshipString(playerRow[playerRelIdx]);\n            console.info(`[DICE]: ${playerRelations.length}`);\n\n            playerRelations.forEach(rel => {\n              if (!rel.name) return;\n              const resolvedRelName = resolveName(rel.name);\n              if (resolvedRelName === resolvedPlayerName) return;\n\n              if (!nodes.has(resolvedRelName)) {\n                // NPC\n                let relRowIndex = -1;\n                let relIsInScene = false;\n                for (let ri = 0; ri < rows.length; ri++) {\n                  if (resolveName(rows[ri][nameIdx]) === resolvedRelName) {\n                    relRowIndex = ri;\n                    if (inSceneColIdx > 0) {\n                      const inSceneVal = String(rows[ri][inSceneColIdx] || '')\n                        .trim()\n                        .toLowerCase();\n                      const header = String(headers[inSceneColIdx] || '').toLowerCase();\n                      if (header.includes('')) {\n                        relIsInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n                      } else {\n                        relIsInScene =\n                          inSceneVal.startsWith('') ||\n                          inSceneVal === 'true' ||\n                          inSceneVal === '' ||\n                          inSceneVal === 'yes';\n                      }\n                    }\n                    break;\n                  }\n                }\n                nodes.set(resolvedRelName, {\n                  name: resolvedRelName,\n                  isPlayer: false,\n                  x: 0,\n                  y: 0,\n                  tableKey: relRowIndex >= 0 ? npcTableKey : '',\n                  rowIndex: relRowIndex >= 0 ? relRowIndex : undefined,\n                  isInScene: relIsInScene,\n                });\n              }\n\n              // \n              const rawLabel = String(rel.relation || '').trim();\n              const cleanedLabels = rawLabel\n                ? rawLabel\n                    .split(/[,\\/\\|]+/)\n                    .map(s => s.trim())\n                    .filter(s => s && s.length > 0 && s.length <= 8)\n                    .slice(0, 2)\n                : [''];\n              if (cleanedLabels.length === 0) cleanedLabels.push('');\n\n              // NPC\n              let existingEdge = edges.find(\n                e =>\n                  (e.source === resolvedPlayerName && e.target === resolvedRelName) ||\n                  (e.source === resolvedRelName && e.target === resolvedPlayerName),\n              );\n\n              if (!existingEdge) {\n                edges.push({\n                  source: resolvedPlayerName,\n                  target: resolvedRelName,\n                  labelsFromSource: cleanedLabels.slice(0, 2),\n                  labelsFromTarget: [],\n                });\n              } else {\n                // NPC\n                if (existingEdge.source === resolvedPlayerName) {\n                  const combined = [...(existingEdge.labelsFromSource || []), ...cleanedLabels];\n                  existingEdge.labelsFromSource = [...new Set(combined)].slice(0, 2);\n                } else {\n                  const combined = [...(existingEdge.labelsFromTarget || []), ...cleanedLabels];\n                  existingEdge.labelsFromTarget = [...new Set(combined)].slice(0, 2);\n                }\n              }\n            });\n          }\n          break;\n        }\n      }\n    }\n\n    const nodeArr = Array.from(nodes.values());\n    console.info(`[DICE]${nodeArr.length}${edges.length}`);\n    const centerX = 400,\n      centerY = 300;\n\n    // [] \n    const connectionCount = new Map();\n    nodeArr.forEach(node => connectionCount.set(node.name, 0));\n    edges.forEach(edge => {\n      connectionCount.set(edge.source, (connectionCount.get(edge.source) || 0) + 1);\n      connectionCount.set(edge.target, (connectionCount.get(edge.target) || 0) + 1);\n    });\n\n    // [] \n    const isMobileView = window.innerWidth <= 768;\n    const baseRadius = isMobileView ? 22 : 28;\n    const maxRadius = isMobileView ? 38 : 50;\n    const playerBaseRadius = isMobileView ? 28 : 35;\n    const radiusPerConnection = isMobileView ? 2.5 : 3.5;\n\n    //  getNodeRadius \n    let nodeSizeMultiplier = 1.0; // 1.0\n    let filterInScene = false; // +\n    let filterDirectOnly = false; // \n    let centerNodeName = resolvedPlayerName; // \n\n    const getNodeRadius = (nodeName, isPlayer) => {\n      const base = isPlayer ? playerBaseRadius : baseRadius;\n      const count = connectionCount.get(nodeName) || 0;\n      const calculated = Math.min(maxRadius, base + Math.sqrt(count) * radiusPerConnection);\n      // \n      return calculated * nodeSizeMultiplier;\n    };\n\n    // \n    nodeArr.forEach(node => {\n      node.radius = getNodeRadius(node.name, node.isPlayer);\n    });\n\n    // \n    const getFilteredNodes = () => {\n      // \n      if (!filterInScene && !filterDirectOnly) return nodeArr;\n\n      // \n      let directNodes: Set<string> | null = null;\n      if (filterDirectOnly) {\n        directNodes = new Set([centerNodeName]);\n        edges.forEach(edge => {\n          if (edge.source === centerNodeName) directNodes!.add(edge.target);\n          if (edge.target === centerNodeName) directNodes!.add(edge.source);\n        });\n      }\n\n      return nodeArr.filter(n => {\n        // \n        const passInScene = !filterInScene || n.isInScene || n.isPlayer;\n        // \n        const passDirectOnly = !filterDirectOnly || directNodes!.has(n.name);\n        // \n        return passInScene && passDirectOnly;\n      });\n    };\n\n    // [Modified] \n    // ---------------------------------------------------------\n    //  ()\n    const kRepulsion = 20000; //  () - \n    const kSpring = 0.02; //  () - \n    const kGravity = 0.01; //  - \n    const idealLen = 250; //  - \n    const iterations = 300; // \n    const timeStep = 0.5; // \n    const damping = 0.8; //  ()\n\n    // \n    const LAYOUT_CACHE_KEY = 'acu-relation-graph-layout-cache';\n\n    // \n    const getLayoutCacheKey = () => {\n      const nodeNames = nodeArr\n        .map(n => n.name)\n        .sort()\n        .join('|');\n      return `${LAYOUT_CACHE_KEY}-${nodeNames}`;\n    };\n\n    // \n    const saveLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const layoutData = {};\n        nodeArr.forEach(node => {\n          layoutData[node.name] = { x: node.x, y: node.y };\n        });\n        localStorage.setItem(cacheKey, JSON.stringify(layoutData));\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const loadLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const cached = localStorage.getItem(cacheKey);\n        if (!cached) return false;\n\n        const layoutData = JSON.parse(cached);\n        let allNodesFound = true;\n\n        // \n        for (const node of nodeArr) {\n          if (!layoutData[node.name]) {\n            allNodesFound = false;\n            break;\n          }\n        }\n\n        if (allNodesFound) {\n          // \n          nodeArr.forEach(node => {\n            const cached = layoutData[node.name];\n            if (cached) {\n              node.x = cached.x;\n              node.y = cached.y;\n              node.vx = 0;\n              node.vy = 0;\n            }\n          });\n          return true;\n        }\n        return false;\n      } catch (e) {\n        console.warn('[DICE] :', e);\n        return false;\n      }\n    };\n\n    // \n    const clearLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        localStorage.removeItem(cacheKey);\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const runForceDirectedLayout = () => {\n      // \n      nodeArr.forEach(node => {\n        if (node.name === centerNodeName) {\n          node.x = centerX;\n          node.y = centerY;\n          node.vx = 0;\n          node.vy = 0;\n        } else {\n          //  100px \n          const angle = Math.random() * 2 * Math.PI;\n          const dist = 50 + Math.random() * 100;\n          node.x = centerX + Math.cos(angle) * dist;\n          node.y = centerY + Math.sin(angle) * dist;\n          node.vx = 0;\n          node.vy = 0;\n        }\n      });\n\n      //  O(1) \n      const nodeMap = new Map();\n      nodeArr.forEach(n => nodeMap.set(n.name, n));\n\n      //  ()\n      for (let iter = 0; iter < iterations; iter++) {\n        // 1.  ( vs )\n        for (let i = 0; i < nodeArr.length; i++) {\n          const u = nodeArr[i];\n          for (let j = i + 1; j < nodeArr.length; j++) {\n            const v = nodeArr[j];\n            const dx = v.x - u.x;\n            const dy = v.y - u.y;\n            let distSq = dx * dx + dy * dy;\n            if (distSq < 1) distSq = 1; // \n\n            const dist = Math.sqrt(distSq);\n            const force = kRepulsion / distSq;\n\n            const fx = (dx / dist) * force;\n            const fy = (dy / dist) * force;\n\n            if (u.name !== centerNodeName) {\n              u.vx -= fx;\n              u.vy -= fy;\n            }\n            if (v.name !== centerNodeName) {\n              v.vx += fx;\n              v.vy += fy;\n            }\n          }\n        }\n\n        // 2.  ()\n        edges.forEach(edge => {\n          const u = nodeMap.get(edge.source);\n          const v = nodeMap.get(edge.target);\n          if (!u || !v) return;\n\n          const dx = v.x - u.x;\n          const dy = v.y - u.y;\n          const dist = Math.sqrt(dx * dx + dy * dy) || 1;\n\n          // : F = k * ( - )\n          const force = (dist - idealLen) * kSpring;\n\n          const fx = (dx / dist) * force;\n          const fy = (dy / dist) * force;\n\n          if (u.name !== centerNodeName) {\n            u.vx += fx;\n            u.vy += fy;\n          }\n          if (v.name !== centerNodeName) {\n            v.vx -= fx;\n            v.vy -= fy;\n          }\n        });\n\n        // 3.  ()\n        nodeArr.forEach(node => {\n          if (node.name === centerNodeName) return;\n          const dx = centerX - node.x;\n          const dy = centerY - node.y;\n          node.vx += dx * kGravity;\n          node.vy += dy * kGravity;\n        });\n\n        // 4. \n        // \n        const maxSpeed = 50 * (1 - iter / iterations); // \n\n        nodeArr.forEach(node => {\n          if (node.name === centerNodeName) return; //  ()\n\n          // \n          node.vx *= damping;\n          node.vy *= damping;\n\n          // \n          const vMag = Math.sqrt(node.vx * node.vx + node.vy * node.vy);\n          if (vMag > maxSpeed) {\n            node.vx = (node.vx / vMag) * maxSpeed;\n            node.vy = (node.vy / vMag) * maxSpeed;\n          }\n\n          node.x += node.vx * timeStep;\n          node.y += node.vy * timeStep;\n        });\n      }\n\n      // \n      saveLayoutCache();\n    };\n\n    // \n    if (!loadLayoutCache()) {\n      // \n      runForceDirectedLayout();\n    }\n\n    // \n    let scale = 1;\n    let panX = 0;\n    let panY = 0;\n    const minScale = 0.3;\n    const maxScale = 4;\n\n    const overlay = $(`\n            <div class=\"acu-relation-graph-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-relation-graph-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-graph-title\">\n                            <i class=\"fa-solid fa-project-diagram\"></i>\n                            <div class=\"acu-graph-center-dropdown\" id=\"graph-center-dropdown\">\n                                <button class=\"acu-graph-center-trigger\" type=\"button\" title=\"\">\n                                    <span class=\"acu-center-label\">${escapeHtml(replaceUserPlaceholders(centerNodeName))}</span>\n                                    <i class=\"fa-solid fa-caret-down\"></i>\n                                </button>\n                                <div class=\"acu-graph-center-menu\">\n                                    ${nodeArr.map(n => `<div class=\"acu-center-option${n.name === centerNodeName ? ' active' : ''}\" data-value=\"${escapeHtml(n.name)}\">${escapeHtml(replaceUserPlaceholders(n.name))}</div>`).join('')}\n                                </div>\n                            </div>\n                            <button class=\"acu-graph-btn acu-filter-toggle acu-graph-filter-btn\" id=\"filter-in-scene\" title=\"\"><i class=\"fa-solid fa-map-marker-alt\"></i></button>\n                            <button class=\"acu-graph-btn acu-filter-toggle acu-graph-filter-btn\" id=\"filter-direct-only\" title=\"\"><i class=\"fa-solid fa-link\"></i></button>\n                        </div>\n                        <div class=\"acu-graph-actions\">\n                            <button class=\"acu-graph-btn\" id=\"graph-relayout\" title=\"\"><i class=\"fa-solid fa-sync\"></i></button>\n                            <button class=\"acu-graph-btn\" id=\"graph-manage-avatar\" title=\"\"><i class=\"fa-solid fa-user-circle\"></i></button>\n                            <button class=\"acu-graph-btn acu-graph-close\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-canvas-wrapper\">\n                        <svg class=\"acu-graph-svg\" viewBox=\"0 0 800 600\">\n                            <defs>\n                                <marker id=\"arrowhead-end\" markerWidth=\"6\" markerHeight=\"5\" refX=\"5\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 6 2.5, 0 5\" />\n                                </marker>\n                                <marker id=\"arrowhead-start\" markerWidth=\"6\" markerHeight=\"5\" refX=\"1\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"6 0, 0 2.5, 6 5\" />\n                                </marker>\n                                <marker id=\"arrowhead-end-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"6\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 7 3, 0 6\" />\n                                </marker>\n                                <marker id=\"arrowhead-start-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"1\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"7 0, 0 3, 7 6\" />\n                                </marker>\n                            </defs>\n                            <g class=\"acu-graph-transform\">\n                                <g class=\"acu-graph-edges\"></g>\n                                <g class=\"acu-graph-nodes\"></g>\n                            </g>\n                        </svg>\n                        <div class=\"acu-node-size-slider-container\">\n                            <div class=\"acu-slider-header\">\n                                <span class=\"acu-slider-label\"></span>\n                                <span id=\"slider-size-display\" class=\"acu-slider-value\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                            </div>\n                            <input type=\"range\" id=\"node-size-slider\" min=\"0.5\" max=\"2.0\" step=\"0.1\" value=\"${nodeSizeMultiplier}\" class=\"acu-range-input\" />\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-legend\">\n                        <button class=\"acu-graph-btn acu-graph-reset-btn\" id=\"graph-zoom-reset\" title=\"\"><i class=\"fa-solid fa-compress-arrows-alt\"></i><span></span></button>\n                        <div class=\"acu-node-size-stepper-wrapper acu-node-size-wrapper\">\n                            <span style=\"font-size:11px;color:var(--acu-text-sub);white-space:nowrap;\">:</span>\n                            <div class=\"acu-stepper acu-stepper-container\" data-id=\"graph-node-size\" data-min=\"50\" data-max=\"200\" data-step=\"10\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value acu-stepper-value-display\" id=\"node-size-display\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <span class=\"acu-zoom-display acu-zoom-info\">\n                            <span>:</span>\n                            <span>${Math.round(scale * 100)}%</span>\n                        </span>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const $svg = overlay.find('.acu-graph-svg');\n    const $transform = overlay.find('.acu-graph-transform');\n    const $edgesGroup = overlay.find('.acu-graph-edges');\n    const $nodesGroup = overlay.find('.acu-graph-nodes');\n    const $zoomDisplay = overlay.find('.acu-zoom-display span:last-child');\n    const $nodeSizeDisplay = overlay.find('#node-size-display');\n    const $wrapper = overlay.find('.acu-graph-canvas-wrapper');\n\n    const updateTransform = () => {\n      $transform.attr('transform', `translate(${panX}, ${panY}) scale(${scale})`);\n      $zoomDisplay.text(`${Math.round(scale * 100)}%`);\n    };\n\n    const updateNodeSizeDisplay = () => {\n      if ($nodeSizeDisplay.length) {\n        $nodeSizeDisplay.text(`${Math.round(nodeSizeMultiplier * 100)}%`);\n      }\n    };\n\n    const zoomTo = (newScale, centerX = 400, centerY = 300) => {\n      const oldScale = scale;\n      scale = Math.max(minScale, Math.min(maxScale, newScale));\n      const scaleChange = scale / oldScale;\n      panX = centerX - (centerX - panX) * scaleChange;\n      panY = centerY - (centerY - panY) * scaleChange;\n      updateTransform();\n    };\n\n    const render = async () => {\n      // \n      const filteredNodes = getFilteredNodes();\n      const filteredNodeNames = new Set(filteredNodes.map(n => n.name));\n\n      // \n      const filteredEdges = edges.filter(\n        edge => filteredNodeNames.has(edge.source) && filteredNodeNames.has(edge.target),\n      );\n\n      let edgesHtml = '';\n      filteredEdges.forEach((edge, edgeIdx) => {\n        const source = nodes.get(edge.source);\n        const target = nodes.get(edge.target);\n        if (!source || !target) return;\n\n        // \n        const dx = target.x - source.x;\n        const dy = target.y - source.y;\n        const len = Math.sqrt(dx * dx + dy * dy) || 1;\n        const nx = dx / len; // \n        const ny = dy / len;\n\n        // \n        const px = -ny;\n        const py = nx;\n\n        // \n        const hasFromSource =\n          edge.labelsFromSource && edge.labelsFromSource.length > 0 && edge.labelsFromSource.some(l => l);\n        const hasFromTarget =\n          edge.labelsFromTarget && edge.labelsFromTarget.length > 0 && edge.labelsFromTarget.some(l => l);\n\n        // \n        const sourceRadius = source.radius || 28;\n        const targetRadius = target.radius || 28;\n        const arrowGap = 10; // \n        const x1 = source.x + nx * (sourceRadius + arrowGap);\n        const y1 = source.y + ny * (sourceRadius + arrowGap);\n        const x2 = target.x - nx * (targetRadius + arrowGap);\n        const y2 = target.y - ny * (targetRadius + arrowGap);\n\n        // \n        let srcLabels = (edge.labelsFromSource || []).filter(l => l);\n        let tgtLabels = (edge.labelsFromTarget || []).filter(l => l);\n\n        // \n        const srcSet = new Set(srcLabels);\n        const tgtSet = new Set(tgtLabels);\n        const commonLabels = [...srcSet].filter(l => tgtSet.has(l));\n\n        // \n        const srcUnique = srcLabels.filter(l => !commonLabels.includes(l));\n        const tgtUnique = tgtLabels.filter(l => !commonLabels.includes(l));\n\n        // \n        let markerStart = '';\n        let markerEnd = '';\n        if (hasFromSource) markerEnd = 'url(#arrowhead-end)';\n        if (hasFromTarget) markerStart = 'url(#arrowhead-start)';\n\n        edgesHtml += `<line class=\"acu-graph-edge\" x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                    ${markerEnd ? `marker-end=\"${markerEnd}\"` : ''}\n                    ${markerStart ? `marker-start=\"${markerStart}\"` : ''}\n                    data-edge-idx=\"${edgeIdx}\" />`;\n\n        // \n        const midX = (source.x + target.x) / 2;\n        const midY = (source.y + target.y) / 2;\n\n        // \n        const lineLen = Math.sqrt(dx * dx + dy * dy);\n\n        // \"\"\n        const isBidirectional = hasFromSource && hasFromTarget;\n        const isBidirectionalSame =\n          isBidirectional && commonLabels.length > 0 && srcUnique.length === 0 && tgtUnique.length === 0;\n\n        // \n        if (isBidirectionalSame) {\n          // \n          // []  renderRelationIcon  addRelationIcon \n          const renderRelationIconInline = (iconStr: string): string => {\n            if (iconStr.startsWith('fa:')) {\n              return `<i class=\"fa-solid fa-${iconStr.slice(3)}\" style=\"font-size:10px;margin-left:2px;opacity:0.8;\"></i>`;\n            } else if (iconStr.startsWith('ti:')) {\n              return `<i class=\"ti ti-${iconStr.slice(3)}\" style=\"font-size:10px;margin-left:2px;opacity:0.8;\"></i>`;\n            }\n            return iconStr;\n          };\n\n          const addRelationIconInline = (lbl: string): string => {\n            if (!lbl) return '';\n            for (const group of RELATION_ICON_MAP) {\n              for (const kw of group.keywords) {\n                if (lbl.includes(kw)) {\n                  return lbl + renderRelationIconInline(group.icon);\n                }\n              }\n            }\n            return lbl;\n          };\n\n          commonLabels.slice(0, 2).forEach((lbl, i) => {\n            if (!lbl) return;\n            const offsetDir = i === 0 ? 1 : -1;\n            const offsetDist = 6 + i * 10;\n            const lx = midX + px * offsetDir * offsetDist;\n            const ly = midY + py * offsetDir * offsetDist;\n            // [] \n            const content = addRelationIconInline(lbl);\n            if (content.includes('<i ')) {\n              // foreignObjectHTML\n              edgesHtml += `<foreignObject x=\"${lx - 50}\" y=\"${ly - 10}\" width=\"100\" height=\"20\" style=\"overflow:visible;\">\n                <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"acu-graph-edge-label-html\" data-edge-idx=\"${edgeIdx}\" style=\"\n                  display:flex;align-items:center;justify-content:center;\n                  font-size:11px;color:var(--acu-text-sub);white-space:nowrap;\n                  pointer-events:none;\n                \">${content}</div>\n              </foreignObject>`;\n            } else {\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(lbl)}</text>`;\n            }\n          });\n        } else {\n          // \n          // source/target\n          // 25%\n          const safeOffset = Math.max(30, Math.min(lineLen * 0.25, 60));\n\n          // HTML\n          const renderRelationIcon = (iconStr: string): string => {\n            if (iconStr.startsWith('fa:')) {\n              return `<i class=\"fa-solid fa-${iconStr.slice(3)}\" style=\"font-size:10px;margin-left:2px;opacity:0.8;\"></i>`;\n            } else if (iconStr.startsWith('ti:')) {\n              return `<i class=\"ti ti-${iconStr.slice(3)}\" style=\"font-size:10px;margin-left:2px;opacity:0.8;\"></i>`;\n            }\n            return iconStr;\n          };\n\n          // \n          const addRelationIcon = (lbl: string): string => {\n            if (!lbl) return '';\n            for (const group of RELATION_ICON_MAP) {\n              for (const kw of group.keywords) {\n                if (lbl.includes(kw)) {\n                  return lbl + renderRelationIcon(group.icon);\n                }\n              }\n            }\n            return lbl;\n          };\n\n          // \n          const truncateLabel = (lbl: string, maxLen = 4): string => {\n            if (!lbl) return '';\n            const truncated = lbl.length > maxLen ? lbl.substring(0, maxLen) + '..' : lbl;\n            return addRelationIcon(truncated);\n          };\n\n          // HTMLforeignObjectHTML\n          const createLabelHtml = (lbl: string, x: number, y: number, edgeIdx: number, maxLen = 5): string => {\n            const content = truncateLabel(lbl, maxLen);\n            // HTML\n            if (content.includes('<i ')) {\n              // foreignObjectHTML\n              return `<foreignObject x=\"${x - 50}\" y=\"${y - 10}\" width=\"100\" height=\"20\" style=\"overflow:visible;\">\n                <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"acu-graph-edge-label-html\" data-edge-idx=\"${edgeIdx}\" style=\"\n                  display:flex;align-items:center;justify-content:center;\n                  font-size:11px;color:var(--acu-text-sub);white-space:nowrap;\n                  pointer-events:none;\n                \">${content}</div>\n              </foreignObject>`;\n            }\n            // text\n            return `<text class=\"acu-graph-edge-label\" x=\"${x}\" y=\"${y}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(content)}</text>`;\n          };\n\n          // 1. \n          if (commonLabels.length > 0) {\n            commonLabels.slice(0, 1).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const lx = midX + px * 8;\n              const ly = midY + py * 8 - 3;\n              edgesHtml += createLabelHtml(lbl, lx, ly, edgeIdx, 5);\n            });\n          }\n\n          // 2. Sourcesource\n          if (srcUnique.length > 0 || (hasFromSource && !hasFromTarget && commonLabels.length === 0)) {\n            const labelsToShow = srcUnique.length > 0 ? srcUnique : srcLabels;\n            // source\n            const labelBaseX = midX - nx * safeOffset;\n            const labelBaseY = midY - ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? 1 : -1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += createLabelHtml(lbl, lx, ly, edgeIdx, 5);\n            });\n          }\n\n          // 3. Targettarget\n          if (tgtUnique.length > 0 || (hasFromTarget && !hasFromSource && commonLabels.length === 0)) {\n            const labelsToShow = tgtUnique.length > 0 ? tgtUnique : tgtLabels;\n            // target\n            const labelBaseX = midX + nx * safeOffset;\n            const labelBaseY = midY + ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? -1 : 1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += createLabelHtml(lbl, lx, ly, edgeIdx, 5);\n            });\n          }\n        }\n      });\n      $edgesGroup.html(edgesHtml);\n\n      // [] \n      let nodesHtml = '';\n      for (const node of filteredNodes) {\n        //  > URL > ST\n        const nodeAvatar = await AvatarManager.getAsync(node.name);\n        const isPlayer = node.isPlayer;\n\n        // Discord\n        const indicatorRadius = node.radius * 0.22;\n        const indicatorOffset = node.radius * 0.62;\n        const inSceneIndicator = node.isInScene\n          ? `<circle class=\"acu-node-inscene-indicator\" cx=\"${indicatorOffset}\" cy=\"${indicatorOffset}\" r=\"${indicatorRadius}\" style=\"fill:var(--acu-accent);stroke:var(--acu-bg-panel);stroke-width:3;\" />`\n          : '';\n\n        const nodeDisplayName = replaceUserPlaceholders(node.name);\n        nodesHtml += `\n                <g class=\"acu-graph-node acu-dash-preview-trigger\" data-name=\"${escapeHtml(node.name)}\" data-table-key=\"${node.tableKey || ''}\" data-row-index=\"${node.rowIndex !== undefined ? node.rowIndex : ''}\" transform=\"translate(${node.x}, ${node.y})\">\n                    <circle class=\"acu-node-bg\" r=\"${node.radius}\" />\n                    ${\n                      nodeAvatar\n                        ? (() => {\n                            const offsetX = AvatarManager.getOffsetX(node.name);\n                            const offsetY = AvatarManager.getOffsetY(node.name);\n                            const scaleVal = AvatarManager.getScale(node.name);\n                            const size = (node.radius - 2) * 2;\n                            const shadowWidth = 4; // box-shadow\n                            const foSize = size + shadowWidth * 2;\n                            const foOffset = foSize / 2;\n                            return `<foreignObject x=\"${-foOffset}\" y=\"${-foOffset}\" width=\"${foSize}\" height=\"${foSize}\">\n                            <div class=\"acu-node-avatar\" xmlns=\"http://www.w3.org/1999/xhtml\" style=\"\n                                width: ${size}px;\n                                height: ${size}px;\n                                margin: ${shadowWidth}px;\n                                border-radius: 50%;\n                                background-image: url('${nodeAvatar}');\n                                background-size: ${scaleVal}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                                background-repeat: no-repeat;\n                            \"></div>\n                        </foreignObject>`;\n                          })()\n                        : `<text class=\"acu-node-char\" dy=\"0.35em\">${escapeHtml(nodeDisplayName.charAt(0))}</text>`\n                    }\n                    ${inSceneIndicator}\n                    ${node.name === centerNodeName ? `<circle class=\"acu-node-center-indicator\" r=\"${node.radius + 5}\" />` : ''}\n                    <text class=\"acu-node-label\" dy=\"${node.radius + 14}\">${escapeHtml(nodeDisplayName)}</text>\n                </g>\n            `;\n      }\n      $nodesGroup.html(nodesHtml);\n    };\n\n    // [] \n    const highlightNode = nodeName => {\n      $svg.addClass('highlighting');\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if ($(this).data('name') === nodeName) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedNodes = new Set([nodeName]);\n\n      // \n      edges.forEach(edge => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          const otherNode = edge.source === nodeName ? edge.target : edge.source;\n          connectedNodes.add(otherNode);\n        }\n      });\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if (connectedNodes.has($(this).data('name'))) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedEdgeIndices = new Set();\n      edges.forEach((edge, idx) => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          connectedEdgeIndices.add(idx);\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n          if ($(this).attr('marker-end')) {\n            $(this).attr('marker-end', 'url(#arrowhead-end-hl)');\n          }\n          if ($(this).attr('marker-start')) {\n            $(this).attr('marker-start', 'url(#arrowhead-start-hl)');\n          }\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge-label').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n        }\n      });\n    };\n\n    const clearHighlight = () => {\n      $svg.removeClass('highlighting');\n      $nodesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        if ($(this).attr('marker-end')) {\n          $(this).attr('marker-end', 'url(#arrowhead-end)');\n        }\n        if ($(this).attr('marker-start')) {\n          $(this).attr('marker-start', 'url(#arrowhead-start)');\n        }\n      });\n    };\n\n    // []  - PC +  + \n    // pointerfine()coarse()\n    const hasFinePointer = window.matchMedia('(pointer: fine)').matches;\n    const isTouchDevice = !hasFinePointer;\n\n    // \n    let currentHighlightedNode = null; // \n    let longPressTimer = null;\n\n    if (isTouchDevice) {\n      // ==========  ==========\n      let currentHighlightedNode = null;\n\n      $nodesGroup.on('pointerdown', '.acu-graph-node', function (e) {\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        const startX = e.clientX;\n        const startY = e.clientY;\n        const startTime = Date.now();\n        let hasMoved = false;\n        let longPressTriggered = false;\n\n        // \n        if (currentHighlightedNode) {\n          clearHighlight();\n          currentHighlightedNode = null;\n          // return\n          e.preventDefault();\n          e.stopPropagation();\n          return;\n        }\n\n        // \n        const longPressTimer = setTimeout(() => {\n          if (!hasMoved && nodeName) {\n            longPressTriggered = true;\n            currentHighlightedNode = nodeName;\n            highlightNode(nodeName);\n            if (navigator.vibrate) navigator.vibrate(30);\n          }\n        }, 300);\n\n        const onMove = moveE => {\n          const dx = Math.abs(moveE.clientX - startX);\n          const dy = Math.abs(moveE.clientY - startY);\n          if (dx > 8 || dy > 8) {\n            hasMoved = true;\n            clearTimeout(longPressTimer);\n          }\n        };\n\n        const onUp = () => {\n          $(document).off('pointermove.mobilenode pointerup.mobilenode pointercancel.mobilenode');\n          clearTimeout(longPressTimer);\n\n          const elapsed = Date.now() - startTime;\n\n          //   \n          if (longPressTriggered) {\n            return;\n          }\n\n          //   \n          if (hasMoved) {\n            return;\n          }\n\n          // <300ms  \n          if (elapsed < 300) {\n            const nodeName = $node.data('name');\n            // \n            const primaryName = AvatarManager.getPrimaryName(nodeName);\n            const tableKey = $node.data('table-key');\n            let rowIndex = $node.data('row-index');\n\n            // tableKey\n            if (!tableKey || rowIndex === '' || rowIndex === undefined) {\n              // NPC\n              const rawData = cachedRawData || getTableData();\n              if (rawData) {\n                for (const key in rawData) {\n                  const table = rawData[key];\n                  if (!table?.content || !table.name?.includes('NPC')) continue;\n                  const headers = table.content[0] || [];\n                  const nameIdx = headers.findIndex(\n                    h => h && (h.includes('') || h.includes('') || h.includes('')),\n                  );\n                  if (nameIdx < 0) continue;\n                  for (let i = 1; i < table.content.length; i++) {\n                    const rowName = String(table.content[i][nameIdx] || '').trim();\n                    if (rowName === primaryName || AvatarManager.getPrimaryName(rowName) === primaryName) {\n                      // \n                      const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n                        .data('table-key', key)\n                        .data('row-index', i - 1);\n                      $('body').append(tempNode);\n                      tempNode.trigger('click.acu_dash_preview');\n                      tempNode.remove();\n                      return;\n                    }\n                  }\n                }\n              }\n              // \n              if (window.toastr) {\n                window.toastr.info(`${primaryName}`, '', { timeOut: 2000 });\n              }\n              return;\n            }\n\n            // tableKey\n            const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n              .data('table-key', tableKey)\n              .data('row-index', parseInt(rowIndex, 10));\n            $('body').append(tempNode);\n            tempNode.trigger('click.acu_dash_preview');\n            tempNode.remove();\n          }\n        };\n\n        $(document).on('pointermove.mobilenode', onMove);\n        $(document).on('pointerup.mobilenode pointercancel.mobilenode', onUp);\n      });\n\n      // \n      $wrapper.on('pointerup.mobileclear', function (e) {\n        if (currentHighlightedNode && !$(e.target).closest('.acu-graph-node').length) {\n          clearHighlight();\n          currentHighlightedNode = null;\n        }\n      });\n    } else {\n      // ========== PC ==========\n\n      $nodesGroup.on('pointerenter.pchover', '.acu-graph-node', function () {\n        const nodeName = $(this).data('name');\n        if (nodeName) {\n          highlightNode(nodeName);\n        }\n      });\n\n      $nodesGroup.on('pointerleave.pchover', '.acu-graph-node', function () {\n        clearHighlight();\n      });\n\n      // PC\n      $nodesGroup.on('click.pcclick', '.acu-graph-node', function (e) {\n        e.stopPropagation();\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        // \n        const primaryName = AvatarManager.getPrimaryName(nodeName);\n        const tableKey = $node.data('table-key');\n        let rowIndex = $node.data('row-index');\n\n        // tableKey\n        if (!tableKey || rowIndex === '' || rowIndex === undefined) {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            for (const key in rawData) {\n              const table = rawData[key];\n              if (!table?.content || !table.name?.includes('NPC')) continue;\n              const headers = table.content[0] || [];\n              const nameIdx = headers.findIndex(\n                h => h && (h.includes('') || h.includes('') || h.includes('')),\n              );\n              if (nameIdx < 0) continue;\n              for (let i = 1; i < table.content.length; i++) {\n                const rowName = String(table.content[i][nameIdx] || '').trim();\n                if (rowName === primaryName || AvatarManager.getPrimaryName(rowName) === primaryName) {\n                  const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n                    .data('table-key', key)\n                    .data('row-index', i - 1);\n                  $('body').append(tempNode);\n                  tempNode.trigger('click.acu_dash_preview');\n                  tempNode.remove();\n                  return;\n                }\n              }\n            }\n          }\n          if (window.toastr) {\n            window.toastr.info(`${primaryName}`, '', { timeOut: 2000 });\n          }\n          return;\n        }\n\n        // tableKey\n        const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n          .data('table-key', tableKey)\n          .data('row-index', parseInt(rowIndex, 10));\n        $('body').append(tempNode);\n        tempNode.trigger('click.acu_dash_preview');\n        tempNode.remove();\n      });\n    }\n\n    // \n    render().then(() => {\n      updateTransform();\n    });\n\n    //  -  Pointer Events API\n    let isPanning = false;\n    let panStartX = 0,\n      panStartY = 0;\n    let panStartPanX = 0,\n      panStartPanY = 0;\n    let lastPinchDist = 0;\n    let activePointerId = null;\n\n    const wrapperEl = $wrapper[0];\n    const svgEl = $svg[0];\n\n    // Pointer Down - \n    wrapperEl.onpointerdown = function (e) {\n      if (e.button !== 0) return;\n      // [] \n      if ($(e.target).closest('.acu-graph-node').length) return;\n      // [] \n      if ($(e.target).closest('.acu-node-size-slider-container').length) return;\n      e.preventDefault();\n      wrapperEl.setPointerCapture(e.pointerId);\n      activePointerId = e.pointerId;\n      isPanning = true;\n      panStartX = e.clientX;\n      panStartY = e.clientY;\n      panStartPanX = panX;\n      panStartPanY = panY;\n      svgEl.style.cursor = 'grabbing';\n    };\n\n    // Pointer Move - \n    wrapperEl.onpointermove = function (e) {\n      if (!isPanning || e.pointerId !== activePointerId) return;\n      const dx = e.clientX - panStartX;\n      const dy = e.clientY - panStartY;\n      const rect = svgEl.getBoundingClientRect();\n      panX = panStartPanX + (dx / rect.width) * 800;\n      panY = panStartPanY + (dy / rect.height) * 600;\n      updateTransform();\n    };\n\n    // Pointer Up - \n    wrapperEl.onpointerup = function (e) {\n      if (e.pointerId === activePointerId) {\n        wrapperEl.releasePointerCapture(e.pointerId);\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // Pointer Cancel - \n    wrapperEl.onpointercancel = function (e) {\n      if (e.pointerId === activePointerId) {\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // \n    wrapperEl.onwheel = function (e) {\n      e.preventDefault();\n      const delta = e.deltaY > 0 ? -0.15 : 0.15;\n      zoomTo(scale + delta);\n    };\n\n    // \n    wrapperEl.addEventListener(\n      'touchstart',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          isPanning = false;\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener(\n      'touchmove',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            zoomTo(scale * (newDist / lastPinchDist));\n          }\n          lastPinchDist = newDist;\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener('touchend', function (e) {\n      if (e.touches.length < 2) lastPinchDist = 0;\n    });\n\n    // \n    const cleanupEvents = () => {\n      wrapperEl.onpointerdown = null;\n      wrapperEl.onpointermove = null;\n      wrapperEl.onpointerup = null;\n      wrapperEl.onpointercancel = null;\n      wrapperEl.onwheel = null;\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n      $(document).off('click.slider-hide');\n    };\n\n    // \n    const $nodeSizeSlider = overlay.find('#node-size-slider');\n    const $sliderSizeDisplay = overlay.find('#slider-size-display');\n    const $sliderContainer = overlay.find('.acu-node-size-slider-container');\n    const $nodeSizeDisplayTrigger = overlay.find('#node-size-display-trigger');\n    const $legend = overlay.find('.acu-graph-legend');\n\n    let sliderVisible = false;\n    let sliderHideTimer: ReturnType<typeof setTimeout> | null = null;\n    const SLIDER_AUTO_HIDE_DELAY = 4000; // 4\n\n    // \n    const showSlider = () => {\n      if (sliderVisible) return;\n\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = true;\n\n      // \"\"wrappertriggerlegendlegendwrapper\n      // getBoundingClientRectviewport\n      const triggerRect = $nodeSizeDisplayTrigger[0].getBoundingClientRect();\n      const wrapperRect = $wrapper[0].getBoundingClientRect();\n\n      // wrappertrigger\n      const sliderHeight = 60; // \n      const top = wrapperRect.height - sliderHeight - 10; // wrapper\n      const left = triggerRect.left - wrapperRect.left;\n\n      $sliderContainer.css({\n        display: 'block',\n        top: `${top}px`,\n        left: `${left}px`,\n      });\n\n      // \n      resetSliderHideTimer();\n    };\n\n    // \n    const hideSlider = () => {\n      if (!sliderVisible) return;\n\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = false;\n      $sliderContainer.hide();\n    };\n\n    // \n    const resetSliderHideTimer = () => {\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n      }\n      sliderHideTimer = setTimeout(() => {\n        hideSlider();\n      }, SLIDER_AUTO_HIDE_DELAY);\n    };\n\n    // \"\"/\n    overlay.on('click', '#node-size-display-trigger, #node-size-display-trigger *', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        hideSlider();\n      } else {\n        showSlider();\n      }\n    });\n\n    // \n    $nodeSizeSlider.on('input mousedown touchstart', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        resetSliderHideTimer();\n      }\n    });\n\n    // \n    $sliderContainer.on('pointerdown mousedown touchstart', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $(document).on('click.slider-hide', function (e) {\n      if (\n        sliderVisible &&\n        !$sliderContainer.is(e.target) &&\n        $sliderContainer.has(e.target).length === 0 &&\n        !$nodeSizeDisplayTrigger.is(e.target) &&\n        $nodeSizeDisplayTrigger.has(e.target).length === 0\n      ) {\n        hideSlider();\n      }\n    });\n\n    $nodeSizeSlider.on('input', function () {\n      nodeSizeMultiplier = parseFloat($(this).val());\n      $sliderSizeDisplay.text(Math.round(nodeSizeMultiplier * 100) + '%');\n      updateNodeSizeDisplay();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n      render();\n\n      // \n      resetSliderHideTimer();\n    });\n\n    //  toggle \n    const $filterInSceneBtn = overlay.find('#filter-in-scene');\n    const $filterDirectOnlyBtn = overlay.find('#filter-direct-only');\n\n    const updateFilterToggleStyles = () => {\n      $filterInSceneBtn.toggleClass('active', filterInScene);\n      $filterDirectOnlyBtn.toggleClass('active', filterDirectOnly);\n    };\n\n    // \n    updateFilterToggleStyles();\n\n    $filterInSceneBtn.click(function (e) {\n      e.stopPropagation();\n      filterInScene = !filterInScene;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    $filterDirectOnlyBtn.click(function (e) {\n      e.stopPropagation();\n      filterDirectOnly = !filterDirectOnly;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    // [] \n    const $centerDropdown = overlay.find('#graph-center-dropdown');\n    const $centerTrigger = $centerDropdown.find('.acu-graph-center-trigger');\n    const $centerMenu = $centerDropdown.find('.acu-graph-center-menu');\n    const $centerLabel = $centerDropdown.find('.acu-center-label');\n\n    //  toggle \n    $centerTrigger.on('click', function (e) {\n      e.stopPropagation();\n      $centerDropdown.toggleClass('open');\n    });\n\n    // \n    $centerMenu.on('click', '.acu-center-option', function (e) {\n      e.stopPropagation();\n      const newCenter = $(this).data('value') as string;\n      $centerDropdown.removeClass('open');\n      if (newCenter && newCenter !== centerNodeName && nodes.has(newCenter)) {\n        centerNodeName = newCenter;\n        // \n        $centerLabel.text(replaceUserPlaceholders(newCenter));\n        $centerMenu.find('.acu-center-option').removeClass('active');\n        $(this).addClass('active');\n        // \n        clearLayoutCache();\n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        runForceDirectedLayout();\n        render();\n        const displayName = replaceUserPlaceholders(newCenter);\n        if (window.toastr) window.toastr.info(`${displayName}`, '', { timeOut: 1500 });\n      }\n    });\n\n    // \n    overlay.on('click.center-dropdown', function () {\n      $centerDropdown.removeClass('open');\n    });\n\n    //  +  +  + \n    overlay.find('#graph-zoom-reset').click(() => {\n      // \n      scale = 1;\n      panX = 0;\n      panY = 0;\n      updateTransform();\n\n      // \n      centerNodeName = resolvedPlayerName;\n      $centerLabel.text(replaceUserPlaceholders(resolvedPlayerName));\n      $centerMenu.find('.acu-center-option').removeClass('active');\n      $centerMenu.find(`.acu-center-option[data-value=\"${resolvedPlayerName}\"]`).addClass('active');\n\n      // \n      nodeSizeMultiplier = 1.0;\n      $nodeSizeSlider.val(1.0);\n      $sliderSizeDisplay.text('100%');\n      updateNodeSizeDisplay();\n\n      // stepper\n      const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n      if ($nodeSizeStepper.length) {\n        $nodeSizeStepper.find('.acu-stepper-value').text('100%');\n      }\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      if (!loadLayoutCache()) {\n        // \n        runForceDirectedLayout();\n      }\n      render();\n    });\n\n    // Stepper  - \n    const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n    if ($nodeSizeStepper.length) {\n      const min = parseInt($nodeSizeStepper.data('min')); // 50\n      const max = parseInt($nodeSizeStepper.data('max')); // 200\n      const step = parseInt($nodeSizeStepper.data('step')); // 10\n      const $value = $nodeSizeStepper.find('.acu-stepper-value');\n\n      const updateNodeSizeValue = (newPercent: number) => {\n        newPercent = Math.max(min, Math.min(max, newPercent));\n        nodeSizeMultiplier = newPercent / 100; //  (0.5-2.0)\n        $value.text(`${newPercent}%`);\n        updateNodeSizeDisplay();\n\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      };\n\n      const getCurrentPercent = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || 100;\n      };\n\n      $nodeSizeStepper.find('.acu-stepper-dec').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() - step);\n      });\n\n      $nodeSizeStepper.find('.acu-stepper-inc').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() + step);\n      });\n    }\n\n    // \n    overlay.find('#graph-relayout').click(() => {\n      // \n      clearLayoutCache();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      runForceDirectedLayout();\n      render();\n    });\n\n    overlay.find('#graph-manage-avatar').click(() => {\n      // \n      showAvatarManager(nodeArr, () => {\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      });\n    });\n\n    const closeGraph = () => {\n      cleanupEvents();\n      overlay.remove();\n    };\n    overlay.find('.acu-graph-close').click(closeGraph);\n    setupOverlayClose(overlay, 'acu-relation-graph-overlay', closeGraph);\n  };\n  // ========================================\n  //  - PC/\n  // ========================================\n\n  const showAvatarCropModal = (imageSource, characterName, onSave) => {\n    const { $ } = getCore();\n    $('.acu-crop-modal-overlay').remove();\n\n    const config = getConfig();\n\n    // \n    let scale = 150;\n    let offsetX = 50;\n    let offsetY = 50;\n\n    // \n    const existing = AvatarManager.getAll()[characterName];\n    if (existing) {\n      scale = existing.scale ?? 150;\n      offsetX = existing.offsetX ?? 50;\n      offsetY = existing.offsetY ?? 50;\n    }\n\n    const modalHtml = `\n            <div class=\"acu-crop-modal-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-crop-modal\">\n                    <div class=\"acu-crop-header\">\n                        <span><i class=\"fa-solid fa-crop-simple\"></i>  - ${escapeHtml(characterName)}</span>\n                        <button class=\"acu-crop-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-crop-body\">\n                        <div class=\"acu-crop-container\">\n                            <div class=\"acu-crop-image\" style=\"\n                                background-image: url('${imageSource}');\n                                background-size: ${scale}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                            \"></div>\n                            <div class=\"acu-crop-mask\"></div>\n                        </div>\n                        <div class=\"acu-crop-hint\">  /</div>\n                    </div>\n                    <div class=\"acu-crop-footer\">\n                        <label class=\"acu-crop-btn acu-crop-reupload\" title=\"\">\n                            <i class=\"fa-solid fa-camera\"></i>\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-crop-file-input\" />\n                        </label>\n                        <button class=\"acu-crop-btn acu-crop-cancel\"></button>\n                        <button class=\"acu-crop-btn acu-crop-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    const $image = $modal.find('.acu-crop-image');\n    const $container = $modal.find('.acu-crop-container');\n    const containerEl = $container[0];\n    const imageEl = $image[0];\n\n    // \n    const updateImageStyle = () => {\n      imageEl.style.backgroundSize = `${scale}%`;\n      imageEl.style.backgroundPosition = `${offsetX}% ${offsetY}%`;\n    };\n\n    // ===  Pointer Events  ===\n    let isDragging = false;\n    let startX = 0,\n      startY = 0;\n    let startOffsetX = 0,\n      startOffsetY = 0;\n    let activePointerId = null;\n\n    imageEl.addEventListener('pointerdown', e => {\n      // \n      if (activePointerId !== null) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      isDragging = true;\n      activePointerId = e.pointerId;\n      startX = e.clientX;\n      startY = e.clientY;\n      startOffsetX = offsetX;\n      startOffsetY = offsetY;\n\n      imageEl.setPointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grabbing';\n    });\n\n    imageEl.addEventListener('pointermove', e => {\n      if (!isDragging || e.pointerId !== activePointerId) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      const deltaX = e.clientX - startX;\n      const deltaY = e.clientY - startY;\n\n      // \n      const sensitivity = 100 / scale;\n      offsetX = Math.max(0, Math.min(100, startOffsetX - deltaX * sensitivity));\n      offsetY = Math.max(0, Math.min(100, startOffsetY - deltaY * sensitivity));\n      updateImageStyle();\n    });\n\n    imageEl.addEventListener('pointerup', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.releasePointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grab';\n    });\n\n    imageEl.addEventListener('pointercancel', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.style.cursor = 'grab';\n    });\n\n    // ===  ===\n    // \n    containerEl.addEventListener(\n      'wheel',\n      e => {\n        e.preventDefault();\n        e.stopPropagation();\n        const delta = e.deltaY > 0 ? -10 : 10;\n        scale = Math.max(100, Math.min(300, scale + delta));\n        updateImageStyle();\n      },\n      { passive: false },\n    );\n\n    // \n    let lastPinchDist = 0;\n    let pinchStartScale = scale;\n\n    containerEl.addEventListener(\n      'touchstart',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          pinchStartScale = scale;\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener(\n      'touchmove',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            const pinchRatio = newDist / lastPinchDist;\n            scale = Math.max(100, Math.min(300, pinchStartScale * pinchRatio));\n            updateImageStyle();\n          }\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener('touchend', e => {\n      if (e.touches.length < 2) {\n        lastPinchDist = 0;\n        pinchStartScale = scale;\n      }\n    });\n\n    // ===  ===\n    // \n    $modal.find('.acu-crop-file-input').on('change', async function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      if (!file.type.startsWith('image/')) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        if (window.toastr) window.toastr.warning(' 5MB');\n        return;\n      }\n\n      try {\n        // \n        const success = await AvatarManager.saveLocalAvatar(characterName, file);\n        if (success) {\n          //  URL \n          const newUrl = await LocalAvatarDB.get(characterName);\n          imageSource = newUrl;\n\n          // \n          scale = 150;\n          offsetX = 50;\n          offsetY = 50;\n\n          // \n          $image.css('background-image', `url('${newUrl}')`);\n          updateImageStyle();\n        }\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n\n      $(this).val('');\n    });\n    $modal.find('.acu-crop-close, .acu-crop-cancel').on('click', () => {\n      $modal.remove();\n    });\n\n    $modal.find('.acu-crop-confirm').on('click', () => {\n      onSave({ scale, offsetX, offsetY });\n      $modal.remove();\n    });\n\n    // \n    setupOverlayClose($modal, 'acu-crop-modal-overlay', () => {\n      $modal.remove();\n    });\n  };\n  //  - \n  const showAvatarManager = (nodeArr, onUpdate) => {\n    try {\n      const { $ } = getCore();\n      $('.acu-avatar-manager-overlay').remove();\n\n      const config = getConfig();\n      const avatars = AvatarManager.getAll();\n\n      // \n      let currentView = 'chat'; // 'chat' | 'global'\n      let sortBy = 'name'; // 'name' | 'date' | 'source'\n      let sortOrder = 'asc'; // 'asc' | 'desc'\n      let searchQuery = '';\n      const expandedItems = new Set<string>(); // \n      let isInitialLoad = true; // \n\n      // {{user}}\n      const resolveUserPlaceholderForAvatar = name => {\n        if (!name) return name;\n        const playerName = getPlayerName();\n        const personaName = getPersonaName();\n\n        // \n        const diceCfg = getDiceConfig();\n        const explicitUserVariants = ['<user>', '{{user}}'];\n        if (diceCfg.autoMergeProtagonist !== false) {\n          explicitUserVariants.push('');\n        }\n        const isExplicitUserVariant = explicitUserVariants.some(\n          v => name === v || name.toLowerCase() === v.toLowerCase(),\n        );\n\n        // persona\n        const isPersonaName = personaName && name === personaName;\n\n        // \"\"\n        const isPlayerName = (() => {\n          if (!playerName) return false;\n          // \n          if (name === playerName) return true;\n          // \n          const primaryName = AvatarManager.getPrimaryName(name);\n          return primaryName === playerName;\n        })();\n\n        // {{user}}\n        if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n          return '{{user}}';\n        }\n\n        // \n        return AvatarManager.getPrimaryName(name);\n      };\n\n      // \n      const buildList = async () => {\n        let listHtml = '';\n\n        //  ()\n        const allAvatarData = AvatarManager.getAll();\n\n        // \n        let workingNodes = [];\n        if (currentView === 'chat') {\n          //  nodeArr\n          workingNodes = nodeArr.map(n => ({ name: n.name, isPlayer: n.isPlayer }));\n        } else {\n          //  + \n          const seenNames = new Set<string>();\n          const merged: { name: string; isPlayer: boolean }[] = [];\n\n          // \n          for (const n of nodeArr) {\n            if (!seenNames.has(n.name)) {\n              seenNames.add(n.name);\n              merged.push({ name: n.name, isPlayer: n.isPlayer });\n            }\n          }\n\n          // \n          for (const name of Object.keys(allAvatarData)) {\n            if (!seenNames.has(name)) {\n              seenNames.add(name);\n              merged.push({ name, isPlayer: false });\n            }\n          }\n\n          workingNodes = merged;\n        }\n\n        // {{user}}\n        const userNode = workingNodes.find(n => {\n          const resolved = resolveUserPlaceholderForAvatar(n.name);\n          return resolved === '{{user}}';\n        });\n        let otherNodes = workingNodes.filter(n => {\n          const resolved = resolveUserPlaceholderForAvatar(n.name);\n          return resolved !== '{{user}}';\n        });\n\n        // \n        if (searchQuery) {\n          const query = searchQuery.toLowerCase();\n          otherNodes = otherNodes.filter(n => {\n            const nameMatch = n.name.toLowerCase().includes(query);\n            const aliasMatch = (allAvatarData[n.name]?.aliases || []).some(alias =>\n              alias.toLowerCase().includes(query),\n            );\n            return nameMatch || aliasMatch;\n          });\n        }\n\n        // \n        const nodeSourceMap = new Map<string, { hasLocal: boolean; hasUrl: boolean }>();\n        if (sortBy === 'source') {\n          for (const node of otherNodes) {\n            const hasLocal = await AvatarManager.hasLocalAvatar(node.name);\n            const hasUrl = !!allAvatarData[node.name]?.url;\n            nodeSourceMap.set(node.name, { hasLocal, hasUrl });\n          }\n        }\n\n        // \n        if (sortBy === 'source') {\n          //  > URL > \n          // : local(0) < url(1) < none(2)\n          // : none(2) < url(1) < local(0)\n          const getSourcePriority = (name: string) => {\n            const info = nodeSourceMap.get(name);\n            if (info?.hasLocal) return 0; // \n            if (info?.hasUrl) return 1; // URL\n            return 2; // \n          };\n          otherNodes.sort((a, b) => {\n            const priorityA = getSourcePriority(a.name);\n            const priorityB = getSourcePriority(b.name);\n            const cmp = priorityA - priorityB;\n            return sortOrder === 'asc' ? cmp : -cmp;\n          });\n        } else if (sortBy === 'name') {\n          otherNodes.sort((a, b) => {\n            const cmp = a.name.localeCompare(b.name, 'zh-CN');\n            return sortOrder === 'asc' ? cmp : -cmp;\n          });\n        } else {\n          // \n          otherNodes.sort((a, b) => {\n            const timeA = allAvatarData[a.name]?.createdAt ?? 0;\n            const timeB = allAvatarData[b.name]?.createdAt ?? 0;\n            return sortOrder === 'asc' ? timeA - timeB : timeB - timeA;\n          });\n        }\n\n        // \n        if (currentView === 'global' && workingNodes.length === 0) {\n          return `\n            <div class=\"acu-avatar-empty-state\">\n              <i class=\"fa-solid fa-images\"></i>\n              <p></p>\n            </div>\n          `;\n        }\n\n        // \n        if (currentView === 'chat' && workingNodes.length === 0) {\n          return `\n            <div class=\"acu-avatar-empty-state\">\n              <i class=\"fa-solid fa-user-slash\"></i>\n              <p>NPC</p>\n            </div>\n          `;\n        }\n\n        // {{user}}\n        if (userNode) {\n          // {{user}}'{{user}}'\n          const userNodeForDisplay = {\n            ...userNode,\n            name: '{{user}}', // {{user}}\n          };\n\n          const data = avatars[userNodeForDisplay.name] || {};\n          let currentUrl = data.url || '';\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(userNodeForDisplay.name);\n          let displayUrl = '';\n          let sourceLabel = '';\n\n          if (hasLocal) {\n            displayUrl = await LocalAvatarDB.get(userNodeForDisplay.name);\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n          } else if (currentUrl) {\n            displayUrl = currentUrl;\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n          }\n\n          const aliases = (data.aliases || []).join(', ');\n          const hasAvatar = !!displayUrl;\n\n          // URL\n          if (isInitialLoad && !hasAvatar && !data.url) {\n            expandedItems.add(userNodeForDisplay.name);\n          }\n          const isExpanded = expandedItems.has(userNodeForDisplay.name);\n\n          listHtml += `\n                    <div class=\"acu-avatar-item ${isExpanded ? 'expanded' : ''}\" data-name=\"${escapeHtml(userNodeForDisplay.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <!--  -->\n                        <div class=\"acu-avatar-row-collapsed\">\n                            <div class=\"acu-avatar-preview-wrap\">\n                                <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" data-avatar-url=\"${escapeHtml(displayUrl)}\" data-avatar-x=\"${data.offsetX ?? 50}\" data-avatar-y=\"${data.offsetY ?? 50}\" data-avatar-scale=\"${data.scale ?? 150}\">\n                                    ${!hasAvatar ? `<span>${escapeHtml(userNodeForDisplay.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                                </div>\n                                ${sourceLabel}\n                            </div>\n                            <div class=\"acu-avatar-info-summary\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(userNodeForDisplay.name)}<button class=\"acu-protagonist-toggle ${getDiceConfig().autoMergeProtagonist !== false ? 'active' : ''}\" title=\"&quot;&quot;{{user}}\"><i class=\"fa-solid ${getDiceConfig().autoMergeProtagonist !== false ? 'fa-link' : 'fa-link-slash'}\"></i></button></div>\n                                <div class=\"acu-avatar-url-preview\">${escapeHtml(currentUrl || '')}</div>\n                            </div>\n                            <div class=\"acu-avatar-actions-collapsed\">\n                                <button class=\"acu-btn-action acu-btn-edit\" title=\"\"><i class=\"fa-solid ${isExpanded ? 'fa-chevron-up' : 'fa-pencil'}\"></i></button>\n                                <button class=\"acu-btn-action acu-btn-delete acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                            </div>\n                        </div>\n\n                        <!--  -->\n                        <div class=\"acu-avatar-row-expanded\">\n                            <div class=\"acu-avatar-details\">\n                                <div class=\"acu-input-group\">\n                                    <label class=\"acu-input-group-label\">URL</label>\n                                    <div class=\"acu-url-container\">\n                                        <input type=\"text\" class=\"acu-input acu-avatar-url\" placeholder=\"...\" value=\"${escapeHtml(currentUrl)}\" />\n                                    </div>\n                                </div>\n                                <div class=\"acu-input-group\">\n                                    <label class=\"acu-input-group-label\"></label>\n                                    <div class=\"acu-alias-tags-container\">\n                                        ${(data.aliases || []).map(a => `<span class=\"acu-alias-tag\" data-alias=\"${escapeHtml(a)}\">${escapeHtml(a)} <i class=\"fa-solid fa-xmark\"></i></span>`).join('')}\n                                        <input type=\"text\" class=\"acu-alias-input\" placeholder=\"...\" />\n                                    </div>\n                                </div>\n                                <div class=\"acu-avatar-expanded-footer\">\n                                    <button class=\"acu-btn-action acu-avatar-clear-all-btn\" title=\"\"><i class=\"fa-solid fa-user-slash\"></i></button>\n                                    <button class=\"acu-btn-action acu-avatar-clear-alias-btn\" title=\"\"><i class=\"fa-solid fa-tags\"></i></button>\n                                    <label class=\"acu-avatar-upload-trigger\">\n                                        <i class=\"fa-solid fa-cloud-arrow-up\"></i> \n                                        <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none\" />\n                                    </label>\n                                    <button class=\"acu-btn-action acu-btn-save acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i>&nbsp;</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `;\n        }\n\n        // \n        for (const node of otherNodes) {\n          const data = avatars[node.name] || {};\n          let currentUrl = data.url || '';\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(node.name);\n          let displayUrl = '';\n          let sourceLabel = '';\n\n          if (hasLocal) {\n            displayUrl = await LocalAvatarDB.get(node.name);\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n          } else if (currentUrl) {\n            displayUrl = currentUrl;\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n          }\n\n          const aliases = (data.aliases || []).join(', ');\n          const hasAvatar = !!displayUrl;\n\n          // URL\n          if (isInitialLoad && !hasAvatar && !data.url) {\n            expandedItems.add(node.name);\n          }\n          const isExpanded = expandedItems.has(node.name);\n\n          listHtml += `\n                    <div class=\"acu-avatar-item ${isExpanded ? 'expanded' : ''}\" data-name=\"${escapeHtml(node.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <!--  -->\n                        <div class=\"acu-avatar-row-collapsed\">\n                            <div class=\"acu-avatar-preview-wrap\">\n                                <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" data-avatar-url=\"${escapeHtml(displayUrl)}\" data-avatar-x=\"${data.offsetX ?? 50}\" data-avatar-y=\"${data.offsetY ?? 50}\" data-avatar-scale=\"${data.scale ?? 150}\">\n                                    ${!hasAvatar ? `<span>${escapeHtml(node.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                                </div>\n                                ${sourceLabel}\n                            </div>\n                            <div class=\"acu-avatar-info-summary\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(node.name)}</div>\n                                <div class=\"acu-avatar-url-preview\">${escapeHtml(currentUrl || '')}</div>\n                            </div>\n                            <div class=\"acu-avatar-actions-collapsed\">\n                                <button class=\"acu-btn-action acu-btn-edit\" title=\"\"><i class=\"fa-solid ${isExpanded ? 'fa-chevron-up' : 'fa-pencil'}\"></i></button>\n                                <button class=\"acu-btn-action acu-btn-delete acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                            </div>\n                        </div>\n\n                        <!--  -->\n                        <div class=\"acu-avatar-row-expanded\">\n                            <div class=\"acu-avatar-details\">\n                                <div class=\"acu-input-group\">\n                                    <label class=\"acu-input-group-label\">URL</label>\n                                    <div class=\"acu-url-container\">\n                                        <input type=\"text\" class=\"acu-input acu-avatar-url\" placeholder=\"...\" value=\"${escapeHtml(currentUrl)}\" />\n                                    </div>\n                                </div>\n                                <div class=\"acu-input-group\">\n                                    <label class=\"acu-input-group-label\"></label>\n                                    <div class=\"acu-alias-tags-container\">\n                                        ${(data.aliases || []).map(a => `<span class=\"acu-alias-tag\" data-alias=\"${escapeHtml(a)}\">${escapeHtml(a)} <i class=\"fa-solid fa-xmark\"></i></span>`).join('')}\n                                        <input type=\"text\" class=\"acu-alias-input\" placeholder=\"...\" />\n                                    </div>\n                                </div>\n                                <div class=\"acu-avatar-expanded-footer\">\n                                    <button class=\"acu-btn-action acu-avatar-clear-all-btn\" title=\"\"><i class=\"fa-solid fa-user-slash\"></i></button>\n                                    <button class=\"acu-btn-action acu-avatar-clear-alias-btn\" title=\"\"><i class=\"fa-solid fa-tags\"></i></button>\n                                    <label class=\"acu-avatar-upload-trigger\">\n                                        <i class=\"fa-solid fa-cloud-arrow-up\"></i> \n                                        <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none\" />\n                                    </label>\n                                    <button class=\"acu-btn-action acu-btn-save acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i>&nbsp;</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `;\n        }\n\n        return listHtml;\n      };\n\n      const applyAvatarPreviewStyles = $root => {\n        $root.find('.acu-avatar-preview').each(function () {\n          const $preview = $(this);\n          const url = $preview.attr('data-avatar-url');\n          if (!url) return;\n          const offsetX = Number($preview.attr('data-avatar-x') || 50);\n          const offsetY = Number($preview.attr('data-avatar-y') || 50);\n          const scale = Number($preview.attr('data-avatar-scale') || 150);\n          $preview.css({\n            '--acu-avatar-image': `url('${url}')`,\n            '--acu-avatar-x': `${offsetX}%`,\n            '--acu-avatar-y': `${offsetY}%`,\n            '--acu-avatar-scale': `${scale}%`,\n          });\n        });\n      };\n\n      // \n      const managerHtml = `\n            <div class=\"acu-avatar-manager-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-avatar-manager\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-avatar-title\"><i class=\"fa-solid fa-user-circle\"></i> </div>\n                        <div class=\"acu-avatar-header-actions\">\n                            <button class=\"acu-btn-icon acu-avatar-import-btn\" title=\"\"><i class=\"fa-solid fa-file-import\"></i></button>\n                            <button class=\"acu-btn-icon acu-avatar-export-btn\" title=\"\"><i class=\"fa-solid fa-file-export\"></i></button>\n                            <button class=\"acu-avatar-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-avatar-toolbar\">\n                        <!-- : -->\n                        <div class=\"acu-toolbar-group left\">\n                            <button class=\"acu-btn-icon acu-view-toggle\" title=\" / \" data-view=\"chat\">\n                                <i class=\"fa-solid fa-comments\"></i>\n                            </button>\n                            <div class=\"acu-select-wrapper sort-field\">\n                                <select class=\"acu-toolbar-select acu-sort-field\" title=\"\">\n                                    <option value=\"name\"></option>\n                                    <option value=\"date\"></option>\n                                    <option value=\"source\"></option>\n                                </select>\n                            </div>\n                            <button class=\"acu-btn-icon acu-sort-order\" title=\"\" data-dir=\"asc\">\n                                <i class=\"fa-solid fa-arrow-down-a-z\"></i>\n                            </button>\n                            <div class=\"acu-search-wrapper\">\n                                <i class=\"fa-solid fa-magnifying-glass acu-search-icon\"></i>\n                                <input type=\"text\" class=\"acu-avatar-search\" placeholder=\"...\" autocomplete=\"off\">\n                                <i class=\"fa-solid fa-xmark acu-search-clear\" style=\"display:none;\"></i>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"acu-avatar-list\" id=\"acu-avatar-list-container\">\n                        <div class=\"acu-import-empty\">\n                            <i class=\"fa-solid fa-spinner fa-spin\"></i> ...\n                        </div>\n                    </div>\n                </div>\n                <input type=\"file\" id=\"acu-avatar-file-input\" accept=\".json\" />\n            </div>\n        `;\n\n      const $manager = $(managerHtml);\n      $('body').append($manager);\n\n      // \n      buildList().then(listHtml => {\n        $manager.find('#acu-avatar-list-container').html(listHtml);\n        applyAvatarPreviewStyles($manager);\n        bindAvatarEvents();\n      });\n\n      // \n      const refreshItem = async name => {\n        const $item = $manager.find(`.acu-avatar-item[data-name=\"${name}\"]`);\n        if (!$item.length) return;\n\n        const data = AvatarManager.getAll()[name] || {};\n        const hasLocal = await AvatarManager.hasLocalAvatar(name);\n        let displayUrl = '';\n        let sourceLabel = '';\n\n        if (hasLocal) {\n          displayUrl = await LocalAvatarDB.get(name);\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n        } else if (data.url) {\n          displayUrl = data.url;\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n        }\n\n        const $preview = $item.find('.acu-avatar-preview');\n        $item.find('.acu-avatar-source').remove();\n\n        if (displayUrl) {\n          $preview\n            .addClass('has-image')\n            .attr('data-avatar-url', displayUrl)\n            .attr('data-avatar-x', data.offsetX ?? 50)\n            .attr('data-avatar-y', data.offsetY ?? 50)\n            .attr('data-avatar-scale', data.scale ?? 150)\n            .css({\n              '--acu-avatar-image': `url('${displayUrl}')`,\n              '--acu-avatar-x': `${data.offsetX ?? 50}%`,\n              '--acu-avatar-y': `${data.offsetY ?? 50}%`,\n              '--acu-avatar-scale': `${data.scale ?? 150}%`,\n            })\n            .find('span')\n            .remove();\n          $item.find('.acu-avatar-preview-wrap').append(sourceLabel);\n          $item.find('.acu-avatar-url-preview').text(data.url || '');\n        } else {\n          $preview\n            .removeClass('has-image')\n            .attr('data-avatar-url', '')\n            .attr('data-avatar-x', 50)\n            .attr('data-avatar-y', 50)\n            .attr('data-avatar-scale', 150)\n            .css({\n              '--acu-avatar-image': '',\n              '--acu-avatar-x': '',\n              '--acu-avatar-y': '',\n              '--acu-avatar-scale': '',\n            })\n            .html(\n              `<span>${escapeHtml(name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>`,\n            );\n          $item.find('.acu-avatar-url-preview').text('');\n        }\n\n        $item.attr('data-has-local', hasLocal);\n        $item.attr('data-display-url', displayUrl);\n      };\n\n      // \n      const refreshList = async () => {\n        const listHtml = await buildList();\n        $manager.find('#acu-avatar-list-container').html(listHtml);\n        applyAvatarPreviewStyles($manager);\n        // \n        isInitialLoad = false;\n      };\n\n      // ==========  ==========\n\n      // Part A: \n      const findCharacterInTable = (\n        name: string,\n      ): { tableKey: string; rowIndex: number; row: Record<string, unknown> } | null => {\n        try {\n          const rawData = typeof getTableData === 'function' ? getTableData() : null;\n          if (!rawData) return null;\n\n          // \n          const avatarData = AvatarManager.getAll()[name];\n          const aliases = avatarData?.aliases || [];\n          const allNames = [name, ...aliases].map(n => n.toLowerCase());\n\n          // \n          for (const [tableKey, tableData] of Object.entries(rawData)) {\n            if (!tableData || typeof tableData !== 'object') continue;\n            const rows = (tableData as { rows?: unknown[] }).rows;\n            if (!Array.isArray(rows)) continue;\n\n            for (let i = 0; i < rows.length; i++) {\n              const row = rows[i] as Record<string, unknown>;\n              if (!row) continue;\n\n              // \n              const nameColumns = ['', '', '', 'name', 'Name', ''];\n              for (const col of nameColumns) {\n                const cellValue = row[col];\n                if (cellValue && typeof cellValue === 'string') {\n                  if (allNames.includes(cellValue.toLowerCase())) {\n                    return { tableKey, rowIndex: i, row };\n                  }\n                }\n              }\n            }\n          }\n          return null;\n        } catch (err) {\n          console.error('[DICE] findCharacterInTable :', err);\n          return null;\n        }\n      };\n\n      // Part A: \n      const findRelationshipReferences = (\n        name: string,\n        aliases: string[] = [],\n      ): Array<{\n        tableName: string;\n        rowIndex: number;\n        characterName: string;\n        relationText: string;\n        matchedRelation: string;\n      }> => {\n        const references: Array<{\n          tableName: string;\n          rowIndex: number;\n          characterName: string;\n          relationText: string;\n          matchedRelation: string;\n        }> = [];\n\n        try {\n          const rawData = typeof getTableData === 'function' ? getTableData() : null;\n          if (!rawData) return references;\n\n          const allNames = [name, ...aliases].map(n => n.toLowerCase());\n\n          for (const [tKey, tData] of Object.entries(rawData)) {\n            if (!tKey.startsWith('sheet_')) continue;\n            if (!tData || typeof tData !== 'object') continue;\n\n            const sheet = tData as { name?: string; content?: unknown[][] };\n            if (!Array.isArray(sheet.content) || sheet.content.length < 2) continue;\n\n            const headers = sheet.content[0] as string[];\n            const tableName = sheet.name || tKey.replace('sheet_', '');\n\n            // \"\"\n            const nameColumns = ['', '', '', 'name', 'Name', ''];\n            let nameColIndex = -1;\n            for (const col of nameColumns) {\n              const idx = headers.findIndex(h => h === col);\n              if (idx !== -1) {\n                nameColIndex = idx;\n                break;\n              }\n            }\n\n            // \"\"\n            const relationColIndex = headers.findIndex(h => h === '');\n            if (relationColIndex === -1) continue;\n\n            // \n            for (let i = 1; i < sheet.content.length; i++) {\n              const row = sheet.content[i];\n              if (!Array.isArray(row)) continue;\n\n              // \n              let rowCharacterName = '';\n              if (nameColIndex !== -1) {\n                const cellValue = row[nameColIndex];\n                if (cellValue && typeof cellValue === 'string') {\n                  rowCharacterName = cellValue;\n                }\n              }\n\n              // \n              const relationValue = row[relationColIndex];\n              if (relationValue && typeof relationValue === 'string') {\n                // : \":;:\"\n                const parts = relationValue.split(/[;]/);\n                for (const part of parts) {\n                  const splitResult = part.split(/[:]/);\n                  const refName = splitResult[0];\n                  const relationWord = splitResult[1] || '';\n                  if (refName && allNames.includes(refName.trim().toLowerCase())) {\n                    references.push({\n                      tableName,\n                      rowIndex: i - 1, // 1\n                      characterName: rowCharacterName || `${i}`,\n                      relationText: relationValue,\n                      matchedRelation: relationWord.trim(),\n                    });\n                    break; // \n                  }\n                }\n              }\n            }\n          }\n        } catch (err) {\n          console.error('[DICE] findRelationshipReferences :', err);\n        }\n\n        return references;\n      };\n\n      // Part B:  (Redesigned)\n      const showDeleteConfirmModal = (\n        info: {\n          name: string;\n          avatarUrl: string;\n          tableRow: { tableKey: string; rowIndex: number; row: Record<string, unknown> } | null;\n          relationships: Array<{\n            tableName: string;\n            rowIndex: number;\n            characterName: string;\n            relationText: string;\n            matchedRelation: string;\n          }>;\n        },\n        onConfirm: () => void,\n        onClose?: () => void,\n      ) => {\n        const { name, tableRow, relationships } = info;\n\n        // 1.  (//)\n        const avatarData = AvatarManager.getAll()[name] || {};\n        const aliases = avatarData.aliases || [];\n        const avX = avatarData.offsetX ?? 50;\n        const avY = avatarData.offsetY ?? 50;\n        const avScale = avatarData.scale ?? 150;\n        const displayUrl = avatarData.url || info.avatarUrl;\n\n        // 2. \n        const aliasRows: Array<{ tableKey: string; alias: string }> = [];\n        if (aliases.length > 0) {\n          try {\n            const rawData = typeof getTableData === 'function' ? getTableData() : null;\n            if (rawData) {\n              const lowerAliases = aliases.map((a: string) => a.toLowerCase());\n              for (const [tKey, tData] of Object.entries(rawData)) {\n                if (!tKey.startsWith('sheet_')) continue;\n                if (!tData || typeof tData !== 'object') continue;\n                const sheet = tData as { content?: unknown[][] };\n                if (!Array.isArray(sheet.content) || sheet.content.length < 2) continue;\n\n                const headers = sheet.content[0] as string[];\n                const nameColumns = ['', '', '', 'name', 'Name', ''];\n                let nameColIndex = -1;\n                for (const col of nameColumns) {\n                  const idx = headers.findIndex(h => h === col);\n                  if (idx !== -1) {\n                    nameColIndex = idx;\n                    break;\n                  }\n                }\n                if (nameColIndex === -1) continue;\n\n                for (let i = 1; i < sheet.content.length; i++) {\n                  const row = sheet.content[i];\n                  if (!Array.isArray(row)) continue;\n                  const cellValue = row[nameColIndex];\n                  if (cellValue && typeof cellValue === 'string') {\n                    if (lowerAliases.includes(cellValue.toLowerCase())) {\n                      aliasRows.push({ tableKey: tKey.replace('sheet_', ''), alias: cellValue });\n                    }\n                  }\n                }\n              }\n            }\n          } catch (e) {\n            console.warn('[DeleteModal] Alias scan failed', e);\n          }\n        }\n\n        // 3.  HTML \n        const modalHtml = `\n          <div class=\"acu-delete-confirm-overlay acu-theme-${config.theme}\">\n            <div class=\"acu-delete-confirm-modal redesign\">\n\n              <!--  -->\n              <div class=\"acu-delete-header destruct\">\n                <i class=\"fa-solid fa-triangle-exclamation\"></i>\n                \n                <button class=\"acu-delete-close-btn\" title=\"\">\n                  <i class=\"fa-solid fa-xmark\"></i>\n                </button>\n              </div>\n\n              <div class=\"acu-delete-content\">\n\n                <!--  () -->\n                <div class=\"acu-del-section destruct\">\n                  <div class=\"acu-del-section-head\">\n                    <i class=\"fa-solid fa-id-card\"></i> \n                  </div>\n                  <div class=\"acu-del-card main-identity\">\n                    <div class=\"acu-del-avatar-box\">\n                      <div class=\"acu-avatar-preview ${displayUrl ? 'has-image' : ''}\"\n                           data-avatar-url=\"${escapeHtml(displayUrl || '')}\"\n                           data-avatar-x=\"${avX}\"\n                           data-avatar-y=\"${avY}\"\n                           data-avatar-scale=\"${avScale}\">\n                        ${!displayUrl ? `<span>${escapeHtml(name.charAt(0))}</span>` : ''}\n                      </div>\n                    </div>\n                    <div class=\"acu-del-info\">\n                      <div class=\"acu-del-name\">${escapeHtml(name)}</div>\n                      <div class=\"acu-del-meta\"></div>\n                    </div>\n                  </div>\n                </div>\n\n                <!--  () -->\n                ${\n                  tableRow || aliases.length > 0\n                    ? `\n                <div class=\"acu-del-section warning\">\n                  <div class=\"acu-del-section-head\">\n                    <i class=\"fa-solid fa-database\"></i> \n                  </div>\n                  <ul class=\"acu-del-list\">\n                    ${\n                      tableRow\n                        ? `\n                      <li>\n                        <i class=\"fa-solid fa-table\"></i>\n                        <span>: <strong>${escapeHtml(tableRow.tableKey)}</strong></span>\n                      </li>\n                    `\n                        : ''\n                    }\n                    ${\n                      aliases.length > 0\n                        ? `\n                      <li class=\"sub-group\">\n                        <div class=\"group-title\"><i class=\"fa-solid fa-tags\"></i>  (${aliases.length})</div>\n                        <div class=\"group-content\">${aliases.map((a: string) => `<span class=\"tag\">${escapeHtml(a)}</span>`).join('')}</div>\n                        ${\n                          aliasRows.length > 0\n                            ? `\n                          <div class=\"group-warning\">\n                            <i class=\"fa-solid fa-trash-can\"></i>  ${aliasRows.length} \n                            <span class=\"detail\">(${aliasRows\n                              .map(r => r.tableKey)\n                              .slice(0, 3)\n                              .join(', ')}${aliasRows.length > 3 ? '...' : ''})</span>\n                          </div>\n                        `\n                            : ''\n                        }\n                      </li>\n                    `\n                        : ''\n                    }\n                  </ul>\n                </div>\n                `\n                    : ''\n                }\n\n                <!--  ( - ) -->\n                ${\n                  relationships.length > 0\n                    ? `\n                <div class=\"acu-del-section warning\">\n                  <div class=\"acu-del-section-head\">\n                    <i class=\"fa-solid fa-link\"></i> \n                  </div>\n                  <div class=\"acu-del-summary\">\n                     <strong>${relationships.length}</strong> \n                  </div>\n                  <ul class=\"acu-del-list compact\">\n                    ${relationships\n                      .slice(0, 5)\n                      .map(\n                        rel => `\n                      <li>\n                        <i class=\"fa-solid fa-user-tag\"></i>\n                        <span>${escapeHtml(rel.tableName)}.${escapeHtml(rel.characterName)}${rel.matchedRelation ? ` <span class=\"relation-tag\">${escapeHtml(rel.matchedRelation)}</span>` : ''}</span>\n                      </li>\n                    `,\n                      )\n                      .join('')}\n                    ${relationships.length > 5 ? `<li class=\"more\">...  ${relationships.length - 5} </li>` : ''}\n                  </ul>\n                </div>\n                `\n                    : ''\n                }\n\n                <div class=\"acu-del-final-warn\">\n                   <strong></strong>\n                </div>\n              </div>\n\n              <!--  -->\n              <div class=\"acu-delete-actions\">\n                <button class=\"acu-delete-cancel-btn\">\n                  \n                </button>\n                <button class=\"acu-delete-confirm-btn destruct\">\n                  <i class=\"fa-solid fa-trash\"></i> \n                </button>\n              </div>\n            </div>\n          </div>\n        `;\n\n        const $modal = $(modalHtml);\n        $('body').append($modal);\n\n        //  ( applyAvatarPreviewStyles )\n        $modal.find('.acu-avatar-preview').each(function () {\n          const $preview = $(this);\n          const url = $preview.attr('data-avatar-url');\n          if (!url) return;\n          const offsetX = Number($preview.attr('data-avatar-x') || 50);\n          const offsetY = Number($preview.attr('data-avatar-y') || 50);\n          const scale = Number($preview.attr('data-avatar-scale') || 150);\n          $preview.css({\n            '--acu-avatar-image': `url('${url}')`,\n            '--acu-avatar-x': `${offsetX}%`,\n            '--acu-avatar-y': `${offsetY}%`,\n            '--acu-avatar-scale': `${scale}%`,\n          });\n        });\n\n        // \n        const closeModal = () => {\n          $modal.addClass('closing');\n          setTimeout(() => {\n            $modal.remove();\n            onClose?.();\n          }, 200);\n        };\n\n        // ESC \n        const handleKeydown = (e: KeyboardEvent) => {\n          if (e.key === 'Escape') {\n            closeModal();\n            $(document).off(\n              'keydown',\n              handleKeydown as unknown as JQuery.TypeEventHandler<Document, unknown, Document, Document, 'keydown'>,\n            );\n          }\n        };\n        $(document).on(\n          'keydown',\n          handleKeydown as unknown as JQuery.TypeEventHandler<Document, unknown, Document, Document, 'keydown'>,\n        );\n\n        // \n        $modal.on('click', function (e) {\n          if ($(e.target).hasClass('acu-delete-confirm-overlay')) {\n            closeModal();\n          }\n        });\n\n        // \n        $modal.find('.acu-delete-cancel-btn').on('click', closeModal);\n\n        //  ()\n        $modal.find('.acu-delete-close-btn').on('click', closeModal);\n\n        // \n        $modal.find('.acu-delete-confirm-btn').on('click', () => {\n          const $btn = $modal.find('.acu-delete-confirm-btn');\n          $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n          setTimeout(() => {\n            closeModal();\n            onConfirm();\n          }, 50);\n        });\n      };\n\n      // Part D: \n      const executeCharacterDelete = async (name: string) => {\n        try {\n          const avatarData = AvatarManager.getAll()[name];\n          const aliases = avatarData?.aliases || [];\n\n          // 1. \n          await AvatarManager.deleteLocalAvatar(name);\n          AvatarManager.remove(name);\n\n          // keys\n          const modifiedSheetKeys = new Set<string>();\n\n          // 2.  cachedRawData  getTableData\n          let rawData = typeof getTableData === 'function' ? getTableData() : null;\n          if (!rawData) {\n            console.warn('[DICE] ');\n          }\n\n          // 3. content \n          if (rawData) {\n            const allNames = [name, ...aliases].map(n => n.toLowerCase());\n\n            // \n            for (const [tableKey, tableData] of Object.entries(rawData)) {\n              if (!tableKey.startsWith('sheet_')) continue;\n              if (!tableData || typeof tableData !== 'object') continue;\n\n              const sheet = tableData as { content?: unknown[][] };\n              if (!Array.isArray(sheet.content) || sheet.content.length < 2) continue;\n\n              // \"\"\n              const headers = sheet.content[0] as string[];\n              const nameColumns = ['', '', '', 'name', 'Name', ''];\n              let nameColIndex = -1;\n              for (const col of nameColumns) {\n                const idx = headers.findIndex(h => h === col);\n                if (idx !== -1) {\n                  nameColIndex = idx;\n                  break;\n                }\n              }\n\n              if (nameColIndex === -1) continue; // \n\n              //  content[0]\n              for (let i = sheet.content.length - 1; i >= 1; i--) {\n                const row = sheet.content[i];\n                if (!Array.isArray(row)) continue;\n\n                const cellValue = row[nameColIndex];\n                if (cellValue && typeof cellValue === 'string') {\n                  if (allNames.includes(cellValue.toLowerCase())) {\n                    // \n                    sheet.content.splice(i, 1);\n                    modifiedSheetKeys.add(tableKey);\n                    console.log(`[DICE]  ${tableKey}  [${i}]: ${cellValue}`);\n                    // break\n                  }\n                }\n              }\n            }\n          }\n\n          // 4.  rawData  content \n          if (rawData) {\n            const allNames = [name, ...aliases].map(n => n.toLowerCase());\n\n            for (const [tableKey, tableData] of Object.entries(rawData)) {\n              if (!tableKey.startsWith('sheet_')) continue;\n              if (!tableData || typeof tableData !== 'object') continue;\n\n              const sheet = tableData as { content?: unknown[][] };\n              if (!Array.isArray(sheet.content) || sheet.content.length < 2) continue;\n\n              // \"\"\n              const headers = sheet.content[0] as string[];\n              const relationColIndex = headers.findIndex(h => h === '');\n              if (relationColIndex === -1) continue;\n\n              // \n              for (let i = 1; i < sheet.content.length; i++) {\n                const row = sheet.content[i];\n                if (!Array.isArray(row)) continue;\n\n                const relationValue = row[relationColIndex];\n                if (typeof relationValue !== 'string' || !relationValue) continue;\n\n                // \n                const parts = relationValue.split(/[;]/);\n                const filteredParts = parts.filter(part => {\n                  const [refName] = part.split(/[:]/);\n                  return !refName || !allNames.includes(refName.trim().toLowerCase());\n                });\n\n                const newValue = filteredParts.join(';');\n                if (newValue !== relationValue) {\n                  row[relationColIndex] = newValue;\n                  modifiedSheetKeys.add(tableKey);\n                }\n              }\n            }\n          }\n\n          // 5. \n          if (rawData && modifiedSheetKeys.size > 0) {\n            await saveDataOnly(rawData, Array.from(modifiedSheetKeys));\n            // \n            if (typeof renderInterface === 'function') {\n              renderInterface();\n            }\n          }\n\n          // 6.  nodeArr \n          const idx = nodeArr.findIndex(n => n.name === name);\n          if (idx !== -1) {\n            nodeArr.splice(idx, 1);\n          }\n\n          // 7. \n          await refreshList();\n\n          // 8. \n          if (window.toastr) {\n            window.toastr.success(` \"${name}\"`);\n          }\n\n          onUpdate?.();\n        } catch (err) {\n          console.error('[DICE] :', err);\n          if (window.toastr) {\n            window.toastr.error('');\n          }\n        }\n      };\n\n      // ==========  ==========\n\n      const bindAvatarEvents = () => {\n        // (toggle)\n        $manager.on('click', '.acu-view-toggle', async function () {\n          const $btn = $(this);\n          const isChat = $btn.attr('data-view') === 'chat';\n          const newView = isChat ? 'global' : 'chat';\n\n          $btn.attr('data-view', newView);\n          currentView = newView;\n\n          const $icon = $btn.find('i');\n          if (newView === 'global') {\n            $icon.removeClass('fa-comments').addClass('fa-globe');\n            $btn.addClass('active');\n          } else {\n            $icon.removeClass('fa-globe').addClass('fa-comments');\n            $btn.removeClass('active');\n          }\n\n          await refreshList();\n        });\n\n        // ()\n        const debouncedSearch = _.debounce(async () => {\n          await refreshList();\n        }, 300);\n\n        $manager.on('input', '.acu-avatar-search', function () {\n          searchQuery = $(this).val().trim();\n          const $clear = $manager.find('.acu-search-clear');\n          $clear.toggle(!!searchQuery);\n          debouncedSearch();\n        });\n\n        $manager.on('click', '.acu-search-clear', async function () {\n          searchQuery = '';\n          $manager.find('.acu-avatar-search').val('');\n          $(this).hide();\n          await refreshList();\n        });\n\n        // \n        $manager.on('change', '.acu-sort-field', async function () {\n          sortBy = $(this).val();\n          await refreshList();\n        });\n\n        // (toggle)\n        $manager.on('click', '.acu-sort-order', async function () {\n          const $btn = $(this);\n          const isAsc = $btn.attr('data-dir') === 'asc';\n          const newDir = isAsc ? 'desc' : 'asc';\n\n          $btn.attr('data-dir', newDir);\n          sortOrder = newDir;\n\n          const $icon = $btn.find('i');\n          if (newDir === 'desc') {\n            $icon.removeClass('fa-arrow-down-a-z').addClass('fa-arrow-up-a-z');\n          } else {\n            $icon.removeClass('fa-arrow-up-a-z').addClass('fa-arrow-down-a-z');\n          }\n\n          await refreshList();\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-preview', async function (e) {\n          e.stopPropagation();\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const displayUrl = $item.attr('data-display-url');\n\n          if (displayUrl) {\n            //   \n            showAvatarCropModal(displayUrl, name, async result => {\n              const data = AvatarManager.getAll()[name] || {};\n              AvatarManager.set(name, data.url || '', result.offsetX, result.offsetY, result.scale, data.aliases || []);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          } else {\n            //   \n            $item.find('.acu-avatar-file-input').click();\n          }\n        });\n\n        // /\n        $manager.on('click', '.acu-btn-edit', function (e) {\n          e.stopPropagation();\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const isExpanded = $item.hasClass('expanded');\n\n          if (isExpanded) {\n            $item.removeClass('expanded');\n            expandedItems.delete(name);\n            $(this).find('i').removeClass('fa-chevron-up').addClass('fa-pencil');\n          } else {\n            $item.addClass('expanded');\n            expandedItems.add(name);\n            $(this).find('i').removeClass('fa-pencil').addClass('fa-chevron-up');\n          }\n        });\n\n        // \n        $manager.on('keydown', '.acu-alias-input', function (e) {\n          if (e.key === 'Enter' || e.key === ',') {\n            e.preventDefault();\n            const val = $(this).val().trim();\n            if (val) {\n              const $container = $(this).closest('.acu-alias-tags-container');\n              // \n              let exists = false;\n              $container.find('.acu-alias-tag').each(function () {\n                if ($(this).data('alias') === val) exists = true;\n              });\n\n              if (!exists) {\n                const tagHtml = `<span class=\"acu-alias-tag\" data-alias=\"${escapeHtml(val)}\">${escapeHtml(val)} <i class=\"fa-solid fa-xmark\"></i></span>`;\n                $(this).before(tagHtml);\n              }\n              $(this).val('');\n            }\n          } else if (e.key === 'Backspace' && !$(this).val()) {\n            // \n            $(this).prev('.acu-alias-tag').remove();\n          }\n        });\n\n        //  ()\n        $manager.on('input', '.acu-alias-input', function (e) {\n          const val = $(this).val();\n          if (val.includes(',') || val.includes('')) {\n            const parts = val.split(/[,]/);\n            const lastPart = parts.pop(); // \n            const $container = $(this).closest('.acu-alias-tags-container');\n\n            parts.forEach(part => {\n              const cleanPart = part.trim();\n              if (cleanPart) {\n                let exists = false;\n                $container.find('.acu-alias-tag').each(function () {\n                  if ($(this).data('alias') === cleanPart) exists = true;\n                });\n                if (!exists) {\n                  const tagHtml = `<span class=\"acu-alias-tag\" data-alias=\"${escapeHtml(cleanPart)}\">${escapeHtml(cleanPart)} <i class=\"fa-solid fa-xmark\"></i></span>`;\n                  $(this).before(tagHtml);\n                }\n              }\n            });\n            $(this).val(lastPart);\n          }\n        });\n\n        // \n        $manager.on('paste', '.acu-alias-input', function (e) {\n          e.preventDefault();\n          const clipboardData = (e.originalEvent || e).clipboardData;\n          const pastedData = clipboardData.getData('text');\n          if (!pastedData) return;\n\n          const parts = pastedData.split(/[,\\n]/);\n          const $container = $(this).closest('.acu-alias-tags-container');\n\n          parts.forEach(part => {\n            const cleanPart = part.trim();\n            if (cleanPart) {\n              let exists = false;\n              $container.find('.acu-alias-tag').each(function () {\n                if ($(this).data('alias') === cleanPart) exists = true;\n              });\n              if (!exists) {\n                const tagHtml = `<span class=\"acu-alias-tag\" data-alias=\"${escapeHtml(cleanPart)}\">${escapeHtml(cleanPart)} <i class=\"fa-solid fa-xmark\"></i></span>`;\n                $(this).before(tagHtml);\n              }\n            }\n          });\n        });\n\n        // \n        $manager.on('click', '.acu-alias-tag i', function () {\n          $(this).parent().remove();\n        });\n\n        // \n        $manager.on('click', '.acu-alias-tags-container', function (e) {\n          if (e.target === this) {\n            $(this).find('.acu-alias-input').focus();\n          }\n        });\n\n        // \n        $manager.on('change', '.acu-avatar-file-input', async function (e) {\n          const file = e.target.files[0];\n          if (!file) return;\n\n          if (!file.type.startsWith('image/')) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          if (file.size > 5 * 1024 * 1024) {\n            if (window.toastr) window.toastr.warning(' 5MB');\n            return;\n          }\n\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n\n          try {\n            const success = await AvatarManager.saveLocalAvatar(name, file);\n            if (success) {\n              const newUrl = await LocalAvatarDB.get(name);\n              await refreshItem(name);\n\n              // \n              showAvatarCropModal(newUrl, name, async result => {\n                const data = AvatarManager.getAll()[name] || {};\n                AvatarManager.set(\n                  name,\n                  data.url || '',\n                  result.offsetX,\n                  result.offsetY,\n                  result.scale,\n                  data.aliases || [],\n                );\n                await refreshItem(name);\n                onUpdate && onUpdate();\n              });\n            }\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            if (window.toastr) window.toastr.error('');\n          }\n\n          $(this).val('');\n        });\n\n        // \"\"\n        $manager.on('click', '.acu-protagonist-toggle', function () {\n          const $btn = $(this);\n          const diceCfg = getDiceConfig();\n          const newValue = diceCfg.autoMergeProtagonist === false ? true : false;\n          saveDiceConfig({ autoMergeProtagonist: newValue });\n\n          $btn.toggleClass('active', newValue);\n          $btn.find('i').attr('class', `fa-solid ${newValue ? 'fa-link' : 'fa-link-slash'}`);\n\n          if (window.toastr) window.toastr.info(newValue ? '\"\"' : '\"\"');\n        });\n\n        // URL  \n        $manager.on('click', '.acu-avatar-save-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const url = $item.find('.acu-avatar-url').val().trim();\n\n          // \n          const aliases = [];\n          $item.find('.acu-alias-tag').each(function () {\n            aliases.push($(this).data('alias'));\n          });\n          // \n          const pendingAlias = $item.find('.acu-alias-input').val().trim();\n          if (pendingAlias && !aliases.includes(pendingAlias)) {\n            aliases.push(pendingAlias);\n          }\n\n          const data = AvatarManager.getAll()[name] || {};\n\n          // \n          AvatarManager.set(name, url, data.offsetX ?? 50, data.offsetY ?? 50, data.scale ?? 150, aliases);\n\n          // URL\n          const hasLocal = $item.attr('data-has-local') === 'true';\n          if (url && !hasLocal) {\n            await refreshItem(name);\n            showAvatarCropModal(url, name, async result => {\n              AvatarManager.set(name, url, result.offsetX, result.offsetY, result.scale, aliases);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          } else {\n            await refreshItem(name);\n            onUpdate && onUpdate();\n          }\n        });\n\n        // URL\n        $manager.on('click', '.acu-avatar-clear-all-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name') as string;\n\n          // URL\n          $item.find('.acu-avatar-url').val('');\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(name);\n          if (hasLocal) {\n            await LocalAvatarDB.delete(name);\n          }\n\n          // URL\n          const data = AvatarManager.getAll()[name] || {};\n          AvatarManager.set(name, '', data.offsetX ?? 50, data.offsetY ?? 50, data.scale ?? 150, data.aliases || []);\n\n          // \n          await refreshItem(name);\n          onUpdate && onUpdate();\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-clear-alias-btn', function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          $item.find('.acu-alias-tag').remove();\n          $item.find('.acu-alias-input').val('');\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-clear-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name') as string;\n\n          // {{user}} \n          if (name === '{{user}}') {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          // \n          const avatarData = AvatarManager.getAll()[name];\n          const aliases = avatarData?.aliases || [];\n          const tableRow = findCharacterInTable(name);\n          const relationships = findRelationshipReferences(name, aliases);\n\n          //  URL \n          let avatarUrl = '';\n          const hasLocal = await AvatarManager.hasLocalAvatar(name);\n          if (hasLocal) {\n            avatarUrl = (await LocalAvatarDB.get(name)) || '';\n          } else if (avatarData?.url) {\n            avatarUrl = avatarData.url;\n          }\n\n          // \n          showDeleteConfirmModal({ name, avatarUrl, tableRow, relationships }, () => executeCharacterDelete(name));\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-export-btn', function () {\n          const exportData = AvatarManager.exportData();\n          const jsonStr = JSON.stringify(exportData, null, 2);\n          const blob = new Blob([jsonStr], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `avatar-config-${new Date().toISOString().slice(0, 10)}.json`;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-import-btn', function () {\n          $manager.find('#acu-avatar-file-input').click();\n        });\n\n        $manager.on('change', '#acu-avatar-file-input', function (e) {\n          const file = e.target.files[0];\n          if (!file) return;\n\n          const reader = new FileReader();\n          reader.onload = function (evt) {\n            try {\n              const jsonData = JSON.parse(evt.target.result);\n              const analysis = AvatarManager.analyzeImport(jsonData);\n\n              if (!analysis.valid) {\n                if (window.toastr) window.toastr.error(analysis.error);\n                return;\n              }\n\n              showImportConfirmDialog(jsonData, analysis, () => {\n                $manager.remove();\n                showAvatarManager(nodeArr, onUpdate);\n                onUpdate && onUpdate();\n              });\n            } catch (err) {\n              console.error('[DICE]ACU :', err);\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n          reader.readAsText(file);\n          $(this).val('');\n        });\n      };\n\n      // \n      const closeManager = () => $manager.remove();\n      $manager.on('click', '.acu-avatar-close', closeManager);\n      setupOverlayClose($manager, 'acu-avatar-manager-overlay', closeManager);\n    } catch (error) {\n      console.error(':', error);\n      if (window.toastr) {\n        const errorMsg = error instanceof Error ? error.message : '';\n        window.toastr.error(`: ${errorMsg}`);\n      }\n      // DOM\n      $('.acu-avatar-manager-overlay').remove();\n    }\n  };\n\n  // \n  const clearDiceSystemCache = async (): Promise<void> => {\n    if (!('caches' in window)) {\n      console.log('[DICE] Cache API ');\n      return;\n    }\n\n    try {\n      const cacheNames = await caches.keys();\n      const urlPatterns = ['jsdelivr.net/gh/jerryzmtz/my-tavern-scripts', '/dist//'];\n\n      for (const cacheName of cacheNames) {\n        const cache = await caches.open(cacheName);\n        const requests = await cache.keys();\n\n        for (const request of requests) {\n          const url = request.url;\n          //  jsDelivr \n          if (urlPatterns.some(pattern => url.includes(pattern))) {\n            await cache.delete(request);\n            console.log('[DICE] :', url);\n          }\n        }\n      }\n      console.log('[DICE] ');\n    } catch (err) {\n      console.warn('[DICE] :', err);\n    }\n  };\n\n  const clearDiceLocalCacheData = async (): Promise<number> => {\n    let removedLocalStorageKeys = 0;\n\n    for (let i = localStorage.length - 1; i >= 0; i--) {\n      const key = localStorage.key(i);\n      if (!key) continue;\n      if (key.startsWith('acu_')) {\n        localStorage.removeItem(key);\n        removedLocalStorageKeys++;\n      }\n    }\n\n    await Promise.allSettled([LocalAvatarDB.clearAll(), FavoritesDB.clear(), DiceHistoryStatsDB.clear()]);\n    await clearDiceSystemCache();\n\n    return removedLocalStorageKeys;\n  };\n\n  // /\n  const showManualUpdateDialog = (options?: {\n    title?: string;\n    iconClass?: string;\n    description?: string;\n    safeTitle?: string;\n    safeDescription?: string;\n    confirmText?: string;\n    loadingText?: string;\n    onConfirm?: () => Promise<void>;\n    isDanger?: boolean;\n    safeIconClass?: string;\n  }) => {\n    const { $ } = getCore();\n    $('.acu-manual-update-overlay').remove();\n\n    const config = getConfig();\n    const title = options?.title || '';\n    const iconClass = options?.iconClass || 'fa-rotate';\n    const description = options?.description || '';\n    const safeTitle = options?.safeTitle || '';\n    const safeDescription =\n      options?.safeDescription || '';\n    const confirmText = options?.confirmText || '';\n    const loadingText = options?.loadingText || '...';\n    const onConfirm = options?.onConfirm;\n    const isDanger = options?.isDanger || false;\n    const safeIconClass = options?.safeIconClass || (isDanger ? 'fa-triangle-exclamation' : 'fa-shield-check');\n\n    // \n    const headerBg = 'var(--acu-table-head)';\n    const headerTextColor = 'var(--acu-text-main)';\n    const confirmBtnBg = 'var(--acu-accent)';\n    const safeBoxBorder = 'var(--acu-border)';\n    const safeBoxIconColor = 'var(--acu-accent)';\n\n    const dialogHtml = `\n    <div class=\"acu-manual-update-overlay acu-theme-${config.theme}\">\n      <div class=\"acu-manual-update-dialog\" style=\"background:var(--acu-bg-panel);border-color:var(--acu-border);max-width:420px;box-shadow:0 8px 24px rgba(0,0,0,0.3);\">\n        <div class=\"acu-manual-update-header\" style=\"background:${headerBg};color:${headerTextColor};border-bottom:1px solid var(--acu-border);padding:12px 16px;font-weight:bold;font-size:1.1em;display:flex;align-items:center;gap:8px;\">\n          <i class=\"fa-solid ${escapeHtml(iconClass)}\" style=\"font-size:1.1em;\"></i> ${escapeHtml(title)}\n        </div>\n        <div class=\"acu-manual-update-body\" style=\"color:var(--acu-text-main);padding:20px 16px;\">\n          <p style=\"color:var(--acu-text-main);margin-bottom:16px;line-height:1.5;\">${escapeHtml(description)}</p>\n          <div class=\"acu-manual-update-safe-box\" style=\"background:var(--acu-btn-bg);border:1px solid ${safeBoxBorder};border-radius:6px;padding:12px;display:flex;gap:12px;align-items:flex-start;\">\n            <i class=\"fa-solid ${escapeHtml(safeIconClass)}\" style=\"color:${safeBoxIconColor};font-size:1.2em;margin-top:2px;\"></i>\n            <div class=\"safe-text\" style=\"display:flex;flex-direction:column;gap:4px;\">\n              <strong style=\"color:var(--acu-text-main);font-size:0.95em;\">${escapeHtml(safeTitle)}</strong>\n              <span style=\"color:var(--acu-text-sub);font-size:0.85em;line-height:1.4;\">${escapeHtml(safeDescription)}</span>\n            </div>\n          </div>\n        </div>\n        <div class=\"acu-manual-update-footer\" style=\"background:var(--acu-table-head);border-top:1px solid var(--acu-border);padding:12px 16px;display:flex;justify-content:flex-end;gap:10px;\">\n          <button class=\"acu-manual-update-cancel-btn\" style=\"background:transparent;color:var(--acu-text-sub);border:1px solid var(--acu-border);padding:6px 16px;border-radius:4px;cursor:pointer;transition:all 0.2s;\"></button>\n          <button class=\"acu-manual-update-confirm-btn\" style=\"background:${confirmBtnBg};color:var(--acu-btn-active-text, #fff);border:none;padding:6px 20px;border-radius:4px;cursor:pointer;font-weight:bold;box-shadow:0 2px 4px rgba(0,0,0,0.2);transition:all 0.2s;\">${escapeHtml(confirmText)}</button>\n        </div>\n      </div>\n    </div>\n  `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    const overlayEl = $dialog[0];\n\n    // \n    $dialog.find('.acu-manual-update-cancel-btn').on('click', () => {\n      $dialog.remove();\n    });\n\n    $dialog.find('.acu-manual-update-confirm-btn').on('click', async () => {\n      const $btn = $dialog.find('.acu-manual-update-confirm-btn');\n      $btn.prop('disabled', true).html(`<i class=\"fa-solid fa-spinner fa-spin\"></i> ${escapeHtml(loadingText)}`);\n\n      try {\n        if (onConfirm) {\n          await onConfirm();\n          $dialog.remove();\n          return;\n        }\n\n        await clearDiceSystemCache();\n        //  Ctrl+Shift+R\n        if (window.parent !== window) {\n          window.parent.location.reload();\n        } else {\n          window.location.reload();\n        }\n      } catch (err) {\n        console.error('[DICE] :', err);\n        if (window.toastr) window.toastr.error('');\n        $btn.prop('disabled', false).html(escapeHtml(confirmText));\n      }\n    });\n\n    // \n    $dialog.on('click', e => {\n      if (e.target === overlayEl) {\n        $dialog.remove();\n      }\n    });\n  };\n\n  // \n  const showImportConfirmDialog = (jsonData, analysis, onComplete) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const config = getConfig();\n\n    const hasConflicts = analysis.conflicts.length > 0;\n    const conflictListHtml =\n      analysis.conflicts.length > 0\n        ? `<div style=\"max-height:80px;overflow-y:auto;background:rgba(0,0,0,0.1);border-radius:4px;padding:6px 8px;margin-top:6px;font-size:11px;color:var(--acu-text-sub);\">${analysis.conflicts.map(n => escapeHtml(n)).join(', ')}</div>`\n        : '';\n\n    const dialogHtml = `\n            <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-import-confirm-dialog\">\n                    <div class=\"acu-import-confirm-header\">\n                        <span class=\"acu-import-confirm-title\"><i class=\"fa-solid fa-file-import\"></i> </span>\n                        <button class=\"acu-import-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-import-confirm-body\">\n                        <div class=\"acu-import-stats\">\n                            <div class=\"acu-import-stat\">\n                                <span class=\"acu-stat-num\">${analysis.total}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-new\">\n                                <span class=\"acu-stat-num\">${analysis.newItems.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-conflict\">\n                                <span class=\"acu-stat-num\">${analysis.conflicts.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                        </div>\n\n                        ${\n                          hasConflicts\n                            ? `\n                            <div class=\"acu-import-conflict-section\">\n                                <div class=\"acu-import-warning\">\n                                    <i class=\"fa-solid fa-exclamation-triangle\"></i> \n                                </div>\n                                ${conflictListHtml}\n                                <div class=\"acu-import-conflict-options\">\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"overwrite\" checked />\n                                        <span></span>\n                                    </label>\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"skip\" />\n                                        <span></span>\n                                    </label>\n                                </div>\n                            </div>\n                        `\n                            : `\n                            <div class=\"acu-import-success\">\n                                <i class=\"fa-solid fa-check-circle\"></i> \n                            </div>\n                        `\n                        }\n                    </div>\n                    <div class=\"acu-import-confirm-footer\">\n                        <button class=\"acu-import-cancel-btn\"></button>\n                        <button class=\"acu-import-confirm-btn\"></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n            position: fixed !important;\n            top: 0 !important;\n            left: 0 !important;\n            right: 0 !important;\n            bottom: 0 !important;\n            width: 100vw !important;\n            height: 100vh !important;\n            background: rgba(0,0,0,0.6) !important;\n            z-index: 31300 !important;\n            display: flex;\n            justify-content: center !important;\n            align-items: center !important;\n            padding: 16px;\n            box-sizing: border-box !important;\n        `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(closeDialog);\n    $dialog.find('.acu-import-close-btn').click(closeDialog);\n    setupOverlayClose($dialog, 'acu-import-confirm-overlay', closeDialog);\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const overwrite = $dialog.find('input[name=\"conflict-mode\"]:checked').val() !== 'skip';\n      try {\n        const stats = AvatarManager.importData(jsonData, overwrite);\n        closeDialog();\n        onComplete && onComplete();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + err.message);\n      }\n    });\n  };\n  // []  ()\n  const showCardEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    let rawData = cachedRawData || getTableData() || loadSnapshot();\n\n    let displayRow = row;\n    // \n    if (rawData && rawData[tableKey] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n      displayRow = rawData[tableKey]?.content?.[rowIndex + 1];\n    }\n\n    const inputsHtml = displayRow\n      .map((cell, idx) => {\n        if (idx === 0) return ''; // \n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        //  textarea\n        return `\n                <div class=\"acu-card-edit-field\">\n                    <label class=\"acu-card-edit-label\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-card-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\">${escapeHtml(val)}</textarea>\n                </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content acu-settings-content-scroll\">\n                        ${inputsHtml}\n                    </div>\n                     <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-card-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-card-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // --- []  ---\n    const adjustHeight = el => {\n      //  auto  0px shrinking  scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    // -----------------------------\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-card-cancel').click(closeDialog);\n\n    //  + AI\n    dialog.find('#dlg-card-save').click(async () => {\n      let rawData = cachedRawData || getTableData() || loadSnapshot();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n        if (hasChanges) {\n          try {\n            //  saveRowInstantly  + \n            await saveRowInstantly(tableKey, rowIndex, [...currentRow]);\n            renderInterface();\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            // \n            return;\n          }\n        }\n      }\n      closeDialog();\n    });\n    // \n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n    // \n    dialog.on('click', function (e) {\n      if ($(e.target).closest('#dlg-close-x, #dlg-close, .acu-close-btn').length) {\n        closeDialog();\n      }\n    });\n  };\n\n  // [] \n  let _configCache = null;\n  const getConfig = () => {\n    if (!_configCache) _configCache = { ...DEFAULT_CONFIG, ...Store.get(STORAGE_KEY_UI_CONFIG, {}) };\n    return _configCache;\n  };\n  const saveConfig = newCfg => {\n    _configCache = { ...getConfig(), ...newCfg };\n    Store.set(STORAGE_KEY_UI_CONFIG, _configCache);\n    const fontVal = applyConfigStyles(_configCache);\n    injectDatabaseStyles(_configCache.theme, fontVal);\n    setDatabaseToastMute(_configCache.muteDatabaseToasts === true);\n  };\n\n  const generateDiffMap = currentData => {\n    const lastData = loadSnapshot();\n    const diffSet = new Set();\n    if (!lastData) return diffSet;\n\n    for (const sheetId in currentData) {\n      const newSheet = currentData[sheetId];\n      const oldSheet = lastData[sheetId];\n      if (!newSheet || !newSheet.name) continue;\n      const tableName = newSheet.name;\n\n      if (!oldSheet) {\n        // \n        if (newSheet.content) {\n          newSheet.content.forEach((row, rIdx) => {\n            if (rIdx > 0) diffSet.add(`${tableName}-row-${rIdx - 1}`);\n          });\n        }\n        continue;\n      }\n\n      const newRows = newSheet.content || [];\n      const oldRows = oldSheet.content || [];\n\n      // [] \n      // : {  -> [{index, row}, ...] } ()\n      const oldRowMap = new Map();\n      oldRows.forEach((row, rIdx) => {\n        if (rIdx === 0) return; // \n        const title = String(row[1] ?? '').trim();\n        if (title) {\n          if (!oldRowMap.has(title)) {\n            oldRowMap.set(title, []);\n          }\n          oldRowMap.get(title).push({ index: rIdx, row: row });\n        }\n      });\n\n      // \n      const matchedOldIndices = new Set();\n\n      // \n      newRows.forEach((row, rIdx) => {\n        if (rIdx === 0) return; // \n        const title = String(row[1] ?? '').trim();\n\n        let matchedOldRow = null;\n\n        if (title && oldRowMap.has(title)) {\n          // \n          const candidates = oldRowMap.get(title);\n          if (candidates.length > 0) {\n            const matched = candidates.shift(); // \n            matchedOldRow = matched.row;\n            matchedOldIndices.add(matched.index);\n            if (candidates.length === 0) {\n              oldRowMap.delete(title);\n            }\n          }\n        }\n\n        if (!matchedOldRow && !title) {\n          // \n          const oldRow = oldRows[rIdx];\n          if (oldRow && !matchedOldIndices.has(rIdx)) {\n            matchedOldRow = oldRow;\n            matchedOldIndices.add(rIdx);\n          }\n        }\n\n        if (!matchedOldRow) {\n          // \n          diffSet.add(`${tableName}-row-${rIdx - 1}`);\n        } else {\n          // \n          row.forEach((cell, cIdx) => {\n            if (cIdx === 0) return; // \n            const oldCell = matchedOldRow[cIdx];\n            if (String(cell ?? '') !== String(oldCell ?? '')) {\n              diffSet.add(`${tableName}-${rIdx - 1}-${cIdx}`);\n            }\n          });\n        }\n      });\n    }\n    return diffSet;\n  };\n\n  const applyConfigStyles = config => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    const fontVal = FONTS.find(f => f.id === config.fontFamily)?.val || FONTS[0].val;\n\n    // []  ID  Style \n    const $styleTag = $('#acu-dynamic-font');\n    const currentFontId = $styleTag.data('font-id');\n\n    if (currentFontId !== config.fontFamily) {\n      $styleTag.remove();\n      const fontImport = `\n                @import url(\"https://fontsapi.zeoseven.com/3/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/442/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/256/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/482/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/446/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/570/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/292/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/69/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/7/main/result.css\");\n            `;\n      $('head').append(`\n                <style id=\"acu-dynamic-font\" data-font-id=\"${config.fontFamily}\">\n                    ${fontImport}\n                    .acu-wrapper, .acu-edit-dialog, .acu-cell-menu, .acu-nav-container, .acu-data-card, .acu-panel-title, .acu-settings-label, .acu-btn-block, .acu-nav-btn, .acu-edit-textarea,\n                    .acu-dice-panel, .acu-contest-panel, .acu-dice-config-dialog,\n                    .acu-relation-graph-container, .acu-avatar-manager, .acu-import-confirm-dialog,\n                    .acu-embedded-options-container, .acu-option-panel, .acu-opt-btn {\n                        font-family: ${fontVal} !important;\n                    }\n                </style>\n            `);\n    }\n\n    // []  CSS \n    const cssVars = {\n      '--acu-card-width': `${config.cardWidth}px`,\n      '--acu-font-size': `${config.fontSize}px`,\n      '--acu-opt-font-size': `${config.optionFontSize || 12}px`,\n      '--acu-grid-cols': config.gridColumns,\n    };\n\n    if ($wrapper.length) {\n      $wrapper.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $wrapper.addClass(`acu-theme-${config.theme}`);\n      $wrapper.css(cssVars);\n    }\n\n    const $optContainer = $('.acu-embedded-options-container');\n    if ($optContainer.length) {\n      $optContainer.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $optContainer.addClass(`acu-theme-${config.theme}`);\n      $optContainer.css(cssVars);\n    }\n\n    return fontVal;\n  };\n\n  /**\n   * \n   *\n   * CSS  ./styles.ts \n   *  styles.ts  MAIN_STYLES \n   *\n   * @see ./styles.ts - MAIN_STYLES \n   */\n  const addStyles = () => {\n    if (window._acuStylesInjected && $(`#${SCRIPT_ID}-styles`).length) return;\n    window._acuStylesInjected = true;\n    const { $ } = getCore();\n\n    //  Tabler Icons  ti:xxx \n    if (!$('#tabler-icons-css').length) {\n      $('head').append(\n        '<link id=\"tabler-icons-css\" rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css\">',\n      );\n    }\n\n    $('style').each(function () {\n      if (this.id && this.id.startsWith('acu_') && this.id.endsWith('-styles') && this.id !== `${SCRIPT_ID}-styles`)\n        $(this).remove();\n    });\n    $(`#${SCRIPT_ID}-styles`).remove();\n    const styles = `<style id=\"${SCRIPT_ID}-styles\">${MAIN_STYLES}</style>`;\n    $('head').append(styles);\n  };\n\n  const getTableData = () => {\n    const api = getCore().getDB();\n    if (!api || !api.exportTableAsJson) {\n      console.warn('[DICE] API ');\n      return null;\n    }\n    try {\n      const data = api.exportTableAsJson();\n      if (data) {\n        const sheetCount = Object.keys(data).filter(k => k.startsWith('sheet_')).length;\n        console.info(`[DICE] ${sheetCount} `);\n      }\n      return data;\n    } catch (e) {\n      console.error('[DICE]:', e);\n      return null;\n    }\n  };\n\n  type DbChatMessage = {\n    is_user?: boolean;\n    TavernDB_ACU_IsolatedData?: unknown;\n    TavernDB_ACU_Identity?: unknown;\n    TavernDB_ACU_IndependentData?: unknown;\n    TavernDB_ACU_ModifiedKeys?: unknown;\n    TavernDB_ACU_UpdateGroupKeys?: unknown;\n    TavernDB_ACU_Data?: unknown;\n    TavernDB_ACU_SummaryData?: unknown;\n  };\n\n  const getDbChatMessages = (): DbChatMessage[] | null => {\n    const st = window.SillyTavern || window.parent?.SillyTavern;\n    const rawChat = st?.chat;\n    return Array.isArray(rawChat) ? (rawChat as DbChatMessage[]) : null;\n  };\n\n  const parseIsolatedData = (value: unknown): Record<string, unknown> | null => {\n    if (!value) return null;\n    if (typeof value === 'string') {\n      try {\n        const parsed = JSON.parse(value);\n        if (parsed && typeof parsed === 'object') return parsed as Record<string, unknown>;\n      } catch {\n        return null;\n      }\n      return null;\n    }\n    if (typeof value === 'object') return value as Record<string, unknown>;\n    return null;\n  };\n\n  const hasSheetKeys = (value: unknown): boolean => {\n    if (!value || typeof value !== 'object') return false;\n    return Object.keys(value as Record<string, unknown>).some(key => key.startsWith('sheet_'));\n  };\n\n  const hasDbPayload = (msg: DbChatMessage): boolean => {\n    if (hasSheetKeys(msg.TavernDB_ACU_IndependentData)) return true;\n    if (hasSheetKeys(msg.TavernDB_ACU_Data)) return true;\n    if (hasSheetKeys(msg.TavernDB_ACU_SummaryData)) return true;\n    const isolated = parseIsolatedData(msg.TavernDB_ACU_IsolatedData);\n    if (!isolated) return false;\n    return Object.values(isolated).some(tagData => {\n      if (!tagData || typeof tagData !== 'object') return false;\n      const data = (tagData as Record<string, unknown>).independentData;\n      return hasSheetKeys(data);\n    });\n  };\n\n  const findLatestDbMessageIndex = (includeUser = false): number => {\n    const chat = getDbChatMessages();\n    if (!chat) return -1;\n    for (let i = chat.length - 1; i >= 0; i--) {\n      const msg = chat[i];\n      if (!includeUser && msg?.is_user) continue;\n      if (hasDbPayload(msg)) return i;\n    }\n    return -1;\n  };\n\n  const resolveIsolationKey = (msg: DbChatMessage, isolated: Record<string, unknown> | null): string | null => {\n    if (typeof msg?.TavernDB_ACU_Identity === 'string') {\n      const identity = msg.TavernDB_ACU_Identity;\n      if (isolated && Object.prototype.hasOwnProperty.call(isolated, identity)) return identity;\n    }\n    if (isolated && Object.prototype.hasOwnProperty.call(isolated, '')) return '';\n    if (isolated) {\n      const keys = Object.keys(isolated);\n      if (keys.length === 1) return keys[0];\n    }\n    return null;\n  };\n\n  const relocateDbPayloadToAnchor = async (anchorIndex: number): Promise<void> => {\n    if (anchorIndex < 0) return;\n    const chat = getDbChatMessages();\n    if (!chat || anchorIndex >= chat.length) return;\n    const latestIndex = findLatestDbMessageIndex(true);\n    if (latestIndex < 0 || latestIndex === anchorIndex) return;\n\n    const source = chat[latestIndex];\n    const target = chat[anchorIndex];\n    if (!source || !target) return;\n    if (target.is_user && !hasDbPayload(target)) return;\n\n    let moved = false;\n\n    const sourceIsolated = parseIsolatedData(source.TavernDB_ACU_IsolatedData);\n    if (sourceIsolated) {\n      const targetIsolated = parseIsolatedData(target.TavernDB_ACU_IsolatedData) || {};\n      const isolationKey = resolveIsolationKey(source, sourceIsolated);\n      if (isolationKey !== null) {\n        if (Object.prototype.hasOwnProperty.call(sourceIsolated, isolationKey)) {\n          targetIsolated[isolationKey] = sourceIsolated[isolationKey];\n          const nextSource = { ...sourceIsolated };\n          delete nextSource[isolationKey];\n          if (Object.keys(nextSource).length > 0) {\n            source.TavernDB_ACU_IsolatedData = nextSource;\n          } else {\n            delete source.TavernDB_ACU_IsolatedData;\n          }\n          target.TavernDB_ACU_IsolatedData = targetIsolated;\n          moved = true;\n        }\n      } else {\n        target.TavernDB_ACU_IsolatedData = sourceIsolated;\n        delete source.TavernDB_ACU_IsolatedData;\n        moved = true;\n      }\n    }\n\n    if (source.TavernDB_ACU_Identity !== undefined) {\n      target.TavernDB_ACU_Identity = source.TavernDB_ACU_Identity;\n      delete source.TavernDB_ACU_Identity;\n      moved = true;\n    }\n    if (source.TavernDB_ACU_IndependentData !== undefined) {\n      target.TavernDB_ACU_IndependentData = source.TavernDB_ACU_IndependentData;\n      delete source.TavernDB_ACU_IndependentData;\n      moved = true;\n    }\n    if (source.TavernDB_ACU_ModifiedKeys !== undefined) {\n      target.TavernDB_ACU_ModifiedKeys = source.TavernDB_ACU_ModifiedKeys;\n      delete source.TavernDB_ACU_ModifiedKeys;\n      moved = true;\n    }\n    if (source.TavernDB_ACU_UpdateGroupKeys !== undefined) {\n      target.TavernDB_ACU_UpdateGroupKeys = source.TavernDB_ACU_UpdateGroupKeys;\n      delete source.TavernDB_ACU_UpdateGroupKeys;\n      moved = true;\n    }\n    if (source.TavernDB_ACU_Data !== undefined) {\n      target.TavernDB_ACU_Data = source.TavernDB_ACU_Data;\n      delete source.TavernDB_ACU_Data;\n      moved = true;\n    }\n    if (source.TavernDB_ACU_SummaryData !== undefined) {\n      target.TavernDB_ACU_SummaryData = source.TavernDB_ACU_SummaryData;\n      delete source.TavernDB_ACU_SummaryData;\n      moved = true;\n    }\n\n    if (moved) {\n      await triggerSlash('savechat');\n    }\n  };\n\n  const saveDataToDatabase = async (tableData, skipRender = false, commitDeletes = false) => {\n    if (isSaving) {\n      console.warn('[DICE]');\n      return; // \n    }\n    console.info('[DICE]...');\n    isSaving = true;\n    const { $ } = getCore();\n    const $saveBtn = $('#acu-btn-save-global');\n\n    // UI \n    if (!skipRender && $saveBtn.length) {\n      $saveBtn.find('i').removeClass('fa-save').addClass('fa-spinner fa-spin');\n      $saveBtn.prop('disabled', true);\n    }\n\n    try {\n      // 1.  sheet_  ( = )\n      const dataToSave = {};\n      //  mate \n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // 2.  ()\n      if (commitDeletes) {\n        const deletions = getPendingDeletions();\n        Object.keys(deletions).forEach(key => {\n          if (dataToSave[key] && dataToSave[key].content) {\n            deletions[key]\n              .sort((a, b) => b - a)\n              .forEach(idx => {\n                if (dataToSave[key].content[idx + 1]) dataToSave[key].content.splice(idx + 1, 1);\n              });\n          }\n        });\n      }\n\n      // 3. \n      let jsonString;\n      try {\n        jsonString = JSON.stringify(dataToSave);\n        //  10MB \n        const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n        if (sizeInMB > 10) {\n          throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n        }\n        console.info(`[DICE]: ${sizeInMB.toFixed(2)}MB`);\n      } catch (stringifyError) {\n        console.error('[DICE]ACU JSON :', stringifyError);\n        throw new Error(`: ${stringifyError.message || stringifyError}`);\n      }\n\n      // 4.  API  ()\n      const api = getCore().getDB();\n      if (!api || !api.importTableAsJson) {\n        throw new Error(' API ');\n      }\n      const anchorIndex = findLatestDbMessageIndex();\n\n      try {\n        //  importTableAsJson saveChat()\n        //  saveChat()  \"Settings could not be saved\" \n        const result = await api.importTableAsJson(jsonString);\n        //  false \n        if (result === false) {\n          throw new Error(' false');\n        }\n        await relocateDbPayloadToAnchor(anchorIndex);\n        console.info('[DICE]');\n      } catch (apiError) {\n        console.error('[DICE]ACU API :', apiError);\n        //  \"Settings could not be saved\" \n        const errorMsg = apiError.message || String(apiError);\n        if (\n          errorMsg.includes('Settings could not be saved') ||\n          errorMsg.includes('server connection') ||\n          errorMsg.includes('data loss')\n        ) {\n          throw new Error('');\n        }\n        throw new Error(`: ${errorMsg}`);\n      }\n\n      // 5. \n      cachedRawData = dataToSave;\n      saveSnapshot(dataToSave);\n      hasUnsavedChanges = false;\n      currentDiffMap = new Set();\n      if (window.acuModifiedSet) window.acuModifiedSet.clear();\n      console.info('[DICE]');\n\n      if (!skipRender) {\n        renderInterface();\n      }\n    } catch (e) {\n      const errorMessage = e.message || '';\n      console.error('[DICE]:', {\n        error: e,\n        message: errorMessage,\n        stack: e.stack,\n      });\n      if (window.toastr) {\n        window.toastr.error(errorMessage, '', { timeOut: 5000 });\n      } else {\n        alert(`: ${errorMessage}`);\n      }\n      // \n      throw e;\n    } finally {\n      isSaving = false;\n      console.info('[DICE]');\n      if (!skipRender && $saveBtn.length) {\n        $saveBtn.find('i').removeClass('fa-spinner fa-spin').addClass('fa-save');\n        $saveBtn.prop('disabled', false);\n      }\n    }\n  };\n\n  const performSaveDataOnly = async (tableData, modifiedSheetKeys?: string[]) => {\n    try {\n      const dataToSave = {};\n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // \n      let jsonString;\n      try {\n        jsonString = JSON.stringify(dataToSave);\n        //  10MB \n        const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n        if (sizeInMB > 10) {\n          throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n        }\n      } catch (stringifyError) {\n        console.error('[DICE]ACU JSON :', stringifyError);\n        throw new Error(`: ${stringifyError.message || stringifyError}`);\n      }\n\n      const api = getCore().getDB();\n      if (!api || !api.importTableAsJson) {\n        throw new Error(' API ');\n      }\n      const anchorIndex = findLatestDbMessageIndex();\n\n      try {\n        //  importTableAsJson saveChat()\n        const result = await api.importTableAsJson(jsonString);\n        //  false \n        if (result === false) {\n          throw new Error(' false');\n        }\n        await relocateDbPayloadToAnchor(anchorIndex);\n      } catch (apiError) {\n        console.error('[DICE]ACU API :', apiError);\n        //  \"Settings could not be saved\" \n        const errorMsg = apiError.message || String(apiError);\n        if (\n          errorMsg.includes('Settings could not be saved') ||\n          errorMsg.includes('server connection') ||\n          errorMsg.includes('data loss')\n        ) {\n          throw new Error('');\n        }\n        throw new Error(`: ${errorMsg}`);\n      }\n\n      cachedRawData = dataToSave;\n      //  saveSnapshot() hasUnsavedChanges\n      return dataToSave;\n    } catch (e) {\n      console.error('[DICE]ACU saveDataOnly error:', e, modifiedSheetKeys ? { modifiedSheetKeys } : undefined);\n      throw e;\n    }\n  };\n\n  const runInSaveQueue = async <T>(task: () => Promise<T>): Promise<T> => {\n    const operation = saveQueue\n      .catch(error => {\n        console.warn('[DICE]ACU runInSaveQueue previous step failed, continue next task:', error);\n      })\n      .then(task);\n\n    saveQueue = operation\n      .then(() => undefined)\n      .catch(e => {\n        console.error('[DICE]ACU runInSaveQueue error:', e);\n      });\n    return operation;\n  };\n\n  // [] \n  // \n  const saveDataOnly = async (tableData, modifiedSheetKeys?: string[]) =>\n    runInSaveQueue(() => performSaveDataOnly(tableData, modifiedSheetKeys));\n\n  // [] \n  // AI\n  //  saveDataToDatabase\n  const saveRowInstantly = async (tableKey: string, rowIndex: number, newRowData: unknown[]): Promise<void> => {\n    try {\n      // 1. \n      const rawData = cachedRawData || getTableData();\n      if (!rawData || !rawData[tableKey]) {\n        throw new Error(` \"${tableKey}\" `);\n      }\n      if (!rawData[tableKey].content) {\n        throw new Error(` \"${tableKey}\" `);\n      }\n\n      // 2. rowIndex 0content[0] \n      rawData[tableKey].content[rowIndex + 1] = newRowData;\n\n      // 3. \n      await saveDataOnly(rawData, [tableKey]);\n\n      // 4. \n      const snapshot = loadSnapshot();\n      if (snapshot && snapshot[tableKey] && snapshot[tableKey].content) {\n        snapshot[tableKey].content[rowIndex + 1] = [...newRowData];\n        saveSnapshot(snapshot);\n      }\n    } catch (e) {\n      const errorMsg = e instanceof Error ? e.message : String(e);\n      console.error('[DICE]ACU saveRowInstantly error:', e);\n      toastr.error(`: ${errorMsg}`);\n      throw e;\n    }\n  };\n\n  const processJsonData = json => {\n    const tables = {};\n    if (!json || typeof json !== 'object') return tables;\n    for (const sheetId in json) {\n      if (json[sheetId]?.name) {\n        const sheet = json[sheetId];\n        tables[sheet.name] = {\n          key: sheetId,\n          headers: sheet.content ? sheet.content[0] || [] : [],\n          rows: sheet.content ? sheet.content.slice(1) : [],\n          rawContent: sheet.content || [],\n          exportConfig: sheet.exportConfig || {},\n          updateConfig: sheet.updateConfig || {},\n          ...sheet,\n        };\n      }\n    }\n    return tables;\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function suggestFormatValue(pattern, rowIndex, existingValues = [], tableContent = null) {\n    if (!pattern || rowIndex === undefined || rowIndex < 0) return null;\n\n    try {\n      //  \"+\"  ^AM\\d{3}$\n      // pattern  JavaScript  '^AM\\\\d{3}$' '^AM\\d{3}$'\n      //  \\d{3} /\\\\d\\{3\\}/+d\n      // ^?[]+\\d\\{\\}$?\n      const prefixMatch = pattern.match(/^\\^?([A-Za-z]+)\\\\d\\{(\\d+)\\}\\$?$/);\n\n      if (prefixMatch) {\n        const prefix = prefixMatch[1]; // \"AM\"\n        const digits = parseInt(prefixMatch[2], 10); // 3\n\n        // \n        if (tableContent && (tableContent.name === '' || tableContent.name === '')) {\n          const headers = tableContent.content?.[0] || [];\n          const rows = tableContent.content?.slice(1) || [];\n          const codeIndex = headers.indexOf('');\n\n          if (codeIndex >= 0) {\n            // \n            const existingNumbers = [];\n            rows.forEach(row => {\n              const codeValue = row?.[codeIndex];\n              if (codeValue && typeof codeValue === 'string') {\n                const match = codeValue.match(new RegExp(`^${prefix}(\\\\d+)$`));\n                if (match) {\n                  const num = parseInt(match[1], 10);\n                  if (!isNaN(num)) existingNumbers.push(num);\n                }\n              }\n            });\n\n            // \n            const maxNum = existingNumbers.length > 0 ? Math.max(...existingNumbers) : 0;\n            const nextNum = String(maxNum + 1).padStart(digits, '0');\n            return prefix + nextNum;\n          }\n        }\n\n        // \n        const nextNum = String(rowIndex + 1).padStart(digits, '0');\n        return prefix + nextNum;\n      }\n\n      //  \\d{3} \n      const numOnlyMatch = pattern.match(/^\\^?\\\\d\\{(\\d+)\\}\\$?$/);\n      if (numOnlyMatch) {\n        const digits = parseInt(numOnlyMatch[1], 10);\n        return String(rowIndex + 1).padStart(digits, '0');\n      }\n    } catch (e) {\n      console.error('[DICE]ACU :', e);\n    }\n\n    return null; // \n  }\n\n  //  OR \n  function getRelationOptions(refTable, refColumns, rawData) {\n    const options = new Set();\n    if (!refTable || !refColumns || !rawData) return Array.from(options);\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        columns.forEach(col => {\n          const colIdx = headers.indexOf(col);\n          if (colIdx >= 0) {\n            rows.forEach(row => {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                options.add(String(value).trim());\n              }\n            });\n          }\n        });\n\n        break; // \n      }\n    }\n\n    return Array.from(options).sort();\n  }\n\n  // \n  function isValueInRelationTable(value, refTable, refColumns, rawData) {\n    if (!value || !refTable || !refColumns || !rawData) return false;\n    if (String(value).trim() === '') return false;\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n    const strVal = String(value).trim();\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        for (const col of columns) {\n          const colIdx = headers.indexOf(col);\n          if (colIdx === -1) continue;\n\n          // \n          for (let i = 0; i < rows.length; i++) {\n            const cellValue = rows[i]?.[colIdx];\n            if (cellValue !== null && cellValue !== undefined && String(cellValue).trim() === strVal) {\n              return true; // \n            }\n          }\n        }\n\n        break; // \n      }\n    }\n\n    return false; // \n  }\n\n  //  required \n  function getColumnExamples(tableName, columnName, currentRowIndex, rawData, maxCount = 5) {\n    const examples = new Set();\n    if (!tableName || !columnName || !rawData) return [];\n\n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === tableName) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n        const colIdx = headers.indexOf(columnName);\n\n        if (colIdx >= 0) {\n          rows.forEach((row, idx) => {\n            if (idx !== currentRowIndex) {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                examples.add(String(value).trim());\n              }\n            }\n          });\n        }\n        break;\n      }\n    }\n\n    return Array.from(examples).slice(0, maxCount);\n  }\n\n  // \n  function getNearestValidNumber(currentValue, min, max) {\n    const num = parseFloat(currentValue);\n    if (isNaN(num)) return min !== undefined ? min : 0;\n    if (min !== undefined && num < min) return min;\n    if (max !== undefined && num > max) return max;\n    return num;\n  }\n\n  // ========================================\n  // []  - \n  // ========================================\n  const refreshRegexRulesList = () => {\n    const { $ } = getCore();\n    const dialog = $('.acu-settings-dialog');\n    if (!dialog.length) return;\n\n    const $rulesList = dialog.find('#regex-rules-list');\n    if (!$rulesList.length) return;\n\n    // HTML\n    const rules = RegexTransformationManager.getAllRules();\n    const html = rules\n      .map(rule => {\n        const scopeIcon =\n          rule.scope.type === 'global' ? 'fa-globe' : rule.scope.type === 'table' ? 'fa-table' : 'fa-columns';\n        const scopeText =\n          rule.scope.type === 'global'\n            ? ''\n            : rule.scope.type === 'table'\n              ? rule.scope.tableNames?.join(',')\n              : `${rule.scope.tableNames?.join(',')}.${rule.scope.columnNames?.join(',')}`;\n        return `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n              <div class=\"acu-rule-type-icon\" title=\": ${escapeHtml(rule.scope.type)}\">\n                  <i class=\"fa-solid ${scopeIcon}\"></i>\n              </div>\n              <div class=\"acu-rule-info\">\n                  <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                  <div class=\"acu-rule-target\" style=\"font-size:10px;\">${escapeHtml(scopeText)} | ${escapeHtml(rule.operation)}</div>\n              </div>\n              <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n              <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                  <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n              </div>\n              <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n      `;\n      })\n      .join('');\n\n    // HTML,\n    $rulesList.html(html);\n  };\n\n  // ========================================\n  // /\n  // ========================================\n  const showAddValidationRuleModal = (parentDialog: JQuery, editRuleId?: string) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const tables = processJsonData(rawData || {});\n    const tableNames = Object.keys(tables);\n\n    // \n    const isEditMode = !!editRuleId;\n    const existingRule = isEditMode ? ValidationRuleManager.getRule(editRuleId) : null;\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\" ${isEditMode ? 'style=\"opacity:0;transition:opacity 0.15s ease-in;\"' : ''}>\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-dice-cfg-header\">\n            <span><i class=\"fa-solid ${isEditMode ? 'fa-pen' : 'fa-plus'}\"></i> ${isEditMode ? '' : ''}</span>\n            <button class=\"acu-config-close\" id=\"dlg-rule-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-table\" class=\"acu-setting-select\">\n                <option value=\"\">...</option>\n                ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"row-column\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-column\" class=\"acu-setting-select\" disabled>\n                <option value=\"\">...</option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-type\" class=\"acu-setting-select\">\n                <optgroup label=\"  \">\n                  <option value=\"tableReadonly\"></option>\n                  <option value=\"rowLimit\"></option>\n                  <option value=\"sequence\"></option>\n                </optgroup>\n                <optgroup label=\"  \">\n                  <option value=\"required\"></option>\n                  <option value=\"format\"></option>\n                  <option value=\"enum\"></option>\n                  <option value=\"numeric\"></option>\n                  <option value=\"relation\"></option>\n                  <option value=\"keyValue\"></option>\n                </optgroup>\n              </select>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-tableReadonly\">\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ,\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-rowLimit\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-max\" class=\"acu-panel-input\" placeholder=\"\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-sequence\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-sequence-prefix\" class=\"acu-panel-input\" placeholder=\"AM\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-sequence-start\" class=\"acu-panel-input\" placeholder=\"1\" value=\"1\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-sequence-paired-table\" class=\"acu-setting-select\" style=\"flex:1;\">\n                  <option value=\"\"></option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> \"+\"(AM0001, AM0002, AM0003...),<br>\n                <i class=\"fa-solid fa-link\" style=\"margin-top:4px;display:block;color:var(--acu-warning-icon);margin-right:6px;\"></i> ,,\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-required\" style=\"display:none;\">\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-format\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-pattern\" class=\"acu-panel-input\" placeholder=\"^AM\\\\d{3}$\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-enum\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-values\" class=\"acu-panel-input\" placeholder=\",,\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-numeric\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-relation\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-table\" class=\"acu-setting-select\">\n                  <option value=\"\">...</option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-column\" class=\"acu-setting-select\" multiple style=\"flex:1;min-height:80px;\">\n                  <option value=\"\">...</option>\n                </select>\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ,(OR ) Ctrl/Cmd \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-keyValue\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-keyvalue-type\" class=\"acu-setting-select\">\n                  <option value=\"text\"></option>\n                  <option value=\"numeric\"></option>\n                </select>\n              </div>\n              <div class=\"acu-setting-row\" id=\"row-keyvalue-range\" style=\"display:none;\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ::;:(,)\n              </div>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-error-msg\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n          </div>\n          <div class=\"acu-dice-cfg-actions\">\n            <button id=\"dlg-rule-cancel\"></button>\n            <button id=\"dlg-rule-save\">${isEditMode ? '' : ''}</button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // select\n    const updateSelectColor = $select => {\n      const val = $select.val();\n      if (!val || val === '') {\n        $select.css('color', 'var(--acu-text-sub)');\n        $select.css('opacity', '0.7');\n      } else {\n        $select.css('color', 'var(--acu-text-main)');\n        $select.css('opacity', '1');\n      }\n    };\n\n    // select\n    dialog.find('select').each(function () {\n      updateSelectColor($(this));\n      $(this).on('change', function () {\n        updateSelectColor($(this));\n      });\n    });\n\n    // \n    dialog.find('#rule-table').on('change', function () {\n      const tableName = $(this).val();\n      const $colSelect = dialog.find('#rule-column');\n      const $pairedTableSelect = dialog.find('#cfg-sequence-paired-table');\n      updateSelectColor($(this));\n\n      // \n      if ($pairedTableSelect.length > 0) {\n        const currentPairedValue = $pairedTableSelect.val();\n        $pairedTableSelect.empty();\n        $pairedTableSelect.append('<option value=\"\"></option>');\n        tableNames\n          .filter(name => name !== tableName)\n          .forEach(name => {\n            $pairedTableSelect.append(`<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`);\n          });\n        // \n        if (currentPairedValue && currentPairedValue !== tableName) {\n          $pairedTableSelect.val(currentPairedValue);\n        }\n        updateSelectColor($pairedTableSelect);\n      }\n\n      if (!tableName || !tables[tableName]) {\n        $colSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($colSelect);\n        return;\n      }\n\n      const headers = tables[tableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $colSelect.html('<option value=\"\">...</option>' + options).prop('disabled', false);\n      updateSelectColor($colSelect);\n    });\n\n    // \n    dialog.find('#cfg-ref-table').on('change', function () {\n      const refTableName = $(this).val();\n      const $refColSelect = dialog.find('#cfg-ref-column');\n      updateSelectColor($(this));\n\n      if (!refTableName || !tables[refTableName]) {\n        $refColSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($refColSelect);\n        return;\n      }\n\n      const headers = tables[refTableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $refColSelect.html(options).prop('disabled', false);\n      updateSelectColor($refColSelect);\n    });\n\n    // \n    dialog.find('#rule-type').on('change', function () {\n      const type = $(this).val();\n      const typeInfo = RULE_TYPE_INFO[type];\n      const isTableRule = typeInfo?.scope === 'table';\n      updateSelectColor($(this));\n\n      // \n      dialog.find('.acu-rule-config-section').hide();\n      dialog.find('#config-' + type).show();\n\n      // sequence\n      if (isTableRule && type !== 'sequence') {\n        dialog.find('#row-column').hide();\n        dialog.find('#rule-column').val('').prop('disabled', true);\n      } else {\n        dialog.find('#row-column').show();\n        // \n        if (dialog.find('#rule-table').val()) {\n          dialog.find('#rule-column').prop('disabled', false);\n        }\n      }\n    });\n\n    // /\n    dialog.find('#cfg-keyvalue-type').on('change', function () {\n      const valueType = $(this).val();\n      if (valueType === 'numeric') {\n        dialog.find('#row-keyvalue-range').show();\n      } else {\n        dialog.find('#row-keyvalue-range').hide();\n      }\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#dlg-rule-close, #dlg-rule-cancel', function (e) {\n      e.stopPropagation(); // \n      closeDialog();\n    });\n    setupOverlayClose(dialog, 'acu-validation-modal-overlay', () => {\n      closeDialog();\n    });\n\n    // \n    dialog.find('#dlg-rule-save').on('click', function () {\n      const name = dialog.find('#rule-name').val()?.trim();\n      const targetTable = dialog.find('#rule-table').val();\n      const targetColumn = dialog.find('#rule-column').val();\n      const ruleType = dialog.find('#rule-type').val();\n      const errorMessage = dialog.find('#rule-error-msg').val()?.trim();\n      const typeInfo = RULE_TYPE_INFO[ruleType];\n      const isTableRule = typeInfo?.scope === 'table';\n\n      // \n      if (!name) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!targetTable) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      // sequence\n      if ((!isTableRule || ruleType === 'sequence') && !targetColumn) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      const ruleConfig = {};\n      if (ruleType === 'tableReadonly') {\n        // \n      } else if (ruleType === 'rowLimit') {\n        const min = dialog.find('#cfg-row-min').val();\n        const max = dialog.find('#cfg-row-max').val();\n        if (min !== '') ruleConfig.min = parseInt(min, 10);\n        if (max !== '') ruleConfig.max = parseInt(max, 10);\n      } else if (ruleType === 'required') {\n        // \n      } else if (ruleType === 'format') {\n        const pattern = dialog.find('#cfg-pattern').val()?.trim();\n        if (!pattern) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        // \n        try {\n          new RegExp(pattern);\n        } catch (e) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n        ruleConfig.pattern = pattern;\n      } else if (ruleType === 'enum') {\n        const valuesStr = dialog.find('#cfg-values').val()?.trim();\n        if (!valuesStr) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        ruleConfig.values = valuesStr\n          .split(',')\n          .map(v => v.trim())\n          .filter(v => v);\n      } else if (ruleType === 'numeric') {\n        const min = dialog.find('#cfg-min').val();\n        const max = dialog.find('#cfg-max').val();\n        if (min !== '') ruleConfig.min = parseFloat(min);\n        if (max !== '') ruleConfig.max = parseFloat(max);\n      } else if (ruleType === 'relation') {\n        const refTable = dialog.find('#cfg-ref-table').val();\n        const refColumns = dialog.find('#cfg-ref-column').val(); // \n\n        if (!refTable) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        const selectedColumns = Array.isArray(refColumns) ? refColumns : refColumns ? [refColumns] : [];\n        if (selectedColumns.length === 0 || (selectedColumns.length === 1 && !selectedColumns[0])) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        ruleConfig.refTable = refTable;\n        // \n        ruleConfig.refColumn = selectedColumns.length === 1 ? selectedColumns[0] : selectedColumns;\n      } else if (ruleType === 'keyValue') {\n        const valueType = dialog.find('#cfg-keyvalue-type').val();\n        ruleConfig.valueType = valueType || 'text';\n\n        if (valueType === 'numeric') {\n          const min = dialog.find('#cfg-keyvalue-min').val();\n          const max = dialog.find('#cfg-keyvalue-max').val();\n          if (min !== '') ruleConfig.valueMin = parseFloat(min);\n          if (max !== '') ruleConfig.valueMax = parseFloat(max);\n        }\n      } else if (ruleType === 'sequence') {\n        const prefix = dialog.find('#cfg-sequence-prefix').val()?.trim() || '';\n        const startFrom = dialog.find('#cfg-sequence-start').val();\n        const pairedTable = dialog.find('#cfg-sequence-paired-table').val()?.trim() || null;\n        ruleConfig.prefix = prefix;\n        ruleConfig.startFrom = startFrom !== '' ? parseInt(startFrom, 10) : 1;\n        if (isNaN(ruleConfig.startFrom)) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        if (pairedTable) {\n          ruleConfig.pairedTable = pairedTable;\n        }\n      }\n\n      // IDID\n      const finalRuleId = isEditMode\n        ? editRuleId\n        : 'custom_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);\n\n      // \n      const ruleData = {\n        id: finalRuleId,\n        name: name,\n        description: existingRule?.description || '',\n        targetTable: targetTable,\n        targetColumn: isTableRule && ruleType !== 'sequence' ? '' : targetColumn, //  targetColumnsequence\n        ruleType: ruleType,\n        config: ruleConfig,\n        errorMessage: errorMessage || typeInfo?.desc || '',\n        intercept: existingRule?.intercept ?? false, // \n        enabled: existingRule?.enabled ?? true, // \n      };\n\n      let success = false;\n      if (isEditMode) {\n        // \n        success = ValidationRuleManager.updateCustomRule(editRuleId, ruleData);\n      } else {\n        // \n        success = ValidationRuleManager.addCustomRule(ruleData);\n      }\n\n      if (success) {\n        closeDialog();\n\n        // \n        ValidationRuleManager.clearCache();\n\n        // \n        const $rulesList = parentDialog.find('#validation-rules-list');\n\n        if (isEditMode) {\n          // \n          const $existingItem = $rulesList.find(`.acu-validation-rule-item[data-rule-id=\"${escapeHtml(editRuleId)}\"]`);\n          if ($existingItem.length) {\n            const hasIntercept = ruleData.intercept;\n            const isEnabled = ruleData.enabled;\n            $existingItem.find('.acu-rule-name').text(name);\n            $existingItem\n              .find('.acu-rule-target')\n              .text(`${targetTable}${isTableRule && ruleType !== 'sequence' ? ' ()' : '.' + targetColumn}`);\n            $existingItem\n              .find('.acu-rule-type-icon')\n              .attr('title', `${typeInfo?.name || ruleType}${isTableRule ? ' ()' : ''}`)\n              .find('i')\n              .attr('class', `fa-solid ${typeInfo?.icon || 'fa-question'}`);\n            $existingItem.toggleClass('disabled', !isEnabled);\n          }\n        } else {\n          // \n          const ruleHtml = `\n          <div class=\"acu-validation-rule-item\" data-rule-id=\"${escapeHtml(finalRuleId)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo?.name || ruleType)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo?.icon || 'fa-question'}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(targetTable)}${isTableRule && ruleType !== 'sequence' ? ' ()' : '.' + escapeHtml(targetColumn)}</div>\n            </div>\n            <div class=\"acu-rule-intercept\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n            <div class=\"acu-rule-toggle active\" title=\"/\">\n              <i class=\"fa-solid fa-toggle-on\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n        `;\n          $rulesList.append(ruleHtml);\n        }\n        // \n      } else {\n        if (window.toastr) window.toastr.error(isEditMode ? '' : '');\n      }\n    });\n\n    // \n    if (isEditMode && existingRule) {\n      dialog.find('#rule-name').val(existingRule.name || '');\n      dialog.find('#rule-error-msg').val(existingRule.errorMessage || '');\n\n      //  change \n      dialog\n        .find('#rule-table')\n        .val(existingRule.targetTable || '')\n        .trigger('change');\n\n      //  change \n      dialog\n        .find('#rule-type')\n        .val(existingRule.ruleType || 'required')\n        .trigger('change');\n\n      // / change \n      setTimeout(() => {\n        // \n        if (existingRule.targetColumn) {\n          dialog.find('#rule-column').val(existingRule.targetColumn);\n          updateSelectColor(dialog.find('#rule-column'));\n        }\n\n        // \n        const cfg = existingRule.config || {};\n        const ruleType = existingRule.ruleType;\n\n        if (ruleType === 'rowLimit') {\n          if (cfg.min !== undefined) dialog.find('#cfg-row-min').val(cfg.min);\n          if (cfg.max !== undefined) dialog.find('#cfg-row-max').val(cfg.max);\n        } else if (ruleType === 'sequence') {\n          dialog.find('#cfg-sequence-prefix').val(cfg.prefix || '');\n          dialog.find('#cfg-sequence-start').val(cfg.startFrom ?? 1);\n          if (cfg.pairedTable) {\n            dialog.find('#cfg-sequence-paired-table').val(cfg.pairedTable);\n            updateSelectColor(dialog.find('#cfg-sequence-paired-table'));\n          }\n        } else if (ruleType === 'format') {\n          dialog.find('#cfg-pattern').val(cfg.pattern || '');\n        } else if (ruleType === 'enum') {\n          dialog.find('#cfg-values').val((cfg.values || []).join(','));\n        } else if (ruleType === 'numeric') {\n          if (cfg.min !== undefined) dialog.find('#cfg-min').val(cfg.min);\n          if (cfg.max !== undefined) dialog.find('#cfg-max').val(cfg.max);\n        } else if (ruleType === 'relation') {\n          if (cfg.refTable) {\n            dialog.find('#cfg-ref-table').val(cfg.refTable).trigger('change');\n            // \n            setTimeout(() => {\n              const refColumns = Array.isArray(cfg.refColumn) ? cfg.refColumn : cfg.refColumn ? [cfg.refColumn] : [];\n              dialog.find('#cfg-ref-column').val(refColumns);\n              updateSelectColor(dialog.find('#cfg-ref-column'));\n              // \n              dialog.css('opacity', '1');\n            }, 100);\n            return; // relation  setTimeout \n          }\n        } else if (ruleType === 'keyValue') {\n          dialog\n            .find('#cfg-keyvalue-type')\n            .val(cfg.valueType || 'text')\n            .trigger('change');\n          if (cfg.valueMin !== undefined) dialog.find('#cfg-keyvalue-min').val(cfg.valueMin);\n          if (cfg.valueMax !== undefined) dialog.find('#cfg-keyvalue-max').val(cfg.valueMax);\n        }\n\n        // \n        dialog.css('opacity', '1');\n      }, 100);\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showSmartFixModal = error => {\n    if (!error || !error.rule) {\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const rule = error.rule;\n    const ruleType = error.ruleType || rule.ruleType;\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n    const isTableRule = typeInfo?.scope === 'table';\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const snapshot = loadSnapshot();\n\n    //  rowTitle\n    if (!error.rowTitle && error.rowIndex >= 0 && rawData && error.tableName) {\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          const row = rawData[sheetId].content?.[error.rowIndex + 1];\n          if (row) {\n            error.rowTitle = row[1] || row[0] || ` ${error.rowIndex + 1}`;\n          }\n          break;\n        }\n      }\n    }\n\n    // \n    let snapshotValue = '';\n    if (!isTableRule && snapshot && error.tableName && error.columnName !== undefined) {\n      for (const sheetId in snapshot) {\n        if (snapshot[sheetId]?.name === error.tableName) {\n          const headers = snapshot[sheetId].content?.[0] || [];\n          const colIdx = headers.indexOf(error.columnName);\n          const rowIdx = error.rowIndex + 1;\n          if (colIdx >= 0 && snapshot[sheetId].content?.[rowIdx]) {\n            snapshotValue = snapshot[sheetId].content[rowIdx][colIdx] ?? '';\n          }\n          break;\n        }\n      }\n    }\n\n    const hasSnapshotValue = snapshotValue !== '' && String(snapshotValue) !== String(error.currentValue || '');\n\n    // ========================================\n    // \n    // ========================================\n    if (isTableRule) {\n      showTableRuleFixModal(error, rule, ruleType, rawData, snapshot, currentThemeClass);\n      return;\n    }\n\n    // ========================================\n    // \n    // ========================================\n\n    // UI\n    let inputHtml = '';\n\n    if (ruleType === 'enum' && rule.config?.values) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'numeric') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'keyValue') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else {\n      // \n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    }\n\n    // \n    let smartSuggestHtml = '';\n\n    if (ruleType === 'required') {\n      // \n      const examples = getColumnExamples(error.tableName, error.columnName, error.rowIndex, rawData, 5);\n      if (examples.length > 0) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            <div class=\"acu-smart-fix-suggest-label\">\n              <i class=\"fa-solid fa-lightbulb\"></i> :\n            </div>\n            <div class=\"acu-smart-fix-suggest-options\">\n              ${examples\n                .map(\n                  val => `\n                <span class=\"acu-smart-fix-option\" data-value=\"${escapeHtml(val)}\" title=\"\">\n                  ${escapeHtml(val.length > 20 ? val.substring(0, 20) + '...' : val)}\n                </span>\n              `,\n                )\n                .join('')}\n            </div>\n          </div>\n        `;\n      }\n    } else if (ruleType === 'enum' && rule.config?.values) {\n      // \n      const validValues = rule.config.values;\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-list\"></i>  ():\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\">\n            ${validValues\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        </div>\n      `;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      // \n      // \n      let tableContent = null;\n      if (rawData && error.tableName) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            tableContent = rawData[sheetId];\n            break;\n          }\n        }\n      }\n      const suggestedValue = suggestFormatValue(rule.config.pattern, error.rowIndex, [], tableContent);\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-font\"></i> : <code>${escapeHtml(rule.config.pattern)}</code>\n          </div>\n          ${\n            suggestedValue\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:4px;display:block;\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </span>\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(suggestedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> ${escapeHtml(suggestedValue)}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'numeric') {\n      // \n      const min = rule.config?.min;\n      const max = rule.config?.max;\n      const currentNum = parseFloat(error.currentValue);\n      const isOutOfRange =\n        !isNaN(currentNum) && ((min !== undefined && currentNum < min) || (max !== undefined && currentNum > max));\n      const nearestValid = isOutOfRange ? getNearestValidNumber(error.currentValue, min, max) : null;\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-hashtag\"></i> : ${min !== undefined ? min : '-'} ~ ${max !== undefined ? max : '+'}\n          </div>\n          ${\n            isOutOfRange && nearestValid !== null\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${nearestValid}\">\n                <i class=\"fa-solid fa-arrow-right\"></i>  ${nearestValid}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      // \n      const options = getRelationOptions(rule.config.refTable, rule.config.refColumn, rawData);\n      const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n      const hasMultipleColumns = refColumns.length > 1;\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      const valueExists = isValueInRelationTable(\n        currentInvalidValue,\n        rule.config.refTable,\n        rule.config.refColumn,\n        rawData,\n      );\n\n      // HTML\n      let optionsHtml = '';\n      if (options.length > 0) {\n        optionsHtml = `\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-link\"></i>  \"${escapeHtml(rule.config.refTable)}\"  (${options.length}):\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\" id=\"smart-fix-options-container\">\n            ${options\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      // \n      let reverseWriteHtml = '';\n      if (currentInvalidValue && !valueExists) {\n        if (hasMultipleColumns) {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <select id=\"smart-fix-reverse-column\" class=\"acu-edit-select\" style=\"width:100%;margin-bottom:8px;\">\n                  ${refColumns.map(col => `<option value=\"${escapeHtml(col)}\">${escapeHtml(col)}</option>`).join('')}\n                </select>\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}\"\n                </button>\n              </div>\n            </div>\n          `;\n        } else {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" data-column=\"${escapeHtml(refColumns[0])}\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}.${escapeHtml(refColumns[0])}\"\n                </button>\n              </div>\n            </div>\n          `;\n        }\n      }\n\n      if (optionsHtml || reverseWriteHtml) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            ${optionsHtml}\n            ${reverseWriteHtml}\n          </div>\n        `;\n      }\n    } else if (ruleType === 'keyValue') {\n      // \n      const valueType = rule.config?.valueType || 'text';\n      const valueMin = rule.config?.valueMin;\n      const valueMax = rule.config?.valueMax;\n\n      // \n      let processedValue = String(error.currentValue || '');\n      processedValue = processedValue.replace(//g, ':').replace(//g, ';').replace(//g, ';').replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n      const issues = [];\n      const fixedPairs = [];\n\n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          issues.push({ pair, error: '/' });\n          continue;\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) {\n          issues.push({ pair, error: '' });\n          continue;\n        }\n\n        let fixedVal = val;\n        let hasIssue = false;\n\n        if (valueType === 'numeric') {\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) {\n            issues.push({ pair, error: `\"${val}\" ` });\n            hasIssue = true;\n          } else {\n            if (valueMin !== undefined && valueMin !== null && numVal < valueMin) {\n              fixedVal = String(valueMin);\n              issues.push({ pair, error: ` ${numVal}  ${valueMin}` });\n              hasIssue = true;\n            } else if (valueMax !== undefined && valueMax !== null && numVal > valueMax) {\n              fixedVal = String(valueMax);\n              issues.push({ pair, error: ` ${numVal}  ${valueMax}` });\n              hasIssue = true;\n            }\n          }\n        }\n\n        fixedPairs.push({ key, val: fixedVal, originalVal: val, hasIssue });\n      }\n\n      // \n      const fixedValue = fixedPairs.map(p => `${p.key}:${p.val}`).join(';');\n      const hasIssues = issues.length > 0 || fixedPairs.some(p => p.hasIssue);\n\n      let issuesHtml = '';\n      if (hasIssues) {\n        issuesHtml = `\n          <div class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:8px;\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i> :\n          </div>\n          <div style=\"margin-bottom:8px;\">\n            ${issues\n              .map(\n                issue => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(issue.pair)} - ${escapeHtml(issue.error)}\n              </div>\n            `,\n              )\n              .join('')}\n            ${fixedPairs\n              .filter(p => p.hasIssue)\n              .map(\n                p => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(p.key)}:${escapeHtml(p.originalVal)}  ${escapeHtml(p.val)}\n              </div>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-key\"></i> : :;:\n          </div>\n          ${\n            valueType === 'numeric'\n              ? `\n            <div class=\"acu-smart-fix-suggest-label\" style=\"margin-top:8px;\">\n              <i class=\"fa-solid fa-hashtag\"></i> : ${valueMin !== undefined ? valueMin : '-'} ~ ${valueMax !== undefined ? valueMax : '+'}\n            </div>\n          `\n              : ''\n          }\n          ${issuesHtml}\n          ${\n            hasIssues\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(fixedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> \n              </span>\n            </div>\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-card-bg);border-radius:4px;font-size:11px;color:var(--acu-text-sub);\">\n              <div style=\"margin-bottom:4px;\"><strong>:</strong></div>\n              <code style=\"color:var(--acu-success-text);\">${escapeHtml(fixedValue)}</code>\n            </div>\n          `\n              : `\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-success-bg);border-radius:4px;font-size:11px;color:var(--acu-success-text);\">\n              <i class=\"fa-solid fa-check-circle\"></i> \n            </div>\n          `\n          }\n        </div>\n      `;\n    }\n\n    // HTML\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} - ${escapeHtml(error.columnName || '')}</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            <!--  -->\n            <div class=\"acu-smart-fix-rule-info\">\n              <div class=\"acu-smart-fix-rule-header\">\n                <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                <span>${escapeHtml(error.ruleName || rule.name || '')}</span>\n              </div>\n              <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || typeInfo.desc || '')}</div>\n            </div>\n\n            <!--  -->\n            ${\n              hasSnapshotValue\n                ? `\n              <div class=\"acu-diff-section acu-diff-old-section\">\n                <div class=\"acu-diff-label\">\n                  <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                </div>\n                <div class=\"acu-diff-readonly\">${escapeHtml(snapshotValue)}</div>\n              </div>\n              <div class=\"acu-diff-arrow-down\"><i class=\"fa-solid fa-arrow-down\"></i></div>\n            `\n                : ''\n            }\n\n            <!--  -->\n            <div class=\"acu-diff-section acu-diff-new-section\">\n              ${\n                error.rowTitle && error.rowIndex >= 0\n                  ? `<div style=\"font-size:12px;color:var(--acu-text-sub);margin-bottom:8px;padding:4px 8px;background:var(--acu-bg-sub);border-radius:4px;\">\n                <i class=\"fa-solid fa-tag\" style=\"margin-right:4px;\"></i>${escapeHtml(error.rowTitle)}\n              </div>`\n                  : ''\n              }\n              <div class=\"acu-diff-label\">\n                <i class=\"fa-solid fa-pen\"></i> \n              </div>\n              ${inputHtml}\n            </div>\n\n            <!--  -->\n            ${\n              smartSuggestHtml\n                ? `\n              <div class=\"acu-smart-fix-suggest-section\">\n                ${smartSuggestHtml}\n              </div>\n            `\n                : ''\n            }\n          </div>\n          <div class=\"acu-dialog-btns\">\n            <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n            ${hasSnapshotValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n            <button class=\"acu-dialog-btn acu-btn-clear\" id=\"smart-fix-clear\"><i class=\"fa-solid fa-eraser\"></i> </button>\n            <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    dialog.on('click', '.acu-smart-fix-option, .acu-smart-fix-quick-btn', function () {\n      // \n      if ($(this).attr('id') === 'smart-fix-reverse-write-btn') return;\n      if ($(this).hasClass('acu-smart-fix-option-current')) return;\n      const optionValue = $(this).data('value') || $(this).text().trim();\n      dialog.find('#smart-fix-value').val(optionValue).trigger('input');\n    });\n\n    // \n    dialog.on('click', '#smart-fix-reverse-write-btn', async function () {\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      if (!currentInvalidValue) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      let targetColumn;\n      if (ruleType === 'relation' && rule.config?.refColumn) {\n        const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n        if (refColumns.length > 1) {\n          // \n          targetColumn = dialog.find('#smart-fix-reverse-column').val();\n        } else {\n          // data\n          targetColumn = $(this).data('column') || refColumns[0];\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      if (!targetColumn || !rule.config?.refTable) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      try {\n        const rawData = cachedRawData || getTableData();\n        let refSheet = null;\n        let refSheetId = null;\n\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === rule.config.refTable) {\n            refSheet = rawData[sheetId];\n            refSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!refSheet || !refSheet.content) {\n          if (window.toastr) window.toastr.error(` \"${rule.config.refTable}\"`);\n          return;\n        }\n\n        const headers = refSheet.content[0] || [];\n        const targetColIdx = headers.indexOf(targetColumn);\n\n        if (targetColIdx === -1) {\n          if (window.toastr) window.toastr.error(` \"${targetColumn}\"`);\n          return;\n        }\n\n        // \n        const newRow = new Array(headers.length).fill('');\n        newRow[targetColIdx] = currentInvalidValue;\n\n        // \n        refSheet.content.push(newRow);\n\n        // \n        await saveDataToDatabase(rawData, false, false);\n\n        // \n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-revert', function () {\n      dialog.find('#smart-fix-value').val(snapshotValue);\n    });\n\n    // \n    dialog.on('click', '#smart-fix-clear', function () {\n      dialog.find('#smart-fix-value').val('').trigger('input');\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-close, #smart-fix-cancel', closeDialog);\n    setupOverlayClose(dialog, 'acu-validation-modal-overlay', closeDialog);\n\n    // \n    dialog.find('#smart-fix-confirm').on('click', async function () {\n      const newValue = dialog.find('#smart-fix-value').val()?.trim() || '';\n\n      if (newValue === '' && ruleType === 'required') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      try {\n        const rawData = cachedRawData || getTableData();\n        let updated = false;\n\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            const sheet = rawData[sheetId];\n            const headers = sheet.content?.[0] || [];\n\n            if (error.rowIndex >= 0 && error.columnName) {\n              const colIdx = headers.indexOf(error.columnName);\n              const rowIdx = error.rowIndex + 1;\n\n              if (colIdx >= 0 && sheet.content && sheet.content[rowIdx]) {\n                sheet.content[rowIdx][colIdx] = newValue;\n                updated = true;\n                break;\n              }\n            }\n          }\n        }\n\n        if (updated) {\n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function extractCodesFromTable(sheet, columnName, prefix) {\n    if (!sheet || !sheet.content || sheet.content.length < 2) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const headers = sheet.content[0] || [];\n    const rows = sheet.content.slice(1) || [];\n    const colIndex = headers.indexOf(columnName);\n\n    if (colIndex < 0) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const codes = new Map(); // Map<, >\n    const allCodes = new Set(); // Set<>\n    const codeToRows = new Map(); // Map<, >\n\n    for (let i = 0; i < rows.length; i++) {\n      const value = rows[i]?.[colIndex];\n      if (value === null || value === undefined || value === '') continue;\n\n      const strValue = String(value).trim();\n      if (!strValue) continue;\n\n      // \n      let isValid = false;\n      if (prefix) {\n        const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          isValid = true;\n        }\n      } else {\n        const num = parseInt(strValue, 10);\n        if (!isNaN(num)) {\n          isValid = true;\n        }\n      }\n\n      if (isValid) {\n        allCodes.add(strValue);\n        if (!codeToRows.has(strValue)) {\n          codeToRows.set(strValue, []);\n        }\n        codeToRows.get(strValue).push(i);\n      }\n    }\n\n    return { codes, allCodes, codeToRows };\n  }\n\n  //   \n  function buildCodeMapping(codes1, codes2, prefix, startFrom) {\n    // \n    const allUniqueCodes = new Set([...codes1, ...codes2]);\n\n    // \n    const codeNumbers = [];\n    for (const code of allUniqueCodes) {\n      let num = null;\n      if (prefix) {\n        const match = code.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          num = parseInt(match[1], 10);\n        }\n      } else {\n        num = parseInt(code, 10);\n      }\n\n      if (!isNaN(num)) {\n        codeNumbers.push({ code, num });\n      }\n    }\n\n    // \n    codeNumbers.sort((a, b) => a.num - b.num);\n\n    //   \n    const mapping = new Map();\n    for (let i = 0; i < codeNumbers.length; i++) {\n      const oldCode = codeNumbers[i].code;\n      const newNum = startFrom + i;\n      const newCode = prefix + String(newNum).padStart(4, '0');\n      mapping.set(oldCode, newCode);\n    }\n\n    return mapping;\n  }\n\n  // \n  // \n  // 1. \n  // 2. \n  // 3. \n  function alignAndFixPairedTables(\n    table1Sheet,\n    table1SheetId,\n    table2Sheet,\n    table2SheetId,\n    columnName,\n    mapping,\n    prefix,\n    startFrom,\n    rawData,\n  ) {\n    if (!table1Sheet || !table2Sheet) return { fixedCount1: 0, fixedCount2: 0 };\n\n    const headers1 = table1Sheet.content[0] || [];\n    const rows1 = table1Sheet.content.slice(1) || [];\n    const colIndex1 = headers1.indexOf(columnName);\n\n    const headers2 = table2Sheet.content[0] || [];\n    const rows2 = table2Sheet.content.slice(1) || [];\n    const colIndex2 = headers2.indexOf(columnName);\n\n    if (colIndex1 < 0 || colIndex2 < 0) return { fixedCount1: 0, fixedCount2: 0 };\n\n    let fixedCount1 = 0;\n    let fixedCount2 = 0;\n\n    //  -> \n    const reverseMapping = new Map();\n    for (const [oldCode, newCode] of mapping.entries()) {\n      reverseMapping.set(newCode, oldCode);\n    }\n\n    // \n    const sortedNewCodes = Array.from(mapping.values()).sort((a, b) => {\n      const numA = parseInt(a.replace(prefix, ''), 10);\n      const numB = parseInt(b.replace(prefix, ''), 10);\n      return numA - numB;\n    });\n\n    // \n    const analyzeTable = (rows, colIndex) => {\n      const codeRows = []; // {rowIndex, oldCode, row}\n      const emptyRows = []; // {rowIndex, row, prevOldCode, nextOldCode}\n\n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        const strValue = value === null || value === undefined ? '' : String(value).trim();\n\n        // \n        let isValid = false;\n        if (strValue && prefix) {\n          const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          if (match) isValid = true;\n        } else if (strValue) {\n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) isValid = true;\n        }\n\n        if (isValid) {\n          codeRows.push({ rowIndex: i, oldCode: strValue, row: rows[i] });\n        } else {\n          emptyRows.push({ rowIndex: i, row: rows[i], prevOldCode: null, nextOldCode: null });\n        }\n      }\n\n      // \n      for (const emptyRow of emptyRows) {\n        let prevCode = null;\n        let nextCode = null;\n\n        for (const codeRow of codeRows) {\n          if (codeRow.rowIndex < emptyRow.rowIndex) {\n            prevCode = codeRow.oldCode;\n          }\n          if (codeRow.rowIndex > emptyRow.rowIndex && nextCode === null) {\n            nextCode = codeRow.oldCode;\n            break;\n          }\n        }\n\n        emptyRow.prevOldCode = prevCode;\n        emptyRow.nextOldCode = nextCode;\n      }\n\n      return { codeRows, emptyRows };\n    };\n\n    const analysis1 = analyzeTable(rows1, colIndex1);\n    const analysis2 = analyzeTable(rows2, colIndex2);\n\n    // \n    const buildNewRows = (analysis, headers, colIndex, allOldCodes) => {\n      const newRows = [];\n      const codeRowMap = new Map(); // oldCode -> row data\n\n      // \n      for (const cr of analysis.codeRows) {\n        codeRowMap.set(cr.oldCode, cr.row);\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n\n        if (codeRowMap.has(oldCode)) {\n          // \n          const oldRow = codeRowMap.get(oldCode);\n          const newRow = oldRow.map(cell => cell);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true });\n        } else {\n          // \n          const newRow = new Array(headers.length).fill(null);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true, isInserted: true });\n        }\n      }\n\n      // \n      //  prevOldCode  nextOldCode \n      const result = [];\n      let codeRowIndex = 0;\n\n      // \n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode === null && emptyRow.nextOldCode !== null) {\n          // \n          const nextNewCode = mapping.get(emptyRow.nextOldCode);\n          // \n          while (codeRowIndex < newRows.length && newRows[codeRowIndex].newCode !== nextNewCode) {\n            result.push(newRows[codeRowIndex].row);\n            codeRowIndex++;\n          }\n          result.push(emptyRow.row);\n        } else if (emptyRow.prevOldCode === null && emptyRow.nextOldCode === null) {\n          // \n          result.push(emptyRow.row);\n        }\n      }\n\n      // \n      for (; codeRowIndex < newRows.length; codeRowIndex++) {\n        result.push(newRows[codeRowIndex].row);\n        const currentNewCode = newRows[codeRowIndex].newCode;\n        const currentOldCode = reverseMapping.get(currentNewCode);\n\n        // \n        for (const emptyRow of analysis.emptyRows) {\n          if (emptyRow.prevOldCode === currentOldCode) {\n            result.push(emptyRow.row);\n          }\n        }\n      }\n\n      // prevOldCode nextOldCode  null\n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode !== null && emptyRow.nextOldCode === null) {\n          // \n        }\n      }\n\n      return result;\n    };\n\n    // \n    const newRows1 = buildNewRows(analysis1, headers1, colIndex1, new Set(analysis1.codeRows.map(r => r.oldCode)));\n    const newRows2 = buildNewRows(analysis2, headers2, colIndex2, new Set(analysis2.codeRows.map(r => r.oldCode)));\n\n    // \n    const countCodeChanges = (oldAnalysis, newRows, colIndex) => {\n      let count = 0;\n      // \n      const oldCodes = new Set(oldAnalysis.codeRows.map(r => r.oldCode));\n      const newCodes = new Set();\n\n      for (const row of newRows) {\n        const code = row[colIndex];\n        if (code) newCodes.add(code);\n      }\n\n      // \n      for (const [oldCode, newCode] of mapping.entries()) {\n        if (oldCodes.has(oldCode) && oldCode !== newCode) {\n          count++; // \n        }\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n        if (!oldCodes.has(oldCode)) {\n          count++; // \n        }\n      }\n\n      return count;\n    };\n\n    fixedCount1 = countCodeChanges(analysis1, newRows1, colIndex1);\n    fixedCount2 = countCodeChanges(analysis2, newRows2, colIndex2);\n\n    // \n    table1Sheet.content = [headers1, ...newRows1];\n    table2Sheet.content = [headers2, ...newRows2];\n\n    return { fixedCount1, fixedCount2 };\n  }\n\n  // \n  // ========================================\n  const showTableRuleFixModal = (error, rule, ruleType, rawData, snapshot, currentThemeClass) => {\n    const { $ } = getCore();\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n\n    let contentHtml = '';\n    let actionBtns = '';\n\n    if (ruleType === 'tableReadonly') {\n      // \n      let changeCount = 0;\n      let changeDetails = [];\n\n      if (snapshot && rawData) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            const newRows = rawData[sheetId].content?.slice(1) || [];\n            const oldRows = snapshot[sheetId].content?.slice(1) || [];\n\n            // \n            newRows.forEach((row, idx) => {\n              const oldRow = oldRows[idx];\n              if (!oldRow) {\n                changeDetails.push(`${idx + 1}: `);\n                changeCount++;\n              } else {\n                for (let c = 0; c < row.length; c++) {\n                  if (String(row[c] || '') !== String(oldRow[c] || '')) {\n                    changeDetails.push(`${idx + 1}: `);\n                    changeCount++;\n                    break;\n                  }\n                }\n              }\n            });\n\n            // \n            if (oldRows.length > newRows.length) {\n              for (let i = newRows.length; i < oldRows.length; i++) {\n                changeDetails.push(`${i + 1}: `);\n                changeCount++;\n              }\n            }\n            break;\n          }\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-lock\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\"></div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${changeCount}</strong> \n          </div>\n          ${\n            changeDetails.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\">\n              ${changeDetails\n                .slice(0, 10)\n                .map(d => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(d)}</div>`)\n                .join('')}\n              ${changeDetails.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${changeDetails.length - 10} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n      actionBtns = `\n        <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n        <button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-restore-table\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n      `;\n    } else if (ruleType === 'rowLimit') {\n      // \n      const minRows = rule.config?.min;\n      const maxRows = rule.config?.max;\n      let currentRowCount = 0;\n      let excessRows = [];\n\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          currentRowCount = (rawData[sheetId].content?.length || 1) - 1; // \n          break;\n        }\n      }\n\n      const isTooMany = maxRows !== undefined && currentRowCount > maxRows;\n      const isTooFew = minRows !== undefined && currentRowCount < minRows;\n\n      if (isTooMany) {\n        for (let i = maxRows + 1; i <= currentRowCount; i++) {\n          excessRows.push(i);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-arrows-up-down\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            : <strong>${currentRowCount}</strong> \n            ${minRows !== undefined || maxRows !== undefined ? ` | : ${minRows !== undefined ? minRows : 0} ~ ${maxRows !== undefined ? maxRows : ''} ` : ''}\n          </div>\n          ${\n            isTooMany && excessRows.length > 0\n              ? `\n            <div class=\"acu-smart-fix-excess-rows\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-trash\"></i>  ( ${excessRows[0]} ):\n              </div>\n              <div class=\"acu-smart-fix-change-list\">\n                ${excessRows\n                  .slice(0, 10)\n                  .map(r => `<div class=\"acu-smart-fix-change-item\"> ${r} </div>`)\n                  .join('')}\n                ${excessRows.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${excessRows.length} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n          ${\n            isTooFew\n              ? `\n            <div class=\"acu-smart-fix-hint\">\n              <i class=\"fa-solid fa-info-circle\"></i>  ${minRows - currentRowCount} \n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (isTooMany && excessRows.length > 0) {\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-delete-rows\" data-start=\"${maxRows}\" data-table=\"${escapeHtml(error.tableName)}\">\n            <i class=\"fa-solid fa-trash\"></i>  ${excessRows.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    } else if (ruleType === 'sequence' && rule.targetColumn) {\n      // \n      const prefix = rule.config?.prefix || '';\n      const startFrom = rule.config?.startFrom !== undefined ? rule.config?.startFrom : 1;\n      let targetSheet = null;\n      let issues = [];\n      let fixSuggestions = [];\n\n      // \n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (targetSheet && targetSheet.content && targetSheet.content.length > 1) {\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = ValidationEngine.findColumnIndex(headers, rule.targetColumn);\n\n        if (colIndex >= 0) {\n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num, originalRowIndex: i + 2 }); // +2 +1\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          const numCountMap = new Map(); // \n          const duplicates = [];\n          const gaps = [];\n          const outOfOrder = [];\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const actualNum = numbers[i].num;\n            if (!numCountMap.has(actualNum)) {\n              numCountMap.set(actualNum, []);\n            }\n            numCountMap.get(actualNum).push(i);\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n\n            // \n            const occurrences = numCountMap.get(actualNum) || [];\n            if (occurrences.length > 1) {\n              // \n              if (occurrences[0] === i) {\n                duplicates.push({\n                  rowNum,\n                  value: numbers[i].value,\n                  num: actualNum,\n                  expectedNum,\n                  count: occurrences.length,\n                });\n              }\n            }\n\n            // \n            if (actualNum !== expectedNum) {\n              if (actualNum < expectedNum) {\n                // \n                outOfOrder.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              } else {\n                // \n                gaps.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              }\n            }\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n            const currentValue = numbers[i].value;\n            const fixedValue = prefix + String(expectedNum).padStart(4, '0');\n\n            if (actualNum !== expectedNum || duplicates.some(d => d.num === actualNum && d.rowNum === rowNum)) {\n              fixSuggestions.push({\n                rowNum,\n                currentValue,\n                fixedValue,\n                reason: actualNum < expectedNum ? '' : actualNum > expectedNum ? '' : '',\n              });\n            }\n          }\n\n          // \n          const issueSet = new Set();\n          duplicates.forEach(d => {\n            issueSet.add(`${d.rowNum}: \"${d.value}\"  (${d.count})`);\n          });\n          gaps.forEach(g => {\n            issueSet.add(\n              `${g.rowNum}: \"${g.value}\"  \"${prefix}${String(g.expectedNum).padStart(4, '0')}\" ()`,\n            );\n          });\n          outOfOrder.forEach(o => {\n            issueSet.add(\n              `${o.rowNum}: \"${o.value}\"  \"${prefix}${String(o.expectedNum).padStart(4, '0')}\" ()`,\n            );\n          });\n          issues = Array.from(issueSet);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-sort-numeric-up\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${issues.length}</strong> \n          </div>\n          ${\n            issues.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n              ${issues\n                .slice(0, 20)\n                .map(issue => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(issue)}</div>`)\n                .join('')}\n              ${issues.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${issues.length - 20} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n          ${\n            fixSuggestions.length > 0\n              ? `\n            <div class=\"acu-smart-fix-suggest\" style=\"margin-top:12px;\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </div>\n              <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n                ${fixSuggestions\n                  .slice(0, 20)\n                  .map(\n                    fix => `\n                  <div class=\"acu-smart-fix-change-item\">\n                    <span style=\"color:var(--acu-text-sub);\">${fix.rowNum}:</span>\n                    <span style=\"color:var(--acu-hl-manual);\">${escapeHtml(fix.currentValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);\">  </span>\n                    <span style=\"color:var(--acu-hl-auto);\">${escapeHtml(fix.fixedValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);font-size:11px;\"> (${escapeHtml(fix.reason)})</span>\n                  </div>\n                `,\n                  )\n                  .join('')}\n                ${fixSuggestions.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${fixSuggestions.length - 20} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (fixSuggestions.length > 0) {\n        // \n        const pairedTable =\n          rule.config?.pairedTable ||\n          (error.tableName === '' ? '' : error.tableName === '' ? '' : null);\n        const pairedTableAttr = pairedTable ? `data-paired-table=\"${escapeHtml(pairedTable)}\"` : '';\n\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-fix-sequence\" data-table=\"${escapeHtml(error.tableName)}\" data-column=\"${escapeHtml(rule.targetColumn)}\" data-prefix=\"${escapeHtml(prefix)}\" data-start=\"${startFrom}\" ${pairedTableAttr}>\n            <i class=\"fa-solid fa-magic\"></i>  ${fixSuggestions.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    }\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} ()</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            ${contentHtml}\n          </div>\n          <div class=\"acu-dialog-btns\">\n            ${actionBtns}\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-cancel', closeDialog);\n    setupOverlayClose(dialog, 'acu-validation-modal-overlay', closeDialog);\n\n    // \n    dialog.on('click', '#smart-fix-restore-table', async function () {\n      if (!snapshot) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      try {\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            rawData[sheetId] = JSON.parse(JSON.stringify(snapshot[sheetId]));\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-fix-sequence', async function () {\n      const $btn = $(this);\n      const tableName = $btn.data('table');\n      const columnName = $btn.data('column');\n      const prefix = $btn.data('prefix') || '';\n      const startFrom = parseInt($btn.data('start') || '1', 10);\n      const pairedTableName = $btn.data('paired-table') || null;\n\n      try {\n        $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n\n        // \n        let targetSheet = null;\n        let targetSheetId = null;\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            targetSheet = rawData[sheetId];\n            targetSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = headers.indexOf(columnName);\n\n        if (colIndex < 0) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        // \n        if (pairedTableName) {\n          // \n          let pairedSheet = null;\n          let pairedSheetId = null;\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === pairedTableName) {\n              pairedSheet = rawData[sheetId];\n              pairedSheetId = sheetId;\n              break;\n            }\n          }\n\n          if (!pairedSheet || !pairedSheet.content || pairedSheet.content.length < 1) {\n            if (window.toastr) window.toastr.warning(`: ${pairedTableName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          const pairedHeaders = pairedSheet.content[0] || [];\n          const pairedColIndex = pairedHeaders.indexOf(columnName);\n\n          if (pairedColIndex < 0) {\n            if (window.toastr) window.toastr.warning(`: ${columnName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          // \n          const extract1 = extractCodesFromTable(targetSheet, columnName, prefix);\n          const extract2 = extractCodesFromTable(pairedSheet, columnName, prefix);\n\n          // \n          const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n          // \n          const { fixedCount1, fixedCount2 } = alignAndFixPairedTables(\n            targetSheet,\n            targetSheetId,\n            pairedSheet,\n            pairedSheetId,\n            columnName,\n            mapping,\n            prefix,\n            startFrom,\n            rawData,\n          );\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          // \n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num });\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          let fixedCount = 0;\n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowIndex = numbers[i].rowIndex;\n\n            if (actualNum !== expectedNum) {\n              const fixedValue = prefix + String(expectedNum).padStart(4, '0');\n              rows[rowIndex][colIndex] = fixedValue;\n              fixedCount++;\n            }\n          }\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n        $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-delete-rows', async function () {\n      const startRow = parseInt($(this).data('start'), 10);\n      const tableName = $(this).data('table');\n\n      try {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            // (index 0) startRow (index 1  startRow)\n            rawData[sheetId].content = rawData[sheetId].content.slice(0, startRow + 1);\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const showBlacklistManagerModal = () => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    $('.acu-blacklist-manager-overlay').remove();\n\n    const blacklist = BlacklistManager.getBlacklist();\n\n    const modalHtml = `\n      <div class=\"acu-blacklist-manager-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width: 600px; width: 90%;\">\n          <div class=\"acu-edit-title\" style=\"position: relative;\">\n            <i class=\"fa-solid fa-filter\"></i> \n            <button class=\"acu-close-btn\" style=\"position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--acu-text-main); cursor: pointer; font-size: 18px; z-index: 10;\">\n              <i class=\"fa-solid fa-times\"></i>\n            </button>\n          </div>\n          <div class=\"acu-settings-content\" style=\"flex: 1; overflow-y: auto; padding: 20px;\">\n            <div style=\"margin-bottom: 15px;\">\n              <div style=\"margin-bottom: 8px; font-size: 12px; color: var(--acu-text-sub);\">\n                \n              </div>\n              <textarea id=\"blacklist-textarea\" style=\"width: 100%; min-height: 120px; max-height: 300px; padding: 10px !important; border: 1px solid var(--acu-border) !important; border-radius: 4px !important; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; font-size: 13px !important; box-sizing: border-box !important; resize: vertical; font-family: monospace; line-height: 1.5;\" placeholder=\"\"></textarea>\n              <div style=\"display: flex; gap: 8px; margin-top: 8px; flex-wrap: nowrap;\">\n                <input type=\"text\" id=\"blacklist-input\" placeholder=\"...\" style=\"flex: 1; min-width: 0; padding: 8px !important; border: 1px solid var(--acu-border) !important; border-radius: 4px !important; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; font-size: 13px !important; box-sizing: border-box !important;\">\n                <button id=\"blacklist-add-btn\" style=\"padding: 8px 16px; background: var(--acu-accent); color: var(--acu-btn-active-text); border: none; border-radius: 4px; cursor: pointer; font-size: 13px; white-space: nowrap; flex-shrink: 0;\">\n                  <i class=\"fa-solid fa-plus\"></i> \n                </button>\n              </div>\n            </div>\n            <div style=\"display: flex; gap: 8px; margin-top: 15px;\">\n              <button id=\"blacklist-reset-btn\" style=\"flex: 1; padding: 10px; background: var(--acu-btn-bg); color: var(--acu-text-main); border: 1px solid var(--acu-text-sub); border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-undo\"></i> \n              </button>\n              <button id=\"blacklist-close-btn\" style=\"flex: 1; padding: 10px; background: var(--acu-accent); color: var(--acu-btn-active-text); border: none; border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-check\"></i> \n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '31300',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    // textarea\n    const updateTextarea = () => {\n      const blacklist = BlacklistManager.getBlacklist();\n      const $textarea = $modal.find('#blacklist-textarea');\n      $textarea.val(blacklist.join(''));\n    };\n\n    // textareaBlacklistManager\n    const syncFromTextarea = () => {\n      const $textarea = $modal.find('#blacklist-textarea');\n      const text = $textarea.val().trim();\n      if (!text) {\n        BlacklistManager.setBlacklist([]);\n        return;\n      }\n      // \n      const items = text\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n      // \n      const uniqueItems = [...new Set(items)];\n      BlacklistManager.setBlacklist(uniqueItems);\n      // textarea\n      if (uniqueItems.length !== items.length) {\n        updateTextarea();\n      }\n    };\n\n    // textarea\n    updateTextarea();\n\n    // textarea\n    $modal.find('#blacklist-textarea').on('input', function () {\n      syncFromTextarea();\n    });\n\n    // \n    $modal.find('#blacklist-add-btn').click(function () {\n      const input = $modal.find('#blacklist-input');\n      const value = input.val().trim();\n      if (!value) return;\n\n      // \n      const newItems = value\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n\n      if (newItems.length === 0) return;\n\n      const blacklist = BlacklistManager.getBlacklist();\n      const existingSet = new Set(blacklist);\n      const addedItems = [];\n\n      newItems.forEach(item => {\n        if (!existingSet.has(item)) {\n          blacklist.push(item);\n          existingSet.add(item);\n          addedItems.push(item);\n        }\n      });\n\n      if (addedItems.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      BlacklistManager.setBlacklist(blacklist);\n      input.val('');\n      updateTextarea();\n    });\n\n    $modal.find('#blacklist-input').on('keypress', function (e) {\n      if (e.which === 13) {\n        $modal.find('#blacklist-add-btn').click();\n      }\n    });\n\n    $modal.find('#blacklist-reset-btn').click(function () {\n      if (confirm('')) {\n        BlacklistManager.resetToDefault();\n        updateTextarea();\n      }\n    });\n\n    const closeModal = () => {\n      $modal.remove();\n      // \n      renderInterface();\n    };\n\n    $modal.find('#blacklist-close-btn, .acu-close-btn').click(closeModal);\n    setupOverlayClose($modal, 'acu-blacklist-manager-overlay', closeModal);\n  };\n\n  const showAttributePresetManager = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n    pushModal('showAttributePresetManager', showAttributePresetManager);\n\n    const config = getConfig();\n    const presets = AttributePresetManager.getAllPresets();\n    const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n\n    // HTMLactiveIdnull\n    const isDefaultActive = activeId === null;\n    const defaultPresetHtml = `\n      <div class=\"acu-preset-item\" data-id=\"__default__\">\n        <div class=\"acu-preset-info\">\n          <div class=\"acu-preset-name\">\n            \n            <span style=\"font-size: 10px; color: var(--acu-text-sub); margin-left: 6px;\">()</span>\n          </div>\n          <div class=\"acu-preset-desc\">5-95</div>\n          <div class=\"acu-preset-stats\">\n            : 6 | : 0\n          </div>\n        </div>\n<div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n            <label class=\"acu-toggle\" style=\"margin: 0;\">\n              <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"__default__\" ${isDefaultActive ? 'checked' : ''}>\n              <span class=\"acu-toggle-slider\"></span>\n            </label>\n            <button class=\"acu-preset-btn acu-preset-copy\" data-id=\"__default__\" title=\"\"><i class=\"fa-solid fa-copy\"></i></button>\n            <button class=\"acu-preset-btn acu-preset-export\" data-id=\"__default__\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n          </div>\n        </div>\n    `;\n\n    // HTML\n    const presetsHtml = presets\n      .map(preset => {\n        const isActive = preset.id === activeId;\n        const isBuiltin = preset.builtin;\n\n        return `\n        <div class=\"acu-preset-item\" data-id=\"${preset.id}\">\n          <div class=\"acu-preset-info\">\n            <div class=\"acu-preset-name\">\n              ${escapeHtml(preset.name)}\n              ${isBuiltin ? `<span style=\"font-size: 10px; color: var(--acu-text-sub); margin-left: 6px;\">()</span>` : ''}\n            </div>\n            ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n            <div class=\"acu-preset-stats\">\n              : ${preset.baseAttributes.length} | : ${preset.specialAttributes?.length || 0}\n            </div>\n          </div>\n          <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n            <label class=\"acu-toggle\" style=\"margin: 0;\">\n              <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"${preset.id}\" ${isActive ? 'checked' : ''}>\n              <span class=\"acu-toggle-slider\"></span>\n            </label>\n            ${\n              isBuiltin\n                ? `<button class=\"acu-preset-btn acu-preset-copy\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-copy\"></i></button>`\n                : `<button class=\"acu-preset-btn acu-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>`\n            }\n            <button class=\"acu-preset-btn acu-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: var(--acu-error-text);\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n          </div>\n        </div>\n      `;\n      })\n      .join('');\n\n    // \n    const allPresetsHtml = defaultPresetHtml + presetsHtml;\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 80vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid var(--acu-border);\">\n            <div style=\"font-size: 16px; font-weight: bold; color: var(--acu-text-main);\">\n              <i class=\"fa-solid fa-dice-d20\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div id=\"acu-presets-list\">\n              ${allPresetsHtml || `<div style=\"text-align: center; padding: 40px; color: var(--acu-text-sub);\"></div>`}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--acu-border);\">\n            <button id=\"acu-preset-new\" style=\"flex: 1; padding: 10px; background: var(--acu-accent); border: none; border-radius: 6px; color: var(--acu-btn-active-text); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-preset-import\" style=\"flex: 1; padding: 10px; background: var(--acu-btn-bg); border: 1px solid var(--acu-text-sub); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-preset-back\" style=\"padding: 10px 16px; background: var(--acu-btn-bg); border: 1px solid var(--acu-text-sub); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n\n          <input type=\"file\" id=\"acu-preset-file-input\" accept=\".json\" style=\"display: none;\" />\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn, #acu-preset-back').on('click', () => {\n      overlay.remove();\n      popModal();\n    });\n\n    // Toggle\n    overlay.on('change', '.acu-preset-toggle', function () {\n      const $toggle = $(this);\n      const id = $toggle.data('id');\n      const isChecked = $toggle.is(':checked');\n\n      if (isChecked) {\n        // id\"__default__\"null\n        const finalId = id === '__default__' ? null : id;\n        AttributePresetManager.setActivePreset(finalId);\n\n        // toggle\n        overlay.find('.acu-preset-toggle').each(function () {\n          const $thisToggle = $(this);\n          const thisId = $thisToggle.data('id');\n          if (thisId !== id) {\n            $thisToggle.prop('checked', false);\n          }\n        });\n      } else {\n        // null\n        AttributePresetManager.setActivePreset(null);\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showAttributePresetEditor(id);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-export', function () {\n      const id = $(this).data('id');\n\n      let json;\n      let filename;\n\n      if (id === '__default__') {\n        // \n        const STANDARD_ATTRS = ['', '', '', '', '', ''];\n        const defaultPresetData = {\n          format: 'acu_attr_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          id: 'default_percentile',\n          name: '',\n          description: '5-95',\n          baseAttributes: STANDARD_ATTRS.map(name => ({\n            name,\n            formula: '3d6*5',\n            range: [15, 90],\n            modifier: '1d10-5',\n          })),\n          specialAttributes: [],\n        };\n        json = JSON.stringify(defaultPresetData, null, 2);\n        filename = `acu_preset__${Date.now()}.json`;\n      } else {\n        json = AttributePresetManager.exportPreset(id);\n        if (!json) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n        const preset = presets.find(p => p.id === id);\n        filename = `acu_preset_${preset?.name || id}_${Date.now()}.json`;\n      }\n\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        const success = AttributePresetManager.deletePreset(id);\n        if (success) {\n          overlay.remove();\n          showAttributePresetManager();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-preset-copy', function () {\n      const id = $(this).data('id');\n\n      let copyData;\n      if (id === '__default__') {\n        // \n        // formula + range + modifier\n        const STANDARD_ATTRS = ['', '', '', '', '', ''];\n        copyData = {\n          name: ' ()',\n          description: '5-95',\n          baseAttributes: STANDARD_ATTRS.map(name => ({\n            name,\n            formula: '3d6*5',\n            range: [15, 90],\n            modifier: '1d10-5',\n          })),\n          specialAttributes: [],\n        };\n      } else {\n        // \n        const preset = presets.find(p => p.id === id);\n        if (!preset) return;\n\n        copyData = {\n          name: preset.name + ' ()',\n          description: preset.description || '',\n          baseAttributes: JSON.parse(JSON.stringify(preset.baseAttributes)),\n          specialAttributes: JSON.parse(JSON.stringify(preset.specialAttributes || [])),\n        };\n      }\n\n      const newPreset = AttributePresetManager.createPreset(copyData);\n      if (newPreset) {\n        if (window.toastr) window.toastr.success(`${newPreset.name}`);\n        overlay.remove();\n        showAttributePresetManager(); // \n      }\n    });\n\n    // \n    overlay.find('#acu-preset-new').on('click', () => {\n      overlay.remove();\n      showAttributePresetEditor();\n    });\n\n    // \n    overlay.find('#acu-preset-import').on('click', () => {\n      overlay.find('#acu-preset-file-input').click();\n    });\n\n    overlay.find('#acu-preset-file-input').on('change', function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      const reader = new FileReader();\n      reader.onload = evt => {\n        try {\n          const jsonStr = evt.target.result as string;\n          if (!jsonStr?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(jsonStr.trim());\n          } catch {\n            if (window.toastr) window.toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.name || '';\n          const existingPresets = AttributePresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = jsonStr.trim();\n            if (newName) {\n              parsedData.name = newName;\n              // IDID\n              parsedData.id = `attr_preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset && !existingPreset.builtin) {\n                AttributePresetManager.deletePreset(existingPreset.id);\n              }\n            }\n\n            const imported = AttributePresetManager.importPreset(finalJson);\n            if (imported) {\n              overlay.remove();\n              showAttributePresetManager();\n            } else {\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      };\n      reader.readAsText(file);\n\n      // \n      $(this).val('');\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      popModal();\n    });\n  };\n\n  // \n  const showAttributePresetEditor = (presetId = null) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n    pushModal('showAttributePresetEditor', () => showAttributePresetEditor(presetId));\n\n    const config = getConfig();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? AttributePresetManager.getAllPresets().find(p => p.id === presetId) : null;\n\n    // \n    const defaultData = {\n      name: existingPreset?.name || '',\n      description: existingPreset?.description || '',\n      baseAttributes: existingPreset?.baseAttributes || [\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n      ],\n      specialAttributes: existingPreset?.specialAttributes || [],\n    };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 650px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid var(--acu-border);\">\n            <div style=\"font-size: 16px; font-weight: bold; color: var(--acu-text-main);\">\n              <i class=\"fa-solid fa-pen\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 4px;\"></label>\n              <input id=\"preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 4px;\"></label>\n              <input id=\"preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 8px;\">\n                JSON <span style=\"font-size: 10px; color: var(--acu-text-sub);\">()</span>\n              </label>\n              <textarea id=\"preset-json\" class=\"acu-preset-editor-textarea\" style=\"width: 100%; height: 320px; padding: 10px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; font-family: 'Consolas', 'Monaco', monospace !important; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: var(--acu-text-sub); padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n               baseAttributes:  nameformularangemodifier()<br/>\n               specialAttributes:  nameformularange()<br/>\n               : 3d6, 4d6kh3, (/2), (+-*/)\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--acu-border);\">\n            <button id=\"preset-save\" style=\"flex: 1; padding: 10px; background: var(--acu-accent); border: none; border-radius: 6px; color: var(--acu-btn-active-text); cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"preset-cancel\" style=\"padding: 10px 16px; background: var(--acu-btn-bg); border: 1px solid var(--acu-text-sub); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#preset-json');\n\n    // JSON\n    const updateJSON = () => {\n      const data = {\n        baseAttributes: defaultData.baseAttributes,\n        specialAttributes: defaultData.specialAttributes,\n      };\n      $jsonTextarea.val(JSON.stringify(data, null, 2));\n    };\n    updateJSON();\n\n    // \n    overlay.find('.acu-close-btn, #preset-cancel').on('click', () => {\n      overlay.remove();\n      popModal();\n    });\n\n    // \n    overlay.find('#preset-save').on('click', () => {\n      try {\n        const name = overlay.find('#preset-name').val().trim();\n        const description = overlay.find('#preset-desc').val().trim();\n        const jsonStr = $jsonTextarea.val().trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const jsonData = JSON.parse(jsonStr);\n\n        // \n        if (\n          !jsonData.baseAttributes ||\n          !Array.isArray(jsonData.baseAttributes) ||\n          jsonData.baseAttributes.length === 0\n        ) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n\n        // \n        const preset = {\n          format: 'acu_attr_preset_v1',\n          version: 1,\n          id: presetId || `custom_${Date.now()}`,\n          name,\n          description,\n          baseAttributes: jsonData.baseAttributes,\n          specialAttributes: jsonData.specialAttributes || [],\n        };\n\n        // \n        if (isEdit) {\n          AttributePresetManager.updatePreset(presetId, preset);\n        } else {\n          AttributePresetManager.createPreset(preset);\n        }\n\n        overlay.remove();\n        popModal();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + (err.message || 'JSON'));\n      }\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      popModal();\n    });\n  };\n\n  // ========================================\n  // UI\n  // ========================================\n  type SortableListOptions = {\n    container: JQuery | HTMLElement;\n    itemSelector: string;\n    handleSelector?: string;\n    cancelSelector?: string;\n    onOrderChange: (newOrder: string[]) => void;\n    getItemId: (item: HTMLElement) => string | null;\n    ghostClass?: string;\n    dragClass?: string;\n    placeholderClass?: string;\n    indicatorClass?: string;\n    longPressDelay?: number;\n  };\n\n  const createSortableList = (options: SortableListOptions) => {\n    const containerEl = options.container instanceof HTMLElement ? options.container : options.container[0];\n    if (!containerEl) return;\n\n    const ghostClass = options.ghostClass ?? 'acu-drag-ghost';\n    const dragClass = options.dragClass ?? 'acu-dragging';\n    const placeholderClass = options.placeholderClass ?? 'acu-drag-placeholder';\n    const indicatorClass = options.indicatorClass ?? 'acu-drag-indicator';\n    const longPressDelay = options.longPressDelay ?? 350;\n\n    const state = {\n      isDragging: false,\n      draggedItem: null as HTMLElement | null,\n      ghost: null as HTMLElement | null,\n      indicator: null as HTMLElement | null,\n      timer: null as number | null,\n      startX: 0,\n      startY: 0,\n      pointerId: null as number | null,\n      offsetX: 0,\n      offsetY: 0,\n      startOrder: [] as string[],\n    };\n\n    const buildOrder = () => {\n      const ids: string[] = [];\n      const items = containerEl.querySelectorAll<HTMLElement>(options.itemSelector);\n      items.forEach(item => {\n        const id = options.getItemId(item);\n        if (id) ids.push(id);\n      });\n      return ids;\n    };\n\n    const clearTimer = () => {\n      if (state.timer) {\n        window.clearTimeout(state.timer);\n        state.timer = null;\n      }\n    };\n\n    const cleanupGhost = () => {\n      if (state.ghost && state.ghost.parentElement) {\n        state.ghost.parentElement.removeChild(state.ghost);\n      }\n      state.ghost = null;\n    };\n\n    const cleanupIndicator = () => {\n      if (state.indicator && state.indicator.parentElement) {\n        state.indicator.parentElement.removeChild(state.indicator);\n      }\n      state.indicator = null;\n    };\n\n    const updateGhostPosition = (clientX: number, clientY: number) => {\n      if (!state.ghost) return;\n      state.ghost.style.left = `${clientX - state.offsetX}px`;\n      state.ghost.style.top = `${clientY - state.offsetY}px`;\n    };\n\n    const ensureIndicator = () => {\n      if (!state.indicator) {\n        const indicator = document.createElement('div');\n        indicator.className = indicatorClass;\n        state.indicator = indicator;\n      }\n      return state.indicator;\n    };\n\n    const placeIndicator = (clientY: number) => {\n      if (!state.draggedItem) return;\n      const items = Array.from(containerEl.querySelectorAll<HTMLElement>(options.itemSelector)).filter(\n        item => item !== state.draggedItem,\n      );\n      let target: HTMLElement | null = null;\n      let insertBefore = true;\n\n      for (const item of items) {\n        const rect = item.getBoundingClientRect();\n        const midY = rect.top + rect.height / 2;\n        if (clientY < midY) {\n          target = item;\n          insertBefore = true;\n          break;\n        }\n        if (clientY >= rect.top && clientY <= rect.bottom) {\n          target = item;\n          insertBefore = false;\n        }\n      }\n\n      const indicator = ensureIndicator();\n      if (target) {\n        if (insertBefore) containerEl.insertBefore(indicator, target);\n        else containerEl.insertBefore(indicator, target.nextSibling);\n      } else {\n        containerEl.appendChild(indicator);\n      }\n    };\n\n    const startDrag = (\n      item: HTMLElement,\n      clientX: number,\n      clientY: number,\n      pointerId: number,\n      captureEl: HTMLElement,\n    ) => {\n      if (state.isDragging) return;\n      state.isDragging = true;\n      state.draggedItem = item;\n      state.pointerId = pointerId;\n      state.startOrder = buildOrder();\n\n      const rect = item.getBoundingClientRect();\n      state.offsetX = clientX - rect.left;\n      state.offsetY = clientY - rect.top;\n\n      const ghost = item.cloneNode(true) as HTMLElement;\n      ghost.classList.add(ghostClass);\n      ghost.style.width = `${rect.width}px`;\n      ghost.style.height = `${rect.height}px`;\n      ghost.style.left = `${rect.left}px`;\n      ghost.style.top = `${rect.top}px`;\n      ghost.style.position = 'fixed';\n      ghost.style.margin = '0';\n      ghost.style.pointerEvents = 'none';\n      document.body.appendChild(ghost);\n      state.ghost = ghost;\n\n      item.classList.add(placeholderClass);\n      item.classList.add(dragClass);\n\n      updateGhostPosition(clientX, clientY);\n      placeIndicator(clientY);\n\n      if (captureEl.setPointerCapture) {\n        captureEl.setPointerCapture(pointerId);\n      }\n    };\n\n    const finishDrag = () => {\n      if (!state.isDragging || !state.draggedItem) {\n        clearTimer();\n        cleanupIndicator();\n        cleanupGhost();\n        return;\n      }\n\n      if (state.indicator && state.indicator.parentElement === containerEl) {\n        containerEl.replaceChild(state.draggedItem, state.indicator);\n      }\n\n      const finalRect = state.draggedItem.getBoundingClientRect();\n      const draggedItem = state.draggedItem;\n      const ghost = state.ghost;\n      if (ghost) {\n        ghost.style.transition = 'left 0.18s ease, top 0.18s ease, opacity 0.18s ease';\n        ghost.style.left = `${finalRect.left}px`;\n        ghost.style.top = `${finalRect.top}px`;\n        ghost.style.opacity = '0';\n        window.setTimeout(() => {\n          if (ghost.parentElement) ghost.parentElement.removeChild(ghost);\n        }, 180);\n      }\n\n      window.setTimeout(() => {\n        draggedItem.classList.remove(placeholderClass);\n        draggedItem.classList.remove(dragClass);\n      }, 180);\n\n      cleanupIndicator();\n      if (!ghost) cleanupGhost();\n\n      const newOrder = buildOrder();\n      const orderChanged = state.startOrder.join('|') !== newOrder.join('|');\n\n      state.isDragging = false;\n      state.draggedItem = null;\n      state.pointerId = null;\n      state.startOrder = [];\n      clearTimer();\n\n      if (orderChanged) options.onOrderChange(newOrder);\n    };\n\n    containerEl.addEventListener(\n      'pointerdown',\n      e => {\n        const target = e.target as HTMLElement | null;\n        if (!target) return;\n        if (options.cancelSelector && target.closest(options.cancelSelector)) return;\n\n        const item = target.closest(options.itemSelector) as HTMLElement | null;\n        if (!item) return;\n\n        const handle = options.handleSelector ? (target.closest(options.handleSelector) as HTMLElement | null) : null;\n\n        if (handle) {\n          e.preventDefault();\n          startDrag(item, e.clientX, e.clientY, e.pointerId, handle);\n          return;\n        }\n\n        if (!options.handleSelector) {\n          e.preventDefault();\n          startDrag(item, e.clientX, e.clientY, e.pointerId, item);\n          return;\n        }\n\n        state.startX = e.clientX;\n        state.startY = e.clientY;\n        state.pointerId = e.pointerId;\n        clearTimer();\n        state.timer = window.setTimeout(() => {\n          startDrag(item, state.startX, state.startY, state.pointerId ?? e.pointerId, item);\n        }, longPressDelay);\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener(\n      'pointermove',\n      e => {\n        if (state.timer && (Math.abs(e.clientY - state.startY) > 8 || Math.abs(e.clientX - state.startX) > 8)) {\n          clearTimer();\n        }\n\n        if (!state.isDragging || !state.draggedItem) return;\n        e.preventDefault();\n        updateGhostPosition(e.clientX, e.clientY);\n        placeIndicator(e.clientY);\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener('pointerup', finishDrag);\n    containerEl.addEventListener('pointercancel', finishDrag);\n    containerEl.addEventListener(\n      'touchmove',\n      e => {\n        if (state.isDragging) {\n          e.preventDefault();\n        }\n      },\n      { passive: false },\n    );\n  };\n\n  // \n  const refreshDicePanelPresets = () => {\n    const { $ } = getCore();\n    const $panel = $('.acu-dice-panel');\n    if ($panel.length === 0) return; // \n\n    // HTML\n    const presets = AdvancedDicePresetManager.getAllPresets()\n      .filter(p => p.visible !== false)\n      .sort((a, b) => (a.order || 0) - (b.order || 0));\n\n    let html = `<button class=\"acu-dice-quick-preset-btn\" data-id=\"__custom__\"></button>`;\n    presets.forEach(p => {\n      html += `<button class=\"acu-dice-quick-preset-btn\" data-id=\"${escapeHtml(p.id)}\">${escapeHtml(p.name)}</button>`;\n    });\n\n    // \n    $panel.find('.acu-dice-quick-presets').html(html);\n  };\n\n  const showPresetListDialog = (options: { fromDicePanel?: boolean } = {}) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const presets = AdvancedDicePresetManager.getAllPresets();\n    const fromDicePanel = options.fromDicePanel === true;\n\n    // \n    pushModal('showPresetListDialog', () => showPresetListDialog(options));\n\n    const presetsHtml = presets\n      .sort((a, b) => (a.order ?? 999) - (b.order ?? 999))\n      .map(preset => {\n        const isBuiltin = preset.builtin;\n        const isVisible = preset.visible !== false;\n\n        return `\n        <div class=\"acu-preset-item${!isVisible ? ' acu-preset-hidden' : ''}\" data-id=\"${preset.id}\" draggable=\"false\">\n           <div class=\"acu-preset-check\" title=\"/\" style=\"padding: 8px; cursor: pointer; color: var(--acu-text-sub); display: flex; align-items: center; justify-content: center; width: 30px;\">\n            <i class=\"fa-solid ${isVisible ? 'fa-eye' : 'fa-eye-slash'}\" style=\"${!isVisible ? 'opacity: 0.6;' : ''}\"></i>\n          </div>\n          <div class=\"acu-preset-info\" style=\"flex: 1;\">\n            <div class=\"acu-preset-name\">\n              ${escapeHtml(preset.name)}\n              ${isBuiltin ? `<span style=\"font-size: 10px; color: var(--acu-text-sub); margin-left: 6px;\">()</span>` : ''}\n            </div>\n            ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n            <div class=\"acu-preset-stats\">\n              : ${escapeHtml(preset.diceExpression)} | : ${preset.outcomes?.length || 0}\n            </div>\n          </div>\n          <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n            ${\n              isBuiltin\n                ? `<button class=\"acu-preset-btn acu-advanced-preset-copy\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-copy\"></i></button>`\n                : `<button class=\"acu-preset-btn acu-advanced-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>`\n            }\n            <button class=\"acu-preset-btn acu-advanced-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-advanced-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: var(--acu-error-text);\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n          </div>\n          <div class=\"acu-preset-handle\" title=\"\" style=\"cursor: grab; padding: 4px; color: var(--acu-text-sub); touch-action: none; display: flex; align-items: center; justify-content: center; width: 22px;\">\n            <i class=\"fa-solid fa-grip-vertical\"></i>\n          </div>\n        </div>\n      `;\n      })\n      .join('');\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 85vh; display: flex; flex-direction: column;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid var(--acu-border); flex-shrink: 0;\">\n            <div style=\"font-size: 16px; font-weight: bold; color: var(--acu-text-main);\">\n              <i class=\"fa-solid fa-sliders\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div class=\"acu-table-manager-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n              <i class=\"fa-solid fa-info-circle\"></i> \n            </div>\n            <div id=\"acu-advanced-presets-list\" style=\"display: flex; flex-direction: column; gap: 8px;\">\n              ${presetsHtml || `<div style=\"text-align: center; padding: 40px; color: var(--acu-text-sub);\"></div>`}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--acu-border); flex-shrink: 0;\">\n            <button id=\"acu-advanced-preset-new\" style=\"flex: 1; padding: 10px; background: var(--acu-accent); border: none; border-radius: 6px; color: var(--acu-btn-active-text); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-advanced-preset-import\" style=\"flex: 1; padding: 10px; background: var(--acu-btn-bg); border: 1px solid var(--acu-text-sub); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-advanced-preset-back\" style=\"padding: 10px 16px; background: var(--acu-btn-bg); border: 1px solid var(--acu-text-sub); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n\n          <input type=\"file\" id=\"acu-advanced-preset-file-input\" accept=\".json\" style=\"display: none;\" />\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    overlay.find('.acu-close-btn, #acu-advanced-preset-back').on('click', () => {\n      overlay.remove();\n      popModal(); // \n    });\n\n    overlay.on('click', '.acu-preset-check', function (e) {\n      e.stopPropagation();\n      const $item = $(this).closest('.acu-preset-item');\n      const id = $item.data('id');\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return;\n\n      const isVisible = preset.visible !== false;\n      if (preset.builtin) {\n        AdvancedDicePresetManager.setBuiltinPresetVisibility(id, !isVisible);\n      } else {\n        AdvancedDicePresetManager.updatePreset(id, { visible: !isVisible });\n      }\n      showPresetListDialog({ fromDicePanel });\n      refreshDicePanelPresets();\n    });\n\n    overlay.on('click', '.acu-advanced-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showAdvancedPresetEditor(id);\n    });\n\n    overlay.on('click', '.acu-advanced-preset-copy', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return;\n\n      const copied = {\n        ...preset,\n        name: preset.name + ' ()',\n        id: undefined,\n        builtin: false,\n      };\n      AdvancedDicePresetManager.createPreset(copied);\n      overlay.remove();\n      showPresetListDialog({ fromDicePanel });\n      refreshDicePanelPresets();\n    });\n\n    overlay.on('click', '.acu-advanced-preset-export', function () {\n      const id = $(this).data('id');\n      const json = AdvancedDicePresetManager.exportPreset(id);\n      if (!json) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n      const preset = presets.find(p => p.id === id);\n      const filename = `acu_advanced_preset_${preset?.name || id}_${Date.now()}.json`;\n\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    overlay.on('click', '.acu-advanced-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        try {\n          AdvancedDicePresetManager.deletePreset(id);\n          overlay.remove();\n          showPresetListDialog({ fromDicePanel });\n          refreshDicePanelPresets();\n        } catch (err) {\n          if (window.toastr) window.toastr.error(': ' + err.message);\n        }\n      }\n    });\n\n    overlay.find('#acu-advanced-preset-new').on('click', () => {\n      overlay.remove();\n      showAdvancedPresetEditor();\n    });\n\n    overlay.find('#acu-advanced-preset-import').on('click', () => {\n      overlay.find('#acu-advanced-preset-file-input').trigger('click');\n    });\n\n    const $list = overlay.find('#acu-advanced-presets-list');\n    createSortableList({\n      container: $list,\n      itemSelector: '.acu-preset-item',\n      handleSelector: '.acu-preset-handle',\n      cancelSelector: '.acu-preset-actions button, .acu-toggle, .acu-preset-check',\n      getItemId: item => {\n        const id = $(item).data('id');\n        if (typeof id === 'string') return id;\n        if (id !== undefined && id !== null) return String(id);\n        return null;\n      },\n      onOrderChange: newOrderIds => {\n        newOrderIds.forEach((id, index) => {\n          AdvancedDicePresetManager.setPresetOrder(id, index);\n        });\n        refreshDicePanelPresets();\n      },\n    });\n\n    overlay.find('#acu-advanced-preset-file-input').on('change', function (e) {\n      const file = (e.target as HTMLInputElement).files?.[0];\n      if (!file) return;\n\n      const reader = new FileReader();\n      reader.onload = ev => {\n        try {\n          const jsonStr = ev.target?.result as string;\n          const result = AdvancedDicePresetManager.importPreset(jsonStr);\n          if (result) {\n            overlay.remove();\n            showPresetListDialog({ fromDicePanel });\n            refreshDicePanelPresets();\n          } else {\n            if (window.toastr) window.toastr.error(': ');\n          }\n        } catch (err) {\n          if (window.toastr) window.toastr.error(': ' + (err.message || ''));\n        }\n      };\n      reader.readAsText(file);\n    });\n\n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      popModal(); // \n    });\n  };\n\n  const showAdvancedPresetManager = (options: { fromDicePanel?: boolean } = {}) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n    pushModal('showAdvancedPresetManager', () => showAdvancedPresetManager(options));\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n    const fromDicePanel = options.fromDicePanel === true;\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 85vh; display: flex; flex-direction: column;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid var(--acu-border); flex-shrink: 0;\">\n            <div style=\"font-size: 16px; font-weight: bold; color: var(--acu-text-main);\">\n              <i class=\"fa-solid fa-dice-d20\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n           <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n              <div class=\"acu-setting-row\">\n                  <div class=\"acu-setting-info\">\n                      <span class=\"acu-setting-label\"><i class=\"fa-solid fa-sliders\"></i> </span>\n                  </div>\n                  <button id=\"acu-open-preset-list\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                      <i class=\"fa-solid fa-cog\"></i> \n                  </button>\n              </div>\n              <div class=\"acu-setting-row\" style=\"margin-top: 12px;\">\n                  <div class=\"acu-setting-info\">\n                      <span class=\"acu-setting-label\"><i class=\"fa-solid fa-gem\"></i> </span>\n                  </div>\n                  <button id=\"acu-open-attr-preset\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                      <i class=\"fa-solid fa-cog\"></i> \n                  </button>\n              </div>\n              <div class=\"acu-setting-row\" style=\"margin-top: 12px;\">\n                  <div class=\"acu-setting-info\">\n                      <span class=\"acu-setting-label\"><i class=\"fa-solid fa-fire\"></i> </span>\n                  </div>\n                  <select id=\"cfg-crazy-mode\" class=\"acu-setting-select\" style=\"width: 90px; min-width: 90px; text-align: center; text-align-last: center;\">\n                      <option value=\"0\"> </option>\n                      <option value=\"25\"> </option>\n                      <option value=\"50\"> </option>\n                      <option value=\"75\"> </option>\n                      <option value=\"100\"> </option>\n                  </select>\n              </div>\n              <div style=\"padding-top: 12px; border-top: 1px solid var(--acu-border);\">\n                <div class=\"acu-setting-row acu-setting-row-toggle\" style=\"margin-bottom: 8px;\">\n                    <div class=\"acu-setting-info\">\n                        <span class=\"acu-setting-label\"></span>\n                    </div>\n                    <label class=\"acu-toggle\">\n                        <input type=\"checkbox\" id=\"cfg-hide-dice-result\" ${diceCfg.hideDiceResultFromUser ? 'checked' : ''}>\n                        <span class=\"acu-toggle-slider\"></span>\n                    </label>\n                </div>\n                 <div class=\"acu-setting-row acu-setting-row-toggle\">\n                    <div class=\"acu-setting-info\">\n                        <span class=\"acu-setting-label\"></span>\n                    </div>\n                    <label class=\"acu-toggle\">\n                        <input type=\"checkbox\" id=\"cfg-hide-dice-result-chat\" ${diceCfg.hideDiceResultInChat ? 'checked' : ''}>\n                        <span class=\"acu-toggle-slider\"></span>\n                    </label>\n                </div>\n            </div>\n           </div>\n         </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn').on('click', () => {\n      overlay.remove();\n      popModal();\n    });\n\n    overlay.find('#acu-open-preset-list').on('click', () => {\n      overlay.remove();\n      showPresetListDialog({ fromDicePanel });\n    });\n\n    overlay.find('#acu-open-attr-preset').on('click', () => {\n      overlay.remove();\n      showAttributePresetManager();\n    });\n\n    // \n    const initCrazyModeUI = () => {\n      const crazyConfig = getCrazyModeConfig();\n      // enabledcrazyLevel\n      const selectValue = crazyConfig.enabled ? crazyConfig.crazyLevel : 0;\n      overlay.find('#cfg-crazy-mode').val(selectValue);\n\n      // \n      overlay.find('#cfg-crazy-mode').on('change', function () {\n        const value = parseInt($(this).val() as string, 10);\n        if (value === 0) {\n          saveCrazyModeConfig({ enabled: false, crazyLevel: 50 });\n        } else {\n          saveCrazyModeConfig({ enabled: true, crazyLevel: value });\n        }\n      });\n    };\n    initCrazyModeUI();\n\n    // \n    overlay.find('#cfg-hide-dice-result').on('change', function () {\n      const hide = $(this).is(':checked');\n      saveDiceConfig({ hideDiceResultFromUser: hide });\n      console.info('[DICE]/()...', hide);\n      hideDiceResultsInUserMessages();\n    });\n\n    overlay.find('#cfg-hide-dice-result-chat').on('change', function () {\n      const hide = $(this).is(':checked');\n      saveDiceConfig({ hideDiceResultInChat: hide });\n      console.info('[DICE]/()...', hide);\n      // \n      // dom\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      popModal();\n    });\n  };\n\n  const showAdvancedPresetEditor = (presetId = null) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n    pushModal('showAdvancedPresetEditor', () => showAdvancedPresetEditor(presetId));\n\n    const config = getConfig();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? AdvancedDicePresetManager.getAllPresets().find(p => p.id === presetId) : null;\n\n    //  - \n    const defaultData = existingPreset\n      ? JSON.parse(JSON.stringify(existingPreset))\n      : {\n          name: '',\n          description: '',\n          diceExpression: '1d20',\n          attribute: {\n            label: '',\n            placeholder: '=10',\n            defaultValue: 10,\n            key: '',\n          },\n          dc: {\n            label: '(DC)',\n            placeholder: '=10',\n            defaultValue: 10,\n          },\n          mod: {\n            label: '',\n            placeholder: '=0',\n            defaultValue: 0,\n          },\n          customFields: [\n            {\n              id: 'advantage',\n              type: 'select',\n              label: '/',\n              defaultValue: 0,\n              options: [\n                { label: '', value: 0 },\n                { label: '', value: 1 },\n                { label: '', value: -1 },\n              ],\n            },\n          ],\n          derivedVars: [{ id: 'attrMod', expr: 'floor(($attr - 10) / 2)' }],\n          dicePatches: [\n            { when: '$advantage > 0', op: 'replace', template: '2d20kh1' },\n            { when: '$advantage < 0', op: 'replace', template: '2d20kl1' },\n          ],\n          outcomes: [\n            {\n              id: 'crit_success',\n              name: '',\n              condition: \"$roll.hasTag('nat20')\",\n              priority: 1,\n              rank: 3,\n              contestRank: 100,\n            },\n            {\n              id: 'success',\n              name: '',\n              condition: '$roll.total + $attrMod + $mod >= $dc',\n              priority: 10,\n              rank: 1,\n              contestRank: 60,\n            },\n            {\n              id: 'failure',\n              name: '',\n              condition: '$roll.total + $attrMod + $mod < $dc',\n              displayExpr: '$roll.total + $attrMod + $mod >= $dc',\n              priority: 50,\n              rank: 0,\n              contestRank: 40,\n            },\n            {\n              id: 'crit_failure',\n              name: '',\n              condition: \"$roll.hasTag('nat1')\",\n              priority: 2,\n              rank: -1,\n              contestRank: 20,\n            },\n          ],\n          contestRule: {\n            mode: 'rank',\n            tieBreakers: ['higher_roll', 'initiator_wins'],\n          },\n          outputTemplate:\n            '<meta:>\\n$outcomeText\\n$initiator  $attrName $formula=$roll $conditionExpr$judgeResult$outcomeName\\n</meta:>',\n          contestOutputTemplate: '',\n          secondaryTriggerMode: 'first',\n          secondaryMaxDepth: 3,\n          secondaryEffects: [],\n        };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 650px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid var(--acu-border);\">\n            <div style=\"font-size: 16px; font-weight: bold; color: var(--acu-text-main);\">\n              <i class=\"fa-solid fa-pen\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 4px;\"></label>\n              <input id=\"advanced-preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 4px;\"></label>\n              <input id=\"advanced-preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 8px;\">\n                JSON <span style=\"font-size: 10px; color: var(--acu-text-sub);\">()</span>\n              </label>\n              <textarea id=\"advanced-preset-json\" class=\"acu-preset-editor-textarea\" style=\"width: 100%; height: 400px; padding: 10px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; font-family: 'Consolas', 'Monaco', monospace !important; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: var(--acu-text-sub); padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n              <strong> (diceExpression)</strong><br/>\n               : \"1d20\", \"3d6\", \"4dF\" (Fate)<br/>\n               /: \"4d6kh3\" (3), \"2d20kl1\" (1)<br/>\n               : \"4d6=3\" (=3), \"6d10>=7\" (7)<br/>\n               CoC: \"1d100b1\" (), \"1d100p2\" (2)<br/>\n               : \"4d6!\" (), \"4d6!!\" ()<br/>\n              <br/>\n              <strong>$roll </strong><br/>\n               $roll.total: <br/>\n               $roll.hasTag('nat20'): 20d20<br/>\n               $roll.hasTag('nat1'): 1d20<br/>\n              <br/>\n              <strong></strong><br/>\n               attribute:  { label, placeholder, defaultValue, hidden, key? }<br/>\n               dc:  { label, placeholder, defaultValue, hidden }<br/>\n               mod:  { label, placeholder, defaultValue, hidden }<br/>\n              <br/>\n              <strong> (outcomes)</strong><br/>\n               : { id, name, condition, priority, rank?, contestRank? }<br/>\n               condition:  \"$roll.total >= $dc\", \"$roll.total == 4\"<br/>\n               priority: <br/>\n              <br/>\n              <strong></strong><br/>\n               customFields:  [{ id, type, label, defaultValue, options? }]<br/>\n               derivedVars:  [{ id, expr }]  { id: \"mod\", expr: \"floor(($attr-10)/2)\" }<br/>\n               dicePatches:  [{ when?, op, template }]<br/>\n               contestRule:  { disabled?, mode, tieBreakers }<br/>\n              <br/>\n              <strong></strong><br/>\n               $roll, $attr, $dc, $mod, $outcomeName, $formula, $initiator <br/>\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--acu-border);\">\n            <button id=\"advanced-preset-save\" style=\"flex: 1; padding: 10px; background: var(--acu-accent); border: none; border-radius: 6px; color: var(--acu-btn-active-text); cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"advanced-preset-cancel\" style=\"padding: 10px 16px; background: var(--acu-btn-bg); border: 1px solid var(--acu-text-sub); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#advanced-preset-json');\n\n    // JSON\n    $jsonTextarea.val(JSON.stringify(defaultData, null, 2));\n\n    // \n    overlay.find('.acu-close-btn, #advanced-preset-cancel').on('click', () => {\n      overlay.remove();\n      popModal();\n    });\n\n    // \n    overlay.find('#advanced-preset-save').on('click', () => {\n      try {\n        const name = overlay.find('#advanced-preset-name').val().trim();\n        const description = overlay.find('#advanced-preset-desc').val().trim();\n        const jsonStr = $jsonTextarea.val().trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const jsonData = JSON.parse(jsonStr);\n\n        // \n        if (\n          !jsonData.diceExpression ||\n          !jsonData.outcomes ||\n          !Array.isArray(jsonData.outcomes) ||\n          jsonData.outcomes.length === 0\n        ) {\n          if (window.toastr) window.toastr.error('(outcomes)');\n          return;\n        }\n\n        //  outcome \n        for (const outcome of jsonData.outcomes) {\n          if (!outcome.id || !outcome.name || outcome.condition === undefined || outcome.priority === undefined) {\n            if (window.toastr)\n              window.toastr.error(\n                ` \"${outcome.name || outcome.id || ''}\" (id, name, condition, priority)`,\n              );\n            return;\n          }\n        }\n\n        // \n        const preset = {\n          ...(isEdit && existingPreset ? existingPreset : {}),\n          ...(isEdit ? {} : { builtin: false }),\n          ...jsonData,\n          kind: 'advanced' as const,\n          version: PRESET_FORMAT_VERSION,\n          id: presetId || `custom_${Date.now()}`,\n          name,\n          description,\n        };\n\n        // \n        if (isEdit) {\n          AdvancedDicePresetManager.updatePreset(presetId, preset);\n        } else {\n          AdvancedDicePresetManager.createPreset(preset);\n        }\n\n        overlay.remove();\n        popModal();\n        refreshDicePanelPresets(); // \n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        const errMsg = err.message || '';\n        if (errMsg.includes('JSON') || errMsg.includes('position') || errMsg.includes('token')) {\n          if (window.toastr)\n            window.toastr.error('JSON \"name\": \"\"');\n        } else {\n          if (window.toastr) window.toastr.error('' + (errMsg || ''));\n        }\n      }\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      popModal();\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showActionPresetManager = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n    pushModal('showActionPresetManager', showActionPresetManager);\n\n    const config = getConfig();\n    const presets = ActionPresetManager.getAllPresets();\n    const activeId = ActionPresetManager.getActivePresetId();\n\n    // HTML\n    const presetsHtml =\n      presets.length === 0\n        ? `<div style=\"text-align: center; padding: 40px; color: var(--acu-text-sub);\"></div>`\n        : presets\n            .map(preset => {\n              const isActive = preset.id === activeId;\n              const isBuiltin = (preset as any).builtin === true;\n              const keywordsSummary =\n                (preset.rules || [])\n                  .flatMap(r => r.table_keywords || [])\n                  .slice(0, 3)\n                  .join('') || '';\n              const actionsSummary =\n                (preset.rules || [])\n                  .flatMap(r => (r.actions || []).map(a => a.label))\n                  .slice(0, 4)\n                  .join('') || '';\n\n              return `\n          <div class=\"acu-preset-item\" data-id=\"${preset.id}\">\n            <div class=\"acu-preset-info\">\n              <div class=\"acu-preset-name\">${escapeHtml(preset.name)}${isBuiltin ? `<span style=\"font-size: 10px; color: var(--acu-text-sub); margin-left: 6px;\">()</span>` : ''}</div>\n              ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n              <div class=\"acu-preset-stats\" style=\"font-size: 11px; color: var(--acu-text-sub);\">\n                : ${escapeHtml(keywordsSummary)} | : ${escapeHtml(actionsSummary)}\n              </div>\n            </div>\n            <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n              <label class=\"acu-toggle\" style=\"margin: 0;\">\n                <input type=\"checkbox\" class=\"acu-action-preset-toggle\" data-id=\"${preset.id}\" ${isActive ? 'checked' : ''}>\n                <span class=\"acu-toggle-slider\"></span>\n              </label>\n              ${\n                isBuiltin\n                  ? `<button class=\"acu-preset-btn acu-action-preset-copy\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-copy\"></i></button>`\n                  : `<button class=\"acu-preset-btn acu-action-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>`\n              }\n              <button class=\"acu-preset-btn acu-action-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n              ${!isBuiltin ? `<button class=\"acu-preset-btn acu-action-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: var(--acu-error-text);\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n            </div>\n          </div>\n        `;\n            })\n            .join('');\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 80vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid var(--acu-border);\">\n            <div style=\"font-size: 16px; font-weight: bold; color: var(--acu-text-main);\">\n              <i class=\"fa-solid fa-wand-magic-sparkles\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div id=\"acu-action-presets-list\">\n              ${presetsHtml}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--acu-border);\">\n            <button id=\"acu-action-preset-new\" style=\"flex: 1; padding: 10px; background: var(--acu-accent); border: none; border-radius: 6px; color: var(--acu-btn-active-text); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-action-preset-import\" style=\"flex: 1; padding: 10px; background: var(--acu-btn-bg); border: 1px solid var(--acu-text-sub); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-action-preset-back\" style=\"padding: 10px 16px; background: var(--acu-btn-bg); border: 1px solid var(--acu-text-sub); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn, #acu-action-preset-back').on('click', () => {\n      overlay.remove();\n      popModal();\n    });\n\n    // Toggle\n    overlay.on('change', '.acu-action-preset-toggle', function () {\n      const $toggle = $(this);\n      const id = $toggle.data('id');\n      const isChecked = $toggle.is(':checked');\n\n      if (isChecked) {\n        ActionPresetManager.setActivePresetId(id);\n        // toggle\n        overlay.find('.acu-action-preset-toggle').each(function () {\n          if ($(this).data('id') !== id) {\n            $(this).prop('checked', false);\n          }\n        });\n      } else {\n        // \n        if (ActionPresetManager.getActivePresetId() === id) {\n          ActionPresetManager.setActivePresetId(null);\n          if (window.toastr) window.toastr.info('');\n        }\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showActionPresetEditor(id);\n    });\n\n    //  - JSON\n    overlay.on('click', '.acu-action-preset-export', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n      const json = ActionPresetManager.exportPreset(id);\n      if (!json) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      // JSON\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `${preset?.name || ''}.json`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      if (window.toastr) window.toastr.success('');\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-copy', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return;\n\n      const copyData = {\n        name: preset.name + ' ()',\n        description: preset.description || '',\n        rules: JSON.parse(JSON.stringify(preset.rules)),\n      };\n\n      const newPreset = ActionPresetManager.createPreset(copyData);\n      if (newPreset) {\n        if (window.toastr)\n          window.toastr.success(`${newPreset.name} ${newPreset.rules.length} `);\n        overlay.remove();\n        showActionPresetManager(); // \n      }\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        const success = ActionPresetManager.deletePreset(id);\n        if (success) {\n          overlay.remove();\n          showActionPresetManager();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      }\n    });\n\n    // \n    overlay.find('#acu-action-preset-new').on('click', () => {\n      overlay.remove();\n      showActionPresetEditor();\n    });\n\n    //  - JSON\n    overlay.find('#acu-action-preset-import').on('click', () => {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = () => {\n        const file = input.files?.[0];\n        if (!file) return;\n\n        const reader = new FileReader();\n        reader.onload = e => {\n          const jsonStr = e.target?.result as string;\n          if (!jsonStr?.trim()) {\n            if (window.toastr) window.toastr.error('');\n            return;\n          }\n\n          const result = ActionPresetManager.importPreset(jsonStr.trim());\n          if (result) {\n            if (window.toastr) window.toastr.success(`${result.name}`);\n            overlay.remove();\n            showActionPresetManager();\n          } else {\n            if (window.toastr) window.toastr.error('JSON');\n          }\n        };\n        reader.onerror = () => {\n          if (window.toastr) window.toastr.error('');\n        };\n        reader.readAsText(file);\n      };\n      input.click();\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      popModal();\n    });\n  };\n\n  // JSON\n  const showActionPresetEditor = (presetId?: string) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n    pushModal('showActionPresetEditor', () => showActionPresetEditor(presetId));\n\n    const config = getConfig();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? ActionPresetManager.getPresetById(presetId) : null;\n\n    // \n    const defaultData = {\n      name: existingPreset?.name || '',\n      description: existingPreset?.description || '',\n      rules: existingPreset?.rules || [\n        {\n          table_keywords: ['', ''],\n          actions: [\n            {\n              label: '',\n              template:\n                '<user>{Name}:{Name}',\n            },\n            {\n              label: '',\n              template: '<user>{Name}',\n            },\n          ],\n        },\n        {\n          table_keywords: ['', ''],\n          actions: [\n            {\n              label: '',\n              template: '<user>{Name}',\n            },\n            {\n              label: '',\n              template: '<user>{Name}',\n            },\n          ],\n        },\n      ],\n    };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 700px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid var(--acu-border);\">\n            <div style=\"font-size: 16px; font-weight: bold; color: var(--acu-text-main);\">\n              <i class=\"fa-solid fa-wand-magic-sparkles\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 4px;\"></label>\n              <input id=\"action-preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 4px;\"></label>\n              <input id=\"action-preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 8px;\">\n                JSON <span style=\"font-size: 10px; color: var(--acu-text-sub);\">(JSON)</span>\n              </label>\n              <textarea id=\"action-preset-json\" class=\"acu-preset-editor-textarea\" style=\"width: 100%; height: 300px; padding: 10px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; font-family: 'Consolas', 'Monaco', monospace; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: var(--acu-text-sub); padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n                table_keywords actions<br/>\n                label template{Name}<br/>\n               : { \"table_keywords\": [\"\"], \"actions\": [{ \"label\": \"\", \"template\": \"<user>{Name}\" }] }\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--acu-border);\">\n            <button id=\"action-preset-save\" style=\"flex: 1; padding: 10px; background: var(--acu-accent); border: none; border-radius: 6px; color: var(--acu-btn-active-text); cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"action-preset-cancel\" style=\"padding: 10px 16px; background: var(--acu-btn-bg); border: 1px solid var(--acu-text-sub); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#action-preset-json');\n\n    // JSON rules \n    $jsonTextarea.val(JSON.stringify(defaultData.rules, null, 2));\n\n    // \n    overlay.find('.acu-close-btn, #action-preset-cancel').on('click', () => {\n      overlay.remove();\n      popModal();\n    });\n\n    // \n    overlay.find('#action-preset-save').on('click', () => {\n      try {\n        const name = (overlay.find('#action-preset-name').val() as string).trim();\n        const description = (overlay.find('#action-preset-desc').val() as string).trim();\n        const jsonStr = ($jsonTextarea.val() as string).trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const rules = JSON.parse(jsonStr);\n\n        // \n        if (!Array.isArray(rules) || rules.length === 0) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n\n        // \n        for (let i = 0; i < rules.length; i++) {\n          const rule = rules[i];\n          if (!rule.table_keywords || !Array.isArray(rule.table_keywords) || rule.table_keywords.length === 0) {\n            if (window.toastr) window.toastr.error(` ${i + 1}  table_keywords`);\n            return;\n          }\n          if (!rule.actions || !Array.isArray(rule.actions) || rule.actions.length === 0) {\n            if (window.toastr) window.toastr.error(` ${i + 1}  actions`);\n            return;\n          }\n        }\n\n        if (isEdit && presetId) {\n          // \n          ActionPresetManager.updatePreset(presetId, { name, description, rules });\n          if (window.toastr) window.toastr.success('');\n        } else {\n          // \n          ActionPresetManager.createPreset({ name, description, rules });\n          if (window.toastr) window.toastr.success('');\n        }\n\n        overlay.remove();\n        popModal();\n      } catch (e) {\n        if (window.toastr) window.toastr.error('JSON : ' + (e as Error).message);\n      }\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      popModal();\n    });\n  };\n  // ========================================\n  const showDebugConsoleModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-debug-console-dialog)').remove();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // localStorage\n    const savedFilters = Store.get('acu_debug_filters', { log: true, info: true, warn: true, error: true });\n    ConsoleCaptureManager.setFilters(savedFilters);\n\n    const renderLogs = () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      const $logContainer = dialog.find('.acu-debug-log-container');\n      $logContainer.empty();\n\n      if (filteredLogs.length === 0) {\n        $logContainer.html(`\n          <div class=\"acu-debug-empty\">\n            <i class=\"fa-solid fa-inbox\"></i>\n            <div class=\"acu-debug-empty-text\"></div>\n            <div class=\"acu-debug-empty-hint\"> Console </div>\n          </div>\n        `);\n        return;\n      }\n\n      filteredLogs.forEach(log => {\n        const logItem = $(`\n          <div class=\"acu-debug-log-item\" data-type=\"${log.type}\">\n            <div class=\"acu-debug-log-header\">\n              <span class=\"acu-debug-log-time\">${log.timeStr}</span>\n              <span class=\"acu-debug-log-type ${log.type}\">${log.type.toUpperCase()}</span>\n            </div>\n            <div class=\"acu-debug-log-content\">${escapeHtml(log.content)}</div>\n            ${log.stack ? `<div class=\"acu-debug-log-stack\">${escapeHtml(log.stack)}</div>` : ''}\n          </div>\n        `);\n        $logContainer.append(logItem);\n      });\n    };\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-debug-console-dialog ${currentThemeClass}\">\n          <div class=\"acu-settings-header\">\n            <div class=\"acu-settings-title\"><i class=\"fa-solid fa-bug\"></i> Debug</div>\n            <button class=\"acu-close-btn\" id=\"debug-console-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex:1;display:flex;flex-direction:column;overflow:hidden;\">\n            <!--  -->\n            <div class=\"acu-debug-toolbar\">\n              <!-- Console -->\n              <div class=\"acu-debug-capture-row\">\n                <span class=\"acu-debug-capture-label\">Console </span>\n                <label class=\"acu-toggle\">\n                  <input type=\"checkbox\" id=\"debug-console-capture-toggle\" ${ConsoleCaptureManager.enabled ? 'checked' : ''}>\n                  <span class=\"acu-toggle-slider\"></span>\n                </label>\n                <span id=\"debug-console-capture-status\" class=\"acu-debug-capture-status ${ConsoleCaptureManager.enabled ? 'enabled' : 'disabled'}\">${ConsoleCaptureManager.enabled ? '' : ''}</span>\n              </div>\n              <!--  -->\n              <div class=\"acu-debug-filter-group\">\n                <button class=\"acu-debug-filter-btn ${savedFilters.log ? 'active' : ''}\" data-filter-type=\"log\">\n                  <i class=\"fa-solid fa-circle indicator\"></i> Log\n                </button>\n                <button class=\"acu-debug-filter-btn ${savedFilters.info ? 'active' : ''}\" data-filter-type=\"info\">\n                  <i class=\"fa-solid fa-info-circle indicator\"></i> Info\n                </button>\n                <button class=\"acu-debug-filter-btn ${savedFilters.warn ? 'active' : ''}\" data-filter-type=\"warn\">\n                  <i class=\"fa-solid fa-exclamation-triangle indicator\"></i> Warn\n                </button>\n                <button class=\"acu-debug-filter-btn ${savedFilters.error ? 'active' : ''}\" data-filter-type=\"error\">\n                  <i class=\"fa-solid fa-exclamation-circle indicator\"></i> Error\n                </button>\n              </div>\n              <!--  -->\n              <div class=\"acu-debug-actions\">\n                <button class=\"acu-debug-action-btn danger\" id=\"debug-console-clear\">\n                  <i class=\"fa-solid fa-trash\"></i> <span class=\"btn-text\"></span>\n                </button>\n                <button class=\"acu-debug-action-btn\" id=\"debug-console-copy\">\n                  <i class=\"fa-solid fa-copy\"></i> <span class=\"btn-text\"></span>\n                </button>\n                <button class=\"acu-debug-action-btn primary\" id=\"debug-console-export\">\n                  <i class=\"fa-solid fa-download\"></i> <span class=\"btn-text\"></span>\n                </button>\n              </div>\n            </div>\n\n            <!--  -->\n            <div class=\"acu-debug-log-scroll\">\n              <div class=\"acu-debug-log-container\"></div>\n            </div>\n\n            <!--  -->\n            <div class=\"acu-debug-footer\">\n              <div class=\"acu-debug-stats\">\n                <div class=\"acu-debug-stat\">\n                  <span></span>\n                  <span class=\"acu-debug-stat-value\" id=\"debug-total-count\">0</span>\n                </div>\n                <div class=\"acu-debug-stat\">\n                  <span></span>\n                  <span class=\"acu-debug-stat-value\" id=\"debug-filtered-count\">0</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const updateCounts = () => {\n      const total = ConsoleCaptureManager.logs.length;\n      const filtered = ConsoleCaptureManager.getFilteredLogs().length;\n      dialog.find('#debug-total-count').text(total);\n      dialog.find('#debug-filtered-count').text(filtered);\n    };\n\n    // \n    renderLogs();\n    updateCounts();\n\n    // Console\n    dialog.find('#debug-console-capture-toggle').on('change', function () {\n      const checked = $(this).is(':checked');\n      const $status = dialog.find('#debug-console-capture-status');\n      if (checked) {\n        ConsoleCaptureManager.enable();\n        $status.text('').removeClass('disabled').addClass('enabled');\n        // \n        console.log('[DICE]Debug');\n      } else {\n        ConsoleCaptureManager.disable();\n        $status.text('').removeClass('enabled').addClass('disabled');\n      }\n    });\n\n    // \n    dialog.find('.acu-debug-filter-btn').on('click', function () {\n      const type = $(this).data('filter-type');\n      const isActive = $(this).hasClass('active');\n      const newState = !isActive;\n\n      // \n      if (newState) {\n        $(this).addClass('active');\n      } else {\n        $(this).removeClass('active');\n      }\n\n      // \n      ConsoleCaptureManager.setFilters({ [type]: newState });\n      Store.set('acu_debug_filters', ConsoleCaptureManager.filters);\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-clear').on('click', () => {\n      ConsoleCaptureManager.clear();\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-copy').on('click', async () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n');\n\n      try {\n        // \n        if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n          const safeContent = text.replace(/\\\"/g, '\\\\\"').replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          return;\n        }\n        // API\n        if (navigator.clipboard && window.isSecureContext) {\n          await navigator.clipboard.writeText(text);\n        } else {\n          // execCommand\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n          document.body.appendChild(textArea);\n          textArea.select();\n          textArea.setSelectionRange(0, 99999);\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n          if (!successful) {\n            throw new Error('execCommand failed');\n          }\n        }\n      } catch (err) {\n        console.error('[DICE]DebugConsole :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // \n    dialog.find('#debug-console-export').on('click', () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n\\n');\n\n      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `debug-console-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    dialog.find('#debug-console-close, .acu-edit-overlay').on('click', function (e) {\n      if (e.target === this || $(e.target).closest('.acu-close-btn').length) {\n        dialog.remove();\n      }\n    });\n\n    // \n    // [] \n    const refreshInterval = setInterval(() => {\n      if (dialog.length && dialog.is(':visible')) {\n        renderLogs();\n        updateCounts();\n      }\n    }, 500);\n\n    // \n    dialog.on('remove', () => {\n      clearInterval(refreshInterval);\n    });\n  };\n\n  // ========================================\n  // showAddRegexRuleModal - / (Phase 4.2)\n  // ========================================\n  const showAddRegexRuleModal = (editRuleId?: string) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // ()\n    const editRule = editRuleId ? RegexTransformationManager.getRule(editRuleId) : null;\n\n    // \n    const tableData = cachedRawData || getTableData();\n    const tableNames = Object.keys(tableData || {})\n      .filter(k => k.startsWith('sheet_'))\n      .map(k => tableData[k]?.name || k)\n      .sort();\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-dice-cfg-header\">\n            <span><i class=\"fa-solid fa-magic\"></i> ${editRule ? '' : ''}</span>\n            <button class=\"acu-config-close\" id=\"acu-close-regex-rule\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.name) : ''}\" placeholder=\": \" style=\"flex:1;\" required>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <textarea id=\"rule-description\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1; resize: none; overflow-wrap: break-word; overflow-y: hidden; min-height: 34px; height: 34px; line-height: 1.4;\">${editRule ? escapeHtml(editRule.description || '') : ''}</textarea>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <input type=\"text\" id=\"rule-pattern\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.pattern) : ''}\" placeholder=\": \\\\s+  /test/g\" style=\"flex:1; font-family: monospace;\" required>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-replacement\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.replacement || '') : ''}\" placeholder=\", $1, $2 \" style=\"flex:1; font-family: monospace;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <select id=\"rule-scope-type\" class=\"acu-setting-select\" style=\"width:120px;\">\n                <option value=\"global\" ${editRule?.scope?.type === 'global' ? 'selected' : ''}></option>\n                <option value=\"table\" ${editRule?.scope?.type === 'table' ? 'selected' : ''}></option>\n                <option value=\"column\" ${editRule?.scope?.type === 'column' ? 'selected' : ''}></option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"field-table-names\" style=\"display: ${editRule?.scope?.type === 'global' ? 'none' : 'flex'};\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> ()</span></div>\n              <input type=\"text\" id=\"rule-table-names\" class=\"acu-panel-input\" value=\"${editRule?.scope?.tableNames?.join(',') || ''}\" placeholder=\": ,\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\" id=\"field-column-names\" style=\"display: ${editRule?.scope?.type === 'column' ? 'flex' : 'none'};\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> ()</span></div>\n              <input type=\"text\" id=\"rule-column-names\" class=\"acu-panel-input\" value=\"${editRule?.scope?.columnNames?.join(',') || ''}\" placeholder=\": ,\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"number\" id=\"rule-priority\" class=\"acu-panel-input\" value=\"${editRule?.priority || 50}\" min=\"1\" max=\"100\" style=\"width:80px;\">\n            </div>\n\n          </div>\n          <div class=\"acu-dice-cfg-actions\">\n            <button id=\"acu-regex-rule-cancel\"></button>\n            <button id=\"acu-regex-rule-confirm\"></button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    // /\n    const updateScopeFields = () => {\n      const scopeType = dialog.find('#rule-scope-type').val();\n      if (scopeType === 'global') {\n        dialog.find('#field-table-names, #field-column-names').hide();\n      } else if (scopeType === 'table') {\n        dialog.find('#field-table-names').css('display', 'flex').show();\n        dialog.find('#field-column-names').hide();\n      } else if (scopeType === 'column') {\n        dialog.find('#field-table-names, #field-column-names').css('display', 'flex').show();\n      }\n    };\n\n    dialog.find('#rule-scope-type').on('change', updateScopeFields);\n\n    // Textarea\n    const $textarea = dialog.find('#rule-description');\n    const autoResizeTextarea = () => {\n      // scrollHeight\n      $textarea.css('height', '34px');\n      // ,1\n      const scrollHeight = $textarea[0].scrollHeight;\n      $textarea.css('height', Math.max(34, scrollHeight) + 'px');\n    };\n    // \n    $textarea.on('input', autoResizeTextarea);\n\n    // ()\n    dialog.find('#acu-regex-rule-confirm').on('click', async function () {\n      const name = dialog.find('#rule-name').val();\n      const pattern = dialog.find('#rule-pattern').val();\n      const scopeType = dialog.find('#rule-scope-type').val();\n\n      if (!name || !pattern) {\n        toastr.error('');\n        return;\n      }\n\n      //  scope \n      const scope: RegexScopeConfig = { type: scopeType as RegexScopeType };\n      if (scopeType !== 'global') {\n        const tableNames = dialog.find('#rule-table-names').val();\n        if (tableNames)\n          scope.tableNames = String(tableNames)\n            .split(',')\n            .map(s => s.trim())\n            .filter(s => s);\n      }\n      if (scopeType === 'column') {\n        const columnNames = dialog.find('#rule-column-names').val();\n        if (columnNames)\n          scope.columnNames = String(columnNames)\n            .split(',')\n            .map(s => s.trim())\n            .filter(s => s);\n      }\n\n      //  pattern  flags\n      const patternStr = String(pattern);\n      const { flags: extractedFlags, patternWithoutFlags } = RegexTransformationEngine._extractFlags(patternStr);\n\n      // \n      try {\n        new RegExp(patternWithoutFlags);\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : String(e);\n        toastr.error(`: ${errorMsg}`, '');\n        return;\n      }\n\n      //  UI  flags\n      const $flagGlobal = dialog.find('#flag-global');\n      const $flagIgnoreCase = dialog.find('#flag-ignorecase');\n      const $flagMultiline = dialog.find('#flag-multiline');\n\n      const uiFlags = {\n        global: $flagGlobal.length > 0 ? $flagGlobal.is(':checked') : false,\n        caseInsensitive: $flagIgnoreCase.length > 0 ? $flagIgnoreCase.is(':checked') : false,\n        multiline: $flagMultiline.length > 0 ? $flagMultiline.is(':checked') : false,\n      };\n\n      //  pattern  flags pattern  flags\n      const finalPattern = patternWithoutFlags !== patternStr ? patternWithoutFlags : patternStr;\n      const finalFlags =\n        patternWithoutFlags !== patternStr\n          ? { ...uiFlags, ...extractedFlags } //  flags  UI flags\n          : uiFlags; //  flags UI flags\n\n      const ruleData = {\n        name: String(name),\n        description: dialog.find('#rule-description').val(),\n        operation: 'replace', // \n        pattern: finalPattern, //  pattern flags\n        flags: finalFlags, //  flags\n        replacement: dialog.find('#rule-replacement').val(),\n        scope,\n        enabled: true, // \n        priority: parseInt(dialog.find('#rule-priority').val(), 10),\n        executeMode: 'auto', // \n      };\n\n      // \n      if (editRuleId) {\n        // \n        RegexTransformationManager.updateRule(editRuleId, ruleData);\n      } else {\n        // \n        const newRule = RegexTransformationManager.addCustomRule(ruleData);\n        if (newRule) {\n          editRuleId = newRule.id;\n        }\n      }\n\n      // [] \n      dialog.remove();\n      $(document).off('keydown.regex-rule-modal'); // ESC\n      refreshRegexRulesList(); // \n    });\n\n    //  isSettingsOpen\n    const closeDialog = () => {\n      dialog.remove();\n      $(document).off('keydown.regex-rule-modal'); // ESC\n    };\n\n    // \n    dialog.find('#acu-regex-rule-cancel, #acu-close-regex-rule').on('click', function (e) {\n      e.stopPropagation();\n      closeDialog();\n    });\n\n    // \n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n\n    // ESC \n    $(document).on('keydown.regex-rule-modal', function (e) {\n      if (e.key === 'Escape' && dialog.length && dialog.is(':visible')) {\n        e.preventDefault();\n        closeDialog();\n        $(document).off('keydown.regex-rule-modal'); // \n      }\n    });\n\n    $('body').append(dialog);\n\n    // DOMtextarea\n    requestAnimationFrame(() => {\n      const $textarea = dialog.find('#rule-description');\n      if ($textarea.length && $textarea[0].scrollHeight > 34) {\n        $textarea.css('height', $textarea[0].scrollHeight + 'px');\n      }\n    });\n  };\n\n  // \n  window.showAddRegexRuleModal = showAddRegexRuleModal;\n\n  // \n  window.showDebugConsoleModal = showDebugConsoleModal;\n\n  // ========================================\n  // AcuDice  API - \n  // ========================================\n\n  const ACUDICE_READY_EVENT = 'acudice:ready';\n\n  const resolveRootWindow = (): Window => {\n    try {\n      return window.top ?? window;\n    } catch (error) {\n      return window;\n    }\n  };\n\n  const rootWindow = resolveRootWindow();\n  const readyCallbacks: Array<() => void> = [];\n  let isAcuDiceReady = false;\n\n  const runReadyCallback = (callback: () => void) => {\n    try {\n      callback();\n    } catch (error) {\n      console.error('[AcuDice] onReady ', error);\n    }\n  };\n\n  const notifyReady = () => {\n    if (isAcuDiceReady) return;\n    isAcuDiceReady = true;\n    for (const callback of readyCallbacks) {\n      runReadyCallback(callback);\n    }\n    readyCallbacks.length = 0;\n  };\n\n  const defineAcuDiceOnWindow = (target: Window) => {\n    if ('AcuDice' in target) return;\n    Object.defineProperty(target, 'AcuDice', {\n      value: AcuDiceAPI,\n      writable: false,\n      configurable: false,\n    });\n  };\n\n  const dispatchReadyEvent = (target: Window) => {\n    try {\n      target.dispatchEvent(new CustomEvent(ACUDICE_READY_EVENT));\n    } catch (error) {\n      console.warn('[AcuDice] ready ', error);\n    }\n  };\n\n  // \n  const eventHandlers: Map<string, Set<Function>> = new Map();\n  type CheckHistoryEntry = AcuDice.CheckResult & CheckHistoryExtension & { timestamp: number };\n  type ContestHistoryEntry = AcuDice.ContestResult & { timestamp: number; detailId?: string; detailLines?: string[] };\n  type AcuDiceSharedHistoryStore = {\n    checkHistory: CheckHistoryEntry[];\n    contestHistory: ContestHistoryEntry[];\n    maxHistory: number;\n  };\n  type RootWindowWithAcuDiceHistory = Window & {\n    __AcuDiceHistoryStore__?: AcuDiceSharedHistoryStore;\n  };\n  const rootWindowWithHistory = rootWindow as RootWindowWithAcuDiceHistory;\n  if (!rootWindowWithHistory.__AcuDiceHistoryStore__) {\n    rootWindowWithHistory.__AcuDiceHistoryStore__ = {\n      checkHistory: [],\n      contestHistory: [],\n      maxHistory: 100,\n    };\n  }\n  const sharedHistoryStore = rootWindowWithHistory.__AcuDiceHistoryStore__;\n  const checkHistory: CheckHistoryEntry[] = sharedHistoryStore.checkHistory;\n  const contestHistory: ContestHistoryEntry[] = sharedHistoryStore.contestHistory;\n  const MAX_HISTORY = sharedHistoryStore.maxHistory;\n\n  const globalExpandedHistoryIds = new Set<string>();\n  let globalHistoryFilterStatus = 'all';\n  let globalHistoryKeyword = '';\n  let globalHistoryStatsScope: DiceStatsScope = 'chat';\n\n  const copyTextWithTavernApi = async (text: string): Promise<boolean> => {\n    try {\n      if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n        const safeContent = text\n          .replace(/\\\\/g, '\\\\\\\\')\n          .replace(/\"/g, '\\\\\"')\n          .replace(/\\n/g, '\\\\n')\n          .replace(/\\{/g, '\\\\{')\n          .replace(/\\}/g, '\\\\}');\n        await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n        return true;\n      }\n    } catch (error) {\n      console.warn('[DICE] history copy via TavernHelper failed:', error);\n    }\n\n    try {\n      if (navigator.clipboard && window.isSecureContext) {\n        await navigator.clipboard.writeText(text);\n        return true;\n      }\n    } catch (error) {\n      console.warn('[DICE] history copy via navigator.clipboard failed:', error);\n    }\n\n    try {\n      const textArea = document.createElement('textarea');\n      textArea.value = text;\n      textArea.style.position = 'fixed';\n      textArea.style.left = '-9999px';\n      textArea.style.top = '0';\n      textArea.setAttribute('readonly', '');\n      document.body.appendChild(textArea);\n      textArea.select();\n      textArea.setSelectionRange(0, 99999);\n      const successful = document.execCommand('copy');\n      document.body.removeChild(textArea);\n      return successful;\n    } catch (error) {\n      console.error('[DICE] history copy fallback failed:', error);\n      return false;\n    }\n  };\n\n  const showGlobalDiceHistoryDialog = () => {\n    $('.acu-dice-history-overlay').remove();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const detailCopyTextMap = new Map<string, string>();\n\n    const renderHistoryItems = (): string => {\n      type UnifiedItem =\n        | (CheckHistoryEntry & { historyType: 'check' })\n        | (ContestHistoryEntry & { historyType: 'contest' });\n\n      detailCopyTextMap.clear();\n\n      const items: UnifiedItem[] = [\n        ...checkHistory.map(item => ({ ...item, historyType: 'check' as const })),\n        ...contestHistory.map(item => ({ ...item, historyType: 'contest' as const })),\n      ]\n        .sort((a, b) => b.timestamp - a.timestamp)\n        .filter(item => {\n          if (globalHistoryFilterStatus !== 'all') {\n            const status = String((item as Record<string, unknown>).effectStatus || '');\n            if (!status || status !== globalHistoryFilterStatus) return false;\n          }\n          const keyword = globalHistoryKeyword.trim().toLowerCase();\n          if (!keyword) return true;\n          const raw = item as Record<string, unknown>;\n          const left = (raw.left || {}) as Record<string, unknown>;\n          const right = (raw.right || {}) as Record<string, unknown>;\n          const haystack = [\n            raw.attrName,\n            raw.message,\n            raw.outcomeText,\n            raw.initiatorName,\n            left.name,\n            right.name,\n            raw.effectStatus,\n          ]\n            .map(text => String(text || '').toLowerCase())\n            .join(' ');\n          return haystack.includes(keyword);\n        })\n        .slice(0, 80);\n\n      if (items.length === 0) {\n        return `<div style=\"padding:20px 12px; color:var(--acu-text-sub); text-align:center; display:flex; flex-direction:column; gap:8px; align-items:center;\"><i class=\"fa-solid fa-dice-d20\" style=\"font-size:20px; opacity:.35;\"></i><span></span></div>`;\n      }\n\n      const statusTextMap: Record<string, string> = {\n        planned: '',\n        confirmed: '',\n        committed: '',\n        failed: '',\n        cancelled: '',\n      };\n      const statusColorMap: Record<string, string> = {\n        planned: 'var(--acu-text-sub)',\n        confirmed: 'var(--acu-accent)',\n        committed: 'var(--acu-success-text)',\n        failed: 'var(--acu-error-text)',\n        cancelled: 'var(--acu-text-sub)',\n      };\n\n      return items\n        .map(item => {\n          const raw = item as Record<string, unknown>;\n          const isContest = item.historyType === 'contest';\n          const left = (raw.left || {}) as Record<string, unknown>;\n          const right = (raw.right || {}) as Record<string, unknown>;\n          const status = String(raw.effectStatus || '');\n          const statusText = status ? statusTextMap[status] || status : '';\n          const statusColor = status ? statusColorMap[status] || 'var(--acu-text-sub)' : 'var(--acu-text-sub)';\n\n          const detailId = String(raw.detailId || raw.effectRunId || `${item.historyType}-${item.timestamp}`);\n          const detailLinesRaw = Array.isArray(raw.detailLines) ? (raw.detailLines as unknown[]) : [];\n          const traceLinesRaw = Array.isArray(raw.effectTrace) ? (raw.effectTrace as unknown[]) : [];\n          const detailLines = detailLinesRaw.map(line => String(line || '').trim()).filter(Boolean);\n          const traceLines = traceLinesRaw.map(line => String(line || '').trim()).filter(Boolean);\n          const canExpand = detailLines.length > 0 || traceLines.length > 0;\n          const isExpanded = canExpand && globalExpandedHistoryIds.has(detailId);\n\n          let title = String(raw.attrName || '');\n          let subtitle = String(raw.outcomeText || (raw.success ? '' : ''));\n          let resultColor = raw.success ? 'var(--acu-success-text)' : 'var(--acu-error-text)';\n          let rollText = `${String(raw.total ?? '-')}/${String(raw.target ?? '-')}`;\n          let typeTag = '';\n\n          if (isContest) {\n            typeTag = '';\n            title = `${String(left.name || '')} vs ${String(right.name || '')}`;\n            subtitle = String(raw.message || '');\n            const winner = String(raw.winner || 'tie');\n            resultColor = winner === 'tie' ? 'var(--acu-text-sub)' : 'var(--acu-accent)';\n            rollText = `${String(left.roll ?? '-')} : ${String(right.roll ?? '-')}`;\n          } else {\n            const initiator = String(raw.initiatorName || '').trim();\n            if (initiator) title = `${initiator}  ${title}`;\n          }\n\n          const pushedBadge = raw.isPushed\n            ? '<i class=\"fa-solid fa-skull\" style=\"font-size:10px;color:var(--acu-text-sub);margin-left:4px;\" title=\"\"></i>'\n            : '';\n\n          const sections: string[] = [];\n          if (detailLines.length > 0) {\n            sections.push(\n              `<div><div style=\"font-weight:700; color:var(--acu-text-main); margin-bottom:4px;\"></div>${detailLines.map(line => escapeHtml(line)).join('<br>')}</div>`,\n            );\n          }\n          if (traceLines.length > 0) {\n            sections.push(\n              `<div><div style=\"font-weight:700; color:var(--acu-text-main); margin-bottom:4px;\"></div>${traceLines.map(line => escapeHtml(line)).join('<br>')}</div>`,\n            );\n          }\n\n          if (canExpand) {\n            const copyParts: string[] = [\n              `[${typeTag}] ${title}`,\n              `: ${new Date(item.timestamp).toLocaleString('zh-CN')}`,\n            ];\n            if (subtitle) copyParts.push(`: ${subtitle}`);\n            if (rollText) copyParts.push(`: ${rollText}`);\n            if (detailLines.length > 0) copyParts.push('---  ---', ...detailLines);\n            if (traceLines.length > 0) copyParts.push('---  ---', ...traceLines);\n            detailCopyTextMap.set(detailId, copyParts.join('\\n'));\n          }\n\n          const detailHtml =\n            canExpand && isExpanded\n              ? `<div style=\"margin-top:8px; padding:9px 10px; background: color-mix(in srgb, var(--acu-card-bg) 72%, transparent); border:1px solid var(--acu-border); border-radius:6px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:11px; line-height:1.45; color:var(--acu-text-sub); white-space: normal;\">${sections.join('<div style=\"height:1px; background:var(--acu-border); margin:8px 0;\"></div>')}</div>`\n              : '';\n\n          return `\n            <div style=\"padding:10px 12px; border:1px solid var(--acu-border); border-radius:10px; margin-bottom:8px; background:var(--acu-bg-panel);\">\n              <div style=\"display:flex; justify-content:space-between; align-items:flex-start; gap:8px;\">\n                <div style=\"min-width:0; flex:1;\">\n                  <div style=\"display:flex; align-items:center; gap:6px;\">\n                    <span style=\"font-size:10px; color:var(--acu-text-sub); border:1px solid var(--acu-border); border-radius:999px; padding:1px 7px;\">${typeTag}</span>\n                    <span style=\"font-weight:700; color:var(--acu-text-main); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;\">${escapeHtml(title)}${pushedBadge}</span>\n                    ${canExpand ? `<button class=\"acu-history-detail-copy\" data-detail-id=\"${escapeHtml(detailId)}\" title=\"\" style=\"border:1px solid var(--acu-border); background:var(--acu-btn-bg); color:var(--acu-text-sub); border-radius:6px; width:24px; height:24px; display:inline-flex; align-items:center; justify-content:center; cursor:pointer; flex-shrink:0;\"><i class=\"fa-solid fa-copy\"></i></button>` : ''}\n                  </div>\n                  <div style=\"margin-top:6px; display:flex; align-items:center; gap:8px; flex-wrap:wrap; font-size:12px;\">\n                    <span style=\"color:${resultColor}; font-weight:700;\">${escapeHtml(subtitle)}</span>\n                    <span style=\"color:var(--acu-text-sub); font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;\">${escapeHtml(rollText)}</span>\n                    ${statusText ? `<span style=\"color:${statusColor}; border:1px solid color-mix(in srgb, ${statusColor} 40%, transparent); border-radius:999px; padding:1px 7px; font-size:11px;\">:${statusText}</span>` : ''}\n                  </div>\n                </div>\n                <div style=\"display:flex; align-items:center; gap:5px; flex-shrink:0;\">\n                  <span style=\"font-size:12px; color:var(--acu-text-sub);\">${new Date(item.timestamp).toLocaleTimeString('zh-CN', { hour12: false })}</span>\n                  ${canExpand ? `<button class=\"acu-history-trace-toggle\" data-run-id=\"${escapeHtml(detailId)}\" style=\"border:none;background:transparent;color:var(--acu-text-sub);cursor:pointer;padding:2px 4px;font-size:13px;\" title=\"${isExpanded ? '' : ''}\">${isExpanded ? '' : ''}</button>` : ''}\n                </div>\n              </div>\n              ${detailHtml}\n            </div>\n          `;\n        })\n        .join('');\n    };\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-dice-history-overlay\">\n        <div class=\"acu-edit-dialog ${currentThemeClass}\" style=\"max-width:600px; width:min(94vw,600px); max-height:82vh; display:flex; flex-direction:column; padding:14px;\">\n          <div style=\"display:flex; justify-content:space-between; align-items:center; padding-bottom:8px; border-bottom:1px solid var(--acu-border);\">\n            <div style=\"font-size:19px; color:var(--acu-text-main); font-weight:700; display:flex; align-items:center; gap:8px;\"><i class=\"fa-solid fa-clock-rotate-left\" style=\"color:var(--acu-accent);\"></i> </div>\n            <button class=\"acu-close-btn acu-history-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div style=\"display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:8px; margin-top:6px; align-items:center;\">\n            <select id=\"acu-history-scope-filter\" class=\"acu-dice-select\" style=\"width:100%; min-width:0;\">\n              <option value=\"chat\"></option>\n              <option value=\"character\"></option>\n              <option value=\"global\"></option>\n            </select>\n            <select id=\"acu-history-status-filter\" class=\"acu-dice-select\" style=\"width:100%; min-width:0;\">\n              <option value=\"all\"></option>\n              <option value=\"planned\"></option>\n              <option value=\"confirmed\"></option>\n              <option value=\"committed\"></option>\n              <option value=\"failed\"></option>\n              <option value=\"cancelled\"></option>\n            </select>\n            <div style=\"position:relative; min-width:0;\">\n              <i class=\"fa-solid fa-search\" style=\"position:absolute; left:11px; top:50%; transform:translateY(-50%); font-size:12px; color:var(--acu-text-sub); pointer-events:none;\"></i>\n              <input id=\"acu-history-search\" class=\"acu-dice-input\" style=\"width:100%; padding-left:34px !important;\" placeholder=\"\" value=\"${escapeHtml(globalHistoryKeyword)}\">\n            </div>\n          </div>\n          <div id=\"acu-dice-history-stats\" style=\"margin-top:2px; padding:9px; border:1px solid var(--acu-border); border-radius:8px; background:var(--acu-card-bg);\"></div>\n          <div id=\"acu-dice-history-list\" style=\"margin-top:8px; overflow-y:auto; flex:1; min-height:220px; max-height:52vh; -webkit-overflow-scrolling:touch; overscroll-behavior:contain; touch-action:pan-y;\">\n            ${renderHistoryItems()}\n          </div>\n          <div style=\"display:flex; justify-content:flex-end; gap:8px; padding-top:10px; border-top:1px solid var(--acu-border); margin-top:8px;\">\n            <button class=\"acu-dialog-btn\" id=\"acu-history-clear\" style=\"background:var(--acu-btn-bg); border-color:var(--acu-border);\"><i class=\"fa-solid fa-trash\"></i> </button>\n            <button class=\"acu-dialog-btn acu-history-close\"><i class=\"fa-solid fa-times\"></i> </button>\n          </div>\n        </div>\n      </div>\n    `);\n    $('body').append(dialog);\n\n    const renderHistoryStats = async () => {\n      const $stats = dialog.find('#acu-dice-history-stats');\n      if ($stats.length === 0) return;\n      const allStats = await DiceHistoryStatsDB.getDashboardStats();\n      const activeStats = allStats[globalHistoryStatsScope];\n      const context = getDiceStatsContext();\n      const mobile = window.innerWidth <= 640;\n      const scopeLabelMap: Record<DiceStatsScope, string> = {\n        chat: '',\n        character: '',\n        global: '',\n      };\n      const scopeUnavailable =\n        (globalHistoryStatsScope === 'chat' && context.chatId === 'unknown_chat') ||\n        (globalHistoryStatsScope === 'character' && context.characterId === 'unknown_character');\n\n      $stats.html(`\n        <div style=\"display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:${mobile ? '6px' : '8px'}; margin-bottom:8px;\">\n          <div style=\"padding:${mobile ? '6px' : '8px'}; border:1px solid var(--acu-border); border-radius:6px;\"><div style=\"font-size:${mobile ? '10px' : '11px'}; color:var(--acu-text-sub);\"></div><div style=\"font-size:${mobile ? '16px' : '18px'}; font-weight:700; color:var(--acu-text-main);\">${allStats.chat.total}</div></div>\n          <div style=\"padding:${mobile ? '6px' : '8px'}; border:1px solid var(--acu-border); border-radius:6px;\"><div style=\"font-size:${mobile ? '10px' : '11px'}; color:var(--acu-text-sub);\"></div><div style=\"font-size:${mobile ? '16px' : '18px'}; font-weight:700; color:var(--acu-text-main);\">${allStats.character.total}</div></div>\n          <div style=\"padding:${mobile ? '6px' : '8px'}; border:1px solid var(--acu-border); border-radius:6px;\"><div style=\"font-size:${mobile ? '10px' : '11px'}; color:var(--acu-text-sub);\"></div><div style=\"font-size:${mobile ? '16px' : '18px'}; font-weight:700; color:var(--acu-text-main);\">${allStats.global.total}</div></div>\n        </div>\n        <div style=\"display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; font-size:${mobile ? '11px' : '12px'};\">\n          <div style=\"color:var(--acu-text-sub);\">${scopeLabelMap[globalHistoryStatsScope]}</div>\n          <div style=\"display:flex; gap:8px; flex-wrap:wrap;\">\n            <span style=\"color:var(--acu-text-main);\"><b>${activeStats.total}</b></span>\n            <span style=\"color:var(--acu-text-main);\"><b>${activeStats.checks}</b></span>\n            <span style=\"color:var(--acu-text-main);\"><b>${activeStats.contests}</b></span>\n            <span style=\"color:var(--acu-text-main);\"><b style=\"color:var(--acu-success-text);\">${activeStats.checkSuccessRate}%</b></span>\n          </div>\n        </div>\n        ${scopeUnavailable ? '<div style=\"margin-top:6px; font-size:11px; color:var(--acu-text-sub);\">ID</div>' : ''}\n      `);\n    };\n\n    const rerender = () => {\n      dialog.find('#acu-dice-history-list').html(renderHistoryItems());\n      void renderHistoryStats();\n    };\n\n    dialog.find('#acu-history-status-filter').val(globalHistoryFilterStatus);\n    dialog.find('#acu-history-scope-filter').val(globalHistoryStatsScope);\n\n    const refreshByEvent = () => rerender();\n    const canListen = Boolean(window.AcuDice && typeof window.AcuDice.on === 'function');\n    if (canListen) {\n      window.AcuDice.on('check', refreshByEvent);\n      window.AcuDice.on('contest', refreshByEvent);\n      window.AcuDice.on('effect_run', refreshByEvent);\n    }\n\n    void renderHistoryStats();\n\n    dialog.on('change', '#acu-history-scope-filter', function () {\n      const val = String($(this).val() || 'chat') as DiceStatsScope;\n      globalHistoryStatsScope = val === 'character' || val === 'global' ? val : 'chat';\n      void renderHistoryStats();\n    });\n\n    dialog.on('change', '#acu-history-status-filter', function () {\n      globalHistoryFilterStatus = String($(this).val() || 'all');\n      rerender();\n    });\n\n    dialog.on('input', '#acu-history-search', function () {\n      globalHistoryKeyword = String($(this).val() || '');\n      rerender();\n    });\n\n    dialog.on('touchstart touchmove', '#acu-dice-history-list', function (e) {\n      e.stopPropagation();\n    });\n\n    dialog.on('click', '.acu-history-trace-toggle', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const runId = String($(this).data('run-id') || '');\n      if (!runId) return;\n      if (globalExpandedHistoryIds.has(runId)) globalExpandedHistoryIds.delete(runId);\n      else globalExpandedHistoryIds.add(runId);\n      rerender();\n    });\n\n    dialog.on('click', '.acu-history-detail-copy', async function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const detailId = String($(this).data('detail-id') || '');\n      const detailText = (detailCopyTextMap.get(detailId) || '').trim();\n      if (!detailText) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      const ok = await copyTextWithTavernApi(detailText);\n      if (window.toastr) {\n        if (ok) window.toastr.success('');\n        else window.toastr.error('');\n      }\n    });\n\n    dialog.on('click', '#acu-history-clear', async function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const ok = window.confirm('');\n      if (!ok) return;\n      checkHistory.length = 0;\n      contestHistory.length = 0;\n      globalExpandedHistoryIds.clear();\n      await DiceHistoryStatsDB.clear();\n      rerender();\n      if (window.toastr) window.toastr.success('');\n    });\n\n    const closeDialog = () => {\n      if (canListen) {\n        window.AcuDice.off('check', refreshByEvent);\n        window.AcuDice.off('contest', refreshByEvent);\n        window.AcuDice.off('effect_run', refreshByEvent);\n      }\n      dialog.remove();\n    };\n    dialog.on('click', '.acu-history-close', closeDialog);\n    setupOverlayClose(dialog, 'acu-dice-history-overlay', closeDialog);\n  };\n\n  function emitEvent(event: string, data: any) {\n    if (event === 'check' || event === 'contest') {\n      void DiceHistoryStatsDB.recordEvent(event, data);\n    }\n    const handlers = eventHandlers.get(event);\n    if (handlers) {\n      handlers.forEach(handler => {\n        try {\n          handler(data);\n        } catch (e) {\n          console.error('[AcuDice] Event handler error:', e);\n        }\n      });\n    }\n  }\n\n  /**\n   * AcuDice  API\n   * \n   */\n  const AcuDiceAPI = {\n    /** API  */\n    version: '1.2.0',\n\n    /**\n     * \n     * @param formula  \"2d6\", \"1d20+5\", \"4d6kh3\"\n     * @returns \n     * @example\n     * AcuDice.roll('2d6') // => { total: 7, formula: '2d6', breakdown: '2d6 = 7' }\n     * AcuDice.roll('1d20+5') // => { total: 15, formula: '1d20+5', breakdown: '1d20+5 = 15' }\n     */\n    roll(formula: string): { total: number; formula: string; breakdown: string } {\n      if (!formula || typeof formula !== 'string') {\n        throw new Error('[AcuDice] roll() ');\n      }\n      //  2d6 3+5\n      const hasDice = /\\d*d(\\d+|F)/i.test(formula);\n      const isMath = /^[\\d\\s+\\-*/().]+$/.test(formula.trim());\n      if (!hasDice && !isMath) {\n        throw new Error(`[AcuDice] : ${formula}`);\n      }\n      const total = evaluateFormula(formula, {});\n      return {\n        total,\n        formula,\n        breakdown: `${formula} = ${total}`,\n      };\n    },\n\n    /**\n     * /\n     * @param options \n     * @returns \n     * @example\n     * await AcuDice.check({ attribute: '' })\n     * await AcuDice.check({ attribute: '', targetValue: 50, diceType: '1d100' })\n     */\n    async check(\n      options: {\n        attribute?: string;\n        skill?: string;\n        targetValue?: number;\n        diceType?: string;\n        successCriteria?: 'lte' | 'gte';\n        modifier?: number;\n      } = {},\n    ): Promise<{\n      success: boolean;\n      roll: number;\n      target: number;\n      margin: number;\n      criticalSuccess: boolean;\n      criticalFailure: boolean;\n      message: string;\n      diceType: string;\n      rule: 'coc' | 'dnd';\n    }> {\n      const diceCfg = getDiceConfig();\n      const diceType = options.diceType || diceCfg.lastDiceType || '1d100';\n      const successCriteria = options.successCriteria || (diceType === '1d20' ? 'gte' : 'lte');\n      const isDND = successCriteria === 'gte';\n      const modifier = options.modifier || 0;\n\n      // \n      let targetValue = options.targetValue;\n\n      // \n      if (targetValue === undefined && (options.attribute || options.skill)) {\n        const attrName = options.attribute || options.skill || '';\n        const rawData = cachedRawData || getTableData();\n\n        if (rawData) {\n          // \n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (sheet?.name === '' && sheet.content?.[1]) {\n              const headers = sheet.content[0] || [];\n              const row = sheet.content[1];\n              for (let idx = 0; idx < headers.length; idx++) {\n                const h = headers[idx];\n                if (h && (h.includes('') || h.includes(''))) {\n                  const parsed = parseAttributeString(row[idx] || '');\n                  const found = parsed.find((attr: { name: string; value: number }) => attr.name === attrName);\n                  if (found) {\n                    targetValue = found.value;\n                    break;\n                  }\n                }\n              }\n              if (targetValue !== undefined) break;\n            }\n          }\n        }\n\n        if (targetValue === undefined) {\n          throw new Error(`[AcuDice] : ${attrName}`);\n        }\n      }\n\n      if (targetValue === undefined) {\n        throw new Error('[AcuDice] check()  targetValue  attribute/skill ');\n      }\n\n      // \n      const rollResult = rollComplexDiceExpression(diceType);\n      if (Number.isNaN(rollResult.total)) {\n        throw new Error(`[AcuDice] : ${diceType}`);\n      }\n\n      const finalRoll = rollResult.total + modifier;\n      const target = targetValue;\n\n      // \n      let success = false;\n      let criticalSuccess = false;\n      let criticalFailure = false;\n      let message = '';\n\n      if (isDND) {\n        // DND : roll >= target \n        success = finalRoll >= target;\n        criticalSuccess = rollResult.total === diceCfg.dndCritSuccess;\n        criticalFailure = rollResult.total === diceCfg.dndCritFail;\n\n        if (criticalSuccess) {\n          success = true;\n          message = ` ${rollResult.total}${modifier ? ` + ${modifier}` : ''} = ${finalRoll}DC ${target}`;\n        } else if (criticalFailure) {\n          success = false;\n          message = ` ${rollResult.total}${modifier ? ` + ${modifier}` : ''} = ${finalRoll}DC ${target}`;\n        } else if (success) {\n          message = ` ${finalRoll} >= DC ${target}`;\n        } else {\n          message = ` ${finalRoll} < DC ${target}`;\n        }\n      } else {\n        // COC : roll <= target \n        success = finalRoll <= target;\n        criticalSuccess = finalRoll <= diceCfg.critSuccessMax;\n        criticalFailure = finalRoll >= diceCfg.critFailMin;\n\n        if (criticalSuccess) {\n          success = true;\n          message = ` ${finalRoll} ${target}`;\n        } else if (criticalFailure) {\n          success = false;\n          message = ` ${finalRoll} ${target}`;\n        } else if (success) {\n          const hardSuccess = finalRoll <= Math.floor(target / diceCfg.hardSuccessDiv);\n          const extremeSuccess = finalRoll <= Math.floor(target / diceCfg.difficultSuccessDiv);\n          if (extremeSuccess) {\n            message = ` ${finalRoll} <= ${Math.floor(target / diceCfg.difficultSuccessDiv)}`;\n          } else if (hardSuccess) {\n            message = ` ${finalRoll} <= ${Math.floor(target / diceCfg.hardSuccessDiv)}`;\n          } else {\n            message = ` ${finalRoll} <= ${target}`;\n          }\n        } else {\n          message = ` ${finalRoll} > ${target}`;\n        }\n      }\n\n      const checkResult: AcuDice.CheckResult = {\n        success,\n        total: finalRoll,\n        target,\n        outcomeText: message,\n        attrName: options.attribute || options.skill || '',\n        formula: diceType,\n        criteria: isDND ? 'gte' : 'lte',\n        isAutoTarget: options.targetValue === undefined,\n      };\n\n      // \n      const detailId = `check_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n      const attrLabel = options.attribute || options.skill || '';\n      const checkResultWithTimestamp = {\n        ...checkResult,\n        timestamp: Date.now(),\n        detailId,\n        initiatorName: 'API',\n        historyType: 'check' as const,\n        detailLines: [\n          `: API`,\n          `: ${attrLabel} (=${target})`,\n          `: ${diceType}`,\n          `: ${finalRoll}`,\n          `: ${target}`,\n          ...(modifier ? [`: ${modifier >= 0 ? '+' + modifier : modifier}`] : []),\n          `: ${message}`,\n        ],\n      };\n      checkHistory.push(checkResultWithTimestamp);\n      if (checkHistory.length > MAX_HISTORY) {\n        checkHistory.shift();\n      }\n\n      // \n      emitEvent('check', checkResultWithTimestamp);\n\n      return {\n        success,\n        roll: finalRoll,\n        target,\n        margin: isDND ? finalRoll - target : target - finalRoll,\n        criticalSuccess,\n        criticalFailure,\n        message,\n        diceType,\n        rule: isDND ? 'dnd' : 'coc',\n      };\n    },\n\n    /**\n     *  - API \n     * @param callback \n     */\n    onReady(callback: () => void): void {\n      if (typeof callback !== 'function') {\n        console.warn('[AcuDice] onReady() ');\n        return;\n      }\n\n      if (isAcuDiceReady) {\n        runReadyCallback(callback);\n        return;\n      }\n\n      readyCallbacks.push(callback);\n    },\n\n    /**\n     * \n     * @param event  ('check' | 'contest')\n     * @param handler \n     */\n    on(event: string, handler: Function): void {\n      if (!eventHandlers.has(event)) {\n        eventHandlers.set(event, new Set());\n      }\n      eventHandlers.get(event)!.add(handler);\n    },\n\n    /**\n     * \n     * @param event  ('check' | 'contest')\n     * @param handler \n     */\n    off(event: string, handler: Function): void {\n      const handlers = eventHandlers.get(event);\n      if (handlers) {\n        handlers.delete(handler);\n      }\n    },\n\n    /**\n     * \n     */\n    getLatestCheck(): (AcuDice.CheckResult & { timestamp: number }) | null {\n      return checkHistory.length > 0 ? checkHistory[checkHistory.length - 1] : null;\n    },\n\n    /**\n     * \n     */\n    getLatestContest(): (AcuDice.ContestResult & { timestamp: number }) | null {\n      return contestHistory.length > 0 ? contestHistory[contestHistory.length - 1] : null;\n    },\n\n    /**\n     * \n     * @param options \n     * @param options.limit \n     * @param options.type  ('check' | 'contest')\n     */\n    getHistory(options?: { limit?: number; type?: 'check' | 'contest' }): Array<any> {\n      const limit = options?.limit;\n      const type = options?.type;\n\n      let results: Array<any> = [];\n\n      if (!type || type === 'check') {\n        results = results.concat(checkHistory.map(item => ({ ...item, _type: 'check' })));\n      }\n      if (!type || type === 'contest') {\n        results = results.concat(contestHistory.map(item => ({ ...item, _type: 'contest' })));\n      }\n\n      // \n      results.sort((a, b) => b.timestamp - a.timestamp);\n\n      //  limit\n      if (limit && limit > 0) {\n        results = results.slice(0, limit);\n      }\n\n      return results;\n    },\n\n    /**\n     * \n     * @returns \n     */\n    listPresets(): Array<{ id: string; name: string; description?: string; builtin: boolean }> {\n      const allPresets = ActionPresetManager.getAllPresets();\n      return allPresets.map((p: any) => ({\n        id: p.id,\n        name: p.name,\n        description: p.description || '',\n        builtin: !!p.builtin,\n      }));\n    },\n\n    /**\n     *  ID\n     * @returns  ID  null\n     */\n    getActivePresetId(): string | null {\n      const id = ActionPresetManager.getActivePresetId();\n      return id === '__none__' ? null : id;\n    },\n\n    /**\n     * \n     * @param presetId  ID\n     * @returns  null\n     */\n    getPresetSummary(presetId: string): { id: string; name: string; description?: string; builtin: boolean } | null {\n      const preset = ActionPresetManager.getPresetById(presetId);\n      if (!preset) return null;\n      return {\n        id: preset.id,\n        name: preset.name,\n        description: preset.description || '',\n        builtin: !!preset.builtin,\n      };\n    },\n\n    /**\n     * \n     * @returns  '<user>'  NPC\n     * @example\n     * AcuDice.listCharacters() // => ['<user>', 'NPC1', 'NPC2']\n     */\n    listCharacters(): string[] {\n      const rawData = cachedRawData || getTableData();\n      if (!rawData) return [];\n\n      const allTables = processJsonData(rawData || {});\n      const characters: string[] = [];\n\n      // \n      const playerResult = DashboardDataParser.findTable(allTables, 'player');\n      if (playerResult?.data?.rows?.length > 0) {\n        characters.push('<user>');\n      }\n\n      //  NPC\n      const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n      if (npcResult) {\n        const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n        npcParsed.forEach(npc => {\n          if (npc.name && typeof npc.name === 'string') {\n            characters.push(npc.name);\n          }\n        });\n      }\n\n      return characters;\n    },\n\n    /**\n     * \n     * @param name  '<user>'  NPC \n     * @returns  name  value\n     * @example\n     * AcuDice.getCharacterAttributes('<user>') // => [{ name: '', value: 50 }, { name: '', value: 60 }]\n     * AcuDice.getCharacterAttributes('') // => [{ name: '', value: 70 }]\n     */\n    getCharacterAttributes(name: string): Array<{ name: string; value: number }> {\n      if (!name || typeof name !== 'string') {\n        throw new Error('[AcuDice] getCharacterAttributes() ');\n      }\n      return getFullAttributesForCharacter(name);\n    },\n\n    /**\n     * \n     * @param name \n     * @param attribute \n     * @returns  null\n     * @example\n     * AcuDice.getAttributeValue('<user>', '') // => 50\n     * AcuDice.getAttributeValue('', '') // => 60\n     */\n    getAttributeValue(name: string, attribute: string): number | null {\n      if (!name || typeof name !== 'string') {\n        throw new Error('[AcuDice] getAttributeValue() ');\n      }\n      if (!attribute || typeof attribute !== 'string') {\n        throw new Error('[AcuDice] getAttributeValue() ');\n      }\n      return getAttributeValue(name, attribute);\n    },\n\n    /**\n     * \n     * @param options \n     * @returns \n     * @example\n     * await AcuDice.checkByCharacter({ name: '<user>', attribute: '' })\n     * await AcuDice.checkByCharacter({ name: 'NPC1', attribute: '', modifier: 5 })\n     */\n    async checkByCharacter(options: {\n      name: string;\n      attribute: string;\n      modifier?: number;\n      diceType?: string;\n      successCriteria?: 'lte' | 'gte';\n    }): Promise<{\n      success: boolean;\n      roll: number;\n      target: number;\n      margin: number;\n      criticalSuccess: boolean;\n      criticalFailure: boolean;\n      message: string;\n      diceType: string;\n      rule: 'coc' | 'dnd';\n    }> {\n      if (!options || !options.name || !options.attribute) {\n        throw new Error('[AcuDice] checkByCharacter()  name  attribute ');\n      }\n\n      // \n      const targetValue = getAttributeValue(options.name, options.attribute);\n      if (targetValue === null) {\n        throw new Error(`[AcuDice]  \"${options.name}\"  \"${options.attribute}\"`);\n      }\n\n      //  check \n      return this.check({\n        attribute: options.attribute,\n        targetValue,\n        modifier: options.modifier,\n        diceType: options.diceType,\n        successCriteria: options.successCriteria,\n      });\n    },\n\n    /**\n     * \n     * @param options \n     * @returns \n     * @example\n     * await AcuDice.contest({\n     *   left: { name: '<user>', attribute: '' },\n     *   right: { name: 'NPC1', attribute: '' }\n     * })\n     */\n    async contest(options: {\n      left?: { name: string; attribute: string; targetValue?: number };\n      right?: { name: string; attribute: string; targetValue?: number };\n      /** @deprecated  left  */\n      attacker?: { name: string; attribute: string; targetValue?: number };\n      /** @deprecated  right  */\n      defender?: { name: string; attribute: string; targetValue?: number };\n      rule?: 'initiator_win' | 'initiator_lose' | 'tie';\n    }): Promise<{\n      left: { name: string; attribute: string; roll: number; target: number; successLevel: number };\n      right: { name: string; attribute: string; roll: number; target: number; successLevel: number };\n      winner: 'left' | 'right' | 'tie';\n      message: string;\n    }> {\n      //  attacker/defender \n      const left = options?.left || options?.attacker;\n      const right = options?.right || options?.defender;\n\n      if (!left?.name || !left?.attribute) {\n        throw new Error('[AcuDice] contest()  left.name  left.attribute ');\n      }\n      if (!right?.name || !right?.attribute) {\n        throw new Error('[AcuDice] contest()  right.name  right.attribute ');\n      }\n\n      try {\n        const rawDataForAlias = cachedRawData || getTableData();\n        if (rawDataForAlias) {\n          NameAliasRegistry.rebuild(processJsonData(rawDataForAlias || {}));\n        }\n      } catch (error) {\n        console.warn('[AcuDice] contest() ', error);\n      }\n\n      const leftName = left.name === '<user>' ? left.name : NameAliasRegistry.resolve(left.name);\n      const rightName = right.name === '<user>' ? right.name : NameAliasRegistry.resolve(right.name);\n\n      //  targetValue\n      let leftTarget = left.targetValue ?? null;\n      if (leftTarget === null) {\n        leftTarget = getAttributeValue(leftName, left.attribute);\n        if (leftTarget === null) {\n          throw new Error(`[AcuDice]  \"${leftName}\"  \"${left.attribute}\"`);\n        }\n      }\n\n      let rightTarget = right.targetValue ?? null;\n      if (rightTarget === null) {\n        rightTarget = getAttributeValue(rightName, right.attribute);\n        if (rightTarget === null) {\n          throw new Error(`[AcuDice]  \"${rightName}\"  \"${right.attribute}\"`);\n        }\n      }\n\n      // \n      const diceCfg = getDiceConfig();\n      const formula = diceCfg.lastDiceType || '1d100';\n\n      // \n      const leftResult = rollComplexDiceExpression(formula).total;\n      const rightResult = rollComplexDiceExpression(formula).total;\n      if (Number.isNaN(leftResult) || Number.isNaN(rightResult)) {\n        throw new Error(`[AcuDice] : ${formula}`);\n      }\n\n      //  sides\n      const sidesMatch = formula.match(/\\d+d(\\d+)/i);\n      const sides = sidesMatch ? parseInt(sidesMatch[1], 10) : 100;\n\n      // \n      const leftSuccessLevel = getSuccessLevel(leftResult, leftTarget, sides);\n      const rightSuccessLevel = getSuccessLevel(rightResult, rightTarget, sides);\n\n      // \n      let winner: 'left' | 'right' | 'tie';\n      let message: string;\n\n      if (leftSuccessLevel.level > rightSuccessLevel.level) {\n        winner = 'left';\n        message = `${leftName} (${leftSuccessLevel.name}  ${rightSuccessLevel.name})`;\n      } else if (leftSuccessLevel.level < rightSuccessLevel.level) {\n        winner = 'right';\n        message = `${rightName} (${rightSuccessLevel.name}  ${leftSuccessLevel.name})`;\n      } else {\n        // \n        const tieRule = options.rule || diceCfg.contestTieRule || 'initiator_lose';\n        message = `( ${leftSuccessLevel.name})`;\n\n        if (tieRule === 'initiator_win') {\n          winner = 'left';\n          message += ` - ${leftName} `;\n        } else if (tieRule === 'tie') {\n          winner = 'tie';\n        } else {\n          // initiator_lose\n          winner = 'right';\n          message += ` - ${leftName} `;\n        }\n      }\n\n      const result = {\n        left: {\n          name: leftName,\n          attribute: left.attribute,\n          roll: leftResult,\n          target: leftTarget,\n          successLevel: leftSuccessLevel.level,\n        },\n        right: {\n          name: rightName,\n          attribute: right.attribute,\n          roll: rightResult,\n          target: rightTarget,\n          successLevel: rightSuccessLevel.level,\n        },\n        winner,\n        message,\n      };\n\n      // \n      emitEvent('contest', result);\n\n      // \n      contestHistory.push({\n        ...result,\n        timestamp: Date.now(),\n        detailId: `contest_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`,\n        detailLines: [\n          `: ${result.left.name} / : ${result.right.name}`,\n          `: ${result.left.attribute} vs ${result.right.attribute}`,\n          `: ${result.left.roll} vs ${result.right.roll}`,\n          `: ${result.left.target} vs ${result.right.target}`,\n          `: ${result.winner === 'left' ? result.left.name : result.winner === 'right' ? result.right.name : ''}`,\n          `: ${result.message}`,\n        ],\n      });\n      if (contestHistory.length > MAX_HISTORY) {\n        contestHistory.shift();\n      }\n\n      return result;\n    },\n  };\n\n  //  Object.defineProperty \n  defineAcuDiceOnWindow(window);\n\n  if (rootWindow !== window) {\n    try {\n      defineAcuDiceOnWindow(rootWindow);\n    } catch (error) {\n      console.warn('[AcuDice] ', error);\n    }\n  }\n\n  notifyReady();\n  dispatchReadyEvent(window);\n  if (rootWindow !== window) {\n    dispatchReadyEvent(rootWindow);\n  }\n\n  console.info('[AcuDice] API v1.2.0 ');\n\n  // ========================================\n  // ========================================\n  //  ( - )\n  //  renderFavoritesPanel() + bindFavoritesEvents() \n  // ========================================\n  /** @deprecated  renderFavoritesPanel()  */\n  const showFavoritesPanel = async () => {\n    const { $ } = getCore();\n    $('.acu-favorites-overlay').remove();\n\n    const config = getConfig();\n\n    // \n    const allFavorites = await FavoritesManager.getAll();\n    const allTags = await FavoritesManager.getAllTags();\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const currentTables = rawData || {};\n\n    // \n    const groupedByTag: Record<string, FavoriteItem[]> = {};\n    const untagged: FavoriteItem[] = [];\n\n    for (const fav of allFavorites) {\n      if (fav.tags && fav.tags.length > 0) {\n        for (const tag of fav.tags) {\n          if (!groupedByTag[tag]) groupedByTag[tag] = [];\n          groupedByTag[tag].push(fav);\n        }\n      } else {\n        untagged.push(fav);\n      }\n    }\n\n    // HTML\n    const renderFavoriteCard = (fav: FavoriteItem) => {\n      const preview = fav.header\n        .slice(0, 3)\n        .map(\n          (h, i) =>\n            `<span class=\"acu-fav-preview-item\"><b>${escapeHtml(h)}:</b> ${escapeHtml(String(fav.rowData[i] || ''))}</span>`,\n        )\n        .join('');\n      const tagsHtml = fav.tags.map(tag => `<span class=\"acu-favorites-tag\">${escapeHtml(tag)}</span>`).join('');\n      const sourceInfo = fav.sourceInfo ? `: ${escapeHtml(fav.sourceInfo.tableName)}` : '';\n\n      return `\n        <div class=\"acu-favorites-card\" data-id=\"${escapeHtml(fav.id)}\">\n          <div class=\"acu-favorites-card-header\">\n            <div class=\"acu-favorites-card-preview\">${preview}</div>\n            <div class=\"acu-favorites-card-source\">${sourceInfo}</div>\n          </div>\n          <div class=\"acu-favorites-card-tags\">${tagsHtml}</div>\n          <div class=\"acu-favorites-card-actions\">\n            <button class=\"acu-fav-btn acu-fav-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n            <button class=\"acu-fav-btn acu-fav-copy\" title=\"\"><i class=\"fa-solid fa-copy\"></i></button>\n            <button class=\"acu-fav-btn acu-fav-send\" title=\"\"><i class=\"fa-solid fa-paper-plane\"></i></button>\n            <button class=\"acu-fav-btn acu-fav-delete\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n        </div>\n      `;\n    };\n\n    // HTML\n    let contentHtml = '';\n\n    // \n    for (const tag of Object.keys(groupedByTag).sort()) {\n      contentHtml += `\n        <div class=\"acu-favorites-group\">\n          <div class=\"acu-favorites-group-title\"><i class=\"fa-solid fa-tag\"></i> ${escapeHtml(tag)} (${groupedByTag[tag].length})</div>\n          <div class=\"acu-favorites-group-cards\">\n            ${groupedByTag[tag].map(renderFavoriteCard).join('')}\n          </div>\n        </div>\n      `;\n    }\n\n    // \n    if (untagged.length > 0) {\n      contentHtml += `\n        <div class=\"acu-favorites-group\">\n          <div class=\"acu-favorites-group-title\"><i class=\"fa-solid fa-inbox\"></i>  (${untagged.length})</div>\n          <div class=\"acu-favorites-group-cards\">\n            ${untagged.map(renderFavoriteCard).join('')}\n          </div>\n        </div>\n      `;\n    }\n\n    if (allFavorites.length === 0) {\n      contentHtml = `\n        <div class=\"acu-favorites-empty\">\n          <i class=\"fa-solid fa-star\" style=\"font-size: 48px; opacity: 0.3;\"></i>\n          <p></p>\n          <p style=\"font-size: 12px; opacity: 0.7;\">  \"\"</p>\n        </div>\n      `;\n    }\n\n    // \n    const tagFilterOptions = allTags\n      .map(tag => `<option value=\"${escapeHtml(tag)}\">${escapeHtml(tag)}</option>`)\n      .join('');\n\n    const overlayHtml = `\n      <div class=\"acu-favorites-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-favorites-panel\">\n          <div class=\"acu-favorites-header\">\n            <h3><i class=\"fa-solid fa-star\"></i> </h3>\n            <div class=\"acu-favorites-header-actions\">\n              <button class=\"acu-fav-header-btn\" id=\"acu-fav-new\" title=\"\"><i class=\"fa-solid fa-plus\"></i> </button>\n              <button class=\"acu-fav-header-btn\" id=\"acu-fav-import\" title=\"\"><i class=\"fa-solid fa-file-import\"></i> </button>\n              <button class=\"acu-fav-header-btn\" id=\"acu-fav-export\" title=\"\"><i class=\"fa-solid fa-file-export\"></i> </button>\n              <button class=\"acu-fav-header-btn acu-fav-close\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n          </div>\n          <div class=\"acu-favorites-filter\">\n            <select id=\"acu-fav-tag-filter\">\n              <option value=\"\"></option>\n              ${tagFilterOptions}\n            </select>\n            <input type=\"text\" id=\"acu-fav-search\" placeholder=\"...\" />\n          </div>\n          <div class=\"acu-favorites-content\">\n            ${contentHtml}\n          </div>\n        </div>\n      </div>\n    `;\n\n    $('body').append(overlayHtml);\n\n    const $overlay = $('.acu-favorites-overlay');\n    const $panel = $overlay.find('.acu-favorites-panel');\n\n    // \n    const closePanel = () => {\n      $overlay.remove();\n    };\n\n    $overlay.on('click', e => {\n      if ($(e.target).hasClass('acu-favorites-overlay')) {\n        closePanel();\n      }\n    });\n\n    $panel.find('.acu-fav-close').on('click', closePanel);\n\n    // \n    $panel.find('#acu-fav-tag-filter').on('change', async function () {\n      const tag = $(this).val() as string;\n      const filtered = tag ? await FavoritesManager.getByTag(tag) : await FavoritesManager.getAll();\n      const $content = $panel.find('.acu-favorites-content');\n\n      if (filtered.length === 0) {\n        $content.html('<div class=\"acu-favorites-empty\"><p></p></div>');\n      } else {\n        $content.html(`<div class=\"acu-favorites-group-cards\">${filtered.map(renderFavoriteCard).join('')}</div>`);\n      }\n    });\n\n    // \n    $panel.find('#acu-fav-search').on('input', async function () {\n      const query = ($(this).val() as string).toLowerCase().trim();\n      const all = await FavoritesManager.getAll();\n      const filtered = query\n        ? all.filter(fav => {\n            const headerMatch = fav.header.some(h => h.toLowerCase().includes(query));\n            const dataMatch = fav.rowData.some(d => String(d).toLowerCase().includes(query));\n            const tagMatch = fav.tags.some(t => t.toLowerCase().includes(query));\n            return headerMatch || dataMatch || tagMatch;\n          })\n        : all;\n\n      const $content = $panel.find('.acu-favorites-content');\n      if (filtered.length === 0) {\n        $content.html('<div class=\"acu-favorites-empty\"><p></p></div>');\n      } else {\n        $content.html(`<div class=\"acu-favorites-group-cards\">${filtered.map(renderFavoriteCard).join('')}</div>`);\n      }\n    });\n\n    // \n    $panel.on('click', '.acu-fav-edit', async function () {\n      const id = $(this).closest('.acu-favorites-card').data('id');\n      const fav = await FavoritesManager.getById(id);\n      if (!fav) return;\n\n      showFavoriteEditModal(fav, async updated => {\n        await FavoritesManager.updateFavorite(id, updated);\n        toastr.success('');\n        closePanel();\n        showFavoritesPanel();\n      });\n    });\n\n    // \n    $panel.on('click', '.acu-fav-copy', async function () {\n      const id = $(this).closest('.acu-favorites-card').data('id');\n      const result = await FavoritesManager.duplicateFavorite(id);\n      if (result) {\n        toastr.success('');\n        closePanel();\n        showFavoritesPanel();\n      } else {\n        toastr.error('');\n      }\n    });\n\n    // \n    $panel.on('click', '.acu-fav-send', async function () {\n      const id = $(this).closest('.acu-favorites-card').data('id');\n      const fav = await FavoritesManager.getById(id);\n      if (!fav) return;\n\n      const compatible = FavoritesManager.findCompatibleTables(fav, currentTables);\n      if (compatible.length === 0) {\n        toastr.warning('');\n        return;\n      }\n\n      showSendToTableModal(fav, compatible, currentTables, () => {\n        toastr.success('');\n        closePanel();\n        renderInterface();\n      });\n    });\n\n    // \n    $panel.on('click', '.acu-fav-delete', async function () {\n      const id = $(this).closest('.acu-favorites-card').data('id');\n      if (!confirm('')) return;\n\n      const result = await FavoritesManager.deleteFavorite(id);\n      if (result) {\n        toastr.success('');\n        $(this)\n          .closest('.acu-favorites-card')\n          .fadeOut(200, function () {\n            $(this).remove();\n          });\n      } else {\n        toastr.error('');\n      }\n    });\n\n    // \n    $panel.find('#acu-fav-new').on('click', () => {\n      const tableKeys = Object.keys(currentTables);\n      if (tableKeys.length === 0) {\n        toastr.warning('');\n        return;\n      }\n\n      showNewFavoriteModal(currentTables, async (header, tableName) => {\n        const emptyRowData = header.map(() => '');\n        const newFav = await FavoritesManager.addFavorite('', tableName, header, emptyRowData, []);\n        if (newFav) {\n          toastr.success('');\n          closePanel();\n          showFavoritesPanel();\n          // \n          setTimeout(async () => {\n            const freshFav = await FavoritesManager.getById(newFav.id);\n            if (freshFav) {\n              showFavoriteEditModal(freshFav, async updated => {\n                await FavoritesManager.updateFavorite(newFav.id, updated);\n                toastr.success('');\n                $('.acu-favorites-overlay').remove();\n                showFavoritesPanel();\n              });\n            }\n          }, 100);\n        }\n      });\n    });\n\n    // \n    $panel.find('#acu-fav-export').on('click', async () => {\n      const json = await FavoritesManager.exportFavorites();\n      if (!json) {\n        toastr.error('');\n        return;\n      }\n\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      const now = new Date();\n      const dateStr = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}${String(now.getSeconds()).padStart(2, '0')}`;\n      a.href = url;\n      a.download = `favorites_${dateStr}.json`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      toastr.success('');\n    });\n\n    // \n    $panel.find('#acu-fav-import').on('click', () => {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const text = await file.text();\n          const result = await FavoritesManager.importFavorites(text);\n          if (result) {\n            toastr.success(`: ${result.added}, ${result.updated}`);\n            closePanel();\n            showFavoritesPanel();\n          } else {\n            toastr.error(': ');\n          }\n        } catch (err) {\n          toastr.error(': ' + (err instanceof Error ? err.message : String(err)));\n        }\n      };\n      input.click();\n    });\n  };\n\n  // \n  const showFavoriteEditModal = (fav: FavoriteItem, onSave: (updated: Partial<FavoriteItem>) => void) => {\n    const { $ } = getCore();\n    $('.acu-fav-edit-overlay').remove();\n\n    const config = getConfig();\n\n    // HTML\n    const renderEditRows = (header: string[], rowData: (string | number)[]) => {\n      return header\n        .map(\n          (h, i) => `\n        <div class=\"acu-fav-edit-row\" data-index=\"${i}\">\n          <input type=\"text\" class=\"acu-fav-edit-header\" value=\"${escapeHtml(h)}\" placeholder=\"\" />\n          <input type=\"text\" class=\"acu-fav-edit-value\" value=\"${escapeHtml(String(rowData[i] || ''))}\" placeholder=\"\" />\n          <button class=\"acu-fav-edit-remove\" title=\"\"><i class=\"fa-solid fa-minus\"></i></button>\n        </div>\n      `,\n        )\n        .join('');\n    };\n\n    const overlayHtml = `\n      <div class=\"acu-fav-edit-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-fav-edit-modal\">\n          <div class=\"acu-fav-edit-modal-header\">\n            <h4></h4>\n            <button class=\"acu-fav-edit-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-fav-edit-modal-body\">\n            <div class=\"acu-fav-edit-tags-section\">\n              <label> ():</label>\n              <input type=\"text\" id=\"acu-fav-edit-tags\" value=\"${escapeHtml(fav.tags.join(', '))}\" />\n            </div>\n            <div class=\"acu-fav-edit-rows\">\n              ${renderEditRows(fav.header, fav.rowData)}\n            </div>\n            <button class=\"acu-fav-edit-add-col\"><i class=\"fa-solid fa-plus\"></i> </button>\n          </div>\n          <div class=\"acu-fav-edit-modal-footer\">\n            <button class=\"acu-fav-edit-cancel\"></button>\n            <button class=\"acu-fav-edit-save\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    $('body').append(overlayHtml);\n\n    const $overlay = $('.acu-fav-edit-overlay');\n    const $modal = $overlay.find('.acu-fav-edit-modal');\n\n    const closeModal = () => $overlay.remove();\n\n    $overlay.on('click', e => {\n      if ($(e.target).hasClass('acu-fav-edit-overlay')) closeModal();\n    });\n\n    $modal.find('.acu-fav-edit-close, .acu-fav-edit-cancel').on('click', closeModal);\n\n    // \n    $modal.on('click', '.acu-fav-edit-remove', function () {\n      $(this).closest('.acu-fav-edit-row').remove();\n    });\n\n    // \n    $modal.find('.acu-fav-edit-add-col').on('click', () => {\n      const newIndex = $modal.find('.acu-fav-edit-row').length;\n      const newRowHtml = `\n        <div class=\"acu-fav-edit-row\" data-index=\"${newIndex}\">\n          <input type=\"text\" class=\"acu-fav-edit-header\" value=\"\" placeholder=\"\" />\n          <input type=\"text\" class=\"acu-fav-edit-value\" value=\"\" placeholder=\"\" />\n          <button class=\"acu-fav-edit-remove\" title=\"\"><i class=\"fa-solid fa-minus\"></i></button>\n        </div>\n      `;\n      $modal.find('.acu-fav-edit-rows').append(newRowHtml);\n    });\n\n    // \n    $modal.find('.acu-fav-edit-save').on('click', () => {\n      const newHeader: string[] = [];\n      const newRowData: (string | number)[] = [];\n\n      $modal.find('.acu-fav-edit-row').each(function () {\n        const h = $(this).find('.acu-fav-edit-header').val() as string;\n        const v = $(this).find('.acu-fav-edit-value').val() as string;\n        if (h.trim()) {\n          newHeader.push(h.trim());\n          newRowData.push(v);\n        }\n      });\n\n      const tagsStr = ($modal.find('#acu-fav-edit-tags').val() as string) || '';\n      const newTags = tagsStr\n        .split(',')\n        .map(t => t.trim())\n        .filter(t => t.length > 0);\n\n      onSave({\n        header: newHeader,\n        rowData: newRowData,\n        tags: newTags,\n      });\n\n      closeModal();\n    });\n  };\n\n  //  prompt\n  const showTagInputModal = (): Promise<string | null> => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    return new Promise(resolve => {\n      $('.acu-fav-tag-overlay').remove();\n\n      const overlayHtml = `\n        <div class=\"acu-fav-tag-overlay acu-theme-${config.theme}\">\n          <div class=\"acu-fav-tag-modal\">\n            <div class=\"acu-fav-tag-modal-header\">\n              <h4><i class=\"fa-solid fa-tags\"></i> </h4>\n              <button class=\"acu-fav-tag-close\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n            <div class=\"acu-fav-tag-modal-body\">\n              <div class=\"acu-fav-tag-input-section\">\n                <label></label>\n                <input type=\"text\" id=\"acu-fav-tag-input\" placeholder=\", , \" />\n              </div>\n            </div>\n            <div class=\"acu-fav-tag-modal-footer\">\n              <button class=\"acu-fav-tag-cancel\"></button>\n              <button class=\"acu-fav-tag-confirm\"></button>\n            </div>\n          </div>\n        </div>\n      `;\n\n      $('body').append(overlayHtml);\n\n      const $overlay = $('.acu-fav-tag-overlay');\n      // \n      $overlay.css({\n        position: 'fixed',\n        top: '0',\n        left: '0',\n        right: '0',\n        bottom: '0',\n        width: '100vw',\n        height: '100vh',\n        'z-index': '31300',\n        display: 'flex',\n        'align-items': 'center',\n        'justify-content': 'center',\n        padding: '16px',\n        'box-sizing': 'border-box',\n      });\n      const $modal = $overlay.find('.acu-fav-tag-modal');\n      const $input = $modal.find('#acu-fav-tag-input');\n      let resolved = false;\n\n      const closeModal = (result: string | null) => {\n        if (resolved) return;\n        resolved = true;\n        $overlay.remove();\n        resolve(result);\n      };\n\n      // \n      $overlay.on('click', e => {\n        if ($(e.target).hasClass('acu-fav-tag-overlay')) closeModal(null);\n      });\n\n      // /\n      $modal.find('.acu-fav-tag-close, .acu-fav-tag-cancel').on('click', () => closeModal(null));\n\n      // \n      $modal.find('.acu-fav-tag-confirm').on('click', () => {\n        closeModal(($input.val() as string) || '');\n      });\n\n      // \n      $input.on('keydown', (e: JQuery.KeyDownEvent) => {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          closeModal(($input.val() as string) || '');\n        }\n      });\n\n      // \n      setTimeout(() => $input.trigger('focus'), 100);\n    });\n  };\n\n  // \n  const showNewFavoriteModal = (\n    currentTables: Record<string, any>,\n    onCreate: (header: string[], tableName: string) => void,\n  ) => {\n    const { $ } = getCore();\n    $('.acu-fav-new-overlay').remove();\n\n    const config = getConfig();\n\n    const tableOptions = Object.keys(currentTables)\n      .map(key => {\n        const table = currentTables[key];\n        const name = table.name || key;\n        return `<option value=\"${escapeHtml(key)}\">${escapeHtml(name)}</option>`;\n      })\n      .join('');\n\n    const overlayHtml = `\n      <div class=\"acu-fav-new-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-fav-new-modal\">\n          <div class=\"acu-fav-new-modal-header\">\n            <h4></h4>\n            <button class=\"acu-fav-new-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-fav-new-modal-body\">\n            <label>:</label>\n            <select id=\"acu-fav-new-template\">\n              ${tableOptions}\n            </select>\n          </div>\n          <div class=\"acu-fav-new-modal-footer\">\n            <button class=\"acu-fav-new-cancel\"></button>\n            <button class=\"acu-fav-new-create\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    $('body').append(overlayHtml);\n\n    const $overlay = $('.acu-fav-new-overlay');\n    const $modal = $overlay.find('.acu-fav-new-modal');\n\n    const closeModal = () => $overlay.remove();\n\n    $overlay.on('click', e => {\n      if ($(e.target).hasClass('acu-fav-new-overlay')) closeModal();\n    });\n\n    $modal.find('.acu-fav-new-close, .acu-fav-new-cancel').on('click', closeModal);\n\n    $modal.find('.acu-fav-new-create').on('click', () => {\n      const key = $modal.find('#acu-fav-new-template').val() as string;\n      const table = currentTables[key];\n      if (!table || !table.content || !table.content[0]) {\n        toastr.error('');\n        return;\n      }\n\n      const fullHeader = table.content[0];\n      const header: string[] = fullHeader.slice(1).map((h: any) => String(h || ''));\n      const tableName = table.name || key;\n\n      onCreate(header, tableName);\n      closeModal();\n    });\n  };\n\n  // \n  const showSendToTableModal = (\n    fav: FavoriteItem,\n    compatible: TableCompatibility[],\n    currentTables: Record<string, any>,\n    onSuccess: () => void,\n  ) => {\n    const { $ } = getCore();\n    $('.acu-fav-send-overlay').remove();\n\n    const config = getConfig();\n\n    const tableListHtml = compatible\n      .map(c => {\n        const modeLabel =\n          c.mode === 'strict'\n            ? '<span class=\"acu-match-full\"> </span>'\n            : `<span class=\"acu-match-partial\">  (${c.matchedCols.length}/${fav.header.length})</span>`;\n        const unmatchedInfo =\n          c.unmatchedCols.length > 0\n            ? `<div class=\"acu-fav-send-unmatched\">: ${c.unmatchedCols.join(', ')}</div>`\n            : '';\n\n        return `\n        <div class=\"acu-fav-send-option\" data-uid=\"${escapeHtml(c.tableUid)}\" data-mode=\"${c.mode}\">\n          <div class=\"acu-fav-send-option-name\">${escapeHtml(c.tableName)}</div>\n          <div class=\"acu-fav-send-option-mode\">${modeLabel}</div>\n          ${unmatchedInfo}\n        </div>\n      `;\n      })\n      .join('');\n\n    const overlayHtml = `\n      <div class=\"acu-fav-send-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-fav-send-modal\">\n          <div class=\"acu-fav-send-modal-header\">\n            <h4></h4>\n            <button class=\"acu-fav-send-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-fav-send-modal-body\">\n            ${tableListHtml}\n          </div>\n          <div class=\"acu-fav-send-modal-footer\">\n            <button class=\"acu-fav-send-cancel\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    $('body').append(overlayHtml);\n\n    const $overlay = $('.acu-fav-send-overlay');\n    // \n    $overlay.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      'z-index': '31300',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '16px',\n      'box-sizing': 'border-box',\n    });\n    const $modal = $overlay.find('.acu-fav-send-modal');\n\n    const closeModal = () => $overlay.remove();\n\n    $overlay.on('click', e => {\n      if ($(e.target).hasClass('acu-fav-send-overlay')) closeModal();\n    });\n\n    $modal.find('.acu-fav-send-close, .acu-fav-send-cancel').on('click', closeModal);\n\n    // \n    $modal.on('click', '.acu-fav-send-option', async function () {\n      const uid = $(this).data('uid') as string;\n      const mode = $(this).data('mode') as string;\n      const table = currentTables[uid];\n\n      if (!table || !table.content) {\n        toastr.error('');\n        return;\n      }\n\n      const targetHeader: string[] = table.content[0].slice(1).map((h: any) => String(h || ''));\n      const newRow = FavoritesManager.mapRowToTable(fav, targetHeader);\n\n      // \n      table.content.push(newRow);\n\n      //  saveDataOnly \n      const rawData = cachedRawData || getTableData();\n      if (!rawData || !rawData[uid]?.content) {\n        toastr.error('');\n        return;\n      }\n      rawData[uid].content = table.content;\n      cachedRawData = rawData;\n\n      try {\n        await saveDataOnly(rawData, [uid]);\n        console.log('[DICE]FavoritesManager ');\n      } catch (err) {\n        console.error('[DICE]FavoritesManager :', err);\n        toastr.error(': ' + (err.message || err));\n        return;\n      }\n\n      // \n      if (mode === 'loose') {\n        const unmatchedCount = fav.header.filter(h => !targetHeader.includes(h)).length;\n        if (unmatchedCount > 0) {\n          toastr.info(`${unmatchedCount}`);\n        }\n      }\n\n      closeModal();\n      onSuccess();\n    });\n  };\n\n  const showSettingsModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-settings-dialog)').remove();\n    clearModalStack();\n    pushModal('showSettingsModal', showSettingsModal);\n\n    isSettingsOpen = true;\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // \n    const expandedGroups = Store.get('acu_settings_expanded', ['appearance']);\n\n    const isGroupExpanded = groupId => expandedGroups.includes(groupId);\n    // HTMLMVU\n    const SPECIAL_BUTTONS_CONFIG = [\n      { key: '__dice__', name: '', icon: 'fa-dice-d20' },\n      { key: '__changes__', name: '', icon: 'fa-code-compare' },\n      { key: '__mvu__', name: 'MVU', icon: 'fa-code-branch' },\n      { key: '__favorites__', name: '', icon: 'fa-star' },\n    ];\n\n    const tableManagerHtml = (() => {\n      const rawData = cachedRawData || getTableData();\n      const tables = processJsonData(rawData || {});\n      const savedOrder = getSavedTableOrder() || [];\n      const hiddenList = getHiddenTables();\n\n      //  + \n      let allItems = [];\n\n      // \n      SPECIAL_BUTTONS_CONFIG.forEach(btn => {\n        // MVU \n        allItems.push({ key: btn.key, name: btn.name, icon: btn.icon, isSpecial: true });\n      });\n\n      // \n      Object.keys(tables).forEach(name => {\n        allItems.push({ key: name, name: name, icon: getIconForTableName(name), isSpecial: false });\n      });\n\n      // \n      if (savedOrder.length > 0) {\n        const orderMap = new Map(savedOrder.map((k, i) => [k, i]));\n        allItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      return allItems\n        .map(item => {\n          const isHidden = hiddenList.includes(item.key);\n          const specialClass = item.isSpecial ? ' acu-special-item' : '';\n          const displayName = item.name;\n          return (\n            '<div class=\"acu-table-manager-item' +\n            specialClass +\n            (isHidden ? ' hidden-table' : '') +\n            '\" data-table-name=\"' +\n            escapeHtml(item.key) +\n            '\" draggable=\"false\">' +\n            '<div class=\"acu-table-item-check\" title=\"/\">' +\n            '<i class=\"fa-solid ' +\n            (isHidden ? 'fa-eye-slash' : 'fa-eye') +\n            '\"></i>' +\n            '</div>' +\n            '<div class=\"acu-table-item-icon\"><i class=\"fa-solid ' +\n            item.icon +\n            '\"></i></div>' +\n            '<div class=\"acu-table-item-name\">' +\n            escapeHtml(displayName) +\n            '</div>' +\n            '<div class=\"acu-table-item-handle\" title=\"\">' +\n            '<i class=\"fa-solid fa-grip-vertical\"></i>' +\n            '</div>' +\n            '</div>'\n          );\n        })\n        .join('');\n    })();\n    const chevron = groupId => (isGroupExpanded(groupId) ? 'fa-chevron-down' : 'fa-chevron-right');\n\n    const dialog = $(`\n        <div class=\"acu-edit-overlay\">\n            <div class=\"acu-edit-dialog acu-settings-dialog ${currentThemeClass}\">\n                <div class=\"acu-settings-header\">\n                    <div class=\"acu-settings-title\">\n                        <span class=\"acu-settings-text\">\n                            <i class=\"fa-solid fa-cog\"></i> \n                            <span class=\"acu-version-badge\">${SCRIPT_VERSION}</span><button class=\"acu-manual-update-btn\" id=\"acu-manual-update-btn\" title=\"\"><i class=\"fa-solid fa-rotate\"></i></button>\n                        </span>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-help-btn\" id=\"acu-help-btn\" title=\"\"><i class=\"fa-solid fa-question-circle\"></i></button>\n                        <button class=\"acu-close-btn\" id=\"dlg-close-x\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n\n                <div class=\"acu-settings-body\">\n                <!--  -->\n                <div class=\"acu-settings-group ${isGroupExpanded('appearance') ? '' : 'collapsed'}\" data-group=\"appearance\">                    <div class=\"acu-settings-group-title\">\n                        <i class=\"fa-solid ${chevron('appearance')} acu-group-chevron\"></i>\n                        <i class=\"fa-solid fa-palette\"></i> \n                    </div>\n                    <div class=\"acu-settings-group-body\">\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-theme\" class=\"acu-setting-select\">\n                                ${THEMES.map(t => `<option value=\"${t.id}\" ${t.id === config.theme ? 'selected' : ''}>${t.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-font-family\" class=\"acu-setting-select\">\n                                ${FONTS.map(f => `<option value=\"${f.id}\" ${f.id === config.fontFamily ? 'selected' : ''}>${f.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-main\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.fontSize}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-opt\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.optionFontSize || 12}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row acu-setting-row-toggle\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <label class=\"acu-toggle\">\n                                <input type=\"checkbox\" id=\"cfg-new\" ${config.highlightNew ? 'checked' : ''}>\n                                <span class=\"acu-toggle-slider\"></span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('layout') ? '' : 'collapsed'}\" data-group=\"layout\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('layout')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-th-large\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-width\" data-min=\"200\" data-max=\"500\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.cardWidth}px</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-layout\" class=\"acu-setting-select\">\n                                    <option value=\"horizontal\" ${config.layout !== 'vertical' ? 'selected' : ''}></option>\n                                    <option value=\"vertical\" ${config.layout === 'vertical' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                    <span class=\"acu-setting-hint\"></span>\n                                </div>\n                                <select id=\"cfg-grid-cols\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"2\" ${config.gridColumns == 2 ? 'selected' : ''}>2</option>\n                                    <option value=\"3\" ${config.gridColumns == 3 ? 'selected' : ''}>3</option>\n                                    <option value=\"4\" ${config.gridColumns == 4 ? 'selected' : ''}>4</option>\n                                    <option value=\"auto\" ${config.gridColumns === 'auto' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-per-page\" data-min=\"10\" data-max=\"200\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.itemsPerPage}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('position') ? '' : 'collapsed'}\" data-group=\"position\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('position')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-arrows-alt\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-position\" class=\"acu-setting-select\">\n                                    <option value=\"fixed\" ${config.positionMode !== 'embedded' ? 'selected' : ''}></option>\n                                    <option value=\"embedded\" ${config.positionMode === 'embedded' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-action-pos\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bottom\" ${config.actionsPosition !== 'top' ? 'selected' : ''}></option>\n                                    <option value=\"top\" ${config.actionsPosition === 'top' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-style\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bar\" ${config.collapseStyle === 'bar' ? 'selected' : ''}></option>\n                                    <option value=\"pill\" ${config.collapseStyle === 'pill' ? 'selected' : ''}></option>\n                                    <option value=\"mini\" ${config.collapseStyle === 'mini' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\" id=\"cfg-col-align-row\" style=\"${config.collapseStyle === 'bar' ? 'display:none;' : ''}\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-align\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"right\" ${config.collapseAlign === 'right' ? 'selected' : ''}></option>\n                                    <option value=\"left\" ${config.collapseAlign === 'left' ? 'selected' : ''}></option>\n                                    <option value=\"center\" ${config.collapseAlign === 'center' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('options') ? '' : 'collapsed'}\" data-group=\"options\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('options')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-gamepad\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row acu-setting-row-toggle\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-show-opt\" ${config.showOptionPanel !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                            <div class=\"acu-setting-row acu-setting-row-toggle\" id=\"row-auto-send\" style=\"${config.showOptionPanel !== false ? '' : 'display:none;'}\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-auto-send\" ${config.clickOptionToAutoSend !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('tables') ? '' : 'collapsed'}\" data-group=\"tables\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('tables')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-table\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-table-manager-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <div class=\"acu-table-manager-list\" id=\"table-manager-list\">\n                                ${tableManagerHtml}\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('validation') ? '' : 'collapsed'}\" data-group=\"validation\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('validation')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-clipboard-check\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${PresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === PresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}${p.id === 'default' ? ` v${PRESET_FORMAT_VERSION}` : p.builtin ? ' ()' : ''}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-reset\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> <i class=\"fa-solid fa-shield-halved\"></i> \n                            </div>\n                            <div class=\"acu-validation-rules-list\" id=\"validation-rules-list\">\n                                ${ValidationRuleManager.getAllRules()\n                                  .map(rule => {\n                                    const typeInfo = RULE_TYPE_INFO[rule.ruleType] || {\n                                      name: rule.ruleType,\n                                      icon: 'fa-question',\n                                    };\n                                    const isTableRule = typeInfo.scope === 'table';\n                                    const hasIntercept = rule.intercept;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n                                            <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n                                        </div>\n                                        <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n                                        <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <button class=\"acu-add-rule-btn\" id=\"btn-add-validation-rule\">\n                                <i class=\"fa-solid fa-plus\"></i> \n                            </button>\n                        </div>\n                    </div>\n\n                    <!--  - Phase 4.1 -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('regex') ? '' : 'collapsed'}\" data-group=\"regex\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('regex')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-wand-magic-sparkles\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"regex-preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${RegexPresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === RegexPresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}${p.id === 'regex_default' ? ` v${PRESET_FORMAT_VERSION}` : ''}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-reset\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <!--  -->\n                            <div class=\"acu-validation-rules-list\" id=\"regex-rules-list\">\n                                ${RegexTransformationManager.getAllRules()\n                                  .map(rule => {\n                                    const scopeIcon =\n                                      rule.scope.type === 'global'\n                                        ? 'fa-globe'\n                                        : rule.scope.type === 'table'\n                                          ? 'fa-table'\n                                          : 'fa-columns';\n                                    const scopeText =\n                                      rule.scope.type === 'global'\n                                        ? ''\n                                        : rule.scope.type === 'table'\n                                          ? rule.scope.tableNames?.join(',')\n                                          : `${rule.scope.tableNames?.join(',')}.${rule.scope.columnNames?.join(',')}`;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\": ${escapeHtml(rule.scope.type)}\">\n                                            <i class=\"fa-solid ${scopeIcon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\" style=\"font-size:10px;\">${escapeHtml(scopeText)} | ${escapeHtml(rule.operation)}</div>\n                                        </div>\n                                        <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <div style=\"display:flex;gap:8px;margin-top:8px;\">\n                                <button class=\"acu-add-rule-btn\" id=\"btn-add-regex-rule\" style=\"flex:1;\">\n                                    <i class=\"fa-solid fa-plus\"></i> \n                                </button>\n                                <button class=\"acu-add-rule-btn\" id=\"btn-import-tavern-regex\" style=\"flex:1;\">\n                                    <i class=\"fa-solid fa-file-import\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('advanced') ? '' : 'collapsed'}\" data-group=\"advanced\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('advanced')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-sliders-h\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-dice-d20\"></i> </span>\n                                </div>\n                                <button id=\"cfg-attr-preset-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-dice\"></i> </span>\n                                </div>\n                                <button id=\"cfg-advanced-preset-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-wand-magic-sparkles\"></i> </span>\n                                </div>\n                                <button id=\"cfg-action-preset-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-filter\"></i> </span>\n                                </div>\n                                <button id=\"cfg-blacklist-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-bug\"></i> Debug</span>\n                                </div>\n                                <button id=\"btn-open-debug-console\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-terminal\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-trash-can\"></i> </span>\n                                </div>\n                                <button id=\"cfg-clear-local-cache\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-eraser\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row acu-setting-row-toggle\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-bell-slash\"></i> -</span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-db-toast-mute\" ${config.muteDatabaseToasts ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                </div><!--  .acu-settings-body -->\n            </div>\n        </div>\n    `);\n    $('body').append(dialog);\n\n    // ===  ===\n    dialog.find('.acu-settings-group-title').on('click', function () {\n      const $group = $(this).closest('.acu-settings-group');\n      const $body = $group.find('.acu-settings-group-body');\n\n      // \n      if ($body.hasClass('acu-animating')) return;\n\n      const groupId = $group.data('group');\n      const $chevron = $(this).find('.acu-group-chevron');\n      let expanded = Store.get('acu_settings_expanded', ['appearance']);\n\n      if ($group.hasClass('collapsed')) {\n        // \n        $group.removeClass('collapsed');\n        $chevron.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n        if (!expanded.includes(groupId)) expanded.push(groupId);\n\n        $body.addClass('acu-animating').show();\n        const targetHeight = $body.prop('scrollHeight');\n        $body.css('height', 0).animate({ height: targetHeight }, 180, function () {\n          $(this).css('height', '').removeClass('acu-animating');\n        });\n      } else {\n        // \n        $group.addClass('collapsed');\n        $chevron.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n        expanded = expanded.filter(id => id !== groupId);\n\n        const currentHeight = $body.outerHeight();\n        $body\n          .addClass('acu-animating')\n          .css('height', currentHeight)\n          .animate({ height: 0 }, 180, function () {\n            $(this).hide().css('height', '').removeClass('acu-animating');\n          });\n      }\n\n      Store.set('acu_settings_expanded', expanded);\n    });\n\n    // ===  ===\n    // \n    dialog.find('#cfg-theme').on('change', function () {\n      const newTheme = $(this).val();\n      saveConfig({ theme: newTheme });\n      dialog\n        .find('.acu-edit-dialog')\n        .removeClass(THEMES.map(t => `acu-theme-${t.id}`).join(' '))\n        .addClass(`acu-theme-${newTheme}`);\n    });\n\n    // \n    dialog.find('#cfg-font-family').on('change', function () {\n      saveConfig({ fontFamily: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-attr-preset-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showAttributePresetManager();\n    });\n\n    // \n    dialog.find('#cfg-action-preset-manage').on('click', function (e) {\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showActionPresetManager();\n    });\n\n    // \n    dialog.find('#cfg-advanced-preset-manage').on('click', function (e) {\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showAdvancedPresetManager();\n    });\n\n    dialog.find('#cfg-db-toast-mute').on('change', function () {\n      saveConfig({ muteDatabaseToasts: $(this).is(':checked') });\n    });\n\n    // \n    dialog.find('#cfg-blacklist-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      showBlacklistManagerModal();\n    });\n\n    // \n    dialog.find('#cfg-layout').on('change', function () {\n      saveConfig({ layout: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-grid-cols').on('change', function () {\n      saveConfig({ gridColumns: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-position').on('change', function () {\n      saveConfig({ positionMode: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-action-pos').on('change', function () {\n      saveConfig({ actionsPosition: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-style').on('change', function () {\n      const newStyle = $(this).val();\n      saveConfig({ collapseStyle: newStyle });\n\n      // \n      const $alignRow = dialog.find('#cfg-col-align-row');\n      if (newStyle === 'bar') {\n        $alignRow.hide();\n      } else {\n        $alignRow.show();\n      }\n\n      renderInterface();\n    });\n    dialog.find('#cfg-col-align').on('change', function () {\n      saveConfig({ collapseAlign: $(this).val() });\n      renderInterface();\n    });\n\n    // \n    dialog.find('#cfg-show-opt').on('change', function () {\n      const checked = $(this).is(':checked');\n      saveConfig({ showOptionPanel: checked });\n      if (checked) dialog.find('#row-auto-send').slideDown(200);\n      else dialog.find('#row-auto-send').slideUp(200);\n      renderInterface();\n    });\n    dialog.find('#cfg-auto-send').on('change', function () {\n      saveConfig({ clickOptionToAutoSend: $(this).is(':checked') });\n    });\n    dialog.find('#cfg-new').on('change', function () {\n      saveConfig({ highlightNew: $(this).is(':checked') });\n      renderInterface();\n    });\n\n    // === / ===\n    dialog.find('.acu-table-item-check').on('click', function (e) {\n      e.stopPropagation();\n      const $item = $(this).closest('.acu-table-manager-item');\n      const tableName = $item.data('table-name');\n      let hiddenList = getHiddenTables();\n      const $icon = $(this).find('i');\n\n      if (hiddenList.includes(tableName)) {\n        // \n        hiddenList = hiddenList.filter(n => n !== tableName);\n        $item.removeClass('hidden-table');\n        $icon.removeClass('fa-eye-slash').addClass('fa-eye');\n      } else {\n        // \n        hiddenList.push(tableName);\n        $item.addClass('hidden-table');\n        $icon.removeClass('fa-eye').addClass('fa-eye-slash');\n      }\n\n      saveHiddenTables(hiddenList);\n      renderInterface();\n    });\n\n    // ===  ===\n    const $list = dialog.find('#table-manager-list');\n    createSortableList({\n      container: $list,\n      itemSelector: '.acu-table-manager-item',\n      handleSelector: '.acu-table-item-handle',\n      cancelSelector: '.acu-table-item-check',\n      getItemId: item => {\n        const tableName = $(item).data('table-name');\n        if (typeof tableName === 'string') return tableName;\n        if (tableName !== undefined && tableName !== null) return String(tableName);\n        return null;\n      },\n      onOrderChange: newOrder => {\n        saveTableOrder(newOrder);\n      },\n    });\n\n    // === Stepper  ===\n    dialog.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        const unit = id === 'cfg-per-page' ? '' : 'px';\n        $value.text(newVal + unit);\n\n        // \n        if (id === 'cfg-width') {\n          $('.acu-wrapper').css('--acu-card-width', newVal + 'px');\n          saveConfig({ cardWidth: newVal });\n        } else if (id === 'cfg-font-main') {\n          $('.acu-wrapper').css('--acu-font-size', newVal + 'px');\n          saveConfig({ fontSize: newVal });\n        } else if (id === 'cfg-font-opt') {\n          $('.acu-wrapper, .acu-embedded-options-container').css('--acu-opt-font-size', newVal + 'px');\n          saveConfig({ optionFontSize: newVal });\n        } else if (id === 'cfg-per-page') {\n          saveConfig({ itemsPerPage: newVal });\n        }\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    // === /===\n    dialog.on('click', '.acu-rule-toggle', function (e) {\n      e.stopPropagation();\n      const $toggle = $(this);\n      const $item = $toggle.closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const $icon = $toggle.find('i');\n      const isCurrentlyActive = $toggle.hasClass('active');\n\n      // \n      ValidationRuleManager.toggleRuleEnabled(ruleId, !isCurrentlyActive);\n\n      //  UI\n      if (isCurrentlyActive) {\n        $toggle.removeClass('active');\n        $icon.removeClass('fa-toggle-on').addClass('fa-toggle-off');\n        $item.addClass('disabled');\n      } else {\n        $toggle.addClass('active');\n        $icon.removeClass('fa-toggle-off').addClass('fa-toggle-on');\n        $item.removeClass('disabled');\n      }\n    });\n\n    // ===  ===\n    dialog.on('click', '#validation-rules-list .acu-rule-edit', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const rule = ValidationRuleManager.getRule(ruleId);\n      if (!rule) return;\n\n      // \n      showAddValidationRuleModal(dialog, ruleId);\n    });\n\n    // === ===\n    dialog.on('click', '#validation-rules-list .acu-rule-delete', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const $item = $(this).closest('.acu-validation-rule-item');\n\n      if (confirm('')) {\n        if (ValidationRuleManager.removeCustomRule(ruleId)) {\n          $item.fadeOut(200, function () {\n            $(this).remove();\n          });\n        }\n      }\n    });\n\n    // === ===\n    dialog.on('click', '.acu-rule-intercept', function (e) {\n      e.stopPropagation();\n      const $btn = $(this);\n      const ruleId = $btn.data('rule-id');\n      const isCurrentlyActive = $btn.hasClass('active');\n\n      if (ValidationRuleManager.toggleRuleIntercept(ruleId, !isCurrentlyActive)) {\n        if (isCurrentlyActive) {\n          $btn.removeClass('active').attr('title', '');\n        } else {\n          $btn.addClass('active').attr('title', '');\n        }\n      }\n    });\n\n    // ===  ===\n    const refreshPresetUI = () => {\n      ValidationRuleManager.clearCache();\n      const rules = ValidationRuleManager.getAllRules();\n      let html = '';\n      rules.forEach(rule => {\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType] || { name: rule.ruleType, icon: 'fa-question' };\n        const isTableRule = typeInfo.scope === 'table';\n        const hasIntercept = rule.intercept;\n        html += `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo.icon}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n            </div>\n            <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n            <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n              <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>`;\n      });\n      dialog.find('#validation-rules-list').html(html);\n    };\n\n    // \n    dialog.find('#preset-select').on('change', function () {\n      if (PresetManager.setActivePreset($(this).val())) {\n        refreshPresetUI();\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-dup').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const newPreset = PresetManager.duplicatePreset(preset.id);\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-new').on('click', function () {\n      const name = prompt(':', '');\n      if (!name?.trim()) return;\n      const newPreset = PresetManager.createPreset(name.trim());\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-del').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      if (preset.id === 'default') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!confirm(`\"${preset.name}\"`)) return;\n      if (PresetManager.deletePreset(preset.id)) {\n        dialog.find(`#preset-select option[value=\"${preset.id}\"]`).remove();\n        dialog.find('#preset-select').val('default').trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-export').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const json = PresetManager.exportPreset(preset.id);\n      if (json) {\n        // \n        try {\n          const filename = `acu_validation_preset_${preset.name || preset.id}_${Date.now()}.json`;\n          const blob = new Blob([json], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = filename;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        } catch (e) {\n          //  Blob /\n          navigator.clipboard\n            .writeText(json)\n            .then(() => {})\n            .catch(() => {\n              prompt(':', json);\n            });\n        }\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-import').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const json = await file.text();\n          if (!json?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(json.trim());\n          } catch {\n            if (window.toastr) window.toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.preset?.name || '';\n          const existingPresets = PresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = json.trim();\n            if (newName && parsedData?.preset) {\n              parsedData.preset.name = newName;\n              // IDID\n              parsedData.preset.id = `preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset && existingPreset.id !== 'default') {\n                PresetManager.deletePreset(existingPreset.id);\n                dialog.find(`#preset-select option[value=\"${existingPreset.id}\"]`).remove();\n              }\n            }\n\n            const result = PresetManager.importPreset(finalJson, false);\n            if (result && result.preset) {\n              const newPreset = result.preset;\n              dialog\n                .find('#preset-select')\n                .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n              dialog.find('#preset-select').val(newPreset.id).trigger('change');\n\n              // \n              if (result.needsMerge) {\n                if (\n                  confirm(\n                    '\\n\\n',\n                  )\n                ) {\n                  if (PresetManager.mergePresetWithDefaults(newPreset.id)) {\n                    refreshPresetUI();\n                  } else {\n                    if (window.toastr) window.toastr.error('');\n                  }\n                }\n              }\n            } else {\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          console.error('[DICE]PresetManager :', err);\n          if (window.toastr) window.toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // \n    dialog.find('#btn-preset-reset').on('click', function () {\n      if (!confirm('\\n')) return;\n      if (PresetManager.resetDefaultPreset()) {\n        // \n        if (PresetManager.getActivePreset()?.id === 'default') {\n          refreshPresetUI();\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // === :/ ===\n    dialog.on('click', '#regex-rules-list .acu-rule-toggle', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const currentState = RegexTransformationManager.getAllRules().find(r => r.id === ruleId)?.enabled;\n      const newState = !currentState;\n      const rule = RegexTransformationManager.getRule(ruleId);\n\n      RegexTransformationManager.toggleRuleEnabled(ruleId, newState);\n\n      if (newState) {\n      } else {\n        toastr.info('');\n      }\n\n      refreshRegexRulesList(); // [] ,\n    });\n\n    // ===  ===\n    dialog.on('click', '#regex-rules-list .acu-rule-edit', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const rule = RegexTransformationManager.getRule(ruleId);\n      if (!rule) return;\n\n      // \n      showAddRegexRuleModal(ruleId);\n    });\n\n    // === : ===\n    dialog.on('click', '#regex-rules-list .acu-rule-delete', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const rule = RegexTransformationManager.getRule(ruleId);\n      if (!rule) return;\n\n      if (confirm(`\"${rule.name}\"`)) {\n        RegexTransformationManager.removeRule(ruleId);\n        refreshRegexRulesList(); // [] ,\n      }\n    });\n\n    // === : ===\n    dialog.find('#regex-preset-select').on('change', function () {\n      const presetId = $(this).val();\n      RegexPresetManager.setActivePreset(String(presetId));\n\n      refreshRegexRulesList(); // [] ,\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-dup').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      const name = prompt(':', `${currentPreset.name} ()`);\n      if (!name) return;\n\n      const newPreset = RegexPresetManager.createPreset(name, currentPreset.id);\n      if (newPreset) {\n        // [] \n        const $presetSelect = dialog.find('#regex-preset-select');\n        $presetSelect.append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        $presetSelect.val(newPreset.id);\n\n        refreshRegexRulesList(); // \n      } else {\n        toastr.error('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-new').on('click', function () {\n      const name = prompt(':');\n      if (!name) return;\n\n      const newPreset = RegexPresetManager.createPreset(name, null);\n      if (newPreset) {\n        RegexPresetManager.setActivePreset(newPreset.id);\n\n        // [] \n        const $presetSelect = dialog.find('#regex-preset-select');\n        $presetSelect.append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        $presetSelect.val(newPreset.id);\n\n        refreshRegexRulesList(); // \n      } else {\n        toastr.error('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-del').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      if (confirm(`\"${currentPreset.name}\"`)) {\n        const success = RegexPresetManager.deletePreset(currentPreset.id);\n        if (success) {\n          // [] \n          const $presetSelect = dialog.find('#regex-preset-select');\n          $presetSelect.find(`option[value=\"${currentPreset.id}\"]`).remove();\n\n          // \n          const defaultPresetId = RegexPresetManager.getActivePreset()?.id;\n          if (defaultPresetId) {\n            $presetSelect.val(defaultPresetId);\n          }\n\n          refreshRegexRulesList(); // \n        } else {\n          toastr.error('');\n        }\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-export').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      const json = RegexPresetManager.exportPreset(currentPreset.id);\n      if (json) {\n        const blob = new Blob([json], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `regex-preset-${currentPreset.name}-${Date.now()}.json`;\n        a.click();\n        URL.revokeObjectURL(url);\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-import').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const text = await file.text();\n          if (!text?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(text.trim());\n          } catch {\n            toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.name || '';\n          const existingPresets = RegexPresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = text.trim();\n            if (newName) {\n              parsedData.name = newName;\n              // IDID\n              parsedData.id = `regex_preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset) {\n                // \n                if (existingPresets.length > 1) {\n                  RegexPresetManager.deletePreset(existingPreset.id);\n                  dialog.find(`#regex-preset-select option[value=\"${existingPreset.id}\"]`).remove();\n                }\n              }\n            }\n\n            const preset = RegexPresetManager.importPreset(finalJson);\n            if (preset) {\n              // [] \n              const $presetSelect = dialog.find('#regex-preset-select');\n              $presetSelect.append(`<option value=\"${escapeHtml(preset.id)}\">${escapeHtml(preset.name)}</option>`);\n              $presetSelect.val(preset.id);\n\n              // [] \n              RegexPresetManager.setActivePreset(preset.id);\n              Store.set(STORAGE_KEY_REGEX_RULES, preset.rules || []);\n              RegexTransformationManager.clearCache();\n\n              refreshRegexRulesList(); // \n            } else {\n              toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-reset').on('click', function () {\n      if (!confirm('\\n\\n')) return;\n\n      // \n      const presets = RegexPresetManager.getAllPresets();\n      let defaultPreset = presets.find(p => p.id === 'regex_default');\n\n      if (defaultPreset) {\n        // \n        defaultPreset.rules = JSON.parse(JSON.stringify(BUILTIN_REGEX_RULES.map(r => ({ ...r, builtin: true }))));\n        defaultPreset.version = PRESET_FORMAT_VERSION;\n        defaultPreset.updatedAt = Date.now();\n      } else {\n        // \n        defaultPreset = {\n          id: 'regex_default',\n          name: '',\n          description: '',\n          version: PRESET_FORMAT_VERSION,\n          rules: JSON.parse(JSON.stringify(BUILTIN_REGEX_RULES.map(r => ({ ...r, builtin: true })))),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n        presets.unshift(defaultPreset);\n      }\n      RegexPresetManager._save(presets);\n\n      // \n      Store.set(STORAGE_KEY_REGEX_ACTIVE_PRESET, 'regex_default');\n\n      // \n      Store.set(\n        STORAGE_KEY_REGEX_RULES,\n        JSON.parse(JSON.stringify(BUILTIN_REGEX_RULES.map(r => ({ ...r, builtin: true })))),\n      );\n      RegexTransformationManager.clearCache();\n\n      // UI - \n      const $presetSelect = dialog.find('#regex-preset-select');\n      $presetSelect.empty();\n      RegexPresetManager.getAllPresets().forEach(p => {\n        const versionSuffix = p.id === 'regex_default' ? ` v${PRESET_FORMAT_VERSION}` : '';\n        $presetSelect.append(`<option value=\"${escapeHtml(p.id)}\">${escapeHtml(p.name)}${versionSuffix}</option>`);\n      });\n      $presetSelect.val('regex_default');\n      refreshRegexRulesList();\n\n      toastr.success(` ${BUILTIN_REGEX_RULES.length} `);\n    });\n\n    // === : ===\n    dialog.find('#btn-add-regex-rule').on('click', function () {\n      showAddRegexRuleModal();\n    });\n\n    // === : ===\n    dialog.find('#btn-import-tavern-regex').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const text = await file.text();\n          if (!text?.trim()) return;\n\n          let parsed;\n          try {\n            parsed = JSON.parse(text.trim());\n          } catch {\n            toastr.error('JSON');\n            return;\n          }\n\n          // \n          const tavernRegexList: TavernRegex[] = Array.isArray(parsed) ? parsed : [parsed];\n\n          //  scriptName  findRegex\n          if (!tavernRegexList.every(r => r.scriptName && r.findRegex)) {\n            toastr.error(' scriptName  findRegex ');\n            return;\n          }\n\n          const existingRules = RegexTransformationManager.getAllRules();\n          const existingNames = existingRules.map(r => r.name);\n\n          let importedCount = 0;\n          let skippedCount = 0;\n\n          // \n          const processNext = (index: number): void => {\n            if (index >= tavernRegexList.length) {\n              // \n              refreshRegexRulesList();\n              if (skippedCount > 0) {\n                toastr.info(`: ${importedCount} , ${skippedCount} `);\n              } else if (importedCount > 0) {\n                toastr.success(` ${importedCount} `);\n              }\n              return;\n            }\n\n            const tavernRegex = tavernRegexList[index];\n            const convertedRule = convertTavernRegexToRule(tavernRegex);\n            const hasConflict = existingNames.includes(convertedRule.name);\n\n            if (hasConflict) {\n              // \n              showPresetConflictDialog({\n                presetName: convertedRule.name,\n                presetType: '',\n                existingNames,\n                onOverwrite: () => {\n                  // \n                  const oldRule = RegexTransformationManager.getAllRules().find(r => r.name === convertedRule.name);\n                  if (oldRule) RegexTransformationManager.removeRule(oldRule.id);\n                  RegexTransformationManager.addCustomRule(convertedRule);\n                  existingNames.push(convertedRule.name);\n                  importedCount++;\n                  processNext(index + 1);\n                },\n                onRename: newName => {\n                  convertedRule.name = newName;\n                  convertedRule.id = `tavern_import_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n                  RegexTransformationManager.addCustomRule(convertedRule);\n                  existingNames.push(newName);\n                  importedCount++;\n                  processNext(index + 1);\n                },\n                onCancel: () => {\n                  skippedCount++;\n                  processNext(index + 1);\n                },\n              });\n            } else {\n              // \n              RegexTransformationManager.addCustomRule(convertedRule);\n              existingNames.push(convertedRule.name);\n              importedCount++;\n              processNext(index + 1);\n            }\n          };\n\n          // \n          processNext(0);\n        } catch (err) {\n          toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // === : ===\n    dialog.find('#btn-add-validation-rule').on('click', function () {\n      showAddValidationRuleModal(dialog);\n    });\n\n    // === Debug ===\n    dialog.find('#btn-open-debug-console').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showDebugConsoleModal();\n    });\n\n    // ===  ===\n    dialog.find('#cfg-clear-local-cache').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      showManualUpdateDialog({\n        title: '',\n        iconClass: 'fa-trash-can',\n        description: '',\n        safeTitle: '',\n        safeDescription: '',\n        confirmText: '',\n        loadingText: '...',\n        isDanger: true,\n        safeIconClass: 'fa-triangle-exclamation',\n        onConfirm: async () => {\n          const removedLocalStorageKeys = await clearDiceLocalCacheData();\n          if (window.toastr) {\n            window.toastr.success(\n              `localStorage ${removedLocalStorageKeys}  IndexedDB/`,\n            );\n          }\n        },\n      });\n    });\n\n    // ===  ===\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n      renderInterface();\n    };\n    dialog.on('click', '#dlg-close-x, .acu-settings-header .acu-close-btn', closeDialog);\n\n    // \n    dialog.on('click', '#acu-help-btn', function (e) {\n      e.stopPropagation();\n      window.open('https://jerryzmtz.github.io/DiceSystemManual//', '_blank');\n    });\n\n    // \n    dialog.on('click', '#acu-manual-update-btn', function (e) {\n      e.stopPropagation();\n      showManualUpdateDialog();\n    });\n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n  };\n\n  // [] \n  let renderInterfaceTimer = null;\n  let renderInterfacePending = false;\n\n  const renderInterface = () => {\n    // \n    if (isSettingsOpen) {\n      if (!renderInterfacePending) {\n        console.info('[DICE]');\n        renderInterfacePending = true;\n      }\n      return;\n    }\n\n    // [] \n    saveCurrentTabState();\n\n    // \n    if (renderInterfaceTimer) {\n      clearTimeout(renderInterfaceTimer);\n    }\n\n    // 50ms\n    renderInterfaceTimer = setTimeout(() => {\n      renderInterfaceTimer = null;\n      renderInterfacePending = false;\n      _renderInterfaceImpl();\n    }, 50);\n  };\n\n  // \n  const _renderInterfaceImpl = () => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n\n    // [] Observer  ()\n    if (!observer && $('#chat').length) {\n      const $chat = $('#chat');\n      let mutationLock = false;\n      const handleMutation = () => {\n        if (mutationLock) return;\n        mutationLock = true;\n        requestAnimationFrame(() => {\n          const config = getConfig();\n          if (config.positionMode === 'embedded') {\n            mutationLock = false;\n            return;\n          }\n          const children = $chat.children();\n          const lastChild = children.last()[0];\n          const wrapper = $('.acu-wrapper')[0];\n          if (wrapper && lastChild && lastChild !== wrapper) {\n            if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n              $chat.append(wrapper);\n            }\n          }\n\n          // [] \n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            // 1\n            const children = $chat.children();\n            const lastChild = children.last();\n            if (lastChild.hasClass('mes') || lastChild.hasClass('message-body')) {\n              lastChild.addClass('acu-dice-result-revealing');\n            }\n\n            // 2RAF\n            requestAnimationFrame(() => {\n              hideDiceResultsInUserMessages();\n\n              // 3\n              requestAnimationFrame(() => {\n                lastChild.removeClass('acu-dice-result-revealing').addClass('acu-dice-result-revealed');\n                // \n                setTimeout(() => {\n                  lastChild.removeClass('acu-dice-result-revealed');\n                }, 200);\n              });\n            });\n          }\n\n          mutationLock = false;\n        });\n      };\n      observer = new MutationObserver(handleMutation);\n      observer.observe($chat[0], { childList: true });\n    }\n    let rawData;\n    let isDataFromDatabase = false; // \n    if (hasUnsavedChanges && cachedRawData) {\n      rawData = cachedRawData;\n    } else {\n      rawData = getTableData();\n      isDataFromDatabase = true; // \n\n      // [] auto\n      // \n      // \n      if (rawData && !isAutoTransforming && isDataFromDatabase) {\n        try {\n          const enabledRules = RegexTransformationManager.getEnabledRules();\n\n          if (enabledRules.length > 0) {\n            console.info(`[DICE] ${enabledRules.length} ...`);\n\n            isAutoTransforming = true; // \n            const transformResult = RegexTransformationEngine.applyToTable(rawData, enabledRules);\n            if (transformResult.totalApplied > 0) {\n              console.info(`[DICE] ${transformResult.totalApplied} `);\n\n              // \n              //  saveDataOnly \n              // saveDataOnly  UpdateController.handleUpdate() isAutoTransforming \n              // \n              saveDataOnly(rawData, transformResult.modifiedSheetKeys).catch(err => {\n                console.warn('[DICE]:', err);\n              });\n            }\n            if (transformResult.errors.length > 0) {\n              console.warn(`[DICE] ${transformResult.errors.length} :`, transformResult.errors);\n            } else if (transformResult.totalApplied === 0) {\n              console.info('[DICE]');\n            }\n            isAutoTransforming = false; // \n          } else {\n            isAutoTransforming = false; // \n          }\n        } catch (transformError) {\n          isAutoTransforming = false; // \n          const errorMsg = transformError instanceof Error ? transformError.message : String(transformError);\n          console.error('[DICE]:', transformError);\n        }\n      }\n\n      if (rawData) {\n        cachedRawData =\n          typeof structuredClone === 'function' ? structuredClone(rawData) : JSON.parse(JSON.stringify(rawData));\n\n        const existingSnapshot = loadSnapshot();\n        const currentCtx = getCurrentContextFingerprint();\n\n        // \n        const hasValidSnapshotData =\n          existingSnapshot && Object.keys(existingSnapshot).some(k => k.startsWith('sheet_'));\n\n        if (!existingSnapshot || !hasValidSnapshotData) {\n          // 1    \n          saveSnapshot({ ...cachedRawData, _contextId: currentCtx });\n        } else if (!existingSnapshot._contextId) {\n          // 2 ID \n          saveSnapshot({ ...existingSnapshot, _contextId: currentCtx });\n        } else if (existingSnapshot._contextId !== currentCtx) {\n          // 3  \n          cachedRawData._contextId = currentCtx;\n          saveSnapshot(cachedRawData);\n        }\n        // 4  \n      }\n    }\n\n    const $searchInput = $('.acu-search-input');\n    if ($('.acu-wrapper').length && $searchInput.is(':focus')) {\n      if (rawData) {\n        if (!isSaving) currentDiffMap = generateDiffMap(rawData);\n        const tables = processJsonData(rawData);\n        const activeTab = getActiveTabState();\n        const currentTabName = activeTab && tables[activeTab] ? activeTab : null;\n\n        if (currentTabName && tables[currentTabName]) {\n          const newHtml = renderTableContent(tables[currentTabName], currentTabName);\n          const $virtualDom = $('<div>').html(newHtml);\n          $('.acu-card-grid').replaceWith($virtualDom.find('.acu-card-grid'));\n          $('.acu-panel-title').html($virtualDom.find('.acu-panel-title').html());\n          // [] \n          bindEvents(tables);\n          bindOptionEvents(); // <--- \n          return;\n        }\n      }\n    }\n\n    let lastScrollX = 0;\n    let lastScrollY = 0;\n\n    const $oldContent = $('.acu-panel-content');\n    if ($oldContent.length) {\n      lastScrollX = $oldContent.scrollLeft();\n      lastScrollY = $oldContent.scrollTop();\n    }\n\n    $('.acu-wrapper').remove();\n    const tables = processJsonData(rawData || {});\n\n    if (isSaving) {\n      currentDiffMap = new Set();\n    } else {\n      currentDiffMap = generateDiffMap(rawData);\n    }\n\n    const savedOrder = getSavedTableOrder();\n    let orderedNames = Object.keys(tables);\n    if (savedOrder)\n      orderedNames = savedOrder.filter(n => tables[n]).concat(orderedNames.filter(n => !savedOrder.includes(n)));\n\n    const hiddenList = getHiddenTables();\n    orderedNames = orderedNames.filter(n => !hiddenList.includes(n));\n\n    const activeTab = getActiveTabState();\n    let currentTabName = activeTab && tables[activeTab] && !hiddenList.includes(activeTab) ? activeTab : null;\n\n    const config = getConfig();\n    const isCollapsed = getCollapsedState();\n\n    const layoutClass = config.layout === 'vertical' ? 'acu-layout-vertical' : '';\n    // []  (/)\n    const positionClass = `acu-mode-${config.positionMode || 'fixed'}`;\n\n    // []  () \n    let finalGridCols = config.gridColumns;\n    if (finalGridCols === 'auto') {\n      const n = orderedNames.length;\n\n      if (n <= 4) {\n        finalGridCols = n < 2 ? 2 : n;\n      } else {\n        const empty3 = Math.ceil(n / 3) * 3 - n;\n        const empty4 = Math.ceil(n / 4) * 4 - n;\n        finalGridCols = empty4 <= empty3 ? 4 : 3;\n      }\n    }\n\n    // --- []  +  ---\n    let optionHtml = '';\n    let currentOptionHash = null; // \n\n    if (config.showOptionPanel !== false) {\n      const optionTables = [];\n      Object.keys(tables).forEach(k => {\n        if (k.includes('')) optionTables.push(tables[k]);\n      });\n\n      // []  - \n      if (optionTables.length > 0) {\n        const isOptionsCollapsed = getOptionsCollapsedState();\n        const collapseIcon = isOptionsCollapsed ? 'fa-chevron-right' : 'fa-chevron-down';\n        const collapseText = isOptionsCollapsed ? '' : '';\n        const collapsedClass = isOptionsCollapsed ? 'collapsed' : '';\n\n        let optionCount = 0;\n        let hasBtns = false;\n        // []\n        let optionValues = []; // \n\n        // \n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  optionCount++;\n                }\n              });\n            });\n          }\n        });\n\n        // \n        let buttonsHtml = `\n                    <div class=\"acu-opt-header\" data-action=\"toggle-options\">\n                        <span>\n                            <i class=\"fa-solid ${collapseIcon}\" style=\"margin-right:6px;font-size:10px;\"></i>\n                             (${optionCount})\n                        </span>\n                    </div>`;\n\n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  const cellStr = String(cell).trim();\n                  buttonsHtml += `<button class=\"acu-opt-btn\" data-val=\"${safeEncodeURIComponent(cellStr)}\">${escapeHtml(cellStr)}</button>`;\n                  optionValues.push(cellStr);\n                  hasBtns = true;\n                }\n              });\n            });\n          }\n        });\n\n        if (hasBtns) {\n          optionHtml = `<div class=\"acu-option-panel acu-theme-${config.theme} ${collapsedClass}\">${buttonsHtml}</div>`;\n          //  ()\n          // [] \n          currentOptionHash =\n            optionValues.join('|||') +\n            (isOptionsCollapsed ? '_collapsed' : '_expanded') +\n            `_theme_${config.theme}` +\n            `_optSize_${config.optionFontSize || 12}`;\n        }\n      }\n    }\n\n    // [] \n    const optionChanged = currentOptionHash !== lastOptionHash;\n    // [] \n    //  optionPanelVisible  false \n    if (currentOptionHash !== null) {\n      optionPanelVisible = true;\n    }\n    lastOptionHash = currentOptionHash; // \n\n    // []  wrapper \n    let html = `<div class=\"acu-wrapper ${positionClass} acu-theme-${config.theme} ${layoutClass}\" style=\"--acu-card-width:${config.cardWidth}px; --acu-font-size:${config.fontSize}px; --acu-opt-font-size:${config.optionFontSize || 12}px; --acu-grid-cols:${finalGridCols}\">`;\n\n    // []  DOM  column-reverse\n    // []  optionPanelVisible \n    if (config.positionMode === 'embedded' && optionHtml && optionPanelVisible) {\n      html += optionHtml;\n    }\n\n    if (isCollapsed) {\n      const colStyleClass = `acu-col-${config.collapseStyle || 'bar'}`;\n      const alignClass = `acu-align-${config.collapseAlign || 'right'}`;\n\n      html += `\n                <div class=\"acu-expand-trigger ${colStyleClass} ${alignClass}\" id=\"acu-btn-expand\">\n                    <i class=\"fa-solid fa-table\"></i> <span> (${Object.keys(tables).length})</span>\n                </div>\n            `;\n    } else {\n      // [] \n      const savedHeight = currentTabName ? getTableHeights()[currentTabName] : null;\n      // [] \n      const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n      const isChangesPanelActive = Store.get('acu_changes_panel_active', false);\n      const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n      const mvuSavedHeight = isMvuActive ? getTableHeights()[MvuModule.MODULE_ID] : null;\n      const finalSavedHeight = mvuSavedHeight || savedHeight;\n      const shouldShowPanel = isDashboardActive || isChangesPanelActive || isMvuActive || currentTabName;\n\n      html += `\n                <div class=\"acu-data-display ${shouldShowPanel ? 'visible' : ''} ${finalSavedHeight ? 'acu-manual-mode' : ''}\" id=\"acu-data-area\" style=\"${finalSavedHeight ? 'height:' + finalSavedHeight + 'px;' : ''}\">\n                    ${\n                      isChangesPanelActive\n                        ? renderChangesPanel(rawData)\n                        : isDashboardActive\n                          ? renderDashboard(tables)\n                          : isMvuActive\n                            ? '<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>'\n                            : currentTabName\n                              ? renderTableContent(tables[currentTabName], currentTabName)\n                              : ''\n                    }\n                </div>\n                `;\n\n      // [] \n      // PC(>768px) CSS display:flex !important grid \n      const gridFixStyle = `grid-template-columns: repeat(${finalGridCols}, 1fr);`;\n\n      html += `\n                <div class=\"acu-nav-container ${config.actionsPosition === 'top' ? 'acu-pos-top' : ''}\" id=\"acu-nav-bar\" style=\"${gridFixStyle}\">\n                    <div class=\"acu-order-controls\" id=\"acu-order-hint\"><i class=\"fa-solid fa-arrows-alt\"></i> </div>\n            `;\n\n      // ===  +  ===\n      const isChangesActive = Store.get('acu_changes_panel_active', false);\n      const isFavoritesActive = Store.get('acu_favorites_panel_active', false);\n      const isSimpleModeNav = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n      let changesCount = 0;\n      let validationErrorCount = 0;\n      if (rawData) {\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          for (const sheetId in rawData) {\n            if (!sheetId.startsWith('sheet_')) continue;\n            const newSheet = rawData[sheetId];\n            const oldSheet = snapshot[sheetId];\n            if (!newSheet?.content) continue;\n            const newRows = newSheet.content.slice(1);\n            const oldRows = oldSheet?.content?.slice(1) || [];\n\n            // [] detectChanges\n            const oldRowsByTitle = new Map<string, Array<{ index: number; row: (typeof oldRows)[0] }>>();\n            oldRows.forEach((row, rIdx) => {\n              const title = String(row[1] ?? '').trim();\n              if (!oldRowsByTitle.has(title)) {\n                oldRowsByTitle.set(title, []);\n              }\n              oldRowsByTitle.get(title)!.push({ index: rIdx, row });\n            });\n\n            newRows.forEach((row, rowIdx) => {\n              const title = String(row[1] ?? '').trim();\n              let oldRow: (typeof oldRows)[0] | undefined;\n\n              if (title && oldRowsByTitle.has(title)) {\n                const queue = oldRowsByTitle.get(title)!;\n                if (queue.length > 0) {\n                  const matched = queue.shift()!;\n                  oldRow = matched.row;\n                }\n              } else if (!title) {\n                oldRow = oldRows[rowIdx];\n              }\n\n              if (!oldRow) {\n                changesCount++; // \n              } else {\n                // \n                let hasChange = false;\n                row.forEach((cell, colIdx) => {\n                  if (colIdx === 0) return;\n                  if (String(cell ?? '') !== String(oldRow![colIdx] ?? '')) hasChange = true;\n                });\n                if (hasChange) changesCount++;\n              }\n            });\n\n            // \n            const newTitleCounts = new Map<string, number>();\n            const oldTitleCounts = new Map<string, number>();\n            newRows.forEach(row => {\n              const title = String(row[1] ?? '').trim();\n              if (title) newTitleCounts.set(title, (newTitleCounts.get(title) || 0) + 1);\n            });\n            oldRows.forEach(row => {\n              const title = String(row[1] ?? '').trim();\n              if (title) oldTitleCounts.set(title, (oldTitleCounts.get(title) || 0) + 1);\n            });\n            oldTitleCounts.forEach((oldCount, title) => {\n              const newCount = newTitleCounts.get(title) || 0;\n              if (oldCount > newCount) changesCount += oldCount - newCount;\n            });\n            // \n            const emptyOldCount = oldRows.filter(r => !String(r[1] ?? '').trim()).length;\n            const emptyNewCount = newRows.filter(r => !String(r[1] ?? '').trim()).length;\n            if (emptyOldCount > emptyNewCount) changesCount += emptyOldCount - emptyNewCount;\n          }\n          for (const sheetId in snapshot) {\n            if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n          }\n        }\n        // \n        validationErrorCount = ValidationEngine.getErrorCount(rawData);\n      }\n      // \n      const isValidationMode = isSimpleModeNav;\n      const displayCount = isValidationMode ? validationErrorCount : changesCount;\n      // \n      const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n      // ===  ===\n      const navHiddenList = getHiddenTables();\n      const navSavedOrder = getSavedTableOrder() || [];\n\n      //  + \n      const SPECIAL_NAV_ITEMS = [\n        { key: '__dice__', icon: 'fa-dice-d20', label: '', id: 'acu-btn-dice-nav', extraClass: 'acu-dice-nav-btn' },\n        {\n          key: '__changes__',\n          icon: 'fa-code-compare',\n          label: `${displayCount > 0 ? '(' + displayCount + ')' : ''}`,\n          id: 'acu-btn-changes',\n          extraClass: `acu-changes-btn${showWarningIcon ? ' has-validation-errors' : ''}`,\n          isActive: isChangesActive,\n          warningIcon: showWarningIcon,\n        },\n        {\n          key: '__mvu__',\n          icon: 'fa-code-branch',\n          label: '',\n          id: 'acu-btn-mvu',\n          extraClass: 'acu-mvu-btn',\n          isActive: getActiveTabState() === MvuModule.MODULE_ID,\n        },\n        {\n          key: '__favorites__',\n          icon: 'fa-star',\n          label: '',\n          id: 'acu-btn-favorites',\n          extraClass: 'acu-favorites-btn',\n          isActive: isFavoritesActive,\n        },\n      ];\n\n      // \n      let allNavItems = [];\n\n      // \n      SPECIAL_NAV_ITEMS.forEach(item => {\n        // \n        if (navHiddenList.includes(item.key)) return;\n\n        // MVU\n        if (item.key === '__mvu__') {\n          allNavItems.push({ ...item, isSpecial: true });\n          return;\n        }\n\n        // checkAvailable\n        if (item.checkAvailable && !item.checkAvailable()) return;\n        allNavItems.push({ ...item, isSpecial: true });\n      });\n\n      // \n      orderedNames.forEach(name => {\n        allNavItems.push({\n          key: name,\n          icon: getIconForTableName(name),\n          label: name,\n          isSpecial: false,\n          isActive: !isDashboardActive && !isChangesActive && currentTabName === name,\n        });\n      });\n\n      // \n      if (navSavedOrder.length > 0) {\n        const orderMap = new Map(navSavedOrder.map((k, i) => [k, i]));\n        allNavItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      // [] /\n      // order  1  Grid \n      html += `<button class=\"acu-nav-btn acu-dashboard-btn ${isDashboardActive ? 'active' : ''}\" id=\"acu-btn-dashboard\" style=\"order: 1;\">\n                <i class=\"fa-solid fa-chart-line\"></i><span></span>\n            </button>`;\n\n      // order  2 \n      allNavItems.forEach((item, idx) => {\n        const activeClass = item.isActive ? 'active' : '';\n        const extraClass = item.extraClass || '';\n        const orderVal = idx + 2; //  2  1\n\n        if (item.isSpecial) {\n          // \n          const warningIconHtml = item.warningIcon\n            ? '<i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>'\n            : '';\n          html += `<button class=\"acu-nav-btn ${extraClass} ${activeClass}\" id=\"${item.id}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>${warningIconHtml}\n                    </button>`;\n        } else {\n          // \n          html += `<button class=\"acu-nav-btn ${activeClass}\" data-table=\"${escapeHtml(item.key)}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>\n                    </button>`;\n        }\n      });\n\n      // order \n      html += `<div class=\"acu-actions-group\" id=\"acu-active-actions\" style=\"order: 9999;\">`;\n      ACTION_BUTTONS.forEach(btn => {\n        html += `<button class=\"acu-action-btn\" id=\"${btn.id}\" title=\"${btn.title}\"><i class=\"fa-solid ${btn.icon}\"></i></button>`;\n      });\n      html += `</div>`;\n\n      html += `</div>`; //  acu-nav-container\n    }\n\n    html += `</div>`; //  acu-wrapper\n\n    const $existing = $('.acu-wrapper');\n    if ($existing.length) {\n      $existing.replaceWith(html);\n    } else {\n      insertHtmlToPage(html);\n    }\n\n    // --- []  ---\n    if (config.positionMode !== 'embedded' && optionHtml && optionPanelVisible) {\n      if (optionChanged) {\n        //  AI \n        injectIndependentOptions(optionHtml);\n      } else {\n        // \n        const $existing = $('.acu-embedded-options-container');\n        if ($existing.length === 0) {\n          // \n          injectIndependentOptions(optionHtml);\n        } else {\n          // []  AI \n          const $lastAiMes = $('#chat .mes')\n            .filter(function () {\n              const $this = $(this);\n              if ($this.attr('is_user') === 'true' || $this.attr('is_system') === 'true' || $this.hasClass('sys_mes'))\n                return false;\n              if ($this.find('.name_text').text().trim() === 'System' || $this.attr('data-is-system') === 'true')\n                return false;\n              if ($this.find('.mes_text').length === 0) return false;\n              if ($this.css('display') === 'none') return false;\n              return true;\n            })\n            .last();\n\n          const isOnLatestMessage =\n            $lastAiMes.length > 0 && $lastAiMes.find('.acu-embedded-options-container').length > 0;\n\n          if (!isOnLatestMessage) {\n            // \n            injectIndependentOptions(optionHtml);\n          } else {\n            // [] fadeOut\n            const containerVisible = $existing.is(':visible');\n            const containerDisplay = $existing.css('display');\n            const containerHtmlLength = $existing.html()?.length || 0;\n            if (!containerVisible || containerDisplay === 'none' || containerHtmlLength === 0) {\n              injectIndependentOptions(optionHtml);\n            }\n          }\n        }\n      }\n    } else if (config.positionMode !== 'embedded') {\n      // \n      $('.acu-embedded-options-container').remove();\n    } else {\n      // [] \n      $('.acu-embedded-options-container').remove();\n    }\n\n    bindEvents(tables);\n    bindOptionEvents();\n    updateSaveButtonState();\n    // [] NPC\n    loadDashboardNpcAvatars();\n    // [] \n    if (Store.get('acu_changes_panel_active', false)) {\n      bindChangesEvents();\n    }\n    // [] \n    if (canWriteMvuPanel()) {\n      const $panel = $('#acu-data-area');\n      if ($panel.length) {\n        // \n        // \n        // \n        $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n        MvuModule.bindEvents($panel);\n\n        // \n        MvuModule.getDataWithRetry(5, 800)\n          .then(mvuData => {\n            // \n            if (mvuData && canWriteMvuPanel()) {\n              $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n              MvuModule.bindEvents($panel);\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error getting data:', err);\n            if (canWriteMvuPanel()) {\n              // \n              $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n              MvuModule.bindEvents($panel);\n            }\n          });\n      }\n    }\n\n    setTimeout(() => {\n      const $newContent = $('.acu-panel-content');\n      const activeTab = getActiveTabState();\n      const savedState = tableScrollStates[activeTab];\n\n      if ($newContent.length) {\n        // 1. \n        //  savedState () lastScrollY ()\n        if (savedState) {\n          $newContent.scrollTop(savedState.top);\n          $newContent.scrollLeft(savedState.left);\n        } else {\n          if (lastScrollY > 0) $newContent.scrollTop(lastScrollY);\n          if (lastScrollX > 0) $newContent.scrollLeft(lastScrollX);\n        }\n\n        // 2.  ()\n        if (savedState && savedState.inner) {\n          Object.keys(savedState.inner).forEach(key => {\n            const scrollTop = savedState.inner[key];\n            // \n            const $targetTitle = $newContent.find(`.acu-editable-title[data-row=\"${key}\"]`);\n            if ($targetTitle.length) {\n              const $card = $targetTitle.closest('.acu-data-card');\n              //  ( overflow on card)\n              $card.scrollTop(scrollTop);\n              //  body  ( overflow on body)\n              $card.find('.acu-card-body').scrollTop(scrollTop);\n            }\n          });\n        }\n      }\n    }, 0);\n\n    console.info('[DICE]');\n  };\n\n  // [] \n  const injectIndependentOptions = htmlContent => {\n    const { $ } = getCore();\n    $('.acu-embedded-options-container').remove();\n\n    //  AI \n    const getTargetContainer = () => {\n      const $allMes = $('#chat .mes');\n      const $aiMes = $allMes.filter(function () {\n        const $this = $(this);\n        if ($this.attr('is_user') === 'true' || $this.attr('is_system') === 'true' || $this.hasClass('sys_mes'))\n          return false;\n        //  data-is-system \n        if ($this.find('.name_text').text().trim() === 'System' || $this.attr('data-is-system') === 'true')\n          return false;\n        // [] \n        if ($this.find('.mes_text').length === 0) return false;\n        if ($this.css('display') === 'none') return false;\n        return true;\n      });\n      if ($aiMes.length === 0) return null;\n\n      const $targetMes = $aiMes.last();\n      const $targetText = $targetMes.find('.mes_text');\n      const $targetBlock = $targetMes.find('.mes_block');\n      if ($targetText.length) return $targetText;\n      if ($targetBlock.length) return $targetBlock;\n      return $targetMes;\n    };\n\n    const $target = getTargetContainer();\n    if ($target && $target.length) {\n      const optConfig = getConfig();\n      const $container = $(\n        `<div class=\"acu-embedded-options-container acu-theme-${optConfig.theme}\" style=\"--acu-opt-font-size:${optConfig.optionFontSize || 12}px;\"></div>`,\n      );\n      $container.html(htmlContent);\n      // []  mes_text \n      //  SillyTavern  mes_text \n      $target.after($container);\n    }\n  };\n\n  // []  ( + )\n  const bindOptionEvents = () => {\n    const { $ } = getCore();\n    //  Body \n    $('body')\n      .off('click.acu_opt')\n      .on('click.acu_opt', '.acu-opt-btn', async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const config = getConfig();\n        const val = safeDecodeURIComponent($(this).data('val'));\n\n        // 1:  -> \n        if (!config.clickOptionToAutoSend) {\n          smartInsertToTextarea(val, 'action');\n          $('#send_textarea').focus();\n          return;\n        }\n\n        // 2: \n        // A: TavernHelper ( refresh: 'affected' )\n        if (window.TavernHelper) {\n          try {\n            // 1.  createChatMessages \n            if (window.TavernHelper.createChatMessages) {\n              await window.TavernHelper.createChatMessages(\n                [\n                  {\n                    role: 'user',\n                    message: val,\n                  },\n                ],\n                {\n                  //  TavernHelper \n                  refresh: 'affected',\n                },\n              );\n\n              // 2. \n              if (window.TavernHelper.triggerSlash) {\n                await window.TavernHelper.triggerSlash('/trigger');\n              }\n              return;\n            }\n          } catch (err) {\n            console.warn('[DICE]ACU TavernHelper ', err);\n          }\n        }\n\n        // B: SillyTavern  (Slash Command)\n        const ST = window.SillyTavern || window.parent?.SillyTavern;\n        if (ST && ST.executeSlashCommandsWithOptions) {\n          try {\n            //  raw=true  ( slash_command.txt)\n            const safeVal = val.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n            const cmd = `/send raw=true \"${safeVal}\"`;\n\n            const sendResult = await ST.executeSlashCommandsWithOptions(cmd);\n\n            if (!sendResult.isError && !sendResult.isAborted) {\n              await ST.executeSlashCommandsWithOptions('/trigger');\n              return;\n            }\n            console.warn('[DICE]ACU ST send :', sendResult);\n          } catch (err) {\n            console.warn('[DICE]ACU ST', err);\n          }\n        }\n\n        // C:  +  ()\n        const ta = $('#send_textarea');\n        if (ta.length) {\n          ta.val(val);\n          ta.trigger('input').trigger('change');\n          //  React \n          await new Promise(r => setTimeout(r, 50));\n          const sendBtn = $('#send_but').filter(':visible');\n          if (sendBtn.length) {\n            sendBtn[0].click();\n          } else {\n            // \n            const enterEvent = $.Event('keydown', { keyCode: 13, which: 13, bubbles: true });\n            ta.trigger(enterEvent);\n          }\n        }\n      });\n  };\n\n  const insertHtmlToPage = html => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // ---  ---\n\n    // 1.  (Embedded) v19 \n    if (config.positionMode === 'embedded') {\n      $('.acu-wrapper').remove(); // \n\n      const getTargetContainer = () => {\n        const $allMes = $('#chat .mes');\n        const $aiMes = $allMes.filter(function () {\n          const $this = $(this);\n          if ($this.attr('is_user') === 'true') return false;\n          if ($this.attr('is_system') === 'true') return false;\n          if ($this.hasClass('sys_mes')) return false;\n          const name = $this.find('.name_text').text().trim();\n          if (name === 'System') return false;\n          if ($this.css('display') === 'none') return false;\n          const $textDiv = $this.find('.mes_text');\n          if ($textDiv.length === 0) return false;\n          const textContent = $textDiv.text().trim();\n          const hasImage = $textDiv.find('img').length > 0;\n          if (textContent.length === 0 && !hasImage) return false;\n          return true;\n        });\n        //  AI  chat\n        if ($aiMes.length === 0) return $('#chat');\n\n        // \n\n        let targetIndex = $aiMes.length - 1;\n        const $targetMes = $aiMes.eq(targetIndex);\n        const $targetBlock = $targetMes.find('.mes_block');\n        return $targetBlock.length ? $targetBlock : $targetMes;\n      };\n\n      const $target = getTargetContainer();\n      if ($target.length) {\n        if ($target.hasClass('mes_block') || $target.hasClass('mes')) {\n          if ($target.find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          } else {\n            $target.find('.acu-wrapper').replaceWith(html);\n          }\n        } else {\n          // Fallback\n          if ($('#chat').find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          }\n        }\n      } else {\n        $('body').append(html);\n      }\n      return;\n    }\n\n    // 2.  (Fixed) B \n    // \n    const $chat = $('#chat');\n    const $oldWrapper = $('.acu-wrapper');\n\n    if ($oldWrapper.length) {\n      $oldWrapper.replaceWith(html);\n    } else {\n      if ($chat.length) {\n        $chat.append(html);\n      } else {\n        $('body').append(html);\n      }\n    }\n  };\n  // [] \n  const renderChangesPanel = rawData => {\n    const snapshot = loadSnapshot();\n    const config = getConfig();\n\n    // \n    const validationErrors = rawData ? ValidationEngine.validateAllData(rawData) : [];\n\n    if (!snapshot || !rawData) {\n      // \n      if (validationErrors.length === 0) {\n        return `\n                <div class=\"acu-panel-header\">\n                    <div class=\"acu-panel-title\">\n                        <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-compare\"></i> <span class=\"acu-title-text\"></span></div>\n                        <div class=\"acu-title-sub\"></div>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-panel-content\" style=\"display:flex;align-items:center;justify-content:center;\">\n                    <div class=\"acu-empty-hint\"></div>\n                </div>`;\n      }\n    }\n\n    // \n    const changes = [];\n\n    for (const sheetId in rawData) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      const newSheet = rawData[sheetId];\n      const oldSheet = snapshot[sheetId];\n      if (!newSheet?.name || !newSheet?.content) continue;\n\n      const tableName = newSheet.name;\n      const headers = newSheet.content[0] || [];\n      const newRows = newSheet.content.slice(1);\n      const oldRows = oldSheet?.content?.slice(1) || [];\n\n      // [] \n      // \n      const oldRowsByTitle = new Map<string, Array<{ index: number; row: (typeof oldRows)[0] }>>();\n      oldRows.forEach((row, rIdx) => {\n        const title = String(row[1] ?? '').trim();\n        if (!oldRowsByTitle.has(title)) {\n          oldRowsByTitle.set(title, []);\n        }\n        oldRowsByTitle.get(title)!.push({ index: rIdx, row });\n      });\n\n      newRows.forEach((row, rowIdx) => {\n        const title = String(row[1] ?? '').trim();\n\n        // \n        let oldRow: (typeof oldRows)[0] | undefined;\n        let oldRowIndex: number | undefined;\n\n        if (title && oldRowsByTitle.has(title)) {\n          const queue = oldRowsByTitle.get(title)!;\n          if (queue.length > 0) {\n            const matched = queue.shift()!; // \n            oldRow = matched.row;\n            oldRowIndex = matched.index;\n          }\n        } else if (!title) {\n          // \n          oldRow = oldRows[rowIdx];\n          oldRowIndex = rowIdx;\n        }\n\n        if (!oldRow) {\n          // \n          changes.push({\n            type: 'row_added',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: rowIdx,\n            headers,\n            row,\n            title: row[1] || ` ${rowIdx + 1}`,\n          });\n        } else {\n          // \n          const rowChanges: Array<{\n            colIndex: number;\n            header: string;\n            oldValue: string;\n            newValue: string;\n          }> = [];\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return; // \n            const oldVal = String(oldRow![colIdx] ?? '');\n            const newVal = String(cell ?? '');\n            if (oldVal !== newVal) {\n              rowChanges.push({\n                colIndex: colIdx,\n                header: headers[colIdx] || `${colIdx}`,\n                oldValue: oldVal,\n                newValue: newVal,\n              });\n            }\n          });\n\n          if (rowChanges.length === 1) {\n            // \n            const c = rowChanges[0];\n            changes.push({\n              type: 'cell_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              colIndex: c.colIndex,\n              header: c.header,\n              oldValue: c.oldValue,\n              newValue: c.newValue,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          } else if (rowChanges.length > 1) {\n            // \n            changes.push({\n              type: 'row_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              headers,\n              row,\n              oldRow,\n              changedFields: rowChanges,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          }\n        }\n      });\n\n      // [] \n      // \n      const newTitleCounts = new Map();\n      newRows.forEach((row, rIdx) => {\n        const title = String(row[1] ?? '').trim();\n        if (title) {\n          newTitleCounts.set(title, (newTitleCounts.get(title) || 0) + 1);\n        }\n      });\n\n      // \n      const oldTitleCounts = new Map();\n      oldRows.forEach((row, rIdx) => {\n        const title = String(row[1] ?? '').trim();\n        if (title) {\n          oldTitleCounts.set(title, (oldTitleCounts.get(title) || 0) + 1);\n        }\n      });\n\n      // \n      const processedTitles = new Set();\n      oldRows.forEach((oldRow, rIdx) => {\n        const title = String(oldRow[1] ?? '').trim();\n\n        if (!title) {\n          // \n          if (rIdx >= newRows.length) {\n            changes.push({\n              type: 'row_deleted',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rIdx,\n              headers,\n              row: oldRow,\n              title: ` ${rIdx + 1}`,\n            });\n          }\n        } else if (!processedTitles.has(title)) {\n          processedTitles.add(title);\n          const oldCount = oldTitleCounts.get(title) || 0;\n          const newCount = newTitleCounts.get(title) || 0;\n          const deletedCount = oldCount - newCount;\n\n          if (deletedCount > 0) {\n            // deletedCount\n            const matchingOldRows = oldRows\n              .map((r, i) => ({ row: r, index: i }))\n              .filter(item => String(item.row[1] ?? '').trim() === title);\n\n            const deletedRows = matchingOldRows.slice(-deletedCount);\n            deletedRows.forEach(item => {\n              changes.push({\n                type: 'row_deleted',\n                tableName,\n                tableKey: sheetId,\n                rowIndex: item.index,\n                headers,\n                row: item.row,\n                title: title,\n              });\n            });\n          }\n        }\n      });\n    }\n\n    // \n    for (const sheetId in snapshot) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      if (!rawData[sheetId]) {\n        const oldSheet = snapshot[sheetId];\n        changes.push({\n          type: 'table_deleted',\n          tableName: oldSheet?.name || sheetId,\n          tableKey: sheetId,\n        });\n      }\n    }\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n\n    // \n    const panelTitle = isValidationMode ? '' : '';\n    const panelIcon = isValidationMode ? 'fa-shield-halved' : 'fa-code-compare';\n    const toggleTitle = isValidationMode ? '' : '';\n\n    //  HTML\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n                    <div class=\"acu-title-main\"><i class=\"fa-solid ${panelIcon}\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                </div>\n                <div class=\"acu-header-actions\">\n                    ${!isValidationMode ? '<button class=\"acu-changes-batch-btn acu-batch-accept\" title=\"\"><i class=\"fa-solid fa-check-double\"></i></button>' : ''}\n                    <button class=\"acu-changes-batch-btn acu-batch-reject\" title=\"${isValidationMode ? '' : ''}\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                    <button class=\"acu-changes-batch-btn acu-simple-mode-toggle ${isValidationMode ? 'active' : ''}\" title=\"${toggleTitle}\">\n                        <i class=\"fa-solid ${isValidationMode ? 'fa-filter-circle-xmark' : 'fa-filter'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                    </div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>`;\n\n    html += `<div class=\"acu-panel-content acu-changes-content ${config.layout === 'horizontal' ? 'acu-changes-horizontal' : ''}\">`;\n\n    // ===  ===\n    if (isValidationMode) {\n      if (validationErrors.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedErrors = ValidationEngine.groupErrorsByTable(validationErrors);\n        const collapsedGroups = Store.get('acu_validation_collapsed_groups', []);\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        for (const tableName in groupedErrors) {\n          const tableErrors = groupedErrors[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header acu-validation-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\" style=\"background:var(--acu-error-text);\">${tableErrors.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableErrors.forEach(error => {\n            const ruleData = error.rule\n              ? escapeHtml(\n                  JSON.stringify({\n                    ruleId: error.ruleId,\n                    ruleType: error.ruleType,\n                    tableName: error.tableName,\n                    rowIndex: error.rowIndex,\n                    columnName: error.columnName || '',\n                    currentValue: error.currentValue || '',\n                    rowTitle: error.rowTitle || '', //  rowTitle  ruleData\n                    rule: error.rule,\n                  }),\n                )\n              : '';\n\n            html += `<div class=\"acu-change-item acu-validation-error-item\"\n                         data-table=\"${escapeHtml(error.tableName)}\"\n                         data-row=\"${error.rowIndex}\"\n                         data-column=\"${escapeHtml(error.columnName || '')}\"\n                         data-rule-id=\"${escapeHtml(error.ruleId || '')}\"\n                         data-rule-type=\"${escapeHtml(error.ruleType || '')}\"\n                         data-rule-data=\"${ruleData}\">\n                        <span class=\"acu-change-badge\" style=\"background:var(--acu-hl-manual-bg);color:var(--acu-hl-manual);\">!</span>\n                        ${error.rowTitle && error.rowIndex >= 0 ? `<div class=\"acu-validation-row-title\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:2px;\">${escapeHtml(error.rowTitle)}</div>` : ''}\n                        <span class=\"acu-change-title\">${escapeHtml(error.columnName || '')}${error.currentValue ? `: ${escapeHtml(error.currentValue.length > 15 ? error.currentValue.substring(0, 15) + '...' : error.currentValue)}` : ''}</span>\n                        <span class=\"acu-validation-error-msg\">${escapeHtml(error.errorMessage.length > 25 ? error.errorMessage.substring(0, 25) + '...' : error.errorMessage)}</span>\n                        <div class=\"acu-change-actions\">\n                            <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                        </div>\n                    </div>`;\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    } else {\n      // ===  ===\n      if (changes.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedChanges = {};\n        changes.forEach(c => {\n          const key = c.tableName;\n          if (!groupedChanges[key]) groupedChanges[key] = [];\n          groupedChanges[key].push(c);\n        });\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        const collapsedGroups = Store.get('acu_changes_collapsed_groups', []);\n\n        for (const tableName in groupedChanges) {\n          const tableChanges = groupedChanges[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\">${tableChanges.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableChanges.forEach(change => {\n            if (change.type === 'row_added') {\n              html += `<div class=\"acu-change-item acu-change-added\"\n                            data-change-type=\"row_added\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-added\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"row_deleted\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'cell_modified') {\n              const oldShort = change.oldValue.length > 15 ? change.oldValue.substring(0, 15) + '...' : change.oldValue;\n              const newShort = change.newValue.length > 15 ? change.newValue.substring(0, 15) + '...' : change.newValue;\n\n              const isOptionTable = change.tableName && change.tableName.includes('');\n              let fieldDisplay;\n              if (isOptionTable) {\n                fieldDisplay = `${escapeHtml(change.tableName)}.${escapeHtml(change.header)}`;\n              } else {\n                fieldDisplay = `${escapeHtml(change.rowTitle)}.${escapeHtml(change.header)}`;\n              }\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"cell_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\"\n                            data-col-index=\"${change.colIndex}\"\n  data-old-value=\"${safeEncodeURIComponent(change.oldValue)}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-field\">${fieldDisplay}</span>\n                            <span class=\"acu-change-diff\">\n                                <span class=\"acu-diff-old\">${escapeHtml(oldShort || '()')}</span>\n                                <span class=\"acu-diff-arrow\"></span>\n                                <span class=\"acu-diff-new\">${escapeHtml(newShort || '()')}</span>\n                            </span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_modified') {\n              // \n              const fieldCount = change.changedFields.length;\n              const fieldNames = change.changedFields\n                .slice(0, 2)\n                .map(f => f.header)\n                .join('');\n              const moreText = fieldCount > 2 ? ` ${fieldCount}` : '';\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"row_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.rowTitle)}</span>\n                            <span class=\"acu-change-field-count\">${escapeHtml(fieldNames)}${moreText}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'table_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"table_deleted\"\n                            data-table-key=\"${change.tableKey}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\"></span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            }\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    }\n\n    html += `</div>`;\n    return html;\n  };\n  // [] \n  const bindChangesEvents = () => {\n    const { $ } = getCore();\n\n    // \n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-close-btn')\n      .off('click')\n      .on('click', function () {\n        Store.set('acu_changes_panel_active', false);\n        $('#acu-data-area').removeClass('visible');\n        $('.acu-nav-btn').removeClass('active');\n      });\n\n    // === ===\n    const TOUCH_MOVE_THRESHOLD = 10; // 10px\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const tableName = $item.data('table');\n        const rowIndex = parseInt($item.data('row'), 10);\n        const columnName = $item.data('column');\n\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        try {\n          const rawData = cachedRawData || getTableData();\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === tableName && snapshot[sheetId]) {\n              const headers = rawData[sheetId].content?.[0] || [];\n              const colIdx = headers.indexOf(columnName);\n              if (colIdx >= 0 && snapshot[sheetId].content?.[rowIndex + 1]) {\n                const snapshotValue = snapshot[sheetId].content[rowIndex + 1][colIdx];\n                rawData[sheetId].content[rowIndex + 1][colIdx] = snapshotValue;\n                await saveDataToDatabase(rawData, false, false);\n                renderInterface();\n                return;\n              }\n              break;\n            }\n          }\n          if (window.toastr) window.toastr.warning('');\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const ruleData = $item.data('rule-data');\n        if (!ruleData) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        try {\n          const parsed = typeof ruleData === 'string' ? JSON.parse(ruleData) : ruleData;\n          const error = {\n            ruleId: parsed.ruleId,\n            ruleType: parsed.ruleType,\n            rule: parsed.rule,\n            tableName: $item.data('table') || parsed.tableName || '',\n            rowIndex: parseInt($item.data('row'), 10) || parsed.rowIndex || 0,\n            columnName: $item.data('column') || parsed.columnName || '',\n            currentValue: parsed.currentValue || '',\n            rowTitle: parsed.rowTitle || '', //  rowTitle \n            ruleName: parsed.ruleName || parsed.rule?.name || '',\n            errorMessage: parsed.errorMessage || parsed.rule?.errorMessage || '',\n          };\n          showSmartFixModal(error);\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    let validationItemTouchStartPos: { x: number; y: number } | null = null;\n\n    $('.acu-validation-error-item')\n      .off('click touchstart touchend touchmove')\n      .on('touchstart', function (e) {\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        validationItemTouchStartPos = { x: touch.clientX, y: touch.clientY };\n      })\n      .on('touchmove', function (e) {\n        if (!validationItemTouchStartPos) return;\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        const deltaX = Math.abs(touch.clientX - validationItemTouchStartPos.x);\n        const deltaY = Math.abs(touch.clientY - validationItemTouchStartPos.y);\n        // \n        if (deltaX > TOUCH_MOVE_THRESHOLD || deltaY > TOUCH_MOVE_THRESHOLD) {\n          validationItemTouchStartPos = null;\n        }\n      })\n      .on('touchend', function (e) {\n        // \n        if (!validationItemTouchStartPos) return;\n        validationItemTouchStartPos = null;\n\n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      })\n      .on('click', function (e) {\n        //  click \n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        //  touchend \n        if ('ontouchstart' in window) return;\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      });\n\n    // /\n    $('.acu-changes-group-header')\n      .off('click')\n      .on('click', function (e) {\n        if ($(e.target).closest('.acu-change-item').length) return;\n\n        const tableName = $(this).data('table');\n        const $group = $(this).closest('.acu-changes-group');\n        const $body = $group.find('.acu-changes-group-body');\n        const $icon = $(this).find('.acu-collapse-icon');\n\n        // \n        const isValidationMode = $(this).hasClass('acu-validation-group-header');\n        const storageKey = isValidationMode ? 'acu_validation_collapsed_groups' : 'acu_changes_collapsed_groups';\n        let collapsedGroups = Store.get(storageKey, []);\n\n        if ($group.hasClass('collapsed')) {\n          $group.removeClass('collapsed');\n          $body.slideDown(200);\n          $icon.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n          collapsedGroups = collapsedGroups.filter(n => n !== tableName);\n        } else {\n          $group.addClass('collapsed');\n          $body.slideUp(200);\n          $icon.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n          if (!collapsedGroups.includes(tableName)) {\n            collapsedGroups.push(tableName);\n          }\n        }\n\n        Store.set(storageKey, collapsedGroups);\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-accept')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n\n        const snapshot = loadSnapshot();\n        const rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = rawData[tableKey].content[rowIndex + 1][colIndex];\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            if (!snapshot[tableKey]) {\n              snapshot[tableKey] = JSON.parse(JSON.stringify(rawData[tableKey]));\n            } else {\n              snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n            }\n          }\n        } else if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          delete snapshot[tableKey];\n        }\n\n        saveSnapshot(snapshot);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n        const oldValue = safeDecodeURIComponent($item.data('old-value') || '');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content[rowIndex + 1][colIndex] = oldValue;\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content) {\n            rawData[tableKey].content[rowIndex + 1] = [...snapshot[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData, [tableKey]);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === /===\n    $('.acu-action-restore')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            const restoredRow = [...snapshot[tableKey].content[rowIndex + 1]];\n            if (!rawData[tableKey]) {\n              rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n              rawData[tableKey].content = [snapshot[tableKey].content[0]];\n            }\n            // \n            rawData[tableKey].content.splice(rowIndex + 1, 0, restoredRow);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          if (snapshot[tableKey]) {\n            rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData, [tableKey]);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item:not(.acu-validation-error-item) .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const changeType = $item.data('change-type');\n\n        if (!tableKey || rowIndex === undefined) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const sheet = rawData[tableKey];\n        const headers = sheet.content ? sheet.content[0] : [];\n        const row = sheet.content ? sheet.content[rowIndex + 1] : null;\n\n        if (!row) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        if (changeType === 'row_modified') {\n          // \n          showRowCompareEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        } else if (changeType === 'cell_modified') {\n          const colIndex = $item.data('col-index');\n          const headerName = headers[colIndex] || `${colIndex}`;\n          const cellValue = row[colIndex] || '';\n          showChangeSingleFieldModal(cellValue, headerName, sheet.name, rowIndex, colIndex, tableKey);\n        } else {\n          showChangeEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        }\n      });\n\n    // ===  ===\n    $('.acu-batch-accept')\n      .off('click')\n      .on('click', async function () {\n        const rawData = cachedRawData || getTableData();\n        if (!rawData) return;\n\n        // \n        saveSnapshot(JSON.parse(JSON.stringify(rawData)));\n        currentDiffMap = new Set();\n\n        // \n        refreshChangesPanel();\n      });\n\n    // ===  ===\n    $('.acu-batch-reject')\n      .off('click')\n      .on('click', async function () {\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const restoredData = JSON.parse(JSON.stringify(snapshot));\n        cachedRawData = restoredData;\n        await saveDataToDatabase(restoredData, false, false);\n      });\n\n    // ===  ===\n    $('.acu-simple-mode-toggle')\n      .off('click')\n      .on('click', function () {\n        const currentMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        const newMode = !currentMode;\n        Store.set(STORAGE_KEY_VALIDATION_MODE, newMode);\n\n        // \n        const rawData = cachedRawData || getTableData();\n        $('#acu-data-area').html(renderChangesPanel(rawData));\n        bindChangesEvents();\n\n        // \n        updateChangesCount(rawData);\n      });\n\n    // ===  ===\n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          // \n          const finalHeight = $panel.height();\n          const heights = getTableHeights();\n          heights[tableName] = finalHeight;\n          saveTableHeights(heights);\n        };\n      })\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const $panel = $('#acu-data-area');\n        $panel.css('height', ''); // \n        // \n        const heights = getTableHeights();\n        delete heights[tableName];\n        saveTableHeights(heights);\n      });\n\n    // ===  ===\n    const $horizontalScroller = $('.acu-changes-content.acu-changes-horizontal');\n    if ($horizontalScroller.length) {\n      $horizontalScroller[0].addEventListener(\n        'touchstart',\n        function (e) {\n          this._touchStartX = e.touches[0].clientX;\n          this._touchStartY = e.touches[0].clientY;\n          this._scrollDirection = null; // \n        },\n        { passive: true },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchmove',\n        function (e) {\n          if (!this._touchStartX) return;\n\n          const deltaX = Math.abs(e.touches[0].clientX - this._touchStartX);\n          const deltaY = Math.abs(e.touches[0].clientY - this._touchStartY);\n\n          // \n          if (!this._scrollDirection && (deltaX > 5 || deltaY > 5)) {\n            this._scrollDirection = deltaX > deltaY ? 'horizontal' : 'vertical';\n          }\n\n          // \n          // \n          if (this._scrollDirection === 'horizontal' && deltaX > 10) {\n            e.stopPropagation();\n          }\n        },\n        { passive: false },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchend',\n        function () {\n          this._touchStartX = null;\n          this._touchStartY = null;\n          this._scrollDirection = null;\n        },\n        { passive: true },\n      );\n    }\n  };\n\n  // [] \n  const refreshChangesPanel = () => {\n    const { $ } = getCore();\n    const rawData = cachedRawData || getTableData();\n    currentDiffMap = generateDiffMap(rawData);\n\n    const $panel = $('#acu-data-area');\n    if ($panel.length && Store.get('acu_changes_panel_active', false)) {\n      $panel.html(renderChangesPanel(rawData));\n      bindChangesEvents();\n\n      // \n      updateChangesCount(rawData);\n    }\n  };\n\n  // []  + \n  const updateChangesCount = rawData => {\n    const { $ } = getCore();\n    const snapshot = loadSnapshot();\n    let changesCount = 0;\n\n    if (snapshot && rawData) {\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const newSheet = rawData[sheetId];\n        const oldSheet = snapshot[sheetId];\n        if (!newSheet?.content) continue;\n        const newRows = newSheet.content.slice(1);\n        const oldRows = oldSheet?.content?.slice(1) || [];\n\n        // [] detectChanges\n        const oldRowsByTitle = new Map<string, Array<{ index: number; row: (typeof oldRows)[0] }>>();\n        oldRows.forEach((row, rIdx) => {\n          const title = String(row[1] ?? '').trim();\n          if (!oldRowsByTitle.has(title)) {\n            oldRowsByTitle.set(title, []);\n          }\n          oldRowsByTitle.get(title)!.push({ index: rIdx, row });\n        });\n\n        newRows.forEach((row, rowIdx) => {\n          const title = String(row[1] ?? '').trim();\n          let oldRow: (typeof oldRows)[0] | undefined;\n\n          if (title && oldRowsByTitle.has(title)) {\n            const queue = oldRowsByTitle.get(title)!;\n            if (queue.length > 0) {\n              const matched = queue.shift()!;\n              oldRow = matched.row;\n            }\n          } else if (!title) {\n            oldRow = oldRows[rowIdx];\n          }\n\n          if (!oldRow) {\n            changesCount++; // \n          } else {\n            // \n            let hasChange = false;\n            row.forEach((cell, colIdx) => {\n              if (colIdx === 0) return;\n              if (String(cell ?? '') !== String(oldRow![colIdx] ?? '')) hasChange = true;\n            });\n            if (hasChange) changesCount++;\n          }\n        });\n\n        // \n        const newTitleCounts = new Map<string, number>();\n        const oldTitleCounts = new Map<string, number>();\n        newRows.forEach(row => {\n          const title = String(row[1] ?? '').trim();\n          if (title) newTitleCounts.set(title, (newTitleCounts.get(title) || 0) + 1);\n        });\n        oldRows.forEach(row => {\n          const title = String(row[1] ?? '').trim();\n          if (title) oldTitleCounts.set(title, (oldTitleCounts.get(title) || 0) + 1);\n        });\n        oldTitleCounts.forEach((oldCount, title) => {\n          const newCount = newTitleCounts.get(title) || 0;\n          if (oldCount > newCount) changesCount += oldCount - newCount;\n        });\n        // \n        const emptyOldCount = oldRows.filter(r => !String(r[1] ?? '').trim()).length;\n        const emptyNewCount = newRows.filter(r => !String(r[1] ?? '').trim()).length;\n        if (emptyOldCount > emptyNewCount) changesCount += emptyOldCount - emptyNewCount;\n      }\n      for (const sheetId in snapshot) {\n        if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n      }\n    }\n\n    // \n    const validationErrorCount = rawData ? ValidationEngine.getErrorCount(rawData) : 0;\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n    const displayCount = isValidationMode ? validationErrorCount : changesCount;\n    // \n    const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n    const $btn = $('#acu-btn-changes');\n    const $span = $btn.find('span');\n    $span.html(displayCount > 0 ? `(${displayCount})` : '');\n\n    // \n    if (showWarningIcon) {\n      if (!$btn.find('.acu-nav-warning-icon').length) {\n        $span.append(' <i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>');\n      }\n      $btn.addClass('has-validation-errors');\n    } else {\n      $btn.find('.acu-nav-warning-icon').remove();\n      $btn.removeClass('has-validation-errors');\n    }\n  };\n  // [] \n  const showChangeEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const inputsHtml = row\n      .map((cell, idx) => {\n        if (idx === 0) return '';\n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        return `\n                <div class=\"acu-card-edit-field\">\n                    <label class=\"acu-card-edit-label\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-card-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\">${escapeHtml(val)}</textarea>\n                </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content acu-settings-content-scroll\">\n                        ${inputsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-change-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-change-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // [] \n    const adjustHeight = el => {\n      //  auto  0px scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n    };\n    dialog.find('#dlg-change-cancel').click(closeDialog);\n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n\n    dialog.find('#dlg-change-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n\n        if (hasChanges) {\n          // 1. \n          try {\n            await saveDataOnly(rawData, [tableKey]);\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            let errorMessage = e.message || '';\n            //  \"Settings could not be saved\" \n            const errorMsg = String(e);\n            if (\n              errorMsg.includes('Settings could not be saved') ||\n              errorMsg.includes('server connection') ||\n              errorMsg.includes('data loss')\n            ) {\n              errorMessage = '';\n            }\n            if (window.toastr) {\n              window.toastr.error(errorMessage, '', { timeOut: 7000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n            // \n            return;\n          }\n\n          // 2. \n          const snapshot = loadSnapshot();\n          if (snapshot && snapshot[tableKey] && snapshot[tableKey].content) {\n            snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n            saveSnapshot(snapshot);\n          }\n\n          // 3.  diffMap \n          currentDiffMap = generateDiffMap(rawData);\n\n          // 4. \n          const $panel = $('#acu-data-area');\n          $panel.html(renderChangesPanel(rawData));\n          bindChangesEvents();\n        }\n      }\n      closeDialog();\n    });\n  };\n  // [] \n  const showChangeSingleFieldModal = (value, headerName, tableName, rowIndex, colIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldValue = snapshot?.[tableKey]?.content?.[rowIndex + 1]?.[colIndex] ?? '';\n    const hasOldValue = oldValue !== '' && String(oldValue) !== String(value);\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:450px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(headerName)}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${\n                          hasOldValue\n                            ? `\n                        <div class=\"acu-diff-section acu-diff-old-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                            </div>\n                            <div class=\"acu-diff-readonly\">${escapeHtml(oldValue)}</div>\n                        </div>\n                        <div class=\"acu-diff-arrow-down\">\n                            <i class=\"fa-solid fa-arrow-down\"></i>\n                        </div>\n                        `\n                            : ''\n                        }\n                        <div class=\"acu-diff-section acu-diff-new-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-pen\"></i> ${hasOldValue ? '' : ''}\n                            </div>\n                            <textarea class=\"acu-change-single-input acu-edit-textarea\" spellcheck=\"false\"\n                                style=\"width:100%;min-height:60px;max-height:300px;padding:12px;resize:none;\">${escapeHtml(value)}</textarea>\n                        </div>\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-single-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        ${hasOldValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"dlg-single-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-single-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const $textarea = dialog.find('.acu-change-single-input');\n    const adjustHeight = () => {\n      $textarea[0].style.height = 'auto';\n      const h = Math.max(60, Math.min($textarea[0].scrollHeight + 2, 300));\n      $textarea[0].style.height = h + 'px';\n    };\n    setTimeout(adjustHeight, 0);\n    $textarea.on('input', adjustHeight);\n    $textarea.focus();\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-single-cancel').click(closeDialog);\n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n\n    // [] \n    dialog.find('#dlg-single-revert').click(function () {\n      $textarea.val(oldValue).trigger('input');\n    });\n\n    dialog.find('#dlg-single-save').click(async () => {\n      const newVal = $textarea.val();\n      let rawData = cachedRawData || getTableData();\n\n      if (rawData && rawData[tableKey] && rawData[tableKey].content) {\n        const currentRow = rawData[tableKey].content[rowIndex + 1];\n        if (currentRow && String(currentRow[colIndex]) !== String(newVal)) {\n          currentRow[colIndex] = newVal;\n\n          // \n          await saveDataOnly(rawData, [tableKey]);\n\n          // \n          const snapshot = loadSnapshot();\n          if (\n            snapshot &&\n            snapshot[tableKey] &&\n            snapshot[tableKey].content &&\n            snapshot[tableKey].content[rowIndex + 1]\n          ) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = newVal;\n            saveSnapshot(snapshot);\n          }\n\n          // \n          currentDiffMap = generateDiffMap(rawData);\n          refreshChangesPanel();\n        }\n      }\n      closeDialog();\n    });\n  };\n\n  // [] \n  const showRowCompareEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldRow = snapshot?.[tableKey]?.content?.[rowIndex + 1] || [];\n\n    // \n    let fieldsHtml = '';\n    for (let idx = 1; idx < headers.length; idx++) {\n      const headerName = headers[idx] || ` ${idx}`;\n      const oldVal = oldRow[idx] ?? '';\n      const newVal = row[idx] ?? '';\n      const isChanged = String(oldVal) !== String(newVal);\n\n      fieldsHtml += `\n                <div class=\"acu-row-edit-field ${isChanged ? 'acu-field-changed' : ''}\">\n                    <div class=\"acu-row-edit-label\">${escapeHtml(headerName)} ${isChanged ? '<span class=\"acu-changed-badge\"></span>' : ''}</div>\n                    ${isChanged ? `<div class=\"acu-row-edit-old\">${escapeHtml(oldVal) || '<span class=\"acu-empty-val\">()</span>'}</div>` : ''}\n                    <textarea class=\"acu-row-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\">${escapeHtml(newVal)}</textarea>\n                </div>\n            `;\n    }\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:550px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(row[1] || ' ' + (rowIndex + 1))}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px; max-height:60vh;\">\n                        ${fieldsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-row-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = Math.min(el.scrollHeight + 2, 200) + 'px';\n    };\n    dialog.find('textarea').each(function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-row-cancel').click(closeDialog);\n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n\n    // \n    dialog.find('#dlg-row-revert').click(function () {\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        $(this)\n          .val(oldRow[colIdx] ?? '')\n          .trigger('input');\n      });\n    });\n\n    // \n    dialog.find('#dlg-row-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (!rawData?.[tableKey]?.content?.[rowIndex + 1]) {\n        closeDialog();\n        return;\n      }\n\n      const currentRow = rawData[tableKey].content[rowIndex + 1];\n      let hasChanges = false;\n\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        const newVal = $(this).val();\n        if (String(currentRow[colIdx]) !== String(newVal)) {\n          hasChanges = true;\n          currentRow[colIdx] = newVal;\n        }\n      });\n\n      if (hasChanges) {\n        await saveDataOnly(rawData, [tableKey]);\n\n        // \n        const snapshot = loadSnapshot();\n        if (snapshot?.[tableKey]?.content) {\n          snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n          saveSnapshot(snapshot);\n        }\n\n        currentDiffMap = generateDiffMap(rawData);\n        refreshChangesPanel();\n      }\n      closeDialog();\n    });\n  };\n  const renderDashboard = allTables => {\n    console.info('[DICE]...');\n    // \n    NameAliasRegistry.rebuild(allTables);\n    const config = getConfig();\n\n    // [] \n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const questResult = DashboardDataParser.findTable(allTables, 'quest');\n    const bagResult = DashboardDataParser.findTable(allTables, 'bag');\n    const equipResult = DashboardDataParser.findTable(allTables, 'equip');\n\n    // []  - \n    let player = { name: '', status: '', position: '', attrs: '', money: '0' };\n    const playerParsed = DashboardDataParser.parseRows(playerResult, 'player');\n\n    if (playerParsed.length > 0) {\n      const p = playerParsed[0];\n      player.name = p.name || '';\n      player.status = p.status || '';\n      player.position = p.position || '';\n      player.money = p.money || '';\n      player.resources = '';\n\n      // [] \n      if (playerResult?.data?.headers && playerResult?.data?.rows?.[0]) {\n        const headers = playerResult.data.headers;\n        const row = playerResult.data.rows[0];\n        let allAttrsStr = '';\n        headers.forEach((h, idx) => {\n          if (h && h.includes('')) {\n            const val = row[idx];\n            if (val) allAttrsStr += (allAttrsStr ? '; ' : '') + val;\n          }\n        });\n        player.attrs = allAttrsStr;\n\n        // \n        headers.forEach((h, idx) => {\n          if (h && (h.includes('') || h.includes(''))) {\n            const val = row[idx];\n            if (val) player.resources = val;\n          }\n        });\n      }\n    }\n\n    // [] HTML\n    const playerRows = playerResult?.data?.rows || [];\n    const playerHeaders = playerResult?.data?.headers || [];\n\n    // []  - \n    let globalDetailLocation = ''; // \n    let globalLocation = ''; // \n\n    if (globalResult?.data?.rows?.length > 0) {\n      const headers = globalResult.data.headers || [];\n      const row = globalResult.data.rows[0];\n\n      // \n      const detailIdx = DashboardDataParser.findColumnIndex(headers, 'detailLocation', globalResult.config);\n      if (detailIdx >= 0 && row[detailIdx]) {\n        globalDetailLocation = row[detailIdx];\n      }\n\n      // \n      const locIdx = DashboardDataParser.findColumnIndex(headers, 'currentLocation', globalResult.config);\n      globalLocation = locIdx >= 0 && row[locIdx] ? row[locIdx] : row[2] || '';\n    }\n\n    // currentPlaceName \n    let currentPlaceName =\n      globalDetailLocation ||\n      globalLocation ||\n      (player.position.includes('-') ? player.position.split('-')[0].trim() : player.position);\n\n    // [] NPC - \n    const npcTableName = npcResult?.name || '';\n    const npcTableKey = npcResult?.key || '';\n\n    const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n\n    // NPC\n    let inSceneNPCs = [];\n    let offSceneNPCs = [];\n    npcParsed.forEach(npc => {\n      const inSceneVal = String(npc.inScene || '').toLowerCase();\n      const normalizedNpcName = String(npc.name || '').trim() || '';\n      const npcData = {\n        name: normalizedNpcName,\n        status: npc.status || '',\n        position: npc.position || '',\n        index: npc._rowIndex,\n      };\n      if (inSceneVal === 'true' || inSceneVal === '') {\n        inSceneNPCs.push(npcData);\n      } else {\n        offSceneNPCs.push(npcData);\n      }\n    });\n    // \n    let allNPCs = [...inSceneNPCs, ...offSceneNPCs];\n\n    // []  - ///\n    const questTableName = questResult?.name || '';\n    const questParsed = DashboardDataParser.parseRows(questResult, 'quest');\n\n    // \n    const questStatusOrder = (status: string) => {\n      const s = String(status || '').toLowerCase();\n      // //\n      if (s.includes('') || s.includes('')) return 0;\n      return 1; // \n    };\n    const questTypeOrder = (type: string) => {\n      const t = String(type || '').toLowerCase();\n      if (t.includes('')) return 0;\n      if (t.includes('')) return 1;\n      if (t.includes('')) return 2;\n      return 3;\n    };\n    const questPriorityOrder = (priority: string) => {\n      const p = String(priority || '').toLowerCase();\n      if (p.includes('')) return 0;\n      if (p.includes('')) return 1;\n      if (p.includes('')) return 2;\n      return 3;\n    };\n    const parseProgress = (progress: string) => {\n      const match = String(progress || '').match(/(\\d+)\\s*%/);\n      return match ? parseInt(match[1], 10) : 0;\n    };\n\n    let activeTasks = questParsed\n      .map(q => ({\n        name: q.name || '',\n        type: q.type || '',\n        status: q.status || '',\n        priority: q.priority || '',\n        progress: q.progress || '',\n        _rowIndex: q._rowIndex,\n      }))\n      .sort((a, b) => {\n        // 1.  > \n        const aStatusOrder = questStatusOrder(a.status);\n        const bStatusOrder = questStatusOrder(b.status);\n        const statusDiff = aStatusOrder - bStatusOrder;\n        if (statusDiff !== 0) return statusDiff;\n\n        // \n        if (aStatusOrder === 1) {\n          return (b._rowIndex ?? 0) - (a._rowIndex ?? 0);\n        }\n\n        // \n        // 2.  >  > \n        const typeDiff = questTypeOrder(a.type) - questTypeOrder(b.type);\n        if (typeDiff !== 0) return typeDiff;\n        // 3.  >  > \n        const priorityDiff = questPriorityOrder(a.priority) - questPriorityOrder(b.priority);\n        if (priorityDiff !== 0) return priorityDiff;\n        // 4.   \n        return parseProgress(a.progress) - parseProgress(b.progress);\n      });\n    // []  - \n    const bagTableName = bagResult?.name || '';\n\n    const bagParsed = DashboardDataParser.parseRows(bagResult, 'bag');\n    let bagItems = bagParsed.map(item => ({\n      name: item.name || '',\n      count: item.count || '1',\n      type: item.type || '',\n    }));\n\n    // []  -  + \n    const equipTableName = equipResult?.name || '';\n\n    const equipParsed = DashboardDataParser.parseRows(equipResult, 'equip');\n    const equippedParsed = DashboardDataParser.applyFilter(equipParsed, 'equipped', 'equip');\n\n    let equippedItems = equippedParsed.map(e => ({\n      name: e.name || '',\n      type: e.type || '',\n      part: e.part || '',\n    }));\n    // []  - \n    const locationTableName = locationResult?.name || '';\n    const locationTableKey = locationResult?.key || '';\n\n    const locationParsed = DashboardDataParser.parseRows(locationResult, 'location');\n\n    // HTML\n    let html = `\n        <div class=\"acu-panel-header\">\n            <div class=\"acu-panel-title\">\n                <div class=\"acu-title-main\"><i class=\"fa-solid fa-chart-line\"></i> <span class=\"acu-title-text\"></span></div>\n                <div class=\"acu-title-sub\"></div>\n            </div>\n            <div class=\"acu-header-actions\">\n                <div class=\"acu-height-control\">\n                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                </div>\n                <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n        </div>\n        <div class=\"acu-panel-content acu-dashboard-content\">\n            <div class=\"acu-dash-body ${config.layout === 'horizontal' ? 'acu-dash-horizontal' : ''}\">\n            <!--  +  +  -->\n                <div class=\"acu-dash-player\">\n                    <h3 class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                        data-table-key=\"${playerResult?.key || ''}\"\n                        data-row-index=\"0\"\n                        data-preview-type=\"player\"\n                        style=\"cursor:pointer;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-user-circle\"></i> ${escapeHtml(replaceUserPlaceholders(getDisplayName(player.name)))}</span>\n                        <span style=\"font-size:11px;font-weight:normal;color:var(--acu-text-main);background:var(--acu-badge-bg);padding:2px 8px;border-radius:10px;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;\" title=\"${escapeHtml(player.status)}\">${escapeHtml(player.status.length > 6 ? player.status.substring(0, 6) + '..' : player.status)}</span>\n                    </h3>\n                    ${(() => {\n                      // \n                      const resourcesStr = player.resources || player.money || '';\n                      const parsedResources = parseAttributeString(resourcesStr);\n\n                      // \n                      let baseAttrs = [];\n                      let specialAttrs = [];\n                      if (playerRows.length > 0 && playerHeaders.length > 0) {\n                        const row = playerRows[0];\n                        playerHeaders.forEach((h, idx) => {\n                          if (h && h.includes('')) {\n                            const parsed = parseAttributeString(row[idx] || '');\n                            parsed.forEach(attr => {\n                              if (!baseAttrs.some(a => a.name === attr.name)) {\n                                baseAttrs.push(attr);\n                              }\n                            });\n                          } else if (h && h.includes('')) {\n                            const parsed = parseAttributeString(row[idx] || '');\n                            parsed.forEach(attr => {\n                              if (!specialAttrs.some(a => a.name === attr.name)) {\n                                specialAttrs.push(attr);\n                              }\n                            });\n                          }\n                        });\n                      }\n\n                      let html = '';\n\n                      // \n                      if (parsedResources.length > 0) {\n                        html += `<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:44px;overflow-y:auto;margin-bottom:4px;padding-bottom:4px;border-bottom:1px dashed var(--acu-border);\">\n                                ${parsedResources\n                                  .map(\n                                    res => `\n                                    <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;\">\n                                        <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(res.name)}\">${escapeHtml(res.name.substring(0, 3))}</span>\n                                        <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                            <span style=\"color:var(--acu-accent);font-size:11px;font-weight:bold;\">${res.value}</span>\n                                            <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${res.value}\" data-name=\"${escapeHtml(res.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${res.name}(${res.value})\"></i>\n                                        </div>\n                                    </div>\n                                `,\n                                  )\n                                  .join('')}\n                            </div>`;\n                      }\n\n                      // \n                      html += `<h4 class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                          data-table-key=\"${playerResult?.key || ''}\"\n                          data-row-index=\"0\"\n                          data-preview-type=\"player\"\n                          style=\"font-size:12px;color:var(--acu-accent);margin:4px 0 2px 0;display:flex;align-items:center;gap:4px;cursor:pointer;\"><i class=\"fa-solid fa-chart-bar\" style=\"font-size:10px;\"></i>  (${baseAttrs.length + specialAttrs.length})</h4>`;\n\n                      // 3424px496px\n                      const allAttrs = [...baseAttrs, ...specialAttrs];\n                      if (allAttrs.length > 0) {\n                        html += `<div style=\"display:grid;grid-template-columns:repeat(3,1fr);gap:2px 4px;max-height:104px;overflow-y:auto;overflow-x:hidden;padding-bottom:2px;\">\n                                ${allAttrs\n                                  .map(\n                                    attr => `\n                                    <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;\">\n                                        <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(attr.name)}\">${escapeHtml(attr.name.substring(0, 2))}</span>\n                                        <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                            <span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${attr.value}</span>\n                                            <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${attr.value}\" data-name=\"${escapeHtml(attr.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${attr.name}(${attr.value})\"></i>\n                                        </div>\n                                    </div>\n                                `,\n                                  )\n                                  .join('')}\n                            </div>`;\n                      } else {\n                        html += `<div class=\"acu-empty-hint\"></div>`;\n                      }\n\n                      return html;\n                    })()}\n                </div>\n\n                <!--  + NPC -->\n                <div class=\"acu-dash-locations\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(locationTableName)}\" style=\"display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-map\"></i>  (${locationParsed.length})</span>\n                        <i class=\"fa-solid fa-map acu-dash-map-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;align-content:start;max-height:110px;overflow-y:auto;overflow-x:hidden;margin-bottom:10px;\">\n                    ${\n                      locationParsed.length > 0\n                        ? locationParsed\n                            .map((loc, idx) => {\n                              const areaName = loc.name || '';\n                              const isCurrent =\n                                currentPlaceName &&\n                                (areaName.includes(currentPlaceName) || currentPlaceName.includes(areaName));\n                              const emoji = getElementEmoji(areaName, null);\n                              let iconHtml = '';\n                              if (emoji) {\n                                if (emoji.startsWith('fa:')) {\n                                  iconHtml = `<i class=\"fa-solid fa-${emoji.slice(3)}\" style=\"font-size:10px;opacity:0.7;\"></i>`;\n                                } else if (emoji.startsWith('ti:')) {\n                                  iconHtml = `<i class=\"ti ti-${emoji.slice(3)}\" style=\"font-size:10px;opacity:0.7;\"></i>`;\n                                } else {\n                                  iconHtml = `<span style=\"font-size:10px;\">${emoji}</span>`;\n                                }\n                              } else {\n                                iconHtml = isCurrent\n                                  ? '<i class=\"fa-solid fa-location-dot\"></i>'\n                                  : '<i class=\"fa-solid fa-map-pin\" style=\"font-size:9px;opacity:0.4;\"></i>';\n                              }\n                              return `<div class=\"acu-location-item acu-dash-clickable acu-dash-preview-trigger ${isCurrent ? 'acu-current-location' : ''}\"\n                            data-table-key=\"${escapeHtml(locationTableKey)}\"\n                            data-row-index=\"${loc._rowIndex}\"\n                            data-preview-type=\"location\">\n                            <span style=\"display:flex;align-items:center;gap:4px;\">\n                                ${iconHtml}\n                                <span title=\"${escapeHtml(areaName)}\">${escapeHtml(areaName)}</span>\n                            </span>\n                            ${!isCurrent ? `<i class=\"fa-solid fa-walking acu-dash-goto-btn\" data-location=\"${escapeHtml(areaName)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;flex-shrink:0;\" title=\"${areaName}\"></i>` : '<i class=\"fa-solid fa-street-view\" style=\"flex-shrink:0;\" title=\"\"></i>'}\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(npcTableName)}\" style=\"margin-top:10px;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-users\"></i>  (${allNPCs.length})</span>\n                        <span style=\"display:flex;gap:8px;\">\n                            <i class=\"fa-solid fa-project-diagram acu-dash-relation-graph-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                            <i class=\"fa-solid fa-user-circle acu-dash-avatar-manager-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                        </span>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;align-content:start;max-height:150px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      allNPCs.length > 0\n                        ? allNPCs\n                            .map((npc, npcIdx) => {\n                              const npcName = String(npc.name || '').trim() || '';\n                              const npcDisplayName = replaceUserPlaceholders(getDisplayName(npcName)).trim() || '';\n                              const npcDisplayShort =\n                                npcDisplayName.length > 4 ? npcDisplayName.substring(0, 4) + '..' : npcDisplayName;\n                              const npcFallbackChar = npcDisplayName.charAt(0) || '';\n                              const isInScene = inSceneNPCs.some(n => n.name === npcName);\n                              const isLastNpc = npcIdx === allNPCs.length - 1;\n                              const npcAvatar = AvatarManager.get(npcName);\n                              const avatarOffsetX = AvatarManager.getOffsetX(npcName);\n                              const avatarOffsetY = AvatarManager.getOffsetY(npcName);\n                              const avatarScale = AvatarManager.getScale(npcName);\n                              const avatarStyle = npcAvatar\n                                ? `background-image:url('${npcAvatar}');background-size:${avatarScale}%;background-position:${avatarOffsetX}% ${avatarOffsetY}%;`\n                                : '';\n                              const offSceneFilter = isInScene\n                                ? ''\n                                : 'filter:grayscale(80%) brightness(0.7);opacity:0.5;';\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${escapeHtml(npcTableKey)}\"\n                            data-row-index=\"${npc.index}\"\n                            data-preview-type=\"npc\"\n                            style=\"padding:6px 4px;${!isLastNpc ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <span class=\"acu-task-name\" style=\"font-size:12px;display:flex;align-items:center;gap:6px;\">\n                                    <span class=\"acu-dash-npc-avatar\" data-npc-name=\"${escapeHtml(npcName)}\" style=\"width:22px;height:22px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:var(--acu-badge-bg, rgba(0,255,255,0.12));border:1.5px solid ${isInScene ? 'var(--acu-accent)' : 'var(--acu-border)'};${avatarStyle}${offSceneFilter}\" title=\"${isInScene ? '' : ''}\">\n                                        ${!npcAvatar ? `<span class=\"acu-dash-npc-avatar-fallback\" style=\"font-size:10px;font-weight:bold;color:var(--acu-accent);\">${escapeHtml(npcFallbackChar)}</span>` : ''}\n                                    </span>\n                                    <span title=\"${escapeHtml(npcDisplayName)}\" style=\"${isInScene ? '' : 'opacity:0.6;'}\">${escapeHtml(npcDisplayShort)}</span>\n                                </span>\n                                <div style=\"display:flex;align-items:center;\">\n                                    <i class=\"fa-solid fa-people-arrows acu-dash-contest-btn\" data-npc=\"${escapeHtml(npcName)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:8px;\" title=\"${escapeHtml(npcDisplayName)}\"></i>\n                                </div>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  +  +  -->\n                <div class=\"acu-dash-intel\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(bagTableName)}\"><i class=\"fa-solid fa-bag-shopping\"></i>  (${bagParsed.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:90px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      bagItems.length > 0\n                        ? bagItems\n                            .map((item, idx) => {\n                              const isLastBag = idx === bagItems.length - 1;\n                              const emoji = getElementEmoji(item.name, null);\n                              let iconHtml = '';\n                              if (emoji) {\n                                if (emoji.startsWith('fa:')) {\n                                  iconHtml = `<i class=\"fa-solid fa-${emoji.slice(3)}\" style=\"font-size:10px;opacity:0.7;\"></i>`;\n                                } else if (emoji.startsWith('ti:')) {\n                                  iconHtml = `<i class=\"ti ti-${emoji.slice(3)}\" style=\"font-size:10px;opacity:0.7;\"></i>`;\n                                } else {\n                                  iconHtml = `<span style=\"font-size:10px;\">${emoji}</span>`;\n                                }\n                              } else {\n                                iconHtml = '<i class=\"fa-solid fa-cube\" style=\"font-size:9px;opacity:0.4;\"></i>';\n                              }\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${bagResult?.key || ''}\"\n                            data-row-index=\"${idx}\"\n                            data-preview-type=\"bag\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLastBag ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);flex:1;white-space:nowrap;display:flex;align-items:center;gap:4px;\" title=\"${escapeHtml(item.name)}\">\n                                ${iconHtml}\n                                ${escapeHtml(item.name.length > 4 ? item.name.substring(0, 4) + '..' : item.name)}\n                            </span>\n                            <div style=\"display:flex;align-items:center;gap:6px;\">\n                                <i class=\"fa-solid fa-hand-pointer acu-dash-use-item-btn\" data-item=\"${escapeHtml(item.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:8px;\" title=\"${item.name}\"></i>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(equipTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-shield-halved\"></i>  (${equippedItems.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      equippedItems.length > 0\n                        ? equippedItems\n                            .map((item, idx) => {\n                              const isLast = idx === equippedItems.length - 1;\n                              const emoji = getElementEmoji(item.name, null);\n                              let iconHtml = '';\n                              if (emoji) {\n                                if (emoji.startsWith('fa:')) {\n                                  iconHtml = `<i class=\"fa-solid fa-${emoji.slice(3)}\" style=\"font-size:10px;opacity:0.7;\"></i>`;\n                                } else if (emoji.startsWith('ti:')) {\n                                  iconHtml = `<i class=\"ti ti-${emoji.slice(3)}\" style=\"font-size:10px;opacity:0.7;\"></i>`;\n                                } else {\n                                  iconHtml = `<span style=\"font-size:10px;\">${emoji}</span>`;\n                                }\n                              } else {\n                                iconHtml = '<i class=\"fa-solid fa-shirt\" style=\"font-size:9px;opacity:0.4;\"></i>';\n                              }\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${equipResult?.key || ''}\"\n                            data-row-index=\"${equipParsed.findIndex(r => r.name === item.name)}\"\n                            data-preview-type=\"equipment\"\n                            style=\"display:flex;align-items:center;gap:4px;padding:4px;font-size:11px;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;${!isLast ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            ${iconHtml}\n                            <span style=\"color:var(--acu-text-main);overflow:hidden;text-overflow:ellipsis;\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name)}</span>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(questTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-clipboard-list\"></i>  (${activeTasks.length})</h3>\n                    <div style=\"max-height:50px;overflow-y:auto;\">\n                    ${\n                      activeTasks.length > 0\n                        ? activeTasks\n                            .map((t, idx) => {\n                              const isMain = String(t.type || '').includes('');\n                              // \n                              let progressPercent = null;\n                              const progressMatch = String(t.progress || '').match(/(\\d+)\\s*%/);\n                              if (progressMatch) {\n                                progressPercent = Math.min(100, Math.max(0, parseInt(progressMatch[1], 10)));\n                              }\n                              const progressBar =\n                                progressPercent !== null\n                                  ? `<div style=\"width:40px;height:4px;background:var(--acu-border);border-radius:2px;overflow:hidden;\"><div style=\"width:${progressPercent}%;height:100%;background:var(--acu-accent);\"></div></div>`\n                                  : '';\n                              return `<div class=\"acu-task-item acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${questResult?.key || ''}\"\n                            data-row-index=\"${t._rowIndex !== undefined ? t._rowIndex : questParsed.findIndex(q => q.name === t.name)}\"\n                            data-preview-type=\"quest\"\n                            style=\"padding:4px 8px;margin-bottom:3px;cursor:pointer;\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <div class=\"acu-task-name\" style=\"font-size:11px;${isMain ? 'font-weight:600;' : ''}\">${escapeHtml(t.name)}</div>\n                                ${progressBar}\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n            </div>\n    `;\n\n    // \n    const loadedModules = [\n      globalResult ? '' : null,\n      playerResult ? '' : null,\n      locationResult ? '' : null,\n      npcResult ? 'NPC' : null,\n      questResult ? '' : null,\n      bagResult ? '' : null,\n      equipResult ? '' : null,\n    ].filter(Boolean);\n\n    console.info(`[DICE]${loadedModules.length}: ${loadedModules.join(', ')}`);\n    return html;\n  };\n\n  // [] NPCIndexedDB\n  const loadDashboardNpcAvatars = () => {\n    const $avatars = $('.acu-dash-npc-avatar[data-npc-name]');\n    if ($avatars.length === 0) return;\n\n    const normalizeName = (value: string): string => {\n      const base = String(value || '')\n        .normalize('NFKC')\n        .replace(/[\\u200B-\\u200D\\uFEFF]/g, '')\n        .trim();\n      if (!base) return '';\n      const display = replaceUserPlaceholders(getDisplayName(base)).trim() || base;\n      return display\n        .normalize('NFKC')\n        .replace(/[\\u200B-\\u200D\\uFEFF]/g, '')\n        .replace(/\\s+/g, '')\n        .toLowerCase();\n    };\n\n    void (async () => {\n      const allAvatarData = AvatarManager.getAll();\n      const candidatePool: string[] = [];\n      const pushUnique = (name: string) => {\n        const cleaned = String(name || '').trim();\n        if (!cleaned) return;\n        if (!candidatePool.includes(cleaned)) candidatePool.push(cleaned);\n      };\n\n      Object.keys(allAvatarData).forEach(pushUnique);\n      Object.values(allAvatarData).forEach(data => {\n        const aliasCandidates = Array.isArray((data as { aliases?: unknown[] }).aliases)\n          ? ((data as { aliases?: unknown[] }).aliases as unknown[])\n          : [];\n        aliasCandidates.forEach(alias => pushUnique(String(alias || '')));\n      });\n\n      let localNames: string[] = [];\n      try {\n        localNames = (await LocalAvatarDB.getAllNames()) as string[];\n      } catch {\n        localNames = [];\n      }\n      localNames.forEach(name => pushUnique(String(name || '')));\n\n      const normalizedNameMap = new Map<string, string[]>();\n      const addNormalized = (name: string) => {\n        const key = normalizeName(name);\n        if (!key) return;\n        if (!normalizedNameMap.has(key)) normalizedNameMap.set(key, []);\n        const list = normalizedNameMap.get(key)!;\n        if (!list.includes(name)) list.push(name);\n      };\n      candidatePool.forEach(addNormalized);\n\n      const getManualAliases = (name: string): string[] => {\n        const data = AvatarManager.getAll()[name] as { aliases?: unknown[] } | undefined;\n        if (!data || !Array.isArray(data.aliases)) return [];\n        return data.aliases.map(alias => String(alias || '').trim()).filter(Boolean);\n      };\n\n      $avatars.each(function () {\n        const $el = $(this);\n        const rawName = String($el.attr('data-npc-name') || '').trim();\n        if (!rawName) return;\n\n        void (async () => {\n          try {\n            const displayName = getDisplayName(rawName);\n            const resolvedName = NameAliasRegistry.resolve(rawName);\n            const avatarPrimaryName = AvatarManager.getPrimaryName(rawName);\n\n            const directCandidates = Array.from(\n              new Set(\n                [\n                  rawName,\n                  displayName,\n                  resolvedName,\n                  avatarPrimaryName,\n                  replaceUserPlaceholders(rawName),\n                  replaceUserPlaceholders(displayName),\n                  replaceUserPlaceholders(resolvedName),\n                  ...NameAliasRegistry.getAliases(resolvedName),\n                  ...NameAliasRegistry.getAliases(avatarPrimaryName),\n                  ...getManualAliases(resolvedName),\n                  ...getManualAliases(avatarPrimaryName),\n                ]\n                  .map(v => String(v || '').trim())\n                  .filter(Boolean),\n              ),\n            );\n\n            const allCandidates = [...directCandidates];\n            directCandidates.forEach(name => {\n              const key = normalizeName(name);\n              if (!key) return;\n              const mapped = normalizedNameMap.get(key) || [];\n              mapped.forEach(m => {\n                if (!allCandidates.includes(m)) allCandidates.push(m);\n              });\n            });\n\n            let matchedName: string | null = null;\n            let matchedUrl: string | null = null;\n            let matchedLocal = false;\n\n            // 1) \n            for (const name of allCandidates) {\n              const localUrl = await LocalAvatarDB.get(name);\n              if (localUrl) {\n                matchedName = name;\n                matchedUrl = localUrl;\n                matchedLocal = true;\n                break;\n              }\n            }\n\n            // 2) URL\n            if (!matchedUrl) {\n              for (const name of allCandidates) {\n                const url = AvatarManager.get(name);\n                if (url) {\n                  matchedName = name;\n                  matchedUrl = url;\n                  break;\n                }\n              }\n            }\n\n            // 3) /\n            if (!matchedUrl) {\n              for (const name of allCandidates) {\n                const url = await AvatarManager.getAsync(name);\n                if (url) {\n                  matchedName = name;\n                  matchedUrl = url;\n                  break;\n                }\n              }\n            }\n\n            // fallback\n            if (!matchedUrl || !matchedName) {\n              $el.css({\n                'background-image': 'none',\n                'background-color': 'var(--acu-badge-bg, rgba(0,255,255,0.12))',\n              });\n              $el.find('.acu-dash-npc-avatar-fallback').show();\n              return;\n            }\n\n            const applyAvatar = () => {\n              const offsetX = AvatarManager.getOffsetX(matchedName!);\n              const offsetY = AvatarManager.getOffsetY(matchedName!);\n              const scale = AvatarManager.getScale(matchedName!);\n              $el.css({\n                'background-image': `url('${matchedUrl}')`,\n                'background-size': `${scale}%`,\n                'background-position': `${offsetX}% ${offsetY}%`,\n                'background-repeat': 'no-repeat',\n                'background-color': 'var(--acu-badge-bg, rgba(0,255,255,0.12))',\n              });\n              $el.find('.acu-dash-npc-avatar-fallback').hide();\n            };\n\n            // /Blob\n            if (matchedLocal || matchedUrl.startsWith('blob:')) {\n              applyAvatar();\n              return;\n            }\n\n            // URLfallback\n            const img = new Image();\n            img.onload = applyAvatar;\n            img.onerror = () => {\n              $el.css({\n                'background-image': 'none',\n                'background-color': 'var(--acu-badge-bg, rgba(0,255,255,0.12))',\n              });\n              $el.find('.acu-dash-npc-avatar-fallback').show();\n            };\n            img.src = matchedUrl;\n          } catch {\n            $el.css({\n              'background-image': 'none',\n              'background-color': 'var(--acu-badge-bg, rgba(0,255,255,0.12))',\n            });\n            $el.find('.acu-dash-npc-avatar-fallback').show();\n          }\n        })();\n      });\n    })();\n  };\n\n  // ========== []  ==========\n  const renderFavoritesPanel = async (): Promise<string> => {\n    const allFavorites = await FavoritesManager.getAll();\n    const allTags = await FavoritesManager.getAllTags();\n\n    // \n    const groupedByTag: Record<string, FavoriteItem[]> = {};\n    const untagged: FavoriteItem[] = [];\n\n    for (const fav of allFavorites) {\n      if (fav.tags && fav.tags.length > 0) {\n        for (const tag of fav.tags) {\n          if (!groupedByTag[tag]) groupedByTag[tag] = [];\n          groupedByTag[tag].push(fav);\n        }\n      } else {\n        untagged.push(fav);\n      }\n    }\n\n    // HTML ( acu-data-card)\n    const renderFavoriteCard = (fav: FavoriteItem) => {\n      // \n      const rowsHtml = fav.header\n        .map((h, i) => {\n          // /\n          const cleanHeader = h.replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n          return `\n        <div class=\"acu-card-row\">\n          <div class=\"acu-card-label\">${escapeHtml(cleanHeader)}</div>\n          <div class=\"acu-card-value\">${escapeHtml(String(fav.rowData[i] || ''))}</div>\n        </div>\n      `;\n        })\n        .join('');\n      const tagsHtml = fav.tags.map(tag => `<span class=\"acu-fav-tag\">${escapeHtml(tag)}</span>`).join('');\n      const sourceLabel = fav.sourceInfo ? escapeHtml(fav.sourceInfo.tableName) : '';\n\n      //  acu-data-card tags\n      return `\n        <div class=\"acu-data-card acu-fav-card\" data-id=\"${escapeHtml(fav.id)}\">\n          <div class=\"acu-card-header\">\n            <span class=\"acu-editable-title\">${escapeHtml(String(fav.rowData[0] || ''))}</span>\n          </div>\n          <div class=\"acu-card-body view-list\">${rowsHtml}</div>\n          <div class=\"acu-fav-card-tags\">\n            ${sourceLabel ? `<span class=\"acu-fav-card-source\">${sourceLabel}</span>` : ''}\n            ${tagsHtml}\n          </div>\n        </div>\n      `;\n    };\n\n    // \n    const config = getConfig();\n\n    // \n    let contentHtml = '';\n\n    //  acu-card-grid \n    for (const tag of Object.keys(groupedByTag).sort()) {\n      contentHtml += `\n        <div class=\"acu-fav-group\">\n          <div class=\"acu-fav-group-title\"><i class=\"fa-solid fa-tag\"></i> ${escapeHtml(tag)}</div>\n          <div class=\"acu-card-grid\">${groupedByTag[tag].map(renderFavoriteCard).join('')}</div>\n        </div>\n      `;\n    }\n\n    // \n    if (untagged.length > 0) {\n      contentHtml += `\n        <div class=\"acu-fav-group\">\n          <div class=\"acu-fav-group-title\"><i class=\"fa-solid fa-inbox\"></i> </div>\n          <div class=\"acu-card-grid\">${untagged.map(renderFavoriteCard).join('')}</div>\n        </div>\n      `;\n    }\n\n    if (allFavorites.length === 0) {\n      contentHtml += `\n        <div class=\"acu-fav-empty\">\n          <i class=\"fa-solid fa-star\"></i>\n          <p></p>\n          <p>  \"\"</p>\n        </div>\n      `;\n    }\n\n    return `\n      <div class=\"acu-fav-wrapper acu-theme-${config.theme}\" style=\"--acu-card-width:${config.cardWidth}px; --acu-font-size:${config.fontSize}px;\">\n      <div class=\"acu-panel-header\">\n        <div class=\"acu-panel-title\">\n          <div class=\"acu-title-main\"><i class=\"fa-solid fa-star\"></i> <span class=\"acu-title-text\"></span></div>\n          <div class=\"acu-title-sub\">(${allFavorites.length})</div>\n        </div>\n        <div class=\"acu-header-actions\">\n          <button class=\"acu-view-btn\" id=\"acu-fav-import\" title=\"\"><i class=\"fa-solid fa-file-import\"></i></button>\n          <button class=\"acu-view-btn\" id=\"acu-fav-export\" title=\"\"><i class=\"fa-solid fa-file-export\"></i></button>\n          <div class=\"acu-search-wrapper\"><i class=\"fa-solid fa-search acu-search-icon\"></i><input type=\"text\" class=\"acu-search-input\" id=\"acu-fav-search\" placeholder=\"...\" /></div>\n          <div class=\"acu-height-control\"><i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\"></i></div>\n          <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n        </div>\n      </div>\n      <div class=\"acu-fav-panel-content\">\n        <div class=\"acu-fav-tag-filter-collapsible collapsed\">\n          <div class=\"acu-fav-tag-filter-header\">\n            <span></span>\n            <i class=\"fa-solid fa-chevron-down acu-fav-tag-toggle-icon\"></i>\n          </div>\n          <div class=\"acu-fav-tag-filter-body\">\n            ${untagged.length > 0 ? '<button class=\"acu-fav-tag-btn active\" data-tag=\"__untagged__\"></button>' : ''}\n            ${allTags.map(tag => `<button class=\"acu-fav-tag-btn active\" data-tag=\"${escapeHtml(tag)}\">${escapeHtml(tag)}</button>`).join('')}\n          </div>\n        </div>\n        ${contentHtml}\n      </div>\n      </div>\n    `;\n  };\n\n  // ========== []  ==========\n  const bindFavoritesEvents = ($panel: JQuery) => {\n    const { $ } = getCore();\n    const rawData = cachedRawData || getTableData();\n    const currentTables = rawData || {};\n\n    // \n    $panel.off('.favEvents');\n\n    // === []  ST  swipe regenerate ===\n    (function () {\n      const panelEl = $panel[0];\n      if (!panelEl) return;\n\n      // \n      if ((panelEl as any)._favSwipeFixApplied) return;\n      (panelEl as any)._favSwipeFixApplied = true;\n\n      let touchStartX = 0;\n      let touchStartY = 0;\n      let isHorizontalSwipe = false;\n\n      const onTouchStart = (e: TouchEvent) => {\n        if (e.touches.length === 1) {\n          touchStartX = e.touches[0].clientX;\n          touchStartY = e.touches[0].clientY;\n          isHorizontalSwipe = false;\n        }\n      };\n\n      const onTouchMove = (e: TouchEvent) => {\n        if (e.touches.length !== 1) return;\n\n        const touch = e.touches[0];\n        const deltaX = Math.abs(touch.clientX - touchStartX);\n        const deltaY = Math.abs(touch.clientY - touchStartY);\n\n        // deltaY\n        const isHorizontal = deltaY < 5 ? deltaX > 5 && deltaX > deltaY * 2 : deltaX > deltaY * 1.5 && deltaX > 10;\n\n        if (isHorizontal) {\n          isHorizontalSwipe = true;\n          e.stopImmediatePropagation();\n          e.stopPropagation();\n        }\n      };\n\n      const onTouchEnd = (e: TouchEvent) => {\n        if (isHorizontalSwipe) {\n          e.stopImmediatePropagation();\n          e.stopPropagation();\n          isHorizontalSwipe = false;\n        }\n        touchStartX = 0;\n        touchStartY = 0;\n      };\n\n      //  ST \n      panelEl.addEventListener('touchstart', onTouchStart, true);\n      panelEl.addEventListener('touchmove', onTouchMove, true);\n      panelEl.addEventListener('touchend', onTouchEnd, true);\n\n      // \n      $(window).on('pagehide.favSwipeFix', () => {\n        panelEl.removeEventListener('touchstart', onTouchStart, true);\n        panelEl.removeEventListener('touchmove', onTouchMove, true);\n        panelEl.removeEventListener('touchend', onTouchEnd, true);\n      });\n    })();\n\n    // \n    $panel.on('click.favEvents', '.acu-close-btn', function (e) {\n      e.stopPropagation();\n      Store.set('acu_favorites_panel_active', false);\n      // [] \n      $panel.html('');\n      $('#acu-btn-favorites').removeClass('active');\n    });\n\n    // []  - \n    $panel.on('pointerdown.favEvents', '.acu-height-drag-handle', function (e) {\n      if (e.button !== 0) return;\n      e.preventDefault();\n      e.stopPropagation();\n      const handle = this;\n      handle.setPointerCapture(e.pointerId);\n      $(handle).addClass('active');\n      const $dataArea = $('#acu-data-area');\n      const startHeight = $dataArea.height() || 400;\n      const startY = e.clientY;\n      const tableName = $(handle).data('table');\n\n      handle.onpointermove = function (moveE: PointerEvent) {\n        const dy = moveE.clientY - startY;\n        let newHeight = startHeight - dy;\n        if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n        if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n        $dataArea.css('height', newHeight + 'px');\n      };\n      handle.onpointerup = function (upE: PointerEvent) {\n        $(handle).removeClass('active');\n        handle.releasePointerCapture(upE.pointerId);\n        handle.onpointermove = null;\n        handle.onpointerup = null;\n        if (tableName) {\n          const heights = getTableHeights();\n          heights[tableName] = parseInt($dataArea.css('height'));\n          saveTableHeights(heights);\n          $dataArea.addClass('acu-manual-mode');\n        }\n      };\n    });\n\n    // []  - \n    $panel.on('dblclick.favEvents', '.acu-height-drag-handle', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const tableName = $(this).data('table');\n      if (tableName) {\n        const heights = getTableHeights();\n        delete heights[tableName];\n        saveTableHeights(heights);\n        $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n      }\n    });\n\n    // /\n    $panel.on('click.favEvents', '.acu-fav-tag-filter-header', function () {\n      const $collapsible = $(this).closest('.acu-fav-tag-filter-collapsible');\n      $collapsible.toggleClass('collapsed');\n    });\n\n    // toggle\n    $panel.on('click.favEvents', '.acu-fav-tag-btn', function () {\n      const $btn = $(this);\n      const tag = $btn.data('tag') as string;\n      const isActive = $btn.hasClass('active');\n\n      // \n      $btn.toggleClass('active');\n\n      // \n      if (tag === '__untagged__') {\n        // \"\"\n        $panel.find('.acu-fav-group').each(function () {\n          const groupTitle = $(this).find('.acu-fav-group-title').text();\n          if (groupTitle.includes('')) {\n            $(this).toggle(!isActive);\n          }\n        });\n      } else {\n        // \n        $panel.find('.acu-fav-group').each(function () {\n          const groupTitle = $(this).find('.acu-fav-group-title').text();\n          if (groupTitle.includes(tag) && !groupTitle.includes('')) {\n            $(this).toggle(!isActive);\n          }\n        });\n      }\n    });\n\n    // \n    $panel.find('#acu-fav-search').on(\n      'input.favEvents',\n      _.debounce(function () {\n        const searchTerm = ($(this).val() as string).toLowerCase().trim();\n        $panel.find('.acu-fav-card').each(function () {\n          const cardText = $(this).text().toLowerCase();\n          $(this).toggle(cardText.includes(searchTerm));\n        });\n      }, 300),\n    );\n\n    // \n    const showFavCardMenu = (e: JQuery.ClickEvent, cardId: string) => {\n      $('.acu-cell-menu, .acu-menu-backdrop').remove();\n\n      const backdrop = $('<div class=\"acu-menu-backdrop\"></div>');\n      $('body').append(backdrop);\n\n      const config = getConfig();\n      const menu = $(`\n        <div class=\"acu-cell-menu acu-theme-${config.theme}\" data-fav-id=\"${escapeHtml(cardId)}\">\n          <div class=\"acu-cell-menu-item\" data-action=\"edit\"><i class=\"fa-solid fa-pen\"></i> </div>\n          <div class=\"acu-cell-menu-item\" data-action=\"copy\"><i class=\"fa-solid fa-copy\"></i> </div>\n          <div class=\"acu-cell-menu-item\" data-action=\"send\"><i class=\"fa-solid fa-paper-plane\"></i> </div>\n          <div class=\"acu-cell-menu-item\" data-action=\"delete\"><i class=\"fa-solid fa-trash\"></i> </div>\n          <div class=\"acu-cell-menu-item\" data-action=\"close\"><i class=\"fa-solid fa-times\"></i> </div>\n        </div>\n      `);\n      $('body').append(menu);\n\n      // \n      const winWidth = $(window).width() || 800;\n      const winHeight = $(window).height() || 600;\n      const mWidth = menu.outerWidth() || 150;\n      const mHeight = menu.outerHeight() || 150;\n      let posX = e.clientX || winWidth / 2;\n      let posY = e.clientY || winHeight / 2;\n      if (posX + mWidth > winWidth) posX = winWidth - mWidth - 10;\n      if (posY + mHeight > winHeight) posY = winHeight - mHeight - 10;\n      menu.css({ left: posX, top: posY });\n\n      // backdrop\n      backdrop.on('click', () => {\n        $('.acu-cell-menu, .acu-menu-backdrop').remove();\n      });\n\n      // \n      menu.on('click', '.acu-cell-menu-item', async function () {\n        const action = $(this).data('action');\n        const id = menu.data('fav-id');\n        $('.acu-cell-menu, .acu-menu-backdrop').remove();\n\n        if (action === 'close') return;\n\n        const fav = await FavoritesManager.getById(id);\n        if (!fav) return;\n\n        if (action === 'edit') {\n          showFavoriteEditModal(fav, async updated => {\n            await FavoritesManager.updateFavorite(id, updated);\n            $panel.html(await renderFavoritesPanel());\n            bindFavoritesEvents($panel);\n          });\n        } else if (action === 'copy') {\n          const copied = await FavoritesManager.duplicateFavorite(id);\n          if (copied) {\n            $panel.html(await renderFavoritesPanel());\n            bindFavoritesEvents($panel);\n          }\n        } else if (action === 'send') {\n          const compatible = FavoritesManager.findCompatibleTables(fav, currentTables);\n          if (compatible.length === 0) {\n            toastr.warning('');\n            return;\n          }\n          showSendToTableModal(fav, compatible, currentTables, async () => {\n            $panel.html(await renderFavoritesPanel());\n            bindFavoritesEvents($panel);\n          });\n        } else if (action === 'delete') {\n          await FavoritesManager.deleteFavorite(id);\n          $panel.html(await renderFavoritesPanel());\n          bindFavoritesEvents($panel);\n        }\n      });\n    };\n\n    // \n    $panel.on('click.favEvents', '.acu-fav-card', function (e) {\n      e.stopPropagation();\n      const $card = $(this);\n      const cardId = $card.data('id');\n\n      // Toggle\n      const existingMenu = $('.acu-cell-menu');\n      if (existingMenu.length && existingMenu.data('fav-id') === cardId) {\n        $('.acu-cell-menu, .acu-menu-backdrop').remove();\n        return;\n      }\n\n      showFavCardMenu(e, cardId);\n    });\n\n    // \n    $panel.on('click.favEvents', '#acu-fav-import', async function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (file) {\n          const text = await file.text();\n          const result = await FavoritesManager.importFavorites(text);\n          // [] importFavorites  { added, updated } \n          if (result && (result.added > 0 || result.updated > 0)) {\n            if (window.toastr) window.toastr.success(`: ${result.added}, ${result.updated}`);\n            $panel.html(await renderFavoritesPanel());\n            bindFavoritesEvents($panel);\n          } else {\n            if (window.toastr) window.toastr.warning('');\n          }\n        }\n      };\n      input.click();\n    });\n\n    // \n    $panel.on('click.favEvents', '#acu-fav-export', async function () {\n      const json = await FavoritesManager.exportFavorites();\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `favorites_${new Date().toISOString().slice(0, 10)}.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n      if (window.toastr) window.toastr.success('');\n    });\n\n    console.log('[DICE] bindFavoritesEvents initialized');\n  };\n\n  const renderTableContent = (tableData, tableName) => {\n    if (!tableData || !tableData.rows.length)\n      return `\n            <div class=\"acu-panel-header\"><div class=\"acu-panel-title\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${tableName}</div><button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button></div>\n            <div class=\"acu-panel-content\"><div style=\"text-align:center;color:var(--acu-text-sub);padding:20px;\"></div></div>`;\n\n    const config = getConfig();\n    const headers = (tableData.headers || []).slice(1);\n\n    // [] -API\n    const dbLockApi = getDbLockAPI();\n    const sheetKey = dbLockApi ? getSheetKeyByTableName(tableName) : null;\n    const lockState = dbLockApi && sheetKey ? dbLockApi.getTableLockState(sheetKey) : null;\n\n    //  ( list)\n    const currentStyle = (getTableStyles() || {})[tableName] || 'list';\n    const isGridMode = currentStyle === 'grid';\n\n    let titleColIndex = 1;\n    if (tableData.headers.length === 1) {\n      titleColIndex = 0;\n    } else if (tableName.includes('') || tableName.includes('')) {\n      const idx = tableData.headers.findIndex(\n        h => h && (h.includes('') || h.includes('') || h.includes('')),\n      );\n      if (idx > 0) titleColIndex = idx;\n    }\n\n    // ---  ---\n    let processedRows = tableData.rows.map((row, index) => {\n      const rowKey = getRowKey(tableName, row, tableData.headers);\n      const isBookmarked = rowKey && BookmarkManager.isBookmarked(tableName, rowKey);\n      return { data: row, originalIndex: index, rowKey, isBookmarked };\n    });\n    const searchTerm = (tableSearchStates[tableName] || '').toLowerCase().trim();\n\n    // \n    const isReversed = isTableReversed(tableName);\n\n    if (searchTerm) {\n      processedRows = processedRows.filter(item =>\n        item.data.some(cell => String(cell).toLowerCase().includes(searchTerm)),\n      );\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        const titleA = String(a.data[titleColIndex] || '').toLowerCase();\n        const titleB = String(b.data[titleColIndex] || '').toLowerCase();\n        const aHitTitle = titleA.includes(searchTerm);\n        const bHitTitle = titleB.includes(searchTerm);\n        if (titleA === searchTerm && titleB !== searchTerm) return -1;\n        if (titleA !== searchTerm && titleB === searchTerm) return 1;\n        if (aHitTitle && !bHitTitle) return -1;\n        if (!aHitTitle && bHitTitle) return 1;\n        return a.originalIndex - b.originalIndex;\n      });\n    } else {\n      // \n      // bookmark\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        if (isReversed) {\n          return b.originalIndex - a.originalIndex;\n        } else {\n          return a.originalIndex - b.originalIndex;\n        }\n      });\n    }\n\n    const itemsPerPage = config.itemsPerPage || 50;\n    const totalItems = processedRows.length;\n    const totalPages = Math.ceil(totalItems / itemsPerPage) || 1;\n    let currentPage = tablePageStates[tableName] || 1;\n    if (currentPage > totalPages) currentPage = totalPages;\n    if (currentPage < 1) currentPage = 1;\n    tablePageStates[tableName] = currentPage;\n\n    const startIdx = (currentPage - 1) * itemsPerPage;\n    const endIdx = startIdx + itemsPerPage;\n    const rowsToRender = processedRows.slice(startIdx, endIdx);\n    // []    \n    // \n    const showReverseBtn = shouldShowReverseButton(tableName);\n    const reverseBtnHtml = showReverseBtn\n      ? `\n            <button class=\"acu-view-btn acu-reverse-btn\" data-table=\"${escapeHtml(tableName)}\" title=\"${isReversed ? '' : ''}\">\n                <i class=\"fa-solid ${isReversed ? 'fa-sort-amount-up' : 'fa-sort-amount-down'}\"></i>\n            </button>\n        `\n      : '';\n\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n    <div class=\"acu-title-main\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> <span class=\"acu-title-text\">${escapeHtml(tableName)}</span></div>\n    <div class=\"acu-title-sub\">(${startIdx + 1}-${Math.min(endIdx, totalItems)} / ${totalItems})${isReversed ? ' <span style=\"color:var(--acu-accent);\"></span>' : ''}</div>\n</div>\n                <div class=\"acu-header-actions\">\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn\" id=\"acu-btn-relation-graph\" data-table=\"${escapeHtml(tableName)}\" title=\"\"><i class=\"fa-solid fa-project-diagram\"></i></button>` : ''}\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn acu-table-map-btn\" title=\"\"><i class=\"fa-solid fa-map\"></i></button>` : ''}\n                    ${reverseBtnHtml}\n                    <button class=\"acu-view-btn\" id=\"acu-btn-switch-style\" data-table=\"${escapeHtml(tableName)}\" title=\"  (: ${isGridMode ? '' : ''})\">\n                        <i class=\"fa-solid ${isGridMode ? 'fa-th-large' : 'fa-list'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${escapeHtml(tableName)}\" title=\"  | \"></i>\n                    </div>\n\n                    <div class=\"acu-search-wrapper\"><i class=\"fa-solid fa-search acu-search-icon\"></i><input type=\"text\" class=\"acu-search-input\" placeholder=\"...\" value=\"${(tableSearchStates[tableName] || '').replace(/\"/g, '&quot;')}\" /></div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>\n            <div class=\"acu-panel-content\"><div class=\"acu-card-grid\">`;\n\n    html += rowsToRender\n      .map(item => {\n        const realRowIdx = item.originalIndex;\n        const row = item.data;\n        const cardTitle = row[titleColIndex] || '';\n        // key\n        const cardTitleDisplay = isCharacterTable(tableName) ? getDisplayName(String(cardTitle)) : String(cardTitle);\n        const showDefaultIndex = titleColIndex === 1;\n        const titleCellId = `${tableData.key}-${realRowIdx}-${titleColIndex}`;\n        const isTitleModified = window.acuModifiedSet && window.acuModifiedSet.has(titleCellId);\n        const isRowNew = currentDiffMap.has(`${tableName}-row-${realRowIdx}`);\n        let rowClass = '';\n        if (config.highlightNew) {\n          if (isTitleModified) rowClass = 'acu-highlight-manual';\n          else if (isRowNew) rowClass = 'acu-highlight-diff';\n        }\n\n        // [] \n        const cardLockRowKey = getRowKey(tableName, row, tableData.headers);\n        const cardRowIndex =\n          sheetKey && cardLockRowKey ? findRowIndexByPrimaryKey(sheetKey, tableName, cardLockRowKey) : null;\n        const isCardRowLocked = lockState && cardRowIndex !== null ? lockState.rows.includes(cardRowIndex) : false;\n\n        // [] \n        // titleColIndex - colIndex  -1\n        const isTitleCellLocked =\n          lockState && cardRowIndex !== null ? lockState.cells.includes(`${cardRowIndex}:${titleColIndex - 1}`) : false;\n\n        // \n        const validColIndices = row.map((_, i) => i).filter(i => i > 0 && i !== titleColIndex);\n        const isOddValidCount = validColIndices.length % 2 === 1;\n\n        const cardBody = row\n          .map((cell, cIdx) => {\n            if (cIdx <= 0 || cIdx === titleColIndex) return '';\n            // [] \"\"\n            const currentHeader = headers[cIdx - 1] || '';\n            if (currentHeader.includes('')) return '';\n            const isLastValidCol = cIdx === validColIndices[validColIndices.length - 1];\n            const spanFullRow = isLastValidCol && isOddValidCount;\n            // /\n            const rawHeaderName = headers[cIdx - 1] || '' + cIdx;\n\n            // [] cardRowIndex\n            // [] cIdx - colIndex  -1\n            const isThisCellLocked =\n              lockState && cardRowIndex !== null ? lockState.cells.includes(`${cardRowIndex}:${cIdx - 1}`) : false;\n            // [] \n            const isThisFieldLocked = isCardRowLocked || isThisCellLocked;\n\n            const headerName = rawHeaderName.replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n            const safeStr = str =>\n              String(str)\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#039;');\n            const rawStrOriginal = String(cell).trim();\n            const rawStr = replaceUserPlaceholders(rawStrOriginal);\n            const invalidPlaceholders = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n            if (invalidPlaceholders.includes(rawStr.toLowerCase())) {\n              return ''; // \n            }\n\n            let contentHtml = '';\n            let hideLabel = false; // \n            const splitRegex = /[;]/;\n\n            // [] \n            const isIdentityField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return lowerHeader.includes('');\n            };\n\n            const isAttributeField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return (\n                lowerHeader.includes('') || lowerHeader.includes('') || lowerHeader.includes('')\n              );\n            };\n\n            //  ( \":92\"  \":92, :88\")\n            // [] \n            const parsedAttrs = isIdentityField(rawHeaderName) ? [] : parseAttributeString(rawStr);\n            // [] \n            if (isIdentityField(rawHeaderName)) {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            } else if (isRelationshipCell(rawStr, headerName)) {\n              // [] \n              const relations = parseRelationshipString(rawStr);\n              // [] \n              const validRelations = relations.filter(rel => {\n                if (!rel.relation) return true; // \n                return !invalidPlaceholders.includes(rel.relation.toLowerCase());\n              });\n\n              if (validRelations.length > 1) {\n                hideLabel = true;\n                let relHtml = '';\n                for (let i = 0; i < validRelations.length; i++) {\n                  const rel = validRelations[i];\n                  const borderStyle =\n                    i < validRelations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                  relHtml += '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;' + borderStyle + '\">';\n                  relHtml +=\n                    '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\" data-locked=\"' +\n                    isThisFieldLocked +\n                    '\">' +\n                    safeStr(rel.name) +\n                    '</span>';\n                  if (rel.relation) {\n                    relHtml +=\n                      '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                      safeStr(rel.relation) +\n                      '</span>';\n                  }\n                  relHtml += '</div>';\n                }\n                contentHtml = '<div class=\"acu-relation-container\">' + relHtml + '</div>';\n              } else if (validRelations.length === 1) {\n                hideLabel = true;\n                const rel = validRelations[0];\n                contentHtml = '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;\">';\n                contentHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\" data-locked=\"' +\n                  isThisFieldLocked +\n                  '\">' +\n                  safeStr(rel.name) +\n                  '</span>';\n                if (rel.relation) {\n                  contentHtml +=\n                    '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                    safeStr(rel.relation) +\n                    '</span>';\n                }\n                contentHtml += '</div>';\n              }\n            } else if (parsedAttrs.length > 1) {\n              // 2\n              hideLabel = true;\n              let attrsHtml = '';\n              for (let i = 0; i < parsedAttrs.length; i++) {\n                const attr = parsedAttrs[i];\n                const showDice = !BlacklistManager.isBlacklisted(attr.name);\n                attrsHtml +=\n                  '<div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 0;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.9em;white-space:nowrap;\" data-locked=\"' +\n                  isThisFieldLocked +\n                  '\" title=\"' +\n                  safeStr(attr.name) +\n                  '\">' +\n                  safeStr(attr.name.length > 3 ? attr.name.substring(0, 5) : attr.name) +\n                  '</span>';\n                attrsHtml += '<div style=\"display:flex;align-items:center;gap:4px;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-main);font-weight:bold;font-size:0.95em;\">' +\n                  attr.value +\n                  '</span>';\n                if (showDice) {\n                  attrsHtml +=\n                    '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                    safeStr(attr.name) +\n                    '\" data-attr-value=\"' +\n                    attr.value +\n                    '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:10px;\" title=\"\"></i>';\n                }\n                attrsHtml += '</div></div>';\n              }\n              contentHtml = '<div class=\"acu-multi-attr-container\">' + attrsHtml + '</div>';\n            } else if (parsedAttrs.length === 1) {\n              //  ( \":92\") - \n              hideLabel = true;\n              const attr = parsedAttrs[0];\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml +=\n                '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\" data-locked=\"' +\n                isThisFieldLocked +\n                '\">' +\n                safeStr(attr.name) +\n                '</span>';\n              contentHtml += '<div style=\"display:flex;align-items:center;gap:6px;\">';\n              contentHtml += '<span style=\"color:var(--acu-text-main);font-weight:bold;\">' + attr.value + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(attr.name) +\n                  '\" data-attr-value=\"' +\n                  attr.value +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div></div>';\n            } else if (rawStr.length > 0 && splitRegex.test(rawStr) && !rawStr.includes('http')) {\n              // [] \n              const invalidTagValues = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n              const parts = rawStr\n                .split(splitRegex)\n                .map(s => s.trim())\n                .filter(s => s && !invalidTagValues.includes(s.toLowerCase()));\n              const allShort = parts.length > 1 && parts.every(p => p.length <= 6);\n              if (allShort) {\n                const tagsHtml = parts\n                  .map(part => {\n                    const subStyle = getBadgeStyle(part) || 'acu-badge-neutral';\n                    return '<span class=\"acu-badge ' + subStyle + '\">' + safeStr(part) + '</span>';\n                  })\n                  .join('');\n                contentHtml = '<div class=\"acu-tag-container\">' + tagsHtml + '</div>';\n              } else if (parts.length > 0) {\n                // \n                contentHtml = safeStr(parts.join('; '));\n              } else {\n                // \n                contentHtml = '';\n              }\n            } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n              // \n              const numVal = extractNumericValue(rawStr);\n              const showDice = !BlacklistManager.isBlacklisted(headerName);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml += '<span>' + safeStr(rawStr) + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(headerName) +\n                  '\" data-attr-value=\"' +\n                  numVal +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div>';\n            } else {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            }\n\n            const isDiffChanged = currentDiffMap.has(tableName + '-' + realRowIdx + '-' + cIdx);\n            const cellId = tableData.key + '-' + realRowIdx + '-' + cIdx;\n            const isUserModified = window.acuModifiedSet && window.acuModifiedSet.has(cellId);\n            let cellHighlight = '';\n            if (config.highlightNew) {\n              if (isUserModified) cellHighlight = 'acu-highlight-manual';\n              else if (isDiffChanged) cellHighlight = 'acu-highlight-diff';\n            }\n\n            //  class\n            //  ()\n\n            const rowClass =\n              'acu-card-row acu-cell' +\n              (spanFullRow ? ' acu-grid-span-full' : '') +\n              (hideLabel ? ' acu-hide-label' : '');\n\n            return (\n              '<div class=\"' +\n              rowClass +\n              '\" data-key=\"' +\n              escapeHtml(tableData.key) +\n              '\" data-tname=\"' +\n              escapeHtml(tableName) +\n              '\" data-row=\"' +\n              realRowIdx +\n              '\" data-col=\"' +\n              cIdx +\n              '\" data-val=\"' +\n              safeEncodeURIComponent(cell ?? '') +\n              '\"><div class=\"acu-card-label\"><span data-locked=\"' +\n              isThisFieldLocked +\n              '\">' +\n              headerName +\n              '</span></div><div class=\"acu-card-value ' +\n              cellHighlight +\n              '\">' +\n              contentHtml +\n              '</div></div>'\n            );\n          })\n          .join('');\n\n        // []  acu-card-body  view-grid  view-list \n        // []  tableData.headers  slice  headers getInteractOptionsForRow \n        const tableActions = getInteractOptionsForRow(tableName, tableData.headers, row);\n        let actionsHtml = '';\n\n        if (tableActions.length > 0) {\n          const cardTitle = row[titleColIndex] || '';\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // [] \n        const isTitleLocked = isCardRowLocked || isTitleCellLocked;\n\n        // [] \n        // const cardLockedClass = isCardRowLocked ? ' acu-card-locked' : '';\n\n        // bookmark\n        const cardBookmarkRowKey = getRowKey(tableName, row, tableData.headers);\n        const isBookmarked = cardBookmarkRowKey && BookmarkManager.isBookmarked(tableName, cardBookmarkRowKey);\n        const bookmarkIcon = cardBookmarkRowKey\n          ? `<i class=\"${isBookmarked ? 'fa-solid' : 'fa-regular'} fa-bookmark acu-bookmark-icon ${isBookmarked ? 'bookmarked' : ''}\" data-table=\"${escapeHtml(tableName)}\" data-row-key=\"${escapeHtml(cardBookmarkRowKey)}\" title=\"${isBookmarked ? '' : ''}\"></i>`\n          : '';\n\n        // [] \n        // const rowLockBadge = isCardRowLocked ? '...' : '';\n\n        return `<div class=\"acu-data-card\"><div class=\"acu-card-header\"><span class=\"acu-card-index\">${showDefaultIndex ? '#' + (realRowIdx + 1) : ''}</span><span class=\"acu-cell acu-editable-title ${rowClass}\" data-key=\"${escapeHtml(tableData.key)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${safeEncodeURIComponent(cardTitle ?? '')}\" data-locked=\"${isTitleLocked}\" title=\"\">${escapeHtml(cardTitleDisplay)}</span>${bookmarkIcon}</div><div class=\"acu-card-body ${isGridMode ? 'view-grid' : 'view-list'}\">${cardBody}</div>${actionsHtml}</div>`;\n      })\n      .join('');\n    html += `</div></div>`;\n\n    if (totalPages > 1) {\n      html += `<div class=\"acu-panel-footer\"><button class=\"acu-page-btn ${currentPage === 1 ? 'disabled' : ''}\" data-page=\"${currentPage - 1}\" ${currentPage === 1 ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-left\"></i></button>`;\n      const range = [];\n      if (totalPages <= 7) {\n        for (let i = 1; i <= totalPages; i++) range.push(i);\n      } else {\n        if (currentPage <= 4) range.push(1, 2, 3, 4, 5, '...', totalPages);\n        else if (currentPage >= totalPages - 3)\n          range.push(1, '...', totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1, totalPages);\n        else range.push(1, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages);\n      }\n      range.forEach(p => {\n        if (p === '...') html += `<span class=\"acu-page-info\">...</span>`;\n        else html += `<button class=\"acu-page-btn ${p === currentPage ? 'active' : ''}\" data-page=\"${p}\">${p}</button>`;\n      });\n      html += `<button class=\"acu-page-btn ${currentPage === totalPages ? 'disabled' : ''}\" data-page=\"${currentPage + 1}\" ${currentPage === totalPages ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-right\"></i></button></div>`;\n    }\n    return html;\n  };\n\n  // []  ( + )\n  const saveCurrentTabState = () => {\n    const { $ } = getCore();\n    const activeTab = getActiveTabState();\n    const $content = $('.acu-panel-content');\n\n    if (activeTab && $content.length) {\n      const innerScrolls = {};\n      // \n      $content.find('.acu-data-card, .acu-card-body, .acu-edit-textarea').each(function () {\n        if (this.scrollTop > 0) {\n          //  (Row Index)\n          const $card = $(this).closest('.acu-data-card');\n          const rIdx = $card.find('.acu-editable-title').data('row');\n          // \n          const isEdit = $(this).hasClass('acu-edit-textarea');\n\n          if (rIdx !== undefined) {\n            const key = isEdit ? `edit-${rIdx}` : rIdx;\n            innerScrolls[key] = this.scrollTop;\n          }\n        }\n      });\n\n      // \n      tableScrollStates[activeTab] = {\n        left: $content.scrollLeft(),\n        top: $content.scrollTop(),\n        inner: innerScrolls,\n        timestamp: Date.now(), // \n      };\n    }\n  };\n\n  const closePanel = () => {\n    const { $ } = getCore();\n    saveCurrentTabState(); // <--- \n\n    $('#acu-data-area').removeClass('visible');\n    $('.acu-nav-btn').removeClass('active');\n    saveActiveTabState(null);\n    // [] \n    // $('.acu-embedded-options-container').remove();\n  };\n\n  /**\n   *  - \n   * CSS opacity + visibility \n   * @param {Function} updateContentFn -  $panel \n   */\n  const switchPanel = updateContentFn => {\n    const { $ } = getCore();\n    const $panel = $('#acu-data-area');\n    const isVisible = $panel.hasClass('visible');\n\n    if (!isVisible) {\n      // \n      updateContentFn($panel);\n      $panel.addClass('visible');\n    } else {\n      // CSS transition \n      updateContentFn($panel);\n    }\n  };\n\n  const bindEvents = tables => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    // [] -\n    $wrapper.on('click', '.acu-dash-relation-graph-btn', function (e) {\n      e.stopPropagation();\n      const allTables = processJsonData(cachedRawData || getTableData());\n      const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n      if (npcResult && npcResult.data) {\n        showRelationshipGraph(npcResult.data);\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-map-btn', function (e) {\n      e.stopPropagation();\n      showMapVisualization();\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-avatar-manager-btn', function (e) {\n      e.stopPropagation();\n\n      try {\n        // \n        let allTables;\n        try {\n          const rawData = cachedRawData || getTableData();\n          allTables = processJsonData(rawData);\n        } catch (dataError) {\n          console.error(':', dataError);\n          throw new Error('');\n        }\n\n        if (!allTables || allTables.length === 0) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n        const playerResult = DashboardDataParser.findTable(allTables, 'player');\n\n        const nodeArr = [];\n\n        // \n        if (playerResult?.data?.rows?.[0]) {\n          const playerName = playerResult.data.rows[0][1];\n          if (playerName && typeof playerName === 'string' && playerName.trim()) {\n            nodeArr.push({ name: playerName.trim(), isPlayer: true });\n          }\n        }\n\n        // NPC\n        if (npcResult?.data?.rows && Array.isArray(npcResult.data.rows)) {\n          npcResult.data.rows.forEach((row, idx) => {\n            if (Array.isArray(row) && row[1]) {\n              const npcName = row[1];\n              if (typeof npcName === 'string' && npcName.trim()) {\n                nodeArr.push({ name: npcName.trim(), isPlayer: false, rowIndex: idx });\n              }\n            }\n          });\n        }\n\n        // \n        if (nodeArr.length === 0) {\n          if (window.toastr) {\n            window.toastr.warning('NPC');\n          }\n          return;\n        }\n\n        // \n        try {\n          showAvatarManager(nodeArr, () => renderInterface());\n        } catch (managerError) {\n          console.error('showAvatarManager :', managerError);\n          throw new Error('');\n        }\n      } catch (error) {\n        // \n        console.error(':', error);\n\n        // \n        const errorMsg = error instanceof Error ? error.message : '';\n        if (window.toastr) {\n          window.toastr.error(`: ${errorMsg}`);\n        }\n      }\n    });\n    // \n    $wrapper.off('click.acu_dash_table_link').on('click.acu_dash_table_link', '.acu-dash-table-link', function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      const tableName = $(this).data('table');\n      if (tableName) {\n        // \n        Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        Store.set('acu_changes_panel_active', false); // \n        // [] \n        $('.acu-nav-btn').removeClass('active');\n        $(`.acu-nav-btn[data-table=\"${tableName}\"]`).addClass('active');\n        saveActiveTabState(tableName);\n        setTimeout(() => renderInterface(), 0);\n      }\n    });\n\n    // []  SillyTavern\"\"\n    $('.acu-panel-content')\n      .off('touchstart.acu_swipe touchmove.acu_swipe')\n      .on('touchstart.acu_swipe', function (e) {\n        this._touchStartX = e.originalEvent.touches[0].clientX;\n        this._touchStartY = e.originalEvent.touches[0].clientY;\n      })\n      .on('touchmove.acu_swipe', function (e) {\n        if (!this._touchStartX) return;\n        const deltaX = Math.abs(e.originalEvent.touches[0].clientX - this._touchStartX);\n        const deltaY = Math.abs(e.originalEvent.touches[0].clientY - this._touchStartY);\n        // 45\n        if (deltaX > deltaY && deltaX > 10) {\n          e.stopPropagation();\n        }\n      });\n\n    $('body')\n      .off('click.acu_nav_toggle')\n      .on('click.acu_nav_toggle', '.acu-nav-toggle-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        const currentState = getCollapsedState();\n        saveCollapsedState(!currentState);\n        renderInterface();\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_opt_toggle')\n      .on('click.acu_opt_toggle', '.acu-opt-header[data-action=\"toggle-options\"]', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const currentState = getOptionsCollapsedState();\n        saveOptionsCollapsedState(!currentState);\n        renderInterface();\n      });\n\n    const $panel = $('.acu-panel-content');\n    if ($panel.length) {\n      // [] \n      let scrollTimer = null;\n      $panel.off('scroll.acu_save').on('scroll.acu_save', function () {\n        const $this = $(this);\n        if (scrollTimer) clearTimeout(scrollTimer);\n        scrollTimer = setTimeout(() => {\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            if (!tableScrollStates[activeTab]) tableScrollStates[activeTab] = { top: 0, left: 0, inner: {} };\n            tableScrollStates[activeTab].top = $this.scrollTop();\n            tableScrollStates[activeTab].left = $this.scrollLeft();\n            // \n          }\n        }, 200);\n      });\n    }\n\n    $('body')\n      .off('click.acu_delegate')\n      .on('click.acu_delegate', '.acu-wrapper', function (e) {\n        if (isEditingOrder) return;\n        const $target = $(e.target);\n\n        // []  - \n        const $settingsBtn = $target.closest('#acu-btn-settings');\n        if ($settingsBtn.length) {\n          e.stopPropagation();\n          e.preventDefault();\n          showSettingsModal();\n          return;\n        }\n\n        const $navBtn = $target.closest('.acu-nav-btn');\n        if ($navBtn.length) {\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-dashboard') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isDashboardActive && isPanelVisible) {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, true);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                const rawData = cachedRawData || getTableData();\n                const tables = processJsonData(rawData || {});\n                $panel.html(renderDashboard(tables));\n                bindEvents(tables);\n                loadDashboardNpcAvatars();\n              });\n            }\n            return false;\n          }\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-changes') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isChangesActive = Store.get('acu_changes_panel_active', false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isChangesActive && isPanelVisible) {\n              // \n              Store.set('acu_changes_panel_active', false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              clearAllPanelStates(); // [] \n              Store.set('acu_changes_panel_active', true);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                const rawData = cachedRawData || getTableData();\n                $panel.html(renderChangesPanel(rawData));\n                bindChangesEvents();\n              });\n            }\n            return false;\n          }\n          // []  - \n          if ($navBtn.attr('id') === 'acu-btn-favorites') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isFavoritesActive = Store.get('acu_favorites_panel_active', false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isFavoritesActive && isPanelVisible) {\n              // \n              Store.set('acu_favorites_panel_active', false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              clearAllPanelStates(); // [] \n              Store.set('acu_favorites_panel_active', true);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel(async $panel => {\n                $panel.html(await renderFavoritesPanel());\n                bindFavoritesEvents($panel);\n              });\n            }\n            return false;\n          }\n          // [] MVU\n          if ($navBtn.attr('id') === 'acu-btn-mvu') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isMvuActive && isPanelVisible) {\n              // \n              saveActiveTabState(null);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              clearAllPanelStates(); // [] \n              saveActiveTabState(MvuModule.MODULE_ID);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                try {\n                  const panelHtml = MvuModule.renderPanel();\n                  // \n                  const mvuSavedHeight = getTableHeights()[MvuModule.MODULE_ID];\n                  if (mvuSavedHeight) {\n                    $panel.css('height', mvuSavedHeight + 'px').addClass('acu-manual-mode');\n                  } else {\n                    $panel.css('height', '').removeClass('acu-manual-mode');\n                  }\n                  $panel.html('<div class=\"acu-mvu-panel\">' + panelHtml + '</div>');\n                  MvuModule.bindEvents($panel);\n                } catch (error) {\n                  console.error('[MVU] Error rendering panel:', error);\n                }\n\n                // \n                MvuModule.getDataWithRetry(5, 800)\n                  .then(mvuData => {\n                    // \n                    if (mvuData && canWriteMvuPanel()) {\n                      $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                      MvuModule.bindEvents($panel);\n                    }\n                  })\n                  .catch(err => {\n                    console.error('[DICE]MvuModule Error getting data:', err);\n                    if (canWriteMvuPanel()) {\n                      // \n                      $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                      MvuModule.bindEvents($panel);\n                    }\n                  });\n              });\n            }\n            return false;\n          }\n          e.stopPropagation();\n          const tableName = $navBtn.data('table');\n          const currentActiveTab = getActiveTabState();\n          if (currentActiveTab === tableName && $('#acu-data-area').hasClass('visible')) {\n            closePanel();\n            return;\n          }\n          // [] \n          clearAllPanelStates();\n          $('.acu-nav-btn').removeClass('active');\n          $navBtn.addClass('active');\n          if ($('.acu-panel-content').length && currentActiveTab) {\n            saveCurrentTabState();\n          }\n          saveActiveTabState(tableName);\n          setTimeout(() => renderInterface(), 0);\n          return;\n        }\n        const $cell = $target.closest('.acu-cell');\n        if ($cell.length) {\n          e.stopPropagation();\n          showCellMenu(e, $cell[0]);\n          return;\n        }\n        const $pageBtn = $target.closest('.acu-page-btn');\n        if ($pageBtn.length) {\n          e.stopPropagation();\n          if ($pageBtn.hasClass('disabled') || $pageBtn.hasClass('active')) return;\n          const newPage = parseInt($pageBtn.data('page'));\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tablePageStates[activeTab] = newPage;\n            renderInterface();\n            requestAnimationFrame(() => {\n              $('.acu-panel-content').scrollTop(0);\n            });\n          }\n          return;\n        }\n        return;\n      });\n\n    $('#acu-btn-expand')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(false);\n        renderInterface();\n      });\n    // [] \n    $('#acu-btn-collapse')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(true);\n        renderInterface();\n      });\n\n    // \n    $('#acu-btn-open-visualizer')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n\n        // -\n        const topWin = window.parent || window;\n        if (topWin.AutoCardUpdaterAPI && typeof topWin.AutoCardUpdaterAPI.openVisualizer === 'function') {\n          topWin.AutoCardUpdaterAPI.openVisualizer();\n        } else {\n          // \n          if (typeof (topWin as any).openNewVisualizer_ACU === 'function') {\n            (topWin as any).openNewVisualizer_ACU();\n          } else {\n            if (window.toastr) {\n              window.toastr.warning('-');\n            }\n          }\n        }\n      });\n\n    // [] \n    $('#acu-btn-force-update')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          if (window.toastr) {\n            window.toastr.warning('  manualUpdate ', '', {\n              timeOut: 5000,\n            });\n          }\n        }\n      });\n    $('body')\n      .off('click.acu_settings')\n      .on('click.acu_settings', '#acu-btn-settings', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        showSettingsModal();\n      });\n    // [] \n    $('#acu-btn-dice-nav')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        showDicePanel({\n          targetValue: null,\n          targetName: '', //  placeholder \n          //  diceType\n        });\n      });\n\n    // -\n    $('#acu-btn-open-editor')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.openSettings === 'function') {\n          api.openSettings(); // /\n        } else if (window.toastr) {\n          window.toastr.warning('()');\n        }\n      });\n\n    // \n    $('#acu-btn-refill')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            console.log('[DICE]ACU ');\n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          console.warn('[DICE]ACU manualUpdate API ');\n          if (window.toastr) {\n            window.toastr.warning(' manualUpdate ', '', { timeOut: 3000 });\n          }\n        }\n      });\n    $('#acu-btn-save-global')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        let dataToSave = null;\n        if (hasUnsavedChanges && cachedRawData) {\n          dataToSave = cachedRawData;\n        } else {\n          dataToSave = getTableData();\n        }\n\n        if (dataToSave) {\n          // 1.  false  true\n          await saveDataToDatabase(dataToSave, true, true);\n\n          // 2. \n          // \n          $('.acu-highlight-manual').removeClass('acu-highlight-manual');\n\n          // 3. \n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          hasUnsavedChanges = false;\n\n          // 4. \n          const $btn = $(this);\n          const $icon = $btn.find('i');\n          $icon.removeClass('acu-icon-breathe fa-spinner fa-spin').addClass('fa-save');\n          $btn.attr('title', '').css('color', '');\n          $btn.prop('disabled', false);\n\n          // 5. \n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    const $searchInput = $('.acu-search-input');\n    if ($searchInput.length) {\n      let searchTimeout;\n      let isComposing = false;\n      $searchInput\n        .off('compositionstart compositionend input')\n        .on('compositionstart', () => {\n          isComposing = true;\n        })\n        .on('compositionend', function () {\n          isComposing = false;\n          const val = $(this).val();\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tableSearchStates[activeTab] = val;\n            tablePageStates[activeTab] = 1;\n            renderInterface();\n            setTimeout(() => {\n              $('.acu-search-input').focus();\n            }, 0);\n          }\n        })\n        .on('input', function () {\n          if (isComposing) return;\n          const val = $(this).val();\n          const selectionStart = this.selectionStart;\n          const selectionEnd = this.selectionEnd;\n          clearTimeout(searchTimeout);\n          searchTimeout = setTimeout(() => {\n            const activeTab = getActiveTabState();\n            if (activeTab) {\n              tableSearchStates[activeTab] = val;\n              tablePageStates[activeTab] = 1;\n              const isFocus = document.activeElement && document.activeElement.classList.contains('acu-search-input');\n              renderInterface();\n              if (isFocus) {\n                const $newInput = $('.acu-search-input');\n                $newInput.focus();\n                if ($newInput.length && $newInput[0].setSelectionRange) {\n                  try {\n                    $newInput[0].setSelectionRange(selectionStart, selectionEnd);\n                  } catch (e) {}\n                }\n              }\n            }\n          }, 300);\n        });\n    }\n    // \n    $('#acu-btn-relation-graph')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const rawData = cachedRawData || getTableData();\n        if (rawData) {\n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (sheet?.name === tableName) {\n              const tableData = {\n                headers: sheet.content?.[0] || [],\n                rows: sheet.content?.slice(1) || [],\n                key: key,\n              };\n              showRelationshipGraph(tableData);\n              return;\n            }\n          }\n        }\n        if (window.toastr) window.toastr.warning('');\n      });\n    // \n    $('.acu-table-map-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        showMapVisualization();\n      });\n    // --- []  ---\n\n    // 1. \n    $('#acu-btn-switch-style')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const styles = getTableStyles();\n        const current = styles[tableName] || 'list';\n        styles[tableName] = current === 'grid' ? 'list' : 'grid'; // \n        saveTableStyles(styles);\n        renderInterface(); // \n      });\n\n    // 2. \n    $('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          if (tableName) {\n            const heights = getTableHeights();\n            heights[tableName] = parseInt($panel.css('height'));\n            saveTableHeights(heights);\n            $panel.addClass('acu-manual-mode');\n          }\n        };\n      });\n\n    // 3.  - \n    $('.acu-height-drag-handle')\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    // [] \n    $wrapper.on('click', '.acu-reverse-btn', function (e) {\n      e.stopPropagation();\n      const tName = $(this).data('table');\n      if (!tName) return;\n\n      toggleTableReverse(tName);\n\n      // \n      renderInterface();\n    });\n    // [] \n    $('.acu-panel-header')\n      .off('dblclick.acu')\n      .on('dblclick.acu', function (e) {\n        if ($(e.target).closest('.acu-search-input, .acu-close-btn, .acu-view-btn').length) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = getActiveTabState();\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    $wrapper\n      .find('.acu-close-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $input = $('.acu-search-input');\n\n        // \n        if ($input.length && $input.val()) {\n          $input.val('').trigger('input').focus();\n          return;\n        }\n\n        // \n        const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        if (isDashboardActive) {\n          // \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n        if (isMvuActive) {\n          // \n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        closePanel();\n      });\n    // [] bookmark\n    $('body')\n      .off('click.acu_bookmark')\n      .on('click.acu_bookmark', '.acu-bookmark-icon', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $icon = $(this);\n        const tableName = $icon.data('table');\n        const rowKey = $icon.data('row-key');\n\n        if (!tableName || !rowKey) return;\n\n        // bookmark\n        BookmarkManager.toggleBookmark(tableName, rowKey);\n\n        // \n        if (typeof renderInterface === 'function') {\n          renderInterface();\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_action')\n      .on('click.acu_action', '.acu-action-item', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $btn = $(this);\n        const rowIdx = parseInt($btn.data('row'), 10);\n        const actionIdx = parseInt($btn.data('action-idx'), 10);\n\n        // \n        const $card = $btn.closest('.acu-data-card');\n        const $title = $card.find('.acu-editable-title');\n        const tableKey = $title.data('key');\n        const tableName = $title.data('tname') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const headers = rawData[tableKey].content[0] || [];\n        const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n\n        // []  + AI\n        const actions = getInteractOptionsForRow(tableName, headers, rowData);\n\n        const action = actions[actionIdx];\n\n        // [] \n        if (action && action.type === 'skill_check') {\n          const skillName = rowData[1] || '';\n\n          // \n          let checkValue = null;\n          const attrValIdx = headers.findIndex(h => h && h.includes(''));\n          const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n          // \n          if (attrValIdx > 0 && rowData[attrValIdx]) {\n            const val = extractNumericValue(rowData[attrValIdx]);\n            if (val > 0) checkValue = val;\n          }\n          // \n          if (checkValue === null && profIdx > 0 && rowData[profIdx]) {\n            const val = extractNumericValue(rowData[profIdx]);\n            if (val > 0) checkValue = val;\n          }\n\n          // \n          const promptText = processTemplate(action.template, rowData, headers);\n          smartInsertToTextarea(promptText, 'action');\n\n          // \n          if (checkValue !== null && checkValue > 0) {\n            showDicePanel({\n              attrValue: checkValue,\n              targetValue: null,\n              targetName: skillName,\n              initiatorName: '<user>',\n            });\n          } else {\n            $('#send_textarea').focus();\n          }\n          return;\n        }\n\n        if (action && action.template) {\n          // \n          const rawData = cachedRawData || getTableData();\n          if (rawData && rawData[tableKey]) {\n            const headers = rawData[tableKey].content[0] || [];\n            const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n            const npcName = rowData[1] || '';\n\n            // \"\"\n            if (action.label === '') {\n              const config = getConfig();\n              $('.acu-msg-overlay').remove();\n\n              const overlay = $(`\n                        <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:31200;display:flex;justify-content:center;align-items:center;\">\n                            <div style=\"background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                                <div style=\"font-size:14px;font-weight:bold;color:var(--acu-accent);margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                                    <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                                </div>\n                                <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:var(--acu-input-bg) !important;border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main) !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                                <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                                    <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:var(--acu-input-bg);border:1px solid var(--acu-text-sub);border-radius:6px;color:var(--acu-text-main);cursor:pointer;\"></button>\n                                    <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:var(--acu-btn-active-bg);border:none;border-radius:6px;color:var(--acu-btn-active-text);cursor:pointer;font-weight:bold;\"></button>\n                                </div>\n                            </div>\n                        </div>\n                    `);\n\n              $('body').append(overlay);\n              // []  JS  overlay \n              const overlayEl = overlay[0];\n              overlayEl.style.setProperty('position', 'fixed', 'important');\n              overlayEl.style.setProperty('top', '0', 'important');\n              overlayEl.style.setProperty('left', '0', 'important');\n              overlayEl.style.setProperty('right', '0', 'important');\n              overlayEl.style.setProperty('bottom', '0', 'important');\n              overlayEl.style.setProperty('width', '100vw', 'important');\n              overlayEl.style.setProperty('height', '100vh', 'important');\n              overlayEl.style.setProperty('display', 'flex', 'important');\n              overlayEl.style.setProperty('justify-content', 'center', 'important');\n              overlayEl.style.setProperty('align-items', 'center', 'important');\n              overlayEl.style.setProperty('z-index', '31100', 'important');\n              setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n              const sendMessage = () => {\n                const msg = overlay.find('#acu-msg-input').val().trim();\n                if (msg) {\n                  const promptText = `<user>${npcName}\"${msg}\"`;\n                  smartInsertToTextarea(promptText, 'action');\n                  $('#send_textarea').focus();\n                }\n                overlay.remove();\n              };\n\n              overlay.find('#acu-msg-send').click(sendMessage);\n              overlay.find('#acu-msg-input').on('keydown', function (ev) {\n                if (ev.key === 'Enter') {\n                  ev.preventDefault();\n                  sendMessage();\n                }\n              });\n              overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n              setupOverlayClose(overlay, 'acu-msg-overlay', () => overlay.remove());\n              return;\n            }\n\n            //  processTemplate \n            const promptText = processTemplate(action.template, rowData, headers);\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_global_dice')\n      .on('click.acu_global_dice', '#acu-btn-dice', function (e) {\n        e.stopPropagation();\n        showDicePanel({\n          targetValue: 50,\n          targetName: '',\n          diceType: '1d100',\n        });\n      });\n    // ========== [] ==========\n    // /\n    $('body')\n      .off('click.acu_location_toggle')\n      .on('click.acu_location_toggle', '.acu-location-header', function (e) {\n        e.stopPropagation();\n        const $group = $(this).closest('.acu-location-group');\n        $group.toggleClass('expanded');\n      });\n\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_jump')\n      .on('click.acu_dash_jump', '.acu-dash-jump-link, .acu-dash-loc-item', function (e) {\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const searchTerm = $(this).data('search') || '';\n\n        if (tableName) {\n          // 1. \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n\n          // 2. \n          saveActiveTabState(tableName);\n\n          // 3. \n          if (searchTerm) {\n            tableSearchStates[tableName] = searchTerm;\n            tablePageStates[tableName] = 1;\n          }\n\n          // 4. \n          renderInterface();\n\n          // 5. \n          if (searchTerm) {\n            setTimeout(() => {\n              const $input = $('.acu-search-input');\n              if ($input.length) $input.focus();\n            }, 100);\n          }\n        }\n      });\n    // ========== [] ==========\n    // [] \n    $('body')\n      .off('click.acu_inline_dice')\n      .on('click.acu_inline_dice', '.acu-inline-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        //  .attr()  jQuery \n        const attrName = $(this).attr('data-attr-name') || '';\n        const attrValue = parseInt($(this).attr('data-attr-value'), 10) || 50;\n\n        // NPC\n        const $card = $(this).closest('.acu-data-card');\n        const cardTitle = $card.find('.acu-editable-title').text().trim();\n\n        // <user>\n        const tableName = $card.find('.acu-editable-title').data('tname') || '';\n        const isPlayerTable = tableName.includes('');\n        const initiatorName = isPlayerTable ? '<user>' : cardTitle;\n\n        showDicePanel({\n          attrValue: attrValue,\n          targetValue: null, // showDicePanel\n          targetName: attrName,\n          initiatorName: initiatorName,\n          //  diceType\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_dice')\n      .on('click.acu_dash_dice', '.acu-dash-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const targetValue = parseInt($(this).data('target'), 10) || 50;\n        const targetName = $(this).data('name') || '';\n        const npcName = $(this).data('npc') || '';\n\n        // NPC\n        if (npcName) {\n          // \n          const playerAttrValue = getAttributeValue('<user>', targetName) || 50;\n          showContestPanel({\n            initiatorName: '<user>',\n            initiatorValue: playerAttrValue,\n            opponentName: npcName,\n            opponentValue: targetValue,\n          });\n        } else {\n          showDicePanel({\n            attrValue: targetValue,\n            targetValue: null,\n            targetName: targetName,\n            initiatorName: '<user>',\n          });\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_goto')\n      .on('click.acu_dash_goto', '.acu-dash-goto-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const locationName = $(this).data('location') || '';\n        const promptText = `<user>${locationName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_use_item')\n      .on('click.acu_dash_use_item', '.acu-dash-use-item-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const itemName = $(this).data('item') || '';\n        const promptText = `<user>${itemName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\" - \n    $('body')\n      .off('click.acu_dash_use_skill')\n      .on('click.acu_dash_use_skill', '.acu-dash-use-skill-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const skillName = $(this).data('skill') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        let checkValue = null;\n\n        if (rawData) {\n          // \n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n            if (sheet.name.includes('') || sheet.name.includes('')) {\n              const headers = sheet.content[0] || [];\n              // \n              const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n              const attrValIdx = headers.findIndex(h => h && h.includes(''));\n              const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n              for (let i = 1; i < sheet.content.length; i++) {\n                const row = sheet.content[i];\n                if (row && row[nameIdx === -1 ? 1 : nameIdx] === skillName) {\n                  // \n                  if (attrValIdx > 0 && row[attrValIdx]) {\n                    const val = extractNumericValue(row[attrValIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  // \n                  if (profIdx > 0 && row[profIdx]) {\n                    const val = extractNumericValue(row[profIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n              if (checkValue !== null) break;\n            }\n          }\n        }\n\n        // \n        const promptText = `<user>${skillName}`;\n        smartInsertToTextarea(promptText, 'action');\n\n        // \n        if (checkValue !== null && checkValue > 0) {\n          showDicePanel({\n            attrValue: checkValue,\n            targetValue: null,\n            targetName: skillName,\n            initiatorName: '<user>',\n          });\n        } else {\n          // \n          $('#send_textarea').focus();\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_track_task')\n      .on('click.acu_dash_track_task', '.acu-dash-track-task-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const taskName = $(this).data('task') || '';\n        const promptText = `<user>${taskName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_msg')\n      .on('click.acu_dash_msg', '.acu-dash-msg-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n        const config = getConfig();\n\n        // \n        $('.acu-msg-overlay').remove();\n\n        const overlay = $(`\n            <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:31200;display:flex;justify-content:center;align-items:center;\">\n                <div class=\"acu-msg-dialog\" style=\"background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                    <div style=\"font-size:14px;font-weight:bold;color:var(--acu-accent);margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                        <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                    </div>\n                    <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:var(--acu-input-bg) !important;border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main) !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                    <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                        <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:var(--acu-input-bg);border:1px solid var(--acu-text-sub);border-radius:6px;color:var(--acu-text-main);cursor:pointer;\"></button>\n                        <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:var(--acu-btn-active-bg);border:none;border-radius:6px;color:var(--acu-btn-active-text);cursor:pointer;font-weight:bold;\"></button>\n                    </div>\n                </div>\n            </div>\n        `);\n\n        $('body').append(overlay);\n        const overlayEl = overlay[0];\n        overlayEl.style.setProperty('position', 'fixed', 'important');\n        overlayEl.style.setProperty('top', '0', 'important');\n        overlayEl.style.setProperty('left', '0', 'important');\n        overlayEl.style.setProperty('right', '0', 'important');\n        overlayEl.style.setProperty('bottom', '0', 'important');\n        overlayEl.style.setProperty('width', '100vw', 'important');\n        overlayEl.style.setProperty('height', '100vh', 'important');\n        overlayEl.style.setProperty('display', 'flex', 'important');\n        overlayEl.style.setProperty('justify-content', 'center', 'important');\n        overlayEl.style.setProperty('align-items', 'center', 'important');\n        overlayEl.style.setProperty('z-index', '31100', 'important');\n        setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n        const sendMessage = () => {\n          const msg = overlay.find('#acu-msg-input').val().trim();\n          if (msg) {\n            const promptText = `<user>${npcName}\"${msg}\"`;\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n          overlay.remove();\n        };\n\n        // \n        overlay.find('#acu-msg-send').click(sendMessage);\n\n        // \n        overlay.find('#acu-msg-input').on('keydown', function (ev) {\n          if (ev.key === 'Enter') {\n            ev.preventDefault();\n            sendMessage();\n          }\n        });\n\n        // \n        overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n        setupOverlayClose(overlay, 'acu-msg-overlay', () => overlay.remove());\n      });\n    // [] NPC\n    $('body')\n      .off('click.acu_dash_contest')\n      .on('click.acu_dash_contest', '.acu-dash-contest-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n\n        const rawData = cachedRawData || getTableData();\n\n        var playerAttrValue = 50;\n        var npcAttrValue = 50;\n        var foundPlayer = false;\n        var foundNPC = false;\n\n        if (rawData) {\n          for (var key in rawData) {\n            var sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n\n            // \n            if (sheet.name?.includes('')) {\n              if (sheet.content[1]) {\n                var attrStr = sheet.content[1][7] || '';\n                var parts = attrStr.split(/[,;\\s]+/);\n                for (var i = 0; i < parts.length; i++) {\n                  var match = parts[i].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                  if (match) {\n                    playerAttrValue = parseInt(match[2], 10);\n                    foundPlayer = true;\n                    break;\n                  }\n                }\n              }\n            }\n\n            // \n            if (isNpcTableName(sheet.name) && npcName) {\n              for (var j = 1; j < sheet.content.length; j++) {\n                var row = sheet.content[j];\n                if (row && row[1] === npcName) {\n                  var npcAttrStr = row[9] || '';\n                  var npcParts = npcAttrStr.split(/[,;\\s]+/);\n                  for (var k = 0; k < npcParts.length; k++) {\n                    var npcMatch = npcParts[k].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                    if (npcMatch) {\n                      npcAttrValue = parseInt(npcMatch[2], 10);\n                      foundNPC = true;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n            }\n          }\n        }\n\n        showContestPanel({\n          initiatorName: '<user>',\n          initiatorValue: playerAttrValue,\n          opponentName: npcName,\n          opponentValue: npcAttrValue,\n          diceType: '1d100',\n        });\n      });\n\n    // [] \n    //  $('body')  $(document) iframe \n    $('body')\n      .off('click.acu_preview_cell_menu')\n      .on('click.acu_preview_cell_menu', '.acu-preview-overlay .acu-cell', function (e) {\n        console.log('[DICE] preview cell click triggered', this, $(this).data());\n        // \n        if ($(e.target).closest('.acu-preview-close').length) return;\n\n        const $this = $(this);\n        const existingMenu = $('.acu-cell-menu');\n\n        // [] Toggle \n        if (existingMenu.length) {\n          const menuCellId = existingMenu.data('cell-id');\n          const thisCellId = `${$this.data('key')}-${$this.data('row')}-${$this.data('col')}`;\n          if (menuCellId === thisCellId) {\n            $('.acu-cell-menu, .acu-menu-backdrop').remove();\n            return;\n          }\n        }\n\n        e.stopPropagation();\n        e.preventDefault();\n        showCellMenu(e, this);\n\n        // ID toggle \n        const cellId = `${$this.data('key')}-${$this.data('row')}-${$this.data('col')}`;\n        $('.acu-cell-menu').data('cell-id', cellId);\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_dash_preview')\n      .on('click.acu_dash_preview', '.acu-dash-preview-trigger', function (e) {\n        e.stopPropagation();\n\n        const tableKey = $(this).data('table-key');\n        const rowIndex = parseInt($(this).data('row-index'), 10);\n\n        if (!tableKey || isNaN(rowIndex)) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const table = rawData[tableKey];\n        const tableName = table.name || '';\n        const headers = table.content[0] || [];\n        const rowData = table.content[rowIndex + 1];\n\n        if (!rowData) return;\n\n        const config = getConfig();\n        const title = rowData[1] || '';\n        const titleDisplay = isCharacterTable(tableName) ? getDisplayName(String(title)) : String(title);\n\n        //  renderTableContent \n        const titleColIndex = 1;\n        const realRowIdx = rowIndex;\n\n        // [] -API\n        const dbLockApi = getDbLockAPI();\n        const sheetKey = dbLockApi ? getSheetKeyByTableName(tableName) : null;\n        const lockState = dbLockApi && sheetKey ? dbLockApi.getTableLockState(sheetKey) : null;\n\n        // [] \n        const lockRowKey = getRowKey(tableName, rowData, headers);\n        const dbRowIndex = sheetKey && lockRowKey ? findRowIndexByPrimaryKey(sheetKey, tableName, lockRowKey) : null;\n        const isCardRowLocked =\n          lockState && dbRowIndex !== null ? (lockState.rows?.includes(dbRowIndex) ?? false) : false;\n\n        // [] \n        const isTitleLocked =\n          isCardRowLocked ||\n          (lockState && dbRowIndex !== null\n            ? (lockState.cells?.includes(`${dbRowIndex}:${titleColIndex - 1}`) ?? false)\n            : false);\n\n        // \n        let cardBody = '';\n        rowData.forEach((cell, cIdx) => {\n          if (cIdx <= 0 || cIdx === titleColIndex) return;\n          const currentHeader = headers[cIdx] || '';\n          if (currentHeader.includes('')) return; // \n\n          // /\n          const headerName = (headers[cIdx] || '' + cIdx).replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n          const rawStr = String(cell || '').trim();\n          if (!rawStr) return;\n\n          // [] \n          // [] cIdx - colIndex  -1\n          const isThisCellLocked =\n            lockState && dbRowIndex !== null\n              ? (lockState.cells?.includes(`${dbRowIndex}:${cIdx - 1}`) ?? false)\n              : false;\n          const isThisFieldLocked = isCardRowLocked || isThisCellLocked;\n\n          let contentHtml = '';\n          let hideLabel = false;\n\n          const parsedAttrs = parseAttributeString(rawStr);\n          // [] \n          if (isRelationshipCell(rawStr, headerName)) {\n            const relations = parseRelationshipString(rawStr);\n            if (relations.length > 1) {\n              hideLabel = true;\n              let relHtml = '';\n              relations.forEach((rel, i) => {\n                const borderStyle = i < relations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                relHtml += `<div style=\"display:flex;justify-content:flex-start;align-items:center;gap:8px;padding:3px 0;${borderStyle}\">\n                              <span style=\"color:var(--acu-text-sub);font-size:0.95em;\" data-locked=\"${isThisFieldLocked}\">${escapeHtml(rel.name)}</span>\n                              ${rel.relation ? `<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>` : ''}\n                          </div>`;\n              });\n              contentHtml = `<div class=\"acu-relation-container\">${relHtml}</div>`;\n            } else if (relations.length === 1 && relations[0].relation) {\n              hideLabel = true; // [] \n              const rel = relations[0];\n              contentHtml = `<div style=\"display:flex;justify-content:flex-start;align-items:center;gap:8px;\">\n                          <span style=\"color:var(--acu-text-sub);\" data-locked=\"${isThisFieldLocked}\">${escapeHtml(rel.name)}</span>\n                          <span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>\n                      </div>`;\n            }\n          } else if (parsedAttrs.length > 1) {\n            hideLabel = true;\n            let attrsHtml = '';\n            parsedAttrs.forEach((attr, i) => {\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              const borderStyle = i < parsedAttrs.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n              attrsHtml += `<div style=\"display:flex;justify-content:space-between;align-items:center;padding:3px 0;${borderStyle}\">\n                          <span style=\"color:var(--acu-text-sub);font-size:0.95em;\" data-locked=\"${isThisFieldLocked}\">${escapeHtml(attr.name)}</span>\n                          <div style=\"display:flex;align-items:center;gap:6px;\">\n                              <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                              ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                          </div></div>`;\n            });\n            contentHtml = `<div class=\"acu-multi-attr-container\">${attrsHtml}</div>`;\n          } else if (parsedAttrs.length === 1) {\n            hideLabel = true;\n            const attr = parsedAttrs[0];\n            const showDice = !BlacklistManager.isBlacklisted(attr.name);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                      <span style=\"color:var(--acu-text-sub);font-size:0.95em;\" data-locked=\"${isThisFieldLocked}\">${escapeHtml(attr.name)}</span>\n                      <div style=\"display:flex;align-items:center;gap:6px;\">\n                          <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                          ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                      </div></div>`;\n          } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n            const numVal = extractNumericValue(rawStr);\n            const showDice = !BlacklistManager.isBlacklisted(headerName);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                      <span>${escapeHtml(rawStr)}</span>\n                      ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(headerName)}\" data-attr-value=\"${numVal}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;margin-left:6px;\" title=\"\"></i>` : ''}\n                  </div>`;\n          } else {\n            const badgeStyle = getBadgeStyle(rawStr);\n            contentHtml = badgeStyle\n              ? `<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(rawStr)}</span>`\n              : escapeHtml(rawStr);\n          }\n\n          const rowClass = 'acu-card-row acu-cell' + (hideLabel ? ' acu-hide-label' : '');\n          cardBody += `<div class=\"${rowClass}\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${cIdx}\" data-val=\"${safeEncodeURIComponent(cell ?? '')}\">\n                <div class=\"acu-card-label\"><span data-locked=\"${isThisFieldLocked}\">${escapeHtml(headerName)}</span></div>\n                <div class=\"acu-card-value\">${contentHtml}</div>\n            </div>`;\n        });\n\n        // []  + AI\n        // [] \n        const tableActions = getInteractOptionsForRow(tableName, headers, rowData);\n        let actionsHtml = '';\n        if (tableActions.length > 0) {\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardHtml = `\n            <div class=\"acu-preview-overlay acu-theme-${config.theme}\" style=\"--acu-card-width:${config.cardWidth}px;--acu-font-size:${config.fontSize}px;\">\n                <div class=\"acu-data-card\" style=\"width:90vw;max-width:420px;max-height:85vh;overflow-y:auto;\">\n                    <div class=\"acu-card-header\">\n                        <span class=\"acu-card-index\">#${realRowIdx + 1}</span>\n                    <span class=\"acu-cell acu-editable-title\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${safeEncodeURIComponent(title)}\" data-locked=\"${isTitleLocked}\">${escapeHtml(titleDisplay)}</span>\n                        <button class=\"acu-preview-close\" style=\"margin-left:auto;background:none;border:none;color:var(--acu-text-sub);cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-card-body view-list\">${cardBody}</div>\n                    ${actionsHtml}\n                </div>\n            </div>\n        `;\n\n        $('.acu-preview-overlay').remove();\n        $('body').append(cardHtml);\n\n        // \n        const overlayEl = $('.acu-preview-overlay')[0];\n        if (overlayEl) {\n          overlayEl.style.setProperty('position', 'fixed', 'important');\n          overlayEl.style.setProperty('top', '0', 'important');\n          overlayEl.style.setProperty('left', '0', 'important');\n          overlayEl.style.setProperty('right', '0', 'important');\n          overlayEl.style.setProperty('bottom', '0', 'important');\n          overlayEl.style.setProperty('width', '100vw', 'important');\n          overlayEl.style.setProperty('height', '100vh', 'important');\n          overlayEl.style.setProperty('display', 'flex', 'important');\n          overlayEl.style.setProperty('justify-content', 'center', 'important');\n          overlayEl.style.setProperty('align-items', 'center', 'important');\n        }\n\n        // \n        const $previewOverlay = $('.acu-preview-overlay');\n        setupOverlayClose($previewOverlay, 'acu-preview-overlay', () => $previewOverlay.remove());\n        $previewOverlay.on('click', function (ev) {\n          if ($(ev.target).closest('.acu-preview-close').length) {\n            $(this).remove();\n          }\n        });\n      });\n\n    // === []  ST  swipe regenerate ===\n    (function () {\n      const $doc = $(document);\n      let touchStartX = 0;\n      let touchStartY = 0;\n\n      //  data-area\n      $doc.on('touchstart.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length === 1) {\n          touchStartX = e.originalEvent.touches[0].clientX;\n          touchStartY = e.originalEvent.touches[0].clientY;\n        }\n      });\n\n      $doc.on('touchmove.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length !== 1) return;\n\n        const touch = e.originalEvent.touches[0];\n        const deltaX = Math.abs(touch.clientX - touchStartX);\n        const deltaY = Math.abs(touch.clientY - touchStartY);\n\n        // X > Y * 1.5\n        if (deltaX > deltaY * 1.5 && deltaX > 10) {\n          e.stopPropagation();\n          console.log('[DICE]ACU  ST swipe');\n        }\n      });\n    })();\n  };\n\n  let selectedSwapSource = null;\n  const toggleOrderEditMode = () => {\n    const { $ } = getCore();\n    isEditingOrder = !isEditingOrder;\n\n    const $container = $('#acu-nav-bar');\n    const $hint = $('#acu-order-hint');\n    const $pool = $('#acu-action-pool');\n\n    // \n    if (!$container.length) {\n      console.error('[DICE]ACU ');\n      isEditingOrder = false;\n      return;\n    }\n\n    selectedSwapSource = null;\n    $('.acu-swap-selected').removeClass('acu-swap-selected');\n\n    if (isEditingOrder) {\n      // \n      $container.addClass('editing-order');\n      if ($pool.length) $pool.addClass('visible');\n\n      if ($hint.length) {\n        $hint\n          .html(\n            `\n                    <div style=\"display:flex; justify-content:space-between; align-items:center; width:100%; flex-wrap:wrap; gap:8px;\">\n                        <div style=\"display:flex; align-items:center; gap:10px; flex:1; min-width:200px;\">\n                            <span><i class=\"fa-solid fa-layer-group\"></i> </span>\n                            <span style=\"font-size:11px; opacity:0.9; font-weight:normal;\"></span>\n                        </div>\n                        <button id=\"acu-btn-finish-sort\" class=\"acu-btn-finish-sort\">>\n                            <i class=\"fa-solid fa-check\"></i> \n                        </button>\n                    </div>\n                `,\n          )\n          .addClass('visible')\n          .css('display', 'flex');\n\n        $('#acu-btn-finish-sort').hover(\n          function () {\n            $(this).addClass('hover');\n          },\n          function () {\n            $(this).removeClass('hover');\n          },\n        );\n\n        $('#acu-btn-finish-sort')\n          .off('click')\n          .on('click', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            toggleOrderEditMode();\n          });\n      }\n\n      // \n      $('#acu-data-area').removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn').not('#acu-btn-dashboard, #acu-btn-dice-nav').attr('draggable', 'true');\n      $container.find('.acu-action-btn').attr('draggable', 'true');\n\n      // \n      initSortable();\n    } else {\n      // \n      $container.removeClass('editing-order');\n      if ($hint.length) $hint.removeClass('visible').hide();\n      if ($pool.length) $pool.removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn, .acu-action-btn').attr('draggable', 'false');\n      $('.acu-nav-btn, .acu-action-btn').off('.sort');\n      $('#acu-action-pool, #acu-active-actions').off('.sort');\n\n      // \n      const newTableOrder = [];\n      $container.find('.acu-nav-btn[data-table]').each(function () {\n        const tableName = $(this).data('table');\n        if (tableName) {\n          newTableOrder.push(tableName);\n        }\n      });\n      if (newTableOrder.length > 0) {\n        saveTableOrder(newTableOrder);\n      }\n\n      // \n      const newActionOrder = [];\n      $('#acu-active-actions .acu-action-btn').each(function () {\n        const btnId = $(this).attr('id');\n        if (btnId) {\n          newActionOrder.push(btnId);\n        }\n      });\n\n      // \n      if (!newActionOrder.includes('acu-btn-settings')) {\n        newActionOrder.push('acu-btn-settings');\n      }\n\n      Store.set(STORAGE_KEY_ACTION_ORDER, newActionOrder);\n\n      // \n      renderInterface();\n    }\n  };\n\n  const initSortable = () => {\n    const { $ } = getCore();\n    let $dragSrcEl = null;\n\n    // \n    $('.acu-nav-btn, .acu-action-btn, #acu-action-pool, #acu-active-actions').off('.sort');\n\n    // --- 1.  () ---\n    const $items = $('.acu-nav-btn, .acu-action-btn');\n\n    $items.on('dragstart.sort', function (e) {\n      $dragSrcEl = $(this);\n      $(this).css('opacity', '0.4');\n      e.originalEvent.dataTransfer.effectAllowed = 'move';\n    });\n\n    $items.on('dragend.sort', function (e) {\n      $(this).css('opacity', '1');\n      $('.acu-drag-over').removeClass('acu-drag-over');\n      $('.acu-actions-group, .acu-unused-pool').removeClass('dragging-over');\n    });\n\n    $items.on('dragover.sort', function (e) {\n      e.preventDefault();\n      return false;\n    });\n    $items.on('dragenter.sort', function () {\n      if ($dragSrcEl && this !== $dragSrcEl[0]) $(this).addClass('acu-drag-over');\n    });\n    $items.on('dragleave.sort', function () {\n      $(this).removeClass('acu-drag-over');\n    });\n\n    $items.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('acu-drag-over');\n      if (!$dragSrcEl || $dragSrcEl[0] === this) return false;\n\n      const isSrcAction = $dragSrcEl.hasClass('acu-action-btn');\n      const isTgtAction = $(this).hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) return false;\n\n      if (isSrcAction) {\n        const targetPoolId = $(this).parent().attr('id');\n        const srcPoolId = $dragSrcEl.parent().attr('id');\n\n        if (srcPoolId === 'acu-action-pool' && targetPoolId === 'acu-active-actions') {\n          if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n            if (window.toastr) window.toastr.warning('6');\n            return false;\n          }\n        }\n\n        if (srcPoolId !== targetPoolId) {\n          $(this).before($dragSrcEl);\n          return false;\n        }\n      }\n\n      const $temp = $('<span>').hide();\n      $dragSrcEl.before($temp);\n      $(this).before($dragSrcEl);\n      $temp.replaceWith($(this));\n      return false;\n    });\n\n    // --- 2.  (/) ---\n    const $containers = $('#acu-action-pool, #acu-active-actions');\n\n    $containers.on('dragover.sort', function (e) {\n      e.preventDefault();\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        $(this).addClass('dragging-over');\n      }\n    });\n\n    $containers.on('dragleave.sort', function (e) {\n      $(this).removeClass('dragging-over');\n    });\n\n    $containers.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('dragging-over');\n\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        const currentParentId = $dragSrcEl.parent().attr('id');\n        const targetId = $(this).attr('id');\n        const btnId = $dragSrcEl.attr('id');\n\n        if (currentParentId !== targetId) {\n          if (targetId === 'acu-action-pool') {\n            if (btnId === 'acu-btn-settings') {\n              if (window.toastr) window.toastr.warning('');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          } else if (targetId === 'acu-active-actions') {\n            if ($(this).children().length >= 6) {\n              if (window.toastr) window.toastr.warning('6');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          }\n        }\n      }\n      return false;\n    });\n\n    // --- 3.  -  ---\n    $containers.on('click.sort', function (e) {\n      e.stopPropagation();\n\n      // \n      if ($(e.target).closest('.acu-action-btn, .acu-nav-btn').length > 0) return;\n\n      // \n      if (!selectedSwapSource) return;\n\n      const $src = $(selectedSwapSource);\n\n      // \n      if (!$src.hasClass('acu-action-btn')) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const targetId = $(this).attr('id');\n      const btnId = $src.attr('id');\n\n      // \n      if (srcPoolId === targetId) {\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      //   \n      if (targetId === 'acu-action-pool') {\n        if (btnId === 'acu-btn-settings') {\n          if (window.toastr) window.toastr.warning('');\n          $src.removeClass('acu-swap-selected');\n          selectedSwapSource = null;\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n      //   \n      else if (targetId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n    });\n\n    // --- 4.  (Click-to-Swap) -  ---\n    $items.on('click.sort', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (selectedSwapSource && selectedSwapSource === this) {\n        $(this).removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      if (!selectedSwapSource) {\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const $src = $(selectedSwapSource);\n      const $tgt = $(this);\n\n      const isSrcAction = $src.hasClass('acu-action-btn');\n      const isTgtAction = $tgt.hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const tgtPoolId = $tgt.parent().attr('id');\n\n      if (isSrcAction && srcPoolId === 'acu-action-pool' && tgtPoolId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n      }\n\n      if (srcPoolId !== tgtPoolId) {\n        $tgt.before($src);\n      } else {\n        const $temp = $('<span>').hide();\n        $src.before($temp);\n        $tgt.before($src);\n        $temp.replaceWith($tgt);\n      }\n\n      $src.removeClass('acu-swap-selected');\n      selectedSwapSource = null;\n    });\n  };\n\n  const showCellMenu = (e, cell) => {\n    const { $ } = getCore();\n    $('.acu-cell-menu, .acu-menu-backdrop').remove();\n    const backdrop = $('<div class=\"acu-menu-backdrop\"></div>');\n    $('body').append(backdrop);\n\n    const $cell = $(cell); //  data-locked\n    const rowIdx = parseInt($cell.data('row'), 10);\n    const colIdx = parseInt($cell.data('col'), 10);\n    if (isNaN(rowIdx) || isNaN(colIdx)) {\n      console.warn('[DICE]ACU /');\n      backdrop.remove();\n      return;\n    }\n    const tableKey = $cell.data('key');\n    // v19.x  tname\n    const tableName = $cell.data('tname') || $cell.closest('.acu-data-card').find('.acu-editable-title').text();\n    const content = safeDecodeURIComponent($cell.data('val'));\n    const config = getConfig();\n\n    // \n    const $card = $cell.closest('.acu-data-card');\n\n    //  ID\n    const cellId = `${tableKey}-${rowIdx}-${colIdx}`;\n    if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n\n    // \n    const isModified = window.acuModifiedSet.has(cellId);\n\n    // \n    const headers = cachedRawData?.[tableKey]?.content?.[0] || [];\n    const rowData = cachedRawData?.[tableKey]?.content?.[rowIdx + 1] || [];\n    const lockRowKey = getRowKey(tableName, rowData, headers);\n    const currentHeader = headers[colIdx] || '';\n\n    let isFieldLocked = false;\n    let hasAnyLockInRow = false;\n    let rowIndex = -1;\n    let sheetKey = '';\n\n    const api = getDbLockAPI();\n    if (api && lockRowKey) {\n      sheetKey = getSheetKeyByTableName(tableName);\n      if (sheetKey) {\n        rowIndex = findRowIndexByPrimaryKey(sheetKey, tableName, lockRowKey);\n        if (rowIndex !== null && rowIndex !== -1) {\n          const lockState = api.getTableLockState(sheetKey);\n          if (lockState) {\n            // \n            hasAnyLockInRow = lockState.rows?.includes(rowIndex) ?? false;\n            // \n            // [] colIdx - colIndex  -1\n            const cellKey = `${rowIndex}:${colIdx - 1}`;\n            isFieldLocked = lockState.cells?.includes(cellKey) ?? false;\n          }\n        } else {\n          console.warn('[DICE]  rowIndex');\n          isFieldLocked = false;\n          hasAnyLockInRow = false;\n        }\n      } else {\n        console.warn('[DICE]  sheetKey');\n        isFieldLocked = false;\n        hasAnyLockInRow = false;\n      }\n    } else {\n      if (!api) console.warn('[DICE] - API ');\n      isFieldLocked = false;\n      hasAnyLockInRow = false;\n    }\n\n    // \n    let lockMenuHtml = '';\n    if (lockRowKey) {\n      lockMenuHtml = '<div style=\"border-top:1px dashed var(--acu-border); margin:4px 0;\"></div>';\n\n      // \"\"\"\"\n      if (isFieldLocked) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-field\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-field\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n\n      // \"\"\"\"\n      if (hasAnyLockInRow) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-row\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-row\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n    }\n\n    const menu = $(`\n            <div class=\"acu-cell-menu acu-theme-${config.theme}\">\n                <div class=\"acu-cell-menu-item\" id=\"act-edit\"><i class=\"fa-solid fa-pen\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-edit-card\"><i class=\"fa-solid fa-edit\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-insert\"><i class=\"fa-solid fa-plus\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-copy\"><i class=\"fa-solid fa-copy\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-favorite\"><i class=\"fa-solid fa-star\"></i> </div>\n                ${lockMenuHtml}\n                ${isModified ? '<div class=\"acu-cell-menu-item\" id=\"act-undo\"><i class=\"fa-solid fa-undo\"></i> </div>' : ''}\n                <div class=\"acu-cell-menu-item\" id=\"act-delete\"><i class=\"fa-solid fa-trash\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-close\"><i class=\"fa-solid fa-times\"></i> </div>\n            </div>\n        `);\n    $('body').append(menu);\n\n    // \n    const winWidth = $(window).width();\n    const winHeight = $(window).height();\n    const mWidth = menu.outerWidth() || 150;\n    const mHeight = menu.outerHeight() || 150;\n    let clientX = e.clientX;\n    let clientY = e.clientY;\n    if (!clientX && e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length) {\n      clientX = e.originalEvent.touches[0].clientX;\n      clientY = e.originalEvent.touches[0].clientY;\n    } else if (!clientX && e.changedTouches && e.changedTouches.length) {\n      clientX = e.changedTouches[0].clientX;\n      clientY = e.changedTouches[0].clientY;\n    }\n\n    // \n    if (clientX === undefined) clientX = winWidth / 2;\n    if (clientY === undefined) clientY = winHeight / 2;\n\n    let left = clientX + 5;\n    let top = clientY + 5;\n    if (left + mWidth > winWidth) left = clientX - mWidth - 5;\n    if (top + mHeight > winHeight) top = clientY - mHeight - 5;\n\n    // \n    if (left < 5) left = 5;\n    if (top < 5) top = 5;\n\n    menu.css({ top: top + 'px', left: left + 'px' });\n\n    const closeAll = () => {\n      menu.remove();\n      backdrop.remove();\n    };\n    backdrop.on('click', closeAll);\n    menu.find('#act-close').click(closeAll);\n    // \n    // [] colIdx - colIndex  -1\n    const dbColIndex = colIdx - 1;\n    menu.find('#act-lock-field').click(e => {\n      e.stopPropagation();\n      if (lockRowKey && currentHeader) {\n        if (api && sheetKey && rowIndex !== null && rowIndex !== -1 && dbColIndex >= 0) {\n          api.lockTableCell(sheetKey, rowIndex, dbColIndex, true);\n          // []  data-locked \n          // []  $cell  data-locked \n          if ($cell.is('[data-locked]')) {\n            $cell.attr('data-locked', 'true');\n          }\n          $cell.find('[data-locked]').attr('data-locked', 'true');\n        } else {\n          console.warn('[DICE] -API');\n        }\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-field').click(e => {\n      e.stopPropagation();\n      if (lockRowKey && currentHeader) {\n        if (api && sheetKey && rowIndex !== null && rowIndex !== -1 && dbColIndex >= 0) {\n          api.lockTableCell(sheetKey, rowIndex, dbColIndex, false);\n          // []  data-locked \n          // []  $cell  data-locked \n          if ($cell.is('[data-locked]')) {\n            $cell.attr('data-locked', 'false');\n          }\n          $cell.find('[data-locked]').attr('data-locked', 'false');\n        } else {\n          console.warn('[DICE] -API');\n        }\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-lock-row').click(e => {\n      e.stopPropagation();\n      if (lockRowKey) {\n        if (api && sheetKey && rowIndex !== null && rowIndex !== -1) {\n          api.lockTableRow(sheetKey, rowIndex, true);\n          // []  data-locked \n          $card.find('[data-locked]').attr('data-locked', 'true');\n        } else {\n          console.warn('[DICE] -API');\n        }\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-row').click(e => {\n      e.stopPropagation();\n      if (lockRowKey) {\n        if (api && sheetKey && rowIndex !== null && rowIndex !== -1) {\n          // [] \n          const currentLockState = api.getTableLockState(sheetKey);\n          if (currentLockState && currentLockState.cells) {\n            // \n            const rowPrefix = `${rowIndex}:`;\n            currentLockState.cells.forEach((cellKey: string) => {\n              if (cellKey.startsWith(rowPrefix)) {\n                const cellColIndex = parseInt(cellKey.split(':')[1], 10);\n                if (!isNaN(cellColIndex)) {\n                  api.lockTableCell(sheetKey, rowIndex, cellColIndex, false);\n                }\n              }\n            });\n          }\n          // \n          api.lockTableRow(sheetKey, rowIndex, false);\n          // []  data-locked \n          $card.find('[data-locked]').attr('data-locked', 'false');\n        } else {\n          console.warn('[DICE] -API');\n        }\n      }\n      closeAll();\n    });\n\n    //  (v7.9 )\n    menu.find('#act-copy').click(async e => {\n      e.stopPropagation();\n\n      //  v7.7  (/PWA )\n      // : slash_command.txt /clipboard-set\n      if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n        try {\n          // \n          const safeContent = content\n            .replace(/\\\\/g, '\\\\\\\\')\n            .replace(/\"/g, '\\\\\"')\n            .replace(/\\n/g, '\\\\n')\n            .replace(/\\{/g, '\\\\{')\n            .replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          closeAll();\n          return; // \n        } catch (err) {\n          console.warn('[DICE]ACU ', err);\n        }\n      }\n\n      //  (v7.8 )\n      const doCopy = text => {\n        // A:  API ( HTTPS  localhost )\n        if (navigator.clipboard && window.isSecureContext) {\n          navigator.clipboard\n            .writeText(text)\n            .then(() => {})\n            .catch(() => {\n              fallbackCopy(text);\n            });\n        } else {\n          // B:  execCommand ( HTTP)\n          fallbackCopy(text);\n        }\n      };\n\n      const fallbackCopy = text => {\n        try {\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n\n          // \n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n\n          document.body.appendChild(textArea);\n\n          textArea.select();\n          textArea.setSelectionRange(0, 99999); //  iOS Safari\n\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n\n          if (successful) {\n          } else {\n            throw new Error('execCommand failed');\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          prompt(':', text);\n        }\n      };\n\n      doCopy(content);\n      closeAll();\n    });\n\n    // \n    menu.find('#act-favorite').click(async () => {\n      try {\n        // \n        const tableData = cachedRawData?.[tableKey];\n        if (!tableData || !tableData.content) {\n          toastr.error('');\n          closeAll();\n          return;\n        }\n\n        // null\n        const fullHeader = tableData.content[0] || [];\n        const header: string[] = fullHeader.slice(1).map((h: any) => String(h || ''));\n\n        // null\n        const fullRowData = tableData.content[rowIdx + 1] || [];\n        const rowDataValues: (string | number)[] = fullRowData.slice(1);\n\n        if (header.length === 0 || rowDataValues.length === 0) {\n          toastr.error('');\n          closeAll();\n          return;\n        }\n\n        // \n        const tagInput = await showTagInputModal();\n        if (tagInput === null) {\n          // \n          closeAll();\n          return;\n        }\n        const tags: string[] = tagInput\n          ? tagInput\n              .split(',')\n              .map(t => t.trim())\n              .filter(t => t.length > 0)\n          : [];\n\n        // \n        const result = await FavoritesManager.addFavorite(tableKey, tableName, header, rowDataValues, tags);\n\n        if (result) {\n          toastr.success('');\n        } else {\n          toastr.error('');\n        }\n      } catch (e) {\n        console.error('[DICE]:', e);\n        toastr.error(': ' + (e instanceof Error ? e.message : String(e)));\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-undo').click(() => {\n      const snapshot = loadSnapshot();\n      let originalValue = null;\n      if (snapshot && snapshot[tableKey]?.content[rowIdx + 1]) {\n        originalValue = snapshot[tableKey].content[rowIdx + 1][colIdx];\n      }\n\n      if (originalValue !== null) {\n        if (!cachedRawData) cachedRawData = getTableData();\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = originalValue;\n        }\n\n        const $cell = $(cell);\n        $cell.attr('data-val', safeEncodeURIComponent(originalValue));\n        $cell.data('val', safeEncodeURIComponent(originalValue));\n\n        // [1]  Label\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length > 0) {\n          $displayTarget = $cell.find('.acu-card-value');\n        } else if ($cell.hasClass('acu-grid-item')) {\n          $displayTarget = $cell.find('.acu-grid-value');\n        } else if ($cell.hasClass('acu-full-item')) {\n          $displayTarget = $cell.find('.acu-full-value');\n        }\n\n        const badgeStyle = getBadgeStyle(originalValue);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${originalValue}</span>`);\n        } else {\n          $displayTarget.text(originalValue);\n        }\n\n        // [] \n        $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n        if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n        window.acuModifiedSet.delete(cellId);\n\n        if (window.acuModifiedSet.size === 0) {\n          hasUnsavedChanges = false;\n          updateSaveButtonState();\n        }\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n      closeAll();\n    });\n\n    // []  ()\n    menu.find('#act-delete').click(async () => {\n      // [] DOM\n      const $panelContent = $('.acu-panel-content');\n      const savedScrollTop = $panelContent.length ? $panelContent.scrollTop() : 0;\n      const savedScrollLeft = $panelContent.length ? $panelContent.scrollLeft() : 0;\n\n      // \n      closeAll();\n\n      // [Bug 1 ] preview cardoverlay\n      const $mapOverlay = $('.acu-map-overlay');\n      const isFromMap = $mapOverlay.length > 0;\n\n      // preview card overlay\n      $('.acu-preview-overlay').remove();\n\n      // ---  DOM ---\n      if (isFromMap) {\n        // chip data-table-key  data-row-index \n        $mapOverlay.find(`.acu-map-element-chip[data-table-key=\"${tableKey}\"][data-row-index=\"${rowIdx}\"]`).remove();\n        $mapOverlay.find(`.acu-map-thumbnail[data-table-key=\"${tableKey}\"][data-row-index=\"${rowIdx}\"]`).remove();\n      }\n\n      // \n      const $card = $(cell).closest('.acu-data-card');\n      if ($card.length && !isFromMap) {\n        $card.css('transition', 'all 0.2s ease').css('opacity', '0').css('transform', 'scale(0.9)');\n        setTimeout(() => $card.slideUp(200, () => $card.remove()), 200);\n      }\n\n      // ---  ---\n      if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n      if (cachedRawData && cachedRawData[tableKey]?.content) {\n        cachedRawData[tableKey].content.splice(rowIdx + 1, 1);\n\n        try {\n          // \n          await saveDataOnly(cachedRawData, [tableKey]);\n\n          // [Bug 3 ] diffMap\n          currentDiffMap = generateDiffMap(cachedRawData);\n\n          // \n          renderInterface();\n\n          // [] overlayviewModel\n          if (isFromMap) {\n            const refreshMapData = $mapOverlay.data('refreshMapData');\n            if (typeof refreshMapData === 'function') {\n              await refreshMapData();\n            }\n          }\n\n          // [] renderInterface\n          setTimeout(() => {\n            const $newContent = $('.acu-panel-content');\n            if ($newContent.length && (savedScrollTop > 0 || savedScrollLeft > 0)) {\n              $newContent.scrollTop(savedScrollTop);\n              $newContent.scrollLeft(savedScrollLeft);\n            }\n          }, 60);\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n          toastr.error(': ' + (e instanceof Error ? e.message : String(e)));\n          renderInterface();\n\n          // [] \n          setTimeout(() => {\n            const $newContent = $('.acu-panel-content');\n            if ($newContent.length && (savedScrollTop > 0 || savedScrollLeft > 0)) {\n              $newContent.scrollTop(savedScrollTop);\n              $newContent.scrollLeft(savedScrollLeft);\n            }\n          }, 60);\n        }\n      }\n    });\n\n    // []  ()\n    menu.find('#act-insert').click(async () => {\n      closeAll();\n      // 1.  ()\n      if (!cachedRawData) cachedRawData = getTableData();\n      if (!cachedRawData) cachedRawData = loadSnapshot();\n\n      if (cachedRawData && cachedRawData[tableKey]?.content) {\n        const sheet = cachedRawData[tableKey];\n        // 2.  ()\n        const colCount = sheet.content[0] ? sheet.content[0].length : 2;\n        const newRow = new Array(colCount).fill('');\n        //  ()\n        if (colCount > 0) newRow[0] = String(sheet.content.length);\n\n        // 3.  (rowIdx+2  content )\n        sheet.content.splice(rowIdx + 2, 0, newRow);\n\n        // 4. \n        // \n        await saveDataToDatabase(cachedRawData, false, true);\n\n        // \n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $panel = $('.acu-panel-content');\n          // \n          if ($panel.length && $panel[0].scrollHeight > $panel.height()) {\n            $panel.scrollTop($panel.scrollTop() + 10);\n          }\n        }, 100);\n      }\n    });\n\n    // [] \n    menu.find('#act-edit-card').click(() => {\n      closeAll();\n      const rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const headers = rawData[tableKey].content[0];\n        const row = rawData[tableKey].content[rowIdx + 1];\n        if (row) {\n          showCardEditModal(row, headers, tableName, rowIdx, tableKey);\n        }\n      }\n    });\n\n    menu.find('#act-edit').click(() => {\n      closeAll();\n      showEditDialog(content, async newVal => {\n        // 1. \n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = newVal;\n        } else {\n          alert('');\n          return;\n        }\n\n        // 2.  UI \n        const $cell = $(cell);\n        $cell.attr('data-val', safeEncodeURIComponent(newVal)).data('val', safeEncodeURIComponent(newVal));\n\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length) $displayTarget = $cell.find('.acu-card-value');\n        else if ($cell.hasClass('acu-grid-item')) $displayTarget = $cell.find('.acu-grid-value');\n        else if ($cell.hasClass('acu-editable-title')) $displayTarget = $cell;\n\n        // 3.  UI / ()\n        const badgeStyle = getBadgeStyle(newVal);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(newVal)}</span>`);\n        } else {\n          $displayTarget.text(newVal);\n        }\n\n        // 4.  + AI\n        //  ()\n        $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n        if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n        //  saveRowInstantly  + \n        try {\n          const currentRow = cachedRawData[tableKey].content[rowIdx + 1];\n          await saveRowInstantly(tableKey, rowIdx, [...currentRow]);\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n          toastr.error(': ' + (e instanceof Error ? e.message : String(e)));\n        }\n      });\n    });\n  };\n\n  const showEditDialog = (content, onSave) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <!-- 2. []  acu-theme-${config.theme} -->\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"></div>\n                    <textarea class=\"acu-edit-textarea\" spellcheck=\"false\">${escapeHtml(content)}</textarea>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = el.scrollHeight + 2 + 'px';\n    };\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    dialog.find('#dlg-cancel').click(() => dialog.remove());\n    // \n    setupOverlayClose(dialog, 'acu-edit-overlay', () => dialog.remove());\n\n    dialog.find('#dlg-save').click(() => {\n      onSave(dialog.find('textarea').val());\n      dialog.remove();\n    });\n  };\n\n  // ==========================================\n  // []  (Observer )\n  // ==========================================\n  // \n  const detectVisualizerConflict = () => {\n    const { $ } = getCore();\n    if (!$) return false;\n\n    // 1:  DOM \n    //  .acu-wrapper\n    const $wrapper = $('.acu-wrapper');\n    if ($wrapper.length > 0) {\n      //  wrapper \n      //  v12.60  'acu_visualizer_ui_v20_pagination'  SCRIPT_ID\n      // \n      const hasVisualizerNav = $wrapper.find('.acu-nav-container').length > 0;\n      const hasVisualizerDataDisplay = $wrapper.find('.acu-data-display').length > 0;\n\n      //  wrapper \n      //  wrapper  data  id\n      const wrapperId = $wrapper.attr('id') || '';\n      const wrapperClass = $wrapper.attr('class') || '';\n\n      // \n      if (hasVisualizerNav && hasVisualizerDataDisplay) {\n        // \n        const hasDiceFeatures = $wrapper.find('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceFeatures) {\n          return true; // \n        }\n      }\n    }\n\n    // 2: \n    try {\n      const scripts = document.querySelectorAll('script');\n      for (const script of scripts) {\n        const content = script.textContent || script.innerHTML || '';\n        //  v12.60 \n        if (content.includes('acu_visualizer_ui_v20_pagination') && content.includes('acu_ui_config_v18')) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // \n    }\n\n    // 3:  localStorage\n    //  localStorage \n    try {\n      const visualizerConfig = localStorage.getItem('acu_ui_config_v18');\n      const diceConfig = localStorage.getItem('acu_ui_config_v19');\n\n      //  DOM \n      if (visualizerConfig && !diceConfig) {\n        //  DOM\n        const hasDiceInDOM = $('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceInDOM) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // localStorage \n    }\n\n    return false;\n  };\n\n  // \n  const showConflictDialog = () => {\n    const { $ } = getCore();\n    if (!$) return;\n\n    // \n    $('.dice-conflict-dialog-overlay').remove();\n\n    const dialogHtml = `\n      <div class=\"dice-conflict-dialog-overlay\" style=\"\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0, 0, 0, 0.75);\n        backdrop-filter: blur(4px);\n        z-index: 31200;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 20px;\n        box-sizing: border-box;\n      \">\n        <div class=\"dice-conflict-dialog\" style=\"\n          background: #fff;\n          border-radius: 16px;\n          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n          max-width: 500px;\n          width: 100%;\n          padding: 30px;\n          box-sizing: border-box;\n          animation: diceDialogPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n        \">\n          <div style=\"\n            text-align: center;\n            margin-bottom: 20px;\n          \">\n            <div style=\"\n              font-size: 48px;\n              color: #e74c3c;\n              margin-bottom: 15px;\n            \"></div>\n            <h2 style=\"\n              font-size: 24px;\n              font-weight: bold;\n              color: #333;\n              margin: 0 0 10px 0;\n            \"></h2>\n            <p style=\"\n              font-size: 16px;\n              color: #666;\n              line-height: 1.6;\n              margin: 0;\n            \">\"\"</p>\n          </div>\n          <div style=\"\n            background: #fff3cd;\n            border: 1px solid #ffc107;\n            border-radius: 8px;\n            padding: 15px;\n            margin-bottom: 20px;\n          \">\n            <p style=\"\n              font-size: 14px;\n              color: #856404;\n              line-height: 1.6;\n              margin: 0;\n            \">\n              <strong></strong><br>\n              <strong></strong>\n            </p>\n          </div>\n          <div style=\"\n            display: flex;\n            gap: 10px;\n            justify-content: center;\n            flex-wrap: wrap;\n          \">\n            <button id=\"dice-conflict-close\" style=\"\n              background: #6c757d;\n              color: #fff;\n              border: none;\n              border-radius: 8px;\n              padding: 12px 24px;\n              font-size: 16px;\n              font-weight: bold;\n              cursor: pointer;\n              transition: all 0.2s;\n              min-width: 120px;\n            \"></button>\n          </div>\n        </div>\n      </div>\n      <style>\n        @keyframes diceDialogPop {\n          from {\n            opacity: 0;\n            transform: translateY(20px) scale(0.95);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0) scale(1);\n          }\n        }\n        .dice-conflict-dialog button:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        }\n        .dice-conflict-dialog button:active {\n          transform: translateY(0);\n        }\n        @media (max-width: 768px) {\n          .dice-conflict-dialog {\n            padding: 20px !important;\n            margin: 10px !important;\n            max-width: calc(100% - 20px) !important;\n          }\n          .dice-conflict-dialog h2 {\n            font-size: 20px !important;\n          }\n          .dice-conflict-dialog p {\n            font-size: 14px !important;\n          }\n        }\n      </style>\n    `;\n\n    $('body').append(dialogHtml);\n\n    // \n    $('#dice-conflict-close').on('click', function () {\n      $('.dice-conflict-dialog-overlay').fadeOut(200, function () {\n        $(this).remove();\n      });\n    });\n\n    // \n    const $conflictOverlay = $('.dice-conflict-dialog-overlay');\n    setupOverlayClose($conflictOverlay, 'dice-conflict-dialog-overlay', () => {\n      $conflictOverlay.fadeOut(200, function () {\n        $(this).remove();\n      });\n    });\n\n    //  toastr \n    if (window.toastr) {\n      window.toastr.error('', '', {\n        timeOut: 0,\n        extendedTimeOut: 0,\n        closeButton: true,\n        preventDuplicates: true,\n      });\n    }\n  };\n\n  const init = () => {\n    if (isInitialized) return;\n\n    // LockManager (-API)\n    (() => {\n      const prefix = 'acu_locked_fields_v2_';\n      const keysToRemove: string[] = [];\n\n      for (let i = 0; i < localStorage.length; i++) {\n        const key = localStorage.key(i);\n        if (key && key.startsWith(prefix)) {\n          keysToRemove.push(key);\n        }\n      }\n\n      keysToRemove.forEach(key => localStorage.removeItem(key));\n\n      if (keysToRemove.length > 0) {\n        console.info(`[DICE]  ${keysToRemove.length} `);\n      }\n    })();\n\n    console.log('[DICE]...');\n\n    //  ConsoleCaptureManager  localStorage\n    try {\n      ConsoleCaptureManager.restore();\n      console.info('[DICE]ConsoleCaptureManager ');\n    } catch (e) {\n      console.error('[DICE] ConsoleCaptureManager :', e);\n    }\n\n    // \n    try {\n      ErrorHandler.checkAndRestore();\n      console.info('[DICE]');\n    } catch (e) {\n      console.error('[DICE]:', e);\n    }\n\n    // \n    if (detectVisualizerConflict()) {\n      showConflictDialog();\n      console.error('[DICE] ');\n      return; // \n    }\n\n    console.info('[DICE] MVU ...');\n    MvuModule.injectStyles();\n\n    //  Observer\n    if (observer) {\n      observer.disconnect();\n      observer = null;\n      console.info('[DICE] MutationObserver');\n    }\n    addStyles();\n    const initCfg = getConfig();\n    const initFontVal = FONTS.find(f => f.id === initCfg.fontFamily)?.val || FONTS[0].val;\n    injectDatabaseStyles(initCfg.theme, initFontVal);\n    setDatabaseToastMute(initCfg.muteDatabaseToasts === true);\n    // 2.  SillyTavern \n    if (window.SillyTavern && window.SillyTavern.eventSource) {\n      console.info('[DICE] SillyTavern ...');\n      const events = window.SillyTavern.eventTypes;\n      const source = window.SillyTavern.eventSource;\n      const triggers = [events.CHAT_CHANGED, events.MESSAGE_SWIPED, events.MESSAGE_DELETED, events.MESSAGE_UPDATED];\n\n      // \n      if (!_boundRenderHandler) {\n        _boundRenderHandler = () => {\n          if (!isEditingOrder) {\n            console.info('[DICE]');\n            setTimeout(renderInterface, 500);\n          } else {\n            console.info('[DICE]');\n          }\n        };\n      }\n\n      // \n      if (!window._acuBoundChatChangeHandler) {\n        window._acuBoundChatChangeHandler = () => {\n          console.info('[DICE]');\n          cachedRawData = null;\n          tablePageStates = {};\n          tableSearchStates = {};\n          tableScrollStates = {};\n          hasUnsavedChanges = false;\n          currentDiffMap.clear();\n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          // /\n          try {\n            if (typeof MvuModule?.clearCache === 'function') {\n              MvuModule.clearCache();\n            }\n          } catch (e) {\n            console.warn('[DICE]:', e);\n          }\n          setTimeout(renderInterface, 500);\n        };\n      }\n      const _boundChatChangeHandler = window._acuBoundChatChangeHandler;\n\n      triggers.forEach(evt => {\n        if (evt) {\n          source.removeListener(evt, _boundRenderHandler);\n          source.removeListener(evt, _boundChatChangeHandler); // \n          if (evt === events.CHAT_CHANGED) {\n            source.on(evt, _boundChatChangeHandler);\n          } else {\n            source.on(evt, _boundRenderHandler);\n          }\n        }\n      });\n      console.info(`[DICE] ${triggers.length} `);\n    } else {\n      console.warn('[DICE]SillyTavern ');\n    }\n\n    // 3.  API \n    const loop = () => {\n      const api = getCore().getDB();\n      if (api?.exportTableAsJson) {\n        isInitialized = true;\n        console.log('[DICE]');\n        console.info('[DICE] API ');\n\n        // --- [Fix]  API  #chat  () ---\n        const $chat = $('#chat');\n        if ($chat.length && !observer) {\n          console.info('[DICE] MutationObserver');\n          let mutationLock = false;\n          const handleMutation = () => {\n            if (mutationLock) return;\n            mutationLock = true;\n            requestAnimationFrame(() => {\n              const config = getConfig();\n              if (config.positionMode === 'embedded') {\n                mutationLock = false;\n                return;\n              }\n\n              const children = $chat.children();\n              const lastChild = children.last()[0];\n              const wrapper = $('.acu-wrapper')[0];\n\n              if (wrapper && lastChild && lastChild !== wrapper) {\n                if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n                  $chat.append(wrapper);\n                }\n              }\n\n              // [] \n              const diceCfg = getDiceConfig();\n              if (diceCfg && diceCfg.hideDiceResultInChat) {\n                // 1\n                const children = $chat.children();\n                const lastChild = children.last();\n                if (lastChild.hasClass('mes') || lastChild.hasClass('message-body')) {\n                  lastChild.addClass('acu-dice-result-revealing');\n                }\n\n                // 2RAF\n                requestAnimationFrame(() => {\n                  hideDiceResultsInUserMessages();\n\n                  // 3\n                  requestAnimationFrame(() => {\n                    lastChild.removeClass('acu-dice-result-revealing').addClass('acu-dice-result-revealed');\n                    // \n                    setTimeout(() => {\n                      lastChild.removeClass('acu-dice-result-revealed');\n                    }, 200);\n                  });\n                });\n              }\n\n              mutationLock = false;\n            });\n          };\n          observer = new MutationObserver(handleMutation);\n          observer.observe($chat[0], { childList: true });\n        } else if (!$chat.length) {\n          console.warn('[DICE] (#chat)  MutationObserver ');\n        }\n        // --------------------------------------------------\n\n        console.info('[DICE]...');\n        renderInterface(); // \n        // [] \n        setTimeout(() => {\n          hideDiceResultsInUserMessages();\n        }, 500);\n        // \n        if (api.registerTableUpdateCallback) {\n          api.registerTableUpdateCallback(UpdateController.handleUpdate);\n          console.info('[DICE]');\n\n          // \n          if (api.registerTableFillStartCallback) {\n            api.registerTableFillStartCallback(() => {\n              const current = api.exportTableAsJson();\n              if (current) saveSnapshot(current);\n            });\n            console.info('[DICE]');\n          }\n        } else {\n          console.warn('[DICE] API ');\n        }\n      } else {\n        //  ( 60)\n        if (!isInitialized) {\n          window._acuInitRetries = (window._acuInitRetries || 0) + 1;\n          if (window._acuInitRetries < 60) {\n            if (window._acuInitRetries % 10 === 0) {\n              console.info(`[DICE] API ... (${window._acuInitRetries}/60)`);\n            }\n            setTimeout(loop, 1000);\n          } else {\n            console.error('[DICE] API');\n          }\n        }\n      }\n    };\n    loop();\n\n    // []  - \n    const setupOptionHideListener = () => {\n      const { $ } = getCore();\n      const hideOptionPanel = () => {\n        optionPanelVisible = false;\n        $('.acu-option-panel, .acu-embedded-options-container').fadeOut(200, function () {\n          $(this).remove();\n        });\n      };\n\n      const pendingCrazyAppend = new Map<number, { result: string; createdAt: number }>();\n      const CRAZY_APPEND_TTL_MS = 12000;\n      let lastCrazyPreSendAt = 0;\n\n      const normalizeMessageId = (messageId: number | string) => {\n        const id = typeof messageId === 'string' ? Number(messageId) : messageId;\n        return Number.isFinite(id) ? id : null;\n      };\n\n      const hasDiceResultInText = (text: string) => {\n        if (!text) return false;\n        //  <meta:> \n        const metaRegex = /<meta:>[\\s\\S]*?<\\/meta:>/g;\n        return metaRegex.test(text);\n      };\n\n      const insertDiceIntoUserInputBlock = (text: string, diceResult: string) => {\n        if (!text || !diceResult) return '';\n        const blockRegex = /(<>)([\\s\\S]*?)(<\\/>)/;\n        const blockMatch = text.match(blockRegex);\n        if (!blockMatch) return '';\n        const inner = blockMatch[2];\n        if (inner.includes(diceResult)) return '';\n        const prefix = inner.startsWith('\\n') ? '\\n' : '';\n        const suffix = inner.endsWith('\\n') ? '\\n' : '';\n        const trimmedInner = inner.trim();\n        const newInner = trimmedInner ? `${trimmedInner} ${diceResult}` : diceResult;\n        const textWithoutDice = text.includes(diceResult) ? text.replace(diceResult, '').trim() : text;\n        return textWithoutDice.replace(blockRegex, `${blockMatch[1]}${prefix}${newInner}${suffix}${blockMatch[3]}`);\n      };\n\n      const applyCrazyModeToPrompt = (type: string, params: unknown, dryRun: boolean) => {\n        if (dryRun) return;\n        const safeParams = params && typeof params === 'object' ? (params as Record<string, unknown>) : {};\n        const quietPrompt = typeof safeParams.quiet_prompt === 'string' ? safeParams.quiet_prompt : '';\n        const automaticTrigger = safeParams.automatic_trigger === true;\n        const alreadyApplied = safeParams._acu_crazy_applied === true;\n        if (alreadyApplied || automaticTrigger) return;\n        if (type === 'quiet' || quietPrompt.trim().length > 0) return;\n\n        const now = Date.now();\n        if (now - lastCrazyPreSendAt < 300) return;\n\n        const originalPrompt = typeof safeParams.prompt === 'string' ? safeParams.prompt : '';\n        if (!originalPrompt || !originalPrompt.trim()) return;\n        if (hasDiceResultInText(originalPrompt)) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        let finalPrompt = '';\n        if (originalPrompt.includes('<>')) {\n          const inserted = insertDiceIntoUserInputBlock(originalPrompt, crazyRollResult);\n          finalPrompt =\n            inserted && inserted !== originalPrompt ? inserted : `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n        } else {\n          finalPrompt = `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n        }\n\n        safeParams.prompt = finalPrompt;\n        safeParams._acu_crazy_applied = true;\n        lastCrazyPreSendAt = now;\n      };\n\n      const triggerCrazyModeBeforeSend = () => {\n        const now = Date.now();\n        if (now - lastCrazyPreSendAt < 300) return;\n\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        const content = ($ta.val() || '').toString().trim();\n        if (!content) return;\n        if (hasDiceResultInText(content)) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        smartInsertToTextarea(crazyRollResult, 'dice');\n        const updatedValue = ($ta.val() || '').toString();\n        if (updatedValue) {\n          const textarea = $ta[0] as HTMLTextAreaElement;\n          textarea.value = updatedValue;\n          textarea.dispatchEvent(new Event('input', { bubbles: true }));\n          textarea.dispatchEvent(new Event('change', { bubbles: true }));\n        }\n        lastCrazyPreSendAt = now;\n      };\n\n      const queueCrazyAppend = (messageId: number | string) => {\n        const id = normalizeMessageId(messageId);\n        if (id === null) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        pendingCrazyAppend.set(id, { result: crazyRollResult, createdAt: Date.now() });\n        void applyCrazyAppend(id);\n      };\n\n      const applyCrazyAppend = async (messageId: number | string) => {\n        const id = normalizeMessageId(messageId);\n        if (id === null) return;\n\n        const pending = pendingCrazyAppend.get(id);\n        if (!pending) return;\n\n        if (Date.now() - pending.createdAt > CRAZY_APPEND_TTL_MS) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        pendingCrazyAppend.delete(id);\n        let newMessage = '';\n\n        try {\n          await enqueueMessageMutation(id, async () => {\n            const stChat = ST?.chat || window.parent?.SillyTavern?.chat;\n            const stMsg = stChat && typeof id === 'number' ? stChat[id] : null;\n            const msg = getChatMessages(id)[0];\n            if (!msg || msg.role !== 'user') {\n              if (!stMsg || !stMsg.is_user) {\n                return;\n              }\n            }\n\n            const originalText = String(stMsg?.mes ?? msg?.message ?? '');\n            if (hasDiceResultInText(originalText)) {\n              return;\n            }\n\n            const extraObj: Record<string, unknown> =\n              msg?.extra && typeof msg.extra === 'object' ? (msg.extra as Record<string, unknown>) : {};\n            if (extraObj.acuCrazyModeApplied === true) {\n              return;\n            }\n\n            if (originalText.includes('<>')) {\n              const inserted = insertDiceIntoUserInputBlock(originalText, pending.result);\n              newMessage =\n                inserted && inserted !== originalText ? inserted : `${originalText} ${pending.result}`.trim();\n            } else {\n              newMessage = originalText ? `${originalText} ${pending.result}` : pending.result;\n            }\n\n            if (stMsg && stMsg.is_user) {\n              stMsg.mes = newMessage;\n            }\n\n            await setChatMessages(\n              [{ message_id: id, message: newMessage, extra: { ...extraObj, acuCrazyModeApplied: true } }],\n              { refresh: 'affected' },\n            );\n          });\n        } catch (e) {\n          console.warn('[DICE]: ', e);\n        }\n\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        if ($ta.length && newMessage) {\n          const currentVal = ($ta.val() || '').toString();\n          if (currentVal === newMessage) {\n            $ta.val('').trigger('input').trigger('change');\n          }\n        }\n      };\n\n      // [] \n      const setupSendButtonListener = () => {\n        // []  value \n        interceptTextareaValue();\n\n        // [] \n        const sendButton = document.getElementById('send_but');\n        if (sendButton) {\n          const onSendCapture = () => {\n            // \n            triggerCrazyModeBeforeSend();\n            // \n            restoreDiceResultBeforeSend();\n          };\n          sendButton.addEventListener('click', onSendCapture, true);\n          sendButton.addEventListener('pointerup', onSendCapture, true);\n          sendButton.addEventListener('touchend', onSendCapture, true);\n        }\n\n        // jQuery\n        $(document)\n          .off('click.acu_restore_dice', '#send_but')\n          .on('click.acu_restore_dice', '#send_but', function (e) {\n            // \n            triggerCrazyModeBeforeSend();\n            // \n            restoreDiceResultBeforeSend();\n          });\n\n        // \n        const textarea = document.getElementById('send_textarea');\n        if (textarea) {\n          textarea.addEventListener(\n            'keydown',\n            function (e) {\n              //  ShiftShift+Enter \n              if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n                // \n                triggerCrazyModeBeforeSend();\n                // \n                restoreDiceResultBeforeSend();\n              }\n            },\n            true, // \n          );\n          textarea.addEventListener(\n            'keyup',\n            function (e) {\n              if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n                triggerCrazyModeBeforeSend();\n                restoreDiceResultBeforeSend();\n              }\n            },\n            true,\n          );\n        }\n\n        $('#send_textarea')\n          .off('keydown.acu_restore_dice')\n          .on('keydown.acu_restore_dice', function (e) {\n            //  ShiftShift+Enter \n            if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n              // \n              triggerCrazyModeBeforeSend();\n              // \n              restoreDiceResultBeforeSend();\n            }\n          })\n          .off('keyup.acu_restore_dice')\n          .on('keyup.acu_restore_dice', function (e) {\n            if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n              triggerCrazyModeBeforeSend();\n              restoreDiceResultBeforeSend();\n            }\n          });\n\n        // [] /\n        const observer = new MutationObserver(() => {\n          const $ta = $('#send_textarea');\n          if ($ta.length && !$ta[0]._acuValueIntercepted) {\n            interceptTextareaValue();\n          }\n        });\n        observer.observe(document.body, { childList: true, subtree: true });\n      };\n\n      const installCrazyGenerateHook = () => {\n        const rootWindow = window as Window & {\n          __acuCrazyGenerateHookInstalled?: boolean;\n          __acuCrazyGenerateOriginal?: (...args: unknown[]) => unknown;\n        };\n        if (rootWindow.__acuCrazyGenerateHookInstalled) return;\n        if (!rootWindow.TavernHelper || typeof rootWindow.TavernHelper.generate !== 'function') return;\n\n        rootWindow.__acuCrazyGenerateOriginal = rootWindow.TavernHelper.generate;\n        rootWindow.TavernHelper.generate = async function (...args: unknown[]) {\n          const options =\n            args.length > 0 && args[0] && typeof args[0] === 'object' ? (args[0] as Record<string, unknown>) : null;\n\n          if (options) {\n            const quietPrompt = typeof options.quiet_prompt === 'string' ? options.quiet_prompt : '';\n            const automaticTrigger = options.automatic_trigger === true;\n            const alreadyApplied = options._acu_crazy_applied === true;\n            if (!alreadyApplied && !automaticTrigger && quietPrompt.trim().length === 0) {\n              let originalPrompt = '';\n              const injects = options.injects;\n              if (Array.isArray(injects) && injects.length > 0) {\n                const first = injects[0];\n                if (first && typeof first === 'object') {\n                  const content = (first as Record<string, unknown>).content;\n                  if (typeof content === 'string') originalPrompt = content;\n                }\n              }\n              if (!originalPrompt && typeof options.prompt === 'string') {\n                originalPrompt = options.prompt;\n              }\n              if (!originalPrompt && typeof options.user_input === 'string') {\n                originalPrompt = options.user_input;\n              }\n\n              if (originalPrompt && !hasDiceResultInText(originalPrompt) && shouldTriggerCrazyMode()) {\n                const crazyRollResult = generateCrazyRoll();\n                if (crazyRollResult) {\n                  const mergedPrompt = `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n                  if (Array.isArray(injects) && injects.length > 0) {\n                    const first = injects[0];\n                    if (first && typeof first === 'object') {\n                      (first as Record<string, unknown>).content = mergedPrompt;\n                    }\n                  } else if (typeof options.prompt === 'string') {\n                    options.prompt = mergedPrompt;\n                  } else {\n                    options.user_input = mergedPrompt;\n                  }\n                  options._acu_crazy_applied = true;\n                  lastCrazyPreSendAt = Date.now();\n                  console.info('[DICE]: ');\n                }\n              }\n            }\n          }\n\n          return (rootWindow.__acuCrazyGenerateOriginal as (...args: unknown[]) => unknown).apply(this, args);\n        };\n        rootWindow.__acuCrazyGenerateHookInstalled = true;\n      };\n\n      // []  ( ST  -> )\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      // \n      const evtName =\n        ST?.eventTypes?.MESSAGE_SENT || (window.tavern_events ? window.tavern_events.MESSAGE_SENT : 'message_sent');\n\n      // 1.  ST.eventSource ()\n      if (ST?.eventSource) {\n        ST.eventSource.on(evtName, hideOptionPanel);\n        // [] \n        ST.eventSource.on(evtName, async messageId => {\n          // \n          queueCrazyAppend(messageId);\n\n          // [] \n          await processPendingEffectRuns(messageId);\n\n          // DOM\n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            setTimeout(() => {\n              hideDiceResultsInUserMessages();\n            }, 300);\n          }\n        });\n\n        // []  GENERATION_AFTER_COMMANDS \n        const afterCommandsEvtName =\n          ST?.eventTypes?.GENERATION_AFTER_COMMANDS ||\n          (window.tavern_events ? window.tavern_events.GENERATION_AFTER_COMMANDS : 'GENERATION_AFTER_COMMANDS');\n        if (afterCommandsEvtName) {\n          ST.eventSource.on(afterCommandsEvtName, (type, params, dryRun) => {\n            applyCrazyModeToPrompt(type, params, dryRun);\n          });\n        }\n\n        installCrazyGenerateHook();\n        setupSendButtonListener();\n        return;\n      }\n\n      // 2.  eventOn (TavernHelper )\n      if (typeof window.eventOn === 'function') {\n        window.eventOn(evtName, hideOptionPanel);\n        // [] \n        window.eventOn(evtName, async messageId => {\n          // \n          queueCrazyAppend(messageId);\n\n          // [] \n          await processPendingEffectRuns(messageId);\n\n          // DOM\n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            setTimeout(() => {\n              hideDiceResultsInUserMessages();\n            }, 300);\n          }\n        });\n\n        // []  GENERATION_AFTER_COMMANDS \n        const afterCommandsEvtName = window.tavern_events\n          ? window.tavern_events.GENERATION_AFTER_COMMANDS\n          : 'GENERATION_AFTER_COMMANDS';\n        window.eventOn(afterCommandsEvtName, (type, params, dryRun) => {\n          applyCrazyModeToPrompt(type, params, dryRun);\n        });\n\n        installCrazyGenerateHook();\n        setupSendButtonListener();\n        return;\n      }\n    };\n\n    // \n    setTimeout(setupOptionHideListener, 2000);\n\n    // [] \n    setTimeout(() => {\n      interceptTextareaValue();\n    }, 500);\n\n    // [] ERA\n    const eventOn = window.eventOn || window.parent?.eventOn;\n    if (typeof eventOn === 'function') {\n      eventOn('era:writeDone', detail => {\n        //  ERA \n        if (typeof MvuModule === 'object' && typeof MvuModule.clearCache === 'function') {\n          MvuModule.clearCache();\n        }\n\n        // ERA\n        const mode = MvuModule.detectMode();\n        if (mode === 'era' && getActiveTabState() === MvuModule.MODULE_ID) {\n          console.log('[DICE]ERA');\n          renderInterface();\n        }\n      });\n    } else {\n      console.warn('[DICE] ERA eventOn ');\n    }\n\n    // [] \n    $(window)\n      .off('beforeunload.acu pagehide.acu')\n      .on('beforeunload.acu pagehide.acu', () => {\n        try {\n          // \n          abortAllPendingRequests();\n          const timer = (window as Record<string, unknown>).__acuEffectRunCleanerTimer;\n          if (typeof timer === 'number') {\n            window.clearInterval(timer);\n            delete (window as Record<string, unknown>).__acuEffectRunCleanerTimer;\n          }\n          localStorage.setItem(STORAGE_KEY_SCROLL, JSON.stringify(tableScrollStates));\n          if (observer) {\n            observer.disconnect();\n            observer = null;\n          }\n        } catch (e) {\n          console.warn('[DICE]:', e);\n        }\n      });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  // window.testPairedTableFix()\n  window.testPairedTableFix = function () {\n    // \n    const prefix = 'AM';\n    const startFrom = 1;\n    const columnName = '';\n\n    // 1AM0001, AM0002, (), AM0030, ()\n    // AM0001, AM0002, AM0030\n    const table1Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        ['AM0001', '1', '1'],\n        ['AM0002', '2', '2'],\n        [null, '3-', '3-'], // \n        ['AM0030', '4', '4'],\n        [null, '5-', '5-'], // \n      ],\n    };\n\n    // 2(), AM0002, AM0030, AM0040, AM0050\n    // AM0002, AM0030, AM0040, AM0050\n    const table2Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        [null, 'A-', 'A-'], // \n        ['AM0002', 'B', 'B'],\n        ['AM0030', 'C', 'C'],\n        ['AM0040', 'D', 'D'],\n        ['AM0050', 'E', 'E'],\n      ],\n    };\n\n    // \n    const extract1 = extractCodesFromTable(table1Sheet, columnName, prefix);\n    const extract2 = extractCodesFromTable(table2Sheet, columnName, prefix);\n\n    // \n    const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n    // \n    const rawData = {};\n    const result = alignAndFixPairedTables(\n      table1Sheet,\n      'sheet1',\n      table2Sheet,\n      'sheet2',\n      columnName,\n      mapping,\n      prefix,\n      startFrom,\n      rawData,\n    );\n\n    // \n    const getValidCodes = sheet =>\n      sheet.content\n        .slice(1)\n        .map(r => r[0])\n        .filter(c => c && String(c).match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\d+$`)));\n\n    const codes1 = getValidCodes(table1Sheet);\n    const codes2 = getValidCodes(table2Sheet);\n\n    // \n    const emptyRows1 = table1Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\d+$`)));\n    const emptyRows2 = table2Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\d+$`)));\n\n    // \n    const validateSequence = (codes, prefix, startFrom) => {\n      const numbers = codes\n        .map(c => {\n          if (!c) return null;\n          const match = c.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          return match ? parseInt(match[1], 10) : null;\n        })\n        .filter(n => n !== null);\n\n      for (let i = 0; i < numbers.length; i++) {\n        if (numbers[i] !== startFrom + i) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    const isValid1 = validateSequence(codes1, prefix, startFrom);\n    const isValid2 = validateSequence(codes2, prefix, startFrom);\n\n    // \n    const set1 = new Set(codes1);\n    const set2 = new Set(codes2);\n    const setsEqual = set1.size === set2.size && [...set1].every(c => set2.has(c));\n\n    // \n    const emptyRowsPreserved1 = emptyRows1.some(r => r[1] && r[1].includes(''));\n    const emptyRowsPreserved2 = emptyRows2.some(r => r[1] && r[1].includes(''));\n\n    return {\n      table1Sheet,\n      table2Sheet,\n      result,\n      codes1,\n      codes2,\n      emptyRows1,\n      emptyRows2,\n      isValid1,\n      isValid2,\n      setsEqual,\n      emptyRowsPreserved1,\n      emptyRowsPreserved2,\n      //  +  + \n      isValid: isValid1 && isValid2 && setsEqual && emptyRowsPreserved1 && emptyRowsPreserved2,\n    };\n  };\n\n  // \n  window.diagnoseDiceVariables = async function () {\n    if (typeof MvuModule !== 'undefined' && typeof MvuModule.diagnoseVariableFramework === 'function') {\n      return await MvuModule.diagnoseVariableFramework();\n    } else {\n      console.error('[DICE]MvuModule ');\n      return null;\n    }\n  };\n\n  const { $ } = getCore();\n  if ($) $(document).ready(init);\n  else window.addEventListener('load', init);\n})();\n"],"names":["EMOJI_MAP","LOCATION_EMOJI_MAP","ELEMENT_EMOJI_MAP","RELATION_ICON_MAP","icon","keywords","DATABASE_THEME_MAP","retro","bgNav","bgPanel","border","textMain","textSub","btnBg","btnHover","btnActiveBg","btnActiveText","accent","inputBg","dark","modern","forest","ocean","cyber","nightowl","sakura","minepink","purple","wechat","educational","vaporwave","classicpackaging","galgame","terminal","dreamcore","aurora","chouten","injectDatabaseStyles","themeId","fontFamily","getJQuery","w","jQuery","targets","window","parent","top","filter","v","idx","arr","indexOf","length","t","isDarkTheme","Set","has","stepperSpinFilter","stepperSpinOpacity","stepperColorScheme","S_POPUP","S_MAIN","S_ALL_WINDOWS","S_POPUP_MAIN","css","encodeURIComponent","$","remove","append","e","DB_TOAST_MUTE_STYLE_ID","setDatabaseToastMute","enabled","docs","tryAddDoc","doc","document","includes","push","collectDatabaseToastDocuments","existing","getElementById","style","createElement","id","textContent","head","documentElement","appendChild","querySelectorAll","forEach","node","SCRIPT_ID","PRIMARY_KEYS","isNpcTableName","name","getRowKey","tableName","row","headers","pkField","fieldIndex","getDbLockAPI","topWindow","AutoCardUpdaterAPI","getSheetKeyByTableName","api","exportTableAsJson","data","key","startsWith","console","warn","findRowIndexByPrimaryKey","sheetKey","primaryKeyValue","sheet","content","Array","isArray","pkIndex","actualValue","eqIdx","substring","i","String","async","executeEffects","pendingCtx","results","preset","matchedOutcome","context","replayOperations","deferredSecondaryCallbacks","baseData","cachedRawData","getTableData","Error","transactionalData","JSON","parse","stringify","modifiedSheetKeys","overrideMap","Map","effectOverrides","item","set","effectId","effects","info","effect","condition","condContext","$roll","roll","$attr","attributeValue","$mod","modifier","$dc","dc","condResult","evaluateCondition","success","value","effectsConfig","allowedTargets","target","rolledValue","finalValue","formulaText","override","get","Math","abs","computedValue","formula","Number","isFinite","undefined","parsedValue","parseEffectValueInput","valid","aliasCandidates","attributeName","Boolean","updateResult","updateSingleAttribute","characterName","operation","initValue","min","max","skipSave","dataOverride","modifiedSheetKey","add","effectResult","oldValue","newValue","error","resolvedAttrName","level","triggerType","branchLabel","resultRef","secondaryResults","executeSecondaryEffectsChain","allResults","some","r","map","runInSaveQueue","latestData","latestTransactionalData","latestModifiedSheetKeys","op","replayResult","size","performSaveDataOnly","from","run","rawValue","traceLabel","trim","rollResult","rollComplexDiceExpression","isNaN","total","round","effectResults","secondaryEffects","maxDepth","num","secondaryMaxDepth","triggerCounts","allGenerated","localDeferredCallbacks","callbackQueue","currentLevelResults","buildFormulaContext","currentAttrs","getFullAttributesForCharacter","formulaContext","attr","compare","operator","left","right","resolveThresholdValue","result","depth","rawExpr","expr","replace","delta","liveFormulaContext","exprContext","$old","$new","$delta","$depth","val","formulaExpr","token","formulaValue","evaluateFormula","fallbackNum","parseFloat","renderTemplateText","text","vars","match","renderTemplateTextTwice","pass1","appendNamedRandomTables","outputVars","randomTables","tableKey","tableDef","Object","entries","dice","tableRoll","rawResult","nextLevelResults","secondaryTriggerMode","secEffect","maxTriggerCount","currentCount","matchedCandidates","resultTarget","isSameAttributeAlias","trigger","attribute","attrValue","thresholdValue","compareValue","type","remainingTriggerCount","consumedMatches","generatedByMatch","candidateIndex","matched","matchedResult","matchedThresholdValue","nextMatchIndex","callbackScheduled","callback","callbackFn","callbackPayload","matchIndex","chainMode","runCallback","effectsToRun","generatedForCurrentMatch","baseOutputVars","$initiator","$attribute","outputText","randomTable","$tableRoll","rawTableResult","$tableResult","renderedText","infoResult","triggerSourceId","triggerThreshold","triggerMatchIndex","outputMessage","subCheck","subCheckCandidates","attributeCandidates","subCheckLabel","label","subCheckAttrName","subCheckAttrValue","candidate","getAttributeValue","fallbackText","missingAttributeText","missingVars","$subCheckLabel","$subCheckAttrName","subCheckDice","subCheckRoll","subCheckTarget","targetValue","subCheckOperator","subCheckPassed","subCheckJudge","branch","failure","subCheckVars","$subCheckAttrValue","$subCheckDice","$subCheckRoll","$subCheckTarget","$subCheckOperator","$subCheckPassed","$subCheckJudge","formulaContextForCondition","generatedResult","grouped","triggerMatchCount","buildEffectTraceLines","prefix","sign","formulaInfo","buildEffectMetaLines","options","settledHeader","lines","primaryBranch","slice","formulaDetail","branchReasonText","BookmarkManager","STORAGE_KEY_PREFIX","MAX_CONTEXTS","_cache","_currentContextId","_getStorageKey","ctxId","this","getCurrentContextFingerprint","_cleanupOldContexts","allKeys","localStorage","keyWithTime","getItem","time","_lastAccess","sort","a","b","toDelete","removeItem","log","_load","stored","_save","dataToSave","Date","now","setItem","isBookmarked","rowKey","toggleBookmark","keys","getBookmarks","clearCurrentContext","escapeHtml","s","stripLoneSurrogates","sanitized","code","charCodeAt","next","safeEncodeURIComponent","safeDecodeURIComponent","decodeURIComponent","setupOverlayClose","$overlay","overlayClass","onClose","navigator","maxTouchPoints","on","hasClass","mouseDownOnOverlay","showPresetConflictDialog","getCore","config","getConfig","suggestedName","baseName","existingNames","counter","newName","generateUniqueName","presetName","$dialog","theme","presetType","cssText","closeDialog","find","click","onCancel","mode","onOverwrite","onRename","smartInsertToTextarea","newContent","contentType","$ta","normalizeTextareaContent","normalizedNewContent","currentVal","metaCheckResultRegex","actionRegex","placeholderRegex","diceCfg","getDiceConfig","contentToInsert","shouldSaveOriginal","hideDiceResultFromUser","textarea","_acuOriginalDiceText","_acuHasDiceData","workingText","existingAction","existingDice","existingDiceOriginal","test","originalText","metaMatches","actionMatches","userInput","firstLine","split","normalizeFragment","userNorm","firstNorm","parts","finalVal","join","restoreDiceResultBeforeSend","restoredVal","removeData","interceptTextareaValue","_acuValueIntercepted","originalDescriptor","getOwnPropertyDescriptor","HTMLTextAreaElement","prototype","originalValue","defineProperty","call","_value","configurable","STORAGE_KEY_TABLE_ORDER","STORAGE_KEY_ACTIVE_TAB","STORAGE_KEY_UI_CONFIG","STORAGE_KEY_LAST_SNAPSHOT","STORAGE_KEY_IS_COLLAPSED","STORAGE_KEY_OPTIONS_COLLAPSED","STORAGE_KEY_DASHBOARD_ACTIVE","STORAGE_KEY_TABLE_HEIGHTS","STORAGE_KEY_TABLE_STYLES","STORAGE_KEY_HIDDEN_TABLES","STORAGE_KEY_REVERSE_TABLES","MIN_PANEL_HEIGHT","MAX_PANEL_HEIGHT","STORAGE_KEY_DICE_CONFIG","STORAGE_KEY_ATTRIBUTE_PRESETS","STORAGE_KEY_ACTIVE_ATTR_PRESET","STORAGE_KEY_ACTION_PRESETS","STORAGE_KEY_ACTIVE_ACTION_PRESET","STORAGE_KEY_ADVANCED_PRESETS","STORAGE_KEY_BUILTIN_PRESET_VISIBILITY","STORAGE_KEY_BUILTIN_PRESET_ORDER","STORAGE_KEY_LAST_PRESET","STORAGE_KEY_CRAZY_MODE","DEFAULT_CRAZY_MODE_CONFIG","crazyLevel","playerWeight","inSceneNpcWeight","offSceneNpcWeight","PRESET_FORMAT_VERSION","compareVersion","v1","v2","normalizeVersion","nv1","nv2","parts1","parts2","p1","p2","STORAGE_KEY_AVATAR_MAP","STORAGE_KEY_MAP_FOCUS","ConsoleCaptureManager","logs","maxLogs","filters","originalMethods","isIntercepted","restore","enable","intercept","disable","emergencyBtn","display","self","args","apply","capture","timestamp","timeStr","toLocaleTimeString","hour12","arg","stack","logEntry","random","rawArgs","shift","clear","getFilteredLogs","setFilters","ErrorHandler","errorCount","errorThreshold","lastErrorTime","errorWindow","fatalErrorDetected","isFatalError","source","lineno","colno","thirdPartyPatterns","errorInfo","errorSource","pattern","corePatterns","isCoreError","handleError","triggerFatalError","showEmergencyButton","btn","innerHTML","onmouseenter","background","transform","onmouseleave","onclick","showDebugConsoleModal","alert","body","checkAndRestore","onerror","message","addEventListener","event","reason","STORAGE_KEY_REGEX_RULES","STORAGE_KEY_REGEX_PRESETS","STORAGE_KEY_REGEX_ACTIVE_PRESET","STORAGE_KEY_REGEX_ENABLED","BUILTIN_REGEX_RULES","description","flags","global","caseInsensitive","multiline","replacement","scope","priority","executeMode","security","maxMatchTime","maxMatches","maxInputLength","tableNames","STORAGE_KEY_VALIDATION_ENABLED","STORAGE_KEY_VALIDATION_MODE","RULE_TYPE_INFO","tableReadonly","desc","rowLimit","sequence","required","format","enum","numeric","relation","keyValue","BUILTIN_VALIDATION_RULES","builtin","targetTable","targetColumn","ruleType","startFrom","errorMessage","values","refTable","refColumn","valueType","valueMin","valueMax","STORAGE_KEY_BLACKLIST","STORAGE_KEY_BLACKLIST_VERSION","DEFAULT_BLACKLIST","BlacklistManager","getBlacklist","Store","storedVersion","defaultItems","mergedItems","setBlacklist","list","resetToDefault","isBlacklisted","blacklist","lastPart","STORAGE_KEY_PRESETS","STORAGE_KEY_ACTIVE_PRESET","PresetManager","getAllPresets","_initDefaultPreset","needsSave","version","_compareVersion","customRules","rules","existingBuiltinMap","_mergeBuiltinRules","ValidationRuleManager","clearCache","getActivePreset","presets","activeId","p","setActivePreset","createPreset","newPreset","createdAt","toISOString","duplicatePreset","deletePreset","filtered","updatePresetRules","exportPreset","mergePresetWithDefaults","presetId","builtinRuleIds","builtinRuleMap","mergedRules","processedCustomIds","newRule","existingRule","rule","importPreset","json","autoMerge","importedVersion","needsMerge","defaultPreset","oldCustom","resetDefaultPreset","_enabledCache","getAllRules","enabledStates","getEnabledStates","allRules","toggleRuleEnabled","ruleId","states","toggleRuleIntercept","getEnabledRules","addCustomRule","removeCustomRule","index","findIndex","splice","updateCustomRule","updates","getRule","getRulesByTable","RegexTransformationManager","_generateId","toString","substr","_saveEnabledStates","getApplicableRules","columnName","columnNames","ruleIndex","activePreset","RegexPresetManager","testCases","updatedAt","_syncRulesToActivePreset","removeRule","updateRule","storedRules","storedRuleIds","missingBuiltinRules","sourcePresetId","sourcePreset","exportData","jsonString","RegexTransformationEngine","_regexCache","_buildFlags","unicode","sticky","_getRegex","hasLookbehind","hasLookahead","flagsStr","cacheKey","regex","lastIndex","RegExp","_scoreRegexComplexity","score","captureGroups","_getTimeoutForRule","complexity","baseTimeout","_safeReplace","timeout","startTime","elapsed","applyToValue","strValue","extracted","_extractFlags","patternWithoutFlags","patternStr","inlineFlagMatch","flagStr","applyToTable","tableData","totalApplied","errors","isSimpleFormat","sheetMap","simpleTable","contentRowIndex","dataObj","tableInfo","tableModified","rows","rowIndex","colIndex","debug","tableError","errorMsg","applyToCell","applicableRules","currentValue","wasMatched","applyToRow","cell","previewBatchTransform","affectedCells","totalAffected","columnIndex","clearRegexCache","ValidationEngine","findColumnIndex","exactIndex","header","validateFormat","validateEnum","allowedValues","validateNumeric","strVal","numVal","endsWith","validateRelation","rawData","refSheet","sheetId","columns","col","refColIndex","validateRequired","validateKeyValue","ruleConfig","processedValue","pairs","pair","colonIndex","validateTableReadonly","oldContent","validateRowLimit","rowCount","validateSequence","numbers","allRowValues","escapedPrefix","parseInt","n","expectedNum","checkTableRules","snapshot","newData","violations","typeInfo","oldSheet","newSheet","padStart","rowIdx","validateValue","validateRow","rowTitle","ruleName","severity","validateAllData","allErrors","tableRules","fieldRules","rowErrors","validateTable","targetSheet","groupErrorsByTable","getErrorCount","LocalAvatarDB","DB_NAME","STORE_NAME","DB_VERSION","_db","_urlCache","init","Promise","resolve","reject","request","indexedDB","open","onsuccess","onupgradeneeded","db","objectStoreNames","contains","createObjectStore","keyPath","save","blob","store","transaction","objectStore","URL","revokeObjectURL","delete","put","url","createObjectURL","getKey","getAllNames","getAllKeys","getStats","getAll","items","totalSize","reduce","sum","count","totalSizeMB","toFixed","clearAll","FavoritesDB","update","updated","getAllTags","tagSet","tags","tag","getByTag","DiceHistoryStatsDB","autoIncrement","createIndex","unique","record","tx","oncomplete","recordEvent","payload","getDiceStatsContext","timestampRaw","entry","eventType","chatId","characterId","attrName","outcomeText","winner","summarize","records","checks","contests","checkSuccess","checkSuccessRate","getDashboardStats","all","hasChatScope","hasCharacterScope","chatRecords","characterRecords","chat","character","FavoritesManager","addFavorite","tableUid","rowData","SillyTavern","getCurrentChatId","crypto","randomUUID","sourceInfo","updateFavorite","duplicateFavorite","original","copy","deleteFavorite","addTag","removeTag","findCompatibleTables","favorite","currentTables","uid","table","tableHeader","h","isStrict","every","matchedCols","unmatchedCols","matchRatio","mapRowToTable","targetHeader","newRow","srcIndex","exportFavorites","exportedAt","importFavorites","jsonStr","added","newItem","getPlayerName","getDisplayName","getPersonaName","getContext","ctx","name1","$persona","first","getDisplayPlayerName","replaceUserPlaceholders","displayName","ST","directChatId","parsed","currentChatId","getCharData","currentChar","avatarId","avatar","cid","chars","characters","AvatarManager","load","raw","offsetX","offsetY","scale","aliases","getAsync","playerName","isPlayer","localUrl","userLocalUrl","primaryName","getPrimaryName","aliasLocalUrl","hasLocalAvatar","getOffsetX","_resolveByAlias","getOffsetY","getScale","setPosition","setScale","setAliases","exportTime","avatars","importData","jsonData","overwriteConflicts","current","stats","skipped","imported","analyzeImport","newItems","conflicts","parseCharacterName","rawName","trimmed","bestIdx","_","isCharacterTable","kw","toLowerCase","NameAliasRegistry","_autoAliases","_conflicts","_displayNames","rebuild","allTables","aliasOwners","nameIdx","alias","owners","manualPrimary","autoPrimary","getAliases","owner","manualAliases","getConflicts","isDisplayName","getEmojiCandidates","lowerName","candidates","emoji","getElementEmoji","lowerType","MvuModule","MODULE_ID","cachedEraData","cachedEraDataChatId","getCurrentChatIdSafe","clearMvuCacheIfChatChanged","isLwbChatContext","lwbGuard","globalThis","LWB_Guard","chatMetadata","eventEmit","eventOn","variablesUnknown","variables","ERAMetaData","stat_data","Mvu","getMvuData","mvuData","message_id","k","hasEraDataInCurrentChat","detectMode","_source","eraFrameworkExists","parseJsonSafe","getLwbData","display_data","delta_data","getEraData","timeoutId","setTimeout","eventOff","onResult","detail","clearTimeout","statWithoutMeta","schema","isAvailable","getData","lwbData","allVars","getMvuDataWithRetry","maxRetries","retryDelay","race","waitGlobalInitialized","attempt","isVWD","isSimpleArray","countChildren","extractNumericDisplayValue","str","rangeMatch","slashNumericMatch","commaDescMatch","numericDescMatch","extractFirstNumericValue","displayValue","renderRow","path","deltaData","changeIndicator","part","oldVal","newVal","getChangeIndicator","changedClass","valueClass","diceIconHtml","isNumericCell","numericValue","pathParts","renderCard","defaultExpanded","isHorizontal","childCount","collapsedClass","bodyHtml","hasNestedCards","nestedCardCount","childKey","childValue","childPath","itemPath","countText","bodyClass","nestedCardsNeedWidth","getDataWithRetry","detection","eraData","detectModeWithData","diagnoseVariableFramework","era","available","dataAvailable","mvu","apiExists","getDataExists","cache","hasCache","cacheKeys","recommendation","injectStyles","targetDoc","styleEl","renderNavButton","isActive","renderPanel","varMode","isEraMode","isNumericMode","layoutMode","panelTitle","numericHtml","visibleLevels","saved","numericItems","collectNumericItems","obj","levelNames","itemValue","numValue","newLevelNames","topKeys","filteredNumericItems","nonArrayLevels","levelKey","allLevelNames","levelNamesArray","levelTogglesHtml","levelButtonsHtml","levelName","isVisible","itemsHtml","pathLevels","hierarchyLevels","allLevelsVisible","pathDisplay","finalAttrName","displayStyle","levelsJson","renderNumericMode","cardsHtml","bindEvents","$container","$panel","off","stopPropagation","$card","closest","$body","is","hide","removeClass","addClass","slideDown","slideUp","refresh","newMode","saveActiveTabState","currentTab","getActiveTabState","renderInterface","toastr","toggleClass","$button","color","borderColor","opacity","each","$item","levels","newPathDisplay","$value","showEditDialog","setValue","preventDefault","$icon","showDicePanel","targetName","initiatorName","fromMvu","parsedInfo","initiator","filteredParts","parseMvuPathForDice","mvuPath","mvuParsedInfo","$doc","touchStartX","touchStartY","isHorizontalSwipe","originalEvent","touches","clientX","clientY","touch","deltaX","deltaY","stopImmediatePropagation","$input","focus","button","handle","setPointerCapture","pointerId","startHeight","height","startY","onpointermove","moveE","dy","newHeight","onpointerup","upE","releasePointerCapture","getTableHeights","saveTableHeights","heights","onSave","html","select","ctrlKey","parsePath","rootName","subPath","setLwbValue","saveMetadata","onWriteDone","setEraValue","setMvuVariable","is_recursive","replaceMvuData","isModuleTab","$refreshBtn","then","canWriteMvuPanel","actualData","warning","catch","err","DEFAULT_DICE_CONFIG","critSuccessMax","hardSuccessDiv","difficultSuccessDiv","critFailMin","lastDiceType","dndCritSuccess","dndCritFail","contestTieRule","hideDiceResultInChat","autoMergeProtagonist","saveDiceConfig","cfg","oldCfg","newCfg","changedKeys","hideDiceResultsInUserMessages","hideInput","hideChat","textareaVal","modifiedText","lastMessageId","getLastMessageId","userMessages","getChatMessages","role","hiddenCount","msg","$msgElement","messageId","retrieveDisplayedMessage","$el","idText","$chat","getMessageElement","$mesText","currentDomText","currentHtml","modifiedHtml","metaRegex","replacedText","replacedFromOriginal","formatAsDisplayedMessage","elem","$elem","$target","replaced","restoredCount","BUILTIN_ADVANCED_PRESETS","kind","diceExpression","placeholder","defaultValue","hidden","mod","customFields","contestOverride","derivedVars","dicePatches","when","template","triggerPatterns","pushedRoll","pushableOutcomes","blockedOutcomes","excludePatterns","outcomeLabels","crit_success","extreme_success","resourceBurners","resourceName","ratio","direction","suggestedAmount","selector","namePatterns","include","exclude","ui","tooltip","quickActions","carryInitiator","carryAttrValue","carryTarget","carryModifier","carrySkillMod","attrAliasCandidates","fallbackAttrName","carryAttrName","outcomes","rank","contestRank","displayExpr","outcomePolicy","requiredRankVarId","unmetOutcomeId","keepActualOutcome","durationImmediate","durationSummary","symptom","contestRule","tieBreakers","outputTemplate","visible","currentAttrAutoUpdate","valueExpr","changeLabel","outputTextTemplate","computeModifier","skillMod","attrTargetMapping","hideDc","contestOutputTemplate","disabled","BUILTIN_ATTRIBUTE_PRESETS","baseAttributes","range","specialAttributes","AttributePresetManager","presetVersion","finalId","updateTemplateForActivePreset","updatePreset","exported","autoUpdate","needsUpdate","STORAGE_KEY_ACTIVE_ADVANCED_PRESET","AdvancedDicePresetManager","getBuiltinPresetVisibilityMap","getBuiltinPresetOrderMap","builtinVisibilityMap","builtinOrderMap","processedBuiltin","order","processedCustom","setBuiltinPresetVisibility","setPresetOrder","attributeLabel","dcLabel","supportsContest","presetObj","DEFAULT_SPECIAL_ATTR_TEMPLATE","DEFAULT_VIRTUAL_PRESET","replaceTag","attrs","generateRPGAttributes","baseRangeMin","baseRangeMax","specialRangeMin","specialRangeMax","baseRanges","specialRanges","baseEntries","base","specialEntries","special","dbApi","getDB","getTableTemplate","attributeScaleStr","threshold1","floor","threshold2","threshold3","threshold4","threshold5","formatRange","start","end","generateAttributeScale","baseRangeStr","specialRangeStr","attributeRulesContent","modified","checkTemplateFormat","note","sheetName","sheet_protagonist","sourceData","sheet_important_npc","protagonistSheet","originalNote","npcSheet","importTemplateFromData","BUILTIN_ACTION_PRESETS","table_keywords","actions","ActionPresetManager","getPresetById","getActivePresetId","setActivePresetId","getCrazyModeConfig","saveCrazyModeConfig","shouldTriggerCrazyMode","selectCrazyParticipant","processJsonData","playerResult","DashboardDataParser","findTable","npcResult","playerAttrs","inScene","weight","parseRows","npc","inSceneVal","isInScene","npcAttrs","totalWeight","weightedRandomSelect","selectCrazyAttribute","participant","randomAttr","allPresetAttrs","randomPresetAttr","skillPool","getRandomSkillPool","crazyRollWithPreset","diceExpr","rollTotal","attrMod","rawDice","generateCrazyRoll","rollType","contestChance","selectCrazyRollType","rollData","participant1","participant2","attr1","attr2","rollData1","rollData2","result1","result2","margin1","margin2","total1","total2","presetLabel","rollDiceExpression","rollDice","sides","NaN","keptDice","breakdown","countStr","sidesOrF","cocPart","rerollPart","explodePart","keepDrop","successPart","isFate","toUpperCase","rolls","rerollType","rerollCompare","rerollValue","m","checkReroll","explodeType","explodeCompare","explodeValue","checkExplode","cocType","cocCount","units","allTens","finalTens","rerollCount","nextToCheck","explodeCount","kd","sorted","sm","isSuccess","diceToCheck","totalText","diceList","simpleResult","allRawDice","allKeptDice","breakdownParts","allTags","diceResult","signedValue","varNames","Function","functionHandlers","minArgs","maxArgs","POSITIVE_INFINITY","evaluateExpression","expression","illegal","tokens","char","threeChar","twoChar","lastToken","ops","prec","assoc","outputQueue","operatorStack","pop","o1","o2","evalStack","res","normalizeNumberLiteral","splitArguments","argsText","inQuote","findMatchingParen","startIndex","evaluateArgumentValue","argExpr","exprWithVars","resolved","resolveFunctions","evalResult","isIdentifierStart","isIdentifierChar","nameLower","nextIndex","closeIndex","handler","valueResult","fnResult","_match","evaluateOutcomes","outcome","conditionResult","formatOutputTemplate","missingKeys","generateAttributeValue","DASHBOARD_TABLE_CONFIG","tableKeywords","detailLocation","fallbackIndex","currentLocation","player","status","position","isMultiple","money","resources","location","quest","progress","active","column","excludeColumn","excludes","bag","skill","equip","isEquipped","equipped","moduleKey","keyword","columnKey","moduleConfig","colConfig","getValue","getColumnMap","colKey","tableResult","colMap","_rowIndex","_raw","colIdx","applyFilter","parsedRows","filterKey","matchInclude","inc","excludeValue","matchExclude","exc","DEFAULT_GM_CONFIG","diceSystem","showDiceIcon","autoSendPrompt","action_groups","auto_send","getResultBadgeClass","resultType","classMap","critSuccess","extremeSuccess","critFailure","ACTION_ICON_MAP","getActionsForTable","baseConfig","action_rules_disabled","customActionGroups","action","custom_action_groups","getGMConfig","group","builtinRules","getInteractOptionsForRow","defaultActions","interactColIdx","invalidValues","cellValue","interactOptions","existingLabels","newActions","opt","extractNumericValue","matches","parseAttributeString","rawStr","jsonObj","parseRelationshipString","colonMatch","parenMatch","isRelationshipCell","headerName","lowerHeader","processTemplate","cardData","ACTION_BUTTONS","title","isInitialized","isSaving","saveQueue","isEditingOrder","isSettingsOpen","modalStack","pushModal","show","popModal","prev","currentDiffMap","observer","_boundRenderHandler","hasUnsavedChanges","pendingDeletions","getPendingDeletions","isAutoTransforming","tablePageStates","tableSearchStates","lastOptionHash","optionPanelVisible","STORAGE_KEY_SCROLL","tableScrollStates","UpdateController","_lastValidationCount","_isRollingBack","handleUpdate","loadSnapshot","fillTable","timeOut","positionClass","fillError","newCount","updateValidationIndicator","$indicator","DEFAULT_CONFIG","layout","collapseStyle","collapseAlign","cardWidth","fontSize","highlightNew","itemsPerPage","actionsPosition","gridColumns","positionMode","showOptionPanel","clickOptionToAutoSend","optionFontSize","muteDatabaseToasts","FONTS","THEMES","_coreCache","core","clipboard","updateSaveButtonState","$btn","deletions","hasDeletions","getIconForTableName","getBadgeStyle","def","retryErr","_acuQuotaAlerted","clearAllPanelStates","getSavedTableOrder","saveTableOrder","getCollapsedState","saveCollapsedState","getOptionsCollapsedState","currentCtx","_contextId","saveSnapshot","getTableStyles","getHiddenTables","getReverseTables","toggleTableReverse","getAttributesForCharacter","isUser","nameColIdx","normalizeAttributeName","resolveAttributeAliasName","allAttrs","orderedCandidates","lowerMap","lower","normalizedGroups","normalized","found","STANDARD_ATTRS","allPresets","RANDOM_SKILL_POOL","isDNDOrPreset","isDND","generate3d6","generateValue","adjust","baseResult","specialResult","clearPresetAttributesForCharacter","charName","targetRowIndex","baseColIndex","specialColIndex","saveDataOnly","writeAttributesToCharacter","newAttrs","specialAttrs","standardAttrs","getStandardAttrs","presetSpecialAttrNames","existingBaseStr","existingBaseAttrs","existingBaseMap","standardCount","isComplete","customBaseAttrs","baseResultParts","newBaseAttrString","newSpecialAttrString","existingSpecialStr","existingSpecialAttrs","existingSpecialMap","customSpecialAttrs","specialResultParts","attrDef","writtenAttrs","attrString","specialAttrString","wasComplete","targetColIndex","fallbackAttrColIndex","attrColIndices","collectAttrCols","cols","pickFallbackAttrCol","targetAttrName","cellStr","existingStr","existingAttrs","existingMap","Infinity","resultParts","processedNames","newAttrString","initCustomDropdown","inputId","wrap","$dropdown","after","renderItems","lowerFilter","hideDropdown","addClearButton","inputSelector","$clearBtn","savedDiceType","rawDataForList","diceCharacterList","diceAttrList","unshift","diceType","successCriteria","initialAttrValue","initialTargetValue","overlay","defaultCriteria","quickPresetsHtml","panel","customDiceExpr","effectRunCleanerTimerKey","buildAttrButtons","$parentSection","targetField","currentAdvancedPreset","fieldId","names","prop","originalHtml","originalHandler","generated","baseAttrs","shortName","resolvedName","buildCharButtons","randomSkill","newAttrList","updateRuleMode","$targetInput","$difficultyWrapper","$row3","lastVisiblePresetId","pendingEffectRuns","activeConfirmEffectRun","effectRunRetryTimer","effectRunEventSeq","messageMutationQueues","getPresetQuickActions","isQuickActionVisible","attrRaw","modRaw","targetRaw","buildQuickActionContext","renderPresetQuickActions","empty","waitMs","ms","injectEffectLinesIntoMeta","runId","task","enqueueMessageMutation","retryDelays","delay","msgs","msgRole","extraObj","extra","injectedRunsRaw","acuEffectInjectedRuns","injectedRuns","closingCandidates","closingIdx","closingTag","lastIndexOf","hasRawOpen","hasRawClose","hasEscapedOpen","hasEscapedClose","beforeClose","needsLeadingNewline","updatedMsg","setChatMessages","verifyMsg","verifyText","lineHitCount","line","injectEffectLinesIntoTextarea","missingLines","hasMetaInTextarea","emitEffectRun","emitEvent","seq","getSecondaryTriggerMode","setHistoryEffectState","historyIndex","patch","checkHistory","historyEntry","nextPatch","fromStatus","toStatus","effectStatus","planned","confirmed","committed","failed","cancelled","assign","setHistoryEffectStateByRun","byRunId","effectRunId","findHistoryIndexByRunId","resolveLatestMetaUserMessageId","lastId","enqueueEffectRun","expiresAt","processPendingEffectRuns","incomingMessageId","hit","mid","normalizeMessageId","nextPending","executableRuns","consumedByMessage","consumedByFallback","errMsg","effectError","effectTrace","effectEventSeq","withinFallbackWindow","guessedMsgId","hasFailure","latestAttrResult","reverse","metaLines","msgId","injectErr","existingCleaner","clearInterval","setInterval","cleanupExpiredEffectRuns","applyFieldConfig","$label","defaults","$wrapper","matchesCheckSelector","normalizedName","matchesAnyPattern","patterns","escaped","wildcardToRegex","applyAdvancedPreset","$modWrapper","$row1","$row2","$customArea","$attrWrapper","$targetWrapper","$skillModWrapper","$nameWrapper","$attrNameWrapper","restoreRow1","detach","prependTo","appendTo","restoreModifier","restoreRow2","insertAfter","gridItems","effectInputItems","defaultVal","defaultValues","renderEffectInputs","modDefault","f","field","isSelected","isChecked","placeholderText","appendItem","$row","computeRowLayout","gridRowLayout","itemIndex","colCount","j","isWorkMode","$normalPresets","$workflowReturn","customExpr","targetPresetId","targetPreset","firstVisible","actionId","executePresetQuickAction","savedPresetId","parseModifier","modStr","activatePresetQuickAction","previousState","customFieldValues","$field","_index","element","configuredTargetPreset","presetAllowedTargets","mergedCandidates","workflowAction","fallbackName","executeAttrShortcutQuickAction","handleResourceBurnerClick","burner","rawInitiatorName","currentResource","showBurnerInputDialog","d1","d2","d3","initialLuck","rawCharName","currentThemeClass","suggestedValue","suggestedHint","rawNeeded","ceil","resourceOperation","isAddMode","actionVerb","maxAttr","dialog","updatePreview","amount","effectValue","newRoll","newAttr","beforePass","afterPass","beforeColor","afterColor","applyBurnerEffect","showEffectConfirmDialog","outcomeLabel","onConfirm","uiCfg","effectConfirmUi","dialogTitle","effectListTitle","branchReasonLabel","resolvedTarget","beforeValue","afterValue","conditionSummary","resolveEffectConditionPreview","effectContext","outcomeName","conditionExpr","resolvedConditionExpr","conditionPassed","passed","resolvedExpr","handleEffectConfirmation","staleRun","needsConfirmEffects","needsConfirm","computedEffects","$inputGroup","inputValue","displayText","conditionPreview","computeEffectsFromInputs","eff","confirmedRun","totalChange","$modInput","newMod","performAdvancedCheck","$dcInput","newDc","$attrInput","resolveDefaultValue","attrInputVal","dcInputVal","skillModStr","modFormula","customValues","fieldConfig","rawVal","baseContext","$attrMod","$skillMod","derivedValues","spec","varName","extraValues","patchContext","replacePatchTemplate","resolvedTemplate","postRollDerivedValues","postRollContext","isPushed","$isPushed","displayExprResult","originalOutcome","requiredOutcome","requiredRank","actualRank","o","fallbackOutcome","displaySourceOutcome","safeKey","displayExprEvalResult","badgeClass","displayOutcomeText","exprDisplay","$rollBtn","burnerContext","burnersHtml","renderResourceBurnerButtons","$burners","burnerId","outcomeId","isBlocked","blockOnCritFailure","$pushBtn","$burnersContainer","judgeResultText","pushedLabel","outcomeTextRaw","attrModStr","skillModText","modText","attrModText","derivedOutputVars","cleanKey","customOutputVars","effectVars","effectTarget","effectOperation","effectDelta","effectDeltaFormula","effectOldValue","effectNewValue","effectSummary","effectText","hasEffect","effectCount","firstEffect","operationMap","subtract","summaries","pending","computePendingEffectVariables","outputContext","judgeResult","diceResultText","checkResult","criteria","isAutoTarget","detailId","checkResultWithTimestamp","historyType","detailLines","MAX_HISTORY","plannedSeq","confirmedSeq","autoContext","$success","resolveExpressionWithContext","changeValue","targetAttr","beforeValueRaw","previewAfterValue","minValue","maxValue","previewDelta","computedAutoEffect","finalAttr","exprRaw","rolledText","exprNormalized","exprWithRoll","settledContext","attrPlain","old","new","rolled","settledTemplate","settledLine","autoRunId","currentAttrName","performCustomRoll","judgeMode","targetValueStr","expectedValue","diceMatch","expectedPerDie","keptCount","keepDropType","keepDropValue","calculateDiceExpectedValue","autoTargetValue","hasJudgement","displayInitiator","displayAttrName","displayOutcome","lastDiceRollAt","performDiceRoll","difficulty","hardDiv","extremeDiv","targetInputVal","getDefaultTarget","formulaStr","maxRoll","parsedTarget","basicMatch","sidesStr","requiredTarget","difficultyLabel","difficultyDiv","isCritSuccess","isCritFailure","outcomeClass","extremeTarget","hardTarget","criteriaSymbol","displayConditionExpr","judgeExpr","attrValueInput","currentDice","initiatorNameVal","closePanel","showContestPanel","initiatorValue","showGlobalDiceHistoryDialog","showAdvancedPresetManager","fromDicePanel","getSuccessLevel","opponentName","passedInitiatorName","passedInitiatorValue","passedOpponentValue","opponentValue","opponentAttrs","characterList","contestAttrList","attrStr","targetType","contestAvailablePresets","currentActivePreset","activePresetId","panelHtml","buildCharBtns","containerId","rebuildAttrBtns","aname","targetInput","getContestAttrTargetInput","refreshedAttrs","initAttrs","oppAttrs","currentContestAdvancedPreset","party","mapping","applyContestAdvancedPreset","$initValuesRow","$oppValuesRow","$initPrimaryRow","$oppPrimaryRow","$initCustomFields","$oppCustomFields","$initAttrWrapper","$initSkillModWrapper","$initModWrapper","$initTargetWrapper","$oppAttrWrapper","$oppSkillModWrapper","$oppModWrapper","$oppTargetWrapper","$initAttrLabel","$initSkillModLabel","$oppAttrLabel","$oppSkillModLabel","$initTargetLabel","$oppTargetLabel","$initModLabel","$oppModLabel","$initAttrInput","$oppAttrInput","$initSkillModInput","$oppSkillModInput","$initModInput","$oppModInput","updateRowColumns","visibleCount","buildContestCustomFieldCell","extraClass","fieldLabel","fieldType","option","optValue","inputType","renderCustomFields","visibleFields","rowLayout","restoreDefaults","rebuildDefaultRow","$skillWrapper","children","not","attrLabel","skillModLabel","modLabel","attrPlaceholder","skillModPlaceholder","modPlaceholder","hideDcInContest","hideModInContest","hideMod","hideSkillModInContest","hideSkillMod","visibleContestFields","customFieldCount","baseVisibleCount","totalFields","customField","renderPrimaryInlineField","buildIntegratedRow","visibleItems","$base","$customContainer","appendItemTo","firstRowCols","$gridRow","savedContestPreset","savedSupportedContestPreset","defaultContestPresetId","$matchedBtn","$defaultBtn","fullAttrs","newDice","performCustomContestRoll","initDiceExpr","oppDiceExpr","judgeRule","tieRule","rawDataForAlias","initNameRaw","initName","initAttrName","oppNameRaw","oppName","oppAttrName","initRoll","oppRoll","errorExpr","initTotal","oppTotal","winnerText","compareExpr","initDisplayRoll","oppDisplayRoll","showOutcome","initOutcomeText","oppOutcomeText","customContestWithTimestamp","successLevel","contestHistory","lastContestRollAt","performContestRoll","hasAdvancedPreset","getHalfMax","initValueInput","initTarget","initTargetInput","oppValue","oppValueInput","oppTarget","oppTargetInput","initModInput","oppModInput","initSkillModInput","oppSkillModInput","initMod","oppMod","initSkillMod","oppSkillMod","fallbackPresetId","fallbackPreset","collectContestCustomFields","computeDerivedVars","modValue","dcValue","applyDicePatches","baseFormula","initCustomValues","initDerivedValues","initFormula","oppCustomValues","oppDerivedValues","oppFormula","initResult","oppResult","initRollTotal","oppRollTotal","initAttrMod","oppAttrMod","initContext","oppContext","initOutcome","oppOutcome","winnerSide","initAttr","oppAttr","initRank","oppRank","$initValue","$oppValue","$initRank","$oppRank","tieBreaker","resolveContest","winnerResultType","displayInitValue","displayOppValue","displayInitSuccessName","displayOppSuccessName","displayWinner","getResultTypeFromOutcome","initResultType","oppResultType","initBadgeClass","oppBadgeClass","winnerColorClass","$resultDisplay","$resultInit","$resultOpp","initDisplayExpr","oppDisplayExpr","initConditionExpr","oppConditionExpr","initDisplayExprResult","oppDisplayExprResult","initJudgeResult","oppJudgeResult","margin","initAttrModStr","initSkillModStr","initAttrModText","initSkillModText","initModText","oppAttrModStr","oppSkillModStr","oppAttrModText","oppSkillModText","oppModText","contestOutputContext","opponent","initSuccessName","oppSuccessName","shifts","contestResultText","getOutcomeLevel","contestResult","contestDetailId","contestResultWithTimestamp","currentInitName","parseInSceneStatus","buildMapViewModel","globalResult","locationResult","elementResult","globalHeaders","globalRow","globalConfig","detailIdx","regionIdx","currentRegion","locations","locationHeaders","locationRows","locationNameIdx","locationRegionIdx","locationTypeIdx","locationDescIdx","locationImportanceIdx","locationExploreIdx","allLocationNames","emojiMap","candidatesMap","sortedNames","localeCompare","usedEmojis","resolveBatchLocationEmojis","region","locationType","importance","exploreStatus","elements","elementHeaders","elementRows","elementNameIdx","elementTypeIdx","elementLocationIdx","elementDescIdx","elementStatusIdx","elementInteractIdx","locationName","rawInteractions","interactions","typeValue","addElement","addCharacter","avatarUrl","full","avatarOffsetX","avatarOffsetY","avatarScale","playerLocation","playerConfig","playerHeaders","playerRow","playerNameIdx","playerPosIdx","playerNameRaw","playerPosRaw","npcConfig","npcHeaders","npcRows","npcNameIdx","npcPosIdx","npcInSceneIdx","npcName","inSceneValue","inSceneHeader","firstLocation","allRegions","l","otherIndex","focusLocation","fallbackRegion","regionLocations","regionName","scoreA","getHotLocationsInRegion","isMapOpening","showMapVisualization","viewModel","tabSelectionCache","selectedRegion","targetLocation","overlayEl","setProperty","$focusArea","$thumbnails","renderIconContent","renderElementChip","refreshPanel","model","leftChars","rightChars","leftElems","rightElems","renderAvatarHtml","avatarStyle","charAt","leftAvatarsHtml","rightAvatarsHtml","leftElemsHtml","rightElemsHtml","emojiHtml","renderFocusArea","thumbnails","totalCount","badgeHtml","renderThumbnailLocation","regions","newViewModel","newFocus","newRegion","regionLocs","loc","firstLoc","cachedLocation","hotLocations","fallbackFocus","targetRegion","showRelationshipGraph","npcTable","relationIdx","npcTableKey","nodes","edges","resolveName","personaName","explicitUserVariants","isExplicitUserVariant","isPersonaName","isPlayerName","resolveUserPlaceholder","resolvedPlayerName","playerTableKey","x","y","inSceneColIdx","rawNpcName","relationStr","rel","resolvedRelName","relRowIndex","relIsInScene","ri","cleanedLabels","rawRel","commonRelations","specialSuffixMatch","lastChars","cleanRelation","existingEdge","combined","labelsFromSource","labelsFromTarget","playerRelIdx","playerRelations","rawLabel","nodeArr","connectionCount","edge","isMobileView","innerWidth","baseRadius","maxRadius","playerBaseRadius","radiusPerConnection","nodeSizeMultiplier","filterInScene","filterDirectOnly","centerNodeName","getNodeRadius","nodeName","sqrt","radius","getLayoutCacheKey","loadLayoutCache","cached","layoutData","allNodesFound","vx","vy","clearLayoutCache","runForceDirectedLayout","angle","PI","dist","cos","sin","nodeMap","iter","u","dx","distSq","force","fx","fy","maxSpeed","vMag","saveLayoutCache","panX","panY","$svg","$transform","$edgesGroup","$nodesGroup","$zoomDisplay","$nodeSizeDisplay","updateTransform","updateNodeSizeDisplay","zoomTo","newScale","centerX","centerY","oldScale","scaleChange","render","filteredNodes","directNodes","passInScene","passDirectOnly","getFilteredNodes","filteredNodeNames","filteredEdges","edgesHtml","edgeIdx","len","nx","ny","px","py","hasFromSource","hasFromTarget","sourceRadius","targetRadius","x1","y1","x2","y2","srcLabels","tgtLabels","srcSet","tgtSet","commonLabels","srcUnique","tgtUnique","markerStart","markerEnd","midX","midY","lineLen","renderRelationIconInline","iconStr","addRelationIconInline","lbl","offsetDir","offsetDist","lx","ly","safeOffset","renderRelationIcon","addRelationIcon","truncateLabel","maxLen","truncated","createLabelHtml","labelsToShow","labelBaseX","labelBaseY","perpOffset","nodesHtml","nodeAvatar","indicatorRadius","indicatorOffset","inSceneIndicator","nodeDisplayName","scaleVal","foSize","shadowWidth","foOffset","highlightNode","connectedNodes","otherNode","connectedEdgeIndices","clearHighlight","matchMedia","currentHighlightedNode","$node","startX","hasMoved","longPressTriggered","longPressTimer","vibrate","rowName","tempNode","isPanning","panStartX","panStartY","panStartPanX","panStartPanY","lastPinchDist","activePointerId","wrapperEl","svgEl","onpointerdown","cursor","rect","getBoundingClientRect","width","onpointercancel","onwheel","hypot","passive","newDist","$nodeSizeSlider","$sliderSizeDisplay","$sliderContainer","$nodeSizeDisplayTrigger","sliderVisible","sliderHideTimer","hideSlider","resetSliderHideTimer","triggerRect","wrapperRect","showSlider","$filterInSceneBtn","$filterDirectOnlyBtn","updateFilterToggleStyles","$centerDropdown","$centerTrigger","$centerMenu","$centerLabel","newCenter","$nodeSizeStepper","step","updateNodeSizeValue","newPercent","getCurrentPercent","showAvatarManager","closeGraph","showAvatarCropModal","imageSource","modalHtml","$modal","$image","containerEl","imageEl","updateImageStyle","backgroundSize","backgroundPosition","isDragging","startOffsetX","startOffsetY","sensitivity","pinchStartScale","pinchRatio","file","files","saveLocalAvatar","newUrl","onUpdate","currentView","sortBy","sortOrder","searchQuery","expandedItems","isInitialLoad","resolveUserPlaceholderForAvatar","buildList","listHtml","allAvatarData","workingNodes","seenNames","merged","userNode","otherNodes","query","nameMatch","aliasMatch","nodeSourceMap","hasLocal","hasUrl","getSourcePriority","cmp","timeA","timeB","userNodeForDisplay","currentUrl","displayUrl","sourceLabel","hasAvatar","isExpanded","applyAvatarPreviewStyles","$root","$preview","managerHtml","$manager","bindAvatarEvents","refreshItem","refreshList","findCharacterInTable","avatarData","allNames","nameColumns","findRelationshipReferences","references","tKey","tData","nameColIndex","relationColIndex","rowCharacterName","relationValue","splitResult","refName","relationWord","relationText","matchedRelation","showDeleteConfirmModal","tableRow","relationships","avX","avY","avScale","aliasRows","lowerAliases","closeModal","handleKeydown","executeCharacterDelete","deleteLocalAvatar","newView","debouncedSearch","debounce","toggle","newDir","exists","tagHtml","before","cleanPart","pastedData","clipboardData","pendingAlias","Blob","href","download","removeChild","reader","FileReader","onload","evt","analysis","showImportConfirmDialog","readAsText","closeManager","clearDiceSystemCache","cacheNames","caches","urlPatterns","cacheName","requests","showManualUpdateDialog","iconClass","safeTitle","safeDescription","confirmText","loadingText","isDanger","safeIconClass","reload","onComplete","hasConflicts","conflictListHtml","overwrite","showCardEditModal","displayRow","inputsHtml","adjustHeight","el","contentHeight","scrollHeight","overflowY","requestAnimationFrame","currentRow","hasChanges","saveRowInstantly","_configCache","saveConfig","fontVal","applyConfigStyles","generateDiffMap","currentData","lastData","diffSet","rIdx","newRows","oldRows","oldRowMap","matchedOldIndices","matchedOldRow","oldRow","cIdx","oldCell","$styleTag","fontImport","cssVars","cls","$optContainer","addStyles","_acuStylesInjected","styles","sheetCount","getDbChatMessages","st","rawChat","parseIsolatedData","hasSheetKeys","hasDbPayload","TavernDB_ACU_IndependentData","TavernDB_ACU_Data","TavernDB_ACU_SummaryData","isolated","TavernDB_ACU_IsolatedData","tagData","independentData","findLatestDbMessageIndex","includeUser","is_user","relocateDbPayloadToAnchor","anchorIndex","latestIndex","moved","sourceIsolated","targetIsolated","isolationKey","TavernDB_ACU_Identity","identity","hasOwnProperty","resolveIsolationKey","nextSource","TavernDB_ACU_ModifiedKeys","TavernDB_ACU_UpdateGroupKeys","triggerSlash","saveDataToDatabase","skipRender","commitDeletes","$saveBtn","mate","sizeInMB","stringifyError","importTableAsJson","apiError","acuModifiedSet","newRowData","tables","rawContent","exportConfig","updateConfig","refreshRegexRulesList","$rulesList","scopeIcon","scopeText","showAddValidationRuleModal","parentDialog","editRuleId","isEditMode","updateSelectColor","$select","$colSelect","$pairedTableSelect","currentPairedValue","refTableName","$refColSelect","isTableRule","valuesStr","refColumns","selectedColumns","pairedTable","finalRuleId","ruleData","$existingItem","isEnabled","ruleHtml","showSmartFixModal","snapshotValue","hasSnapshotValue","showTableRuleFixModal","inputHtml","smartSuggestHtml","examples","currentRowIndex","maxCount","getColumnExamples","tableContent","existingValues","prefixMatch","digits","codeIndex","existingNumbers","codeValue","maxNum","nextNum","numOnlyMatch","suggestFormatValue","currentNum","isOutOfRange","nearestValid","getNearestValidNumber","getRelationOptions","hasMultipleColumns","currentInvalidValue","valueExists","isValueInRelationTable","optionsHtml","reverseWriteHtml","issues","fixedPairs","fixedVal","hasIssue","originalVal","fixedValue","hasIssues","issuesHtml","issue","optionValue","refSheetId","targetColIdx","fill","extractCodesFromTable","codes","allCodes","codeToRows","isValid","buildCodeMapping","codes1","codes2","allUniqueCodes","codeNumbers","oldCode","newCode","alignAndFixPairedTables","table1Sheet","table1SheetId","table2Sheet","table2SheetId","fixedCount1","fixedCount2","headers1","rows1","colIndex1","headers2","rows2","colIndex2","reverseMapping","sortedNewCodes","analyzeTable","codeRows","emptyRows","prevOldCode","nextOldCode","emptyRow","prevCode","nextCode","codeRow","analysis1","analysis2","buildNewRows","allOldCodes","codeRowMap","cr","isCodeRow","isInserted","codeRowIndex","nextNewCode","currentNewCode","currentOldCode","newRows1","newRows2","countCodeChanges","oldAnalysis","oldCodes","newCodes","contentHtml","actionBtns","changeCount","changeDetails","c","d","minRows","maxRows","currentRowCount","excessRows","isTooMany","isTooFew","fixSuggestions","originalRowIndex","numCountMap","duplicates","gaps","outOfOrder","actualNum","rowNum","occurrences","issueSet","g","fix","pairedTableAttr","pairedTableName","targetSheetId","pairedSheet","pairedSheetId","pairedHeaders","extract1","extract2","fixedCount","startRow","showBlacklistManagerModal","bottom","padding","updateTextarea","uniqueItems","syncFromTextarea","input","existingSet","addedItems","which","confirm","showAttributePresetManager","allPresetsHtml","isBuiltin","$toggle","$thisToggle","showAttributePresetEditor","filename","defaultPresetData","copyData","parsedData","importingName","existingPresets","hasConflict","doImport","finalJson","existingPreset","isEdit","defaultData","$jsonTextarea","updateJSON","createSortableList","container","HTMLElement","ghostClass","dragClass","placeholderClass","indicatorClass","longPressDelay","state","draggedItem","ghost","indicator","timer","startOrder","buildOrder","ids","itemSelector","getItemId","clearTimer","cleanupGhost","parentElement","cleanupIndicator","updateGhostPosition","placeIndicator","insertBefore","className","ensureIndicator","nextSibling","startDrag","captureEl","cloneNode","classList","pointerEvents","finishDrag","replaceChild","finalRect","transition","newOrder","orderChanged","onOrderChange","cancelSelector","handleSelector","refreshDicePanelPresets","showPresetListDialog","presetsHtml","showAdvancedPresetEditor","copied","$list","newOrderIds","ev","crazyConfig","selectValue","initCrazyModeUI","showActionPresetManager","keywordsSummary","flatMap","actionsSummary","showActionPresetEditor","accept","onchange","savedFilters","renderLogs","filteredLogs","$logContainer","logItem","updateCounts","checked","$status","newState","TavernHelper","safeContent","isSecureContext","writeText","textArea","setAttribute","setSelectionRange","successful","execCommand","refreshInterval","showAddRegexRuleModal","editRule","scopeType","$textarea","extractedFlags","$flagGlobal","$flagIgnoreCase","$flagMultiline","uiFlags","finalPattern","finalFlags","rootWindow","resolveRootWindow","readyCallbacks","isAcuDiceReady","runReadyCallback","defineAcuDiceOnWindow","AcuDiceAPI","writable","dispatchReadyEvent","dispatchEvent","CustomEvent","eventHandlers","rootWindowWithHistory","__AcuDiceHistoryStore__","maxHistory","sharedHistoryStore","globalExpandedHistoryIds","globalHistoryFilterStatus","globalHistoryKeyword","globalHistoryStatsScope","detailCopyTextMap","renderHistoryItems","statusTextMap","statusColorMap","isContest","statusText","statusColor","detailLinesRaw","traceLinesRaw","traceLines","canExpand","subtitle","resultColor","rollText","typeTag","pushedBadge","sections","copyParts","toLocaleString","detailHtml","renderHistoryStats","$stats","allStats","activeStats","mobile","scopeUnavailable","rerender","refreshByEvent","canListen","AcuDice","detailText","ok","copyTextWithTavernApi","handlers","hasDice","isMath","check","finalRoll","criticalSuccess","criticalFailure","hardSuccess","onReady","getLatestCheck","getLatestContest","getHistory","limit","concat","_type","listPresets","getPresetSummary","listCharacters","getCharacterAttributes","checkByCharacter","contest","attacker","defender","leftName","rightName","leftTarget","rightTarget","leftResult","rightResult","sidesMatch","leftSuccessLevel","rightSuccessLevel","notifyReady","showFavoriteEditModal","fav","overlayHtml","newRowHtml","newHeader","newTags","showSendToTableModal","compatible","onSuccess","tableListHtml","modeLabel","unmatchedInfo","unmatchedCount","showSettingsModal","expandedGroups","isGroupExpanded","groupId","SPECIAL_BUTTONS_CONFIG","tableManagerHtml","savedOrder","hiddenList","allItems","isSpecial","orderMap","isHidden","specialClass","chevron","hasIntercept","$group","$chevron","expanded","targetHeight","animate","currentHeight","outerHeight","newTheme","newStyle","$alignRow","$stepper","updateValue","unit","getCurrentValue","isCurrentlyActive","fadeOut","refreshPresetUI","prompt","currentState","currentPreset","$presetSelect","defaultPresetId","versionSuffix","tavernRegexList","scriptName","findRegex","importedCount","skippedCount","processNext","convertedRule","tavernRegex","parseTavernFindRegex","extraInfo","placement","markdownOnly","promptOnly","minDepth","replaceString","runOnEdit","convertTavernRegexToRule","oldRule","removedLocalStorageKeys","allSettled","clearDiceLocalCacheData","renderInterfaceTimer","renderInterfacePending","saveCurrentTabState","_renderInterfaceImpl","mutationLock","MutationObserver","lastChild","last","wrapper","observe","childList","isDataFromDatabase","enabledRules","transformResult","transformError","structuredClone","existingSnapshot","hasValidSnapshotData","$searchInput","activeTab","currentTabName","newHtml","renderTableContent","$virtualDom","replaceWith","bindOptionEvents","lastScrollX","lastScrollY","$oldContent","scrollLeft","scrollTop","orderedNames","isCollapsed","layoutClass","finalGridCols","empty3","optionHtml","currentOptionHash","optionTables","isOptionsCollapsed","collapseIcon","optionCount","hasBtns","optionValues","buttonsHtml","optionChanged","colStyleClass","alignClass","savedHeight","isDashboardActive","isChangesPanelActive","isMvuActive","finalSavedHeight","renderChangesPanel","renderDashboard","gridFixStyle","isChangesActive","isFavoritesActive","isSimpleModeNav","changesCount","validationErrorCount","oldRowsByTitle","queue","hasChange","newTitleCounts","oldTitleCounts","oldCount","emptyOldCount","emptyNewCount","displayCount","showWarningIcon","navHiddenList","navSavedOrder","SPECIAL_NAV_ITEMS","warningIcon","allNavItems","checkAvailable","activeClass","orderVal","warningIconHtml","$existing","insertHtmlToPage","injectIndependentOptions","$lastAiMes","$this","containerVisible","containerDisplay","containerHtmlLength","loadDashboardNpcAvatars","bindChangesEvents","$newContent","savedState","inner","$targetTitle","htmlContent","$aiMes","$targetMes","$targetText","$targetBlock","getTargetContainer","optConfig","createChatMessages","executeSlashCommandsWithOptions","cmd","sendResult","isError","isAborted","ta","sendBtn","enterEvent","Event","keyCode","bubbles","$textDiv","hasImage","targetIndex","eq","$oldWrapper","validationErrors","changes","oldRowIndex","rowChanges","changedFields","processedTitles","deletedCount","isValidationMode","groupedErrors","collapsedGroups","tableErrors","groupedChanges","tableChanges","change","oldShort","newShort","fieldDisplay","fieldCount","fieldNames","moreText","validationItemTouchStartPos","$targetCard","scrollIntoView","behavior","block","storageKey","changeType","refreshChangesPanel","restoredRow","showRowCompareEditModal","showChangeSingleFieldModal","showChangeEditModal","restoredData","updateChangesCount","finalHeight","$horizontalScroller","_touchStartX","_touchStartY","_scrollDirection","$span","hasOldValue","fieldsHtml","isChanged","questResult","bagResult","equipResult","playerParsed","allAttrsStr","playerRows","globalDetailLocation","globalLocation","locIdx","currentPlaceName","npcTableName","npcParsed","inSceneNPCs","offSceneNPCs","npcData","allNPCs","questTableName","questParsed","questStatusOrder","questTypeOrder","questPriorityOrder","parseProgress","activeTasks","q","aStatusOrder","statusDiff","typeDiff","priorityDiff","bagTableName","bagParsed","bagItems","equipTableName","equipParsed","equippedItems","locationTableName","locationTableKey","locationParsed","resourcesStr","parsedResources","areaName","isCurrent","iconHtml","npcIdx","npcDisplayName","npcDisplayShort","npcFallbackChar","isLastNpc","npcAvatar","offSceneFilter","isLastBag","isLast","isMain","progressPercent","progressMatch","progressBar","loadedModules","$avatars","normalizeName","normalize","candidatePool","pushUnique","cleaned","localNames","normalizedNameMap","getManualAliases","avatarPrimaryName","directCandidates","allCandidates","matchedName","matchedUrl","matchedLocal","applyAvatar","img","Image","src","renderFavoritesPanel","allFavorites","groupedByTag","untagged","renderFavoriteCard","rowsHtml","cleanHeader","tagsHtml","bindFavoritesEvents","panelEl","_favSwipeFixApplied","onTouchStart","onTouchMove","onTouchEnd","removeEventListener","$dataArea","groupTitle","searchTerm","cardText","showFavCardMenu","cardId","backdrop","menu","winWidth","winHeight","mWidth","outerWidth","mHeight","posX","posY","getById","existingMenu","dbLockApi","lockState","getTableLockState","isGridMode","titleColIndex","processedRows","originalIndex","isReversed","isTableReversed","titleA","titleB","aHitTitle","bHitTitle","totalItems","totalPages","currentPage","startIdx","endIdx","rowsToRender","showReverseBtn","shouldShowReverseButton","reverseBtnHtml","realRowIdx","cardTitle","cardTitleDisplay","showDefaultIndex","titleCellId","isTitleModified","isRowNew","rowClass","cardLockRowKey","cardRowIndex","isCardRowLocked","isTitleCellLocked","cells","validColIndices","isOddValidCount","cardBody","spanFullRow","rawHeaderName","isThisCellLocked","isThisFieldLocked","safeStr","rawStrOriginal","invalidPlaceholders","hideLabel","splitRegex","isIdentityField","parsedAttrs","badgeStyle","displayCell","validRelations","relHtml","attrsHtml","showDice","invalidTagValues","isDiffChanged","cellId","isUserModified","cellHighlight","tableActions","actionsHtml","act","actIdx","isTitleLocked","cardBookmarkRowKey","bookmarkIcon","$content","innerScrolls","switchPanel","updateContentFn","dataError","managerError","scrollTimer","$navBtn","isPanelVisible","mvuSavedHeight","currentActiveTab","$cell","showCellMenu","$pageBtn","newPage","topWin","openVisualizer","openNewVisualizer_ACU","manualUpdate","openSettings","searchTimeout","isComposing","selectionStart","selectionEnd","isFocus","activeElement","$newInput","tName","actionIdx","$title","skillName","checkValue","attrValIdx","profIdx","promptText","sendMessage","isPlayerTable","playerAttrValue","itemName","taskName","npcAttrValue","npcParts","npcMatch","titleDisplay","lockRowKey","dbRowIndex","relations","borderStyle","cardHtml","$previewOverlay","isModified","currentHeader","isFieldLocked","hasAnyLockInRow","cellKey","lockMenuHtml","changedTouches","closeAll","dbColIndex","lockTableCell","lockTableRow","currentLockState","rowPrefix","cellColIndex","fallbackCopy","rowDataValues","tagInput","showTagInputModal","$displayTarget","$panelContent","savedScrollTop","savedScrollLeft","$mapOverlay","isFromMap","refreshMapData","showConflictDialog","$conflictOverlay","extendedTimeOut","closeButton","preventDuplicates","keysToRemove","hasVisualizerNav","hasVisualizerDataDisplay","scripts","script","visualizerConfig","diceConfig","detectVisualizerConflict","disconnect","initCfg","initFontVal","eventSource","events","eventTypes","triggers","CHAT_CHANGED","MESSAGE_SWIPED","MESSAGE_DELETED","MESSAGE_UPDATED","_acuBoundChatChangeHandler","_boundChatChangeHandler","removeListener","loop","registerTableUpdateCallback","registerTableFillStartCallback","_acuInitRetries","hideOptionPanel","pendingCrazyAppend","lastCrazyPreSendAt","hasDiceResultInText","insertDiceIntoUserInputBlock","blockRegex","blockMatch","suffix","trimmedInner","newInner","applyCrazyModeToPrompt","params","dryRun","safeParams","quietPrompt","quiet_prompt","automaticTrigger","automatic_trigger","_acu_crazy_applied","originalPrompt","crazyRollResult","finalPrompt","inserted","triggerCrazyModeBeforeSend","updatedValue","queueCrazyAppend","applyCrazyAppend","newMessage","stChat","stMsg","mes","acuCrazyModeApplied","setupSendButtonListener","sendButton","onSendCapture","subtree","installCrazyGenerateHook","__acuCrazyGenerateHookInstalled","generate","__acuCrazyGenerateOriginal","injects","user_input","mergedPrompt","evtName","MESSAGE_SENT","tavern_events","afterCommandsEvtName","GENERATION_AFTER_COMMANDS","abortAllPendingRequests","__acuEffectRunCleanerTimer","testPairedTableFix","getValidCodes","emptyRows1","emptyRows2","isValid1","isValid2","set1","set2","setsEqual","emptyRowsPreserved1","emptyRowsPreserved2","diagnoseDiceVariables","ready"],"sourceRoot":""}