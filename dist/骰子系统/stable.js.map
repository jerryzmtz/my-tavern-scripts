{"version":3,"file":"stable.js","mappings":"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AMwtB,KAAK4e,EACpB,CAAE,MAAOvX,GAEP,OADAj4B,QAAQsM,MAAM,mCAAoC2rB,GAC3CyX,IAAqB,EAC9B,GAIIA,GAAoB,CAExB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KAEA,OACA,OACA,OACA,MACA,SACA,OACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,MACA,KACA,MAGA,MACA,KACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,MACA,MACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,KACA,SACA,KACA,KAGA,KACA,MACA,QACA,MACA,KACA,KACA,KACA,MACA,MACA,MACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,MACA,KACA,QACA,KACA,KACA,KACA,MACA,KACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,MACA,QACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,O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AIC,GAAe,EACfC,GAAe,EACnB,IAAK,IAAIC,EAAK,EAAGA,EAAK9oC,EAAKhf,OAAQ8nD,IACjC,GAAIjB,EAAY7nC,EAAK8oC,GAAItB,MAAcmB,EAAiB,CAGtD,GAFAC,EAAcE,EAEVP,EAAgB,EAAG,CACrB,MAAMnpB,EAAaj5B,OAAO6Z,EAAK8oC,GAAIP,IAAkB,IAClD3/C,OACAy2B,cAIDwpB,EAHa1iD,OAAOhD,EAAQolD,IAAkB,IAAIlpB,cAEzCr4B,SAAS,MACY,MAAfo4B,GAAqC,UAAfA,GAAyC,OAAfA,EAG7DA,EAAWl+B,WAAW,OACP,SAAfk+B,GACe,MAAfA,GACe,QAAfA,CAEN,CACA,KACF,CAEFuoB,EAAMr8C,IAAIq9C,EAAiB,CACzBl1C,KAAMk1C,EACNx/B,SAAUw/B,IAAoBR,EAC9BE,EAAG,EACHC,EAAG,EACH3G,SAAUiH,GAAe,EAAIlB,EAAc,GAC3C1iD,SAAU4jD,GAAe,EAAIA,OAAc1jD,EAC3Co6B,UAAWupB,GAEf,CAGA,MAsLME,EAtLgBC,KACpB,IAAKA,EAAQ,MAAO,GACpB,MAAM3+C,EAAQlE,OAAO6iD,GAClBp7C,MAAM,sCACNvM,IAAI6E,GAAKA,EAAE0C,QACX6H,OAAOvK,GAAKA,GAAKA,EAAElF,OAAS,IAGzBioD,EAAkB,CACtB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA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","sources":["src://tavern_helper_template/src//emoji-maps.ts","src://tavern_helper_template/src//index.ts"],"sourcesContent":["/**\n *  Emoji \n * emoji\n *\n * \n * 1. \"\"\"\"\n * 2. \"\"\"|\"\n * 3. emoji\"\"\"|\"\n * 4. \"\"\"\"\n * 5. //\n */\nexport const EMOJI_MAP: [RegExp, string][] = [\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/RiNG|LiveHouse/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/T/, ''],\n  [//, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [//, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [//, ''],\n  [//, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // //\n  // ============================================\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n\n  // \n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/SCP||/, ''],\n\n  // \n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // \n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // \n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/BOSS||/, ''],\n  [/|||/, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  // \n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||||||/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n\n  // \n  [/||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n\n  // \n  [/|||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // \n  [//, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n\n  // \n  [/||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/||/, ''],\n  [//, ''],\n\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|||/, ''],\n\n  // \n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n\n  // \n  [/||/, ''],\n  [/|||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [//, ''],\n  [/|||/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/||/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // \n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // \n  [/||/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [/|||||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|||||/, ''],\n];\n\n// \nexport const LOCATION_EMOJI_MAP = EMOJI_MAP;\nexport const ELEMENT_EMOJI_MAP = EMOJI_MAP;\n","// @ts-nocheck\nimport { ELEMENT_EMOJI_MAP, LOCATION_EMOJI_MAP } from './emoji-maps';\nimport { MAIN_STYLES } from './styles';\n\n(function () {\n  'use strict';\n\n  const SCRIPT_ID = 'acu_visualizer_ui_v19_6_ai_overlay';\n  // ========================================\n  // LockManager - \n  // ========================================\n  const LockManager = {\n    STORAGE_KEY_PREFIX: 'acu_locked_fields_v2_',\n    MAX_CONTEXTS: 20, // \n\n    PRIMARY_KEYS: {\n      : null,\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n    },\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    //  N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) return;\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(`[DICE]LockManager  ${toDelete.length} `);\n        }\n      } catch (e) {\n        console.warn('[DICE]LockManager ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[DICE]LockManager ', e);\n      }\n    },\n\n    getRowKey(tableName, row, headers) {\n      const pkField = this.PRIMARY_KEYS[tableName];\n      if (pkField === null) return '_row_0';\n\n      let fieldIndex = 1;\n      if (pkField) {\n        const idx = headers.indexOf(pkField);\n        if (idx !== -1) fieldIndex = idx;\n      }\n\n      if (!row[fieldIndex]) return null;\n      return `${pkField || headers[fieldIndex]}=${row[fieldIndex]}`;\n    },\n\n    lockField(tableName, rowKey, fieldName, value) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n      if (!data[tableName][rowKey]) {\n        data[tableName][rowKey] = { _fullRow: false, _fields: {}, _snapshot: null };\n      }\n      data[tableName][rowKey]._fields[fieldName] = value;\n      this._save();\n    },\n\n    lockRow(tableName, rowKey, rowData, headers) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      const snapshot = {};\n      headers.forEach((h, i) => {\n        if (h && rowData[i] != null && rowData[i] !== '') {\n          snapshot[h] = rowData[i];\n        }\n      });\n\n      data[tableName][rowKey] = { _fullRow: true, _fields: {}, _snapshot: snapshot };\n      this._save();\n    },\n\n    unlockField(tableName, rowKey, fieldName) {\n      const data = this._load();\n      const lock = data[tableName]?.[rowKey];\n      if (!lock) return;\n\n      //  _snapshot \n      if (lock._fullRow && lock._snapshot) {\n        delete lock._snapshot[fieldName];\n        //  _snapshot \n        if (Object.keys(lock._snapshot).length === 0) {\n          delete data[tableName][rowKey];\n          if (Object.keys(data[tableName]).length === 0) {\n            delete data[tableName];\n          }\n        }\n      } else {\n        //  _fields \n        delete lock._fields[fieldName];\n        if (Object.keys(lock._fields).length === 0) {\n          delete data[tableName][rowKey];\n          if (Object.keys(data[tableName]).length === 0) {\n            delete data[tableName];\n          }\n        }\n      }\n      this._save();\n    },\n\n    unlockRow(tableName, rowKey) {\n      const data = this._load();\n      if (data[tableName]) {\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n        this._save();\n      }\n    },\n\n    isFieldLocked(tableName, rowKey, fieldName) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return false;\n      if (lock._fullRow) return lock._snapshot?.hasOwnProperty(fieldName);\n      return lock._fields?.hasOwnProperty(fieldName);\n    },\n\n    isRowLocked(tableName, rowKey) {\n      return this._load()[tableName]?.[rowKey]?._fullRow === true;\n    },\n\n    applyLocks(tableName, tableContent) {\n      const tableLocks = this._load()[tableName];\n      if (!tableLocks || !tableContent || tableContent.length < 2) {\n        return { modified: false, restored: [] };\n      }\n\n      const headers = tableContent[0];\n      const restored = [];\n      let modified = false;\n\n      // \n      const rowIndex = {};\n      for (let i = 1; i < tableContent.length; i++) {\n        const key = this.getRowKey(tableName, tableContent[i], headers);\n        if (key) rowIndex[key] = i;\n      }\n\n      for (const [rowKey, lock] of Object.entries(tableLocks)) {\n        const idx = rowIndex[rowKey];\n\n        if (idx === undefined) {\n          // \n          const newRow = this._rebuildRow(headers, lock);\n          if (newRow) {\n            tableContent.push(newRow);\n            restored.push(rowKey);\n            modified = true;\n          }\n          continue;\n        }\n\n        const row = tableContent[idx];\n        const fields = lock._fullRow ? lock._snapshot : lock._fields;\n\n        if (fields) {\n          for (const [field, value] of Object.entries(fields)) {\n            const colIdx = headers.indexOf(field);\n            if (colIdx !== -1 && row[colIdx] !== value) {\n              row[colIdx] = value;\n              modified = true;\n            }\n          }\n        }\n      }\n\n      return { modified, restored };\n    },\n\n    _rebuildRow(headers, lock) {\n      const fields = lock._fullRow ? lock._snapshot : lock._fields;\n      if (!fields || Object.keys(fields).length === 0) return null;\n\n      const row = new Array(headers.length).fill(null);\n      for (const [field, value] of Object.entries(fields)) {\n        const idx = headers.indexOf(field);\n        if (idx !== -1) row[idx] = value;\n      }\n      return row;\n    },\n\n    // \n    hasAnyLock(tableName, rowKey) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return false;\n      if (lock._fullRow) return true;\n      return Object.keys(lock._fields || {}).length > 0;\n    },\n\n    getLockedFields(tableName, rowKey) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return [];\n      if (lock._fullRow) return Object.keys(lock._snapshot || {});\n      return Object.keys(lock._fields || {});\n    },\n\n    // \n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  // ========================================\n  // BookmarkManager - \n  // ========================================\n  const BookmarkManager = {\n    STORAGE_KEY_PREFIX: 'acu_bookmarks_v1_',\n    MAX_CONTEXTS: 20, // bookmark\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    // bookmark N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) {\n          // \n          return;\n        }\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(\n            `[DICE]BookmarkManager  ${toDelete.length} bookmark ${this.MAX_CONTEXTS}  ${allKeys.length} `,\n          );\n        }\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    isBookmarked(tableName, rowKey) {\n      const data = this._load();\n      return !!(data[tableName] && data[tableName][rowKey]);\n    },\n\n    toggleBookmark(tableName, rowKey) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      if (data[tableName][rowKey]) {\n        // bookmark\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n      } else {\n        // bookmark\n        data[tableName][rowKey] = true;\n      }\n      this._save();\n    },\n\n    getBookmarks(tableName) {\n      const data = this._load();\n      if (!data[tableName]) return [];\n      return Object.keys(data[tableName]);\n    },\n\n    // bookmark\n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  const escapeHtml = s =>\n    String(s ?? '')\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n\n  // [] \n  const generateUniqueName = (baseName: string, existingNames: string[]): string => {\n    if (!existingNames.includes(baseName)) return baseName;\n    let counter = 2;\n    let newName = `${baseName} (${counter})`;\n    while (existingNames.includes(newName)) {\n      counter++;\n      newName = `${baseName} (${counter})`;\n    }\n    return newName;\n  };\n\n  // [] \n  const showPresetConflictDialog = (options: {\n    presetName: string;\n    presetType: string;\n    onOverwrite: () => void;\n    onRename: (newName: string) => void;\n    onCancel: () => void;\n    existingNames: string[];\n  }) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const t = getThemeColors();\n    const config = getConfig();\n    const suggestedName = generateUniqueName(options.presetName, options.existingNames);\n\n    const dialogHtml = `\n      <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-import-confirm-dialog\">\n          <div class=\"acu-import-confirm-header\">\n            <i class=\"fa-solid fa-file-import\"></i> ${options.presetType}\n          </div>\n          <div class=\"acu-import-confirm-body\">\n            <div class=\"acu-import-warning-container\">\n              <i class=\"fa-solid fa-exclamation-triangle acu-import-warning-icon\"></i>\n              <div class=\"acu-import-warning-title\"></div>\n              <div class=\"acu-import-warning-message\">${escapeHtml(options.presetName)}</div>\n            </div>\n            <div class=\"acu-import-conflict-options\">\n              <label class=\"acu-import-radio\">\n                <input type=\"radio\" name=\"preset-conflict-mode\" value=\"overwrite\" checked />\n                <span></span>\n              </label>\n              <label class=\"acu-import-radio\">\n                <input type=\"radio\" name=\"preset-conflict-mode\" value=\"rename\" />\n                <span>${escapeHtml(suggestedName)}</span>\n              </label>\n            </div>\n          </div>\n          <div class=\"acu-import-confirm-footer\">\n            <button class=\"acu-import-cancel-btn\"></button>\n            <button class=\"acu-import-confirm-btn\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n      position: fixed !important;\n      top: 0 !important;\n      left: 0 !important;\n      right: 0 !important;\n      bottom: 0 !important;\n      width: 100vw !important;\n      height: 100vh !important;\n      background: rgba(0,0,0,0.6) !important;\n      z-index: 2147483655 !important;\n      display: flex;\n      justify-content: center !important;\n      align-items: center !important;\n      padding: 16px;\n      box-sizing: border-box !important;\n    `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(() => {\n      closeDialog();\n      options.onCancel();\n    });\n\n    $dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-import-confirm-overlay')) {\n        closeDialog();\n        options.onCancel();\n      }\n    });\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const mode = $dialog.find('input[name=\"preset-conflict-mode\"]:checked').val();\n      closeDialog();\n      if (mode === 'overwrite') {\n        options.onOverwrite();\n      } else {\n        options.onRename(suggestedName);\n      }\n    });\n  };\n  // [] \n  const smartInsertToTextarea = (newContent, contentType) => {\n    // contentType: 'action' ()  'dice' ()\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = ($ta.val() || '').trim();\n\n    // \n    // : \"XX\"\n    const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n    // \n    // : \"  vs    (...)  ......  (...)  .........\"\n    const contestDiceRegex =\n      /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n    // <user>\n    const actionRegex = /<user>(?:(?!<user>).)*?[]/g;\n\n    // \n    const placeholderRegex = /\\[\\]/g;\n\n    // [] \n    const diceCfg = getDiceConfig();\n    let contentToInsert = newContent;\n    let shouldSaveOriginal = false;\n    if (contentType === 'dice' && diceCfg.hideDiceResultFromUser) {\n      contentToInsert = '[]';\n      shouldSaveOriginal = true;\n    }\n\n    // \n    if (!currentVal) {\n      $ta.val(contentToInsert).trigger('input').trigger('change');\n      // []  data \n      if (contentType === 'dice') {\n        $ta.data('acu-original-dice-text', newContent);\n        // []  DOM  getter  jQuery\n        const textarea = $ta[0] as any;\n        textarea._acuOriginalDiceText = newContent;\n        textarea._acuHasDiceData = true;\n      }\n      return;\n    }\n\n    // \n    let workingText = currentVal;\n    let existingAction = '';\n    let existingDice = '';\n    let existingDiceOriginal = '';\n\n    // [] 0. \n    if (placeholderRegex.test(workingText)) {\n      // \n      const originalText = $ta.data('acu-original-dice-text') || '';\n      if (originalText) {\n        // \n        workingText = workingText.replace(placeholderRegex, originalText);\n        existingDice = originalText;\n        existingDiceOriginal = originalText;\n      } else {\n        // \n        workingText = workingText.replace(placeholderRegex, '').trim();\n      }\n    }\n\n    // 1. \n    const contestMatches = workingText.match(contestDiceRegex);\n    if (contestMatches && contestMatches.length > 0) {\n      existingDice = contestMatches[contestMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(contestDiceRegex, '\\u0000').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted contest roll:', existingDice);\n    }\n\n    // 2. \n    const normalMatches = workingText.match(normalDiceRegex);\n    if (normalMatches && normalMatches.length > 0) {\n      // \n      existingDice = normalMatches[normalMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(normalDiceRegex, '\\u0000').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted normal roll:', existingDice);\n    }\n\n    // 3. \n    const actionMatches = workingText.match(actionRegex);\n    if (actionMatches && actionMatches.length > 0) {\n      existingAction = actionMatches[actionMatches.length - 1];\n      workingText = workingText.replace(actionRegex, '\\u0001').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted action:', existingAction);\n    }\n\n    // 4. \n    let userInput = workingText\n      .replace(/[\\u0000\\u0001]/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .trim();\n\n    // 5. \n    if (contentType === 'dice') {\n      // [] \n      existingDice = contentToInsert;\n      existingDiceOriginal = newContent;\n      //  data \n      $ta.data('acu-original-dice-text', newContent);\n      // []  DOM  getter  jQuery\n      const textarea = $ta[0] as any;\n      textarea._acuOriginalDiceText = newContent;\n      textarea._acuHasDiceData = true;\n    } else if (contentType === 'action') {\n      existingAction = newContent;\n    }\n\n    // 6.  +  + \n    const parts = [];\n    if (userInput) parts.push(userInput);\n    if (existingAction) parts.push(existingAction);\n    if (existingDice) parts.push(existingDice);\n\n    const finalVal = parts.join(' ');\n    $ta.val(finalVal).trigger('input').trigger('change');\n  };\n\n  // [] \n  const restoreDiceResultBeforeSend = () => {\n    const { $ } = getCore();\n    const diceCfg = getDiceConfig();\n    const hideInput = diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n    if (hideInput) return;\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = $ta.val() || '';\n    const originalText = $ta.data('acu-original-dice-text');\n\n    // \n    if (currentVal.includes('[]') && originalText) {\n      const restoredVal = currentVal.replace(/\\[\\]/g, originalText);\n      $ta.val(restoredVal);\n      // \n      $ta.removeData('acu-original-dice-text');\n      // []  DOM \n      const textarea = $ta[0] as any;\n      textarea._acuOriginalDiceText = null;\n      textarea._acuHasDiceData = false;\n    }\n  };\n\n  // []  value \n  const interceptTextareaValue = () => {\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const textarea = $ta[0] as HTMLTextAreaElement;\n    if (!textarea || (textarea as any)._acuValueIntercepted) return;\n\n    // \n    (textarea as any)._acuValueIntercepted = true;\n\n    //  value \n    const originalDescriptor = Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype, 'value');\n    const originalValue = textarea.value;\n\n    //  value  getter\n    Object.defineProperty(textarea, 'value', {\n      get: function (this: HTMLTextAreaElement) {\n        // \n        let val: string;\n        if (originalDescriptor && originalDescriptor.get) {\n          val = originalDescriptor.get.call(this);\n        } else {\n          val = (this as any)._value || originalValue || '';\n        }\n\n        // [] \n        //  DOM  jQuery data getter  jQuery\n        //  ) \n        if (!(this as any)._acuHasDiceData) {\n          return val;\n        }\n\n        // \n        const originalText = (this as any)._acuOriginalDiceText;\n        if (val && typeof val === 'string' && val.includes('[]') && originalText) {\n          return val.replace(/\\[\\]/g, originalText);\n        }\n        return val;\n      },\n      set: function (this: HTMLTextAreaElement, val: string) {\n        if (originalDescriptor && originalDescriptor.set) {\n          originalDescriptor.set.call(this, val);\n        } else {\n          (this as any)._value = val;\n        }\n      },\n      configurable: true,\n    });\n  };\n  const STORAGE_KEY_TABLE_ORDER = 'acu_table_order';\n  const STORAGE_KEY_ACTION_ORDER = 'acu_action_order';\n  const STORAGE_KEY_PENDING_DELETIONS = 'acu_pending_deletions';\n  const STORAGE_KEY_ACTIVE_TAB = 'acu_active_tab';\n  const STORAGE_KEY_UI_CONFIG = 'acu_ui_config_v19';\n  const STORAGE_KEY_LAST_SNAPSHOT = 'acu_data_snapshot_v19';\n  const STORAGE_KEY_IS_COLLAPSED = 'acu_ui_collapsed_state';\n  const STORAGE_KEY_OPTIONS_COLLAPSED = 'acu_options_collapsed'; // [] \n  const STORAGE_KEY_DASHBOARD_ACTIVE = 'acu_dashboard_active';\n  // [] \n  const STORAGE_KEY_TABLE_HEIGHTS = 'acu_table_heights_v19';\n  const STORAGE_KEY_TABLE_STYLES = 'acu_table_styles_v19';\n  const STORAGE_KEY_HIDDEN_TABLES = 'acu_hidden_tables_v19';\n  const STORAGE_KEY_GM_CONFIG = 'acu_gm_engine_config_v1';\n  const STORAGE_KEY_REVERSE_TABLES = 'acu_reverse_tables_v1';\n  const MAX_ACTION_BUTTONS = 6; // \n  const MIN_PANEL_HEIGHT = 200; // \n  const MAX_PANEL_HEIGHT = 1200; // \n\n  const STORAGE_KEY_DICE_CONFIG = 'acu_dice_config_v1';\n  const STORAGE_KEY_ATTRIBUTE_PRESETS = 'acu_attribute_presets_v1';\n  const STORAGE_KEY_ACTIVE_ATTR_PRESET = 'acu_active_attr_preset_v1';\n  const STORAGE_KEY_ACTION_PRESETS = 'acu_action_presets_v1';\n  const STORAGE_KEY_ACTIVE_ACTION_PRESET = 'acu_active_action_preset_v1';\n  const STORAGE_KEY_CRAZY_MODE = 'acu_dice_crazy_mode';\n  const DEFAULT_CRAZY_MODE_CONFIG = {\n    enabled: false,\n    crazyLevel: 50,\n    playerWeight: 80,\n    inSceneNpcWeight: 15,\n    offSceneNpcWeight: 5,\n  };\n  const PRESET_FORMAT_VERSION = '1.4.0'; // \n  const SCRIPT_VERSION = 'v3.41'; // \n\n  //  \"x.y.z\"\n  const compareVersion = (v1, v2) => {\n    // \n    const normalizeVersion = v => {\n      if (typeof v === 'number') return `${v}.0.0`;\n      if (typeof v !== 'string') return '0.0.0';\n      return v;\n    };\n    const nv1 = normalizeVersion(v1);\n    const nv2 = normalizeVersion(v2);\n    const parts1 = nv1.split('.').map(Number);\n    const parts2 = nv2.split('.').map(Number);\n    for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {\n      const p1 = parts1[i] || 0;\n      const p2 = parts2[i] || 0;\n      if (p1 < p2) return -1;\n      if (p1 > p2) return 1;\n    }\n    return 0;\n  };\n\n  const STORAGE_KEY_AVATAR_MAP = 'acu_avatar_map_v1';\n  const STORAGE_KEY_MAP_FOCUS = 'acu_map_focus_v1';\n\n  // ========================================\n  // ConsoleCaptureManager - Console\n  // ========================================\n  const ConsoleCaptureManager = {\n    logs: [],\n    maxLogs: 1000,\n    filters: { log: true, info: true, warn: true, error: true },\n    originalMethods: {},\n    isIntercepted: false,\n    enabled: false, // \n\n    restore() {\n      //  localStorage \n      const saved = localStorage.getItem('acu_console_capture_enabled');\n      if (saved === 'true') {\n        this.enable();\n      }\n    },\n\n    enable() {\n      if (this.enabled) return;\n      this.enabled = true;\n      localStorage.setItem('acu_console_capture_enabled', 'true');\n      this.intercept();\n    },\n\n    disable() {\n      if (!this.enabled) return;\n      this.enabled = false;\n      localStorage.setItem('acu_console_capture_enabled', 'false');\n      // \n      localStorage.removeItem('acu_script_error_detected');\n      // \n      const emergencyBtn = document.getElementById('acu-emergency-debug-btn');\n      if (emergencyBtn) {\n        emergencyBtn.style.display = 'none';\n      }\n    },\n\n    intercept() {\n      if (this.isIntercepted) return;\n      this.isIntercepted = true;\n\n      ['log', 'info', 'warn', 'error'].forEach(type => {\n        this.originalMethods[type] = console[type];\n        const self = this;\n        console[type] = function (...args) {\n          // \n          self.originalMethods[type].apply(console, args);\n          // \n          if (self.enabled) {\n            self.capture(type, args);\n          }\n        };\n      });\n    },\n\n    capture(type, args) {\n      if (!this.enabled) return; // \n      try {\n        const timestamp = new Date();\n        const timeStr = timestamp.toLocaleTimeString('zh-CN', { hour12: false });\n\n        // \n        const content = args\n          .map(arg => {\n            if (typeof arg === 'object') {\n              try {\n                return JSON.stringify(arg, null, 2);\n              } catch {\n                return String(arg);\n              }\n            }\n            return String(arg);\n          })\n          .join(' ');\n\n        // error\n        let stack = null;\n        if (type === 'error' && args[0] instanceof Error) {\n          stack = args[0].stack || null;\n        }\n\n        const logEntry = {\n          id: Date.now() + Math.random(),\n          timestamp,\n          timeStr,\n          type,\n          content,\n          stack,\n          rawArgs: args,\n        };\n\n        this.logs.push(logEntry);\n\n        // \n        if (this.logs.length > this.maxLogs) {\n          this.logs.shift();\n        }\n      } catch (e) {\n        // console\n      }\n    },\n\n    clear() {\n      this.logs = [];\n    },\n\n    getFilteredLogs() {\n      return this.logs.filter(log => this.filters[log.type]);\n    },\n\n    setFilters(filters) {\n      this.filters = { ...this.filters, ...filters };\n    },\n  };\n\n  // \n  // ConsoleCaptureManager.intercept();\n\n  // ========================================\n  // \n  // ========================================\n  const ErrorHandler = {\n    errorCount: 0,\n    errorThreshold: 3, // 3\n    lastErrorTime: 0,\n    errorWindow: 5000, // 5\n    fatalErrorDetected: false,\n\n    // \n    isFatalError(error, source, lineno, colno, stack) {\n      // \n      const thirdPartyPatterns = [/jquery/i, /lodash/i, /vue/i, /react/i, /pixi/i, /gsap/i, /toastr/i, /node_modules/i];\n\n      const errorInfo = stack || error?.stack || '';\n      const errorSource = source || '';\n\n      // \n      for (const pattern of thirdPartyPatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          return false;\n        }\n      }\n\n      // \n      const corePatterns = [\n        /acu_visualizer/i,\n        //i,\n        /LockManager/i,\n        /Store/i,\n        /ConsoleCaptureManager/i,\n        /renderInterface/i,\n        /init\\s*\\(/i,\n      ];\n\n      let isCoreError = false;\n      for (const pattern of corePatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          isCoreError = true;\n          break;\n        }\n      }\n\n      // \n      return isCoreError;\n    },\n\n    // \n    handleError(error, source, lineno, colno, stack) {\n      try {\n        // \n        if (!this.isFatalError(error, source, lineno, colno, stack)) {\n          return; // \n        }\n\n        const now = Date.now();\n\n        // \n        if (now - this.lastErrorTime > this.errorWindow) {\n          this.errorCount = 0;\n        }\n\n        this.errorCount++;\n        this.lastErrorTime = now;\n\n        // \n        if (this.errorCount >= this.errorThreshold && !this.fatalErrorDetected) {\n          this.fatalErrorDetected = true;\n          this.triggerFatalError();\n        }\n      } catch (e) {\n        // \n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    triggerFatalError() {\n      try {\n        //  console \n        if (!ConsoleCaptureManager.enabled) {\n          ConsoleCaptureManager.enable();\n        }\n\n        // \n        localStorage.setItem('acu_script_error_detected', 'true');\n\n        // \n        this.showEmergencyButton();\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    showEmergencyButton() {\n      try {\n        // \n        let btn = document.getElementById('acu-emergency-debug-btn');\n        if (btn) {\n          btn.style.display = 'block';\n          return;\n        }\n\n        // \n        btn = document.createElement('button');\n        btn.id = 'acu-emergency-debug-btn';\n        btn.innerHTML = '<i class=\"fa-solid fa-bug\"></i> ';\n        btn.style.cssText = `\n          position: fixed;\n          bottom: 20px;\n          right: 20px;\n          z-index: 99999;\n          padding: 10px 16px;\n          background: #e74c3c;\n          color: #fff;\n          border: none;\n          border-radius: 6px;\n          font-size: 14px;\n          font-weight: bold;\n          cursor: pointer;\n          box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);\n          display: flex;\n          align-items: center;\n          gap: 6px;\n          transition: all 0.2s;\n        `;\n\n        btn.onmouseenter = function () {\n          this.style.background = '#c0392b';\n          this.style.transform = 'scale(1.05)';\n        };\n        btn.onmouseleave = function () {\n          this.style.background = '#e74c3c';\n          this.style.transform = 'scale(1)';\n        };\n\n        btn.onclick = function () {\n          try {\n            //  showDebugConsoleModal\n            if (typeof window.showDebugConsoleModal === 'function') {\n              window.showDebugConsoleModal();\n            } else {\n              // \n              alert('F12');\n            }\n          } catch (e) {\n            console.error('[DICE]:', e);\n            alert('F12');\n          }\n        };\n\n        document.body.appendChild(btn);\n      } catch (e) {\n        console.error('[DICE]:', e);\n      }\n    },\n\n    // \n    checkAndRestore() {\n      try {\n        const errorDetected = localStorage.getItem('acu_script_error_detected') === 'true';\n        if (errorDetected) {\n          //  console \n          if (!ConsoleCaptureManager.enabled) {\n            ConsoleCaptureManager.enable();\n          }\n          // \n          this.showEmergencyButton();\n        }\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n  };\n\n  // \n  window.onerror = function (message, source, lineno, colno, error) {\n    ErrorHandler.handleError(error || message, source, lineno, colno, error?.stack);\n    return false; // \n  };\n\n  //  Promise \n  window.addEventListener('unhandledrejection', function (event) {\n    ErrorHandler.handleError(event.reason, null, null, null, event.reason?.stack);\n  });\n\n  // \n  //  init \n\n  // ========================================\n  //  -  (Phase 1.1)\n  // ========================================\n\n  /**\n   * \n   * - replace: \n   * - extract: ()\n   * - delete: \n   * - validate: (ValidationEngine,)\n   */\n  type RegexOperation = 'replace' | 'extract' | 'delete' | 'validate';\n\n  /**\n   * \n   * - global: \n   * - table: \n   * - column: \n   */\n  type RegexScopeType = 'global' | 'table' | 'column';\n\n  /**\n   * \n   * - auto: \n   * - manual: \n   * - preview: ,\n   */\n  type RegexExecutionMode = 'auto' | 'manual' | 'preview';\n\n  /**\n   * \n   */\n  interface RegexFlags {\n    caseInsensitive?: boolean; // i - \n    global?: boolean; // g - \n    multiline?: boolean; // m - \n    unicode?: boolean; // u - Unicode\n    sticky?: boolean; // y - \n  }\n\n  /**\n   * \n   */\n  interface RegexScopeConfig {\n    type: RegexScopeType;\n    tableNames?: string[]; // tablecolumn\n    columnNames?: string[]; // column\n  }\n\n  /**\n   * \n   */\n  interface RegexSecurityConfig {\n    maxMatchTime: number; // (),100\n    maxMatches: number; // ,1000\n    maxInputLength: number; // ,10000\n  }\n\n  /**\n   * \n   */\n  interface RegexTestCase {\n    input: string;\n    expected: string;\n    description?: string;\n  }\n\n  /**\n   * \n   */\n  interface RegexTransformationRule {\n    id: string; // \n    name: string; // \n    description?: string; // \n    operation: RegexOperation; // \n    pattern: string; // \n    flags?: RegexFlags; // \n    replacement?: string; // (replace)\n    scope: RegexScopeConfig; // \n    enabled: boolean; // \n    priority: number; // (1-100),\n    executeMode: RegexExecutionMode; // \n    testCases?: RegexTestCase[]; // \n    security?: RegexSecurityConfig; // \n    createdAt?: number; // \n    updatedAt?: number; // \n  }\n\n  /**\n   * \n   */\n  interface RegexTransformResult {\n    success: boolean;\n    oldValue: string;\n    newValue: string;\n    matched: boolean;\n    error?: string;\n  }\n\n  /**\n   * \n   */\n  interface RegexBatchTransformResult {\n    tableName: string;\n    columnIndex: number;\n    rowIndex: number;\n    result: RegexTransformResult;\n  }\n\n  /**\n   * \n   */\n  interface RegexPreviewResult {\n    rule: RegexTransformationRule;\n    affectedCells: Array<{\n      tableName: string;\n      rowIndex: number;\n      columnIndex: number;\n      columnName: string;\n      oldValue: string;\n      newValue: string;\n    }>;\n    totalAffected: number;\n  }\n\n  /**\n   * \n   */\n  interface RegexPreset {\n    id: string;\n    name: string;\n    description?: string;\n    version: string;\n    rules: RegexTransformationRule[];\n    createdAt?: number;\n    updatedAt?: number;\n  }\n\n  // \n  const STORAGE_KEY_REGEX_RULES = 'acu_regex_rules_v1';\n  const STORAGE_KEY_REGEX_PRESETS = 'acu_regex_presets_v1';\n  const STORAGE_KEY_REGEX_ACTIVE_PRESET = 'acu_regex_active_preset_v1';\n  const STORAGE_KEY_REGEX_ENABLED = 'acu_regex_enabled_v1';\n\n  // ========================================\n  //  (Phase 2.2)\n  // ========================================\n  const BUILTIN_REGEX_RULES: RegexTransformationRule[] = [\n    // 1: ()\n    {\n      id: 'builtin_trim_spaces',\n      name: '',\n      description: ',',\n      operation: 'replace',\n      pattern: '^\\\\s+|\\\\s+$|\\\\s+',\n      flags: { global: true },\n      replacement: ' ',\n      scope: { type: 'global' },\n      enabled: false,\n      priority: 10,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // 2: ()\n    {\n      id: 'builtin_normalize_quotes',\n      name: '',\n      description: '',\n      operation: 'replace',\n      pattern: '[\"]|[\\']',\n      flags: { global: true },\n      replacement: '\"',\n      scope: { type: 'global' },\n      enabled: false,\n      priority: 10,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // 3: ()\n    {\n      id: 'builtin_item_quality_format',\n      name: '',\n      description: '',\n      operation: 'replace',\n      pattern: '\\\\b(|||||)\\\\b',\n      flags: { global: true },\n      replacement: '$1',\n      scope: { type: 'column', tableNames: ['', ''], columnNames: [''] },\n      enabled: false,\n      priority: 50,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n  ];\n\n  // ========================================\n  // ValidationRuleManager - \n  // ========================================\n  const STORAGE_KEY_VALIDATION_RULES = 'acu_validation_rules_v1';\n  const STORAGE_KEY_VALIDATION_ENABLED = 'acu_validation_enabled_v1';\n  const STORAGE_KEY_VALIDATION_MODE = 'acu_validation_mode'; // \n\n  //  UI \n  const RULE_TYPE_INFO = {\n    // \n    tableReadonly: { name: '', scope: 'table', icon: 'fa-lock', desc: '' },\n    rowLimit: { name: '', scope: 'table', icon: 'fa-arrows-up-down', desc: '' },\n    sequence: { name: '', scope: 'table', icon: 'fa-sort-numeric-up', desc: '' },\n    // \n    required: { name: '', scope: 'field', icon: 'fa-asterisk', desc: '' },\n    format: { name: '', scope: 'field', icon: 'fa-font', desc: '' },\n    enum: { name: '', scope: 'field', icon: 'fa-list', desc: '' },\n    numeric: { name: '', scope: 'field', icon: 'fa-hashtag', desc: '' },\n    relation: { name: '', scope: 'field', icon: 'fa-link', desc: '' },\n    keyValue: { name: '', scope: 'field', icon: 'fa-key', desc: '' },\n  };\n\n  // \n  const BUILTIN_VALIDATION_RULES = [\n    // \n    {\n      id: 'summary_code_sequence',\n      name: '',\n      description: 'AM0001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM0001',\n    },\n    // \n    {\n      id: 'outline_code_sequence',\n      name: '',\n      description: 'AM0001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM0001',\n    },\n    // \n    {\n      id: 'summary_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'outline_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_priority_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'item_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_proficiency_range',\n      name: '',\n      description: ' 0-100 ',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'numeric',\n      config: { min: 0, max: 100 },\n      errorMessage: ' 0-100 ',\n    },\n    // \n    {\n      id: 'npc_presence_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_explore_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'intel_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'player_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // NPC\n    {\n      id: 'npc_location_relation',\n      name: 'NPC',\n      description: 'NPC',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'element_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'global_detail_location_relation',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    //  - \n    {\n      id: 'player_base_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_special_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_relationships_keyvalue',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    //  - \n    {\n      id: 'npc_base_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_special_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_relationships_keyvalue',\n      name: 'NPC',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    //  - \n    {\n      id: 'quest_progress_format',\n      name: '',\n      description: '+%50%',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'format',\n      config: { pattern: '^\\\\d+%$' },\n      errorMessage: '+%50%100%',\n    },\n  ];\n\n  // ========================================\n  // BlacklistManager - MVU\n  // ========================================\n  const STORAGE_KEY_BLACKLIST = 'acu_filter_blacklist_v1';\n  const STORAGE_KEY_BLACKLIST_VERSION = 'acu_filter_blacklist_version';\n  const DEFAULT_BLACKLIST = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    'ID',\n    '',\n    '',\n    'measurements',\n    'ages',\n    '',\n    'order',\n    '',\n    'time',\n    'cost',\n  ];\n\n  const BlacklistManager = {\n    // \n    getBlacklist() {\n      const stored = Store.get(STORAGE_KEY_BLACKLIST, null);\n      const storedVersion = Store.get(STORAGE_KEY_BLACKLIST_VERSION, null);\n\n      // \n      if (!stored || !Array.isArray(stored)) {\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return [...DEFAULT_BLACKLIST];\n      }\n\n      // \n      if (!storedVersion || compareVersion(storedVersion, PRESET_FORMAT_VERSION) < 0) {\n        console.log(`[DICE]BlacklistManager  (${storedVersion || ''})`);\n\n        // \n        const userItems = new Set(stored);\n        const defaultItems = new Set(DEFAULT_BLACKLIST);\n        const mergedItems = [...DEFAULT_BLACKLIST]; // \n\n        // \n        stored.forEach(item => {\n          if (!defaultItems.has(item)) {\n            mergedItems.push(item);\n          }\n        });\n\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, mergedItems);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return mergedItems;\n      }\n\n      return stored;\n    },\n\n    // \n    setBlacklist(list) {\n      if (!Array.isArray(list)) {\n        console.warn('[DICE]BlacklistManager ');\n        return false;\n      }\n      Store.set(STORAGE_KEY_BLACKLIST, list);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // \n    resetToDefault() {\n      Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // key\n    //  \" >  >  > \" \"\"\n    isBlacklisted(key) {\n      if (!key || typeof key !== 'string') return false;\n      const blacklist = this.getBlacklist();\n      if (blacklist.length === 0) return false;\n\n      // key \">\"  \" > \"\n      const parts = key\n        .split(/>| > /)\n        .map(s => s.trim())\n        .filter(s => s);\n      const lastPart = parts.length > 0 ? parts[parts.length - 1] : key;\n\n      // key\n      return blacklist.some(item => lastPart.includes(item));\n    },\n  };\n\n  // ========================================\n  // PresetManager - \n  // ========================================\n  const STORAGE_KEY_PRESETS = 'acu_validation_presets_v1';\n  const STORAGE_KEY_ACTIVE_PRESET = 'acu_active_preset_id';\n\n  const PresetManager = {\n    _cache: null,\n\n    // \n    getAllPresets() {\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n      if (!stored) {\n        this._initDefaultPreset();\n        return this._cache;\n      }\n      // \n      let needsSave = false;\n      stored.forEach(preset => {\n        if (!preset.version || this._compareVersion(preset.version, PRESET_FORMAT_VERSION) < 0) {\n          console.log(\n            `[DICE]PresetManager  \"${preset.name}\"  (${preset.version || ''})`,\n          );\n          // \n          const customRules = preset.rules.filter(r => !r.builtin);\n          const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n          const mergedRules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r, builtin: true }))];\n          customRules.forEach(rule => {\n            const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n            if (!builtinRuleIds.has(key)) {\n              mergedRules.push({ ...rule, builtin: false });\n            }\n          });\n          preset.rules = mergedRules;\n          preset.version = PRESET_FORMAT_VERSION;\n          needsSave = true;\n        }\n      });\n      if (needsSave) {\n        this._save(stored);\n        ValidationRuleManager.clearCache();\n        // \n        this._cache = null;\n      }\n      // \n      if (!needsSave && this._cache) {\n        return this._cache;\n      }\n      this._cache = stored;\n      return stored;\n    },\n\n    // \n    getActivePreset() {\n      const presets = this.getAllPresets();\n      const activeId = Store.get(STORAGE_KEY_ACTIVE_PRESET, 'default');\n      return presets.find(p => p.id === activeId) || presets[0];\n    },\n\n    // \n    setActivePreset(id) {\n      if (!this.getAllPresets().find(p => p.id === id)) return false;\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, id);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    createPreset(name) {\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: name || '',\n        builtin: false,\n        rules: [],\n        version: PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    duplicatePreset(id) {\n      const source = this.getAllPresets().find(p => p.id === id);\n      if (!source) return null;\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: source.name + ' ()',\n        builtin: false,\n        rules: JSON.parse(JSON.stringify(source.rules)),\n        version: source.version || PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      console.log('[DICE]PresetManager :', source.name, '->', newPreset.name);\n      return newPreset;\n    },\n\n    //  id='default' \n    deletePreset(id) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset || preset.id === 'default') return false; // \n      const filtered = presets.filter(p => p.id !== id);\n      this._save(filtered);\n      if (Store.get(STORAGE_KEY_ACTIVE_PRESET) === id) {\n        Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n        ValidationRuleManager.clearCache();\n      }\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    updatePresetRules(id, rules) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return false;\n      preset.rules = rules;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      return true;\n    },\n\n    // \n    exportPreset(id) {\n      const preset = this.getAllPresets().find(p => p.id === id);\n      if (!preset) return null;\n      const json = JSON.stringify(\n        {\n          format: 'acu_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          preset: { name: preset.name, rules: preset.rules },\n        },\n        null,\n        2,\n      );\n      return json;\n    },\n\n    // \n    _compareVersion(v1, v2) {\n      return compareVersion(v1, v2);\n    },\n\n    // \n    mergePresetWithDefaults(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) return false;\n\n      // \n      const customRules = preset.rules.filter(r => !r.builtin);\n      const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n\n      // \n      const builtinRuleMap = new Map();\n      BUILTIN_VALIDATION_RULES.forEach(r => {\n        const key = r.id || r.targetTable + '_' + r.ruleType;\n        builtinRuleMap.set(key, r);\n      });\n\n      // \n      const mergedRules = [];\n      const processedCustomIds = new Set();\n\n      // 1. \n      BUILTIN_VALIDATION_RULES.forEach(newRule => {\n        const key = newRule.id || newRule.targetTable + '_' + newRule.ruleType;\n        const existingRule = preset.rules.find(r => (r.id || r.targetTable + '_' + r.ruleType) === key && r.builtin);\n        if (existingRule) {\n          // \n          const isModified = JSON.stringify(existingRule) !== JSON.stringify(newRule);\n          if (isModified) {\n            // \n            mergedRules.push({ ...existingRule, builtin: true });\n          } else {\n            // \n            mergedRules.push({ ...newRule, builtin: true });\n          }\n        } else {\n          // \n          mergedRules.push({ ...newRule, builtin: true });\n        }\n        processedCustomIds.add(key);\n      });\n\n      // 2. \n      customRules.forEach(rule => {\n        const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n        if (!builtinRuleIds.has(key)) {\n          mergedRules.push({ ...rule, builtin: false });\n        }\n      });\n\n      preset.rules = mergedRules;\n      preset.version = PRESET_FORMAT_VERSION;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', preset.name);\n      return true;\n    },\n\n    // \n    importPreset(json, autoMerge = false) {\n      try {\n        const data = JSON.parse(json);\n        if (data.format !== 'acu_preset_v1' || !data.preset) return null;\n\n        const importedVersion = data.version || '0.0.0';\n        const needsMerge = this._compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n        const presets = this.getAllPresets();\n        const newPreset = {\n          id: 'imported_' + Date.now(),\n          name: data.preset.name || '',\n          builtin: false,\n          rules: data.preset.rules || [],\n          version: importedVersion,\n          createdAt: new Date().toISOString(),\n        };\n\n        // \n        if (needsMerge && autoMerge) {\n          presets.push(newPreset);\n          this._save(presets);\n          this.mergePresetWithDefaults(newPreset.id);\n          console.log('[DICE]PresetManager :', newPreset.name);\n        } else {\n          presets.push(newPreset);\n          this._save(presets);\n          console.log('[DICE]PresetManager :', newPreset.name);\n          if (needsMerge) {\n            console.warn('[DICE]PresetManager  mergePresetWithDefaults ');\n          }\n        }\n\n        return { preset: newPreset, needsMerge: needsMerge && !autoMerge };\n      } catch (e) {\n        console.error('[DICE]PresetManager :', e);\n        return null;\n      }\n    },\n\n    // \n    _getBuiltinRulesVersion() {\n      try {\n        const rulesStr = JSON.stringify(BUILTIN_VALIDATION_RULES);\n        // \n        let hash = 0;\n        for (let i = 0; i < rulesStr.length; i++) {\n          const char = rulesStr.charCodeAt(i);\n          hash = (hash << 5) - hash + char;\n          hash = hash & hash; // Convert to 32bit integer\n        }\n        return hash.toString(36);\n      } catch (e) {\n        console.error('[DICE]PresetManager :', e);\n        return '0';\n      }\n    },\n\n    // \n    _initDefaultPreset() {\n      const currentVersion = this._getBuiltinRulesVersion();\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n\n      // \n      if (stored && Array.isArray(stored)) {\n        const defaultPreset = stored.find(p => p.id === 'default');\n        if (defaultPreset && defaultPreset._builtinVersion !== currentVersion) {\n          console.log('[DICE]PresetManager ');\n          // \n          const customRules = defaultPreset.rules.filter(r => !r.builtin);\n          defaultPreset.rules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r })), ...customRules];\n          defaultPreset._builtinVersion = currentVersion;\n          this._cache = stored;\n          this._save(stored);\n          Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n          return;\n        }\n      }\n\n      const defaultPreset = {\n        id: 'default',\n        name: '',\n        builtin: true,\n        rules: BUILTIN_VALIDATION_RULES.map(r => ({ ...r })),\n        version: PRESET_FORMAT_VERSION,\n        _builtinVersion: currentVersion,\n        createdAt: new Date().toISOString(),\n      };\n      // \n      const oldCustom = Store.get(STORAGE_KEY_VALIDATION_RULES, []);\n      if (oldCustom.length > 0) {\n        defaultPreset.rules.push(...oldCustom.map(r => ({ ...r, builtin: false })));\n        console.log('[DICE]PresetManager :', oldCustom.length, '');\n      }\n      this._cache = [defaultPreset];\n      this._save(this._cache);\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n    },\n\n    // \n    resetDefaultPreset() {\n      const presets = this.getAllPresets();\n      const defaultPreset = presets.find(p => p.id === 'default');\n      if (defaultPreset) {\n        // \n        const customRules = defaultPreset.rules.filter(r => !r.builtin);\n        defaultPreset.rules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r })), ...customRules];\n        defaultPreset._builtinVersion = this._getBuiltinRulesVersion();\n        this._save(presets);\n        ValidationRuleManager.clearCache();\n        return true;\n      }\n      return false;\n    },\n\n    _save(presets) {\n      Store.set(STORAGE_KEY_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  //  PresetManager \n  const ValidationRuleManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const preset = PresetManager.getActivePreset();\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = (preset?.rules || []).map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_VALIDATION_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n      this._cache = null; // \n    },\n\n    // \n    toggleRuleIntercept(ruleId, intercept) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const rule = preset.rules.find(r => r.id === ruleId);\n      if (!rule) return false;\n\n      rule.intercept = intercept;\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled);\n    },\n\n    // \n    addCustomRule(rule) {\n      if (!rule.id || !rule.name || !rule.targetTable) {\n        console.error('[DICE]ValidationRuleManager ');\n        return false;\n      }\n\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      //  ID \n      if (preset.rules.some(r => r.id === rule.id)) {\n        console.error('[DICE]ValidationRuleManager  ID :', rule.id);\n        return false;\n      }\n\n      const newRule = { ...rule, builtin: false, enabled: true };\n      preset.rules.push(newRule);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      console.log('[DICE]ValidationRuleManager :', newRule.name);\n      return true;\n    },\n\n    // \n    removeCustomRule(ruleId) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules.splice(index, 1);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n\n      // \n      const states = this.getEnabledStates();\n      delete states[ruleId];\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n\n      console.log('[DICE]ValidationRuleManager :', ruleId);\n      return true;\n    },\n\n    // \n    updateCustomRule(ruleId, updates) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules[index] = { ...preset.rules[index], ...updates, id: ruleId };\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getRule(ruleId) {\n      return this.getAllRules().find(r => r.id === ruleId);\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n\n    // \n    getRulesByTable(tableName) {\n      return this.getEnabledRules().filter(rule => rule.targetTable === tableName);\n    },\n  };\n\n  // ========================================\n  // RegexTransformationManager -  (Phase 1.2)\n  // ========================================\n  const RegexTransformationManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // ID\n    _generateId() {\n      return `regex_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    },\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = rules.map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_REGEX_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    _saveEnabledStates(states) {\n      Store.set(STORAGE_KEY_REGEX_ENABLED, states);\n      this._enabledCache = states;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled !== false);\n    },\n\n    // \n    getApplicableRules(tableName, columnName) {\n      const allRules = this.getEnabledRules();\n\n      return allRules\n        .filter(rule => {\n          // \n          switch (rule.scope.type) {\n            case 'global':\n              return true;\n            case 'table':\n              return rule.scope.tableNames && rule.scope.tableNames.includes(tableName);\n            case 'column':\n              return (\n                rule.scope.tableNames &&\n                rule.scope.tableNames.includes(tableName) &&\n                rule.scope.columnNames &&\n                rule.scope.columnNames.includes(columnName)\n              );\n            default:\n              return false;\n          }\n        })\n        .sort((a, b) => b.priority - a.priority); // \n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      this._saveEnabledStates(states);\n      this.clearCache();\n    },\n\n    // \n    addCustomRule(rule) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n\n      // \n      if (!rule.name || !rule.pattern || !rule.scope) {\n        console.error('[DICE]RegexTransformationManager: ');\n        return false;\n      }\n\n      const newRule: RegexTransformationRule = {\n        id: this._generateId(),\n        name: rule.name,\n        description: rule.description,\n        operation: rule.operation || 'replace',\n        pattern: rule.pattern,\n        flags: rule.flags || {},\n        replacement: rule.replacement,\n        scope: rule.scope,\n        enabled: rule.enabled !== undefined ? rule.enabled : true,\n        priority: rule.priority || 50,\n        executeMode: rule.executeMode || 'auto',\n        testCases: rule.testCases || [],\n        security: rule.security || { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      rules.push(newRule);\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n\n      // \n      this._syncRulesToActivePreset();\n\n      return newRule;\n    },\n\n    // \n    _syncRulesToActivePreset() {\n      const activePreset = RegexPresetManager.getActivePreset();\n      if (activePreset) {\n        const allRules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n        RegexPresetManager.updatePresetRules(activePreset.id, allRules);\n      }\n    },\n\n    // \n    removeRule(ruleId) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const index = rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      rules.splice(index, 1);\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n\n      // \n      this._syncRulesToActivePreset();\n\n      return true;\n    },\n\n    // \n    updateRule(ruleId, updates) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const index = rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      rules[index] = {\n        ...rules[index],\n        ...updates,\n        id: ruleId,\n        updatedAt: Date.now(),\n      };\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n\n      // \n      this._syncRulesToActivePreset();\n\n      return true;\n    },\n\n    // \n    getRule(ruleId) {\n      return this.getAllRules().find(r => r.id === ruleId);\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n  };\n\n  // ========================================\n  // RegexPresetManager -  (Phase 1.3)\n  // ========================================\n  const RegexPresetManager = {\n    _cache: null,\n\n    // \n    getAllPresets() {\n      if (this._cache) return this._cache;\n\n      const presets = Store.get(STORAGE_KEY_REGEX_PRESETS, []);\n\n      // \n      if (presets.length === 0) {\n        const defaultPreset: RegexPreset = {\n          id: 'regex_default',\n          name: '',\n          description: '',\n          version: '1.0.0',\n          rules: [],\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n        presets.push(defaultPreset);\n        Store.set(STORAGE_KEY_REGEX_PRESETS, presets);\n      }\n\n      this._cache = presets;\n      return presets;\n    },\n\n    // \n    getActivePreset() {\n      const activeId = Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET, 'regex_default');\n      const presets = this.getAllPresets();\n      return presets.find(p => p.id === activeId) || presets[0];\n    },\n\n    // \n    setActivePreset(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) {\n        console.error('[DICE]RegexPresetManager: ', presetId);\n        return false;\n      }\n\n      Store.set(STORAGE_KEY_REGEX_ACTIVE_PRESET, presetId);\n\n      // RegexTransformationManager\n      RegexTransformationManager.clearCache();\n\n      return true;\n    },\n\n    // \n    createPreset(name, sourcePresetId) {\n      const presets = this.getAllPresets();\n\n      // \n      if (presets.some(p => p.name === name)) {\n        console.error('[DICE]RegexPresetManager: ', name);\n        return false;\n      }\n\n      const sourcePreset = sourcePresetId ? presets.find(p => p.id === sourcePresetId) : this.getActivePreset();\n\n      const newPreset: RegexPreset = {\n        id: `regex_preset_${Date.now()}`,\n        name: name,\n        description: sourcePreset?.description,\n        version: '1.0.0',\n        rules: sourcePreset ? JSON.parse(JSON.stringify(sourcePreset.rules)) : [],\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    updatePresetRules(presetId, rules) {\n      const presets = this.getAllPresets();\n      const index = presets.findIndex(p => p.id === presetId);\n      if (index === -1) return false;\n\n      presets[index].rules = JSON.parse(JSON.stringify(rules));\n      presets[index].updatedAt = Date.now();\n\n      this._save(presets);\n\n      // ,\n      if (presetId === Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET)) {\n        RegexTransformationManager.clearCache();\n      }\n\n      return true;\n    },\n\n    // \n    deletePreset(presetId) {\n      const presets = this.getAllPresets();\n\n      // \n      if (presets.length <= 1) {\n        console.error('[DICE]RegexPresetManager: ');\n        return false;\n      }\n\n      const index = presets.findIndex(p => p.id === presetId);\n      if (index === -1) return false;\n\n      presets.splice(index, 1);\n      this._save(presets);\n\n      // ,\n      if (presetId === Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET)) {\n        this.setActivePreset(presets[0].id);\n      }\n\n      return true;\n    },\n\n    // JSON\n    exportPreset(presetId) {\n      const preset = this.getAllPresets().find(p => p.id === presetId);\n      if (!preset) return null;\n\n      // \n      const activePreset = this.getActivePreset();\n      const isActivePreset = activePreset && activePreset.id === presetId;\n      const rules = isActivePreset ? Store.get(STORAGE_KEY_REGEX_RULES, []) : preset.rules;\n\n      const exportData = {\n        ...preset,\n        rules: rules,\n      };\n\n      return JSON.stringify(exportData, null, 2);\n    },\n\n    // JSON\n    importPreset(jsonString) {\n      try {\n        const data = JSON.parse(jsonString);\n\n        // \n        if (!data.name || !Array.isArray(data.rules)) {\n          console.error('[DICE]RegexPresetManager: ');\n          return false;\n        }\n\n        const presets = this.getAllPresets();\n\n        // ID\n        const newPreset: RegexPreset = {\n          id: `regex_preset_${Date.now()}`,\n          name: data.name,\n          description: data.description,\n          version: data.version || '1.0.0',\n          rules: data.rules.map((rule: RegexTransformationRule) => ({\n            ...rule,\n            id: RegexTransformationManager._generateId(),\n          })),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n\n        presets.push(newPreset);\n        this._save(presets);\n        return newPreset;\n      } catch (e) {\n        console.error('[DICE]RegexPresetManager: ', e);\n        return false;\n      }\n    },\n\n    // \n    _save(presets) {\n      Store.set(STORAGE_KEY_REGEX_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  // ========================================\n  // RegexTransformationEngine -  (Phase 2.1)\n  // ========================================\n  const RegexTransformationEngine = {\n    // \n    _regexCache: new Map<string, RegExp>(),\n\n    // \n    _buildFlags(flags: RegexFlags): string {\n      const result: string[] = [];\n      if (flags.caseInsensitive) result.push('i');\n      if (flags.global) result.push('g');\n      if (flags.multiline) result.push('m');\n      if (flags.unicode) result.push('u');\n      if (flags.sticky) result.push('y');\n      return result.join('');\n    },\n\n    // ()\n    _getRegex(pattern: string, flags: RegexFlags): RegExp | null {\n      //  unicode \n      const hasLookbehind = pattern.includes('(?<') || pattern.includes('(?<=');\n      const hasLookahead = pattern.includes('(?=') || pattern.includes('(?!');\n      const needsUnicode = hasLookbehind || hasLookahead;\n\n      //  unicode \n      if (needsUnicode && !flags.unicode) {\n        flags = { ...flags, unicode: true };\n      }\n\n      const flagsStr = this._buildFlags(flags);\n      const cacheKey = `${pattern}/${flagsStr}`;\n\n      if (this._regexCache.has(cacheKey)) {\n        const regex = this._regexCache.get(cacheKey)!;\n        regex.lastIndex = 0;\n        return regex;\n      }\n\n      try {\n        const regex = new RegExp(pattern, flagsStr);\n        this._regexCache.set(cacheKey, regex);\n        return regex;\n      } catch (e) {\n        console.error('[DICE]RegexTransformationEngine: ', pattern, e);\n        return null;\n      }\n    },\n\n    // ReDoS: \n    _scoreRegexComplexity(pattern: string): number {\n      let score = 0;\n\n      //  +50\n      if (/(\\*|\\+|\\{)\\1{2,}/.test(pattern)) score += 50;\n\n      //  +30\n      if (/(\\.\\*|\\.\\+)[^\\[]*\\1/.test(pattern)) score += 30;\n\n      //  +10\n      const captureGroups = (pattern.match(/\\(/g) || []).length;\n      score += Math.min(captureGroups * 5, 20);\n\n      return score;\n    },\n\n    // ReDoS: \n    _getTimeoutForRule(rule: RegexTransformationRule): number {\n      const complexity = this._scoreRegexComplexity(rule.pattern);\n      const baseTimeout = rule.security?.maxMatchTime || 100;\n      // ,\n      return Math.max(baseTimeout - complexity * 2, 50);\n    },\n\n    // \n    _safeReplace(value: string, rule: RegexTransformationRule, regex: RegExp): RegexTransformResult {\n      const oldValue = value;\n\n      // \n      const maxInputLength = rule.security?.maxInputLength || 10000;\n      if (value.length > maxInputLength) {\n        return {\n          success: false,\n          oldValue,\n          newValue: oldValue,\n          matched: false,\n          error: `(${maxInputLength})`,\n        };\n      }\n\n      try {\n        const timeout = this._getTimeoutForRule(rule);\n        const startTime = Date.now();\n\n        // \n        let newValue: string;\n        switch (rule.operation) {\n          case 'replace':\n            newValue = value.replace(regex, rule.replacement || '');\n            break;\n          case 'delete':\n            newValue = value.replace(regex, '');\n            break;\n          case 'validate':\n            const isValid = regex.test(value);\n            newValue = value;\n            break;\n          default:\n            newValue = value;\n        }\n\n        // \n        const elapsed = Date.now() - startTime;\n        if (elapsed > timeout) {\n          console.warn('[DICE]RegexTransformationEngine: ', rule.pattern, elapsed);\n          return {\n            success: false,\n            oldValue,\n            newValue: oldValue,\n            matched: false,\n            error: `(${elapsed}ms > ${timeout}ms)`,\n          };\n        }\n\n        // \n        const matched = oldValue !== newValue || regex.test(oldValue);\n\n        return {\n          success: true,\n          oldValue,\n          newValue,\n          matched,\n        };\n      } catch (e) {\n        console.error('[DICE]RegexTransformationEngine: ', rule.pattern, e);\n        return {\n          success: false,\n          oldValue,\n          newValue: oldValue,\n          matched: false,\n          error: String(e),\n        };\n      }\n    },\n\n    // \n    applyToValue(value: string, rule: RegexTransformationRule): RegexTransformResult {\n      if (value === null || value === undefined) {\n        return {\n          success: true,\n          oldValue: '',\n          newValue: '',\n          matched: false,\n        };\n      }\n\n      const strValue = String(value);\n\n      //  pattern  flags /pattern/flags\n      let pattern = rule.pattern;\n      let flags = rule.flags || {};\n\n      //  /pattern/flags \n      const extracted = this._extractFlags(pattern);\n      if (extracted.patternWithoutFlags !== pattern) {\n        //  pattern  flags\n        pattern = extracted.patternWithoutFlags;\n        flags = { ...flags, ...extracted.flags };\n      }\n\n      // \n      //  flags  global true\n      if (flags.global === undefined) {\n        flags.global = true;\n      }\n\n      const regex = this._getRegex(pattern, flags);\n\n      if (!regex) {\n        return {\n          success: false,\n          oldValue: strValue,\n          newValue: strValue,\n          matched: false,\n          error: '',\n        };\n      }\n\n      return this._safeReplace(strValue, rule, regex);\n    },\n\n    // flags (: /test/g  'g')\n    _extractFlags(patternStr: string): { flags: RegexFlags; patternWithoutFlags: string } {\n      const flags: RegexFlags = {\n        global: false,\n        caseInsensitive: false,\n        multiline: false,\n        unicode: false,\n        sticky: false,\n      };\n\n      //  /pattern/flags \n      const inlineFlagMatch = patternStr.match(/^\\/(.+)\\/([gimuy]*)$/);\n      if (inlineFlagMatch) {\n        const [, patternWithoutFlags, flagStr] = inlineFlagMatch;\n        if (flagStr.includes('g')) flags.global = true;\n        if (flagStr.includes('i')) flags.caseInsensitive = true;\n        if (flagStr.includes('m')) flags.multiline = true;\n        if (flagStr.includes('u')) flags.unicode = true;\n        if (flagStr.includes('y')) flags.sticky = true;\n        return { flags, patternWithoutFlags };\n      }\n\n      // flags\n      return { flags, patternWithoutFlags: patternStr };\n    },\n\n    // \n    applyToTable(\n      tableData:\n        | { name: string; headers: string[]; rows: string[][] }\n        | { [key: string]: { name?: string; content?: string[][] } },\n      rules: RegexTransformationRule[],\n    ): { totalApplied: number; errors: string[] } {\n      let totalApplied = 0;\n      const errors: string[] = [];\n\n      try {\n        // \n        let isSimpleFormat = false;\n        let sheetMap: Map<\n          string,\n          { sheet: any; sheetKey: string; name: string; headers: string[]; contentRowIndex: number }\n        > = new Map();\n\n        if ('name' in tableData && 'headers' in tableData && 'rows' in tableData) {\n          // : { name, headers, rows }\n          isSimpleFormat = true;\n          const simpleTable = tableData as { name: string; headers: string[]; rows: string[][] };\n          sheetMap.set(simpleTable.name, {\n            sheet: simpleTable,\n            sheetKey: simpleTable.name,\n            name: simpleTable.name,\n            headers: simpleTable.headers,\n            contentRowIndex: -1, //  contentRowIndex\n          });\n        } else {\n          // : { sheet_xxx: { name, content: [headers, ...rows] } }\n          const dataObj = tableData as { [key: string]: { name?: string; content?: string[][] } };\n\n          Object.keys(dataObj).forEach(sheetKey => {\n            if (!sheetKey.startsWith('sheet_')) return;\n\n            const sheet = dataObj[sheetKey];\n            if (!sheet || !sheet.content || !Array.isArray(sheet.content) || sheet.content.length < 1) {\n              console.warn(`[DICE]applyToTable:  ${sheetKey}`);\n              return;\n            }\n\n            const tableName = sheet.name || sheetKey;\n            sheetMap.set(tableName, {\n              sheet,\n              sheetKey,\n              name: tableName,\n              headers: sheet.content[0] || [],\n              contentRowIndex: 0, //  content[0]\n            });\n          });\n        }\n\n        if (sheetMap.size === 0) {\n          console.warn('[DICE]applyToTable: ');\n          return { totalApplied: 0, errors: [''] };\n        }\n\n        // \n        for (const [tableName, tableInfo] of sheetMap.entries()) {\n          const { sheet, headers, contentRowIndex } = tableInfo;\n\n          for (const rule of rules) {\n            if (!rule.enabled) continue;\n\n            // \n            const scope = rule.scope;\n            const shouldProcessTable = scope.type === 'global' || scope.tableNames?.includes(tableName);\n\n            if (!shouldProcessTable) continue;\n\n            try {\n              // \n              if (isSimpleFormat) {\n                //  rows\n                const rows = (sheet as { rows: string[][] }).rows;\n                for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {\n                  const row = rows[rowIndex];\n\n                  // \n                  for (let colIndex = 0; colIndex < row.length; colIndex++) {\n                    const columnName = headers[colIndex];\n\n                    // \n                    if (scope.type === 'column') {\n                      if (!scope.columnNames?.includes(columnName)) continue;\n                    }\n\n                    // \n                    const result = this.applyToValue(row[colIndex], rule);\n                    if (result.success) {\n                      if (result.matched) {\n                        row[colIndex] = result.newValue;\n                        totalApplied++;\n                      }\n                    } else {\n                      errors.push(`${rule.name} [${tableName}]: ${result.error}`);\n                    }\n                  }\n                }\n              } else {\n                //  content  content[1] \n                const content = sheet.content;\n                for (let contentRowIndex = 1; contentRowIndex < content.length; contentRowIndex++) {\n                  const row = content[contentRowIndex];\n                  if (!Array.isArray(row)) continue;\n\n                  // \n                  for (let colIndex = 0; colIndex < row.length; colIndex++) {\n                    const columnName = headers[colIndex];\n\n                    // \n                    if (scope.type === 'column') {\n                      if (!scope.columnNames?.includes(columnName)) continue;\n                    }\n\n                    // \n                    const oldValue = row[colIndex];\n                    const result = this.applyToValue(oldValue, rule);\n\n                    if (result.success) {\n                      if (result.matched) {\n                        row[colIndex] = result.newValue;\n                        totalApplied++;\n                        console.debug(\n                          `[DICE]: ${tableName}[${contentRowIndex}].${columnName}`,\n                          `\"${result.oldValue}\" -> \"${result.newValue}\"`,\n                        );\n                      }\n                    } else {\n                      errors.push(`${rule.name} [${tableName}]: ${result.error}`);\n                    }\n                  }\n                }\n              }\n            } catch (tableError) {\n              const errorMsg = tableError instanceof Error ? tableError.message : String(tableError);\n              console.error(`[DICE]applyToTable:  ${tableName} :`, tableError);\n              errors.push(`${rule.name} [${tableName}]:  - ${errorMsg}`);\n            }\n          }\n        }\n\n        if (totalApplied > 0) {\n          console.info(`[DICE]applyToTable:  ${totalApplied} `);\n        }\n        if (errors.length > 0) {\n          console.warn(`[DICE]applyToTable:  ${errors.length} `);\n        }\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : String(e);\n        console.error('[DICE]applyToTable: :', e);\n        errors.push(`: ${errorMsg}`);\n      }\n\n      return { totalApplied, errors };\n    },\n\n    // \n    applyToCell(\n      value: string,\n      tableName: string,\n      columnName: string,\n      executeMode?: RegexExecutionMode,\n    ): RegexTransformResult {\n      // \n      const rules = RegexTransformationManager.getApplicableRules(tableName, columnName);\n\n      // ,\n      if (rules.length === 0) {\n        return {\n          success: true,\n          oldValue: value || '',\n          newValue: value || '',\n          matched: false,\n        };\n      }\n\n      // \n      let applicableRules = rules;\n      if (executeMode) {\n        applicableRules = rules.filter(r => r.executeMode === executeMode || r.executeMode === 'auto');\n      }\n\n      if (applicableRules.length === 0) {\n        return {\n          success: true,\n          oldValue: value || '',\n          newValue: value || '',\n          matched: false,\n        };\n      }\n\n      // \n      let currentValue = value || '';\n      let wasMatched = false;\n\n      for (const rule of applicableRules) {\n        const result = this.applyToValue(currentValue, rule);\n        if (!result.success) {\n          return result;\n        }\n        if (result.matched) {\n          wasMatched = true;\n        }\n        currentValue = result.newValue;\n      }\n\n      return {\n        success: true,\n        oldValue: value || '',\n        newValue: currentValue,\n        matched: wasMatched,\n      };\n    },\n\n    // \n    applyToRow(row: string[], headers: string[], tableName: string, executeMode?: RegexExecutionMode): string[] {\n      return row.map((cell, index) => {\n        const columnName = headers[index];\n        const result = this.applyToCell(cell, tableName, columnName, executeMode);\n        return result.newValue;\n      });\n    },\n\n    // \n    previewBatchTransform(\n      tableData: { name: string; headers: string[]; rows: string[][] },\n      executeMode?: RegexExecutionMode,\n    ): RegexPreviewResult[] {\n      const tableName = tableData.name;\n      const rules = RegexTransformationManager.getApplicableRules(tableName, null).filter(\n        r => r.scope.type === 'global' || r.scope.tableNames?.includes(tableName),\n      );\n\n      const results: RegexPreviewResult[] = [];\n\n      for (const rule of rules) {\n        const affectedCells: RegexPreviewResult['affectedCells'] = [];\n        let totalAffected = 0;\n\n        for (let rowIndex = 0; rowIndex < tableData.rows.length; rowIndex++) {\n          const row = tableData.rows[rowIndex];\n          for (let colIndex = 0; colIndex < row.length; colIndex++) {\n            const columnName = tableData.headers[colIndex];\n            const value = row[colIndex];\n\n            // \n            if (rule.scope.type === 'column') {\n              if (!rule.scope.columnNames?.includes(columnName) || !rule.scope.tableNames?.includes(tableName)) {\n                continue;\n              }\n            } else if (rule.scope.type === 'table') {\n              if (!rule.scope.tableNames?.includes(tableName)) {\n                continue;\n              }\n            }\n\n            const result = this.applyToValue(value, rule);\n            if (result.matched && result.oldValue !== result.newValue) {\n              affectedCells.push({\n                tableName,\n                rowIndex,\n                columnIndex: colIndex,\n                columnName,\n                oldValue: result.oldValue,\n                newValue: result.newValue,\n              });\n              totalAffected++;\n            }\n          }\n        }\n\n        if (totalAffected > 0) {\n          results.push({\n            rule,\n            affectedCells,\n            totalAffected,\n          });\n        }\n      }\n\n      return results;\n    },\n\n    // \n    clearRegexCache() {\n      this._regexCache.clear();\n    },\n  };\n\n  // ========================================\n  // ValidationEngine - \n  // ========================================\n  const ValidationEngine = {\n    // \n    validateFormat(value, pattern) {\n      if (value === null || value === undefined || value === '') return true; // \n      try {\n        const regex = new RegExp(pattern);\n        return regex.test(String(value));\n      } catch (e) {\n        console.error('[DICE]ValidationEngine :', pattern, e);\n        return true; // \n      }\n    },\n\n    // \n    validateEnum(value, allowedValues) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!Array.isArray(allowedValues) || allowedValues.length === 0) return true;\n      return allowedValues.includes(String(value));\n    },\n\n    // \n    validateNumeric(value, min, max) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      //  \"50/100\"  \":80\" \n      const strVal = String(value);\n      let numVal;\n\n      //  \"50%\"\n      if (strVal.endsWith('%')) {\n        numVal = parseFloat(strVal);\n      }\n      //  \"50/100\"\n      else if (strVal.includes('/')) {\n        const parts = strVal.split('/');\n        numVal = parseFloat(parts[0]);\n      }\n      //  \":\" \n      else if (strVal.includes(':')) {\n        const parts = strVal.split(':');\n        numVal = parseFloat(parts[parts.length - 1]);\n      }\n      // \n      else {\n        numVal = parseFloat(strVal);\n      }\n\n      if (isNaN(numVal)) return false; // \n\n      if (min !== undefined && min !== null && numVal < min) return false;\n      if (max !== undefined && max !== null && numVal > max) return false;\n      return true;\n    },\n\n    //  OR \n    validateRelation(value, rawData, refTable, refColumn) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!rawData || !refTable || !refColumn) return true;\n\n      // \n      let refSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === refTable) {\n          refSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!refSheet || !refSheet.content || refSheet.content.length < 2) {\n        return true; // \n      }\n\n      const headers = refSheet.content[0];\n      const strVal = String(value);\n\n      //  refColumn \n      const columns = Array.isArray(refColumn) ? refColumn : [refColumn];\n\n      for (const col of columns) {\n        const refColIndex = headers.indexOf(col);\n        if (refColIndex === -1) continue; // \n\n        // \n        for (let i = 1; i < refSheet.content.length; i++) {\n          if (String(refSheet.content[i][refColIndex] || '') === strVal) {\n            return true; // \n          }\n        }\n      }\n\n      return columns.length === 0; //  true false\n    },\n\n    // \n    validateRequired(value) {\n      return value !== null && value !== undefined && String(value).trim() !== '';\n    },\n\n    // \n    validateKeyValue(value, ruleConfig) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      const valueType = ruleConfig?.valueType || 'text';\n      const valueMin = ruleConfig?.valueMin;\n      const valueMax = ruleConfig?.valueMax;\n\n      // \n      let processedValue = String(value);\n\n      // \n      processedValue = processedValue\n        .replace(//g, ':') //   \n        .replace(//g, ';') //   \n        .replace(//g, ';'); //   \n\n      // \n      processedValue = processedValue.replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n\n      if (pairs.length === 0) return false; // \n\n      // \n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          return false; // /\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) return false; // \n\n        // \n        if (valueType === 'numeric') {\n          // \n          if (!/^-?\\d+(\\.\\d+)?$/.test(val.trim())) return false; // \n\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) return false; // \n\n          if (valueMin !== undefined && valueMin !== null && numVal < valueMin) return false;\n          if (valueMax !== undefined && valueMax !== null && numVal > valueMax) return false;\n        }\n        // \n      }\n\n      return true;\n    },\n\n    // \n    validateTableReadonly(oldContent, newContent) {\n      if (!oldContent || !newContent) return true;\n      return JSON.stringify(oldContent) === JSON.stringify(newContent);\n    },\n\n    // \n    validateRowLimit(rowCount, min, max) {\n      if (min !== undefined && min !== null && rowCount < min) return false;\n      if (max !== undefined && max !== null && rowCount > max) return false;\n      return true;\n    },\n\n    // \n    validateSequence(sheet, columnName, config) {\n      if (!sheet || !sheet.content || sheet.content.length < 2) return true; // \n      if (!columnName || !config) return true;\n\n      const headers = sheet.content[0] || [];\n      const rows = sheet.content.slice(1) || [];\n      const colIndex = headers.indexOf(columnName);\n      if (colIndex < 0) return true; // \n\n      const prefix = config.prefix || '';\n      const startFrom = config.startFrom !== undefined ? config.startFrom : 1;\n\n      // \n      const numbers = [];\n      const allRowValues = []; // \n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        allRowValues.push({ rowIndex: i, rawValue: value, type: typeof value });\n        if (value === null || value === undefined || value === '') continue;\n\n        const strValue = String(value).trim();\n        if (!strValue) continue;\n\n        // +\n        if (prefix) {\n          const regex = new RegExp(`^${prefix}(\\\\d+)$`);\n          const match = strValue.match(regex);\n          if (match) {\n            const num = parseInt(match[1], 10);\n            if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n          }\n        } else {\n          // \n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n        }\n      }\n\n      if (numbers.length === 0) return true; // \n\n      // \n      numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n      // \n      const numSet = new Set(numbers.map(n => n.num));\n      if (numSet.size !== numbers.length) {\n        return false; // \n      }\n\n      // startFrom\n      // startFromstartFrom+1\n      for (let i = 0; i < numbers.length; i++) {\n        const expectedNum = startFrom + i;\n        const actualNum = numbers[i].num;\n        if (actualNum !== expectedNum) {\n          return false; // startFrom\n        }\n      }\n\n      return true;\n    },\n\n    //  intercept \n    checkTableRules(snapshot, newData, rules) {\n      const violations = [];\n      if (!snapshot || !newData || !rules) return violations;\n\n      for (const rule of rules) {\n        // \n        if (!rule.enabled || !rule.intercept) continue;\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n        if (!typeInfo) continue;\n\n        // \n        let oldSheet = null,\n          newSheet = null;\n        for (const sheetId in snapshot) {\n          if (snapshot[sheetId]?.name === rule.targetTable) {\n            oldSheet = snapshot[sheetId];\n            break;\n          }\n        }\n        for (const sheetId in newData) {\n          if (newData[sheetId]?.name === rule.targetTable) {\n            newSheet = newData[sheetId];\n            break;\n          }\n        }\n\n        if (!newSheet) continue;\n\n        // \n        if (typeInfo.scope === 'table') {\n          if (rule.ruleType === 'tableReadonly') {\n            if (!this.validateTableReadonly(oldSheet?.content, newSheet?.content)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message: rule.errorMessage || ` \"${rule.targetTable}\" `,\n              });\n            }\n          } else if (rule.ruleType === 'rowLimit') {\n            const rowCount = (newSheet.content?.length || 1) - 1; // \n            if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetTable}\"  ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n              });\n            }\n          } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n            // \n            if (!this.validateSequence(newSheet, rule.targetColumn, rule.config || {})) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(4, '0')}`,\n              });\n            }\n          }\n        }\n        // \n        else if (typeInfo.scope === 'field' && rule.targetColumn) {\n          const headers = newSheet.content?.[0] || [];\n          const colIndex = headers.indexOf(rule.targetColumn);\n          if (colIndex === -1) continue;\n\n          // \n          for (let rowIdx = 1; rowIdx < (newSheet.content?.length || 0); rowIdx++) {\n            const row = newSheet.content[rowIdx];\n            const value = row?.[colIndex];\n            const isValid = this.validateValue(value, rule, newData);\n\n            if (!isValid) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                rowIndex: rowIdx,\n                columnName: rule.targetColumn,\n                currentValue: String(value ?? ''),\n                message: rule.errorMessage || ` \"${rule.targetColumn}\" `,\n              });\n              // \n              break;\n            }\n          }\n        }\n      }\n      return violations;\n    },\n\n    // \n    validateValue(value, rule, rawData) {\n      switch (rule.ruleType) {\n        case 'format':\n          return this.validateFormat(value, rule.config?.pattern);\n        case 'enum':\n          return this.validateEnum(value, rule.config?.values);\n        case 'numeric':\n          return this.validateNumeric(value, rule.config?.min, rule.config?.max);\n        case 'relation':\n          return this.validateRelation(value, rawData, rule.config?.refTable, rule.config?.refColumn);\n        case 'required':\n          return this.validateRequired(value);\n        case 'keyValue':\n          return this.validateKeyValue(value, rule.config);\n        default:\n          return true;\n      }\n    },\n\n    // \n    validateRow(row, headers, tableName, rowIndex, rules, rawData) {\n      const errors = [];\n      // \n      const rowTitle = row[1] || row[0] || ` ${rowIndex + 1}`;\n\n      for (const rule of rules) {\n        if (rule.targetTable !== tableName) continue;\n        if (!rule.enabled) continue;\n\n        // \n        const colIndex = headers.indexOf(rule.targetColumn);\n        if (colIndex === -1) continue;\n\n        const value = row[colIndex];\n        const isValid = this.validateValue(value, rule, rawData);\n\n        if (!isValid) {\n          errors.push({\n            ruleId: rule.id,\n            ruleName: rule.name,\n            ruleType: rule.ruleType,\n            rule: rule, // \n            tableName: tableName,\n            rowIndex: rowIndex,\n            columnName: rule.targetColumn,\n            currentValue: String(value ?? ''),\n            rowTitle: rowTitle, // \n            errorMessage: rule.errorMessage,\n            severity: 'error',\n          });\n        }\n      }\n\n      return errors;\n    },\n\n    // \n    validateAllData(rawData) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getEnabledRules();\n      if (rules.length === 0) return [];\n\n      const allErrors = [];\n\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const sheet = rawData[sheetId];\n        if (!sheet?.name || !sheet?.content || sheet.content.length < 2) continue;\n\n        const tableName = sheet.name;\n        const headers = sheet.content[0];\n        const tableRules = rules.filter(r => r.targetTable === tableName);\n\n        if (tableRules.length === 0) continue;\n\n        // \n        for (const rule of tableRules) {\n          const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n          if (typeInfo?.scope === 'table') {\n            if (rule.ruleType === 'rowLimit') {\n              const rowCount = sheet.content.length - 1;\n              if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n                allErrors.push({\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: '',\n                  currentValue: `${rowCount} `,\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n                  severity: 'warning',\n                });\n              }\n            } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n              // \n              const isValid = this.validateSequence(sheet, rule.targetColumn, rule.config || {});\n              if (!isValid) {\n                const error = {\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: rule.targetColumn,\n                  currentValue: '',\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(4, '0')}`,\n                  severity: 'error',\n                };\n                allErrors.push(error);\n              }\n            }\n            // tableReadonly \n          }\n        }\n\n        // \n        const fieldRules = tableRules.filter(r => RULE_TYPE_INFO[r.ruleType]?.scope !== 'table');\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          const rowErrors = this.validateRow(row, headers, tableName, i - 1, fieldRules, rawData);\n          allErrors.push(...rowErrors);\n        }\n      }\n\n      return allErrors;\n    },\n\n    // \n    validateTable(rawData, tableName) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getRulesByTable(tableName);\n      if (rules.length === 0) return [];\n\n      // \n      let targetSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n        return [];\n      }\n\n      const headers = targetSheet.content[0];\n      const allErrors = [];\n\n      for (let i = 1; i < targetSheet.content.length; i++) {\n        const row = targetSheet.content[i];\n        const rowErrors = this.validateRow(row, headers, tableName, i - 1, rules, rawData);\n        allErrors.push(...rowErrors);\n      }\n\n      return allErrors;\n    },\n\n    // \n    groupErrorsByTable(errors) {\n      const grouped = {};\n      for (const error of errors) {\n        if (!grouped[error.tableName]) {\n          grouped[error.tableName] = [];\n        }\n        grouped[error.tableName].push(error);\n      }\n      return grouped;\n    },\n\n    // \n    getErrorCount(rawData) {\n      return this.validateAllData(rawData).length;\n    },\n  };\n\n  // ========================================\n  // LocalAvatarDB -  IndexedDB \n  // ========================================\n  const LocalAvatarDB = {\n    DB_NAME: 'acu_local_avatars',\n    STORE_NAME: 'avatars',\n    DB_VERSION: 1,\n    _db: null,\n    _urlCache: new Map(), //  ObjectURL \n\n    // \n    async init() {\n      if (this._db) return this._db;\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n        request.onerror = () => {\n          console.error('[DICE]LocalAvatarDB :', request.error);\n          reject(request.error);\n        };\n\n        request.onsuccess = () => {\n          this._db = request.result;\n          resolve(this._db);\n        };\n\n        request.onupgradeneeded = event => {\n          const db = event.target.result;\n          if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n            // \n            db.createObjectStore(this.STORE_NAME, { keyPath: 'name' });\n          }\n        };\n      });\n    },\n\n    //  name \n    async save(name, blob) {\n      if (!name || !blob) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          //  ObjectURL \n          if (this._urlCache.has(name)) {\n            URL.revokeObjectURL(this._urlCache.get(name));\n            this._urlCache.delete(name);\n          }\n\n          const data = {\n            name: name,\n            blob: blob,\n            size: blob.size,\n            type: blob.type,\n            updatedAt: Date.now(),\n          };\n\n          const request = store.put(data);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]LocalAvatarDB :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB save error:', e);\n        return false;\n      }\n    },\n\n    //  URL ObjectURL\n    async get(name) {\n      if (!name) return null;\n\n      // \n      if (this._urlCache.has(name)) {\n        return this._urlCache.get(name);\n      }\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.get(name);\n\n          request.onsuccess = () => {\n            const data = request.result;\n            if (data && data.blob) {\n              const url = URL.createObjectURL(data.blob);\n              this._urlCache.set(name, url);\n              resolve(url);\n            } else {\n              resolve(null);\n            }\n          };\n\n          request.onerror = () => resolve(null);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB get error:', e);\n        return null;\n      }\n    },\n\n    // \n    async has(name) {\n      if (!name) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getKey(name);\n\n          request.onsuccess = () => resolve(request.result !== undefined);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        return false;\n      }\n    },\n\n    // \n    async delete(name) {\n      if (!name) return false;\n\n      try {\n        //  ObjectURL \n        if (this._urlCache.has(name)) {\n          URL.revokeObjectURL(this._urlCache.get(name));\n          this._urlCache.delete(name);\n        }\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.delete(name);\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB delete error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAllNames() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAllKeys();\n\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => resolve([]);\n        });\n      } catch (e) {\n        return [];\n      }\n    },\n\n    // \n    async getStats() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAll();\n\n          request.onsuccess = () => {\n            const items = request.result || [];\n            const totalSize = items.reduce((sum, item) => sum + (item.size || 0), 0);\n            resolve({\n              count: items.length,\n              totalSize: totalSize,\n              totalSizeMB: (totalSize / 1024 / 1024).toFixed(2),\n            });\n          };\n\n          request.onerror = () => resolve({ count: 0, totalSize: 0, totalSizeMB: '0' });\n        });\n      } catch (e) {\n        return { count: 0, totalSize: 0, totalSizeMB: '0' };\n      }\n    },\n\n    // \n    async clearAll() {\n      try {\n        //  ObjectURL \n        this._urlCache.forEach(url => URL.revokeObjectURL(url));\n        this._urlCache.clear();\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.clear();\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB clearAll error:', e);\n        return false;\n      }\n    },\n  };\n\n  // []  SillyTavern  URL\n  const getUserAvatarUrl = () => {\n    try {\n      // 1:  DOM \n      const w = window.parent || window;\n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        // SillyTavern  #user_avatar_block img  .avatar[title=\"You\"] img\n        const $avatar = $('#user_avatar_block img').first();\n        if ($avatar.length && $avatar.attr('src')) {\n          return $avatar.attr('src');\n        }\n        // \n        const $userMes = $('.mes[is_user=\"true\"]').last().find('.avatar img');\n        if ($userMes.length && $userMes.attr('src')) {\n          return $userMes.attr('src');\n        }\n      }\n      // 2:  SillyTavern API \n      const ST = w.SillyTavern || window.SillyTavern;\n      if (ST && ST.getContext) {\n        const ctx = ST.getContext();\n        if (ctx && ctx.userAvatar) {\n          return ctx.userAvatar;\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getUserAvatarUrl error:', e);\n    }\n    return null;\n  };\n\n  // [] \n  const getPlayerName = () => {\n    const rawData = cachedRawData || (typeof getTableData === 'function' ? getTableData() : null);\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]?.[1]) {\n          return sheet.content[1][1];\n        }\n      }\n    }\n    return null;\n  };\n\n  // []  SillyTavern Persona \n  const getPersonaName = () => {\n    try {\n      // 1: SillyTavern  API\n      const w = window.parent || window;\n      if (w.SillyTavern?.getContext) {\n        const ctx = w.SillyTavern.getContext();\n        if (ctx?.name1) return ctx.name1;\n      }\n      // 2: \n      if (typeof name1 !== 'undefined' && name1) return name1;\n      if (w.name1) return w.name1;\n      // 3:  DOM \n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        const $persona = $('#user_avatar_block .avatar-name, #persona_name_input').first();\n        if ($persona.length) {\n          const name = $persona.val?.() || $persona.text?.();\n          if (name && name.trim()) return name.trim();\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getPersonaName error:', e);\n    }\n    return null;\n  };\n\n  // []  Persona\n  const getDisplayPlayerName = () => {\n    return getPersonaName() || getPlayerName() || '';\n  };\n\n  // []  Persona \n  const replaceUserPlaceholders = text => {\n    if (!text || typeof text !== 'string') return text;\n    const displayName = getDisplayPlayerName();\n    //  <user>{{user}}\n    let result = text.replace(/<user>/gi, displayName);\n    result = result.replace(/\\{\\{user\\}\\}/gi, displayName);\n    return result;\n  };\n  // \n  const AvatarManager = {\n    _cache: null,\n\n    load() {\n      if (!this._cache) {\n        const raw = Store.get(STORAGE_KEY_AVATAR_MAP, {});\n        this._cache = {};\n        for (const name in raw) {\n          if (typeof raw[name] === 'string') {\n            this._cache[name] = { url: raw[name], offsetX: 50, offsetY: 50, scale: 150, aliases: [] };\n          } else {\n            this._cache[name] = {\n              url: raw[name].url || '',\n              offsetX: raw[name].offsetX ?? 50,\n              offsetY: raw[name].offsetY ?? 50,\n              scale: raw[name].scale ?? 150,\n              aliases: raw[name].aliases || [],\n            };\n          }\n        }\n      }\n      return this._cache;\n    },\n\n    save() {\n      Store.set(STORAGE_KEY_AVATAR_MAP, this._cache || {});\n      this._cache = null;\n    },\n\n    //  URL  ST \n    get(name) {\n      const data = this.load()[name];\n      if (data && data.url) return data.url;\n\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          if (this._cache[key].url) return this._cache[key].url;\n        }\n      }\n\n      return null;\n    },\n\n    //  > URL > ST\n    async getAsync(name) {\n      if (!name) return null;\n\n      // \n      const playerName = getPlayerName();\n      const isPlayer = name === '<user>' || name === '' || (playerName && name === playerName);\n\n      // 1.  IndexedDB\n      const localUrl = await LocalAvatarDB.get(name);\n      if (localUrl) return localUrl;\n\n      // 2.  <user> \n      if (isPlayer && name !== '<user>') {\n        const userLocalUrl = await LocalAvatarDB.get('<user>');\n        if (userLocalUrl) return userLocalUrl;\n      }\n\n      // 3. \n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        const aliasLocalUrl = await LocalAvatarDB.get(primaryName);\n        if (aliasLocalUrl) return aliasLocalUrl;\n      }\n\n      // 4. URL / ST\n      return this.get(name);\n    },\n\n    // \n    async hasLocalAvatar(name) {\n      if (!name) return false;\n      const has = await LocalAvatarDB.has(name);\n      if (has) return true;\n\n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        return await LocalAvatarDB.has(primaryName);\n      }\n      return false;\n    },\n\n    // \n    async saveLocalAvatar(name, blob) {\n      return await LocalAvatarDB.save(name, blob);\n    },\n\n    // \n    async deleteLocalAvatar(name) {\n      return await LocalAvatarDB.delete(name);\n    },\n\n    getOffsetX(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetX ?? 50) : 50;\n    },\n\n    getOffsetY(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetY ?? 50) : 50;\n    },\n\n    getScale(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.scale ?? 150) : 150;\n    },\n\n    // \n    _resolveByAlias(name) {\n      const data = this.load()[name];\n      if (data) return data;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return this._cache[key];\n        }\n      }\n      return null;\n    },\n\n    // \n    getPrimaryName(name) {\n      if (this.load()[name]) return name;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return key;\n        }\n      }\n      return name;\n    },\n\n    set(name, url, offsetX = 50, offsetY = 50, scale = 150, aliases = []) {\n      this.load()[name] = { url, offsetX, offsetY, scale, aliases };\n      this.save();\n    },\n\n    setPosition(name, offsetX, offsetY) {\n      const data = this.load()[name];\n      if (data) {\n        data.offsetX = offsetX;\n        data.offsetY = offsetY;\n        this.save();\n      }\n    },\n\n    setScale(name, scale) {\n      const data = this.load()[name];\n      if (data) {\n        data.scale = scale;\n        this.save();\n      }\n    },\n\n    setAliases(name, aliases) {\n      const data = this.load()[name];\n      if (data) {\n        data.aliases = aliases;\n        this.save();\n      }\n    },\n\n    remove(name) {\n      delete this.load()[name];\n      this.save();\n    },\n\n    getAll() {\n      return this.load();\n    },\n\n    // JSON\n    exportData() {\n      return {\n        version: 1,\n        exportTime: new Date().toISOString(),\n        avatars: this.load(),\n      };\n    },\n\n    // \n    importData(jsonData, overwriteConflicts = true) {\n      if (!jsonData || !jsonData.avatars) {\n        throw new Error('');\n      }\n\n      const current = this.load();\n      const stats = { added: 0, updated: 0, skipped: 0 };\n\n      for (const name in jsonData.avatars) {\n        const imported = jsonData.avatars[name];\n        if (!imported.url) continue;\n\n        if (current[name]) {\n          // \n          if (overwriteConflicts) {\n            current[name] = {\n              url: imported.url,\n              offsetX: imported.offsetX ?? 50,\n              offsetY: imported.offsetY ?? 50,\n              scale: imported.scale ?? 150,\n              aliases: imported.aliases || [],\n            };\n            stats.updated++;\n          } else {\n            stats.skipped++;\n          }\n        } else {\n          // \n          current[name] = {\n            url: imported.url,\n            offsetX: imported.offsetX ?? 50,\n            offsetY: imported.offsetY ?? 50,\n            scale: imported.scale ?? 150,\n            aliases: imported.aliases || [],\n          };\n          stats.added++;\n        }\n      }\n\n      this.save();\n      return stats;\n    },\n\n    // \n    analyzeImport(jsonData) {\n      if (!jsonData || !jsonData.avatars) {\n        return { valid: false, error: '' };\n      }\n\n      const current = this.load();\n      const result = { valid: true, total: 0, newItems: [], conflicts: [] };\n\n      for (const name in jsonData.avatars) {\n        if (!jsonData.avatars[name].url) continue;\n        result.total++;\n        if (current[name]) {\n          result.conflicts.push(name);\n        } else {\n          result.newItems.push(name);\n        }\n      }\n\n      return result;\n    },\n  };\n\n  const getLocationEmoji = name => {\n    if (!name) return null;\n    for (const [pattern, emoji] of LOCATION_EMOJI_MAP) {\n      if (pattern.test(name)) return emoji;\n    }\n    return null;\n  };\n\n  // emoji\n  const getEmojiCandidates = (name: string): string[] => {\n    if (!name) return [];\n    const candidates: string[] = [];\n    for (const [pattern, emoji] of LOCATION_EMOJI_MAP) {\n      if (pattern.test(name)) {\n        candidates.push(emoji);\n      }\n    }\n    return candidates;\n  };\n\n  // emoji\n  const resolveBatchLocationEmojis = (names: string[]): Map<string, string | null> => {\n    // 1. \n    const candidatesMap = new Map<string, string[]>();\n    for (const name of names) {\n      candidatesMap.set(name, getEmojiCandidates(name));\n    }\n\n    // 2. \n    const sortedNames = [...names].sort((a, b) => {\n      if (a.length !== b.length) return a.length - b.length;\n      return a.localeCompare(b);\n    });\n\n    // 3. \n    const usedEmojis = new Set<string>();\n    const result = new Map<string, string | null>();\n\n    for (const name of sortedNames) {\n      const candidates = candidatesMap.get(name) || [];\n      const available = candidates.find(e => !usedEmojis.has(e));\n      if (available) {\n        result.set(name, available);\n        usedEmojis.add(available);\n      } else {\n        // \n        result.set(name, candidates.length > 0 ? candidates[0] : null);\n      }\n    }\n\n    return result;\n  };\n\n  const getElementEmoji = (name, type) => {\n    if (!name && !type) return null;\n    for (const [pattern, emoji] of ELEMENT_EMOJI_MAP) {\n      if (name && pattern.test(name)) return emoji;\n    }\n    for (const [pattern, emoji] of ELEMENT_EMOJI_MAP) {\n      if (type && pattern.test(type)) return emoji;\n    }\n    return null;\n  };\n\n  // ========================================\n  // MVU  v2.0\n  //  -  UI\n  // ========================================\n  const MvuModule = (function () {\n    'use strict';\n\n    // [] MVU  - \n    function parseMvuPathForDice(path, value) {\n      try {\n        if (!path || typeof path !== 'string') {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        //  . \n        const parts = path.split('.').filter(p => p && p.trim());\n\n        if (parts.length === 0) {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        // \n        const blacklist = [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          'stat_data',\n          'delta_data',\n        ];\n\n        // \n        const filteredParts = parts.filter(p => !blacklist.includes(p));\n\n        // \n        let initiator = null;\n        if (filteredParts.length >= 2) {\n          // \n          initiator = filteredParts[filteredParts.length - 2];\n        } else if (filteredParts.length === 1) {\n          // \n          initiator = filteredParts[0];\n        }\n\n        // \n        let attrName = null;\n        if (filteredParts.length > 0) {\n          attrName = filteredParts[filteredParts.length - 1];\n        } else if (parts.length > 0) {\n          // \n          attrName = parts[parts.length - 1];\n        }\n\n        // \n        const candidates = filteredParts.length > 0 ? filteredParts : parts.slice(-1);\n\n        return {\n          initiator: initiator || null,\n          attrName: attrName || null,\n          candidates: candidates,\n        };\n      } catch (e) {\n        console.warn('[DICE]parseMvuPathForDice ', e);\n        return { initiator: null, attrName: null, candidates: [] };\n      }\n    }\n\n    // =====  =====\n    const MODULE_ID = '__mvu__';\n    let cachedEraData = null; //  ERA \n\n    // =====  =====\n    function detectMode() {\n      // \n      if (cachedEraData && cachedEraData._source) {\n        return cachedEraData._source;\n      }\n\n      //  ERA ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n\n      if (typeof eventEmit === 'function' && typeof eventOn === 'function') {\n        console.log('[DICE]MvuModule  ERA ');\n        return 'era';\n      }\n\n      //  MVU\n      if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n        console.log('[DICE]MvuModule  MVU ');\n        return 'mvu';\n      }\n\n      //  MVU\n      console.log('[DICE]MvuModule  MVU ');\n      return 'mvu';\n    }\n\n    // ===== =====\n    async function detectModeWithData() {\n      // 1.  ERA ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n\n      if (typeof eventEmit === 'function' && typeof eventOn === 'function') {\n        try {\n          //  ERA \n          const eraData = await Promise.race([\n            getEraData(),\n            new Promise((_, reject) => setTimeout(() => reject(new Error('ERA timeout')), 2000)),\n          ]);\n\n          if (eraData && eraData.stat_data) {\n            console.log('[DICE] ERA ');\n            return { mode: 'era', data: eraData };\n          }\n        } catch (e) {\n          console.warn('[DICE]ERA :', e.message);\n        }\n      }\n\n      // 2.  MVU\n      try {\n        await waitGlobalInitialized('Mvu');\n\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (mvuData && mvuData.stat_data) {\n            console.log('[DICE] MVU ');\n            return {\n              mode: 'mvu',\n              data: {\n                stat_data: mvuData.stat_data || null,\n                display_data: mvuData.display_data || {},\n                delta_data: mvuData.delta_data || {},\n                schema: mvuData.schema || null,\n                _source: 'mvu', // \n              },\n            };\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MVU :', e);\n      }\n\n      // 3.  MVU \n      console.warn('[DICE] MVU ');\n      return { mode: 'mvu', data: null };\n    }\n\n    // ===== ERA  =====\n    // ERA\n    async function getEraData() {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(null);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onResult = detail => {\n          clearTimeout(timeoutId);\n          //  eventOff \n          if (typeof eventOff === 'function') {\n            try {\n              eventOff('era:queryResult', onResult);\n            } catch (e) {\n              console.warn('[DICE]MvuModule :', e);\n            }\n          }\n\n          console.log('[DICE]MvuModule ERA:', JSON.stringify(detail, null, 2));\n          console.log('[DICE]MvuModule detail.result:', JSON.stringify(detail.result, null, 2));\n\n          if (detail.result && detail.result.error) {\n            console.error('[DICE]MvuModule ERA:', detail.result.error);\n            resolve(null);\n            return;\n          }\n\n          const statData = detail.result?.statWithoutMeta || null;\n          console.log('[DICE]MvuModule  stat_data:', JSON.stringify(statData, null, 2));\n\n          const result = {\n            stat_data: statData,\n            delta_data: {},\n            schema: null,\n            _source: 'era', // \n          };\n\n          // \n          cachedEraData = result;\n\n          resolve(result);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA...');\n          console.log('[DICE]MvuModule ERA API :', {\n            eventEmit: typeof eventEmit === 'function',\n            eventOn: typeof eventOn === 'function',\n            eventOff: typeof eventOff === 'function',\n          });\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n\n          eventOn('era:queryResult', onResult);\n          eventEmit('era:getCurrentVars');\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(null);\n        }\n      });\n    }\n\n    // ERA \n    async function setEraValue(path, newValue) {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(false);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onWriteDone = detail => {\n          clearTimeout(timeoutId);\n          if (typeof eventOff === 'function') {\n            eventOff('era:writeDone', onWriteDone);\n          }\n          console.log('[DICE]MvuModule ERA');\n          resolve(true);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA:', path, newValue);\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n\n          eventOn('era:writeDone', onWriteDone);\n          eventEmit('era:updateByPath', {\n            path: path,\n            value: newValue,\n          });\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(false);\n        }\n      });\n    }\n\n    // =====  =====\n    const STYLES = `\n            /* MVU  */\n            .acu-mvu-panel {\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n                min-height: 300px; /*  */\n                overflow: hidden; /*  */\n            }\n            .acu-mvu-panel .acu-panel-header {\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                padding: 10px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                flex-shrink: 0;\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title i {\n                color: var(--acu-accent);\n            }\n            .acu-mvu-panel .acu-header-actions {\n                display: flex;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                padding: 5px 10px;\n                font-size: 13px;\n                border-radius: 4px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn:hover {\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent);\n            }\n            .acu-mvu-panel .mvu-header-btn.active {\n                background: var(--acu-accent);\n                color: #fff;\n                border-color: var(--acu-accent);\n            }\n            /* []  */\n            .mvu-numeric-mode {\n                padding: 0;\n            }\n            .mvu-numeric-level-controls {\n                position: sticky;\n                top: 0;\n                z-index: 10;\n            }\n            /* []  */\n            .mvu-level-controls-collapsible {\n                margin-bottom: 8px;\n            }\n            .mvu-level-controls-header {\n                transition: background 0.2s;\n            }\n            .mvu-level-controls-header:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-level-controls-body {\n                overflow-y: auto;\n                overflow-x: hidden;\n                transition: max-height 0.3s ease-out, padding-top 0.3s ease-out, padding-bottom 0.3s ease-out, border-bottom 0.3s ease-out;\n                max-height: 300px; /*  */\n                scrollbar-width: thin;\n            }\n            /*  */\n            @media (max-width: 768px) {\n                .mvu-level-controls-body {\n                    max-height: 200px;\n                }\n            }\n            .mvu-level-controls-body::-webkit-scrollbar {\n                width: 6px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-track {\n                background: transparent;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb {\n                background: var(--acu-border);\n                border-radius: 3px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb:hover {\n                background: var(--acu-text-sub);\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-body {\n                max-height: 0 !important;\n                padding-top: 0 !important;\n                padding-bottom: 0 !important;\n                border-bottom: none !important;\n                margin: 0 !important;\n            }\n            .mvu-level-controls-toggle-icon {\n                transition: transform 0.3s ease-out;\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-toggle-icon {\n                transform: rotate(-90deg);\n            }\n            .mvu-numeric-items {\n                max-height: calc(100vh - 200px);\n                overflow-y: auto;\n            }\n            .mvu-numeric-item {\n                transition: background 0.2s;\n            }\n            .mvu-numeric-item:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-dice-icon {\n                transition: opacity 0.2s, transform 0.2s;\n            }\n            .mvu-dice-icon:hover {\n                opacity: 1 !important;\n                transform: scale(1.1);\n            }\n            .mvu-level-toggle:hover {\n                opacity: 1 !important;\n            }\n            .mvu-level-toggle[data-visible=\"true\"]:hover {\n                background: var(--acu-accent) !important;\n                color: #fff !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .mvu-level-toggle[data-visible=\"false\"]:hover,\n            .mvu-level-toggle[data-visible=\"\"]:hover {\n                background: var(--acu-table-hover) !important;\n                color: var(--acu-text-sub) !important;\n                border-color: var(--acu-border) !important;\n            }\n\n            /* MVU  -  */\n            .mvu-content {\n                display: flex;\n                flex-direction: column;\n                overflow-x: hidden;\n                overflow-y: auto; /*  */\n                flex: 1 1 auto;\n                min-height: 0; /*  flex  */\n                max-height: 100%; /*  */\n                padding: 12px;\n                scrollbar-width: thin;\n            }\n            .mvu-content::-webkit-scrollbar {\n                display: none;\n            }\n            .mvu-content .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 100%;\n                max-width: 100%;\n                width: 100%;\n            }\n            /* MVU */\n            .acu-mvu-panel {\n                overflow-y: auto !important;\n                overflow-x: hidden !important;\n                flex: 1 1 0; /*  flex-basis: 0  */\n                min-height: 300px; /*  */\n            }\n\n            /* MVU  */\n            .mvu-card {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 10px;\n                overflow: hidden;\n            }\n            .mvu-card:last-child {\n                margin-bottom: 0;\n            }\n            .mvu-card-header {\n                background: var(--acu-table-head);\n                padding: 8px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                cursor: pointer;\n                user-select: none;\n                transition: background 0.2s;\n            }\n            .mvu-card-header:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-card-title {\n                font-weight: 600;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            .mvu-card-count {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                font-weight: normal;\n            }\n            .mvu-card-toggle {\n                color: var(--acu-text-sub);\n                font-size: 10px;\n                transition: transform 0.2s;\n            }\n            .mvu-card.collapsed .mvu-card-toggle {\n                transform: rotate(-90deg);\n            }\n            .mvu-card-body {\n                padding: 8px 12px;\n                display: block;\n                overflow: hidden; /*  slideUp/slideDown  */\n            }\n            .mvu-card.collapsed .mvu-card-body {\n                display: none;\n            }\n\n            /*  */\n            .mvu-card .mvu-card {\n                background: var(--acu-table-head);\n                margin: 6px 0;\n            }\n            .mvu-card .mvu-card .mvu-card-header {\n                background: rgba(128,128,128,0.1);\n                padding: 6px 10px;\n            }\n            .mvu-card .mvu-card .mvu-card-body {\n                padding: 6px 10px;\n            }\n\n            /*  -  */\n            .mvu-card-body.horizontal-nested {\n                display: flex;\n                flex-direction: row;\n                flex-wrap: nowrap;\n                gap: 12px;\n                overflow-x: auto;\n                overflow-y: visible;\n                -webkit-overflow-scrolling: touch;\n                padding-bottom: 8px;\n                align-items: flex-start;\n            }\n            /*  has-nested-cards  wrap  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested {\n                flex-wrap: wrap;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-row {\n                display: flex;\n                flex: 0 0 100%;\n                width: 100%;\n                max-width: 100%; /*  */\n                box-sizing: border-box;\n            }\n            /*  has-nested-cards  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                flex: 0 0 auto; /*  */\n                min-width: 100%; /*  */\n                width: auto; /*  */\n                max-width: 450px; /*  */\n                box-sizing: border-box;\n            }\n            @media (min-width: 769px) {\n                .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                    max-width: 550px; /*  */\n                }\n            }\n            /*  -  */\n            .mvu-card-body.horizontal-nested > .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 200px;\n                max-width: 350px;\n                width: auto;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                min-width: 400px; /*  */\n                max-width: none; /*  */\n            }\n            @media (min-width: 769px) {\n                .mvu-card-body.horizontal-nested > .mvu-card {\n                    min-width: 240px;\n                    max-width: 400px;\n                }\n                .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                    min-width: 500px; /*  */\n                    max-width: none; /*  */\n                }\n            }\n\n            /*  */\n            .mvu-row {\n                display: flex;\n                align-items: flex-start;\n                padding: 5px 0;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n            .mvu-row:last-child {\n                border-bottom: none;\n            }\n            .mvu-key {\n                color: var(--acu-text-sub);\n                min-width: 80px;\n                max-width: 120px;\n                flex-shrink: 0;\n                font-size: 12px;\n                padding-right: 8px;\n                word-break: break-all;\n            }\n            .mvu-value-wrap {\n                flex: 1;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                min-width: 0;\n            }\n            .mvu-value {\n                color: var(--acu-text-main);\n                font-size: var(--acu-font-size, 13px);\n                cursor: pointer;\n                padding: 1px 6px;\n                border-radius: 4px;\n                transition: background 0.2s;\n                word-break: break-word;\n                flex: 0 1 auto;\n            }\n            .mvu-value:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-value.mvu-array-value {\n                font-size: calc(var(--acu-font-size, 13px) * 0.92);\n                color: var(--acu-text-sub);\n            }\n            .mvu-change-indicator {\n                color: var(--acu-success-text);\n                font-weight: bold;\n                font-size: 12px;\n                flex-shrink: 0;\n            }\n            .mvu-row.mvu-changed {\n                background: var(--acu-success-bg);\n                margin: 0 -12px;\n                padding: 5px 12px;\n                border-radius: 4px;\n            }\n            .mvu-card .mvu-card .mvu-row.mvu-changed {\n                margin: 0 -10px;\n                padding: 5px 10px;\n            }\n\n            /*  */\n            .mvu-empty {\n                text-align: center;\n                padding: 40px 20px;\n                color: var(--acu-text-sub);\n                flex: 1;\n                min-width: 100%;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n            }\n            .mvu-empty i {\n                font-size: 32px;\n                margin-bottom: 12px;\n                display: block;\n                opacity: 0.5;\n            }\n            .mvu-empty p {\n                margin: 0 0 6px 0;\n            }\n            .mvu-empty .mvu-empty-hint {\n                font-size: 12px;\n                opacity: 0.7;\n            }\n\n            /*  */\n            .mvu-edit-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0,0,0,0.6);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 99999;\n                animation: mvuFadeIn 0.15s ease-out;\n            }\n            .mvu-edit-dialog {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                padding: 16px;\n                width: 90%;\n                max-width: 400px;\n                animation: mvuSlideIn 0.2s ease-out;\n            }\n            .mvu-edit-title {\n                font-weight: 600;\n                color: var(--acu-text-main);\n                margin-bottom: 12px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .mvu-edit-path {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                background: var(--acu-table-head);\n                padding: 6px 10px;\n                border-radius: 4px;\n                margin-bottom: 12px;\n                word-break: break-all;\n                font-family: monospace;\n            }\n            .mvu-edit-textarea {\n                width: 100%;\n                min-height: 80px;\n                padding: 10px;\n                border: 1px solid var(--acu-border);\n                border-radius: 4px;\n                background: var(--acu-input-bg, var(--acu-bg-panel));\n                color: var(--acu-text-main);\n                font-size: 13px;\n                resize: vertical;\n                box-sizing: border-box;\n            }\n            .mvu-edit-textarea:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n            }\n            .mvu-edit-hint {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                margin-top: 8px;\n                opacity: 0.7;\n            }\n            .mvu-edit-btns {\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n                margin-top: 16px;\n            }\n            .mvu-edit-btn {\n                padding: 8px 16px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 13px;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                transition: all 0.2s;\n            }\n            .mvu-edit-btn.mvu-btn-cancel {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n            }\n            .mvu-edit-btn.mvu-btn-cancel:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-edit-btn.mvu-btn-save {\n                background: var(--acu-accent);\n                border: 1px solid var(--acu-accent);\n                color: #fff;\n            }\n            .mvu-edit-btn.mvu-btn-save:hover {\n                opacity: 0.9;\n            }\n\n            @keyframes mvuFadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes mvuSlideIn {\n                from { transform: translateY(-20px); opacity: 0; }\n                to { transform: translateY(0); opacity: 1; }\n            }\n\n            /*  */\n            .acu-nav-btn.acu-mvu-btn.active {\n                background: var(--acu-btn-active-bg);\n                color: var(--acu-btn-active-text);\n            }\n        `;\n\n    // =====  =====\n    function escapeHtml(s) {\n      return String(s ?? '')\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#039;');\n    }\n\n    function isAvailable() {\n      const mode = detectMode();\n\n      if (mode === 'era') {\n        // ERA  eventEmit  eventOn  iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const emitAvailable = typeof eventEmit === 'function';\n        const onAvailable = typeof eventOn === 'function';\n        return emitAvailable && onAvailable;\n      } else {\n        // MVU  MVU \n        const mvuAvailable = typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function';\n        return mvuAvailable;\n      }\n    }\n\n    function getData() {\n      console.warn('[DICE]: getData()  MVU  getDataWithRetry()');\n\n      //  ERA  MVU\n      if (cachedEraData) {\n        return cachedEraData;\n      }\n\n      //  MVU\n      try {\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (allVars && allVars.stat_data) {\n            const data = {\n              stat_data: allVars.stat_data || null,\n              display_data: allVars.display_data || {},\n              delta_data: allVars.delta_data || {},\n              schema: allVars.schema || null,\n              _source: 'mvu', // \n            };\n\n            cachedEraData = data; // \n            return data;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE] MVU :', e);\n      }\n\n      return null;\n    }\n\n    // ===== MVU  =====\n    async function getMvuDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // []  MVU API \n        if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n          //  MVU \n          try {\n            await Promise.race([\n              waitGlobalInitialized('Mvu'),\n              new Promise((_, reject) => setTimeout(() => reject(new Error(' MVU ')), 3000)),\n            ]);\n          } catch (e) {\n            console.warn('[DICE] MVU :', e.message);\n            //  MVU \n          }\n        }\n\n        for (let attempt = 1; attempt <= maxRetries; attempt++) {\n          try {\n            if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n              throw new Error('MVU API ');\n            }\n\n            const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n            if (allVars && allVars.stat_data) {\n              const data = {\n                stat_data: allVars.stat_data || null,\n                display_data: allVars.display_data || {},\n                delta_data: allVars.delta_data || {},\n                schema: allVars.schema || null,\n                _source: 'mvu', // \n              };\n\n              //  MVU \n              cachedEraData = data;\n              console.log('[DICE]MVU ');\n              return data;\n            }\n          } catch (e) {\n            console.warn(`[DICE]MVU  ( ${attempt}/${maxRetries}):`, e);\n          }\n\n          if (attempt < maxRetries) {\n            await new Promise(resolve => setTimeout(resolve, retryDelay));\n          }\n        }\n\n        return null;\n      } catch (e) {\n        console.error('[DICE]MVU :', e);\n        return null;\n      }\n    }\n\n    // \n    async function getDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // \n        const detection = await detectModeWithData();\n\n        // \n        if (detection.data) {\n          cachedEraData = detection.data; // \n          return detection.data;\n        }\n\n        // \n        const mode = detection.mode;\n\n        if (mode === 'era') {\n          // ERA \n          for (let attempt = 1; attempt <= maxRetries; attempt++) {\n            try {\n              const data = await getEraData();\n              if (data && data.stat_data) {\n                cachedEraData = data;\n                return data;\n              }\n            } catch (e) {\n              console.warn(`[DICE]ERA  ( ${attempt}/${maxRetries}):`, e);\n            }\n\n            if (attempt < maxRetries) {\n              await new Promise(resolve => setTimeout(resolve, retryDelay));\n            }\n          }\n\n          // ERA  MVU\n          console.warn('[DICE]ERA  MVU');\n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        } else {\n          // MVU \n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        }\n      } catch (e) {\n        console.error('[DICE]:', e);\n        return null;\n      }\n    }\n\n    //  ValueWithDescription  [, \"\"]\n    function isVWD(value) {\n      return (\n        Array.isArray(value) &&\n        value.length === 2 &&\n        typeof value[1] === 'string' &&\n        (typeof value[0] === 'number' || typeof value[0] === 'string' || typeof value[0] === 'boolean')\n      );\n    }\n\n    // \n    function isSimpleArray(value) {\n      if (!Array.isArray(value)) return false;\n      return value.every(\n        item => typeof item === 'string' || typeof item === 'number' || typeof item === 'boolean' || item === null,\n      );\n    }\n\n    // \n    function getChangeIndicator(path, deltaData) {\n      if (!deltaData || !path) return '';\n\n      const parts = path.split('.');\n      let current = deltaData;\n      for (const part of parts) {\n        if (current === null || current === undefined) return '';\n        current = current[part];\n      }\n\n      if (!current) return '';\n\n      if (typeof current === 'string' && current.includes('->')) {\n        const match = current.match(/^(-?[\\d.]+)->(-?[\\d.]+)/);\n        if (match) {\n          const oldVal = parseFloat(match[1]);\n          const newVal = parseFloat(match[2]);\n          if (!isNaN(oldVal) && !isNaN(newVal)) {\n            return newVal > oldVal ? '' : newVal < oldVal ? '' : '';\n          }\n        }\n        return '';\n      }\n      return '';\n    }\n\n    // /\n    function countChildren(value) {\n      if (Array.isArray(value)) {\n        if (isVWD(value)) return 0;\n        return value.length;\n      }\n      if (value && typeof value === 'object') {\n        return Object.keys(value).filter(k => !k.startsWith('$')).length;\n      }\n      return 0;\n    }\n\n    // =====  =====\n\n    // \n    // +++\n    function extractNumericDisplayValue(value, isArray = false) {\n      //  null/undefined\n      if (value === null || value === undefined) {\n        return '';\n      }\n\n      // \n      if (isArray || Array.isArray(value)) {\n        if (isVWD(value)) {\n          return String(value[0]);\n        } else if (isSimpleArray(value)) {\n          return value.map(v => String(v ?? '')).join(', ');\n        } else {\n          // \n          return String(value);\n        }\n      }\n\n      // \n      const str = String(value).trim();\n\n      // 1.  \"85\", \"-20\", \"100%\"\n      if (/^-?\\d+(\\.\\d+)?%?$/.test(str)) {\n        return str;\n      }\n\n      // 2. ++ \",[] \" \n      // \"0,[-20, 120] User...\"\n      const rangeMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)(,\\s*\\[[^\\]]+\\])?\\s+/);\n      if (rangeMatch) {\n        // \n        if (rangeMatch[2]) {\n          return rangeMatch[1] + rangeMatch[2].trim();\n        }\n        // \n        return rangeMatch[1];\n      }\n\n      // 2.5. /, \"/,\" \n      // \"100/100,/'/'\"\n      const slashNumericMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?\\/-?\\d+(?:\\.\\d+)?%?),/);\n      if (slashNumericMatch) {\n        return slashNumericMatch[1];\n      }\n\n      // 3. , \",\" \n      // \"150000,...\"\n      const commaDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?),/);\n      if (commaDescMatch) {\n        return commaDescMatch[1];\n      }\n\n      // 4. + \" \" \n      // \"85 \"\n      const numericDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)\\s+[^\\d]/);\n      if (numericDescMatch) {\n        return numericDescMatch[1];\n      }\n\n      // 5. \n      return str;\n    }\n\n    // \n    // \"85\" -> 85, \"85,[0,100]\" -> 85, \"0,[-20, 120]\" -> 0\n    function extractFirstNumericValue(displayValue) {\n      if (!displayValue) return 0;\n      const str = String(displayValue).trim();\n\n      // \n      const match = str.match(/^(-?\\d+(?:\\.\\d+)?)/);\n      if (match) {\n        const num = parseFloat(match[1]);\n        return isNaN(num) ? 0 : num;\n      }\n\n      return 0;\n    }\n\n    // \n    function renderRow(key, value, path, deltaData) {\n      const changeIndicator = getChangeIndicator(path, deltaData);\n      const changedClass = changeIndicator ? 'mvu-changed' : '';\n\n      let displayValue;\n      let valueClass = 'mvu-value';\n\n      if (isVWD(value)) {\n        displayValue = String(value[0]);\n      } else if (isSimpleArray(value)) {\n        displayValue = value.map(v => String(v ?? '')).join(', ');\n        valueClass += ' mvu-array-value';\n      } else {\n        // \n        displayValue = extractNumericDisplayValue(value ?? '', false);\n      }\n\n      // [] \n      let diceIconHtml = '';\n      try {\n        //  extractNumericDisplayValue \n        //  \"85,[0,100]\"  85  100\n        if (typeof isNumericCell === 'function' && isNumericCell(displayValue)) {\n          // \n          const numericValue = extractFirstNumericValue(displayValue);\n          if (numericValue > 0) {\n            //  key key \n            let attrName = key;\n            if (key.includes('.')) {\n              const parts = key.split('.');\n              attrName = parts[parts.length - 1];\n            }\n            // \n            if (path && path.includes('.')) {\n              const pathParts = path.split('.');\n              const lastPart = pathParts[pathParts.length - 1];\n              // \n              if (lastPart && !/^\\d+$/.test(lastPart) && lastPart !== key) {\n                attrName = lastPart;\n              }\n            }\n            diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon\" data-path=\"${escapeHtml(path)}\" data-attr-name=\"${escapeHtml(attrName)}\" data-attr-value=\"${numericValue}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.6;font-size:calc(var(--acu-font-size, 13px) * 0.85);flex-shrink:0;\" title=\"\"></i>`;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule renderRow: ', e);\n      }\n\n      return `\n                <div class=\"mvu-row ${changedClass}\">\n                    <div class=\"mvu-key\">${escapeHtml(key)}</div>\n                    <div class=\"mvu-value-wrap\">\n                        <span class=\"${valueClass}\" data-path=\"${escapeHtml(path)}\">${escapeHtml(displayValue)}</span>\n                        ${diceIconHtml}\n                        ${changeIndicator ? `<span class=\"mvu-change-indicator\">${changeIndicator}</span>` : ''}\n                    </div>\n                </div>\n            `;\n    }\n\n    // \n    function renderCard(key, value, path, deltaData, depth, defaultExpanded, isHorizontal) {\n      const childCount = countChildren(value);\n      const collapsedClass = defaultExpanded ? '' : 'collapsed';\n\n      let bodyHtml = '';\n      let hasNestedCards = false; // \n      let nestedCardCount = 0; // \n      let rowCount = 0; // \n\n      if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n        // \n        value.forEach((item, index) => {\n          const itemPath = `${path}[${index}]`;\n\n          if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(`[${index}]`, item, itemPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            rowCount++;\n            bodyHtml += renderRow(`[${index}]`, item, itemPath, deltaData);\n          }\n        });\n      } else if (value && typeof value === 'object' && !isVWD(value)) {\n        // \n        const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n\n        for (const [childKey, childValue] of entries) {\n          const childPath = path ? `${path}.${childKey}` : childKey;\n\n          if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n            // /  \n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(childKey, childValue, childPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            //   \n            rowCount++;\n            bodyHtml += renderRow(childKey, childValue, childPath, deltaData);\n          }\n        }\n      }\n\n      const countText = Array.isArray(value) ? `[${childCount}]` : `(${childCount})`;\n\n      //  card-body  horizontal-nested \n      const bodyClass = isHorizontal && hasNestedCards ? 'mvu-card-body horizontal-nested' : 'mvu-card-body';\n\n      // \n      let nestedCardsNeedWidth = false;\n      if (isHorizontal && hasNestedCards && depth === 0) {\n        // \n        if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n          // \n          value.forEach(item => {\n            if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n              const itemChildCount = countChildren(item);\n              if (itemChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          });\n        } else if (value && typeof value === 'object' && !isVWD(value)) {\n          // \n          const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n          for (const [childKey, childValue] of entries) {\n            if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n              const childChildCount = countChildren(childValue);\n              if (childChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          }\n        }\n      }\n\n      //  has-nested-cards \n      // \n      // depth === 0\n      //   -  >= 2  <= 1 has-nested-cards\n      //   -  has-nested-cards\n      // depth > 0rowCount === 0 >= 2  has-nested-cards\n      const shouldAddHasNestedClass =\n        isHorizontal &&\n        hasNestedCards &&\n        ((depth === 0 && ((nestedCardCount >= 2 && rowCount <= 1) || nestedCardsNeedWidth)) || //  >= 2  <= 1\n          (depth > 0 && rowCount === 0 && nestedCardCount >= 2)); //  >= 2\n      const hasNestedClass = shouldAddHasNestedClass ? ' has-nested-cards' : '';\n\n      return `\n                <div class=\"mvu-card${hasNestedClass} ${collapsedClass}\" data-path=\"${escapeHtml(path)}\" data-depth=\"${depth}\">\n                    <div class=\"mvu-card-header\">\n                        <div class=\"mvu-card-title\">\n                            <span>${escapeHtml(key)}</span>\n                            <span class=\"mvu-card-count\">${countText}</span>\n                        </div>\n                        <span class=\"mvu-card-toggle\"></span>\n                    </div>\n                    <div class=\"${bodyClass}\">\n                        ${bodyHtml}\n                    </div>\n                </div>\n            `;\n    }\n\n    // [] \n    function renderNumericMode(mvuData) {\n      if (!mvuData || !mvuData.stat_data) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-inbox\"></i><p></p></div>';\n      }\n\n      // [] \n      let visibleLevels = {};\n      try {\n        const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n        if (saved) {\n          visibleLevels = JSON.parse(saved);\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule ', e);\n      }\n\n      // \n      const numericItems = [];\n\n      // \n      function collectNumericItems(obj, path, levelNames) {\n        if (!obj || typeof obj !== 'object') return;\n\n        if (Array.isArray(obj)) {\n          if (isVWD(obj) || isSimpleArray(obj)) {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const itemValue = String(item ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: itemPath,\n                    key: `[${index}]`,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: [...levelNames],\n                  });\n                }\n              }\n            });\n          } else {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const newLevelNames = [...levelNames, `[${index}]`];\n              collectNumericItems(item, itemPath, newLevelNames);\n            });\n          }\n        } else {\n          // \n          const entries = Object.entries(obj).filter(([k]) => !k.startsWith('$'));\n          for (const [key, value] of entries) {\n            const childPath = path ? `${path}.${key}` : key;\n            const newLevelNames = [...levelNames, key];\n\n            if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n              // \n              collectNumericItems(value, childPath, newLevelNames);\n            } else {\n              // \n              const itemValue = String(value ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: childPath,\n                    key: key,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: newLevelNames,\n                  });\n                }\n              }\n            }\n          }\n        }\n      }\n\n      // \n      const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n      for (const key of topKeys) {\n        const value = mvuData.stat_data[key];\n        collectNumericItems(value, key, [key]);\n      }\n\n      // [] \n      const filteredNumericItems = numericItems.filter(item => {\n        // key\n        // levelNames\n        let lastLevelKey = item.key;\n        const nonArrayLevels = item.levelNames.filter(level => level && !level.startsWith('['));\n        if (nonArrayLevels.length > 0) {\n          lastLevelKey = nonArrayLevels[nonArrayLevels.length - 1];\n        } else if (item.path && item.path.includes('.')) {\n          // levelNamespath\n          const parts = item.path.split('.');\n          lastLevelKey = parts[parts.length - 1];\n        }\n        //  BlacklistManager \n        return !BlacklistManager.isBlacklisted(lastLevelKey);\n      });\n\n      if (filteredNumericItems.length === 0) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-filter\"></i><p></p></div>';\n      }\n\n      // \n      //  2\n      const allLevelNames = new Set();\n      filteredNumericItems.forEach(item => {\n        // \n        const hierarchyLevels =\n          item.levelNames.length > 1\n            ? item.levelNames.slice(0, -1) // \n            : [];\n\n        hierarchyLevels.forEach(level => {\n          if (level && !level.startsWith('[')) {\n            // \n            allLevelNames.add(level);\n          }\n        });\n      });\n\n      const levelNamesArray = Array.from(allLevelNames).sort();\n\n      //  toggle \n      let levelTogglesHtml = '';\n      if (levelNamesArray.length > 0) {\n        const theme = getThemeColors();\n        const buttonTextColor = theme.buttonTextOnAccent || theme.textMain || '#6B4A5A';\n\n        // \n        let levelButtonsHtml = '';\n        levelNamesArray.forEach(levelName => {\n          const isVisible = visibleLevels[levelName] !== false; // \n          const activeStyle = isVisible\n            ? `background:var(--acu-accent);color:${buttonTextColor};border-color:var(--acu-accent);opacity:1;`\n            : 'background:transparent;color:var(--acu-text-sub);border-color:var(--acu-border);opacity:0.5;';\n          levelButtonsHtml += `<button class=\"mvu-level-toggle\" data-level=\"${escapeHtml(levelName)}\" data-visible=\"${isVisible}\" style=\"display:flex;align-items:center;gap:4px;font-size:calc(var(--acu-font-size, 13px) * 0.85);cursor:pointer;padding:2px 6px;border-radius:4px;border:1px solid;${activeStyle}transition:all 0.2s;\" title=\"${isVisible ? '' : ''}: ${escapeHtml(levelName)}\"><span>${escapeHtml(levelName)}</span></button>`;\n        });\n\n        // \n        levelTogglesHtml = `\n          <div class=\"mvu-level-controls-collapsible collapsed\">\n            <div class=\"mvu-level-controls-header\" style=\"padding:6px 8px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);cursor:pointer;display:flex;align-items:center;justify-content:space-between;user-select:none;\">\n              <span style=\"font-size:calc(var(--acu-font-size, 13px) * 0.85);color:var(--acu-text-sub);\"></span>\n              <i class=\"fa-solid fa-chevron-down mvu-level-controls-toggle-icon\" style=\"font-size:10px;color:var(--acu-text-sub);transition:transform 0.2s;\"></i>\n            </div>\n            <div class=\"mvu-level-controls-body\" style=\"padding:8px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);display:flex;flex-wrap:wrap;gap:6px;align-items:center;\">\n              ${levelButtonsHtml}\n            </div>\n          </div>\n        `;\n      }\n\n      // \n      let itemsHtml = '';\n      filteredNumericItems.forEach(item => {\n        //  data-levels \n        const nonArrayLevels = item.levelNames.filter(level => !level.startsWith('['));\n\n        // \n        const visibleLevels = item.levelNames.filter(level => {\n          if (level.startsWith('[')) return false; // \n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        //  1\n        //  visibleLevels \n        const pathLevels = visibleLevels.length > 1 ? visibleLevels.slice(0, -1) : [];\n\n        // \n        //  nonArrayLevels  N-1 \n        const hierarchyLevels = nonArrayLevels.length > 1 ? nonArrayLevels.slice(0, -1) : [];\n\n        const allLevelsVisible = hierarchyLevels.every(level => {\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        // \n        const pathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n        const attrName = item.key;\n\n        // \n        let finalAttrName = attrName;\n        if (item.path && item.path.includes('.')) {\n          const parts = item.path.split('.');\n          finalAttrName = parts[parts.length - 1];\n        }\n\n        // \n        const diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon\" data-path=\"${escapeHtml(item.path)}\" data-attr-name=\"${escapeHtml(finalAttrName)}\" data-attr-value=\"${item.numericValue}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.6;font-size:calc(var(--acu-font-size, 13px) * 0.85);flex-shrink:0;\" title=\"\"></i>`;\n\n        // \n        let displayValue = extractNumericDisplayValue(item.value, false);\n        //  \",[0, 100]\"\n        displayValue = displayValue.replace(/,\\s*\\[[^\\]]+\\]/g, '');\n\n        //  data-levels \n        // data-levels \n        const displayStyle = allLevelsVisible ? '' : 'display:none;';\n        const levelsJson = JSON.stringify(hierarchyLevels);\n\n        itemsHtml += `\n          <div class=\"mvu-numeric-item\" data-levels='${escapeHtml(levelsJson)}' style=\"${displayStyle}display:flex;align-items:center;padding:6px 8px;margin-bottom:4px;background:var(--acu-table-hover);border-radius:4px;border-left:3px solid var(--acu-accent);\">\n            <div style=\"flex:1;min-width:0;\">\n              <div class=\"mvu-path-display\" style=\"font-size:calc(var(--acu-font-size, 13px) * 0.77);color:var(--acu-text-sub);margin-bottom:2px;\">${escapeHtml(pathDisplay)}</div>\n              <div style=\"display:flex;align-items:center;gap:6px;\">\n                <span style=\"font-size:calc(var(--acu-font-size, 13px) * 0.92);color:var(--acu-text-main);font-weight:bold;\">${escapeHtml(finalAttrName)}</span>\n                <span class=\"mvu-value\" data-path=\"${escapeHtml(item.path)}\" style=\"font-size:var(--acu-font-size, 13px);color:var(--acu-accent);font-weight:bold;cursor:pointer;\" title=\"\">${escapeHtml(displayValue)}</span>\n                ${diceIconHtml}\n              </div>\n            </div>\n          </div>\n        `;\n      });\n\n      return levelTogglesHtml + '<div class=\"mvu-numeric-items\" style=\"padding:0 8px;\">' + itemsHtml + '</div>';\n    }\n\n    // =====  API =====\n    return {\n      MODULE_ID: MODULE_ID,\n\n      isAvailable: isAvailable,\n      getData: getData,\n      getDataWithRetry: getDataWithRetry,\n\n      // \n      diagnoseVariableFramework: async function () {\n        const result = {\n          timestamp: new Date().toISOString(),\n          era: {\n            available: false,\n            eventEmit: typeof (window.eventEmit || window.parent?.eventEmit) === 'function',\n            eventOn: typeof (window.eventOn || window.parent?.eventOn) === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          mvu: {\n            available: false,\n            apiExists: typeof window.Mvu !== 'undefined',\n            getDataExists: typeof window.Mvu?.getMvuData === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          cache: {\n            hasCache: !!cachedEraData,\n            cacheKeys: cachedEraData ? Object.keys(cachedEraData) : [],\n          },\n          recommendation: '',\n        };\n\n        //  ERA\n        if (result.era.eventEmit && result.era.eventOn) {\n          try {\n            const eraData = await Promise.race([\n              getEraData(),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 2000)),\n            ]);\n            result.era.available = true;\n            result.era.dataAvailable = !!(eraData && eraData.stat_data);\n          } catch (e) {\n            result.era.error = e.message;\n          }\n        }\n\n        //  MVU\n        if (result.mvu.apiExists && result.mvu.getDataExists) {\n          try {\n            // [] \n            await Promise.race([\n              waitGlobalInitialized('Mvu'),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('')), 2000)),\n            ]);\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            result.mvu.available = true;\n            result.mvu.dataAvailable = !!(mvuData && mvuData.stat_data);\n          } catch (e) {\n            result.mvu.error = e.message;\n          }\n        }\n\n        // \n        if (result.era.dataAvailable) {\n          result.recommendation = 'ERA ';\n        } else if (result.mvu.dataAvailable) {\n          result.recommendation = 'MVU ';\n        } else if (result.era.available || result.mvu.available) {\n          result.recommendation = '';\n        } else {\n          result.recommendation = ' MVU  ERA ';\n        }\n\n        return result;\n      },\n\n      injectStyles: function () {\n        //  document iframe \n        const targetDoc = window.parent?.document || document;\n        if (targetDoc.getElementById('mvu-module-styles')) return;\n        const styleEl = targetDoc.createElement('style');\n        styleEl.id = 'mvu-module-styles';\n        styleEl.textContent = STYLES;\n        targetDoc.head.appendChild(styleEl);\n      },\n\n      renderNavButton: function (isActive) {\n        //  isAvailable()\n        const activeClass = isActive ? 'active' : '';\n        return `<button class=\"acu-nav-btn acu-mvu-btn $${activeClass}\" id=\"acu-btn-mvu\" data-table=\"$${MODULE_ID}\" style=\"order:-1;\">\n                    <i class=\"fa-solid fa-code-branch\"></i><span></span>\n                </button>`;\n      },\n\n      renderPanel: function () {\n        // \n        // \n\n        const mvuData = getData();\n\n        // MVU  ERA\n        const varMode = detectMode();\n        const isEraMode = varMode === 'era';\n\n        // [] \n        let isNumericMode = false;\n        try {\n          const saved = localStorage.getItem('acu_mvu_numeric_mode');\n          isNumericMode = saved === 'true';\n        } catch (e) {\n          console.warn('[DICE]MvuModule ', e);\n        }\n\n        // MVU\n        const layoutMode = 'vertical-layout';\n\n        // \n        const panelTitle = isEraMode ? 'ERA ' : 'MVU ';\n\n        // MVU  null\n        if (!mvuData) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-exclamation-circle\"></i>\n                                <p> ${isEraMode ? 'ERA' : 'MVU'} </p>\n                                <p class=\"mvu-empty-hint\"> ${isEraMode ? 'ERA ' : 'MVU '}</p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        //  stat_data  null\n        if (\n          !mvuData.stat_data ||\n          (typeof mvuData.stat_data === 'object' && Object.keys(mvuData.stat_data).length === 0)\n        ) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-inbox\"></i>\n                                <p></p>\n                                <p class=\"mvu-empty-hint\"> AI </p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        // [] \n        if (isNumericMode) {\n          const numericHtml = renderNumericMode(mvuData);\n          return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span> <span style=\"font-size:calc(var(--acu-font-size,13px) * 0.85);color:var(--acu-text-sub);margin-left:6px;\">()</span></div>\n                            <div class=\"acu-title-sub\">()</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode active\" title=\"\">\n                                <i class=\"fa-solid fa-list\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode} mvu-numeric-mode\">\n                        ${numericHtml}\n                    </div>\n                `;\n        }\n\n        // \n        const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n\n        let cardsHtml = '';\n        for (const key of topKeys) {\n          const value = mvuData.stat_data[key];\n          const childCount = countChildren(value);\n\n          if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n            // /  \n            // MVU isHorizontal  false\n            cardsHtml += renderCard(key, value, key, mvuData.delta_data, 0, true, false);\n          } else {\n            //   \n            cardsHtml += `\n                            <div class=\"mvu-card\" data-path=\"${escapeHtml(key)}\" data-depth=\"0\">\n                                <div class=\"mvu-card-body\">\n                                    ${renderRow(key, value, key, mvuData.delta_data)}\n                                </div>\n                            </div>\n                        `;\n          }\n        }\n\n        return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                            <div class=\"acu-title-sub\">(${topKeys.length})</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode\" title=\"\">\n                                <i class=\"fa-solid fa-filter\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode}\">\n                        ${cardsHtml}\n                    </div>\n                `;\n      },\n\n      bindEvents: function ($container) {\n        //  jQuery\n        const $ = window.parent?.jQuery || window.jQuery;\n        if (!$ || !$container || !$container.length) {\n          console.warn('[DICE]MvuModule bindEvents: jQuery or container not available');\n          return;\n        }\n\n        //  jQuery \n        const $panel = $('#acu-data-area');\n        if (!$panel.length) {\n          console.warn('[DICE]MvuModule bindEvents: #acu-data-area not found');\n          return;\n        }\n\n        // \n        $panel.off('.mvu');\n\n        // /\n        $panel.on('click.mvu', '.mvu-card-header', function (e) {\n          e.stopPropagation();\n          const $card = $(this).closest('.mvu-card');\n          const $body = $card.find('> .mvu-card-body').first();\n\n          // \n          if ($body.is(':animated') || $body.hasClass('animating')) return;\n\n          if ($card.hasClass('collapsed')) {\n            //  hide()  collapsed \n            $body.hide();\n            $card.removeClass('collapsed');\n            $body.addClass('animating').slideDown(180, function () {\n              $(this).removeClass('animating');\n            });\n          } else {\n            // \n            $body.addClass('animating').slideUp(180, function () {\n              $card.addClass('collapsed');\n              $(this).removeClass('animating');\n            });\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-btn-refresh', function (e) {\n          e.stopPropagation();\n          MvuModule.refresh($panel);\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-btn-numeric-mode', function (e) {\n          e.stopPropagation();\n          try {\n            const isCurrentlyNumeric = $(this).hasClass('active');\n            const newMode = !isCurrentlyNumeric;\n            localStorage.setItem('acu_mvu_numeric_mode', String(newMode));\n            // \n            if (typeof saveActiveTabState === 'function') {\n              const currentTab = getActiveTabState();\n              saveActiveTabState(currentTab);\n            }\n            if (typeof renderInterface === 'function') {\n              renderInterface();\n            }\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n            if (window.toastr) window.toastr.error('');\n          }\n        });\n\n        // [] /\n        $panel.on('click.mvu', '.mvu-level-controls-header', function (e) {\n          e.stopPropagation();\n          const $header = $(this);\n          const $collapsible = $header.closest('.mvu-level-controls-collapsible');\n\n          //  collapsed CSS \n          $collapsible.toggleClass('collapsed');\n        });\n\n        // []  toggle\n        $panel.on('click.mvu', '.mvu-level-toggle', function (e) {\n          e.stopPropagation();\n          const $button = $(this);\n          const levelName = $button.data('level');\n          const currentVisible = $button.data('visible') === 'true' || $button.data('visible') === true;\n          const isVisible = !currentVisible;\n\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            const visibleLevels = saved ? JSON.parse(saved) : {};\n            visibleLevels[levelName] = isVisible;\n            localStorage.setItem('acu_mvu_numeric_mode_visible_levels', JSON.stringify(visibleLevels));\n\n            // \n            const theme = getThemeColors();\n            const buttonTextColor = theme.buttonTextOnAccent || theme.textMain || '#6B4A5A';\n            $button.data('visible', isVisible);\n            if (isVisible) {\n              $button.css({\n                background: 'var(--acu-accent)',\n                color: buttonTextColor,\n                borderColor: 'var(--acu-accent)',\n                opacity: '1',\n              });\n              $button.attr('title', `: ${levelName}`);\n            } else {\n              $button.css({\n                background: 'transparent',\n                color: 'var(--acu-text-sub)',\n                borderColor: 'var(--acu-border)',\n                opacity: '0.5',\n              });\n              $button.attr('title', `: ${levelName}`);\n            }\n\n            //  3\n            $('.mvu-numeric-item').each(function () {\n              const $item = $(this);\n              try {\n                const levels = JSON.parse($item.attr('data-levels') || '[]');\n                if (levels.includes(levelName)) {\n                  // \n                  const visibleLevels = levels.filter(level => {\n                    const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n                    const prefs = saved ? JSON.parse(saved) : {};\n                    return prefs[level] !== false;\n                  });\n\n                  //  levels \n                  const pathLevels = visibleLevels;\n\n                  const newPathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n\n                  // \n                  $item.find('.mvu-path-display').text(newPathDisplay);\n                }\n              } catch (e) {\n                console.warn('[DICE]MvuModule ', e);\n              }\n            });\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-value', function (e) {\n          e.stopPropagation();\n          const $value = $(this);\n          const path = $value.data('path');\n          if (!path) {\n            console.warn('[DICE]MvuModule No path on value element');\n            return;\n          }\n          const currentValue = $value\n            .text()\n            .replace(/\\s*\\$\\s*$/, '')\n            .trim(); //  $\n\n          MvuModule.showEditDialog(path, currentValue, async function (newValue) {\n            if (newValue !== null && newValue !== currentValue) {\n              const success = await MvuModule.setValue(path, newValue);\n              const toastr = window.parent?.toastr || window.toastr;\n              if (success) {\n                $value.text(newValue);\n                $value.css('background', 'var(--acu-success-bg)');\n                setTimeout(() => $value.css('background', ''), 1500);\n              } else {\n                if (toastr) toastr.error('');\n              }\n            }\n          });\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-dice-icon', function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n          const $icon = $(this);\n          const path = $icon.data('path');\n          const attrName = $icon.data('attr-name') || '';\n          const attrValue = parseInt($icon.data('attr-value'), 10) || 50;\n\n          // \n          if (!path) {\n            console.warn('[DICE]MvuModule ');\n            return;\n          }\n\n          //  MVU \n          if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n            console.warn('[DICE]MvuModule MVU ');\n            // \n            if (typeof showDicePanel === 'function') {\n              showDicePanel({\n                attrValue: attrValue,\n                targetValue: null, // showDicePanel\n                targetName: attrName,\n                initiatorName: '<user>',\n                fromMvu: false,\n              });\n            }\n            return;\n          }\n\n          // \n          let parsedInfo = null;\n          try {\n            parsedInfo = parseMvuPathForDice(path, attrValue);\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n\n          // \n          if (typeof showDicePanel === 'function') {\n            showDicePanel({\n              attrValue: attrValue,\n              targetValue: null, // showDicePanel\n              targetName: attrName,\n              initiatorName: parsedInfo?.initiator || '<user>',\n              fromMvu: true,\n              mvuPath: path,\n              mvuParsedInfo: parsedInfo,\n            });\n          }\n        });\n\n        //  ST  swipe regenerate\n        (function () {\n          //  documentiframe \n          const targetDoc = window.parent?.document || document;\n          const $doc = $(targetDoc);\n\n          // \n          $doc.off('touchstart.mvuSwipeFix touchmove.mvuSwipeFix touchend.mvuSwipeFix', '#acu-data-area');\n\n          let touchStartX = 0;\n          let touchStartY = 0;\n          let isHorizontalSwipe = false;\n\n          //  #acu-data-area  MVU \n          $doc.on('touchstart.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) return;\n\n            if (e.originalEvent.touches.length === 1) {\n              touchStartX = e.originalEvent.touches[0].clientX;\n              touchStartY = e.originalEvent.touches[0].clientY;\n              isHorizontalSwipe = false;\n            }\n          });\n\n          $doc.on('touchmove.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              return;\n            }\n\n            if (e.originalEvent.touches.length !== 1) return;\n\n            const touch = e.originalEvent.touches[0];\n            const deltaX = Math.abs(touch.clientX - touchStartX);\n            const deltaY = Math.abs(touch.clientY - touchStartY);\n\n            // X > Y * 1.5\n            // deltaYdeltaX\n            const isHorizontal =\n              deltaY < 5\n                ? deltaX > 5 && deltaX > deltaY * 2 // deltaYdeltaX > 5deltaY\n                : deltaX > deltaY * 1.5 && deltaX > 10; // \n\n            if (isHorizontal) {\n              isHorizontalSwipe = true;\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n            }\n          });\n\n          $doc.on('touchend.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              isHorizontalSwipe = false;\n              touchStartX = 0;\n              touchStartY = 0;\n              return;\n            }\n\n            // \n            if (isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              isHorizontalSwipe = false;\n            }\n            touchStartX = 0;\n            touchStartY = 0;\n          });\n\n          // \n          const captureHandlerTouchStart = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1) {\n              touchStartX = e.touches[0].clientX;\n              touchStartY = e.touches[0].clientY;\n            }\n          };\n          const captureHandlerTouchMove = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1 && touchStartX && touchStartY) {\n              const touch = e.touches[0];\n              const deltaX = Math.abs(touch.clientX - touchStartX);\n              const deltaY = Math.abs(touch.clientY - touchStartY);\n              // \n              const isHorizontal =\n                deltaY < 5 ? deltaX > 5 && deltaX > deltaY * 2 : deltaX > deltaY * 1.5 && deltaX > 10;\n              if (isHorizontal) {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                e.preventDefault();\n              }\n            }\n          };\n          const captureHandlerTouchEnd = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              e.preventDefault();\n            }\n          };\n          // \n          targetDoc.addEventListener('touchstart', captureHandlerTouchStart, true);\n          targetDoc.addEventListener('touchmove', captureHandlerTouchMove, true);\n          targetDoc.addEventListener('touchend', captureHandlerTouchEnd, true);\n        })();\n\n        // \n        $panel.on('click.mvu', '.acu-close-btn', function (e) {\n          e.stopPropagation();\n          const $input = $panel.find('.acu-search-input');\n\n          // \n          if ($input.length && $input.val()) {\n            $input.val('').trigger('input').focus();\n            return;\n          }\n\n          // \n          if (typeof saveActiveTabState === 'function') {\n            saveActiveTabState(null);\n          }\n          if (typeof renderInterface === 'function') {\n            renderInterface();\n          }\n        });\n\n        // \n        $panel.on('pointerdown.mvu', '.acu-height-drag-handle', function (e) {\n          if (e.button !== 0) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const handle = this;\n          handle.setPointerCapture(e.pointerId);\n          $(handle).addClass('active');\n          const startHeight = $panel.height();\n          const startY = e.clientY;\n          const tableName = $(handle).data('table');\n\n          //  MIN_PANEL_HEIGHT  MAX_PANEL_HEIGHT\n          const MIN_PANEL_HEIGHT = typeof window.MIN_PANEL_HEIGHT !== 'undefined' ? window.MIN_PANEL_HEIGHT : 200;\n          const MAX_PANEL_HEIGHT = typeof window.MAX_PANEL_HEIGHT !== 'undefined' ? window.MAX_PANEL_HEIGHT : 800;\n\n          handle.onpointermove = function (moveE) {\n            const dy = moveE.clientY - startY;\n            let newHeight = startHeight - dy; // \n            if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n            if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n            $panel.css('height', newHeight + 'px');\n          };\n          handle.onpointerup = function (upE) {\n            $(handle).removeClass('active');\n            handle.releasePointerCapture(upE.pointerId);\n            handle.onpointermove = null;\n            handle.onpointerup = null;\n            if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n              const heights = getTableHeights();\n              heights[tableName] = parseInt($panel.css('height'));\n              saveTableHeights(heights);\n              $panel.addClass('acu-manual-mode');\n            }\n          };\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-height-drag-handle', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = $(this).data('table');\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-panel-header', function (e) {\n          if ($(e.target).closest('.acu-search-input, .acu-close-btn, .mvu-header-btn').length) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = MvuModule.MODULE_ID;\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n      },\n\n      showEditDialog: function (path, currentValue, onSave) {\n        //  jQuery  document\n        const $ = window.parent?.jQuery || window.jQuery;\n        const targetDoc = window.parent?.document || document;\n        if (!$) return;\n\n        // \n        $(targetDoc).find('.mvu-edit-overlay').remove();\n\n        const currentTheme = (typeof getConfig === 'function' ? getConfig().theme : null) || 'retro';\n\n        const html = `\n                    <div class=\"mvu-edit-overlay acu-edit-overlay acu-theme-${currentTheme}\">\n                        <div class=\"mvu-edit-dialog acu-edit-dialog\">\n                            <div class=\"acu-edit-title\">\n                                <i class=\"fa-solid fa-edit\" style=\"opacity:0.7;\"></i>\n                                <span></span>\n                            </div>\n                            <div class=\"mvu-edit-path\">${escapeHtml(path)}</div>\n                            <textarea class=\"mvu-edit-textarea acu-edit-textarea\">${escapeHtml(currentValue)}</textarea>\n                            <div class=\"mvu-edit-hint\">Ctrl+Enter  | Esc </div>\n                            <div class=\"acu-dialog-btns\">\n                                <button class=\"acu-dialog-btn mvu-btn-cancel\">\n                                    <i class=\"fa-solid fa-times\"></i> \n                                </button>\n                                <button class=\"acu-dialog-btn acu-btn-confirm mvu-btn-save\">\n                                    <i class=\"fa-solid fa-check\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `;\n\n        $(targetDoc.body).append(html);\n        const $overlay = $(targetDoc).find('.mvu-edit-overlay');\n        const $input = $overlay.find('.mvu-edit-textarea');\n\n        setTimeout(() => $input.focus().select(), 50);\n\n        // \n        $overlay.on('click', '.mvu-btn-cancel', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          $overlay.remove();\n          onSave(null);\n        });\n\n        // \n        $overlay.on('click', '.mvu-btn-save', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const newValue = $input.val();\n          $overlay.remove();\n          onSave(newValue);\n        });\n\n        // \n        $overlay.on('click', function (e) {\n          if ($(e.target).hasClass('mvu-edit-overlay')) {\n            $overlay.remove();\n            onSave(null);\n          }\n        });\n\n        // \n        $input.on('keydown', function (e) {\n          if (e.key === 'Escape') {\n            e.preventDefault();\n            $overlay.remove();\n            onSave(null);\n          } else if (e.key === 'Enter' && e.ctrlKey) {\n            e.preventDefault();\n            const newValue = $input.val();\n            $overlay.remove();\n            onSave(newValue);\n          }\n        });\n      },\n\n      setValue: async function (path, newValue) {\n        if (!isAvailable()) return false;\n\n        const mode = detectMode();\n\n        try {\n          let parsedValue = newValue;\n          if (newValue === 'true') parsedValue = true;\n          else if (newValue === 'false') parsedValue = false;\n          else if (!isNaN(Number(newValue)) && String(newValue).trim() !== '') {\n            parsedValue = Number(newValue);\n          }\n\n          if (mode === 'era') {\n            return await setEraValue(path, parsedValue);\n          } else {\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            if (!mvuData) {\n              console.error('[DICE]MvuModule  MVU ');\n              return false;\n            }\n\n            const success = await window.Mvu.setMvuVariable(mvuData, path, parsedValue, {\n              reason: '',\n              is_recursive: false,\n            });\n\n            if (success) {\n              await window.Mvu.replaceMvuData(mvuData, { type: 'message', message_id: 'latest' });\n            } else {\n              console.warn('[DICE]MvuModule setMvuVariable  false');\n            }\n\n            return success;\n          }\n        } catch (e) {\n          console.error('[DICE]MvuModule setValue error:', e);\n          return false;\n        }\n      },\n\n      isModuleTab: function (tableName) {\n        return tableName === MODULE_ID;\n      },\n\n      //  ERA  ERA \n      clearCache: function () {\n        cachedEraData = null;\n        console.log('[DICE]MvuModule  ERA ');\n      },\n\n      // \n      detectMode: function () {\n        return detectMode();\n      },\n\n      refresh: function ($container) {\n        // \n        this.clearCache();\n\n        if (!$container || !$container.length) {\n          const $panel = $('#acu-data-area');\n          if (!$panel.length) return;\n          $container = $panel;\n        }\n        // \n        const $refreshBtn = $container.find('.mvu-btn-refresh');\n        if ($refreshBtn.length) {\n          $refreshBtn.find('i').addClass('fa-spin');\n        }\n\n        // \n        //  10  1  10 \n        this.getDataWithRetry(10, 1000)\n          .then(mvuData => {\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            // []  toastr  renderPanel \n            //  getDataWithRetry \n            const toastr = window.parent?.toastr || window.toastr;\n            const actualData = this.getData();\n            if (toastr && !actualData) {\n              toastr.warning(' MVU ');\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error refreshing data:', err);\n\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            // [] \n            const toastr = window.parent?.toastr || window.toastr;\n            const actualData = this.getData();\n            if (toastr && !actualData) {\n              toastr.error('');\n            }\n          });\n      },\n    };\n  })();\n  // MVU \n  // COC\n  const DEFAULT_DICE_CONFIG = {\n    critSuccessMax: 5,\n    hardSuccessDiv: 5,\n    difficultSuccessDiv: 2,\n    critFailMin: 96,\n    ruleType: 'high_good',\n    lastDiceType: '1d100',\n    // DND \n    dndCritSuccess: 20,\n    dndCritFail: 1,\n    // : initiator_lose | tie | initiator_win\n    contestTieRule: 'initiator_lose',\n    // \n    hideDiceResultFromUser: false,\n    // \n    hideDiceResultInChat: false,\n  };\n\n  const getDiceConfig = () => Store.get(STORAGE_KEY_DICE_CONFIG, DEFAULT_DICE_CONFIG);\n  const saveDiceConfig = cfg => {\n    const oldCfg = getDiceConfig();\n    const newCfg = { ...oldCfg, ...cfg };\n    Store.set(STORAGE_KEY_DICE_CONFIG, newCfg);\n    // \n    const changedKeys = Object.keys(cfg).filter(k => oldCfg[k] !== newCfg[k]);\n    if (changedKeys.length > 0) {\n      console.info(`[DICE]: ${changedKeys.join(', ')}`);\n    }\n  };\n\n  // [] \n  const hideDiceResultsInUserMessages = () => {\n    try {\n      const diceCfg = getDiceConfig();\n      const hideInput = diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const hideChat = diceCfg.hideDiceResultInChat !== undefined ? diceCfg.hideDiceResultInChat : false;\n\n      // : \"XX\"\n      const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n      // : \"  vs    (...)  ......  (...)  .........\"\n      const contestDiceRegex =\n        /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n      // ==========  hideInput  ==========\n      try {\n        const $ta = $('#send_textarea');\n        if ($ta.length) {\n          let textareaVal = $ta.val() || '';\n          let modifiedText = textareaVal;\n\n          if (hideInput) {\n            // \n            const contestRegex =\n              /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n            const normalRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n            if (contestRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(contestRegex, '[]');\n            }\n            if (normalRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(normalRegex, '[]');\n            }\n          } else {\n            // \n            const originalText = $ta.data('acu-original-dice-text');\n            if (originalText && textareaVal.includes('[]')) {\n              // \n              modifiedText = textareaVal.replace(/\\[\\]/g, originalText);\n              $ta.removeData('acu-original-dice-text');\n            }\n          }\n\n          if (modifiedText !== textareaVal) {\n            $ta.val(modifiedText).trigger('input').trigger('change');\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]ACU :', e);\n      }\n\n      // ==========  hideChat  ==========\n      // \n      let lastMessageId;\n      try {\n        lastMessageId = getLastMessageId();\n      } catch (e) {\n        //  lastMessageId \n        return;\n      }\n\n      // \n      if (lastMessageId < 0) {\n        return;\n      }\n\n      try {\n        const userMessages = getChatMessages(`0-${lastMessageId}`, { role: 'user' });\n        // \n        if (!userMessages || userMessages.length === 0) {\n          return;\n        }\n\n        if (hideChat) {\n          // \n          let hiddenCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const $msgElement = retrieveDisplayedMessage(msg.message_id);\n              if (!$msgElement || !$msgElement.length) {\n                return;\n              }\n\n              // \n              let $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) {\n                // \n                $mesText = $msgElement.find('.message-text, .text, [class*=\"text\"], [class*=\"message\"]').first();\n                if (!$mesText || !$mesText.length) {\n                  // \n                  $mesText = $msgElement;\n                }\n              }\n\n              // DOM\n              const currentDomText = $mesText.text();\n              // \n              if (currentDomText.includes('[]')) {\n                return;\n              }\n\n              // AI\n              const originalText = msg.message || '';\n              if (!originalText) {\n                return;\n              }\n\n              // \n              let modifiedText = originalText;\n\n              // \n              //  lastIndex \n              const contestRegex =\n                /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n              const contestMatch = contestRegex.test(modifiedText);\n              if (contestMatch) {\n                modifiedText = modifiedText.replace(contestRegex, '[]');\n              }\n\n              // \n              const normalRegex =\n                /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n              const normalMatch = normalRegex.test(modifiedText);\n              if (normalMatch) {\n                modifiedText = modifiedText.replace(normalRegex, '[]');\n              }\n\n              // DOM\n              // HTMLHTML\n              if (modifiedText !== originalText && modifiedText !== currentDomText) {\n                // HTML\n                const currentHtml = $mesText.html();\n                // HTMLHTML\n                let modifiedHtml = currentHtml;\n\n                // \n                const contestPattern =\n                  /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n                if (contestPattern.test(currentHtml)) {\n                  modifiedHtml = modifiedHtml.replace(contestPattern, '[]');\n                }\n\n                // \n                const normalPattern =\n                  /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n                if (normalPattern.test(currentHtml)) {\n                  modifiedHtml = modifiedHtml.replace(normalPattern, '[]');\n                }\n\n                // HTML\n                if (modifiedHtml !== currentHtml) {\n                  $mesText.html(modifiedHtml);\n                  hiddenCount++;\n                }\n              }\n            } catch (e) {\n              console.warn(`[DICE]ACU  ${msg.message_id} :`, e);\n            }\n          });\n          if (hiddenCount > 0) {\n            console.info(`[DICE] ${hiddenCount} `);\n          }\n        } else {\n          // \n          let restoredCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const $msgElement = retrieveDisplayedMessage(msg.message_id);\n              if (!$msgElement || !$msgElement.length) return;\n\n              const $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) return;\n\n              // \n              const currentText = $mesText.text();\n              if (currentText.includes('[]')) {\n                // \n                const originalText = msg.message || '';\n                if (originalText) {\n                  $mesText.text(originalText);\n                  restoredCount++;\n                }\n              }\n            } catch (e) {\n              // \n            }\n          });\n          if (restoredCount > 0) {\n            console.info(`[DICE] ${restoredCount} `);\n          }\n        }\n      } catch (e) {\n        // \n        // \n        if (hideChat) {\n          console.warn('[DICE]ACU :', e);\n        }\n      }\n    } catch (e) {\n      // [] \n      // \n      const diceCfg = getDiceConfig();\n      if (diceCfg && (diceCfg.hideDiceResultFromUser || diceCfg.hideDiceResultInChat)) {\n        console.warn('[DICE]ACU :', e);\n      }\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const BUILTIN_ATTRIBUTE_PRESETS = [\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'coc7',\n      name: 'COC',\n      builtin: true,\n      description: '7816',\n      baseAttributes: [\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n      ],\n      specialAttributes: [\n        //  15-1109560\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        //  9-8547\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        //  8-6536\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        //  3-4122\n        { name: '', formula: '1+2d20', range: [3, 41] },\n        // \n        { name: '', formula: '/2', range: [1, 99] },\n        // COC \n        { name: 'SAN', formula: '', range: [1, 99] },\n        { name: '', formula: '1d5', range: [1, 5] },\n      ],\n    },\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'dnd5e',\n      name: 'DND',\n      builtin: true,\n      description: '568',\n      baseAttributes: [\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n      ],\n      specialAttributes: [\n        //  10-2015\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        //  7-1712\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        //  4-149\n        { name: '', formula: '2+2d6', range: [4, 14] },\n        { name: '', formula: '2+2d6', range: [4, 14] },\n      ],\n    },\n  ];\n\n  // \n  const AttributePresetManager = (() => {\n    let _cache = null;\n\n    return {\n      //  + \n      getAllPresets() {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        // \n        let needsSave = false;\n        stored.forEach(preset => {\n          const presetVersion = preset.version || '0.0.0';\n          if (compareVersion(presetVersion, PRESET_FORMAT_VERSION) < 0) {\n            console.log(\n              `[DICE]AttributePresetManager  \"${preset.name}\"  (${presetVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n            preset.version = PRESET_FORMAT_VERSION;\n            needsSave = true;\n          }\n        });\n        if (needsSave) {\n          Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n          // \n          _cache = null;\n        }\n        // \n        if (!needsSave && _cache) {\n          return _cache;\n        }\n        _cache = [...BUILTIN_ATTRIBUTE_PRESETS, ...stored];\n        return _cache;\n      },\n\n      // null = \n      getActivePreset() {\n        const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        if (!activeId) return null;\n        return this.getAllPresets().find(p => p.id === activeId) || null;\n      },\n\n      // \n      setActivePreset(id) {\n        try {\n          // idnull\n          const finalId = id === '' || id === undefined ? null : id;\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, finalId);\n          // \n          _cache = null;\n          console.log('[DICE]AttributePresetManager :', finalId);\n          return true;\n        } catch (err) {\n          console.error('[DICE]AttributePresetManager :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const newPreset = {\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          builtin: false,\n          version: preset.version || PRESET_FORMAT_VERSION,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates };\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        }\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getAllPresets().find(p => p.id === id);\n        if (!preset) return null;\n        const exported = {\n          format: 'acu_attr_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n        };\n        delete exported.builtin; // \n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr, autoUpdate = false) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.format !== 'acu_attr_preset_v1') {\n            throw new Error('');\n          }\n\n          // \n          if (!data.name || !data.baseAttributes || !Array.isArray(data.baseAttributes)) {\n            throw new Error('');\n          }\n\n          const importedVersion = data.version || '0.0.0';\n          const needsUpdate = compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            builtin: false,\n            version: autoUpdate && needsUpdate ? PRESET_FORMAT_VERSION : importedVersion,\n            createdAt: new Date().toISOString(),\n          };\n\n          const result = this.createPreset(imported);\n          if (result && needsUpdate && !autoUpdate) {\n            console.warn(\n              `[DICE]AttributePresetManager  \"${result.name}\"  (${importedVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n          }\n          return result;\n        } catch (e) {\n          console.error('[DICE]AttributePresetManager :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  // ActionPresetManager  JS \n  // interface ActionGroupPreset {\n  //   format: 'acu_action_preset_v1';\n  //   version: string;\n  //   id: string;\n  //   name: string;\n  //   builtin: boolean;\n  //   description?: string;\n  //   rules: ActionRule[];\n  // }\n  // interface ActionRule {\n  //   table_keywords: string[];\n  //   actions: ActionItem[];\n  // }\n  // interface ActionItem {\n  //   label: string;\n  //   icon?: string;\n  //   template?: string;\n  // }\n\n  // \n  const BUILTIN_ACTION_PRESETS = [\n    {\n      format: 'acu_action_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: '__builtin_default__',\n      name: '',\n      builtin: true,\n      description: '',\n      rules: [\n        {\n          table_keywords: ['', '', 'Location', 'Map', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', 'NPC', '', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n      ],\n    },\n  ];\n\n  const ActionPresetManager = (() => {\n    let _cache = null;\n\n    return {\n      //  + \n      getAllPresets() {\n        if (_cache) return _cache;\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        _cache = [...BUILTIN_ACTION_PRESETS, ...stored];\n        return _cache;\n      },\n\n      // ID\n      getPresetById(id) {\n        return this.getAllPresets().find(p => p.id === id) || null;\n      },\n\n      // ID\n      getActivePresetId() {\n        const stored = Store.get(STORAGE_KEY_ACTIVE_ACTION_PRESET, '__builtin_default__');\n        return stored === null ? '__builtin_default__' : stored;\n      },\n\n      // \n      getActivePreset() {\n        const activeId = this.getActivePresetId();\n        if (!activeId || activeId === '__none__') return null;\n        return this.getPresetById(activeId);\n      },\n\n      // '__none__' \n      setActivePresetId(id) {\n        try {\n          const finalId = id === '' || id === undefined || id === null ? '__none__' : id;\n          Store.set(STORAGE_KEY_ACTIVE_ACTION_PRESET, finalId);\n          _cache = null;\n          console.log('[DICE]ActionPresetManager :', finalId);\n          return true;\n        } catch (err) {\n          console.error('[DICE]ActionPresetManager :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        const newPreset = {\n          format: 'acu_action_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          builtin: false,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ACTION_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]ActionPresetManager :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates, version: PRESET_FORMAT_VERSION };\n        Store.set(STORAGE_KEY_ACTION_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]ActionPresetManager :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ACTION_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ACTION_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ACTION_PRESET, null);\n        }\n        console.log('[DICE]ActionPresetManager :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getPresetById(id);\n        if (!preset) return null;\n        const exported = {\n          format: 'acu_action_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n        };\n        delete exported.builtin;\n        delete exported.createdAt;\n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.format !== 'acu_action_preset_v1') {\n            throw new Error(' acu_action_preset_v1');\n          }\n\n          // \n          if (!data.name || !data.rules || !Array.isArray(data.rules)) {\n            throw new Error(' name  rules ');\n          }\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            builtin: false,\n            version: PRESET_FORMAT_VERSION,\n            createdAt: new Date().toISOString(),\n          };\n\n          const result = this.createPreset(imported);\n          return result;\n        } catch (e) {\n          console.error('[DICE]ActionPresetManager :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const getCrazyModeConfig = () => {\n    const stored = Store.get(STORAGE_KEY_CRAZY_MODE, null);\n    if (!stored) return { ...DEFAULT_CRAZY_MODE_CONFIG };\n    return { ...DEFAULT_CRAZY_MODE_CONFIG, ...stored };\n  };\n\n  // \n  const saveCrazyModeConfig = config => {\n    Store.set(STORAGE_KEY_CRAZY_MODE, config);\n  };\n\n  // \n  const shouldTriggerCrazyMode = () => {\n    const config = getCrazyModeConfig();\n    if (!config.enabled) return false;\n    // crazyLevel \n    const roll = Math.random() * 100;\n    return roll < config.crazyLevel;\n  };\n\n  // \n  const selectCrazyRollType = crazyLevel => {\n    // crazyLevel < 50: 100% \n    // crazyLevel 50-75: 70%  / 30% \n    // crazyLevel > 75: 50%  / 50% \n    if (crazyLevel < 50) return 'normal';\n    const contestChance = crazyLevel <= 75 ? 0.3 : 0.5;\n    return Math.random() < contestChance ? 'contest' : 'normal';\n  };\n\n  // \n  const weightedRandomSelect = items => {\n    if (!items || items.length === 0) return null;\n    const totalWeight = items.reduce((sum, item) => sum + (item.weight || 1), 0);\n    let random = Math.random() * totalWeight;\n    for (const item of items) {\n      random -= item.weight || 1;\n      if (random <= 0) return item;\n    }\n    return items[items.length - 1];\n  };\n\n  // \n  const selectCrazyParticipant = () => {\n    const config = getCrazyModeConfig();\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return null;\n\n    const allTables = processJsonData(rawData || {});\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n\n    // \n    const candidates = [];\n\n    // \n    if (playerResult?.data?.rows?.length > 0) {\n      const playerName = getDisplayPlayerName() || '';\n      const playerAttrs = getFullAttributesForCharacter('<user>');\n      candidates.push({\n        name: playerName,\n        attrs: playerAttrs,\n        isPlayer: true,\n        inScene: true,\n        weight: config.playerWeight,\n      });\n    }\n\n    // NPC\n    if (npcResult) {\n      const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n      npcParsed.forEach(npc => {\n        if (!npc.name) return;\n        const inSceneVal = String(npc.inScene || '').toLowerCase();\n        const isInScene = inSceneVal === 'true' || inSceneVal === '';\n        const npcAttrs = getFullAttributesForCharacter(npc.name);\n        candidates.push({\n          name: npc.name,\n          attrs: npcAttrs,\n          isPlayer: false,\n          inScene: isInScene,\n          weight: isInScene ? config.inSceneNpcWeight : config.offSceneNpcWeight,\n        });\n      });\n    }\n\n    if (candidates.length === 0) return null;\n    return weightedRandomSelect(candidates);\n  };\n\n  // \n  const selectCrazyAttribute = participant => {\n    if (!participant) return { name: '', value: 50 };\n\n    // 1. \n    if (participant.attrs && participant.attrs.length > 0) {\n      const randomAttr = participant.attrs[Math.floor(Math.random() * participant.attrs.length)];\n      return { name: randomAttr.name, value: randomAttr.value };\n    }\n\n    // 2. \n    const activePreset = AttributePresetManager.getActivePreset();\n    if (activePreset) {\n      const allPresetAttrs = [...(activePreset.baseAttributes || []), ...(activePreset.specialAttributes || [])];\n      if (allPresetAttrs.length > 0) {\n        const randomPresetAttr = allPresetAttrs[Math.floor(Math.random() * allPresetAttrs.length)];\n        //  range  50% \n        const range = randomPresetAttr.range || [0, 100];\n        const defaultValue = Math.floor((range[0] + range[1]) / 2);\n        return { name: randomPresetAttr.name, value: defaultValue };\n      }\n    }\n\n    // 3. \n    const skillPool = getRandomSkillPool();\n    if (skillPool && skillPool.length > 0) {\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      return { name: randomSkill, value: 50 };\n    }\n\n    return { name: '', value: 50 };\n  };\n\n  //  d100\n  const crazyRollD100 = () => Math.floor(Math.random() * 100) + 1;\n\n  // \n  const judgeCrazyRollResult = (roll, target) => {\n    if (roll <= 5) return '';\n    if (roll >= 96) return '';\n    if (roll <= target) return '';\n    return '';\n  };\n\n  // \n  const generateCrazyRoll = () => {\n    const config = getCrazyModeConfig();\n    const rollType = selectCrazyRollType(config.crazyLevel);\n\n    if (rollType === 'normal') {\n      // \n      const participant = selectCrazyParticipant();\n      if (!participant) return null;\n\n      const attr = selectCrazyAttribute(participant);\n      const roll = crazyRollD100();\n      const result = judgeCrazyRollResult(roll, attr.value);\n\n      // XXYY\n      return `${participant.name}${attr.name}${roll}${attr.value}${result}`;\n    } else {\n      // \n      const participant1 = selectCrazyParticipant();\n      if (!participant1) return null;\n\n      // \n      let participant2 = null;\n      for (let i = 0; i < 5; i++) {\n        const candidate = selectCrazyParticipant();\n        if (candidate && candidate.name !== participant1.name) {\n          participant2 = candidate;\n          break;\n        }\n      }\n\n      // \n      if (!participant2) {\n        const attr = selectCrazyAttribute(participant1);\n        const roll = crazyRollD100();\n        const result = judgeCrazyRollResult(roll, attr.value);\n        return `${participant1.name}${attr.name}${roll}${attr.value}${result}`;\n      }\n\n      const attr1 = selectCrazyAttribute(participant1);\n      const attr2 = selectCrazyAttribute(participant2);\n      const roll1 = crazyRollD100();\n      const roll2 = crazyRollD100();\n\n      // \n      const result1 = judgeCrazyRollResult(roll1, attr1.value);\n      const result2 = judgeCrazyRollResult(roll2, attr2.value);\n      const margin1 = attr1.value - roll1;\n      const margin2 = attr2.value - roll2;\n\n      let winner;\n      if (margin1 > margin2) {\n        winner = `${participant1.name}`;\n      } else if (margin2 > margin1) {\n        winner = `${participant2.name}`;\n      } else {\n        winner = '';\n      }\n\n      // \n      return (\n        `${participant1.name} ${attr1.name} vs ${participant2.name} ${attr2.name}` +\n        `${participant1.name} ${attr1.name} (${attr1.value})  ${roll1}${result1}` +\n        `${participant2.name} ${attr2.name} (${attr2.value})  ${roll2}${result2}` +\n        `${winner}`\n      );\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  /**\n   * \n   * : 3d6, 4d6kh3, 4d6dl1, 4d6dh1\n   * @returns  NaN\n   */\n  const rollDiceExpression = expr => {\n    const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n\n    const match = expr.match(/^(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?$/i);\n    if (!match) return NaN;\n\n    const [, countStr, sidesStr, keepDrop] = match;\n    const count = parseInt(countStr, 10);\n    const sides = parseInt(sidesStr, 10);\n\n    let rolls = Array.from({ length: count }, () => rollDice(sides));\n\n    //  keep/drop\n    if (keepDrop) {\n      const kd = keepDrop.toLowerCase();\n      const n = parseInt(kd.slice(2), 10);\n      rolls.sort((a, b) => b - a); // \n\n      if (kd.startsWith('kh'))\n        rolls = rolls.slice(0, n); // n\n      else if (kd.startsWith('kl'))\n        rolls = rolls.slice(-n); // n\n      else if (kd.startsWith('dh'))\n        rolls = rolls.slice(n); // n\n      else if (kd.startsWith('dl')) rolls = rolls.slice(0, -n); // n\n    }\n\n    return rolls.reduce((a, b) => a + b, 0);\n  };\n\n  /**\n   * \n   * @param formula  \"/2+1d10\"  \"3d6*5\"\n   * @param context  { : 50, : 40 }\n   * @returns \n   */\n  const evaluateFormula = (formula, context = {}) => {\n    if (!formula) return 0;\n\n    let expr = String(formula).trim();\n\n    // 1. \n    const varNames = Object.keys(context).sort((a, b) => b.length - a.length);\n    for (const name of varNames) {\n      const value = context[name];\n      if (typeof value === 'number' && !isNaN(value)) {\n        // \n        expr = expr.split(name).join(`(${value})`);\n      }\n    }\n\n    // 2. \n    expr = expr.replace(/\\d+d\\d+(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi, match => {\n      const result = rollDiceExpression(match);\n      return isNaN(result) ? '0' : String(result);\n    });\n\n    // 3. \n    if (!/^[\\d\\s+\\-*/().]+$/.test(expr)) {\n      console.warn('[DICE]evaluateFormula :', formula, '', expr);\n      return 0;\n    }\n\n    // 4. \n    try {\n      // eslint-disable-next-line no-new-func\n      const result = new Function(`return (${expr})`)();\n      return Math.round(result); // \n    } catch (e) {\n      console.error('[DICE]evaluateFormula :', formula, '', expr, e);\n      return 0;\n    }\n  };\n\n  /**\n   * \n   * @param formula \n   * @param range  [min, max]\n   * @param context \n   * @returns \n   */\n  const generateAttributeValue = (formula, range, context) => {\n    let value = evaluateFormula(formula, context);\n\n    if (range && Array.isArray(range) && range.length === 2) {\n      value = Math.max(range[0], Math.min(range[1], value));\n    }\n\n    return value;\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const DASHBOARD_TABLE_CONFIG = {\n    global: {\n      tableKeywords: ['', '', ''],\n      columns: {\n        detailLocation: { keywords: ['', '', '', ''], fallbackIndex: null },\n        currentLocation: { keywords: ['', '', '', ''], fallbackIndex: 2 },\n      },\n    },\n    player: {\n      // : user, <user>\n      tableKeywords: ['', '', '', '', 'player', '', 'user', '<user>'],\n      columns: {\n        name: { keywords: ['', '', '', 'name'], fallbackIndex: 1 },\n        status: { keywords: ['', '', '', ''], fallbackIndex: null },\n        position: { keywords: ['', '', ''], fallbackIndex: null },\n        attrs: { keywords: ['', ''], fallbackIndex: null, isMultiple: true },\n        // : , , , \n        money: {\n          keywords: ['', '', '', '', '', '', '', '', ''],\n          fallbackIndex: null,\n        },\n        resources: { keywords: ['', '', 'resources'], fallbackIndex: null },\n      },\n    },\n    location: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: {\n          keywords: ['', '', '', '', '', '', '', ''],\n          fallbackIndex: 1,\n        },\n        description: { keywords: ['', '', '', '', ''], fallbackIndex: null },\n      },\n    },\n    npc: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        'NPC',\n        '',\n        '',\n        '',\n        '',\n        'character',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', ''], fallbackIndex: 1 },\n        status: { keywords: ['', ''], fallbackIndex: null },\n        position: { keywords: ['', '', '', ''], fallbackIndex: null },\n        inScene: { keywords: ['', '', '', ''], fallbackIndex: null },\n      },\n    },\n    quest: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        progress: { keywords: ['', '', '/'], fallbackIndex: 5 },\n        status: { keywords: [''], fallbackIndex: 6 },\n      },\n      filters: {\n        active: { column: 'status', includes: ['', '', ''], excludeColumn: 'type', excludes: [''] },\n      },\n    },\n    bag: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        count: { keywords: ['', '', ''], fallbackIndex: 3 },\n      },\n    },\n    skill: {\n      // : , , , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        level: { keywords: ['', '', '', 'lv'], fallbackIndex: 3 },\n      },\n    },\n    equip: {\n      // : , , , , , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        part: { keywords: ['', '', ''], fallbackIndex: 3 },\n        isEquipped: { keywords: ['', '', '', ''], fallbackIndex: 4 },\n      },\n      filters: {\n        equipped: { column: 'isEquipped', includes: ['', '', 'true', '', 'yes', 'equipped'] },\n      },\n    },\n  };\n\n  // \n  const DashboardDataParser = {\n    // \n    findTable(allTables, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return null;\n      }\n\n      for (const keyword of config.tableKeywords) {\n        for (const tableName in allTables) {\n          if (tableName.includes(keyword)) {\n            console.info(`[DICE]: \"${moduleKey}\"\"${tableName}\" (: \"${keyword}\")`);\n            return {\n              data: allTables[tableName],\n              name: tableName,\n              key: allTables[tableName].key,\n              config: config,\n            };\n          }\n        }\n      }\n      console.info(\n        `[DICE]: \"${moduleKey}\" (: ${config.tableKeywords.join(', ')})`,\n      );\n      return null;\n    },\n\n    // \n    findColumnIndex(headers, columnKey, moduleConfig) {\n      const colConfig = moduleConfig.columns[columnKey];\n      if (!colConfig) return -1;\n\n      // \n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (colConfig.keywords.some(kw => h.includes(kw.toLowerCase()))) {\n          return i;\n        }\n      }\n\n      // \n      return colConfig.fallbackIndex ?? -1;\n    },\n\n    // \n    getValue(row, headers, columnKey, moduleConfig) {\n      const idx = this.findColumnIndex(headers, columnKey, moduleConfig);\n      if (idx < 0 || idx >= row.length) return null;\n      return row[idx];\n    },\n\n    // \n    getColumnMap(headers, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) return {};\n\n      const map = {};\n      for (const colKey in config.columns) {\n        map[colKey] = this.findColumnIndex(headers, colKey, config);\n      }\n      return map;\n    },\n\n    // \n    parseRows(tableResult, moduleKey) {\n      if (!tableResult || !tableResult.data) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return [];\n      }\n\n      const { data, config } = tableResult;\n      const headers = data.headers || [];\n      const rows = data.rows || [];\n      const colMap = this.getColumnMap(headers, moduleKey);\n\n      const parsed = rows.map((row, idx) => {\n        const obj = { _rowIndex: idx, _raw: row };\n        for (const colKey in colMap) {\n          const colIdx = colMap[colKey];\n          obj[colKey] = colIdx >= 0 && colIdx < row.length ? row[colIdx] : null;\n        }\n        return obj;\n      });\n\n      console.info(`[DICE]: \"${moduleKey}\"${parsed.length}`);\n      return parsed;\n    },\n\n    // \n    applyFilter(parsedRows, filterKey, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config || !config.filters || !config.filters[filterKey]) return parsedRows;\n\n      const filter = config.filters[filterKey];\n\n      // parsedRows\n      const hasFilterColumn = parsedRows.some(row => row[filter.column] !== null && row[filter.column] !== undefined);\n      if (!hasFilterColumn) {\n        // \n        return parsedRows;\n      }\n\n      return parsedRows.filter(row => {\n        const value = String(row[filter.column] || '').toLowerCase();\n        const matchInclude = filter.includes.some(inc => value.includes(inc.toLowerCase()));\n\n        if (filter.excludeColumn && filter.excludes) {\n          const excludeValue = String(row[filter.excludeColumn] || '').toLowerCase();\n          const matchExclude = filter.excludes.some(exc => excludeValue.includes(exc.toLowerCase()));\n          return matchInclude && !matchExclude;\n        }\n\n        return matchInclude;\n      });\n    },\n  };\n\n  const DEFAULT_GM_CONFIG = {\n    enabled: true,\n    diceSystem: '1d100',\n    showDiceIcon: true,\n    autoSendPrompt: true,\n    action_groups: [\n      {\n        table_keywords: ['', '', 'Location', 'Map', '', ''],\n        actions: [\n          { label: '', icon: 'fa-walking', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-search', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-clock', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', 'NPC', '', '', ''],\n        actions: [\n          { label: '', icon: 'fa-comments', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-hand-fist', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          { label: '', icon: 'fa-hand-pointer', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-trash', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-shield-halved',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-coins', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-wand-magic-sparkles',\n            type: 'skill_check',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-dumbbell', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-crosshairs',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          {\n            label: '',\n            icon: 'fa-list-check',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-ear-listen',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-user-plus', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          {\n            label: '',\n            icon: 'fa-handshake',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n        ],\n      },\n    ],\n  };\n  // [] \n  const THEME_COLORS = {\n    retro: {\n      bgPanel: '#e6e2d3',\n      border: '#dcd0c0',\n      textMain: '#5e4b35',\n      textSub: '#8a7a6a',\n      btnBg: '#dcd0c0',\n      btnHover: '#cbbba8',\n      accent: '#7a695f',\n      tableHead: '#efebe4',\n      successText: '#27ae60',\n      successBg: 'rgba(39, 174, 96, 0.15)',\n      inputBg: '#f5f2eb',\n      inputText: '#5e4b35',\n      placeholderText: '#a09080',\n      btnActiveBg: '#8d7b6f',\n      btnActiveText: '#fdfaf5',\n      // \n      failureText: '#e74c3c',\n      failureBg: 'rgba(231, 76, 60, 0.15)',\n      warningText: '#f39c12',\n      warningBg: 'rgba(243, 156, 18, 0.15)',\n      critSuccessText: '#9b59b6',\n      critSuccessBg: 'rgba(155, 89, 182, 0.15)',\n      critFailureText: '#c0392b',\n      critFailureBg: 'rgba(192, 57, 43, 0.15)',\n      extremeSuccessText: '#2980b9',\n      extremeSuccessBg: 'rgba(41, 128, 185, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#e74c3c',\n      errorBg: 'rgba(231, 76, 60, 0.15)',\n      errorBorder: 'rgba(231, 76, 60, 0.5)',\n      warningIcon: '#e67e22',\n      buttonTextOnAccent: '#fff',\n    },\n    dark: {\n      bgPanel: 'rgba(30, 30, 30, 0.98)',\n      border: '#444',\n      textMain: '#eee',\n      textSub: '#999',\n      btnBg: 'rgba(60, 60, 60, 0.9)',\n      btnHover: '#505050',\n      accent: '#9b8cd9',\n      tableHead: 'rgba(45, 45, 45, 0.95)',\n      successText: '#4cd964',\n      successBg: 'rgba(76, 217, 100, 0.2)',\n      inputBg: 'rgba(50, 50, 50, 0.95)',\n      inputText: '#eee',\n      placeholderText: '#777',\n      btnActiveBg: '#6a5acd',\n      btnActiveText: '#fff',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#ba68c8',\n      critSuccessBg: 'rgba(186, 104, 200, 0.2)',\n      critFailureText: '#d32f2f',\n      critFailureBg: 'rgba(211, 47, 47, 0.2)',\n      extremeSuccessText: '#42a5f5',\n      extremeSuccessBg: 'rgba(66, 165, 245, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.75)',\n      overlayBgLight: 'rgba(0,0,0,0.65)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255,255,255,0.05)',\n      veryLightBg: 'rgba(255,255,255,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(255,255,255,0.1)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#fff',\n    },\n    modern: {\n      bgPanel: '#f8f9fa',\n      border: '#e0e0e0',\n      textMain: '#333',\n      textSub: '#666',\n      btnBg: '#e9ecef',\n      btnHover: '#dee2e6',\n      accent: '#007bff',\n      tableHead: '#f1f3f5',\n      successText: '#28a745',\n      successBg: 'rgba(40, 167, 69, 0.15)',\n      inputBg: '#fff',\n      inputText: '#333',\n      placeholderText: '#999',\n      btnActiveBg: '#007bff',\n      btnActiveText: '#fff',\n      // \n      failureText: '#dc3545',\n      failureBg: 'rgba(220, 53, 69, 0.15)',\n      warningText: '#ffc107',\n      warningBg: 'rgba(255, 193, 7, 0.15)',\n      critSuccessText: '#6f42c1',\n      critSuccessBg: 'rgba(111, 66, 193, 0.15)',\n      critFailureText: '#c82333',\n      critFailureBg: 'rgba(200, 35, 51, 0.15)',\n      extremeSuccessText: '#17a2b8',\n      extremeSuccessBg: 'rgba(23, 162, 184, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#dc3545',\n      errorBg: 'rgba(220, 53, 69, 0.15)',\n      errorBorder: 'rgba(220, 53, 69, 0.5)',\n      warningIcon: '#fd7e14',\n      buttonTextOnAccent: '#fff',\n    },\n    forest: {\n      bgPanel: '#e8f5e9',\n      border: '#a5d6a7',\n      textMain: '#2e7d32',\n      textSub: '#66bb6a',\n      btnBg: '#c8e6c9',\n      btnHover: '#a5d6a7',\n      accent: '#43a047',\n      tableHead: '#dcedc8',\n      successText: '#2e7d32',\n      successBg: 'rgba(46, 125, 50, 0.2)',\n      inputBg: '#f1f8e9',\n      inputText: '#2e7d32',\n      placeholderText: '#81c784',\n      btnActiveBg: '#43a047',\n      btnActiveText: '#fff',\n      // \n      failureText: '#c62828',\n      failureBg: 'rgba(198, 40, 40, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#0277bd',\n      extremeSuccessBg: 'rgba(2, 119, 189, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#c62828',\n      errorBg: 'rgba(198, 40, 40, 0.15)',\n      errorBorder: 'rgba(198, 40, 40, 0.5)',\n      warningIcon: '#e67e22',\n      buttonTextOnAccent: '#fff',\n    },\n    ocean: {\n      bgPanel: '#e3f2fd',\n      border: '#90caf9',\n      textMain: '#1565c0',\n      textSub: '#42a5f5',\n      btnBg: '#bbdefb',\n      btnHover: '#90caf9',\n      accent: '#1976d2',\n      tableHead: '#bbdefb',\n      successText: '#0288d1',\n      successBg: 'rgba(2, 136, 209, 0.15)',\n      inputBg: '#e1f5fe',\n      inputText: '#1565c0',\n      placeholderText: '#64b5f6',\n      btnActiveBg: '#1976d2',\n      btnActiveText: '#fff',\n      // \n      failureText: '#d32f2f',\n      failureBg: 'rgba(211, 47, 47, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#0277bd',\n      extremeSuccessBg: 'rgba(2, 119, 189, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#d32f2f',\n      errorBg: 'rgba(211, 47, 47, 0.15)',\n      errorBorder: 'rgba(211, 47, 47, 0.5)',\n      warningIcon: '#f57c00',\n      buttonTextOnAccent: '#fff',\n    },\n    cyber: {\n      bgPanel: '#0a0a0a',\n      border: '#00ffcc33',\n      textMain: '#00ffcc',\n      textSub: '#00cc99',\n      btnBg: 'rgba(0, 255, 204, 0.1)',\n      btnHover: 'rgba(0, 255, 204, 0.2)',\n      accent: '#00ffcc',\n      tableHead: 'rgba(0, 255, 204, 0.05)',\n      successText: '#0f0',\n      successBg: 'rgba(0, 255, 0, 0.15)',\n      inputBg: 'rgba(0, 0, 0, 0.6)',\n      inputText: '#00ffcc',\n      placeholderText: '#006655',\n      btnActiveBg: '#ff00ff',\n      btnActiveText: '#fff',\n      // \n      failureText: '#ff0066',\n      failureBg: 'rgba(255, 0, 102, 0.2)',\n      warningText: '#ffaa00',\n      warningBg: 'rgba(255, 170, 0, 0.2)',\n      critSuccessText: '#ff00ff',\n      critSuccessBg: 'rgba(255, 0, 255, 0.2)',\n      critFailureText: '#ff0000',\n      critFailureBg: 'rgba(255, 0, 0, 0.2)',\n      extremeSuccessText: '#00ffff',\n      extremeSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,255,204,0.3)',\n      lightBg: 'rgba(0,255,204,0.05)',\n      veryLightBg: 'rgba(0,255,204,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(0,255,204,0.1)',\n      // \n      buttonBg: 'rgba(0, 200, 150, 0.6)',\n      buttonBgActive: 'rgba(0, 180, 130, 0.7)',\n      presetButtonBg: 'rgba(0, 200, 150, 0.3)',\n      presetButtonBgActive: 'rgba(0, 200, 150, 0.6)',\n      // /\n      errorText: '#ff0066',\n      errorBg: 'rgba(255, 0, 102, 0.2)',\n      errorBorder: 'rgba(255, 0, 102, 0.5)',\n      warningIcon: '#ffaa00',\n      buttonTextOnAccent: '#000',\n    },\n    nightowl: {\n      bgPanel: '#011627',\n      border: '#132e45',\n      textMain: '#e0e6f2',\n      textSub: '#a6b8cc',\n      btnBg: '#1f3a52',\n      btnHover: '#2a4a68',\n      accent: '#7fdbca',\n      tableHead: '#0a2133',\n      successText: '#addb67',\n      successBg: 'rgba(173, 219, 103, 0.15)',\n      inputBg: '#00101c',\n      inputText: '#e0e6f2',\n      placeholderText: '#6a8090',\n      btnActiveBg: '#7fdbca',\n      btnActiveText: '#011627',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#c792ea',\n      critSuccessBg: 'rgba(199, 146, 234, 0.2)',\n      critFailureText: '#ef5350',\n      critFailureBg: 'rgba(239, 83, 80, 0.2)',\n      extremeSuccessText: '#82aaff',\n      extremeSuccessBg: 'rgba(130, 170, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.75)',\n      overlayBgLight: 'rgba(0,0,0,0.65)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255,255,255,0.05)',\n      veryLightBg: 'rgba(255,255,255,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(255,255,255,0.1)',\n      // \n      buttonBg: 'rgba(127, 219, 202, 0.4)',\n      buttonBgActive: 'rgba(127, 219, 202, 0.5)',\n      presetButtonBg: 'rgba(127, 219, 202, 0.2)',\n      presetButtonBgActive: 'rgba(127, 219, 202, 0.4)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#000',\n    },\n    sakura: {\n      bgPanel: '#F9F0EF',\n      border: '#EBDCD9',\n      textMain: '#6B5552',\n      textSub: '#C08D8D',\n      btnBg: '#EBDCD9',\n      btnHover: '#D8C7C4',\n      accent: '#C08D8D',\n      tableHead: '#F9F0EF',\n      successText: '#6B5552',\n      successBg: 'rgba(192, 141, 141, 0.12)',\n      inputBg: '#F9F0EF',\n      inputText: '#6B5552',\n      placeholderText: '#C08D8D',\n      btnActiveBg: '#C08D8D',\n      btnActiveText: '#F9F0EF',\n      // \n      failureText: '#9B7A7A',\n      failureBg: 'rgba(155, 122, 122, 0.12)',\n      warningText: '#A68A7A',\n      warningBg: 'rgba(166, 138, 122, 0.12)',\n      critSuccessText: '#8B7A7A',\n      critSuccessBg: 'rgba(139, 122, 122, 0.12)',\n      critFailureText: '#8B6F6F',\n      critFailureBg: 'rgba(139, 111, 111, 0.12)',\n      extremeSuccessText: '#9B8A8A',\n      extremeSuccessBg: 'rgba(155, 138, 138, 0.12)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(107, 85, 82, 0.3)',\n      lightBg: 'rgba(192, 141, 141, 0.08)',\n      veryLightBg: 'rgba(192, 141, 141, 0.02)',\n      buttonText: '#F9F0EF',\n      grayBg: 'rgba(192, 141, 141, 0.08)',\n      // \n      buttonBg: 'rgba(192, 141, 141, 0.4)',\n      buttonBgActive: 'rgba(192, 141, 141, 0.5)',\n      presetButtonBg: 'rgba(192, 141, 141, 0.2)',\n      presetButtonBgActive: 'rgba(192, 141, 141, 0.4)',\n      // /\n      errorText: '#9B7A7A',\n      errorBg: 'rgba(155, 122, 122, 0.12)',\n      errorBorder: 'rgba(155, 122, 122, 0.4)',\n      warningIcon: '#A68A7A',\n      buttonTextOnAccent: '#fff',\n    },\n    minepink: {\n      bgPanel: '#1a1a1a',\n      border: '#333333',\n      textMain: '#ffb3d9',\n      textSub: '#ff80c1',\n      btnBg: '#2a2a2a',\n      btnHover: '#3a3a3a',\n      accent: '#ff80c1',\n      tableHead: '#252525',\n      successText: '#ff80c1',\n      successBg: 'rgba(255, 128, 193, 0.2)',\n      inputBg: '#222222',\n      inputText: '#ffb3d9',\n      placeholderText: '#666666',\n      btnActiveBg: '#ff80c1',\n      btnActiveText: '#1a1a1a',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#ff80c1',\n      critSuccessBg: 'rgba(255, 128, 193, 0.2)',\n      critFailureText: '#ff4444',\n      critFailureBg: 'rgba(255, 68, 68, 0.2)',\n      extremeSuccessText: '#ffb3d9',\n      extremeSuccessBg: 'rgba(255, 179, 217, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255, 128, 193, 0.1)',\n      veryLightBg: 'rgba(255, 128, 193, 0.02)',\n      buttonText: '#1a1a1a',\n      grayBg: 'rgba(255, 128, 193, 0.1)',\n      // \n      buttonBg: 'rgba(255, 128, 193, 0.7)',\n      buttonBgActive: 'rgba(255, 128, 193, 0.8)',\n      presetButtonBg: 'rgba(255, 128, 193, 0.2)',\n      presetButtonBgActive: 'rgba(255, 128, 193, 0.4)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#000',\n    },\n    purple: {\n      bgPanel: '#f3e5f5',\n      border: '#ce93d8',\n      textMain: '#6a1b9a',\n      textSub: '#9c27b0',\n      btnBg: '#e1bee7',\n      btnHover: '#ce93d8',\n      accent: '#9c27b0',\n      tableHead: '#f8e1f5',\n      successText: '#6a1b9a',\n      successBg: 'rgba(106, 27, 154, 0.15)',\n      inputBg: '#fce4ec',\n      inputText: '#6a1b9a',\n      placeholderText: '#ba68c8',\n      btnActiveBg: '#9c27b0',\n      btnActiveText: '#fff',\n      // \n      failureText: '#d32f2f',\n      failureBg: 'rgba(211, 47, 47, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#6a1b9a',\n      extremeSuccessBg: 'rgba(106, 27, 154, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(156, 39, 176, 0.1)',\n      veryLightBg: 'rgba(156, 39, 176, 0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(156, 39, 176, 0.1)',\n      // \n      buttonBg: 'rgba(156, 39, 176, 0.6)',\n      buttonBgActive: 'rgba(156, 39, 176, 0.7)',\n      presetButtonBg: 'rgba(156, 39, 176, 0.3)',\n      presetButtonBgActive: 'rgba(156, 39, 176, 0.6)',\n      // /\n      errorText: '#d32f2f',\n      errorBg: 'rgba(211, 47, 47, 0.15)',\n      errorBorder: 'rgba(211, 47, 47, 0.5)',\n      warningIcon: '#f57c00',\n      buttonTextOnAccent: '#fff',\n    },\n    wechat: {\n      bgPanel: '#F7F7F7',\n      border: '#E5E5E5',\n      textMain: '#333333',\n      textSub: '#666666',\n      btnBg: '#E5E5E5',\n      btnHover: '#D5D5D5',\n      accent: '#09B83E',\n      tableHead: '#F0F0F0',\n      successText: '#09B83E',\n      successBg: 'rgba(9, 184, 62, 0.12)',\n      inputBg: '#FFFFFF',\n      inputText: '#333333',\n      placeholderText: '#999999',\n      btnActiveBg: '#09B83E',\n      btnActiveText: '#FFFFFF',\n      // \n      failureText: '#E53E3E',\n      failureBg: 'rgba(229, 62, 62, 0.12)',\n      warningText: '#FF9500',\n      warningBg: 'rgba(255, 149, 0, 0.12)',\n      critSuccessText: '#07A832',\n      critSuccessBg: 'rgba(7, 168, 50, 0.15)',\n      critFailureText: '#C53030',\n      critFailureBg: 'rgba(197, 48, 48, 0.15)',\n      extremeSuccessText: '#09B83E',\n      extremeSuccessBg: 'rgba(9, 184, 62, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.2)',\n      lightBg: 'rgba(9, 184, 62, 0.08)',\n      veryLightBg: 'rgba(9, 184, 62, 0.02)',\n      buttonText: '#FFFFFF',\n      grayBg: 'rgba(9, 184, 62, 0.08)',\n      // \n      buttonBg: 'rgba(9, 184, 62, 0.7)',\n      buttonBgActive: 'rgba(9, 184, 62, 0.85)',\n      presetButtonBg: 'rgba(9, 184, 62, 0.3)',\n      presetButtonBgActive: 'rgba(9, 184, 62, 0.6)',\n      // /\n      errorText: '#E53E3E',\n      errorBg: 'rgba(229, 62, 62, 0.12)',\n      errorBorder: 'rgba(229, 62, 62, 0.5)',\n      warningIcon: '#FF9500',\n      buttonTextOnAccent: '#fff',\n    },\n    educational: {\n      bgPanel: '#000000',\n      border: '#1B1B1B',\n      textMain: '#FFFFFF',\n      textSub: '#CCCCCC',\n      btnBg: '#1B1B1B',\n      btnHover: '#2B2B2B',\n      accent: '#FF9900',\n      tableHead: '#1B1B1B',\n      successText: '#FF9900',\n      successBg: 'rgba(255, 153, 0, 0.15)',\n      inputBg: '#1B1B1B',\n      inputText: '#FFFFFF',\n      placeholderText: '#666666',\n      btnActiveBg: '#FF9900',\n      btnActiveText: '#000000',\n      // \n      failureText: '#FF6B6B',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#FFAA00',\n      warningBg: 'rgba(255, 170, 0, 0.2)',\n      critSuccessText: '#FF9900',\n      critSuccessBg: 'rgba(255, 153, 0, 0.2)',\n      critFailureText: '#FF4444',\n      critFailureBg: 'rgba(255, 68, 68, 0.2)',\n      extremeSuccessText: '#FFB84D',\n      extremeSuccessBg: 'rgba(255, 184, 77, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255, 153, 0, 0.1)',\n      veryLightBg: 'rgba(255, 153, 0, 0.02)',\n      buttonText: '#FFFFFF',\n      grayBg: 'rgba(255, 255, 255, 0.1)',\n      // \n      buttonBg: 'rgba(255, 153, 0, 0.7)',\n      buttonBgActive: 'rgba(255, 153, 0, 0.85)',\n      presetButtonBg: 'rgba(255, 153, 0, 0.3)',\n      presetButtonBgActive: 'rgba(255, 153, 0, 0.6)',\n      // /\n      errorText: '#FF6B6B',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#FFAA00',\n      buttonTextOnAccent: '#000000',\n    },\n    galgame: {\n      bgPanel: '#FFF0F5',\n      border: '#F0D4E4',\n      textMain: '#6B4A5A',\n      textSub: '#B08A9A',\n      btnBg: '#FFE4E9',\n      btnHover: '#FFD4E4',\n      accent: '#E8B4D9',\n      tableHead: '#FFF5F9',\n      successText: '#D4A5C8',\n      successBg: 'rgba(212, 165, 200, 0.15)',\n      inputBg: '#FFF8FA',\n      inputText: '#6B4A5A',\n      placeholderText: '#C8A5B0',\n      btnActiveBg: '#E8B4D9',\n      btnActiveText: '#6B4A5A',\n      // \n      failureText: '#C88A9A',\n      failureBg: 'rgba(200, 138, 154, 0.15)',\n      warningText: '#D4A5A5',\n      warningBg: 'rgba(212, 165, 165, 0.15)',\n      critSuccessText: '#E8B4D9',\n      critSuccessBg: 'rgba(232, 180, 217, 0.2)',\n      critFailureText: '#C88A9A',\n      critFailureBg: 'rgba(200, 138, 154, 0.2)',\n      extremeSuccessText: '#D4A5C8',\n      extremeSuccessBg: 'rgba(212, 165, 200, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(232, 180, 217, 0.25)',\n      lightBg: 'rgba(232, 180, 217, 0.08)',\n      veryLightBg: 'rgba(232, 180, 217, 0.02)',\n      buttonText: '#6B4A5A',\n      grayBg: 'rgba(232, 180, 217, 0.1)',\n      // \n      buttonBg: 'rgba(232, 180, 217, 0.6)',\n      buttonBgActive: 'rgba(232, 180, 217, 0.75)',\n      presetButtonBg: 'rgba(232, 180, 217, 0.3)',\n      presetButtonBgActive: 'rgba(232, 180, 217, 0.6)',\n      // /\n      errorText: '#C88A9A',\n      errorBg: 'rgba(200, 138, 154, 0.15)',\n      errorBorder: 'rgba(200, 138, 154, 0.4)',\n      warningIcon: '#D4A5A5',\n      buttonTextOnAccent: '#6B4A5A',\n    },\n    vaporwave: {\n      bgPanel: '#191970',\n      border: 'rgba(0, 255, 255, 0.3)',\n      textMain: '#00FFFF',\n      textSub: '#FF00FF',\n      btnBg: 'rgba(25, 25, 112, 0.8)',\n      btnHover: 'rgba(0, 255, 255, 0.2)',\n      accent: '#00FFFF',\n      tableHead: 'rgba(25, 25, 112, 0.9)',\n      successText: '#00FFFF',\n      successBg: 'rgba(0, 255, 255, 0.15)',\n      inputBg: 'rgba(25, 25, 112, 0.6)',\n      inputText: '#00FFFF',\n      placeholderText: '#FF00FF',\n      btnActiveBg: '#FF00FF',\n      btnActiveText: '#F0F8FF',\n      // \n      failureText: '#FF00FF',\n      failureBg: 'rgba(255, 0, 255, 0.2)',\n      warningText: '#FF00FF',\n      warningBg: 'rgba(255, 0, 255, 0.15)',\n      critSuccessText: '#00FFFF',\n      critSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      critFailureText: '#FF00FF',\n      critFailureBg: 'rgba(255, 0, 255, 0.25)',\n      extremeSuccessText: '#00FFFF',\n      extremeSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(25, 25, 112, 0.85)',\n      overlayBgLight: 'rgba(25, 25, 112, 0.75)',\n      shadowBg: 'rgba(0, 255, 255, 0.3)',\n      lightBg: 'rgba(0, 255, 255, 0.05)',\n      veryLightBg: 'rgba(0, 255, 255, 0.02)',\n      buttonText: '#F0F8FF',\n      grayBg: 'rgba(0, 255, 255, 0.1)',\n      // \n      buttonBg: 'rgba(0, 255, 255, 0.6)',\n      buttonBgActive: 'rgba(255, 0, 255, 0.7)',\n      presetButtonBg: 'rgba(0, 255, 255, 0.3)',\n      presetButtonBgActive: 'rgba(0, 255, 255, 0.6)',\n      // /\n      errorText: '#FF00FF',\n      errorBg: 'rgba(255, 0, 255, 0.2)',\n      errorBorder: 'rgba(255, 0, 255, 0.5)',\n      warningIcon: '#FF00FF',\n      buttonTextOnAccent: '#191970',\n    },\n    classicpackaging: {\n      bgPanel: '#000000',\n      border: '#FFFF00',\n      textMain: '#FFFF00',\n      textSub: '#CCCC00',\n      btnBg: '#FF0000',\n      btnHover: '#CC0000',\n      accent: '#FF0000',\n      tableHead: '#1a1a1a',\n      successText: '#0000FF',\n      successBg: 'rgba(0, 0, 255, 0.2)',\n      inputBg: '#1a1a1a',\n      inputText: '#FFFF00',\n      placeholderText: '#666600',\n      btnActiveBg: '#0000FF',\n      btnActiveText: '#FFFF00',\n      // \n      failureText: '#FF0000',\n      failureBg: 'rgba(255, 0, 0, 0.2)',\n      warningText: '#FF0000',\n      warningBg: 'rgba(255, 0, 0, 0.15)',\n      critSuccessText: '#0000FF',\n      critSuccessBg: 'rgba(0, 0, 255, 0.2)',\n      critFailureText: '#FF0000',\n      critFailureBg: 'rgba(255, 0, 0, 0.25)',\n      extremeSuccessText: '#0000FF',\n      extremeSuccessBg: 'rgba(0, 0, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0, 0, 0, 0.9)',\n      overlayBgLight: 'rgba(0, 0, 0, 0.8)',\n      shadowBg: 'rgba(0, 0, 0, 0.6)',\n      lightBg: 'rgba(255, 255, 0, 0.1)',\n      veryLightBg: 'rgba(255, 255, 0, 0.02)',\n      buttonText: '#FFFF00',\n      grayBg: 'rgba(255, 255, 0, 0.1)',\n      // \n      buttonBg: '#FF0000',\n      buttonBgActive: '#CC0000',\n      presetButtonBg: 'rgba(255, 0, 0, 0.7)',\n      presetButtonBgActive: '#FF0000',\n      // /\n      errorText: '#FF0000',\n      errorBg: 'rgba(255, 0, 0, 0.2)',\n      errorBorder: 'rgba(255, 0, 0, 0.8)',\n      warningIcon: '#FF0000',\n      buttonTextOnAccent: '#FFFF00',\n    },\n    terminal: {\n      bgPanel: '#0c0c0c',\n      border: '#00ff00',\n      textMain: '#00ff00',\n      textSub: '#00cc00',\n      btnBg: '#1a1a1a',\n      btnHover: '#2a2a2a',\n      accent: '#00ff00',\n      tableHead: '#0a0a0a',\n      successText: '#00ff00',\n      successBg: 'rgba(0, 255, 0, 0.15)',\n      inputBg: '#0c0c0c',\n      inputText: '#00ff00',\n      placeholderText: '#008800',\n      btnActiveBg: '#00ff00',\n      btnActiveText: '#0c0c0c',\n      failureText: '#ff0000',\n      failureBg: 'rgba(255, 0, 0, 0.15)',\n      warningText: '#ffff00',\n      warningBg: 'rgba(255, 255, 0, 0.15)',\n      critSuccessText: '#00ffff',\n      critSuccessBg: 'rgba(0, 255, 255, 0.15)',\n      critFailureText: '#ff00ff',\n      critFailureBg: 'rgba(255, 0, 255, 0.15)',\n      extremeSuccessText: '#00ff00',\n      extremeSuccessBg: 'rgba(0, 255, 0, 0.2)',\n      overlayBg: 'rgba(0, 0, 0, 0.9)',\n      overlayBgLight: 'rgba(0, 0, 0, 0.8)',\n      shadowBg: 'rgba(0, 0, 0, 0.7)',\n      lightBg: 'rgba(0, 255, 0, 0.05)',\n      veryLightBg: 'rgba(0, 255, 0, 0.02)',\n      buttonText: '#0c0c0c',\n      grayBg: 'rgba(0, 255, 0, 0.05)',\n      errorText: '#ff0000',\n      errorBg: 'rgba(255, 0, 0, 0.15)',\n      errorBorder: 'rgba(255, 0, 0, 0.5)',\n      warningIcon: '#ffff00',\n      buttonTextOnAccent: '#0c0c0c',\n    },\n    dreamcore: {\n      // 90VHS\n      bgPanel: '#F4F1EA',\n      border: '#D6D2C4',\n      textMain: '#5C5869',\n      textSub: '#9490A0',\n      btnBg: '#E6E1D5',\n      btnHover: '#DBD8CC',\n      accent: '#8A9AC6',\n      tableHead: '#EBE7DE',\n      successText: '#4A7A68',\n      successBg: 'rgba(74, 122, 104, 0.18)',\n      inputBg: '#FFFFFF',\n      inputText: '#4A4652',\n      placeholderText: '#B0ACC0',\n      btnActiveBg: '#8A9AC6',\n      btnActiveText: '#FFFFFF',\n      // \n      failureText: '#8F5E5E',\n      failureBg: 'rgba(143, 94, 94, 0.18)',\n      warningText: '#8A7040',\n      warningBg: 'rgba(138, 112, 64, 0.18)',\n      critSuccessText: '#2D6E58',\n      critSuccessBg: 'rgba(45, 110, 88, 0.25)',\n      critFailureText: '#7A3E3E',\n      critFailureBg: 'rgba(122, 62, 62, 0.25)',\n      extremeSuccessText: '#5C5228',\n      extremeSuccessBg: 'rgba(92, 82, 40, 0.2)',\n      // UI\n      overlayBg: 'rgba(244, 241, 234, 0.85)',\n      overlayBgLight: 'rgba(255, 255, 255, 0.4)',\n      shadowBg: 'rgba(92, 88, 105, 0.15)',\n      lightBg: 'rgba(138, 154, 198, 0.08)',\n      veryLightBg: 'rgba(138, 154, 198, 0.03)',\n      buttonText: '#5C5869',\n      grayBg: 'rgba(92, 88, 105, 0.08)',\n      // \n      buttonBg: 'rgba(138, 154, 198, 0.4)',\n      buttonBgActive: 'rgba(138, 154, 198, 0.6)',\n      presetButtonBg: 'rgba(138, 154, 198, 0.2)',\n      presetButtonBgActive: 'rgba(138, 154, 198, 0.45)',\n      // /\n      errorText: '#B85C5C',\n      errorBg: 'rgba(184, 92, 92, 0.15)',\n      errorBorder: 'rgba(184, 92, 92, 0.4)',\n      warningIcon: '#E0C080',\n      buttonTextOnAccent: '#FFFFFF',\n    },\n    //  (Chouten) - \n    // VTuber +  + \n    chouten: {\n      bgPanel: '#1A0A2E', // \n      border: '#FF6B9D', // \n      textMain: '#FFE4F0', // \n      textSub: '#B388FF', // \n      btnBg: 'rgba(255, 107, 157, 0.25)', // \n      btnHover: 'rgba(255, 107, 157, 0.4)', // \n      accent: '#7FFFD4', // \n      tableHead: 'rgba(45, 27, 78, 0.95)', // \n      successText: '#7FFFD4', // \n      successBg: 'rgba(127, 255, 212, 0.2)',\n      inputBg: 'rgba(26, 10, 46, 0.9)', // \n      inputText: '#FFE4F0',\n      placeholderText: '#9370DB', // \n      btnActiveBg: '#FF6B9D', // \n      btnActiveText: '#1A0A2E', // \n      // \n      failureText: '#FF6B6B', // \n      failureBg: 'rgba(255, 107, 107, 0.25)',\n      warningText: '#FFD93D', // \n      warningBg: 'rgba(255, 217, 61, 0.2)',\n      critSuccessText: '#00FFAB', // \n      critSuccessBg: 'rgba(0, 255, 171, 0.25)',\n      critFailureText: '#FF4757', // \n      critFailureBg: 'rgba(255, 71, 87, 0.25)',\n      extremeSuccessText: '#00D9FF', // \n      extremeSuccessBg: 'rgba(0, 217, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(26, 10, 46, 0.92)',\n      overlayBgLight: 'rgba(45, 27, 78, 0.85)',\n      shadowBg: 'rgba(255, 107, 157, 0.3)', // \n      lightBg: 'rgba(255, 107, 157, 0.08)',\n      veryLightBg: 'rgba(179, 136, 255, 0.05)',\n      buttonText: '#1A0A2E',\n      grayBg: 'rgba(179, 136, 255, 0.15)',\n      // \n      buttonBg: 'rgba(255, 107, 157, 0.6)',\n      buttonBgActive: 'rgba(255, 107, 157, 0.8)',\n      presetButtonBg: 'rgba(127, 255, 212, 0.2)',\n      presetButtonBgActive: 'rgba(127, 255, 212, 0.45)',\n      // /\n      errorText: '#FF6B6B',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#FFD93D',\n      buttonTextOnAccent: '#1A0A2E',\n    },\n  };\n  const getThemeColors = () => {\n    const theme = THEME_COLORS[getConfig().theme] || THEME_COLORS['retro'];\n    // \n    if (!theme.buttonBg) {\n      theme.buttonBg = theme.accent;\n      theme.buttonBgActive = theme.accent;\n      theme.presetButtonBg = theme.btnBg;\n      theme.presetButtonBgActive = theme.accent;\n    }\n    // \n    if (!theme.buttonTextOnAccent) {\n      // \n      // \n      const isLightTheme =\n        theme.bgPanel &&\n        (theme.bgPanel.startsWith('#F') ||\n          theme.bgPanel.startsWith('#f') ||\n          theme.bgPanel.startsWith('#e') ||\n          theme.bgPanel.startsWith('#E') ||\n          theme.bgPanel.includes('255') ||\n          theme.bgPanel.includes('fff'));\n      theme.buttonTextOnAccent = isLightTheme ? theme.textMain || '#333' : '#fff';\n    }\n    return theme;\n  };\n  const getGMConfig = () => {\n    const baseConfig = Store.get(STORAGE_KEY_GM_CONFIG, DEFAULT_GM_CONFIG);\n\n    // \n    const activePresetId = ActionPresetManager.getActivePresetId();\n    if (activePresetId === '__none__') {\n      return {\n        ...baseConfig,\n        action_rules_disabled: true, // \n      };\n    }\n\n    // \n    const activePreset = ActionPresetManager.getActivePreset();\n    if (activePreset && activePreset.rules && activePreset.rules.length > 0) {\n      //  custom_action_groups \n      const customActionGroups = activePreset.rules.map(rule => ({\n        table_keywords: rule.table_keywords || [],\n        actions: (rule.actions || []).map(action => ({\n          label: action.label,\n          icon: action.icon || ACTION_ICON_MAP[action.label] || 'fa-circle',\n          type: 'prompt',\n          template: action.template || `<user>{Name}:${action.label}`,\n          auto_send: false,\n        })),\n      }));\n\n      return {\n        ...baseConfig,\n        custom_action_groups: customActionGroups,\n      };\n    }\n\n    return baseConfig;\n  };\n\n  // \n  const getResultBadgeStyle = (resultType, t) => {\n    // resultType: 'critSuccess' | 'extremeSuccess' | 'success' | 'warning' | 'failure' | 'critFailure'\n    const styles = {\n      critSuccess: {\n        bg: t.critSuccessText,\n        text: '#fff',\n      },\n      extremeSuccess: {\n        bg: t.extremeSuccessText,\n        text: '#fff',\n      },\n      success: {\n        bg: t.successText,\n        text: '#fff',\n      },\n      warning: {\n        bg: t.warningText,\n        text: '#fff',\n      },\n      failure: {\n        bg: t.failureText,\n        text: '#fff',\n      },\n      critFailure: {\n        bg: t.critFailureText,\n        text: '#fff',\n      },\n    };\n    const style = styles[resultType] || styles.failure;\n    return {\n      'background-color': style.bg,\n      color: style.text,\n      padding: '3px 8px',\n      'border-radius': '6px',\n      'font-size': '11px',\n      'font-weight': 'bold',\n      'white-space': 'nowrap',\n      display: 'inline-flex',\n      'align-items': 'center',\n    };\n  };\n\n  // [] \n  const ACTION_ICON_MAP: Record<string, string> = {\n    // \n    : 'fa-hand-fist',\n    : 'fa-hand-fist',\n    : 'fa-shield',\n    : 'fa-person-running',\n    // \n    : 'fa-comments',\n    : 'fa-comments',\n    : 'fa-hand',\n    : 'fa-heart',\n    : 'fa-calendar-check',\n    : 'fa-gift',\n    : 'fa-gift',\n    // \n    : 'fa-eye',\n    : 'fa-eye',\n    : 'fa-magnifying-glass',\n    // \n    : 'fa-hand-pointer',\n    : 'fa-trash',\n    : 'fa-shield-halved',\n    : 'fa-circle-xmark',\n    : 'fa-coins',\n    : 'fa-shopping-cart',\n    // \n    : 'fa-walking',\n    : 'fa-search',\n    : 'fa-clock',\n    : 'fa-door-open',\n    // \n    : 'fa-dumbbell',\n    : 'fa-wand-magic-sparkles',\n    : 'fa-fire',\n    // \n    : 'fa-crosshairs',\n    : 'fa-list-check',\n    : 'fa-circle-xmark',\n    : 'fa-check',\n    // \n    : 'fa-ear-listen',\n    : 'fa-user-plus',\n    : 'fa-handshake',\n    // \n    : 'fa-music',\n    : 'fa-guitar',\n    : 'fa-microphone',\n  };\n\n  /**\n   * \n   *\n   * []  > \n   *  config.custom_action_groups \n   * \"\"\"\"\"\"\n   *\n   * @param tableName \n   * @returns \n   */\n  const getActionsForTable = (tableName: string) => {\n    const config = getGMConfig();\n    if (!config.enabled) return [];\n\n    // \n    if ((config as any).action_rules_disabled) return [];\n\n    const lowerName = tableName.toLowerCase();\n\n    // [] \n    const customRules = (config as any).custom_action_groups || [];\n    for (const group of customRules) {\n      const matched = group.table_keywords.some((keyword: string) => lowerName.includes(keyword.toLowerCase()));\n      if (matched) return [...(group.actions || [])]; // \n    }\n\n    // \n    const builtinRules = config.action_groups || [];\n    for (const group of builtinRules) {\n      const matched = group.table_keywords.some((keyword: string) => lowerName.includes(keyword.toLowerCase()));\n      if (matched) return [...(group.actions || [])]; // \n    }\n\n    return [];\n  };\n\n  /**\n   * \n   *  + AI\n   *\n   * @param tableName \n   * @param headers \n   * @param rowData \n   * @returns \n   */\n  const getInteractOptionsForRow = (tableName: string, headers: any[], rowData: any[]) => {\n    // 1. \n    const defaultActions = [...getActionsForTable(tableName)];\n\n    // 2. \"\"\n    const interactColIdx = headers.findIndex(h => h && String(h).includes(''));\n    if (interactColIdx < 0 || !rowData[interactColIdx]) {\n      return defaultActions;\n    }\n\n    // 3. \n    const invalidValues = ['-', 'null', 'none', '', '', 'n/a', 'undefined', '/'];\n    const cellValue = String(rowData[interactColIdx]).trim();\n    if (!cellValue || invalidValues.includes(cellValue.toLowerCase())) {\n      return defaultActions;\n    }\n\n    // 4. \n    const interactOptions = cellValue\n      .split(/[,;]/)\n      .map(s => s.trim())\n      .filter(s => s && !invalidValues.includes(s.toLowerCase()));\n\n    if (interactOptions.length === 0) {\n      return defaultActions;\n    }\n\n    // 5. \n    const existingLabels = defaultActions.map(a => a.label.toLowerCase());\n\n    // 6. \n    const newActions = interactOptions\n      .filter(opt => !existingLabels.includes(opt.toLowerCase()))\n      .map(opt => ({\n        label: opt,\n        icon: ACTION_ICON_MAP[opt] || 'fa-hand-pointer',\n        type: 'prompt',\n        template: `<user>{Name}:${opt}`,\n        auto_send: true,\n      }));\n\n    // 7.  + \n    return [...defaultActions, ...newActions];\n  };\n\n  const isNumericCell = value => {\n    if (value === null || value === undefined || value === '') return false;\n    const str = String(value).trim();\n    // : (50/100)/: \n    return (\n      /^-?\\d+(\\.\\d+)?%?$/.test(str) ||\n      /^\\d+\\/\\d+$/.test(str) ||\n      /^[\\u4e00-\\u9fa5a-zA-Z]+[:\\s]\\s*\\d+/i.test(str) ||\n      /\\d+/.test(str)\n    );\n  };\n\n  const extractNumericValue = value => {\n    if (!value) return 0;\n    const str = String(value).trim();\n    //  (50/100 -> )\n    if (/^\\d+\\/\\d+$/.test(str)) return parseInt(str.split('/')[0], 10);\n    // \n    if (str.endsWith('%')) return parseInt(str.replace('%', ''), 10);\n    //  \":\" \n    const matches = str.match(/\\d+/g);\n    if (matches && matches.length > 0) {\n      return parseInt(matches[matches.length - 1], 10);\n    }\n    return 0;\n  };\n\n  const parseAttributeString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    //  JSON  {\"\":, ...}\n    if (rawStr.startsWith('{') && rawStr.endsWith('}')) {\n      try {\n        const jsonObj = JSON.parse(rawStr);\n        for (const key in jsonObj) {\n          const val = jsonObj[key];\n          if (typeof val === 'number') {\n            results.push({ name: key, value: val });\n          } else if (typeof val === 'string' && /^\\d+$/.test(val)) {\n            results.push({ name: key, value: parseInt(val, 10) });\n          }\n        }\n        if (results.length > 0) return results;\n      } catch (e) {\n        // JSON \n      }\n    }\n\n    //  \":; :\" \n    const parts = rawStr.split(/[,;\\s]+/);\n    for (const part of parts) {\n      const match = part.match(/^\"?([\\u4e00-\\u9fa5a-zA-Z_]+)\"?[:\\s]\\s*\"?(-?\\d+)\"?/);\n      if (match) {\n        results.push({ name: match[1], value: parseInt(match[2], 10) });\n      }\n    }\n    return results;\n  };\n  // [] :\n  // 1: \"();()\"\n  // 2: \":;:\"\n  // 3: \":,;:\"\n  const parseRelationshipString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    // \n    const parts = rawStr.split(/[;]/);\n    for (const part of parts) {\n      const trimmed = part.trim();\n      if (!trimmed) continue;\n\n      // 2/3: \":\"  \"\"\n      const colonMatch = trimmed.match(/^?(.+?)[:\\](.+)$/);\n      if (colonMatch) {\n        const name = colonMatch[1].trim();\n        const relation = colonMatch[2].trim();\n        if (name && relation) {\n          results.push({ name: name, relation: relation });\n          continue;\n        }\n      }\n\n      // 1: \"()\"  \"\"\n      const parenMatch = trimmed.match(/^([^(]+)[(]([^)]+)[)]$/);\n      if (parenMatch) {\n        results.push({ name: parenMatch[1].trim(), relation: parenMatch[2].trim() });\n        continue;\n      }\n\n      // \n      if (trimmed.length > 0) {\n        results.push({ name: trimmed, relation: '' });\n      }\n    }\n    return results;\n  };\n\n  // [] \n  const isRelationshipCell = (value, headerName) => {\n    if (!value) return false;\n    const str = String(value).trim();\n    const lowerHeader = (headerName || '').toLowerCase();\n    // \"\"\n    if (lowerHeader.includes('') || lowerHeader.includes('')) {\n      return true;\n    }\n    //  \"();()\" \n    return /^[^(;]+[(][^)]+[)]([;][^(;]+[(][^)]+[)])*$/.test(str);\n  };\n\n  const processTemplate = (template, cardData, headers) => {\n    if (!template || !cardData) return template;\n    let result = template;\n    const name = cardData[1] || '';\n    result = result.replace(/\\{Name\\}/gi, name);\n    result = result.replace(/\\{RowIndex\\}/gi, cardData[0] || '0');\n    if (headers && headers.length > 0) {\n      headers.forEach((header, idx) => {\n        if (header && idx < cardData.length) {\n          const value = cardData[idx] || '';\n          const regex = new RegExp(`\\\\{${header}\\\\}`, 'gi');\n          result = result.replace(regex, value);\n        }\n      });\n    }\n    result = result.replace(/\\{[^}]+\\}/g, '');\n    return result;\n  };\n\n  // \n  const ACTION_BUTTONS = [\n    { id: 'acu-btn-save-global', icon: 'fa-save', title: '' },\n    { id: 'acu-btn-refresh', icon: 'fa-sync-alt', title: '' },\n    { id: 'acu-btn-collapse', icon: 'fa-chevron-down', title: '' },\n    // {id: 'acu-btn-open-editor', icon: 'fa-table-columns', title: ''},\n    { id: 'acu-btn-refill', icon: 'fa-bolt', title: '' },\n    { id: 'acu-btn-settings', icon: 'fa-cog', title: '' },\n  ];\n\n  let isInitialized = false;\n  let isSaving = false;\n  let isEditingOrder = false;\n  let isSettingsOpen = false;\n  let currentDiffMap = new Set();\n  let observer = null;\n  let _boundRenderHandler = null;\n\n  // ---  ---\n  let cachedRawData = null;\n  let hasUnsavedChanges = false;\n  let isAutoTransforming = false; // \n  let tablePageStates = {};\n  let tableSearchStates = {};\n  let lastOptionHash = null;\n  let optionPanelVisible = false; // [] \n  // [] \n  const STORAGE_KEY_SCROLL = 'acu_scroll_v19_fixed';\n  let tableScrollStates = {};\n  try {\n    const saved = localStorage.getItem(STORAGE_KEY_SCROLL);\n    if (saved) tableScrollStates = JSON.parse(saved);\n  } catch (e) {\n    console.warn('[DICE]ACU Error:', e);\n  }\n  // [] \n  const UpdateController = {\n    _lastValidationCount: 0,\n    _isRollingBack: false, // \n\n    handleUpdate: () => {\n      // \n      if (UpdateController._isRollingBack) return;\n\n      // ===  intercept  ===\n      try {\n        const snapshot = loadSnapshot();\n        const newData = getTableData();\n        if (snapshot && newData) {\n          const rules = ValidationRuleManager.getEnabledRules();\n          const violations = ValidationEngine.checkTableRules(snapshot, newData, rules);\n\n          if (violations.length > 0) {\n            console.warn('[DICE]ACU :', violations);\n            UpdateController._isRollingBack = true;\n\n            //  API \n            const api = getCore().getDB();\n            if (api?.fillTable) {\n              try {\n                api.fillTable(snapshot);\n                if (window.toastr) {\n                  window.toastr.error(violations[0].message, '', {\n                    timeOut: 5000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              } catch (fillError) {\n                console.error('[DICE]ACU fillTable :', fillError);\n                // \n                if (window.toastr) {\n                  window.toastr.error(`: ${violations[0].message}`, '', {\n                    timeOut: 7000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              }\n            }\n\n            setTimeout(() => {\n              UpdateController._isRollingBack = false;\n            }, 500);\n            return;\n          }\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n      }\n\n      //  renderInterface \n      // \n      renderInterface();\n\n      // \n      setTimeout(() => {\n        try {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            const errors = ValidationEngine.validateAllData(rawData);\n            const newCount = errors.length;\n\n            // \n            if (newCount > UpdateController._lastValidationCount && newCount > 0) {\n              // \n            }\n\n            UpdateController._lastValidationCount = newCount;\n\n            // \n            updateValidationIndicator(newCount);\n          }\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n        }\n      }, 100);\n    },\n  };\n\n  // \n  const updateValidationIndicator = count => {\n    const { $ } = getCore();\n    const $indicator = $('.acu-validation-indicator');\n\n    if (count > 0) {\n      if ($indicator.length) {\n        $indicator.find('.acu-validation-count').text(count);\n        $indicator.show();\n      }\n    } else {\n      $indicator.hide();\n    }\n  };\n\n  // --- []  ---\n  const getCurrentContextFingerprint = () => {\n    try {\n      // 1:  API\n      if (typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId) {\n        return SillyTavern.getCurrentChatId();\n      }\n      // 2: \n      if (typeof SillyTavern !== 'undefined' && SillyTavern.chatId) {\n        return SillyTavern.chatId;\n      }\n      // 3:  (iframe )\n      if (window.parent?.SillyTavern?.getCurrentChatId) {\n        return window.parent.SillyTavern.getCurrentChatId();\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getCurrentContextFingerprint error:', e);\n    }\n    return 'unknown_context';\n  };\n\n  //  ()\n\n  const DEFAULT_CONFIG = {\n    layout: 'horizontal',\n    collapseStyle: 'bar',\n    collapseAlign: 'right',\n    fontFamily: 'default',\n    theme: 'retro',\n    cardWidth: 260,\n    fontSize: 13,\n    highlightNew: true,\n    itemsPerPage: 50,\n    actionsPosition: 'bottom',\n    gridColumns: 'auto', // [] \n    positionMode: 'fixed', // fixed=, embedded=\n    showOptionPanel: true, // [] \n    clickOptionToAutoSend: true, // [] \n    optionFontSize: 12, // [] \n  };\n\n  const FONTS = [\n    { id: 'default', name: ' (Modern)', val: `'Segoe UI', 'Microsoft YaHei', sans-serif` },\n    { id: 'hanchan', name: '', val: `\"\", sans-serif` },\n    { id: 'maple', name: 'Maple Mono ()', val: `\"Maple Mono NF CN\", monospace` },\n    { id: 'huiwen', name: ' (Huiwen)', val: `\"Huiwen-mincho\", serif` },\n    { id: 'cooper', name: 'Cooper', val: `\"CooperZhengKai\", serif` },\n    { id: 'yffyt', name: 'YFFYT ()', val: `\"YFFYT\", sans-serif` },\n    { id: 'fusion', name: 'Fusion Pixel ()', val: `\"Fusion Pixel 12px M latin\", monospace` },\n    { id: 'wenkai', name: ' (WenKai)', val: `\"LXGW WenKai\", serif` },\n    { id: 'notosans', name: ' (Noto Sans)', val: `\"Noto Sans CJK\", sans-serif` },\n    { id: 'zhuque', name: ' (Zhuque)', val: `\"Zhuque Fangsong (technical preview)\", serif` },\n  ];\n\n  const THEMES = [\n    { id: 'retro', name: ' (Retro)', icon: 'fa-scroll' },\n    { id: 'dark', name: ' (Dark)', icon: 'fa-moon' },\n    { id: 'modern', name: ' (Modern)', icon: 'fa-sun' },\n    { id: 'forest', name: ' (Forest)', icon: 'fa-tree' },\n    { id: 'ocean', name: ' (Ocean)', icon: 'fa-water' },\n    { id: 'cyber', name: ' (Cyber)', icon: 'fa-bolt' },\n    { id: 'nightowl', name: ' (Night Owl)', icon: 'fa-feather' },\n    { id: 'sakura', name: ' (Warm Pink)', icon: 'fa-heart' },\n    { id: 'minepink', name: ' (Mine Pink)', icon: 'fa-skull' },\n    { id: 'galgame', name: ' (Galgame Pink)', icon: 'fa-heart' },\n    { id: 'purple', name: ' (Purple)', icon: 'fa-gem' },\n    { id: 'wechat', name: ' (Green Bubble)', icon: 'fa-weixin' },\n    { id: 'educational', name: ' (Educational)', icon: 'fa-book' },\n    { id: 'vaporwave', name: ' (Vaporwave)', icon: 'fa-palette' },\n    { id: 'classicpackaging', name: ' (Classic Packaging)', icon: 'fa-box' },\n    { id: 'terminal', name: ' (Terminal)', icon: 'fa-terminal' },\n    { id: 'dreamcore', name: ' (Dreamcore)', icon: 'fa-cloud-moon' },\n    { id: 'chouten', name: ' (Cyber Kawaii)', icon: 'fa-star' },\n  ];\n\n  // []  core  ( +  ST )\n  let _coreCache = null;\n  const getCore = () => {\n    const w = window.parent || window;\n    //  jQuery\n    const $ = window.jQuery || w.jQuery;\n\n    // ($)\n    if (_coreCache && _coreCache.$) return _coreCache;\n\n    const core = {\n      $: $,\n      getDB: () => w.AutoCardUpdaterAPI || window.AutoCardUpdaterAPI,\n      clipboard: w.navigator.clipboard,\n      //   ->  ->  ()\n      ST:\n        window.SillyTavern ||\n        w.SillyTavern ||\n        (() => {\n          try {\n            return window.top ? window.top.SillyTavern : null;\n          } catch (e) {\n            return null;\n          }\n        })(),\n    };\n\n    //  jQuery \n    if ($) _coreCache = core;\n    return core;\n  };\n\n  const updateSaveButtonState = () => {\n    const { $ } = getCore();\n    const $btn = $('#acu-btn-save-global');\n    const $icon = $btn.find('i');\n    const deletions = getPendingDeletions();\n    let hasDeletions = false;\n    if (deletions) {\n      for (const key in deletions) {\n        if (deletions[key] && deletions[key].length > 0) {\n          hasDeletions = true;\n          break;\n        }\n      }\n    }\n    if (hasUnsavedChanges || hasDeletions) {\n      $icon.addClass('acu-icon-breathe');\n      $btn.attr('title', '');\n    } else {\n      $icon.removeClass('acu-icon-breathe');\n      $btn.attr('title', '');\n      $btn.css('color', '');\n    }\n  };\n\n  const getIconForTableName = name => {\n    if (!name) return 'fa-table';\n    const n = name.toLowerCase();\n    if (n.includes('') || n.includes('')) return 'fa-user-circle';\n    if (n.includes('') || n.includes('')) return 'fa-globe-asia';\n    if (n.includes('') || n.includes('')) return 'fa-briefcase';\n    if (n.includes('') || n.includes('')) return 'fa-dragon';\n    if (n.includes('') || n.includes('')) return 'fa-user-friends';\n    if (n.includes('') || n.includes('')) return 'fa-scroll';\n    if (n.includes('') || n.includes('')) return 'fa-address-book';\n    if (n.includes('') || n.includes('')) return 'fa-book-reader';\n    if (n.includes('') || n.includes('')) return 'fa-map-location-dot';\n    if (n.includes('') || n.includes('') || n.includes('')) return 'fa-bullseye';\n    if (n.includes('') || n.includes('')) return 'fa-shield-halved';\n    if (n.includes('')) return 'fa-gem';\n    if (n.includes('') || n.includes('')) return 'fa-file-lines';\n    if (n.includes('')) return 'fa-list-check';\n    return 'fa-table';\n  };\n\n  const getBadgeStyle = text => {\n    if (!text) return '';\n    const str = String(text).trim();\n    if (/^[0-9]+%?$/.test(str) || /^Lv\\.\\d+$/.test(str)) return 'acu-badge-green';\n    if (str.length <= 6 && !str.includes('http')) return 'acu-badge-neutral';\n    if (['', '', '', '', '', ''].includes(str)) return 'acu-badge-neutral';\n    return '';\n  };\n\n  // []  ()\n  const Store = {\n    get: (key, def = null) => {\n      try {\n        return JSON.parse(localStorage.getItem(key)) ?? def;\n      } catch {\n        return def;\n      }\n    },\n    set: (key, val) => {\n      try {\n        localStorage.setItem(key, JSON.stringify(val));\n      } catch (e) {\n        // \n        if (e.name === 'QuotaExceededError' || e.message.includes('quota')) {\n          console.warn('[DICE]ACU ...');\n          try {\n            // 1.  ()\n            localStorage.removeItem(STORAGE_KEY_LAST_SNAPSHOT);\n\n            // 2. \n            localStorage.setItem(key, JSON.stringify(val));\n          } catch (retryErr) {\n            // \n            console.error('[DICE]ACU Store ', retryErr);\n            if (window.toastr && !window._acuQuotaAlerted) {\n              window.toastr.warning(' ');\n              window._acuQuotaAlerted = true;\n              setTimeout(() => (window._acuQuotaAlerted = false), 10000);\n            }\n          }\n        } else {\n          console.error('[DICE]ACU Store', e);\n        }\n      }\n    },\n  };\n\n  const getActiveTabState = () => Store.get(STORAGE_KEY_ACTIVE_TAB);\n  const saveActiveTabState = v => Store.set(STORAGE_KEY_ACTIVE_TAB, v);\n  const getPendingDeletions = () => Store.get(STORAGE_KEY_PENDING_DELETIONS, {});\n  const savePendingDeletions = v => Store.set(STORAGE_KEY_PENDING_DELETIONS, v);\n  const getSavedTableOrder = () => Store.get(STORAGE_KEY_TABLE_ORDER);\n  const saveTableOrder = v => Store.set(STORAGE_KEY_TABLE_ORDER, v);\n  const getCollapsedState = () => Store.get(STORAGE_KEY_IS_COLLAPSED, false);\n  const saveCollapsedState = v => Store.set(STORAGE_KEY_IS_COLLAPSED, v);\n  // [] \n  const getOptionsCollapsedState = () => Store.get(STORAGE_KEY_OPTIONS_COLLAPSED, false);\n  const saveOptionsCollapsedState = v => Store.set(STORAGE_KEY_OPTIONS_COLLAPSED, v);\n  // []  (Chat ID)\n  const loadSnapshot = () => {\n    const data = Store.get(STORAGE_KEY_LAST_SNAPSHOT);\n    if (!data) return null;\n    // \n    const currentCtx = getCurrentContextFingerprint();\n    // \n    if (data._contextId && data._contextId !== currentCtx) {\n      return null;\n    }\n    return data;\n  };\n\n  // [] \n  const saveSnapshot = v => {\n    if (!v) return;\n    //  ChatID\n    if (typeof v === 'object') {\n      v._contextId = getCurrentContextFingerprint();\n    }\n    Store.set(STORAGE_KEY_LAST_SNAPSHOT, v);\n  };\n\n  // --- []  ---\n  const getTableHeights = () => Store.get(STORAGE_KEY_TABLE_HEIGHTS, {});\n  const saveTableHeights = v => Store.set(STORAGE_KEY_TABLE_HEIGHTS, v);\n  const getTableStyles = () => Store.get(STORAGE_KEY_TABLE_STYLES, {});\n  const saveTableStyles = v => Store.set(STORAGE_KEY_TABLE_STYLES, v);\n  const getHiddenTables = () => Store.get(STORAGE_KEY_HIDDEN_TABLES, []);\n  const saveHiddenTables = v => Store.set(STORAGE_KEY_HIDDEN_TABLES, v);\n  const getReverseTables = () => Store.get(STORAGE_KEY_REVERSE_TABLES, []);\n  const saveReverseTables = v => Store.set(STORAGE_KEY_REVERSE_TABLES, v);\n\n  // \n  const shouldShowReverseButton = tableName => {\n    if (!tableName) return false;\n    const keywords = ['', '', '', '', ''];\n    return keywords.some(kw => tableName.includes(kw));\n  };\n\n  // \n  const isTableReversed = tableName => {\n    return getReverseTables().includes(tableName);\n  };\n\n  // \n  const toggleTableReverse = tableName => {\n    const list = getReverseTables();\n    const idx = list.indexOf(tableName);\n    if (idx >= 0) {\n      list.splice(idx, 1);\n    } else {\n      list.push(tableName);\n    }\n    saveReverseTables(list);\n    console.log('[DICE]ACU toggleTableReverse:', tableName, 'reversed:', idx < 0);\n  };\n  // [] \n  const getAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          let attrs = [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.includes(attr.name)) attrs.push(attr.name);\n              });\n            }\n          });\n          if (attrs.length > 0) return attrs;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            let attrs = [];\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.includes(attr.name)) attrs.push(attr.name);\n                });\n              }\n            });\n            return attrs;\n          }\n        }\n      }\n    }\n\n    return [];\n  };\n  // [] \n  const getAttributeValue = (characterName, attrName) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData || !attrName) return null;\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          for (let idx = 0; idx < headers.length; idx++) {\n            const h = headers[idx];\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              const found = parsed.find(attr => attr.name === attrName);\n              if (found) return found.value;\n            }\n          }\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            for (let idx = 0; idx < headers.length; idx++) {\n              const h = headers[idx];\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                const found = parsed.find(attr => attr.name === attrName);\n                if (found) return found.value;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n  // [] 6\n  const STANDARD_ATTRS = ['', '', '', '', '', ''];\n\n  /**\n   * \n   */\n  const getStandardAttrs = () => {\n    const preset = AttributePresetManager.getActivePreset();\n    if (preset && preset.baseAttributes) {\n      return preset.baseAttributes.map(attr => attr.name);\n    }\n    return STANDARD_ATTRS;\n  };\n\n  /**\n   * \n   * \n   *  + \n   */\n  const getRandomSkillPool = () => {\n    try {\n      const preset = AttributePresetManager.getActivePreset();\n      if (preset) {\n        //  + \n        const allAttrs = new Set();\n\n        // \n        if (preset.baseAttributes && Array.isArray(preset.baseAttributes)) {\n          preset.baseAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        // \n        if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n          preset.specialAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        return Array.from(allAttrs);\n      }\n\n      // \n      const allPresets = AttributePresetManager.getAllPresets() || [];\n      const allAttrs = new Set(RANDOM_SKILL_POOL || []); // \n\n      // \n      if (Array.isArray(allPresets)) {\n        allPresets.forEach(p => {\n          if (!p) return;\n\n          // \n          if (p.baseAttributes && Array.isArray(p.baseAttributes)) {\n            p.baseAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n\n          // \n          if (p.specialAttributes && Array.isArray(p.specialAttributes)) {\n            p.specialAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n        });\n      }\n\n      return Array.from(allAttrs);\n    } catch (err) {\n      console.error('[DICE]ACU getRandomSkillPool :', err);\n      return RANDOM_SKILL_POOL || [];\n    }\n  };\n\n  // [] \n  const RANDOM_SKILL_POOL = [\n    // ---  (Physical & Movement) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Social & Psychological) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    // /\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Technical & Crafting) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Knowledge & Investigation) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Combat & Special) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  // []  COC/DND 6\n  /**\n   * \n   * @param isDNDOrPreset ()    null()\n   * @returns { base: {...}, special: {...} }  {...}\n   */\n  const generateRPGAttributes = (isDNDOrPreset = undefined) => {\n    // \n    if (typeof isDNDOrPreset === 'boolean') {\n      const isDND = isDNDOrPreset;\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n\n      const generateValue = () => {\n        if (isDND) {\n          const base = generate3d6();\n          const adjust = rollDice(4) - 2;\n          return Math.max(3, Math.min(18, base + adjust));\n        } else {\n          const base = generate3d6() * 5;\n          const adjust = rollDice(10) - 5;\n          return Math.max(5, Math.min(95, base + adjust));\n        }\n      };\n\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        result[attr] = generateValue();\n      });\n      return result; // \n    }\n\n    // \n    const preset = isDNDOrPreset || AttributePresetManager.getActivePreset();\n\n    // \n    if (!preset) {\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        const base = generate3d6() * 5;\n        const adjust = rollDice(10) - 5;\n        result[attr] = Math.max(5, Math.min(95, base + adjust));\n      });\n      return { base: result, special: {} };\n    }\n\n    // \n    const baseResult = {};\n    preset.baseAttributes.forEach(attr => {\n      const formula = attr.modifier ? `${attr.formula}+${attr.modifier}` : attr.formula;\n      baseResult[attr.name] = generateAttributeValue(formula, attr.range, {});\n    });\n\n    // \n    const specialResult = {};\n    if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n      preset.specialAttributes.forEach(attr => {\n        specialResult[attr.name] = generateAttributeValue(attr.formula, attr.range, baseResult);\n      });\n    }\n\n    return { base: baseResult, special: specialResult };\n  };\n\n  // [] \n  const clearPresetAttributesForCharacter = async charName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // NPC//\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    const customAttrs = existingAttrs.filter(attr => !presetAttrNames.has(attr.name));\n    const newAttrString = customAttrs.map(attr => `${attr.name}:${attr.value}`).join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData);\n\n    return {\n      success: true,\n      attrString: newAttrString,\n    };\n  };\n\n  // [] \n  const writeAttributesToCharacter = async (charName, newAttrs, isDND = false) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \"\"\n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // \n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('\"\"');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const existingMap = {};\n    existingAttrs.forEach(attr => {\n      existingMap[attr.name] = attr.value;\n    });\n\n    // +\n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    let standardCount = 0;\n    standardAttrs.forEach(attrName => {\n      if (existingMap[attrName] !== undefined) {\n        standardCount++;\n      }\n    });\n    const isComplete = standardCount === standardAttrs.length;\n\n    // \n    const customAttrs = [];\n    existingAttrs.forEach(attr => {\n      if (!presetAttrNames.has(attr.name)) {\n        customAttrs.push({ name: attr.name, value: attr.value });\n      }\n    });\n\n    // \n    const resultParts = [];\n\n    // 1. \n    standardAttrs.forEach(attrName => {\n      if (isComplete) {\n        //   \n        const newValue = newAttrs[attrName] !== undefined ? newAttrs[attrName] : existingMap[attrName];\n        if (newValue !== undefined) {\n          resultParts.push(`${attrName}:${newValue}`);\n        }\n      } else {\n        //   \n        if (existingMap[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        } else if (newAttrs[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        }\n      }\n    });\n\n    // 2. \n    Object.keys(newAttrs).forEach(attrName => {\n      if (!standardAttrs.includes(attrName)) {\n        // \n        if (isComplete || !existingMap[attrName]) {\n          // \n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        } else {\n          // \n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        }\n      }\n    });\n\n    // 3. \n    customAttrs.forEach(attr => {\n      resultParts.push(`${attr.name}:${attr.value}`);\n    });\n\n    const newAttrString = resultParts.join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData);\n\n    // UI\n    const writtenAttrs = [];\n    standardAttrs.forEach(attrName => {\n      writtenAttrs.push({ name: attrName, value: newAttrs[attrName] });\n    });\n\n    return {\n      success: true,\n      attrs: writtenAttrs,\n      attrString: newAttrString,\n      wasComplete: isComplete,\n    };\n  };\n  // [] \"\"\n  const getFullAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n    let attrs = [];\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.some(a => a.name === attr.name)) {\n                  attrs.push(attr);\n                }\n              });\n            }\n          });\n          if (attrs.length > 0) break;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.some(a => a.name === attr.name)) {\n                    attrs.push(attr);\n                  }\n                });\n              }\n            });\n            break;\n          }\n        }\n        if (attrs.length > 0) break;\n      }\n    }\n\n    return attrs;\n  };\n  // [] \n  const initCustomDropdown = ($input, options, themeColors) => {\n    const { $ } = getCore();\n    const t = themeColors || {};\n    const inputId = $input.attr('id') || 'dd_' + Math.random().toString(36).substr(2, 9);\n    $input.attr('id', inputId);\n\n    // \n    $input.parent().find('.acu-dropdown-list').remove();\n\n    //  wrapper\n    if (!$input.parent().hasClass('acu-dropdown-wrapper')) {\n      $input.wrap('<div class=\"acu-dropdown-wrapper\"></div>');\n    }\n\n    // \n    const $dropdown = $(`<div class=\"acu-dropdown-list\" data-for=\"${inputId}\"></div>`);\n    $dropdown.css({\n      background: t.bgPanel || '#fff',\n      'border-color': t.border || '#ccc',\n    });\n    $input.after($dropdown);\n\n    const renderItems = (filter = '') => {\n      const lowerFilter = filter.toLowerCase();\n      const filtered = options.filter(opt => opt.toLowerCase().includes(lowerFilter));\n\n      if (filtered.length === 0) {\n        $dropdown.html(`<div class=\"acu-dropdown-empty\" style=\"color:${t.textSub || '#999'};\"></div>`);\n      } else {\n        $dropdown.html(\n          filtered\n            .map(\n              opt =>\n                `<div class=\"acu-dropdown-item\" data-value=\"${escapeHtml(opt)}\" style=\"color:${t.textMain || '#333'};\">${escapeHtml(opt)}</div>`,\n            )\n            .join(''),\n        );\n      }\n    };\n\n    const showDropdown = () => {\n      $('.acu-dropdown-list').removeClass('visible');\n      renderItems($input.val());\n      $dropdown.addClass('visible');\n    };\n\n    const hideDropdown = () => {\n      $dropdown.removeClass('visible');\n    };\n\n    // \n    $input.off('.acudd').on('focus.acudd click.acudd', function (e) {\n      e.stopPropagation();\n      showDropdown();\n    });\n\n    // \n    $input.on('input.acudd', function () {\n      renderItems($(this).val());\n    });\n\n    // hover \n    $dropdown\n      .on('mouseenter', '.acu-dropdown-item', function () {\n        $(this).css('background', t.tableHead || 'rgba(128,128,128,0.15)');\n      })\n      .on('mouseleave', '.acu-dropdown-item', function () {\n        $(this).css('background', 'transparent');\n      });\n\n    // \n    $dropdown.on('click', '.acu-dropdown-item', function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      const val = $(this).data('value');\n      $input.val(val).trigger('change');\n      hideDropdown();\n    });\n\n    // \n    $dropdown.on('click', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $input\n      .closest('.acu-dice-panel, .acu-contest-panel')\n      .off('click.acudd_' + inputId)\n      .on('click.acudd_' + inputId, function (e) {\n        if (!$(e.target).closest('.acu-dropdown-wrapper').length) {\n          hideDropdown();\n        }\n      });\n  };\n  // [] \n  const addClearButton = ($panel, inputSelector, themeColors) => {\n    const { $ } = getCore();\n    const t = themeColors || {};\n    $panel.find(inputSelector).each(function () {\n      const $input = $(this);\n      // \n      if ($input.parent().hasClass('acu-input-wrapper')) return;\n      // \n      $input.wrap('<div class=\"acu-input-wrapper\"></div>');\n      //  - \n      const $clearBtn = $(\n        `<button type=\"button\" class=\"acu-clear-btn\" title=\"\" style=\"color:${t.textSub || '#999'};\"><i class=\"fa-solid fa-times\"></i></button>`,\n      );\n      $input.after($clearBtn);\n      // \n      $clearBtn.on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        $input.val('').trigger('input').trigger('change').focus();\n      });\n      //  - \n      $clearBtn\n        .on('mouseenter', function () {\n          $(this).css({ color: t.accent || '#7a695f', opacity: '1' });\n        })\n        .on('mouseleave', function () {\n          $(this).css({ color: t.textSub || '#999', opacity: '0.5' });\n        });\n    });\n  };\n  // [] \n  const showDiceSettingsPanel = (isDND = false) => {\n    const { $ } = getCore();\n    $('.acu-dice-config-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    const ruleTitle = isDND ? 'DND ' : 'COC ';\n    const resetText = isDND ? ' DND ' : ' COC ';\n\n    // \n    const defaults = isDND\n      ? { critSuccess: 20, critFail: 1 }\n      : { critSuccess: 5, critFail: 96, hardDiv: 2, extremeDiv: 5 };\n\n    //  placeholder\n    const currentCritSuccess = isDND\n      ? diceCfg.dndCritSuccess !== undefined && diceCfg.dndCritSuccess !== defaults.critSuccess\n        ? diceCfg.dndCritSuccess\n        : ''\n      : diceCfg.critSuccessMax !== undefined && diceCfg.critSuccessMax !== defaults.critSuccess\n        ? diceCfg.critSuccessMax\n        : '';\n    const currentCritFail = isDND\n      ? diceCfg.dndCritFail !== undefined && diceCfg.dndCritFail !== defaults.critFail\n        ? diceCfg.dndCritFail\n        : ''\n      : diceCfg.critFailMin !== undefined && diceCfg.critFailMin !== defaults.critFail\n        ? diceCfg.critFailMin\n        : '';\n    const currentHardDiv =\n      !isDND && diceCfg.difficultSuccessDiv !== undefined && diceCfg.difficultSuccessDiv !== defaults.hardDiv\n        ? diceCfg.difficultSuccessDiv\n        : '';\n    const currentExtremeDiv =\n      !isDND && diceCfg.hardSuccessDiv !== undefined && diceCfg.hardSuccessDiv !== defaults.extremeDiv\n        ? diceCfg.hardSuccessDiv\n        : '';\n\n    const tieRule = diceCfg.contestTieRule || 'initiator_lose';\n    const hideDiceResultFromUser =\n      diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n    const hideDiceResultInChat = diceCfg.hideDiceResultInChat !== undefined ? diceCfg.hideDiceResultInChat : false;\n\n    const cocExtraHtml = isDND\n      ? ''\n      : `\n            <div class=\"acu-dice-cfg-row\">\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-hard-div\" data-min=\"2\" data-max=\"5\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentHardDiv || defaults.hardDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-extreme-div\" data-min=\"3\" data-max=\"10\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentExtremeDiv || defaults.extremeDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const panelHtml = `\n            <div class=\"acu-dice-config-overlay\">\n                <div class=\"acu-dice-config-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-dice-cfg-header\">\n                        <span><i class=\"fa-solid fa-cog\"></i> ${ruleTitle}</span>\n                        <button class=\"acu-config-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-dice-cfg-body\">\n                        <div class=\"acu-dice-cfg-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-success\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritSuccess || defaults.critSuccess}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-fail\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritFail || defaults.critFail}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                        ${cocExtraHtml}\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <select id=\"cfg-tie-rule\">\n                                    <option value=\"initiator_lose\" ${tieRule === 'initiator_lose' ? 'selected' : ''}> ()</option>\n                                    <option value=\"tie\" ${tieRule === 'tie' ? 'selected' : ''}></option>\n                                    <option value=\"initiator_win\" ${tieRule === 'initiator_win' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label></label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result\" ${hideDiceResultFromUser ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label></label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result-chat\" ${hideDiceResultInChat ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-actions\">\n                            <button id=\"cfg-reset-dice\">${resetText}</button>\n                            <button id=\"cfg-save-dice\"></button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $panel = $(panelHtml);\n    $('body').append($panel);\n\n    $panel.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '2147483655',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    // \n    const theme = getThemeColors();\n    $panel.find('#cfg-reset-dice, #cfg-save-dice').css({\n      background: theme.btnBg,\n      color: theme.textMain,\n      borderColor: theme.border,\n    });\n    $panel.find('#cfg-reset-dice, #cfg-save-dice').hover(\n      function () {\n        $(this).css({\n          background: theme.btnHover,\n          borderColor: theme.btnHover,\n        });\n      },\n      function () {\n        $(this).css({\n          background: theme.btnBg,\n          borderColor: theme.border,\n        });\n      },\n    );\n\n    const closePanel = () => $panel.remove();\n    $panel.find('.acu-config-close').click(closePanel);\n    $panel.on('click', e => {\n      if ($(e.target).hasClass('acu-dice-config-overlay')) closePanel();\n    });\n\n    // === Stepper  ===\n    $panel.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        $value.text(newVal);\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    $panel.find('#cfg-save-dice').click(function () {\n      const newCfg = { contestTieRule: $('#cfg-tie-rule').val() };\n\n      // stepper\n      const getStepperValue = id => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          const text = $stepper.find('.acu-stepper-value').text().replace(/[^\\d]/g, '');\n          return text !== '' ? parseInt(text, 10) : null;\n        }\n        return null;\n      };\n\n      const critSuccessVal = getStepperValue('cfg-crit-success');\n      const critFailVal = getStepperValue('cfg-crit-fail');\n\n      if (isDND) {\n        newCfg.dndCritSuccess = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.dndCritFail = critFailVal !== null ? critFailVal : defaults.critFail;\n      } else {\n        newCfg.critSuccessMax = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.critFailMin = critFailVal !== null ? critFailVal : defaults.critFail;\n\n        const hardDivVal = getStepperValue('cfg-hard-div');\n        const extremeDivVal = getStepperValue('cfg-extreme-div');\n        newCfg.difficultSuccessDiv = hardDivVal !== null ? hardDivVal : defaults.hardDiv;\n        newCfg.hardSuccessDiv = extremeDivVal !== null ? extremeDivVal : defaults.extremeDiv;\n      }\n\n      // \"\"\n      newCfg.hideDiceResultFromUser = $('#cfg-hide-dice-result').is(':checked');\n      // \"\"\n      newCfg.hideDiceResultInChat = $('#cfg-hide-dice-result-chat').is(':checked');\n\n      saveDiceConfig(newCfg);\n      // \n      console.info('[DICE]/...');\n      hideDiceResultsInUserMessages();\n      closePanel();\n    });\n\n    $panel.find('#cfg-reset-dice').click(function () {\n      // stepper\n      const resetStepper = (id, defaultValue) => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          $stepper.find('.acu-stepper-value').text(defaultValue);\n        }\n      };\n\n      resetStepper('cfg-crit-success', defaults.critSuccess);\n      resetStepper('cfg-crit-fail', defaults.critFail);\n      if (!isDND) {\n        resetStepper('cfg-hard-div', defaults.hardDiv);\n        resetStepper('cfg-extreme-div', defaults.extremeDiv);\n      }\n    });\n  };\n  // [] \n  const showDicePanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n    // 1d100\n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    // 1d100\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n    // [] \n    const rawDataForList = cachedRawData || getTableData();\n    let diceCharacterList = ['<user>'];\n    let diceAttrList = [];\n\n    if (rawDataForList) {\n      for (const key in rawDataForList) {\n        const sheet = rawDataForList[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '') {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) diceCharacterList.push(row[1]);\n          }\n        }\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const row = sheet.content[1];\n          const headers = sheet.content[0] || [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!diceAttrList.includes(attr.name)) diceAttrList.push(attr.name);\n              });\n            }\n          });\n        }\n      }\n    }\n    const {\n      targetValue = null, // []  null\n      targetName = '',\n      attrValue = null, // [] \n      diceType = savedDiceType, // \n      successCriteria = 'lte', // [] COC\n      onResult = null,\n      initiatorName = '', // [] \n      fromMvu = false, // [] MVU\n      mvuPath = null, // [] MVU\n      mvuParsedInfo = null, // [] \n    } = options;\n\n    // [] /DC\n    const isDND = diceType === '1d20' || successCriteria === 'gte';\n    let initialAttrValue = attrValue;\n    let initialTargetValue = targetValue;\n\n    // attrValuetargetValue\n    if (attrValue !== null && targetValue === null) {\n      if (isDND) {\n        initialTargetValue = Math.max(0, 20 - attrValue);\n      } else {\n        initialTargetValue = attrValue;\n      }\n    }\n\n    const t = getThemeColors();\n    const isCyberTheme = getConfig().theme === 'cyber';\n    const inputTextColor = isCyberTheme ? '#ff00ff' : t.inputText;\n    const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n    // \n    const inputStyle = `width:100%;padding:5px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:4px;color:${inputTextColor} !important;font-size:12px;text-align:center;box-sizing:border-box;`;\n\n    const overlay = $(\n      `<div class=\"acu-dice-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:${t.overlayBgLight};z-index:2147483647;\"></div>`,\n    );\n\n    // []  COC  DND\n    const successCriteriaOptions = [\n      { id: 'lte', name: ' (COC)' },\n      { id: 'gte', name: ' (DND)' },\n    ];\n\n    // [] \n    let defaultCriteria = successCriteria;\n    if (diceType === '1d100') defaultCriteria = 'lte';\n    else if (diceType === '1d20') defaultCriteria = 'gte';\n\n    const panel = $(`\n            <div class=\"acu-dice-panel acu-theme-${config.theme}\" style=\"\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 340px;\n                max-width: 90vw;\n                background: ${t.bgPanel};\n                border: 1px solid ${t.border};\n                border-radius: 12px;\n                box-shadow: 0 20px 60px ${t.shadowBg};\n                z-index: 2147483648;\n                overflow: hidden;\n            \">\n                <div style=\"padding: 12px 15px; background: ${t.tableHead}; border-bottom: 1px solid ${t.border}; display: flex; justify-content: space-between; align-items: center;\">\n                    <div style=\"font-size: 15px; font-weight: bold; color: ${t.accent}; display: flex; align-items: center; gap: 8px;\">\n                        <i class=\"fa-solid fa-dice-d20\"></i> \n                    </div>\n                    <div style=\"display: flex; align-items: center; gap: 8px;\">\n                        <button id=\"dice-switch-contest-top\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 14px; padding: 4px; transition: all 0.2s;\" title=\"\"><i class=\"fa-solid fa-people-arrows\"></i></button>\n                        <button class=\"acu-dice-config-btn\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 14px; padding: 4px; transition: all 0.2s;\" title=\"\">\n                            <i class=\"fa-solid fa-cog\"></i>\n                        </button>\n                        <button class=\"acu-dice-close\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 16px; padding: 4px;\">\n                            <i class=\"fa-solid fa-times\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div style=\"padding: 15px; max-height: 70vh; overflow-y: auto;\">\n                    <div style=\"display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; align-items: center;\" class=\"acu-dice-presets\">\n                        <button class=\"acu-dice-preset ${diceType === '1d20' ? 'active' : ''}\" data-dice=\"1d20\" data-criteria=\"gte\" style=\"padding: 4px 10px; background: ${diceType === '1d20' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${diceType === '1d20' ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\">1d20</button>\n                        <button class=\"acu-dice-preset ${diceType === '1d100' ? 'active' : ''}\" data-dice=\"1d100\" data-criteria=\"lte\" style=\"padding: 4px 10px; background: ${diceType === '1d100' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${diceType === '1d100' ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\">1d100</button>\n                        <button class=\"acu-dice-preset acu-dice-custom-btn\" data-dice=\"custom\" style=\"padding: 4px 10px; background: ${!['1d20', '1d100'].includes(diceType) ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${!['1d20', '1d100'].includes(diceType) ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\"></button>\n                        <input type=\"text\" id=\"dice-custom-input\" placeholder=\"2d6\" value=\"${!['1d20', '1d100'].includes(diceType) ? diceType : ''}\" style=\"width:60px;\">\n                    </div>\n\n                    <!--  -->\n                    <div style=\"margin-bottom: 10px;\">\n                        <div style=\"font-size: 11px; color: ${t.accent}; font-weight: bold; margin-bottom: 4px; display: flex; align-items: center; gap: 6px;\"><i class=\"fa-solid fa-user\"></i> </div>\n                        <div id=\"dice-char-buttons\" style=\"display: flex; flex-wrap: wrap; gap: 4px; max-height: 60px; overflow-y: auto;\"></div>\n                    </div>\n\n                    <!-- 1 +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-initiator-name\" value=\"${escapeHtml(initiatorName)}\" placeholder=\"<user>\" style=\"${inputStyle}\">\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; gap: 6px;\">\n                                \n                                <button type=\"button\" class=\"acu-random-skill-btn\" id=\"dice-random-skill\" title=\"\" style=\"width: 18px; height: 18px; padding: 0; background: transparent; border: 1px dashed ${t.accent}; border-radius: 4px; color: ${t.accent}; font-size: 9px; cursor: pointer; display: flex; align-items: center; justify-content: center;\">\n                                    <i class=\"fa-solid fa-dice\"></i>\n                                </button>\n                            </div>\n                            <input type=\"text\" id=\"dice-attr-name\" value=\"${escapeHtml(targetName || '')}\" placeholder=\"\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!-- 2 +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-attr-value\" value=\"${initialAttrValue !== null ? initialAttrValue : ''}\" placeholder=\"=50%\" style=\"${inputStyle}\">\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\" id=\"dice-target-label\"></div>\n                            <input type=\"text\" id=\"dice-target\" value=\"${initialTargetValue !== null ? initialTargetValue : ''}\" placeholder=\"=\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!-- 3 +  +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-bottom: 6px;\" id=\"dice-row-3\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; justify-content: center;\"></div>\n                            <select id=\"dice-success-criteria\" class=\"acu-dice-select\">\n                                ${successCriteriaOptions\n                                  .map(\n                                    opt =>\n                                      `<option value=\"${opt.id}\" ${opt.id === defaultCriteria ? 'selected' : ''}>${opt.name}</option>`,\n                                  )\n                                  .join('')}\n                            </select>\n                        </div>\n                        <div id=\"dice-difficulty-wrapper\">\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; justify-content: center;\"></div>\n                            <select id=\"dice-difficulty\" class=\"acu-dice-select\">\n                                <option value=\"normal\" selected></option>\n                                <option value=\"hard\"></option>\n                                <option value=\"extreme\"></option>\n                                <option value=\"critical\"></option>\n                            </select>\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-modifier\" value=\"0\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div style=\"margin-bottom: 10px;\">\n                        <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 4px;\"><i class=\"fa-solid fa-sliders\"></i> </div>\n                        <div id=\"dice-attr-buttons\" style=\"display: flex; flex-wrap: wrap; gap: 4px; max-height: 80px; overflow-y: auto;\"></div>\n                    </div>\n                    <!--  -->\n                    <input type=\"hidden\" id=\"dice-formula\" value=\"${diceType}\">\n\n                    <button id=\"dice-roll-btn\" style=\"width: 100%; padding: 12px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 8px; color: ${t.buttonText}; font-size: 15px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; position: relative;\">\n                        <i class=\"fa-solid fa-dice\"></i> \n                    </button>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay).append(panel);\n\n    // [] \n    const buildCharButtons = () => {\n      const $container = panel.find('#dice-char-buttons');\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.initiator) {\n        const initiator = mvuParsedInfo.initiator;\n        const shortName = initiator.length > 4 ? initiator.substring(0, 4) + '..' : initiator;\n        const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n        html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu\" data-char=\"${escapeHtml(initiator)}\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;white-space:nowrap;font-weight:bold;\" title=\": ${escapeHtml(initiator)}\">${escapeHtml(shortName)}</button>`;\n      }\n\n      // \n      diceCharacterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html += `<button class=\"acu-dice-char-btn\" data-char=\"${escapeHtml(name)}\" style=\"padding:3px 8px;background:${t.btnBg};border:1px solid ${t.border};border-radius:4px;color:${t.textMain};font-size:11px;cursor:pointer;white-space:nowrap;\" title=\"${escapeHtml(displayName)}\">${escapeHtml(shortName)}</button>`;\n      });\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.candidates && mvuParsedInfo.candidates.length > 0) {\n        mvuParsedInfo.candidates.forEach(candidate => {\n          // \n          if (mvuParsedInfo.initiator && candidate === mvuParsedInfo.initiator) return;\n          const shortName = candidate.length > 4 ? candidate.substring(0, 4) + '..' : candidate;\n          html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu-candidate\" data-char=\"${escapeHtml(candidate)}\" style=\"padding:3px 8px;background:${t.inputBg};border:1px dashed ${t.accent};border-radius:4px;color:${t.accent};font-size:11px;cursor:pointer;white-space:nowrap;\" title=\": ${escapeHtml(candidate)}\">${escapeHtml(shortName)}</button>`;\n        });\n      }\n\n      $container.html(html || `<div style=\"font-size:11px;color:${t.textSub};\"></div>`);\n      // \n      $container.find('.acu-dice-char-btn').click(function () {\n        const charName = $(this).data('char');\n        panel.find('#dice-initiator-name').val(charName).trigger('change');\n      });\n    };\n\n    // [] \n    const buildAttrButtons = charName => {\n      const $container = panel.find('#dice-attr-buttons');\n      const $parentSection = $container.parent(); // \n      const attrs = getFullAttributesForCharacter(charName);\n\n      // \n      $parentSection.show();\n\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.attrName) {\n        const attrName = mvuParsedInfo.attrName;\n        // \n        const attrValue = getAttributeValue(charName, attrName) || targetValue || '';\n        const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n        if (attrValue) {\n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"${attrValue}\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;font-weight:bold;\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}:${attrValue}</button>`;\n        } else {\n          // \n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;font-weight:bold;\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}</button>`;\n        }\n      }\n\n      // \n      attrs.forEach(attr => {\n        html += `<button class=\"acu-dice-attr-btn\" data-name=\"${escapeHtml(attr.name)}\" data-value=\"${attr.value}\" style=\"padding:3px 8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:4px;color:${t.inputText};font-size:11px;cursor:pointer;\">${escapeHtml(attr.name)}:${attr.value}</button>`;\n      });\n\n      // \n      html += `<button class=\"acu-dice-gen-attr-btn\" style=\"padding:3px 8px;background:transparent;border:1px dashed ${t.accent};border-radius:4px;color:${t.accent};font-size:11px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>`;\n\n      // \n      html += `<button class=\"acu-dice-clear-attr-btn\" style=\"padding:3px 8px;background:transparent;border:1px dashed ${t.errorText};border-radius:4px;color:${t.errorText};font-size:11px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;margin-left:4px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\"></i></button>`;\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-dice-attr-btn').click(function () {\n        const attrName = $(this).data('name');\n        const attrValue = $(this).data('value');\n        panel.find('#dice-attr-name').val(attrName);\n        panel.find('#dice-attr-value').val(attrValue);\n\n        // \n        const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n        const isDND = criteria === 'gte';\n        const numValue = parseInt(attrValue, 10) || 0;\n\n        if (isDND) {\n          // DNDDC = 20 - \n          panel.find('#dice-target').val(20 - numValue);\n        } else {\n          // COC = \n          panel.find('#dice-target').val(attrValue);\n        }\n\n        // changeUI\n        panel.find('#dice-attr-value').trigger('change');\n      });\n\n      // \n      $container.find('.acu-dice-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n          console.log('[DICE]ACU  for:', charName);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-dice-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharButtons();\n    // <user>\n    buildAttrButtons('<user>');\n    // [] \n    panel.find('#dice-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#dice-attr-name').val(randomSkill).trigger('change');\n    });\n\n    // \n    initCustomDropdown(panel.find('#dice-initiator-name'), diceCharacterList, t);\n    initCustomDropdown(panel.find('#dice-attr-name'), diceAttrList, t);\n    // [] \n    addClearButton(panel, '#dice-initiator-name, #dice-attr-name, #dice-attr-value, #dice-target', t);\n\n    // [] \n    panel.find('#dice-initiator-name').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#dice-attr-name'), newAttrList.length > 0 ? newAttrList : diceAttrList, t);\n\n      // [] \n      buildAttrButtons(charName);\n    });\n\n    // [] \n    panel.find('#dice-attr-name').on('change.acuval', function () {\n      const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#dice-attr-value').val(attrValue);\n        // /DC\n        const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n        const isDND = criteria === 'gte';\n        panel.find('#dice-target').val(isDND ? 20 - attrValue : attrValue);\n      }\n    });\n\n    // [] \n    const convertTargetForDice = (currentTarget, fromDice, toDice) => {\n      if (!currentTarget || currentTarget === '') return '';\n      const val = parseInt(currentTarget, 10);\n      if (isNaN(val)) return currentTarget;\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n\n      const fromMax = getMaxRoll(fromDice);\n      const toMax = getMaxRoll(toDice);\n\n      // \n      const ratio = val / fromMax;\n      const newVal = Math.round(ratio * toMax);\n      return Math.max(1, Math.min(newVal, toMax));\n    };\n\n    // []  UICOC/DND \n    const updateRuleMode = () => {\n      const criteria = panel.find('#dice-success-criteria').val();\n      const isDND = criteria === 'gte';\n      const $targetInput = panel.find('#dice-target');\n      const $difficultyWrapper = panel.find('#dice-difficulty-wrapper');\n      const $row3 = panel.find('#dice-row-3');\n\n      if (isDND) {\n        // DND \n        $targetInput.attr('placeholder', '=20-');\n        panel.find('#dice-target-label').text('DC');\n        $difficultyWrapper.hide();\n        $row3.css('grid-template-columns', '1fr 1fr');\n      } else {\n        // COC \n        $targetInput.attr('placeholder', '=');\n        panel.find('#dice-target-label').text('');\n        $difficultyWrapper.show();\n        $row3.css('grid-template-columns', '1fr 1fr 1fr');\n      }\n    };\n\n    panel.find('#dice-success-criteria').on('change', updateRuleMode);\n\n    // \n    updateRuleMode();\n\n    // \n    let currentDiceType = diceType;\n\n    //  - [] \n    panel.find('.acu-dice-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-dice-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n      const suggestedCriteria = $(this).data('criteria') || 'lte';\n\n      // [] \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, newDice);\n        $targetInput.val(convertedVal);\n      }\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n      const newMax = getMaxRoll(newDice);\n      panel.find('#dice-target-auto').text(`(: 1~${newMax})`);\n\n      currentDiceType = newDice;\n      panel.find('#dice-formula').val(newDice);\n\n      // [] \n      panel.find('#dice-success-criteria').val(suggestedCriteria).trigger('change');\n    });\n    // \n    panel.find('.acu-dice-custom-btn').click(function () {\n      // \n      panel.find('.acu-dice-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      const customDice = panel.find('#dice-custom-input').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#dice-custom-input').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      // \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, customDice);\n        $targetInput.val(convertedVal);\n      }\n\n      panel.find('#dice-formula').val(customDice);\n      currentDiceType = customDice;\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n\n      panel.find('#dice-success-criteria').val('gte').trigger('change');\n    });\n\n    // \n    panel.find('#dice-custom-input').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-dice-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = formula => {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], formula };\n\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      const total = rolls.reduce((a, b) => a + b, 0) + modifier;\n\n      return { total, rolls, sides, count, modifier, formula };\n    };\n\n    // 1d6, 1d6+2\n    const parseModifier = function (modStr) {\n      if (!modStr || modStr.trim() === '') return 0;\n      const trimmed = modStr.trim();\n\n      // \n      const numValue = parseFloat(trimmed);\n      if (!isNaN(numValue) && isFinite(numValue) && trimmed.match(/^-?\\d+(\\.\\d+)?$/)) {\n        return numValue;\n      }\n\n      // \n      // 1d6, 2d10, 1d6+2, 1d6-2, 2d6+1d4\n      let result = 0;\n      let remaining = trimmed;\n\n      // 1d6, 2d10\n      const dicePattern = /(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi;\n      let match;\n      while ((match = dicePattern.exec(remaining)) !== null) {\n        const diceResult = rollDiceExpression(match[0]);\n        if (!isNaN(diceResult)) {\n          result += diceResult;\n        }\n        remaining = remaining.replace(match[0], '');\n      }\n\n      // \n      const numberPattern = /([+-]?\\d+(\\.\\d+)?)/g;\n      let numMatch;\n      while ((numMatch = numberPattern.exec(remaining)) !== null) {\n        const num = parseFloat(numMatch[0]);\n        if (!isNaN(num) && isFinite(num)) {\n          result += num;\n        }\n      }\n\n      return result;\n    };\n\n    // \n    const performDiceRoll = function () {\n      const formula = panel.find('#dice-formula').val().trim() || '1d100';\n      const modStr = panel.find('#dice-modifier').val().trim() || '0';\n      const mod = parseModifier(modStr);\n      const attrName = panel.find('#dice-attr-name').val().trim() || '';\n      const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n      const difficulty = panel.find('#dice-difficulty').val() || 'normal';\n\n      // \n      const isDND = criteria === 'gte';\n\n      // \n      const diceCfg = getDiceConfig();\n      const hardDiv = diceCfg.difficultSuccessDiv || 2;\n      const extremeDiv = diceCfg.hardSuccessDiv || 5;\n      // COC:   critSuccessMax,   critFailMin\n      // DND:   dndCritSuccess,   dndCritFail\n      const critSuccessMax = isDND ? diceCfg.dndCritFail || 1 : diceCfg.critSuccessMax || 5;\n      const critFailMin = isDND ? diceCfg.dndCritSuccess || 20 : diceCfg.critFailMin || 96;\n\n      // COC  DND \n      let targetInputVal = panel.find('#dice-target').val().trim();\n      let attrInputVal = panel.find('#dice-attr-value').val().trim();\n      let attrValue = attrInputVal !== '' ? parseInt(attrInputVal, 10) : 0;\n      let target;\n      let isAutoTarget = false;\n\n      // \n      const getDefaultTarget = formulaStr => {\n        const match = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (match) {\n          const maxRoll = parseInt(match[1], 10) * parseInt(match[2], 10);\n          return Math.round(maxRoll / 2);\n        }\n        return 50;\n      };\n\n      if (targetInputVal !== '') {\n        // /DC\n        target = parseInt(targetInputVal, 10) || getDefaultTarget(formula);\n      } else if (isDND) {\n        // DND  DC = 20 - DC=10\n        if (attrValue > 0) {\n          target = 20 - attrValue;\n          isAutoTarget = true;\n        } else {\n          target = 10; // \n          isAutoTarget = true;\n        }\n      } else {\n        // COC  = \n        if (attrValue > 0) {\n          target = attrValue;\n          isAutoTarget = true;\n        } else {\n          target = getDefaultTarget(formula);\n          isAutoTarget = true;\n        }\n      }\n\n      const result = rollDice(formula);\n      const finalValue = result.total + mod;\n\n      // \n      let requiredTarget = target;\n      let difficultyLabel = '';\n      let difficultyDiv = 1;\n\n      // DND \n      if (!isDND) {\n        switch (difficulty) {\n          case 'hard':\n            requiredTarget = Math.floor(target / hardDiv);\n            difficultyLabel = '';\n            difficultyDiv = hardDiv;\n            break;\n          case 'extreme':\n            requiredTarget = Math.floor(target / extremeDiv);\n            difficultyLabel = '';\n            difficultyDiv = extremeDiv;\n            break;\n          case 'critical':\n            requiredTarget = critSuccessMax;\n            difficultyLabel = '';\n            break;\n          default:\n            difficultyLabel = '';\n            break;\n        }\n      }\n\n      // \n      let isCritSuccess = false;\n      let isCritFailure = false;\n      let isSuccess = false;\n      let outcomeText = '';\n      let outcomeClass = '';\n\n      // /\n      if (isDND) {\n        // DND:   20  1\n        isCritSuccess = finalValue >= critFailMin; //  critFailMin  DND \n        isCritFailure = finalValue <= critSuccessMax; //  critSuccessMax  DND \n      } else {\n        // COC:   5  96\n        isCritSuccess = finalValue <= critSuccessMax;\n        isCritFailure = finalValue >= critFailMin;\n      }\n\n      // /\n      if (isDND) {\n        isSuccess = finalValue >= requiredTarget;\n      } else {\n        isSuccess = finalValue <= requiredTarget;\n      }\n\n      // \n      if (isCritSuccess) {\n        outcomeText = '';\n        outcomeClass = 'success';\n        isSuccess = true;\n      } else if (isCritFailure) {\n        outcomeText = '';\n        outcomeClass = 'failure';\n        isSuccess = false;\n      } else if (isSuccess) {\n        if (isDND) {\n          outcomeText = '';\n        } else if (difficulty === 'hard') {\n          outcomeText = '';\n        } else if (difficulty === 'extreme') {\n          outcomeText = '';\n        } else {\n          // \n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            outcomeText = '';\n          } else if (finalValue <= hardTarget) {\n            outcomeText = '';\n          } else {\n            outcomeText = '';\n          }\n        }\n        outcomeClass = 'success';\n      } else {\n        outcomeText = '';\n        outcomeClass = 'failure';\n      }\n\n      const criteriaSymbol = isDND ? '' : '';\n      const hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const displayValue = hideDiceResultFromUser ? '' : finalValue;\n      const displayOutcomeText = hideDiceResultFromUser ? '' : outcomeText;\n\n      // \n      let resultType;\n      if (isCritSuccess) {\n        resultType = 'critSuccess';\n      } else if (isCritFailure) {\n        resultType = 'critFailure';\n      } else if (isSuccess) {\n        if (difficulty === 'extreme' || (difficulty === 'normal' && finalValue <= Math.floor(target / extremeDiv))) {\n          resultType = 'extremeSuccess';\n        } else if (difficulty === 'hard' || (difficulty === 'normal' && finalValue <= Math.floor(target / hardDiv))) {\n          resultType = 'success';\n        } else {\n          resultType = 'warning';\n        }\n      } else {\n        resultType = 'failure';\n      }\n\n      const badgeStyle = getResultBadgeStyle(resultType, t);\n      const badgeStyleStr = Object.entries(badgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n\n      // \n      const $rollBtn = panel.find('#dice-roll-btn');\n      $rollBtn.html(`\n        <div style=\"display:flex; align-items:center; justify-content:center; width:100%; gap:8px;\">\n          <span style=\"font-size:22px; font-weight:bold; color:${t.buttonText};\">${displayValue}</span>\n          <span style=\"font-size:11px; color:${t.buttonText}; opacity:0.9;\">${criteriaSymbol}${requiredTarget}${difficultyLabel ? '(' + difficultyLabel + ')' : ''}</span>\n          ${displayOutcomeText ? `<span style=\"${badgeStyleStr}\">${displayOutcomeText}</span>` : ''}\n          <button class=\"dice-retry-btn\" style=\"background:transparent; border:none; color:${t.buttonText}; cursor:pointer; padding:4px; display:flex; align-items:center; justify-content:center; opacity:0.8; transition:opacity 0.2s;\" title=\"\">\n            <i class=\"fa-solid fa-rotate-right\"></i>\n          </button>\n        </div>\n      `);\n\n      // \n      $rollBtn.off('click', '.dice-retry-btn').on('click', '.dice-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        // \n        performDiceRoll();\n      });\n\n      //  Prompt \n      const initiatorName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      let judgeExpr = '';\n\n      if (isCritSuccess) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        } else {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        }\n      } else if (isCritFailure) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        } else {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        }\n      } else if (isDND) {\n        // DND \n        if (isSuccess) {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}<${requiredTarget}`;\n        }\n      } else if (difficulty === 'critical') {\n        // COC \n        judgeExpr = `${critSuccessMax}${finalValue}>${critSuccessMax}`;\n      } else if (difficulty !== 'normal') {\n        // COC \n        if (isSuccess) {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}>${requiredTarget}`;\n        }\n      } else {\n        // COC \n        if (isSuccess) {\n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${extremeDiv}`;\n          } else if (finalValue <= hardTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${hardDiv}`;\n          } else {\n            judgeExpr = `${target}${finalValue}${target}`;\n          }\n        } else {\n          judgeExpr = `${target}${finalValue}>${target}`;\n        }\n      }\n\n      const diceResultText = `${initiatorName}${attrName}${finalValue}${judgeExpr}${outcomeText}`;\n      smartInsertToTextarea(diceResultText, 'dice');\n      if (onResult) {\n        onResult({\n          success: isSuccess,\n          total: finalValue,\n          target,\n          outcomeText,\n          attrName,\n          criteria,\n          isAutoTarget,\n          formula: formulaText,\n        });\n      }\n    };\n\n    // \n    panel.find('#dice-roll-btn').click(function () {\n      performDiceRoll();\n    });\n\n    // \n    panel.find('#dice-switch-contest-top').click(function () {\n      const targetInput = panel.find('#dice-target').val().trim();\n      const attrValueInput = panel.find('#dice-attr-value').val().trim();\n      const currentDice = panel.find('#dice-formula').val() || '1d100';\n      const initiatorNameVal = panel.find('#dice-initiator-name').val().trim();\n      closePanel();\n      showContestPanel({\n        //  placeholder \n        initiatorName: initiatorNameVal && initiatorNameVal !== '<user>' ? initiatorNameVal : '',\n        initiatorValue: attrValueInput !== '' ? parseInt(attrValueInput, 10) : undefined,\n        diceType: currentDice,\n      });\n    });\n    // \n    const closePanel = () => {\n      overlay.remove();\n      panel.remove();\n    };\n    overlay.click(closePanel);\n    panel.find('.acu-dice-close').click(closePanel);\n    //  - \n    panel.find('.acu-dice-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentCriteria = panel.find('#dice-success-criteria').val();\n      const isDND = currentCriteria === 'gte';\n      showDiceSettingsPanel(isDND);\n    });\n  };\n\n  // [] \n  const showContestPanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay, .acu-contest-panel, .acu-contest-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    // \n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n\n    // \n    const opponentName = options.opponentName || '';\n    const diceType = options.diceType || savedDiceType;\n    const passedInitiatorName = options.initiatorName || '';\n    const passedInitiatorValue = options.initiatorValue;\n    const passedOpponentValue = options.opponentValue;\n\n    const rawData = cachedRawData || getTableData();\n    let playerAttrs = [];\n    let opponentAttrs = [];\n\n    // [] <user> + \n    let characterList = ['<user>'];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) characterList.push(row[1]);\n          }\n          break;\n        }\n      }\n    }\n    // [] \n    let contestAttrList = [];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content && sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!contestAttrList.includes(attr.name)) contestAttrList.push(attr.name);\n              });\n            }\n          });\n          break;\n        }\n      }\n    }\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const attrStr = sheet.content[1][7] || '';\n          playerAttrs = parseAttributeString(attrStr);\n        }\n\n        if (sheet.name === '' && opponentName) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1] === opponentName) {\n              const attrStr = row[9] || '';\n              opponentAttrs = parseAttributeString(attrStr);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    const t = getThemeColors();\n    const isCyberTheme = getConfig().theme === 'cyber';\n    const inputTextColor = isCyberTheme ? '#ff00ff' : t.inputText;\n    // \n    const inputStyle = `width:100%;padding:5px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:4px;color:${inputTextColor} !important;font-size:12px;text-align:center;box-sizing:border-box;`;\n\n    const buildAttrButtons = (attrs, targetType) => {\n      let html = '';\n      // \n      for (let i = 0; i < attrs.length; i++) {\n        const attr = attrs[i];\n        html +=\n          '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n          attr.value +\n          '\" data-aname=\"' +\n          escapeHtml(attr.name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" style=\"padding:3px 8px;background:' +\n          t.inputBg +\n          ';border:1px solid ' +\n          t.border +\n          ';border-radius:4px;color:' +\n          t.inputText +\n          ';font-size:11px;cursor:pointer;margin:2px;\">' +\n          escapeHtml(attr.name) +\n          ': ' +\n          attr.value +\n          '</button>';\n      }\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.accent +\n        ';border-radius:3px;color:' +\n        t.accent +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin:2px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.errorText +\n        ';border-radius:3px;color:' +\n        t.errorText +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin:2px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\" style=\"font-size:9px;\"></i></button>';\n      return html;\n    };\n\n    const overlay = $(\n      '<div class=\"acu-contest-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:' +\n        t.overlayBg +\n        ';z-index:2147483647;\"></div>',\n    );\n    const panelHtml =\n      '<div class=\"acu-contest-panel acu-theme-' +\n      config.theme +\n      '\" style=\"position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:360px;max-width:92vw;background:' +\n      t.bgPanel +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:12px;box-shadow:0 20px 60px ' +\n      t.shadowBg +\n      ';z-index:2147483648;overflow:hidden;\">' +\n      '<div style=\"padding:12px 15px;background:' +\n      t.tableHead +\n      ';border-bottom:1px solid ' +\n      t.border +\n      ';display:flex;justify-content:space-between;align-items:center;\">' +\n      '<div style=\"font-size:15px;font-weight:bold;color:' +\n      t.accent +\n      ';display:flex;align-items:center;gap:8px;\"><i class=\"fa-solid fa-people-arrows\"></i> </div>' +\n      '<div style=\"display:flex;align-items:center;gap:8px;\">' +\n      '<button id=\"contest-switch-normal\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:14px;padding:4px;transition:all 0.2s;\" title=\"\"><i class=\"fa-solid fa-dice-d20\"></i></button>' +\n      '<button class=\"acu-contest-config-btn\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:14px;padding:4px;transition:all 0.2s;\" title=\"\"><i class=\"fa-solid fa-cog\"></i></button>' +\n      '<button class=\"acu-contest-close\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>' +\n      '</div>' +\n      '</div>' +\n      '<div style=\"padding:15px;max-height:70vh;overflow-y:auto;\">' +\n      '<div style=\"display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;align-items:center;\">' +\n      '<button class=\"acu-contest-preset' +\n      (diceType === '1d20' ? ' active' : '') +\n      '\" data-dice=\"1d20\" style=\"padding:4px 10px;background:' +\n      (diceType === '1d20' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (diceType === '1d20' ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\">1d20</button>' +\n      '<button class=\"acu-contest-preset' +\n      (diceType === '1d100' ? ' active' : '') +\n      '\" data-dice=\"1d100\" style=\"padding:4px 10px;background:' +\n      (diceType === '1d100' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (diceType === '1d100' ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\">1d100</button>' +\n      '<button class=\"acu-contest-preset acu-contest-custom-btn\" data-dice=\"custom\" style=\"padding:4px 10px;background:' +\n      (!['1d20', '1d100'].includes(diceType) ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (!['1d20', '1d100'].includes(diceType) ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\"></button>' +\n      '<input type=\"text\" id=\"contest-custom-dice\" placeholder=\"2d6\" value=\"' +\n      (!['1d20', '1d100'].includes(diceType) ? diceType : '') +\n      '\" style=\"width:60px;padding:4px 6px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      inputTextColor +\n      ' !important;font-size:11px;text-align:center;box-sizing:border-box;\" />' +\n      '</div>' +\n      '<input type=\"hidden\" id=\"contest-dice-type\" value=\"' +\n      diceType +\n      '\">' +\n      '<div style=\"font-size:11px;color:' +\n      t.accent +\n      ';font-weight:bold;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-init-char-buttons\" style=\"display:flex;flex-wrap:wrap;gap:3px;\"></div></div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-display\" value=\"\" placeholder=\"<user>\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;gap:6px;\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-init-random-skill\" title=\"\" style=\"width:18px;height:18px;padding:0;background:transparent;border:1px dashed ' +\n      t.accent +\n      ';border-radius:4px;color:' +\n      t.accent +\n      ';font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" id=\"contest-init-name\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-value\" value=\"' +\n      (passedInitiatorValue !== undefined ? passedInitiatorValue : '') +\n      '\" placeholder=\"=50%\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-target\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div id=\"init-attr-buttons\" style=\"display:flex;flex-wrap:wrap;gap:2px;margin-bottom:8px;max-height:50px;overflow-y:auto;\">' +\n      buildAttrButtons(playerAttrs, 'init') +\n      '</div>' +\n      '<div style=\"font-size:11px;color:' +\n      t.accent +\n      ';font-weight:bold;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-opp-char-buttons\" style=\"display:flex;flex-wrap:wrap;gap:3px;\"></div></div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opponent-display\" value=\"' +\n      escapeHtml(opponentName) +\n      '\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;gap:6px;\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-opp-random-skill\" title=\"\" style=\"width:18px;height:18px;padding:0;background:transparent;border:1px dashed ' +\n      t.accent +\n      ';border-radius:4px;color:' +\n      t.accent +\n      ';font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" id=\"contest-opp-name\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opp-value\" value=\"' +\n      (passedOpponentValue !== undefined ? passedOpponentValue : '') +\n      '\" placeholder=\"=50%\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opp-target\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div id=\"opp-attr-buttons\" style=\"display:flex;flex-wrap:wrap;gap:2px;margin-bottom:10px;max-height:50px;overflow-y:auto;\">' +\n      buildAttrButtons(opponentAttrs, 'opp') +\n      '</div>' +\n      '<div id=\"contest-result-display\" style=\"display:none;margin-bottom:10px;padding:8px;background:' +\n      t.inputBg +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:6px;\">' +\n      '<div style=\"display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;width:100%;\">' +\n      '<div id=\"contest-result-init\" style=\"display:flex;align-items:center;gap:4px;min-width:0;flex:1;\"></div>' +\n      '<span style=\"color:' +\n      t.textSub +\n      ';opacity:0.9;font-size:11px;font-weight:bold;white-space:nowrap;\">VS</span>' +\n      '<div id=\"contest-result-opp\" style=\"display:flex;align-items:center;gap:4px;min-width:0;flex:1;justify-content:flex-end;\"></div>' +\n      '</div>' +\n      '</div>' +\n      '<button id=\"contest-roll-btn\" style=\"width:100%;padding:12px;background:' +\n      (t.buttonBg || t.accent) +\n      ';border:none;border-radius:8px;color:' +\n      t.buttonText +\n      ';font-size:15px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;position:relative;\"><i class=\"fa-solid fa-dice\"></i> </button>' +\n      '</div>' +\n      '</div>';\n\n    const panel = $(panelHtml);\n    $('body').append(overlay).append(panel);\n\n    // []  - \n    const buildCharBtns = targetType => {\n      const containerId = targetType === 'init' ? '#contest-init-char-buttons' : '#contest-opp-char-buttons';\n      const $container = panel.find(containerId);\n      let html = '';\n      characterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html +=\n          '<button class=\"acu-contest-char-btn\" data-char=\"' +\n          escapeHtml(name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" style=\"padding:3px 8px;background:' +\n          t.btnBg +\n          ';border:1px solid ' +\n          t.border +\n          ';border-radius:4px;color:' +\n          t.textMain +\n          ';font-size:11px;cursor:pointer;white-space:nowrap;\" title=\"' +\n          escapeHtml(displayName) +\n          '\">' +\n          escapeHtml(shortName) +\n          '</button>';\n      });\n      $container.html(html);\n      $container.find('.acu-contest-char-btn').click(function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const charName = $(this).data('char');\n        const type = $(this).data('type');\n        if (type === 'init') {\n          panel.find('#contest-init-display').val(charName).trigger('change');\n        } else {\n          panel.find('#contest-opponent-display').val(charName).trigger('change');\n        }\n      });\n    };\n\n    // [] \n    const rebuildAttrBtns = (attrs, targetType) => {\n      const containerId = targetType === 'init' ? '#init-attr-buttons' : '#opp-attr-buttons';\n      const $container = panel.find(containerId);\n\n      // \n      $container.show();\n\n      let html = '';\n\n      // \n      if (attrs.length > 0) {\n        attrs.forEach(attr => {\n          html +=\n            '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n            attr.value +\n            '\" data-aname=\"' +\n            escapeHtml(attr.name) +\n            '\" data-type=\"' +\n            targetType +\n            '\" style=\"padding:2px 6px;background:' +\n            t.inputBg +\n            ';border:1px solid ' +\n            t.border +\n            ';border-radius:3px;color:' +\n            t.inputText +\n            ';font-size:10px;cursor:pointer;\">' +\n            escapeHtml(attr.name) +\n            ':' +\n            attr.value +\n            '</button>';\n        });\n      }\n\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.accent +\n        ';border-radius:3px;color:' +\n        t.accent +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.errorText +\n        ';border-radius:3px;color:' +\n        t.errorText +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin-left:4px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\" style=\"font-size:9px;\"></i></button>';\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-contest-attr-btn').click(function () {\n        const val = $(this).attr('data-val');\n        const aname = $(this).attr('data-aname');\n        const type = $(this).attr('data-type');\n        if (type === 'init') {\n          panel.find('#contest-init-value').val(val);\n          panel.find('#contest-init-name').val(aname);\n        } else {\n          panel.find('#contest-opp-value').val(val);\n          panel.find('#contest-opp-name').val(aname);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          // \n          let charName;\n          if (type === 'init') {\n            charName = panel.find('#contest-init-display').val().trim() || '<user>';\n          } else {\n            charName = panel.find('#contest-opponent-display').val().trim();\n          }\n\n          if (!charName) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        let charName;\n        if (type === 'init') {\n          charName = panel.find('#contest-init-display').val().trim() || '<user>';\n        } else {\n          charName = panel.find('#contest-opponent-display').val().trim();\n        }\n\n        if (!charName) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharBtns('init');\n    buildCharBtns('opp');\n    // [] \n    panel.find('#contest-init-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-init-name').val(randomSkill).trigger('change');\n    });\n\n    // [] \n    panel.find('#contest-opp-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-opp-name').val(randomSkill).trigger('change');\n    });\n    //  rebuildAttrBtns /\n    const initAttrs = getFullAttributesForCharacter(passedInitiatorName || '<user>');\n    rebuildAttrBtns(initAttrs, 'init');\n    const oppAttrs = getFullAttributesForCharacter(opponentName || '');\n    rebuildAttrBtns(oppAttrs, 'opp');\n\n    // \n    initCustomDropdown(panel.find('#contest-init-display'), characterList, t);\n    initCustomDropdown(panel.find('#contest-opponent-display'), characterList, t);\n    initCustomDropdown(panel.find('#contest-init-name'), contestAttrList, t);\n    initCustomDropdown(panel.find('#contest-opp-name'), contestAttrList, t);\n    addClearButton(\n      panel,\n      '#contest-init-display, #contest-init-name, #contest-init-value, #contest-init-target, #contest-opponent-display, #contest-opp-name, #contest-opp-value, #contest-opp-target',\n      t,\n    );\n\n    // \n    panel.find('#contest-init-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-init-name'), newAttrList.length > 0 ? newAttrList : contestAttrList, t);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'init');\n    });\n\n    // \n    panel.find('#contest-opponent-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim();\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-opp-name'), newAttrList.length > 0 ? newAttrList : contestAttrList, t);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'opp');\n    });\n\n    // \n    panel.find('#contest-init-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-init-display').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-init-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('#contest-opp-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-opponent-display').val().trim();\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-opp-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('.acu-contest-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-contest-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n      panel.find('#contest-dice-type').val(newDice);\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n    });\n\n    // \n    panel.find('.acu-contest-custom-btn').click(function () {\n      // \n      panel.find('.acu-contest-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      var customDice = panel.find('#contest-custom-dice').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#contest-custom-dice').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      panel.find('#contest-dice-type').val(customDice);\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n    });\n\n    // \n    panel.find('#contest-custom-dice').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-contest-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = function (formula) {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], sides: 100 };\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      return {\n        total:\n          rolls.reduce(function (a, b) {\n            return a + b;\n          }, 0) + modifier,\n        rolls: rolls,\n        sides: sides,\n      };\n    };\n\n    const getSuccessLevel = function (roll, target, sides) {\n      const t = getThemeColors();\n      if (sides === 100) {\n        if (roll <= 5) return { level: 3, name: '', color: t.critSuccessText };\n        if (roll >= 96) return { level: -1, name: '', color: t.critFailureText };\n        if (roll <= Math.floor(target / 5)) return { level: 2, name: '', color: t.extremeSuccessText };\n        if (roll <= Math.floor(target / 2)) return { level: 1, name: '', color: t.successText };\n        if (roll <= target) return { level: 0, name: '', color: t.warningText };\n        return { level: -1, name: '', color: t.failureText };\n      } else {\n        if (roll === 20) return { level: 3, name: '', color: t.critSuccessText };\n        if (roll === 1) return { level: -1, name: '', color: t.critFailureText };\n        if (roll >= target) return { level: 0, name: '', color: t.successText };\n        return { level: -1, name: '', color: t.failureText };\n      }\n    };\n\n    // \n    const performContestRoll = function () {\n      var formula = panel.find('#contest-dice-type').val() || '1d100';\n\n      var initName = panel.find('#contest-init-display').val().trim() || '<user>';\n      var initAttrName = panel.find('#contest-init-name').val().trim() || '';\n      // \n      var getHalfMax = function (formulaStr) {\n        var m = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (m) return Math.round((parseInt(m[1], 10) * parseInt(m[2], 10)) / 2);\n        return 50;\n      };\n\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var initValue;\n      if (initValueInput === '') {\n        // \n        initValue = getHalfMax(formula);\n      } else {\n        initValue = parseInt(initValueInput, 10) || getHalfMax(formula);\n      }\n      var initTargetInput = panel.find('#contest-init-target').val().trim();\n      var initTarget;\n      if (initTargetInput !== '') {\n        initTarget = parseInt(initTargetInput, 10);\n      } else {\n        // \n        initTarget = initValue;\n      }\n\n      var oppName = panel.find('#contest-opponent-display').val().trim() || '';\n      var oppAttrName = panel.find('#contest-opp-name').val().trim() || initAttrName;\n      var oppValueInput = panel.find('#contest-opp-value').val().trim();\n      var oppValue;\n      if (oppValueInput === '') {\n        // \n        oppValue = getHalfMax(formula);\n      } else {\n        oppValue = parseInt(oppValueInput, 10) || getHalfMax(formula);\n      }\n      var oppTargetInput = panel.find('#contest-opp-target').val().trim();\n      var oppTarget;\n      if (oppTargetInput !== '') {\n        oppTarget = parseInt(oppTargetInput, 10);\n      } else {\n        // \n        oppTarget = oppValue;\n      }\n\n      var initResult = rollDice(formula);\n      var oppResult = rollDice(formula);\n      var initSuccess = getSuccessLevel(initResult.total, initTarget, initResult.sides);\n      var oppSuccess = getSuccessLevel(oppResult.total, oppTarget, oppResult.sides);\n\n      var winner, winnerColor, resultDesc;\n      var diceCfg = getDiceConfig();\n      var tieRule = diceCfg.contestTieRule || 'initiator_lose';\n      var hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      var displayInitValue = hideDiceResultFromUser ? '' : initResult.total;\n      var displayOppValue = hideDiceResultFromUser ? '' : oppResult.total;\n      var displayInitSuccessName = hideDiceResultFromUser ? '' : initSuccess.name;\n      var displayOppSuccessName = hideDiceResultFromUser ? '' : oppSuccess.name;\n\n      if (initSuccess.level > oppSuccess.level) {\n        winner = initName + ' ';\n        winnerColor = t.successText;\n        resultDesc = initSuccess.name + '  ' + oppSuccess.name;\n      } else if (initSuccess.level < oppSuccess.level) {\n        winner = oppName + ' ';\n        winnerColor = t.failureText;\n        resultDesc = oppSuccess.name + '  ' + initSuccess.name;\n      } else {\n        // \n        resultDesc = ' ' + initSuccess.name;\n        if (tieRule === 'initiator_win') {\n          winner = '' + initName + ' ';\n          winnerColor = t.successText;\n        } else if (tieRule === 'tie') {\n          winner = '';\n          winnerColor = t.warningText;\n        } else {\n          // : initiator_lose\n          winner = '' + initName + ' ';\n          winnerColor = t.failureText;\n        }\n      }\n\n      var displayWinner = hideDiceResultFromUser ? '' : winner;\n\n      // \n      const getResultTypeFromSuccess = success => {\n        if (success.level === 3) return 'critSuccess';\n        if (success.level === 2) return 'extremeSuccess';\n        if (success.level === 1) return 'success';\n        if (success.level === 0) return 'warning';\n        if (success.level === -1) {\n          // name\n          return success.name === '' ? 'critFailure' : 'failure';\n        }\n        return 'failure';\n      };\n      const initResultType = getResultTypeFromSuccess(initSuccess);\n      const oppResultType = getResultTypeFromSuccess(oppSuccess);\n\n      const initBadgeStyle = getResultBadgeStyle(initResultType, t);\n      const oppBadgeStyle = getResultBadgeStyle(oppResultType, t);\n      const winnerBadgeStyle = getResultBadgeStyle(\n        winnerColor === t.successText ? 'success' : winnerColor === t.warningText ? 'warning' : 'failure',\n        t,\n      );\n\n      const initBadgeStyleStr = Object.entries(initBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n      const oppBadgeStyleStr = Object.entries(oppBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n      const winnerBadgeStyleStr = Object.entries(winnerBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n\n      // \n      const $resultDisplay = panel.find('#contest-result-display');\n      const $resultInit = panel.find('#contest-result-init');\n      const $resultOpp = panel.find('#contest-result-opp');\n\n      // \n      $resultInit.html(\n        '<span style=\"font-size:11px;color:' +\n          t.textMain +\n          ';opacity:0.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;\">' +\n          escapeHtml(initName) +\n          '</span>' +\n          '<span style=\"font-size:16px;font-weight:bold;color:' +\n          t.textMain +\n          ';\">' +\n          displayInitValue +\n          '</span>' +\n          (displayInitSuccessName\n            ? '<span style=\"' + initBadgeStyleStr + '\">' + displayInitSuccessName + '</span>'\n            : ''),\n      );\n\n      // \n      $resultOpp.html(\n        (displayOppSuccessName ? '<span style=\"' + oppBadgeStyleStr + '\">' + displayOppSuccessName + '</span>' : '') +\n          '<span style=\"font-size:16px;font-weight:bold;color:' +\n          t.textMain +\n          ';\">' +\n          displayOppValue +\n          '</span>' +\n          '<span style=\"font-size:11px;color:' +\n          t.textMain +\n          ';opacity:0.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;\">' +\n          escapeHtml(oppName) +\n          '</span>',\n      );\n\n      $resultDisplay.show();\n\n      // \n      const $contestBtn = panel.find('#contest-roll-btn');\n      $contestBtn.html(\n        '<div style=\"display:flex; align-items:center; justify-content:center; width:100%; gap:8px;\">' +\n          (displayWinner ? '<span style=\"' + winnerBadgeStyleStr + '\">' + displayWinner + '</span>' : '') +\n          '<button class=\"contest-retry-btn\" style=\"background:transparent; border:none; color:' +\n          t.buttonText +\n          '; cursor:pointer; padding:4px; display:flex; align-items:center; justify-content:center; opacity:0.8; transition:opacity 0.2s;\" title=\"\">' +\n          '<i class=\"fa-solid fa-rotate-right\"></i>' +\n          '</button>' +\n          '</div>',\n      );\n\n      // \n      $contestBtn.off('click', '.contest-retry-btn').on('click', '.contest-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        // \n        performContestRoll();\n      });\n\n      const contestResultText =\n        `${initName} ${initAttrName} vs ${oppName} ${oppAttrName}` +\n        `${initName} ${initAttrName} (${initTarget})  ${initResult.total}${initSuccess.name}` +\n        `${oppName} ${oppAttrName} (${oppTarget})  ${oppResult.total}${oppSuccess.name}` +\n        `${winner}`;\n      smartInsertToTextarea(contestResultText, 'dice');\n    };\n\n    // \n    panel.find('#contest-roll-btn').click(function () {\n      performContestRoll();\n    });\n\n    // [] \n    panel.find('#contest-switch-normal').click(function () {\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var currentInitName = panel.find('#contest-init-name').val() || '';\n      var currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      var initiatorNameVal = panel.find('#contest-init-display').val().trim();\n      closePanel();\n      showDicePanel({\n        //  null  placeholder\n        targetValue: initValueInput !== '' ? parseInt(initValueInput, 10) : null,\n        targetName: currentInitName,\n        diceType: currentDice,\n        initiatorName: initiatorNameVal,\n      });\n    });\n    //  - \n    // 1d20 -> DND,  -> COC\n    panel.find('.acu-contest-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      const isDND = currentDice === '1d20';\n      showDiceSettingsPanel(isDND);\n    });\n    var closePanel = function () {\n      overlay.remove();\n      panel.remove();\n    };\n    overlay.click(closePanel);\n    panel.find('.acu-contest-close').click(closePanel);\n  };\n\n  const parseInSceneStatus = (value, headerName) => {\n    const val = String(value || '')\n      .trim()\n      .toLowerCase();\n    const header = String(headerName || '').toLowerCase();\n    if (!val) return false;\n\n    if (header.includes('')) {\n      return val === '' || val === 'false' || val === 'no';\n    }\n\n    return val.startsWith('') || val === 'true' || val === '' || val === 'yes';\n  };\n\n  const buildMapViewModel = async () => {\n    const rawData = cachedRawData || getTableData();\n    const allTables = processJsonData(rawData || {});\n    if (!rawData || Object.keys(allTables).length === 0) return null;\n\n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const elementResult = (() => {\n      const keywords = ['', '', '', '', ''];\n      for (const tableName in allTables) {\n        if (keywords.some(keyword => tableName.includes(keyword))) {\n          return {\n            data: allTables[tableName],\n            name: tableName,\n            key: allTables[tableName].key,\n          };\n        }\n      }\n      return null;\n    })();\n\n    const globalHeaders = globalResult?.data?.headers || [];\n    const globalRows = globalResult?.data?.rows || [];\n    const globalRow = globalRows[0] || [];\n    const globalConfig = DASHBOARD_TABLE_CONFIG.global;\n    const detailIdx = DashboardDataParser.findColumnIndex(globalHeaders, 'detailLocation', globalConfig);\n    const regionIdx = DashboardDataParser.findColumnIndex(globalHeaders, 'currentLocation', globalConfig);\n    const detailLocation = detailIdx >= 0 ? String(globalRow[detailIdx] || '').trim() : '';\n    const currentRegion = regionIdx >= 0 ? String(globalRow[regionIdx] || '').trim() : '';\n\n    if (!locationResult?.data) return null;\n\n    const findColumnIndex = (headers, keywords, fallbackIndex = null) => {\n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (keywords.some(keyword => h.includes(keyword.toLowerCase()))) return i;\n      }\n      return fallbackIndex ?? -1;\n    };\n\n    const locations = new Map();\n    const locationHeaders = locationResult.data.headers || [];\n    const locationRows = locationResult.data.rows || [];\n    const locationNameIdx = findColumnIndex(locationHeaders, ['', '', '', '', ''], 1);\n    const locationRegionIdx = findColumnIndex(locationHeaders, ['', '', '', ''], null);\n    const locationTypeIdx = findColumnIndex(locationHeaders, ['', '', ''], null);\n    const locationDescIdx = findColumnIndex(locationHeaders, ['', '', '', '', ''], null);\n    const locationImportanceIdx = findColumnIndex(locationHeaders, ['', ''], null);\n    const locationExploreIdx = findColumnIndex(locationHeaders, ['', '', ''], null);\n\n    // emoji\n    const allLocationNames: string[] = [];\n    locationRows.forEach(row => {\n      const name = String(row[locationNameIdx] || '')\n        .trim()\n        .replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n      if (name) allLocationNames.push(name);\n    });\n    const emojiMap = resolveBatchLocationEmojis(allLocationNames);\n\n    locationRows.forEach((row, idx) => {\n      const name = String(row[locationNameIdx] || '')\n        .trim()\n        .replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n      if (!name) return;\n      const region = locationRegionIdx >= 0 ? String(row[locationRegionIdx] || '').trim() : '';\n\n      const location = {\n        name,\n        region,\n        locationType: locationTypeIdx >= 0 ? row[locationTypeIdx] || '' : '',\n        description: locationDescIdx >= 0 ? row[locationDescIdx] || '' : '',\n        importance: locationImportanceIdx >= 0 ? row[locationImportanceIdx] || '' : '',\n        exploreStatus: locationExploreIdx >= 0 ? row[locationExploreIdx] || '' : '',\n        emoji: emojiMap.get(name) ?? null,\n        tableKey: locationResult.key || '',\n        rowIndex: idx,\n      };\n      locations.set(name, location);\n    });\n\n    const elements = new Map();\n    const addElement = (locationName, element) => {\n      if (!elements.has(locationName)) {\n        elements.set(locationName, []);\n      }\n      elements.get(locationName).push(element);\n    };\n\n    if (elementResult?.data) {\n      const elementHeaders = elementResult.data.headers || [];\n      const elementRows = elementResult.data.rows || [];\n      const elementNameIdx = findColumnIndex(elementHeaders, ['', '', ''], 1);\n      const elementTypeIdx = findColumnIndex(elementHeaders, ['', '', ''], 2);\n      const elementLocationIdx = findColumnIndex(elementHeaders, ['', '', ''], 3);\n      const elementDescIdx = findColumnIndex(elementHeaders, ['', '', ''], null);\n      const elementStatusIdx = findColumnIndex(elementHeaders, ['', ''], null);\n      const elementInteractIdx = findColumnIndex(elementHeaders, ['', '', '', ''], null);\n\n      elementRows.forEach((row, idx) => {\n        const name = String(row[elementNameIdx] || '').trim();\n        if (!name) return;\n        const locationName = String(row[elementLocationIdx] || '').trim();\n        if (!locationName) return;\n        if (currentRegion && locations.size > 0 && !locations.has(locationName)) return;\n\n        const rawInteractions = elementInteractIdx >= 0 ? row[elementInteractIdx] : '';\n        const interactions = String(rawInteractions || '')\n          .split(/[,;]/)\n          .map(item => item.trim())\n          .filter(Boolean);\n        const typeValue = elementTypeIdx >= 0 ? row[elementTypeIdx] || '' : '';\n        const element = {\n          name,\n          type: typeValue,\n          location: locationName,\n          description: elementDescIdx >= 0 ? row[elementDescIdx] || '' : '',\n          status: elementStatusIdx >= 0 ? row[elementStatusIdx] || '' : '',\n          interactions,\n          emoji: getElementEmoji(name, typeValue),\n          tableKey: elementResult.key || '',\n          rowIndex: idx,\n        };\n        addElement(locationName, element);\n      });\n    }\n\n    const characters = new Map();\n    const addCharacter = async character => {\n      const avatarUrl = await AvatarManager.getAsync(character.name);\n      const full = {\n        ...character,\n        avatarUrl,\n        avatarOffsetX: AvatarManager.getOffsetX(character.name),\n        avatarOffsetY: AvatarManager.getOffsetY(character.name),\n        avatarScale: AvatarManager.getScale(character.name),\n      };\n      if (!characters.has(full.location)) {\n        characters.set(full.location, []);\n      }\n      characters.get(full.location).push(full);\n    };\n\n    let playerLocation = '';\n\n    if (playerResult?.data) {\n      const playerConfig = DASHBOARD_TABLE_CONFIG.player;\n      const playerHeaders = playerResult.data.headers || [];\n      const playerRows = playerResult.data.rows || [];\n      const playerRow = playerRows[0] || [];\n      const playerNameIdx = DashboardDataParser.findColumnIndex(playerHeaders, 'name', playerConfig);\n      const playerPosIdx = DashboardDataParser.findColumnIndex(playerHeaders, 'position', playerConfig);\n      const playerNameRaw = playerNameIdx >= 0 ? playerRow[playerNameIdx] : getPlayerName();\n      const playerPosRaw = playerPosIdx >= 0 ? playerRow[playerPosIdx] : '';\n      const playerName = String(playerNameRaw || '').trim();\n      playerLocation = String(playerPosRaw || '').trim();\n\n      if (!playerLocation && detailLocation) {\n        playerLocation = detailLocation;\n      }\n\n      if (playerName && playerLocation) {\n        await addCharacter({\n          name: playerName,\n          location: playerLocation,\n          isPlayer: true,\n          isInScene: true,\n          tableKey: playerResult.key || '',\n          rowIndex: 0,\n        });\n      }\n    }\n\n    if (npcResult?.data) {\n      const npcConfig = DASHBOARD_TABLE_CONFIG.npc;\n      const npcHeaders = npcResult.data.headers || [];\n      const npcRows = npcResult.data.rows || [];\n      const npcNameIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'name', npcConfig);\n      const npcPosIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'position', npcConfig);\n      const npcInSceneIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'inScene', npcConfig);\n\n      for (let idx = 0; idx < npcRows.length; idx++) {\n        const row = npcRows[idx];\n        const npcName = String(row[npcNameIdx] || '').trim();\n        if (!npcName) continue;\n        const locationName = String(row[npcPosIdx] || '').trim();\n        if (!locationName) continue;\n        if (currentRegion && locations.size > 0 && !locations.has(locationName)) continue;\n        const inSceneValue = npcInSceneIdx >= 0 ? row[npcInSceneIdx] : '';\n        const inSceneHeader = npcHeaders[npcInSceneIdx] || '';\n        const isInScene = parseInSceneStatus(inSceneValue, inSceneHeader);\n\n        await addCharacter({\n          name: npcName,\n          location: locationName,\n          isPlayer: false,\n          isInScene,\n          tableKey: npcResult.key || '',\n          rowIndex: idx,\n        });\n      }\n    }\n\n    const locationIterator = locations.values();\n    const firstLocation = locationIterator.next().value;\n\n    const allRegions = [...new Set(Array.from(locations.values()).map(l => l.region || ''))].sort();\n    // \"\"\n    const otherIndex = allRegions.indexOf('');\n    if (otherIndex > -1) {\n      allRegions.splice(otherIndex, 1);\n      allRegions.push('');\n    }\n\n    const getHotLocationsInRegion = region => {\n      const regionName = region || '';\n      return Array.from(locations.values())\n        .filter(l => (l.region || '') === regionName)\n        .sort((a, b) => {\n          const scoreA = (characters.get(a.name)?.length || 0) + (elements.get(a.name)?.length || 0);\n          const scoreB = (characters.get(b.name)?.length || 0) + (elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n    };\n\n    const focusLocation = (() => {\n      if (detailLocation && locations.has(detailLocation)) return detailLocation;\n      if (playerLocation && locations.has(playerLocation)) return playerLocation;\n      const fallbackRegion = allRegions[0];\n      if (fallbackRegion) {\n        const regionLocations = getHotLocationsInRegion(fallbackRegion);\n        if (regionLocations.length > 0) return regionLocations[0].name;\n      }\n      return firstLocation ? firstLocation.name : '';\n    })();\n\n    return {\n      currentRegion: currentRegion || locations.get(playerLocation)?.region || '',\n      detailLocation,\n      focusLocation,\n      playerLocation,\n      locations,\n      elements,\n      characters,\n      allRegions,\n    };\n  };\n\n  // \n  let isMapOpening = false;\n\n  const showMapVisualization = async () => {\n    const { $ } = getCore();\n\n    // \n    if (isMapOpening) return;\n    isMapOpening = true;\n\n    // overlay\n    $('.acu-map-overlay').remove();\n\n    let viewModel = await buildMapViewModel();\n    if (!viewModel) {\n      isMapOpening = false;\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const config = getConfig();\n\n    // \n    const tabSelectionCache = new Map<string, string>();\n\n    // \n    const getHotLocationsInRegion = (region: string) => {\n      const regionName = region || '';\n      return Array.from(viewModel.locations.values())\n        .filter(l => (l.region || '') === regionName)\n        .sort((a, b) => {\n          const scoreA =\n            (viewModel.characters.get(a.name)?.length || 0) + (viewModel.elements.get(a.name)?.length || 0);\n          const scoreB =\n            (viewModel.characters.get(b.name)?.length || 0) + (viewModel.elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n    };\n\n    // \"\"\n    const detailLocation = viewModel.detailLocation || '';\n    const playerLocation = viewModel.playerLocation || '';\n    let focusLocation = '';\n    let selectedRegion = viewModel.currentRegion;\n\n    // :  >  > viewModel.focusLocation\n    if (detailLocation && viewModel.locations.has(detailLocation)) {\n      focusLocation = detailLocation;\n      const targetLocation = viewModel.locations.get(detailLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n      focusLocation = playerLocation;\n      const targetLocation = viewModel.locations.get(playerLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    } else if (viewModel.focusLocation && viewModel.locations.has(viewModel.focusLocation)) {\n      focusLocation = viewModel.focusLocation;\n      const targetLocation = viewModel.locations.get(focusLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    }\n\n    if (focusLocation) {\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      // \n      tabSelectionCache.set(selectedRegion, focusLocation);\n    }\n\n    const overlay = $(`\n            <div class=\"acu-map-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-map-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-map-title\">\n                            <i class=\"fa-solid fa-map-location-dot\"></i>\n                            <span class=\"acu-map-region-name\">${escapeHtml(viewModel.currentRegion || '')}</span>\n                        </div>\n                        <div class=\"acu-map-region-tabs\"></div>\n                        <div class=\"acu-map-actions\">\n                            <button class=\"acu-map-back-btn\" title=\"\"><i class=\"fa-solid fa-location-crosshairs\"></i></button>\n                            <button class=\"acu-close-btn acu-map-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-map-body\">\n                        <div class=\"acu-map-focus-area\"></div>\n                        <div class=\"acu-map-thumbnails\"></div>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const overlayEl = overlay[0];\n    overlayEl.style.setProperty('position', 'fixed', 'important');\n    overlayEl.style.setProperty('top', '0', 'important');\n    overlayEl.style.setProperty('left', '0', 'important');\n    overlayEl.style.setProperty('right', '0', 'important');\n    overlayEl.style.setProperty('bottom', '0', 'important');\n    overlayEl.style.setProperty('width', '100vw', 'important');\n    overlayEl.style.setProperty('height', '100vh', 'important');\n    overlayEl.style.setProperty('display', 'flex', 'important');\n    overlayEl.style.setProperty('justify-content', 'center', 'important');\n    overlayEl.style.setProperty('align-items', 'center', 'important');\n    overlayEl.style.setProperty('z-index', '2147483650', 'important');\n\n    // selectedRegion \n    const $focusArea = overlay.find('.acu-map-focus-area');\n    const $thumbnails = overlay.find('.acu-map-thumbnails');\n\n    const renderElementChip = element => {\n      const name = element.name || element.type || '';\n      const emoji = element.emoji ? `<span class=\"acu-map-chip-emoji\">${element.emoji}</span>` : '';\n      return `\n                 <div class=\"acu-map-element-chip acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n                   element.tableKey || '',\n                 )}\" data-row-index=\"${element.rowIndex}\">\n                     ${emoji}\n                     <span class=\"acu-map-chip-name\" title=\"${escapeHtml(name)}\">${escapeHtml(name)}</span>\n                 </div>\n             `;\n    };\n\n    const renderFocusArea = (model, locationName) => {\n      const location = model.locations.get(locationName);\n      if (!location) {\n        return '<div class=\"acu-map-loading\" style=\"grid-column: 1 / -1;\"><div class=\"acu-map-spinner\"></div></div>';\n      }\n\n      const characters = model.characters.get(locationName) || [];\n      const elements = model.elements.get(locationName) || [];\n\n      // \n      const leftChars = characters.slice(0, Math.ceil(characters.length / 2));\n      const rightChars = characters.slice(Math.ceil(characters.length / 2));\n      const leftElems = elements.slice(0, Math.ceil(elements.length / 2));\n      const rightElems = elements.slice(Math.ceil(elements.length / 2));\n\n      const renderAvatarHtml = char => {\n        const displayName = replaceUserPlaceholders(char.name);\n        const avatarStyle = char.avatarUrl\n          ? `background-image:url('${char.avatarUrl}');background-size:${char.avatarScale}%;background-position:${char.avatarOffsetX}% ${char.avatarOffsetY}%;`\n          : '';\n        return `\n            <div class=\"acu-map-avatar acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n              char.tableKey || '',\n            )}\" data-row-index=\"${char.rowIndex}\">\n                <div class=\"acu-map-avatar-circle\" style=\"${avatarStyle}\">\n                    ${char.avatarUrl ? '' : `<span>${escapeHtml(displayName.charAt(0))}</span>`}\n                </div>\n                <div class=\"acu-map-avatar-name\" title=\"${escapeHtml(displayName)}\">${escapeHtml(\n                  displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName,\n                )}</div>\n            </div>\n        `;\n      };\n\n      const leftAvatarsHtml = leftChars.length ? leftChars.map(renderAvatarHtml).join('') : '';\n      const rightAvatarsHtml = rightChars.length ? rightChars.map(renderAvatarHtml).join('') : '';\n      const leftElemsHtml = leftElems.length ? leftElems.map(e => renderElementChip(e)).join('') : '';\n      const rightElemsHtml = rightElems.length ? rightElems.map(e => renderElementChip(e)).join('') : '';\n\n      const emojiHtml = location.emoji\n        ? `<div class=\"acu-map-location-emoji\">${location.emoji}</div>`\n        : `<div class=\"acu-map-location-text\">${escapeHtml(location.name.charAt(0) || '')}</div>`;\n\n      return `\n        <div class=\"acu-map-wing left\">\n            <div class=\"acu-map-avatar-group acu-group-left\">${leftAvatarsHtml || ''}</div>\n            <div class=\"acu-map-element-group acu-group-left\">${leftElemsHtml || ''}</div>\n        </div>\n        <div class=\"acu-map-stage-center acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n          location.tableKey,\n        )}\" data-row-index=\"${location.rowIndex}\">\n            ${emojiHtml}\n            <div class=\"acu-map-location-name\" title=\"${escapeHtml(location.name)}\">${escapeHtml(location.name)}</div>\n        </div>\n        <div class=\"acu-map-wing right\">\n            <div class=\"acu-map-avatar-group acu-group-right\">${rightAvatarsHtml || ''}</div>\n            <div class=\"acu-map-element-group acu-group-right\">${rightElemsHtml || ''}</div>\n        </div>\n        <div class=\"acu-map-mobile-stack\">\n            <div class=\"acu-map-mobile-avatars\">${leftAvatarsHtml || ''}${rightAvatarsHtml || ''}</div>\n            <div class=\"acu-map-mobile-elements\">${leftElemsHtml || ''}${rightElemsHtml || ''}</div>\n        </div>\n    `;\n    };\n\n    const renderThumbnailLocation = (model, location, isActive) => {\n      const charCount = (model.characters.get(location.name) || []).length;\n      const elementCount = (model.elements.get(location.name) || []).length;\n      const totalCount = charCount + elementCount;\n      const emoji = location.emoji\n        ? `<div class=\"acu-map-thumbnail-emoji\">${location.emoji}</div>`\n        : `<div class=\"acu-map-thumbnail-placeholder\">${escapeHtml(location.name.charAt(0) || '')}</div>`;\n      const badgeHtml = totalCount > 0 ? `<div class=\"acu-map-thumbnail-badge\">${totalCount}</div>` : '';\n      return `\n        <div class=\"acu-map-thumbnail ${isActive ? 'active' : ''}\" data-location=\"${escapeHtml(location.name)}\">\n            ${badgeHtml}\n            ${emoji}\n            <div class=\"acu-map-thumbnail-name\" title=\"${escapeHtml(location.name)}\">${escapeHtml(\n              location.name.length > 6 ? location.name.substring(0, 6) + '..' : location.name,\n            )}</div>\n        </div>\n    `;\n    };\n\n    const renderRegionTabs = (regions, currentRegion) => {\n      if (regions.length <= 1) return '';\n      return regions\n        .map(\n          r =>\n            `<button class=\"acu-map-region-tab ${r === currentRegion ? 'active' : ''}\" data-region=\"${escapeHtml(\n              r,\n            )}\">${escapeHtml(r)}</button>`,\n        )\n        .join('');\n    };\n\n    const refreshPanel = () => {\n      $focusArea.html(renderFocusArea(viewModel, focusLocation));\n\n      const regionLocations = Array.from(viewModel.locations.values())\n        .filter(l => (l.region || '') === selectedRegion)\n        .sort((a, b) => {\n          // :  + \n          const scoreA =\n            (viewModel.characters.get(a.name)?.length || 0) + (viewModel.elements.get(a.name)?.length || 0);\n          const scoreB =\n            (viewModel.characters.get(b.name)?.length || 0) + (viewModel.elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n\n      const thumbnails = regionLocations\n        .map(location => renderThumbnailLocation(viewModel, location, location.name === focusLocation))\n        .join('');\n      $thumbnails.html(thumbnails || '<div class=\"acu-map-empty\"></div>');\n\n      overlay.find('.acu-map-region-name').text(selectedRegion || '');\n      overlay.find('.acu-map-region-tabs').html(renderRegionTabs(viewModel.allRegions, selectedRegion));\n    };\n\n    const setFocusLocation = name => {\n      if (!name) return;\n      focusLocation = name;\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      // \n      tabSelectionCache.set(selectedRegion, focusLocation);\n      refreshPanel();\n    };\n\n    refreshPanel();\n\n    overlay.on('click', '.acu-map-close', () => {\n      overlay.remove();\n    });\n    overlay.on('click', '.acu-map-region-tab', function () {\n      const newRegion = $(this).data('region');\n      if (newRegion === selectedRegion) return;\n      selectedRegion = newRegion;\n\n      //  focusLocation \n      const regionLocations = Array.from(viewModel.locations.values()).filter(\n        l => (l.region || '') === selectedRegion,\n      );\n      const currentInNewRegion = regionLocations.find(l => l.name === focusLocation);\n\n      if (!currentInNewRegion && regionLocations.length > 0) {\n        // :  > \n        const cachedLocation = tabSelectionCache.get(selectedRegion);\n        const cachedInRegion = cachedLocation && regionLocations.find(l => l.name === cachedLocation);\n\n        if (cachedInRegion) {\n          // \n          focusLocation = cachedLocation;\n        } else {\n          // \n          const hotLocations = getHotLocationsInRegion(selectedRegion);\n          focusLocation = hotLocations.length > 0 ? hotLocations[0].name : regionLocations[0].name;\n        }\n        Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      }\n\n      refreshPanel();\n    });\n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-map-overlay')) {\n        overlay.remove();\n      }\n    });\n\n    overlay.on('click', '.acu-map-thumbnail', function () {\n      const locationName = $(this).data('location');\n      if (locationName) setFocusLocation(locationName);\n    });\n\n    overlay.on('click', '.acu-map-back-btn', () => {\n      const fallbackFocus = viewModel.focusLocation;\n      const detailLocation = viewModel.detailLocation || '';\n      const playerLocation = viewModel.playerLocation || '';\n\n      let target = '';\n      if (detailLocation && viewModel.locations.has(detailLocation)) {\n        target = detailLocation;\n      } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n        target = playerLocation;\n      } else if (fallbackFocus && viewModel.locations.has(fallbackFocus)) {\n        target = fallbackFocus;\n      }\n\n      if (!target) return;\n\n      // \n      const targetLocation = viewModel.locations.get(target);\n      const targetRegion = targetLocation?.region || viewModel.currentRegion || '';\n      if (targetRegion !== selectedRegion) {\n        selectedRegion = targetRegion;\n      }\n\n      focusLocation = target;\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      refreshPanel();\n    });\n\n    // \n    isMapOpening = false;\n\n    // \n    // \n  };\n\n  // \n  const showRelationshipGraph = npcTable => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n    $('.acu-relation-graph-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    const headers = npcTable.headers || [];\n    const rows = npcTable.rows || [];\n\n    const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n    const relationIdx = headers.findIndex(h => h && h.includes(''));\n    const npcTableKey = npcTable.key || '';\n\n    console.info(`[DICE]: \"${npcTableKey || ''}\"${rows.length}`);\n\n    if (relationIdx < 0) {\n      console.warn('[DICE]: \"\"');\n      if (window.toastr) window.toastr.warning('\"\"');\n      return;\n    }\n\n    const nodes = new Map();\n    const edges = [];\n\n    // {{user}}\n    const resolveUserPlaceholder = name => {\n      if (!name) return name;\n      const playerName = getPlayerName();\n      const personaName = getPersonaName();\n\n      // \n      const explicitUserVariants = ['<user>', '{{user}}'];\n      const isExplicitUserVariant = explicitUserVariants.some(\n        v => name === v || name.toLowerCase() === v.toLowerCase(),\n      );\n\n      // persona\n      const isPersonaName = personaName && name === personaName;\n\n      // \"\"\n      const isPlayerName = (() => {\n        if (!playerName) return false;\n        // \n        if (name === playerName) return true;\n        // \n        const primaryName = AvatarManager.getPrimaryName(name);\n        return primaryName === playerName;\n      })();\n\n      // {{user}}\n      if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n        return '{{user}}';\n      }\n\n      // \n      return AvatarManager.getPrimaryName(name);\n    };\n\n    const resolveName = name => resolveUserPlaceholder(name);\n\n    const rawData = cachedRawData || getTableData();\n    let playerName = '';\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]) {\n          playerName = sheet.content[1][1] || '';\n          break;\n        }\n      }\n    }\n    const resolvedPlayerName = resolveName(playerName);\n    const playerTableKey = (() => {\n      for (const k in rawData) {\n        if (rawData[k]?.name?.includes('')) return k;\n      }\n      return '';\n    })();\n    nodes.set(resolvedPlayerName, {\n      name: resolvedPlayerName,\n      isPlayer: true,\n      x: 0,\n      y: 0,\n      tableKey: playerTableKey,\n      rowIndex: 0,\n    });\n\n    // \"\"\n    const inSceneColIdx = headers.findIndex(h => h && h.includes(''));\n\n    rows.forEach((row, idx) => {\n      const rawNpcName = row[nameIdx];\n      if (!rawNpcName) return;\n\n      const npcName = resolveName(rawNpcName);\n\n      // \n      let isInScene = false;\n      if (inSceneColIdx > 0) {\n        const inSceneVal = String(row[inSceneColIdx] || '')\n          .trim()\n          .toLowerCase();\n        const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n        if (header.includes('')) {\n          isInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n        } else {\n          isInScene =\n            inSceneVal.startsWith('') || inSceneVal === 'true' || inSceneVal === '' || inSceneVal === 'yes';\n        }\n      }\n\n      if (!nodes.has(npcName)) {\n        nodes.set(npcName, {\n          name: npcName,\n          isPlayer: false,\n          x: 0,\n          y: 0,\n          tableKey: npcTableKey,\n          rowIndex: idx,\n          isInScene: isInScene,\n        });\n      }\n\n      const relationStr = row[relationIdx] || '';\n      const relations = parseRelationshipString(relationStr);\n\n      relations.forEach(rel => {\n        if (!rel.name) return;\n        const resolvedRelName = resolveName(rel.name);\n\n        if (resolvedRelName === npcName) return;\n\n        if (!nodes.has(resolvedRelName)) {\n          // NPC\n          let relRowIndex = -1;\n          let relIsInScene = false;\n          for (let ri = 0; ri < rows.length; ri++) {\n            if (resolveName(rows[ri][nameIdx]) === resolvedRelName) {\n              relRowIndex = ri;\n              // \n              if (inSceneColIdx > 0) {\n                const inSceneVal = String(rows[ri][inSceneColIdx] || '')\n                  .trim()\n                  .toLowerCase();\n                const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n                if (header.includes('')) {\n                  relIsInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n                } else {\n                  relIsInScene =\n                    inSceneVal.startsWith('') ||\n                    inSceneVal === 'true' ||\n                    inSceneVal === '' ||\n                    inSceneVal === 'yes';\n                }\n              }\n              break;\n            }\n          }\n          nodes.set(resolvedRelName, {\n            name: resolvedRelName,\n            isPlayer: resolvedRelName === resolvedPlayerName,\n            x: 0,\n            y: 0,\n            tableKey: relRowIndex >= 0 ? npcTableKey : '',\n            rowIndex: relRowIndex >= 0 ? relRowIndex : undefined,\n            isInScene: relIsInScene,\n          });\n        }\n\n        // /\n        const cleanRelation = rawRel => {\n          if (!rawRel) return [];\n          const parts = String(rawRel)\n            .split(/[,;\\/\\|]+|\\s*[&]\\s*|\\s{2,}|\\n/)\n            .map(s => s.trim())\n            .filter(s => s && s.length < 30); // \n\n          // \n          const commonRelations = [\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n          ];\n\n          return parts\n            .map(p => {\n              // [] \n              p = p.replace(/[(][^)]*[)]/g, '').trim();\n              // === XX/  XX ===\n              const specialSuffixMatch = p.match(/^(.+)(|)$/);\n              if (specialSuffixMatch) {\n                p = specialSuffixMatch[1]; // \"\"  \"\"\n              } else {\n                // === XXYY  YY ===\n                p = p.replace(/^[\\u4e00-\\u9fa5]{2,4}(?=[\\u4e00-\\u9fa5]{1,4}$)/, '');\n              }\n\n              // ===  ===\n              p = p.replace(/^(?:|||?|?|)/, '');\n              p = p.replace(/^(?:?|?|?|)/, '');\n              p = p.replace(/^(?:|?|?)/, '');\n\n              // ===  ===\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n\n              // ===  ===\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^(?:||?)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n\n              p = p.trim();\n\n              // === []  ===\n              if (p.length > 8) {\n                // \n                for (const rel of commonRelations) {\n                  if (p.endsWith(rel)) {\n                    return rel;\n                  }\n                }\n                // 2-4\n                const lastChars = p.slice(-4);\n                for (const rel of commonRelations) {\n                  if (lastChars.includes(rel)) {\n                    return rel;\n                  }\n                }\n                // 3\n                return p.slice(-3);\n              }\n\n              return p;\n            })\n            .filter(s => s && s.length > 0 && s.length <= 8);\n        };\n\n        const cleanedLabels = cleanRelation(rel.relation);\n        if (cleanedLabels.length === 0) cleanedLabels.push('');\n\n        // \n        let existingEdge = edges.find(\n          e =>\n            (e.source === npcName && e.target === resolvedRelName) ||\n            (e.source === resolvedRelName && e.target === npcName),\n        );\n\n        if (!existingEdge) {\n          // \n          edges.push({\n            source: npcName,\n            target: resolvedRelName,\n            // \n            labelsFromSource: cleanedLabels.slice(0, 2), // sourcetarget 2\n            labelsFromTarget: [], // targetsource \n          });\n        } else {\n          // \n          if (existingEdge.source === npcName) {\n            // npcsource labelsFromSource\n            const combined = [...(existingEdge.labelsFromSource || []), ...cleanedLabels];\n            // 2\n            existingEdge.labelsFromSource = [...new Set(combined)].slice(0, 2);\n          } else {\n            // npctarget labelsFromTarget\n            const combined = [...(existingEdge.labelsFromTarget || []), ...cleanedLabels];\n            existingEdge.labelsFromTarget = [...new Set(combined)].slice(0, 2);\n          }\n        }\n      });\n    });\n\n    const nodeArr = Array.from(nodes.values());\n    console.info(`[DICE]${nodeArr.length}${edges.length}`);\n    const centerX = 400,\n      centerY = 300;\n\n    // [] \n    const connectionCount = new Map();\n    nodeArr.forEach(node => connectionCount.set(node.name, 0));\n    edges.forEach(edge => {\n      connectionCount.set(edge.source, (connectionCount.get(edge.source) || 0) + 1);\n      connectionCount.set(edge.target, (connectionCount.get(edge.target) || 0) + 1);\n    });\n\n    // [] \n    const isMobileView = window.innerWidth <= 768;\n    const baseRadius = isMobileView ? 22 : 28;\n    const maxRadius = isMobileView ? 38 : 50;\n    const playerBaseRadius = isMobileView ? 28 : 35;\n    const radiusPerConnection = isMobileView ? 2.5 : 3.5;\n\n    //  getNodeRadius \n    let nodeSizeMultiplier = 1.0; // 1.0\n    let filterInScene = false; // +\n    let filterDirectOnly = false; // \n\n    const getNodeRadius = (nodeName, isPlayer) => {\n      const base = isPlayer ? playerBaseRadius : baseRadius;\n      const count = connectionCount.get(nodeName) || 0;\n      const calculated = Math.min(maxRadius, base + Math.sqrt(count) * radiusPerConnection);\n      // \n      return calculated * nodeSizeMultiplier;\n    };\n\n    // \n    nodeArr.forEach(node => {\n      node.radius = getNodeRadius(node.name, node.isPlayer);\n    });\n\n    // \n    const getFilteredNodes = () => {\n      // \n      if (!filterInScene && !filterDirectOnly) return nodeArr;\n\n      // \n      let directNodes: Set<string> | null = null;\n      if (filterDirectOnly) {\n        directNodes = new Set([resolvedPlayerName]);\n        edges.forEach(edge => {\n          if (edge.source === resolvedPlayerName) directNodes!.add(edge.target);\n          if (edge.target === resolvedPlayerName) directNodes!.add(edge.source);\n        });\n      }\n\n      return nodeArr.filter(n => {\n        // \n        const passInScene = !filterInScene || n.isInScene || n.isPlayer;\n        // \n        const passDirectOnly = !filterDirectOnly || directNodes!.has(n.name);\n        // \n        return passInScene && passDirectOnly;\n      });\n    };\n\n    // [Modified] \n    // ---------------------------------------------------------\n    //  ()\n    const kRepulsion = 20000; //  () - \n    const kSpring = 0.02; //  () - \n    const kGravity = 0.01; //  - \n    const idealLen = 250; //  - \n    const iterations = 300; // \n    const timeStep = 0.5; // \n    const damping = 0.8; //  ()\n\n    // \n    const LAYOUT_CACHE_KEY = 'acu-relation-graph-layout-cache';\n\n    // \n    const getLayoutCacheKey = () => {\n      const nodeNames = nodeArr\n        .map(n => n.name)\n        .sort()\n        .join('|');\n      return `${LAYOUT_CACHE_KEY}-${nodeNames}`;\n    };\n\n    // \n    const saveLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const layoutData = {};\n        nodeArr.forEach(node => {\n          layoutData[node.name] = { x: node.x, y: node.y };\n        });\n        localStorage.setItem(cacheKey, JSON.stringify(layoutData));\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const loadLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const cached = localStorage.getItem(cacheKey);\n        if (!cached) return false;\n\n        const layoutData = JSON.parse(cached);\n        let allNodesFound = true;\n\n        // \n        for (const node of nodeArr) {\n          if (!layoutData[node.name]) {\n            allNodesFound = false;\n            break;\n          }\n        }\n\n        if (allNodesFound) {\n          // \n          nodeArr.forEach(node => {\n            const cached = layoutData[node.name];\n            if (cached) {\n              node.x = cached.x;\n              node.y = cached.y;\n              node.vx = 0;\n              node.vy = 0;\n            }\n          });\n          return true;\n        }\n        return false;\n      } catch (e) {\n        console.warn('[DICE] :', e);\n        return false;\n      }\n    };\n\n    // \n    const clearLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        localStorage.removeItem(cacheKey);\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const runForceDirectedLayout = () => {\n      // \n      nodeArr.forEach(node => {\n        if (node.isPlayer) {\n          node.x = centerX;\n          node.y = centerY;\n          node.vx = 0;\n          node.vy = 0;\n        } else {\n          //  100px \n          const angle = Math.random() * 2 * Math.PI;\n          const dist = 50 + Math.random() * 100;\n          node.x = centerX + Math.cos(angle) * dist;\n          node.y = centerY + Math.sin(angle) * dist;\n          node.vx = 0;\n          node.vy = 0;\n        }\n      });\n\n      //  O(1) \n      const nodeMap = new Map();\n      nodeArr.forEach(n => nodeMap.set(n.name, n));\n\n      //  ()\n      for (let iter = 0; iter < iterations; iter++) {\n        // 1.  ( vs )\n        for (let i = 0; i < nodeArr.length; i++) {\n          const u = nodeArr[i];\n          for (let j = i + 1; j < nodeArr.length; j++) {\n            const v = nodeArr[j];\n            const dx = v.x - u.x;\n            const dy = v.y - u.y;\n            let distSq = dx * dx + dy * dy;\n            if (distSq < 1) distSq = 1; // \n\n            const dist = Math.sqrt(distSq);\n            const force = kRepulsion / distSq;\n\n            const fx = (dx / dist) * force;\n            const fy = (dy / dist) * force;\n\n            if (!u.isPlayer) {\n              u.vx -= fx;\n              u.vy -= fy;\n            }\n            if (!v.isPlayer) {\n              v.vx += fx;\n              v.vy += fy;\n            }\n          }\n        }\n\n        // 2.  ()\n        edges.forEach(edge => {\n          const u = nodeMap.get(edge.source);\n          const v = nodeMap.get(edge.target);\n          if (!u || !v) return;\n\n          const dx = v.x - u.x;\n          const dy = v.y - u.y;\n          const dist = Math.sqrt(dx * dx + dy * dy) || 1;\n\n          // : F = k * ( - )\n          const force = (dist - idealLen) * kSpring;\n\n          const fx = (dx / dist) * force;\n          const fy = (dy / dist) * force;\n\n          if (!u.isPlayer) {\n            u.vx += fx;\n            u.vy += fy;\n          }\n          if (!v.isPlayer) {\n            v.vx -= fx;\n            v.vy -= fy;\n          }\n        });\n\n        // 3.  ()\n        nodeArr.forEach(node => {\n          if (node.isPlayer) return;\n          const dx = centerX - node.x;\n          const dy = centerY - node.y;\n          node.vx += dx * kGravity;\n          node.vy += dy * kGravity;\n        });\n\n        // 4. \n        // \n        const maxSpeed = 50 * (1 - iter / iterations); // \n\n        nodeArr.forEach(node => {\n          if (node.isPlayer) return; //  ()\n\n          // \n          node.vx *= damping;\n          node.vy *= damping;\n\n          // \n          const vMag = Math.sqrt(node.vx * node.vx + node.vy * node.vy);\n          if (vMag > maxSpeed) {\n            node.vx = (node.vx / vMag) * maxSpeed;\n            node.vy = (node.vy / vMag) * maxSpeed;\n          }\n\n          node.x += node.vx * timeStep;\n          node.y += node.vy * timeStep;\n        });\n      }\n\n      // \n      saveLayoutCache();\n    };\n\n    // \n    if (!loadLayoutCache()) {\n      // \n      runForceDirectedLayout();\n    }\n\n    // \n    let scale = 1;\n    let panX = 0;\n    let panY = 0;\n    const minScale = 0.3;\n    const maxScale = 4;\n\n    const overlay = $(`\n            <div class=\"acu-relation-graph-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-relation-graph-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-graph-title\">\n                            <i class=\"fa-solid fa-project-diagram\"></i>\n                            <button class=\"acu-graph-btn acu-filter-toggle\" id=\"filter-in-scene\" title=\"\" style=\"margin-left:8px;padding:4px 6px;font-size:12px;\"><i class=\"fa-solid fa-map-marker-alt\"></i></button>\n                            <button class=\"acu-graph-btn acu-filter-toggle\" id=\"filter-direct-only\" title=\"\" style=\"padding:4px 6px;font-size:12px;\"><i class=\"fa-solid fa-link\"></i></button>\n                        </div>\n                        <div class=\"acu-graph-actions\">\n                            <button class=\"acu-graph-btn\" id=\"graph-relayout\" title=\"\"><i class=\"fa-solid fa-sync\"></i></button>\n                            <button class=\"acu-graph-btn\" id=\"graph-manage-avatar\" title=\"\"><i class=\"fa-solid fa-user-circle\"></i></button>\n                            <button class=\"acu-graph-btn acu-graph-close\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-canvas-wrapper\">\n                        <svg class=\"acu-graph-svg\" viewBox=\"0 0 800 600\">\n                            <defs>\n                                <marker id=\"arrowhead-end\" markerWidth=\"6\" markerHeight=\"5\" refX=\"5\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 6 2.5, 0 5\" fill=\"${t.textSub}\" />\n                                </marker>\n                                <marker id=\"arrowhead-start\" markerWidth=\"6\" markerHeight=\"5\" refX=\"1\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"6 0, 0 2.5, 6 5\" fill=\"${t.textSub}\" />\n                                </marker>\n                                <marker id=\"arrowhead-end-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"6\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 7 3, 0 6\" fill=\"${t.accent}\" />\n                                </marker>\n                                <marker id=\"arrowhead-start-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"1\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"7 0, 0 3, 7 6\" fill=\"${t.accent}\" />\n                                </marker>\n                            </defs>\n                            <g class=\"acu-graph-transform\">\n                                <g class=\"acu-graph-edges\"></g>\n                                <g class=\"acu-graph-nodes\"></g>\n                            </g>\n                        </svg>\n                        <div class=\"acu-node-size-slider-container\" style=\"\n                            position: absolute;\n                            display: none;\n                            width: 200px;\n                            padding: 10px;\n                            background: ${t.bgPanel};\n                            border: 1px solid ${t.border};\n                            border-radius: 8px;\n                            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n                            z-index: 10;\n                        \">\n                            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:6px;\">\n                                <span style=\"font-size:11px;color:${t.textSub};white-space:nowrap;\"></span>\n                                <span id=\"slider-size-display\" style=\"font-size:11px;color:${t.accent};font-weight:bold;min-width:35px;text-align:right;\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                            </div>\n                            <input type=\"range\" id=\"node-size-slider\" min=\"0.5\" max=\"2.0\" step=\"0.1\" value=\"${nodeSizeMultiplier}\" style=\"\n                                width: 100%;\n                                height: 8px;\n                                border-radius: 4px;\n                                background: ${t.btnBg};\n                                outline: none;\n                                cursor: pointer;\n                                -webkit-appearance: none;\n                            \" />\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-legend\">\n                        <button class=\"acu-graph-btn\" id=\"graph-zoom-reset\" title=\"\" style=\"width:auto;height:auto;padding:4px 10px;font-size:11px;display:flex;align-items:center;gap:4px;\"><i class=\"fa-solid fa-compress-arrows-alt\"></i><span></span></button>\n                        <div class=\"acu-node-size-stepper-wrapper\" style=\"display:flex;align-items:center;justify-content:center;gap:6px;\">\n                            <span style=\"font-size:11px;color:var(--acu-text-sub);white-space:nowrap;\">:</span>\n                            <div class=\"acu-stepper\" data-id=\"graph-node-size\" data-min=\"50\" data-max=\"200\" data-step=\"10\" style=\"display:flex;align-items:center;\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\" id=\"node-size-display\" style=\"display:flex;align-items:center;justify-content:center;\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <span class=\"acu-zoom-display\" style=\"display:flex;align-items:center;gap:4px;color:var(--acu-text-sub);font-size:11px;\">\n                            <span>:</span>\n                            <span>${Math.round(scale * 100)}%</span>\n                        </span>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const $svg = overlay.find('.acu-graph-svg');\n    const $transform = overlay.find('.acu-graph-transform');\n    const $edgesGroup = overlay.find('.acu-graph-edges');\n    const $nodesGroup = overlay.find('.acu-graph-nodes');\n    const $zoomDisplay = overlay.find('.acu-zoom-display span:last-child');\n    const $nodeSizeDisplay = overlay.find('#node-size-display');\n    const $wrapper = overlay.find('.acu-graph-canvas-wrapper');\n\n    const updateTransform = () => {\n      $transform.attr('transform', `translate(${panX}, ${panY}) scale(${scale})`);\n      $zoomDisplay.text(`${Math.round(scale * 100)}%`);\n    };\n\n    const updateNodeSizeDisplay = () => {\n      if ($nodeSizeDisplay.length) {\n        $nodeSizeDisplay.text(`${Math.round(nodeSizeMultiplier * 100)}%`);\n      }\n    };\n\n    const zoomTo = (newScale, centerX = 400, centerY = 300) => {\n      const oldScale = scale;\n      scale = Math.max(minScale, Math.min(maxScale, newScale));\n      const scaleChange = scale / oldScale;\n      panX = centerX - (centerX - panX) * scaleChange;\n      panY = centerY - (centerY - panY) * scaleChange;\n      updateTransform();\n    };\n\n    const render = async () => {\n      // \n      const filteredNodes = getFilteredNodes();\n      const filteredNodeNames = new Set(filteredNodes.map(n => n.name));\n\n      // \n      const filteredEdges = edges.filter(\n        edge => filteredNodeNames.has(edge.source) && filteredNodeNames.has(edge.target),\n      );\n\n      let edgesHtml = '';\n      filteredEdges.forEach((edge, edgeIdx) => {\n        const source = nodes.get(edge.source);\n        const target = nodes.get(edge.target);\n        if (!source || !target) return;\n\n        // \n        const dx = target.x - source.x;\n        const dy = target.y - source.y;\n        const len = Math.sqrt(dx * dx + dy * dy) || 1;\n        const nx = dx / len; // \n        const ny = dy / len;\n\n        // \n        const px = -ny;\n        const py = nx;\n\n        // \n        const hasFromSource =\n          edge.labelsFromSource && edge.labelsFromSource.length > 0 && edge.labelsFromSource.some(l => l);\n        const hasFromTarget =\n          edge.labelsFromTarget && edge.labelsFromTarget.length > 0 && edge.labelsFromTarget.some(l => l);\n\n        // \n        const sourceRadius = source.radius || 28;\n        const targetRadius = target.radius || 28;\n        const arrowGap = 10; // \n        const x1 = source.x + nx * (sourceRadius + arrowGap);\n        const y1 = source.y + ny * (sourceRadius + arrowGap);\n        const x2 = target.x - nx * (targetRadius + arrowGap);\n        const y2 = target.y - ny * (targetRadius + arrowGap);\n\n        // \n        let srcLabels = (edge.labelsFromSource || []).filter(l => l);\n        let tgtLabels = (edge.labelsFromTarget || []).filter(l => l);\n\n        // \n        const srcSet = new Set(srcLabels);\n        const tgtSet = new Set(tgtLabels);\n        const commonLabels = [...srcSet].filter(l => tgtSet.has(l));\n\n        // \n        const srcUnique = srcLabels.filter(l => !commonLabels.includes(l));\n        const tgtUnique = tgtLabels.filter(l => !commonLabels.includes(l));\n\n        // \n        let markerStart = '';\n        let markerEnd = '';\n        if (hasFromSource) markerEnd = 'url(#arrowhead-end)';\n        if (hasFromTarget) markerStart = 'url(#arrowhead-start)';\n\n        edgesHtml += `<line class=\"acu-graph-edge\" x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                    ${markerEnd ? `marker-end=\"${markerEnd}\"` : ''}\n                    ${markerStart ? `marker-start=\"${markerStart}\"` : ''}\n                    data-edge-idx=\"${edgeIdx}\" />`;\n\n        // \n        const midX = (source.x + target.x) / 2;\n        const midY = (source.y + target.y) / 2;\n\n        // \n        const lineLen = Math.sqrt(dx * dx + dy * dy);\n\n        // \"\"\n        const isBidirectional = hasFromSource && hasFromTarget;\n        const isBidirectionalSame =\n          isBidirectional && commonLabels.length > 0 && srcUnique.length === 0 && tgtUnique.length === 0;\n\n        // \n        if (isBidirectionalSame) {\n          // \n          commonLabels.slice(0, 2).forEach((lbl, i) => {\n            if (!lbl) return;\n            const offsetDir = i === 0 ? 1 : -1;\n            const offsetDist = 6 + i * 10;\n            const lx = midX + px * offsetDir * offsetDist;\n            const ly = midY + py * offsetDir * offsetDist;\n            edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(lbl)}</text>`;\n          });\n        } else {\n          // \n          // source/target\n          // 25%\n          const safeOffset = Math.max(30, Math.min(lineLen * 0.25, 60));\n\n          // Emoji\n          const relationEmojiMap = [\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', ''] },\n          ];\n\n          // Emoji\n          const addRelationEmoji = lbl => {\n            if (!lbl) return '';\n            for (const group of relationEmojiMap) {\n              for (const kw of group.keywords) {\n                if (lbl.includes(kw)) {\n                  return lbl + group.emoji;\n                }\n              }\n            }\n            return lbl;\n          };\n\n          // emoji\n          const truncateLabel = (lbl, maxLen = 4) => {\n            if (!lbl) return '';\n            const truncated = lbl.length > maxLen ? lbl.substring(0, maxLen) + '..' : lbl;\n            return addRelationEmoji(truncated);\n          };\n\n          // 1. \n          if (commonLabels.length > 0) {\n            commonLabels.slice(0, 1).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const lx = midX + px * 8;\n              const ly = midY + py * 8 - 3;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n\n          // 2. Sourcesource\n          if (srcUnique.length > 0 || (hasFromSource && !hasFromTarget && commonLabels.length === 0)) {\n            const labelsToShow = srcUnique.length > 0 ? srcUnique : srcLabels;\n            // source\n            const labelBaseX = midX - nx * safeOffset;\n            const labelBaseY = midY - ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? 1 : -1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n\n          // 3. Targettarget\n          if (tgtUnique.length > 0 || (hasFromTarget && !hasFromSource && commonLabels.length === 0)) {\n            const labelsToShow = tgtUnique.length > 0 ? tgtUnique : tgtLabels;\n            // target\n            const labelBaseX = midX + nx * safeOffset;\n            const labelBaseY = midY + ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? -1 : 1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n        }\n      });\n      $edgesGroup.html(edgesHtml);\n\n      // [] \n      let nodesHtml = '';\n      for (const node of filteredNodes) {\n        //  > URL > ST\n        const nodeAvatar = await AvatarManager.getAsync(node.name);\n        const isPlayer = node.isPlayer;\n\n        // \n        const indicatorRadius = node.radius * 0.28;\n        const indicatorOffset = node.radius * 0.65;\n        const inSceneIndicator = node.isInScene\n          ? `<circle class=\"acu-node-inscene-indicator\" cx=\"${-indicatorOffset}\" cy=\"${-indicatorOffset}\" r=\"${indicatorRadius}\" style=\"fill:var(--acu-accent);stroke:var(--acu-bg-panel);stroke-width:2;\" />`\n          : '';\n\n        const nodeDisplayName = replaceUserPlaceholders(node.name);\n        nodesHtml += `\n                <g class=\"acu-graph-node acu-dash-preview-trigger\" data-name=\"${escapeHtml(node.name)}\" data-table-key=\"${node.tableKey || ''}\" data-row-index=\"${node.rowIndex !== undefined ? node.rowIndex : ''}\" transform=\"translate(${node.x}, ${node.y})\">\n                    <circle class=\"acu-node-bg\" r=\"${node.radius}\" />\n                    ${\n                      nodeAvatar\n                        ? (() => {\n                            const offsetX = AvatarManager.getOffsetX(node.name);\n                            const offsetY = AvatarManager.getOffsetY(node.name);\n                            const scaleVal = AvatarManager.getScale(node.name);\n                            const size = (node.radius - 2) * 2;\n                            const shadowWidth = 4; // box-shadow\n                            const foSize = size + shadowWidth * 2;\n                            const foOffset = foSize / 2;\n                            return `<foreignObject x=\"${-foOffset}\" y=\"${-foOffset}\" width=\"${foSize}\" height=\"${foSize}\">\n                            <div class=\"acu-node-avatar\" xmlns=\"http://www.w3.org/1999/xhtml\" style=\"\n                                width: ${size}px;\n                                height: ${size}px;\n                                margin: ${shadowWidth}px;\n                                border-radius: 50%;\n                                background-image: url('${nodeAvatar}');\n                                background-size: ${scaleVal}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                                background-repeat: no-repeat;\n                            \"></div>\n                        </foreignObject>`;\n                          })()\n                        : `<text class=\"acu-node-char\" dy=\"0.35em\">${escapeHtml(nodeDisplayName.charAt(0))}</text>`\n                    }\n                    ${inSceneIndicator}\n                    <text class=\"acu-node-label\" dy=\"${node.radius + 14}\">${escapeHtml(nodeDisplayName)}</text>\n                </g>\n            `;\n      }\n      $nodesGroup.html(nodesHtml);\n    };\n\n    // [] \n    const highlightNode = nodeName => {\n      $svg.addClass('highlighting');\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if ($(this).data('name') === nodeName) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedNodes = new Set([nodeName]);\n\n      // \n      edges.forEach(edge => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          const otherNode = edge.source === nodeName ? edge.target : edge.source;\n          connectedNodes.add(otherNode);\n        }\n      });\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if (connectedNodes.has($(this).data('name'))) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedEdgeIndices = new Set();\n      edges.forEach((edge, idx) => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          connectedEdgeIndices.add(idx);\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n          if ($(this).attr('marker-end')) {\n            $(this).attr('marker-end', 'url(#arrowhead-end-hl)');\n          }\n          if ($(this).attr('marker-start')) {\n            $(this).attr('marker-start', 'url(#arrowhead-start-hl)');\n          }\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge-label').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n        }\n      });\n    };\n\n    const clearHighlight = () => {\n      $svg.removeClass('highlighting');\n      $nodesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        if ($(this).attr('marker-end')) {\n          $(this).attr('marker-end', 'url(#arrowhead-end)');\n        }\n        if ($(this).attr('marker-start')) {\n          $(this).attr('marker-start', 'url(#arrowhead-start)');\n        }\n      });\n    };\n\n    // []  - PC +  + \n    // pointerfine()coarse()\n    const hasFinePointer = window.matchMedia('(pointer: fine)').matches;\n    const isTouchDevice = !hasFinePointer;\n\n    // \n    let currentHighlightedNode = null; // \n    let longPressTimer = null;\n\n    if (isTouchDevice) {\n      // ==========  ==========\n      let currentHighlightedNode = null;\n\n      $nodesGroup.on('pointerdown', '.acu-graph-node', function (e) {\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        const startX = e.clientX;\n        const startY = e.clientY;\n        const startTime = Date.now();\n        let hasMoved = false;\n        let longPressTriggered = false;\n\n        // \n        if (currentHighlightedNode) {\n          clearHighlight();\n          currentHighlightedNode = null;\n          // return\n          e.preventDefault();\n          e.stopPropagation();\n          return;\n        }\n\n        // \n        const longPressTimer = setTimeout(() => {\n          if (!hasMoved && nodeName) {\n            longPressTriggered = true;\n            currentHighlightedNode = nodeName;\n            highlightNode(nodeName);\n            if (navigator.vibrate) navigator.vibrate(30);\n          }\n        }, 300);\n\n        const onMove = moveE => {\n          const dx = Math.abs(moveE.clientX - startX);\n          const dy = Math.abs(moveE.clientY - startY);\n          if (dx > 8 || dy > 8) {\n            hasMoved = true;\n            clearTimeout(longPressTimer);\n          }\n        };\n\n        const onUp = () => {\n          $(document).off('pointermove.mobilenode pointerup.mobilenode pointercancel.mobilenode');\n          clearTimeout(longPressTimer);\n\n          const elapsed = Date.now() - startTime;\n\n          //   \n          if (longPressTriggered) {\n            return;\n          }\n\n          //   \n          if (hasMoved) {\n            return;\n          }\n\n          // <300ms  \n          if (elapsed < 300) {\n            const nodeName = $node.data('name');\n            // \n            const primaryName = AvatarManager.getPrimaryName(nodeName);\n            const tableKey = $node.data('table-key');\n            let rowIndex = $node.data('row-index');\n\n            // tableKey\n            if (!tableKey || rowIndex === '' || rowIndex === undefined) {\n              // NPC\n              const rawData = cachedRawData || getTableData();\n              if (rawData) {\n                for (const key in rawData) {\n                  const table = rawData[key];\n                  if (!table?.content || !table.name?.includes('NPC')) continue;\n                  const headers = table.content[0] || [];\n                  const nameIdx = headers.findIndex(\n                    h => h && (h.includes('') || h.includes('') || h.includes('')),\n                  );\n                  if (nameIdx < 0) continue;\n                  for (let i = 1; i < table.content.length; i++) {\n                    const rowName = String(table.content[i][nameIdx] || '').trim();\n                    if (rowName === primaryName || AvatarManager.getPrimaryName(rowName) === primaryName) {\n                      // \n                      const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n                        .data('table-key', key)\n                        .data('row-index', i - 1);\n                      $('body').append(tempNode);\n                      tempNode.trigger('click.acu_dash_preview');\n                      tempNode.remove();\n                      return;\n                    }\n                  }\n                }\n              }\n              // \n              if (window.toastr) {\n                window.toastr.info(`${primaryName}`, '', { timeOut: 2000 });\n              }\n              return;\n            }\n\n            // tableKey\n            const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n              .data('table-key', tableKey)\n              .data('row-index', parseInt(rowIndex, 10));\n            $('body').append(tempNode);\n            tempNode.trigger('click.acu_dash_preview');\n            tempNode.remove();\n          }\n        };\n\n        $(document).on('pointermove.mobilenode', onMove);\n        $(document).on('pointerup.mobilenode pointercancel.mobilenode', onUp);\n      });\n\n      // \n      $wrapper.on('pointerup.mobileclear', function (e) {\n        if (currentHighlightedNode && !$(e.target).closest('.acu-graph-node').length) {\n          clearHighlight();\n          currentHighlightedNode = null;\n        }\n      });\n    } else {\n      // ========== PC ==========\n\n      $nodesGroup.on('pointerenter.pchover', '.acu-graph-node', function () {\n        const nodeName = $(this).data('name');\n        if (nodeName) {\n          highlightNode(nodeName);\n        }\n      });\n\n      $nodesGroup.on('pointerleave.pchover', '.acu-graph-node', function () {\n        clearHighlight();\n      });\n\n      // PC\n      $nodesGroup.on('click.pcclick', '.acu-graph-node', function (e) {\n        e.stopPropagation();\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        // \n        const primaryName = AvatarManager.getPrimaryName(nodeName);\n        const tableKey = $node.data('table-key');\n        let rowIndex = $node.data('row-index');\n\n        // tableKey\n        if (!tableKey || rowIndex === '' || rowIndex === undefined) {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            for (const key in rawData) {\n              const table = rawData[key];\n              if (!table?.content || !table.name?.includes('NPC')) continue;\n              const headers = table.content[0] || [];\n              const nameIdx = headers.findIndex(\n                h => h && (h.includes('') || h.includes('') || h.includes('')),\n              );\n              if (nameIdx < 0) continue;\n              for (let i = 1; i < table.content.length; i++) {\n                const rowName = String(table.content[i][nameIdx] || '').trim();\n                if (rowName === primaryName || AvatarManager.getPrimaryName(rowName) === primaryName) {\n                  const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n                    .data('table-key', key)\n                    .data('row-index', i - 1);\n                  $('body').append(tempNode);\n                  tempNode.trigger('click.acu_dash_preview');\n                  tempNode.remove();\n                  return;\n                }\n              }\n            }\n          }\n          if (window.toastr) {\n            window.toastr.info(`${primaryName}`, '', { timeOut: 2000 });\n          }\n          return;\n        }\n\n        // tableKey\n        const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n          .data('table-key', tableKey)\n          .data('row-index', parseInt(rowIndex, 10));\n        $('body').append(tempNode);\n        tempNode.trigger('click.acu_dash_preview');\n        tempNode.remove();\n      });\n    }\n\n    // \n    render().then(() => {\n      updateTransform();\n    });\n\n    //  -  Pointer Events API\n    let isPanning = false;\n    let panStartX = 0,\n      panStartY = 0;\n    let panStartPanX = 0,\n      panStartPanY = 0;\n    let lastPinchDist = 0;\n    let activePointerId = null;\n\n    const wrapperEl = $wrapper[0];\n    const svgEl = $svg[0];\n\n    // Pointer Down - \n    wrapperEl.onpointerdown = function (e) {\n      if (e.button !== 0) return;\n      // [] \n      if ($(e.target).closest('.acu-graph-node').length) return;\n      // [] \n      if ($(e.target).closest('.acu-node-size-slider-container').length) return;\n      e.preventDefault();\n      wrapperEl.setPointerCapture(e.pointerId);\n      activePointerId = e.pointerId;\n      isPanning = true;\n      panStartX = e.clientX;\n      panStartY = e.clientY;\n      panStartPanX = panX;\n      panStartPanY = panY;\n      svgEl.style.cursor = 'grabbing';\n    };\n\n    // Pointer Move - \n    wrapperEl.onpointermove = function (e) {\n      if (!isPanning || e.pointerId !== activePointerId) return;\n      const dx = e.clientX - panStartX;\n      const dy = e.clientY - panStartY;\n      const rect = svgEl.getBoundingClientRect();\n      panX = panStartPanX + (dx / rect.width) * 800;\n      panY = panStartPanY + (dy / rect.height) * 600;\n      updateTransform();\n    };\n\n    // Pointer Up - \n    wrapperEl.onpointerup = function (e) {\n      if (e.pointerId === activePointerId) {\n        wrapperEl.releasePointerCapture(e.pointerId);\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // Pointer Cancel - \n    wrapperEl.onpointercancel = function (e) {\n      if (e.pointerId === activePointerId) {\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // \n    wrapperEl.onwheel = function (e) {\n      e.preventDefault();\n      const delta = e.deltaY > 0 ? -0.15 : 0.15;\n      zoomTo(scale + delta);\n    };\n\n    // \n    wrapperEl.addEventListener(\n      'touchstart',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          isPanning = false;\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener(\n      'touchmove',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            zoomTo(scale * (newDist / lastPinchDist));\n          }\n          lastPinchDist = newDist;\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener('touchend', function (e) {\n      if (e.touches.length < 2) lastPinchDist = 0;\n    });\n\n    // \n    const cleanupEvents = () => {\n      wrapperEl.onpointerdown = null;\n      wrapperEl.onpointermove = null;\n      wrapperEl.onpointerup = null;\n      wrapperEl.onpointercancel = null;\n      wrapperEl.onwheel = null;\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n      $(document).off('click.slider-hide');\n    };\n\n    // \n    const $nodeSizeSlider = overlay.find('#node-size-slider');\n    const $sliderSizeDisplay = overlay.find('#slider-size-display');\n    const $sliderContainer = overlay.find('.acu-node-size-slider-container');\n    const $nodeSizeDisplayTrigger = overlay.find('#node-size-display-trigger');\n    const $legend = overlay.find('.acu-graph-legend');\n\n    let sliderVisible = false;\n    let sliderHideTimer: ReturnType<typeof setTimeout> | null = null;\n    const SLIDER_AUTO_HIDE_DELAY = 4000; // 4\n\n    // \n    const showSlider = () => {\n      if (sliderVisible) return;\n\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = true;\n\n      // \"\"wrappertriggerlegendlegendwrapper\n      // getBoundingClientRectviewport\n      const triggerRect = $nodeSizeDisplayTrigger[0].getBoundingClientRect();\n      const wrapperRect = $wrapper[0].getBoundingClientRect();\n\n      // wrappertrigger\n      const sliderHeight = 60; // \n      const top = wrapperRect.height - sliderHeight - 10; // wrapper\n      const left = triggerRect.left - wrapperRect.left;\n\n      $sliderContainer.css({\n        display: 'block',\n        top: `${top}px`,\n        left: `${left}px`,\n      });\n\n      // \n      resetSliderHideTimer();\n    };\n\n    // \n    const hideSlider = () => {\n      if (!sliderVisible) return;\n\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = false;\n      $sliderContainer.hide();\n    };\n\n    // \n    const resetSliderHideTimer = () => {\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n      }\n      sliderHideTimer = setTimeout(() => {\n        hideSlider();\n      }, SLIDER_AUTO_HIDE_DELAY);\n    };\n\n    // \"\"/\n    overlay.on('click', '#node-size-display-trigger, #node-size-display-trigger *', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        hideSlider();\n      } else {\n        showSlider();\n      }\n    });\n\n    // \n    $nodeSizeSlider.on('input mousedown touchstart', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        resetSliderHideTimer();\n      }\n    });\n\n    // \n    $sliderContainer.on('pointerdown mousedown touchstart', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $(document).on('click.slider-hide', function (e) {\n      if (\n        sliderVisible &&\n        !$sliderContainer.is(e.target) &&\n        $sliderContainer.has(e.target).length === 0 &&\n        !$nodeSizeDisplayTrigger.is(e.target) &&\n        $nodeSizeDisplayTrigger.has(e.target).length === 0\n      ) {\n        hideSlider();\n      }\n    });\n\n    $nodeSizeSlider.on('input', function () {\n      nodeSizeMultiplier = parseFloat($(this).val());\n      $sliderSizeDisplay.text(Math.round(nodeSizeMultiplier * 100) + '%');\n      updateNodeSizeDisplay();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n      render();\n\n      // \n      resetSliderHideTimer();\n    });\n\n    //  toggle \n    const $filterInSceneBtn = overlay.find('#filter-in-scene');\n    const $filterDirectOnlyBtn = overlay.find('#filter-direct-only');\n\n    const updateFilterToggleStyles = () => {\n      $filterInSceneBtn.css({\n        background: filterInScene ? t.accent : t.btnBg,\n        color: filterInScene ? t.btnActiveText : t.textMain,\n        borderColor: filterInScene ? t.accent : t.border,\n      });\n      $filterDirectOnlyBtn.css({\n        background: filterDirectOnly ? t.accent : t.btnBg,\n        color: filterDirectOnly ? t.btnActiveText : t.textMain,\n        borderColor: filterDirectOnly ? t.accent : t.border,\n      });\n    };\n\n    // \n    updateFilterToggleStyles();\n\n    $filterInSceneBtn.click(function (e) {\n      e.stopPropagation();\n      filterInScene = !filterInScene;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    $filterDirectOnlyBtn.click(function (e) {\n      e.stopPropagation();\n      filterDirectOnly = !filterDirectOnly;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    //  +  + \n    overlay.find('#graph-zoom-reset').click(() => {\n      // \n      scale = 1;\n      panX = 0;\n      panY = 0;\n      updateTransform();\n\n      // \n      nodeSizeMultiplier = 1.0;\n      $nodeSizeSlider.val(1.0);\n      $sliderSizeDisplay.text('100%');\n      updateNodeSizeDisplay();\n\n      // stepper\n      const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n      if ($nodeSizeStepper.length) {\n        $nodeSizeStepper.find('.acu-stepper-value').text('100%');\n      }\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      if (!loadLayoutCache()) {\n        // \n        runForceDirectedLayout();\n      }\n      render();\n    });\n\n    // Stepper  - \n    const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n    if ($nodeSizeStepper.length) {\n      const min = parseInt($nodeSizeStepper.data('min')); // 50\n      const max = parseInt($nodeSizeStepper.data('max')); // 200\n      const step = parseInt($nodeSizeStepper.data('step')); // 10\n      const $value = $nodeSizeStepper.find('.acu-stepper-value');\n\n      const updateNodeSizeValue = (newPercent: number) => {\n        newPercent = Math.max(min, Math.min(max, newPercent));\n        nodeSizeMultiplier = newPercent / 100; //  (0.5-2.0)\n        $value.text(`${newPercent}%`);\n        updateNodeSizeDisplay();\n\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      };\n\n      const getCurrentPercent = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || 100;\n      };\n\n      $nodeSizeStepper.find('.acu-stepper-dec').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() - step);\n      });\n\n      $nodeSizeStepper.find('.acu-stepper-inc').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() + step);\n      });\n    }\n\n    // \n    overlay.find('#graph-relayout').click(() => {\n      // \n      clearLayoutCache();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      runForceDirectedLayout();\n      render();\n    });\n\n    overlay.find('#graph-manage-avatar').click(() => {\n      // \n      showAvatarManager(nodeArr, () => {\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      });\n    });\n\n    const closeGraph = () => {\n      cleanupEvents();\n      overlay.remove();\n    };\n    overlay.find('.acu-graph-close').click(closeGraph);\n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-relation-graph-overlay')) closeGraph();\n    });\n  };\n  // ========================================\n  //  - PC/\n  // ========================================\n\n  const showAvatarCropModal = (imageSource, characterName, onSave) => {\n    const { $ } = getCore();\n    $('.acu-crop-modal-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // \n    let scale = 150;\n    let offsetX = 50;\n    let offsetY = 50;\n\n    // \n    const existing = AvatarManager.getAll()[characterName];\n    if (existing) {\n      scale = existing.scale ?? 150;\n      offsetX = existing.offsetX ?? 50;\n      offsetY = existing.offsetY ?? 50;\n    }\n\n    const modalHtml = `\n            <div class=\"acu-crop-modal-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-crop-modal\">\n                    <div class=\"acu-crop-header\">\n                        <span><i class=\"fa-solid fa-crop-simple\"></i>  - ${escapeHtml(characterName)}</span>\n                        <button class=\"acu-crop-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-crop-body\">\n                        <div class=\"acu-crop-container\">\n                            <div class=\"acu-crop-image\" style=\"\n                                background-image: url('${imageSource}');\n                                background-size: ${scale}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                            \"></div>\n                            <div class=\"acu-crop-mask\"></div>\n                        </div>\n                        <div class=\"acu-crop-hint\">  /</div>\n                    </div>\n                    <div class=\"acu-crop-footer\">\n                        <label class=\"acu-crop-btn acu-crop-reupload\" title=\"\">\n                            <i class=\"fa-solid fa-camera\"></i>\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-crop-file-input\" style=\"display:none;\" />\n                        </label>\n                        <button class=\"acu-crop-btn acu-crop-cancel\"></button>\n                        <button class=\"acu-crop-btn acu-crop-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      'z-index': '2147483658',\n    });\n\n    const $image = $modal.find('.acu-crop-image');\n    const $container = $modal.find('.acu-crop-container');\n    const containerEl = $container[0];\n    const imageEl = $image[0];\n\n    // \n    const updateImageStyle = () => {\n      imageEl.style.backgroundSize = `${scale}%`;\n      imageEl.style.backgroundPosition = `${offsetX}% ${offsetY}%`;\n    };\n\n    // ===  Pointer Events  ===\n    let isDragging = false;\n    let startX = 0,\n      startY = 0;\n    let startOffsetX = 0,\n      startOffsetY = 0;\n    let activePointerId = null;\n\n    imageEl.addEventListener('pointerdown', e => {\n      // \n      if (activePointerId !== null) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      isDragging = true;\n      activePointerId = e.pointerId;\n      startX = e.clientX;\n      startY = e.clientY;\n      startOffsetX = offsetX;\n      startOffsetY = offsetY;\n\n      imageEl.setPointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grabbing';\n    });\n\n    imageEl.addEventListener('pointermove', e => {\n      if (!isDragging || e.pointerId !== activePointerId) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      const deltaX = e.clientX - startX;\n      const deltaY = e.clientY - startY;\n\n      // \n      const sensitivity = 100 / scale;\n      offsetX = Math.max(0, Math.min(100, startOffsetX - deltaX * sensitivity));\n      offsetY = Math.max(0, Math.min(100, startOffsetY - deltaY * sensitivity));\n      updateImageStyle();\n    });\n\n    imageEl.addEventListener('pointerup', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.releasePointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grab';\n    });\n\n    imageEl.addEventListener('pointercancel', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.style.cursor = 'grab';\n    });\n\n    // ===  ===\n    // \n    containerEl.addEventListener(\n      'wheel',\n      e => {\n        e.preventDefault();\n        e.stopPropagation();\n        const delta = e.deltaY > 0 ? -10 : 10;\n        scale = Math.max(100, Math.min(300, scale + delta));\n        updateImageStyle();\n      },\n      { passive: false },\n    );\n\n    // \n    let lastPinchDist = 0;\n    let pinchStartScale = scale;\n\n    containerEl.addEventListener(\n      'touchstart',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          pinchStartScale = scale;\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener(\n      'touchmove',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            const pinchRatio = newDist / lastPinchDist;\n            scale = Math.max(100, Math.min(300, pinchStartScale * pinchRatio));\n            updateImageStyle();\n          }\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener('touchend', e => {\n      if (e.touches.length < 2) {\n        lastPinchDist = 0;\n        pinchStartScale = scale;\n      }\n    });\n\n    // ===  ===\n    // \n    $modal.find('.acu-crop-file-input').on('change', async function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      if (!file.type.startsWith('image/')) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        if (window.toastr) window.toastr.warning(' 5MB');\n        return;\n      }\n\n      try {\n        // \n        const success = await AvatarManager.saveLocalAvatar(characterName, file);\n        if (success) {\n          //  URL \n          const newUrl = await LocalAvatarDB.get(characterName);\n          imageSource = newUrl;\n\n          // \n          scale = 150;\n          offsetX = 50;\n          offsetY = 50;\n\n          // \n          $image.css('background-image', `url('${newUrl}')`);\n          updateImageStyle();\n        }\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n\n      $(this).val('');\n    });\n    $modal.find('.acu-crop-close, .acu-crop-cancel').on('click', () => {\n      $modal.remove();\n    });\n\n    $modal.find('.acu-crop-confirm').on('click', () => {\n      onSave({ scale, offsetX, offsetY });\n      $modal.remove();\n    });\n\n    // \n    $modal.on('click', e => {\n      if ($(e.target).hasClass('acu-crop-modal-overlay')) {\n        $modal.remove();\n      }\n    });\n  };\n  //  - \n  const showAvatarManager = (nodeArr, onUpdate) => {\n    try {\n      const { $ } = getCore();\n      $('.acu-avatar-manager-overlay').remove();\n\n      const config = getConfig();\n      const t = getThemeColors();\n      const avatars = AvatarManager.getAll();\n\n      // {{user}}\n      const resolveUserPlaceholderForAvatar = name => {\n        if (!name) return name;\n        const playerName = getPlayerName();\n        const personaName = getPersonaName();\n\n        // \n        const explicitUserVariants = ['<user>', '{{user}}'];\n        const isExplicitUserVariant = explicitUserVariants.some(\n          v => name === v || name.toLowerCase() === v.toLowerCase(),\n        );\n\n        // persona\n        const isPersonaName = personaName && name === personaName;\n\n        // \"\"\n        const isPlayerName = (() => {\n          if (!playerName) return false;\n          // \n          if (name === playerName) return true;\n          // \n          const primaryName = AvatarManager.getPrimaryName(name);\n          return primaryName === playerName;\n        })();\n\n        // {{user}}\n        if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n          return '{{user}}';\n        }\n\n        // \n        return AvatarManager.getPrimaryName(name);\n      };\n\n      // \n      const buildList = async () => {\n        let listHtml = '';\n\n        // {{user}}\n        const userNode = nodeArr.find(n => {\n          const resolved = resolveUserPlaceholderForAvatar(n.name);\n          return resolved === '{{user}}';\n        });\n        const otherNodes = nodeArr.filter(n => {\n          const resolved = resolveUserPlaceholderForAvatar(n.name);\n          return resolved !== '{{user}}';\n        });\n\n        // {{user}}\n        if (userNode) {\n          // {{user}}'{{user}}'\n          const userNodeForDisplay = {\n            ...userNode,\n            name: '{{user}}', // {{user}}\n          };\n\n          const data = avatars[userNodeForDisplay.name] || {};\n          let currentUrl = data.url || '';\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(userNodeForDisplay.name);\n          let displayUrl = '';\n          let sourceLabel = '';\n\n          if (hasLocal) {\n            displayUrl = await LocalAvatarDB.get(userNodeForDisplay.name);\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n          } else if (currentUrl) {\n            displayUrl = currentUrl;\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n          }\n\n          const aliases = (data.aliases || []).join(', ');\n          const hasAvatar = !!displayUrl;\n\n          listHtml += `\n                    <div class=\"acu-avatar-item\" data-name=\"${escapeHtml(userNodeForDisplay.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <div class=\"acu-avatar-preview-wrap\">\n                            <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" style=\"${hasAvatar ? `background-image: url('${displayUrl}'); background-position: ${data.offsetX ?? 50}% ${data.offsetY ?? 50}%; background-size: ${data.scale ?? 150}%;` : ''}\">\n                                ${!hasAvatar ? `<span>${escapeHtml(userNodeForDisplay.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                            </div>\n                            ${sourceLabel}\n                        </div>\n                        <div class=\"acu-avatar-info\">\n                            <div class=\"acu-avatar-name-row\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(userNodeForDisplay.name)}</div>\n                                <div class=\"acu-avatar-actions\">\n                                    <button class=\"acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                    <button class=\"acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                </div>\n                            </div>\n                            <input type=\"text\" class=\"acu-avatar-url\" placeholder=\"URL...\" value=\"${escapeHtml(currentUrl)}\" />\n                            <input type=\"text\" class=\"acu-avatar-aliases\" placeholder=\"...\" value=\"${escapeHtml(aliases)}\" title=\": , \" />\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none;\" />\n                        </div>\n                    </div>\n                `;\n        }\n\n        // \n        for (const node of otherNodes) {\n          const data = avatars[node.name] || {};\n          let currentUrl = data.url || '';\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(node.name);\n          let displayUrl = '';\n          let sourceLabel = '';\n\n          if (hasLocal) {\n            displayUrl = await LocalAvatarDB.get(node.name);\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n          } else if (currentUrl) {\n            displayUrl = currentUrl;\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n          }\n\n          const aliases = (data.aliases || []).join(', ');\n          const hasAvatar = !!displayUrl;\n\n          listHtml += `\n                    <div class=\"acu-avatar-item\" data-name=\"${escapeHtml(node.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <div class=\"acu-avatar-preview-wrap\">\n                            <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" style=\"${hasAvatar ? `background-image: url('${displayUrl}'); background-position: ${data.offsetX ?? 50}% ${data.offsetY ?? 50}%; background-size: ${data.scale ?? 150}%;` : ''}\">\n                                ${!hasAvatar ? `<span>${escapeHtml(node.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                            </div>\n                            ${sourceLabel}\n                        </div>\n                        <div class=\"acu-avatar-info\">\n                            <div class=\"acu-avatar-name-row\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(node.name)}</div>\n                                <div class=\"acu-avatar-actions\">\n                                    <button class=\"acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                    <button class=\"acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                </div>\n                            </div>\n                            <input type=\"text\" class=\"acu-avatar-url\" placeholder=\"URL...\" value=\"${escapeHtml(currentUrl)}\" />\n                            <input type=\"text\" class=\"acu-avatar-aliases\" placeholder=\"...\" value=\"${escapeHtml(aliases)}\" title=\": , \" />\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none;\" />\n                        </div>\n                    </div>\n                `;\n        }\n\n        return listHtml;\n      };\n\n      // \n      const managerHtml = `\n            <div class=\"acu-avatar-manager-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-avatar-manager\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-avatar-title\"><i class=\"fa-solid fa-user-circle\"></i> </div>\n                        <div style=\"display:flex;gap:4px;align-items:center;\">\n                            <button class=\"acu-avatar-import-btn\" title=\"\"><i class=\"fa-solid fa-file-import\"></i></button>\n                            <button class=\"acu-avatar-export-btn\" title=\"\"><i class=\"fa-solid fa-file-export\"></i></button>\n                            <button class=\"acu-avatar-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-avatar-list\" id=\"acu-avatar-list-container\">\n                        <div style=\"text-align:center;padding:20px;color:${t.textSub};\">\n                            <i class=\"fa-solid fa-spinner fa-spin\"></i> ...\n                        </div>\n                    </div>\n                </div>\n                <input type=\"file\" id=\"acu-avatar-file-input\" accept=\".json\" style=\"display:none;\" />\n            </div>\n        `;\n\n      const $manager = $(managerHtml);\n      $('body').append($manager);\n\n      // \n      buildList().then(listHtml => {\n        $manager.find('#acu-avatar-list-container').html(listHtml);\n        bindAvatarEvents();\n      });\n\n      // \n      const refreshItem = async name => {\n        const $item = $manager.find(`.acu-avatar-item[data-name=\"${name}\"]`);\n        if (!$item.length) return;\n\n        const data = AvatarManager.getAll()[name] || {};\n        const hasLocal = await AvatarManager.hasLocalAvatar(name);\n        let displayUrl = '';\n        let sourceLabel = '';\n\n        if (hasLocal) {\n          displayUrl = await LocalAvatarDB.get(name);\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n        } else if (data.url) {\n          displayUrl = data.url;\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n        }\n\n        const $preview = $item.find('.acu-avatar-preview');\n        $item.find('.acu-avatar-source').remove();\n\n        if (displayUrl) {\n          $preview\n            .addClass('has-image')\n            .css({\n              'background-image': `url('${displayUrl}')`,\n              'background-position': `${data.offsetX ?? 50}% ${data.offsetY ?? 50}%`,\n              'background-size': `${data.scale ?? 150}%`,\n            })\n            .find('span')\n            .remove();\n          $item.find('.acu-avatar-preview-wrap').append(sourceLabel);\n        } else {\n          $preview\n            .removeClass('has-image')\n            .css({ 'background-image': '', 'background-position': '', 'background-size': '' })\n            .html(\n              `<span>${escapeHtml(name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>`,\n            );\n        }\n\n        $item.attr('data-has-local', hasLocal);\n        $item.attr('data-display-url', displayUrl);\n      };\n\n      const bindAvatarEvents = () => {\n        // \n        $manager.on('click', '.acu-avatar-preview', async function (e) {\n          e.stopPropagation();\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const displayUrl = $item.attr('data-display-url');\n\n          if (displayUrl) {\n            //   \n            showAvatarCropModal(displayUrl, name, async result => {\n              const data = AvatarManager.getAll()[name] || {};\n              AvatarManager.set(name, data.url || '', result.offsetX, result.offsetY, result.scale, data.aliases || []);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          } else {\n            //   \n            $item.find('.acu-avatar-file-input').click();\n          }\n        });\n\n        // \n        $manager.on('change', '.acu-avatar-file-input', async function (e) {\n          const file = e.target.files[0];\n          if (!file) return;\n\n          if (!file.type.startsWith('image/')) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          if (file.size > 5 * 1024 * 1024) {\n            if (window.toastr) window.toastr.warning(' 5MB');\n            return;\n          }\n\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n\n          try {\n            const success = await AvatarManager.saveLocalAvatar(name, file);\n            if (success) {\n              const newUrl = await LocalAvatarDB.get(name);\n              await refreshItem(name);\n\n              // \n              showAvatarCropModal(newUrl, name, async result => {\n                const data = AvatarManager.getAll()[name] || {};\n                AvatarManager.set(\n                  name,\n                  data.url || '',\n                  result.offsetX,\n                  result.offsetY,\n                  result.scale,\n                  data.aliases || [],\n                );\n                await refreshItem(name);\n                onUpdate && onUpdate();\n              });\n            }\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            if (window.toastr) window.toastr.error('');\n          }\n\n          $(this).val('');\n        });\n\n        // URL  \n        $manager.on('click', '.acu-avatar-save-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const url = $item.find('.acu-avatar-url').val().trim();\n          const aliasesStr = $item.find('.acu-avatar-aliases').val().trim();\n          const aliases = aliasesStr\n            ? aliasesStr\n                .split(/[,]/)\n                .map(s => s.trim())\n                .filter(s => s && s !== name)\n            : [];\n\n          const data = AvatarManager.getAll()[name] || {};\n\n          // \n          AvatarManager.set(name, url, data.offsetX ?? 50, data.offsetY ?? 50, data.scale ?? 150, aliases);\n\n          // URL\n          const hasLocal = $item.attr('data-has-local') === 'true';\n          if (url && !hasLocal) {\n            await refreshItem(name);\n            showAvatarCropModal(url, name, async result => {\n              AvatarManager.set(name, url, result.offsetX, result.offsetY, result.scale, aliases);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          } else {\n            await refreshItem(name);\n            onUpdate && onUpdate();\n          }\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-clear-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n\n          await AvatarManager.deleteLocalAvatar(name);\n          AvatarManager.remove(name);\n\n          $item.find('.acu-avatar-url').val('');\n          $item.find('.acu-avatar-aliases').val('');\n          await refreshItem(name);\n          onUpdate && onUpdate();\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-export-btn', function () {\n          const exportData = AvatarManager.exportData();\n          const jsonStr = JSON.stringify(exportData, null, 2);\n          const blob = new Blob([jsonStr], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `avatar-config-${new Date().toISOString().slice(0, 10)}.json`;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-import-btn', function () {\n          $manager.find('#acu-avatar-file-input').click();\n        });\n\n        $manager.on('change', '#acu-avatar-file-input', function (e) {\n          const file = e.target.files[0];\n          if (!file) return;\n\n          const reader = new FileReader();\n          reader.onload = function (evt) {\n            try {\n              const jsonData = JSON.parse(evt.target.result);\n              const analysis = AvatarManager.analyzeImport(jsonData);\n\n              if (!analysis.valid) {\n                if (window.toastr) window.toastr.error(analysis.error);\n                return;\n              }\n\n              showImportConfirmDialog(jsonData, analysis, () => {\n                $manager.remove();\n                showAvatarManager(nodeArr, onUpdate);\n                onUpdate && onUpdate();\n              });\n            } catch (err) {\n              console.error('[DICE]ACU :', err);\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n          reader.readAsText(file);\n          $(this).val('');\n        });\n      };\n\n      // \n      const closeManager = () => $manager.remove();\n      $manager.on('click', '.acu-avatar-close', closeManager);\n      $manager.on('click', function (e) {\n        if ($(e.target).hasClass('acu-avatar-manager-overlay')) closeManager();\n      });\n    } catch (error) {\n      console.error(':', error);\n      if (window.toastr) {\n        const errorMsg = error instanceof Error ? error.message : '';\n        window.toastr.error(`: ${errorMsg}`);\n      }\n      // DOM\n      $('.acu-avatar-manager-overlay').remove();\n    }\n  };\n\n  // \n  const showImportConfirmDialog = (jsonData, analysis, onComplete) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const t = getThemeColors();\n    const config = getConfig();\n\n    const hasConflicts = analysis.conflicts.length > 0;\n    const conflictListHtml =\n      analysis.conflicts.length > 0\n        ? `<div style=\"max-height:80px;overflow-y:auto;background:rgba(0,0,0,0.1);border-radius:4px;padding:6px 8px;margin-top:6px;font-size:11px;color:${t.textSub};\">${analysis.conflicts.map(n => escapeHtml(n)).join(', ')}</div>`\n        : '';\n\n    const dialogHtml = `\n            <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-import-confirm-dialog\">\n                    <div class=\"acu-import-confirm-header\">\n                        <i class=\"fa-solid fa-file-import\"></i> \n                    </div>\n                    <div class=\"acu-import-confirm-body\">\n                        <div class=\"acu-import-stats\">\n                            <div class=\"acu-import-stat\">\n                                <span class=\"acu-stat-num\">${analysis.total}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-new\">\n                                <span class=\"acu-stat-num\">${analysis.newItems.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-conflict\">\n                                <span class=\"acu-stat-num\">${analysis.conflicts.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                        </div>\n\n                        ${\n                          hasConflicts\n                            ? `\n                            <div class=\"acu-import-conflict-section\">\n                                <div style=\"font-size:12px;font-weight:bold;color:${t.textMain};margin-bottom:4px;\">\n                                    <i class=\"fa-solid fa-exclamation-triangle\" style=\"color:${t.warningIcon};\"></i> \n                                </div>\n                                ${conflictListHtml}\n                                <div class=\"acu-import-conflict-options\">\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"overwrite\" checked />\n                                        <span></span>\n                                    </label>\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"skip\" />\n                                        <span></span>\n                                    </label>\n                                </div>\n                            </div>\n                        `\n                            : `\n                            <div style=\"text-align:center;padding:10px;color:${t.successText};\">\n                                <i class=\"fa-solid fa-check-circle\"></i> \n                            </div>\n                        `\n                        }\n                    </div>\n                    <div class=\"acu-import-confirm-footer\">\n                        <button class=\"acu-import-cancel-btn\"></button>\n                        <button class=\"acu-import-confirm-btn\"></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n            position: fixed !important;\n            top: 0 !important;\n            left: 0 !important;\n            right: 0 !important;\n            bottom: 0 !important;\n            width: 100vw !important;\n            height: 100vh !important;\n            background: rgba(0,0,0,0.6) !important;\n            z-index: 2147483655 !important;\n            display: flex;\n            justify-content: center !important;\n            align-items: center !important;\n            padding: 16px;\n            box-sizing: border-box !important;\n        `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(closeDialog);\n    $dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-import-confirm-overlay')) closeDialog();\n    });\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const overwrite = $dialog.find('input[name=\"conflict-mode\"]:checked').val() !== 'skip';\n      try {\n        const stats = AvatarManager.importData(jsonData, overwrite);\n        closeDialog();\n        onComplete && onComplete();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + err.message);\n      }\n    });\n  };\n  // []  ()\n  const showCardEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    let rawData = cachedRawData || getTableData() || loadSnapshot();\n\n    let displayRow = row;\n    // \n    if (rawData && rawData[tableKey] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n      displayRow = rawData[tableKey]?.content?.[rowIndex + 1];\n    }\n\n    const inputsHtml = displayRow\n      .map((cell, idx) => {\n        if (idx === 0) return ''; // \n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        //  textarea\n        return `\n                <div class=\"acu-card-edit-field\" style=\"margin-bottom: 10px;\">\n                    <label style=\"display:block;font-size:12px;color:var(--acu-accent);font-weight:bold;margin-bottom:4px;\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\"\n                    style=\"width:100%;min-height:40px;max-height:500px;padding:10px;resize:none;overflow-y:hidden;\">${escapeHtml(val)}</textarea>\n                </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${inputsHtml}\n                    </div>\n                     <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-card-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-card-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // --- []  ---\n    const adjustHeight = el => {\n      //  auto  0px shrinking  scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    // -----------------------------\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-card-cancel').click(closeDialog);\n\n    //  v8.4  saveDataToDatabase\n    dialog.find('#dlg-card-save').click(async () => {\n      let rawData = cachedRawData || getTableData() || loadSnapshot();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n        if (hasChanges) {\n          try {\n            await saveDataToDatabase(rawData, false, true); //  v8.4 \n            renderInterface();\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            // \n            return;\n          }\n        }\n      }\n      closeDialog();\n    });\n    dialog.on('click', function (e) {\n      // \n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        closeDialog();\n        return;\n      }\n      // \n      if ($(e.target).closest('#dlg-close-x, #dlg-close, .acu-close-btn').length) {\n        closeDialog();\n      }\n    });\n  };\n\n  // [] \n  let _configCache = null;\n  const getConfig = () => {\n    if (!_configCache) _configCache = { ...DEFAULT_CONFIG, ...Store.get(STORAGE_KEY_UI_CONFIG, {}) };\n    return _configCache;\n  };\n  const saveConfig = newCfg => {\n    _configCache = { ...getConfig(), ...newCfg };\n    Store.set(STORAGE_KEY_UI_CONFIG, _configCache);\n    applyConfigStyles(_configCache);\n  };\n\n  const generateDiffMap = currentData => {\n    const lastData = loadSnapshot();\n    const diffSet = new Set();\n    if (!lastData) return diffSet;\n\n    for (const sheetId in currentData) {\n      const newSheet = currentData[sheetId];\n      const oldSheet = lastData[sheetId];\n      if (!newSheet || !newSheet.name) continue;\n      const tableName = newSheet.name;\n      if (!oldSheet) {\n        if (newSheet.content) {\n          newSheet.content.forEach((row, rIdx) => {\n            if (rIdx > 0) diffSet.add(`${tableName}-row-${rIdx - 1}`);\n          });\n        }\n        continue;\n      }\n      const newRows = newSheet.content || [];\n      const oldRows = oldSheet.content || [];\n      newRows.forEach((row, rIdx) => {\n        if (rIdx === 0) return;\n        const oldRow = oldRows[rIdx];\n        if (!oldRow) {\n          diffSet.add(`${tableName}-row-${rIdx - 1}`);\n        } else {\n          row.forEach((cell, cIdx) => {\n            if (cIdx === 0) return;\n            const oldCell = oldRow[cIdx];\n            if (String(cell) !== String(oldCell)) diffSet.add(`${tableName}-${rIdx - 1}-${cIdx}`);\n          });\n        }\n      });\n    }\n    return diffSet;\n  };\n\n  const applyConfigStyles = config => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    const fontVal = FONTS.find(f => f.id === config.fontFamily)?.val || FONTS[0].val;\n\n    // []  ID  Style \n    const $styleTag = $('#acu-dynamic-font');\n    const currentFontId = $styleTag.data('font-id');\n\n    if (currentFontId !== config.fontFamily) {\n      $styleTag.remove();\n      const fontImport = `\n                @import url(\"https://fontsapi.zeoseven.com/3/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/442/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/256/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/482/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/446/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/570/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/292/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/69/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/7/main/result.css\");\n            `;\n      $('head').append(`\n                <style id=\"acu-dynamic-font\" data-font-id=\"${config.fontFamily}\">\n                    ${fontImport}\n                    .acu-wrapper, .acu-edit-dialog, .acu-cell-menu, .acu-nav-container, .acu-data-card, .acu-panel-title, .acu-settings-label, .acu-btn-block, .acu-nav-btn, .acu-edit-textarea,\n                    .acu-dice-panel, .acu-contest-panel, .acu-dice-config-dialog,\n                    .acu-relation-graph-container, .acu-avatar-manager, .acu-import-confirm-dialog {\n                        font-family: ${fontVal} !important;\n                    }\n                </style>\n            `);\n    }\n\n    // []  CSS \n    const cssVars = {\n      '--acu-card-width': `${config.cardWidth}px`,\n      '--acu-font-size': `${config.fontSize}px`,\n      '--acu-opt-font-size': `${config.optionFontSize || 12}px`,\n      '--acu-grid-cols': config.gridColumns,\n    };\n\n    if ($wrapper.length) {\n      $wrapper.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $wrapper.addClass(`acu-theme-${config.theme}`);\n      $wrapper.css(cssVars);\n    }\n\n    const $optContainer = $('.acu-embedded-options-container');\n    if ($optContainer.length) {\n      $optContainer.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $optContainer.addClass(`acu-theme-${config.theme}`);\n      $optContainer.css(cssVars);\n    }\n  };\n\n  /**\n   * \n   *\n   * CSS  ./styles.ts \n   *  styles.ts  MAIN_STYLES \n   *\n   * @see ./styles.ts - MAIN_STYLES \n   */\n  const addStyles = () => {\n    if (window._acuStylesInjected && $(`#${SCRIPT_ID}-styles`).length) return;\n    window._acuStylesInjected = true;\n    const { $ } = getCore();\n    $('style').each(function () {\n      if (this.id && this.id.startsWith('acu_') && this.id.endsWith('-styles') && this.id !== `${SCRIPT_ID}-styles`)\n        $(this).remove();\n    });\n    $(`#${SCRIPT_ID}-styles`).remove();\n    const styles = `<style id=\"${SCRIPT_ID}-styles\">${MAIN_STYLES}</style>`;\n    $('head').append(styles);\n  };\n\n  const getTableData = () => {\n    const api = getCore().getDB();\n    if (!api || !api.exportTableAsJson) {\n      console.warn('[DICE] API ');\n      return null;\n    }\n    try {\n      const data = api.exportTableAsJson();\n      if (data) {\n        const sheetCount = Object.keys(data).filter(k => k.startsWith('sheet_')).length;\n        console.info(`[DICE] ${sheetCount} `);\n      }\n      return data;\n    } catch (e) {\n      console.error('[DICE]:', e);\n      return null;\n    }\n  };\n\n  const saveDataToDatabase = async (tableData, skipRender = false, commitDeletes = false) => {\n    if (isSaving) {\n      console.warn('[DICE]');\n      return; // \n    }\n    console.info('[DICE]...');\n    isSaving = true;\n    const { $ } = getCore();\n    const $saveBtn = $('#acu-btn-save-global');\n\n    // UI \n    if (!skipRender && $saveBtn.length) {\n      $saveBtn.find('i').removeClass('fa-save').addClass('fa-spinner fa-spin');\n      $saveBtn.prop('disabled', true);\n    }\n\n    try {\n      // 1.  sheet_  ( = )\n      const dataToSave = {};\n      //  mate \n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // 2.  ()\n      if (commitDeletes) {\n        const deletions = getPendingDeletions();\n        Object.keys(deletions).forEach(key => {\n          if (dataToSave[key] && dataToSave[key].content) {\n            deletions[key]\n              .sort((a, b) => b - a)\n              .forEach(idx => {\n                if (dataToSave[key].content[idx + 1]) dataToSave[key].content.splice(idx + 1, 1);\n              });\n          }\n        });\n        savePendingDeletions({});\n      }\n\n      // 3. \n      let jsonString;\n      try {\n        jsonString = JSON.stringify(dataToSave);\n        //  10MB \n        const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n        if (sizeInMB > 10) {\n          throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n        }\n        console.info(`[DICE]: ${sizeInMB.toFixed(2)}MB`);\n      } catch (stringifyError) {\n        console.error('[DICE]ACU JSON :', stringifyError);\n        throw new Error(`: ${stringifyError.message || stringifyError}`);\n      }\n\n      // 4.  API  ()\n      const api = getCore().getDB();\n      if (!api || !api.importTableAsJson) {\n        throw new Error(' API ');\n      }\n\n      try {\n        //  importTableAsJson saveChat()\n        //  saveChat()  \"Settings could not be saved\" \n        const result = await api.importTableAsJson(jsonString);\n        //  false \n        if (result === false) {\n          throw new Error(' false');\n        }\n        console.info('[DICE]');\n      } catch (apiError) {\n        console.error('[DICE]ACU API :', apiError);\n        //  \"Settings could not be saved\" \n        const errorMsg = apiError.message || String(apiError);\n        if (\n          errorMsg.includes('Settings could not be saved') ||\n          errorMsg.includes('server connection') ||\n          errorMsg.includes('data loss')\n        ) {\n          throw new Error('');\n        }\n        throw new Error(`: ${errorMsg}`);\n      }\n\n      // 5. \n      cachedRawData = dataToSave;\n      saveSnapshot(dataToSave);\n      hasUnsavedChanges = false;\n      currentDiffMap = new Set();\n      if (window.acuModifiedSet) window.acuModifiedSet.clear();\n      console.info('[DICE]');\n\n      if (!skipRender) {\n        renderInterface();\n      }\n    } catch (e) {\n      const errorMessage = e.message || '';\n      console.error('[DICE]:', {\n        error: e,\n        message: errorMessage,\n        stack: e.stack,\n      });\n      if (window.toastr) {\n        window.toastr.error(errorMessage, '', { timeOut: 5000 });\n      } else {\n        alert(`: ${errorMessage}`);\n      }\n      // \n      throw e;\n    } finally {\n      isSaving = false;\n      console.info('[DICE]');\n      if (!skipRender && $saveBtn.length) {\n        $saveBtn.find('i').removeClass('fa-spinner fa-spin').addClass('fa-save');\n        $saveBtn.prop('disabled', false);\n      }\n    }\n  };\n\n  // [] \n  const saveDataOnly = async tableData => {\n    try {\n      const dataToSave = {};\n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // \n      let jsonString;\n      try {\n        jsonString = JSON.stringify(dataToSave);\n        //  10MB \n        const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n        if (sizeInMB > 10) {\n          throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n        }\n      } catch (stringifyError) {\n        console.error('[DICE]ACU JSON :', stringifyError);\n        throw new Error(`: ${stringifyError.message || stringifyError}`);\n      }\n\n      const api = getCore().getDB();\n      if (!api || !api.importTableAsJson) {\n        throw new Error(' API ');\n      }\n\n      try {\n        //  importTableAsJson saveChat()\n        const result = await api.importTableAsJson(jsonString);\n        //  false \n        if (result === false) {\n          throw new Error(' false');\n        }\n      } catch (apiError) {\n        console.error('[DICE]ACU API :', apiError);\n        //  \"Settings could not be saved\" \n        const errorMsg = apiError.message || String(apiError);\n        if (\n          errorMsg.includes('Settings could not be saved') ||\n          errorMsg.includes('server connection') ||\n          errorMsg.includes('data loss')\n        ) {\n          throw new Error('');\n        }\n        throw new Error(`: ${errorMsg}`);\n      }\n\n      cachedRawData = dataToSave;\n      //  saveSnapshot() hasUnsavedChanges\n    } catch (e) {\n      console.error('[DICE]ACU saveDataOnly error:', e);\n      // \n      throw e;\n    }\n  };\n  const processJsonData = json => {\n    const tables = {};\n    if (!json || typeof json !== 'object') return tables;\n    for (const sheetId in json) {\n      if (json[sheetId]?.name) {\n        const sheet = json[sheetId];\n        tables[sheet.name] = {\n          key: sheetId,\n          headers: sheet.content ? sheet.content[0] || [] : [],\n          rows: sheet.content ? sheet.content.slice(1) : [],\n          rawContent: sheet.content || [],\n          exportConfig: sheet.exportConfig || {},\n          updateConfig: sheet.updateConfig || {},\n          ...sheet,\n        };\n      }\n    }\n    return tables;\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function suggestFormatValue(pattern, rowIndex, existingValues = [], tableContent = null) {\n    if (!pattern || rowIndex === undefined || rowIndex < 0) return null;\n\n    try {\n      //  \"+\"  ^AM\\d{3}$\n      // pattern  JavaScript  '^AM\\\\d{3}$' '^AM\\d{3}$'\n      //  \\d{3} /\\\\d\\{3\\}/+d\n      // ^?[]+\\d\\{\\}$?\n      const prefixMatch = pattern.match(/^\\^?([A-Za-z]+)\\\\d\\{(\\d+)\\}\\$?$/);\n\n      if (prefixMatch) {\n        const prefix = prefixMatch[1]; // \"AM\"\n        const digits = parseInt(prefixMatch[2], 10); // 3\n\n        // \n        if (tableContent && (tableContent.name === '' || tableContent.name === '')) {\n          const headers = tableContent.content?.[0] || [];\n          const rows = tableContent.content?.slice(1) || [];\n          const codeIndex = headers.indexOf('');\n\n          if (codeIndex >= 0) {\n            // \n            const existingNumbers = [];\n            rows.forEach(row => {\n              const codeValue = row?.[codeIndex];\n              if (codeValue && typeof codeValue === 'string') {\n                const match = codeValue.match(new RegExp(`^${prefix}(\\\\d+)$`));\n                if (match) {\n                  const num = parseInt(match[1], 10);\n                  if (!isNaN(num)) existingNumbers.push(num);\n                }\n              }\n            });\n\n            // \n            const maxNum = existingNumbers.length > 0 ? Math.max(...existingNumbers) : 0;\n            const nextNum = String(maxNum + 1).padStart(digits, '0');\n            return prefix + nextNum;\n          }\n        }\n\n        // \n        const nextNum = String(rowIndex + 1).padStart(digits, '0');\n        return prefix + nextNum;\n      }\n\n      //  \\d{3} \n      const numOnlyMatch = pattern.match(/^\\^?\\\\d\\{(\\d+)\\}\\$?$/);\n      if (numOnlyMatch) {\n        const digits = parseInt(numOnlyMatch[1], 10);\n        return String(rowIndex + 1).padStart(digits, '0');\n      }\n    } catch (e) {\n      console.error('[DICE]ACU :', e);\n    }\n\n    return null; // \n  }\n\n  //  OR \n  function getRelationOptions(refTable, refColumns, rawData) {\n    const options = new Set();\n    if (!refTable || !refColumns || !rawData) return Array.from(options);\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        columns.forEach(col => {\n          const colIdx = headers.indexOf(col);\n          if (colIdx >= 0) {\n            rows.forEach(row => {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                options.add(String(value).trim());\n              }\n            });\n          }\n        });\n\n        break; // \n      }\n    }\n\n    return Array.from(options).sort();\n  }\n\n  // \n  function isValueInRelationTable(value, refTable, refColumns, rawData) {\n    if (!value || !refTable || !refColumns || !rawData) return false;\n    if (String(value).trim() === '') return false;\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n    const strVal = String(value).trim();\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        for (const col of columns) {\n          const colIdx = headers.indexOf(col);\n          if (colIdx === -1) continue;\n\n          // \n          for (let i = 0; i < rows.length; i++) {\n            const cellValue = rows[i]?.[colIdx];\n            if (cellValue !== null && cellValue !== undefined && String(cellValue).trim() === strVal) {\n              return true; // \n            }\n          }\n        }\n\n        break; // \n      }\n    }\n\n    return false; // \n  }\n\n  //  required \n  function getColumnExamples(tableName, columnName, currentRowIndex, rawData, maxCount = 5) {\n    const examples = new Set();\n    if (!tableName || !columnName || !rawData) return [];\n\n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === tableName) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n        const colIdx = headers.indexOf(columnName);\n\n        if (colIdx >= 0) {\n          rows.forEach((row, idx) => {\n            if (idx !== currentRowIndex) {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                examples.add(String(value).trim());\n              }\n            }\n          });\n        }\n        break;\n      }\n    }\n\n    return Array.from(examples).slice(0, maxCount);\n  }\n\n  // \n  function getNearestValidNumber(currentValue, min, max) {\n    const num = parseFloat(currentValue);\n    if (isNaN(num)) return min !== undefined ? min : 0;\n    if (min !== undefined && num < min) return min;\n    if (max !== undefined && num > max) return max;\n    return num;\n  }\n\n  // ========================================\n  // []  - \n  // ========================================\n  const refreshRegexRulesList = () => {\n    const { $ } = getCore();\n    const dialog = $('.acu-settings-dialog');\n    if (!dialog.length) return;\n\n    const $rulesList = dialog.find('#regex-rules-list');\n    if (!$rulesList.length) return;\n\n    // HTML\n    const rules = RegexTransformationManager.getAllRules();\n    const html = rules\n      .map(rule => {\n        const scopeIcon =\n          rule.scope.type === 'global' ? 'fa-globe' : rule.scope.type === 'table' ? 'fa-table' : 'fa-columns';\n        const scopeText =\n          rule.scope.type === 'global'\n            ? ''\n            : rule.scope.type === 'table'\n              ? rule.scope.tableNames?.join(',')\n              : `${rule.scope.tableNames?.join(',')}.${rule.scope.columnNames?.join(',')}`;\n        return `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n              <div class=\"acu-rule-type-icon\" title=\": ${escapeHtml(rule.scope.type)}\">\n                  <i class=\"fa-solid ${scopeIcon}\"></i>\n              </div>\n              <div class=\"acu-rule-info\">\n                  <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                  <div class=\"acu-rule-target\" style=\"font-size:10px;\">${escapeHtml(scopeText)} | ${escapeHtml(rule.operation)}</div>\n              </div>\n              <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n              <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                  <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n              </div>\n              <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n      `;\n      })\n      .join('');\n\n    // HTML,\n    $rulesList.html(html);\n  };\n\n  // ========================================\n  // /\n  // ========================================\n  const showAddValidationRuleModal = (parentDialog: JQuery, editRuleId?: string) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const tables = processJsonData(rawData || {});\n    const tableNames = Object.keys(tables);\n\n    // \n    const isEditMode = !!editRuleId;\n    const existingRule = isEditMode ? ValidationRuleManager.getRule(editRuleId) : null;\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\" ${isEditMode ? 'style=\"opacity:0;transition:opacity 0.15s ease-in;\"' : ''}>\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-dice-cfg-header\">\n            <span><i class=\"fa-solid ${isEditMode ? 'fa-pen' : 'fa-plus'}\"></i> ${isEditMode ? '' : ''}</span>\n            <button class=\"acu-config-close\" id=\"dlg-rule-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-table\" class=\"acu-setting-select\">\n                <option value=\"\">...</option>\n                ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"row-column\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-column\" class=\"acu-setting-select\" disabled>\n                <option value=\"\">...</option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-type\" class=\"acu-setting-select\">\n                <optgroup label=\"  \">\n                  <option value=\"tableReadonly\"></option>\n                  <option value=\"rowLimit\"></option>\n                  <option value=\"sequence\"></option>\n                </optgroup>\n                <optgroup label=\"  \">\n                  <option value=\"required\"></option>\n                  <option value=\"format\"></option>\n                  <option value=\"enum\"></option>\n                  <option value=\"numeric\"></option>\n                  <option value=\"relation\"></option>\n                  <option value=\"keyValue\"></option>\n                </optgroup>\n              </select>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-tableReadonly\">\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ,\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-rowLimit\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-max\" class=\"acu-panel-input\" placeholder=\"\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-sequence\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-sequence-prefix\" class=\"acu-panel-input\" placeholder=\"AM\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-sequence-start\" class=\"acu-panel-input\" placeholder=\"1\" value=\"1\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-sequence-paired-table\" class=\"acu-setting-select\" style=\"flex:1;\">\n                  <option value=\"\"></option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> \"+\"(AM0001, AM0002, AM0003...),<br>\n                <i class=\"fa-solid fa-link\" style=\"margin-top:4px;display:block;color:var(--acu-warning-icon);margin-right:6px;\"></i> ,,\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-required\" style=\"display:none;\">\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-format\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-pattern\" class=\"acu-panel-input\" placeholder=\"^AM\\\\d{3}$\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-enum\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-values\" class=\"acu-panel-input\" placeholder=\",,\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-numeric\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-relation\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-table\" class=\"acu-setting-select\">\n                  <option value=\"\">...</option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-column\" class=\"acu-setting-select\" multiple style=\"flex:1;min-height:80px;\">\n                  <option value=\"\">...</option>\n                </select>\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ,(OR ) Ctrl/Cmd \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-keyValue\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-keyvalue-type\" class=\"acu-setting-select\">\n                  <option value=\"text\"></option>\n                  <option value=\"numeric\"></option>\n                </select>\n              </div>\n              <div class=\"acu-setting-row\" id=\"row-keyvalue-range\" style=\"display:none;\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ::;:(,)\n              </div>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-error-msg\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n          </div>\n          <div class=\"acu-dice-cfg-actions\">\n            <button id=\"dlg-rule-cancel\"></button>\n            <button id=\"dlg-rule-save\">${isEditMode ? '' : ''}</button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // select\n    const updateSelectColor = $select => {\n      const val = $select.val();\n      if (!val || val === '') {\n        $select.css('color', 'var(--acu-text-sub)');\n        $select.css('opacity', '0.7');\n      } else {\n        $select.css('color', 'var(--acu-text-main)');\n        $select.css('opacity', '1');\n      }\n    };\n\n    // select\n    dialog.find('select').each(function () {\n      updateSelectColor($(this));\n      $(this).on('change', function () {\n        updateSelectColor($(this));\n      });\n    });\n\n    // \n    dialog.find('#rule-table').on('change', function () {\n      const tableName = $(this).val();\n      const $colSelect = dialog.find('#rule-column');\n      const $pairedTableSelect = dialog.find('#cfg-sequence-paired-table');\n      updateSelectColor($(this));\n\n      // \n      if ($pairedTableSelect.length > 0) {\n        const currentPairedValue = $pairedTableSelect.val();\n        $pairedTableSelect.empty();\n        $pairedTableSelect.append('<option value=\"\"></option>');\n        tableNames\n          .filter(name => name !== tableName)\n          .forEach(name => {\n            $pairedTableSelect.append(`<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`);\n          });\n        // \n        if (currentPairedValue && currentPairedValue !== tableName) {\n          $pairedTableSelect.val(currentPairedValue);\n        }\n        updateSelectColor($pairedTableSelect);\n      }\n\n      if (!tableName || !tables[tableName]) {\n        $colSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($colSelect);\n        return;\n      }\n\n      const headers = tables[tableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $colSelect.html('<option value=\"\">...</option>' + options).prop('disabled', false);\n      updateSelectColor($colSelect);\n    });\n\n    // \n    dialog.find('#cfg-ref-table').on('change', function () {\n      const refTableName = $(this).val();\n      const $refColSelect = dialog.find('#cfg-ref-column');\n      updateSelectColor($(this));\n\n      if (!refTableName || !tables[refTableName]) {\n        $refColSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($refColSelect);\n        return;\n      }\n\n      const headers = tables[refTableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $refColSelect.html(options).prop('disabled', false);\n      updateSelectColor($refColSelect);\n    });\n\n    // \n    dialog.find('#rule-type').on('change', function () {\n      const type = $(this).val();\n      const typeInfo = RULE_TYPE_INFO[type];\n      const isTableRule = typeInfo?.scope === 'table';\n      updateSelectColor($(this));\n\n      // \n      dialog.find('.acu-rule-config-section').hide();\n      dialog.find('#config-' + type).show();\n\n      // sequence\n      if (isTableRule && type !== 'sequence') {\n        dialog.find('#row-column').hide();\n        dialog.find('#rule-column').val('').prop('disabled', true);\n      } else {\n        dialog.find('#row-column').show();\n        // \n        if (dialog.find('#rule-table').val()) {\n          dialog.find('#rule-column').prop('disabled', false);\n        }\n      }\n    });\n\n    // /\n    dialog.find('#cfg-keyvalue-type').on('change', function () {\n      const valueType = $(this).val();\n      if (valueType === 'numeric') {\n        dialog.find('#row-keyvalue-range').show();\n      } else {\n        dialog.find('#row-keyvalue-range').hide();\n      }\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#dlg-rule-close, #dlg-rule-cancel', function (e) {\n      e.stopPropagation(); // \n      closeDialog();\n    });\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) {\n        e.stopPropagation(); // \n        closeDialog();\n      }\n    });\n\n    // \n    dialog.find('#dlg-rule-save').on('click', function () {\n      const name = dialog.find('#rule-name').val()?.trim();\n      const targetTable = dialog.find('#rule-table').val();\n      const targetColumn = dialog.find('#rule-column').val();\n      const ruleType = dialog.find('#rule-type').val();\n      const errorMessage = dialog.find('#rule-error-msg').val()?.trim();\n      const typeInfo = RULE_TYPE_INFO[ruleType];\n      const isTableRule = typeInfo?.scope === 'table';\n\n      // \n      if (!name) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!targetTable) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      // sequence\n      if ((!isTableRule || ruleType === 'sequence') && !targetColumn) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      const ruleConfig = {};\n      if (ruleType === 'tableReadonly') {\n        // \n      } else if (ruleType === 'rowLimit') {\n        const min = dialog.find('#cfg-row-min').val();\n        const max = dialog.find('#cfg-row-max').val();\n        if (min !== '') ruleConfig.min = parseInt(min, 10);\n        if (max !== '') ruleConfig.max = parseInt(max, 10);\n      } else if (ruleType === 'required') {\n        // \n      } else if (ruleType === 'format') {\n        const pattern = dialog.find('#cfg-pattern').val()?.trim();\n        if (!pattern) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        // \n        try {\n          new RegExp(pattern);\n        } catch (e) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n        ruleConfig.pattern = pattern;\n      } else if (ruleType === 'enum') {\n        const valuesStr = dialog.find('#cfg-values').val()?.trim();\n        if (!valuesStr) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        ruleConfig.values = valuesStr\n          .split(',')\n          .map(v => v.trim())\n          .filter(v => v);\n      } else if (ruleType === 'numeric') {\n        const min = dialog.find('#cfg-min').val();\n        const max = dialog.find('#cfg-max').val();\n        if (min !== '') ruleConfig.min = parseFloat(min);\n        if (max !== '') ruleConfig.max = parseFloat(max);\n      } else if (ruleType === 'relation') {\n        const refTable = dialog.find('#cfg-ref-table').val();\n        const refColumns = dialog.find('#cfg-ref-column').val(); // \n\n        if (!refTable) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        const selectedColumns = Array.isArray(refColumns) ? refColumns : refColumns ? [refColumns] : [];\n        if (selectedColumns.length === 0 || (selectedColumns.length === 1 && !selectedColumns[0])) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        ruleConfig.refTable = refTable;\n        // \n        ruleConfig.refColumn = selectedColumns.length === 1 ? selectedColumns[0] : selectedColumns;\n      } else if (ruleType === 'keyValue') {\n        const valueType = dialog.find('#cfg-keyvalue-type').val();\n        ruleConfig.valueType = valueType || 'text';\n\n        if (valueType === 'numeric') {\n          const min = dialog.find('#cfg-keyvalue-min').val();\n          const max = dialog.find('#cfg-keyvalue-max').val();\n          if (min !== '') ruleConfig.valueMin = parseFloat(min);\n          if (max !== '') ruleConfig.valueMax = parseFloat(max);\n        }\n      } else if (ruleType === 'sequence') {\n        const prefix = dialog.find('#cfg-sequence-prefix').val()?.trim() || '';\n        const startFrom = dialog.find('#cfg-sequence-start').val();\n        const pairedTable = dialog.find('#cfg-sequence-paired-table').val()?.trim() || null;\n        ruleConfig.prefix = prefix;\n        ruleConfig.startFrom = startFrom !== '' ? parseInt(startFrom, 10) : 1;\n        if (isNaN(ruleConfig.startFrom)) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        if (pairedTable) {\n          ruleConfig.pairedTable = pairedTable;\n        }\n      }\n\n      // IDID\n      const finalRuleId = isEditMode\n        ? editRuleId\n        : 'custom_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);\n\n      // \n      const ruleData = {\n        id: finalRuleId,\n        name: name,\n        description: existingRule?.description || '',\n        targetTable: targetTable,\n        targetColumn: isTableRule && ruleType !== 'sequence' ? '' : targetColumn, //  targetColumnsequence\n        ruleType: ruleType,\n        config: ruleConfig,\n        errorMessage: errorMessage || typeInfo?.desc || '',\n        intercept: existingRule?.intercept ?? false, // \n        enabled: existingRule?.enabled ?? true, // \n      };\n\n      let success = false;\n      if (isEditMode) {\n        // \n        success = ValidationRuleManager.updateCustomRule(editRuleId, ruleData);\n      } else {\n        // \n        success = ValidationRuleManager.addCustomRule(ruleData);\n      }\n\n      if (success) {\n        closeDialog();\n\n        // \n        ValidationRuleManager.clearCache();\n\n        // \n        const $rulesList = parentDialog.find('#validation-rules-list');\n\n        if (isEditMode) {\n          // \n          const $existingItem = $rulesList.find(`.acu-validation-rule-item[data-rule-id=\"${escapeHtml(editRuleId)}\"]`);\n          if ($existingItem.length) {\n            const hasIntercept = ruleData.intercept;\n            const isEnabled = ruleData.enabled;\n            $existingItem.find('.acu-rule-name').text(name);\n            $existingItem\n              .find('.acu-rule-target')\n              .text(`${targetTable}${isTableRule && ruleType !== 'sequence' ? ' ()' : '.' + targetColumn}`);\n            $existingItem\n              .find('.acu-rule-type-icon')\n              .attr('title', `${typeInfo?.name || ruleType}${isTableRule ? ' ()' : ''}`)\n              .find('i')\n              .attr('class', `fa-solid ${typeInfo?.icon || 'fa-question'}`);\n            $existingItem.toggleClass('disabled', !isEnabled);\n          }\n        } else {\n          // \n          const ruleHtml = `\n          <div class=\"acu-validation-rule-item\" data-rule-id=\"${escapeHtml(finalRuleId)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo?.name || ruleType)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo?.icon || 'fa-question'}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(targetTable)}${isTableRule && ruleType !== 'sequence' ? ' ()' : '.' + escapeHtml(targetColumn)}</div>\n            </div>\n            <div class=\"acu-rule-intercept\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n            <div class=\"acu-rule-toggle active\" title=\"/\">\n              <i class=\"fa-solid fa-toggle-on\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n        `;\n          $rulesList.append(ruleHtml);\n        }\n        // \n      } else {\n        if (window.toastr) window.toastr.error(isEditMode ? '' : '');\n      }\n    });\n\n    // \n    if (isEditMode && existingRule) {\n      dialog.find('#rule-name').val(existingRule.name || '');\n      dialog.find('#rule-error-msg').val(existingRule.errorMessage || '');\n\n      //  change \n      dialog\n        .find('#rule-table')\n        .val(existingRule.targetTable || '')\n        .trigger('change');\n\n      //  change \n      dialog\n        .find('#rule-type')\n        .val(existingRule.ruleType || 'required')\n        .trigger('change');\n\n      // / change \n      setTimeout(() => {\n        // \n        if (existingRule.targetColumn) {\n          dialog.find('#rule-column').val(existingRule.targetColumn);\n          updateSelectColor(dialog.find('#rule-column'));\n        }\n\n        // \n        const cfg = existingRule.config || {};\n        const ruleType = existingRule.ruleType;\n\n        if (ruleType === 'rowLimit') {\n          if (cfg.min !== undefined) dialog.find('#cfg-row-min').val(cfg.min);\n          if (cfg.max !== undefined) dialog.find('#cfg-row-max').val(cfg.max);\n        } else if (ruleType === 'sequence') {\n          dialog.find('#cfg-sequence-prefix').val(cfg.prefix || '');\n          dialog.find('#cfg-sequence-start').val(cfg.startFrom ?? 1);\n          if (cfg.pairedTable) {\n            dialog.find('#cfg-sequence-paired-table').val(cfg.pairedTable);\n            updateSelectColor(dialog.find('#cfg-sequence-paired-table'));\n          }\n        } else if (ruleType === 'format') {\n          dialog.find('#cfg-pattern').val(cfg.pattern || '');\n        } else if (ruleType === 'enum') {\n          dialog.find('#cfg-values').val((cfg.values || []).join(','));\n        } else if (ruleType === 'numeric') {\n          if (cfg.min !== undefined) dialog.find('#cfg-min').val(cfg.min);\n          if (cfg.max !== undefined) dialog.find('#cfg-max').val(cfg.max);\n        } else if (ruleType === 'relation') {\n          if (cfg.refTable) {\n            dialog.find('#cfg-ref-table').val(cfg.refTable).trigger('change');\n            // \n            setTimeout(() => {\n              const refColumns = Array.isArray(cfg.refColumn) ? cfg.refColumn : cfg.refColumn ? [cfg.refColumn] : [];\n              dialog.find('#cfg-ref-column').val(refColumns);\n              updateSelectColor(dialog.find('#cfg-ref-column'));\n              // \n              dialog.css('opacity', '1');\n            }, 100);\n            return; // relation  setTimeout \n          }\n        } else if (ruleType === 'keyValue') {\n          dialog\n            .find('#cfg-keyvalue-type')\n            .val(cfg.valueType || 'text')\n            .trigger('change');\n          if (cfg.valueMin !== undefined) dialog.find('#cfg-keyvalue-min').val(cfg.valueMin);\n          if (cfg.valueMax !== undefined) dialog.find('#cfg-keyvalue-max').val(cfg.valueMax);\n        }\n\n        // \n        dialog.css('opacity', '1');\n      }, 100);\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showSmartFixModal = error => {\n    if (!error || !error.rule) {\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const rule = error.rule;\n    const ruleType = error.ruleType || rule.ruleType;\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n    const isTableRule = typeInfo?.scope === 'table';\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const snapshot = loadSnapshot();\n\n    //  rowTitle\n    if (!error.rowTitle && error.rowIndex >= 0 && rawData && error.tableName) {\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          const row = rawData[sheetId].content?.[error.rowIndex + 1];\n          if (row) {\n            error.rowTitle = row[1] || row[0] || ` ${error.rowIndex + 1}`;\n          }\n          break;\n        }\n      }\n    }\n\n    // \n    let snapshotValue = '';\n    if (!isTableRule && snapshot && error.tableName && error.columnName !== undefined) {\n      for (const sheetId in snapshot) {\n        if (snapshot[sheetId]?.name === error.tableName) {\n          const headers = snapshot[sheetId].content?.[0] || [];\n          const colIdx = headers.indexOf(error.columnName);\n          const rowIdx = error.rowIndex + 1;\n          if (colIdx >= 0 && snapshot[sheetId].content?.[rowIdx]) {\n            snapshotValue = snapshot[sheetId].content[rowIdx][colIdx] ?? '';\n          }\n          break;\n        }\n      }\n    }\n\n    const hasSnapshotValue = snapshotValue !== '' && String(snapshotValue) !== String(error.currentValue || '');\n\n    // ========================================\n    // \n    // ========================================\n    if (isTableRule) {\n      showTableRuleFixModal(error, rule, ruleType, rawData, snapshot, currentThemeClass);\n      return;\n    }\n\n    // ========================================\n    // \n    // ========================================\n\n    // UI\n    let inputHtml = '';\n\n    if (ruleType === 'enum' && rule.config?.values) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'numeric') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'keyValue') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else {\n      // \n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    }\n\n    // \n    let smartSuggestHtml = '';\n\n    if (ruleType === 'required') {\n      // \n      const examples = getColumnExamples(error.tableName, error.columnName, error.rowIndex, rawData, 5);\n      if (examples.length > 0) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            <div class=\"acu-smart-fix-suggest-label\">\n              <i class=\"fa-solid fa-lightbulb\"></i> :\n            </div>\n            <div class=\"acu-smart-fix-suggest-options\">\n              ${examples\n                .map(\n                  val => `\n                <span class=\"acu-smart-fix-option\" data-value=\"${escapeHtml(val)}\" title=\"\">\n                  ${escapeHtml(val.length > 20 ? val.substring(0, 20) + '...' : val)}\n                </span>\n              `,\n                )\n                .join('')}\n            </div>\n          </div>\n        `;\n      }\n    } else if (ruleType === 'enum' && rule.config?.values) {\n      // \n      const validValues = rule.config.values;\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-list\"></i>  ():\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\">\n            ${validValues\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        </div>\n      `;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      // \n      // \n      let tableContent = null;\n      if (rawData && error.tableName) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            tableContent = rawData[sheetId];\n            break;\n          }\n        }\n      }\n      const suggestedValue = suggestFormatValue(rule.config.pattern, error.rowIndex, [], tableContent);\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-font\"></i> : <code>${escapeHtml(rule.config.pattern)}</code>\n          </div>\n          ${\n            suggestedValue\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:4px;display:block;\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </span>\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(suggestedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> ${escapeHtml(suggestedValue)}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'numeric') {\n      // \n      const min = rule.config?.min;\n      const max = rule.config?.max;\n      const currentNum = parseFloat(error.currentValue);\n      const isOutOfRange =\n        !isNaN(currentNum) && ((min !== undefined && currentNum < min) || (max !== undefined && currentNum > max));\n      const nearestValid = isOutOfRange ? getNearestValidNumber(error.currentValue, min, max) : null;\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-hashtag\"></i> : ${min !== undefined ? min : '-'} ~ ${max !== undefined ? max : '+'}\n          </div>\n          ${\n            isOutOfRange && nearestValid !== null\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${nearestValid}\">\n                <i class=\"fa-solid fa-arrow-right\"></i>  ${nearestValid}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      // \n      const options = getRelationOptions(rule.config.refTable, rule.config.refColumn, rawData);\n      const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n      const hasMultipleColumns = refColumns.length > 1;\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      const valueExists = isValueInRelationTable(\n        currentInvalidValue,\n        rule.config.refTable,\n        rule.config.refColumn,\n        rawData,\n      );\n\n      // HTML\n      let optionsHtml = '';\n      if (options.length > 0) {\n        optionsHtml = `\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-link\"></i>  \"${escapeHtml(rule.config.refTable)}\"  (${options.length}):\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\" id=\"smart-fix-options-container\">\n            ${options\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      // \n      let reverseWriteHtml = '';\n      if (currentInvalidValue && !valueExists) {\n        if (hasMultipleColumns) {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <select id=\"smart-fix-reverse-column\" class=\"acu-edit-select\" style=\"width:100%;margin-bottom:8px;\">\n                  ${refColumns.map(col => `<option value=\"${escapeHtml(col)}\">${escapeHtml(col)}</option>`).join('')}\n                </select>\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}\"\n                </button>\n              </div>\n            </div>\n          `;\n        } else {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" data-column=\"${escapeHtml(refColumns[0])}\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}.${escapeHtml(refColumns[0])}\"\n                </button>\n              </div>\n            </div>\n          `;\n        }\n      }\n\n      if (optionsHtml || reverseWriteHtml) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            ${optionsHtml}\n            ${reverseWriteHtml}\n          </div>\n        `;\n      }\n    } else if (ruleType === 'keyValue') {\n      // \n      const valueType = rule.config?.valueType || 'text';\n      const valueMin = rule.config?.valueMin;\n      const valueMax = rule.config?.valueMax;\n\n      // \n      let processedValue = String(error.currentValue || '');\n      processedValue = processedValue.replace(//g, ':').replace(//g, ';').replace(//g, ';').replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n      const issues = [];\n      const fixedPairs = [];\n\n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          issues.push({ pair, error: '/' });\n          continue;\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) {\n          issues.push({ pair, error: '' });\n          continue;\n        }\n\n        let fixedVal = val;\n        let hasIssue = false;\n\n        if (valueType === 'numeric') {\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) {\n            issues.push({ pair, error: `\"${val}\" ` });\n            hasIssue = true;\n          } else {\n            if (valueMin !== undefined && valueMin !== null && numVal < valueMin) {\n              fixedVal = String(valueMin);\n              issues.push({ pair, error: ` ${numVal}  ${valueMin}` });\n              hasIssue = true;\n            } else if (valueMax !== undefined && valueMax !== null && numVal > valueMax) {\n              fixedVal = String(valueMax);\n              issues.push({ pair, error: ` ${numVal}  ${valueMax}` });\n              hasIssue = true;\n            }\n          }\n        }\n\n        fixedPairs.push({ key, val: fixedVal, originalVal: val, hasIssue });\n      }\n\n      // \n      const fixedValue = fixedPairs.map(p => `${p.key}:${p.val}`).join(';');\n      const hasIssues = issues.length > 0 || fixedPairs.some(p => p.hasIssue);\n\n      let issuesHtml = '';\n      if (hasIssues) {\n        issuesHtml = `\n          <div class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:8px;\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i> :\n          </div>\n          <div style=\"margin-bottom:8px;\">\n            ${issues\n              .map(\n                issue => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(issue.pair)} - ${escapeHtml(issue.error)}\n              </div>\n            `,\n              )\n              .join('')}\n            ${fixedPairs\n              .filter(p => p.hasIssue)\n              .map(\n                p => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(p.key)}:${escapeHtml(p.originalVal)}  ${escapeHtml(p.val)}\n              </div>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-key\"></i> : :;:\n          </div>\n          ${\n            valueType === 'numeric'\n              ? `\n            <div class=\"acu-smart-fix-suggest-label\" style=\"margin-top:8px;\">\n              <i class=\"fa-solid fa-hashtag\"></i> : ${valueMin !== undefined ? valueMin : '-'} ~ ${valueMax !== undefined ? valueMax : '+'}\n            </div>\n          `\n              : ''\n          }\n          ${issuesHtml}\n          ${\n            hasIssues\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(fixedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> \n              </span>\n            </div>\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-card-bg);border-radius:4px;font-size:11px;color:var(--acu-text-sub);\">\n              <div style=\"margin-bottom:4px;\"><strong>:</strong></div>\n              <code style=\"color:var(--acu-success-text);\">${escapeHtml(fixedValue)}</code>\n            </div>\n          `\n              : `\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-success-bg);border-radius:4px;font-size:11px;color:var(--acu-success-text);\">\n              <i class=\"fa-solid fa-check-circle\"></i> \n            </div>\n          `\n          }\n        </div>\n      `;\n    }\n\n    // HTML\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} - ${escapeHtml(error.columnName || '')}</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            <!--  -->\n            <div class=\"acu-smart-fix-rule-info\">\n              <div class=\"acu-smart-fix-rule-header\">\n                <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                <span>${escapeHtml(error.ruleName || rule.name || '')}</span>\n              </div>\n              <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || typeInfo.desc || '')}</div>\n            </div>\n\n            <!--  -->\n            ${\n              hasSnapshotValue\n                ? `\n              <div class=\"acu-diff-section acu-diff-old-section\">\n                <div class=\"acu-diff-label\">\n                  <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                </div>\n                <div class=\"acu-diff-readonly\">${escapeHtml(snapshotValue)}</div>\n              </div>\n              <div class=\"acu-diff-arrow-down\"><i class=\"fa-solid fa-arrow-down\"></i></div>\n            `\n                : ''\n            }\n\n            <!--  -->\n            <div class=\"acu-diff-section acu-diff-new-section\">\n              ${\n                error.rowTitle && error.rowIndex >= 0\n                  ? `<div style=\"font-size:12px;color:var(--acu-text-sub);margin-bottom:8px;padding:4px 8px;background:var(--acu-bg-sub);border-radius:4px;\">\n                <i class=\"fa-solid fa-tag\" style=\"margin-right:4px;\"></i>${escapeHtml(error.rowTitle)}\n              </div>`\n                  : ''\n              }\n              <div class=\"acu-diff-label\">\n                <i class=\"fa-solid fa-pen\"></i> \n              </div>\n              ${inputHtml}\n            </div>\n\n            <!--  -->\n            ${\n              smartSuggestHtml\n                ? `\n              <div class=\"acu-smart-fix-suggest-section\">\n                ${smartSuggestHtml}\n              </div>\n            `\n                : ''\n            }\n          </div>\n          <div class=\"acu-dialog-btns\">\n            <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n            ${hasSnapshotValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n            <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    dialog.on('click', '.acu-smart-fix-option, .acu-smart-fix-quick-btn', function () {\n      // \n      if ($(this).attr('id') === 'smart-fix-reverse-write-btn') return;\n      if ($(this).hasClass('acu-smart-fix-option-current')) return;\n      const optionValue = $(this).data('value') || $(this).text().trim();\n      dialog.find('#smart-fix-value').val(optionValue).trigger('input');\n    });\n\n    // \n    dialog.on('click', '#smart-fix-reverse-write-btn', async function () {\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      if (!currentInvalidValue) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      let targetColumn;\n      if (ruleType === 'relation' && rule.config?.refColumn) {\n        const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n        if (refColumns.length > 1) {\n          // \n          targetColumn = dialog.find('#smart-fix-reverse-column').val();\n        } else {\n          // data\n          targetColumn = $(this).data('column') || refColumns[0];\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      if (!targetColumn || !rule.config?.refTable) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      try {\n        const rawData = cachedRawData || getTableData();\n        let refSheet = null;\n        let refSheetId = null;\n\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === rule.config.refTable) {\n            refSheet = rawData[sheetId];\n            refSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!refSheet || !refSheet.content) {\n          if (window.toastr) window.toastr.error(` \"${rule.config.refTable}\"`);\n          return;\n        }\n\n        const headers = refSheet.content[0] || [];\n        const targetColIdx = headers.indexOf(targetColumn);\n\n        if (targetColIdx === -1) {\n          if (window.toastr) window.toastr.error(` \"${targetColumn}\"`);\n          return;\n        }\n\n        // \n        const newRow = new Array(headers.length).fill('');\n        newRow[targetColIdx] = currentInvalidValue;\n\n        // \n        refSheet.content.push(newRow);\n\n        // \n        await saveDataToDatabase(rawData, false, false);\n\n        // \n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-revert', function () {\n      dialog.find('#smart-fix-value').val(snapshotValue);\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-close, #smart-fix-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#smart-fix-confirm').on('click', async function () {\n      const newValue = dialog.find('#smart-fix-value').val()?.trim() || '';\n\n      if (newValue === '' && ruleType === 'required') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      try {\n        const rawData = cachedRawData || getTableData();\n        let updated = false;\n\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            const sheet = rawData[sheetId];\n            const headers = sheet.content?.[0] || [];\n\n            if (error.rowIndex >= 0 && error.columnName) {\n              const colIdx = headers.indexOf(error.columnName);\n              const rowIdx = error.rowIndex + 1;\n\n              if (colIdx >= 0 && sheet.content && sheet.content[rowIdx]) {\n                sheet.content[rowIdx][colIdx] = newValue;\n                updated = true;\n                break;\n              }\n            }\n          }\n        }\n\n        if (updated) {\n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function extractCodesFromTable(sheet, columnName, prefix) {\n    if (!sheet || !sheet.content || sheet.content.length < 2) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const headers = sheet.content[0] || [];\n    const rows = sheet.content.slice(1) || [];\n    const colIndex = headers.indexOf(columnName);\n\n    if (colIndex < 0) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const codes = new Map(); // Map<, >\n    const allCodes = new Set(); // Set<>\n    const codeToRows = new Map(); // Map<, >\n\n    for (let i = 0; i < rows.length; i++) {\n      const value = rows[i]?.[colIndex];\n      if (value === null || value === undefined || value === '') continue;\n\n      const strValue = String(value).trim();\n      if (!strValue) continue;\n\n      // \n      let isValid = false;\n      if (prefix) {\n        const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          isValid = true;\n        }\n      } else {\n        const num = parseInt(strValue, 10);\n        if (!isNaN(num)) {\n          isValid = true;\n        }\n      }\n\n      if (isValid) {\n        allCodes.add(strValue);\n        if (!codeToRows.has(strValue)) {\n          codeToRows.set(strValue, []);\n        }\n        codeToRows.get(strValue).push(i);\n      }\n    }\n\n    return { codes, allCodes, codeToRows };\n  }\n\n  //   \n  function buildCodeMapping(codes1, codes2, prefix, startFrom) {\n    // \n    const allUniqueCodes = new Set([...codes1, ...codes2]);\n\n    // \n    const codeNumbers = [];\n    for (const code of allUniqueCodes) {\n      let num = null;\n      if (prefix) {\n        const match = code.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          num = parseInt(match[1], 10);\n        }\n      } else {\n        num = parseInt(code, 10);\n      }\n\n      if (!isNaN(num)) {\n        codeNumbers.push({ code, num });\n      }\n    }\n\n    // \n    codeNumbers.sort((a, b) => a.num - b.num);\n\n    //   \n    const mapping = new Map();\n    for (let i = 0; i < codeNumbers.length; i++) {\n      const oldCode = codeNumbers[i].code;\n      const newNum = startFrom + i;\n      const newCode = prefix + String(newNum).padStart(4, '0');\n      mapping.set(oldCode, newCode);\n    }\n\n    return mapping;\n  }\n\n  // \n  // \n  // 1. \n  // 2. \n  // 3. \n  function alignAndFixPairedTables(\n    table1Sheet,\n    table1SheetId,\n    table2Sheet,\n    table2SheetId,\n    columnName,\n    mapping,\n    prefix,\n    startFrom,\n    rawData,\n  ) {\n    if (!table1Sheet || !table2Sheet) return { fixedCount1: 0, fixedCount2: 0 };\n\n    const headers1 = table1Sheet.content[0] || [];\n    const rows1 = table1Sheet.content.slice(1) || [];\n    const colIndex1 = headers1.indexOf(columnName);\n\n    const headers2 = table2Sheet.content[0] || [];\n    const rows2 = table2Sheet.content.slice(1) || [];\n    const colIndex2 = headers2.indexOf(columnName);\n\n    if (colIndex1 < 0 || colIndex2 < 0) return { fixedCount1: 0, fixedCount2: 0 };\n\n    let fixedCount1 = 0;\n    let fixedCount2 = 0;\n\n    //  -> \n    const reverseMapping = new Map();\n    for (const [oldCode, newCode] of mapping.entries()) {\n      reverseMapping.set(newCode, oldCode);\n    }\n\n    // \n    const sortedNewCodes = Array.from(mapping.values()).sort((a, b) => {\n      const numA = parseInt(a.replace(prefix, ''), 10);\n      const numB = parseInt(b.replace(prefix, ''), 10);\n      return numA - numB;\n    });\n\n    // \n    const analyzeTable = (rows, colIndex) => {\n      const codeRows = []; // {rowIndex, oldCode, row}\n      const emptyRows = []; // {rowIndex, row, prevOldCode, nextOldCode}\n\n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        const strValue = value === null || value === undefined ? '' : String(value).trim();\n\n        // \n        let isValid = false;\n        if (strValue && prefix) {\n          const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          if (match) isValid = true;\n        } else if (strValue) {\n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) isValid = true;\n        }\n\n        if (isValid) {\n          codeRows.push({ rowIndex: i, oldCode: strValue, row: rows[i] });\n        } else {\n          emptyRows.push({ rowIndex: i, row: rows[i], prevOldCode: null, nextOldCode: null });\n        }\n      }\n\n      // \n      for (const emptyRow of emptyRows) {\n        let prevCode = null;\n        let nextCode = null;\n\n        for (const codeRow of codeRows) {\n          if (codeRow.rowIndex < emptyRow.rowIndex) {\n            prevCode = codeRow.oldCode;\n          }\n          if (codeRow.rowIndex > emptyRow.rowIndex && nextCode === null) {\n            nextCode = codeRow.oldCode;\n            break;\n          }\n        }\n\n        emptyRow.prevOldCode = prevCode;\n        emptyRow.nextOldCode = nextCode;\n      }\n\n      return { codeRows, emptyRows };\n    };\n\n    const analysis1 = analyzeTable(rows1, colIndex1);\n    const analysis2 = analyzeTable(rows2, colIndex2);\n\n    // \n    const buildNewRows = (analysis, headers, colIndex, allOldCodes) => {\n      const newRows = [];\n      const codeRowMap = new Map(); // oldCode -> row data\n\n      // \n      for (const cr of analysis.codeRows) {\n        codeRowMap.set(cr.oldCode, cr.row);\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n\n        if (codeRowMap.has(oldCode)) {\n          // \n          const oldRow = codeRowMap.get(oldCode);\n          const newRow = oldRow.map(cell => cell);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true });\n        } else {\n          // \n          const newRow = new Array(headers.length).fill(null);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true, isInserted: true });\n        }\n      }\n\n      // \n      //  prevOldCode  nextOldCode \n      const result = [];\n      let codeRowIndex = 0;\n\n      // \n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode === null && emptyRow.nextOldCode !== null) {\n          // \n          const nextNewCode = mapping.get(emptyRow.nextOldCode);\n          // \n          while (codeRowIndex < newRows.length && newRows[codeRowIndex].newCode !== nextNewCode) {\n            result.push(newRows[codeRowIndex].row);\n            codeRowIndex++;\n          }\n          result.push(emptyRow.row);\n        } else if (emptyRow.prevOldCode === null && emptyRow.nextOldCode === null) {\n          // \n          result.push(emptyRow.row);\n        }\n      }\n\n      // \n      for (; codeRowIndex < newRows.length; codeRowIndex++) {\n        result.push(newRows[codeRowIndex].row);\n        const currentNewCode = newRows[codeRowIndex].newCode;\n        const currentOldCode = reverseMapping.get(currentNewCode);\n\n        // \n        for (const emptyRow of analysis.emptyRows) {\n          if (emptyRow.prevOldCode === currentOldCode) {\n            result.push(emptyRow.row);\n          }\n        }\n      }\n\n      // prevOldCode nextOldCode  null\n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode !== null && emptyRow.nextOldCode === null) {\n          // \n        }\n      }\n\n      return result;\n    };\n\n    // \n    const newRows1 = buildNewRows(analysis1, headers1, colIndex1, new Set(analysis1.codeRows.map(r => r.oldCode)));\n    const newRows2 = buildNewRows(analysis2, headers2, colIndex2, new Set(analysis2.codeRows.map(r => r.oldCode)));\n\n    // \n    const countCodeChanges = (oldAnalysis, newRows, colIndex) => {\n      let count = 0;\n      // \n      const oldCodes = new Set(oldAnalysis.codeRows.map(r => r.oldCode));\n      const newCodes = new Set();\n\n      for (const row of newRows) {\n        const code = row[colIndex];\n        if (code) newCodes.add(code);\n      }\n\n      // \n      for (const [oldCode, newCode] of mapping.entries()) {\n        if (oldCodes.has(oldCode) && oldCode !== newCode) {\n          count++; // \n        }\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n        if (!oldCodes.has(oldCode)) {\n          count++; // \n        }\n      }\n\n      return count;\n    };\n\n    fixedCount1 = countCodeChanges(analysis1, newRows1, colIndex1);\n    fixedCount2 = countCodeChanges(analysis2, newRows2, colIndex2);\n\n    // \n    table1Sheet.content = [headers1, ...newRows1];\n    table2Sheet.content = [headers2, ...newRows2];\n\n    return { fixedCount1, fixedCount2 };\n  }\n\n  // \n  // ========================================\n  const showTableRuleFixModal = (error, rule, ruleType, rawData, snapshot, currentThemeClass) => {\n    const { $ } = getCore();\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n\n    let contentHtml = '';\n    let actionBtns = '';\n\n    if (ruleType === 'tableReadonly') {\n      // \n      let changeCount = 0;\n      let changeDetails = [];\n\n      if (snapshot && rawData) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            const newRows = rawData[sheetId].content?.slice(1) || [];\n            const oldRows = snapshot[sheetId].content?.slice(1) || [];\n\n            // \n            newRows.forEach((row, idx) => {\n              const oldRow = oldRows[idx];\n              if (!oldRow) {\n                changeDetails.push(`${idx + 1}: `);\n                changeCount++;\n              } else {\n                for (let c = 0; c < row.length; c++) {\n                  if (String(row[c] || '') !== String(oldRow[c] || '')) {\n                    changeDetails.push(`${idx + 1}: `);\n                    changeCount++;\n                    break;\n                  }\n                }\n              }\n            });\n\n            // \n            if (oldRows.length > newRows.length) {\n              for (let i = newRows.length; i < oldRows.length; i++) {\n                changeDetails.push(`${i + 1}: `);\n                changeCount++;\n              }\n            }\n            break;\n          }\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-lock\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\"></div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${changeCount}</strong> \n          </div>\n          ${\n            changeDetails.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\">\n              ${changeDetails\n                .slice(0, 10)\n                .map(d => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(d)}</div>`)\n                .join('')}\n              ${changeDetails.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${changeDetails.length - 10} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n      actionBtns = `\n        <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n        <button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-restore-table\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n      `;\n    } else if (ruleType === 'rowLimit') {\n      // \n      const minRows = rule.config?.min;\n      const maxRows = rule.config?.max;\n      let currentRowCount = 0;\n      let excessRows = [];\n\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          currentRowCount = (rawData[sheetId].content?.length || 1) - 1; // \n          break;\n        }\n      }\n\n      const isTooMany = maxRows !== undefined && currentRowCount > maxRows;\n      const isTooFew = minRows !== undefined && currentRowCount < minRows;\n\n      if (isTooMany) {\n        for (let i = maxRows + 1; i <= currentRowCount; i++) {\n          excessRows.push(i);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-arrows-up-down\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            : <strong>${currentRowCount}</strong> \n            ${minRows !== undefined || maxRows !== undefined ? ` | : ${minRows !== undefined ? minRows : 0} ~ ${maxRows !== undefined ? maxRows : ''} ` : ''}\n          </div>\n          ${\n            isTooMany && excessRows.length > 0\n              ? `\n            <div class=\"acu-smart-fix-excess-rows\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-trash\"></i>  ( ${excessRows[0]} ):\n              </div>\n              <div class=\"acu-smart-fix-change-list\">\n                ${excessRows\n                  .slice(0, 10)\n                  .map(r => `<div class=\"acu-smart-fix-change-item\"> ${r} </div>`)\n                  .join('')}\n                ${excessRows.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${excessRows.length} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n          ${\n            isTooFew\n              ? `\n            <div class=\"acu-smart-fix-hint\">\n              <i class=\"fa-solid fa-info-circle\"></i>  ${minRows - currentRowCount} \n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (isTooMany && excessRows.length > 0) {\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-delete-rows\" data-start=\"${maxRows}\" data-table=\"${escapeHtml(error.tableName)}\">\n            <i class=\"fa-solid fa-trash\"></i>  ${excessRows.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    } else if (ruleType === 'sequence' && rule.targetColumn) {\n      // \n      const prefix = rule.config?.prefix || '';\n      const startFrom = rule.config?.startFrom !== undefined ? rule.config?.startFrom : 1;\n      let targetSheet = null;\n      let issues = [];\n      let fixSuggestions = [];\n\n      // \n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (targetSheet && targetSheet.content && targetSheet.content.length > 1) {\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = headers.indexOf(rule.targetColumn);\n\n        if (colIndex >= 0) {\n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num, originalRowIndex: i + 2 }); // +2 +1\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          const numCountMap = new Map(); // \n          const duplicates = [];\n          const gaps = [];\n          const outOfOrder = [];\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const actualNum = numbers[i].num;\n            if (!numCountMap.has(actualNum)) {\n              numCountMap.set(actualNum, []);\n            }\n            numCountMap.get(actualNum).push(i);\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n\n            // \n            const occurrences = numCountMap.get(actualNum) || [];\n            if (occurrences.length > 1) {\n              // \n              if (occurrences[0] === i) {\n                duplicates.push({\n                  rowNum,\n                  value: numbers[i].value,\n                  num: actualNum,\n                  expectedNum,\n                  count: occurrences.length,\n                });\n              }\n            }\n\n            // \n            if (actualNum !== expectedNum) {\n              if (actualNum < expectedNum) {\n                // \n                outOfOrder.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              } else {\n                // \n                gaps.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              }\n            }\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n            const currentValue = numbers[i].value;\n            const fixedValue = prefix + String(expectedNum).padStart(4, '0');\n\n            if (actualNum !== expectedNum || duplicates.some(d => d.num === actualNum && d.rowNum === rowNum)) {\n              fixSuggestions.push({\n                rowNum,\n                currentValue,\n                fixedValue,\n                reason: actualNum < expectedNum ? '' : actualNum > expectedNum ? '' : '',\n              });\n            }\n          }\n\n          // \n          const issueSet = new Set();\n          duplicates.forEach(d => {\n            issueSet.add(`${d.rowNum}: \"${d.value}\"  (${d.count})`);\n          });\n          gaps.forEach(g => {\n            issueSet.add(\n              `${g.rowNum}: \"${g.value}\"  \"${prefix}${String(g.expectedNum).padStart(4, '0')}\" ()`,\n            );\n          });\n          outOfOrder.forEach(o => {\n            issueSet.add(\n              `${o.rowNum}: \"${o.value}\"  \"${prefix}${String(o.expectedNum).padStart(4, '0')}\" ()`,\n            );\n          });\n          issues = Array.from(issueSet);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-sort-numeric-up\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${issues.length}</strong> \n          </div>\n          ${\n            issues.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n              ${issues\n                .slice(0, 20)\n                .map(issue => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(issue)}</div>`)\n                .join('')}\n              ${issues.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${issues.length - 20} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n          ${\n            fixSuggestions.length > 0\n              ? `\n            <div class=\"acu-smart-fix-suggest\" style=\"margin-top:12px;\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </div>\n              <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n                ${fixSuggestions\n                  .slice(0, 20)\n                  .map(\n                    fix => `\n                  <div class=\"acu-smart-fix-change-item\">\n                    <span style=\"color:var(--acu-text-sub);\">${fix.rowNum}:</span>\n                    <span style=\"color:var(--acu-hl-manual);\">${escapeHtml(fix.currentValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);\">  </span>\n                    <span style=\"color:var(--acu-hl-auto);\">${escapeHtml(fix.fixedValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);font-size:11px;\"> (${escapeHtml(fix.reason)})</span>\n                  </div>\n                `,\n                  )\n                  .join('')}\n                ${fixSuggestions.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${fixSuggestions.length - 20} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (fixSuggestions.length > 0) {\n        // \n        const pairedTable =\n          rule.config?.pairedTable ||\n          (error.tableName === '' ? '' : error.tableName === '' ? '' : null);\n        const pairedTableAttr = pairedTable ? `data-paired-table=\"${escapeHtml(pairedTable)}\"` : '';\n\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-fix-sequence\" data-table=\"${escapeHtml(error.tableName)}\" data-column=\"${escapeHtml(rule.targetColumn)}\" data-prefix=\"${escapeHtml(prefix)}\" data-start=\"${startFrom}\" ${pairedTableAttr}>\n            <i class=\"fa-solid fa-magic\"></i>  ${fixSuggestions.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    }\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} ()</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            ${contentHtml}\n          </div>\n          <div class=\"acu-dialog-btns\">\n            ${actionBtns}\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.on('click', '#smart-fix-restore-table', async function () {\n      if (!snapshot) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      try {\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            rawData[sheetId] = JSON.parse(JSON.stringify(snapshot[sheetId]));\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-fix-sequence', async function () {\n      const $btn = $(this);\n      const tableName = $btn.data('table');\n      const columnName = $btn.data('column');\n      const prefix = $btn.data('prefix') || '';\n      const startFrom = parseInt($btn.data('start') || '1', 10);\n      const pairedTableName = $btn.data('paired-table') || null;\n\n      try {\n        $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n\n        // \n        let targetSheet = null;\n        let targetSheetId = null;\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            targetSheet = rawData[sheetId];\n            targetSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = headers.indexOf(columnName);\n\n        if (colIndex < 0) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        // \n        if (pairedTableName) {\n          // \n          let pairedSheet = null;\n          let pairedSheetId = null;\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === pairedTableName) {\n              pairedSheet = rawData[sheetId];\n              pairedSheetId = sheetId;\n              break;\n            }\n          }\n\n          if (!pairedSheet || !pairedSheet.content || pairedSheet.content.length < 1) {\n            if (window.toastr) window.toastr.warning(`: ${pairedTableName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          const pairedHeaders = pairedSheet.content[0] || [];\n          const pairedColIndex = pairedHeaders.indexOf(columnName);\n\n          if (pairedColIndex < 0) {\n            if (window.toastr) window.toastr.warning(`: ${columnName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          // \n          const extract1 = extractCodesFromTable(targetSheet, columnName, prefix);\n          const extract2 = extractCodesFromTable(pairedSheet, columnName, prefix);\n\n          // \n          const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n          // \n          const { fixedCount1, fixedCount2 } = alignAndFixPairedTables(\n            targetSheet,\n            targetSheetId,\n            pairedSheet,\n            pairedSheetId,\n            columnName,\n            mapping,\n            prefix,\n            startFrom,\n            rawData,\n          );\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          // \n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num });\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          let fixedCount = 0;\n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowIndex = numbers[i].rowIndex;\n\n            if (actualNum !== expectedNum) {\n              const fixedValue = prefix + String(expectedNum).padStart(4, '0');\n              rows[rowIndex][colIndex] = fixedValue;\n              fixedCount++;\n            }\n          }\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n        $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-delete-rows', async function () {\n      const startRow = parseInt($(this).data('start'), 10);\n      const tableName = $(this).data('table');\n\n      try {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            // (index 0) startRow (index 1  startRow)\n            rawData[sheetId].content = rawData[sheetId].content.slice(0, startRow + 1);\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const showBlacklistManagerModal = () => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const theme = getThemeColors();\n    const t = theme;\n\n    $('.acu-blacklist-manager-overlay').remove();\n\n    const blacklist = BlacklistManager.getBlacklist();\n\n    const modalHtml = `\n      <div class=\"acu-blacklist-manager-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width: 600px; width: 90%;\">\n          <div class=\"acu-edit-title\" style=\"position: relative;\">\n            <i class=\"fa-solid fa-filter\"></i> \n            <button class=\"acu-close-btn\" style=\"position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: ${t.textMain}; cursor: pointer; font-size: 18px; z-index: 10;\">\n              <i class=\"fa-solid fa-times\"></i>\n            </button>\n          </div>\n          <div class=\"acu-settings-content\" style=\"flex: 1; overflow-y: auto; padding: 20px;\">\n            <div style=\"margin-bottom: 15px;\">\n              <div style=\"margin-bottom: 8px; font-size: 12px; color: ${t.textSub};\">\n                \n              </div>\n              <textarea id=\"blacklist-textarea\" style=\"width: 100%; min-height: 120px; max-height: 300px; padding: 10px !important; border: 1px solid ${t.border} !important; border-radius: 4px !important; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-size: 13px !important; box-sizing: border-box !important; resize: vertical; font-family: monospace; line-height: 1.5;\" placeholder=\"\"></textarea>\n              <div style=\"display: flex; gap: 8px; margin-top: 8px; flex-wrap: nowrap;\">\n                <input type=\"text\" id=\"blacklist-input\" placeholder=\"...\" style=\"flex: 1; min-width: 0; padding: 8px !important; border: 1px solid ${t.border} !important; border-radius: 4px !important; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-size: 13px !important; box-sizing: border-box !important;\">\n                <button id=\"blacklist-add-btn\" style=\"padding: 8px 16px; background: ${t.accent}; color: ${t.buttonTextOnAccent || t.textMain || '#6B4A5A'}; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; white-space: nowrap; flex-shrink: 0;\">\n                  <i class=\"fa-solid fa-plus\"></i> \n                </button>\n              </div>\n            </div>\n            <div style=\"display: flex; gap: 8px; margin-top: 15px;\">\n              <button id=\"blacklist-reset-btn\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; color: ${t.textMain}; border: 1px solid ${t.border}; border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-undo\"></i> \n              </button>\n              <button id=\"blacklist-close-btn\" style=\"flex: 1; padding: 10px; background: ${t.accent}; color: ${t.buttonTextOnAccent || t.textMain || '#6B4A5A'}; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-check\"></i> \n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '2147483655',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    // textarea\n    const updateTextarea = () => {\n      const blacklist = BlacklistManager.getBlacklist();\n      const $textarea = $modal.find('#blacklist-textarea');\n      $textarea.val(blacklist.join(''));\n    };\n\n    // textareaBlacklistManager\n    const syncFromTextarea = () => {\n      const $textarea = $modal.find('#blacklist-textarea');\n      const text = $textarea.val().trim();\n      if (!text) {\n        BlacklistManager.setBlacklist([]);\n        return;\n      }\n      // \n      const items = text\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n      // \n      const uniqueItems = [...new Set(items)];\n      BlacklistManager.setBlacklist(uniqueItems);\n      // textarea\n      if (uniqueItems.length !== items.length) {\n        updateTextarea();\n      }\n    };\n\n    // textarea\n    updateTextarea();\n\n    // textarea\n    $modal.find('#blacklist-textarea').on('input', function () {\n      syncFromTextarea();\n    });\n\n    // \n    $modal.find('#blacklist-add-btn').click(function () {\n      const input = $modal.find('#blacklist-input');\n      const value = input.val().trim();\n      if (!value) return;\n\n      // \n      const newItems = value\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n\n      if (newItems.length === 0) return;\n\n      const blacklist = BlacklistManager.getBlacklist();\n      const existingSet = new Set(blacklist);\n      const addedItems = [];\n\n      newItems.forEach(item => {\n        if (!existingSet.has(item)) {\n          blacklist.push(item);\n          existingSet.add(item);\n          addedItems.push(item);\n        }\n      });\n\n      if (addedItems.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      BlacklistManager.setBlacklist(blacklist);\n      input.val('');\n      updateTextarea();\n    });\n\n    $modal.find('#blacklist-input').on('keypress', function (e) {\n      if (e.which === 13) {\n        $modal.find('#blacklist-add-btn').click();\n      }\n    });\n\n    $modal.find('#blacklist-reset-btn').click(function () {\n      if (confirm('')) {\n        BlacklistManager.resetToDefault();\n        updateTextarea();\n      }\n    });\n\n    const closeModal = () => {\n      $modal.remove();\n      // \n      renderInterface();\n    };\n\n    $modal.find('#blacklist-close-btn, .acu-close-btn').click(closeModal);\n    $modal.on('click', function (e) {\n      if ($(e.target).hasClass('acu-blacklist-manager-overlay')) closeModal();\n    });\n  };\n\n  const showAttributePresetManager = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const presets = AttributePresetManager.getAllPresets();\n    const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n\n    // HTMLactiveIdnull\n    const isDefaultActive = activeId === null;\n    const defaultPresetHtml = `\n      <div class=\"acu-preset-item\" data-id=\"__default__\">\n        <div class=\"acu-preset-info\">\n          <div class=\"acu-preset-name\">\n            \n            <span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>\n          </div>\n          <div class=\"acu-preset-desc\">5-95</div>\n          <div class=\"acu-preset-stats\">\n            : 6 | : 0\n          </div>\n        </div>\n        <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n          <label class=\"acu-toggle\" style=\"margin: 0;\">\n            <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"__default__\" ${isDefaultActive ? 'checked' : ''}>\n            <span class=\"acu-toggle-slider\"></span>\n          </label>\n        </div>\n      </div>\n    `;\n\n    // HTML\n    const presetsHtml = presets\n      .map(preset => {\n        const isActive = preset.id === activeId;\n        const isBuiltin = preset.builtin;\n\n        return `\n        <div class=\"acu-preset-item\" data-id=\"${preset.id}\">\n          <div class=\"acu-preset-info\">\n            <div class=\"acu-preset-name\">\n              ${escapeHtml(preset.name)}\n              ${isBuiltin ? `<span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>` : ''}\n            </div>\n            ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n            <div class=\"acu-preset-stats\">\n              : ${preset.baseAttributes.length} | : ${preset.specialAttributes?.length || 0}\n            </div>\n          </div>\n          <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n            <label class=\"acu-toggle\" style=\"margin: 0;\">\n              <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"${preset.id}\" ${isActive ? 'checked' : ''}>\n              <span class=\"acu-toggle-slider\"></span>\n            </label>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>` : ''}\n            <button class=\"acu-preset-btn acu-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: #e74c3c;\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n          </div>\n        </div>\n      `;\n      })\n      .join('');\n\n    // \n    const allPresetsHtml = defaultPresetHtml + presetsHtml;\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 80vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-dice-d20\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div id=\"acu-presets-list\">\n              ${allPresetsHtml || `<div style=\"text-align: center; padding: 40px; color: ${t.textSub};\"></div>`}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"acu-preset-new\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-preset-import\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-preset-back\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n\n          <input type=\"file\" id=\"acu-preset-file-input\" accept=\".json\" style=\"display: none;\" />\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn, #acu-preset-back').on('click', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n\n    // Toggle\n    overlay.on('change', '.acu-preset-toggle', function () {\n      const $toggle = $(this);\n      const id = $toggle.data('id');\n      const isChecked = $toggle.is(':checked');\n\n      if (isChecked) {\n        // id\"__default__\"null\n        const finalId = id === '__default__' ? null : id;\n        AttributePresetManager.setActivePreset(finalId);\n\n        // toggle\n        overlay.find('.acu-preset-toggle').each(function () {\n          const $thisToggle = $(this);\n          const thisId = $thisToggle.data('id');\n          if (thisId !== id) {\n            $thisToggle.prop('checked', false);\n          }\n        });\n      } else {\n        // null\n        AttributePresetManager.setActivePreset(null);\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showAttributePresetEditor(id);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-export', function () {\n      const id = $(this).data('id');\n      const json = AttributePresetManager.exportPreset(id);\n      if (!json) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      const preset = presets.find(p => p.id === id);\n      const filename = `acu_preset_${preset?.name || id}_${Date.now()}.json`;\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        const success = AttributePresetManager.deletePreset(id);\n        if (success) {\n          overlay.remove();\n          showAttributePresetManager();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      }\n    });\n\n    // \n    overlay.find('#acu-preset-new').on('click', () => {\n      overlay.remove();\n      showAttributePresetEditor();\n    });\n\n    // \n    overlay.find('#acu-preset-import').on('click', () => {\n      overlay.find('#acu-preset-file-input').click();\n    });\n\n    overlay.find('#acu-preset-file-input').on('change', function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      const reader = new FileReader();\n      reader.onload = evt => {\n        try {\n          const jsonStr = evt.target.result as string;\n          if (!jsonStr?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(jsonStr.trim());\n          } catch {\n            if (window.toastr) window.toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.name || '';\n          const existingPresets = AttributePresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = jsonStr.trim();\n            if (newName) {\n              parsedData.name = newName;\n              // IDID\n              parsedData.id = `attr_preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset && !existingPreset.builtin) {\n                AttributePresetManager.deletePreset(existingPreset.id);\n              }\n            }\n\n            const imported = AttributePresetManager.importPreset(finalJson);\n            if (imported) {\n              overlay.remove();\n              showAttributePresetManager();\n            } else {\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      };\n      reader.readAsText(file);\n\n      // \n      $(this).val('');\n    });\n\n    // \n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        overlay.remove();\n        showSettingsModal();\n      }\n    });\n  };\n\n  // \n  const showAttributePresetEditor = (presetId = null) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? AttributePresetManager.getAllPresets().find(p => p.id === presetId) : null;\n\n    // \n    const defaultData = {\n      name: existingPreset?.name || '',\n      description: existingPreset?.description || '',\n      baseAttributes: existingPreset?.baseAttributes || [\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n      ],\n      specialAttributes: existingPreset?.specialAttributes || [],\n    };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 650px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-pen\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 8px;\">\n                JSON <span style=\"font-size: 10px; color: ${t.textSub};\">()</span>\n              </label>\n              <textarea id=\"preset-json\" class=\"acu-preset-editor-textarea\" style=\"width: 100%; height: 320px; padding: 10px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-family: 'Consolas', 'Monaco', monospace !important; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: ${t.textSub}; padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n               baseAttributes:  nameformularangemodifier()<br/>\n               specialAttributes:  nameformularange()<br/>\n               : 3d6, 4d6kh3, (/2), (+-*/)\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"preset-save\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"preset-cancel\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#preset-json');\n\n    // JSON\n    const updateJSON = () => {\n      const data = {\n        baseAttributes: defaultData.baseAttributes,\n        specialAttributes: defaultData.specialAttributes,\n      };\n      $jsonTextarea.val(JSON.stringify(data, null, 2));\n    };\n    updateJSON();\n\n    // \n    overlay.find('.acu-close-btn, #preset-cancel').on('click', () => {\n      overlay.remove();\n      showAttributePresetManager();\n    });\n\n    // \n    overlay.find('#preset-save').on('click', () => {\n      try {\n        const name = overlay.find('#preset-name').val().trim();\n        const description = overlay.find('#preset-desc').val().trim();\n        const jsonStr = $jsonTextarea.val().trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const jsonData = JSON.parse(jsonStr);\n\n        // \n        if (\n          !jsonData.baseAttributes ||\n          !Array.isArray(jsonData.baseAttributes) ||\n          jsonData.baseAttributes.length === 0\n        ) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n\n        // \n        const preset = {\n          format: 'acu_attr_preset_v1',\n          version: 1,\n          id: presetId || `custom_${Date.now()}`,\n          name,\n          description,\n          baseAttributes: jsonData.baseAttributes,\n          specialAttributes: jsonData.specialAttributes || [],\n        };\n\n        // \n        if (isEdit) {\n          AttributePresetManager.updatePreset(presetId, preset);\n        } else {\n          AttributePresetManager.createPreset(preset);\n        }\n\n        overlay.remove();\n        showAttributePresetManager();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + (err.message || 'JSON'));\n      }\n    });\n\n    // \n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        overlay.remove();\n        showAttributePresetManager();\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showActionPresetManager = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const presets = ActionPresetManager.getAllPresets();\n    const activeId = ActionPresetManager.getActivePresetId();\n\n    // HTML\n    const presetsHtml =\n      presets.length === 0\n        ? `<div style=\"text-align: center; padding: 40px; color: ${t.textSub};\"></div>`\n        : presets\n            .map(preset => {\n              const isActive = preset.id === activeId;\n              const isBuiltin = (preset as any).builtin === true;\n              const keywordsSummary =\n                (preset.rules || [])\n                  .flatMap(r => r.table_keywords || [])\n                  .slice(0, 3)\n                  .join('') || '';\n              const actionsSummary =\n                (preset.rules || [])\n                  .flatMap(r => (r.actions || []).map(a => a.label))\n                  .slice(0, 4)\n                  .join('') || '';\n\n              return `\n          <div class=\"acu-preset-item\" data-id=\"${preset.id}\">\n            <div class=\"acu-preset-info\">\n              <div class=\"acu-preset-name\">${escapeHtml(preset.name)}${isBuiltin ? `<span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>` : ''}</div>\n              ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n              <div class=\"acu-preset-stats\" style=\"font-size: 11px; color: ${t.textSub};\">\n                : ${escapeHtml(keywordsSummary)} | : ${escapeHtml(actionsSummary)}\n              </div>\n            </div>\n            <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n              <label class=\"acu-toggle\" style=\"margin: 0;\">\n                <input type=\"checkbox\" class=\"acu-action-preset-toggle\" data-id=\"${preset.id}\" ${isActive ? 'checked' : ''}>\n                <span class=\"acu-toggle-slider\"></span>\n              </label>\n              ${\n                isBuiltin\n                  ? `<button class=\"acu-preset-btn acu-action-preset-copy\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-copy\"></i></button>`\n                  : `<button class=\"acu-preset-btn acu-action-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>`\n              }\n              <button class=\"acu-preset-btn acu-action-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n              ${!isBuiltin ? `<button class=\"acu-preset-btn acu-action-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: #e74c3c;\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n            </div>\n          </div>\n        `;\n            })\n            .join('');\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 80vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-wand-magic-sparkles\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div id=\"acu-action-presets-list\">\n              ${presetsHtml}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"acu-action-preset-new\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-action-preset-import\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-action-preset-back\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn, #acu-action-preset-back').on('click', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n\n    // Toggle\n    overlay.on('change', '.acu-action-preset-toggle', function () {\n      const $toggle = $(this);\n      const id = $toggle.data('id');\n      const isChecked = $toggle.is(':checked');\n\n      if (isChecked) {\n        ActionPresetManager.setActivePresetId(id);\n        // toggle\n        overlay.find('.acu-action-preset-toggle').each(function () {\n          if ($(this).data('id') !== id) {\n            $(this).prop('checked', false);\n          }\n        });\n      } else {\n        // \n        if (ActionPresetManager.getActivePresetId() === id) {\n          ActionPresetManager.setActivePresetId(null);\n          if (window.toastr) window.toastr.info('');\n        }\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showActionPresetEditor(id);\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-export', function () {\n      const id = $(this).data('id');\n      const json = ActionPresetManager.exportPreset(id);\n      if (!json) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      // \n      navigator.clipboard\n        .writeText(json)\n        .then(() => {\n          if (window.toastr) window.toastr.success('');\n        })\n        .catch(() => {\n          // textarea\n          const ta = document.createElement('textarea');\n          ta.value = json;\n          document.body.appendChild(ta);\n          ta.select();\n          document.execCommand('copy');\n          document.body.removeChild(ta);\n          if (window.toastr) window.toastr.success('');\n        });\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-copy', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return;\n\n      const copyData = {\n        name: preset.name + ' ()',\n        description: preset.description || '',\n        rules: JSON.parse(JSON.stringify(preset.rules)),\n      };\n\n      const newPreset = ActionPresetManager.createPreset(copyData);\n      if (newPreset) {\n        if (window.toastr)\n          window.toastr.success(`${newPreset.name} ${newPreset.rules.length} `);\n        overlay.remove();\n        showActionPresetManager(); // \n      }\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        const success = ActionPresetManager.deletePreset(id);\n        if (success) {\n          overlay.remove();\n          showActionPresetManager();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      }\n    });\n\n    // \n    overlay.find('#acu-action-preset-new').on('click', () => {\n      overlay.remove();\n      showActionPresetEditor();\n    });\n\n    // \n    overlay.find('#acu-action-preset-import').on('click', () => {\n      const jsonStr = prompt('JSON:');\n      if (!jsonStr?.trim()) return;\n\n      const result = ActionPresetManager.importPreset(jsonStr.trim());\n      if (result) {\n        if (window.toastr) window.toastr.success(`${result.name}`);\n        overlay.remove();\n        showActionPresetManager();\n      } else {\n        if (window.toastr) window.toastr.error('JSON');\n      }\n    });\n\n    // \n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        overlay.remove();\n        showSettingsModal();\n      }\n    });\n  };\n\n  // JSON\n  const showActionPresetEditor = (presetId?: string) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? ActionPresetManager.getPresetById(presetId) : null;\n\n    // \n    const defaultData = {\n      name: existingPreset?.name || '',\n      description: existingPreset?.description || '',\n      rules: existingPreset?.rules || [\n        {\n          table_keywords: [''],\n          actions: [{ label: '', template: '<user>{Name}:' }],\n        },\n      ],\n    };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 700px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-wand-magic-sparkles\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"action-preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border}; border-radius: 6px; background: ${t.inputBg}; color: ${t.textMain}; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"action-preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border}; border-radius: 6px; background: ${t.inputBg}; color: ${t.textMain}; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 8px;\">\n                 <span style=\"font-size: 10px; color: ${t.textSub};\">(JSON)</span>\n              </label>\n              <textarea id=\"action-preset-json\" style=\"width: 100%; height: 300px; padding: 10px; border: 1px solid ${t.border}; border-radius: 6px; background: ${t.inputBg}; color: ${t.textMain}; font-family: 'Consolas', 'Monaco', monospace; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: ${t.textSub}; padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n                table_keywords actions<br/>\n                label template{Name}<br/>\n               : { \"table_keywords\": [\"\"], \"actions\": [{ \"label\": \"\", \"template\": \"<user>{Name}\" }] }\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"action-preset-save\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"action-preset-cancel\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#action-preset-json');\n\n    // JSON rules \n    $jsonTextarea.val(JSON.stringify(defaultData.rules, null, 2));\n\n    // \n    overlay.find('.acu-close-btn, #action-preset-cancel').on('click', () => {\n      overlay.remove();\n      showActionPresetManager();\n    });\n\n    // \n    overlay.find('#action-preset-save').on('click', () => {\n      try {\n        const name = (overlay.find('#action-preset-name').val() as string).trim();\n        const description = (overlay.find('#action-preset-desc').val() as string).trim();\n        const jsonStr = ($jsonTextarea.val() as string).trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const rules = JSON.parse(jsonStr);\n\n        // \n        if (!Array.isArray(rules) || rules.length === 0) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n\n        // \n        for (let i = 0; i < rules.length; i++) {\n          const rule = rules[i];\n          if (!rule.table_keywords || !Array.isArray(rule.table_keywords) || rule.table_keywords.length === 0) {\n            if (window.toastr) window.toastr.error(` ${i + 1}  table_keywords`);\n            return;\n          }\n          if (!rule.actions || !Array.isArray(rule.actions) || rule.actions.length === 0) {\n            if (window.toastr) window.toastr.error(` ${i + 1}  actions`);\n            return;\n          }\n        }\n\n        if (isEdit && presetId) {\n          // \n          ActionPresetManager.updatePreset(presetId, { name, description, rules });\n          if (window.toastr) window.toastr.success('');\n        } else {\n          // \n          ActionPresetManager.createPreset({ name, description, rules });\n          if (window.toastr) window.toastr.success('');\n        }\n\n        overlay.remove();\n        showActionPresetManager();\n      } catch (e) {\n        if (window.toastr) window.toastr.error('JSON : ' + (e as Error).message);\n      }\n    });\n\n    // \n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        overlay.remove();\n        showActionPresetManager();\n      }\n    });\n  };\n\n  // ========================================\n  // Debug\n  // ========================================\n  const showDebugConsoleModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-debug-console-dialog)').remove();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const t = getThemeColors();\n\n    // localStorage\n    const savedFilters = Store.get('acu_debug_filters', { log: true, info: true, warn: true, error: true });\n    ConsoleCaptureManager.setFilters(savedFilters);\n\n    const renderLogs = () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      const $logContainer = dialog.find('.acu-debug-log-container');\n      $logContainer.empty();\n\n      if (filteredLogs.length === 0) {\n        $logContainer.html(\n          '<div style=\"text-align:center;padding:40px;color:var(--acu-text-sub);\"><i class=\"fa-solid fa-inbox\"></i><br/></div>',\n        );\n        return;\n      }\n\n      filteredLogs.forEach(log => {\n        const typeColors = {\n          error: '#e74c3c',\n          warn: '#f39c12',\n          info: '#3498db',\n          log: '#95a5a6',\n        };\n        const typeIcons = {\n          error: 'fa-exclamation-circle',\n          warn: 'fa-exclamation-triangle',\n          info: 'fa-info-circle',\n          log: 'fa-circle',\n        };\n        const color = typeColors[log.type] || typeColors.log;\n        const icon = typeIcons[log.type] || typeIcons.log;\n\n        const logItem = $(`\n          <div class=\"acu-debug-log-item\" data-type=\"${log.type}\" style=\"padding:8px 12px;border-bottom:1px solid var(--acu-border);font-family:monospace;font-size:12px;line-height:1.5;\">\n            <div style=\"display:flex;align-items:flex-start;gap:8px;\">\n              <span style=\"color:${color};min-width:60px;font-size:11px;\">\n                <i class=\"fa-solid ${icon}\"></i> [${log.timeStr}]\n              </span>\n              <span style=\"color:${color};min-width:50px;font-size:11px;text-transform:uppercase;\">[${log.type}]</span>\n              <span style=\"flex:1;color:var(--acu-text-main);word-break:break-word;white-space:pre-wrap;\">${escapeHtml(log.content)}</span>\n            </div>\n            ${log.stack ? `<div style=\"margin-top:4px;margin-left:128px;color:var(--acu-text-sub);font-size:11px;white-space:pre-wrap;font-family:monospace;\">${escapeHtml(log.stack)}</div>` : ''}\n          </div>\n        `);\n        $logContainer.append(logItem);\n      });\n    };\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-debug-console-dialog ${currentThemeClass}\" style=\"max-width:90vw;max-height:90vh;width:800px;height:600px;display:flex;flex-direction:column;\">\n          <div class=\"acu-settings-header\" style=\"flex-shrink:0;\">\n            <div class=\"acu-settings-title\"><i class=\"fa-solid fa-bug\"></i> Debug</div>\n            <button class=\"acu-close-btn\" id=\"debug-console-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex:1;display:flex;flex-direction:column;overflow:hidden;\">\n            <!--  -->\n            <div style=\"padding:12px;border-bottom:1px solid var(--acu-border);flex-shrink:0;display:flex;flex-direction:column;gap:8px;\">\n              <!-- Console -->\n              <div style=\"display:flex;align-items:center;gap:8px;padding-bottom:8px;border-bottom:1px solid var(--acu-border);\">\n                <span style=\"font-size:12px;color:var(--acu-text-sub);flex:1;\">Console:</span>\n                <label class=\"acu-toggle\">\n                  <input type=\"checkbox\" id=\"debug-console-capture-toggle\" ${ConsoleCaptureManager.enabled ? 'checked' : ''}>\n                  <span class=\"acu-toggle-slider\"></span>\n                </label>\n                <span id=\"debug-console-capture-status\" style=\"font-size:11px;color:var(--acu-text-sub);\">${ConsoleCaptureManager.enabled ? '' : ''}</span>\n              </div>\n              <!--  -->\n              <div style=\"display:flex;flex-wrap:wrap;gap:8px;align-items:center;\">\n                <div style=\"display:flex;gap:8px;align-items:center;flex:1;\">\n                  <span style=\"font-size:12px;color:var(--acu-text-sub);\">:</span>\n                  <button class=\"acu-btn ${savedFilters.log ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"log\" style=\"padding:4px 10px;font-size:12px;${savedFilters.log ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Log</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.info ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"info\" style=\"padding:4px 10px;font-size:12px;${savedFilters.info ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Info</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.warn ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"warn\" style=\"padding:4px 10px;font-size:12px;${savedFilters.warn ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Warn</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.error ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"error\" style=\"padding:4px 10px;font-size:12px;${savedFilters.error ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Error</span>\n                  </button>\n                </div>\n                <div style=\"display:flex;gap:6px;\">\n                  <button class=\"acu-btn acu-btn-secondary\" id=\"debug-console-clear\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-trash\"></i> \n                  </button>\n                  <button class=\"acu-btn acu-btn-secondary\" id=\"debug-console-copy\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-copy\"></i> \n                  </button>\n                  <button class=\"acu-btn acu-btn-primary\" id=\"debug-console-export\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-download\"></i> \n                  </button>\n                </div>\n              </div>\n            </div>\n\n            <!--  -->\n            <div class=\"acu-debug-log-scroll\" style=\"flex:1;overflow-y:auto;overflow-x:hidden;background:var(--acu-card-bg);\">\n              <div class=\"acu-debug-log-container\"></div>\n            </div>\n\n            <!--  -->\n            <div style=\"padding:8px 12px;border-top:1px solid var(--acu-border);flex-shrink:0;font-size:11px;color:var(--acu-text-sub);display:flex;justify-content:space-between;\">\n              <span>: <span id=\"debug-total-count\">0</span> | : <span id=\"debug-filtered-count\">0</span></span>\n            </div>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const updateCounts = () => {\n      const total = ConsoleCaptureManager.logs.length;\n      const filtered = ConsoleCaptureManager.getFilteredLogs().length;\n      dialog.find('#debug-total-count').text(total);\n      dialog.find('#debug-filtered-count').text(filtered);\n    };\n\n    // \n    renderLogs();\n    updateCounts();\n\n    // Console\n    dialog.find('#debug-console-capture-toggle').on('change', function () {\n      const checked = $(this).is(':checked');\n      const $status = dialog.find('#debug-console-capture-status');\n      if (checked) {\n        ConsoleCaptureManager.enable();\n        $status.text('');\n        // \n        console.log('[DICE]Debug');\n      } else {\n        ConsoleCaptureManager.disable();\n        $status.text('');\n      }\n    });\n\n    // \n    dialog.find('[data-filter-type]').on('click', function () {\n      const type = $(this).data('filter-type');\n      const isActive = $(this).hasClass('acu-btn-primary');\n      const newState = !isActive;\n\n      // \n      if (newState) {\n        $(this).removeClass('acu-btn-secondary').addClass('acu-btn-primary');\n        $(this).css('opacity', '1');\n      } else {\n        $(this).removeClass('acu-btn-primary').addClass('acu-btn-secondary');\n        $(this).css('opacity', '0.5');\n      }\n\n      // \n      ConsoleCaptureManager.setFilters({ [type]: newState });\n      Store.set('acu_debug_filters', ConsoleCaptureManager.filters);\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-clear').on('click', () => {\n      ConsoleCaptureManager.clear();\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-copy').on('click', async () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n');\n\n      try {\n        // \n        if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n          const safeContent = text.replace(/\\\"/g, '\\\\\"').replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          return;\n        }\n        // API\n        if (navigator.clipboard && window.isSecureContext) {\n          await navigator.clipboard.writeText(text);\n        } else {\n          // execCommand\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n          document.body.appendChild(textArea);\n          textArea.select();\n          textArea.setSelectionRange(0, 99999);\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n          if (!successful) {\n            throw new Error('execCommand failed');\n          }\n        }\n      } catch (err) {\n        console.error('[DICE]DebugConsole :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // \n    dialog.find('#debug-console-export').on('click', () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n\\n');\n\n      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `debug-console-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    dialog.find('#debug-console-close, .acu-edit-overlay').on('click', function (e) {\n      if (e.target === this || $(e.target).closest('.acu-close-btn').length) {\n        dialog.remove();\n      }\n    });\n\n    // \n    // [] \n    const refreshInterval = setInterval(() => {\n      if (dialog.length && dialog.is(':visible')) {\n        renderLogs();\n        updateCounts();\n      }\n    }, 500);\n\n    // \n    dialog.on('remove', () => {\n      clearInterval(refreshInterval);\n    });\n  };\n\n  // ========================================\n  // showAddRegexRuleModal - / (Phase 4.2)\n  // ========================================\n  const showAddRegexRuleModal = (editRuleId?: string) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // ()\n    const editRule = editRuleId ? RegexTransformationManager.getRule(editRuleId) : null;\n\n    // \n    const tableData = cachedRawData || getTableData();\n    const tableNames = Object.keys(tableData || {})\n      .filter(k => k.startsWith('sheet_'))\n      .map(k => tableData[k]?.name || k)\n      .sort();\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-dice-cfg-header\">\n            <span><i class=\"fa-solid fa-magic\"></i> ${editRule ? '' : ''}</span>\n            <button class=\"acu-config-close\" id=\"acu-close-regex-rule\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.name) : ''}\" placeholder=\": \" style=\"flex:1;\" required>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <textarea id=\"rule-description\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1; resize: none; overflow-wrap: break-word; overflow-y: hidden; min-height: 34px; height: 34px; line-height: 1.4;\">${editRule ? escapeHtml(editRule.description || '') : ''}</textarea>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <input type=\"text\" id=\"rule-pattern\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.pattern) : ''}\" placeholder=\": \\\\s+  /test/g\" style=\"flex:1; font-family: monospace;\" required>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-replacement\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.replacement || '') : ''}\" placeholder=\", $1, $2 \" style=\"flex:1; font-family: monospace;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <select id=\"rule-scope-type\" class=\"acu-setting-select\" style=\"width:120px;\">\n                <option value=\"global\" ${editRule?.scope?.type === 'global' ? 'selected' : ''}></option>\n                <option value=\"table\" ${editRule?.scope?.type === 'table' ? 'selected' : ''}></option>\n                <option value=\"column\" ${editRule?.scope?.type === 'column' ? 'selected' : ''}></option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"field-table-names\" style=\"display: ${editRule?.scope?.type === 'global' ? 'none' : 'flex'};\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> ()</span></div>\n              <input type=\"text\" id=\"rule-table-names\" class=\"acu-panel-input\" value=\"${editRule?.scope?.tableNames?.join(',') || ''}\" placeholder=\": ,\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\" id=\"field-column-names\" style=\"display: ${editRule?.scope?.type === 'column' ? 'flex' : 'none'};\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> ()</span></div>\n              <input type=\"text\" id=\"rule-column-names\" class=\"acu-panel-input\" value=\"${editRule?.scope?.columnNames?.join(',') || ''}\" placeholder=\": ,\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"number\" id=\"rule-priority\" class=\"acu-panel-input\" value=\"${editRule?.priority || 50}\" min=\"1\" max=\"100\" style=\"width:80px;\">\n            </div>\n\n          </div>\n          <div class=\"acu-dice-cfg-actions\">\n            <button id=\"acu-regex-rule-cancel\"></button>\n            <button id=\"acu-regex-rule-confirm\"></button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    // /\n    const updateScopeFields = () => {\n      const scopeType = dialog.find('#rule-scope-type').val();\n      if (scopeType === 'global') {\n        dialog.find('#field-table-names, #field-column-names').hide();\n      } else if (scopeType === 'table') {\n        dialog.find('#field-table-names').css('display', 'flex').show();\n        dialog.find('#field-column-names').hide();\n      } else if (scopeType === 'column') {\n        dialog.find('#field-table-names, #field-column-names').css('display', 'flex').show();\n      }\n    };\n\n    dialog.find('#rule-scope-type').on('change', updateScopeFields);\n\n    // Textarea\n    const $textarea = dialog.find('#rule-description');\n    const autoResizeTextarea = () => {\n      // scrollHeight\n      $textarea.css('height', '34px');\n      // ,1\n      const scrollHeight = $textarea[0].scrollHeight;\n      $textarea.css('height', Math.max(34, scrollHeight) + 'px');\n    };\n    // \n    $textarea.on('input', autoResizeTextarea);\n\n    // ()\n    dialog.find('#acu-regex-rule-confirm').on('click', async function () {\n      const name = dialog.find('#rule-name').val();\n      const pattern = dialog.find('#rule-pattern').val();\n      const scopeType = dialog.find('#rule-scope-type').val();\n\n      if (!name || !pattern) {\n        toastr.error('');\n        return;\n      }\n\n      //  scope \n      const scope: RegexScopeConfig = { type: scopeType as RegexScopeType };\n      if (scopeType !== 'global') {\n        const tableNames = dialog.find('#rule-table-names').val();\n        if (tableNames)\n          scope.tableNames = String(tableNames)\n            .split(',')\n            .map(s => s.trim())\n            .filter(s => s);\n      }\n      if (scopeType === 'column') {\n        const columnNames = dialog.find('#rule-column-names').val();\n        if (columnNames)\n          scope.columnNames = String(columnNames)\n            .split(',')\n            .map(s => s.trim())\n            .filter(s => s);\n      }\n\n      //  pattern  flags\n      const patternStr = String(pattern);\n      const { flags: extractedFlags, patternWithoutFlags } = RegexTransformationEngine._extractFlags(patternStr);\n\n      //  UI  flags\n      const $flagGlobal = dialog.find('#flag-global');\n      const $flagIgnoreCase = dialog.find('#flag-ignorecase');\n      const $flagMultiline = dialog.find('#flag-multiline');\n\n      const uiFlags = {\n        global: $flagGlobal.length > 0 ? $flagGlobal.is(':checked') : false,\n        caseInsensitive: $flagIgnoreCase.length > 0 ? $flagIgnoreCase.is(':checked') : false,\n        multiline: $flagMultiline.length > 0 ? $flagMultiline.is(':checked') : false,\n      };\n\n      //  pattern  flags pattern  flags\n      const finalPattern = patternWithoutFlags !== patternStr ? patternWithoutFlags : patternStr;\n      const finalFlags =\n        patternWithoutFlags !== patternStr\n          ? { ...uiFlags, ...extractedFlags } //  flags  UI flags\n          : uiFlags; //  flags UI flags\n\n      const ruleData = {\n        name: String(name),\n        description: dialog.find('#rule-description').val(),\n        operation: 'replace', // \n        pattern: finalPattern, //  pattern flags\n        flags: finalFlags, //  flags\n        replacement: dialog.find('#rule-replacement').val(),\n        scope,\n        enabled: true, // \n        priority: parseInt(dialog.find('#rule-priority').val(), 10),\n        executeMode: 'auto', // \n      };\n\n      // \n      if (editRuleId) {\n        // \n        RegexTransformationManager.updateRule(editRuleId, ruleData);\n      } else {\n        // \n        const newRule = RegexTransformationManager.addCustomRule(ruleData);\n        if (newRule) {\n          editRuleId = newRule.id;\n        }\n      }\n\n      // [] \n      dialog.remove();\n      $(document).off('keydown.regex-rule-modal'); // ESC\n      refreshRegexRulesList(); // \n    });\n\n    //  isSettingsOpen\n    const closeDialog = () => {\n      dialog.remove();\n      $(document).off('keydown.regex-rule-modal'); // ESC\n    };\n\n    // \n    dialog.find('#acu-regex-rule-cancel, #acu-close-regex-rule').on('click', function (e) {\n      e.stopPropagation();\n      closeDialog();\n    });\n\n    // \n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        closeDialog();\n      }\n    });\n\n    // ESC \n    $(document).on('keydown.regex-rule-modal', function (e) {\n      if (e.key === 'Escape' && dialog.length && dialog.is(':visible')) {\n        e.preventDefault();\n        closeDialog();\n        $(document).off('keydown.regex-rule-modal'); // \n      }\n    });\n\n    $('body').append(dialog);\n\n    // DOMtextarea\n    requestAnimationFrame(() => {\n      const $textarea = dialog.find('#rule-description');\n      if ($textarea.length && $textarea[0].scrollHeight > 34) {\n        $textarea.css('height', $textarea[0].scrollHeight + 'px');\n      }\n    });\n  };\n\n  // \n  window.showAddRegexRuleModal = showAddRegexRuleModal;\n\n  // \n  window.showDebugConsoleModal = showDebugConsoleModal;\n\n  const showSettingsModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-settings-dialog)').remove();\n    isSettingsOpen = true;\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const t = getThemeColors();\n\n    // \n    const expandedGroups = Store.get('acu_settings_expanded', ['appearance']);\n\n    const isGroupExpanded = groupId => expandedGroups.includes(groupId);\n    // HTMLMVU\n    const SPECIAL_BUTTONS_CONFIG = [\n      { key: '__dice__', name: '', icon: 'fa-dice-d20' },\n      { key: '__changes__', name: '', icon: 'fa-code-compare' },\n      { key: '__mvu__', name: 'MVU', icon: 'fa-code-branch' },\n    ];\n\n    const tableManagerHtml = (() => {\n      const rawData = cachedRawData || getTableData();\n      const tables = processJsonData(rawData || {});\n      const savedOrder = getSavedTableOrder() || [];\n      const hiddenList = getHiddenTables();\n\n      //  + \n      let allItems = [];\n\n      // \n      SPECIAL_BUTTONS_CONFIG.forEach(btn => {\n        // MVU \n        allItems.push({ key: btn.key, name: btn.name, icon: btn.icon, isSpecial: true });\n      });\n\n      // \n      Object.keys(tables).forEach(name => {\n        allItems.push({ key: name, name: name, icon: getIconForTableName(name), isSpecial: false });\n      });\n\n      // \n      if (savedOrder.length > 0) {\n        const orderMap = new Map(savedOrder.map((k, i) => [k, i]));\n        allItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      return allItems\n        .map(item => {\n          const isHidden = hiddenList.includes(item.key);\n          const specialClass = item.isSpecial ? ' acu-special-item' : '';\n          const displayName = item.name;\n          return (\n            '<div class=\"acu-table-manager-item' +\n            specialClass +\n            (isHidden ? ' hidden-table' : '') +\n            '\" data-table-name=\"' +\n            escapeHtml(item.key) +\n            '\" draggable=\"false\">' +\n            '<div class=\"acu-table-item-check\" title=\"/\">' +\n            '<i class=\"fa-solid ' +\n            (isHidden ? 'fa-eye-slash' : 'fa-eye') +\n            '\"></i>' +\n            '</div>' +\n            '<div class=\"acu-table-item-icon\"><i class=\"fa-solid ' +\n            item.icon +\n            '\"></i></div>' +\n            '<div class=\"acu-table-item-name\">' +\n            escapeHtml(displayName) +\n            '</div>' +\n            '<div class=\"acu-table-item-handle\" title=\"\">' +\n            '<i class=\"fa-solid fa-grip-vertical\"></i>' +\n            '</div>' +\n            '</div>'\n          );\n        })\n        .join('');\n    })();\n    const chevron = groupId => (isGroupExpanded(groupId) ? 'fa-chevron-down' : 'fa-chevron-right');\n\n    const dialog = $(`\n        <div class=\"acu-edit-overlay\">\n            <div class=\"acu-edit-dialog acu-settings-dialog ${currentThemeClass}\">\n                <div class=\"acu-settings-header\">\n                    <div class=\"acu-settings-title\">\n                        <span class=\"acu-settings-text\">\n                            <i class=\"fa-solid fa-cog\"></i> \n                            <span class=\"acu-version-badge\">${SCRIPT_VERSION}</span>\n                        </span>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-help-btn\" id=\"acu-help-btn\" title=\"\"><i class=\"fa-solid fa-question-circle\"></i></button>\n                        <button class=\"acu-close-btn\" id=\"dlg-close-x\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n\n                <div class=\"acu-settings-body\">\n                <!--  -->\n                <div class=\"acu-settings-group ${isGroupExpanded('appearance') ? '' : 'collapsed'}\" data-group=\"appearance\">                    <div class=\"acu-settings-group-title\">\n                        <i class=\"fa-solid ${chevron('appearance')} acu-group-chevron\"></i>\n                        <i class=\"fa-solid fa-palette\"></i> \n                    </div>\n                    <div class=\"acu-settings-group-body\">\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-theme\" class=\"acu-setting-select\">\n                                ${THEMES.map(t => `<option value=\"${t.id}\" ${t.id === config.theme ? 'selected' : ''}>${t.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-font-family\" class=\"acu-setting-select\">\n                                ${FONTS.map(f => `<option value=\"${f.id}\" ${f.id === config.fontFamily ? 'selected' : ''}>${f.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-main\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.fontSize}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-opt\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.optionFontSize || 12}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row acu-setting-row-toggle\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <label class=\"acu-toggle\">\n                                <input type=\"checkbox\" id=\"cfg-new\" ${config.highlightNew ? 'checked' : ''}>\n                                <span class=\"acu-toggle-slider\"></span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('layout') ? '' : 'collapsed'}\" data-group=\"layout\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('layout')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-th-large\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-width\" data-min=\"200\" data-max=\"500\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.cardWidth}px</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-layout\" class=\"acu-setting-select\">\n                                    <option value=\"horizontal\" ${config.layout !== 'vertical' ? 'selected' : ''}></option>\n                                    <option value=\"vertical\" ${config.layout === 'vertical' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                    <span class=\"acu-setting-hint\"></span>\n                                </div>\n                                <select id=\"cfg-grid-cols\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"2\" ${config.gridColumns == 2 ? 'selected' : ''}>2</option>\n                                    <option value=\"3\" ${config.gridColumns == 3 ? 'selected' : ''}>3</option>\n                                    <option value=\"4\" ${config.gridColumns == 4 ? 'selected' : ''}>4</option>\n                                    <option value=\"auto\" ${config.gridColumns === 'auto' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-per-page\" data-min=\"10\" data-max=\"200\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.itemsPerPage}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('position') ? '' : 'collapsed'}\" data-group=\"position\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('position')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-arrows-alt\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-position\" class=\"acu-setting-select\">\n                                    <option value=\"fixed\" ${config.positionMode !== 'embedded' ? 'selected' : ''}></option>\n                                    <option value=\"embedded\" ${config.positionMode === 'embedded' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-action-pos\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bottom\" ${config.actionsPosition !== 'top' ? 'selected' : ''}></option>\n                                    <option value=\"top\" ${config.actionsPosition === 'top' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-style\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bar\" ${config.collapseStyle === 'bar' ? 'selected' : ''}></option>\n                                    <option value=\"pill\" ${config.collapseStyle === 'pill' ? 'selected' : ''}></option>\n                                    <option value=\"mini\" ${config.collapseStyle === 'mini' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-align\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"right\" ${config.collapseAlign !== 'left' ? 'selected' : ''}></option>\n                                    <option value=\"left\" ${config.collapseAlign === 'left' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('options') ? '' : 'collapsed'}\" data-group=\"options\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('options')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-gamepad\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row acu-setting-row-toggle\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-show-opt\" ${config.showOptionPanel !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                            <div class=\"acu-setting-row acu-setting-row-toggle\" id=\"row-auto-send\" style=\"${config.showOptionPanel !== false ? '' : 'display:none;'}\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-auto-send\" ${config.clickOptionToAutoSend !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('tables') ? '' : 'collapsed'}\" data-group=\"tables\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('tables')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-table\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-table-manager-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <div class=\"acu-table-manager-list\" id=\"table-manager-list\">\n                                ${tableManagerHtml}\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('validation') ? '' : 'collapsed'}\" data-group=\"validation\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('validation')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-clipboard-check\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${PresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === PresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}${p.builtin ? ' ()' : ''}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-reset\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> <i class=\"fa-solid fa-shield-halved\"></i> \n                            </div>\n                            <div class=\"acu-validation-rules-list\" id=\"validation-rules-list\">\n                                ${ValidationRuleManager.getAllRules()\n                                  .map(rule => {\n                                    const typeInfo = RULE_TYPE_INFO[rule.ruleType] || {\n                                      name: rule.ruleType,\n                                      icon: 'fa-question',\n                                    };\n                                    const isTableRule = typeInfo.scope === 'table';\n                                    const hasIntercept = rule.intercept;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n                                            <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n                                        </div>\n                                        <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n                                        <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <button class=\"acu-add-rule-btn\" id=\"btn-add-validation-rule\">\n                                <i class=\"fa-solid fa-plus\"></i> \n                            </button>\n                        </div>\n                    </div>\n\n                    <!--  - Phase 4.1 -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('regex') ? '' : 'collapsed'}\" data-group=\"regex\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('regex')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-wand-magic-sparkles\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"regex-preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${RegexPresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === RegexPresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-execute-regex-now\" title=\"\" style=\"flex:1;height:28px;background:var(--acu-btn-accent, #4a9eff);color:white;\"><i class=\"fa-solid fa-play\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <!--  -->\n                            <div class=\"acu-validation-rules-list\" id=\"regex-rules-list\">\n                                ${RegexTransformationManager.getAllRules()\n                                  .map(rule => {\n                                    const scopeIcon =\n                                      rule.scope.type === 'global'\n                                        ? 'fa-globe'\n                                        : rule.scope.type === 'table'\n                                          ? 'fa-table'\n                                          : 'fa-columns';\n                                    const scopeText =\n                                      rule.scope.type === 'global'\n                                        ? ''\n                                        : rule.scope.type === 'table'\n                                          ? rule.scope.tableNames?.join(',')\n                                          : `${rule.scope.tableNames?.join(',')}.${rule.scope.columnNames?.join(',')}`;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\": ${escapeHtml(rule.scope.type)}\">\n                                            <i class=\"fa-solid ${scopeIcon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\" style=\"font-size:10px;\">${escapeHtml(scopeText)} | ${escapeHtml(rule.operation)}</div>\n                                        </div>\n                                        <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <div style=\"display:flex;gap:8px;margin-top:8px;\">\n                                <button class=\"acu-add-rule-btn\" id=\"btn-add-regex-rule\" style=\"flex:1;\">\n                                    <i class=\"fa-solid fa-plus\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('advanced') ? '' : 'collapsed'}\" data-group=\"advanced\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('advanced')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-sliders-h\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-fire\"></i> </span>\n                                </div>\n                                <select id=\"cfg-crazy-mode\" class=\"acu-setting-select\" style=\"width: 90px; min-width: 90px;\">\n                                    <option value=\"0\"></option>\n                                    <option value=\"25\"></option>\n                                    <option value=\"50\"></option>\n                                    <option value=\"75\"></option>\n                                    <option value=\"100\"></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-dice-d20\"></i> </span>\n                                </div>\n                                <button id=\"cfg-attr-preset-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-wand-magic-sparkles\"></i> </span>\n                                </div>\n                                <button id=\"cfg-action-preset-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-filter\"></i> </span>\n                                </div>\n                                <button id=\"cfg-blacklist-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-bug\"></i> Debug</span>\n                                </div>\n                                <button id=\"btn-open-debug-console\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-terminal\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                </div><!--  .acu-settings-body -->\n            </div>\n        </div>\n    `);\n    $('body').append(dialog);\n\n    // ===  ===\n    dialog.find('.acu-settings-group-title').on('click', function () {\n      const $group = $(this).closest('.acu-settings-group');\n      const $body = $group.find('.acu-settings-group-body');\n\n      // \n      if ($body.hasClass('acu-animating')) return;\n\n      const groupId = $group.data('group');\n      const $chevron = $(this).find('.acu-group-chevron');\n      let expanded = Store.get('acu_settings_expanded', ['appearance']);\n\n      if ($group.hasClass('collapsed')) {\n        // \n        $group.removeClass('collapsed');\n        $chevron.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n        if (!expanded.includes(groupId)) expanded.push(groupId);\n\n        $body.addClass('acu-animating').show();\n        const targetHeight = $body.prop('scrollHeight');\n        $body.css('height', 0).animate({ height: targetHeight }, 180, function () {\n          $(this).css('height', '').removeClass('acu-animating');\n        });\n      } else {\n        // \n        $group.addClass('collapsed');\n        $chevron.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n        expanded = expanded.filter(id => id !== groupId);\n\n        const currentHeight = $body.outerHeight();\n        $body\n          .addClass('acu-animating')\n          .css('height', currentHeight)\n          .animate({ height: 0 }, 180, function () {\n            $(this).hide().css('height', '').removeClass('acu-animating');\n          });\n      }\n\n      Store.set('acu_settings_expanded', expanded);\n    });\n\n    // ===  ===\n    // \n    dialog.find('#cfg-theme').on('change', function () {\n      const newTheme = $(this).val();\n      saveConfig({ theme: newTheme });\n      dialog\n        .find('.acu-edit-dialog')\n        .removeClass(THEMES.map(t => `acu-theme-${t.id}`).join(' '))\n        .addClass(`acu-theme-${newTheme}`);\n\n      // \n      const t = getThemeColors();\n      dialog.find('#cfg-attr-preset-manage').css({\n        background: t.btnBg,\n        borderColor: t.border,\n        color: t.textMain,\n      });\n      dialog.find('#cfg-action-preset-manage').css({\n        background: t.btnBg,\n        borderColor: t.border,\n        color: t.textMain,\n      });\n    });\n\n    // \n    dialog.find('#cfg-font-family').on('change', function () {\n      saveConfig({ fontFamily: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-attr-preset-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showAttributePresetManager();\n    });\n\n    // \n    dialog.find('#cfg-action-preset-manage').on('click', function (e) {\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showActionPresetManager();\n    });\n\n    // \n    const initCrazyModeUI = () => {\n      const crazyConfig = getCrazyModeConfig();\n      // enabledcrazyLevel\n      const selectValue = crazyConfig.enabled ? crazyConfig.crazyLevel : 0;\n      dialog.find('#cfg-crazy-mode').val(selectValue);\n\n      // \n      dialog.find('#cfg-crazy-mode').on('change', function () {\n        const value = parseInt($(this).val() as string, 10);\n        if (value === 0) {\n          saveCrazyModeConfig({ enabled: false, crazyLevel: 50 });\n          toastr.info('');\n        } else {\n          saveCrazyModeConfig({ enabled: true, crazyLevel: value });\n        }\n      });\n    };\n    initCrazyModeUI();\n\n    // \n    dialog.find('#cfg-blacklist-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      showBlacklistManagerModal();\n    });\n\n    // \n    dialog.find('#cfg-layout').on('change', function () {\n      saveConfig({ layout: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-grid-cols').on('change', function () {\n      saveConfig({ gridColumns: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-position').on('change', function () {\n      saveConfig({ positionMode: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-action-pos').on('change', function () {\n      saveConfig({ actionsPosition: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-style').on('change', function () {\n      saveConfig({ collapseStyle: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-align').on('change', function () {\n      saveConfig({ collapseAlign: $(this).val() });\n      renderInterface();\n    });\n\n    // \n    dialog.find('#cfg-show-opt').on('change', function () {\n      const checked = $(this).is(':checked');\n      saveConfig({ showOptionPanel: checked });\n      if (checked) dialog.find('#row-auto-send').slideDown(200);\n      else dialog.find('#row-auto-send').slideUp(200);\n      renderInterface();\n    });\n    dialog.find('#cfg-auto-send').on('change', function () {\n      saveConfig({ clickOptionToAutoSend: $(this).is(':checked') });\n    });\n    dialog.find('#cfg-new').on('change', function () {\n      saveConfig({ highlightNew: $(this).is(':checked') });\n      renderInterface();\n    });\n\n    // === / ===\n    dialog.find('.acu-table-item-check').on('click', function (e) {\n      e.stopPropagation();\n      const $item = $(this).closest('.acu-table-manager-item');\n      const tableName = $item.data('table-name');\n      let hiddenList = getHiddenTables();\n      const $icon = $(this).find('i');\n\n      if (hiddenList.includes(tableName)) {\n        // \n        hiddenList = hiddenList.filter(n => n !== tableName);\n        $item.removeClass('hidden-table');\n        $icon.removeClass('fa-eye-slash').addClass('fa-eye');\n      } else {\n        // \n        hiddenList.push(tableName);\n        $item.addClass('hidden-table');\n        $icon.removeClass('fa-eye').addClass('fa-eye-slash');\n      }\n\n      saveHiddenTables(hiddenList);\n      renderInterface();\n    });\n\n    // ===  ===\n    const $list = dialog.find('#table-manager-list');\n    let dragState = {\n      isDragging: false,\n      element: null,\n      timer: null,\n      startY: 0,\n    };\n\n    const clearDragState = () => {\n      if (dragState.timer) {\n        clearTimeout(dragState.timer);\n        dragState.timer = null;\n      }\n      if (dragState.element) {\n        $(dragState.element).removeClass('acu-dragging');\n      }\n      $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n      dragState.isDragging = false;\n      dragState.element = null;\n    };\n\n    const startDrag = $item => {\n      dragState.isDragging = true;\n      dragState.element = $item[0];\n      $item.addClass('acu-dragging');\n    };\n\n    const finishDrag = () => {\n      if (!dragState.isDragging || !dragState.element) {\n        clearDragState();\n        return;\n      }\n\n      const $dragged = $(dragState.element);\n      const $target = $list.find('.acu-drag-above, .acu-drag-below').first();\n\n      if ($target.length && $target[0] !== dragState.element) {\n        if ($target.hasClass('acu-drag-above')) {\n          $dragged.insertBefore($target);\n        } else {\n          $dragged.insertAfter($target);\n        }\n\n        // \n        const newOrder = [];\n        $list.find('.acu-table-manager-item').each(function () {\n          newOrder.push($(this).data('table-name'));\n        });\n        saveTableOrder(newOrder);\n      }\n\n      clearDragState();\n    };\n\n    // \n    $list[0].addEventListener(\n      'pointerdown',\n      function (e) {\n        const handle = e.target.closest('.acu-table-item-handle');\n        if (!handle) return;\n\n        e.preventDefault();\n        const $item = $(handle).closest('.acu-table-manager-item');\n        dragState.startY = e.clientY;\n        startDrag($item);\n        handle.setPointerCapture(e.pointerId);\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerdown', function (e) {\n      const item = e.target.closest('.acu-table-manager-item');\n      if (!item) return;\n      // \n      if (e.target.closest('.acu-table-item-check, .acu-table-item-handle')) return;\n\n      dragState.startY = e.clientY;\n      const $item = $(item);\n\n      dragState.timer = setTimeout(() => {\n        startDrag($item);\n      }, 350);\n    });\n\n    // \n    $list[0].addEventListener(\n      'pointermove',\n      function (e) {\n        // \n        if (dragState.timer && Math.abs(e.clientY - dragState.startY) > 8) {\n          clearTimeout(dragState.timer);\n          dragState.timer = null;\n        }\n\n        if (!dragState.isDragging || !dragState.element) return;\n        e.preventDefault();\n\n        // \n        const items = $list.find('.acu-table-manager-item').not('.acu-dragging');\n        let targetItem = null;\n        let insertBefore = true;\n\n        items.each(function () {\n          const rect = this.getBoundingClientRect();\n          const midY = rect.top + rect.height / 2;\n\n          if (e.clientY < midY && !targetItem) {\n            targetItem = this;\n            insertBefore = true;\n          } else if (e.clientY >= rect.top && e.clientY <= rect.bottom) {\n            targetItem = this;\n            insertBefore = e.clientY < midY;\n          }\n        });\n\n        // \n        $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n        if (targetItem && targetItem !== dragState.element) {\n          $(targetItem).addClass(insertBefore ? 'acu-drag-above' : 'acu-drag-below');\n        }\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerup', finishDrag);\n    $list[0].addEventListener('pointercancel', clearDragState);\n\n    // \n    $list[0].addEventListener(\n      'touchmove',\n      function (e) {\n        if (dragState.isDragging) {\n          e.preventDefault();\n        }\n      },\n      { passive: false },\n    );\n\n    // === Stepper  ===\n    dialog.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        const unit = id === 'cfg-per-page' ? '' : 'px';\n        $value.text(newVal + unit);\n\n        // \n        if (id === 'cfg-width') {\n          $('.acu-wrapper').css('--acu-card-width', newVal + 'px');\n          saveConfig({ cardWidth: newVal });\n        } else if (id === 'cfg-font-main') {\n          $('.acu-wrapper').css('--acu-font-size', newVal + 'px');\n          saveConfig({ fontSize: newVal });\n        } else if (id === 'cfg-font-opt') {\n          $('.acu-wrapper, .acu-embedded-options-container').css('--acu-opt-font-size', newVal + 'px');\n          saveConfig({ optionFontSize: newVal });\n        } else if (id === 'cfg-per-page') {\n          saveConfig({ itemsPerPage: newVal });\n        }\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    // === /===\n    dialog.on('click', '.acu-rule-toggle', function (e) {\n      e.stopPropagation();\n      const $toggle = $(this);\n      const $item = $toggle.closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const $icon = $toggle.find('i');\n      const isCurrentlyActive = $toggle.hasClass('active');\n\n      // \n      ValidationRuleManager.toggleRuleEnabled(ruleId, !isCurrentlyActive);\n\n      //  UI\n      if (isCurrentlyActive) {\n        $toggle.removeClass('active');\n        $icon.removeClass('fa-toggle-on').addClass('fa-toggle-off');\n        $item.addClass('disabled');\n      } else {\n        $toggle.addClass('active');\n        $icon.removeClass('fa-toggle-off').addClass('fa-toggle-on');\n        $item.removeClass('disabled');\n      }\n    });\n\n    // ===  ===\n    dialog.on('click', '#validation-rules-list .acu-rule-edit', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const rule = ValidationRuleManager.getRule(ruleId);\n      if (!rule) return;\n\n      // \n      showAddValidationRuleModal(dialog, ruleId);\n    });\n\n    // === ===\n    dialog.on('click', '#validation-rules-list .acu-rule-delete', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const $item = $(this).closest('.acu-validation-rule-item');\n\n      if (confirm('')) {\n        if (ValidationRuleManager.removeCustomRule(ruleId)) {\n          $item.fadeOut(200, function () {\n            $(this).remove();\n          });\n        }\n      }\n    });\n\n    // === ===\n    dialog.on('click', '.acu-rule-intercept', function (e) {\n      e.stopPropagation();\n      const $btn = $(this);\n      const ruleId = $btn.data('rule-id');\n      const isCurrentlyActive = $btn.hasClass('active');\n\n      if (ValidationRuleManager.toggleRuleIntercept(ruleId, !isCurrentlyActive)) {\n        if (isCurrentlyActive) {\n          $btn.removeClass('active').attr('title', '');\n        } else {\n          $btn.addClass('active').attr('title', '');\n        }\n      }\n    });\n\n    // ===  ===\n    const refreshPresetUI = () => {\n      ValidationRuleManager.clearCache();\n      const rules = ValidationRuleManager.getAllRules();\n      let html = '';\n      rules.forEach(rule => {\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType] || { name: rule.ruleType, icon: 'fa-question' };\n        const isTableRule = typeInfo.scope === 'table';\n        const hasIntercept = rule.intercept;\n        html += `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo.icon}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n            </div>\n            <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n            <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n              <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>`;\n      });\n      dialog.find('#validation-rules-list').html(html);\n    };\n\n    // \n    dialog.find('#preset-select').on('change', function () {\n      if (PresetManager.setActivePreset($(this).val())) {\n        refreshPresetUI();\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-dup').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const newPreset = PresetManager.duplicatePreset(preset.id);\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-new').on('click', function () {\n      const name = prompt(':', '');\n      if (!name?.trim()) return;\n      const newPreset = PresetManager.createPreset(name.trim());\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-del').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      if (preset.id === 'default') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!confirm(`\"${preset.name}\"`)) return;\n      if (PresetManager.deletePreset(preset.id)) {\n        dialog.find(`#preset-select option[value=\"${preset.id}\"]`).remove();\n        dialog.find('#preset-select').val('default').trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-export').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const json = PresetManager.exportPreset(preset.id);\n      if (json) {\n        // \n        try {\n          const filename = `acu_validation_preset_${preset.name || preset.id}_${Date.now()}.json`;\n          const blob = new Blob([json], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = filename;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        } catch (e) {\n          //  Blob /\n          navigator.clipboard\n            .writeText(json)\n            .then(() => {})\n            .catch(() => {\n              prompt(':', json);\n            });\n        }\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-import').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const json = await file.text();\n          if (!json?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(json.trim());\n          } catch {\n            if (window.toastr) window.toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.preset?.name || '';\n          const existingPresets = PresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = json.trim();\n            if (newName && parsedData?.preset) {\n              parsedData.preset.name = newName;\n              // IDID\n              parsedData.preset.id = `preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset && existingPreset.id !== 'default') {\n                PresetManager.deletePreset(existingPreset.id);\n                dialog.find(`#preset-select option[value=\"${existingPreset.id}\"]`).remove();\n              }\n            }\n\n            const result = PresetManager.importPreset(finalJson, false);\n            if (result && result.preset) {\n              const newPreset = result.preset;\n              dialog\n                .find('#preset-select')\n                .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n              dialog.find('#preset-select').val(newPreset.id).trigger('change');\n\n              // \n              if (result.needsMerge) {\n                if (\n                  confirm(\n                    '\\n\\n',\n                  )\n                ) {\n                  if (PresetManager.mergePresetWithDefaults(newPreset.id)) {\n                    refreshPresetUI();\n                  } else {\n                    if (window.toastr) window.toastr.error('');\n                  }\n                }\n              }\n            } else {\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          console.error('[DICE]PresetManager :', err);\n          if (window.toastr) window.toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // \n    dialog.find('#btn-preset-reset').on('click', function () {\n      if (!confirm('\\n')) return;\n      if (PresetManager.resetDefaultPreset()) {\n        // \n        if (PresetManager.getActivePreset()?.id === 'default') {\n          refreshPresetUI();\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // === :/ ===\n    dialog.on('click', '#regex-rules-list .acu-rule-toggle', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const currentState = RegexTransformationManager.getAllRules().find(r => r.id === ruleId)?.enabled;\n      const newState = !currentState;\n      const rule = RegexTransformationManager.getRule(ruleId);\n\n      RegexTransformationManager.toggleRuleEnabled(ruleId, newState);\n\n      if (newState) {\n      } else {\n        toastr.info('');\n      }\n\n      refreshRegexRulesList(); // [] ,\n    });\n\n    // ===  ===\n    dialog.on('click', '#regex-rules-list .acu-rule-edit', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const rule = RegexTransformationManager.getRule(ruleId);\n      if (!rule) return;\n\n      // \n      showAddRegexRuleModal(ruleId);\n    });\n\n    // === : ===\n    dialog.on('click', '#regex-rules-list .acu-rule-delete', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const rule = RegexTransformationManager.getRule(ruleId);\n      if (!rule) return;\n\n      if (confirm(`\"${rule.name}\"`)) {\n        RegexTransformationManager.removeRule(ruleId);\n        refreshRegexRulesList(); // [] ,\n      }\n    });\n\n    // === : ===\n    dialog.find('#regex-preset-select').on('change', function () {\n      const presetId = $(this).val();\n      RegexPresetManager.setActivePreset(String(presetId));\n\n      refreshRegexRulesList(); // [] ,\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-dup').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      const name = prompt(':', `${currentPreset.name} ()`);\n      if (!name) return;\n\n      const newPreset = RegexPresetManager.createPreset(name, currentPreset.id);\n      if (newPreset) {\n        // [] \n        const $presetSelect = dialog.find('#regex-preset-select');\n        $presetSelect.append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        $presetSelect.val(newPreset.id);\n\n        refreshRegexRulesList(); // \n      } else {\n        toastr.error('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-new').on('click', function () {\n      const name = prompt(':');\n      if (!name) return;\n\n      const newPreset = RegexPresetManager.createPreset(name, null);\n      if (newPreset) {\n        RegexPresetManager.setActivePreset(newPreset.id);\n\n        // [] \n        const $presetSelect = dialog.find('#regex-preset-select');\n        $presetSelect.append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        $presetSelect.val(newPreset.id);\n\n        refreshRegexRulesList(); // \n      } else {\n        toastr.error('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-del').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      if (confirm(`\"${currentPreset.name}\"`)) {\n        const success = RegexPresetManager.deletePreset(currentPreset.id);\n        if (success) {\n          // [] \n          const $presetSelect = dialog.find('#regex-preset-select');\n          $presetSelect.find(`option[value=\"${currentPreset.id}\"]`).remove();\n\n          // \n          const defaultPresetId = RegexPresetManager.getActivePreset()?.id;\n          if (defaultPresetId) {\n            $presetSelect.val(defaultPresetId);\n          }\n\n          refreshRegexRulesList(); // \n        } else {\n          toastr.error('');\n        }\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-export').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      const json = RegexPresetManager.exportPreset(currentPreset.id);\n      if (json) {\n        const blob = new Blob([json], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `regex-preset-${currentPreset.name}-${Date.now()}.json`;\n        a.click();\n        URL.revokeObjectURL(url);\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-import').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const text = await file.text();\n          if (!text?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(text.trim());\n          } catch {\n            toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.name || '';\n          const existingPresets = RegexPresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = text.trim();\n            if (newName) {\n              parsedData.name = newName;\n              // IDID\n              parsedData.id = `regex_preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset) {\n                // \n                if (existingPresets.length > 1) {\n                  RegexPresetManager.deletePreset(existingPreset.id);\n                  dialog.find(`#regex-preset-select option[value=\"${existingPreset.id}\"]`).remove();\n                }\n              }\n            }\n\n            const preset = RegexPresetManager.importPreset(finalJson);\n            if (preset) {\n              // [] \n              const $presetSelect = dialog.find('#regex-preset-select');\n              $presetSelect.append(`<option value=\"${escapeHtml(preset.id)}\">${escapeHtml(preset.name)}</option>`);\n              $presetSelect.val(preset.id);\n\n              // [] \n              RegexPresetManager.setActivePreset(preset.id);\n              Store.set(STORAGE_KEY_REGEX_RULES, preset.rules || []);\n              RegexTransformationManager.clearCache();\n\n              refreshRegexRulesList(); // \n            } else {\n              toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // === : ===\n    dialog.find('#btn-add-regex-rule').on('click', function () {\n      showAddRegexRuleModal();\n    });\n\n    // === [] : ===\n    dialog.find('#btn-execute-regex-now').on('click', async function () {\n      const $btn = $(this);\n      const originalHtml = $btn.html();\n\n      try {\n        // \n        $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n\n        // \n        let tableData = cachedRawData || getTableData();\n\n        if (!tableData) {\n          toastr.error('');\n          return;\n        }\n\n        // \n        if (typeof tableData !== 'object' || Array.isArray(tableData)) {\n          toastr.error('');\n          console.error('[DICE]:', typeof tableData, Array.isArray(tableData));\n          return;\n        }\n\n        // \n        const enabledRules = RegexTransformationManager.getEnabledRules();\n\n        if (enabledRules.length === 0) {\n          toastr.warning('');\n          return;\n        }\n\n        console.info(`[DICE] ${enabledRules.length} ...`);\n\n        // \n        const { totalApplied, errors } = RegexTransformationEngine.applyToTable(tableData, enabledRules);\n\n        // \n        cachedRawData = tableData;\n\n        // \n        await saveDataToDatabase(tableData, false, false);\n\n        if (errors.length > 0) {\n          toastr.warning(` ${totalApplied} ${errors.length} `);\n          console.warn('[DICE]:', errors);\n        } else {\n        }\n\n        console.info('[DICE]');\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : String(e);\n        console.error('[DICE]:', e);\n        toastr.error(`: ${errorMsg}`);\n      } finally {\n        // \n        $btn.prop('disabled', false).html(originalHtml);\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-add-validation-rule').on('click', function () {\n      showAddValidationRuleModal(dialog);\n    });\n\n    // === Debug ===\n    dialog.find('#btn-open-debug-console').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showDebugConsoleModal();\n    });\n\n    // ===  ===\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n      renderInterface();\n    };\n    dialog.on('click', '#dlg-close-x, .acu-settings-header .acu-close-btn', closeDialog);\n\n    // \n    dialog.on('click', '#acu-help-btn', function (e) {\n      e.stopPropagation();\n      window.open('https://jerryzmtz.github.io/DiceSystemManual//', '_blank');\n    });\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n  };\n\n  // [] \n  let renderInterfaceTimer = null;\n  let renderInterfacePending = false;\n\n  const renderInterface = () => {\n    // \n    if (isSettingsOpen) {\n      if (!renderInterfacePending) {\n        console.info('[DICE]');\n        renderInterfacePending = true;\n      }\n      return;\n    }\n\n    // \n    if (renderInterfaceTimer) {\n      clearTimeout(renderInterfaceTimer);\n    }\n\n    // 50ms\n    renderInterfaceTimer = setTimeout(() => {\n      renderInterfaceTimer = null;\n      renderInterfacePending = false;\n      _renderInterfaceImpl();\n    }, 50);\n  };\n\n  // \n  const _renderInterfaceImpl = () => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n\n    // [] Observer  ()\n    if (!observer && $('#chat').length) {\n      const $chat = $('#chat');\n      let mutationLock = false;\n      const handleMutation = () => {\n        if (mutationLock) return;\n        mutationLock = true;\n        requestAnimationFrame(() => {\n          const config = getConfig();\n          if (config.positionMode === 'embedded') {\n            mutationLock = false;\n            return;\n          }\n          const children = $chat.children();\n          const lastChild = children.last()[0];\n          const wrapper = $('.acu-wrapper')[0];\n          if (wrapper && lastChild && lastChild !== wrapper) {\n            if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n              $chat.append(wrapper);\n            }\n          }\n\n          // [] \n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            // 1\n            const children = $chat.children();\n            const lastChild = children.last();\n            if (lastChild.hasClass('mes') || lastChild.hasClass('message-body')) {\n              lastChild.addClass('acu-dice-result-revealing');\n            }\n\n            // 2RAF\n            requestAnimationFrame(() => {\n              hideDiceResultsInUserMessages();\n\n              // 3\n              requestAnimationFrame(() => {\n                lastChild.removeClass('acu-dice-result-revealing').addClass('acu-dice-result-revealed');\n                // \n                setTimeout(() => {\n                  lastChild.removeClass('acu-dice-result-revealed');\n                }, 200);\n              });\n            });\n          }\n\n          mutationLock = false;\n        });\n      };\n      observer = new MutationObserver(handleMutation);\n      observer.observe($chat[0], { childList: true });\n    }\n    let rawData;\n    let isDataFromDatabase = false; // \n    if (hasUnsavedChanges && cachedRawData) {\n      rawData = cachedRawData;\n    } else {\n      rawData = getTableData();\n      isDataFromDatabase = true; // \n\n      // [] \n      if (rawData) {\n        let anyLockApplied = false;\n        for (const sheetId in rawData) {\n          if (!sheetId.startsWith('sheet_')) continue;\n          const sheet = rawData[sheetId];\n          if (!sheet || !sheet.name || !sheet.content) continue;\n\n          const result = LockManager.applyLocks(sheet.name, sheet.content);\n          if (result.modified) {\n            anyLockApplied = true;\n          }\n          if (result.restored.length > 0) {\n          }\n        }\n        if (anyLockApplied) {\n        }\n      }\n\n      // [] auto\n      // \n      // \n      if (rawData && !isAutoTransforming && isDataFromDatabase) {\n        try {\n          const enabledRules = RegexTransformationManager.getEnabledRules();\n\n          if (enabledRules.length > 0) {\n            console.info(`[DICE] ${enabledRules.length} ...`);\n\n            isAutoTransforming = true; // \n            const transformResult = RegexTransformationEngine.applyToTable(rawData, enabledRules);\n            if (transformResult.totalApplied > 0) {\n              console.info(`[DICE] ${transformResult.totalApplied} `);\n\n              // \n              //  saveDataOnly \n              // saveDataOnly  UpdateController.handleUpdate() isAutoTransforming \n              // \n              saveDataOnly(rawData).catch(err => {\n                console.warn('[DICE]:', err);\n              });\n            }\n            if (transformResult.errors.length > 0) {\n              console.warn(`[DICE] ${transformResult.errors.length} :`, transformResult.errors);\n            } else if (transformResult.totalApplied === 0) {\n              console.info('[DICE]');\n            }\n            isAutoTransforming = false; // \n          } else {\n            isAutoTransforming = false; // \n          }\n        } catch (transformError) {\n          isAutoTransforming = false; // \n          const errorMsg = transformError instanceof Error ? transformError.message : String(transformError);\n          console.error('[DICE]:', transformError);\n        }\n      }\n\n      if (rawData) {\n        cachedRawData =\n          typeof structuredClone === 'function' ? structuredClone(rawData) : JSON.parse(JSON.stringify(rawData));\n\n        const existingSnapshot = loadSnapshot();\n        const currentCtx = getCurrentContextFingerprint();\n\n        // \n        const hasValidSnapshotData =\n          existingSnapshot && Object.keys(existingSnapshot).some(k => k.startsWith('sheet_'));\n\n        if (!existingSnapshot || !hasValidSnapshotData) {\n          // 1    \n          saveSnapshot({ ...cachedRawData, _contextId: currentCtx });\n        } else if (!existingSnapshot._contextId) {\n          // 2 ID \n          saveSnapshot({ ...existingSnapshot, _contextId: currentCtx });\n        } else if (existingSnapshot._contextId !== currentCtx) {\n          // 3  \n          cachedRawData._contextId = currentCtx;\n          saveSnapshot(cachedRawData);\n        }\n        // 4  \n      }\n    }\n\n    const $searchInput = $('.acu-search-input');\n    if ($('.acu-wrapper').length && $searchInput.is(':focus')) {\n      if (rawData) {\n        if (!isSaving) currentDiffMap = generateDiffMap(rawData);\n        const tables = processJsonData(rawData);\n        const activeTab = getActiveTabState();\n        const currentTabName = activeTab && tables[activeTab] ? activeTab : null;\n\n        if (currentTabName && tables[currentTabName]) {\n          const newHtml = renderTableContent(tables[currentTabName], currentTabName);\n          const $virtualDom = $('<div>').html(newHtml);\n          $('.acu-card-grid').replaceWith($virtualDom.find('.acu-card-grid'));\n          $('.acu-panel-title').html($virtualDom.find('.acu-panel-title').html());\n          // [] \n          bindEvents(tables);\n          bindOptionEvents(); // <--- \n          return;\n        }\n      }\n    }\n\n    let lastScrollX = 0;\n    let lastScrollY = 0;\n\n    const $oldContent = $('.acu-panel-content');\n    if ($oldContent.length) {\n      lastScrollX = $oldContent.scrollLeft();\n      lastScrollY = $oldContent.scrollTop();\n    }\n\n    $('.acu-wrapper').remove();\n    const tables = processJsonData(rawData || {});\n\n    if (isSaving) {\n      currentDiffMap = new Set();\n    } else {\n      currentDiffMap = generateDiffMap(rawData);\n    }\n\n    const savedOrder = getSavedTableOrder();\n    let orderedNames = Object.keys(tables);\n    if (savedOrder)\n      orderedNames = savedOrder.filter(n => tables[n]).concat(orderedNames.filter(n => !savedOrder.includes(n)));\n\n    const hiddenList = getHiddenTables();\n    orderedNames = orderedNames.filter(n => !hiddenList.includes(n));\n\n    const activeTab = getActiveTabState();\n    let currentTabName = activeTab && tables[activeTab] && !hiddenList.includes(activeTab) ? activeTab : null;\n\n    const config = getConfig();\n    const isCollapsed = getCollapsedState();\n\n    const layoutClass = config.layout === 'vertical' ? 'acu-layout-vertical' : '';\n    // []  (/)\n    const positionClass = `acu-mode-${config.positionMode || 'fixed'}`;\n\n    // []  () \n    let finalGridCols = config.gridColumns;\n    if (finalGridCols === 'auto') {\n      const n = orderedNames.length;\n\n      if (n <= 4) {\n        finalGridCols = n < 2 ? 2 : n;\n      } else {\n        const empty3 = Math.ceil(n / 3) * 3 - n;\n        const empty4 = Math.ceil(n / 4) * 4 - n;\n        finalGridCols = empty4 <= empty3 ? 4 : 3;\n      }\n    }\n\n    // --- []  +  ---\n    let optionHtml = '';\n    let currentOptionHash = null; // \n\n    if (config.showOptionPanel !== false) {\n      const optionTables = [];\n      Object.keys(tables).forEach(k => {\n        if (k.includes('')) optionTables.push(tables[k]);\n      });\n\n      // []  - \n      if (optionTables.length > 0) {\n        const isOptionsCollapsed = getOptionsCollapsedState();\n        const collapseIcon = isOptionsCollapsed ? 'fa-chevron-right' : 'fa-chevron-down';\n        const collapseText = isOptionsCollapsed ? '' : '';\n        const collapsedClass = isOptionsCollapsed ? 'collapsed' : '';\n\n        let optionCount = 0;\n        let hasBtns = false;\n        // []\n        let optionValues = []; // \n\n        // \n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  optionCount++;\n                }\n              });\n            });\n          }\n        });\n\n        // \n        let buttonsHtml = `\n                    <div class=\"acu-opt-header\" data-action=\"toggle-options\">\n                        <span>\n                            <i class=\"fa-solid ${collapseIcon}\" style=\"margin-right:6px;font-size:10px;\"></i>\n                             (${optionCount})\n                        </span>\n                    </div>`;\n\n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  const cellStr = String(cell).trim();\n                  buttonsHtml += `<button class=\"acu-opt-btn\" data-val=\"${encodeURIComponent(cellStr)}\">${escapeHtml(cellStr)}</button>`;\n                  optionValues.push(cellStr);\n                  hasBtns = true;\n                }\n              });\n            });\n          }\n        });\n\n        if (hasBtns) {\n          optionHtml = `<div class=\"acu-option-panel ${collapsedClass}\">${buttonsHtml}</div>`;\n          //  ()\n          // [] \n          currentOptionHash = optionValues.join('|||') + (isOptionsCollapsed ? '_collapsed' : '_expanded');\n        }\n      }\n    }\n\n    // [] \n    const optionChanged = currentOptionHash !== lastOptionHash;\n    if (optionChanged && currentOptionHash !== null) {\n      // \n      optionPanelVisible = true;\n    }\n    lastOptionHash = currentOptionHash; // \n\n    let html = `<div class=\"acu-wrapper ${positionClass} acu-theme-${config.theme} ${layoutClass}\" style=\"--acu-card-width:${config.cardWidth}px; --acu-font-size:${config.fontSize}px; --acu-opt-font-size:${config.optionFontSize || 12}px; --acu-grid-cols:${finalGridCols}\">`;\n\n    // []  DOM  column-reverse\n    // []  optionPanelVisible \n    if (config.positionMode === 'embedded' && optionHtml && optionPanelVisible) {\n      html += optionHtml;\n    }\n\n    if (isCollapsed) {\n      const colStyleClass = `acu-col-${config.collapseStyle || 'bar'}`;\n      const alignClass = `acu-align-${config.collapseAlign || 'right'}`;\n      html += `\n                <div class=\"acu-expand-trigger ${colStyleClass} ${alignClass}\" id=\"acu-btn-expand\">\n                    <i class=\"fa-solid fa-table\"></i> <span> (${Object.keys(tables).length})</span>\n                </div>\n            `;\n    } else {\n      // [] \n      const savedHeight = currentTabName ? getTableHeights()[currentTabName] : null;\n      // [] \n      const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n      const isChangesPanelActive = Store.get('acu_changes_panel_active', false);\n      const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n      const mvuSavedHeight = isMvuActive ? getTableHeights()[MvuModule.MODULE_ID] : null;\n      const finalSavedHeight = mvuSavedHeight || savedHeight;\n      const shouldShowPanel = isDashboardActive || isChangesPanelActive || isMvuActive || currentTabName;\n\n      html += `\n                <div class=\"acu-data-display ${shouldShowPanel ? 'visible' : ''} ${finalSavedHeight ? 'acu-manual-mode' : ''}\" id=\"acu-data-area\" style=\"${finalSavedHeight ? 'height:' + finalSavedHeight + 'px;' : ''}\">\n                    ${\n                      isChangesPanelActive\n                        ? renderChangesPanel(rawData)\n                        : isDashboardActive\n                          ? renderDashboard(tables)\n                          : isMvuActive\n                            ? '<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>'\n                            : currentTabName\n                              ? renderTableContent(tables[currentTabName], currentTabName)\n                              : ''\n                    }\n                </div>\n                `;\n\n      // [] \n      // PC(>768px) CSS display:flex !important grid \n      const gridFixStyle = `grid-template-columns: repeat(${finalGridCols}, 1fr);`;\n\n      html += `\n                <div class=\"acu-nav-container ${config.actionsPosition === 'top' ? 'acu-pos-top' : ''}\" id=\"acu-nav-bar\" style=\"${gridFixStyle}\">\n                    <div class=\"acu-order-controls\" id=\"acu-order-hint\"><i class=\"fa-solid fa-arrows-alt\"></i> </div>\n            `;\n\n      // ===  +  ===\n      const isChangesActive = Store.get('acu_changes_panel_active', false);\n      const isSimpleModeNav = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n      let changesCount = 0;\n      let validationErrorCount = 0;\n      if (rawData) {\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          for (const sheetId in rawData) {\n            if (!sheetId.startsWith('sheet_')) continue;\n            const newSheet = rawData[sheetId];\n            const oldSheet = snapshot[sheetId];\n            if (!newSheet?.content) continue;\n            const newRows = newSheet.content.slice(1);\n            const oldRows = oldSheet?.content?.slice(1) || [];\n            newRows.forEach((row, rowIdx) => {\n              const oldRow = oldRows[rowIdx];\n              if (!oldRow) {\n                changesCount++;\n                return;\n              }\n              row.forEach((cell, colIdx) => {\n                if (colIdx === 0) return;\n                if (String(cell ?? '') !== String(oldRow[colIdx] ?? '')) changesCount++;\n              });\n            });\n            if (oldRows.length > newRows.length) changesCount += oldRows.length - newRows.length;\n          }\n          for (const sheetId in snapshot) {\n            if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n          }\n        }\n        // \n        validationErrorCount = ValidationEngine.getErrorCount(rawData);\n      }\n      // \n      const isValidationMode = isSimpleModeNav;\n      const displayCount = isValidationMode ? validationErrorCount : changesCount;\n      // \n      const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n      // ===  ===\n      const navHiddenList = getHiddenTables();\n      const navSavedOrder = getSavedTableOrder() || [];\n\n      //  + \n      const SPECIAL_NAV_ITEMS = [\n        { key: '__dice__', icon: 'fa-dice-d20', label: '', id: 'acu-btn-dice-nav', extraClass: 'acu-dice-nav-btn' },\n        {\n          key: '__changes__',\n          icon: 'fa-code-compare',\n          label: `${displayCount > 0 ? '(' + displayCount + ')' : ''}`,\n          id: 'acu-btn-changes',\n          extraClass: `acu-changes-btn${showWarningIcon ? ' has-validation-errors' : ''}`,\n          isActive: isChangesActive,\n          warningIcon: showWarningIcon,\n        },\n        {\n          key: '__mvu__',\n          icon: 'fa-code-branch',\n          label: '',\n          id: 'acu-btn-mvu',\n          extraClass: 'acu-mvu-btn',\n          isActive: getActiveTabState() === MvuModule.MODULE_ID,\n        },\n      ];\n\n      // \n      let allNavItems = [];\n\n      // \n      SPECIAL_NAV_ITEMS.forEach(item => {\n        // \n        if (navHiddenList.includes(item.key)) return;\n\n        // MVU\n        if (item.key === '__mvu__') {\n          allNavItems.push({ ...item, isSpecial: true });\n          return;\n        }\n\n        // checkAvailable\n        if (item.checkAvailable && !item.checkAvailable()) return;\n        allNavItems.push({ ...item, isSpecial: true });\n      });\n\n      // \n      orderedNames.forEach(name => {\n        allNavItems.push({\n          key: name,\n          icon: getIconForTableName(name),\n          label: name,\n          isSpecial: false,\n          isActive: !isDashboardActive && !isChangesActive && currentTabName === name,\n        });\n      });\n\n      // \n      if (navSavedOrder.length > 0) {\n        const orderMap = new Map(navSavedOrder.map((k, i) => [k, i]));\n        allNavItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      // [] /\n      // order  1  Grid \n      html += `<button class=\"acu-nav-btn acu-dashboard-btn ${isDashboardActive ? 'active' : ''}\" id=\"acu-btn-dashboard\" style=\"order: 1;\">\n                <i class=\"fa-solid fa-chart-line\"></i><span></span>\n            </button>`;\n\n      // order  2 \n      allNavItems.forEach((item, idx) => {\n        const activeClass = item.isActive ? 'active' : '';\n        const extraClass = item.extraClass || '';\n        const orderVal = idx + 2; //  2  1\n\n        if (item.isSpecial) {\n          // \n          const warningIconHtml = item.warningIcon\n            ? '<i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>'\n            : '';\n          html += `<button class=\"acu-nav-btn ${extraClass} ${activeClass}\" id=\"${item.id}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>${warningIconHtml}\n                    </button>`;\n        } else {\n          // \n          html += `<button class=\"acu-nav-btn ${activeClass}\" data-table=\"${escapeHtml(item.key)}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>\n                    </button>`;\n        }\n      });\n      // order \n      html += `<div class=\"acu-actions-group\" id=\"acu-active-actions\" style=\"order: 9999;\">`;\n      ACTION_BUTTONS.forEach(btn => {\n        html += `<button class=\"acu-action-btn\" id=\"${btn.id}\" title=\"${btn.title}\"><i class=\"fa-solid ${btn.icon}\"></i></button>`;\n      });\n      html += `</div>`;\n\n      html += `</div>`; //  acu-nav-container\n    }\n\n    html += `</div>`; //  acu-wrapper\n\n    const $existing = $('.acu-wrapper');\n    if ($existing.length) {\n      $existing.replaceWith(html);\n    } else {\n      insertHtmlToPage(html);\n    }\n\n    // --- []  ---\n    if (config.positionMode !== 'embedded' && optionHtml && optionPanelVisible) {\n      if (optionChanged) {\n        //  AI \n        injectIndependentOptions(optionHtml);\n      } else {\n        // \n        const $existing = $('.acu-embedded-options-container');\n        if ($existing.length === 0) {\n          // \n          injectIndependentOptions(optionHtml);\n        }\n        // \n      }\n    } else if (config.positionMode !== 'embedded') {\n      // \n      $('.acu-embedded-options-container').remove();\n    } else {\n      // [] \n      $('.acu-embedded-options-container').remove();\n    }\n\n    bindEvents(tables);\n    bindOptionEvents();\n    updateSaveButtonState();\n    // [] \n    if (Store.get('acu_changes_panel_active', false)) {\n      bindChangesEvents();\n    }\n    // [] \n    if (getActiveTabState() === MvuModule.MODULE_ID) {\n      const $panel = $('#acu-data-area');\n      if ($panel.length) {\n        // \n        // \n        // \n        $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n        MvuModule.bindEvents($panel);\n\n        // \n        MvuModule.getDataWithRetry(5, 800)\n          .then(mvuData => {\n            // \n            if (mvuData) {\n              $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n              MvuModule.bindEvents($panel);\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error getting data:', err);\n            // \n            $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n            MvuModule.bindEvents($panel);\n          });\n      }\n    }\n\n    setTimeout(() => {\n      const $newContent = $('.acu-panel-content');\n      const activeTab = getActiveTabState();\n      const savedState = tableScrollStates[activeTab];\n\n      if ($newContent.length) {\n        // 1. \n        //  savedState () lastScrollY ()\n        if (savedState) {\n          $newContent.scrollTop(savedState.top);\n          $newContent.scrollLeft(savedState.left);\n        } else {\n          if (lastScrollY > 0) $newContent.scrollTop(lastScrollY);\n          if (lastScrollX > 0) $newContent.scrollLeft(lastScrollX);\n        }\n\n        // 2.  ()\n        if (savedState && savedState.inner) {\n          Object.keys(savedState.inner).forEach(key => {\n            const scrollTop = savedState.inner[key];\n            // \n            const $targetTitle = $newContent.find(`.acu-editable-title[data-row=\"${key}\"]`);\n            if ($targetTitle.length) {\n              const $card = $targetTitle.closest('.acu-data-card');\n              //  ( overflow on card)\n              $card.scrollTop(scrollTop);\n              //  body  ( overflow on body)\n              $card.find('.acu-card-body').scrollTop(scrollTop);\n            }\n          });\n        }\n      }\n    }, 0);\n    console.info('[DICE]');\n  };\n\n  // [] \n  const injectIndependentOptions = htmlContent => {\n    const { $ } = getCore();\n    $('.acu-embedded-options-container').remove();\n\n    //  AI \n    const getTargetContainer = () => {\n      const $allMes = $('#chat .mes');\n      const $aiMes = $allMes.filter(function () {\n        const $this = $(this);\n        if ($this.attr('is_user') === 'true' || $this.attr('is_system') === 'true' || $this.hasClass('sys_mes'))\n          return false;\n        //  data-is-system \n        if ($this.find('.name_text').text().trim() === 'System' || $this.attr('data-is-system') === 'true')\n          return false;\n        // [] \n        if ($this.find('.mes_text').length === 0) return false;\n        if ($this.css('display') === 'none') return false;\n        return true;\n      });\n      if ($aiMes.length === 0) return null;\n\n      const $targetMes = $aiMes.last();\n      // []  .mes_text  .mes_block\n      const $targetText = $targetMes.find('.mes_text');\n      return $targetText.length ? $targetText : $targetMes;\n    };\n\n    const $target = getTargetContainer();\n    if ($target && $target.length) {\n      const optConfig = getConfig();\n      const $container = $(\n        `<div class=\"acu-embedded-options-container acu-theme-${optConfig.theme}\" style=\"--acu-opt-font-size:${optConfig.optionFontSize || 12}px;\"></div>`,\n      );\n      $container.html(htmlContent);\n      $target.append($container);\n    }\n  };\n\n  // []  ( + )\n  const bindOptionEvents = () => {\n    const { $ } = getCore();\n    //  Body \n    $('body')\n      .off('click.acu_opt')\n      .on('click.acu_opt', '.acu-opt-btn', async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const config = getConfig();\n        const val = decodeURIComponent($(this).data('val'));\n\n        // 1:  -> \n        if (!config.clickOptionToAutoSend) {\n          smartInsertToTextarea(val, 'action');\n          $('#send_textarea').focus();\n          return;\n        }\n\n        // 2: \n        // A: TavernHelper ( refresh: 'affected' )\n        if (window.TavernHelper) {\n          try {\n            // 1.  createChatMessages \n            if (window.TavernHelper.createChatMessages) {\n              await window.TavernHelper.createChatMessages(\n                [\n                  {\n                    role: 'user',\n                    message: val,\n                  },\n                ],\n                {\n                  //  TavernHelper \n                  refresh: 'affected',\n                },\n              );\n\n              // 2. \n              if (window.TavernHelper.triggerSlash) {\n                await window.TavernHelper.triggerSlash('/trigger');\n              }\n              return;\n            }\n          } catch (err) {\n            console.warn('[DICE]ACU TavernHelper ', err);\n          }\n        }\n\n        // B: SillyTavern  (Slash Command)\n        const ST = window.SillyTavern || window.parent?.SillyTavern;\n        if (ST && ST.executeSlashCommandsWithOptions) {\n          try {\n            //  raw=true  ( slash_command.txt)\n            const safeVal = val.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n            const cmd = `/send raw=true \"${safeVal}\"`;\n\n            const sendResult = await ST.executeSlashCommandsWithOptions(cmd);\n\n            if (!sendResult.isError && !sendResult.isAborted) {\n              await ST.executeSlashCommandsWithOptions('/trigger');\n              return;\n            }\n            console.warn('[DICE]ACU ST send :', sendResult);\n          } catch (err) {\n            console.warn('[DICE]ACU ST', err);\n          }\n        }\n\n        // C:  +  ()\n        const ta = $('#send_textarea');\n        if (ta.length) {\n          ta.val(val);\n          ta.trigger('input').trigger('change');\n          //  React \n          await new Promise(r => setTimeout(r, 50));\n          const sendBtn = $('#send_but').filter(':visible');\n          if (sendBtn.length) {\n            sendBtn[0].click();\n          } else {\n            // \n            const enterEvent = $.Event('keydown', { keyCode: 13, which: 13, bubbles: true });\n            ta.trigger(enterEvent);\n          }\n        }\n      });\n  };\n\n  const insertHtmlToPage = html => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // ---  ---\n\n    // 1.  (Embedded) v19 \n    if (config.positionMode === 'embedded') {\n      $('.acu-wrapper').remove(); // \n\n      const getTargetContainer = () => {\n        const $allMes = $('#chat .mes');\n        const $aiMes = $allMes.filter(function () {\n          const $this = $(this);\n          if ($this.attr('is_user') === 'true') return false;\n          if ($this.attr('is_system') === 'true') return false;\n          if ($this.hasClass('sys_mes')) return false;\n          const name = $this.find('.name_text').text().trim();\n          if (name === 'System') return false;\n          if ($this.css('display') === 'none') return false;\n          const $textDiv = $this.find('.mes_text');\n          if ($textDiv.length === 0) return false;\n          const textContent = $textDiv.text().trim();\n          const hasImage = $textDiv.find('img').length > 0;\n          if (textContent.length === 0 && !hasImage) return false;\n          return true;\n        });\n        //  AI  chat\n        if ($aiMes.length === 0) return $('#chat');\n\n        // \n\n        let targetIndex = $aiMes.length - 1;\n        const $targetMes = $aiMes.eq(targetIndex);\n        const $targetBlock = $targetMes.find('.mes_block');\n        return $targetBlock.length ? $targetBlock : $targetMes;\n      };\n\n      const $target = getTargetContainer();\n      if ($target.length) {\n        if ($target.hasClass('mes_block') || $target.hasClass('mes')) {\n          if ($target.find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          } else {\n            $target.find('.acu-wrapper').replaceWith(html);\n          }\n        } else {\n          // Fallback\n          if ($('#chat').find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          }\n        }\n      } else {\n        $('body').append(html);\n      }\n      return;\n    }\n\n    // 2.  (Fixed) B \n    // \n    const $chat = $('#chat');\n    const $oldWrapper = $('.acu-wrapper');\n\n    if ($oldWrapper.length) {\n      $oldWrapper.replaceWith(html);\n    } else {\n      if ($chat.length) {\n        $chat.append(html);\n      } else {\n        $('body').append(html);\n      }\n    }\n  };\n  // [] \n  const renderChangesPanel = rawData => {\n    const snapshot = loadSnapshot();\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // \n    const validationErrors = rawData ? ValidationEngine.validateAllData(rawData) : [];\n\n    if (!snapshot || !rawData) {\n      // \n      if (validationErrors.length === 0) {\n        return `\n                <div class=\"acu-panel-header\">\n                    <div class=\"acu-panel-title\">\n                        <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-compare\"></i> <span class=\"acu-title-text\"></span></div>\n                        <div class=\"acu-title-sub\"></div>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-panel-content\" style=\"display:flex;align-items:center;justify-content:center;\">\n                    <div class=\"acu-empty-hint\"></div>\n                </div>`;\n      }\n    }\n\n    // \n    const changes = [];\n\n    for (const sheetId in rawData) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      const newSheet = rawData[sheetId];\n      const oldSheet = snapshot[sheetId];\n      if (!newSheet?.name || !newSheet?.content) continue;\n\n      const tableName = newSheet.name;\n      const headers = newSheet.content[0] || [];\n      const newRows = newSheet.content.slice(1);\n      const oldRows = oldSheet?.content?.slice(1) || [];\n\n      // \n      newRows.forEach((row, rowIdx) => {\n        const oldRow = oldRows[rowIdx];\n\n        if (!oldRow) {\n          // \n          changes.push({\n            type: 'row_added',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: rowIdx,\n            headers,\n            row,\n            title: row[1] || ` ${rowIdx + 1}`,\n          });\n        } else {\n          // \n          const rowChanges = [];\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return; // \n            const oldVal = String(oldRow[colIdx] ?? '');\n            const newVal = String(cell ?? '');\n            if (oldVal !== newVal) {\n              rowChanges.push({\n                colIndex: colIdx,\n                header: headers[colIdx] || `${colIdx}`,\n                oldValue: oldVal,\n                newValue: newVal,\n              });\n            }\n          });\n\n          if (rowChanges.length === 1) {\n            // \n            const c = rowChanges[0];\n            changes.push({\n              type: 'cell_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              colIndex: c.colIndex,\n              header: c.header,\n              oldValue: c.oldValue,\n              newValue: c.newValue,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          } else if (rowChanges.length > 1) {\n            // \n            changes.push({\n              type: 'row_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              headers,\n              row,\n              oldRow,\n              changedFields: rowChanges,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          }\n        }\n      });\n\n      // \n      if (oldRows.length > newRows.length) {\n        for (let i = newRows.length; i < oldRows.length; i++) {\n          const oldRow = oldRows[i];\n          changes.push({\n            type: 'row_deleted',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: i,\n            headers,\n            row: oldRow,\n            title: oldRow[1] || ` ${i + 1}`,\n          });\n        }\n      }\n    }\n\n    // \n    for (const sheetId in snapshot) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      if (!rawData[sheetId]) {\n        const oldSheet = snapshot[sheetId];\n        changes.push({\n          type: 'table_deleted',\n          tableName: oldSheet?.name || sheetId,\n          tableKey: sheetId,\n        });\n      }\n    }\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n\n    // \n    const panelTitle = isValidationMode ? '' : '';\n    const panelIcon = isValidationMode ? 'fa-shield-halved' : 'fa-code-compare';\n    const toggleTitle = isValidationMode ? '' : '';\n\n    //  HTML\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n                    <div class=\"acu-title-main\"><i class=\"fa-solid ${panelIcon}\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                </div>\n                <div class=\"acu-header-actions\">\n                    ${!isValidationMode ? '<button class=\"acu-changes-batch-btn acu-batch-accept\" title=\"\"><i class=\"fa-solid fa-check-double\"></i></button>' : ''}\n                    <button class=\"acu-changes-batch-btn acu-batch-reject\" title=\"${isValidationMode ? '' : ''}\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                    <button class=\"acu-changes-batch-btn acu-simple-mode-toggle ${isValidationMode ? 'active' : ''}\" title=\"${toggleTitle}\">\n                        <i class=\"fa-solid ${isValidationMode ? 'fa-filter-circle-xmark' : 'fa-filter'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                    </div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>`;\n\n    // ===  ===\n    if (isValidationMode) {\n      html += `<div class=\"acu-validation-mode-hint\">\n        <i class=\"fa-solid fa-info-circle\"></i>\n      </div>`;\n    }\n\n    html += `<div class=\"acu-panel-content acu-changes-content ${config.layout === 'horizontal' ? 'acu-changes-horizontal' : ''}\">`;\n\n    // ===  ===\n    if (isValidationMode) {\n      if (validationErrors.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedErrors = ValidationEngine.groupErrorsByTable(validationErrors);\n        const collapsedGroups = Store.get('acu_validation_collapsed_groups', []);\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        for (const tableName in groupedErrors) {\n          const tableErrors = groupedErrors[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header acu-validation-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\" style=\"background:${t.errorText};\">${tableErrors.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableErrors.forEach(error => {\n            const ruleData = error.rule\n              ? escapeHtml(\n                  JSON.stringify({\n                    ruleId: error.ruleId,\n                    ruleType: error.ruleType,\n                    tableName: error.tableName,\n                    rowIndex: error.rowIndex,\n                    columnName: error.columnName || '',\n                    currentValue: error.currentValue || '',\n                    rowTitle: error.rowTitle || '', //  rowTitle  ruleData\n                    rule: error.rule,\n                  }),\n                )\n              : '';\n\n            html += `<div class=\"acu-change-item acu-validation-error-item\"\n                         data-table=\"${escapeHtml(error.tableName)}\"\n                         data-row=\"${error.rowIndex}\"\n                         data-column=\"${escapeHtml(error.columnName || '')}\"\n                         data-rule-id=\"${escapeHtml(error.ruleId || '')}\"\n                         data-rule-type=\"${escapeHtml(error.ruleType || '')}\"\n                         data-rule-data=\"${ruleData}\">\n                        <span class=\"acu-change-badge\" style=\"background:var(--acu-hl-manual-bg);color:var(--acu-hl-manual);\">!</span>\n                        ${error.rowTitle && error.rowIndex >= 0 ? `<div class=\"acu-validation-row-title\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:2px;\">${escapeHtml(error.rowTitle)}</div>` : ''}\n                        <span class=\"acu-change-title\">${escapeHtml(error.columnName || '')}${error.currentValue ? `: ${escapeHtml(error.currentValue.length > 15 ? error.currentValue.substring(0, 15) + '...' : error.currentValue)}` : ''}</span>\n                        <span class=\"acu-validation-error-msg\">${escapeHtml(error.errorMessage.length > 25 ? error.errorMessage.substring(0, 25) + '...' : error.errorMessage)}</span>\n                        <div class=\"acu-change-actions\">\n                            <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                        </div>\n                    </div>`;\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    } else {\n      // ===  ===\n      if (changes.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedChanges = {};\n        changes.forEach(c => {\n          const key = c.tableName;\n          if (!groupedChanges[key]) groupedChanges[key] = [];\n          groupedChanges[key].push(c);\n        });\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        const collapsedGroups = Store.get('acu_changes_collapsed_groups', []);\n\n        for (const tableName in groupedChanges) {\n          const tableChanges = groupedChanges[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\">${tableChanges.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableChanges.forEach(change => {\n            if (change.type === 'row_added') {\n              html += `<div class=\"acu-change-item acu-change-added\"\n                            data-change-type=\"row_added\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-added\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"row_deleted\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'cell_modified') {\n              const oldShort = change.oldValue.length > 15 ? change.oldValue.substring(0, 15) + '...' : change.oldValue;\n              const newShort = change.newValue.length > 15 ? change.newValue.substring(0, 15) + '...' : change.newValue;\n\n              const isOptionTable = change.tableName && change.tableName.includes('');\n              let fieldDisplay;\n              if (isOptionTable) {\n                fieldDisplay = `${escapeHtml(change.tableName)}.${escapeHtml(change.header)}`;\n              } else {\n                fieldDisplay = `${escapeHtml(change.rowTitle)}.${escapeHtml(change.header)}`;\n              }\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"cell_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\"\n                            data-col-index=\"${change.colIndex}\"\n                            data-old-value=\"${encodeURIComponent(change.oldValue)}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-field\">${fieldDisplay}</span>\n                            <span class=\"acu-change-diff\">\n                                <span class=\"acu-diff-old\">${escapeHtml(oldShort || '()')}</span>\n                                <span class=\"acu-diff-arrow\"></span>\n                                <span class=\"acu-diff-new\">${escapeHtml(newShort || '()')}</span>\n                            </span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_modified') {\n              // \n              const fieldCount = change.changedFields.length;\n              const fieldNames = change.changedFields\n                .slice(0, 2)\n                .map(f => f.header)\n                .join('');\n              const moreText = fieldCount > 2 ? ` ${fieldCount}` : '';\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"row_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.rowTitle)}</span>\n                            <span class=\"acu-change-field-count\">${escapeHtml(fieldNames)}${moreText}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'table_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"table_deleted\"\n                            data-table-key=\"${change.tableKey}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\"></span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            }\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    }\n\n    html += `</div>`;\n    return html;\n  };\n  // [] \n  const bindChangesEvents = () => {\n    const { $ } = getCore();\n\n    // \n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-close-btn')\n      .off('click')\n      .on('click', function () {\n        Store.set('acu_changes_panel_active', false);\n        $('#acu-data-area').removeClass('visible');\n        $('.acu-nav-btn').removeClass('active');\n      });\n\n    // === ===\n    const TOUCH_MOVE_THRESHOLD = 10; // 10px\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const tableName = $item.data('table');\n        const rowIndex = parseInt($item.data('row'), 10);\n        const columnName = $item.data('column');\n\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        try {\n          const rawData = cachedRawData || getTableData();\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === tableName && snapshot[sheetId]) {\n              const headers = rawData[sheetId].content?.[0] || [];\n              const colIdx = headers.indexOf(columnName);\n              if (colIdx >= 0 && snapshot[sheetId].content?.[rowIndex + 1]) {\n                const snapshotValue = snapshot[sheetId].content[rowIndex + 1][colIdx];\n                rawData[sheetId].content[rowIndex + 1][colIdx] = snapshotValue;\n                await saveDataToDatabase(rawData, false, false);\n                renderInterface();\n                return;\n              }\n              break;\n            }\n          }\n          if (window.toastr) window.toastr.warning('');\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const ruleData = $item.data('rule-data');\n        if (!ruleData) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        try {\n          const parsed = typeof ruleData === 'string' ? JSON.parse(ruleData) : ruleData;\n          const error = {\n            ruleId: parsed.ruleId,\n            ruleType: parsed.ruleType,\n            rule: parsed.rule,\n            tableName: $item.data('table') || parsed.tableName || '',\n            rowIndex: parseInt($item.data('row'), 10) || parsed.rowIndex || 0,\n            columnName: $item.data('column') || parsed.columnName || '',\n            currentValue: parsed.currentValue || '',\n            rowTitle: parsed.rowTitle || '', //  rowTitle \n            ruleName: parsed.ruleName || parsed.rule?.name || '',\n            errorMessage: parsed.errorMessage || parsed.rule?.errorMessage || '',\n          };\n          showSmartFixModal(error);\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    let validationItemTouchStartPos: { x: number; y: number } | null = null;\n\n    $('.acu-validation-error-item')\n      .off('click touchstart touchend touchmove')\n      .on('touchstart', function (e) {\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        validationItemTouchStartPos = { x: touch.clientX, y: touch.clientY };\n      })\n      .on('touchmove', function (e) {\n        if (!validationItemTouchStartPos) return;\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        const deltaX = Math.abs(touch.clientX - validationItemTouchStartPos.x);\n        const deltaY = Math.abs(touch.clientY - validationItemTouchStartPos.y);\n        // \n        if (deltaX > TOUCH_MOVE_THRESHOLD || deltaY > TOUCH_MOVE_THRESHOLD) {\n          validationItemTouchStartPos = null;\n        }\n      })\n      .on('touchend', function (e) {\n        // \n        if (!validationItemTouchStartPos) return;\n        validationItemTouchStartPos = null;\n\n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      })\n      .on('click', function (e) {\n        //  click \n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        //  touchend \n        if ('ontouchstart' in window) return;\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      });\n\n    // /\n    $('.acu-changes-group-header')\n      .off('click')\n      .on('click', function (e) {\n        if ($(e.target).closest('.acu-change-item').length) return;\n\n        const tableName = $(this).data('table');\n        const $group = $(this).closest('.acu-changes-group');\n        const $body = $group.find('.acu-changes-group-body');\n        const $icon = $(this).find('.acu-collapse-icon');\n\n        // \n        const isValidationMode = $(this).hasClass('acu-validation-group-header');\n        const storageKey = isValidationMode ? 'acu_validation_collapsed_groups' : 'acu_changes_collapsed_groups';\n        let collapsedGroups = Store.get(storageKey, []);\n\n        if ($group.hasClass('collapsed')) {\n          $group.removeClass('collapsed');\n          $body.slideDown(200);\n          $icon.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n          collapsedGroups = collapsedGroups.filter(n => n !== tableName);\n        } else {\n          $group.addClass('collapsed');\n          $body.slideUp(200);\n          $icon.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n          if (!collapsedGroups.includes(tableName)) {\n            collapsedGroups.push(tableName);\n          }\n        }\n\n        Store.set(storageKey, collapsedGroups);\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-accept')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n\n        const snapshot = loadSnapshot();\n        const rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = rawData[tableKey].content[rowIndex + 1][colIndex];\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            if (!snapshot[tableKey]) {\n              snapshot[tableKey] = JSON.parse(JSON.stringify(rawData[tableKey]));\n            } else {\n              snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n            }\n          }\n        } else if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          delete snapshot[tableKey];\n        }\n\n        saveSnapshot(snapshot);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n        const oldValue = decodeURIComponent($item.data('old-value') || '');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content[rowIndex + 1][colIndex] = oldValue;\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content) {\n            rawData[tableKey].content[rowIndex + 1] = [...snapshot[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === /===\n    $('.acu-action-restore')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            const restoredRow = [...snapshot[tableKey].content[rowIndex + 1]];\n            if (!rawData[tableKey]) {\n              rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n              rawData[tableKey].content = [snapshot[tableKey].content[0]];\n            }\n            // \n            rawData[tableKey].content.splice(rowIndex + 1, 0, restoredRow);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          if (snapshot[tableKey]) {\n            rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item:not(.acu-validation-error-item) .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const changeType = $item.data('change-type');\n\n        if (!tableKey || rowIndex === undefined) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const sheet = rawData[tableKey];\n        const headers = sheet.content ? sheet.content[0] : [];\n        const row = sheet.content ? sheet.content[rowIndex + 1] : null;\n\n        if (!row) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        if (changeType === 'row_modified') {\n          // \n          showRowCompareEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        } else if (changeType === 'cell_modified') {\n          const colIndex = $item.data('col-index');\n          const headerName = headers[colIndex] || `${colIndex}`;\n          const cellValue = row[colIndex] || '';\n          showChangeSingleFieldModal(cellValue, headerName, sheet.name, rowIndex, colIndex, tableKey);\n        } else {\n          showChangeEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        }\n      });\n\n    // ===  ===\n    $('.acu-batch-accept')\n      .off('click')\n      .on('click', async function () {\n        const rawData = cachedRawData || getTableData();\n        if (!rawData) return;\n\n        // \n        saveSnapshot(JSON.parse(JSON.stringify(rawData)));\n        currentDiffMap = new Set();\n\n        // \n        refreshChangesPanel();\n      });\n\n    // ===  ===\n    $('.acu-batch-reject')\n      .off('click')\n      .on('click', async function () {\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const restoredData = JSON.parse(JSON.stringify(snapshot));\n        cachedRawData = restoredData;\n        await saveDataToDatabase(restoredData, false, false);\n      });\n\n    // ===  ===\n    $('.acu-simple-mode-toggle')\n      .off('click')\n      .on('click', function () {\n        const currentMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        const newMode = !currentMode;\n        Store.set(STORAGE_KEY_VALIDATION_MODE, newMode);\n\n        // \n        const rawData = cachedRawData || getTableData();\n        $('#acu-data-area').html(renderChangesPanel(rawData));\n        bindChangesEvents();\n\n        // \n        updateChangesCount(rawData);\n      });\n\n    // ===  ===\n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          // \n          const finalHeight = $panel.height();\n          const heights = getTableHeights();\n          heights[tableName] = finalHeight;\n          saveTableHeights(heights);\n        };\n      })\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const $panel = $('#acu-data-area');\n        $panel.css('height', ''); // \n        // \n        const heights = getTableHeights();\n        delete heights[tableName];\n        saveTableHeights(heights);\n      });\n\n    // ===  ===\n    const $horizontalScroller = $('.acu-changes-content.acu-changes-horizontal');\n    if ($horizontalScroller.length) {\n      $horizontalScroller[0].addEventListener(\n        'touchstart',\n        function (e) {\n          this._touchStartX = e.touches[0].clientX;\n          this._touchStartY = e.touches[0].clientY;\n          this._scrollDirection = null; // \n        },\n        { passive: true },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchmove',\n        function (e) {\n          if (!this._touchStartX) return;\n\n          const deltaX = Math.abs(e.touches[0].clientX - this._touchStartX);\n          const deltaY = Math.abs(e.touches[0].clientY - this._touchStartY);\n\n          // \n          if (!this._scrollDirection && (deltaX > 5 || deltaY > 5)) {\n            this._scrollDirection = deltaX > deltaY ? 'horizontal' : 'vertical';\n          }\n\n          // \n          // \n          if (this._scrollDirection === 'horizontal' && deltaX > 10) {\n            e.stopPropagation();\n          }\n        },\n        { passive: false },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchend',\n        function () {\n          this._touchStartX = null;\n          this._touchStartY = null;\n          this._scrollDirection = null;\n        },\n        { passive: true },\n      );\n    }\n  };\n\n  // [] \n  const refreshChangesPanel = () => {\n    const { $ } = getCore();\n    const rawData = cachedRawData || getTableData();\n    currentDiffMap = generateDiffMap(rawData);\n\n    const $panel = $('#acu-data-area');\n    if ($panel.length && Store.get('acu_changes_panel_active', false)) {\n      $panel.html(renderChangesPanel(rawData));\n      bindChangesEvents();\n\n      // \n      updateChangesCount(rawData);\n    }\n  };\n\n  // []  + \n  const updateChangesCount = rawData => {\n    const { $ } = getCore();\n    const snapshot = loadSnapshot();\n    let changesCount = 0;\n\n    if (snapshot && rawData) {\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const newSheet = rawData[sheetId];\n        const oldSheet = snapshot[sheetId];\n        if (!newSheet?.content) continue;\n        const newRows = newSheet.content.slice(1);\n        const oldRows = oldSheet?.content?.slice(1) || [];\n        newRows.forEach((row, rowIdx) => {\n          const oldRow = oldRows[rowIdx];\n          if (!oldRow) {\n            changesCount++;\n            return;\n          }\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return;\n            if (String(cell ?? '') !== String(oldRow[colIdx] ?? '')) changesCount++;\n          });\n        });\n        if (oldRows.length > newRows.length) changesCount += oldRows.length - newRows.length;\n      }\n      for (const sheetId in snapshot) {\n        if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n      }\n    }\n\n    // \n    const validationErrorCount = rawData ? ValidationEngine.getErrorCount(rawData) : 0;\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n    const displayCount = isValidationMode ? validationErrorCount : changesCount;\n    // \n    const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n    const $btn = $('#acu-btn-changes');\n    const $span = $btn.find('span');\n    $span.html(displayCount > 0 ? `(${displayCount})` : '');\n\n    // \n    if (showWarningIcon) {\n      if (!$btn.find('.acu-nav-warning-icon').length) {\n        $span.append(' <i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>');\n      }\n      $btn.addClass('has-validation-errors');\n    } else {\n      $btn.find('.acu-nav-warning-icon').remove();\n      $btn.removeClass('has-validation-errors');\n    }\n  };\n  // [] \n  const showChangeEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const inputsHtml = row\n      .map((cell, idx) => {\n        if (idx === 0) return '';\n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        return `\n                <div class=\"acu-card-edit-field\" style=\"margin-bottom: 10px;\">\n                    <label style=\"display:block;font-size:12px;color:var(--acu-accent);font-weight:bold;margin-bottom:4px;\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\"\n                                                        style=\"width:100%;min-height:40px;max-height:500px;padding:10px;resize:none;overflow-y:hidden;\">${escapeHtml(val)}</textarea>                            </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${inputsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-change-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-change-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // [] \n    const adjustHeight = el => {\n      //  auto  0px scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n    };\n    dialog.find('#dlg-change-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    dialog.find('#dlg-change-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n\n        if (hasChanges) {\n          // 1. \n          try {\n            const api = getCore().getDB();\n            if (!api || !api.importTableAsJson) {\n              throw new Error(' API ');\n            }\n\n            const dataToSave = { mate: rawData.mate || { type: 'chatSheets', version: 1 } };\n            Object.keys(rawData).forEach(k => {\n              if (k.startsWith('sheet_')) dataToSave[k] = rawData[k];\n            });\n\n            // \n            let jsonString;\n            try {\n              jsonString = JSON.stringify(dataToSave);\n              //  10MB \n              const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n              if (sizeInMB > 10) {\n                throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n              }\n            } catch (stringifyError) {\n              console.error('[DICE]ACU JSON :', stringifyError);\n              throw new Error(`: ${stringifyError.message || stringifyError}`);\n            }\n\n            //  importTableAsJson saveChat()\n            const result = await api.importTableAsJson(jsonString);\n            //  false \n            if (result === false) {\n              throw new Error(' false');\n            }\n            cachedRawData = rawData;\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            let errorMessage = e.message || '';\n            //  \"Settings could not be saved\" \n            const errorMsg = String(e);\n            if (\n              errorMsg.includes('Settings could not be saved') ||\n              errorMsg.includes('server connection') ||\n              errorMsg.includes('data loss')\n            ) {\n              errorMessage = '';\n            }\n            if (window.toastr) {\n              window.toastr.error(errorMessage, '', { timeOut: 7000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n            // \n            return;\n          }\n\n          // 2. \n          const snapshot = loadSnapshot();\n          if (snapshot && snapshot[tableKey] && snapshot[tableKey].content) {\n            snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n            saveSnapshot(snapshot);\n          }\n\n          // 3.  diffMap \n          currentDiffMap = generateDiffMap(rawData);\n\n          // 4. \n          const $panel = $('#acu-data-area');\n          $panel.html(renderChangesPanel(rawData));\n          bindChangesEvents();\n        }\n      }\n      closeDialog();\n    });\n  };\n  // [] \n  const showChangeSingleFieldModal = (value, headerName, tableName, rowIndex, colIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldValue = snapshot?.[tableKey]?.content?.[rowIndex + 1]?.[colIndex] ?? '';\n    const hasOldValue = oldValue !== '' && String(oldValue) !== String(value);\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:450px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(headerName)}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${\n                          hasOldValue\n                            ? `\n                        <div class=\"acu-diff-section acu-diff-old-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                            </div>\n                            <div class=\"acu-diff-readonly\">${escapeHtml(oldValue)}</div>\n                        </div>\n                        <div class=\"acu-diff-arrow-down\">\n                            <i class=\"fa-solid fa-arrow-down\"></i>\n                        </div>\n                        `\n                            : ''\n                        }\n                        <div class=\"acu-diff-section acu-diff-new-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-pen\"></i> ${hasOldValue ? '' : ''}\n                            </div>\n                            <textarea class=\"acu-change-single-input acu-edit-textarea\" spellcheck=\"false\"\n                                style=\"width:100%;min-height:60px;max-height:300px;padding:12px;resize:none;\">${escapeHtml(value)}</textarea>\n                        </div>\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-single-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        ${hasOldValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"dlg-single-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-single-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const $textarea = dialog.find('.acu-change-single-input');\n    const adjustHeight = () => {\n      $textarea[0].style.height = 'auto';\n      const h = Math.max(60, Math.min($textarea[0].scrollHeight + 2, 300));\n      $textarea[0].style.height = h + 'px';\n    };\n    setTimeout(adjustHeight, 0);\n    $textarea.on('input', adjustHeight);\n    $textarea.focus();\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-single-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    // [] \n    dialog.find('#dlg-single-revert').click(function () {\n      $textarea.val(oldValue).trigger('input');\n    });\n\n    dialog.find('#dlg-single-save').click(async () => {\n      const newVal = $textarea.val();\n      let rawData = cachedRawData || getTableData();\n\n      if (rawData && rawData[tableKey] && rawData[tableKey].content) {\n        const currentRow = rawData[tableKey].content[rowIndex + 1];\n        if (currentRow && String(currentRow[colIndex]) !== String(newVal)) {\n          currentRow[colIndex] = newVal;\n\n          // \n          await saveDataOnly(rawData);\n\n          // \n          const snapshot = loadSnapshot();\n          if (\n            snapshot &&\n            snapshot[tableKey] &&\n            snapshot[tableKey].content &&\n            snapshot[tableKey].content[rowIndex + 1]\n          ) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = newVal;\n            saveSnapshot(snapshot);\n          }\n\n          // \n          currentDiffMap = generateDiffMap(rawData);\n          refreshChangesPanel();\n        }\n      }\n      closeDialog();\n    });\n  };\n\n  // [] \n  const showRowCompareEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldRow = snapshot?.[tableKey]?.content?.[rowIndex + 1] || [];\n\n    // \n    let fieldsHtml = '';\n    for (let idx = 1; idx < headers.length; idx++) {\n      const headerName = headers[idx] || ` ${idx}`;\n      const oldVal = oldRow[idx] ?? '';\n      const newVal = row[idx] ?? '';\n      const isChanged = String(oldVal) !== String(newVal);\n\n      fieldsHtml += `\n                <div class=\"acu-row-edit-field ${isChanged ? 'acu-field-changed' : ''}\">\n                    <div class=\"acu-row-edit-label\">${escapeHtml(headerName)} ${isChanged ? '<span class=\"acu-changed-badge\"></span>' : ''}</div>\n                    ${isChanged ? `<div class=\"acu-row-edit-old\">${escapeHtml(oldVal) || '<span class=\"acu-empty-val\">()</span>'}</div>` : ''}\n                    <textarea class=\"acu-row-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\">${escapeHtml(newVal)}</textarea>\n                </div>\n            `;\n    }\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:550px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(row[1] || ' ' + (rowIndex + 1))}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px; max-height:60vh;\">\n                        ${fieldsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-row-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = Math.min(el.scrollHeight + 2, 200) + 'px';\n    };\n    dialog.find('textarea').each(function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-row-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#dlg-row-revert').click(function () {\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        $(this)\n          .val(oldRow[colIdx] ?? '')\n          .trigger('input');\n      });\n    });\n\n    // \n    dialog.find('#dlg-row-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (!rawData?.[tableKey]?.content?.[rowIndex + 1]) {\n        closeDialog();\n        return;\n      }\n\n      const currentRow = rawData[tableKey].content[rowIndex + 1];\n      let hasChanges = false;\n\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        const newVal = $(this).val();\n        if (String(currentRow[colIdx]) !== String(newVal)) {\n          hasChanges = true;\n          currentRow[colIdx] = newVal;\n        }\n      });\n\n      if (hasChanges) {\n        await saveDataOnly(rawData);\n\n        // \n        const snapshot = loadSnapshot();\n        if (snapshot?.[tableKey]?.content) {\n          snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n          saveSnapshot(snapshot);\n        }\n\n        currentDiffMap = generateDiffMap(rawData);\n        refreshChangesPanel();\n      }\n      closeDialog();\n    });\n  };\n  const renderDashboard = allTables => {\n    console.info('[DICE]...');\n    const config = getConfig();\n\n    // [] \n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const questResult = DashboardDataParser.findTable(allTables, 'quest');\n    const bagResult = DashboardDataParser.findTable(allTables, 'bag');\n    const skillResult = DashboardDataParser.findTable(allTables, 'skill');\n    const equipResult = DashboardDataParser.findTable(allTables, 'equip');\n\n    // []  - \n    let player = { name: '', status: '', position: '', attrs: '', money: '0' };\n    const playerParsed = DashboardDataParser.parseRows(playerResult, 'player');\n\n    if (playerParsed.length > 0) {\n      const p = playerParsed[0];\n      player.name = p.name || '';\n      player.status = p.status || '';\n      player.position = p.position || '';\n      player.money = p.money || '';\n      player.resources = '';\n\n      // [] \n      if (playerResult?.data?.headers && playerResult?.data?.rows?.[0]) {\n        const headers = playerResult.data.headers;\n        const row = playerResult.data.rows[0];\n        let allAttrsStr = '';\n        headers.forEach((h, idx) => {\n          if (h && h.includes('')) {\n            const val = row[idx];\n            if (val) allAttrsStr += (allAttrsStr ? '; ' : '') + val;\n          }\n        });\n        player.attrs = allAttrsStr;\n\n        // \n        headers.forEach((h, idx) => {\n          if (h && (h.includes('') || h.includes(''))) {\n            const val = row[idx];\n            if (val) player.resources = val;\n          }\n        });\n      }\n    }\n\n    // [] HTML\n    const playerRows = playerResult?.data?.rows || [];\n    const playerHeaders = playerResult?.data?.headers || [];\n\n    // []  - \n    let globalDetailLocation = ''; // \n    let globalLocation = ''; // \n\n    if (globalResult?.data?.rows?.length > 0) {\n      const headers = globalResult.data.headers || [];\n      const row = globalResult.data.rows[0];\n\n      // \n      const detailIdx = DashboardDataParser.findColumnIndex(headers, 'detailLocation', globalResult.config);\n      if (detailIdx >= 0 && row[detailIdx]) {\n        globalDetailLocation = row[detailIdx];\n      }\n\n      // \n      const locIdx = DashboardDataParser.findColumnIndex(headers, 'currentLocation', globalResult.config);\n      globalLocation = locIdx >= 0 && row[locIdx] ? row[locIdx] : row[2] || '';\n    }\n\n    // currentPlaceName \n    let currentPlaceName =\n      globalDetailLocation ||\n      globalLocation ||\n      (player.position.includes('-') ? player.position.split('-')[0].trim() : player.position);\n\n    // [] NPC - \n    const npcTableName = npcResult?.name || '';\n    const npcTableKey = npcResult?.key || '';\n\n    const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n\n    // NPC\n    let inSceneNPCs = [];\n    let offSceneNPCs = [];\n    npcParsed.forEach(npc => {\n      const inSceneVal = String(npc.inScene || '').toLowerCase();\n      const npcData = {\n        name: npc.name || '',\n        status: npc.status || '',\n        position: npc.position || '',\n        index: npc._rowIndex,\n      };\n      if (inSceneVal === 'true' || inSceneVal === '') {\n        inSceneNPCs.push(npcData);\n      } else {\n        offSceneNPCs.push(npcData);\n      }\n    });\n    // \n    let allNPCs = [...inSceneNPCs, ...offSceneNPCs];\n\n    // []  -  + \n    const questTableName = questResult?.name || '';\n    const questParsed = DashboardDataParser.parseRows(questResult, 'quest');\n    const activeQuestParsed = DashboardDataParser.applyFilter(questParsed, 'active', 'quest');\n\n    //  >  >  > \n    const questTypeOrder = type => {\n      const t = String(type || '').toLowerCase();\n      if (t.includes('')) return 0;\n      if (t.includes('')) return 1;\n      if (t.includes('')) return 2;\n      return 3;\n    };\n    let activeTasks = activeQuestParsed\n      .map(q => ({\n        name: q.name || '',\n        type: q.type || '',\n        progress: q.progress || '',\n        _rowIndex: q._rowIndex,\n      }))\n      .sort((a, b) => questTypeOrder(a.type) - questTypeOrder(b.type))\n      .slice(0, 5);\n    // []  - \n    const bagTableName = bagResult?.name || '';\n\n    const bagParsed = DashboardDataParser.parseRows(bagResult, 'bag');\n    let bagItems = bagParsed.slice(0, 6).map(item => ({\n      name: item.name || '',\n      count: item.count || '1',\n      type: item.type || '',\n    }));\n\n    // []  - \n    const skillTableName = skillResult?.name || '';\n\n    const skillParsed = DashboardDataParser.parseRows(skillResult, 'skill');\n    let skills = skillParsed.slice(0, 6).map(s => ({\n      name: s.name || '',\n      level: s.level || '',\n      type: s.type || '',\n    }));\n\n    // []  -  + \n    const equipTableName = equipResult?.name || '';\n\n    const equipParsed = DashboardDataParser.parseRows(equipResult, 'equip');\n    const equippedParsed = DashboardDataParser.applyFilter(equipParsed, 'equipped', 'equip');\n\n    let equippedItems = equippedParsed.slice(0, 4).map(e => ({\n      name: e.name || '',\n      type: e.type || '',\n      part: e.part || '',\n    }));\n    // []  - \n    const locationTableName = locationResult?.name || '';\n    const locationTableKey = locationResult?.key || '';\n\n    const locationParsed = DashboardDataParser.parseRows(locationResult, 'location');\n\n    // HTML\n    let html = `\n        <div class=\"acu-panel-header\">\n            <div class=\"acu-panel-title\">\n                <div class=\"acu-title-main\"><i class=\"fa-solid fa-chart-line\"></i> <span class=\"acu-title-text\"></span></div>\n                <div class=\"acu-title-sub\"></div>\n            </div>\n            <div class=\"acu-header-actions\">\n                <div class=\"acu-height-control\">\n                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                </div>\n                <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n        </div>\n        <div class=\"acu-panel-content acu-dashboard-content\">\n            <div class=\"acu-dash-body ${config.layout === 'horizontal' ? 'acu-dash-horizontal' : ''}\">\n            <!--  +  -->\n                <div class=\"acu-dash-player\">\n                    <h3 class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                        data-table-key=\"${playerResult?.key || ''}\"\n                        data-row-index=\"0\"\n                        data-preview-type=\"player\"\n                        style=\"cursor:pointer;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-user-circle\"></i> ${escapeHtml(replaceUserPlaceholders(player.name))}</span>\n                        <span style=\"font-size:11px;font-weight:normal;color:var(--acu-text-main);background:var(--acu-badge-bg);padding:2px 8px;border-radius:10px;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;\" title=\"${escapeHtml(player.status)}\">${escapeHtml(player.status.length > 6 ? player.status.substring(0, 6) + '..' : player.status)}</span>\n                    </h3>\n                    <div class=\"acu-player-status\" style=\"margin-bottom:8px;\">\n                        ${(() => {\n                          // \n                          const resourcesStr = player.resources || player.money || '';\n                          const parsedResources = parseAttributeString(resourcesStr);\n                          if (parsedResources.length > 0) {\n                            return `<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:52px;overflow-y:auto;margin-bottom:6px;padding-bottom:6px;border-bottom:1px dashed var(--acu-border);\">\n                                    ${parsedResources\n                                      .slice(0, 4)\n                                      .map(\n                                        res => `\n                                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;\">\n                                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(res.name)}\">${escapeHtml(res.name.substring(0, 3))}</span>\n                                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                                <span style=\"color:var(--acu-accent);font-size:11px;font-weight:bold;\">${res.value}</span>\n                                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${res.value}\" data-name=\"${escapeHtml(res.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${res.name}(${res.value})\"></i>\n                                            </div>\n                                        </div>\n                                    `,\n                                      )\n                                      .join('')}\n                                </div>`;\n                          }\n                          return '';\n                        })()}\n        ${(() => {\n          // \n          let allAttrs = [];\n          if (playerRows.length > 0 && playerHeaders.length > 0) {\n            const row = playerRows[0];\n            playerHeaders.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!allAttrs.some(a => a.name === attr.name)) {\n                    allAttrs.push(attr);\n                  }\n                });\n              }\n            });\n          }\n\n          if (allAttrs.length > 0) {\n            // 378px\n            return `<div style=\"display:grid;grid-template-columns:repeat(3,1fr);gap:2px 6px;max-height:78px;overflow-y:auto;overflow-x:hidden;\">\n                    ${allAttrs\n                      .map(\n                        attr => `\n                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;\">\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(attr.name)}\">${escapeHtml(attr.name.substring(0, 2))}</span>\n                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                <span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${attr.value}</span>\n                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${attr.value}\" data-name=\"${escapeHtml(attr.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${attr.name}(${attr.value})\"></i>\n                            </div>\n                        </div>\n                    `,\n                      )\n                      .join('')}\n                </div>`;\n          }\n          return '';\n        })()}\n                    </div>\n\n                    <h4 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(skillTableName)}\" style=\"font-size:12px;color:var(--acu-accent);margin:10px 0 6px 0;\"><i class=\"fa-solid fa-bolt\"></i>  (${skillParsed.length})</h4>\n                    <div style=\"display:grid;grid-template-columns:repeat(2,1fr);gap:2px 6px;max-height:78px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      skills.length > 0\n                        ? skills\n                            .map((skill, idx) => {\n                              const skillValue = extractNumericValue(skill.level);\n                              const hasNumeric = skillValue > 0;\n                              const skillRowIndex = skillParsed.findIndex(s => s.name === skill.name);\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${skillResult?.key || ''}\"\n                            data-row-index=\"${skillRowIndex >= 0 ? skillRowIndex : idx}\"\n                            data-preview-type=\"skill\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;cursor:pointer;\">\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(skill.name)}\">${escapeHtml(skill.name.length > 5 ? skill.name.substring(0, 5) + '..' : skill.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                ${\n                                  hasNumeric\n                                    ? `<span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${skillValue}</span>\n                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${skillValue}\" data-name=\"${escapeHtml(skill.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${skill.name}(${skillValue})\"></i>`\n                                    : `<span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(skill.level || '-')}</span>`\n                                }\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div style=\"grid-column:1/-1;text-align:center;color:var(--acu-text-sub);padding:8px;font-size:11px;\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  + NPC -->\n                <div class=\"acu-dash-locations\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(locationTableName)}\" style=\"display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-map\"></i>  (${locationParsed.length})</span>\n                        <i class=\"fa-solid fa-map acu-dash-map-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:100px;overflow-y:auto;overflow-x:hidden;margin-bottom:10px;\">\n                    ${\n                      locationParsed.length > 0\n                        ? locationParsed\n                            .map((loc, idx) => {\n                              const areaName = loc.name || '';\n                              const isCurrent =\n                                currentPlaceName &&\n                                (areaName.includes(currentPlaceName) || currentPlaceName.includes(areaName));\n                              return `<div class=\"acu-location-item acu-dash-clickable acu-dash-preview-trigger ${isCurrent ? 'acu-current-location' : ''}\"\n                            data-table-key=\"${escapeHtml(locationTableKey)}\"\n                            data-row-index=\"${loc._rowIndex}\"\n                            data-preview-type=\"location\">\n                            <span>\n                                ${isCurrent ? '<i class=\"fa-solid fa-location-dot\"></i>' : '<i class=\"fa-solid fa-map-pin\" style=\"font-size:9px;opacity:0.4;\"></i>'}\n                                <span title=\"${escapeHtml(areaName)}\">${escapeHtml(areaName)}</span>\n                            </span>\n                            ${!isCurrent ? `<i class=\"fa-solid fa-walking acu-dash-goto-btn\" data-location=\"${escapeHtml(areaName)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;flex-shrink:0;\" title=\"${areaName}\"></i>` : '<i class=\"fa-solid fa-street-view\" style=\"flex-shrink:0;\" title=\"\"></i>'}\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(npcTableName)}\" style=\"margin-top:10px;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-users\"></i>  (${allNPCs.length})</span>\n                        <span style=\"display:flex;gap:8px;\">\n                            <i class=\"fa-solid fa-project-diagram acu-dash-relation-graph-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                            <i class=\"fa-solid fa-user-circle acu-dash-avatar-manager-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                        </span>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:150px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      allNPCs.length > 0\n                        ? allNPCs\n                            .slice(0, 12)\n                            .map((npc, npcIdx) => {\n                              const isInScene = inSceneNPCs.some(n => n.name === npc.name);\n                              const isLastNpc = npcIdx === Math.min(allNPCs.length, 12) - 1;\n                              const npcAvatar = AvatarManager.get(npc.name);\n                              const avatarOffsetX = AvatarManager.getOffsetX(npc.name);\n                              const avatarOffsetY = AvatarManager.getOffsetY(npc.name);\n                              const avatarScale = AvatarManager.getScale(npc.name);\n                              const avatarStyle = npcAvatar\n                                ? `background-image:url('${npcAvatar}');background-size:${avatarScale}%;background-position:${avatarOffsetX}% ${avatarOffsetY}%;`\n                                : '';\n                              const offSceneFilter = isInScene\n                                ? ''\n                                : 'filter:grayscale(80%) brightness(0.7);opacity:0.5;';\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${escapeHtml(npcTableKey)}\"\n                            data-row-index=\"${npc.index}\"\n                            data-preview-type=\"npc\"\n                            style=\"padding:6px 4px;${!isLastNpc ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <span class=\"acu-task-name\" style=\"font-size:12px;display:flex;align-items:center;gap:6px;\">\n                                    <span class=\"acu-dash-npc-avatar\" style=\"width:22px;height:22px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border:1.5px solid ${isInScene ? 'var(--acu-accent)' : 'var(--acu-border)'};${avatarStyle}${offSceneFilter}\" title=\"${isInScene ? '' : ''}\">\n                                        ${!npcAvatar ? `<span style=\"font-size:10px;font-weight:bold;color:var(--acu-text-sub);${offSceneFilter}\">${escapeHtml(npc.name.charAt(0))}</span>` : ''}\n                                    </span>\n                                    <span title=\"${escapeHtml(npc.name)}\" style=\"${isInScene ? '' : 'opacity:0.6;'}\">${escapeHtml(npc.name.length > 4 ? npc.name.substring(0, 4) + '..' : npc.name)}</span>\n                                </span>\n                                <div style=\"display:flex;align-items:center;\">\n                                    <i class=\"fa-solid fa-people-arrows acu-dash-contest-btn\" data-npc=\"${escapeHtml(npc.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${npc.name}\"></i>\n                                </div>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  +  +  -->\n                <div class=\"acu-dash-intel\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(bagTableName)}\"><i class=\"fa-solid fa-bag-shopping\"></i>  (${bagParsed.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      bagItems.length > 0\n                        ? bagItems\n                            .map((item, idx) => {\n                              const isLastBag = idx === bagItems.length - 1;\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${bagResult?.key || ''}\"\n                            data-row-index=\"${idx}\"\n                            data-preview-type=\"bag\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLastBag ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);flex:1;white-space:nowrap;\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name.length > 4 ? item.name.substring(0, 4) + '..' : item.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:6px;\">\n                                <i class=\"fa-solid fa-hand-pointer acu-dash-use-item-btn\" data-item=\"${escapeHtml(item.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${item.name}\"></i>\n                                <span style=\"color:var(--acu-accent);font-weight:bold;\">${escapeHtml(item.count)}</span>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(equipTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-shield-halved\"></i>  (${equippedItems.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      equippedItems.length > 0\n                        ? equippedItems\n                            .map((item, idx) => {\n                              const isLast = idx === equippedItems.length - 1;\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${equipResult?.key || ''}\"\n                            data-row-index=\"${equipParsed.findIndex(r => r.name === item.name)}\"\n                            data-preview-type=\"equipment\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLast ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name.length > 5 ? item.name.substring(0, 5) + '..' : item.name)}</span>\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(item.part || item.type)}</span>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(questTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-clipboard-list\"></i>  (${activeTasks.length})</h3>\n                    ${\n                      activeTasks.length > 0\n                        ? activeTasks\n                            .map((t, idx) => {\n                              const isMain = String(t.type || '').includes('');\n                              // \n                              let progressPercent = null;\n                              const progressMatch = String(t.progress || '').match(/(\\d+)\\s*%/);\n                              if (progressMatch) {\n                                progressPercent = Math.min(100, Math.max(0, parseInt(progressMatch[1], 10)));\n                              }\n                              const progressBar =\n                                progressPercent !== null\n                                  ? `<div style=\"width:40px;height:4px;background:var(--acu-border);border-radius:2px;overflow:hidden;\"><div style=\"width:${progressPercent}%;height:100%;background:var(--acu-accent);\"></div></div>`\n                                  : '';\n                              return `<div class=\"acu-task-item acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${questResult?.key || ''}\"\n                            data-row-index=\"${t._rowIndex !== undefined ? t._rowIndex : questParsed.findIndex(q => q.name === t.name)}\"\n                            data-preview-type=\"quest\"\n                            style=\"padding:4px 8px;margin-bottom:3px;cursor:pointer;\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <div class=\"acu-task-name\" style=\"font-size:11px;${isMain ? 'font-weight:600;' : ''}\">${escapeHtml(t.name)}</div>\n                                ${progressBar}\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                </div>\n            </div>\n    `;\n\n    // \n    const loadedModules = [\n      globalResult ? '' : null,\n      playerResult ? '' : null,\n      locationResult ? '' : null,\n      npcResult ? 'NPC' : null,\n      questResult ? '' : null,\n      bagResult ? '' : null,\n      skillResult ? '' : null,\n      equipResult ? '' : null,\n    ].filter(Boolean);\n\n    console.info(`[DICE]${loadedModules.length}: ${loadedModules.join(', ')}`);\n    return html;\n  };\n\n  const renderTableContent = (tableData, tableName) => {\n    if (!tableData || !tableData.rows.length)\n      return `\n            <div class=\"acu-panel-header\"><div class=\"acu-panel-title\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${tableName}</div><button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button></div>\n            <div class=\"acu-panel-content\"><div style=\"text-align:center;color:var(--acu-text-sub);padding:20px;\"></div></div>`;\n\n    const config = getConfig();\n    const pendingDeletions = getPendingDeletions()[tableData.key] || [];\n    const headers = (tableData.headers || []).slice(1);\n\n    //  ( list)\n    const currentStyle = (getTableStyles() || {})[tableName] || 'list';\n    const isGridMode = currentStyle === 'grid';\n\n    let titleColIndex = 1;\n    if (tableData.headers.length === 1) {\n      titleColIndex = 0;\n    } else if (tableName.includes('') || tableName.includes('')) {\n      const idx = tableData.headers.findIndex(\n        h => h && (h.includes('') || h.includes('') || h.includes('')),\n      );\n      if (idx > 0) titleColIndex = idx;\n    }\n\n    // ---  ---\n    let processedRows = tableData.rows.map((row, index) => {\n      const rowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n      const isBookmarked = rowKey && BookmarkManager.isBookmarked(tableName, rowKey);\n      return { data: row, originalIndex: index, rowKey, isBookmarked };\n    });\n    const searchTerm = (tableSearchStates[tableName] || '').toLowerCase().trim();\n\n    // \n    const isReversed = isTableReversed(tableName);\n\n    if (searchTerm) {\n      processedRows = processedRows.filter(item =>\n        item.data.some(cell => String(cell).toLowerCase().includes(searchTerm)),\n      );\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        const titleA = String(a.data[titleColIndex] || '').toLowerCase();\n        const titleB = String(b.data[titleColIndex] || '').toLowerCase();\n        const aHitTitle = titleA.includes(searchTerm);\n        const bHitTitle = titleB.includes(searchTerm);\n        if (titleA === searchTerm && titleB !== searchTerm) return -1;\n        if (titleA !== searchTerm && titleB === searchTerm) return 1;\n        if (aHitTitle && !bHitTitle) return -1;\n        if (!aHitTitle && bHitTitle) return 1;\n        return a.originalIndex - b.originalIndex;\n      });\n    } else {\n      // \n      // bookmark\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        if (isReversed) {\n          return b.originalIndex - a.originalIndex;\n        } else {\n          return a.originalIndex - b.originalIndex;\n        }\n      });\n    }\n\n    const itemsPerPage = config.itemsPerPage || 50;\n    const totalItems = processedRows.length;\n    const totalPages = Math.ceil(totalItems / itemsPerPage) || 1;\n    let currentPage = tablePageStates[tableName] || 1;\n    if (currentPage > totalPages) currentPage = totalPages;\n    if (currentPage < 1) currentPage = 1;\n    tablePageStates[tableName] = currentPage;\n\n    const startIdx = (currentPage - 1) * itemsPerPage;\n    const endIdx = startIdx + itemsPerPage;\n    const rowsToRender = processedRows.slice(startIdx, endIdx);\n    // []    \n    // \n    const showReverseBtn = shouldShowReverseButton(tableName);\n    const reverseBtnHtml = showReverseBtn\n      ? `\n            <button class=\"acu-view-btn acu-reverse-btn\" data-table=\"${escapeHtml(tableName)}\" title=\"${isReversed ? '' : ''}\">\n                <i class=\"fa-solid ${isReversed ? 'fa-sort-amount-up' : 'fa-sort-amount-down'}\"></i>\n            </button>\n        `\n      : '';\n\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n    <div class=\"acu-title-main\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> <span class=\"acu-title-text\">${escapeHtml(tableName)}</span></div>\n    <div class=\"acu-title-sub\">(${startIdx + 1}-${Math.min(endIdx, totalItems)} / ${totalItems})${isReversed ? ' <span style=\"color:var(--acu-accent);\"></span>' : ''}</div>\n</div>\n                <div class=\"acu-header-actions\">\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn\" id=\"acu-btn-relation-graph\" data-table=\"${escapeHtml(tableName)}\" title=\"\"><i class=\"fa-solid fa-project-diagram\"></i></button>` : ''}\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn acu-table-map-btn\" title=\"\"><i class=\"fa-solid fa-map\"></i></button>` : ''}\n                    ${reverseBtnHtml}\n                    <button class=\"acu-view-btn\" id=\"acu-btn-switch-style\" data-table=\"${escapeHtml(tableName)}\" title=\"  (: ${isGridMode ? '' : ''})\">\n                        <i class=\"fa-solid ${isGridMode ? 'fa-th-large' : 'fa-list'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${escapeHtml(tableName)}\" title=\"  | \"></i>\n                    </div>\n\n                    <div class=\"acu-search-wrapper\"><i class=\"fa-solid fa-search acu-search-icon\"></i><input type=\"text\" class=\"acu-search-input\" placeholder=\"...\" value=\"${(tableSearchStates[tableName] || '').replace(/\"/g, '&quot;')}\" /></div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>\n            <div class=\"acu-panel-content\"><div class=\"acu-card-grid\">`;\n\n    html += rowsToRender\n      .map(item => {\n        const realRowIdx = item.originalIndex;\n        const row = item.data;\n        const isPending = pendingDeletions.includes(realRowIdx);\n        const cardTitle = row[titleColIndex] || '';\n        const showDefaultIndex = titleColIndex === 1;\n        const titleCellId = `${tableData.key}-${realRowIdx}-${titleColIndex}`;\n        const isTitleModified = window.acuModifiedSet && window.acuModifiedSet.has(titleCellId);\n        const isRowNew = currentDiffMap.has(`${tableName}-row-${realRowIdx}`);\n        let rowClass = '';\n        if (config.highlightNew) {\n          if (isTitleModified) rowClass = 'acu-highlight-manual';\n          else if (isRowNew) rowClass = 'acu-highlight-diff';\n        }\n\n        // \n        const validColIndices = row.map((_, i) => i).filter(i => i > 0 && i !== titleColIndex);\n        const isOddValidCount = validColIndices.length % 2 === 1;\n\n        const cardBody = row\n          .map((cell, cIdx) => {\n            if (cIdx <= 0 || cIdx === titleColIndex) return '';\n            // [] \"\"\n            const currentHeader = headers[cIdx - 1] || '';\n            if (currentHeader.includes('')) return '';\n            const isLastValidCol = cIdx === validColIndices[validColIndices.length - 1];\n            const spanFullRow = isLastValidCol && isOddValidCount;\n            // /\n            const rawHeaderName = headers[cIdx - 1] || '' + cIdx;\n\n            // [] \n            const lockRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n            const isThisFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, headers[cIdx - 1]);\n            const inlineLockIcon = isThisFieldLocked\n              ? '<i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:10px;opacity:0.7;margin-left:4px;\" title=\"\"></i>'\n              : '';\n\n            const headerName = rawHeaderName.replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n            const safeStr = str =>\n              String(str)\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#039;');\n            const rawStrOriginal = String(cell).trim();\n            const rawStr = replaceUserPlaceholders(rawStrOriginal);\n            const invalidPlaceholders = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n            if (invalidPlaceholders.includes(rawStr.toLowerCase())) {\n              return ''; // \n            }\n\n            let contentHtml = '';\n            let hideLabel = false; // \n            const splitRegex = /[;]/;\n\n            // [] \n            const isIdentityField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return lowerHeader.includes('');\n            };\n\n            const isAttributeField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return (\n                lowerHeader.includes('') || lowerHeader.includes('') || lowerHeader.includes('')\n              );\n            };\n\n            //  ( \":92\"  \":92, :88\")\n            // [] \n            const parsedAttrs = isIdentityField(rawHeaderName) ? [] : parseAttributeString(rawStr);\n            // [] \n            if (isIdentityField(rawHeaderName)) {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            } else if (isRelationshipCell(rawStr, headerName)) {\n              // [] \n              const relations = parseRelationshipString(rawStr);\n              // [] \n              const validRelations = relations.filter(rel => {\n                if (!rel.relation) return true; // \n                return !invalidPlaceholders.includes(rel.relation.toLowerCase());\n              });\n\n              if (validRelations.length > 1) {\n                hideLabel = true;\n                let relHtml = '';\n                for (let i = 0; i < validRelations.length; i++) {\n                  const rel = validRelations[i];\n                  const borderStyle =\n                    i < validRelations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                  relHtml += '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;' + borderStyle + '\">';\n                  relHtml +=\n                    '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' +\n                    safeStr(rel.name) +\n                    inlineLockIcon +\n                    '</span>';\n                  if (rel.relation) {\n                    relHtml +=\n                      '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                      safeStr(rel.relation) +\n                      '</span>';\n                  }\n                  relHtml += '</div>';\n                }\n                contentHtml = '<div class=\"acu-relation-container\">' + relHtml + '</div>';\n              } else if (validRelations.length === 1) {\n                hideLabel = true;\n                const rel = validRelations[0];\n                contentHtml = '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;\">';\n                contentHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' +\n                  safeStr(rel.name) +\n                  inlineLockIcon +\n                  '</span>';\n                if (rel.relation) {\n                  contentHtml +=\n                    '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                    safeStr(rel.relation) +\n                    '</span>';\n                }\n                contentHtml += '</div>';\n              }\n            } else if (parsedAttrs.length > 1) {\n              // 2\n              hideLabel = true;\n              let attrsHtml = '';\n              for (let i = 0; i < parsedAttrs.length; i++) {\n                const attr = parsedAttrs[i];\n                const showDice = !BlacklistManager.isBlacklisted(attr.name);\n                attrsHtml +=\n                  '<div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 0;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.9em;white-space:nowrap;\" title=\"' +\n                  safeStr(attr.name) +\n                  '\">' +\n                  safeStr(attr.name.length > 3 ? attr.name.substring(0, 5) : attr.name) +\n                  inlineLockIcon +\n                  '</span>';\n                attrsHtml += '<div style=\"display:flex;align-items:center;gap:4px;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-main);font-weight:bold;font-size:0.95em;\">' +\n                  attr.value +\n                  '</span>';\n                if (showDice) {\n                  attrsHtml +=\n                    '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                    safeStr(attr.name) +\n                    '\" data-attr-value=\"' +\n                    attr.value +\n                    '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:10px;\" title=\"\"></i>';\n                }\n                attrsHtml += '</div></div>';\n              }\n              contentHtml = '<div class=\"acu-multi-attr-container\">' + attrsHtml + '</div>';\n            } else if (parsedAttrs.length === 1) {\n              //  ( \":92\") - \n              hideLabel = true;\n              const attr = parsedAttrs[0];\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml +=\n                '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' +\n                safeStr(attr.name) +\n                inlineLockIcon +\n                '</span>';\n              contentHtml += '<div style=\"display:flex;align-items:center;gap:6px;\">';\n              contentHtml += '<span style=\"color:var(--acu-text-main);font-weight:bold;\">' + attr.value + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(attr.name) +\n                  '\" data-attr-value=\"' +\n                  attr.value +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div></div>';\n            } else if (rawStr.length > 0 && splitRegex.test(rawStr) && !rawStr.includes('http')) {\n              // [] \n              const invalidTagValues = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n              const parts = rawStr\n                .split(splitRegex)\n                .map(s => s.trim())\n                .filter(s => s && !invalidTagValues.includes(s.toLowerCase()));\n              const allShort = parts.length > 1 && parts.every(p => p.length <= 6);\n              if (allShort) {\n                const tagsHtml = parts\n                  .map(part => {\n                    const subStyle = getBadgeStyle(part) || 'acu-badge-neutral';\n                    return '<span class=\"acu-badge ' + subStyle + '\">' + safeStr(part) + '</span>';\n                  })\n                  .join('');\n                contentHtml = '<div class=\"acu-tag-container\">' + tagsHtml + '</div>';\n              } else if (parts.length > 0) {\n                // \n                contentHtml = safeStr(parts.join('; '));\n              } else {\n                // \n                contentHtml = '';\n              }\n            } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n              // \n              const numVal = extractNumericValue(rawStr);\n              const showDice = !BlacklistManager.isBlacklisted(headerName);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml += '<span>' + safeStr(rawStr) + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(headerName) +\n                  '\" data-attr-value=\"' +\n                  numVal +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div>';\n            } else {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            }\n\n            const isDiffChanged = currentDiffMap.has(tableName + '-' + realRowIdx + '-' + cIdx);\n            const cellId = tableData.key + '-' + realRowIdx + '-' + cIdx;\n            const isUserModified = window.acuModifiedSet && window.acuModifiedSet.has(cellId);\n            let cellHighlight = '';\n            if (config.highlightNew) {\n              if (isUserModified) cellHighlight = 'acu-highlight-manual';\n              else if (isDiffChanged) cellHighlight = 'acu-highlight-diff';\n            }\n\n            //  class\n            //  ()\n\n            const rowClass =\n              'acu-card-row acu-cell' +\n              (spanFullRow ? ' acu-grid-span-full' : '') +\n              (hideLabel ? ' acu-hide-label' : '');\n\n            return (\n              '<div class=\"' +\n              rowClass +\n              '\" data-key=\"' +\n              escapeHtml(tableData.key) +\n              '\" data-tname=\"' +\n              escapeHtml(tableName) +\n              '\" data-row=\"' +\n              realRowIdx +\n              '\" data-col=\"' +\n              cIdx +\n              '\" data-val=\"' +\n              encodeURIComponent(cell ?? '') +\n              '\"><div class=\"acu-card-label\">' +\n              headerName +\n              inlineLockIcon +\n              '</div><div class=\"acu-card-value ' +\n              cellHighlight +\n              '\">' +\n              contentHtml +\n              '</div></div>'\n            );\n          })\n          .join('');\n\n        // []  acu-card-body  view-grid  view-list \n        // []  tableData.headers  slice  headers getInteractOptionsForRow \n        const tableActions = getInteractOptionsForRow(tableName, tableData.headers, row);\n        let actionsHtml = '';\n\n        if (tableActions.length > 0) {\n          const cardTitle = row[titleColIndex] || '';\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardLockRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n        const isCardRowLocked = cardLockRowKey && LockManager.isRowLocked(tableName, cardLockRowKey);\n        const cardLockIcon = isCardRowLocked\n          ? ' <i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:11px;opacity:0.8;\" title=\"\"></i>'\n          : '';\n\n        // bookmark\n        const cardBookmarkRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n        const isBookmarked = cardBookmarkRowKey && BookmarkManager.isBookmarked(tableName, cardBookmarkRowKey);\n        const bookmarkIcon = cardBookmarkRowKey\n          ? `<i class=\"${isBookmarked ? 'fa-solid' : 'fa-regular'} fa-bookmark acu-bookmark-icon ${isBookmarked ? 'bookmarked' : ''}\" data-table=\"${escapeHtml(tableName)}\" data-row-key=\"${escapeHtml(cardBookmarkRowKey)}\" title=\"${isBookmarked ? '' : ''}\"></i>`\n          : '';\n\n        return `<div class=\"acu-data-card ${isPending ? 'pending-deletion' : ''}\"><div class=\"acu-card-header\"><span class=\"acu-card-index\">${showDefaultIndex ? '#' + (realRowIdx + 1) : ''}</span><span class=\"acu-cell acu-editable-title ${rowClass}\" data-key=\"${escapeHtml(tableData.key)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(cardTitle ?? '')}\" title=\"\">${escapeHtml(cardTitle)}${cardLockIcon}</span>${bookmarkIcon}</div><div class=\"acu-card-body ${isGridMode ? 'view-grid' : 'view-list'}\">${cardBody}</div>${actionsHtml}</div>`;\n      })\n      .join('');\n    html += `</div></div>`;\n\n    if (totalPages > 1) {\n      html += `<div class=\"acu-panel-footer\"><button class=\"acu-page-btn ${currentPage === 1 ? 'disabled' : ''}\" data-page=\"${currentPage - 1}\" ${currentPage === 1 ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-left\"></i></button>`;\n      const range = [];\n      if (totalPages <= 7) {\n        for (let i = 1; i <= totalPages; i++) range.push(i);\n      } else {\n        if (currentPage <= 4) range.push(1, 2, 3, 4, 5, '...', totalPages);\n        else if (currentPage >= totalPages - 3)\n          range.push(1, '...', totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1, totalPages);\n        else range.push(1, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages);\n      }\n      range.forEach(p => {\n        if (p === '...') html += `<span class=\"acu-page-info\">...</span>`;\n        else html += `<button class=\"acu-page-btn ${p === currentPage ? 'active' : ''}\" data-page=\"${p}\">${p}</button>`;\n      });\n      html += `<button class=\"acu-page-btn ${currentPage === totalPages ? 'disabled' : ''}\" data-page=\"${currentPage + 1}\" ${currentPage === totalPages ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-right\"></i></button></div>`;\n    }\n    return html;\n  };\n\n  // []  ( + )\n  const saveCurrentTabState = () => {\n    const { $ } = getCore();\n    const activeTab = getActiveTabState();\n    const $content = $('.acu-panel-content');\n\n    if (activeTab && $content.length) {\n      const innerScrolls = {};\n      // \n      $content.find('.acu-data-card, .acu-card-body, .acu-edit-textarea').each(function () {\n        if (this.scrollTop > 0) {\n          //  (Row Index)\n          const $card = $(this).closest('.acu-data-card');\n          const rIdx = $card.find('.acu-editable-title').data('row');\n          // \n          const isEdit = $(this).hasClass('acu-edit-textarea');\n\n          if (rIdx !== undefined) {\n            const key = isEdit ? `edit-${rIdx}` : rIdx;\n            innerScrolls[key] = this.scrollTop;\n          }\n        }\n      });\n\n      // \n      tableScrollStates[activeTab] = {\n        left: $content.scrollLeft(),\n        top: $content.scrollTop(),\n        inner: innerScrolls,\n        timestamp: Date.now(), // \n      };\n    }\n  };\n\n  const closePanel = () => {\n    const { $ } = getCore();\n    saveCurrentTabState(); // <--- \n\n    $('#acu-data-area').removeClass('visible');\n    $('.acu-nav-btn').removeClass('active');\n    saveActiveTabState(null);\n    // [] \n    // $('.acu-embedded-options-container').remove();\n  };\n\n  /**\n   *  - \n   * CSS opacity + visibility \n   * @param {Function} updateContentFn -  $panel \n   */\n  const switchPanel = updateContentFn => {\n    const { $ } = getCore();\n    const $panel = $('#acu-data-area');\n    const isVisible = $panel.hasClass('visible');\n\n    if (!isVisible) {\n      // \n      updateContentFn($panel);\n      $panel.addClass('visible');\n    } else {\n      // CSS transition \n      updateContentFn($panel);\n    }\n  };\n\n  const bindEvents = tables => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    // [] -\n    $wrapper.on('click', '.acu-dash-relation-graph-btn', function (e) {\n      e.stopPropagation();\n      const allTables = processJsonData(cachedRawData || getTableData());\n      const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n      if (npcResult && npcResult.data) {\n        showRelationshipGraph(npcResult.data);\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-map-btn', function (e) {\n      e.stopPropagation();\n      showMapVisualization();\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-avatar-manager-btn', function (e) {\n      e.stopPropagation();\n\n      try {\n        // \n        let allTables;\n        try {\n          const rawData = cachedRawData || getTableData();\n          allTables = processJsonData(rawData);\n        } catch (dataError) {\n          console.error(':', dataError);\n          throw new Error('');\n        }\n\n        if (!allTables || allTables.length === 0) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n        const playerResult = DashboardDataParser.findTable(allTables, 'player');\n\n        const nodeArr = [];\n\n        // \n        if (playerResult?.data?.rows?.[0]) {\n          const playerName = playerResult.data.rows[0][1];\n          if (playerName && typeof playerName === 'string' && playerName.trim()) {\n            nodeArr.push({ name: playerName.trim(), isPlayer: true });\n          }\n        }\n\n        // NPC\n        if (npcResult?.data?.rows && Array.isArray(npcResult.data.rows)) {\n          npcResult.data.rows.forEach((row, idx) => {\n            if (Array.isArray(row) && row[1]) {\n              const npcName = row[1];\n              if (typeof npcName === 'string' && npcName.trim()) {\n                nodeArr.push({ name: npcName.trim(), isPlayer: false, rowIndex: idx });\n              }\n            }\n          });\n        }\n\n        // \n        if (nodeArr.length === 0) {\n          if (window.toastr) {\n            window.toastr.warning('NPC');\n          }\n          return;\n        }\n\n        // \n        try {\n          showAvatarManager(nodeArr, () => renderInterface());\n        } catch (managerError) {\n          console.error('showAvatarManager :', managerError);\n          throw new Error('');\n        }\n      } catch (error) {\n        // \n        console.error(':', error);\n\n        // \n        const errorMsg = error instanceof Error ? error.message : '';\n        if (window.toastr) {\n          window.toastr.error(`: ${errorMsg}`);\n        }\n      }\n    });\n    // \n    $wrapper.on('click', '.acu-dash-table-link', function (e) {\n      e.stopPropagation();\n      const tableName = $(this).data('table');\n      if (tableName) {\n        Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        saveActiveTabState(tableName);\n        renderInterface();\n      }\n    });\n\n    // []  SillyTavern\"\"\n    $('.acu-panel-content')\n      .off('touchstart.acu_swipe touchmove.acu_swipe')\n      .on('touchstart.acu_swipe', function (e) {\n        this._touchStartX = e.originalEvent.touches[0].clientX;\n        this._touchStartY = e.originalEvent.touches[0].clientY;\n      })\n      .on('touchmove.acu_swipe', function (e) {\n        if (!this._touchStartX) return;\n        const deltaX = Math.abs(e.originalEvent.touches[0].clientX - this._touchStartX);\n        const deltaY = Math.abs(e.originalEvent.touches[0].clientY - this._touchStartY);\n        // 45\n        if (deltaX > deltaY && deltaX > 10) {\n          e.stopPropagation();\n        }\n      });\n\n    $('body')\n      .off('click.acu_nav_toggle')\n      .on('click.acu_nav_toggle', '.acu-nav-toggle-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        const currentState = getCollapsedState();\n        saveCollapsedState(!currentState);\n        renderInterface();\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_opt_toggle')\n      .on('click.acu_opt_toggle', '.acu-opt-header[data-action=\"toggle-options\"]', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const currentState = getOptionsCollapsedState();\n        saveOptionsCollapsedState(!currentState);\n        renderInterface();\n      });\n\n    const $panel = $('.acu-panel-content');\n    if ($panel.length) {\n      // [] \n      let scrollTimer = null;\n      $panel.off('scroll.acu_save').on('scroll.acu_save', function () {\n        const $this = $(this);\n        if (scrollTimer) clearTimeout(scrollTimer);\n        scrollTimer = setTimeout(() => {\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            if (!tableScrollStates[activeTab]) tableScrollStates[activeTab] = { top: 0, left: 0, inner: {} };\n            tableScrollStates[activeTab].top = $this.scrollTop();\n            tableScrollStates[activeTab].left = $this.scrollLeft();\n            // \n          }\n        }, 200);\n      });\n    }\n\n    $('body')\n      .off('click.acu_delegate')\n      .on('click.acu_delegate', '.acu-wrapper', function (e) {\n        if (isEditingOrder) return;\n        const $target = $(e.target);\n\n        // []  - \n        const $settingsBtn = $target.closest('#acu-btn-settings');\n        if ($settingsBtn.length) {\n          e.stopPropagation();\n          e.preventDefault();\n          showSettingsModal();\n          return;\n        }\n\n        const $navBtn = $target.closest('.acu-nav-btn');\n        if ($navBtn.length) {\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-dashboard') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isDashboardActive && isPanelVisible) {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, true);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                const rawData = cachedRawData || getTableData();\n                const tables = processJsonData(rawData || {});\n                $panel.html(renderDashboard(tables));\n                bindEvents(tables);\n              });\n            }\n            return false;\n          }\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-changes') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isChangesActive = Store.get('acu_changes_panel_active', false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isChangesActive && isPanelVisible) {\n              // \n              Store.set('acu_changes_panel_active', false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set('acu_changes_panel_active', true);\n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                const rawData = cachedRawData || getTableData();\n                $panel.html(renderChangesPanel(rawData));\n                bindChangesEvents();\n              });\n            }\n            return false;\n          }\n          // [] MVU\n          if ($navBtn.attr('id') === 'acu-btn-mvu') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isMvuActive && isPanelVisible) {\n              // \n              saveActiveTabState(null);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              Store.set('acu_changes_panel_active', false);\n              saveActiveTabState(MvuModule.MODULE_ID);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                try {\n                  const panelHtml = MvuModule.renderPanel();\n                  // \n                  const mvuSavedHeight = getTableHeights()[MvuModule.MODULE_ID];\n                  if (mvuSavedHeight) {\n                    $panel.css('height', mvuSavedHeight + 'px').addClass('acu-manual-mode');\n                  } else {\n                    $panel.css('height', '').removeClass('acu-manual-mode');\n                  }\n                  $panel.html('<div class=\"acu-mvu-panel\">' + panelHtml + '</div>');\n                  MvuModule.bindEvents($panel);\n                } catch (error) {\n                  console.error('[MVU] Error rendering panel:', error);\n                }\n\n                // \n                MvuModule.getDataWithRetry(5, 800)\n                  .then(mvuData => {\n                    // \n                    if (mvuData) {\n                      $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                      MvuModule.bindEvents($panel);\n                    }\n                  })\n                  .catch(err => {\n                    console.error('[DICE]MvuModule Error getting data:', err);\n                    // \n                    $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                    MvuModule.bindEvents($panel);\n                  });\n              });\n            }\n            return false;\n          }\n          e.stopPropagation();\n          // [] \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          Store.set('acu_changes_panel_active', false);\n          const tableName = $navBtn.data('table');\n          const currentActiveTab = getActiveTabState();\n          if (currentActiveTab === tableName && $('#acu-data-area').hasClass('visible')) {\n            closePanel();\n            return;\n          }\n          $('.acu-nav-btn').removeClass('active');\n          $navBtn.addClass('active');\n          if ($('.acu-panel-content').length && currentActiveTab) {\n            saveCurrentTabState();\n          }\n          saveActiveTabState(tableName);\n          setTimeout(() => renderInterface(), 0);\n          return;\n        }\n        const $cell = $target.closest('.acu-cell');\n        if ($cell.length) {\n          e.stopPropagation();\n          showCellMenu(e, $cell[0]);\n          return;\n        }\n        const $pageBtn = $target.closest('.acu-page-btn');\n        if ($pageBtn.length) {\n          e.stopPropagation();\n          if ($pageBtn.hasClass('disabled') || $pageBtn.hasClass('active')) return;\n          const newPage = parseInt($pageBtn.data('page'));\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tablePageStates[activeTab] = newPage;\n            renderInterface();\n            requestAnimationFrame(() => {\n              $('.acu-panel-content').scrollTop(0);\n            });\n          }\n          return;\n        }\n        return;\n      });\n\n    $('#acu-btn-expand')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(false);\n        renderInterface();\n      });\n    // [] \n    $('#acu-btn-collapse')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(true);\n        renderInterface();\n      });\n\n    // []  =  (Instant Revert)\n    $('#acu-btn-refresh')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n\n        // [] \n        if (isEditingOrder) return;\n\n        // 1. \n        if (isSaving) {\n          if (window.toastr) window.toastr.warning(' ...');\n          return;\n        }\n\n        const $btn = $(e.currentTarget);\n        const $icon = $btn.find('i');\n        // $icon.addClass('fa-spin'); // \n\n        // 2.  ()\n        // (1) \n        savePendingDeletions({});\n\n        // (2)  -> \n        cachedRawData = null;\n\n        // (3) \n        hasUnsavedChanges = false;\n        currentDiffMap.clear();\n        if (window.acuModifiedSet) window.acuModifiedSet.clear();\n\n        // (4)  ()\n        const $saveBtn = $('#acu-btn-save-global');\n        $saveBtn.find('i').removeClass('acu-icon-breathe');\n        $saveBtn.attr('title', '').css('color', '');\n\n        // 3.  300ms \n        // await new Promise(r => setTimeout(r, 300)); // <--- \n\n        // Last SnapshotAPI\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          cachedRawData = snapshot; // \n        }\n\n        // 4. \n        // \n        $('.acu-edit-overlay, .acu-cell-menu, .acu-menu-backdrop').remove();\n\n        // \n        renderInterface();\n\n        // $icon.removeClass('fa-spin');\n      });\n\n    // [] \n    $('#acu-btn-force-update')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          if (window.toastr) {\n            window.toastr.warning('  manualUpdate ', '', {\n              timeOut: 5000,\n            });\n          }\n        }\n      });\n    $('body')\n      .off('click.acu_settings')\n      .on('click.acu_settings', '#acu-btn-settings', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        showSettingsModal();\n      });\n    // [] \n    $('#acu-btn-dice-nav')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        showDicePanel({\n          targetValue: null,\n          targetName: '',\n          //  diceType\n        });\n      });\n\n    /* // \n    $('#acu-btn-open-editor').off('click').on('click', (e) => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.openVisualizer === 'function') {\n            api.openVisualizer();\n        } else if (window.toastr) {\n            window.toastr.warning('()');\n        }\n    });\n    */\n\n    // \n    $('#acu-btn-refill')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            console.log('[DICE]ACU ');\n            //  manualUpdate \n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          console.warn('[DICE]ACU manualUpdate API ');\n          if (window.toastr) {\n            window.toastr.warning(' manualUpdate ', '', { timeOut: 3000 });\n          }\n        }\n      });\n    $('#acu-btn-save-global')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        let dataToSave = null;\n        if (hasUnsavedChanges && cachedRawData) {\n          dataToSave = cachedRawData;\n        } else {\n          dataToSave = getTableData();\n        }\n\n        if (dataToSave) {\n          // 1.  false  true\n          await saveDataToDatabase(dataToSave, true, true);\n\n          // 2. \n          // \n          $('.acu-highlight-manual').removeClass('acu-highlight-manual');\n\n          // 3. \n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          hasUnsavedChanges = false;\n\n          // 4. \n          const $btn = $(this);\n          const $icon = $btn.find('i');\n          $icon.removeClass('acu-icon-breathe fa-spinner fa-spin').addClass('fa-save');\n          $btn.attr('title', '').css('color', '');\n          $btn.prop('disabled', false);\n\n          // 5. \n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    const $searchInput = $('.acu-search-input');\n    if ($searchInput.length) {\n      let searchTimeout;\n      let isComposing = false;\n      $searchInput\n        .off('compositionstart compositionend input')\n        .on('compositionstart', () => {\n          isComposing = true;\n        })\n        .on('compositionend', function () {\n          isComposing = false;\n          const val = $(this).val();\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tableSearchStates[activeTab] = val;\n            tablePageStates[activeTab] = 1;\n            renderInterface();\n            setTimeout(() => {\n              $('.acu-search-input').focus();\n            }, 0);\n          }\n        })\n        .on('input', function () {\n          if (isComposing) return;\n          const val = $(this).val();\n          const selectionStart = this.selectionStart;\n          const selectionEnd = this.selectionEnd;\n          clearTimeout(searchTimeout);\n          searchTimeout = setTimeout(() => {\n            const activeTab = getActiveTabState();\n            if (activeTab) {\n              tableSearchStates[activeTab] = val;\n              tablePageStates[activeTab] = 1;\n              const isFocus = document.activeElement && document.activeElement.classList.contains('acu-search-input');\n              renderInterface();\n              if (isFocus) {\n                const $newInput = $('.acu-search-input');\n                $newInput.focus();\n                if ($newInput.length && $newInput[0].setSelectionRange) {\n                  try {\n                    $newInput[0].setSelectionRange(selectionStart, selectionEnd);\n                  } catch (e) {}\n                }\n              }\n            }\n          }, 300);\n        });\n    }\n    // \n    $('#acu-btn-relation-graph')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const rawData = cachedRawData || getTableData();\n        if (rawData) {\n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (sheet?.name === tableName) {\n              const tableData = {\n                headers: sheet.content?.[0] || [],\n                rows: sheet.content?.slice(1) || [],\n                key: key,\n              };\n              showRelationshipGraph(tableData);\n              return;\n            }\n          }\n        }\n        if (window.toastr) window.toastr.warning('');\n      });\n    // \n    $('.acu-table-map-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        showMapVisualization();\n      });\n    // --- []  ---\n\n    // 1. \n    $('#acu-btn-switch-style')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const styles = getTableStyles();\n        const current = styles[tableName] || 'list';\n        styles[tableName] = current === 'grid' ? 'list' : 'grid'; // \n        saveTableStyles(styles);\n        renderInterface(); // \n      });\n\n    // 2. \n    $('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          if (tableName) {\n            const heights = getTableHeights();\n            heights[tableName] = parseInt($panel.css('height'));\n            saveTableHeights(heights);\n            $panel.addClass('acu-manual-mode');\n          }\n        };\n      });\n\n    // 3.  - \n    $('.acu-height-drag-handle')\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    // [] \n    $wrapper.on('click', '.acu-reverse-btn', function (e) {\n      e.stopPropagation();\n      const tName = $(this).data('table');\n      if (!tName) return;\n\n      toggleTableReverse(tName);\n\n      // \n      renderInterface();\n    });\n    // [] \n    $('.acu-panel-header')\n      .off('dblclick.acu')\n      .on('dblclick.acu', function (e) {\n        if ($(e.target).closest('.acu-search-input, .acu-close-btn, .acu-view-btn').length) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = getActiveTabState();\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    $('.acu-close-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $input = $('.acu-search-input');\n\n        // \n        if ($input.length && $input.val()) {\n          $input.val('').trigger('input').focus();\n          return;\n        }\n\n        // \n        const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        if (isDashboardActive) {\n          // \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n        if (isMvuActive) {\n          // \n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        closePanel();\n      });\n    // [] bookmark\n    $('body')\n      .off('click.acu_bookmark')\n      .on('click.acu_bookmark', '.acu-bookmark-icon', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $icon = $(this);\n        const tableName = $icon.data('table');\n        const rowKey = $icon.data('row-key');\n\n        if (!tableName || !rowKey) return;\n\n        // bookmark\n        BookmarkManager.toggleBookmark(tableName, rowKey);\n\n        // \n        if (typeof renderInterface === 'function') {\n          renderInterface();\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_action')\n      .on('click.acu_action', '.acu-action-item', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $btn = $(this);\n        const rowIdx = parseInt($btn.data('row'), 10);\n        const actionIdx = parseInt($btn.data('action-idx'), 10);\n\n        // \n        const $card = $btn.closest('.acu-data-card');\n        const $title = $card.find('.acu-editable-title');\n        const tableKey = $title.data('key');\n        const tableName = $title.data('tname') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const headers = rawData[tableKey].content[0] || [];\n        const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n\n        // []  + AI\n        const actions = getInteractOptionsForRow(tableName, headers, rowData);\n\n        const action = actions[actionIdx];\n\n        // [] \n        if (action && action.type === 'skill_check') {\n          const skillName = rowData[1] || '';\n\n          // \n          let checkValue = null;\n          const attrValIdx = headers.findIndex(h => h && h.includes(''));\n          const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n          // \n          if (attrValIdx > 0 && rowData[attrValIdx]) {\n            const val = extractNumericValue(rowData[attrValIdx]);\n            if (val > 0) checkValue = val;\n          }\n          // \n          if (checkValue === null && profIdx > 0 && rowData[profIdx]) {\n            const val = extractNumericValue(rowData[profIdx]);\n            if (val > 0) checkValue = val;\n          }\n\n          // \n          const promptText = processTemplate(action.template, rowData, headers);\n          smartInsertToTextarea(promptText, 'action');\n\n          // \n          if (checkValue !== null && checkValue > 0) {\n            showDicePanel({\n              targetValue: checkValue,\n              targetName: skillName,\n              initiatorName: '<user>',\n            });\n          } else {\n            $('#send_textarea').focus();\n          }\n          return;\n        }\n\n        if (action && action.template) {\n          // \n          const rawData = cachedRawData || getTableData();\n          if (rawData && rawData[tableKey]) {\n            const headers = rawData[tableKey].content[0] || [];\n            const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n            const npcName = rowData[1] || '';\n\n            // \"\"\n            if (action.label === '') {\n              const config = getConfig();\n              $('.acu-msg-overlay').remove();\n\n              const t = getThemeColors();\n\n              const overlay = $(`\n                        <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2147483647;display:flex;justify-content:center;align-items:center;\">\n                            <div style=\"background:${t.bgPanel};border:1px solid ${t.border};border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                                <div style=\"font-size:14px;font-weight:bold;color:${t.accent};margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                                    <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                                </div>\n                                <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:6px;color:${t.textMain} !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                                <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                                    <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:6px;color:${t.textMain};cursor:pointer;\"></button>\n                                    <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:${t.btnActiveBg};border:none;border-radius:6px;color:${t.btnActiveText};cursor:pointer;font-weight:bold;\"></button>\n                                </div>\n                            </div>\n                        </div>\n                    `);\n\n              $('body').append(overlay);\n              // []  JS  overlay \n              const overlayEl = overlay[0];\n              overlayEl.style.setProperty('position', 'fixed', 'important');\n              overlayEl.style.setProperty('top', '0', 'important');\n              overlayEl.style.setProperty('left', '0', 'important');\n              overlayEl.style.setProperty('right', '0', 'important');\n              overlayEl.style.setProperty('bottom', '0', 'important');\n              overlayEl.style.setProperty('width', '100vw', 'important');\n              overlayEl.style.setProperty('height', '100vh', 'important');\n              overlayEl.style.setProperty('display', 'flex', 'important');\n              overlayEl.style.setProperty('justify-content', 'center', 'important');\n              overlayEl.style.setProperty('align-items', 'center', 'important');\n              overlayEl.style.setProperty('z-index', '2147483650', 'important');\n              setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n              const sendMessage = () => {\n                const msg = overlay.find('#acu-msg-input').val().trim();\n                if (msg) {\n                  const promptText = `<user>${npcName}\"${msg}\"`;\n                  smartInsertToTextarea(promptText, 'action');\n                  $('#send_textarea').focus();\n                }\n                overlay.remove();\n              };\n\n              overlay.find('#acu-msg-send').click(sendMessage);\n              overlay.find('#acu-msg-input').on('keydown', function (ev) {\n                if (ev.key === 'Enter') {\n                  ev.preventDefault();\n                  sendMessage();\n                }\n              });\n              overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n              overlay.on('click', function (ev) {\n                if ($(ev.target).hasClass('acu-msg-overlay')) overlay.remove();\n              });\n              return;\n            }\n\n            //  processTemplate \n            const promptText = processTemplate(action.template, rowData, headers);\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_global_dice')\n      .on('click.acu_global_dice', '#acu-btn-dice', function (e) {\n        e.stopPropagation();\n        showDicePanel({\n          targetValue: 50,\n          targetName: '',\n          diceType: '1d100',\n        });\n      });\n    // ========== [] ==========\n    // /\n    $('body')\n      .off('click.acu_location_toggle')\n      .on('click.acu_location_toggle', '.acu-location-header', function (e) {\n        e.stopPropagation();\n        const $group = $(this).closest('.acu-location-group');\n        $group.toggleClass('expanded');\n      });\n\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_jump')\n      .on('click.acu_dash_jump', '.acu-dash-jump-link, .acu-dash-loc-item', function (e) {\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const searchTerm = $(this).data('search') || '';\n\n        if (tableName) {\n          // 1. \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n\n          // 2. \n          saveActiveTabState(tableName);\n\n          // 3. \n          if (searchTerm) {\n            tableSearchStates[tableName] = searchTerm;\n            tablePageStates[tableName] = 1;\n          }\n\n          // 4. \n          renderInterface();\n\n          // 5. \n          if (searchTerm) {\n            setTimeout(() => {\n              const $input = $('.acu-search-input');\n              if ($input.length) $input.focus();\n            }, 100);\n          }\n        }\n      });\n    // ========== [] ==========\n    // [] \n    $('body')\n      .off('click.acu_inline_dice')\n      .on('click.acu_inline_dice', '.acu-inline-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        //  .attr()  jQuery \n        const attrName = $(this).attr('data-attr-name') || '';\n        const attrValue = parseInt($(this).attr('data-attr-value'), 10) || 50;\n\n        // NPC\n        const $card = $(this).closest('.acu-data-card');\n        const cardTitle = $card.find('.acu-editable-title').text().trim();\n\n        // <user>\n        const tableName = $card.find('.acu-editable-title').data('tname') || '';\n        const isPlayerTable = tableName.includes('');\n        const initiatorName = isPlayerTable ? '<user>' : cardTitle;\n\n        showDicePanel({\n          attrValue: attrValue,\n          targetValue: null, // showDicePanel\n          targetName: attrName,\n          initiatorName: initiatorName,\n          //  diceType\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_dice')\n      .on('click.acu_dash_dice', '.acu-dash-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const targetValue = parseInt($(this).data('target'), 10) || 50;\n        const targetName = $(this).data('name') || '';\n        const npcName = $(this).data('npc') || '';\n\n        // NPC\n        if (npcName) {\n          // \n          const playerAttrValue = getAttributeValue('<user>', targetName) || 50;\n          showContestPanel({\n            initiatorName: '<user>',\n            initiatorValue: playerAttrValue,\n            opponentName: npcName,\n            opponentValue: targetValue,\n          });\n        } else {\n          showDicePanel({\n            targetValue: targetValue,\n            targetName: targetName,\n            initiatorName: '<user>',\n          });\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_goto')\n      .on('click.acu_dash_goto', '.acu-dash-goto-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const locationName = $(this).data('location') || '';\n        const promptText = `<user>${locationName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_use_item')\n      .on('click.acu_dash_use_item', '.acu-dash-use-item-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const itemName = $(this).data('item') || '';\n        const promptText = `<user>${itemName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\" - \n    $('body')\n      .off('click.acu_dash_use_skill')\n      .on('click.acu_dash_use_skill', '.acu-dash-use-skill-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const skillName = $(this).data('skill') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        let checkValue = null;\n\n        if (rawData) {\n          // \n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n            if (sheet.name.includes('') || sheet.name.includes('')) {\n              const headers = sheet.content[0] || [];\n              // \n              const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n              const attrValIdx = headers.findIndex(h => h && h.includes(''));\n              const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n              for (let i = 1; i < sheet.content.length; i++) {\n                const row = sheet.content[i];\n                if (row && row[nameIdx === -1 ? 1 : nameIdx] === skillName) {\n                  // \n                  if (attrValIdx > 0 && row[attrValIdx]) {\n                    const val = extractNumericValue(row[attrValIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  // \n                  if (profIdx > 0 && row[profIdx]) {\n                    const val = extractNumericValue(row[profIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n              if (checkValue !== null) break;\n            }\n          }\n        }\n\n        // \n        const promptText = `<user>${skillName}`;\n        smartInsertToTextarea(promptText, 'action');\n\n        // \n        if (checkValue !== null && checkValue > 0) {\n          showDicePanel({\n            targetValue: checkValue,\n            targetName: skillName,\n            initiatorName: '<user>',\n          });\n        } else {\n          // \n          $('#send_textarea').focus();\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_track_task')\n      .on('click.acu_dash_track_task', '.acu-dash-track-task-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const taskName = $(this).data('task') || '';\n        const promptText = `<user>${taskName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_msg')\n      .on('click.acu_dash_msg', '.acu-dash-msg-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n        const config = getConfig();\n\n        // \n        $('.acu-msg-overlay').remove();\n\n        // \n        const t = getThemeColors();\n\n        const overlay = $(`\n            <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2147483647;display:flex;justify-content:center;align-items:center;\">\n                <div class=\"acu-msg-dialog\" style=\"background:${t.bgPanel};border:1px solid ${t.border};border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                    <div style=\"font-size:14px;font-weight:bold;color:${t.accent};margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                        <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                    </div>\n                    <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:6px;color:${t.textMain} !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                    <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                        <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:6px;color:${t.textMain};cursor:pointer;\"></button>\n                        <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:${t.btnActiveBg};border:none;border-radius:6px;color:${t.btnActiveText};cursor:pointer;font-weight:bold;\"></button>\n                    </div>\n                </div>\n            </div>\n        `);\n\n        $('body').append(overlay);\n        const overlayEl = overlay[0];\n        overlayEl.style.setProperty('position', 'fixed', 'important');\n        overlayEl.style.setProperty('top', '0', 'important');\n        overlayEl.style.setProperty('left', '0', 'important');\n        overlayEl.style.setProperty('right', '0', 'important');\n        overlayEl.style.setProperty('bottom', '0', 'important');\n        overlayEl.style.setProperty('width', '100vw', 'important');\n        overlayEl.style.setProperty('height', '100vh', 'important');\n        overlayEl.style.setProperty('display', 'flex', 'important');\n        overlayEl.style.setProperty('justify-content', 'center', 'important');\n        overlayEl.style.setProperty('align-items', 'center', 'important');\n        overlayEl.style.setProperty('z-index', '2147483650', 'important');\n        setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n        const sendMessage = () => {\n          const msg = overlay.find('#acu-msg-input').val().trim();\n          if (msg) {\n            const promptText = `<user>${npcName}\"${msg}\"`;\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n          overlay.remove();\n        };\n\n        // \n        overlay.find('#acu-msg-send').click(sendMessage);\n\n        // \n        overlay.find('#acu-msg-input').on('keydown', function (ev) {\n          if (ev.key === 'Enter') {\n            ev.preventDefault();\n            sendMessage();\n          }\n        });\n\n        // \n        overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n        overlay.on('click', function (ev) {\n          if ($(ev.target).hasClass('acu-msg-overlay')) overlay.remove();\n        });\n      });\n    // [] NPC\n    $('body')\n      .off('click.acu_dash_contest')\n      .on('click.acu_dash_contest', '.acu-dash-contest-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n\n        const rawData = cachedRawData || getTableData();\n\n        var playerAttrValue = 50;\n        var npcAttrValue = 50;\n        var foundPlayer = false;\n        var foundNPC = false;\n\n        if (rawData) {\n          for (var key in rawData) {\n            var sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n\n            // \n            if (sheet.name === '') {\n              if (sheet.content[1]) {\n                var attrStr = sheet.content[1][7] || '';\n                var parts = attrStr.split(/[,;\\s]+/);\n                for (var i = 0; i < parts.length; i++) {\n                  var match = parts[i].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                  if (match) {\n                    playerAttrValue = parseInt(match[2], 10);\n                    foundPlayer = true;\n                    break;\n                  }\n                }\n              }\n            }\n\n            // \n            if (sheet.name === '' && npcName) {\n              for (var j = 1; j < sheet.content.length; j++) {\n                var row = sheet.content[j];\n                if (row && row[1] === npcName) {\n                  var npcAttrStr = row[9] || '';\n                  var npcParts = npcAttrStr.split(/[,;\\s]+/);\n                  for (var k = 0; k < npcParts.length; k++) {\n                    var npcMatch = npcParts[k].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                    if (npcMatch) {\n                      npcAttrValue = parseInt(npcMatch[2], 10);\n                      foundNPC = true;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n            }\n          }\n        }\n\n        showContestPanel({\n          initiatorName: '<user>',\n          initiatorValue: playerAttrValue,\n          opponentName: npcName,\n          opponentValue: npcAttrValue,\n          diceType: '1d100',\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_preview')\n      .on('click.acu_dash_preview', '.acu-dash-preview-trigger', function (e) {\n        e.stopPropagation();\n\n        const tableKey = $(this).data('table-key');\n        const rowIndex = parseInt($(this).data('row-index'), 10);\n\n        if (!tableKey || isNaN(rowIndex)) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const table = rawData[tableKey];\n        const tableName = table.name || '';\n        const headers = table.content[0] || [];\n        const rowData = table.content[rowIndex + 1];\n\n        if (!rowData) return;\n\n        const config = getConfig();\n        const title = rowData[1] || '';\n\n        //  renderTableContent \n        const titleColIndex = 1;\n        const realRowIdx = rowIndex;\n\n        // \n        let cardBody = '';\n        rowData.forEach((cell, cIdx) => {\n          if (cIdx <= 0 || cIdx === titleColIndex) return;\n          const currentHeader = headers[cIdx] || '';\n          if (currentHeader.includes('')) return; // \n\n          const headerName = headers[cIdx] || '' + cIdx;\n          const rawStr = String(cell || '').trim();\n          if (!rawStr) return;\n\n          // [] \n          const lockRowKey = LockManager.getRowKey(tableName, rowData, headers);\n          const isThisFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, headerName);\n          const inlineLockIcon = isThisFieldLocked\n            ? '<i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:10px;opacity:0.7;margin-left:4px;\" title=\"\"></i>'\n            : '';\n\n          let contentHtml = '';\n          let hideLabel = false;\n\n          const parsedAttrs = parseAttributeString(rawStr);\n          // [] \n          if (isRelationshipCell(rawStr, headerName)) {\n            const relations = parseRelationshipString(rawStr);\n            if (relations.length > 1) {\n              hideLabel = true;\n              let relHtml = '';\n              relations.forEach((rel, i) => {\n                const borderStyle = i < relations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                relHtml += `<div style=\"display:flex;justify-content:flex-start;align-items:center;gap:8px;padding:3px 0;${borderStyle}\">\n                              <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(rel.name)}${inlineLockIcon}</span>\n                              ${rel.relation ? `<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>` : ''}\n                          </div>`;\n              });\n              contentHtml = `<div class=\"acu-relation-container\">${relHtml}</div>`;\n            } else if (relations.length === 1 && relations[0].relation) {\n              hideLabel = true; // [] \n              const rel = relations[0];\n              contentHtml = `<div style=\"display:flex;justify-content:flex-start;align-items:center;gap:8px;\">\n                          <span style=\"color:var(--acu-text-sub);\">${escapeHtml(rel.name)}${inlineLockIcon}</span>\n                          <span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>\n                      </div>`;\n            }\n          } else if (parsedAttrs.length > 1) {\n            hideLabel = true;\n            let attrsHtml = '';\n            parsedAttrs.forEach((attr, i) => {\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              const borderStyle = i < parsedAttrs.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n              attrsHtml += `<div style=\"display:flex;justify-content:space-between;align-items:center;padding:3px 0;${borderStyle}\">\n                          <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(attr.name)}${inlineLockIcon}</span>\n                          <div style=\"display:flex;align-items:center;gap:6px;\">\n                              <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                              ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                          </div></div>`;\n            });\n            contentHtml = `<div class=\"acu-multi-attr-container\">${attrsHtml}</div>`;\n          } else if (parsedAttrs.length === 1) {\n            hideLabel = true;\n            const attr = parsedAttrs[0];\n            const showDice = !BlacklistManager.isBlacklisted(attr.name);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                      <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(attr.name)}${inlineLockIcon}</span>\n                      <div style=\"display:flex;align-items:center;gap:6px;\">\n                          <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                          ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                      </div></div>`;\n          } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n            const numVal = extractNumericValue(rawStr);\n            const showDice = !BlacklistManager.isBlacklisted(headerName);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                      <span>${escapeHtml(rawStr)}</span>\n                      ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(headerName)}\" data-attr-value=\"${numVal}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;margin-left:6px;\" title=\"\"></i>` : ''}\n                  </div>`;\n          } else {\n            const badgeStyle = getBadgeStyle(rawStr);\n            contentHtml = badgeStyle\n              ? `<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(rawStr)}</span>`\n              : escapeHtml(rawStr);\n          }\n\n          const rowClass = 'acu-card-row acu-cell' + (hideLabel ? ' acu-hide-label' : '');\n          cardBody += `<div class=\"${rowClass}\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${cIdx}\" data-val=\"${encodeURIComponent(cell ?? '')}\">\n                <div class=\"acu-card-label\">${escapeHtml(headerName)}</div>\n                <div class=\"acu-card-value\">${contentHtml}</div>\n            </div>`;\n        });\n\n        // []  + AI\n        // [] \n        const tableActions = getInteractOptionsForRow(tableName, headers, rowData);\n        let actionsHtml = '';\n        if (tableActions.length > 0) {\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardHtml = `\n            <div class=\"acu-preview-overlay acu-theme-${config.theme}\" style=\"--acu-card-width:${config.cardWidth}px;--acu-font-size:${config.fontSize}px;\">\n                <div class=\"acu-data-card\" style=\"width:90vw;max-width:420px;max-height:85vh;overflow-y:auto;\">\n                    <div class=\"acu-card-header\">\n                        <span class=\"acu-card-index\">#${realRowIdx + 1}</span>\n                        <span class=\"acu-cell acu-editable-title\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(title)}\">${escapeHtml(title)}</span>\n                        <button class=\"acu-preview-close\" style=\"margin-left:auto;background:none;border:none;color:var(--acu-text-sub);cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-card-body view-list\">${cardBody}</div>\n                    ${actionsHtml}\n                </div>\n            </div>\n        `;\n\n        $('.acu-preview-overlay').remove();\n        $('body').append(cardHtml);\n\n        // \n        const overlayEl = $('.acu-preview-overlay')[0];\n        if (overlayEl) {\n          overlayEl.style.setProperty('position', 'fixed', 'important');\n          overlayEl.style.setProperty('top', '0', 'important');\n          overlayEl.style.setProperty('left', '0', 'important');\n          overlayEl.style.setProperty('right', '0', 'important');\n          overlayEl.style.setProperty('bottom', '0', 'important');\n          overlayEl.style.setProperty('width', '100vw', 'important');\n          overlayEl.style.setProperty('height', '100vh', 'important');\n          overlayEl.style.setProperty('display', 'flex', 'important');\n          overlayEl.style.setProperty('justify-content', 'center', 'important');\n          overlayEl.style.setProperty('align-items', 'center', 'important');\n          overlayEl.style.setProperty('z-index', '2147483650', 'important');\n        }\n\n        // \n        $('.acu-preview-overlay').on('click', function (ev) {\n          if ($(ev.target).hasClass('acu-preview-overlay') || $(ev.target).closest('.acu-preview-close').length) {\n            $(this).remove();\n          }\n        });\n      });\n\n    // === []  ST  swipe regenerate ===\n    (function () {\n      const $doc = $(document);\n      let touchStartX = 0;\n      let touchStartY = 0;\n\n      //  data-area\n      $doc.on('touchstart.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length === 1) {\n          touchStartX = e.originalEvent.touches[0].clientX;\n          touchStartY = e.originalEvent.touches[0].clientY;\n        }\n      });\n\n      $doc.on('touchmove.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length !== 1) return;\n\n        const touch = e.originalEvent.touches[0];\n        const deltaX = Math.abs(touch.clientX - touchStartX);\n        const deltaY = Math.abs(touch.clientY - touchStartY);\n\n        // X > Y * 1.5\n        if (deltaX > deltaY * 1.5 && deltaX > 10) {\n          e.stopPropagation();\n          console.log('[DICE]ACU  ST swipe');\n        }\n      });\n    })();\n  };\n\n  let selectedSwapSource = null;\n  const toggleOrderEditMode = () => {\n    const { $ } = getCore();\n    isEditingOrder = !isEditingOrder;\n\n    const $container = $('#acu-nav-bar');\n    const $hint = $('#acu-order-hint');\n    const $pool = $('#acu-action-pool');\n\n    // \n    if (!$container.length) {\n      console.error('[DICE]ACU ');\n      isEditingOrder = false;\n      return;\n    }\n\n    selectedSwapSource = null;\n    $('.acu-swap-selected').removeClass('acu-swap-selected');\n\n    if (isEditingOrder) {\n      // \n      $container.addClass('editing-order');\n      if ($pool.length) $pool.addClass('visible');\n\n      if ($hint.length) {\n        $hint\n          .html(\n            `\n                    <div style=\"display:flex; justify-content:space-between; align-items:center; width:100%; flex-wrap:wrap; gap:8px;\">\n                        <div style=\"display:flex; align-items:center; gap:10px; flex:1; min-width:200px;\">\n                            <span><i class=\"fa-solid fa-layer-group\"></i> </span>\n                            <span style=\"font-size:11px; opacity:0.9; font-weight:normal;\"></span>\n                        </div>\n                        <button id=\"acu-btn-finish-sort\" style=\"background:rgba(255,255,255,0.2); color:#fff; border:1px solid rgba(255,255,255,0.4); padding:4px 14px; border-radius:4px; cursor:pointer; font-size:12px; transition:all 0.2s; white-space:nowrap;\">\n                            <i class=\"fa-solid fa-check\"></i> \n                        </button>\n                    </div>\n                `,\n          )\n          .addClass('visible')\n          .css('display', 'flex');\n\n        $('#acu-btn-finish-sort').hover(\n          function () {\n            $(this).css({ background: '#fff', color: 'var(--acu-accent)' });\n          },\n          function () {\n            $(this).css({ background: 'rgba(255,255,255,0.2)', color: '#fff' });\n          },\n        );\n\n        $('#acu-btn-finish-sort')\n          .off('click')\n          .on('click', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            toggleOrderEditMode();\n          });\n      }\n\n      // \n      $('#acu-data-area').removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn').not('#acu-btn-dashboard, #acu-btn-dice-nav').attr('draggable', 'true');\n      $container.find('.acu-action-btn').attr('draggable', 'true');\n\n      // \n      initSortable();\n    } else {\n      // \n      $container.removeClass('editing-order');\n      if ($hint.length) $hint.removeClass('visible').hide();\n      if ($pool.length) $pool.removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn, .acu-action-btn').attr('draggable', 'false');\n      $('.acu-nav-btn, .acu-action-btn').off('.sort');\n      $('#acu-action-pool, #acu-active-actions').off('.sort');\n\n      // \n      const newTableOrder = [];\n      $container.find('.acu-nav-btn[data-table]').each(function () {\n        const tableName = $(this).data('table');\n        if (tableName) {\n          newTableOrder.push(tableName);\n        }\n      });\n      if (newTableOrder.length > 0) {\n        saveTableOrder(newTableOrder);\n      }\n\n      // \n      const newActionOrder = [];\n      $('#acu-active-actions .acu-action-btn').each(function () {\n        const btnId = $(this).attr('id');\n        if (btnId) {\n          newActionOrder.push(btnId);\n        }\n      });\n\n      // \n      if (!newActionOrder.includes('acu-btn-settings')) {\n        newActionOrder.push('acu-btn-settings');\n      }\n\n      Store.set(STORAGE_KEY_ACTION_ORDER, newActionOrder);\n\n      // \n      renderInterface();\n    }\n  };\n\n  const initSortable = () => {\n    const { $ } = getCore();\n    let $dragSrcEl = null;\n\n    // \n    $('.acu-nav-btn, .acu-action-btn, #acu-action-pool, #acu-active-actions').off('.sort');\n\n    // --- 1.  () ---\n    const $items = $('.acu-nav-btn, .acu-action-btn');\n\n    $items.on('dragstart.sort', function (e) {\n      $dragSrcEl = $(this);\n      $(this).css('opacity', '0.4');\n      e.originalEvent.dataTransfer.effectAllowed = 'move';\n    });\n\n    $items.on('dragend.sort', function (e) {\n      $(this).css('opacity', '1');\n      $('.acu-drag-over').removeClass('acu-drag-over');\n      $('.acu-actions-group, .acu-unused-pool').removeClass('dragging-over');\n    });\n\n    $items.on('dragover.sort', function (e) {\n      e.preventDefault();\n      return false;\n    });\n    $items.on('dragenter.sort', function () {\n      if ($dragSrcEl && this !== $dragSrcEl[0]) $(this).addClass('acu-drag-over');\n    });\n    $items.on('dragleave.sort', function () {\n      $(this).removeClass('acu-drag-over');\n    });\n\n    $items.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('acu-drag-over');\n      if (!$dragSrcEl || $dragSrcEl[0] === this) return false;\n\n      const isSrcAction = $dragSrcEl.hasClass('acu-action-btn');\n      const isTgtAction = $(this).hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) return false;\n\n      if (isSrcAction) {\n        const targetPoolId = $(this).parent().attr('id');\n        const srcPoolId = $dragSrcEl.parent().attr('id');\n\n        if (srcPoolId === 'acu-action-pool' && targetPoolId === 'acu-active-actions') {\n          if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n            if (window.toastr) window.toastr.warning('6');\n            return false;\n          }\n        }\n\n        if (srcPoolId !== targetPoolId) {\n          $(this).before($dragSrcEl);\n          return false;\n        }\n      }\n\n      const $temp = $('<span>').hide();\n      $dragSrcEl.before($temp);\n      $(this).before($dragSrcEl);\n      $temp.replaceWith($(this));\n      return false;\n    });\n\n    // --- 2.  (/) ---\n    const $containers = $('#acu-action-pool, #acu-active-actions');\n\n    $containers.on('dragover.sort', function (e) {\n      e.preventDefault();\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        $(this).addClass('dragging-over');\n      }\n    });\n\n    $containers.on('dragleave.sort', function (e) {\n      $(this).removeClass('dragging-over');\n    });\n\n    $containers.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('dragging-over');\n\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        const currentParentId = $dragSrcEl.parent().attr('id');\n        const targetId = $(this).attr('id');\n        const btnId = $dragSrcEl.attr('id');\n\n        if (currentParentId !== targetId) {\n          if (targetId === 'acu-action-pool') {\n            if (btnId === 'acu-btn-settings') {\n              if (window.toastr) window.toastr.warning('');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          } else if (targetId === 'acu-active-actions') {\n            if ($(this).children().length >= 6) {\n              if (window.toastr) window.toastr.warning('6');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          }\n        }\n      }\n      return false;\n    });\n\n    // --- 3.  -  ---\n    $containers.on('click.sort', function (e) {\n      e.stopPropagation();\n\n      // \n      if ($(e.target).closest('.acu-action-btn, .acu-nav-btn').length > 0) return;\n\n      // \n      if (!selectedSwapSource) return;\n\n      const $src = $(selectedSwapSource);\n\n      // \n      if (!$src.hasClass('acu-action-btn')) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const targetId = $(this).attr('id');\n      const btnId = $src.attr('id');\n\n      // \n      if (srcPoolId === targetId) {\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      //   \n      if (targetId === 'acu-action-pool') {\n        if (btnId === 'acu-btn-settings') {\n          if (window.toastr) window.toastr.warning('');\n          $src.removeClass('acu-swap-selected');\n          selectedSwapSource = null;\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n      //   \n      else if (targetId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n    });\n\n    // --- 4.  (Click-to-Swap) -  ---\n    $items.on('click.sort', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (selectedSwapSource && selectedSwapSource === this) {\n        $(this).removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      if (!selectedSwapSource) {\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const $src = $(selectedSwapSource);\n      const $tgt = $(this);\n\n      const isSrcAction = $src.hasClass('acu-action-btn');\n      const isTgtAction = $tgt.hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const tgtPoolId = $tgt.parent().attr('id');\n\n      if (isSrcAction && srcPoolId === 'acu-action-pool' && tgtPoolId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n      }\n\n      if (srcPoolId !== tgtPoolId) {\n        $tgt.before($src);\n      } else {\n        const $temp = $('<span>').hide();\n        $src.before($temp);\n        $tgt.before($src);\n        $temp.replaceWith($tgt);\n      }\n\n      $src.removeClass('acu-swap-selected');\n      selectedSwapSource = null;\n    });\n  };\n\n  const showCellMenu = (e, cell) => {\n    const { $ } = getCore();\n    $('.acu-cell-menu, .acu-menu-backdrop').remove();\n    const backdrop = $('<div class=\"acu-menu-backdrop\"></div>');\n    $('body').append(backdrop);\n\n    const rowIdx = parseInt($(cell).data('row'), 10);\n    const colIdx = parseInt($(cell).data('col'), 10);\n    if (isNaN(rowIdx) || isNaN(colIdx)) {\n      console.warn('[DICE]ACU /');\n      backdrop.remove();\n      return;\n    }\n    const tableKey = $(cell).data('key');\n    // v19.x  tname\n    const tableName = $(cell).data('tname') || $(cell).closest('.acu-data-card').find('.acu-editable-title').text();\n    const content = decodeURIComponent($(cell).data('val'));\n    const config = getConfig();\n\n    //  ID\n    const cellId = `${tableKey}-${rowIdx}-${colIdx}`;\n    if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n\n    // \n    const isModified = window.acuModifiedSet.has(cellId);\n\n    // \n    const pendingDeletionsMap = getPendingDeletions();\n    const tableDeletions = pendingDeletionsMap[tableKey] || [];\n    const isPending = tableDeletions.includes(rowIdx);\n\n    // \n    const headers = cachedRawData?.[tableKey]?.content?.[0] || [];\n    const rowData = cachedRawData?.[tableKey]?.content?.[rowIdx + 1] || [];\n    const lockRowKey = LockManager.getRowKey(tableName, rowData, headers);\n    const currentHeader = headers[colIdx] || '';\n\n    const isFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, currentHeader);\n    const hasAnyLockInRow = lockRowKey && LockManager.hasAnyLock(tableName, lockRowKey);\n\n    // \n    let lockMenuHtml = '';\n    if (lockRowKey) {\n      lockMenuHtml = '<div style=\"border-top:1px dashed var(--acu-border); margin:4px 0;\"></div>';\n\n      // \"\"\"\"\n      if (isFieldLocked) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-field\" style=\"color:#27ae60;\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-field\" style=\"color:#f39c12;\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n\n      // \"\"\"\"\n      if (hasAnyLockInRow) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-row\" style=\"color:#27ae60;\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-row\" style=\"color:#f39c12;\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n    }\n\n    const menu = $(`\n            <div class=\"acu-cell-menu acu-theme-${config.theme}\">\n                <div class=\"acu-cell-menu-item\" id=\"act-edit\"><i class=\"fa-solid fa-pen\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-edit-card\" style=\"color:#9b59b6\"><i class=\"fa-solid fa-edit\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-insert\" style=\"color:#2980b9\"><i class=\"fa-solid fa-plus\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-copy\"><i class=\"fa-solid fa-copy\"></i> </div>\n                ${lockMenuHtml}\n                ${isModified ? '<div class=\"acu-cell-menu-item\" id=\"act-undo\" style=\"color:#e67e22; border-top:1px solid #eee;\"><i class=\"fa-solid fa-undo\"></i> </div>' : ''}\n                ${isPending ? '<div class=\"acu-cell-menu-item\" id=\"act-restore\" style=\"color:#27ae60\"><i class=\"fa-solid fa-undo\"></i> </div>' : '<div class=\"acu-cell-menu-item\" id=\"act-delete\" style=\"color:#e74c3c\"><i class=\"fa-solid fa-trash\"></i> </div>'}\n                <div class=\"acu-cell-menu-item\" id=\"act-close\"><i class=\"fa-solid fa-times\"></i> </div>\n            </div>\n        `);\n    $('body').append(menu);\n\n    // \n    const winWidth = $(window).width();\n    const winHeight = $(window).height();\n    const mWidth = menu.outerWidth() || 150;\n    const mHeight = menu.outerHeight() || 150;\n    let clientX = e.clientX;\n    let clientY = e.clientY;\n    if (!clientX && e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length) {\n      clientX = e.originalEvent.touches[0].clientX;\n      clientY = e.originalEvent.touches[0].clientY;\n    } else if (!clientX && e.changedTouches && e.changedTouches.length) {\n      clientX = e.changedTouches[0].clientX;\n      clientY = e.changedTouches[0].clientY;\n    }\n\n    // \n    if (clientX === undefined) clientX = winWidth / 2;\n    if (clientY === undefined) clientY = winHeight / 2;\n\n    let left = clientX + 5;\n    let top = clientY + 5;\n    if (left + mWidth > winWidth) left = clientX - mWidth - 5;\n    if (top + mHeight > winHeight) top = clientY - mHeight - 5;\n\n    // \n    if (left < 5) left = 5;\n    if (top < 5) top = 5;\n\n    menu.css({ top: top + 'px', left: left + 'px' });\n\n    const closeAll = () => {\n      menu.remove();\n      backdrop.remove();\n    };\n    backdrop.on('click', closeAll);\n    menu.find('#act-close').click(closeAll);\n    // \n    menu.find('#act-lock-field').click(() => {\n      if (lockRowKey && currentHeader) {\n        LockManager.lockField(tableName, lockRowKey, currentHeader, content);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-field').click(() => {\n      if (lockRowKey && currentHeader) {\n        LockManager.unlockField(tableName, lockRowKey, currentHeader);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-lock-row').click(() => {\n      if (lockRowKey) {\n        LockManager.lockRow(tableName, lockRowKey, rowData, headers);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-row').click(() => {\n      if (lockRowKey) {\n        LockManager.unlockRow(tableName, lockRowKey);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    //  (v7.9 )\n    menu.find('#act-copy').click(async e => {\n      e.stopPropagation();\n\n      //  v7.7  (/PWA )\n      // : slash_command.txt /clipboard-set\n      if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n        try {\n          // \n          const safeContent = content\n            .replace(/\\\\/g, '\\\\\\\\')\n            .replace(/\"/g, '\\\\\"')\n            .replace(/\\n/g, '\\\\n')\n            .replace(/\\{/g, '\\\\{')\n            .replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          closeAll();\n          return; // \n        } catch (err) {\n          console.warn('[DICE]ACU ', err);\n        }\n      }\n\n      //  (v7.8 )\n      const doCopy = text => {\n        // A:  API ( HTTPS  localhost )\n        if (navigator.clipboard && window.isSecureContext) {\n          navigator.clipboard\n            .writeText(text)\n            .then(() => {})\n            .catch(() => {\n              fallbackCopy(text);\n            });\n        } else {\n          // B:  execCommand ( HTTP)\n          fallbackCopy(text);\n        }\n      };\n\n      const fallbackCopy = text => {\n        try {\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n\n          // \n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n\n          document.body.appendChild(textArea);\n\n          textArea.select();\n          textArea.setSelectionRange(0, 99999); //  iOS Safari\n\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n\n          if (successful) {\n          } else {\n            throw new Error('execCommand failed');\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          prompt(':', text);\n        }\n      };\n\n      doCopy(content);\n      closeAll();\n    });\n\n    // \n    menu.find('#act-undo').click(() => {\n      const snapshot = loadSnapshot();\n      let originalValue = null;\n      if (snapshot && snapshot[tableKey]?.content[rowIdx + 1]) {\n        originalValue = snapshot[tableKey].content[rowIdx + 1][colIdx];\n      }\n\n      if (originalValue !== null) {\n        if (!cachedRawData) cachedRawData = getTableData();\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = originalValue;\n        }\n\n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(originalValue));\n        $cell.data('val', encodeURIComponent(originalValue));\n\n        // [1]  Label\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length > 0) {\n          $displayTarget = $cell.find('.acu-card-value');\n        } else if ($cell.hasClass('acu-grid-item')) {\n          $displayTarget = $cell.find('.acu-grid-value');\n        } else if ($cell.hasClass('acu-full-item')) {\n          $displayTarget = $cell.find('.acu-full-value');\n        }\n\n        const badgeStyle = getBadgeStyle(originalValue);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${originalValue}</span>`);\n        } else {\n          $displayTarget.text(originalValue);\n        }\n\n        // [] \n        $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n        if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n        window.acuModifiedSet.delete(cellId);\n\n        if (window.acuModifiedSet.size === 0) {\n          hasUnsavedChanges = false;\n          updateSaveButtonState();\n        }\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n      closeAll();\n    });\n\n    // []  ( & )\n    menu.find('#act-delete').click(async () => {\n      closeAll();\n\n      let actOrd = Store.get(STORAGE_KEY_ACTION_ORDER);\n      if (!actOrd || !Array.isArray(actOrd))\n        actOrd = ['acu-btn-save-global', 'acu-btn-collapse', 'acu-btn-refresh', 'acu-btn-settings'];\n      const isInstantMode = !actOrd.includes('acu-btn-save-global');\n\n      if (isInstantMode) {\n        // ---  DOM ---\n        const $card = $(cell).closest('.acu-data-card');\n        $card.css('transition', 'all 0.2s ease').css('opacity', '0').css('transform', 'scale(0.9)');\n        setTimeout(() => $card.slideUp(200, () => $card.remove()), 200);\n\n        // ---  ---\n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n        if (cachedRawData && cachedRawData[tableKey]?.content) {\n          cachedRawData[tableKey].content.splice(rowIdx + 1, 1);\n\n          //  skipRender=true ()\n          saveSnapshot(cachedRawData);\n          await saveDataToDatabase(cachedRawData, true, true);\n        }\n      } else {\n        // ---  () ---\n        const dels = getPendingDeletions();\n        if (!dels[tableKey]) dels[tableKey] = [];\n        if (!dels[tableKey].includes(rowIdx)) {\n          dels[tableKey].push(rowIdx);\n          savePendingDeletions(dels);\n        }\n\n        // \n        $(cell).closest('.acu-data-card').addClass('pending-deletion');\n\n        // \n        updateSaveButtonState();\n      }\n    });\n\n    // \n    menu.find('#act-restore').click(() => {\n      const dels = getPendingDeletions();\n      if (dels[tableKey]) {\n        dels[tableKey] = dels[tableKey].filter(i => i !== rowIdx);\n        if (dels[tableKey].length === 0) delete dels[tableKey];\n        savePendingDeletions(dels);\n      }\n\n      $(cell).closest('.acu-data-card').removeClass('pending-deletion');\n      updateSaveButtonState();\n      closeAll();\n    });\n\n    // []  ()\n    menu.find('#act-insert').click(async () => {\n      closeAll();\n      // 1.  ()\n      if (!cachedRawData) cachedRawData = getTableData();\n      if (!cachedRawData) cachedRawData = loadSnapshot();\n\n      if (cachedRawData && cachedRawData[tableKey]?.content) {\n        const sheet = cachedRawData[tableKey];\n        // 2.  ()\n        const colCount = sheet.content[0] ? sheet.content[0].length : 2;\n        const newRow = new Array(colCount).fill('');\n        //  ()\n        if (colCount > 0) newRow[0] = String(sheet.content.length);\n\n        // 3.  (rowIdx+2  content )\n        sheet.content.splice(rowIdx + 2, 0, newRow);\n\n        // 4. \n        // \n        await saveDataToDatabase(cachedRawData, false, true);\n\n        // \n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $panel = $('.acu-panel-content');\n          // \n          if ($panel.length && $panel[0].scrollHeight > $panel.height()) {\n            $panel.scrollTop($panel.scrollTop() + 10);\n          }\n        }, 100);\n      }\n    });\n\n    // [] \n    menu.find('#act-edit-card').click(() => {\n      closeAll();\n      const rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const headers = rawData[tableKey].content[0];\n        const row = rawData[tableKey].content[rowIdx + 1];\n        if (row) {\n          showCardEditModal(row, headers, tableName, rowIdx, tableKey);\n        }\n      }\n    });\n\n    menu.find('#act-edit').click(() => {\n      closeAll();\n      showEditDialog(content, async newVal => {\n        // 1. \n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = newVal;\n        } else {\n          alert('');\n          return;\n        }\n\n        // 2.  UI \n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(newVal)).data('val', encodeURIComponent(newVal));\n\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length) $displayTarget = $cell.find('.acu-card-value');\n        else if ($cell.hasClass('acu-grid-item')) $displayTarget = $cell.find('.acu-grid-value');\n        else if ($cell.hasClass('acu-editable-title')) $displayTarget = $cell;\n\n        // 3.  UI / ()\n        const badgeStyle = getBadgeStyle(newVal);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(newVal)}</span>`);\n        } else {\n          $displayTarget.text(newVal);\n        }\n\n        // 4.  vs \n        let actOrd = Store.get(STORAGE_KEY_ACTION_ORDER);\n        if (!actOrd || !Array.isArray(actOrd))\n          actOrd = ['acu-btn-save-global', 'acu-btn-collapse', 'acu-btn-refresh', 'acu-btn-settings'];\n        const isInstantMode = !actOrd.includes('acu-btn-save-global');\n\n        if (isInstantMode) {\n          // --- A.  ---\n          //  ()\n          $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n          if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n          //  ()\n          saveSnapshot(cachedRawData);\n          await saveDataToDatabase(cachedRawData, true, true);\n        } else {\n          // --- B.  () ---\n          // \n          $displayTarget.removeClass('acu-highlight-diff').addClass('acu-highlight-manual');\n          if ($cell.hasClass('acu-editable-title'))\n            $cell.removeClass('acu-highlight-diff').addClass('acu-highlight-manual');\n\n          // \n          if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n          window.acuModifiedSet.add(cellId);\n          hasUnsavedChanges = true;\n          updateSaveButtonState();\n        }\n      });\n    });\n  };\n\n  const showEditDialog = (content, onSave) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <!-- 2. []  acu-theme-${config.theme} -->\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"></div>\n                    <textarea class=\"acu-edit-textarea\" spellcheck=\"false\">${escapeHtml(content)}</textarea>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = el.scrollHeight + 2 + 'px';\n    };\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    dialog.find('#dlg-cancel').click(() => dialog.remove());\n    // \n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) dialog.remove();\n    });\n\n    dialog.find('#dlg-save').click(() => {\n      onSave(dialog.find('textarea').val());\n      dialog.remove();\n    });\n  };\n\n  // ==========================================\n  // []  (Observer )\n  // ==========================================\n  // \n  const detectVisualizerConflict = () => {\n    const { $ } = getCore();\n    if (!$) return false;\n\n    // 1:  DOM \n    //  .acu-wrapper\n    const $wrapper = $('.acu-wrapper');\n    if ($wrapper.length > 0) {\n      //  wrapper \n      //  v12.60  'acu_visualizer_ui_v20_pagination'  SCRIPT_ID\n      // \n      const hasVisualizerNav = $wrapper.find('.acu-nav-container').length > 0;\n      const hasVisualizerDataDisplay = $wrapper.find('.acu-data-display').length > 0;\n\n      //  wrapper \n      //  wrapper  data  id\n      const wrapperId = $wrapper.attr('id') || '';\n      const wrapperClass = $wrapper.attr('class') || '';\n\n      // \n      if (hasVisualizerNav && hasVisualizerDataDisplay) {\n        // \n        const hasDiceFeatures = $wrapper.find('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceFeatures) {\n          return true; // \n        }\n      }\n    }\n\n    // 2: \n    try {\n      const scripts = document.querySelectorAll('script');\n      for (const script of scripts) {\n        const content = script.textContent || script.innerHTML || '';\n        //  v12.60 \n        if (content.includes('acu_visualizer_ui_v20_pagination') && content.includes('acu_ui_config_v18')) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // \n    }\n\n    // 3:  localStorage\n    //  localStorage \n    try {\n      const visualizerConfig = localStorage.getItem('acu_ui_config_v18');\n      const diceConfig = localStorage.getItem('acu_ui_config_v19');\n\n      //  DOM \n      if (visualizerConfig && !diceConfig) {\n        //  DOM\n        const hasDiceInDOM = $('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceInDOM) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // localStorage \n    }\n\n    return false;\n  };\n\n  // \n  const showConflictDialog = () => {\n    const { $ } = getCore();\n    if (!$) return;\n\n    // \n    $('.dice-conflict-dialog-overlay').remove();\n\n    const dialogHtml = `\n      <div class=\"dice-conflict-dialog-overlay\" style=\"\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0, 0, 0, 0.75);\n        backdrop-filter: blur(4px);\n        z-index: 2147483647;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 20px;\n        box-sizing: border-box;\n      \">\n        <div class=\"dice-conflict-dialog\" style=\"\n          background: #fff;\n          border-radius: 16px;\n          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n          max-width: 500px;\n          width: 100%;\n          padding: 30px;\n          box-sizing: border-box;\n          animation: diceDialogPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n        \">\n          <div style=\"\n            text-align: center;\n            margin-bottom: 20px;\n          \">\n            <div style=\"\n              font-size: 48px;\n              color: #e74c3c;\n              margin-bottom: 15px;\n            \"></div>\n            <h2 style=\"\n              font-size: 24px;\n              font-weight: bold;\n              color: #333;\n              margin: 0 0 10px 0;\n            \"></h2>\n            <p style=\"\n              font-size: 16px;\n              color: #666;\n              line-height: 1.6;\n              margin: 0;\n            \">\"\"</p>\n          </div>\n          <div style=\"\n            background: #fff3cd;\n            border: 1px solid #ffc107;\n            border-radius: 8px;\n            padding: 15px;\n            margin-bottom: 20px;\n          \">\n            <p style=\"\n              font-size: 14px;\n              color: #856404;\n              line-height: 1.6;\n              margin: 0;\n            \">\n              <strong></strong><br>\n              <strong></strong>\n            </p>\n          </div>\n          <div style=\"\n            display: flex;\n            gap: 10px;\n            justify-content: center;\n            flex-wrap: wrap;\n          \">\n            <button id=\"dice-conflict-close\" style=\"\n              background: #6c757d;\n              color: #fff;\n              border: none;\n              border-radius: 8px;\n              padding: 12px 24px;\n              font-size: 16px;\n              font-weight: bold;\n              cursor: pointer;\n              transition: all 0.2s;\n              min-width: 120px;\n            \"></button>\n          </div>\n        </div>\n      </div>\n      <style>\n        @keyframes diceDialogPop {\n          from {\n            opacity: 0;\n            transform: translateY(20px) scale(0.95);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0) scale(1);\n          }\n        }\n        .dice-conflict-dialog button:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        }\n        .dice-conflict-dialog button:active {\n          transform: translateY(0);\n        }\n        @media (max-width: 768px) {\n          .dice-conflict-dialog {\n            padding: 20px !important;\n            margin: 10px !important;\n            max-width: calc(100% - 20px) !important;\n          }\n          .dice-conflict-dialog h2 {\n            font-size: 20px !important;\n          }\n          .dice-conflict-dialog p {\n            font-size: 14px !important;\n          }\n        }\n      </style>\n    `;\n\n    $('body').append(dialogHtml);\n\n    // \n    $('#dice-conflict-close').on('click', function () {\n      $('.dice-conflict-dialog-overlay').fadeOut(200, function () {\n        $(this).remove();\n      });\n    });\n\n    // \n    $('.dice-conflict-dialog-overlay').on('click', function (e) {\n      if ($(e.target).hasClass('dice-conflict-dialog-overlay')) {\n        $(this).fadeOut(200, function () {\n          $(this).remove();\n        });\n      }\n    });\n\n    //  toastr \n    if (window.toastr) {\n      window.toastr.error('', '', {\n        timeOut: 0,\n        extendedTimeOut: 0,\n        closeButton: true,\n        preventDuplicates: true,\n      });\n    }\n  };\n\n  const init = () => {\n    if (isInitialized) return;\n\n    console.log('[DICE]...');\n\n    //  ConsoleCaptureManager  localStorage\n    try {\n      ConsoleCaptureManager.restore();\n      console.info('[DICE]ConsoleCaptureManager ');\n    } catch (e) {\n      console.error('[DICE] ConsoleCaptureManager :', e);\n    }\n\n    // \n    try {\n      ErrorHandler.checkAndRestore();\n      console.info('[DICE]');\n    } catch (e) {\n      console.error('[DICE]:', e);\n    }\n\n    // \n    if (detectVisualizerConflict()) {\n      showConflictDialog();\n      console.error('[DICE] ');\n      return; // \n    }\n\n    console.info('[DICE] MVU ...');\n    MvuModule.injectStyles();\n\n    //  Observer\n    if (observer) {\n      observer.disconnect();\n      observer = null;\n      console.info('[DICE] MutationObserver');\n    }\n    addStyles();\n    // 2.  SillyTavern \n    if (window.SillyTavern && window.SillyTavern.eventSource) {\n      console.info('[DICE] SillyTavern ...');\n      const events = window.SillyTavern.eventTypes;\n      const source = window.SillyTavern.eventSource;\n      const triggers = [events.CHAT_CHANGED, events.MESSAGE_SWIPED, events.MESSAGE_DELETED, events.MESSAGE_UPDATED];\n\n      // \n      if (!_boundRenderHandler) {\n        _boundRenderHandler = () => {\n          if (!isEditingOrder) {\n            console.info('[DICE]');\n            setTimeout(renderInterface, 500);\n          } else {\n            console.info('[DICE]');\n          }\n        };\n      }\n\n      // \n      if (!window._acuBoundChatChangeHandler) {\n        window._acuBoundChatChangeHandler = () => {\n          console.info('[DICE]');\n          cachedRawData = null;\n          tablePageStates = {};\n          tableSearchStates = {};\n          tableScrollStates = {};\n          hasUnsavedChanges = false;\n          currentDiffMap.clear();\n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          setTimeout(renderInterface, 500);\n        };\n      }\n      const _boundChatChangeHandler = window._acuBoundChatChangeHandler;\n\n      triggers.forEach(evt => {\n        if (evt) {\n          source.removeListener(evt, _boundRenderHandler);\n          source.removeListener(evt, _boundChatChangeHandler); // \n          if (evt === events.CHAT_CHANGED) {\n            source.on(evt, _boundChatChangeHandler);\n          } else {\n            source.on(evt, _boundRenderHandler);\n          }\n        }\n      });\n      console.info(`[DICE] ${triggers.length} `);\n    } else {\n      console.warn('[DICE]SillyTavern ');\n    }\n\n    // 3.  API \n    const loop = () => {\n      const api = getCore().getDB();\n      if (api?.exportTableAsJson) {\n        isInitialized = true;\n        console.log('[DICE]');\n        console.info('[DICE] API ');\n\n        // --- [Fix]  API  #chat  () ---\n        const $chat = $('#chat');\n        if ($chat.length && !observer) {\n          console.info('[DICE] MutationObserver');\n          let mutationLock = false;\n          const handleMutation = () => {\n            if (mutationLock) return;\n            mutationLock = true;\n            requestAnimationFrame(() => {\n              const config = getConfig();\n              if (config.positionMode === 'embedded') {\n                mutationLock = false;\n                return;\n              }\n\n              const children = $chat.children();\n              const lastChild = children.last()[0];\n              const wrapper = $('.acu-wrapper')[0];\n\n              if (wrapper && lastChild && lastChild !== wrapper) {\n                if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n                  $chat.append(wrapper);\n                }\n              }\n\n              // [] \n              const diceCfg = getDiceConfig();\n              if (diceCfg && diceCfg.hideDiceResultInChat) {\n                // 1\n                const children = $chat.children();\n                const lastChild = children.last();\n                if (lastChild.hasClass('mes') || lastChild.hasClass('message-body')) {\n                  lastChild.addClass('acu-dice-result-revealing');\n                }\n\n                // 2RAF\n                requestAnimationFrame(() => {\n                  hideDiceResultsInUserMessages();\n\n                  // 3\n                  requestAnimationFrame(() => {\n                    lastChild.removeClass('acu-dice-result-revealing').addClass('acu-dice-result-revealed');\n                    // \n                    setTimeout(() => {\n                      lastChild.removeClass('acu-dice-result-revealed');\n                    }, 200);\n                  });\n                });\n              }\n\n              mutationLock = false;\n            });\n          };\n          observer = new MutationObserver(handleMutation);\n          observer.observe($chat[0], { childList: true });\n        } else if (!$chat.length) {\n          console.warn('[DICE] (#chat)  MutationObserver ');\n        }\n        // --------------------------------------------------\n\n        console.info('[DICE]...');\n        renderInterface(); // \n        // [] \n        setTimeout(() => {\n          hideDiceResultsInUserMessages();\n        }, 500);\n        // \n        if (api.registerTableUpdateCallback) {\n          api.registerTableUpdateCallback(UpdateController.handleUpdate);\n          console.info('[DICE]');\n\n          // \n          if (api.registerTableFillStartCallback) {\n            api.registerTableFillStartCallback(() => {\n              const current = api.exportTableAsJson();\n              if (current) saveSnapshot(current);\n            });\n            console.info('[DICE]');\n          }\n        } else {\n          console.warn('[DICE] API ');\n        }\n      } else {\n        //  ( 60)\n        if (!isInitialized) {\n          window._acuInitRetries = (window._acuInitRetries || 0) + 1;\n          if (window._acuInitRetries < 60) {\n            if (window._acuInitRetries % 10 === 0) {\n              console.info(`[DICE] API ... (${window._acuInitRetries}/60)`);\n            }\n            setTimeout(loop, 1000);\n          } else {\n            console.error('[DICE] API');\n          }\n        }\n      }\n    };\n    loop();\n\n    // []  - \n    const setupOptionHideListener = () => {\n      const { $ } = getCore();\n      const hideOptionPanel = () => {\n        optionPanelVisible = false;\n        $('.acu-option-panel, .acu-embedded-options-container').fadeOut(200, function () {\n          $(this).remove();\n        });\n      };\n\n      const pendingCrazyAppend = new Map<number, { result: string; createdAt: number }>();\n      const CRAZY_APPEND_TTL_MS = 12000;\n      let lastCrazyPreSendAt = 0;\n\n      const normalizeMessageId = (messageId: number | string) => {\n        const id = typeof messageId === 'string' ? Number(messageId) : messageId;\n        return Number.isFinite(id) ? id : null;\n      };\n\n      const hasDiceResultInText = (text: string) => {\n        if (!text) return false;\n        const contestRegex =\n          /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n        const normalRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n        return contestRegex.test(text) || normalRegex.test(text);\n      };\n\n      const insertDiceIntoUserInputBlock = (text: string, diceResult: string) => {\n        if (!text || !diceResult) return '';\n        const blockRegex = /(<>)([\\s\\S]*?)(<\\/>)/;\n        const blockMatch = text.match(blockRegex);\n        if (!blockMatch) return '';\n        const inner = blockMatch[2];\n        if (inner.includes(diceResult)) return '';\n        const prefix = inner.startsWith('\\n') ? '\\n' : '';\n        const suffix = inner.endsWith('\\n') ? '\\n' : '';\n        const trimmedInner = inner.trim();\n        const newInner = trimmedInner ? `${trimmedInner} ${diceResult}` : diceResult;\n        const textWithoutDice = text.includes(diceResult) ? text.replace(diceResult, '').trim() : text;\n        return textWithoutDice.replace(blockRegex, `${blockMatch[1]}${prefix}${newInner}${suffix}${blockMatch[3]}`);\n      };\n\n      const applyCrazyModeToPrompt = (type: string, params: unknown, dryRun: boolean) => {\n        if (dryRun) return;\n        const safeParams = params && typeof params === 'object' ? (params as Record<string, unknown>) : {};\n        const quietPrompt = typeof safeParams.quiet_prompt === 'string' ? safeParams.quiet_prompt : '';\n        const automaticTrigger = safeParams.automatic_trigger === true;\n        const alreadyApplied = safeParams._acu_crazy_applied === true;\n        if (alreadyApplied || automaticTrigger) return;\n        if (type === 'quiet' || quietPrompt.trim().length > 0) return;\n\n        const now = Date.now();\n        if (now - lastCrazyPreSendAt < 300) return;\n\n        const originalPrompt = typeof safeParams.prompt === 'string' ? safeParams.prompt : '';\n        if (!originalPrompt || !originalPrompt.trim()) return;\n        if (hasDiceResultInText(originalPrompt)) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        let finalPrompt = '';\n        if (originalPrompt.includes('<>')) {\n          const inserted = insertDiceIntoUserInputBlock(originalPrompt, crazyRollResult);\n          finalPrompt =\n            inserted && inserted !== originalPrompt ? inserted : `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n        } else {\n          finalPrompt = `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n        }\n\n        safeParams.prompt = finalPrompt;\n        safeParams._acu_crazy_applied = true;\n        lastCrazyPreSendAt = now;\n      };\n\n      const triggerCrazyModeBeforeSend = () => {\n        const now = Date.now();\n        if (now - lastCrazyPreSendAt < 300) return;\n\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        const content = ($ta.val() || '').toString().trim();\n        if (!content) return;\n        if (hasDiceResultInText(content)) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        smartInsertToTextarea(crazyRollResult, 'dice');\n        const updatedValue = ($ta.val() || '').toString();\n        if (updatedValue) {\n          const textarea = $ta[0] as HTMLTextAreaElement;\n          textarea.value = updatedValue;\n          textarea.dispatchEvent(new Event('input', { bubbles: true }));\n          textarea.dispatchEvent(new Event('change', { bubbles: true }));\n        }\n        lastCrazyPreSendAt = now;\n      };\n\n      const queueCrazyAppend = (messageId: number | string) => {\n        const id = normalizeMessageId(messageId);\n        if (id === null) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        pendingCrazyAppend.set(id, { result: crazyRollResult, createdAt: Date.now() });\n        void applyCrazyAppend(id);\n      };\n\n      const applyCrazyAppend = async (messageId: number | string) => {\n        const id = normalizeMessageId(messageId);\n        if (id === null) return;\n\n        const pending = pendingCrazyAppend.get(id);\n        if (!pending) return;\n\n        if (Date.now() - pending.createdAt > CRAZY_APPEND_TTL_MS) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        const stChat = ST?.chat || window.parent?.SillyTavern?.chat;\n        const stMsg = stChat && typeof id === 'number' ? stChat[id] : null;\n        const msg = getChatMessages(id)[0];\n        if (!msg || msg.role !== 'user') {\n          if (!stMsg || !stMsg.is_user) {\n            pendingCrazyAppend.delete(id);\n            return;\n          }\n        }\n\n        const originalText = String(stMsg?.mes ?? msg?.message ?? '');\n        if (hasDiceResultInText(originalText)) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        const extra = msg?.extra || stMsg?.extra || {};\n        if ((extra as { acuCrazyModeApplied?: boolean }).acuCrazyModeApplied) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        let newMessage = '';\n        if (originalText.includes('<>')) {\n          const inserted = insertDiceIntoUserInputBlock(originalText, pending.result);\n          newMessage = inserted && inserted !== originalText ? inserted : `${originalText} ${pending.result}`.trim();\n        } else {\n          newMessage = originalText ? `${originalText} ${pending.result}` : pending.result;\n        }\n        pendingCrazyAppend.delete(id);\n\n        if (stMsg && stMsg.is_user) {\n          stMsg.mes = newMessage;\n        }\n\n        try {\n          await setChatMessages(\n            [{ message_id: id, message: newMessage, extra: { ...extra, acuCrazyModeApplied: true } }],\n            { refresh: 'affected' },\n          );\n        } catch (e) {\n          console.warn('[DICE]: ', e);\n        }\n\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        if ($ta.length) {\n          const currentVal = ($ta.val() || '').toString();\n          if (currentVal === newMessage) {\n            $ta.val('').trigger('input').trigger('change');\n          }\n        }\n      };\n\n      // [] \n      const setupSendButtonListener = () => {\n        // []  value \n        interceptTextareaValue();\n\n        // [] \n        const sendButton = document.getElementById('send_but');\n        if (sendButton) {\n          const onSendCapture = () => {\n            // \n            triggerCrazyModeBeforeSend();\n            // \n            restoreDiceResultBeforeSend();\n          };\n          sendButton.addEventListener('click', onSendCapture, true);\n          sendButton.addEventListener('pointerup', onSendCapture, true);\n          sendButton.addEventListener('touchend', onSendCapture, true);\n        }\n\n        // jQuery\n        $(document)\n          .off('click.acu_restore_dice', '#send_but')\n          .on('click.acu_restore_dice', '#send_but', function (e) {\n            // \n            triggerCrazyModeBeforeSend();\n            // \n            restoreDiceResultBeforeSend();\n          });\n\n        // \n        const textarea = document.getElementById('send_textarea');\n        if (textarea) {\n          textarea.addEventListener(\n            'keydown',\n            function (e) {\n              //  ShiftShift+Enter \n              if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n                // \n                triggerCrazyModeBeforeSend();\n                // \n                restoreDiceResultBeforeSend();\n              }\n            },\n            true, // \n          );\n          textarea.addEventListener(\n            'keyup',\n            function (e) {\n              if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n                triggerCrazyModeBeforeSend();\n                restoreDiceResultBeforeSend();\n              }\n            },\n            true,\n          );\n        }\n\n        $('#send_textarea')\n          .off('keydown.acu_restore_dice')\n          .on('keydown.acu_restore_dice', function (e) {\n            //  ShiftShift+Enter \n            if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n              // \n              triggerCrazyModeBeforeSend();\n              // \n              restoreDiceResultBeforeSend();\n            }\n          })\n          .off('keyup.acu_restore_dice')\n          .on('keyup.acu_restore_dice', function (e) {\n            if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n              triggerCrazyModeBeforeSend();\n              restoreDiceResultBeforeSend();\n            }\n          });\n\n        // [] /\n        const observer = new MutationObserver(() => {\n          const $ta = $('#send_textarea');\n          if ($ta.length && !$ta[0]._acuValueIntercepted) {\n            interceptTextareaValue();\n          }\n        });\n        observer.observe(document.body, { childList: true, subtree: true });\n      };\n\n      const installCrazyGenerateHook = () => {\n        const rootWindow = window as Window & {\n          __acuCrazyGenerateHookInstalled?: boolean;\n          __acuCrazyGenerateOriginal?: (...args: unknown[]) => unknown;\n        };\n        if (rootWindow.__acuCrazyGenerateHookInstalled) return;\n        if (!rootWindow.TavernHelper || typeof rootWindow.TavernHelper.generate !== 'function') return;\n\n        rootWindow.__acuCrazyGenerateOriginal = rootWindow.TavernHelper.generate;\n        rootWindow.TavernHelper.generate = async function (...args: unknown[]) {\n          const options =\n            args.length > 0 && args[0] && typeof args[0] === 'object' ? (args[0] as Record<string, unknown>) : null;\n\n          if (options) {\n            const quietPrompt = typeof options.quiet_prompt === 'string' ? options.quiet_prompt : '';\n            const automaticTrigger = options.automatic_trigger === true;\n            const alreadyApplied = options._acu_crazy_applied === true;\n            if (!alreadyApplied && !automaticTrigger && quietPrompt.trim().length === 0) {\n              let originalPrompt = '';\n              const injects = options.injects;\n              if (Array.isArray(injects) && injects.length > 0) {\n                const first = injects[0];\n                if (first && typeof first === 'object') {\n                  const content = (first as Record<string, unknown>).content;\n                  if (typeof content === 'string') originalPrompt = content;\n                }\n              }\n              if (!originalPrompt && typeof options.prompt === 'string') {\n                originalPrompt = options.prompt;\n              }\n              if (!originalPrompt && typeof options.user_input === 'string') {\n                originalPrompt = options.user_input;\n              }\n\n              if (originalPrompt && !hasDiceResultInText(originalPrompt) && shouldTriggerCrazyMode()) {\n                const crazyRollResult = generateCrazyRoll();\n                if (crazyRollResult) {\n                  const mergedPrompt = `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n                  if (Array.isArray(injects) && injects.length > 0) {\n                    const first = injects[0];\n                    if (first && typeof first === 'object') {\n                      (first as Record<string, unknown>).content = mergedPrompt;\n                    }\n                  } else if (typeof options.prompt === 'string') {\n                    options.prompt = mergedPrompt;\n                  } else {\n                    options.user_input = mergedPrompt;\n                  }\n                  options._acu_crazy_applied = true;\n                  lastCrazyPreSendAt = Date.now();\n                  console.info('[DICE]: ');\n                }\n              }\n            }\n          }\n\n          return (rootWindow.__acuCrazyGenerateOriginal as (...args: unknown[]) => unknown).apply(this, args);\n        };\n        rootWindow.__acuCrazyGenerateHookInstalled = true;\n      };\n\n      // []  ( ST  -> )\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      // \n      const evtName =\n        ST?.eventTypes?.MESSAGE_SENT || (window.tavern_events ? window.tavern_events.MESSAGE_SENT : 'message_sent');\n\n      // 1.  ST.eventSource ()\n      if (ST?.eventSource) {\n        ST.eventSource.on(evtName, hideOptionPanel);\n        // [] \n        ST.eventSource.on(evtName, messageId => {\n          // \n          queueCrazyAppend(messageId);\n\n          // DOM\n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            setTimeout(() => {\n              hideDiceResultsInUserMessages();\n            }, 300);\n          }\n        });\n\n        // []  GENERATION_AFTER_COMMANDS \n        const afterCommandsEvtName =\n          ST?.eventTypes?.GENERATION_AFTER_COMMANDS ||\n          (window.tavern_events ? window.tavern_events.GENERATION_AFTER_COMMANDS : 'GENERATION_AFTER_COMMANDS');\n        if (afterCommandsEvtName) {\n          ST.eventSource.on(afterCommandsEvtName, (type, params, dryRun) => {\n            applyCrazyModeToPrompt(type, params, dryRun);\n          });\n        }\n\n        installCrazyGenerateHook();\n        setupSendButtonListener();\n        return;\n      }\n\n      // 2.  eventOn (TavernHelper )\n      if (typeof window.eventOn === 'function') {\n        window.eventOn(evtName, hideOptionPanel);\n        // [] \n        window.eventOn(evtName, messageId => {\n          // \n          queueCrazyAppend(messageId);\n\n          // DOM\n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            setTimeout(() => {\n              hideDiceResultsInUserMessages();\n            }, 300);\n          }\n        });\n\n        // []  GENERATION_AFTER_COMMANDS \n        const afterCommandsEvtName = window.tavern_events\n          ? window.tavern_events.GENERATION_AFTER_COMMANDS\n          : 'GENERATION_AFTER_COMMANDS';\n        window.eventOn(afterCommandsEvtName, (type, params, dryRun) => {\n          applyCrazyModeToPrompt(type, params, dryRun);\n        });\n\n        installCrazyGenerateHook();\n        setupSendButtonListener();\n        return;\n      }\n    };\n\n    // \n    setTimeout(setupOptionHideListener, 2000);\n\n    // [] \n    setTimeout(() => {\n      interceptTextareaValue();\n    }, 500);\n\n    // [] ERA\n    const eventOn = window.eventOn || window.parent?.eventOn;\n    if (typeof eventOn === 'function') {\n      eventOn('era:writeDone', detail => {\n        //  ERA \n        if (typeof MvuModule === 'object' && typeof MvuModule.clearCache === 'function') {\n          MvuModule.clearCache();\n        }\n\n        // ERA\n        const mode = MvuModule.detectMode();\n        if (mode === 'era' && getActiveTabState() === MvuModule.MODULE_ID) {\n          console.log('[DICE]ERA');\n          renderInterface();\n        }\n      });\n    } else {\n      console.warn('[DICE] ERA eventOn ');\n    }\n\n    // [] \n    $(window)\n      .off('beforeunload.acu pagehide.acu')\n      .on('beforeunload.acu pagehide.acu', () => {\n        try {\n          localStorage.setItem(STORAGE_KEY_SCROLL, JSON.stringify(tableScrollStates));\n          if (observer) {\n            observer.disconnect();\n            observer = null;\n          }\n        } catch (e) {}\n      });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  // window.testPairedTableFix()\n  window.testPairedTableFix = function () {\n    // \n    const prefix = 'AM';\n    const startFrom = 1;\n    const columnName = '';\n\n    // 1AM0001, AM0002, (), AM0030, ()\n    // AM0001, AM0002, AM0030\n    const table1Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        ['AM0001', '1', '1'],\n        ['AM0002', '2', '2'],\n        [null, '3-', '3-'], // \n        ['AM0030', '4', '4'],\n        [null, '5-', '5-'], // \n      ],\n    };\n\n    // 2(), AM0002, AM0030, AM0040, AM0050\n    // AM0002, AM0030, AM0040, AM0050\n    const table2Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        [null, 'A-', 'A-'], // \n        ['AM0002', 'B', 'B'],\n        ['AM0030', 'C', 'C'],\n        ['AM0040', 'D', 'D'],\n        ['AM0050', 'E', 'E'],\n      ],\n    };\n\n    // \n    const extract1 = extractCodesFromTable(table1Sheet, columnName, prefix);\n    const extract2 = extractCodesFromTable(table2Sheet, columnName, prefix);\n\n    // \n    const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n    // \n    const rawData = {};\n    const result = alignAndFixPairedTables(\n      table1Sheet,\n      'sheet1',\n      table2Sheet,\n      'sheet2',\n      columnName,\n      mapping,\n      prefix,\n      startFrom,\n      rawData,\n    );\n\n    // \n    const getValidCodes = sheet =>\n      sheet.content\n        .slice(1)\n        .map(r => r[0])\n        .filter(c => c && String(c).match(new RegExp(`^${prefix}\\\\d+$`)));\n\n    const codes1 = getValidCodes(table1Sheet);\n    const codes2 = getValidCodes(table2Sheet);\n\n    // \n    const emptyRows1 = table1Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix}\\\\d+$`)));\n    const emptyRows2 = table2Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix}\\\\d+$`)));\n\n    // \n    const validateSequence = (codes, prefix, startFrom) => {\n      const numbers = codes\n        .map(c => {\n          if (!c) return null;\n          const match = c.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          return match ? parseInt(match[1], 10) : null;\n        })\n        .filter(n => n !== null);\n\n      for (let i = 0; i < numbers.length; i++) {\n        if (numbers[i] !== startFrom + i) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    const isValid1 = validateSequence(codes1, prefix, startFrom);\n    const isValid2 = validateSequence(codes2, prefix, startFrom);\n\n    // \n    const set1 = new Set(codes1);\n    const set2 = new Set(codes2);\n    const setsEqual = set1.size === set2.size && [...set1].every(c => set2.has(c));\n\n    // \n    const emptyRowsPreserved1 = emptyRows1.some(r => r[1] && r[1].includes(''));\n    const emptyRowsPreserved2 = emptyRows2.some(r => r[1] && r[1].includes(''));\n\n    return {\n      table1Sheet,\n      table2Sheet,\n      result,\n      codes1,\n      codes2,\n      emptyRows1,\n      emptyRows2,\n      isValid1,\n      isValid2,\n      setsEqual,\n      emptyRowsPreserved1,\n      emptyRowsPreserved2,\n      //  +  + \n      isValid: isValid1 && isValid2 && setsEqual && emptyRowsPreserved1 && emptyRowsPreserved2,\n    };\n  };\n\n  // \n  window.diagnoseDiceVariables = async function () {\n    if (typeof MvuModule !== 'undefined' && typeof MvuModule.diagnoseVariableFramework === 'function') {\n      return await MvuModule.diagnoseVariableFramework();\n    } else {\n      console.error('[DICE]MvuModule ');\n      return null;\n    }\n  };\n\n  const { $ } = getCore();\n  if ($) $(document).ready(init);\n  else window.addEventListener('load', init);\n})();\n"],"names":["EMOJI_MAP","LOCATION_EMOJI_MAP","ELEMENT_EMOJI_MAP","SCRIPT_ID","LockManager","STORAGE_KEY_PREFIX","MAX_CONTEXTS","PRIMARY_KEYS","_cache","_currentContextId","_getStorageKey","ctxId","this","getCurrentContextFingerprint","_cleanupOldContexts","prefix","allKeys","i","localStorage","length","key","startsWith","push","keyWithTime","map","data","JSON","parse","getItem","time","_lastAccess","sort","a","b","toDelete","slice","forEach","item","removeItem","console","log","e","warn","_load","stored","_save","dataToSave","Date","now","setItem","stringify","getRowKey","tableName","row","headers","pkField","fieldIndex","idx","indexOf","lockField","rowKey","fieldName","value","_fullRow","_fields","_snapshot","lockRow","rowData","snapshot","h","unlockField","lock","Object","keys","unlockRow","isFieldLocked","hasOwnProperty","isRowLocked","applyLocks","tableContent","tableLocks","modified","restored","rowIndex","entries","undefined","newRow","_rebuildRow","fields","field","colIdx","Array","fill","hasAnyLock","getLockedFields","clearCurrentContext","BookmarkManager","isBookmarked","toggleBookmark","getBookmarks","escapeHtml","s","String","replace","showPresetConflictDialog","options","getCore","$","remove","getThemeColors","config","getConfig","suggestedName","baseName","existingNames","includes","counter","newName","generateUniqueName","presetName","dialogHtml","theme","presetType","$dialog","append","style","cssText","closeDialog","find","click","onCancel","on","target","hasClass","mode","val","onOverwrite","onRename","smartInsertToTextarea","newContent","contentType","$ta","currentVal","trim","normalDiceRegex","contestDiceRegex","actionRegex","placeholderRegex","diceCfg","getDiceConfig","contentToInsert","shouldSaveOriginal","hideDiceResultFromUser","trigger","textarea","_acuOriginalDiceText","_acuHasDiceData","workingText","existingAction","existingDice","existingDiceOriginal","test","originalText","contestMatches","match","normalMatches","actionMatches","userInput","parts","finalVal","join","restoreDiceResultBeforeSend","restoredVal","removeData","interceptTextareaValue","_acuValueIntercepted","originalDescriptor","getOwnPropertyDescriptor","HTMLTextAreaElement","prototype","originalValue","defineProperty","get","call","_value","set","configurable","STORAGE_KEY_TABLE_ORDER","STORAGE_KEY_ACTION_ORDER","STORAGE_KEY_PENDING_DELETIONS","STORAGE_KEY_ACTIVE_TAB","STORAGE_KEY_UI_CONFIG","STORAGE_KEY_LAST_SNAPSHOT","STORAGE_KEY_IS_COLLAPSED","STORAGE_KEY_OPTIONS_COLLAPSED","STORAGE_KEY_DASHBOARD_ACTIVE","STORAGE_KEY_TABLE_HEIGHTS","STORAGE_KEY_TABLE_STYLES","STORAGE_KEY_HIDDEN_TABLES","STORAGE_KEY_REVERSE_TABLES","MIN_PANEL_HEIGHT","MAX_PANEL_HEIGHT","STORAGE_KEY_DICE_CONFIG","STORAGE_KEY_ATTRIBUTE_PRESETS","STORAGE_KEY_ACTIVE_ATTR_PRESET","STORAGE_KEY_ACTION_PRESETS","STORAGE_KEY_ACTIVE_ACTION_PRESET","STORAGE_KEY_CRAZY_MODE","DEFAULT_CRAZY_MODE_CONFIG","enabled","crazyLevel","playerWeight","inSceneNpcWeight","offSceneNpcWeight","PRESET_FORMAT_VERSION","compareVersion","v1","v2","normalizeVersion","v","nv1","nv2","parts1","split","Number","parts2","Math","max","p1","p2","STORAGE_KEY_AVATAR_MAP","STORAGE_KEY_MAP_FOCUS","ConsoleCaptureManager","logs","maxLogs","filters","info","error","originalMethods","isIntercepted","restore","enable","intercept","disable","emergencyBtn","document","getElementById","display","type","self","args","apply","capture","timestamp","timeStr","toLocaleTimeString","hour12","content","arg","stack","Error","logEntry","id","random","rawArgs","shift","clear","getFilteredLogs","filter","setFilters","ErrorHandler","errorCount","errorThreshold","lastErrorTime","errorWindow","fatalErrorDetected","isFatalError","source","lineno","colno","thirdPartyPatterns","errorInfo","errorSource","pattern","corePatterns","isCoreError","handleError","triggerFatalError","showEmergencyButton","btn","createElement","innerHTML","onmouseenter","background","transform","onmouseleave","onclick","window","showDebugConsoleModal","alert","body","appendChild","checkAndRestore","onerror","message","addEventListener","event","reason","STORAGE_KEY_REGEX_RULES","STORAGE_KEY_REGEX_PRESETS","STORAGE_KEY_REGEX_ACTIVE_PRESET","STORAGE_KEY_REGEX_ENABLED","STORAGE_KEY_VALIDATION_ENABLED","STORAGE_KEY_VALIDATION_MODE","RULE_TYPE_INFO","tableReadonly","name","scope","icon","desc","rowLimit","sequence","required","format","enum","numeric","relation","keyValue","BUILTIN_VALIDATION_RULES","description","builtin","targetTable","targetColumn","ruleType","startFrom","errorMessage","values","min","refTable","refColumn","valueType","valueMin","valueMax","STORAGE_KEY_BLACKLIST","STORAGE_KEY_BLACKLIST_VERSION","DEFAULT_BLACKLIST","BlacklistManager","getBlacklist","Store","storedVersion","isArray","Set","defaultItems","mergedItems","has","setBlacklist","list","resetToDefault","isBlacklisted","blacklist","lastPart","some","STORAGE_KEY_PRESETS","STORAGE_KEY_ACTIVE_PRESET","PresetManager","getAllPresets","_initDefaultPreset","needsSave","preset","version","_compareVersion","customRules","rules","r","builtinRuleIds","mergedRules","rule","ValidationRuleManager","clearCache","getActivePreset","presets","activeId","p","setActivePreset","createPreset","newPreset","createdAt","toISOString","duplicatePreset","deletePreset","filtered","updatePresetRules","exportPreset","mergePresetWithDefaults","presetId","builtinRuleMap","Map","processedCustomIds","newRule","existingRule","add","importPreset","json","autoMerge","importedVersion","needsMerge","_getBuiltinRulesVersion","rulesStr","hash","charCodeAt","toString","currentVersion","defaultPreset","_builtinVersion","oldCustom","resetDefaultPreset","_enabledCache","getAllRules","enabledStates","getEnabledStates","allRules","toggleRuleEnabled","ruleId","states","toggleRuleIntercept","getEnabledRules","addCustomRule","removeCustomRule","index","findIndex","splice","updateCustomRule","updates","getRule","getRulesByTable","RegexTransformationManager","_generateId","substr","_saveEnabledStates","getApplicableRules","columnName","tableNames","columnNames","priority","operation","flags","replacement","executeMode","testCases","security","maxMatchTime","maxMatches","maxInputLength","updatedAt","_syncRulesToActivePreset","activePreset","RegexPresetManager","removeRule","updateRule","sourcePresetId","sourcePreset","exportData","jsonString","RegexTransformationEngine","_regexCache","_buildFlags","result","caseInsensitive","global","multiline","unicode","sticky","_getRegex","hasLookbehind","hasLookahead","flagsStr","cacheKey","regex","lastIndex","RegExp","_scoreRegexComplexity","score","captureGroups","_getTimeoutForRule","complexity","baseTimeout","_safeReplace","oldValue","success","newValue","matched","timeout","startTime","elapsed","applyToValue","strValue","extracted","_extractFlags","patternWithoutFlags","patternStr","inlineFlagMatch","flagStr","applyToTable","tableData","totalApplied","errors","isSimpleFormat","sheetMap","simpleTable","sheet","sheetKey","contentRowIndex","dataObj","size","tableInfo","rows","colIndex","debug","tableError","errorMsg","applyToCell","applicableRules","currentValue","wasMatched","applyToRow","cell","previewBatchTransform","results","affectedCells","totalAffected","columnIndex","clearRegexCache","ValidationEngine","validateFormat","validateEnum","allowedValues","validateNumeric","strVal","numVal","endsWith","parseFloat","isNaN","validateRelation","rawData","refSheet","sheetId","columns","col","refColIndex","validateRequired","validateKeyValue","ruleConfig","processedValue","pairs","pair","colonIndex","substring","validateTableReadonly","oldContent","validateRowLimit","rowCount","validateSequence","numbers","allRowValues","rawValue","num","parseInt","n","expectedNum","checkTableRules","newData","violations","typeInfo","oldSheet","newSheet","padStart","rowIdx","validateValue","validateRow","rowTitle","ruleName","severity","validateAllData","allErrors","tableRules","fieldRules","rowErrors","validateTable","targetSheet","groupErrorsByTable","grouped","getErrorCount","LocalAvatarDB","DB_NAME","STORE_NAME","DB_VERSION","_db","_urlCache","init","Promise","resolve","reject","request","indexedDB","open","onsuccess","onupgradeneeded","db","objectStoreNames","contains","createObjectStore","keyPath","save","blob","store","transaction","objectStore","URL","revokeObjectURL","delete","put","url","createObjectURL","getKey","getAllNames","getAllKeys","getStats","getAll","items","totalSize","reduce","sum","count","totalSizeMB","toFixed","clearAll","getPlayerName","cachedRawData","getTableData","getPersonaName","w","parent","SillyTavern","getContext","ctx","name1","jQuery","$persona","first","text","getDisplayPlayerName","replaceUserPlaceholders","displayName","AvatarManager","load","raw","offsetX","offsetY","scale","aliases","getAsync","playerName","isPlayer","localUrl","userLocalUrl","primaryName","getPrimaryName","aliasLocalUrl","hasLocalAvatar","async","getOffsetX","_resolveByAlias","getOffsetY","getScale","setPosition","setScale","setAliases","exportTime","avatars","importData","jsonData","overwriteConflicts","current","stats","added","updated","skipped","imported","analyzeImport","valid","total","newItems","conflicts","getEmojiCandidates","candidates","emoji","getElementEmoji","MvuModule","MODULE_ID","cachedEraData","detectMode","_source","eventEmit","eventOn","Mvu","getMvuData","getEraData","timeoutId","setTimeout","eventOff","onResult","detail","clearTimeout","statData","statWithoutMeta","stat_data","delta_data","schema","isAvailable","getData","allVars","message_id","display_data","getMvuDataWithRetry","maxRetries","retryDelay","race","waitGlobalInitialized","_","attempt","isVWD","isSimpleArray","every","countChildren","k","extractNumericDisplayValue","str","rangeMatch","slashNumericMatch","commaDescMatch","numericDescMatch","extractFirstNumericValue","displayValue","renderRow","path","deltaData","changeIndicator","part","oldVal","newVal","getChangeIndicator","changedClass","valueClass","diceIconHtml","isNumericCell","numericValue","attrName","pathParts","renderCard","depth","defaultExpanded","isHorizontal","childCount","collapsedClass","bodyHtml","hasNestedCards","nestedCardCount","childKey","childValue","childPath","itemPath","countText","bodyClass","nestedCardsNeedWidth","getDataWithRetry","detection","eraData","mvuData","detectModeWithData","diagnoseVariableFramework","era","available","dataAvailable","mvu","apiExists","getDataExists","cache","hasCache","cacheKeys","recommendation","injectStyles","targetDoc","styleEl","textContent","head","renderNavButton","isActive","renderPanel","isEraMode","isNumericMode","layoutMode","panelTitle","numericHtml","visibleLevels","saved","numericItems","collectNumericItems","obj","levelNames","itemValue","numValue","newLevelNames","topKeys","filteredNumericItems","lastLevelKey","nonArrayLevels","level","allLevelNames","levelNamesArray","from","levelTogglesHtml","buttonTextColor","buttonTextOnAccent","textMain","levelButtonsHtml","levelName","isVisible","activeStyle","itemsHtml","pathLevels","hierarchyLevels","allLevelsVisible","pathDisplay","finalAttrName","displayStyle","levelsJson","renderNumericMode","cardsHtml","bindEvents","$container","$panel","off","stopPropagation","$card","closest","$body","is","hide","removeClass","addClass","slideDown","slideUp","refresh","newMode","saveActiveTabState","currentTab","getActiveTabState","renderInterface","toastr","toggleClass","$button","css","color","borderColor","opacity","attr","each","$item","levels","newPathDisplay","$value","showEditDialog","setValue","preventDefault","$icon","attrValue","showDicePanel","targetValue","targetName","initiatorName","fromMvu","parsedInfo","initiator","filteredParts","parseMvuPathForDice","mvuPath","mvuParsedInfo","$doc","touchStartX","touchStartY","isHorizontalSwipe","originalEvent","touches","clientX","clientY","touch","deltaX","abs","deltaY","stopImmediatePropagation","$input","focus","button","handle","setPointerCapture","pointerId","startHeight","height","startY","onpointermove","moveE","dy","newHeight","onpointerup","upE","releasePointerCapture","getTableHeights","saveTableHeights","heights","onSave","html","$overlay","select","ctrlKey","parsedValue","onWriteDone","setEraValue","setMvuVariable","is_recursive","replaceMvuData","isModuleTab","$refreshBtn","then","actualData","warning","catch","err","DEFAULT_DICE_CONFIG","critSuccessMax","hardSuccessDiv","difficultSuccessDiv","critFailMin","lastDiceType","dndCritSuccess","dndCritFail","contestTieRule","hideDiceResultInChat","saveDiceConfig","cfg","oldCfg","newCfg","changedKeys","hideDiceResultsInUserMessages","hideInput","hideChat","textareaVal","modifiedText","contestRegex","normalRegex","lastMessageId","getLastMessageId","userMessages","getChatMessages","role","hiddenCount","msg","$msgElement","retrieveDisplayedMessage","$mesText","currentDomText","currentHtml","modifiedHtml","contestPattern","normalPattern","restoredCount","BUILTIN_ATTRIBUTE_PRESETS","baseAttributes","formula","range","modifier","specialAttributes","AttributePresetManager","presetVersion","finalId","updatePreset","exported","jsonStr","autoUpdate","needsUpdate","BUILTIN_ACTION_PRESETS","table_keywords","actions","label","template","ActionPresetManager","getPresetById","getActivePresetId","setActivePresetId","getCrazyModeConfig","saveCrazyModeConfig","shouldTriggerCrazyMode","selectCrazyParticipant","allTables","processJsonData","playerResult","DashboardDataParser","findTable","npcResult","playerAttrs","getFullAttributesForCharacter","attrs","inScene","weight","parseRows","npc","inSceneVal","toLowerCase","isInScene","npcAttrs","totalWeight","weightedRandomSelect","selectCrazyAttribute","participant","randomAttr","floor","allPresetAttrs","randomPresetAttr","defaultValue","skillPool","getRandomSkillPool","crazyRollD100","judgeCrazyRollResult","roll","generateCrazyRoll","contestChance","selectCrazyRollType","participant1","participant2","candidate","attr1","attr2","roll1","roll2","result1","result2","margin1","margin2","winner","rollDiceExpression","expr","NaN","countStr","sidesStr","keepDrop","sides","rolls","rollDice","kd","generateAttributeValue","context","varNames","Function","round","evaluateFormula","DASHBOARD_TABLE_CONFIG","tableKeywords","detailLocation","keywords","fallbackIndex","currentLocation","player","status","position","isMultiple","money","resources","location","quest","progress","active","column","excludeColumn","excludes","bag","skill","equip","isEquipped","equipped","moduleKey","keyword","findColumnIndex","columnKey","moduleConfig","colConfig","kw","getValue","getColumnMap","colKey","tableResult","colMap","parsed","_rowIndex","_raw","applyFilter","parsedRows","filterKey","matchInclude","inc","excludeValue","matchExclude","exc","DEFAULT_GM_CONFIG","diceSystem","showDiceIcon","autoSendPrompt","action_groups","auto_send","THEME_COLORS","retro","bgPanel","border","textSub","btnBg","btnHover","accent","tableHead","successText","successBg","inputBg","inputText","placeholderText","btnActiveBg","btnActiveText","failureText","failureBg","warningText","warningBg","critSuccessText","critSuccessBg","critFailureText","critFailureBg","extremeSuccessText","extremeSuccessBg","overlayBg","overlayBgLight","shadowBg","lightBg","veryLightBg","buttonText","grayBg","errorText","errorBg","errorBorder","warningIcon","dark","modern","forest","ocean","cyber","buttonBg","buttonBgActive","presetButtonBg","presetButtonBgActive","nightowl","sakura","minepink","purple","wechat","educational","galgame","vaporwave","classicpackaging","terminal","dreamcore","chouten","isLightTheme","getResultBadgeStyle","resultType","t","styles","critSuccess","bg","extremeSuccess","failure","critFailure","padding","ACTION_ICON_MAP","getActionsForTable","baseConfig","action_rules_disabled","customActionGroups","action","custom_action_groups","getGMConfig","lowerName","group","builtinRules","getInteractOptionsForRow","defaultActions","interactColIdx","invalidValues","cellValue","interactOptions","existingLabels","newActions","opt","extractNumericValue","matches","parseAttributeString","rawStr","jsonObj","parseRelationshipString","trimmed","colonMatch","parenMatch","isRelationshipCell","headerName","lowerHeader","processTemplate","cardData","header","ACTION_BUTTONS","title","isInitialized","isSaving","isEditingOrder","isSettingsOpen","currentDiffMap","observer","_boundRenderHandler","hasUnsavedChanges","isAutoTransforming","tablePageStates","tableSearchStates","lastOptionHash","optionPanelVisible","STORAGE_KEY_SCROLL","tableScrollStates","UpdateController","_lastValidationCount","_isRollingBack","handleUpdate","loadSnapshot","api","getDB","fillTable","timeOut","positionClass","fillError","newCount","updateValidationIndicator","$indicator","show","getCurrentChatId","chatId","DEFAULT_CONFIG","layout","collapseStyle","collapseAlign","fontFamily","cardWidth","fontSize","highlightNew","itemsPerPage","actionsPosition","gridColumns","positionMode","showOptionPanel","clickOptionToAutoSend","optionFontSize","FONTS","THEMES","_coreCache","core","AutoCardUpdaterAPI","clipboard","navigator","ST","top","updateSaveButtonState","$btn","deletions","getPendingDeletions","hasDeletions","getIconForTableName","getBadgeStyle","def","retryErr","_acuQuotaAlerted","savePendingDeletions","getSavedTableOrder","saveTableOrder","getCollapsedState","saveCollapsedState","getOptionsCollapsedState","currentCtx","_contextId","saveSnapshot","getTableStyles","getHiddenTables","getReverseTables","toggleTableReverse","getAttributesForCharacter","characterName","isUser","sheetName","nameColIdx","getAttributeValue","found","STANDARD_ATTRS","getStandardAttrs","allAttrs","allPresets","RANDOM_SKILL_POOL","generateRPGAttributes","isDNDOrPreset","isDND","generate3d6","generateValue","base","adjust","special","baseResult","specialResult","clearPresetAttributesForCharacter","charName","targetRowIndex","targetColIndex","existingStr","existingAttrs","standardAttrs","presetAttrNames","newAttrString","saveDataOnly","attrString","writeAttributesToCharacter","newAttrs","existingMap","standardCount","isComplete","customAttrs","resultParts","writtenAttrs","wasComplete","initCustomDropdown","themeColors","inputId","wrap","$dropdown","after","renderItems","lowerFilter","hideDropdown","addClearButton","inputSelector","$clearBtn","showDiceSettingsPanel","ruleTitle","resetText","defaults","critFail","hardDiv","extremeDiv","currentCritSuccess","currentCritFail","currentHardDiv","currentExtremeDiv","tieRule","cocExtraHtml","panelHtml","left","right","bottom","width","hover","closePanel","$stepper","step","updateValue","getCurrentValue","getStepperValue","critSuccessVal","critFailVal","hardDivVal","extremeDivVal","resetStepper","savedDiceType","rawDataForList","diceCharacterList","diceAttrList","diceType","successCriteria","initialAttrValue","initialTargetValue","inputTextColor","inputStyle","overlay","defaultCriteria","panel","buildAttrButtons","$parentSection","prop","originalHtml","originalHandler","generated","baseAttrs","specialAttrs","confirm","shortName","buildCharButtons","randomSkill","newAttrList","convertTargetForDice","currentTarget","fromDice","toDice","getMaxRoll","dice","fromMax","toMax","ratio","updateRuleMode","$targetInput","$difficultyWrapper","$row3","currentDiceType","newDice","suggestedCriteria","currentTargetVal","convertedVal","newMax","customDice","performDiceRoll","mod","modStr","isFinite","remaining","dicePattern","exec","diceResult","numberPattern","numMatch","parseModifier","criteria","difficulty","targetInputVal","attrInputVal","isAutoTarget","getDefaultTarget","formulaStr","maxRoll","finalValue","requiredTarget","difficultyLabel","difficultyDiv","isCritSuccess","isCritFailure","isSuccess","outcomeText","outcomeClass","extremeTarget","hardTarget","criteriaSymbol","displayOutcomeText","badgeStyle","badgeStyleStr","$rollBtn","judgeExpr","formulaText","attrValueInput","currentDice","initiatorNameVal","showContestPanel","initiatorValue","currentCriteria","opponentName","passedInitiatorName","passedInitiatorValue","passedOpponentValue","opponentValue","opponentAttrs","characterList","contestAttrList","attrStr","targetType","buildCharBtns","containerId","rebuildAttrBtns","aname","refreshedAttrs","initAttrs","oppAttrs","fullAttrs","getSuccessLevel","performContestRoll","initValue","initName","initAttrName","getHalfMax","m","initValueInput","initTarget","initTargetInput","oppValue","oppName","oppAttrName","oppValueInput","oppTarget","oppTargetInput","winnerColor","initResult","oppResult","initSuccess","oppSuccess","displayInitValue","displayOppValue","displayInitSuccessName","displayOppSuccessName","displayWinner","getResultTypeFromSuccess","initResultType","oppResultType","initBadgeStyle","oppBadgeStyle","winnerBadgeStyle","initBadgeStyleStr","oppBadgeStyleStr","winnerBadgeStyleStr","$resultDisplay","$resultInit","$resultOpp","$contestBtn","contestResultText","currentInitName","parseInSceneStatus","buildMapViewModel","globalResult","locationResult","elementResult","globalHeaders","globalRow","globalConfig","detailIdx","regionIdx","currentRegion","locations","locationHeaders","locationRows","locationNameIdx","locationRegionIdx","locationTypeIdx","locationDescIdx","locationImportanceIdx","locationExploreIdx","allLocationNames","emojiMap","names","candidatesMap","sortedNames","localeCompare","usedEmojis","resolveBatchLocationEmojis","region","locationType","importance","exploreStatus","tableKey","elements","elementHeaders","elementRows","elementNameIdx","elementTypeIdx","elementLocationIdx","elementDescIdx","elementStatusIdx","elementInteractIdx","locationName","rawInteractions","interactions","Boolean","typeValue","element","addElement","characters","addCharacter","character","avatarUrl","full","avatarOffsetX","avatarOffsetY","avatarScale","playerLocation","playerConfig","playerHeaders","playerRow","playerNameIdx","playerPosIdx","playerNameRaw","playerPosRaw","npcConfig","npcHeaders","npcRows","npcNameIdx","npcPosIdx","npcInSceneIdx","npcName","inSceneValue","inSceneHeader","firstLocation","next","allRegions","l","otherIndex","focusLocation","fallbackRegion","regionLocations","regionName","scoreA","getHotLocationsInRegion","isMapOpening","showMapVisualization","viewModel","tabSelectionCache","selectedRegion","targetLocation","overlayEl","setProperty","$focusArea","$thumbnails","renderElementChip","refreshPanel","model","leftChars","ceil","rightChars","leftElems","rightElems","renderAvatarHtml","char","avatarStyle","charAt","leftAvatarsHtml","rightAvatarsHtml","leftElemsHtml","rightElemsHtml","emojiHtml","renderFocusArea","thumbnails","totalCount","badgeHtml","renderThumbnailLocation","regions","newRegion","cachedLocation","hotLocations","fallbackFocus","targetRegion","showRelationshipGraph","npcTable","nameIdx","relationIdx","npcTableKey","nodes","edges","resolveName","personaName","isExplicitUserVariant","isPersonaName","isPlayerName","resolveUserPlaceholder","resolvedPlayerName","playerTableKey","x","y","inSceneColIdx","rawNpcName","relationStr","rel","resolvedRelName","relRowIndex","relIsInScene","ri","cleanedLabels","rawRel","commonRelations","specialSuffixMatch","lastChars","cleanRelation","existingEdge","combined","labelsFromSource","labelsFromTarget","nodeArr","connectionCount","node","edge","isMobileView","innerWidth","baseRadius","maxRadius","playerBaseRadius","radiusPerConnection","nodeSizeMultiplier","filterInScene","filterDirectOnly","getNodeRadius","nodeName","sqrt","radius","getLayoutCacheKey","loadLayoutCache","cached","layoutData","allNodesFound","vx","vy","runForceDirectedLayout","angle","PI","dist","cos","sin","nodeMap","iter","u","j","dx","distSq","force","fx","fy","maxSpeed","vMag","saveLayoutCache","panX","panY","$svg","$transform","$edgesGroup","$nodesGroup","$zoomDisplay","$nodeSizeDisplay","$wrapper","updateTransform","updateNodeSizeDisplay","zoomTo","newScale","centerX","centerY","oldScale","scaleChange","render","filteredNodes","directNodes","passInScene","passDirectOnly","getFilteredNodes","filteredNodeNames","filteredEdges","edgesHtml","edgeIdx","len","nx","ny","px","py","hasFromSource","hasFromTarget","sourceRadius","targetRadius","x1","y1","x2","y2","srcLabels","tgtLabels","srcSet","tgtSet","commonLabels","srcUnique","tgtUnique","markerStart","markerEnd","midX","midY","lineLen","lbl","offsetDir","offsetDist","safeOffset","relationEmojiMap","addRelationEmoji","truncateLabel","maxLen","truncated","labelsToShow","labelBaseX","labelBaseY","perpOffset","nodesHtml","nodeAvatar","indicatorRadius","indicatorOffset","inSceneIndicator","nodeDisplayName","scaleVal","foSize","shadowWidth","foOffset","highlightNode","connectedNodes","otherNode","connectedEdgeIndices","clearHighlight","matchMedia","currentHighlightedNode","$node","startX","hasMoved","longPressTriggered","longPressTimer","vibrate","table","rowName","tempNode","isPanning","panStartX","panStartY","panStartPanX","panStartPanY","lastPinchDist","activePointerId","wrapperEl","svgEl","onpointerdown","cursor","rect","getBoundingClientRect","onpointercancel","onwheel","delta","hypot","passive","newDist","$nodeSizeSlider","$sliderSizeDisplay","$sliderContainer","$nodeSizeDisplayTrigger","sliderVisible","sliderHideTimer","hideSlider","resetSliderHideTimer","triggerRect","wrapperRect","showSlider","$filterInSceneBtn","$filterDirectOnlyBtn","updateFilterToggleStyles","$nodeSizeStepper","updateNodeSizeValue","newPercent","getCurrentPercent","clearLayoutCache","showAvatarManager","closeGraph","showAvatarCropModal","imageSource","existing","modalHtml","$modal","$image","containerEl","imageEl","updateImageStyle","backgroundSize","backgroundPosition","isDragging","startOffsetX","startOffsetY","sensitivity","pinchStartScale","pinchRatio","file","files","saveLocalAvatar","newUrl","onUpdate","resolveUserPlaceholderForAvatar","buildList","listHtml","userNode","otherNodes","userNodeForDisplay","currentUrl","hasLocal","displayUrl","sourceLabel","hasAvatar","managerHtml","$manager","bindAvatarEvents","refreshItem","$preview","aliasesStr","deleteLocalAvatar","Blob","href","download","removeChild","reader","FileReader","onload","evt","analysis","showImportConfirmDialog","readAsText","closeManager","onComplete","hasConflicts","conflictListHtml","overwrite","showCardEditModal","displayRow","inputsHtml","dialog","adjustHeight","el","contentHeight","scrollHeight","overflowY","requestAnimationFrame","currentRow","hasChanges","saveDataToDatabase","_configCache","saveConfig","applyConfigStyles","generateDiffMap","currentData","lastData","diffSet","rIdx","newRows","oldRows","oldRow","cIdx","oldCell","fontVal","f","$styleTag","fontImport","cssVars","cls","$optContainer","addStyles","_acuStylesInjected","exportTableAsJson","sheetCount","skipRender","commitDeletes","$saveBtn","mate","sizeInMB","stringifyError","importTableAsJson","apiError","acuModifiedSet","tables","rawContent","exportConfig","updateConfig","refreshRegexRulesList","$rulesList","scopeIcon","scopeText","showAddValidationRuleModal","parentDialog","editRuleId","currentThemeClass","isEditMode","updateSelectColor","$select","$colSelect","$pairedTableSelect","currentPairedValue","empty","refTableName","$refColSelect","isTableRule","valuesStr","refColumns","selectedColumns","pairedTable","finalRuleId","ruleData","$existingItem","isEnabled","ruleHtml","showSmartFixModal","snapshotValue","hasSnapshotValue","showTableRuleFixModal","inputHtml","smartSuggestHtml","examples","currentRowIndex","maxCount","getColumnExamples","suggestedValue","existingValues","prefixMatch","digits","codeIndex","existingNumbers","codeValue","maxNum","nextNum","numOnlyMatch","suggestFormatValue","currentNum","isOutOfRange","nearestValid","getNearestValidNumber","getRelationOptions","hasMultipleColumns","currentInvalidValue","valueExists","isValueInRelationTable","optionsHtml","reverseWriteHtml","issues","fixedPairs","fixedVal","hasIssue","originalVal","fixedValue","hasIssues","issuesHtml","issue","optionValue","refSheetId","targetColIdx","extractCodesFromTable","codes","allCodes","codeToRows","isValid","buildCodeMapping","codes1","codes2","allUniqueCodes","codeNumbers","code","mapping","oldCode","newCode","alignAndFixPairedTables","table1Sheet","table1SheetId","table2Sheet","table2SheetId","fixedCount1","fixedCount2","headers1","rows1","colIndex1","headers2","rows2","colIndex2","reverseMapping","sortedNewCodes","analyzeTable","codeRows","emptyRows","prevOldCode","nextOldCode","emptyRow","prevCode","nextCode","codeRow","analysis1","analysis2","buildNewRows","allOldCodes","codeRowMap","cr","isCodeRow","isInserted","codeRowIndex","nextNewCode","currentNewCode","currentOldCode","newRows1","newRows2","countCodeChanges","oldAnalysis","oldCodes","newCodes","contentHtml","actionBtns","changeCount","changeDetails","c","d","minRows","maxRows","currentRowCount","excessRows","isTooMany","isTooFew","fixSuggestions","originalRowIndex","numCountMap","duplicates","gaps","outOfOrder","actualNum","rowNum","occurrences","issueSet","g","o","fix","pairedTableAttr","pairedTableName","targetSheetId","pairedSheet","pairedSheetId","pairedHeaders","extract1","extract2","fixedCount","startRow","showBlacklistManagerModal","updateTextarea","uniqueItems","syncFromTextarea","input","existingSet","addedItems","which","closeModal","showAttributePresetManager","isDefaultActive","allPresetsHtml","isBuiltin","showSettingsModal","$toggle","$thisToggle","showAttributePresetEditor","filename","parsedData","importingName","existingPresets","hasConflict","doImport","finalJson","existingPreset","isEdit","defaultData","$jsonTextarea","updateJSON","showActionPresetManager","presetsHtml","keywordsSummary","flatMap","actionsSummary","showActionPresetEditor","writeText","ta","execCommand","copyData","prompt","not","savedFilters","renderLogs","filteredLogs","$logContainer","typeColors","typeIcons","logItem","updateCounts","checked","$status","newState","line","toUpperCase","TavernHelper","triggerSlash","safeContent","isSecureContext","textArea","setAttribute","setSelectionRange","successful","refreshInterval","setInterval","clearInterval","showAddRegexRuleModal","editRule","scopeType","$textarea","extractedFlags","$flagGlobal","$flagIgnoreCase","$flagMultiline","uiFlags","finalPattern","finalFlags","expandedGroups","isGroupExpanded","groupId","SPECIAL_BUTTONS_CONFIG","tableManagerHtml","savedOrder","hiddenList","allItems","isSpecial","orderMap","isHidden","specialClass","chevron","hasIntercept","$group","$chevron","expanded","targetHeight","animate","currentHeight","outerHeight","newTheme","crazyConfig","selectValue","initCrazyModeUI","$list","dragState","timer","clearDragState","startDrag","targetItem","insertBefore","$dragged","$target","insertAfter","newOrder","unit","isCurrentlyActive","fadeOut","refreshPresetUI","accept","onchange","currentState","currentPreset","$presetSelect","defaultPresetId","enabledRules","renderInterfaceTimer","renderInterfacePending","_renderInterfaceImpl","$chat","mutationLock","MutationObserver","lastChild","children","last","wrapper","observe","childList","isDataFromDatabase","anyLockApplied","transformResult","transformError","structuredClone","existingSnapshot","hasValidSnapshotData","$searchInput","activeTab","currentTabName","newHtml","renderTableContent","$virtualDom","replaceWith","bindOptionEvents","lastScrollX","lastScrollY","$oldContent","scrollLeft","scrollTop","orderedNames","concat","isCollapsed","layoutClass","finalGridCols","empty3","optionHtml","currentOptionHash","optionTables","isOptionsCollapsed","collapseIcon","optionCount","hasBtns","optionValues","buttonsHtml","cellStr","encodeURIComponent","optionChanged","colStyleClass","alignClass","savedHeight","isDashboardActive","isChangesPanelActive","isMvuActive","finalSavedHeight","renderChangesPanel","renderDashboard","gridFixStyle","isChangesActive","isSimpleModeNav","changesCount","validationErrorCount","displayCount","showWarningIcon","navHiddenList","navSavedOrder","SPECIAL_NAV_ITEMS","extraClass","allNavItems","checkAvailable","activeClass","orderVal","warningIconHtml","$existing","insertHtmlToPage","injectIndependentOptions","bindChangesEvents","$newContent","savedState","inner","$targetTitle","htmlContent","$aiMes","$this","$targetMes","$targetText","getTargetContainer","optConfig","decodeURIComponent","createChatMessages","executeSlashCommandsWithOptions","cmd","sendResult","isError","isAborted","sendBtn","enterEvent","Event","keyCode","bubbles","$textDiv","hasImage","targetIndex","eq","$targetBlock","$oldWrapper","validationErrors","changes","rowChanges","changedFields","isValidationMode","groupedErrors","collapsedGroups","tableErrors","groupedChanges","tableChanges","change","oldShort","newShort","fieldDisplay","fieldCount","fieldNames","moreText","validationItemTouchStartPos","$targetCard","scrollIntoView","behavior","block","storageKey","changeType","refreshChangesPanel","restoredRow","showRowCompareEditModal","showChangeSingleFieldModal","showChangeEditModal","restoredData","updateChangesCount","finalHeight","$horizontalScroller","_touchStartX","_touchStartY","_scrollDirection","$span","hasOldValue","fieldsHtml","isChanged","questResult","bagResult","skillResult","equipResult","playerParsed","allAttrsStr","playerRows","globalDetailLocation","globalLocation","locIdx","currentPlaceName","npcTableName","npcParsed","inSceneNPCs","offSceneNPCs","npcData","allNPCs","questTableName","questParsed","activeQuestParsed","questTypeOrder","activeTasks","q","bagTableName","bagParsed","bagItems","skillTableName","skillParsed","skills","equipTableName","equipParsed","equippedItems","locationTableName","locationTableKey","locationParsed","resourcesStr","parsedResources","res","skillValue","hasNumeric","skillRowIndex","loc","areaName","isCurrent","npcIdx","isLastNpc","npcAvatar","offSceneFilter","isLastBag","isLast","isMain","progressPercent","progressMatch","progressBar","loadedModules","pendingDeletions","isGridMode","titleColIndex","processedRows","originalIndex","searchTerm","isReversed","isTableReversed","titleA","titleB","aHitTitle","bHitTitle","totalItems","totalPages","currentPage","startIdx","endIdx","rowsToRender","showReverseBtn","shouldShowReverseButton","reverseBtnHtml","realRowIdx","isPending","cardTitle","showDefaultIndex","titleCellId","isTitleModified","isRowNew","rowClass","validColIndices","isOddValidCount","cardBody","spanFullRow","rawHeaderName","lockRowKey","inlineLockIcon","safeStr","rawStrOriginal","invalidPlaceholders","hideLabel","splitRegex","isIdentityField","parsedAttrs","displayCell","validRelations","relHtml","attrsHtml","showDice","invalidTagValues","isDiffChanged","cellId","isUserModified","cellHighlight","tableActions","actionsHtml","act","actIdx","cardLockRowKey","cardLockIcon","cardBookmarkRowKey","bookmarkIcon","saveCurrentTabState","$content","innerScrolls","switchPanel","updateContentFn","dataError","managerError","scrollTimer","$navBtn","isPanelVisible","mvuSavedHeight","currentActiveTab","$cell","showCellMenu","$pageBtn","newPage","manualUpdate","searchTimeout","isComposing","selectionStart","selectionEnd","isFocus","activeElement","classList","$newInput","tName","actionIdx","$title","skillName","checkValue","attrValIdx","profIdx","promptText","sendMessage","ev","isPlayerTable","playerAttrValue","itemName","taskName","npcAttrValue","npcParts","npcMatch","relations","borderStyle","cardHtml","backdrop","isModified","currentHeader","hasAnyLockInRow","lockMenuHtml","menu","winWidth","winHeight","mWidth","outerWidth","mHeight","changedTouches","closeAll","fallbackCopy","$displayTarget","actOrd","dels","colCount","showConflictDialog","extendedTimeOut","closeButton","preventDuplicates","hasVisualizerNav","hasVisualizerDataDisplay","scripts","querySelectorAll","script","visualizerConfig","diceConfig","detectVisualizerConflict","disconnect","eventSource","events","eventTypes","triggers","CHAT_CHANGED","MESSAGE_SWIPED","MESSAGE_DELETED","MESSAGE_UPDATED","_acuBoundChatChangeHandler","_boundChatChangeHandler","removeListener","loop","registerTableUpdateCallback","registerTableFillStartCallback","_acuInitRetries","hideOptionPanel","pendingCrazyAppend","lastCrazyPreSendAt","normalizeMessageId","messageId","hasDiceResultInText","insertDiceIntoUserInputBlock","blockRegex","blockMatch","suffix","trimmedInner","newInner","applyCrazyModeToPrompt","params","dryRun","safeParams","quietPrompt","quiet_prompt","automaticTrigger","automatic_trigger","_acu_crazy_applied","originalPrompt","crazyRollResult","finalPrompt","inserted","triggerCrazyModeBeforeSend","updatedValue","dispatchEvent","queueCrazyAppend","applyCrazyAppend","pending","stChat","chat","stMsg","is_user","mes","extra","acuCrazyModeApplied","newMessage","setChatMessages","setupSendButtonListener","sendButton","onSendCapture","subtree","installCrazyGenerateHook","rootWindow","__acuCrazyGenerateHookInstalled","generate","__acuCrazyGenerateOriginal","injects","user_input","mergedPrompt","evtName","MESSAGE_SENT","tavern_events","afterCommandsEvtName","GENERATION_AFTER_COMMANDS","testPairedTableFix","getValidCodes","emptyRows1","emptyRows2","isValid1","isValid2","set1","set2","setsEqual","emptyRowsPreserved1","emptyRowsPreserved2","diagnoseDiceVariables","ready"],"ignoreList":[],"sourceRoot":""}