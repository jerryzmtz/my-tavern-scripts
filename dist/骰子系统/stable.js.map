{"version":3,"file":"stable.js","mappings":"AAWO,MAAMA,EAAgC,CAI3C,CAAC,SAAU,MACX,CAAC,iBAAkB,MACnB,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,MAAO,MACR,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,KAAM,OACP,CAAC,KAAM,MAKP,CAAC,KAAM,MACP,CAAC,YAAa,MACd,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,OAKP,CAAC,UAAW,MACZ,CAAC,UAAW,MACZ,CAAC,WAAY,MACb,CAAC,WAAY,OACb,CAAC,WAAY,MACb,CAAC,QAAS,MACV,CAAC,KAAM,OAKP,CAAC,SAAU,MACX,CAAC,cAAe,MAChB,CAAC,SAAU,OACX,CAAC,UAAW,OACZ,CAAC,WAAY,MAKb,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,aAAc,MACf,CAAC,WAAY,MACb,CAAC,SAAU,MACX,CAAC,KAAM,MACP,CAAC,SAAU,OACX,CAAC,KAAM,MACP,CAAC,MAAO,MACR,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,UAAW,MAKZ,CAAC,YAAa,MACd,CAAC,UAAW,MACZ,CAAC,MAAO,OACR,CAAC,UAAW,MACZ,CAAC,QAAS,MACV,CAAC,aAAc,MAKf,CAAC,UAAW,MACZ,CAAC,SAAU,MACX,CAAC,aAAc,MACf,CAAC,cAAe,OAChB,CAAC,WAAY,MAKb,CAAC,WAAY,MACb,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,QAAS,MAKV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,YAAa,MACd,CAAC,SAAU,OACX,CAAC,UAAW,MAMZ,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,OACV,CAAC,QAAS,KACV,CAAC,QAAS,OACV,CAAC,SAAU,MAGX,CAAC,UAAW,MACZ,CAAC,SAAU,MACX,CAAC,QAAS,MACV,CAAC,UAAW,MAGZ,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,OACV,CAAC,WAAY,OAGb,CAAC,KAAM,MACP,CAAC,KAAM,OACP,CAAC,UAAW,OACZ,CAAC,QAAS,MACV,CAAC,YAAa,OAGd,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,SAAU,MACX,CAAC,KAAM,OAGP,CAAC,KAAM,OACP,CAAC,KAAM,MACP,CAAC,MAAO,OACR,CAAC,KAAM,MACP,CAAC,QAAS,MAGV,CAAC,QAAS,MACV,CAAC,MAAO,OACR,CAAC,QAAS,MACV,CAAC,MAAO,MAGR,CAAC,OAAQ,MACT,CAAC,SAAU,MACX,CAAC,QAAS,MACV,CAAC,QAAS,OAKV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,OAAQ,MACT,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,UAAW,MACZ,CAAC,QAAS,MACV,CAAC,SAAU,MAKX,CAAC,MAAO,MACR,CAAC,MAAO,OACR,CAAC,MAAO,OACR,CAAC,MAAO,MACR,CAAC,QAAS,MACV,CAAC,QAAS,KACV,CAAC,QAAS,MAKV,CAAC,SAAU,MACX,CAAC,MAAO,KACR,CAAC,MAAO,MACR,CAAC,MAAO,MACR,CAAC,MAAO,MACR,CAAC,MAAO,MACR,CAAC,QAAS,MAKV,CAAC,SAAU,MACX,CAAC,SAAU,MACX,CAAC,SAAU,MACX,CAAC,MAAO,MACR,CAAC,MAAO,KACR,CAAC,SAAU,KACX,CAAC,SAAU,MACX,CAAC,KAAM,KAKP,CAAC,KAAM,MACP,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,MAAO,MACR,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,QAAS,QACV,CAAC,QAAS,MACV,CAAC,KAAM,OACP,CAAC,IAAK,MACN,CAAC,KAAM,MAKP,CAAC,aAAc,MACf,CAAC,cAAe,MAChB,CAAC,KAAM,MACP,CAAC,SAAU,MACX,CAAC,KAAM,MACP,CAAC,SAAU,MAKX,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,KAAM,OACP,CAAC,KAAM,MAKP,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,QAAS,MACV,CAAC,KAAM,OAKP,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,QAAS,SACV,CAAC,QAAS,MACV,CAAC,QAAS,MAKV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MAMV,CAAC,KAAM,MACP,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,MAAO,OACR,CAAC,QAAS,MACV,CAAC,0BAA2B,OAC5B,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,OAAQ,MACT,CAAC,KAAM,MACP,CAAC,QAAS,MACV,CAAC,OAAQ,MACT,CAAC,aAAc,MAGf,CAAC,WAAY,MACb,CAAC,OAAQ,MACT,CAAC,KAAM,KACP,CAAC,KAAM,MAGP,CAAC,cAAe,MAChB,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,KAAM,MAGP,CAAC,MAAO,OACR,CAAC,UAAW,MACZ,CAAC,WAAY,MACb,CAAC,YAAa,MACd,CAAC,WAAY,OACb,CAAC,QAAS,KACV,CAAC,QAAS,MACV,CAAC,SAAU,MAGX,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,YAAa,MAGd,CAAC,WAAY,OACb,CAAC,QAAS,MACV,CAAC,WAAY,MACb,CAAC,QAAS,OACV,CAAC,WAAY,MACb,CAAC,WAAY,MACb,CAAC,WAAY,MACb,CAAC,QAAS,MAGV,CAAC,QAAS,MACV,CAAC,KAAM,OACP,CAAC,QAAS,MACV,CAAC,SAAU,KACX,CAAC,cAAe,MAChB,CAAC,QAAS,OACV,CAAC,KAAM,OACP,CAAC,UAAW,MACZ,CAAC,KAAM,OAGP,CAAC,QAAS,SACV,CAAC,SAAU,MACX,CAAC,MAAO,MACR,CAAC,UAAW,OACZ,CAAC,aAAc,OACf,CAAC,YAAa,OACd,CAAC,cAAe,MAGhB,CAAC,QAAS,MACV,CAAC,WAAY,OACb,CAAC,WAAY,MAGb,CAAC,WAAY,MACb,CAAC,WAAY,MACb,CAAC,UAAW,MACZ,CAAC,QAAS,MACV,CAAC,aAAc,MACf,CAAC,IAAK,MACN,CAAC,cAAe,MAChB,CAAC,IAAK,MACN,CAAC,IAAK,MACN,CAAC,IAAK,MACN,CAAC,KAAM,MACP,CAAC,IAAK,MACN,CAAC,KAAM,MACP,CAAC,WAAY,MACb,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,KAAM,MACP,CAAC,QAAS,MACV,CAAC,QAAS,MAGV,CAAC,SAAU,MACX,CAAC,QAAS,MACV,CAAC,QAAS,OACV,CAAC,QAAS,OACV,CAAC,KAAM,MACP,CAAC,QAAS,MAGV,CAAC,WAAY,MACb,CAAC,QAAS,MACV,CAAC,cAAe,OAChB,CAAC,mBAAoB,MACrB,CAAC,QAAS,MACV,CAAC,OAAQ,MACT,CAAC,QAAS,MACV,CAAC,QAAS,MACV,CAAC,KAAM,MACP,CAAC,mBAAoB,OAIVC,EAAqBD,EACrBE,EAAoBF,GC/ajC,WAGE,MAAMG,EAAY,qCAIZC,EAAc,CAClBC,mBAAoB,wBACpBC,aAAc,GAEdC,aAAc,CACZ,MAAO,KACP,MAAO,OACP,MAAO,OACP,KAAM,KACN,MAAO,KACP,IAAK,OACL,IAAK,OACL,IAAK,OACL,IAAK,KACL,IAAK,OACL,KAAM,OACN,KAAM,OACN,GAAI,MAGNC,OAAQ,KACRC,kBAAmB,KAGnB,cAAAC,CAAeC,GACb,OAAOC,KAAKP,oBAAsBM,GAASE,KAC7C,EAGA,mBAAAC,GACE,IACE,MAAMC,EAASH,KAAKP,mBACdW,EAAU,GAEhB,IAAK,IAAIC,EAAI,EAAGA,EAAIC,aAAaC,OAAQF,IAAK,CAC5C,MAAMG,EAAMF,aAAaE,IAAIH,GACzBG,GAAOA,EAAIC,WAAWN,IACxBC,EAAQM,KAAKF,EAEjB,CAEA,GAAIJ,EAAQG,QAAUP,KAAKN,aAAc,OAGzC,MAAMiB,EAAcP,EAAQQ,IAAIJ,IAC9B,IACE,MAAMK,EAAOC,KAAKC,MAAMT,aAAaU,QAAQR,IAC7C,MAAO,CAAEA,MAAKS,KAAMJ,GAAMK,aAAe,EAC3C,CAAE,MACA,MAAO,CAAEV,MAAKS,KAAM,EACtB,IAGFN,EAAYQ,KAAK,CAACC,EAAGC,IAAMA,EAAEJ,KAAOG,EAAEH,MAGtC,MAAMK,EAAWX,EAAYY,MAAMvB,KAAKN,cACxC4B,EAASE,QAAQC,IACfnB,aAAaoB,WAAWD,EAAKjB,OAG3Bc,EAASf,OAAS,GACpBoB,QAAQC,IAAI,yBAAyBN,EAASf,kBAElD,CAAE,MAAOsB,GACPF,QAAQG,KAAK,yBAA0BD,EACzC,CACF,EAEA,KAAAE,GACE,MAAMhC,EAAQE,KAQd,GALID,KAAKH,oBAAsBE,IAC7BC,KAAKJ,OAAS,KACdI,KAAKH,kBAAoBE,IAGtBC,KAAKJ,OACR,IACE,MAAMoC,EAAS1B,aAAaU,QAAQhB,KAAKF,kBACzCE,KAAKJ,OAASoC,EAASlB,KAAKC,MAAMiB,GAAU,CAAC,SAEtChC,KAAKJ,OAAOsB,WACrB,CAAE,MAAOW,GACP7B,KAAKJ,OAAS,CAAC,CACjB,CAEF,OAAOI,KAAKJ,MACd,EAEA,KAAAqC,GACE,IAEE,MAAMC,EAAa,IAAKlC,KAAKJ,OAAQsB,YAAaiB,KAAKC,OACvD9B,aAAa+B,QAAQrC,KAAKF,iBAAkBgB,KAAKwB,UAAUJ,IAG3DlC,KAAKE,qBACP,CAAE,MAAO2B,GACPF,QAAQG,KAAK,yBAA0BD,EACzC,CACF,EAEA,SAAAU,CAAUC,EAAWC,EAAKC,GACxB,MAAMC,EAAU3C,KAAKL,aAAa6C,GAClC,GAAgB,OAAZG,EAAkB,MAAO,SAE7B,IAAIC,EAAa,EACjB,GAAID,EAAS,CACX,MAAME,EAAMH,EAAQI,QAAQH,IACf,IAATE,IAAYD,EAAaC,EAC/B,CAEA,OAAKJ,EAAIG,GACF,GAAGD,GAAWD,EAAQE,MAAeH,EAAIG,KADnB,IAE/B,EAEA,SAAAG,CAAUP,EAAWQ,EAAQC,EAAWC,GACtC,MAAMrC,EAAOb,KAAK+B,QACblB,EAAK2B,KAAY3B,EAAK2B,GAAa,CAAC,GACpC3B,EAAK2B,GAAWQ,KACnBnC,EAAK2B,GAAWQ,GAAU,CAAEG,UAAU,EAAOC,QAAS,CAAC,EAAGC,UAAW,OAEvExC,EAAK2B,GAAWQ,GAAQI,QAAQH,GAAaC,EAC7ClD,KAAKiC,OACP,EAEA,OAAAqB,CAAQd,EAAWQ,EAAQO,EAASb,GAClC,MAAM7B,EAAOb,KAAK+B,QACblB,EAAK2B,KAAY3B,EAAK2B,GAAa,CAAC,GAEzC,MAAMgB,EAAW,CAAC,EAClBd,EAAQlB,QAAQ,CAACiC,EAAGpD,KACdoD,GAAmB,MAAdF,EAAQlD,IAA6B,KAAfkD,EAAQlD,KACrCmD,EAASC,GAAKF,EAAQlD,MAI1BQ,EAAK2B,GAAWQ,GAAU,CAAEG,UAAU,EAAMC,QAAS,CAAC,EAAGC,UAAWG,GACpExD,KAAKiC,OACP,EAEA,WAAAyB,CAAYlB,EAAWQ,EAAQC,GAC7B,MAAMpC,EAAOb,KAAK+B,QACZ4B,EAAO9C,EAAK2B,KAAaQ,GAC1BW,IAGDA,EAAKR,UAAYQ,EAAKN,kBACjBM,EAAKN,UAAUJ,GAEqB,IAAvCW,OAAOC,KAAKF,EAAKN,WAAW9C,gBACvBM,EAAK2B,GAAWQ,GACqB,IAAxCY,OAAOC,KAAKhD,EAAK2B,IAAYjC,eACxBM,EAAK2B,aAKTmB,EAAKP,QAAQH,GACqB,IAArCW,OAAOC,KAAKF,EAAKP,SAAS7C,gBACrBM,EAAK2B,GAAWQ,GACqB,IAAxCY,OAAOC,KAAKhD,EAAK2B,IAAYjC,eACxBM,EAAK2B,KAIlBxC,KAAKiC,QACP,EAEA,SAAA6B,CAAUtB,EAAWQ,GACnB,MAAMnC,EAAOb,KAAK+B,QACdlB,EAAK2B,YACA3B,EAAK2B,GAAWQ,GACqB,IAAxCY,OAAOC,KAAKhD,EAAK2B,IAAYjC,eACxBM,EAAK2B,GAEdxC,KAAKiC,QAET,EAEA,aAAA8B,CAAcvB,EAAWQ,EAAQC,GAC/B,MAAMU,EAAO3D,KAAK+B,QAAQS,KAAaQ,GACvC,QAAKW,IACDA,EAAKR,SAAiBQ,EAAKN,WAAWW,eAAef,GAClDU,EAAKP,SAASY,eAAef,GACtC,EAEA,WAAAgB,CAAYzB,EAAWQ,GACrB,OAAuD,IAAhDhD,KAAK+B,QAAQS,KAAaQ,IAASG,QAC5C,EAEA,UAAAe,CAAW1B,EAAW2B,GACpB,MAAMC,EAAapE,KAAK+B,QAAQS,GAChC,IAAK4B,IAAeD,GAAgBA,EAAa5D,OAAS,EACxD,MAAO,CAAE8D,UAAU,EAAOC,SAAU,IAGtC,MAAM5B,EAAUyB,EAAa,GACvBG,EAAW,GACjB,IAAID,GAAW,EAGf,MAAME,EAAW,CAAC,EAClB,IAAK,IAAIlE,EAAI,EAAGA,EAAI8D,EAAa5D,OAAQF,IAAK,CAC5C,MAAMG,EAAMR,KAAKuC,UAAUC,EAAW2B,EAAa9D,GAAIqC,GACnDlC,IAAK+D,EAAS/D,GAAOH,EAC3B,CAEA,IAAK,MAAO2C,EAAQW,KAASC,OAAOY,QAAQJ,GAAa,CACvD,MAAMvB,EAAM0B,EAASvB,GAErB,QAAYyB,IAAR5B,EAAmB,CAErB,MAAM6B,EAAS1E,KAAK2E,YAAYjC,EAASiB,GACrCe,IACFP,EAAazD,KAAKgE,GAClBJ,EAAS5D,KAAKsC,GACdqB,GAAW,GAEb,QACF,CAEA,MAAM5B,EAAM0B,EAAatB,GACnB+B,EAASjB,EAAKR,SAAWQ,EAAKN,UAAYM,EAAKP,QAErD,GAAIwB,EACF,IAAK,MAAOC,EAAO3B,KAAUU,OAAOY,QAAQI,GAAS,CACnD,MAAME,EAASpC,EAAQI,QAAQ+B,IACf,IAAZC,GAAiBrC,EAAIqC,KAAY5B,IACnCT,EAAIqC,GAAU5B,EACdmB,GAAW,EAEf,CAEJ,CAEA,MAAO,CAAEA,WAAUC,WACrB,EAEA,WAAAK,CAAYjC,EAASiB,GACnB,MAAMiB,EAASjB,EAAKR,SAAWQ,EAAKN,UAAYM,EAAKP,QACrD,IAAKwB,GAAyC,IAA/BhB,OAAOC,KAAKe,GAAQrE,OAAc,OAAO,KAExD,MAAMkC,EAAM,IAAIsC,MAAMrC,EAAQnC,QAAQyE,KAAK,MAC3C,IAAK,MAAOH,EAAO3B,KAAUU,OAAOY,QAAQI,GAAS,CACnD,MAAM/B,EAAMH,EAAQI,QAAQ+B,IACf,IAAThC,IAAYJ,EAAII,GAAOK,EAC7B,CACA,OAAOT,CACT,EAGA,UAAAwC,CAAWzC,EAAWQ,GACpB,MAAMW,EAAO3D,KAAK+B,QAAQS,KAAaQ,GACvC,QAAKW,MACDA,EAAKR,UACFS,OAAOC,KAAKF,EAAKP,SAAW,CAAC,GAAG7C,OAAS,EAClD,EAEA,eAAA2E,CAAgB1C,EAAWQ,GACzB,MAAMW,EAAO3D,KAAK+B,QAAQS,KAAaQ,GACvC,OAAKW,EACDA,EAAKR,SAAiBS,OAAOC,KAAKF,EAAKN,WAAa,CAAC,GAClDO,OAAOC,KAAKF,EAAKP,SAAW,CAAC,GAFlB,EAGpB,EAGA,mBAAA+B,GACE7E,aAAaoB,WAAW1B,KAAKF,kBAC7BE,KAAKJ,OAAS,IAChB,GAKIwF,EAAkB,CACtB3F,mBAAoB,oBACpBC,aAAc,GAEdE,OAAQ,KACRC,kBAAmB,KAGnB,cAAAC,CAAeC,GACb,OAAOC,KAAKP,oBAAsBM,GAASE,KAC7C,EAGA,mBAAAC,GACE,IACE,MAAMC,EAASH,KAAKP,mBACdW,EAAU,GAEhB,IAAK,IAAIC,EAAI,EAAGA,EAAIC,aAAaC,OAAQF,IAAK,CAC5C,MAAMG,EAAMF,aAAaE,IAAIH,GACzBG,GAAOA,EAAIC,WAAWN,IACxBC,EAAQM,KAAKF,EAEjB,CAEA,GAAIJ,EAAQG,QAAUP,KAAKN,aAEzB,OAIF,MAAMiB,EAAcP,EAAQQ,IAAIJ,IAC9B,IACE,MAAMK,EAAOC,KAAKC,MAAMT,aAAaU,QAAQR,IAC7C,MAAO,CAAEA,MAAKS,KAAMJ,GAAMK,aAAe,EAC3C,CAAE,MACA,MAAO,CAAEV,MAAKS,KAAM,EACtB,IAGFN,EAAYQ,KAAK,CAACC,EAAGC,IAAMA,EAAEJ,KAAOG,EAAEH,MAGtC,MAAMK,EAAWX,EAAYY,MAAMvB,KAAKN,cACxC4B,EAASE,QAAQC,IACfnB,aAAaoB,WAAWD,EAAKjB,OAG3Bc,EAASf,OAAS,GACpBoB,QAAQC,IACN,6BAA6BN,EAASf,8BAA8BP,KAAKN,6BAA6BU,EAAQG,YAGpH,CAAE,MAAOsB,GACPF,QAAQG,KAAK,6BAA8BD,EAC7C,CACF,EAEA,KAAAE,GACE,MAAMhC,EAAQE,KAQd,GALID,KAAKH,oBAAsBE,IAC7BC,KAAKJ,OAAS,KACdI,KAAKH,kBAAoBE,IAGtBC,KAAKJ,OACR,IACE,MAAMoC,EAAS1B,aAAaU,QAAQhB,KAAKF,kBACzCE,KAAKJ,OAASoC,EAASlB,KAAKC,MAAMiB,GAAU,CAAC,SAEtChC,KAAKJ,OAAOsB,WACrB,CAAE,MAAOW,GACP7B,KAAKJ,OAAS,CAAC,CACjB,CAEF,OAAOI,KAAKJ,MACd,EAEA,KAAAqC,GACE,IAEE,MAAMC,EAAa,IAAKlC,KAAKJ,OAAQsB,YAAaiB,KAAKC,OACvD9B,aAAa+B,QAAQrC,KAAKF,iBAAkBgB,KAAKwB,UAAUJ,IAG3DlC,KAAKE,qBACP,CAAE,MAAO2B,GACPF,QAAQG,KAAK,6BAA8BD,EAC7C,CACF,EAEA,YAAAwD,CAAa7C,EAAWQ,GACtB,MAAMnC,EAAOb,KAAK+B,QAClB,SAAUlB,EAAK2B,KAAc3B,EAAK2B,GAAWQ,GAC/C,EAEA,cAAAsC,CAAe9C,EAAWQ,GACxB,MAAMnC,EAAOb,KAAK+B,QACblB,EAAK2B,KAAY3B,EAAK2B,GAAa,CAAC,GAErC3B,EAAK2B,GAAWQ,WAEXnC,EAAK2B,GAAWQ,GACqB,IAAxCY,OAAOC,KAAKhD,EAAK2B,IAAYjC,eACxBM,EAAK2B,IAId3B,EAAK2B,GAAWQ,IAAU,EAE5BhD,KAAKiC,OACP,EAEA,YAAAsD,CAAa/C,GACX,MAAM3B,EAAOb,KAAK+B,QAClB,OAAKlB,EAAK2B,GACHoB,OAAOC,KAAKhD,EAAK2B,IADK,EAE/B,EAGA,mBAAA2C,GACE7E,aAAaoB,WAAW1B,KAAKF,kBAC7BE,KAAKJ,OAAS,IAChB,GAEI4F,EAAaC,GACjBC,OAAOD,GAAK,IACTE,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,UAUbC,EAAoB,CAACC,EAAkBC,EAAsBC,KAGjE,GAFiB,iBAAkBC,QAAUC,UAAUC,eAAiB,EAItEL,EAASM,GAAG,QAAS,SAAUtE,GACzBuE,EAAEvE,EAAEwE,QAAQC,SAASR,IACvBC,GAEJ,OACK,CAEL,IAAIQ,GAAqB,EAEzBV,EAASM,GAAG,YAAa,SAAUtE,GACjC0E,EAAqBH,EAAEvE,EAAEwE,QAAQC,SAASR,EAC5C,GAEAD,EAASM,GAAG,UAAW,SAAUtE,GAC3B0E,GAAsBH,EAAEvE,EAAEwE,QAAQC,SAASR,IAC7CC,IAEFQ,GAAqB,CACvB,EACF,GAgBIC,EAA4BC,IAQhC,MAAM,GAAQC,KACdN,EAAE,+BAA+BO,SAEvBC,KAAV,MACMC,EAASC,KACTC,EAzBmB,EAACC,EAAkBC,KAC5C,IAAKA,EAAcC,SAASF,GAAW,OAAOA,EAC9C,IAAIG,EAAU,EACVC,EAAU,GAAGJ,MAAaG,KAC9B,KAAOF,EAAcC,SAASE,IAC5BD,IACAC,EAAU,GAAGJ,MAAaG,KAE5B,OAAOC,GAiBeC,CAAmBZ,EAAQa,WAAYb,EAAQQ,eAiC/DM,EAAUnB,EA/BG,4DACkCS,EAAOW,sKAGRf,EAAQgB,+VAMLjC,EAAWiB,EAAQa,2dAS7C9B,EAAWuB,uTAaxCX,EAAE,QAAQsB,OAAOH,GAGCA,EAAQ,GAChBI,MAAMC,QAAU,odAiB1B,MAAMC,EAAc,IAAMN,EAAQZ,SAElCY,EAAQO,KAAK,0BAA0BC,MAAM,KAC3CF,IACApB,EAAQuB,aAGVpC,EAAkB2B,EAAS,6BAA8B,KACvDM,IACApB,EAAQuB,aAGVT,EAAQO,KAAK,2BAA2BC,MAAM,WAC5C,MAAME,EAAOV,EAAQO,KAAK,8CAA8CI,MACxEL,IACa,cAATI,EACFxB,EAAQ0B,cAER1B,EAAQ2B,SAASrB,EAErB,IAGIsB,EAAwB,CAACC,EAAYC,KAEzC,MAAM,GAAQ7B,KACR8B,EAAMpC,EAAE,kBACd,IAAKoC,EAAIjI,OAAQ,OAEjB,MAAMkI,GAAcD,EAAIN,OAAS,IAAIQ,OAI/BC,EAAkB,iEAIlBC,EACJ,+GAGIC,EAAc,gCAGdC,EAAmB,eAGnBC,EAAUC,KAChB,IAAIC,EAAkBX,EAClBY,GAAqB,EAOzB,GANoB,SAAhBX,GAA0BQ,EAAQI,yBACpCF,EAAkB,YAClBC,GAAqB,IAIlBT,EAAY,CAGf,GAFAD,EAAIN,IAAIe,GAAiBG,QAAQ,SAASA,QAAQ,UAE9B,SAAhBb,EAAwB,CAC1BC,EAAI3H,KAAK,yBAA0ByH,GAEnC,MAAMe,EAAWb,EAAI,GACrBa,EAASC,qBAAuBhB,EAChCe,EAASE,iBAAkB,CAC7B,CACA,MACF,CAGA,IAAIC,EAAcf,EACdgB,EAAiB,GACjBC,EAAe,GACfC,EAAuB,GAG3B,GAAIb,EAAiBc,KAAKJ,GAAc,CAEtC,MAAMK,EAAerB,EAAI3H,KAAK,2BAA6B,GACvDgJ,GAEFL,EAAcA,EAAY7D,QAAQmD,EAAkBe,GACpDH,EAAeG,EACfF,EAAuBE,GAGvBL,EAAcA,EAAY7D,QAAQmD,EAAkB,IAAIJ,MAE5D,CAGA,MAAMoB,EAAiBN,EAAYO,MAAMnB,GACrCkB,GAAkBA,EAAevJ,OAAS,IAC5CmJ,EAAeI,EAAeA,EAAevJ,OAAS,GACtDoJ,EAAuBD,EACvBF,EAAcA,EAAY7D,QAAQiD,EAAkB,MAAUF,OAC9D/G,QAAQC,IAAI,0DAA2D8H,IAIzE,MAAMM,EAAgBR,EAAYO,MAAMpB,GACpCqB,GAAiBA,EAAczJ,OAAS,IAE1CmJ,EAAeM,EAAcA,EAAczJ,OAAS,GACpDoJ,EAAuBD,EACvBF,EAAcA,EAAY7D,QAAQgD,EAAiB,MAAUD,OAC7D/G,QAAQC,IAAI,yDAA0D8H,IAIxE,MAAMO,EAAgBT,EAAYO,MAAMlB,GACpCoB,GAAiBA,EAAc1J,OAAS,IAC1CkJ,EAAiBQ,EAAcA,EAAc1J,OAAS,GACtDiJ,EAAcA,EAAY7D,QAAQkD,EAAa,KAAUH,OACzD/G,QAAQC,IAAI,oDAAqD6H,IAInE,IAAIS,EAAYV,EACb7D,QAAQ,kBAAmB,KAC3BA,QAAQ,OAAQ,KAChB+C,OAGH,GAAoB,SAAhBH,EAAwB,CAE1BmB,EAAeT,EACfU,EAAuBrB,EAEvBE,EAAI3H,KAAK,yBAA0ByH,GAEnC,MAAMe,EAAWb,EAAI,GACrBa,EAASC,qBAAuBhB,EAChCe,EAASE,iBAAkB,CAC7B,KAA2B,WAAhBhB,IACTkB,EAAiBnB,GAInB,MAAM6B,EAAQ,GACVD,GAAWC,EAAMzJ,KAAKwJ,GACtBT,GAAgBU,EAAMzJ,KAAK+I,GAC3BC,GAAcS,EAAMzJ,KAAKgJ,GAE7B,MAAMU,EAAWD,EAAME,KAAK,KAC5B7B,EAAIN,IAAIkC,GAAUhB,QAAQ,SAASA,QAAQ,WAIvCkB,EAA8B,KAClC,MAAM,GAAQ5D,KACRqC,EAAUC,KAEhB,QADqDvE,IAAnCsE,EAAQI,wBAAuCJ,EAAQI,uBAC1D,OACf,MAAMX,EAAMpC,EAAE,kBACd,IAAKoC,EAAIjI,OAAQ,OAEjB,MAAMkI,EAAaD,EAAIN,OAAS,GAC1B2B,EAAerB,EAAI3H,KAAK,0BAG9B,GAAI4H,EAAWvB,SAAS,cAAgB2C,EAAc,CACpD,MAAMU,EAAc9B,EAAW9C,QAAQ,eAAgBkE,GACvDrB,EAAIN,IAAIqC,GAER/B,EAAIgC,WAAW,0BAEf,MAAMnB,EAAWb,EAAI,GACrBa,EAASC,qBAAuB,KAChCD,EAASE,iBAAkB,CAC7B,GAIIkB,EAAyB,KAC7B,MAAM,GAAQ/D,KACR8B,EAAMpC,EAAE,kBACd,IAAKoC,EAAIjI,OAAQ,OAEjB,MAAM8I,EAAWb,EAAI,GACrB,IAAKa,GAAaA,EAAiBqB,qBAAsB,OAGxDrB,EAAiBqB,sBAAuB,EAGzC,MAAMC,EAAqB/G,OAAOgH,yBAAyBC,oBAAoBC,UAAW,SACpFC,EAAgB1B,EAASnG,MAG/BU,OAAOoH,eAAe3B,EAAU,QAAS,CACvC4B,IAAK,WAEH,IAAI/C,EAUJ,GAREA,EADEyC,GAAsBA,EAAmBM,IACrCN,EAAmBM,IAAIC,KAAKlL,MAE3BA,KAAamL,QAAUJ,GAAiB,IAM3C/K,KAAauJ,gBACjB,OAAOrB,EAIT,MAAM2B,EAAgB7J,KAAasJ,qBACnC,OAAIpB,GAAsB,iBAARA,GAAoBA,EAAIhB,SAAS,cAAgB2C,EAC1D3B,EAAIvC,QAAQ,eAAgBkE,GAE9B3B,CACT,EACAkD,IAAK,SAAqClD,GACpCyC,GAAsBA,EAAmBS,IAC3CT,EAAmBS,IAAIF,KAAKlL,KAAMkI,GAEjClI,KAAamL,OAASjD,CAE3B,EACAmD,cAAc,KAGZC,EAA0B,kBAG1BC,EAAyB,iBACzBC,EAAwB,oBACxBC,EAA4B,wBAC5BC,EAA2B,yBAC3BC,EAAgC,wBAChCC,EAA+B,uBAE/BC,EAA4B,wBAC5BC,EAA2B,uBAC3BC,EAA4B,wBAE5BC,EAA6B,wBAE7BC,EAAmB,IACnBC,EAAmB,KAEnBC,EAA0B,qBAC1BC,EAAgC,2BAChCC,EAAiC,4BACjCC,EAA6B,wBAC7BC,EAAmC,8BACnCC,EAAyB,sBACzBC,EAA4B,CAChCC,SAAS,EACTC,WAAY,GACZC,aAAc,GACdC,iBAAkB,GAClBC,kBAAmB,GAEfC,EAAwB,QAIxBC,EAAiB,CAACC,EAAIC,KAE1B,MAAMC,EAAmBC,GACN,iBAANA,EAAuB,GAAGA,QACpB,iBAANA,EAAuB,QAC3BA,EAEHC,EAAMF,EAAiBF,GACvBK,EAAMH,EAAiBD,GACvBK,EAASF,EAAIG,MAAM,KAAK5M,IAAI6M,QAC5BC,EAASJ,EAAIE,MAAM,KAAK5M,IAAI6M,QAClC,IAAK,IAAIpN,EAAI,EAAGA,EAAIsN,KAAKC,IAAIL,EAAOhN,OAAQmN,EAAOnN,QAASF,IAAK,CAC/D,MAAMwN,EAAKN,EAAOlN,IAAM,EAClByN,EAAKJ,EAAOrN,IAAM,EACxB,GAAIwN,EAAKC,EAAI,OAAQ,EACrB,GAAID,EAAKC,EAAI,OAAO,CACtB,CACA,OAAO,GAGHC,EAAyB,oBACzBC,EAAwB,mBAKxBC,EAAwB,CAC5BC,KAAM,GACNC,QAAS,IACTC,QAAS,CAAExM,KAAK,EAAMyM,MAAM,EAAMvM,MAAM,EAAMwM,OAAO,GACrDC,gBAAiB,CAAC,EAClBC,eAAe,EACf9B,SAAS,EAET,OAAA+B,GAGgB,SADAnO,aAAaU,QAAQ,gCAEjChB,KAAK0O,QAET,EAEA,MAAAA,GACM1O,KAAK0M,UACT1M,KAAK0M,SAAU,EACfpM,aAAa+B,QAAQ,8BAA+B,QACpDrC,KAAK2O,YACP,EAEA,OAAAC,GACE,IAAK5O,KAAK0M,QAAS,OACnB1M,KAAK0M,SAAU,EACfpM,aAAa+B,QAAQ,8BAA+B,SAEpD/B,aAAaoB,WAAW,6BAExB,MAAMmN,EAAeC,SAASC,eAAe,2BACzCF,IACFA,EAAalH,MAAMqH,QAAU,OAEjC,EAEA,SAAAL,GACM3O,KAAKwO,gBACTxO,KAAKwO,eAAgB,EAErB,CAAC,MAAO,OAAQ,OAAQ,SAAShN,QAAQyN,IACvCjP,KAAKuO,gBAAgBU,GAAQtN,QAAQsN,GACrC,MAAMC,EAAOlP,KACb2B,QAAQsN,GAAQ,YAAaE,GAE3BD,EAAKX,gBAAgBU,GAAMG,MAAMzN,QAASwN,GAEtCD,EAAKxC,SACPwC,EAAKG,QAAQJ,EAAME,EAEvB,IAEJ,EAEA,OAAAE,CAAQJ,EAAME,GACZ,GAAKnP,KAAK0M,QACV,IACE,MAAM4C,EAAY,IAAInN,KAChBoN,EAAUD,EAAUE,mBAAmB,QAAS,CAAEC,QAAQ,IAG1DC,EAAUP,EACbvO,IAAI+O,IACH,GAAmB,iBAARA,EACT,IACE,OAAO7O,KAAKwB,UAAUqN,EAAK,KAAM,EACnC,CAAE,MACA,OAAOjK,OAAOiK,EAChB,CAEF,OAAOjK,OAAOiK,KAEftF,KAAK,KAGR,IAAIuF,EAAQ,KACC,UAATX,GAAoBE,EAAK,aAAcU,QACzCD,EAAQT,EAAK,GAAGS,OAAS,MAG3B,MAAME,EAAW,CACfC,GAAI5N,KAAKC,MAAQuL,KAAKqC,SACtBV,YACAC,UACAN,OACAS,UACAE,QACAK,QAASd,GAGXnP,KAAKkO,KAAKxN,KAAKoP,GAGX9P,KAAKkO,KAAK3N,OAASP,KAAKmO,SAC1BnO,KAAKkO,KAAKgC,OAEd,CAAE,MAAOrO,GAET,CACF,EAEA,KAAAsO,GACEnQ,KAAKkO,KAAO,EACd,EAEA,eAAAkC,GACE,OAAOpQ,KAAKkO,KAAKmC,OAAOzO,GAAO5B,KAAKoO,QAAQxM,EAAIqN,MAClD,EAEA,UAAAqB,CAAWlC,GACTpO,KAAKoO,QAAU,IAAKpO,KAAKoO,WAAYA,EACvC,GASImC,EAAe,CACnBC,WAAY,EACZC,eAAgB,EAChBC,cAAe,EACfC,YAAa,IACbC,oBAAoB,EAGpB,YAAAC,CAAavC,EAAOwC,EAAQC,EAAQC,EAAOpB,GAEzC,MAAMqB,EAAqB,CAAC,UAAW,UAAW,OAAQ,SAAU,QAAS,QAAS,UAAW,iBAE3FC,EAAYtB,GAAStB,GAAOsB,OAAS,GACrCuB,EAAcL,GAAU,GAG9B,IAAK,MAAMM,KAAWH,EACpB,GAAIG,EAAQxH,KAAKsH,IAAcE,EAAQxH,KAAKuH,GAC1C,OAAO,EAKX,MAAME,EAAe,CACnB,kBACA,QACA,eACA,SACA,yBACA,mBACA,cAGF,IAAIC,GAAc,EAClB,IAAK,MAAMF,KAAWC,EACpB,GAAID,EAAQxH,KAAKsH,IAAcE,EAAQxH,KAAKuH,GAAc,CACxDG,GAAc,EACd,KACF,CAIF,OAAOA,CACT,EAGA,WAAAC,CAAYjD,EAAOwC,EAAQC,EAAQC,EAAOpB,GACxC,IAEE,IAAK5P,KAAK6Q,aAAavC,EAAOwC,EAAQC,EAAQC,EAAOpB,GACnD,OAGF,MAAMxN,EAAMD,KAAKC,MAGbA,EAAMpC,KAAK0Q,cAAgB1Q,KAAK2Q,cAClC3Q,KAAKwQ,WAAa,GAGpBxQ,KAAKwQ,aACLxQ,KAAK0Q,cAAgBtO,EAGjBpC,KAAKwQ,YAAcxQ,KAAKyQ,iBAAmBzQ,KAAK4Q,qBAClD5Q,KAAK4Q,oBAAqB,EAC1B5Q,KAAKwR,oBAET,CAAE,MAAO3P,GAEPF,QAAQ2M,MAAM,8BAA+BzM,EAC/C,CACF,EAGA,iBAAA2P,GACE,IAEOvD,EAAsBvB,SACzBuB,EAAsBS,SAIxBpO,aAAa+B,QAAQ,4BAA6B,QAGlDrC,KAAKyR,qBACP,CAAE,MAAO5P,GACPF,QAAQ2M,MAAM,kCAAmCzM,EACnD,CACF,EAGA,mBAAA4P,GACE,IAEE,IAAIC,EAAM5C,SAASC,eAAe,2BAClC,GAAI2C,EAEF,YADAA,EAAI/J,MAAMqH,QAAU,SAKtB0C,EAAM5C,SAAS6C,cAAc,UAC7BD,EAAI3B,GAAK,0BACT2B,EAAIE,UAAY,qCAChBF,EAAI/J,MAAMC,QAAU,ogBAoBpB8J,EAAIG,aAAe,WACjB7R,KAAK2H,MAAMmK,WAAa,UACxB9R,KAAK2H,MAAMoK,UAAY,aACzB,EACAL,EAAIM,aAAe,WACjBhS,KAAK2H,MAAMmK,WAAa,UACxB9R,KAAK2H,MAAMoK,UAAY,UACzB,EAEAL,EAAIO,QAAU,WACZ,IAE8C,mBAAjCjM,OAAOkM,sBAChBlM,OAAOkM,wBAGPC,MAAM,+BAEV,CAAE,MAAOtQ,GACPF,QAAQ2M,MAAM,oBAAqBzM,GACnCsQ,MAAM,+BACR,CACF,EAEArD,SAASsD,KAAKC,YAAYX,EAC5B,CAAE,MAAO7P,GACPF,QAAQ2M,MAAM,oBAAqBzM,EACrC,CACF,EAGA,eAAAyQ,GACE,IAC8E,SAAtDhS,aAAaU,QAAQ,+BAGpCiN,EAAsBvB,SACzBuB,EAAsBS,SAGxB1O,KAAKyR,sBAET,CAAE,MAAO5P,GACPF,QAAQ2M,MAAM,+BAAgCzM,EAChD,CACF,GAIFmE,OAAOuM,QAAU,SAAUC,EAAS1B,EAAQC,EAAQC,EAAO1C,GAEzD,OADAiC,EAAagB,YAAYjD,GAASkE,EAAS1B,EAAQC,EAAQC,EAAO1C,GAAOsB,QAClE,CACT,EAGA5J,OAAOyM,iBAAiB,qBAAsB,SAAUC,GACtDnC,EAAagB,YAAYmB,EAAMC,OAAQ,KAAM,KAAM,KAAMD,EAAMC,QAAQ/C,MACzE,GAgJA,MAAMgD,EAA0B,qBAC1BC,EAA4B,uBAC5BC,EAAkC,6BAClCC,EAA4B,uBAuFlC,MAoDMC,EAAiC,4BACjCC,EAA8B,sBAG9BC,EAAiB,CAErBC,cAAe,CAAEC,KAAM,OAAQC,MAAO,QAASC,KAAM,UAAWC,KAAM,WACtEC,SAAU,CAAEJ,KAAM,OAAQC,MAAO,QAASC,KAAM,oBAAqBC,KAAM,YAC3EE,SAAU,CAAEL,KAAM,OAAQC,MAAO,QAASC,KAAM,qBAAsBC,KAAM,eAE5EG,SAAU,CAAEN,KAAM,KAAMC,MAAO,QAASC,KAAM,cAAeC,KAAM,UACnEI,OAAQ,CAAEP,KAAM,OAAQC,MAAO,QAASC,KAAM,UAAWC,KAAM,WAC/DK,KAAM,CAAER,KAAM,OAAQC,MAAO,QAASC,KAAM,UAAWC,KAAM,WAC7DM,QAAS,CAAET,KAAM,OAAQC,MAAO,QAASC,KAAM,aAAcC,KAAM,YACnEO,SAAU,CAAEV,KAAM,OAAQC,MAAO,QAASC,KAAM,UAAWC,KAAM,WACjEQ,SAAU,CAAEX,KAAM,QAASC,MAAO,QAASC,KAAM,SAAUC,KAAM,iBAI7DS,EAA2B,CAE/B,CACEjE,GAAI,wBACJqD,KAAM,UACNa,YAAa,8BACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,MACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAE1G,OAAQ,KAAMmU,UAAW,GACnCC,aAAc,+BAGhB,CACExE,GAAI,wBACJqD,KAAM,WACNa,YAAa,8BACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,OACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAE1G,OAAQ,KAAMmU,UAAW,GACnCC,aAAc,+BAGhB,CACExE,GAAI,wBACJqD,KAAM,YACNa,YAAa,WACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,MACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAC,EACT0N,aAAc,YAGhB,CACExE,GAAI,wBACJqD,KAAM,aACNa,YAAa,WACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,OACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAC,EACT0N,aAAc,YAGhB,CACExE,GAAI,oBACJqD,KAAM,QACNa,YAAa,eACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,MACbC,aAAc,KACdC,SAAU,OACVxN,OAAQ,CAAE2N,OAAQ,CAAC,MAAO,MAAO,MAAO,QACxCD,aAAc,yBAGhB,CACExE,GAAI,kBACJqD,KAAM,QACNa,YAAa,eACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,MACbC,aAAc,KACdC,SAAU,OACVxN,OAAQ,CAAE2N,OAAQ,CAAC,KAAM,KAAM,OAC/BD,aAAc,kBAGhB,CACExE,GAAI,sBACJqD,KAAM,SACNa,YAAa,gBACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,MACbC,aAAc,MACdC,SAAU,OACVxN,OAAQ,CAAE2N,OAAQ,CAAC,KAAM,KAAM,OAC/BD,aAAc,mBAGhB,CACExE,GAAI,oBACJqD,KAAM,QACNa,YAAa,eACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,MACbC,aAAc,KACdC,SAAU,OACVxN,OAAQ,CAAE2N,OAAQ,CAAC,MAAO,OAC1BD,aAAc,gBAGhB,CACExE,GAAI,qBACJqD,KAAM,QACNa,YAAa,eACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,MACbC,aAAc,KACdC,SAAU,OACVxN,OAAQ,CAAE2N,OAAQ,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,OACjDD,aAAc,2BAGhB,CACExE,GAAI,oBACJqD,KAAM,QACNa,YAAa,eACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,MACbC,aAAc,KACdC,SAAU,OACVxN,OAAQ,CAAE2N,OAAQ,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,OACjDD,aAAc,2BAGhB,CACExE,GAAI,kBACJqD,KAAM,QACNa,YAAa,eACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,MACbC,aAAc,KACdC,SAAU,OACVxN,OAAQ,CAAE2N,OAAQ,CAAC,KAAM,KAAM,OAC/BD,aAAc,kBAGhB,CACExE,GAAI,qBACJqD,KAAM,QACNa,YAAa,eACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,MACbC,aAAc,KACdC,SAAU,OACVxN,OAAQ,CAAE2N,OAAQ,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,OACjDD,aAAc,2BAGhB,CACExE,GAAI,0BACJqD,KAAM,UACNa,YAAa,oBACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,MACbC,aAAc,MACdC,SAAU,UACVxN,OAAQ,CAAE4N,IAAK,EAAG7G,IAAK,KACvB2G,aAAc,mBAGhB,CACExE,GAAI,oBACJqD,KAAM,WACNa,YAAa,eACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,QACbC,aAAc,OACdC,SAAU,OACVxN,OAAQ,CAAE2N,OAAQ,CAAC,KAAM,OACzBD,aAAc,iBAGhB,CACExE,GAAI,mBACJqD,KAAM,UACNa,YAAa,eACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,QACbC,aAAc,OACdC,SAAU,OACVxN,OAAQ,CAAE2N,OAAQ,CAAC,MAAO,OAAQ,QAClCD,aAAc,wBAGhB,CACExE,GAAI,sBACJqD,KAAM,SACNa,YAAa,cACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,QACbC,aAAc,MACdC,SAAU,OACVxN,OAAQ,CAAE2N,OAAQ,CAAC,KAAM,KAAM,OAC/BD,aAAc,mBAGhB,CACExE,GAAI,wBACJqD,KAAM,QACNa,YAAa,cACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,OACbC,aAAc,MACdC,SAAU,OACVxN,OAAQ,CAAE2N,OAAQ,CAAC,KAAM,KAAM,OAC/BD,aAAc,mBAGhB,CACExE,GAAI,2BACJqD,KAAM,SACNa,YAAa,oBACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,OACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAE6N,SAAU,QAASC,UAAW,QACxCJ,aAAc,0BAGhB,CACExE,GAAI,wBACJqD,KAAM,UACNa,YAAa,qBACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,QACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAE6N,SAAU,QAASC,UAAW,QACxCJ,aAAc,0BAGhB,CACExE,GAAI,4BACJqD,KAAM,SACNa,YAAa,yBACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,QACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAE6N,SAAU,QAASC,UAAW,QACxCJ,aAAc,0BAGhB,CACExE,GAAI,kCACJqD,KAAM,WACNa,YAAa,oBACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,QACbC,aAAc,SACdC,SAAU,WACVxN,OAAQ,CAAE6N,SAAU,QAASC,UAAW,QACxCJ,aAAc,4BAGhB,CACExE,GAAI,kCACJqD,KAAM,SACNa,YAAa,2BACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,OACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAE+N,UAAW,UAAWC,SAAU,EAAGC,SAAU,KACvDP,aAAc,wCAGhB,CACExE,GAAI,qCACJqD,KAAM,SACNa,YAAa,2BACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,OACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAE+N,UAAW,UAAWC,SAAU,EAAGC,SAAU,KACvDP,aAAc,wCAGhB,CACExE,GAAI,gCACJqD,KAAM,SACNa,YAAa,eACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,OACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAE+N,UAAW,QACrBL,aAAc,8BAGhB,CACExE,GAAI,+BACJqD,KAAM,UACNa,YAAa,2BACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,QACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAE+N,UAAW,UAAWC,SAAU,EAAGC,SAAU,KACvDP,aAAc,wCAGhB,CACExE,GAAI,kCACJqD,KAAM,UACNa,YAAa,2BACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,QACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAE+N,UAAW,UAAWC,SAAU,EAAGC,SAAU,KACvDP,aAAc,wCAGhB,CACExE,GAAI,6BACJqD,KAAM,UACNa,YAAa,eACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,QACbC,aAAc,OACdC,SAAU,WACVxN,OAAQ,CAAE+N,UAAW,QACrBL,aAAc,8BAGhB,CACExE,GAAI,wBACJqD,KAAM,SACNa,YAAa,mBACbvH,SAAS,EACTwH,SAAS,EACTvF,WAAW,EACXwF,YAAa,MACbC,aAAc,KACdC,SAAU,SACVxN,OAAQ,CAAEuK,QAAS,WACnBmD,aAAc,2BAOZQ,EAAwB,0BACxBC,EAAgC,+BAChCC,EAAoB,CACxB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,eACA,OACA,KACA,QACA,KACA,OACA,QAGIC,EAAmB,CAEvB,YAAAC,GACE,MAAMnT,EAASoT,GAAMnK,IAAI8J,EAAuB,MAC1CM,EAAgBD,GAAMnK,IAAI+J,EAA+B,MAG/D,IAAKhT,IAAW+C,MAAMuQ,QAAQtT,GAI5B,OAFAoT,GAAMhK,IAAI2J,EAAuB,IAAIE,IACrCG,GAAMhK,IAAI4J,EAA+BjI,GAClC,IAAIkI,GAIb,IAAKI,GAAiBrI,EAAeqI,EAAetI,GAAyB,EAAG,CAC9EpL,QAAQC,IAAI,sCAAsCyT,GAAiB,kBAGjD,IAAIE,IAAIvT,GAA1B,MACMwT,EAAe,IAAID,IAAIN,GACvBQ,EAAc,IAAIR,GAYxB,OATAjT,EAAOR,QAAQC,IACR+T,EAAaE,IAAIjU,IACpBgU,EAAY/U,KAAKe,KAKrB2T,GAAMhK,IAAI2J,EAAuBU,GACjCL,GAAMhK,IAAI4J,EAA+BjI,GAClC0I,CACT,CAEA,OAAOzT,CACT,EAGA2T,aAAaC,GACN7Q,MAAMuQ,QAAQM,IAInBR,GAAMhK,IAAI2J,EAAuBa,GACjCR,GAAMhK,IAAI4J,EAA+BjI,IAClC,IALLpL,QAAQG,KAAK,sCACN,GAQX+T,eAAc,KACZT,GAAMhK,IAAI2J,EAAuB,IAAIE,IACrCG,GAAMhK,IAAI4J,EAA+BjI,IAClC,GAKT,aAAA+I,CAActV,GACZ,IAAKA,GAAsB,iBAARA,EAAkB,OAAO,EAC5C,MAAMuV,EAAY/V,KAAKmV,eACvB,GAAyB,IAArBY,EAAUxV,OAAc,OAAO,EAGnC,MAAM4J,EAAQ3J,EACXgN,MAAM,SACN5M,IAAI6E,GAAKA,EAAEiD,QACX2H,OAAO5K,GAAKA,GACTuQ,EAAW7L,EAAM5J,OAAS,EAAI4J,EAAMA,EAAM5J,OAAS,GAAKC,EAG9D,OAAOuV,EAAUE,KAAKxU,GAAQuU,EAAS9O,SAASzF,GAClD,GAMIyU,EAAsB,4BACtBC,EAA4B,uBAE5BC,GAAgB,CACpBxW,OAAQ,KAGR,aAAAyW,GACE,MAAMrU,EAASoT,GAAMnK,IAAIiL,EAAqB,MAC9C,IAAKlU,EAEH,OADAhC,KAAKsW,qBACEtW,KAAKJ,OAGd,IAAI2W,GAAY,EA4BhB,OA3BAvU,EAAOR,QAAQgV,IACb,IAAKA,EAAOC,SAAWzW,KAAK0W,gBAAgBF,EAAOC,QAAS1J,GAAyB,EAAG,CACtFpL,QAAQC,IACN,8BAA8B4U,EAAOpD,eAAeoD,EAAOC,SAAW,kBAGxE,MAAME,EAAcH,EAAOI,MAAMvG,OAAOwG,IAAMA,EAAE3C,SAC1C4C,EAAiB,IAAIvB,IAAIvB,EAAyBpT,IAAIiW,GAAKA,EAAE9G,IAAM8G,EAAE1C,YAAc,IAAM0C,EAAExC,WAC3F0C,EAAc,IAAI/C,EAAyBpT,IAAIiW,IAAK,IAAMA,EAAG3C,SAAS,MAC5EyC,EAAYnV,QAAQwV,IAClB,MAAMxW,EAAMwW,EAAKjH,IAAMiH,EAAK7C,YAAc,IAAM6C,EAAK3C,SAChDyC,EAAepB,IAAIlV,IACtBuW,EAAYrW,KAAK,IAAKsW,EAAM9C,SAAS,MAGzCsC,EAAOI,MAAQG,EACfP,EAAOC,QAAU1J,EACjBwJ,GAAY,CACd,IAEEA,IACFvW,KAAKiC,MAAMD,GACXiV,GAAsBC,aAEtBlX,KAAKJ,OAAS,OAGX2W,GAAavW,KAAKJ,OACdI,KAAKJ,QAEdI,KAAKJ,OAASoC,EACPA,EACT,EAGA,eAAAmV,GACE,MAAMC,EAAUpX,KAAKqW,gBACfgB,EAAWjC,GAAMnK,IAAIkL,EAA2B,WACtD,OAAOiB,EAAQtP,KAAKwP,GAAKA,EAAEvH,KAAOsH,IAAaD,EAAQ,EACzD,EAGA,eAAAG,CAAgBxH,GACd,QAAK/P,KAAKqW,gBAAgBvO,KAAKwP,GAAKA,EAAEvH,KAAOA,KAC7CqF,GAAMhK,IAAI+K,EAA2BpG,GACrCkH,GAAsBC,aACtBvV,QAAQC,IAAI,4BAA6BmO,IAClC,EACT,EAGA,YAAAyH,CAAapE,GACX,MAAMgE,EAAUpX,KAAKqW,gBACfoB,EAAY,CAChB1H,GAAI,UAAY5N,KAAKC,MACrBgR,KAAMA,GAAQ,MACdc,SAAS,EACT0C,MAAO,GACPH,QAAS1J,EACT2K,WAAW,IAAIvV,MAAOwV,eAIxB,OAFAP,EAAQ1W,KAAK+W,GACbzX,KAAKiC,MAAMmV,GACJK,CACT,EAGA,eAAAG,CAAgB7H,GACd,MAAMe,EAAS9Q,KAAKqW,gBAAgBvO,KAAKwP,GAAKA,EAAEvH,KAAOA,GACvD,IAAKe,EAAQ,OAAO,KACpB,MAAMsG,EAAUpX,KAAKqW,gBACfoB,EAAY,CAChB1H,GAAI,UAAY5N,KAAKC,MACrBgR,KAAMtC,EAAOsC,KAAO,QACpBc,SAAS,EACT0C,MAAO9V,KAAKC,MAAMD,KAAKwB,UAAUwO,EAAO8F,QACxCH,QAAS3F,EAAO2F,SAAW1J,EAC3B2K,WAAW,IAAIvV,MAAOwV,eAKxB,OAHAP,EAAQ1W,KAAK+W,GACbzX,KAAKiC,MAAMmV,GACXzV,QAAQC,IAAI,4BAA6BkP,EAAOsC,KAAM,KAAMqE,EAAUrE,MAC/DqE,CACT,EAGA,YAAAI,CAAa9H,GACX,MAAMqH,EAAUpX,KAAKqW,gBACfG,EAASY,EAAQtP,KAAKwP,GAAKA,EAAEvH,KAAOA,GAC1C,IAAKyG,GAAwB,YAAdA,EAAOzG,GAAkB,OAAO,EAC/C,MAAM+H,EAAWV,EAAQ/G,OAAOiH,GAAKA,EAAEvH,KAAOA,GAO9C,OANA/P,KAAKiC,MAAM6V,GACP1C,GAAMnK,IAAIkL,KAA+BpG,IAC3CqF,GAAMhK,IAAI+K,EAA2B,WACrCc,GAAsBC,cAExBvV,QAAQC,IAAI,4BAA6BmO,IAClC,CACT,EAGA,iBAAAgI,CAAkBhI,EAAI6G,GACpB,MAAMQ,EAAUpX,KAAKqW,gBACfG,EAASY,EAAQtP,KAAKwP,GAAKA,EAAEvH,KAAOA,GAC1C,QAAKyG,IACLA,EAAOI,MAAQA,EACf5W,KAAKiC,MAAMmV,GACXH,GAAsBC,cACf,EACT,EAGA,YAAAc,CAAajI,GACX,MAAMyG,EAASxW,KAAKqW,gBAAgBvO,KAAKwP,GAAKA,EAAEvH,KAAOA,GACvD,IAAKyG,EAAQ,OAAO,KAUpB,OATa1V,KAAKwB,UAChB,CACEqR,OAAQ,gBACR8C,QAAS1J,EACTyJ,OAAQ,CAAEpD,KAAMoD,EAAOpD,KAAMwD,MAAOJ,EAAOI,QAE7C,KACA,EAGJ,EAGAF,gBAAe,CAACzJ,EAAIC,IACXF,EAAeC,EAAIC,GAI5B,uBAAA+K,CAAwBC,GACtB,MAAMd,EAAUpX,KAAKqW,gBACfG,EAASY,EAAQtP,KAAKwP,GAAKA,EAAEvH,KAAOmI,GAC1C,IAAK1B,EAAQ,OAAO,EAGpB,MAAMG,EAAcH,EAAOI,MAAMvG,OAAOwG,IAAMA,EAAE3C,SAC1C4C,EAAiB,IAAIvB,IAAIvB,EAAyBpT,IAAIiW,GAAKA,EAAE9G,IAAM8G,EAAE1C,YAAc,IAAM0C,EAAExC,WAG3F8D,EAAiB,IAAIC,IAC3BpE,EAAyBxS,QAAQqV,IAC/B,MAAMrW,EAAMqW,EAAE9G,IAAM8G,EAAE1C,YAAc,IAAM0C,EAAExC,SAC5C8D,EAAe/M,IAAI5K,EAAKqW,KAI1B,MAAME,EAAc,GACdsB,EAAqB,IAAI9C,IAoC/B,OAjCAvB,EAAyBxS,QAAQ8W,IAC/B,MAAM9X,EAAM8X,EAAQvI,IAAMuI,EAAQnE,YAAc,IAAMmE,EAAQjE,SACxDkE,EAAe/B,EAAOI,MAAM9O,KAAK+O,IAAMA,EAAE9G,IAAM8G,EAAE1C,YAAc,IAAM0C,EAAExC,YAAc7T,GAAOqW,EAAE3C,SACpG,GAAIqE,EAAc,CAEGzX,KAAKwB,UAAUiW,KAAkBzX,KAAKwB,UAAUgW,GAGjEvB,EAAYrW,KAAK,IAAK6X,EAAcrE,SAAS,IAG7C6C,EAAYrW,KAAK,IAAK4X,EAASpE,SAAS,GAE5C,MAEE6C,EAAYrW,KAAK,IAAK4X,EAASpE,SAAS,IAE1CmE,EAAmBG,IAAIhY,KAIzBmW,EAAYnV,QAAQwV,IAClB,MAAMxW,EAAMwW,EAAKjH,IAAMiH,EAAK7C,YAAc,IAAM6C,EAAK3C,SAChDyC,EAAepB,IAAIlV,IACtBuW,EAAYrW,KAAK,IAAKsW,EAAM9C,SAAS,MAIzCsC,EAAOI,MAAQG,EACfP,EAAOC,QAAU1J,EACjB/M,KAAKiC,MAAMmV,GACXH,GAAsBC,aACtBvV,QAAQC,IAAI,4BAA6B4U,EAAOpD,OACzC,CACT,EAGA,YAAAqF,CAAaC,EAAMC,GAAY,GAC7B,IACE,MAAM9X,EAAOC,KAAKC,MAAM2X,GACxB,GAAoB,kBAAhB7X,EAAK8S,SAA+B9S,EAAK2V,OAAQ,OAAO,KAE5D,MAAMoC,EAAkB/X,EAAK4V,SAAW,QAClCoC,EAAa7Y,KAAK0W,gBAAgBkC,EAAiB7L,GAAyB,EAE5EqK,EAAUpX,KAAKqW,gBACfoB,EAAY,CAChB1H,GAAI,YAAc5N,KAAKC,MACvBgR,KAAMvS,EAAK2V,OAAOpD,MAAQ,QAC1Bc,SAAS,EACT0C,MAAO/V,EAAK2V,OAAOI,OAAS,GAC5BH,QAASmC,EACTlB,WAAW,IAAIvV,MAAOwV,eAkBxB,OAdIkB,GAAcF,GAChBvB,EAAQ1W,KAAK+W,GACbzX,KAAKiC,MAAMmV,GACXpX,KAAKiY,wBAAwBR,EAAU1H,IACvCpO,QAAQC,IAAI,+BAAgC6V,EAAUrE,QAEtDgE,EAAQ1W,KAAK+W,GACbzX,KAAKiC,MAAMmV,GACXzV,QAAQC,IAAI,4BAA6B6V,EAAUrE,MAC/CyF,GACFlX,QAAQG,KAAK,wEAIV,CAAE0U,OAAQiB,EAAWoB,WAAYA,IAAeF,EACzD,CAAE,MAAO9W,GAEP,OADAF,QAAQ2M,MAAM,4BAA6BzM,GACpC,IACT,CACF,EAGA,uBAAAiX,GACE,IACE,MAAMC,EAAWjY,KAAKwB,UAAU0R,GAEhC,IAAIgF,EAAO,EACX,IAAK,IAAI3Y,EAAI,EAAGA,EAAI0Y,EAASxY,OAAQF,IAAK,CAExC2Y,GAAQA,GAAQ,GAAKA,EADRD,EAASE,WAAW5Y,GAEjC2Y,GAAcA,CAChB,CACA,OAAOA,EAAKE,SAAS,GACvB,CAAE,MAAOrX,GAEP,OADAF,QAAQ2M,MAAM,8BAA+BzM,GACtC,GACT,CACF,EAGA,kBAAAyU,GACE,MAAM6C,EAAiBnZ,KAAK8Y,0BACtB9W,EAASoT,GAAMnK,IAAIiL,EAAqB,MAG9C,GAAIlU,GAAU+C,MAAMuQ,QAAQtT,GAAS,CACnC,MAAMoX,EAAgBpX,EAAO8F,KAAKwP,GAAc,YAATA,EAAEvH,IACzC,GAAIqJ,GAAiBA,EAAcC,kBAAoBF,EAAgB,CACrExX,QAAQC,IAAI,0CAEZ,MAAM+U,EAAcyC,EAAcxC,MAAMvG,OAAOwG,IAAMA,EAAE3C,SAMvD,OALAkF,EAAcxC,MAAQ,IAAI5C,EAAyBpT,IAAIiW,IAAK,IAAMA,QAAUF,GAC5EyC,EAAcC,gBAAkBF,EAChCnZ,KAAKJ,OAASoC,EACdhC,KAAKiC,MAAMD,QACXoT,GAAMhK,IAAI+K,EAA2B,UAEvC,CACF,CAEA,MAAMiD,EAAgB,CACpBrJ,GAAI,UACJqD,KAAM,OACNc,SAAS,EACT0C,MAAO5C,EAAyBpT,IAAIiW,IAAK,IAAMA,KAC/CJ,QAAS1J,EACTsM,gBAAiBF,EACjBzB,WAAW,IAAIvV,MAAOwV,eAGlB2B,EAAYlE,GAAMnK,IA3zBS,0BA2zByB,IACtDqO,EAAU/Y,OAAS,IACrB6Y,EAAcxC,MAAMlW,QAAQ4Y,EAAU1Y,IAAIiW,IAAK,IAAMA,EAAG3C,SAAS,MACjEvS,QAAQC,IAAI,6BAA8B0X,EAAU/Y,OAAQ,MAE9DP,KAAKJ,OAAS,CAACwZ,GACfpZ,KAAKiC,MAAMjC,KAAKJ,QAChBwV,GAAMhK,IAAI+K,EAA2B,UACvC,EAGA,kBAAAoD,GACE,MAAMnC,EAAUpX,KAAKqW,gBACf+C,EAAgBhC,EAAQtP,KAAKwP,GAAc,YAATA,EAAEvH,IAC1C,GAAIqJ,EAAe,CAEjB,MAAMzC,EAAcyC,EAAcxC,MAAMvG,OAAOwG,IAAMA,EAAE3C,SAKvD,OAJAkF,EAAcxC,MAAQ,IAAI5C,EAAyBpT,IAAIiW,IAAK,IAAMA,QAAUF,GAC5EyC,EAAcC,gBAAkBrZ,KAAK8Y,0BACrC9Y,KAAKiC,MAAMmV,GACXH,GAAsBC,cACf,CACT,CACA,OAAO,CACT,EAEA,KAAAjV,CAAMmV,GACJhC,GAAMhK,IAAI8K,EAAqBkB,GAC/BpX,KAAKJ,OAASwX,CAChB,EAEA,UAAAF,GACElX,KAAKJ,OAAS,IAChB,GAIIqX,GAAwB,CAC5BrX,OAAQ,KACR4Z,cAAe,KAGf,WAAAC,GACE,GAAIzZ,KAAKJ,OAAQ,OAAOI,KAAKJ,OAE7B,MAAM4W,EAASJ,GAAce,kBACvBuC,EAAgB1Z,KAAK2Z,mBAGrBC,GAAYpD,GAAQI,OAAS,IAAIhW,IAAIoW,IAAQ,IAC9CA,EACHtK,aAAoCjI,IAA3BiV,EAAc1C,EAAKjH,IAAoB2J,EAAc1C,EAAKjH,IAAMiH,EAAKtK,WAIhF,OADA1M,KAAKJ,OAASga,EACPA,CACT,EAGA,gBAAAD,GACE,OAAI3Z,KAAKwZ,gBACTxZ,KAAKwZ,cAAgBpE,GAAMnK,IAAI+H,EAAgC,CAAC,IADjChT,KAAKwZ,aAGtC,EAGA,iBAAAK,CAAkBC,EAAQpN,GACxB,MAAMqN,EAAS/Z,KAAK2Z,mBACpBI,EAAOD,GAAUpN,EACjB0I,GAAMhK,IAAI4H,EAAgC+G,GAC1C/Z,KAAKwZ,cAAgBO,EACrB/Z,KAAKJ,OAAS,IAChB,EAGA,mBAAAoa,CAAoBF,EAAQnL,GAC1B,MAAM6H,EAASJ,GAAce,kBAC7B,IAAKX,EAAQ,OAAO,EAEpB,MAAMQ,EAAOR,EAAOI,MAAM9O,KAAK+O,GAAKA,EAAE9G,KAAO+J,GAC7C,QAAK9C,IAELA,EAAKrI,UAAYA,EACjByH,GAAc2B,kBAAkBvB,EAAOzG,GAAIyG,EAAOI,QAC3C,EACT,EAGA,eAAAqD,GACE,OAAOja,KAAKyZ,cAAcpJ,OAAO2G,GAAQA,EAAKtK,QAChD,EAGA,aAAAwN,CAAclD,GACZ,IAAKA,EAAKjH,KAAOiH,EAAK5D,OAAS4D,EAAK7C,YAElC,OADAxS,QAAQ2M,MAAM,yCACP,EAGT,MAAMkI,EAASJ,GAAce,kBAC7B,IAAKX,EAAQ,OAAO,EAGpB,GAAIA,EAAOI,MAAMX,KAAKY,GAAKA,EAAE9G,KAAOiH,EAAKjH,IAEvC,OADApO,QAAQ2M,MAAM,yCAA0C0I,EAAKjH,KACtD,EAGT,MAAMuI,EAAU,IAAKtB,EAAM9C,SAAS,EAAOxH,SAAS,GAIpD,OAHA8J,EAAOI,MAAMlW,KAAK4X,GAClBlC,GAAc2B,kBAAkBvB,EAAOzG,GAAIyG,EAAOI,OAClDjV,QAAQC,IAAI,oCAAqC0W,EAAQlF,OAClD,CACT,EAGA,gBAAA+G,CAAiBL,GACf,MAAMtD,EAASJ,GAAce,kBAC7B,IAAKX,EAAQ,OAAO,EAEpB,MAAM4D,EAAQ5D,EAAOI,MAAMyD,UAAUxD,GAAKA,EAAE9G,KAAO+J,GACnD,IAAe,IAAXM,EAAc,OAAO,EAEzB5D,EAAOI,MAAM0D,OAAOF,EAAO,GAC3BhE,GAAc2B,kBAAkBvB,EAAOzG,GAAIyG,EAAOI,OAGlD,MAAMmD,EAAS/Z,KAAK2Z,mBAMpB,cALOI,EAAOD,GACd1E,GAAMhK,IAAI4H,EAAgC+G,GAC1C/Z,KAAKwZ,cAAgBO,EAErBpY,QAAQC,IAAI,oCAAqCkY,IAC1C,CACT,EAGA,gBAAAS,CAAiBT,EAAQU,GACvB,MAAMhE,EAASJ,GAAce,kBAC7B,IAAKX,EAAQ,OAAO,EAEpB,MAAM4D,EAAQ5D,EAAOI,MAAMyD,UAAUxD,GAAKA,EAAE9G,KAAO+J,GACnD,OAAe,IAAXM,IAEJ5D,EAAOI,MAAMwD,GAAS,IAAK5D,EAAOI,MAAMwD,MAAWI,EAASzK,GAAI+J,GAChE1D,GAAc2B,kBAAkBvB,EAAOzG,GAAIyG,EAAOI,QAC3C,EACT,EAGA,OAAA6D,CAAQX,GACN,OAAO9Z,KAAKyZ,cAAc3R,KAAK+O,GAAKA,EAAE9G,KAAO+J,EAC/C,EAGA,UAAA5C,GACElX,KAAKJ,OAAS,KACdI,KAAKwZ,cAAgB,IACvB,EAGA,eAAAkB,CAAgBlY,GACd,OAAOxC,KAAKia,kBAAkB5J,OAAO2G,GAAQA,EAAK7C,cAAgB3R,EACpE,GAMImY,GAA6B,CACjC/a,OAAQ,KACR4Z,cAAe,KAGfoB,YAAW,IACF,SAASzY,KAAKC,SAASuL,KAAKqC,SAASkJ,SAAS,IAAI2B,OAAO,EAAG,KAIrE,WAAApB,GACE,GAAIzZ,KAAKJ,OAAQ,OAAOI,KAAKJ,OAE7B,MAAMgX,EAAQxB,GAAMnK,IAAI2H,EAAyB,IAC3C8G,EAAgB1Z,KAAK2Z,mBAGrBC,EAAWhD,EAAMhW,IAAIoW,IAAQ,IAC9BA,EACHtK,aAAoCjI,IAA3BiV,EAAc1C,EAAKjH,IAAoB2J,EAAc1C,EAAKjH,IAAMiH,EAAKtK,WAIhF,OADA1M,KAAKJ,OAASga,EACPA,CACT,EAGA,gBAAAD,GACE,OAAI3Z,KAAKwZ,gBACTxZ,KAAKwZ,cAAgBpE,GAAMnK,IAAI8H,EAA2B,CAAC,IAD5B/S,KAAKwZ,aAGtC,EAGA,kBAAAsB,CAAmBf,GACjB3E,GAAMhK,IAAI2H,EAA2BgH,GACrC/Z,KAAKwZ,cAAgBO,CACvB,EAGA,eAAAE,GACE,OAAOja,KAAKyZ,cAAcpJ,OAAO2G,IAAyB,IAAjBA,EAAKtK,QAChD,EAGA,kBAAAqO,CAAmBvY,EAAWwY,GAG5B,OAFiBhb,KAAKia,kBAGnB5J,OAAO2G,IAEN,OAAQA,EAAK3D,MAAMpE,MACjB,IAAK,SACH,OAAO,EACT,IAAK,QACH,OAAO+H,EAAK3D,MAAM4H,YAAcjE,EAAK3D,MAAM4H,WAAW/T,SAAS1E,GACjE,IAAK,SACH,OACEwU,EAAK3D,MAAM4H,YACXjE,EAAK3D,MAAM4H,WAAW/T,SAAS1E,IAC/BwU,EAAK3D,MAAM6H,aACXlE,EAAK3D,MAAM6H,YAAYhU,SAAS8T,GAEpC,QACE,OAAO,KAGZ7Z,KAAK,CAACC,EAAGC,IAAMA,EAAE8Z,SAAW/Z,EAAE+Z,SACnC,EAGA,iBAAAtB,CAAkBC,EAAQpN,GACxB,MAAMqN,EAAS/Z,KAAK2Z,mBACpBI,EAAOD,GAAUpN,EACjB1M,KAAK8a,mBAAmBf,GACxB/Z,KAAKkX,YACP,EAGA,aAAAgD,CAAclD,GACZ,MAAMJ,EAAQxB,GAAMnK,IAAI2H,EAAyB,IAGjD,IAAKoE,EAAK5D,OAAS4D,EAAK5F,UAAY4F,EAAK3D,MAEvC,OADA1R,QAAQ2M,MAAM,+CACP,EAGT,MAAMgK,EAAmC,CACvCvI,GAAI/P,KAAK4a,cACTxH,KAAM4D,EAAK5D,KACXa,YAAa+C,EAAK/C,YAClBmH,UAAWpE,EAAKoE,WAAa,UAC7BhK,QAAS4F,EAAK5F,QACdiK,MAAOrE,EAAKqE,OAAS,CAAC,EACtBC,YAAatE,EAAKsE,YAClBjI,MAAO2D,EAAK3D,MACZ3G,aAA0BjI,IAAjBuS,EAAKtK,SAAwBsK,EAAKtK,QAC3CyO,SAAUnE,EAAKmE,UAAY,GAC3BI,YAAavE,EAAKuE,aAAe,OACjCC,UAAWxE,EAAKwE,WAAa,GAC7BC,SAAUzE,EAAKyE,UAAY,CAAEC,aAAc,IAAKC,WAAY,IAAMC,eAAgB,KAClFlE,UAAWvV,KAAKC,MAChByZ,UAAW1Z,KAAKC,OAUlB,OAPAwU,EAAMlW,KAAK4X,GACXlD,GAAMhK,IAAIwH,EAAyBgE,GACnC5W,KAAKkX,aAGLlX,KAAK8b,2BAEExD,CACT,EAGA,wBAAAwD,GACE,MAAMC,EAAeC,GAAmB7E,kBACxC,GAAI4E,EAAc,CAChB,MAAMnC,EAAWxE,GAAMnK,IAAI2H,EAAyB,IACpDoJ,GAAmBjE,kBAAkBgE,EAAahM,GAAI6J,EACxD,CACF,EAGA,UAAAqC,CAAWnC,GACT,MAAMlD,EAAQxB,GAAMnK,IAAI2H,EAAyB,IAC3CwH,EAAQxD,EAAMyD,UAAUxD,GAAKA,EAAE9G,KAAO+J,GAC5C,OAAe,IAAXM,IAEJxD,EAAM0D,OAAOF,EAAO,GACpBhF,GAAMhK,IAAIwH,EAAyBgE,GACnC5W,KAAKkX,aAGLlX,KAAK8b,4BAEE,EACT,EAGA,UAAAI,CAAWpC,EAAQU,GACjB,MAAM5D,EAAQxB,GAAMnK,IAAI2H,EAAyB,IAC3CwH,EAAQxD,EAAMyD,UAAUxD,GAAKA,EAAE9G,KAAO+J,GAC5C,OAAe,IAAXM,IAEJxD,EAAMwD,GAAS,IACVxD,EAAMwD,MACNI,EACHzK,GAAI+J,EACJ+B,UAAW1Z,KAAKC,OAElBgT,GAAMhK,IAAIwH,EAAyBgE,GACnC5W,KAAKkX,aAGLlX,KAAK8b,4BAEE,EACT,EAGA,OAAArB,CAAQX,GACN,OAAO9Z,KAAKyZ,cAAc3R,KAAK+O,GAAKA,EAAE9G,KAAO+J,EAC/C,EAGA,UAAA5C,GACElX,KAAKJ,OAAS,KACdI,KAAKwZ,cAAgB,IACvB,GAMIwC,GAAqB,CACzBpc,OAAQ,KAGR,aAAAyW,GACE,GAAIrW,KAAKJ,OAAQ,OAAOI,KAAKJ,OAE7B,MAAMwX,EAAUhC,GAAMnK,IAAI4H,EAA2B,IAGrD,GAAuB,IAAnBuE,EAAQ7W,OAAc,CACxB,MAAM6Y,EAA6B,CACjCrJ,GAAI,gBACJqD,KAAM,OACNa,YAAa,gBACbwC,QAAS,QACTG,MAAO,GACPc,UAAWvV,KAAKC,MAChByZ,UAAW1Z,KAAKC,OAElBgV,EAAQ1W,KAAK0Y,GACbhE,GAAMhK,IAAIyH,EAA2BuE,EACvC,CAGA,OADApX,KAAKJ,OAASwX,EACPA,CACT,EAGA,eAAAD,GACE,MAAME,EAAWjC,GAAMnK,IAAI6H,EAAiC,iBACtDsE,EAAUpX,KAAKqW,gBACrB,OAAOe,EAAQtP,KAAKwP,GAAKA,EAAEvH,KAAOsH,IAAaD,EAAQ,EACzD,EAGA,eAAAG,CAAgBW,GAGd,OAFgBlY,KAAKqW,gBACEvO,KAAKwP,GAAKA,EAAEvH,KAAOmI,IAM1C9C,GAAMhK,IAAI0H,EAAiCoF,GAG3CyC,GAA2BzD,cAEpB,IATLvV,QAAQ2M,MAAM,kCAAmC4J,IAC1C,EASX,EAGA,YAAAV,CAAapE,EAAM+I,GACjB,MAAM/E,EAAUpX,KAAKqW,gBAGrB,GAAIe,EAAQnB,KAAKqB,GAAKA,EAAElE,OAASA,GAE/B,OADAzR,QAAQ2M,MAAM,oCAAqC8E,IAC5C,EAGT,MAAMgJ,EAAeD,EAAiB/E,EAAQtP,KAAKwP,GAAKA,EAAEvH,KAAOoM,GAAkBnc,KAAKmX,kBAElFM,EAAyB,CAC7B1H,GAAI,gBAAgB5N,KAAKC,QACzBgR,KAAMA,EACNa,YAAamI,GAAcnI,YAC3BwC,QAAS,QACTG,MAAOwF,EAAetb,KAAKC,MAAMD,KAAKwB,UAAU8Z,EAAaxF,QAAU,GACvEc,UAAWvV,KAAKC,MAChByZ,UAAW1Z,KAAKC,OAKlB,OAFAgV,EAAQ1W,KAAK+W,GACbzX,KAAKiC,MAAMmV,GACJK,CACT,EAGA,iBAAAM,CAAkBG,EAAUtB,GAC1B,MAAMQ,EAAUpX,KAAKqW,gBACf+D,EAAQhD,EAAQiD,UAAU/C,GAAKA,EAAEvH,KAAOmI,GAC9C,OAAe,IAAXkC,IAEJhD,EAAQgD,GAAOxD,MAAQ9V,KAAKC,MAAMD,KAAKwB,UAAUsU,IACjDQ,EAAQgD,GAAOyB,UAAY1Z,KAAKC,MAEhCpC,KAAKiC,MAAMmV,GAGPc,IAAa9C,GAAMnK,IAAI6H,IACzB6H,GAA2BzD,cAGtB,EACT,EAGA,YAAAW,CAAaK,GACX,MAAMd,EAAUpX,KAAKqW,gBAGrB,GAAIe,EAAQ7W,QAAU,EAEpB,OADAoB,QAAQ2M,MAAM,yCACP,EAGT,MAAM8L,EAAQhD,EAAQiD,UAAU/C,GAAKA,EAAEvH,KAAOmI,GAC9C,OAAe,IAAXkC,IAEJhD,EAAQkD,OAAOF,EAAO,GACtBpa,KAAKiC,MAAMmV,GAGPc,IAAa9C,GAAMnK,IAAI6H,IACzB9S,KAAKuX,gBAAgBH,EAAQ,GAAGrH,KAG3B,EACT,EAGA,YAAAiI,CAAaE,GACX,MAAM1B,EAASxW,KAAKqW,gBAAgBvO,KAAKwP,GAAKA,EAAEvH,KAAOmI,GACvD,IAAK1B,EAAQ,OAAO,KAGpB,MAAMuF,EAAe/b,KAAKmX,kBAEpBP,EADiBmF,GAAgBA,EAAahM,KAAOmI,EAC5B9C,GAAMnK,IAAI2H,EAAyB,IAAM4D,EAAOI,MAEzEyF,EAAa,IACd7F,EACHI,MAAOA,GAGT,OAAO9V,KAAKwB,UAAU+Z,EAAY,KAAM,EAC1C,EAGA,YAAA5D,CAAa6D,GACX,IACE,MAAMzb,EAAOC,KAAKC,MAAMub,GAGxB,IAAKzb,EAAKuS,OAASrO,MAAMuQ,QAAQzU,EAAK+V,OAEpC,OADAjV,QAAQ2M,MAAM,qCACP,EAGT,MAAM8I,EAAUpX,KAAKqW,gBAGfoB,EAAyB,CAC7B1H,GAAI,gBAAgB5N,KAAKC,QACzBgR,KAAMvS,EAAKuS,KACXa,YAAapT,EAAKoT,YAClBwC,QAAS5V,EAAK4V,SAAW,QACzBG,MAAO/V,EAAK+V,MAAMhW,IAAKoW,IAAkC,IACpDA,EACHjH,GAAI4K,GAA2BC,iBAEjClD,UAAWvV,KAAKC,MAChByZ,UAAW1Z,KAAKC,OAKlB,OAFAgV,EAAQ1W,KAAK+W,GACbzX,KAAKiC,MAAMmV,GACJK,CACT,CAAE,MAAO5V,GAEP,OADAF,QAAQ2M,MAAM,mCAAoCzM,IAC3C,CACT,CACF,EAGA,KAAAI,CAAMmV,GACJhC,GAAMhK,IAAIyH,EAA2BuE,GACrCpX,KAAKJ,OAASwX,CAChB,EAGA,UAAAF,GACElX,KAAKJ,OAAS,IAChB,GAMI2c,GAA4B,CAEhCC,YAAa,IAAIpE,IAGjB,WAAAqE,CAAYpB,GACV,MAAMqB,EAAmB,GAMzB,OALIrB,EAAMsB,iBAAiBD,EAAOhc,KAAK,KACnC2a,EAAMuB,QAAQF,EAAOhc,KAAK,KAC1B2a,EAAMwB,WAAWH,EAAOhc,KAAK,KAC7B2a,EAAMyB,SAASJ,EAAOhc,KAAK,KAC3B2a,EAAM0B,QAAQL,EAAOhc,KAAK,KACvBgc,EAAOrS,KAAK,GACrB,EAGA,SAAA2S,CAAU5L,EAAiBiK,GAEzB,MAAM4B,EAAgB7L,EAAQlK,SAAS,QAAUkK,EAAQlK,SAAS,QAC5DgW,EAAe9L,EAAQlK,SAAS,QAAUkK,EAAQlK,SAAS,QAC5C+V,GAAiBC,KAGjB7B,EAAMyB,UACzBzB,EAAQ,IAAKA,EAAOyB,SAAS,IAG/B,MAAMK,EAAWnd,KAAKyc,YAAYpB,GAC5B+B,EAAW,GAAGhM,KAAW+L,IAE/B,GAAInd,KAAKwc,YAAY9G,IAAI0H,GAAW,CAClC,MAAMC,EAAQrd,KAAKwc,YAAYvR,IAAImS,GAEnC,OADAC,EAAMC,UAAY,EACXD,CACT,CAEA,IACE,MAAMA,EAAQ,IAAIE,OAAOnM,EAAS+L,GAElC,OADAnd,KAAKwc,YAAYpR,IAAIgS,EAAUC,GACxBA,CACT,CAAE,MAAOxb,GAEP,OADAF,QAAQ2M,MAAM,2CAA4C8C,EAASvP,GAC5D,IACT,CACF,EAGA,qBAAA2b,CAAsBpM,GACpB,IAAIqM,EAAQ,EAGR,mBAAmB7T,KAAKwH,KAAUqM,GAAS,IAG3C,sBAAsB7T,KAAKwH,KAAUqM,GAAS,IAGlD,MAAMC,GAAiBtM,EAAQrH,MAAM,QAAU,IAAIxJ,OAGnD,OAFAkd,GAAS9P,KAAK8G,IAAoB,EAAhBiJ,EAAmB,IAE9BD,CACT,EAGA,kBAAAE,CAAmB3G,GACjB,MAAM4G,EAAa5d,KAAKwd,sBAAsBxG,EAAK5F,SAC7CyM,EAAc7G,EAAKyE,UAAUC,cAAgB,IAEnD,OAAO/N,KAAKC,IAAIiQ,EAA2B,EAAbD,EAAgB,GAChD,EAGA,YAAAE,CAAa5a,EAAe8T,EAA+BqG,GACzD,MAAMU,EAAW7a,EAGX0Y,EAAiB5E,EAAKyE,UAAUG,gBAAkB,IACxD,GAAI1Y,EAAM3C,OAASqb,EACjB,MAAO,CACLoC,SAAS,EACTD,WACAE,SAAUF,EACVG,SAAS,EACT5P,MAAO,YAAYsN,MAIvB,IACE,MAAMuC,EAAUne,KAAK2d,mBAAmB3G,GAClCoH,EAAYjc,KAAKC,MAGvB,IAAI6b,EACJ,OAAQjH,EAAKoE,WACX,IAAK,UACH6C,EAAW/a,EAAMyC,QAAQ0X,EAAOrG,EAAKsE,aAAe,IACpD,MACF,IAAK,SACH2C,EAAW/a,EAAMyC,QAAQ0X,EAAO,IAChC,MACF,IAAK,WACaA,EAAMzT,KAAK1G,GAC3B+a,EAAW/a,EACX,MACF,QACE+a,EAAW/a,EAIf,MAAMmb,EAAUlc,KAAKC,MAAQgc,EAC7B,GAAIC,EAAUF,EAEZ,OADAxc,QAAQG,KAAK,0CAA2CkV,EAAK5F,QAASiN,GAC/D,CACLL,SAAS,EACTD,WACAE,SAAUF,EACVG,SAAS,EACT5P,MAAO,QAAQ+P,SAAeF,QAOlC,MAAO,CACLH,SAAS,EACTD,WACAE,WACAC,QANcH,IAAaE,GAAYZ,EAAMzT,KAAKmU,GAQtD,CAAE,MAAOlc,GAEP,OADAF,QAAQ2M,MAAM,0CAA2C0I,EAAK5F,QAASvP,GAChE,CACLmc,SAAS,EACTD,WACAE,SAAUF,EACVG,SAAS,EACT5P,MAAO5I,OAAO7D,GAElB,CACF,EAGA,YAAAyc,CAAapb,EAAe8T,GAC1B,GAAI9T,QACF,MAAO,CACL8a,SAAS,EACTD,SAAU,GACVE,SAAU,GACVC,SAAS,GAIb,MAAMK,EAAW7Y,OAAOxC,GAGxB,IAAIkO,EAAU4F,EAAK5F,QACfiK,EAAQrE,EAAKqE,OAAS,CAAC,EAG3B,MAAMmD,EAAYxe,KAAKye,cAAcrN,GACjCoN,EAAUE,sBAAwBtN,IAEpCA,EAAUoN,EAAUE,oBACpBrD,EAAQ,IAAKA,KAAUmD,EAAUnD,aAKd5W,IAAjB4W,EAAMuB,SACRvB,EAAMuB,QAAS,GAGjB,MAAMS,EAAQrd,KAAKgd,UAAU5L,EAASiK,GAEtC,OAAKgC,EAUErd,KAAK8d,aAAaS,EAAUvH,EAAMqG,GAThC,CACLW,SAAS,EACTD,SAAUQ,EACVN,SAAUM,EACVL,SAAS,EACT5P,MAAO,WAKb,EAGA,aAAAmQ,CAAcE,GACZ,MAAMtD,EAAoB,CACxBuB,QAAQ,EACRD,iBAAiB,EACjBE,WAAW,EACXC,SAAS,EACTC,QAAQ,GAIJ6B,EAAkBD,EAAW5U,MAAM,wBACzC,GAAI6U,EAAiB,CACnB,MAAO,CAAEF,EAAqBG,GAAWD,EAMzC,OALIC,EAAQ3X,SAAS,OAAMmU,EAAMuB,QAAS,GACtCiC,EAAQ3X,SAAS,OAAMmU,EAAMsB,iBAAkB,GAC/CkC,EAAQ3X,SAAS,OAAMmU,EAAMwB,WAAY,GACzCgC,EAAQ3X,SAAS,OAAMmU,EAAMyB,SAAU,GACvC+B,EAAQ3X,SAAS,OAAMmU,EAAM0B,QAAS,GACnC,CAAE1B,QAAOqD,sBAClB,CAGA,MAAO,CAAErD,QAAOqD,oBAAqBC,EACvC,EAGA,YAAAG,CACEC,EAGAnI,GAEA,IAAIoI,EAAe,EACnB,MAAMC,EAAmB,GAEzB,IAEE,IAAIC,GAAiB,EACjBC,EAGA,IAAI/G,IAER,GAAI,SAAU2G,GAAa,YAAaA,GAAa,SAAUA,EAAW,CAExEG,GAAiB,EACjB,MAAME,EAAcL,EACpBI,EAAS/T,IAAIgU,EAAYhM,KAAM,CAC7BiM,MAAOD,EACPE,SAAUF,EAAYhM,KACtBA,KAAMgM,EAAYhM,KAClB1Q,QAAS0c,EAAY1c,QACrB6c,iBAAkB,GAEtB,KAAO,CAEL,MAAMC,EAAUT,EAEhBnb,OAAOC,KAAK2b,GAAShe,QAAQ8d,IAC3B,IAAKA,EAAS7e,WAAW,UAAW,OAEpC,MAAM4e,EAAQG,EAAQF,GACtB,IAAKD,IAAUA,EAAM3P,UAAY3K,MAAMuQ,QAAQ+J,EAAM3P,UAAY2P,EAAM3P,QAAQnP,OAAS,EAEtF,YADAoB,QAAQG,KAAK,8BAA8Bwd,KAI7C,MAAM9c,EAAY6c,EAAMjM,MAAQkM,EAChCH,EAAS/T,IAAI5I,EAAW,CACtB6c,QACAC,WACAlM,KAAM5Q,EACNE,QAAS2c,EAAM3P,QAAQ,IAAM,GAC7B6P,gBAAiB,KAGvB,CAEA,GAAsB,IAAlBJ,EAASM,KAEX,OADA9d,QAAQG,KAAK,iCACN,CAAEkd,aAAc,EAAGC,OAAQ,CAAC,cAIrC,IAAK,MAAOzc,EAAWkd,KAAcP,EAAS3a,UAAW,CACvD,MAAM,MAAE6a,EAAK,QAAE3c,EAAO,gBAAE6c,GAAoBG,EAE5C,IAAK,MAAM1I,KAAQJ,EAAO,CACxB,IAAKI,EAAKtK,QAAS,SAGnB,MAAM2G,EAAQ2D,EAAK3D,MAGnB,GAF0C,WAAfA,EAAMpE,MAAqBoE,EAAM4H,YAAY/T,SAAS1E,GAIjF,IAEE,GAAI0c,EAAgB,CAElB,MAAMS,EAAQN,EAA+BM,KAC7C,IAAK,IAAIpb,EAAW,EAAGA,EAAWob,EAAKpf,OAAQgE,IAAY,CACzD,MAAM9B,EAAMkd,EAAKpb,GAGjB,IAAK,IAAIqb,EAAW,EAAGA,EAAWnd,EAAIlC,OAAQqf,IAAY,CACxD,MAAM5E,EAAatY,EAAQkd,GAG3B,GAAmB,WAAfvM,EAAMpE,OACHoE,EAAM6H,aAAahU,SAAS8T,GAAa,SAIhD,MAAM0B,EAAS1c,KAAKse,aAAa7b,EAAImd,GAAW5I,GAC5C0F,EAAOsB,QACLtB,EAAOwB,UACTzb,EAAImd,GAAYlD,EAAOuB,SACvBe,KAGFC,EAAOve,KAAK,GAAGsW,EAAK5D,SAAS5Q,OAAeka,EAAOpO,QAEvD,CACF,CACF,KAAO,CAEL,MAAMoB,EAAU2P,EAAM3P,QACtB,IAAK,IAAI6P,EAAkB,EAAGA,EAAkB7P,EAAQnP,OAAQgf,IAAmB,CACjF,MAAM9c,EAAMiN,EAAQ6P,GACpB,GAAKxa,MAAMuQ,QAAQ7S,GAGnB,IAAK,IAAImd,EAAW,EAAGA,EAAWnd,EAAIlC,OAAQqf,IAAY,CACxD,MAAM5E,EAAatY,EAAQkd,GAG3B,GAAmB,WAAfvM,EAAMpE,OACHoE,EAAM6H,aAAahU,SAAS8T,GAAa,SAIhD,MAAM+C,EAAWtb,EAAImd,GACflD,EAAS1c,KAAKse,aAAaP,EAAU/G,GAEvC0F,EAAOsB,QACLtB,EAAOwB,UACTzb,EAAImd,GAAYlD,EAAOuB,SACvBe,IACArd,QAAQke,MACN,eAAerd,KAAa+c,MAAoBvE,IAChD,IAAI0B,EAAOqB,iBAAiBrB,EAAOuB,cAIvCgB,EAAOve,KAAK,GAAGsW,EAAK5D,SAAS5Q,OAAeka,EAAOpO,QAEvD,CACF,CACF,CACF,CAAE,MAAOwR,GACP,MAAMC,EAAWD,aAAsBjQ,MAAQiQ,EAAWtN,QAAU9M,OAAOoa,GAC3Ene,QAAQ2M,MAAM,4BAA4B9L,SAAkBsd,GAC5Db,EAAOve,KAAK,GAAGsW,EAAK5D,SAAS5Q,iBAAyBud,IACxD,CACF,CACF,CAEIf,EAAe,GACjBrd,QAAQ0M,KAAK,4BAA4B2Q,SAEvCC,EAAO1e,OAAS,GAClBoB,QAAQG,KAAK,0BAA0Bmd,EAAO1e,aAElD,CAAE,MAAOsB,GACP,MAAMke,EAAWle,aAAagO,MAAQhO,EAAE2Q,QAAU9M,OAAO7D,GACzDF,QAAQ2M,MAAM,4BAA6BzM,GAC3Cod,EAAOve,KAAK,SAASqf,IACvB,CAEA,MAAO,CAAEf,eAAcC,SACzB,EAGA,WAAAe,CACE9c,EACAV,EACAwY,EACAO,GAGA,MAAM3E,EAAQ+D,GAA2BI,mBAAmBvY,EAAWwY,GAGvE,GAAqB,IAAjBpE,EAAMrW,OACR,MAAO,CACLyd,SAAS,EACTD,SAAU7a,GAAS,GACnB+a,SAAU/a,GAAS,GACnBgb,SAAS,GAKb,IAAI+B,EAAkBrJ,EAKtB,GAJI2E,IACF0E,EAAkBrJ,EAAMvG,OAAOwG,GAAKA,EAAE0E,cAAgBA,GAAiC,SAAlB1E,EAAE0E,cAG1C,IAA3B0E,EAAgB1f,OAClB,MAAO,CACLyd,SAAS,EACTD,SAAU7a,GAAS,GACnB+a,SAAU/a,GAAS,GACnBgb,SAAS,GAKb,IAAIgC,EAAehd,GAAS,GACxBid,GAAa,EAEjB,IAAK,MAAMnJ,KAAQiJ,EAAiB,CAClC,MAAMvD,EAAS1c,KAAKse,aAAa4B,EAAclJ,GAC/C,IAAK0F,EAAOsB,QACV,OAAOtB,EAELA,EAAOwB,UACTiC,GAAa,GAEfD,EAAexD,EAAOuB,QACxB,CAEA,MAAO,CACLD,SAAS,EACTD,SAAU7a,GAAS,GACnB+a,SAAUiC,EACVhC,QAASiC,EAEb,EAGA,UAAAC,CAAW3d,EAAeC,EAAmBF,EAAmB+Y,GAC9D,OAAO9Y,EAAI7B,IAAI,CAACyf,EAAMjG,KACpB,MAAMY,EAAatY,EAAQ0X,GAE3B,OADepa,KAAKggB,YAAYK,EAAM7d,EAAWwY,EAAYO,GAC/C0C,UAElB,EAGA,qBAAAqC,CACEvB,EACAxD,GAEA,MAAM/Y,EAAYuc,EAAU3L,KACtBwD,EAAQ+D,GAA2BI,mBAAmBvY,EAAW,MAAM6N,OAC3EwG,GAAsB,WAAjBA,EAAExD,MAAMpE,MAAqB4H,EAAExD,MAAM4H,YAAY/T,SAAS1E,IAG3D+d,EAAgC,GAEtC,IAAK,MAAMvJ,KAAQJ,EAAO,CACxB,MAAM4J,EAAqD,GAC3D,IAAIC,EAAgB,EAEpB,IAAK,IAAIlc,EAAW,EAAGA,EAAWwa,EAAUY,KAAKpf,OAAQgE,IAAY,CACnE,MAAM9B,EAAMsc,EAAUY,KAAKpb,GAC3B,IAAK,IAAIqb,EAAW,EAAGA,EAAWnd,EAAIlC,OAAQqf,IAAY,CACxD,MAAM5E,EAAa+D,EAAUrc,QAAQkd,GAC/B1c,EAAQT,EAAImd,GAGlB,GAAwB,WAApB5I,EAAK3D,MAAMpE,MACb,IAAK+H,EAAK3D,MAAM6H,aAAahU,SAAS8T,KAAgBhE,EAAK3D,MAAM4H,YAAY/T,SAAS1E,GACpF,cAEG,GAAwB,UAApBwU,EAAK3D,MAAMpE,OACf+H,EAAK3D,MAAM4H,YAAY/T,SAAS1E,GACnC,SAIJ,MAAMka,EAAS1c,KAAKse,aAAapb,EAAO8T,GACpC0F,EAAOwB,SAAWxB,EAAOqB,WAAarB,EAAOuB,WAC/CuC,EAAc9f,KAAK,CACjB8B,YACA+B,WACAmc,YAAad,EACb5E,aACA+C,SAAUrB,EAAOqB,SACjBE,SAAUvB,EAAOuB,WAEnBwC,IAEJ,CACF,CAEIA,EAAgB,GAClBF,EAAQ7f,KAAK,CACXsW,OACAwJ,gBACAC,iBAGN,CAEA,OAAOF,CACT,EAGA,eAAAI,GACE3gB,KAAKwc,YAAYrM,OACnB,GAMIyQ,GAAmB,CAEvB,cAAAC,CAAe3d,EAAOkO,GACpB,GAAIlO,SAAmD,KAAVA,EAAc,OAAO,EAClE,IAEE,OADc,IAAIqa,OAAOnM,GACZxH,KAAKlE,OAAOxC,GAC3B,CAAE,MAAOrB,GAEP,OADAF,QAAQ2M,MAAM,kCAAmC8C,EAASvP,IACnD,CACT,CACF,EAGAif,aAAY,CAAC5d,EAAO6d,IACd7d,SAAmD,KAAVA,KACxC6B,MAAMuQ,QAAQyL,IAA2C,IAAzBA,EAAcxgB,QAC5CwgB,EAAc7Z,SAASxB,OAAOxC,KAIvC,eAAA8d,CAAgB9d,EAAOuR,EAAK7G,GAC1B,GAAI1K,SAAmD,KAAVA,EAAc,OAAO,EAGlE,MAAM+d,EAASvb,OAAOxC,GACtB,IAAIge,EAGJ,GAAID,EAAOE,SAAS,KAClBD,EAASE,WAAWH,QAGjB,GAAIA,EAAO/Z,SAAS,KAAM,CAC7B,MAAMiD,EAAQ8W,EAAOzT,MAAM,KAC3B0T,EAASE,WAAWjX,EAAM,GAC5B,MAEK,GAAI8W,EAAO/Z,SAAS,KAAM,CAC7B,MAAMiD,EAAQ8W,EAAOzT,MAAM,KAC3B0T,EAASE,WAAWjX,EAAMA,EAAM5J,OAAS,GAC3C,MAGE2gB,EAASE,WAAWH,GAGtB,OAAII,MAAMH,OAENzM,SAAqCyM,EAASzM,MAC9C7G,SAAqCsT,EAAStT,GAEpD,EAGA,gBAAA0T,CAAiBpe,EAAOqe,EAAS7M,EAAUC,GACzC,GAAIzR,SAAmD,KAAVA,EAAc,OAAO,EAClE,IAAKqe,IAAY7M,IAAaC,EAAW,OAAO,EAGhD,IAAI6M,EAAW,KACf,IAAK,MAAMC,KAAWF,EACpB,GAAIA,EAAQE,IAAUrO,OAASsB,EAAU,CACvC8M,EAAWD,EAAQE,GACnB,KACF,CAGF,IAAKD,IAAaA,EAAS9R,SAAW8R,EAAS9R,QAAQnP,OAAS,EAC9D,OAAO,EAGT,MAAMmC,EAAU8e,EAAS9R,QAAQ,GAC3BuR,EAASvb,OAAOxC,GAGhBwe,EAAU3c,MAAMuQ,QAAQX,GAAaA,EAAY,CAACA,GAExD,IAAK,MAAMgN,KAAOD,EAAS,CACzB,MAAME,EAAclf,EAAQI,QAAQ6e,GACpC,IAAqB,IAAjBC,EAGJ,IAAK,IAAIvhB,EAAI,EAAGA,EAAImhB,EAAS9R,QAAQnP,OAAQF,IAC3C,GAAIqF,OAAO8b,EAAS9R,QAAQrP,GAAGuhB,IAAgB,MAAQX,EACrD,OAAO,CAGb,CAEA,OAA0B,IAAnBS,EAAQnhB,MACjB,EAGAshB,iBAAiB3e,GACRA,SAAkE,KAAzBwC,OAAOxC,GAAOwF,OAIhE,gBAAAoZ,CAAiB5e,EAAO6e,GACtB,GAAI7e,SAAmD,KAAVA,EAAc,OAAO,EAElE,MAAM0R,EAAYmN,GAAYnN,WAAa,OACrCC,EAAWkN,GAAYlN,SACvBC,EAAWiN,GAAYjN,SAG7B,IAAIkN,EAAiBtc,OAAOxC,GAG5B8e,EAAiBA,EACdrc,QAAQ,KAAM,KACdA,QAAQ,KAAM,KACdA,QAAQ,KAAM,KAGjBqc,EAAiBA,EAAerc,QAAQ,OAAQ,IAGhD,MAAMsc,EAAQD,EAAexU,MAAM,KAAK6C,OAAOiH,GAAKA,EAAE5O,QAEtD,GAAqB,IAAjBuZ,EAAM1hB,OAAc,OAAO,EAG/B,IAAK,MAAM2hB,KAAQD,EAAO,CACxB,MAAME,EAAaD,EAAKpf,QAAQ,KAChC,IAAoB,IAAhBqf,GAAoC,IAAfA,GAAoBA,IAAeD,EAAK3hB,OAAS,EACxE,OAAO,EAGT,MAAMC,EAAM0hB,EAAKE,UAAU,EAAGD,GACxBja,EAAMga,EAAKE,UAAUD,EAAa,GAExC,IAAK3hB,IAAQ0H,EAAK,OAAO,EAGzB,GAAkB,YAAd0M,EAAyB,CAE3B,IAAK,kBAAkBhL,KAAK1B,EAAIQ,QAAS,OAAO,EAEhD,MAAMwY,EAASE,WAAWlZ,GAC1B,GAAImZ,MAAMH,GAAS,OAAO,EAE1B,GAAIrM,SAA+CqM,EAASrM,EAAU,OAAO,EAC7E,GAAIC,SAA+CoM,EAASpM,EAAU,OAAO,CAC/E,CAEF,CAEA,OAAO,CACT,EAGAuN,sBAAqB,CAACC,EAAYha,KAC3Bga,IAAeha,GACbxH,KAAKwB,UAAUggB,KAAgBxhB,KAAKwB,UAAUgG,GAIvDia,iBAAgB,CAACC,EAAU/N,EAAK7G,MAC1B6G,SAAqC+N,EAAW/N,MAChD7G,SAAqC4U,EAAW5U,GAKtD,gBAAA6U,CAAiBpD,EAAOrE,EAAYnU,GAClC,IAAKwY,IAAUA,EAAM3P,SAAW2P,EAAM3P,QAAQnP,OAAS,EAAG,OAAO,EACjE,IAAKya,IAAenU,EAAQ,OAAO,EAEnC,MAAMnE,EAAU2c,EAAM3P,QAAQ,IAAM,GAC9BiQ,EAAON,EAAM3P,QAAQnO,MAAM,IAAM,GACjCqe,EAAWld,EAAQI,QAAQkY,GACjC,GAAI4E,EAAW,EAAG,OAAO,EAEzB,MAAMzf,EAAS0G,EAAO1G,QAAU,GAC1BmU,OAAiC7P,IAArBoC,EAAOyN,UAA0BzN,EAAOyN,UAAY,EAGhEoO,EAAU,GACVC,EAAe,GACrB,IAAK,IAAItiB,EAAI,EAAGA,EAAIsf,EAAKpf,OAAQF,IAAK,CACpC,MAAM6C,EAAQyc,EAAKtf,KAAKuf,GAExB,GADA+C,EAAajiB,KAAK,CAAE6D,SAAUlE,EAAGuiB,SAAU1f,EAAO+L,YAAa/L,IAC3DA,SAAmD,KAAVA,EAAc,SAE3D,MAAMqb,EAAW7Y,OAAOxC,GAAOwF,OAC/B,GAAK6V,EAGL,GAAIpe,EAAQ,CACV,MAAM0iB,EAAgB1iB,EAAOwF,QAAQ,sBAAuB,QACtD0X,EAAQ,IAAIE,OAAO,IAAIsF,YACvB9Y,EAAQwU,EAASxU,MAAMsT,GAC7B,GAAItT,EAAO,CACT,MAAM+Y,EAAMC,SAAShZ,EAAM,GAAI,IAC1BsX,MAAMyB,IAAMJ,EAAQhiB,KAAK,CAAE6D,SAAUlE,EAAG6C,MAAOqb,EAAUuE,OAChE,CACF,KAAO,CAEL,MAAMA,EAAMC,SAASxE,EAAU,IAC1B8C,MAAMyB,IAAMJ,EAAQhiB,KAAK,CAAE6D,SAAUlE,EAAG6C,MAAOqb,EAAUuE,OAChE,CACF,CAEA,GAAuB,IAAnBJ,EAAQniB,OAAc,OAAO,EAGjCmiB,EAAQvhB,KAAK,CAACC,EAAGC,IAAMD,EAAEmD,SAAWlD,EAAEkD,UAItC,GADe,IAAIgR,IAAImN,EAAQ9hB,IAAIoiB,GAAKA,EAAEF,MAC/BrD,OAASiD,EAAQniB,OAC1B,OAAO,EAKT,IAAK,IAAIF,EAAI,EAAGA,EAAIqiB,EAAQniB,OAAQF,IAAK,CACvC,MAAM4iB,EAAc3O,EAAYjU,EAEhC,GADkBqiB,EAAQriB,GAAGyiB,MACXG,EAChB,OAAO,CAEX,CAEA,OAAO,CACT,EAGA,eAAAC,CAAgB1f,EAAU2f,EAASvM,GACjC,MAAMwM,EAAa,GACnB,IAAK5f,IAAa2f,IAAYvM,EAAO,OAAOwM,EAE5C,IAAK,MAAMpM,KAAQJ,EAAO,CAExB,IAAKI,EAAKtK,UAAYsK,EAAKrI,UAAW,SACtC,MAAM0U,EAAWnQ,EAAe8D,EAAK3C,UACrC,IAAKgP,EAAU,SAGf,IAAIC,EAAW,KACbC,EAAW,KACb,IAAK,MAAM9B,KAAWje,EACpB,GAAIA,EAASie,IAAUrO,OAAS4D,EAAK7C,YAAa,CAChDmP,EAAW9f,EAASie,GACpB,KACF,CAEF,IAAK,MAAMA,KAAW0B,EACpB,GAAIA,EAAQ1B,IAAUrO,OAAS4D,EAAK7C,YAAa,CAC/CoP,EAAWJ,EAAQ1B,GACnB,KACF,CAGF,GAAK8B,EAGL,GAAuB,UAAnBF,EAAShQ,MACX,GAAsB,kBAAlB2D,EAAK3C,SACFrU,KAAKqiB,sBAAsBiB,GAAU5T,QAAS6T,GAAU7T,UAC3D0T,EAAW1iB,KAAK,CACdsW,OACAxU,UAAWwU,EAAK7C,YAChB3B,QAASwE,EAAKzC,cAAgB,MAAMyC,EAAK7C,gCAGxC,GAAsB,aAAlB6C,EAAK3C,SAAyB,CACvC,MAAMmO,GAAYe,EAAS7T,SAASnP,QAAU,GAAK,EAC9CP,KAAKuiB,iBAAiBC,EAAUxL,EAAKnQ,QAAQ4N,IAAKuC,EAAKnQ,QAAQ+G,MAClEwV,EAAW1iB,KAAK,CACdsW,OACAxU,UAAWwU,EAAK7C,YAChB3B,QACEwE,EAAKzC,cACL,MAAMyC,EAAK7C,mBAAmBqO,WAAkBxL,EAAKnQ,QAAQ4N,KAAO,KAAKuC,EAAKnQ,QAAQ+G,KAAO,QAGrG,KAA6B,aAAlBoJ,EAAK3C,UAA2B2C,EAAK5C,eAEzCpU,KAAKyiB,iBAAiBc,EAAUvM,EAAK5C,aAAc4C,EAAKnQ,QAAU,CAAC,IACtEuc,EAAW1iB,KAAK,CACdsW,OACAxU,UAAWwU,EAAK7C,YAChB3B,QACEwE,EAAKzC,cACL,OAAOyC,EAAK5C,yBAAyB4C,EAAKnQ,QAAQ1G,QAAU,KAAKuF,OAAOsR,EAAKnQ,QAAQyN,WAAa,GAAGkP,SAAS,EAAG,6BAMtH,GAAuB,UAAnBH,EAAShQ,OAAqB2D,EAAK5C,aAAc,CACxD,MACMwL,GADU2D,EAAS7T,UAAU,IAAM,IAChB5M,QAAQkU,EAAK5C,cACtC,IAAkB,IAAdwL,EAAiB,SAGrB,IAAK,IAAI6D,EAAS,EAAGA,GAAUF,EAAS7T,SAASnP,QAAU,GAAIkjB,IAAU,CACvE,MAAMhhB,EAAM8gB,EAAS7T,QAAQ+T,GACvBvgB,EAAQT,IAAMmd,GAGpB,IAFgB5f,KAAK0jB,cAAcxgB,EAAO8T,EAAMmM,GAElC,CACZC,EAAW1iB,KAAK,CACdsW,OACAxU,UAAWwU,EAAK7C,YAChB5P,SAAUkf,EACVzI,WAAYhE,EAAK5C,aACjB8L,aAAcxa,OAAOxC,GAAS,IAC9BsP,QAASwE,EAAKzC,cAAgB,OAAOyC,EAAK5C,uBAG5C,KACF,CACF,CACF,CACF,CACA,OAAOgP,CACT,EAGA,aAAAM,CAAcxgB,EAAO8T,EAAMuK,GACzB,OAAQvK,EAAK3C,UACX,IAAK,SACH,OAAOrU,KAAK6gB,eAAe3d,EAAO8T,EAAKnQ,QAAQuK,SACjD,IAAK,OACH,OAAOpR,KAAK8gB,aAAa5d,EAAO8T,EAAKnQ,QAAQ2N,QAC/C,IAAK,UACH,OAAOxU,KAAKghB,gBAAgB9d,EAAO8T,EAAKnQ,QAAQ4N,IAAKuC,EAAKnQ,QAAQ+G,KACpE,IAAK,WACH,OAAO5N,KAAKshB,iBAAiBpe,EAAOqe,EAASvK,EAAKnQ,QAAQ6N,SAAUsC,EAAKnQ,QAAQ8N,WACnF,IAAK,WACH,OAAO3U,KAAK6hB,iBAAiB3e,GAC/B,IAAK,WACH,OAAOlD,KAAK8hB,iBAAiB5e,EAAO8T,EAAKnQ,QAC3C,QACE,OAAO,EAEb,EAGA,WAAA8c,CAAYlhB,EAAKC,EAASF,EAAW+B,EAAUqS,EAAO2K,GACpD,MAAMtC,EAAS,GAET2E,EAAWnhB,EAAI,IAAMA,EAAI,IAAM,KAAK8B,EAAW,IAErD,IAAK,MAAMyS,KAAQJ,EAAO,CACxB,GAAII,EAAK7C,cAAgB3R,EAAW,SACpC,IAAKwU,EAAKtK,QAAS,SAGnB,MAAMkT,EAAWld,EAAQI,QAAQkU,EAAK5C,cACtC,IAAkB,IAAdwL,EAAiB,SAErB,MAAM1c,EAAQT,EAAImd,GACF5f,KAAK0jB,cAAcxgB,EAAO8T,EAAMuK,IAG9CtC,EAAOve,KAAK,CACVoZ,OAAQ9C,EAAKjH,GACb8T,SAAU7M,EAAK5D,KACfiB,SAAU2C,EAAK3C,SACf2C,KAAMA,EACNxU,UAAWA,EACX+B,SAAUA,EACVyW,WAAYhE,EAAK5C,aACjB8L,aAAcxa,OAAOxC,GAAS,IAC9B0gB,SAAUA,EACVrP,aAAcyC,EAAKzC,aACnBuP,SAAU,SAGhB,CAEA,OAAO7E,CACT,EAGA,eAAA8E,CAAgBxC,GACd,IAAKA,EAAS,MAAO,GAErB,MAAM3K,EAAQK,GAAsBgD,kBACpC,GAAqB,IAAjBrD,EAAMrW,OAAc,MAAO,GAE/B,MAAMyjB,EAAY,GAElB,IAAK,MAAMvC,KAAWF,EAAS,CAC7B,IAAKE,EAAQhhB,WAAW,UAAW,SACnC,MAAM4e,EAAQkC,EAAQE,GACtB,IAAKpC,GAAOjM,OAASiM,GAAO3P,SAAW2P,EAAM3P,QAAQnP,OAAS,EAAG,SAEjE,MAAMiC,EAAY6c,EAAMjM,KAClB1Q,EAAU2c,EAAM3P,QAAQ,GACxBuU,EAAarN,EAAMvG,OAAOwG,GAAKA,EAAE1C,cAAgB3R,GAEvD,GAA0B,IAAtByhB,EAAW1jB,OAAc,SAG7B,IAAK,MAAMyW,KAAQiN,EAAY,CAC7B,MAAMZ,EAAWnQ,EAAe8D,EAAK3C,UACrC,GAAwB,UAApBgP,GAAUhQ,MACZ,GAAsB,aAAlB2D,EAAK3C,SAAyB,CAChC,MAAMmO,EAAWnD,EAAM3P,QAAQnP,OAAS,EACnCP,KAAKuiB,iBAAiBC,EAAUxL,EAAKnQ,QAAQ4N,IAAKuC,EAAKnQ,QAAQ+G,MAClEoW,EAAUtjB,KAAK,CACboZ,OAAQ9C,EAAKjH,GACb8T,SAAU7M,EAAK5D,KACfiB,SAAU2C,EAAK3C,SACf2C,KAAMA,EACNxU,UAAWA,EACX+B,UAAW,EACXyW,WAAY,GACZkF,aAAc,GAAGsC,MACjBjO,aACEyC,EAAKzC,cACL,MAAMiO,WAAkBxL,EAAKnQ,QAAQ4N,KAAO,KAAKuC,EAAKnQ,QAAQ+G,KAAO,OACvEkW,SAAU,WAGhB,MAAO,GAAsB,aAAlB9M,EAAK3C,UAA2B2C,EAAK5C,aAAc,CAG5D,IADgBpU,KAAKyiB,iBAAiBpD,EAAOrI,EAAK5C,aAAc4C,EAAKnQ,QAAU,CAAC,GAClE,CACZ,MAAMyH,EAAQ,CACZwL,OAAQ9C,EAAKjH,GACb8T,SAAU7M,EAAK5D,KACfiB,SAAU2C,EAAK3C,SACf2C,KAAMA,EACNxU,UAAWA,EACX+B,UAAW,EACXyW,WAAYhE,EAAK5C,aACjB8L,aAAc,GACd3L,aACEyC,EAAKzC,cACL,OAAOyC,EAAK5C,yBAAyB4C,EAAKnQ,QAAQ1G,QAAU,KAAKuF,OAAOsR,EAAKnQ,QAAQyN,WAAa,GAAGkP,SAAS,EAAG,qBACnHM,SAAU,SAEZE,EAAUtjB,KAAK4N,EACjB,CACF,CAGJ,CAGA,MAAM4V,EAAaD,EAAW5T,OAAOwG,GAA2C,UAAtC3D,EAAe2D,EAAExC,WAAWhB,OACtE,IAAK,IAAIhT,EAAI,EAAGA,EAAIgf,EAAM3P,QAAQnP,OAAQF,IAAK,CAC7C,MAAMoC,EAAM4c,EAAM3P,QAAQrP,GACpB8jB,EAAYnkB,KAAK2jB,YAAYlhB,EAAKC,EAASF,EAAWnC,EAAI,EAAG6jB,EAAY3C,GAC/EyC,EAAUtjB,QAAQyjB,EACpB,CACF,CAEA,OAAOH,CACT,EAGA,aAAAI,CAAc7C,EAAS/e,GACrB,IAAK+e,EAAS,MAAO,GAErB,MAAM3K,EAAQK,GAAsByD,gBAAgBlY,GACpD,GAAqB,IAAjBoU,EAAMrW,OAAc,MAAO,GAG/B,IAAI8jB,EAAc,KAClB,IAAK,MAAM5C,KAAWF,EACpB,GAAIA,EAAQE,IAAUrO,OAAS5Q,EAAW,CACxC6hB,EAAc9C,EAAQE,GACtB,KACF,CAGF,IAAK4C,IAAgBA,EAAY3U,SAAW2U,EAAY3U,QAAQnP,OAAS,EACvE,MAAO,GAGT,MAAMmC,EAAU2hB,EAAY3U,QAAQ,GAC9BsU,EAAY,GAElB,IAAK,IAAI3jB,EAAI,EAAGA,EAAIgkB,EAAY3U,QAAQnP,OAAQF,IAAK,CACnD,MAAMoC,EAAM4hB,EAAY3U,QAAQrP,GAC1B8jB,EAAYnkB,KAAK2jB,YAAYlhB,EAAKC,EAASF,EAAWnC,EAAI,EAAGuW,EAAO2K,GAC1EyC,EAAUtjB,QAAQyjB,EACpB,CAEA,OAAOH,CACT,EAGA,kBAAAM,CAAmBrF,GACjB,MAAMsF,EAAU,CAAC,EACjB,IAAK,MAAMjW,KAAS2Q,EACbsF,EAAQjW,EAAM9L,aACjB+hB,EAAQjW,EAAM9L,WAAa,IAE7B+hB,EAAQjW,EAAM9L,WAAW9B,KAAK4N,GAEhC,OAAOiW,CACT,EAGA,aAAAC,CAAcjD,GACZ,OAAOvhB,KAAK+jB,gBAAgBxC,GAAShhB,MACvC,GAMIkkB,GAAgB,CACpBC,QAAS,oBACTC,WAAY,UACZC,WAAY,EACZC,IAAK,KACLC,UAAW,IAAI1M,IAGf,UAAM2M,GACJ,OAAI/kB,KAAK6kB,IAAY7kB,KAAK6kB,IAEnB,IAAIG,QAAQ,CAACC,EAASC,KAC3B,MAAMC,EAAUC,UAAUC,KAAKrlB,KAAK0kB,QAAS1kB,KAAK4kB,YAElDO,EAAQ5S,QAAU,KAChB5Q,QAAQ2M,MAAM,+BAAgC6W,EAAQ7W,OACtD4W,EAAOC,EAAQ7W,QAGjB6W,EAAQG,UAAY,KAClBtlB,KAAK6kB,IAAMM,EAAQzI,OACnBuI,EAAQjlB,KAAK6kB,MAGfM,EAAQI,gBAAkB7S,IACxB,MAAM8S,EAAK9S,EAAMrM,OAAOqW,OACnB8I,EAAGC,iBAAiBC,SAAS1lB,KAAK2kB,aAErCa,EAAGG,kBAAkB3lB,KAAK2kB,WAAY,CAAEiB,QAAS,WAIzD,EAGA,UAAMC,CAAKzS,EAAM0S,GACf,IAAK1S,IAAS0S,EAAM,OAAO,EAE3B,IACE,MAAMN,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQ,CAACC,EAASC,KAC3B,MACMa,EADKP,EAAGQ,YAAYhmB,KAAK2kB,WAAY,aAC1BsB,YAAYjmB,KAAK2kB,YAG9B3kB,KAAK8kB,UAAUpP,IAAItC,KACrB8S,IAAIC,gBAAgBnmB,KAAK8kB,UAAU7Z,IAAImI,IACvCpT,KAAK8kB,UAAUsB,OAAOhT,IAGxB,MAAMvS,EAAO,CACXuS,KAAMA,EACN0S,KAAMA,EACNrG,KAAMqG,EAAKrG,KACXxQ,KAAM6W,EAAK7W,KACX4M,UAAW1Z,KAAKC,OAGZ+iB,EAAUY,EAAMM,IAAIxlB,GAC1BskB,EAAQG,UAAY,IAAML,GAAQ,GAClCE,EAAQ5S,QAAU,KAChB5Q,QAAQ2M,MAAM,4BAA6B6W,EAAQ7W,OACnD4W,EAAOC,EAAQ7W,SAGrB,CAAE,MAAOzM,GAEP,OADAF,QAAQ2M,MAAM,kCAAmCzM,IAC1C,CACT,CACF,EAGA,SAAMoJ,CAAImI,GACR,IAAKA,EAAM,OAAO,KAGlB,GAAIpT,KAAK8kB,UAAUpP,IAAItC,GACrB,OAAOpT,KAAK8kB,UAAU7Z,IAAImI,GAG5B,IACE,MAAMoS,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,YAC1BsB,YAAYjmB,KAAK2kB,YACZ1Z,IAAImI,GAE1B+R,EAAQG,UAAY,KAClB,MAAMzkB,EAAOskB,EAAQzI,OACrB,GAAI7b,GAAQA,EAAKilB,KAAM,CACrB,MAAMQ,EAAMJ,IAAIK,gBAAgB1lB,EAAKilB,MACrC9lB,KAAK8kB,UAAU1Z,IAAIgI,EAAMkT,GACzBrB,EAAQqB,EACV,MACErB,EAAQ,OAIZE,EAAQ5S,QAAU,IAAM0S,EAAQ,OAEpC,CAAE,MAAOpjB,GAEP,OADAF,QAAQ2M,MAAM,iCAAkCzM,GACzC,IACT,CACF,EAGA,SAAM6T,CAAItC,GACR,IAAKA,EAAM,OAAO,EAElB,IACE,MAAMoS,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,YAC1BsB,YAAYjmB,KAAK2kB,YACZ6B,OAAOpT,GAE7B+R,EAAQG,UAAY,IAAML,OAA2BxgB,IAAnB0gB,EAAQzI,QAC1CyI,EAAQ5S,QAAU,IAAM0S,GAAQ,IAEpC,CAAE,MAAOpjB,GACP,OAAO,CACT,CACF,EAGA,YAAM,CAAOuR,GACX,IAAKA,EAAM,OAAO,EAElB,IAEMpT,KAAK8kB,UAAUpP,IAAItC,KACrB8S,IAAIC,gBAAgBnmB,KAAK8kB,UAAU7Z,IAAImI,IACvCpT,KAAK8kB,UAAUsB,OAAOhT,IAGxB,MAAMoS,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,aAC1BsB,YAAYjmB,KAAK2kB,YACZyB,OAAOhT,GAE7B+R,EAAQG,UAAY,IAAML,GAAQ,GAClCE,EAAQ5S,QAAU,IAAM0S,GAAQ,IAEpC,CAAE,MAAOpjB,GAEP,OADAF,QAAQ2M,MAAM,oCAAqCzM,IAC5C,CACT,CACF,EAGA,iBAAM4kB,GACJ,IACE,MAAMjB,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,YAC1BsB,YAAYjmB,KAAK2kB,YACZ+B,aAEtBvB,EAAQG,UAAY,IAAML,EAAQE,EAAQzI,QAAU,IACpDyI,EAAQ5S,QAAU,IAAM0S,EAAQ,KAEpC,CAAE,MAAOpjB,GACP,MAAO,EACT,CACF,EAGA,cAAM8kB,GACJ,IACE,MAAMnB,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,YAC1BsB,YAAYjmB,KAAK2kB,YACZiC,SAEtBzB,EAAQG,UAAY,KAClB,MAAMuB,EAAQ1B,EAAQzI,QAAU,GAC1BoK,EAAYD,EAAME,OAAO,CAACC,EAAKvlB,IAASulB,GAAOvlB,EAAKge,MAAQ,GAAI,GACtEwF,EAAQ,CACNgC,MAAOJ,EAAMtmB,OACbumB,UAAWA,EACXI,aAAcJ,EAAY,KAAO,MAAMK,QAAQ,MAInDhC,EAAQ5S,QAAU,IAAM0S,EAAQ,CAAEgC,MAAO,EAAGH,UAAW,EAAGI,YAAa,OAE3E,CAAE,MAAOrlB,GACP,MAAO,CAAEolB,MAAO,EAAGH,UAAW,EAAGI,YAAa,IAChD,CACF,EAGA,cAAME,GACJ,IAEEpnB,KAAK8kB,UAAUtjB,QAAQ8kB,GAAOJ,IAAIC,gBAAgBG,IAClDtmB,KAAK8kB,UAAU3U,QAEf,MAAMqV,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,aAC1BsB,YAAYjmB,KAAK2kB,YACZxU,QAEtBgV,EAAQG,UAAY,IAAML,GAAQ,GAClCE,EAAQ5S,QAAU,IAAM0S,GAAQ,IAEpC,CAAE,MAAOpjB,GAEP,OADAF,QAAQ2M,MAAM,sCAAuCzM,IAC9C,CACT,CACF,GA8BIwlB,GAAc,CAClB3C,QAAS,gBACTC,WAAY,QACZC,WAAY,EACZC,IAAK,KAGL,UAAME,GACJ,OAAI/kB,KAAK6kB,IAAY7kB,KAAK6kB,IAEnB,IAAIG,QAAQ,CAACC,EAASC,KAC3B,MAAMC,EAAUC,UAAUC,KAAKrlB,KAAK0kB,QAAS1kB,KAAK4kB,YAElDO,EAAQ5S,QAAU,KAChB5Q,QAAQ2M,MAAM,6BAA8B6W,EAAQ7W,OACpD4W,EAAOC,EAAQ7W,QAGjB6W,EAAQG,UAAY,KAClBtlB,KAAK6kB,IAAMM,EAAQzI,OACnBuI,EAAQjlB,KAAK6kB,MAGfM,EAAQI,gBAAkB7S,IACxB,MAAM8S,EAAM9S,EAAMrM,OAA4BqW,OACzC8I,EAAGC,iBAAiBC,SAAS1lB,KAAK2kB,aAErCa,EAAGG,kBAAkB3lB,KAAK2kB,WAAY,CAAEiB,QAAS,SAIzD,EAGA,SAAMpN,CAAI/W,GACR,IAAKA,IAASA,EAAKsO,GAAI,OAAO,EAE9B,IACE,MAAMyV,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQ,CAACC,EAASC,KAC3B,MAGMC,EAHKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,aAC1BsB,YAAYjmB,KAAK2kB,YAEZnM,IAAI/W,GAC1B0jB,EAAQG,UAAY,IAAML,GAAQ,GAClCE,EAAQ5S,QAAU,KAChB5Q,QAAQ2M,MAAM,4BAA6B6W,EAAQ7W,OACnD4W,EAAOC,EAAQ7W,SAGrB,CAAE,MAAOzM,GAEP,OADAF,QAAQ2M,MAAM,+BAAgCzM,IACvC,CACT,CACF,EAGA,SAAMoJ,CAAI8E,GACR,IAAKA,EAAI,OAAO,KAEhB,IACE,MAAMyV,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,YAC1BsB,YAAYjmB,KAAK2kB,YACZ1Z,IAAI8E,GAE1BoV,EAAQG,UAAY,KAClBL,EAAQE,EAAQzI,QAAU,OAG5ByI,EAAQ5S,QAAU,IAAM0S,EAAQ,OAEpC,CAAE,MAAOpjB,GAEP,OADAF,QAAQ2M,MAAM,+BAAgCzM,GACvC,IACT,CACF,EAGA,YAAMylB,CAAOvX,EAAYyK,GACvB,IAAKzK,EAAI,OAAO,EAEhB,IACE,MAAMwX,QAAiBvnB,KAAKiL,IAAI8E,GAChC,IAAKwX,EAAU,OAAO,EAEtB,MAAMC,EAAU,IACXD,KACA/M,EACHzK,GAAIwX,EAASxX,GACb8L,UAAW1Z,KAAKC,OAGZojB,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQ,CAACC,EAASC,KAC3B,MAGMC,EAHKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,aAC1BsB,YAAYjmB,KAAK2kB,YAEZ0B,IAAImB,GAC1BrC,EAAQG,UAAY,IAAML,GAAQ,GAClCE,EAAQ5S,QAAU,KAChB5Q,QAAQ2M,MAAM,+BAAgC6W,EAAQ7W,OACtD4W,EAAOC,EAAQ7W,SAGrB,CAAE,MAAOzM,GAEP,OADAF,QAAQ2M,MAAM,kCAAmCzM,IAC1C,CACT,CACF,EAGA,YAAM,CAAOkO,GACX,IAAKA,EAAI,OAAO,EAEhB,IACE,MAAMyV,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,aAC1BsB,YAAYjmB,KAAK2kB,YACZyB,OAAOrW,GAE7BoV,EAAQG,UAAY,IAAML,GAAQ,GAClCE,EAAQ5S,QAAU,IAAM0S,GAAQ,IAEpC,CAAE,MAAOpjB,GAEP,OADAF,QAAQ2M,MAAM,kCAAmCzM,IAC1C,CACT,CACF,EAGA,YAAM+kB,GACJ,IACE,MAAMpB,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,YAC1BsB,YAAYjmB,KAAK2kB,YACZiC,SAEtBzB,EAAQG,UAAY,IAAML,EAAQE,EAAQzI,QAAU,IACpDyI,EAAQ5S,QAAU,IAAM0S,EAAQ,KAEpC,CAAE,MAAOpjB,GAEP,OADAF,QAAQ2M,MAAM,kCAAmCzM,GAC1C,EACT,CACF,EAGA,gBAAM4lB,GACJ,IACE,MAAMZ,QAAc7mB,KAAK4mB,SACnBc,EAAS,IAAInS,IACnB,IAAK,MAAM9T,KAAQolB,EACjB,GAAIplB,EAAKkmB,MAAQ5iB,MAAMuQ,QAAQ7T,EAAKkmB,MAClC,IAAK,MAAMC,KAAOnmB,EAAKkmB,KACjBC,GAAKF,EAAOlP,IAAIoP,GAI1B,OAAO7iB,MAAM8iB,KAAKH,GAAQvmB,MAC5B,CAAE,MAAOU,GAEP,OADAF,QAAQ2M,MAAM,sCAAuCzM,GAC9C,EACT,CACF,EAGA,cAAMimB,CAASF,GACb,IAAKA,EAAK,MAAO,GAEjB,IAEE,aADoB5nB,KAAK4mB,UACZvW,OAAO5O,GAAQA,EAAKkmB,MAAQlmB,EAAKkmB,KAAKzgB,SAAS0gB,GAC9D,CAAE,MAAO/lB,GAEP,OADAF,QAAQ2M,MAAM,oCAAqCzM,GAC5C,EACT,CACF,EAGA,WAAMsO,GACJ,IACE,MAAMqV,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,aAC1BsB,YAAYjmB,KAAK2kB,YACZxU,QAEtBgV,EAAQG,UAAY,IAAML,GAAQ,GAClCE,EAAQ5S,QAAU,IAAM0S,GAAQ,IAEpC,CAAE,MAAOpjB,GAEP,OADAF,QAAQ2M,MAAM,iCAAkCzM,IACzC,CACT,CACF,EAGA,WAAMolB,GACJ,IACE,MAAMzB,QAAWxlB,KAAK+kB,OACtB,OAAO,IAAIC,QAAQC,IACjB,MAEME,EAFKK,EAAGQ,YAAYhmB,KAAK2kB,WAAY,YAC1BsB,YAAYjmB,KAAK2kB,YACZsC,QAEtB9B,EAAQG,UAAY,IAAML,EAAQE,EAAQzI,QAAU,GACpDyI,EAAQ5S,QAAU,IAAM0S,EAAQ,IAEpC,CAAE,MAAOpjB,GAEP,OADAF,QAAQ2M,MAAM,iCAAkCzM,GACzC,CACT,CACF,GAgBIkmB,GAAmB,CAEvB,iBAAMC,CACJC,EACAzlB,EACA0lB,EACA3kB,EACAokB,EAAiB,IAEjB,IACE,MAAMQ,EAASC,YAAYC,oBAAsB,GAC3C5mB,EAAqB,CACzBsO,GAAIuY,OAAOC,aACXL,OAAQA,EACR3kB,QAASA,EACTokB,KAAMA,EACNjQ,UAAWvV,KAAKC,MAChByZ,UAAW1Z,KAAKC,MAChBomB,WAAY,CACVP,WACAzlB,YACA2lB,WAKJ,aADsBd,GAAY7O,IAAI/W,IAEpCE,QAAQC,IAAI,+BAAgCH,EAAKsO,IAC1CtO,GAEF,IACT,CAAE,MAAOI,GAEP,OADAF,QAAQ2M,MAAM,4CAA6CzM,GACpD,IACT,CACF,EAGA,oBAAM4mB,CAAe1Y,EAAYyK,GAC/B,IACE,MAAMwD,QAAgBqJ,GAAYC,OAAOvX,EAAIyK,GAI7C,OAHIwD,GACFrc,QAAQC,IAAI,+BAAgCmO,GAEvCiO,CACT,CAAE,MAAOnc,GAEP,OADAF,QAAQ2M,MAAM,+CAAgDzM,IACvD,CACT,CACF,EAGA,uBAAM6mB,CAAkB3Y,GACtB,IACE,MAAM4Y,QAAiBtB,GAAYpc,IAAI8E,GACvC,IAAK4Y,EAAU,OAAO,KAEtB,MAAMC,EAAqB,IACtBD,EACH5Y,GAAIuY,OAAOC,aACX7Q,UAAWvV,KAAKC,MAChByZ,UAAW1Z,KAAKC,OAIlB,aADsBilB,GAAY7O,IAAIoQ,IAEpCjnB,QAAQC,IAAI,+BAAgCmO,EAAI,KAAM6Y,EAAK7Y,IACpD6Y,GAEF,IACT,CAAE,MAAO/mB,GAEP,OADAF,QAAQ2M,MAAM,kDAAmDzM,GAC1D,IACT,CACF,EAGA,oBAAMgnB,CAAe9Y,GACnB,IACE,MAAMiO,QAAgBqJ,GAAYjB,OAAOrW,GAIzC,OAHIiO,GACFrc,QAAQC,IAAI,+BAAgCmO,GAEvCiO,CACT,CAAE,MAAOnc,GAEP,OADAF,QAAQ2M,MAAM,+CAAgDzM,IACvD,CACT,CACF,EAGA,YAAMinB,CAAO/Y,EAAY6X,GACvB,IACE,MAAMnmB,QAAa4lB,GAAYpc,IAAI8E,GACnC,QAAKtO,MAEAA,EAAKkmB,KAAKzgB,SAAS0gB,KACtBnmB,EAAKkmB,KAAKjnB,KAAKknB,SACFP,GAAYC,OAAOvX,EAAI,CAAE4X,KAAMlmB,EAAKkmB,QAGrD,CAAE,MAAO9lB,GAEP,OADAF,QAAQ2M,MAAM,uCAAwCzM,IAC/C,CACT,CACF,EAGA,eAAMknB,CAAUhZ,EAAY6X,GAC1B,IACE,MAAMnmB,QAAa4lB,GAAYpc,IAAI8E,GACnC,IAAKtO,EAAM,OAAO,EAElB,MAAM2Y,EAAQ3Y,EAAKkmB,KAAK7kB,QAAQ8kB,GAChC,QAAIxN,GAAS,KACX3Y,EAAKkmB,KAAKrN,OAAOF,EAAO,SACXiN,GAAYC,OAAOvX,EAAI,CAAE4X,KAAMlmB,EAAKkmB,OAGrD,CAAE,MAAO9lB,GAEP,OADAF,QAAQ2M,MAAM,0CAA2CzM,IAClD,CACT,CACF,EAGAmnB,WAAgB,eACD3B,GAAYI,aAI3BuB,OAAY,eACG3B,GAAYT,SAI3BoC,SAAc,MAACpB,SACAP,GAAYS,SAASF,GAIpCoB,QAAa,MAACjZ,SACCsX,GAAYpc,IAAI8E,GAI/B,oBAAAkZ,CAAqBC,EAAwBC,GAC3C,MAAM5I,EAAgC,GAEtC,IAAK,MAAM6I,KAAOD,EAAe,CAC/B,MAAME,EAAQF,EAAcC,GAC5B,IAAKC,IAAUA,EAAM3Z,UAAY2Z,EAAM3Z,QAAQ,GAAI,SAGnD,MAAM4Z,EAAwBD,EAAM3Z,QAAQ,GAAGnO,MAAM,GAAGX,IAAK6C,GAAWiC,OAAOjC,GAAK,KAG9E8lB,EACJL,EAAShB,OAAO3nB,SAAW+oB,EAAY/oB,QAAU2oB,EAAShB,OAAOsB,MAAM,CAAC/lB,EAAGpD,IAAMoD,IAAM6lB,EAAYjpB,IAG/FopB,EAAcP,EAAShB,OAAO7X,OAAO5M,GAAK6lB,EAAYpiB,SAASzD,IAC/DimB,EAAgBR,EAAShB,OAAO7X,OAAO5M,IAAM6lB,EAAYpiB,SAASzD,IAClEkmB,EAAaT,EAAShB,OAAO3nB,OAAS,EAAIkpB,EAAYlpB,OAAS2oB,EAAShB,OAAO3nB,OAAS,EAE1FgpB,EACFhJ,EAAQ7f,KAAK,CACXunB,SAAUmB,EACV5mB,UAAW6mB,EAAMjW,MAAQgW,EACzBnhB,KAAM,SACNwhB,cACAC,gBACAC,WAAY,IAELA,EAAa,GACtBpJ,EAAQ7f,KAAK,CACXunB,SAAUmB,EACV5mB,UAAW6mB,EAAMjW,MAAQgW,EACzBnhB,KAAM,QACNwhB,cACAC,gBACAC,cAGN,CAGA,OAAOpJ,EAAQpf,KAAK,CAACC,EAAGC,IACP,WAAXD,EAAE6G,MAAgC,WAAX5G,EAAE4G,MAA2B,EACzC,WAAX7G,EAAE6G,MAAgC,WAAX5G,EAAE4G,KAA0B,EAChD5G,EAAEsoB,WAAavoB,EAAEuoB,WAE5B,EAGA,aAAAC,CAAcV,EAAwBW,GACpC,MAAMnlB,EAAqC,CAAC,MAC5C,IAAK,MAAMid,KAAOkI,EAAc,CAC9B,MAAMC,EAAWZ,EAAShB,OAAOplB,QAAQ6e,GACzCjd,EAAOhE,KAAKopB,GAAY,EAAIZ,EAAS3lB,QAAQumB,GAAY,GAC3D,CACA,OAAOplB,CACT,EAGA,qBAAMqlB,GACJ,IACE,MAAMlD,QAAcQ,GAAYT,SAC1BvK,EAAa,CACjB5F,QAAS,EACTuT,WAAY7nB,KAAKC,MACjBykB,MAAOA,GAET,OAAO/lB,KAAKwB,UAAU+Z,EAAY,KAAM,EAC1C,CAAE,MAAOxa,GAEP,OADAF,QAAQ2M,MAAM,gDAAiDzM,GACxD,EACT,CACF,EAGA,qBAAMooB,CAAgBC,GACpB,IACE,MAAMrpB,EAAOC,KAAKC,MAAMmpB,GACxB,IAAKrpB,IAASA,EAAKgmB,QAAU9hB,MAAMuQ,QAAQzU,EAAKgmB,OAE9C,OADAllB,QAAQ2M,MAAM,iCACP,KAGT,IAAI6b,EAAQ,EACR3C,EAAU,EAEd,IAAK,MAAM/lB,KAAQZ,EAAKgmB,MAAO,CAC7B,IAAKplB,EAAKsO,KAAOtO,EAAKymB,SAAWzmB,EAAK8B,QAAS,SAG/C,SADuB8jB,GAAYpc,IAAIxJ,EAAKsO,UAGpCsX,GAAYC,OAAO7lB,EAAKsO,GAAI,CAChCmY,OAAQzmB,EAAKymB,OACb3kB,QAAS9B,EAAK8B,QACdokB,KAAMlmB,EAAKkmB,MAAQ,GACnB9L,UAAW1Z,KAAKC,MAChBomB,WAAY/mB,EAAK+mB,aAEnBhB,QACK,CAEL,MAAM4C,EAAwB,CAC5Bra,GAAItO,EAAKsO,GACTmY,OAAQzmB,EAAKymB,OACb3kB,QAAS9B,EAAK8B,QACdokB,KAAMlmB,EAAKkmB,MAAQ,GACnBjQ,UAAWjW,EAAKiW,WAAavV,KAAKC,MAClCyZ,UAAW1Z,KAAKC,MAChBomB,WAAY/mB,EAAK+mB,kBAEbnB,GAAY7O,IAAI4R,GACtBD,GACF,CACF,CAGA,OADAxoB,QAAQC,IAAI,+BAAgCuoB,EAAO,MAAO3C,EAAS,MAC5D,CAAE2C,QAAO3C,UAClB,CAAE,MAAO3lB,GAEP,OADAF,QAAQ2M,MAAM,gDAAiDzM,GACxD,IACT,CACF,GAoCIwoB,GAAgB,KACpB,MAAM9I,EAAU+I,KAA0C,mBAAjBC,GAA8BA,KAAiB,MACxF,GAAIhJ,EACF,IAAK,MAAM/gB,KAAO+gB,EAAS,CACzB,MAAMlC,EAAQkC,EAAQ/gB,GACtB,GAAI6e,GAAOjM,MAAMlM,SAAS,OAASmY,EAAM3P,UAAU,KAAK,GACtD,OAAO2P,EAAM3P,QAAQ,GAAG,EAE5B,CAEF,OAAO,MAIH8a,GAAiB,KACrB,IAEE,MAAMC,EAAIzkB,OAAO0kB,QAAU1kB,OAC3B,GAAIykB,EAAErC,aAAauC,WAAY,CAC7B,MAAMC,EAAMH,EAAErC,YAAYuC,aAC1B,GAAIC,GAAKC,MAAO,OAAOD,EAAIC,KAC7B,CAEA,GAAqB,oBAAVA,OAAyBA,MAAO,OAAOA,MAClD,GAAIJ,EAAEI,MAAO,OAAOJ,EAAEI,MAEtB,MAAMzkB,EAAIqkB,EAAEK,QAAU9kB,OAAO8kB,OAC7B,GAAI1kB,EAAG,CACL,MAAM2kB,EAAW3kB,EAAE,wDAAwD4kB,QAC3E,GAAID,EAASxqB,OAAQ,CACnB,MAAM6S,EAAO2X,EAAS7iB,SAAW6iB,EAASE,SAC1C,GAAI7X,GAAQA,EAAK1K,OAAQ,OAAO0K,EAAK1K,MACvC,CACF,CACF,CAAE,MAAO7G,GACPF,QAAQG,KAAK,kCAAmCD,EAClD,CACA,OAAO,MAIHqpB,GAAuB,IACpBV,MAAoBH,MAAmB,KAI1Cc,GAA0BF,IAC9B,IAAKA,GAAwB,iBAATA,EAAmB,OAAOA,EAC9C,MAAMG,EAAcF,KAEpB,IAAIxO,EAASuO,EAAKtlB,QAAQ,WAAYylB,GAEtC,OADA1O,EAASA,EAAO/W,QAAQ,iBAAkBylB,GACnC1O,GAGH2O,GAAgB,CACpBzrB,OAAQ,KAER,IAAA0rB,GACE,IAAKtrB,KAAKJ,OAAQ,CAChB,MAAM2rB,EAAMnW,GAAMnK,IAAI8C,EAAwB,CAAC,GAC/C/N,KAAKJ,OAAS,CAAC,EACf,IAAK,MAAMwT,KAAQmY,EACQ,iBAAdA,EAAInY,GACbpT,KAAKJ,OAAOwT,GAAQ,CAAEkT,IAAKiF,EAAInY,GAAOoY,QAAS,GAAIC,QAAS,GAAIC,MAAO,IAAKC,QAAS,IAErF3rB,KAAKJ,OAAOwT,GAAQ,CAClBkT,IAAKiF,EAAInY,GAAMkT,KAAO,GACtBkF,QAASD,EAAInY,GAAMoY,SAAW,GAC9BC,QAASF,EAAInY,GAAMqY,SAAW,GAC9BC,MAAOH,EAAInY,GAAMsY,OAAS,IAC1BC,QAASJ,EAAInY,GAAMuY,SAAW,GAItC,CACA,OAAO3rB,KAAKJ,MACd,EAEA,IAAAimB,GACEzQ,GAAMhK,IAAI2C,EAAwB/N,KAAKJ,QAAU,CAAC,GAClDI,KAAKJ,OAAS,IAChB,EAGA,GAAAqL,CAAImI,GACF,MAAMvS,EAAOb,KAAKsrB,OAAOlY,GACzB,GAAIvS,GAAQA,EAAKylB,IAAK,OAAOzlB,EAAKylB,IAElC,IAAK,MAAM9lB,KAAOR,KAAKJ,OACrB,GAAII,KAAKJ,OAAOY,GAAKmrB,SAAW3rB,KAAKJ,OAAOY,GAAKmrB,QAAQzkB,SAASkM,IAC5DpT,KAAKJ,OAAOY,GAAK8lB,IAAK,OAAOtmB,KAAKJ,OAAOY,GAAK8lB,IAItD,OAAO,IACT,EAGA,cAAMsF,CAASxY,GACb,IAAKA,EAAM,OAAO,KAGlB,MAAMyY,EAAaxB,KACbyB,EAAoB,WAAT1Y,GAA8B,OAATA,GAAkByY,GAAczY,IAASyY,EAGzEE,QAAiBtH,GAAcxZ,IAAImI,GACzC,GAAI2Y,EAAU,OAAOA,EAGrB,GAAID,GAAqB,WAAT1Y,EAAmB,CACjC,MAAM4Y,QAAqBvH,GAAcxZ,IAAI,UAC7C,GAAI+gB,EAAc,OAAOA,CAC3B,CAGA,MAAMC,EAAcjsB,KAAKksB,eAAe9Y,GACxC,GAAI6Y,IAAgB7Y,EAAM,CACxB,MAAM+Y,QAAsB1H,GAAcxZ,IAAIghB,GAC9C,GAAIE,EAAe,OAAOA,CAC5B,CAGA,OAAOnsB,KAAKiL,IAAImI,EAClB,EAGA,oBAAMgZ,CAAehZ,GACnB,IAAKA,EAAM,OAAO,EAElB,SADkBqR,GAAc/O,IAAItC,GAC3B,OAAO,EAEhB,MAAM6Y,EAAcjsB,KAAKksB,eAAe9Y,GACxC,OAAI6Y,IAAgB7Y,SACLqR,GAAc/O,IAAIuW,EAGnC,EAGAjD,gBAAqB,MAAC5V,EAAM0S,UACbrB,GAAcoB,KAAKzS,EAAM0S,GAIxCkD,kBAAuB,MAAC5V,SACTqR,GAAc2B,OAAOhT,GAGpC,UAAAiZ,CAAWjZ,GACT,MAAMvS,EAAOb,KAAKssB,gBAAgBlZ,GAClC,OAAOvS,EAAQA,EAAK2qB,SAAW,GAAM,EACvC,EAEA,UAAAe,CAAWnZ,GACT,MAAMvS,EAAOb,KAAKssB,gBAAgBlZ,GAClC,OAAOvS,EAAQA,EAAK4qB,SAAW,GAAM,EACvC,EAEA,QAAAe,CAASpZ,GACP,MAAMvS,EAAOb,KAAKssB,gBAAgBlZ,GAClC,OAAOvS,EAAQA,EAAK6qB,OAAS,IAAO,GACtC,EAGA,eAAAY,CAAgBlZ,GACd,MAAMvS,EAAOb,KAAKsrB,OAAOlY,GACzB,GAAIvS,EAAM,OAAOA,EACjB,IAAK,MAAML,KAAOR,KAAKJ,OACrB,GAAII,KAAKJ,OAAOY,GAAKmrB,SAAW3rB,KAAKJ,OAAOY,GAAKmrB,QAAQzkB,SAASkM,GAChE,OAAOpT,KAAKJ,OAAOY,GAGvB,OAAO,IACT,EAGA,cAAA0rB,CAAe9Y,GACb,GAAIpT,KAAKsrB,OAAOlY,GAAO,OAAOA,EAC9B,IAAK,MAAM5S,KAAOR,KAAKJ,OACrB,GAAII,KAAKJ,OAAOY,GAAKmrB,SAAW3rB,KAAKJ,OAAOY,GAAKmrB,QAAQzkB,SAASkM,GAChE,OAAO5S,EAGX,OAAO4S,CACT,EAEA,GAAAhI,CAAIgI,EAAMkT,EAAKkF,EAAU,GAAIC,EAAU,GAAIC,EAAQ,IAAKC,EAAU,IAChE3rB,KAAKsrB,OAAOlY,GAAQ,CAAEkT,MAAKkF,UAASC,UAASC,QAAOC,WACpD3rB,KAAK6lB,MACP,EAEA,WAAA4G,CAAYrZ,EAAMoY,EAASC,GACzB,MAAM5qB,EAAOb,KAAKsrB,OAAOlY,GACrBvS,IACFA,EAAK2qB,QAAUA,EACf3qB,EAAK4qB,QAAUA,EACfzrB,KAAK6lB,OAET,EAEA,QAAA6G,CAAStZ,EAAMsY,GACb,MAAM7qB,EAAOb,KAAKsrB,OAAOlY,GACrBvS,IACFA,EAAK6qB,MAAQA,EACb1rB,KAAK6lB,OAET,EAEA,UAAA8G,CAAWvZ,EAAMuY,GACf,MAAM9qB,EAAOb,KAAKsrB,OAAOlY,GACrBvS,IACFA,EAAK8qB,QAAUA,EACf3rB,KAAK6lB,OAET,EAEA,MAAAlf,CAAOyM,UACEpT,KAAKsrB,OAAOlY,GACnBpT,KAAK6lB,MACP,EAEA,MAAAe,GACE,OAAO5mB,KAAKsrB,MACd,EAGA,UAAAjP,GACE,MAAO,CACL5F,QAAS,EACTmW,YAAY,IAAIzqB,MAAOwV,cACvBkV,QAAS7sB,KAAKsrB,OAElB,EAGA,UAAAwB,CAAWC,EAAUC,GAAqB,GACxC,IAAKD,IAAaA,EAASF,QACzB,MAAM,IAAIhd,MAAM,aAGlB,MAAMod,EAAUjtB,KAAKsrB,OACf4B,EAAQ,CAAE/C,MAAO,EAAG3C,QAAS,EAAG2F,QAAS,GAE/C,IAAK,MAAM/Z,KAAQ2Z,EAASF,QAAS,CACnC,MAAMO,EAAWL,EAASF,QAAQzZ,GAC7Bga,EAAS9G,MAEV2G,EAAQ7Z,GAEN4Z,GACFC,EAAQ7Z,GAAQ,CACdkT,IAAK8G,EAAS9G,IACdkF,QAAS4B,EAAS5B,SAAW,GAC7BC,QAAS2B,EAAS3B,SAAW,GAC7BC,MAAO0B,EAAS1B,OAAS,IACzBC,QAASyB,EAASzB,SAAW,IAE/BuB,EAAM1F,WAEN0F,EAAMC,WAIRF,EAAQ7Z,GAAQ,CACdkT,IAAK8G,EAAS9G,IACdkF,QAAS4B,EAAS5B,SAAW,GAC7BC,QAAS2B,EAAS3B,SAAW,GAC7BC,MAAO0B,EAAS1B,OAAS,IACzBC,QAASyB,EAASzB,SAAW,IAE/BuB,EAAM/C,SAEV,CAGA,OADAnqB,KAAK6lB,OACEqH,CACT,EAGA,aAAAG,CAAcN,GACZ,IAAKA,IAAaA,EAASF,QACzB,MAAO,CAAES,OAAO,EAAOhf,MAAO,aAGhC,MAAM2e,EAAUjtB,KAAKsrB,OACf5O,EAAS,CAAE4Q,OAAO,EAAMC,MAAO,EAAGC,SAAU,GAAIC,UAAW,IAEjE,IAAK,MAAMra,KAAQ2Z,EAASF,QACrBE,EAASF,QAAQzZ,GAAMkT,MAC5B5J,EAAO6Q,QACHN,EAAQ7Z,GACVsJ,EAAO+Q,UAAU/sB,KAAK0S,GAEtBsJ,EAAO8Q,SAAS9sB,KAAK0S,IAIzB,OAAOsJ,CACT,GAYIgR,GAAsBta,IAC1B,IAAKA,EAAM,MAAO,GAClB,MAAMua,EAAuB,GAC7B,IAAK,MAAOvc,EAASwc,KAAUvuB,EACzB+R,EAAQxH,KAAKwJ,IACfua,EAAWjtB,KAAKktB,GAGpB,OAAOD,GAoCHE,GAAkB,CAACza,EAAMnE,KAC7B,IAAKmE,IAASnE,EAAM,OAAO,KAC3B,IAAK,MAAOmC,EAASwc,KAAUtuB,EAC7B,GAAI8T,GAAQhC,EAAQxH,KAAKwJ,GAAO,OAAOwa,EAEzC,IAAK,MAAOxc,EAASwc,KAAUtuB,EAC7B,GAAI2P,GAAQmC,EAAQxH,KAAKqF,GAAO,OAAO2e,EAEzC,OAAO,MAOHE,GAAY,WAqEhB,MAAMC,EAAY,UAClB,IAAIC,EAAgB,KAGpB,SAASC,IAEP,GAAID,GAAiBA,EAAcE,QACjC,OAAOF,EAAcE,QAIvB,MAAMC,EAAYnoB,OAAOmoB,WAAanoB,OAAO0kB,QAAQyD,UAC/CC,EAAUpoB,OAAOooB,SAAWpoB,OAAO0kB,QAAQ0D,QAEjD,MAAyB,mBAAdD,GAA+C,mBAAZC,GAC5CzsB,QAAQC,IAAI,gCACL,YAIiB,IAAfoE,OAAOqoB,KAAwD,mBAA1BroB,OAAOqoB,IAAIC,YACzD3sB,QAAQC,IAAI,gCACL,QAITD,QAAQC,IAAI,sCACL,MACT,CAyDAonB,eAAeuF,IACb,OAAO,IAAIvJ,QAAQC,IACjB,MAAMuJ,EAAYC,WAAW,KAC3B9sB,QAAQG,KAAK,2BACbmjB,EAAQ,OACP,KAGGkJ,EAAYnoB,OAAOmoB,WAAanoB,OAAO0kB,QAAQyD,UAC/CC,EAAUpoB,OAAOooB,SAAWpoB,OAAO0kB,QAAQ0D,QAC3CM,EAAW1oB,OAAO0oB,UAAY1oB,OAAO0kB,QAAQgE,SAE7CC,EAAWC,IAGf,GAFAC,aAAaL,GAEW,mBAAbE,EACT,IACEA,EAAS,kBAAmBC,EAC9B,CAAE,MAAO9sB,GACPF,QAAQG,KAAK,4BAA6BD,EAC5C,CAMF,GAHAF,QAAQC,IAAI,6BAA8Bd,KAAKwB,UAAUssB,EAAQ,KAAM,IACvEjtB,QAAQC,IAAI,iCAAkCd,KAAKwB,UAAUssB,EAAOlS,OAAQ,KAAM,IAE9EkS,EAAOlS,QAAUkS,EAAOlS,OAAOpO,MAGjC,OAFA3M,QAAQ2M,MAAM,2BAA4BsgB,EAAOlS,OAAOpO,YACxD2W,EAAQ,MAIV,MAAM6J,EAAWF,EAAOlS,QAAQqS,iBAAmB,KACnDptB,QAAQC,IAAI,iCAAkCd,KAAKwB,UAAUwsB,EAAU,KAAM,IAE7E,MAAMpS,EAAS,CACbsS,UAAWF,EACXG,WAAY,CAAC,EACbC,OAAQ,KACRhB,QAAS,OAIXF,EAAgBtR,EAEhBuI,EAAQvI,IAGV,IAQE,GAPA/a,QAAQC,IAAI,gCACZD,QAAQC,IAAI,8BAA+B,CACzCusB,UAAgC,mBAAdA,EAClBC,QAA4B,mBAAZA,EAChBM,SAA8B,mBAAbA,IAGI,mBAAZN,EAIT,OAHAzsB,QAAQ2M,MAAM,+BACdugB,aAAaL,QACbvJ,EAAQ,MAGV,GAAyB,mBAAdkJ,EAIT,OAHAxsB,QAAQ2M,MAAM,iCACdugB,aAAaL,QACbvJ,EAAQ,MAIVmJ,EAAQ,kBAAmBO,GAC3BR,EAAU,qBACZ,CAAE,MAAOtsB,GACPgtB,aAAaL,GACb7sB,QAAQ2M,MAAM,+BAAgCzM,GAC9CojB,EAAQ,KACV,GAEJ,CAyiBA,SAASzf,EAAWC,GAClB,OAAOC,OAAOD,GAAK,IAChBE,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,SACnB,CAEA,SAASwpB,IAGP,GAAa,QAFAlB,IAEO,CAElB,MAAME,EAAYnoB,OAAOmoB,WAAanoB,OAAO0kB,QAAQyD,UAC/CC,EAAUpoB,OAAOooB,SAAWpoB,OAAO0kB,QAAQ0D,QAGjD,MAF2C,mBAAdD,GACU,mBAAZC,CAE7B,CAGE,YAD2C,IAAfpoB,OAAOqoB,KAAwD,mBAA1BroB,OAAOqoB,IAAIC,UAGhF,CAEA,SAASc,IAIP,GAHAztB,QAAQG,KAAK,qEAGTksB,EACF,OAAOA,EAIT,IACE,QAA0B,IAAfhoB,OAAOqoB,KAAwD,mBAA1BroB,OAAOqoB,IAAIC,WAA2B,CACpF,MAAMe,EAAUrpB,OAAOqoB,IAAIC,WAAW,CAAErf,KAAM,UAAWqgB,WAAY,WAErE,GAAID,GAAWA,EAAQL,UAAW,CAChC,MAAMnuB,EAAO,CACXmuB,UAAWK,EAAQL,WAAa,KAChCO,aAAcF,EAAQE,cAAgB,CAAC,EACvCN,WAAYI,EAAQJ,YAAc,CAAC,EACnCC,OAAQG,EAAQH,QAAU,KAC1BhB,QAAS,OAIX,OADAF,EAAgBntB,EACTA,CACT,CACF,CACF,CAAE,MAAOgB,GACPF,QAAQG,KAAK,uBAAwBD,EACvC,CAEA,OAAO,IACT,CAGAmnB,eAAewG,EAAoBC,EAAa,EAAGC,EAAa,KAC9D,IAEE,QAA0B,IAAf1pB,OAAOqoB,KAAwD,mBAA1BroB,OAAOqoB,IAAIC,WAEzD,UACQtJ,QAAQ2K,KAAK,CACjBC,sBAAsB,OACtB,IAAI5K,QAAQ,CAAC6K,EAAG3K,IAAWuJ,WAAW,IAAMvJ,EAAO,IAAIrV,MAAM,iBAAkB,OAEnF,CAAE,MAAOhO,GACPF,QAAQG,KAAK,6BAA8BD,EAAE2Q,QAE/C,CAGF,IAAK,IAAIsd,EAAU,EAAGA,GAAWL,EAAYK,IAAW,CACtD,IACE,QAA0B,IAAf9pB,OAAOqoB,KAAwD,mBAA1BroB,OAAOqoB,IAAIC,WACzD,MAAM,IAAIze,MAAM,eAGlB,MAAMwf,EAAUrpB,OAAOqoB,IAAIC,WAAW,CAAErf,KAAM,UAAWqgB,WAAY,WAErE,GAAID,GAAWA,EAAQL,UAAW,CAChC,MAAMnuB,EAAO,CACXmuB,UAAWK,EAAQL,WAAa,KAChCO,aAAcF,EAAQE,cAAgB,CAAC,EACvCN,WAAYI,EAAQJ,YAAc,CAAC,EACnCC,OAAQG,EAAQH,QAAU,KAC1BhB,QAAS,OAMX,OAFAF,EAAgBntB,EAChBc,QAAQC,IAAI,oBACLf,CACT,CACF,CAAE,MAAOgB,GACPF,QAAQG,KAAK,wBAAwBguB,KAAWL,MAAgB5tB,EAClE,CAEIiuB,EAAUL,SACN,IAAIzK,QAAQC,GAAWwJ,WAAWxJ,EAASyK,GAErD,CAEA,OAAO,IACT,CAAE,MAAO7tB,GAEP,OADAF,QAAQ2M,MAAM,mBAAoBzM,GAC3B,IACT,CACF,CAiDA,SAASkuB,EAAM7sB,GACb,OACE6B,MAAMuQ,QAAQpS,IACG,IAAjBA,EAAM3C,QACc,iBAAb2C,EAAM,KACQ,iBAAbA,EAAM,IAAuC,iBAAbA,EAAM,IAAuC,kBAAbA,EAAM,GAElF,CAGA,SAAS8sB,EAAc9sB,GACrB,QAAK6B,MAAMuQ,QAAQpS,IACZA,EAAMsmB,MACX/nB,GAAwB,iBAATA,GAAqC,iBAATA,GAAqC,kBAATA,GAA+B,OAATA,EAEjG,CA8BA,SAASwuB,EAAc/sB,GACrB,OAAI6B,MAAMuQ,QAAQpS,GACZ6sB,EAAM7sB,GAAe,EAClBA,EAAM3C,OAEX2C,GAA0B,iBAAVA,EACXU,OAAOC,KAAKX,GAAOmN,OAAO6f,IAAMA,EAAEzvB,WAAW,MAAMF,OAErD,CACT,CAMA,SAAS4vB,EAA2BjtB,EAAOoS,GAAU,GAEnD,GAAIpS,QACF,MAAO,GAIT,GAAIoS,GAAWvQ,MAAMuQ,QAAQpS,GAC3B,OAAI6sB,EAAM7sB,GACDwC,OAAOxC,EAAM,IACX8sB,EAAc9sB,GAChBA,EAAMtC,IAAIwM,GAAK1H,OAAO0H,GAAK,KAAK/C,KAAK,MAGrC3E,OAAOxC,GAKlB,MAAMktB,EAAM1qB,OAAOxC,GAAOwF,OAG1B,GAAI,oBAAoBkB,KAAKwmB,GAC3B,OAAOA,EAKT,MAAMC,EAAaD,EAAIrmB,MAAM,4CAC7B,GAAIsmB,EAEF,OAAIA,EAAW,GACNA,EAAW,GAAKA,EAAW,GAAG3nB,OAGhC2nB,EAAW,GAKpB,MAAMC,EAAoBF,EAAIrmB,MAAM,4CACpC,GAAIumB,EACF,OAAOA,EAAkB,GAK3B,MAAMC,EAAiBH,EAAIrmB,MAAM,yBACjC,GAAIwmB,EACF,OAAOA,EAAe,GAKxB,MAAMC,EAAmBJ,EAAIrmB,MAAM,gCACnC,OAAIymB,EACKA,EAAiB,GAInBJ,CACT,CAIA,SAASK,EAAyBC,GAChC,IAAKA,EAAc,OAAO,EAC1B,MAGM3mB,EAHMrE,OAAOgrB,GAAchoB,OAGfqB,MAAM,sBACxB,GAAIA,EAAO,CACT,MAAM+Y,EAAM1B,WAAWrX,EAAM,IAC7B,OAAOsX,MAAMyB,GAAO,EAAIA,CAC1B,CAEA,OAAO,CACT,CAGA,SAAS6N,EAAUnwB,EAAK0C,EAAO0tB,EAAMC,GACnC,MAAMC,EA3HR,SAA4BF,EAAMC,GAChC,IAAKA,IAAcD,EAAM,MAAO,GAEhC,MAAMzmB,EAAQymB,EAAKpjB,MAAM,KACzB,IAAIyf,EAAU4D,EACd,IAAK,MAAME,KAAQ5mB,EAAO,CACxB,GAAI8iB,QAA2C,MAAO,GACtDA,EAAUA,EAAQ8D,EACpB,CAEA,IAAK9D,EAAS,MAAO,GAErB,GAAuB,iBAAZA,GAAwBA,EAAQ/lB,SAAS,MAAO,CACzD,MAAM6C,EAAQkjB,EAAQljB,MAAM,2BAC5B,GAAIA,EAAO,CACT,MAAMinB,EAAS5P,WAAWrX,EAAM,IAC1BknB,EAAS7P,WAAWrX,EAAM,IAChC,IAAKsX,MAAM2P,KAAY3P,MAAM4P,GAC3B,OAAOA,EAASD,EAAS,IAAMC,EAASD,EAAS,IAAM,EAE3D,CACA,MAAO,GACT,CACA,MAAO,EACT,CAmG0BE,CAAmBN,EAAMC,GAC3CM,EAAeL,EAAkB,cAAgB,GAEvD,IAAIJ,EACAU,EAAa,YAEbrB,EAAM7sB,GACRwtB,EAAehrB,OAAOxC,EAAM,IACnB8sB,EAAc9sB,IACvBwtB,EAAextB,EAAMtC,IAAIwM,GAAK1H,OAAO0H,GAAK,KAAK/C,KAAK,MACpD+mB,GAAc,oBAGdV,EAAeP,EAA2BjtB,GAAS,IAAI,GAIzD,IAAImuB,EAAe,GACnB,IAGE,GAA6B,mBAAlBC,IAAgCA,GAAcZ,GAAe,CAEtE,MAAMa,EAAed,EAAyBC,GAC9C,GAAIa,EAAe,EAAG,CAEpB,IAAIC,EAAWhxB,EACf,GAAIA,EAAI0G,SAAS,KAAM,CACrB,MAAMiD,EAAQ3J,EAAIgN,MAAM,KACxBgkB,EAAWrnB,EAAMA,EAAM5J,OAAS,EAClC,CAEA,GAAIqwB,GAAQA,EAAK1pB,SAAS,KAAM,CAC9B,MAAMuqB,EAAYb,EAAKpjB,MAAM,KACvBwI,EAAWyb,EAAUA,EAAUlxB,OAAS,GAE1CyV,IAAa,QAAQpM,KAAKoM,IAAaA,IAAaxV,IACtDgxB,EAAWxb,EAEf,CACAqb,EAAe,4DAA4D7rB,EAAWorB,uBAA0BprB,EAAWgsB,wBAA+BD,kJAC5J,CACF,CACF,CAAE,MAAO1vB,GACPF,QAAQG,KAAK,qCAAsCD,EACrD,CAEA,MAAO,yCACyBsvB,iDACK3rB,EAAWhF,oGAEf4wB,iBAA0B5rB,EAAWorB,OAAUprB,EAAWkrB,sCACvEW,8BACAP,EAAkB,sCAAsCA,WAA2B,sEAIzG,CAGA,SAASY,EAAWlxB,EAAK0C,EAAO0tB,EAAMC,EAAWc,EAAOC,EAAiBC,GACvE,MAAMC,EAAa7B,EAAc/sB,GAC3B6uB,EAAiBH,EAAkB,GAAK,YAE9C,IAAII,EAAW,GACXC,GAAiB,EACjBC,EAAkB,EAClB1P,EAAW,EAEf,IAAIzd,MAAMuQ,QAAQpS,IAAW6sB,EAAM7sB,IAAW8sB,EAAc9sB,IAcrD,GAAIA,GAA0B,iBAAVA,IAAuB6sB,EAAM7sB,GAAQ,CAE9D,MAAMsB,EAAUZ,OAAOY,QAAQtB,GAAOmN,OAAO,EAAE6f,MAAQA,EAAEzvB,WAAW,MAEpE,IAAK,MAAO0xB,EAAUC,KAAe5tB,EAAS,CAC5C,MAAM6tB,EAAYzB,EAAO,GAAGA,KAAQuB,IAAaA,GAE7CC,GAAoC,iBAAfA,GAA4BrC,EAAMqC,IAAgBpC,EAAcoC,IAOvF5P,IACAwP,GAAYrB,EAAUwB,EAAUC,EAAYC,EAAWxB,KANvDoB,GAAiB,EACjBC,IACAF,GAAYN,EAAWS,EAAUC,EAAYC,EAAWxB,EAAWc,EAAQ,GAAG,EAAOE,GAMzF,CACF,OA9BE3uB,EAAM1B,QAAQ,CAACC,EAAM2Y,KACnB,MAAMkY,EAAW,GAAG1B,KAAQxW,MAExB3Y,GAAwB,iBAATA,GAAsBsuB,EAAMtuB,IAAUuuB,EAAcvuB,IAKrE+gB,IACAwP,GAAYrB,EAAU,IAAIvW,KAAU3Y,EAAM6wB,EAAUzB,KALpDoB,GAAiB,EACjBC,IACAF,GAAYN,EAAW,IAAItX,KAAU3Y,EAAM6wB,EAAUzB,EAAWc,EAAQ,GAAG,EAAOE,MA0BxF,MAAMU,EAAYxtB,MAAMuQ,QAAQpS,GAAS,IAAI4uB,KAAgB,IAAIA,KAG3DU,EAAYX,GAAgBI,EAAiB,kCAAoC,gBAGvF,IAAIQ,GAAuB,EAC3B,GAAIZ,GAAgBI,GAA4B,IAAVN,EAEpC,IAAI5sB,MAAMuQ,QAAQpS,IAAW6sB,EAAM7sB,IAAW8sB,EAAc9sB,IAQrD,GAAIA,GAA0B,iBAAVA,IAAuB6sB,EAAM7sB,GAAQ,CAE9D,MAAMsB,EAAUZ,OAAOY,QAAQtB,GAAOmN,OAAO,EAAE6f,MAAQA,EAAEzvB,WAAW,MACpE,IAAK,MAAO0xB,EAAUC,KAAe5tB,EACnC,GAAI4tB,GAAoC,iBAAfA,IAA4BrC,EAAMqC,KAAgBpC,EAAcoC,GAAa,CAC5EnC,EAAcmC,IACf,IAAGK,GAAuB,EACnD,CAEJ,OAfEvvB,EAAM1B,QAAQC,IACZ,GAAIA,GAAwB,iBAATA,IAAsBsuB,EAAMtuB,KAAUuuB,EAAcvuB,GAAO,CACrDwuB,EAAcxuB,IACf,IAAGgxB,GAAuB,EAClD,IA2BN,MAAO,yCANLZ,GACAI,IACY,IAAVN,IAAiBO,GAAmB,GAAK1P,GAAY,GAAMiQ,IAC1Dd,EAAQ,GAAkB,IAAbnP,GAAkB0P,GAAmB,GACN,oBAAsB,MAGrBH,iBAA8BvsB,EAAWorB,mBAAsBe,mJAGnFnsB,EAAWhF,uEACY+xB,yKAIzBC,gCACRR,qEAItB,CAyPA,MAAO,CACLjE,UAAWA,EAEXoB,YAAaA,EACbC,QAASA,EACTsD,iBAxlBF1J,eAAgCyG,EAAa,EAAGC,EAAa,KAC3D,IAEE,MAAMiD,QAlyBV3J,iBAEE,MAAMmF,EAAYnoB,OAAOmoB,WAAanoB,OAAO0kB,QAAQyD,UAC/CC,EAAUpoB,OAAOooB,SAAWpoB,OAAO0kB,QAAQ0D,QAEjD,GAAyB,mBAAdD,GAA+C,mBAAZC,EAC5C,IAEE,MAAMwE,QAAgB5N,QAAQ2K,KAAK,CACjCpB,IACA,IAAIvJ,QAAQ,CAAC6K,EAAG3K,IAAWuJ,WAAW,IAAMvJ,EAAO,IAAIrV,MAAM,gBAAiB,QAGhF,GAAI+iB,GAAWA,EAAQ5D,UAErB,OADArtB,QAAQC,IAAI,yBACL,CAAEqG,KAAM,MAAOpH,KAAM+xB,EAEhC,CAAE,MAAO/wB,GACPF,QAAQG,KAAK,wBAAyBD,EAAE2Q,QAC1C,CAIF,IAGE,SAFMod,sBAAsB,YAEF,IAAf5pB,OAAOqoB,KAAwD,mBAA1BroB,OAAOqoB,IAAIC,WAA2B,CACpF,MAAMuE,EAAU7sB,OAAOqoB,IAAIC,WAAW,CAAErf,KAAM,UAAWqgB,WAAY,WAErE,GAAIuD,GAAWA,EAAQ7D,UAErB,OADArtB,QAAQC,IAAI,yBACL,CACLqG,KAAM,MACNpH,KAAM,CACJmuB,UAAW6D,EAAQ7D,WAAa,KAChCO,aAAcsD,EAAQtD,cAAgB,CAAC,EACvCN,WAAY4D,EAAQ5D,YAAc,CAAC,EACnCC,OAAQ2D,EAAQ3D,QAAU,KAC1BhB,QAAS,OAIjB,CACF,CAAE,MAAOrsB,GACPF,QAAQG,KAAK,oBAAqBD,EACpC,CAIA,OADAF,QAAQG,KAAK,iCACN,CAAEmG,KAAM,MAAOpH,KAAM,KAC9B,CAgvB4BiyB,GAGxB,GAAIH,EAAU9xB,KAEZ,OADAmtB,EAAgB2E,EAAU9xB,KACnB8xB,EAAU9xB,KAMnB,GAAa,QAFA8xB,EAAU1qB,KAEH,CAElB,IAAK,IAAI6nB,EAAU,EAAGA,GAAWL,EAAYK,IAAW,CACtD,IACE,MAAMjvB,QAAa0tB,IACnB,GAAI1tB,GAAQA,EAAKmuB,UAEf,OADAhB,EAAgBntB,EACTA,CAEX,CAAE,MAAOgB,GACPF,QAAQG,KAAK,wBAAwBguB,KAAWL,MAAgB5tB,EAClE,CAEIiuB,EAAUL,SACN,IAAIzK,QAAQC,GAAWwJ,WAAWxJ,EAASyK,GAErD,CAIA,OADA/tB,QAAQG,KAAK,oCACA0tB,EAAoBC,EAAYC,EAC/C,CAEE,aAAaF,EAAoBC,EAAYC,EAEjD,CAAE,MAAO7tB,GAEP,OADAF,QAAQ2M,MAAM,gBAAiBzM,GACxB,IACT,CACF,EAgjBEkxB,0BAA2B/J,iBACzB,MAAMtM,EAAS,CACbpN,WAAW,IAAInN,MAAOwV,cACtBqb,IAAK,CACHC,WAAW,EACX9E,UAAqE,mBAAlDnoB,OAAOmoB,WAAanoB,OAAO0kB,QAAQyD,WACtDC,QAA+D,mBAA9CpoB,OAAOooB,SAAWpoB,OAAO0kB,QAAQ0D,SAClD8E,eAAe,EACf5kB,MAAO,MAET6kB,IAAK,CACHF,WAAW,EACXG,eAAiC,IAAfptB,OAAOqoB,IACzBgF,cAAiD,mBAA3BrtB,OAAOqoB,KAAKC,WAClC4E,eAAe,EACf5kB,MAAO,MAETglB,MAAO,CACLC,WAAYvF,EACZwF,UAAWxF,EAAgBpqB,OAAOC,KAAKmqB,GAAiB,IAE1DyF,eAAgB,IAIlB,GAAI/W,EAAOsW,IAAI7E,WAAazR,EAAOsW,IAAI5E,QACrC,IACE,MAAMwE,QAAgB5N,QAAQ2K,KAAK,CACjCpB,IACA,IAAIvJ,QAAQ,CAAC6K,EAAG3K,IAAWuJ,WAAW,IAAMvJ,EAAO,IAAIrV,MAAM,YAAa,QAE5E6M,EAAOsW,IAAIC,WAAY,EACvBvW,EAAOsW,IAAIE,iBAAmBN,IAAWA,EAAQ5D,UACnD,CAAE,MAAOntB,GACP6a,EAAOsW,IAAI1kB,MAAQzM,EAAE2Q,OACvB,CAIF,GAAIkK,EAAOyW,IAAIC,WAAa1W,EAAOyW,IAAIE,cACrC,UAEQrO,QAAQ2K,KAAK,CACjBC,sBAAsB,OACtB,IAAI5K,QAAQ,CAAC6K,EAAG3K,IAAWuJ,WAAW,IAAMvJ,EAAO,IAAIrV,MAAM,SAAU,QAEzE,MAAMgjB,EAAU7sB,OAAOqoB,IAAIC,WAAW,CAAErf,KAAM,UAAWqgB,WAAY,WACrE5S,EAAOyW,IAAIF,WAAY,EACvBvW,EAAOyW,IAAID,iBAAmBL,IAAWA,EAAQ7D,UACnD,CAAE,MAAOntB,GACP6a,EAAOyW,IAAI7kB,MAAQzM,EAAE2Q,OACvB,CAcF,OAVIkK,EAAOsW,IAAIE,cACbxW,EAAO+W,eAAiB,gBACf/W,EAAOyW,IAAID,cACpBxW,EAAO+W,eAAiB,gBACf/W,EAAOsW,IAAIC,WAAavW,EAAOyW,IAAIF,UAC5CvW,EAAO+W,eAAiB,8BAExB/W,EAAO+W,eAAiB,iCAGnB/W,CACT,EAEAgX,aAAc,WAEZ,MAAMC,EAAY3tB,OAAO0kB,QAAQ5b,UAAYA,SAC7C,GAAI6kB,EAAU5kB,eAAe,qBAAsB,OACnD,MAAM6kB,EAAUD,EAAUhiB,cAAc,SACxCiiB,EAAQ7jB,GAAK,oBACb6jB,EAAQC,YA3wCG,0qjBA4wCXF,EAAUG,KAAKzhB,YAAYuhB,EAC7B,EAEAG,gBAAiB,SAAUC,GAGzB,MAAO,2CADaA,EAAW,SAAW,qCACsDjG,8HAGlG,EAEAkG,YAAa,WAIX,MAAMpB,EAAUzD,IAIV8E,EAAwB,QADdjG,IAIhB,IAAIkG,GAAgB,EACpB,IAEEA,EAA0B,SADZ7zB,aAAaU,QAAQ,uBAErC,CAAE,MAAOa,GACPF,QAAQG,KAAK,6BAA8BD,EAC7C,CAGA,MAAMuyB,EAAa,kBAGbC,EAAaH,EAAY,SAAW,SAG1C,IAAKrB,EACH,MAAO,yPAGkHwB,2WAKpBvG,GAAUC,qmBAUvEqG,qLAGRF,EAAY,MAAQ,qFACQA,EAAY,SAAW,yHAOrF,IACGrB,EAAQ7D,WACqB,iBAAtB6D,EAAQ7D,WAAoE,IAA1CprB,OAAOC,KAAKgvB,EAAQ7D,WAAWzuB,OAEzE,MAAO,yPAGkH8zB,2WAKpBvG,GAAUC,qmBAUvEqG,2WAW1C,GAAID,EAAe,CACjB,MAAMG,EA9aZ,SAA2BzB,GACzB,IAAKA,IAAYA,EAAQ7D,UACvB,MAAO,gFAIT,IAAIuF,EAAgB,CAAC,EACrB,IACE,MAAMC,EAAQl0B,aAAaU,QAAQ,uCAC/BwzB,IACFD,EAAgBzzB,KAAKC,MAAMyzB,GAE/B,CAAE,MAAO3yB,GACPF,QAAQG,KAAK,6BAA8BD,EAC7C,CAGA,MAAM4yB,EAAe,GAGrB,SAASC,EAAoBC,EAAK/D,EAAMgE,GACtC,GAAKD,GAAsB,iBAARA,EAEnB,GAAI5vB,MAAMuQ,QAAQqf,GACZ5E,EAAM4E,IAAQ3E,EAAc2E,GAE9BA,EAAInzB,QAAQ,CAACC,EAAM2Y,KACjB,MAAMkY,EAAW1B,EAAO,GAAGA,KAAQxW,KAAW,IAAIA,KAC5Cya,EAAYnvB,OAAOjE,GAAQ,IAAIiH,OACrC,GAA6B,mBAAlB4oB,IAAgCA,GAAcuD,GAAY,CAEnE,MACMC,EAAWrE,EADIN,EAA2B0E,GAAW,IAEvDC,EAAW,GACbL,EAAa/zB,KAAK,CAChBkwB,KAAM0B,EACN9xB,IAAK,IAAI4Z,KACTlX,MAAO2xB,EACPtD,aAAcuD,EACdF,WAAY,IAAIA,IAGtB,IAIFD,EAAInzB,QAAQ,CAACC,EAAM2Y,KAGjBsa,EAAoBjzB,EAFHmvB,EAAO,GAAGA,KAAQxW,KAAW,IAAIA,KAC5B,IAAIwa,EAAY,IAAIxa,aAIzC,CAEL,MAAM5V,EAAUZ,OAAOY,QAAQmwB,GAAKtkB,OAAO,EAAE6f,MAAQA,EAAEzvB,WAAW,MAClE,IAAK,MAAOD,EAAK0C,KAAUsB,EAAS,CAClC,MAAM6tB,EAAYzB,EAAO,GAAGA,KAAQpwB,IAAQA,EACtCu0B,EAAgB,IAAIH,EAAYp0B,GAEtC,IAAI0C,GAA0B,iBAAVA,GAAuB6sB,EAAM7sB,IAAW8sB,EAAc9sB,GAGnE,CAEL,MAAM2xB,EAAYnvB,OAAOxC,GAAS,IAAIwF,OACtC,GAA6B,mBAAlB4oB,IAAgCA,GAAcuD,GAAY,CAEnE,MACMC,EAAWrE,EADIN,EAA2B0E,GAAW,IAEvDC,EAAW,GACbL,EAAa/zB,KAAK,CAChBkwB,KAAMyB,EACN7xB,IAAKA,EACL0C,MAAO2xB,EACPtD,aAAcuD,EACdF,WAAYG,GAGlB,CACF,MAlBEL,EAAoBxxB,EAAOmvB,EAAW0C,EAmB1C,CACF,CACF,CAGA,MAAMC,EAAUpxB,OAAOC,KAAKgvB,EAAQ7D,WAAW3e,OAAO6f,IAAMA,EAAEzvB,WAAW,MACzE,IAAK,MAAMD,KAAOw0B,EAEhBN,EADc7B,EAAQ7D,UAAUxuB,GACLA,EAAK,CAACA,IAInC,MAAMy0B,EAAuBR,EAAapkB,OAAO5O,IAG/C,IAAIyzB,EAAezzB,EAAKjB,IACxB,MAAM20B,EAAiB1zB,EAAKmzB,WAAWvkB,OAAO+kB,GAASA,IAAUA,EAAM30B,WAAW,MAClF,GAAI00B,EAAe50B,OAAS,EAC1B20B,EAAeC,EAAeA,EAAe50B,OAAS,QACjD,GAAIkB,EAAKmvB,MAAQnvB,EAAKmvB,KAAK1pB,SAAS,KAAM,CAE/C,MAAMiD,EAAQ1I,EAAKmvB,KAAKpjB,MAAM,KAC9B0nB,EAAe/qB,EAAMA,EAAM5J,OAAS,EACtC,CAEA,OAAQ2U,EAAiBY,cAAcof,KAGzC,GAAoC,IAAhCD,EAAqB10B,OACvB,MAAO,gFAKT,MAAM80B,EAAgB,IAAI9f,IAC1B0f,EAAqBzzB,QAAQC,KAGzBA,EAAKmzB,WAAWr0B,OAAS,EACrBkB,EAAKmzB,WAAWrzB,MAAM,GAAI,GAC1B,IAEUC,QAAQ4zB,IAClBA,IAAUA,EAAM30B,WAAW,MAE7B40B,EAAc7c,IAAI4c,OAKxB,MAAME,EAAkBvwB,MAAM8iB,KAAKwN,GAAel0B,OAGlD,IAAIo0B,EAAmB,GACvB,GAAID,EAAgB/0B,OAAS,EAAG,CAC9B,MAAMiH,EAAQZ,KACR4uB,EAAkBhuB,EAAMiuB,oBAAsBjuB,EAAMkuB,UAAY,UAGtE,IAAIC,EAAmB,GACvBL,EAAgB9zB,QAAQo0B,IACtB,MAAMC,GAAyC,IAA7BtB,EAAcqB,GAC1BE,EAAcD,EAChB,sCAAsCL,8CACtC,+FACJG,GAAoB,gDAAgDnwB,EAAWowB,qBAA6BC,yKAAiLC,iCAA2CD,EAAY,KAAO,WAAWrwB,EAAWowB,aAAqBpwB,EAAWowB,uBAInZL,EAAmB,m0BAOXI,mDAIV,CAGA,IAAII,EAAY,GA+EhB,OA9EAd,EAAqBzzB,QAAQC,IAE3B,MAAM0zB,EAAiB1zB,EAAKmzB,WAAWvkB,OAAO+kB,IAAUA,EAAM30B,WAAW,MAGnE8zB,EAAgB9yB,EAAKmzB,WAAWvkB,OAAO+kB,IAC3C,GAAIA,EAAM30B,WAAW,KAAM,OAAO,EAClC,IACE,MAAM+zB,EAAQl0B,aAAaU,QAAQ,uCACnC,GAAIwzB,EAEF,OAAwB,IADV1zB,KAAKC,MAAMyzB,GACZY,EAEjB,CAAE,MAAOvzB,GAET,CACA,OAAO,IAKHm0B,EAAazB,EAAch0B,OAAS,EAAIg0B,EAAchzB,MAAM,GAAI,GAAK,GAIrE00B,EAAkBd,EAAe50B,OAAS,EAAI40B,EAAe5zB,MAAM,GAAI,GAAK,GAE5E20B,EAAmBD,EAAgBzM,MAAM4L,IAC7C,IACE,MAAMZ,EAAQl0B,aAAaU,QAAQ,uCACnC,GAAIwzB,EAEF,OAAwB,IADV1zB,KAAKC,MAAMyzB,GACZY,EAEjB,CAAE,MAAOvzB,GAET,CACA,OAAO,IAIHs0B,EAAcH,EAAWz1B,OAAS,EAAIy1B,EAAW3rB,KAAK,OAAS,GAIrE,IAAI+rB,EAHa30B,EAAKjB,IAItB,GAAIiB,EAAKmvB,MAAQnvB,EAAKmvB,KAAK1pB,SAAS,KAAM,CACxC,MAAMiD,EAAQ1I,EAAKmvB,KAAKpjB,MAAM,KAC9B4oB,EAAgBjsB,EAAMA,EAAM5J,OAAS,EACvC,CAGA,MAAM8wB,EAAe,4DAA4D7rB,EAAW/D,EAAKmvB,0BAA0BprB,EAAW4wB,wBAAoC30B,EAAK8vB,8JAG/K,IAAIb,EAAeP,EAA2B1uB,EAAKyB,OAAO,GAE1DwtB,EAAeA,EAAa/qB,QAAQ,kBAAmB,IAIvD,MAAM0wB,EAAeH,EAAmB,GAAK,gBACvCI,EAAax1B,KAAKwB,UAAU2zB,GAElCF,GAAa,0DACkCvwB,EAAW8wB,cAAuBD,wWAE4D7wB,EAAW2wB,gNAEjC3wB,EAAW4wB,iEACrF5wB,EAAW/D,EAAKmvB,6HAA6HprB,EAAWkrB,8BAC3LW,4EAOLkE,EAAmB,yDAA2DQ,EAAY,QACnG,CA2L0BQ,CAAkB1D,GACtC,MAAO,6OAG8GwB,idAKpBvG,GAAUC,+wBAavEqG,iDACpBE,iDAGlB,CAGA,MAAMU,EAAUpxB,OAAOC,KAAKgvB,EAAQ7D,WAAW3e,OAAO6f,IAAMA,EAAEzvB,WAAW,MAEzE,IAAI+1B,EAAY,GAChB,IAAK,MAAMh2B,KAAOw0B,EAAS,CACzB,MAAM9xB,EAAQ2vB,EAAQ7D,UAAUxuB,GACbyvB,EAAc/sB,IAE7BA,GAA0B,iBAAVA,GAAuB6sB,EAAM7sB,IAAW8sB,EAAc9sB,GAMxEszB,GAAa,kEACsChxB,EAAWhF,yHAEpCmwB,EAAUnwB,EAAK0C,EAAO1C,EAAKqyB,EAAQ5D,oHAN7DuH,GAAa9E,EAAWlxB,EAAK0C,EAAO1C,EAAKqyB,EAAQ5D,WAAY,GAAG,GAAM,EAW1E,CAEA,MAAO,6OAGgHoF,2EACrEW,EAAQz0B,oRAIyCutB,GAAUC,kxBAavEqG,gCACpBoC,iDAGpB,EAEAC,WAAY,SAAUC,GAEpB,MAAMtwB,EAAIJ,OAAO0kB,QAAQI,QAAU9kB,OAAO8kB,OAC1C,IAAK1kB,IAAMswB,IAAeA,EAAWn2B,OAEnC,YADAoB,QAAQG,KAAK,iEAKf,MAAM60B,EAASvwB,EAAE,kBACZuwB,EAAOp2B,QAMZo2B,EAAOC,IAAI,QAGXD,EAAOxwB,GAAG,YAAa,mBAAoB,SAAUtE,GACnDA,EAAEg1B,kBACF,MAAMC,EAAQ1wB,EAAEpG,MAAM+2B,QAAQ,aACxBC,EAAQF,EAAMhvB,KAAK,oBAAoBkjB,QAGzCgM,EAAMC,GAAG,cAAgBD,EAAM1wB,SAAS,eAExCwwB,EAAMxwB,SAAS,cAEjB0wB,EAAME,OACNJ,EAAMK,YAAY,aAClBH,EAAMI,SAAS,aAAaC,UAAU,IAAK,WACzCjxB,EAAEpG,MAAMm3B,YAAY,YACtB,IAGAH,EAAMI,SAAS,aAAaE,QAAQ,IAAK,WACvCR,EAAMM,SAAS,aACfhxB,EAAEpG,MAAMm3B,YAAY,YACtB,GAEJ,GAGAR,EAAOxwB,GAAG,YAAa,mBAAoB,SAAUtE,GACnDA,EAAEg1B,kBACF/I,GAAUyJ,QAAQZ,EACpB,GAGAA,EAAOxwB,GAAG,YAAa,wBAAyB,SAAUtE,GACxDA,EAAEg1B,kBACF,IACE,MACMW,GADqBpxB,EAAEpG,MAAMsG,SAAS,UAI5C,GAFAhG,aAAa+B,QAAQ,uBAAwBqD,OAAO8xB,IAElB,mBAAvBC,GAAmC,CAC5C,MAAMC,EAAaC,KACnBF,GAAmBC,EACrB,CAC+B,mBAApBE,IACTA,IAEJ,CAAE,MAAO/1B,GACPF,QAAQG,KAAK,2BAA4BD,GACrCmE,OAAO6xB,QAAQ7xB,OAAO6xB,OAAOvpB,MAAM,SACzC,CACF,GAGAqoB,EAAOxwB,GAAG,YAAa,6BAA8B,SAAUtE,GAC7DA,EAAEg1B,kBACczwB,EAAEpG,MACW+2B,QAAQ,mCAGxBe,YAAY,YAC3B,GAGAnB,EAAOxwB,GAAG,YAAa,oBAAqB,SAAUtE,GACpDA,EAAEg1B,kBACF,MAAMkB,EAAU3xB,EAAEpG,MACZ41B,EAAYmC,EAAQl3B,KAAK,SAEzBg1B,IAD6C,SAA5BkC,EAAQl3B,KAAK,aAAqD,IAA5Bk3B,EAAQl3B,KAAK,YAG1E,IACE,MAAM2zB,EAAQl0B,aAAaU,QAAQ,uCAC7BuzB,EAAgBC,EAAQ1zB,KAAKC,MAAMyzB,GAAS,CAAC,EACnDD,EAAcqB,GAAaC,EAC3Bv1B,aAAa+B,QAAQ,sCAAuCvB,KAAKwB,UAAUiyB,IAG3E,MAAM/sB,EAAQZ,KACR4uB,EAAkBhuB,EAAMiuB,oBAAsBjuB,EAAMkuB,UAAY,UACtEqC,EAAQl3B,KAAK,UAAWg1B,GACpBA,GACFkC,EAAQC,IAAI,CACVlmB,WAAY,oBACZmmB,MAAOzC,EACP0C,YAAa,oBACbC,QAAS,MAEXJ,EAAQK,KAAK,QAAS,SAASxC,OAE/BmC,EAAQC,IAAI,CACVlmB,WAAY,cACZmmB,MAAO,sBACPC,YAAa,oBACbC,QAAS,QAEXJ,EAAQK,KAAK,QAAS,SAASxC,MAIjCxvB,EAAE,qBAAqBiyB,KAAK,WAC1B,MAAMC,EAAQlyB,EAAEpG,MAChB,IACE,MAAMu4B,EAASz3B,KAAKC,MAAMu3B,EAAMF,KAAK,gBAAkB,MACvD,GAAIG,EAAOrxB,SAAS0uB,GAAY,CAE9B,MAAMrB,EAAgBgE,EAAOloB,OAAO+kB,IAClC,MAAMZ,EAAQl0B,aAAaU,QAAQ,uCAEnC,OAAwB,KADVwzB,EAAQ1zB,KAAKC,MAAMyzB,GAAS,CAAC,GAC9BY,KAITY,EAAazB,EAEbiE,EAAiBxC,EAAWz1B,OAAS,EAAIy1B,EAAW3rB,KAAK,OAAS,GAGxEiuB,EAAMxwB,KAAK,qBAAqBmjB,KAAKuN,EACvC,CACF,CAAE,MAAO32B,GACPF,QAAQG,KAAK,2BAA4BD,EAC3C,CACF,EACF,CAAE,MAAOA,GACPF,QAAQG,KAAK,6BAA8BD,EAC7C,CACF,GAGA80B,EAAOxwB,GAAG,YAAa,aAAc,SAAUtE,GAC7CA,EAAEg1B,kBACF,MAAM4B,EAASryB,EAAEpG,MACX4wB,EAAO6H,EAAO53B,KAAK,QACzB,IAAK+vB,EAEH,YADAjvB,QAAQG,KAAK,4CAGf,MAAMoe,EAAeuY,EAClBxN,OACAtlB,QAAQ,YAAa,IACrB+C,OAEHolB,GAAU4K,eAAe9H,EAAM1Q,EAAc8I,eAAgB/K,GAC3D,GAAiB,OAAbA,GAAqBA,IAAaiC,EAAc,CAClD,MAAMlC,QAAgB8P,GAAU6K,SAAS/H,EAAM3S,GACzC4Z,OAAS7xB,OAAO0kB,QAAQmN,QAAU7xB,OAAO6xB,OAC3C7Z,GACFya,EAAOxN,KAAKhN,GACZwa,EAAOT,IAAI,aAAc,yBACzBvJ,WAAW,IAAMgK,EAAOT,IAAI,aAAc,IAAK,OAE3CH,QAAQA,OAAOvpB,MAAM,OAE7B,CACF,EACF,GAGAqoB,EAAOxwB,GAAG,YAAa,iBAAkB,SAAUtE,GACjDA,EAAEg1B,kBACFh1B,EAAE+2B,iBACF,MAAMC,EAAQzyB,EAAEpG,MACV4wB,EAAOiI,EAAMh4B,KAAK,QAClB2wB,EAAWqH,EAAMh4B,KAAK,cAAgB,KACtCi4B,EAAY/V,SAAS8V,EAAMh4B,KAAK,cAAe,KAAO,GAG5D,IAAK+vB,EAEH,YADAjvB,QAAQG,KAAK,8BAKf,QAA0B,IAAfkE,OAAOqoB,KAAwD,mBAA1BroB,OAAOqoB,IAAIC,WAYzD,OAXA3sB,QAAQG,KAAK,0CAEgB,mBAAlBi3B,IACTA,GAAc,CACZD,UAAWA,EACXE,YAAa,KACbC,WAAYzH,EACZ0H,cAAe,SACfC,SAAS,KAOf,IAAIC,EAAa,KACjB,IACEA,EA16DR,SAA6BxI,GAC3B,IACE,IAAKA,GAAwB,iBAATA,EAClB,MAAO,CAAEyI,UAAW,KAAM7H,SAAU,KAAM7D,WAAY,IAIxD,MAAMxjB,EAAQymB,EAAKpjB,MAAM,KAAK6C,OAAOiH,GAAKA,GAAKA,EAAE5O,QAEjD,GAAqB,IAAjByB,EAAM5J,OACR,MAAO,CAAE84B,UAAW,KAAM7H,SAAU,KAAM7D,WAAY,IAIxD,MAAM5X,EAAY,CAChB,OACA,KACA,KACA,IACA,KACA,KACA,KACA,KACA,KACA,YACA,cAIIujB,EAAgBnvB,EAAMkG,OAAOiH,IAAMvB,EAAU7O,SAASoQ,IAG5D,IAAI+hB,EAAY,KACZC,EAAc/4B,QAAU,EAE1B84B,EAAYC,EAAcA,EAAc/4B,OAAS,GACf,IAAzB+4B,EAAc/4B,SAEvB84B,EAAYC,EAAc,IAI5B,IAAI9H,EAAW,KAWf,OAVI8H,EAAc/4B,OAAS,EACzBixB,EAAW8H,EAAcA,EAAc/4B,OAAS,GACvC4J,EAAM5J,OAAS,IAExBixB,EAAWrnB,EAAMA,EAAM5J,OAAS,IAM3B,CACL84B,UAAWA,GAAa,KACxB7H,SAAUA,GAAY,KACtB7D,WALiB2L,EAAc/4B,OAAS,EAAI+4B,EAAgBnvB,EAAM5I,OAAO,GAO7E,CAAE,MAAOM,GAEP,OADAF,QAAQG,KAAK,oCAAqCD,GAC3C,CAAEw3B,UAAW,KAAM7H,SAAU,KAAM7D,WAAY,GACxD,CACF,CA42DqB4L,CAAoB3I,EACnC,CAAE,MAAO/uB,GACPF,QAAQG,KAAK,0BAA2BD,EAC1C,CAG6B,mBAAlBk3B,IACTA,GAAc,CACZD,UAAWA,EACXE,YAAa,KACbC,WAAYzH,EACZ0H,cAAeE,GAAYC,WAAa,SACxCF,SAAS,EACTK,QAAS5I,EACT6I,cAAeL,GAGrB,GAGA,WAEE,MAAMzF,EAAY3tB,OAAO0kB,QAAQ5b,UAAYA,SACvC4qB,EAAOtzB,EAAEutB,GAGf+F,EAAK9C,IAAI,oEAAqE,kBAE9E,IAAI+C,EAAc,EACdC,EAAc,EACdC,GAAoB,EAGxBH,EAAKvzB,GAAG,yBAA0B,iBAAkB,SAAUtE,GAC5CuE,EAAEvE,EAAEwE,QACS0wB,QAAQ,kBAAkBx2B,OAAS,GAKzB,IAAnCsB,EAAEi4B,cAAcC,QAAQx5B,SAC1Bo5B,EAAc93B,EAAEi4B,cAAcC,QAAQ,GAAGC,QACzCJ,EAAc/3B,EAAEi4B,cAAcC,QAAQ,GAAGE,QACzCJ,GAAoB,EAExB,GAEAH,EAAKvzB,GAAG,wBAAyB,iBAAkB,SAAUtE,GAK3D,KAJgBuE,EAAEvE,EAAEwE,QACS0wB,QAAQ,kBAAkBx2B,OAAS,GAI9D,OAGF,GAAuC,IAAnCsB,EAAEi4B,cAAcC,QAAQx5B,OAAc,OAE1C,MAAM25B,EAAQr4B,EAAEi4B,cAAcC,QAAQ,GAChCI,EAASxsB,KAAKysB,IAAIF,EAAMF,QAAUL,GAClCU,EAAS1sB,KAAKysB,IAAIF,EAAMD,QAAUL,IAKtCS,EAAS,EACLF,EAAS,GAAKA,EAAkB,EAATE,EACvBF,EAAkB,IAATE,GAAgBF,EAAS,MAGtCN,GAAoB,EACpBh4B,EAAEy4B,2BACFz4B,EAAEg1B,kBAEN,GAEA6C,EAAKvzB,GAAG,uBAAwB,iBAAkB,SAAUtE,GAK1D,KAJgBuE,EAAEvE,EAAEwE,QACS0wB,QAAQ,kBAAkBx2B,OAAS,GAO9D,OAHAs5B,GAAoB,EACpBF,EAAc,OACdC,EAAc,GAKZC,IACFh4B,EAAEy4B,2BACFz4B,EAAEg1B,kBACFgD,GAAoB,GAEtBF,EAAc,EACdC,EAAc,CAChB,GAsCAjG,EAAUlhB,iBAAiB,aAnCM,SAAU5Q,GACzBuE,EAAEvE,EAAEwE,QACS0wB,QAAQ,kBAAkBx2B,OAAS,GAC5CsB,EAAEk4B,SAAgC,IAArBl4B,EAAEk4B,QAAQx5B,SACzCo5B,EAAc93B,EAAEk4B,QAAQ,GAAGC,QAC3BJ,EAAc/3B,EAAEk4B,QAAQ,GAAGE,QAE/B,GA4BmE,GACnEtG,EAAUlhB,iBAAiB,YA5BK,SAAU5Q,GAGxC,GAFgBuE,EAAEvE,EAAEwE,QACS0wB,QAAQ,kBAAkBx2B,OAAS,GAC5CsB,EAAEk4B,SAAgC,IAArBl4B,EAAEk4B,QAAQx5B,QAAgBo5B,GAAeC,EAAa,CACrF,MAAMM,EAAQr4B,EAAEk4B,QAAQ,GAClBI,EAASxsB,KAAKysB,IAAIF,EAAMF,QAAUL,GAClCU,EAAS1sB,KAAKysB,IAAIF,EAAMD,QAAUL,IAGtCS,EAAS,EAAIF,EAAS,GAAKA,EAAkB,EAATE,EAAaF,EAAkB,IAATE,GAAgBF,EAAS,MAEnFt4B,EAAEy4B,2BACFz4B,EAAEg1B,kBACFh1B,EAAE+2B,iBAEN,CACF,GAYiE,GACjEjF,EAAUlhB,iBAAiB,WAZI,SAAU5Q,GACvBuE,EAAEvE,EAAEwE,QACS0wB,QAAQ,kBAAkBx2B,OAAS,GAC5Cs5B,IAClBh4B,EAAEy4B,2BACFz4B,EAAEg1B,kBACFh1B,EAAE+2B,iBAEN,GAI+D,EAChE,CArHD,GAwHAjC,EAAOxwB,GAAG,YAAa,iBAAkB,SAAUtE,GACjDA,EAAEg1B,kBACF,MAAM0D,EAAS5D,EAAO7uB,KAAK,qBAGvByyB,EAAOh6B,QAAUg6B,EAAOryB,MAC1BqyB,EAAOryB,IAAI,IAAIkB,QAAQ,SAASoxB,SAKA,mBAAvB/C,IACTA,GAAmB,MAEU,mBAApBG,IACTA,KAEJ,GAGAjB,EAAOxwB,GAAG,kBAAmB,0BAA2B,SAAUtE,GAChE,GAAiB,IAAbA,EAAE44B,OAAc,OACpB54B,EAAE+2B,iBACF/2B,EAAEg1B,kBACF,MAAM6D,EAAS16B,KACf06B,EAAOC,kBAAkB94B,EAAE+4B,WAC3Bx0B,EAAEs0B,GAAQtD,SAAS,UACnB,MAAMyD,EAAclE,EAAOmE,SACrBC,EAASl5B,EAAEo4B,QACXz3B,EAAY4D,EAAEs0B,GAAQ75B,KAAK,SAG3BoL,OAAsD,IAA5BjG,OAAOiG,iBAAmCjG,OAAOiG,iBAAmB,IAC9FC,OAAsD,IAA5BlG,OAAOkG,iBAAmClG,OAAOkG,iBAAmB,IAEpGwuB,EAAOM,cAAgB,SAAUC,GAC/B,MAAMC,EAAKD,EAAMhB,QAAUc,EAC3B,IAAII,EAAYN,EAAcK,EAC1BC,EAAYlvB,IAAkBkvB,EAAYlvB,GAC1CkvB,EAAYjvB,IAAkBivB,EAAYjvB,GAC9CyqB,EAAOqB,IAAI,SAAUmD,EAAY,KACnC,EACAT,EAAOU,YAAc,SAAUC,GAK7B,GAJAj1B,EAAEs0B,GAAQvD,YAAY,UACtBuD,EAAOY,sBAAsBD,EAAIT,WACjCF,EAAOM,cAAgB,KACvBN,EAAOU,YAAc,KACjB54B,GAAwC,mBAApB+4B,IAA8D,mBAArBC,GAAiC,CAChG,MAAMC,EAAUF,KAChBE,EAAQj5B,GAAaugB,SAAS4T,EAAOqB,IAAI,WACzCwD,GAAiBC,GACjB9E,EAAOS,SAAS,kBAClB,CACF,CACF,GAGAT,EAAOxwB,GAAG,eAAgB,0BAA2B,SAAUtE,GAC7DA,EAAE+2B,iBACF/2B,EAAEg1B,kBACF,MAAMr0B,EAAY4D,EAAEpG,MAAMa,KAAK,SAC/B,GAAI2B,GAAwC,mBAApB+4B,IAA8D,mBAArBC,GAAiC,CAChG,MAAMC,EAAUF,YACTE,EAAQj5B,GACfg5B,GAAiBC,GACjB9E,EAAOqB,IAAI,SAAU,IAAIb,YAAY,kBACvC,CACF,GAGAR,EAAOxwB,GAAG,eAAgB,oBAAqB,SAAUtE,GACvD,GAAIuE,EAAEvE,EAAEwE,QAAQ0wB,QAAQ,sDAAsDx2B,OAAQ,OACtFsB,EAAE+2B,iBACF/2B,EAAEg1B,kBACF,MAAMr0B,EAAYsrB,GAAUC,UAC5B,GAAIvrB,GAAwC,mBAApB+4B,IAA8D,mBAArBC,GAAiC,CAChG,MAAMC,EAAUF,YACTE,EAAQj5B,GACfg5B,GAAiBC,GACjB9E,EAAOqB,IAAI,SAAU,IAAIb,YAAY,kBACvC,CACF,IAnaEx1B,QAAQG,KAAK,uDAoajB,EAEA42B,eAAgB,SAAU9H,EAAM1Q,EAAcwb,GAE5C,MAAMt1B,EAAIJ,OAAO0kB,QAAQI,QAAU9kB,OAAO8kB,OACpC6I,EAAY3tB,OAAO0kB,QAAQ5b,UAAYA,SAC7C,IAAK1I,EAAG,OAGRA,EAAEutB,GAAW7rB,KAAK,qBAAqBnB,SAEvC,MAEMg1B,EAAO,kFAF8B,mBAAd70B,GAA2BA,KAAYU,MAAQ,OAAS,oXASpChC,EAAWorB,+FACgBprB,EAAW0a,0qBAcvF9Z,EAAEutB,EAAUvhB,MAAM1K,OAAOi0B,GACzB,MAAM91B,EAAWO,EAAEutB,GAAW7rB,KAAK,qBAC7ByyB,EAAS10B,EAASiC,KAAK,sBAE7B2mB,WAAW,IAAM8L,EAAOC,QAAQoB,SAAU,IAG1C/1B,EAASM,GAAG,QAAS,kBAAmB,SAAUtE,GAChDA,EAAE+2B,iBACF/2B,EAAEg1B,kBACFhxB,EAASc,SACT+0B,EAAO,KACT,GAGA71B,EAASM,GAAG,QAAS,gBAAiB,SAAUtE,GAC9CA,EAAE+2B,iBACF/2B,EAAEg1B,kBACF,MAAM5Y,EAAWsc,EAAOryB,MACxBrC,EAASc,SACT+0B,EAAOzd,EACT,GAGArY,EAAkBC,EAAU,mBAAoB,KAC9CA,EAASc,SACT+0B,EAAO,QAITnB,EAAOp0B,GAAG,UAAW,SAAUtE,GAC7B,GAAc,WAAVA,EAAErB,IACJqB,EAAE+2B,iBACF/yB,EAASc,SACT+0B,EAAO,WACF,GAAc,UAAV75B,EAAErB,KAAmBqB,EAAEg6B,QAAS,CACzCh6B,EAAE+2B,iBACF,MAAM3a,EAAWsc,EAAOryB,MACxBrC,EAASc,SACT+0B,EAAOzd,EACT,CACF,EACF,EAEA0a,SAAU3P,eAAgB4H,EAAM3S,GAC9B,IAAKkR,IAAe,OAAO,EAE3B,MAAMlnB,EAAOgmB,IAEb,IACE,IAAI6N,EAAc7d,EAOlB,GANiB,SAAbA,EAAqB6d,GAAc,EACjB,UAAb7d,EAAsB6d,GAAc,EACnCza,MAAM5T,OAAOwQ,KAA0C,KAA5BvY,OAAOuY,GAAUvV,SACpDozB,EAAcruB,OAAOwQ,IAGV,QAAThW,EACF,aA//DR+gB,eAA2B4H,EAAM3S,GAC/B,OAAO,IAAI+G,QAAQC,IACjB,MAAMuJ,EAAYC,WAAW,KAC3B9sB,QAAQG,KAAK,2BACbmjB,GAAQ,IACP,KAGGkJ,EAAYnoB,OAAOmoB,WAAanoB,OAAO0kB,QAAQyD,UAC/CC,EAAUpoB,OAAOooB,SAAWpoB,OAAO0kB,QAAQ0D,QAC3CM,EAAW1oB,OAAO0oB,UAAY1oB,OAAO0kB,QAAQgE,SAE7CqN,EAAcnN,IAClBC,aAAaL,GACW,mBAAbE,GACTA,EAAS,gBAAiBqN,GAE5Bp6B,QAAQC,IAAI,2BACZqjB,GAAQ,IAGV,IAGE,GAFAtjB,QAAQC,IAAI,6BAA8BgvB,EAAM3S,GAEzB,mBAAZmQ,EAIT,OAHAzsB,QAAQ2M,MAAM,+BACdugB,aAAaL,QACbvJ,GAAQ,GAGV,GAAyB,mBAAdkJ,EAIT,OAHAxsB,QAAQ2M,MAAM,iCACdugB,aAAaL,QACbvJ,GAAQ,GAIVmJ,EAAQ,gBAAiB2N,GACzB5N,EAAU,mBAAoB,CAC5ByC,KAAMA,EACN1tB,MAAO+a,GAEX,CAAE,MAAOpc,GACPgtB,aAAaL,GACb7sB,QAAQ2M,MAAM,+BAAgCzM,GAC9CojB,GAAQ,EACV,GAEJ,CA+8DqB+W,CAAYpL,EAAMkL,GAC1B,CACL,MAAMjJ,EAAU7sB,OAAOqoB,IAAIC,WAAW,CAAErf,KAAM,UAAWqgB,WAAY,WACrE,IAAKuD,EAEH,OADAlxB,QAAQ2M,MAAM,gCACP,EAGT,MAAM0P,QAAgBhY,OAAOqoB,IAAI4N,eAAepJ,EAASjC,EAAMkL,EAAa,CAC1EnpB,OAAQ,OACRupB,cAAc,IAShB,OANIle,QACIhY,OAAOqoB,IAAI8N,eAAetJ,EAAS,CAAE5jB,KAAM,UAAWqgB,WAAY,WAExE3tB,QAAQG,KAAK,2CAGRkc,CACT,CACF,CAAE,MAAOnc,GAEP,OADAF,QAAQ2M,MAAM,kCAAmCzM,IAC1C,CACT,CACF,EAEAu6B,YAAa,SAAU55B,GACrB,OAAOA,IAAcurB,CACvB,EAGA7W,WAAY,WACV8W,EAAgB,KAChBrsB,QAAQC,IAAI,6BACd,EAGAqsB,WAAY,WACV,OAAOA,GACT,EAEAsJ,QAAS,SAAUb,GAIjB,GAFA12B,KAAKkX,cAEAwf,IAAeA,EAAWn2B,OAAQ,CACrC,MAAMo2B,EAASvwB,EAAE,kBACjB,IAAKuwB,EAAOp2B,OAAQ,OACpBm2B,EAAaC,CACf,CAEA,MAAM0F,EAAc3F,EAAW5uB,KAAK,oBAChCu0B,EAAY97B,QACd87B,EAAYv0B,KAAK,KAAKsvB,SAAS,WAKjCp3B,KAAK0yB,iBAAiB,GAAI,KACvB4J,KAAKzJ,IAEAwJ,EAAY97B,QACd87B,EAAYv0B,KAAK,KAAKqvB,YAAY,WAIpCT,EAAWiF,KAAK,8BAAgC37B,KAAKi0B,cAAgB,UACrEj0B,KAAKy2B,WAAWC,GAIhB,MAAMmB,OAAS7xB,OAAO0kB,QAAQmN,QAAU7xB,OAAO6xB,OACzC0E,EAAav8B,KAAKovB,UACpByI,SAAW0E,GACb1E,OAAO2E,QAAQ,oCAGlBC,MAAMC,IACL/6B,QAAQ2M,MAAM,yCAA0CouB,GAGpDL,EAAY97B,QACd87B,EAAYv0B,KAAK,KAAKqvB,YAAY,WAIpCT,EAAWiF,KAAK,8BAAgC37B,KAAKi0B,cAAgB,UACrEj0B,KAAKy2B,WAAWC,GAGhB,MAAMmB,OAAS7xB,OAAO0kB,QAAQmN,QAAU7xB,OAAO6xB,OACzC0E,EAAav8B,KAAKovB,UACpByI,SAAW0E,GACb1E,OAAOvpB,MAAM,cAGrB,EAEH,CA50EiB,GA+0EZquB,GAAsB,CAC1BC,eAAgB,EAChBC,eAAgB,EAChBC,oBAAqB,EACrBC,YAAa,GACb1oB,SAAU,YACV2oB,aAAc,QAEdC,eAAgB,GAChBC,YAAa,EAEbC,eAAgB,iBAEhBh0B,wBAAwB,EAExBi0B,sBAAsB,GAGlBp0B,GAAgB,IAAMoM,GAAMnK,IAAIkB,EAAyBwwB,IACzDU,GAAiBC,IACrB,MAAMC,EAASv0B,KACTw0B,EAAS,IAAKD,KAAWD,GAC/BloB,GAAMhK,IAAIe,EAAyBqxB,GAEnC,MAAMC,EAAc75B,OAAOC,KAAKy5B,GAAKjtB,OAAO6f,GAAKqN,EAAOrN,KAAOsN,EAAOtN,IAClEuN,EAAYl9B,OAAS,GACvBoB,QAAQ0M,KAAK,kBAAkBovB,EAAYpzB,KAAK,UAK9CqzB,GAAgC,KACpC,IACE,MAAM30B,EAAUC,KACV20B,OAA+Cl5B,IAAnCsE,EAAQI,wBAAuCJ,EAAQI,uBACnEy0B,OAA4Cn5B,IAAjCsE,EAAQq0B,sBAAqCr0B,EAAQq0B,qBAUtE,IACE,MAAM50B,EAAMpC,EAAE,kBACd,GAAIoC,EAAIjI,OAAQ,CACd,IAAIs9B,EAAcr1B,EAAIN,OAAS,GAC3B41B,EAAeD,EAEnB,GAAIF,EAAW,CAEb,MAAMI,EACJ,+GACIC,EAAc,iEAEhBD,EAAan0B,KAAKk0B,KACpBA,EAAeA,EAAan4B,QAAQo4B,EAAc,cAEhDC,EAAYp0B,KAAKk0B,KACnBA,EAAeA,EAAan4B,QAAQq4B,EAAa,aAErD,KAAO,CAEL,MAAMn0B,EAAerB,EAAI3H,KAAK,0BAC1BgJ,GAAgBg0B,EAAY32B,SAAS,eAEvC42B,EAAeD,EAAYl4B,QAAQ,eAAgBkE,GACnDrB,EAAIgC,WAAW,0BAEnB,CAEIszB,IAAiBD,GACnBr1B,EAAIN,IAAI41B,GAAc10B,QAAQ,SAASA,QAAQ,SAEnD,CACF,CAAE,MAAOvH,GACPF,QAAQG,KAAK,yBAA0BD,EACzC,CAIA,IAAIo8B,EACJ,IACEA,EAAgBC,kBAClB,CAAE,MAAOr8B,GAEP,MACF,CAGA,GAAIo8B,EAAgB,EAClB,OAGF,IACE,MAAME,EAAeC,gBAAgB,KAAKH,IAAiB,CAAEI,KAAM,SAEnE,IAAKF,GAAwC,IAAxBA,EAAa59B,OAChC,OAGF,GAAIq9B,EAAU,CAEZ,IAAIU,EAAc,EAClBH,EAAa38B,QAAQ+8B,IACnB,IACE,MAAMC,EAAcC,yBAAyBF,EAAIjP,YACjD,IAAKkP,IAAgBA,EAAYj+B,OAC/B,OAIF,IAAIm+B,EAAWF,EAAY12B,KAAK,aAC3B42B,GAAaA,EAASn+B,SAEzBm+B,EAAWF,EAAY12B,KAAK,6DAA6DkjB,QACpF0T,GAAaA,EAASn+B,SAEzBm+B,EAAWF,IAKf,MAAMG,EAAiBD,EAASzT,OAEhC,GAAI0T,EAAez3B,SAAS,aAC1B,OAIF,MAAM2C,EAAe00B,EAAI/rB,SAAW,GACpC,IAAK3I,EACH,OAIF,IAAIi0B,EAAej0B,EAInB,MAAMk0B,EACJ,+GACmBA,EAAan0B,KAAKk0B,KAErCA,EAAeA,EAAan4B,QAAQo4B,EAAc,cAIpD,MAAMC,EACJ,iEAQF,GAPoBA,EAAYp0B,KAAKk0B,KAEnCA,EAAeA,EAAan4B,QAAQq4B,EAAa,cAK/CF,IAAiBj0B,GAAgBi0B,IAAiBa,EAAgB,CAEpE,MAAMC,EAAcF,EAAS/C,OAE7B,IAAIkD,EAAeD,EAGnB,MAAME,EACJ,+GACEA,EAAel1B,KAAKg1B,KACtBC,EAAeA,EAAal5B,QAAQm5B,EAAgB,cAItD,MAAMC,EACJ,iEACEA,EAAcn1B,KAAKg1B,KACrBC,EAAeA,EAAal5B,QAAQo5B,EAAe,cAIjDF,IAAiBD,IACnBF,EAAS/C,KAAKkD,GACdP,IAEJ,CACF,CAAE,MAAOz8B,GACPF,QAAQG,KAAK,iBAAiBy8B,EAAIjP,sBAAuBztB,EAC3D,IAEEy8B,EAAc,GAChB38B,QAAQ0M,KAAK,aAAaiwB,aAE9B,KAAO,CAEL,IAAIU,EAAgB,EACpBb,EAAa38B,QAAQ+8B,IACnB,IACE,MAAMC,EAAcC,yBAAyBF,EAAIjP,YACjD,IAAKkP,IAAgBA,EAAYj+B,OAAQ,OAEzC,MAAMm+B,EAAWF,EAAY12B,KAAK,aAClC,IAAK42B,IAAaA,EAASn+B,OAAQ,OAInC,GADoBm+B,EAASzT,OACb/jB,SAAS,aAAc,CAErC,MAAM2C,EAAe00B,EAAI/rB,SAAW,GAChC3I,IACF60B,EAASzT,KAAKphB,GACdm1B,IAEJ,CACF,CAAE,MAAOn9B,GAET,IAEEm9B,EAAgB,GAClBr9B,QAAQ0M,KAAK,aAAa2wB,aAE9B,CACF,CAAE,MAAOn9B,GAGH+7B,GACFj8B,QAAQG,KAAK,0BAA2BD,EAE5C,CACF,CAAE,MAAOA,GAGP,MAAMkH,EAAUC,KACZD,IAAYA,EAAQI,wBAA0BJ,EAAQq0B,uBACxDz7B,QAAQG,KAAK,sBAAuBD,EAExC,GAQIo9B,GAA4B,CAChC,CACEtrB,OAAQ,qBACR8C,QAAS1J,EACTgD,GAAI,OACJqD,KAAM,UACNc,SAAS,EACTD,YAAa,uCACbirB,eAAgB,CACd,CAAE9rB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC3D,CAAEjsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC3D,CAAEjsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC3D,CAAEjsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC3D,CAAEjsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC3D,CAAEjsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC3D,CAAEjsB,KAAM,KAAM+rB,QAAS,WAAYC,MAAO,CAAC,GAAI,IAAKC,SAAU,UAC9D,CAAEjsB,KAAM,KAAM+rB,QAAS,WAAYC,MAAO,CAAC,GAAI,IAAKC,SAAU,WAEhEC,kBAAmB,CAEjB,CAAElsB,KAAM,KAAM+rB,QAAS,UAAWC,MAAO,CAAC,GAAI,KAC9C,CAAEhsB,KAAM,KAAM+rB,QAAS,UAAWC,MAAO,CAAC,GAAI,KAC9C,CAAEhsB,KAAM,MAAO+rB,QAAS,UAAWC,MAAO,CAAC,GAAI,KAE/C,CAAEhsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC5C,CAAEhsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC5C,CAAEhsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC5C,CAAEhsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC5C,CAAEhsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAE5C,CAAEhsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC5C,CAAEhsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC5C,CAAEhsB,KAAM,QAAS+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAC/C,CAAEhsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAE5C,CAAEhsB,KAAM,MAAO+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,KAE7C,CAAEhsB,KAAM,KAAM+rB,QAAS,OAAQC,MAAO,CAAC,EAAG,KAE1C,CAAEhsB,KAAM,OAAQ+rB,QAAS,KAAMC,MAAO,CAAC,EAAG,KAC1C,CAAEhsB,KAAM,QAAS+rB,QAAS,MAAOC,MAAO,CAAC,EAAG,MAGhD,CACEzrB,OAAQ,qBACR8C,QAAS1J,EACTgD,GAAI,QACJqD,KAAM,UACNc,SAAS,EACTD,YAAa,qCACbirB,eAAgB,CACd,CAAE9rB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,IAAKC,SAAU,SAC3D,CAAEjsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,IAAKC,SAAU,SAC3D,CAAEjsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,IAAKC,SAAU,SAC3D,CAAEjsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,IAAKC,SAAU,SAC3D,CAAEjsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,IAAKC,SAAU,SAC3D,CAAEjsB,KAAM,KAAM+rB,QAAS,SAAUC,MAAO,CAAC,EAAG,IAAKC,SAAU,UAE7DC,kBAAmB,CAEjB,CAAElsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,GAAI,KAC5C,CAAEhsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,GAAI,KAE5C,CAAEhsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,EAAG,KAC3C,CAAEhsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,EAAG,KAC3C,CAAEhsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,EAAG,KAC3C,CAAEhsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,EAAG,KAE3C,CAAEhsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,EAAG,KAC3C,CAAEhsB,KAAM,KAAM+rB,QAAS,QAASC,MAAO,CAAC,EAAG,QAM3CG,GAAyB,MAC7B,IAAI3/B,EAAS,KAEb,MAAO,CAEL,aAAAyW,GACE,MAAMrU,EAASoT,GAAMnK,IAAImB,EAA+B,IAExD,IAAImK,GAAY,EAiBhB,OAhBAvU,EAAOR,QAAQgV,IACb,MAAMgpB,EAAgBhpB,EAAOC,SAAW,QACpCzJ,EAAewyB,EAAezyB,GAAyB,IACzDpL,QAAQC,IACN,uCAAuC4U,EAAOpD,eAAeosB,YAAwBzyB,KAEvFyJ,EAAOC,QAAU1J,EACjBwJ,GAAY,KAGZA,IACFnB,GAAMhK,IAAIgB,EAA+BpK,GAEzCpC,EAAS,OAGN2W,GAAa3W,IAGlBA,EAAS,IAAIq/B,MAA8Bj9B,IAFlCpC,CAIX,EAGA,eAAAuX,GACE,MAAME,EAAWjC,GAAMnK,IAAIoB,EAAgC,MAC3D,OAAKgL,GACErX,KAAKqW,gBAAgBvO,KAAKwP,GAAKA,EAAEvH,KAAOsH,IADzB,IAExB,EAGA,eAAAE,CAAgBxH,GACd,IAEE,MAAM0vB,EAAiB,KAAP1vB,QAAoBtL,IAAPsL,EAAmB,KAAOA,EAKvD,OAJAqF,GAAMhK,IAAIiB,EAAgCozB,GAE1C7/B,EAAS,KACT+B,QAAQC,IAAI,qCAAsC69B,IAC3C,CACT,CAAE,MAAO/C,GAEP,OADA/6B,QAAQ2M,MAAM,uCAAwCouB,IAC/C,CACT,CACF,EAGA,YAAAllB,CAAahB,GACX,MAAMxU,EAASoT,GAAMnK,IAAImB,EAA+B,IAClDqL,EAAY,IACbjB,EACHzG,GAAIyG,EAAOzG,IAAM,UAAY5N,KAAKC,MAClC8R,SAAS,EACTuC,QAASD,EAAOC,SAAW1J,EAC3B2K,WAAW,IAAIvV,MAAOwV,eAMxB,OAJA3V,EAAOtB,KAAK+W,GACZrC,GAAMhK,IAAIgB,EAA+BpK,GACzCpC,EAAS,KACT+B,QAAQC,IAAI,qCAAsC6V,EAAUrE,MACrDqE,CACT,EAGA,YAAAioB,CAAa3vB,EAAIyK,GACf,MAAMxY,EAASoT,GAAMnK,IAAImB,EAA+B,IAClDgO,EAAQpY,EAAOqY,UAAU/C,GAAKA,EAAEvH,KAAOA,GAC7C,QAAIqK,EAAQ,KACZpY,EAAOoY,GAAS,IAAKpY,EAAOoY,MAAWI,GACvCpF,GAAMhK,IAAIgB,EAA+BpK,GACzCpC,EAAS,KACT+B,QAAQC,IAAI,qCAAsCmO,IAC3C,EACT,EAGA,YAAA8H,CAAa9H,GACX,MAAM/N,EAASoT,GAAMnK,IAAImB,EAA+B,IAClD0L,EAAW9V,EAAOqO,OAAOiH,GAAKA,EAAEvH,KAAOA,GAC7C,OAAI+H,EAASvX,SAAWyB,EAAOzB,SAC/B6U,GAAMhK,IAAIgB,EAA+B0L,GACzClY,EAAS,KAELwV,GAAMnK,IAAIoB,KAAoC0D,GAChDqF,GAAMhK,IAAIiB,EAAgC,MAE5C1K,QAAQC,IAAI,qCAAsCmO,IAC3C,EACT,EAGA,YAAAiI,CAAajI,GACX,MAAMyG,EAASxW,KAAKqW,gBAAgBvO,KAAKwP,GAAKA,EAAEvH,KAAOA,GACvD,IAAKyG,EAAQ,OAAO,KACpB,MAAMmpB,EAAW,CACfhsB,OAAQ,qBACR8C,QAAS1J,KACNyJ,GAGL,cADOmpB,EAASzrB,QACTpT,KAAKwB,UAAUq9B,EAAU,KAAM,EACxC,EAGA,YAAAlnB,CAAayR,EAAS0V,GAAa,GACjC,IACE,MAAM/+B,EAAOC,KAAKC,MAAMmpB,GAGxB,GAAoB,uBAAhBrpB,EAAK8S,OACP,MAAM,IAAI9D,MAAM,YAIlB,IAAKhP,EAAKuS,OAASvS,EAAKq+B,iBAAmBn6B,MAAMuQ,QAAQzU,EAAKq+B,gBAC5D,MAAM,IAAIrvB,MAAM,WAGlB,MAAM+I,EAAkB/X,EAAK4V,SAAW,QAClCopB,EAAc7yB,EAAe4L,EAAiB7L,GAAyB,EAGvEqgB,EAAW,IACZvsB,EACHkP,GAAI,YAAc5N,KAAKC,MACvB8R,SAAS,EACTuC,QAASmpB,GAAcC,EAAc9yB,EAAwB6L,EAC7DlB,WAAW,IAAIvV,MAAOwV,eAGlB+E,EAAS1c,KAAKwX,aAAa4V,GAMjC,OALI1Q,GAAUmjB,IAAgBD,GAC5Bj+B,QAAQG,KACN,uCAAuC4a,EAAOtJ,eAAewF,YAA0B7L,KAGpF2P,CACT,CAAE,MAAO7a,GAEP,OADAF,QAAQ2M,MAAM,qCAAsCzM,GAC7C,IACT,CACF,EAGA,UAAAqV,GACEtX,EAAS,IACX,EAEH,EA7J8B,GAwLzBkgC,GAAyB,CAC7B,CACEnsB,OAAQ,uBACR8C,QAAS1J,EACTgD,GAAI,sBACJqD,KAAM,SACNc,SAAS,EACTD,YAAa,4CACb2C,MAAO,CACL,CACEmpB,eAAgB,CAAC,KAAM,KAAM,WAAY,MAAO,KAAM,MACtDC,QAAS,CACP,CAAEC,MAAO,KAAMC,SAAU,mBACzB,CAAED,MAAO,KAAMC,SAAU,mBACzB,CAAED,MAAO,KAAMC,SAAU,sBAG7B,CACEH,eAAgB,CAAC,KAAM,MAAO,OAAQ,KAAM,MAC5CC,QAAS,CACP,CAAEC,MAAO,KAAMC,SAAU,oBACzB,CAAED,MAAO,KAAMC,SAAU,mBACzB,CAAED,MAAO,KAAMC,SAAU,sBAG7B,CACEH,eAAgB,CAAC,KAAM,KAAM,MAC7BC,QAAS,CACP,CAAEC,MAAO,KAAMC,SAAU,oBACzB,CAAED,MAAO,KAAMC,SAAU,oBACzB,CAAED,MAAO,KAAMC,SAAU,sBAG7B,CACEH,eAAgB,CAAC,KAAM,KAAM,MAC7BC,QAAS,CACP,CAAEC,MAAO,KAAMC,SAAU,oBACzB,CAAED,MAAO,KAAMC,SAAU,oBACzB,CAAED,MAAO,KAAMC,SAAU,sBAG7B,CACEH,eAAgB,CAAC,KAAM,MACvBC,QAAS,CACP,CAAEC,MAAO,KAAMC,SAAU,mBACzB,CAAED,MAAO,KAAMC,SAAU,qBAG7B,CACEH,eAAgB,CAAC,KAAM,KAAM,MAC7BC,QAAS,CACP,CAAEC,MAAO,KAAMC,SAAU,0BACzB,CAAED,MAAO,KAAMC,SAAU,wBACzB,CAAED,MAAO,KAAMC,SAAU,sBAG7B,CACEH,eAAgB,CAAC,KAAM,KAAM,MAC7BC,QAAS,CACP,CAAEC,MAAO,KAAMC,SAAU,sBACzB,CAAED,MAAO,KAAMC,SAAU,qBACzB,CAAED,MAAO,KAAMC,SAAU,2BAO7BC,GAAsB,MAC1B,IAAIvgC,EAAS,KAEb,MAAO,CAEL,aAAAyW,GACE,GAAIzW,EAAQ,OAAOA,EACnB,MAAMoC,EAASoT,GAAMnK,IAAIqB,EAA4B,IAErD,OADA1M,EAAS,IAAIkgC,MAA2B99B,GACjCpC,CACT,EAGA,aAAAwgC,CAAcrwB,GACZ,OAAO/P,KAAKqW,gBAAgBvO,KAAKwP,GAAKA,EAAEvH,KAAOA,IAAO,IACxD,EAGA,iBAAAswB,GACE,MAAMr+B,EAASoT,GAAMnK,IAAIsB,EAAkC,uBAC3D,OAAkB,OAAXvK,EAAkB,sBAAwBA,CACnD,EAGA,eAAAmV,GACE,MAAME,EAAWrX,KAAKqgC,oBACtB,OAAKhpB,GAAyB,aAAbA,EACVrX,KAAKogC,cAAc/oB,GADuB,IAEnD,EAGA,iBAAAipB,CAAkBvwB,GAChB,IACE,MAAM0vB,EAAiB,KAAP1vB,SAAaA,EAAkC,WAAaA,EAI5E,OAHAqF,GAAMhK,IAAImB,EAAkCkzB,GAC5C7/B,EAAS,KACT+B,QAAQC,IAAI,kCAAmC69B,IACxC,CACT,CAAE,MAAO/C,GAEP,OADA/6B,QAAQ2M,MAAM,oCAAqCouB,IAC5C,CACT,CACF,EAGA,YAAAllB,CAAahB,GACX,MAAMxU,EAASoT,GAAMnK,IAAIqB,EAA4B,IAC/CmL,EAAY,CAChB9D,OAAQ,uBACR8C,QAAS1J,KACNyJ,EACHzG,GAAIyG,EAAOzG,IAAM,UAAY5N,KAAKC,MAClC8R,SAAS,EACTwD,WAAW,IAAIvV,MAAOwV,eAMxB,OAJA3V,EAAOtB,KAAK+W,GACZrC,GAAMhK,IAAIkB,EAA4BtK,GACtCpC,EAAS,KACT+B,QAAQC,IAAI,kCAAmC6V,EAAUrE,MAClDqE,CACT,EAGA,YAAAioB,CAAa3vB,EAAIyK,GACf,MAAMxY,EAASoT,GAAMnK,IAAIqB,EAA4B,IAC/C8N,EAAQpY,EAAOqY,UAAU/C,GAAKA,EAAEvH,KAAOA,GAC7C,QAAIqK,EAAQ,KACZpY,EAAOoY,GAAS,IAAKpY,EAAOoY,MAAWI,EAAS/D,QAAS1J,GACzDqI,GAAMhK,IAAIkB,EAA4BtK,GACtCpC,EAAS,KACT+B,QAAQC,IAAI,kCAAmCmO,IACxC,EACT,EAGA,YAAA8H,CAAa9H,GACX,MAAM/N,EAASoT,GAAMnK,IAAIqB,EAA4B,IAC/CwL,EAAW9V,EAAOqO,OAAOiH,GAAKA,EAAEvH,KAAOA,GAC7C,OAAI+H,EAASvX,SAAWyB,EAAOzB,SAC/B6U,GAAMhK,IAAIkB,EAA4BwL,GACtClY,EAAS,KAELwV,GAAMnK,IAAIsB,KAAsCwD,GAClDqF,GAAMhK,IAAImB,EAAkC,MAE9C5K,QAAQC,IAAI,kCAAmCmO,IACxC,EACT,EAGA,YAAAiI,CAAajI,GACX,MAAMyG,EAASxW,KAAKogC,cAAcrwB,GAClC,IAAKyG,EAAQ,OAAO,KACpB,MAAMmpB,EAAW,CACfhsB,OAAQ,uBACR8C,QAAS1J,KACNyJ,GAIL,cAFOmpB,EAASzrB,eACTyrB,EAASjoB,UACT5W,KAAKwB,UAAUq9B,EAAU,KAAM,EACxC,EAGA,YAAAlnB,CAAayR,GACX,IACE,MAAMrpB,EAAOC,KAAKC,MAAMmpB,GAGxB,GAAoB,yBAAhBrpB,EAAK8S,OACP,MAAM,IAAI9D,MAAM,oCAIlB,IAAKhP,EAAKuS,OAASvS,EAAK+V,QAAU7R,MAAMuQ,QAAQzU,EAAK+V,OACnD,MAAM,IAAI/G,MAAM,8BAIlB,MAAMud,EAAW,IACZvsB,EACHkP,GAAI,YAAc5N,KAAKC,MACvB8R,SAAS,EACTuC,QAAS1J,EACT2K,WAAW,IAAIvV,MAAOwV,eAIxB,OADe3X,KAAKwX,aAAa4V,EAEnC,CAAE,MAAOvrB,GAEP,OADAF,QAAQ2M,MAAM,kCAAmCzM,GAC1C,IACT,CACF,EAGA,UAAAqV,GACEtX,EAAS,IACX,EAEH,EA5I2B,GAmJtB2gC,GAAqB,KACzB,MAAMv+B,EAASoT,GAAMnK,IAAIuB,EAAwB,MACjD,OAAKxK,EACE,IAAKyK,KAA8BzK,GADtB,IAAKyK,IAKrB+zB,GAAsB35B,IAC1BuO,GAAMhK,IAAIoB,EAAwB3F,IAI9B45B,GAAyB,KAC7B,MAAM55B,EAAS05B,KACf,IAAK15B,EAAO6F,QAAS,OAAO,EAG5B,OAD6B,IAAhBiB,KAAKqC,SACJnJ,EAAO8F,YA0BjB+zB,GAAyB,KAC7B,MAAM75B,EAAS05B,KACThf,EAAU+I,IAAiBC,KACjC,IAAKhJ,EAAS,OAAO,KAErB,MAAMof,EAAYC,GAAgBrf,GAAW,CAAC,GACxCsf,EAAeC,GAAoBC,UAAUJ,EAAW,UACxDK,EAAYF,GAAoBC,UAAUJ,EAAW,OAGrDhT,EAAa,GAGnB,GAAIkT,GAAchgC,MAAM8e,MAAMpf,OAAS,EAAG,CACxC,MAAMsrB,EAAaX,MAA0B,KACvC+V,EAAcC,GAA8B,UAClDvT,EAAWjtB,KAAK,CACd0S,KAAMyY,EACNsV,MAAOF,EACPnV,UAAU,EACVsV,SAAS,EACTC,OAAQx6B,EAAO+F,cAEnB,CAGA,GAAIo0B,EAAW,CACKF,GAAoBQ,UAAUN,EAAW,OACjDx/B,QAAQ+/B,IAChB,IAAKA,EAAInuB,KAAM,OACf,MAAMouB,EAAa97B,OAAO67B,EAAIH,SAAW,IAAIK,cACvCC,EAA2B,SAAfF,GAAwC,OAAfA,EACrCG,EAAWT,GAA8BK,EAAInuB,MACnDua,EAAWjtB,KAAK,CACd0S,KAAMmuB,EAAInuB,KACV+tB,MAAOQ,EACP7V,UAAU,EACVsV,QAASM,EACTL,OAAQK,EAAY76B,EAAOgG,iBAAmBhG,EAAOiG,qBAG3D,CAEA,OAA0B,IAAtB6gB,EAAWptB,OAAqB,KAvDTsmB,KAC3B,IAAKA,GAA0B,IAAjBA,EAAMtmB,OAAc,OAAO,KACzC,MAAMqhC,EAAc/a,EAAME,OAAO,CAACC,EAAKvlB,IAASulB,GAAOvlB,EAAK4/B,QAAU,GAAI,GAC1E,IAAIrxB,EAASrC,KAAKqC,SAAW4xB,EAC7B,IAAK,MAAMngC,KAAQolB,EAEjB,GADA7W,GAAUvO,EAAK4/B,QAAU,EACrBrxB,GAAU,EAAG,OAAOvO,EAE1B,OAAOolB,EAAMA,EAAMtmB,OAAS,IAgDrBshC,CAAqBlU,IAIxBmU,GAAuBC,IAC3B,IAAKA,EAAa,MAAO,CAAE3uB,KAAM,KAAMlQ,MAAO,IAG9C,GAAI6+B,EAAYZ,OAASY,EAAYZ,MAAM5gC,OAAS,EAAG,CACrD,MAAMyhC,EAAaD,EAAYZ,MAAMxzB,KAAKs0B,MAAMt0B,KAAKqC,SAAW+xB,EAAYZ,MAAM5gC,SAClF,MAAO,CAAE6S,KAAM4uB,EAAW5uB,KAAMlQ,MAAO8+B,EAAW9+B,MACpD,CAGA,MAAM6Y,EAAewjB,GAAuBpoB,kBAC5C,GAAI4E,EAAc,CAChB,MAAMmmB,EAAiB,IAAKnmB,EAAamjB,gBAAkB,MAASnjB,EAAaujB,mBAAqB,IACtG,GAAI4C,EAAe3hC,OAAS,EAAG,CAC7B,MAAM4hC,EAAmBD,EAAev0B,KAAKs0B,MAAMt0B,KAAKqC,SAAWkyB,EAAe3hC,SAE5E6+B,EAAQ+C,EAAiB/C,OAAS,CAAC,EAAG,KACtCgD,EAAez0B,KAAKs0B,OAAO7C,EAAM,GAAKA,EAAM,IAAM,GACxD,MAAO,CAAEhsB,KAAM+uB,EAAiB/uB,KAAMlQ,MAAOk/B,EAC/C,CACF,CAGA,MAAMC,EAAYC,KAClB,GAAID,GAAaA,EAAU9hC,OAAS,EAAG,CAErC,MAAO,CAAE6S,KADWivB,EAAU10B,KAAKs0B,MAAMt0B,KAAKqC,SAAWqyB,EAAU9hC,SACvC2C,MAAO,GACrC,CAEA,MAAO,CAAEkQ,KAAM,KAAMlQ,MAAO,KAIxBq/B,GAAgB,IAAM50B,KAAKs0B,MAAsB,IAAhBt0B,KAAKqC,UAAkB,EAGxDwyB,GAAuB,CAACC,EAAMp8B,IAC9Bo8B,GAAQ,EAAU,MAClBA,GAAQ,GAAW,MACnBA,GAAQp8B,EAAe,KACpB,KAIHq8B,GAAoB,KAIxB,GAAiB,WAtHS/1B,KAI1B,GAAIA,EAAa,GAAI,MAAO,SAC5B,MAAMg2B,EAAgBh2B,GAAc,GAAK,GAAM,GAC/C,OAAOgB,KAAKqC,SAAW2yB,EAAgB,UAAY,UA8GlCC,CADFrC,KAC6B5zB,YAEjB,CAEzB,MAAMo1B,EAAcrB,KACpB,IAAKqB,EAAa,OAAO,KAEzB,MAAM3J,EAAO0J,GAAqBC,GAC5BU,EAAOF,KACP7lB,EAAS8lB,GAAqBC,EAAMrK,EAAKl1B,OAG/C,MAAO,QAAQ6+B,EAAY3uB,WAAWglB,EAAKhlB,aAAaqvB,OAAUrK,EAAKl1B,UAAUwZ,KACnF,CAAO,CAEL,MAAMmmB,EAAenC,KACrB,IAAKmC,EAAc,OAAO,KAG1B,IAAIC,EAAe,KACnB,IAAK,IAAIziC,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAM0iC,EAAYrC,KAClB,GAAIqC,GAAaA,EAAU3vB,OAASyvB,EAAazvB,KAAM,CACrD0vB,EAAeC,EACf,KACF,CACF,CAGA,IAAKD,EAAc,CACjB,MAAM1K,EAAO0J,GAAqBe,GAC5BJ,EAAOF,KACP7lB,EAAS8lB,GAAqBC,EAAMrK,EAAKl1B,OAC/C,MAAO,QAAQ2/B,EAAazvB,WAAWglB,EAAKhlB,aAAaqvB,OAAUrK,EAAKl1B,UAAUwZ,KACpF,CAEA,MAAMsmB,EAAQlB,GAAqBe,GAC7BI,EAAQnB,GAAqBgB,GAC7BI,EAAQX,KACRY,EAAQZ,KAGRa,EAAUZ,GAAqBU,EAAOF,EAAM9/B,OAC5CmgC,EAAUb,GAAqBW,EAAOF,EAAM//B,OAC5CogC,EAAUN,EAAM9/B,MAAQggC,EACxBK,EAAUN,EAAM//B,MAAQigC,EAE9B,IAAIK,EAUJ,OAREA,EADEF,EAAUC,EACH,GAAGV,EAAazvB,SAChBmwB,EAAUD,EACV,GAAGR,EAAa1vB,SAEhB,KAKT,cAAcyvB,EAAazvB,QAAQ4vB,EAAM5vB,WAAW0vB,EAAa1vB,QAAQ6vB,EAAM7vB,cAC5EyvB,EAAazvB,QAAQ4vB,EAAM5vB,WAAW4vB,EAAM9/B,aAAaggC,SAAaE,MACtEN,EAAa1vB,QAAQ6vB,EAAM7vB,WAAW6vB,EAAM//B,aAAaigC,SAAaE,YAChEG,KAEb,GAYIC,GAAqBC,IACzB,MAEM35B,EAAQ25B,EAAK35B,MAAM,4CACzB,IAAKA,EAAO,OAAO45B,IAEnB,MAAO,CAAEC,EAAUC,EAAUC,GAAY/5B,EACnCkd,EAAQlE,SAAS6gB,EAAU,IAC3BG,EAAQhhB,SAAS8gB,EAAU,IAEjC,IAAIG,EAAQj/B,MAAM8iB,KAAK,CAAEtnB,OAAQ0mB,GAAS,IATzB8c,IAASp2B,KAAKs0B,MAAMt0B,KAAKqC,SAAW+zB,GAAS,EASdE,CAASF,IAGzD,GAAID,EAAU,CACZ,MAAMI,EAAKJ,EAASrC,cACdze,EAAID,SAASmhB,EAAG3iC,MAAM,GAAI,IAChCyiC,EAAM7iC,KAAK,CAACC,EAAGC,IAAMA,EAAID,GAErB8iC,EAAGzjC,WAAW,MAChBujC,EAAQA,EAAMziC,MAAM,EAAGyhB,GAChBkhB,EAAGzjC,WAAW,MACrBujC,EAAQA,EAAMziC,OAAOyhB,GACdkhB,EAAGzjC,WAAW,MACrBujC,EAAQA,EAAMziC,MAAMyhB,GACbkhB,EAAGzjC,WAAW,QAAOujC,EAAQA,EAAMziC,MAAM,GAAIyhB,GACxD,CAEA,OAAOghB,EAAMjd,OAAO,CAAC3lB,EAAGC,IAAMD,EAAIC,EAAG,IASjC8iC,GAAkB,CAAChF,EAASiF,EAAU,CAAC,KAC3C,IAAKjF,EAAS,OAAO,EAErB,IAAIuE,EAAOh+B,OAAOy5B,GAASz2B,OAG3B,MAAM27B,EAAWzgC,OAAOC,KAAKugC,GAASjjC,KAAK,CAACC,EAAGC,IAAMA,EAAEd,OAASa,EAAEb,QAClE,IAAK,MAAM6S,KAAQixB,EAAU,CAC3B,MAAMnhC,EAAQkhC,EAAQhxB,GACD,iBAAVlQ,GAAuBme,MAAMne,KAEtCwgC,EAAOA,EAAKl2B,MAAM4F,GAAM/I,KAAK,IAAInH,MAErC,CASA,GANAwgC,EAAOA,EAAK/9B,QAAQ,sCAAuCoE,IACzD,MAAM2S,EAAS+mB,GAAmB15B,GAClC,OAAOsX,MAAM3E,GAAU,IAAMhX,OAAOgX,MAIjC,oBAAoB9S,KAAK85B,GAE5B,OADA/hC,QAAQG,KAAK,kCAAmCq9B,EAAS,IAAKuE,GACvD,EAIT,IAEE,MAAMhnB,EAAS,IAAI4nB,SAAS,WAAWZ,KAAxB,GACf,OAAO/1B,KAAK42B,MAAM7nB,EACpB,CAAE,MAAO7a,GAEP,OADAF,QAAQ2M,MAAM,gCAAiC6wB,EAAS,IAAKuE,EAAM7hC,GAC5D,CACT,GAUI2iC,GAAyB,CAACrF,EAASC,EAAOgF,KAC9C,IAAIlhC,EAAQihC,GAAgBhF,EAASiF,GAMrC,OAJIhF,GAASr6B,MAAMuQ,QAAQ8pB,IAA2B,IAAjBA,EAAM7+B,SACzC2C,EAAQyK,KAAKC,IAAIwxB,EAAM,GAAIzxB,KAAK8G,IAAI2qB,EAAM,GAAIl8B,KAGzCA,GAMHuhC,GAAyB,CAC7B7nB,OAAQ,CACN8nB,cAAe,CAAC,QAAS,OAAQ,MACjChjB,QAAS,CACPijB,eAAgB,CAAEC,SAAU,CAAC,SAAU,OAAQ,OAAQ,QAASC,cAAe,MAC/EC,gBAAiB,CAAEF,SAAU,CAAC,SAAU,SAAU,OAAQ,QAASC,cAAe,KAGtFE,OAAQ,CAENL,cAAe,CAAC,OAAQ,KAAM,KAAM,OAAQ,SAAU,KAAM,OAAQ,UACpEhjB,QAAS,CACPtO,KAAM,CAAEwxB,SAAU,CAAC,KAAM,KAAM,OAAQ,QAASC,cAAe,GAC/DG,OAAQ,CAAEJ,SAAU,CAAC,QAAS,QAAS,OAAQ,MAAOC,cAAe,MACrEI,SAAU,CAAEL,SAAU,CAAC,OAAQ,KAAM,OAAQC,cAAe,MAC5D1D,MAAO,CAAEyD,SAAU,CAAC,OAAQ,MAAOC,cAAe,KAAMK,YAAY,GAEpEC,MAAO,CACLP,SAAU,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,OAC3DC,cAAe,MAEjBO,UAAW,CAAER,SAAU,CAAC,OAAQ,KAAM,aAAcC,cAAe,QAGvEQ,SAAU,CAERX,cAAe,CACb,QACA,MACA,KACA,KACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MAEFhjB,QAAS,CACPtO,KAAM,CACJwxB,SAAU,CAAC,OAAQ,OAAQ,OAAQ,OAAQ,OAAQ,KAAM,MAAO,MAChEC,cAAe,GAEjB5wB,YAAa,CAAE2wB,SAAU,CAAC,OAAQ,KAAM,KAAM,KAAM,QAASC,cAAe,QAGhFtD,IAAK,CAEHmD,cAAe,CACb,QACA,OACA,MACA,MACA,KACA,MACA,KACA,YACA,KACA,KACA,KACA,KACA,KACA,MAEFhjB,QAAS,CACPtO,KAAM,CAAEwxB,SAAU,CAAC,KAAM,MAAOC,cAAe,GAC/CG,OAAQ,CAAEJ,SAAU,CAAC,OAAQ,MAAOC,cAAe,MACnDI,SAAU,CAAEL,SAAU,CAAC,OAAQ,KAAM,OAAQ,MAAOC,cAAe,MACnEzD,QAAS,CAAEwD,SAAU,CAAC,OAAQ,KAAM,OAAQ,MAAOC,cAAe,QAGtES,MAAO,CAELZ,cAAe,CAAC,MAAO,OAAQ,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACzEhjB,QAAS,CACPtO,KAAM,CAAEwxB,SAAU,CAAC,OAAQ,MAAO,MAAOC,cAAe,GACxD51B,KAAM,CAAE21B,SAAU,CAAC,KAAM,KAAM,QAASC,cAAe,GACvDU,SAAU,CAAEX,SAAU,CAAC,KAAM,MAAO,SAAUC,cAAe,GAC7DG,OAAQ,CAAEJ,SAAU,CAAC,MAAOC,cAAe,IAE7Cz2B,QAAS,CACPo3B,OAAQ,CAAEC,OAAQ,SAAUv+B,SAAU,CAAC,KAAM,MAAO,MAAOw+B,cAAe,OAAQC,SAAU,CAAC,SAGjGC,IAAK,CAEHlB,cAAe,CAAC,OAAQ,KAAM,KAAM,KAAM,KAAM,MAAO,OAAQ,SAC/DhjB,QAAS,CACPtO,KAAM,CAAEwxB,SAAU,CAAC,OAAQ,KAAM,OAAQC,cAAe,GACxD51B,KAAM,CAAE21B,SAAU,CAAC,KAAM,KAAM,QAASC,cAAe,GACvD5d,MAAO,CAAE2d,SAAU,CAAC,KAAM,KAAM,OAAQC,cAAe,KAG3DgB,MAAO,CAELnB,cAAe,CACb,OACA,MACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,MAEFhjB,QAAS,CACPtO,KAAM,CAAEwxB,SAAU,CAAC,OAAQ,KAAM,OAAQC,cAAe,GACxD51B,KAAM,CAAE21B,SAAU,CAAC,KAAM,MAAOC,cAAe,GAC/CzP,MAAO,CAAEwP,SAAU,CAAC,KAAM,KAAM,MAAO,MAAOC,cAAe,KAGjEiB,MAAO,CAELpB,cAAe,CAAC,MAAO,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACvEhjB,QAAS,CACPtO,KAAM,CAAEwxB,SAAU,CAAC,OAAQ,KAAM,OAAQC,cAAe,GACxD51B,KAAM,CAAE21B,SAAU,CAAC,KAAM,MAAOC,cAAe,GAC/C9T,KAAM,CAAE6T,SAAU,CAAC,KAAM,OAAQ,MAAOC,cAAe,GACvDkB,WAAY,CAAEnB,SAAU,CAAC,KAAM,OAAQ,OAAQ,OAAQC,cAAe,IAExEz2B,QAAS,CACP43B,SAAU,CAAEP,OAAQ,aAAcv+B,SAAU,CAAC,MAAO,MAAO,OAAQ,IAAK,MAAO,gBAM/E45B,GAAsB,CAE1B,SAAAC,CAAUJ,EAAWsF,GACnB,MAAMp/B,EAAS49B,GAAuBwB,GACtC,IAAKp/B,EAEH,OADAlF,QAAQ0M,KAAK,qBAAqB43B,WAC3B,KAGT,IAAK,MAAMC,KAAWr/B,EAAO69B,cAC3B,IAAK,MAAMliC,KAAam+B,EACtB,GAAIn+B,EAAU0E,SAASg/B,GAErB,OADAvkC,QAAQ0M,KAAK,qBAAqB43B,UAAkBzjC,aAAqB0jC,OAClE,CACLrlC,KAAM8/B,EAAUn+B,GAChB4Q,KAAM5Q,EACNhC,IAAKmgC,EAAUn+B,GAAWhC,IAC1BqG,OAAQA,GAQhB,OAHAlF,QAAQ0M,KACN,qBAAqB43B,mBAA2Bp/B,EAAO69B,cAAcr6B,KAAK,UAErE,IACT,EAGA,eAAA87B,CAAgBzjC,EAAS0jC,EAAWC,GAClC,MAAMC,EAAYD,EAAa3kB,QAAQ0kB,GACvC,IAAKE,EAAW,OAAQ,EAGxB,IAAK,IAAIjmC,EAAI,EAAGA,EAAIqC,EAAQnC,OAAQF,IAAK,CACvC,MAAMoD,EAAIiC,OAAOhD,EAAQrC,IAAM,IAAIohC,cACnC,GAAI6E,EAAU1B,SAAS3uB,KAAKswB,GAAM9iC,EAAEyD,SAASq/B,EAAG9E,gBAC9C,OAAOphC,CAEX,CAGA,OAAOimC,EAAUzB,gBAAkB,CACrC,EAGA,QAAA2B,CAAS/jC,EAAKC,EAAS0jC,EAAWC,GAChC,MAAMxjC,EAAM7C,KAAKmmC,gBAAgBzjC,EAAS0jC,EAAWC,GACrD,OAAIxjC,EAAM,GAAKA,GAAOJ,EAAIlC,OAAe,KAClCkC,EAAII,EACb,EAGA,YAAA4jC,CAAa/jC,EAASujC,GACpB,MAAMp/B,EAAS49B,GAAuBwB,GACtC,IAAKp/B,EAAQ,MAAO,CAAC,EAErB,MAAMjG,EAAM,CAAC,EACb,IAAK,MAAM8lC,KAAU7/B,EAAO6a,QAC1B9gB,EAAI8lC,GAAU1mC,KAAKmmC,gBAAgBzjC,EAASgkC,EAAQ7/B,GAEtD,OAAOjG,CACT,EAGA,SAAA0gC,CAAUqF,EAAaV,GACrB,IAAKU,IAAgBA,EAAY9lC,KAE/B,OADAc,QAAQ0M,KAAK,qBAAqB43B,cAC3B,GAGT,MAAM,KAAEplC,EAAI,OAAEgG,GAAW8/B,EACnBjkC,EAAU7B,EAAK6B,SAAW,GAC1Bid,EAAO9e,EAAK8e,MAAQ,GACpBinB,EAAS5mC,KAAKymC,aAAa/jC,EAASujC,GAEpCY,EAASlnB,EAAK/e,IAAI,CAAC6B,EAAKI,KAC5B,MAAM8xB,EAAM,CAAEmS,UAAWjkC,EAAKkkC,KAAMtkC,GACpC,IAAK,MAAMikC,KAAUE,EAAQ,CAC3B,MAAM9hC,EAAS8hC,EAAOF,GACtB/R,EAAI+R,GAAU5hC,GAAU,GAAKA,EAASrC,EAAIlC,OAASkC,EAAIqC,GAAU,IACnE,CACA,OAAO6vB,IAIT,OADAhzB,QAAQ0M,KAAK,qBAAqB43B,WAAmBY,EAAOtmC,WACrDsmC,CACT,EAGA,WAAAG,CAAYC,EAAYC,EAAWjB,GACjC,MAAMp/B,EAAS49B,GAAuBwB,GACtC,IAAKp/B,IAAWA,EAAOuH,UAAYvH,EAAOuH,QAAQ84B,GAAY,OAAOD,EAErE,MAAM52B,EAASxJ,EAAOuH,QAAQ84B,GAI9B,OADwBD,EAAWhxB,KAAKxT,GAA8B,OAAvBA,EAAI4N,EAAOo1B,cAA2ChhC,IAAvBhC,EAAI4N,EAAOo1B,SAMlFwB,EAAW52B,OAAO5N,IACvB,MAAMS,EAAQwC,OAAOjD,EAAI4N,EAAOo1B,SAAW,IAAIhE,cACzC0F,EAAe92B,EAAOnJ,SAAS+O,KAAKmxB,GAAOlkC,EAAMgE,SAASkgC,EAAI3F,gBAEpE,GAAIpxB,EAAOq1B,eAAiBr1B,EAAOs1B,SAAU,CAC3C,MAAM0B,EAAe3hC,OAAOjD,EAAI4N,EAAOq1B,gBAAkB,IAAIjE,cACvD6F,EAAej3B,EAAOs1B,SAAS1vB,KAAKsxB,GAAOF,EAAangC,SAASqgC,EAAI9F,gBAC3E,OAAO0F,IAAiBG,CAC1B,CAEA,OAAOH,IAbAF,CAeX,GAGIO,GAAoB,CACxB96B,SAAS,EACT+6B,WAAY,QACZC,cAAc,EACdC,gBAAgB,EAChBC,cAAe,CACb,CACE7H,eAAgB,CAAC,KAAM,KAAM,WAAY,MAAO,KAAM,MACtDC,QAAS,CACP,CAAEC,MAAO,KAAM3sB,KAAM,aAAcrE,KAAM,SAAUixB,SAAU,kBAAmB2H,WAAW,GAC3F,CAAE5H,MAAO,KAAM3sB,KAAM,YAAarE,KAAM,SAAUixB,SAAU,kBAAmB2H,WAAW,GAC1F,CAAE5H,MAAO,KAAM3sB,KAAM,WAAYrE,KAAM,SAAUixB,SAAU,mBAAoB2H,WAAW,KAG9F,CACE9H,eAAgB,CAAC,KAAM,MAAO,OAAQ,KAAM,MAC5CC,QAAS,CACP,CAAEC,MAAO,KAAM3sB,KAAM,cAAerE,KAAM,SAAUixB,SAAU,mBAAoB2H,WAAW,GAC7F,CAAE5H,MAAO,KAAM3sB,KAAM,SAAUrE,KAAM,SAAUixB,SAAU,kBAAmB2H,WAAW,GACvF,CAAE5H,MAAO,KAAM3sB,KAAM,eAAgBrE,KAAM,SAAUixB,SAAU,mBAAoB2H,WAAW,KAGlG,CACE9H,eAAgB,CAAC,KAAM,KAAM,MAC7BC,QAAS,CACP,CAAEC,MAAO,KAAM3sB,KAAM,kBAAmBrE,KAAM,SAAUixB,SAAU,mBAAoB2H,WAAW,GACjG,CAAE5H,MAAO,KAAM3sB,KAAM,SAAUrE,KAAM,SAAUixB,SAAU,mBAAoB2H,WAAW,GACxF,CAAE5H,MAAO,KAAM3sB,KAAM,WAAYrE,KAAM,SAAUixB,SAAU,mBAAoB2H,WAAW,KAG9F,CACE9H,eAAgB,CAAC,KAAM,KAAM,MAC7BC,QAAS,CACP,CACEC,MAAO,KACP3sB,KAAM,mBACNrE,KAAM,SACNixB,SAAU,mBACV2H,WAAW,GAEb,CAAE5H,MAAO,KAAM3sB,KAAM,kBAAmBrE,KAAM,SAAUixB,SAAU,mBAAoB2H,WAAW,GACjG,CAAE5H,MAAO,KAAM3sB,KAAM,WAAYrE,KAAM,SAAUixB,SAAU,mBAAoB2H,WAAW,KAG9F,CACE9H,eAAgB,CAAC,KAAM,MACvBC,QAAS,CACP,CACEC,MAAO,KACP3sB,KAAM,yBACNrE,KAAM,cACNixB,SAAU,kBACV2H,WAAW,GAEb,CAAE5H,MAAO,KAAM3sB,KAAM,cAAerE,KAAM,SAAUixB,SAAU,kBAAmB2H,WAAW,KAGhG,CACE9H,eAAgB,CAAC,KAAM,KAAM,MAC7BC,QAAS,CACP,CACEC,MAAO,KACP3sB,KAAM,gBACNrE,KAAM,SACNixB,SAAU,yBACV2H,WAAW,GAEb,CACE5H,MAAO,KACP3sB,KAAM,gBACNrE,KAAM,SACNixB,SAAU,uBACV2H,WAAW,GAEb,CAAE5H,MAAO,KAAM3sB,KAAM,kBAAmBrE,KAAM,SAAUixB,SAAU,mBAAoB2H,WAAW,KAGrG,CACE9H,eAAgB,CAAC,KAAM,KAAM,MAC7BC,QAAS,CACP,CACEC,MAAO,KACP3sB,KAAM,gBACNrE,KAAM,SACNixB,SAAU,qBACV2H,WAAW,GAEb,CAAE5H,MAAO,KAAM3sB,KAAM,eAAgBrE,KAAM,SAAUixB,SAAU,oBAAqB2H,WAAW,GAC/F,CACE5H,MAAO,KACP3sB,KAAM,eACNrE,KAAM,SACNixB,SAAU,qBACV2H,WAAW,OAOfC,GAAe,CACnBC,MAAO,CACLC,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,0BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,2BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,2BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,kBACTC,YAAa,mBACbC,WAAY,OACZC,OAAQ,wBAERC,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACbzU,mBAAoB,QAEtB0U,KAAM,CACJnC,QAAS,yBACTC,OAAQ,OACRvS,SAAU,OACVwS,QAAS,OACTC,MAAO,wBACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,yBACXC,YAAa,UACbC,UAAW,0BACXC,QAAS,yBACTC,UAAW,OACXC,gBAAiB,OACjBC,YAAa,UACbC,cAAe,OAEfC,YAAa,UACbC,UAAW,2BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,yBACfC,mBAAoB,UACpBC,iBAAkB,0BAElBC,UAAW,mBACXC,eAAgB,mBAChBC,SAAU,kBACVC,QAAS,yBACTC,YAAa,yBACbC,WAAY,OACZC,OAAQ,wBAERC,UAAW,UACXC,QAAS,2BACTC,YAAa,2BACbC,YAAa,UACbzU,mBAAoB,QAEtB2U,OAAQ,CACNpC,QAAS,UACTC,OAAQ,UACRvS,SAAU,OACVwS,QAAS,OACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,0BACXC,QAAS,OACTC,UAAW,OACXC,gBAAiB,OACjBC,YAAa,UACbC,cAAe,OAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,2BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,kBACTC,YAAa,mBACbC,WAAY,OACZC,OAAQ,wBAERC,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACbzU,mBAAoB,QAEtB4U,OAAQ,CACNrC,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,yBACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,OAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,0BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,kBACTC,YAAa,mBACbC,WAAY,OACZC,OAAQ,wBAERC,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACbzU,mBAAoB,QAEtB6U,MAAO,CACLtC,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,0BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,OAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,0BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,kBACTC,YAAa,mBACbC,WAAY,OACZC,OAAQ,wBAERC,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACbzU,mBAAoB,QAEtB8U,MAAO,CACLvC,QAAS,UACTC,OAAQ,YACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,yBACPC,SAAU,yBACVC,OAAQ,UACRC,UAAW,0BACXC,YAAa,OACbC,UAAW,wBACXC,QAAS,qBACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,OAEfC,YAAa,UACbC,UAAW,yBACXC,YAAa,UACbC,UAAW,yBACXC,gBAAiB,UACjBC,cAAe,yBACfC,gBAAiB,UACjBC,cAAe,uBACfC,mBAAoB,UACpBC,iBAAkB,yBAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,sBACVC,QAAS,uBACTC,YAAa,uBACbC,WAAY,OACZC,OAAQ,sBAERU,SAAU,yBACVC,eAAgB,yBAChBC,eAAgB,yBAChBC,qBAAsB,yBAEtBZ,UAAW,UACXC,QAAS,yBACTC,YAAa,yBACbC,YAAa,UACbzU,mBAAoB,QAEtBmV,SAAU,CACR5C,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,4BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,2BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,yBACfC,mBAAoB,UACpBC,iBAAkB,2BAElBC,UAAW,mBACXC,eAAgB,mBAChBC,SAAU,kBACVC,QAAS,yBACTC,YAAa,yBACbC,WAAY,OACZC,OAAQ,wBAERU,SAAU,2BACVC,eAAgB,2BAChBC,eAAgB,2BAChBC,qBAAsB,2BAEtBZ,UAAW,UACXC,QAAS,2BACTC,YAAa,2BACbC,YAAa,UACbzU,mBAAoB,QAEtBoV,OAAQ,CACN7C,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,4BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,4BACXC,YAAa,UACbC,UAAW,4BACXC,gBAAiB,UACjBC,cAAe,4BACfC,gBAAiB,UACjBC,cAAe,4BACfC,mBAAoB,UACpBC,iBAAkB,4BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,yBACVC,QAAS,4BACTC,YAAa,4BACbC,WAAY,UACZC,OAAQ,4BAERU,SAAU,2BACVC,eAAgB,2BAChBC,eAAgB,2BAChBC,qBAAsB,2BAEtBZ,UAAW,UACXC,QAAS,4BACTC,YAAa,2BACbC,YAAa,UACbzU,mBAAoB,QAEtBqV,SAAU,CACR9C,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,2BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,2BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,yBACfC,mBAAoB,UACpBC,iBAAkB,2BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,2BACTC,YAAa,4BACbC,WAAY,UACZC,OAAQ,2BAERU,SAAU,2BACVC,eAAgB,2BAChBC,eAAgB,2BAChBC,qBAAsB,2BAEtBZ,UAAW,UACXC,QAAS,2BACTC,YAAa,2BACbC,YAAa,UACbzU,mBAAoB,QAEtBsV,OAAQ,CACN/C,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,2BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,OAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,2BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,0BACTC,YAAa,2BACbC,WAAY,OACZC,OAAQ,0BAERU,SAAU,0BACVC,eAAgB,0BAChBC,eAAgB,0BAChBC,qBAAsB,0BAEtBZ,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACbzU,mBAAoB,QAEtBuV,OAAQ,CACNhD,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,yBACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,yBACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,yBAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,yBACTC,YAAa,yBACbC,WAAY,UACZC,OAAQ,yBAERU,SAAU,wBACVC,eAAgB,yBAChBC,eAAgB,wBAChBC,qBAAsB,wBAEtBZ,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACbzU,mBAAoB,QAEtBwV,YAAa,CACXjD,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,0BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,2BACXC,YAAa,UACbC,UAAW,yBACXC,gBAAiB,UACjBC,cAAe,yBACfC,gBAAiB,UACjBC,cAAe,yBACfC,mBAAoB,UACpBC,iBAAkB,0BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,kBACVC,QAAS,yBACTC,YAAa,0BACbC,WAAY,UACZC,OAAQ,2BAERU,SAAU,yBACVC,eAAgB,0BAChBC,eAAgB,yBAChBC,qBAAsB,yBAEtBZ,UAAW,UACXC,QAAS,2BACTC,YAAa,2BACbC,YAAa,UACbzU,mBAAoB,WAEtByV,QAAS,CACPlD,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,4BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,4BACXC,YAAa,UACbC,UAAW,4BACXC,gBAAiB,UACjBC,cAAe,2BACfC,gBAAiB,UACjBC,cAAe,2BACfC,mBAAoB,UACpBC,iBAAkB,2BAElBC,UAAW,kBACXC,eAAgB,kBAChBC,SAAU,4BACVC,QAAS,4BACTC,YAAa,4BACbC,WAAY,UACZC,OAAQ,2BAERU,SAAU,2BACVC,eAAgB,4BAChBC,eAAgB,2BAChBC,qBAAsB,2BAEtBZ,UAAW,UACXC,QAAS,4BACTC,YAAa,2BACbC,YAAa,UACbzU,mBAAoB,WAEtB0V,UAAW,CACTnD,QAAS,UACTC,OAAQ,yBACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,yBACPC,SAAU,yBACVC,OAAQ,UACRC,UAAW,yBACXC,YAAa,UACbC,UAAW,0BACXC,QAAS,yBACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,yBACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,yBACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,yBAElBC,UAAW,0BACXC,eAAgB,0BAChBC,SAAU,yBACVC,QAAS,0BACTC,YAAa,0BACbC,WAAY,UACZC,OAAQ,yBAERU,SAAU,yBACVC,eAAgB,yBAChBC,eAAgB,yBAChBC,qBAAsB,yBAEtBZ,UAAW,UACXC,QAAS,yBACTC,YAAa,yBACbC,YAAa,UACbzU,mBAAoB,WAEtB2V,iBAAkB,CAChBpD,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,uBACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,uBACXC,YAAa,UACbC,UAAW,wBACXC,gBAAiB,UACjBC,cAAe,uBACfC,gBAAiB,UACjBC,cAAe,wBACfC,mBAAoB,UACpBC,iBAAkB,uBAElBC,UAAW,qBACXC,eAAgB,qBAChBC,SAAU,qBACVC,QAAS,yBACTC,YAAa,0BACbC,WAAY,UACZC,OAAQ,yBAERU,SAAU,UACVC,eAAgB,UAChBC,eAAgB,uBAChBC,qBAAsB,UAEtBZ,UAAW,UACXC,QAAS,uBACTC,YAAa,uBACbC,YAAa,UACbzU,mBAAoB,WAEtB4V,SAAU,CACRrD,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,wBACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UACfC,YAAa,UACbC,UAAW,wBACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,0BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,uBAClBC,UAAW,qBACXC,eAAgB,qBAChBC,SAAU,qBACVC,QAAS,wBACTC,YAAa,wBACbC,WAAY,UACZC,OAAQ,wBACRC,UAAW,UACXC,QAAS,wBACTC,YAAa,uBACbC,YAAa,UACbzU,mBAAoB,WAEtB6V,UAAW,CAETtD,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,OAAQ,UACRC,UAAW,UACXC,YAAa,UACbC,UAAW,2BACXC,QAAS,UACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,0BACXC,YAAa,UACbC,UAAW,2BACXC,gBAAiB,UACjBC,cAAe,0BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,wBAElBC,UAAW,4BACXC,eAAgB,2BAChBC,SAAU,0BACVC,QAAS,4BACTC,YAAa,4BACbC,WAAY,UACZC,OAAQ,0BAERU,SAAU,2BACVC,eAAgB,2BAChBC,eAAgB,2BAChBC,qBAAsB,4BAEtBZ,UAAW,UACXC,QAAS,0BACTC,YAAa,yBACbC,YAAa,UACbzU,mBAAoB,WAItB8V,QAAS,CACPvD,QAAS,UACTC,OAAQ,UACRvS,SAAU,UACVwS,QAAS,UACTC,MAAO,4BACPC,SAAU,2BACVC,OAAQ,UACRC,UAAW,yBACXC,YAAa,UACbC,UAAW,2BACXC,QAAS,wBACTC,UAAW,UACXC,gBAAiB,UACjBC,YAAa,UACbC,cAAe,UAEfC,YAAa,UACbC,UAAW,4BACXC,YAAa,UACbC,UAAW,0BACXC,gBAAiB,UACjBC,cAAe,0BACfC,gBAAiB,UACjBC,cAAe,0BACfC,mBAAoB,UACpBC,iBAAkB,yBAElBC,UAAW,yBACXC,eAAgB,yBAChBC,SAAU,2BACVC,QAAS,4BACTC,YAAa,4BACbC,WAAY,UACZC,OAAQ,4BAERU,SAAU,2BACVC,eAAgB,2BAChBC,eAAgB,2BAChBC,qBAAsB,4BAEtBZ,UAAW,UACXC,QAAS,2BACTC,YAAa,2BACbC,YAAa,UACbzU,mBAAoB,YAGlB7uB,GAAiB,KACrB,MAAMY,EAAQsgC,GAAahhC,KAAYU,QAAUsgC,GAAoB,MASrE,GAPKtgC,EAAMgjC,WACThjC,EAAMgjC,SAAWhjC,EAAM6gC,OACvB7gC,EAAMijC,eAAiBjjC,EAAM6gC,OAC7B7gC,EAAMkjC,eAAiBljC,EAAM2gC,MAC7B3gC,EAAMmjC,qBAAuBnjC,EAAM6gC,SAGhC7gC,EAAMiuB,mBAAoB,CAG7B,MAAM+V,EACJhkC,EAAMwgC,UACLxgC,EAAMwgC,QAAQvnC,WAAW,OACxB+G,EAAMwgC,QAAQvnC,WAAW,OACzB+G,EAAMwgC,QAAQvnC,WAAW,OACzB+G,EAAMwgC,QAAQvnC,WAAW,OACzB+G,EAAMwgC,QAAQ9gC,SAAS,QACvBM,EAAMwgC,QAAQ9gC,SAAS,QAC3BM,EAAMiuB,mBAAqB+V,EAAehkC,EAAMkuB,UAAY,OAAS,MACvE,CACA,OAAOluB,GAuCHikC,GAAsB,CAACC,EAAYC,KAEvC,MAAMC,EAAS,CACbC,YAAa,CACXC,GAAIH,EAAEzC,gBACNje,KAAM,QAER8gB,eAAgB,CACdD,GAAIH,EAAErC,mBACNre,KAAM,QAERjN,QAAS,CACP8tB,GAAIH,EAAEpD,YACNtd,KAAM,QAERuR,QAAS,CACPsP,GAAIH,EAAE3C,YACN/d,KAAM,QAER+gB,QAAS,CACPF,GAAIH,EAAE7C,YACN7d,KAAM,QAERghB,YAAa,CACXH,GAAIH,EAAEvC,gBACNne,KAAM,SAGJtjB,EAAQikC,EAAOF,IAAeE,EAAOI,QAC3C,MAAO,CACL,mBAAoBrkC,EAAMmkC,GAC1B7T,MAAOtwB,EAAMsjB,KACbihB,QAAS,UACT,gBAAiB,MACjB,YAAa,OACb,cAAe,OACf,cAAe,SACfl9B,QAAS,cACT,cAAe,WAKbm9B,GAA0C,CAE9C,GAAI,eACJ,GAAI,eACJ,GAAI,YACJ,GAAI,oBAEJ,GAAI,cACJ,GAAI,cACJ,GAAI,UACJ,GAAI,WACJ,GAAI,oBACJ,GAAI,UACJ,GAAI,UAEJ,GAAI,SACJ,GAAI,SACJ,GAAI,sBAEJ,GAAI,kBACJ,GAAI,WACJ,GAAI,mBACJ,GAAI,kBACJ,GAAI,WACJ,GAAI,mBAEJ,GAAI,aACJ,GAAI,YACJ,GAAI,WACJ,GAAI,eAEJ,GAAI,cACJ,GAAI,yBACJ,GAAI,UAEJ,GAAI,gBACJ,GAAI,gBACJ,GAAI,kBACJ,GAAI,WAEJ,GAAI,gBACJ,GAAI,eACJ,GAAI,eAEJ,GAAI,WACJ,GAAI,YACJ,GAAI,iBAaAC,GAAsB5pC,IAC1B,MAAMqE,EA5IY,MAClB,MAAMwlC,EAAaj3B,GAAMnK,IAzkRG,0BAykRwBu8B,IAIpD,GAAuB,aADArH,GAAoBE,oBAEzC,MAAO,IACFgM,EACHC,uBAAuB,GAK3B,MAAMvwB,EAAeokB,GAAoBhpB,kBACzC,GAAI4E,GAAgBA,EAAanF,OAASmF,EAAanF,MAAMrW,OAAS,EAAG,CAEvE,MAAMgsC,EAAqBxwB,EAAanF,MAAMhW,IAAIoW,IAAQ,CACxD+oB,eAAgB/oB,EAAK+oB,gBAAkB,GACvCC,SAAUhpB,EAAKgpB,SAAW,IAAIp/B,IAAI4rC,IAAU,CAC1CvM,MAAOuM,EAAOvM,MACd3sB,KAAMk5B,EAAOl5B,MAAQ64B,GAAgBK,EAAOvM,QAAU,YACtDhxB,KAAM,SACNixB,SAAUsM,EAAOtM,UAAY,qBAAqBsM,EAAOvM,SACzD4H,WAAW,QAIf,MAAO,IACFwE,EACHI,qBAAsBF,EAE1B,CAEA,OAAOF,GA2GQK,GACf,IAAK7lC,EAAO6F,QAAS,MAAO,GAG5B,GAAK7F,EAAeylC,sBAAuB,MAAO,GAElD,MAAMK,EAAYnqC,EAAUi/B,cAGtB9qB,EAAe9P,EAAe4lC,sBAAwB,GAC5D,IAAK,MAAMG,KAASj2B,EAAa,CAE/B,GADgBi2B,EAAM7M,eAAe9pB,KAAMiwB,GAAoByG,EAAUzlC,SAASg/B,EAAQzE,gBAC7E,MAAO,IAAKmL,EAAM5M,SAAW,GAC5C,CAGA,MAAM6M,EAAehmC,EAAO+gC,eAAiB,GAC7C,IAAK,MAAMgF,KAASC,EAAc,CAEhC,GADgBD,EAAM7M,eAAe9pB,KAAMiwB,GAAoByG,EAAUzlC,SAASg/B,EAAQzE,gBAC7E,MAAO,IAAKmL,EAAM5M,SAAW,GAC5C,CAEA,MAAO,IAYH8M,GAA2B,CAACtqC,EAAmBE,EAAgBa,KAEnE,MAAMwpC,EAAiB,IAAIX,GAAmB5pC,IAGxCwqC,EAAiBtqC,EAAQ2X,UAAU5W,GAAKA,GAAKiC,OAAOjC,GAAGyD,SAAS,OACtE,GAAI8lC,EAAiB,IAAMzpC,EAAQypC,GACjC,OAAOD,EAIT,MAAME,EAAgB,CAAC,IAAK,OAAQ,OAAQ,IAAK,IAAK,MAAO,YAAa,KACpEC,EAAYxnC,OAAOnC,EAAQypC,IAAiBtkC,OAClD,IAAKwkC,GAAaD,EAAc/lC,SAASgmC,EAAUzL,eACjD,OAAOsL,EAIT,MAAMI,EAAkBD,EACrB1/B,MAAM,WACN5M,IAAI6E,GAAKA,EAAEiD,QACX2H,OAAO5K,GAAKA,IAAMwnC,EAAc/lC,SAASzB,EAAEg8B,gBAE9C,GAA+B,IAA3B0L,EAAgB5sC,OAClB,OAAOwsC,EAIT,MAAMK,EAAiBL,EAAensC,IAAIQ,GAAKA,EAAE6+B,MAAMwB,eAGjD4L,EAAaF,EAChB98B,OAAOi9B,IAAQF,EAAelmC,SAASomC,EAAI7L,gBAC3C7gC,IAAI0sC,IAAO,CACVrN,MAAOqN,EACPh6B,KAAM64B,GAAgBmB,IAAQ,kBAC9Br+B,KAAM,SACNixB,SAAU,qBAAqBoN,KAC/BzF,WAAW,KAIf,MAAO,IAAIkF,KAAmBM,IAG1B/b,GAAgBpuB,IACpB,GAAIA,SAAmD,KAAVA,EAAc,OAAO,EAClE,MAAMktB,EAAM1qB,OAAOxC,GAAOwF,OAE1B,MACE,oBAAoBkB,KAAKwmB,IACzB,aAAaxmB,KAAKwmB,IAClB,uCAAuCxmB,KAAKwmB,IAC5C,MAAMxmB,KAAKwmB,IAITmd,GAAsBrqC,IAC1B,IAAKA,EAAO,OAAO,EACnB,MAAMktB,EAAM1qB,OAAOxC,GAAOwF,OAE1B,GAAI,aAAakB,KAAKwmB,GAAM,OAAOrN,SAASqN,EAAI5iB,MAAM,KAAK,GAAI,IAE/D,GAAI4iB,EAAIjP,SAAS,KAAM,OAAO4B,SAASqN,EAAIzqB,QAAQ,IAAK,IAAK,IAE7D,MAAM6nC,EAAUpd,EAAIrmB,MAAM,QAC1B,OAAIyjC,GAAWA,EAAQjtC,OAAS,EACvBwiB,SAASyqB,EAAQA,EAAQjtC,OAAS,GAAI,IAExC,GAGHktC,GAAuBrd,IAC3B,IAAKA,EAAK,MAAO,GACjB,MAAM7P,EAAU,GACVmtB,EAAShoC,OAAO0qB,GAAK1nB,OAG3B,GAAIglC,EAAOjtC,WAAW,MAAQitC,EAAOvsB,SAAS,KAC5C,IACE,MAAMwsB,EAAU7sC,KAAKC,MAAM2sC,GAC3B,IAAK,MAAMltC,KAAOmtC,EAAS,CACzB,MAAMzlC,EAAMylC,EAAQntC,GACD,iBAAR0H,EACTqY,EAAQ7f,KAAK,CAAE0S,KAAM5S,EAAK0C,MAAOgF,IACT,iBAARA,GAAoB,QAAQ0B,KAAK1B,IACjDqY,EAAQ7f,KAAK,CAAE0S,KAAM5S,EAAK0C,MAAO6f,SAAS7a,EAAK,KAEnD,CACA,GAAIqY,EAAQhgB,OAAS,EAAG,OAAOggB,CACjC,CAAE,MAAO1e,GAET,CAIF,MAAMsI,EAAQujC,EAAOlgC,MAAM,aAC3B,IAAK,MAAMujB,KAAQ5mB,EAAO,CACxB,MAAMJ,EAAQgnB,EAAKhnB,MAAM,sDACrBA,GACFwW,EAAQ7f,KAAK,CAAE0S,KAAMrJ,EAAM,GAAI7G,MAAO6f,SAAShZ,EAAM,GAAI,KAE7D,CACA,OAAOwW,GAMHqtB,GAA0Bxd,IAC9B,IAAKA,EAAK,MAAO,GACjB,MAAM7P,EAAU,GAIVpW,EAHSzE,OAAO0qB,GAAK1nB,OAGN8E,MAAM,QAC3B,IAAK,MAAMujB,KAAQ5mB,EAAO,CACxB,MAAM0jC,EAAU9c,EAAKroB,OACrB,IAAKmlC,EAAS,SAGd,MAAMC,EAAaD,EAAQ9jC,MAAM,qBACjC,GAAI+jC,EAAY,CACd,MAAM16B,EAAO06B,EAAW,GAAGplC,OACrBoL,EAAWg6B,EAAW,GAAGplC,OAC/B,GAAI0K,GAAQU,EAAU,CACpByM,EAAQ7f,KAAK,CAAE0S,KAAMA,EAAMU,SAAUA,IACrC,QACF,CACF,CAGA,MAAMi6B,EAAaF,EAAQ9jC,MAAM,8BAC7BgkC,EACFxtB,EAAQ7f,KAAK,CAAE0S,KAAM26B,EAAW,GAAGrlC,OAAQoL,SAAUi6B,EAAW,GAAGrlC,SAKjEmlC,EAAQttC,OAAS,GACnBggB,EAAQ7f,KAAK,CAAE0S,KAAMy6B,EAAS/5B,SAAU,IAE5C,CACA,OAAOyM,GAIHytB,GAAqB,CAAC9qC,EAAO+qC,KACjC,IAAK/qC,EAAO,OAAO,EACnB,MAAMktB,EAAM1qB,OAAOxC,GAAOwF,OACpBwlC,GAAeD,GAAc,IAAIxM,cAEvC,SAAIyM,EAAYhnC,SAAS,QAASgnC,EAAYhnC,SAAS,QAIhD,wDAAwD0C,KAAKwmB,IAGhE+d,GAAkB,CAACjO,EAAUkO,EAAU1rC,KAC3C,IAAKw9B,IAAakO,EAAU,OAAOlO,EACnC,IAAIxjB,EAASwjB,EACb,MAAM9sB,EAAOg7B,EAAS,IAAM,KAa5B,OAZA1xB,EAASA,EAAO/W,QAAQ,aAAcyN,GACtCsJ,EAASA,EAAO/W,QAAQ,iBAAkByoC,EAAS,IAAM,KACrD1rC,GAAWA,EAAQnC,OAAS,GAC9BmC,EAAQlB,QAAQ,CAAC0mB,EAAQrlB,KACvB,GAAIqlB,GAAUrlB,EAAMurC,EAAS7tC,OAAQ,CACnC,MAAM2C,EAAQkrC,EAASvrC,IAAQ,KACzBwa,EAAQ,IAAIE,OAAO,MAAM2K,OAAa,MAC5CxL,EAASA,EAAO/W,QAAQ0X,EAAOna,EACjC,IAGJwZ,EAASA,EAAO/W,QAAQ,aAAc,MAC/B+W,GAKH2xB,GAAiB,CAErB,CAAEt+B,GAAI,kBAAmBuD,KAAM,cAAeg7B,MAAO,QACrD,CAAEv+B,GAAI,sBAAuBuD,KAAM,cAAeg7B,MAAO,WACzD,CAAEv+B,GAAI,mBAAoBuD,KAAM,kBAAmBg7B,MAAO,QAC1D,CAAEv+B,GAAI,iBAAkBuD,KAAM,UAAWg7B,MAAO,QAChD,CAAEv+B,GAAI,mBAAoBuD,KAAM,SAAUg7B,MAAO,SAGnD,IAAIC,IAAgB,EAChBC,IAAW,EACXC,GAA2BzpB,QAAQC,UACnCypB,IAAiB,EACjBC,IAAiB,EACjBC,GAAiB,IAAIr5B,IACrBs5B,GAAW,KACXC,GAAsB,KAGtBxkB,GAAgB,KAChBykB,IAAoB,EAEpBC,GAA6C,CAAC,EAClD,MAAMC,GAAsB,IAAMD,GAIlC,IAAIE,IAAqB,EACrBC,GAAkB,CAAC,EACnBC,GAAoB,CAAC,EACrBC,GAAiB,KACjBC,IAAqB,EAEzB,MAAMC,GAAqB,uBAC3B,IAAIC,GAAoB,CAAC,EACzB,IACE,MAAMhb,EAAQl0B,aAAaU,QAAQuuC,IAC/B/a,IAAOgb,GAAoB1uC,KAAKC,MAAMyzB,GAC5C,CAAE,MAAO3yB,GACPF,QAAQG,KAAK,mBAAoBD,EACnC,CAEA,MAAM4tC,GAAmB,CACvBC,qBAAsB,EACtBC,gBAAgB,EAEhBC,aAAc,KAEZ,IAAIH,GAAiBE,eAArB,CAGA,IACE,MAAMnsC,EAAWqsC,KACX1sB,EAAUoH,KAChB,GAAI/mB,GAAY2f,EAAS,CACvB,MAAMvM,EAAQK,GAAsBgD,kBAC9BmJ,EAAaxC,GAAiBsC,gBAAgB1f,EAAU2f,EAASvM,GAEvE,GAAIwM,EAAW7iB,OAAS,EAAG,CACzBoB,QAAQG,KAAK,yBAA0BshB,GACvCqsB,GAAiBE,gBAAiB,EAGlC,MAAMG,EAAMppC,KAAUqpC,QACtB,GAAID,GAAKE,UACP,IACEF,EAAIE,UAAUxsC,GACVwC,OAAO6xB,QACT7xB,OAAO6xB,OAAOvpB,MAAM8U,EAAW,GAAG5Q,QAAS,MAAO,CAChDy9B,QAAS,IACTC,cAAe,sBAGrB,CAAE,MAAOC,GACPxuC,QAAQ2M,MAAM,4BAA6B6hC,GAEvCnqC,OAAO6xB,QACT7xB,OAAO6xB,OAAOvpB,MAAM,SAAS8U,EAAW,GAAG5Q,wBAAyB,KAAM,CACxEy9B,QAAS,IACTC,cAAe,sBAGrB,CAMF,YAHAzhB,WAAW,KACTghB,GAAiBE,gBAAiB,GACjC,IAEL,CACF,CACF,CAAE,MAAO9tC,GACPF,QAAQ2M,MAAM,oBAAqBzM,EACrC,CAIA+1B,KAGAnJ,WAAW,KACT,IACE,MAAMlN,EAAU+I,IAAiBC,KACjC,GAAIhJ,EAAS,CACX,MACM6uB,EADSxvB,GAAiBmD,gBAAgBxC,GACxBhhB,OAGTkvC,GAAiBC,qBAIhCD,GAAiBC,qBAAuBU,EAGxCC,GAA0BD,EAC5B,CACF,CAAE,MAAOvuC,GACPF,QAAQ2M,MAAM,oBAAqBzM,EACrC,GACC,IAxEwC,IA6EzCwuC,GAA4BppB,IAChC,MAAM,GAAQvgB,KACR4pC,EAAalqC,EAAE,6BAEjB6gB,EAAQ,EACNqpB,EAAW/vC,SACb+vC,EAAWxoC,KAAK,yBAAyBmjB,KAAKhE,GAC9CqpB,EAAWC,QAGbD,EAAWpZ,QAKTj3B,GAA+B,KACnC,IAEE,GAA2B,oBAAhBmoB,aAA+BA,YAAYC,iBACpD,OAAOD,YAAYC,mBAGrB,GAA2B,oBAAhBD,aAA+BA,YAAYD,OACpD,OAAOC,YAAYD,OAGrB,GAAIniB,OAAO0kB,QAAQtC,aAAaC,iBAC9B,OAAOriB,OAAO0kB,OAAOtC,YAAYC,kBAErC,CAAE,MAAOxmB,GACPF,QAAQG,KAAK,gDAAiDD,EAChE,CACA,MAAO,mBAKH2uC,GAAiB,CACrBC,OAAQ,aACRC,cAAe,MACfC,cAAe,QACfC,WAAY,UACZppC,MAAO,QACPqpC,UAAW,IACXC,SAAU,GACVC,cAAc,EACdC,aAAc,GACdC,gBAAiB,SACjBC,YAAa,OACbC,aAAc,QACdC,iBAAiB,EACjBC,uBAAuB,EACvBC,eAAgB,IAGZC,GAAQ,CACZ,CAAExhC,GAAI,UAAWqD,KAAM,gBAAiBlL,IAAK,iDAC7C,CAAE6H,GAAI,UAAWqD,KAAM,QAASlL,IAAK,uBACrC,CAAE6H,GAAI,QAASqD,KAAM,mBAAoBlL,IAAK,iCAC9C,CAAE6H,GAAI,SAAUqD,KAAM,iBAAkBlL,IAAK,0BAC7C,CAAE6H,GAAI,SAAUqD,KAAM,WAAYlL,IAAK,2BACvC,CAAE6H,GAAI,QAASqD,KAAM,cAAelL,IAAK,uBACzC,CAAE6H,GAAI,SAAUqD,KAAM,qBAAsBlL,IAAK,0CACjD,CAAE6H,GAAI,SAAUqD,KAAM,gBAAiBlL,IAAK,wBAC5C,CAAE6H,GAAI,WAAYqD,KAAM,mBAAoBlL,IAAK,+BACjD,CAAE6H,GAAI,SAAUqD,KAAM,gBAAiBlL,IAAK,iDAGxCspC,GAAS,CACb,CAAEzhC,GAAI,QAASqD,KAAM,eAAgBE,KAAM,aAC3C,CAAEvD,GAAI,OAAQqD,KAAM,cAAeE,KAAM,WACzC,CAAEvD,GAAI,SAAUqD,KAAM,gBAAiBE,KAAM,UAC7C,CAAEvD,GAAI,SAAUqD,KAAM,gBAAiBE,KAAM,WAC7C,CAAEvD,GAAI,QAASqD,KAAM,eAAgBE,KAAM,YAC3C,CAAEvD,GAAI,QAASqD,KAAM,eAAgBE,KAAM,WAC3C,CAAEvD,GAAI,WAAYqD,KAAM,mBAAoBE,KAAM,cAClD,CAAEvD,GAAI,SAAUqD,KAAM,mBAAoBE,KAAM,YAChD,CAAEvD,GAAI,WAAYqD,KAAM,mBAAoBE,KAAM,YAClD,CAAEvD,GAAI,UAAWqD,KAAM,sBAAuBE,KAAM,YACpD,CAAEvD,GAAI,SAAUqD,KAAM,gBAAiBE,KAAM,UAC7C,CAAEvD,GAAI,SAAUqD,KAAM,sBAAuBE,KAAM,aACnD,CAAEvD,GAAI,cAAeqD,KAAM,qBAAsBE,KAAM,WACvD,CAAEvD,GAAI,YAAaqD,KAAM,mBAAoBE,KAAM,cACnD,CAAEvD,GAAI,mBAAoBqD,KAAM,2BAA4BE,KAAM,UAClE,CAAEvD,GAAI,WAAYqD,KAAM,kBAAmBE,KAAM,eACjD,CAAEvD,GAAI,YAAaqD,KAAM,mBAAoBE,KAAM,iBACnD,CAAEvD,GAAI,SAAUqD,KAAM,gBAAiBE,KAAM,gBAC7C,CAAEvD,GAAI,UAAWqD,KAAM,sBAAuBE,KAAM,YAItD,IAAIm+B,GAAa,KACjB,MAAM/qC,GAAU,KACd,MAAM+jB,EAAIzkB,OAAO0kB,QAAU1kB,OAErBI,EAAIJ,OAAO8kB,QAAUL,EAAEK,OAG7B,GAAI2mB,IAAcA,GAAWrrC,EAAG,OAAOqrC,GAEvC,MAAMC,EAAO,CACXtrC,EACA2pC,MAAO,IAAMtlB,EAAEknB,oBAAsB3rC,OAAO2rC,mBAC5CC,UAAWnnB,EAAExkB,UAAU2rC,UAEvBC,GACE7rC,OAAOoiB,aACPqC,EAAErC,aACF,MACE,IACE,OAAOpiB,OAAO8rC,IAAM9rC,OAAO8rC,IAAI1pB,YAAc,IAC/C,CAAE,MAAOvmB,GACP,OAAO,IACT,CACD,EAND,IAWJ,OADIuE,IAAGqrC,GAAaC,GACbA,GAGHK,GAAwB,KAC5B,MAAM,GAAQrrC,KACRsrC,EAAO5rC,EAAE,wBACTyyB,EAAQmZ,EAAKlqC,KAAK,KAClBmqC,EAAYhD,KAClB,IAAIiD,GAAe,EACnB,GAAID,EACF,IAAK,MAAMzxC,KAAOyxC,EAChB,GAAIA,EAAUzxC,IAAQyxC,EAAUzxC,GAAKD,OAAS,EAAG,CAC/C2xC,GAAe,EACf,KACF,CAGAnD,IAAqBmD,GACvBrZ,EAAMzB,SAAS,oBACf4a,EAAK5Z,KAAK,QAAS,qBAEnBS,EAAM1B,YAAY,oBAClB6a,EAAK5Z,KAAK,QAAS,MACnB4Z,EAAKha,IAAI,QAAS,MAIhBma,GAAsB/+B,IAC1B,IAAKA,EAAM,MAAO,WAClB,MAAM4P,EAAI5P,EAAKquB,cACf,OAAIze,EAAE9b,SAAS,OAAS8b,EAAE9b,SAAS,MAAc,iBAC7C8b,EAAE9b,SAAS,OAAS8b,EAAE9b,SAAS,MAAc,gBAC7C8b,EAAE9b,SAAS,OAAS8b,EAAE9b,SAAS,MAAc,eAC7C8b,EAAE9b,SAAS,OAAS8b,EAAE9b,SAAS,MAAc,YAC7C8b,EAAE9b,SAAS,OAAS8b,EAAE9b,SAAS,MAAc,kBAC7C8b,EAAE9b,SAAS,OAAS8b,EAAE9b,SAAS,MAAc,YAC7C8b,EAAE9b,SAAS,OAAS8b,EAAE9b,SAAS,QAAgB,kBAC/C8b,EAAE9b,SAAS,OAAS8b,EAAE9b,SAAS,MAAc,iBAC7C8b,EAAE9b,SAAS,QAAU8b,EAAE9b,SAAS,QAAgB,sBAChD8b,EAAE9b,SAAS,SAAW8b,EAAE9b,SAAS,OAAS8b,EAAE9b,SAAS,MAAc,cACnE8b,EAAE9b,SAAS,OAAS8b,EAAE9b,SAAS,MAAc,mBAC7C8b,EAAE9b,SAAS,MAAc,SACzB8b,EAAE9b,SAAS,OAAS8b,EAAE9b,SAAS,MAAc,gBAC7C8b,EAAE9b,SAAS,MAAc,gBACtB,YAGHkrC,GAAgBnnB,IACpB,IAAKA,EAAM,MAAO,GAClB,MAAMmF,EAAM1qB,OAAOulB,GAAMviB,OACzB,MAAI,aAAakB,KAAKwmB,IAAQ,YAAYxmB,KAAKwmB,GAAa,kBACxDA,EAAI7vB,QAAU,IAAM6vB,EAAIlpB,SAAS,SACjC,CAAC,IAAK,IAAK,IAAK,IAAK,KAAM,MAAMA,SAASkpB,GADO,oBAE9C,IAIHhb,GAAQ,CACZnK,IAAK,CAACzK,EAAK6xC,EAAM,QACf,IACE,OAAOvxC,KAAKC,MAAMT,aAAaU,QAAQR,KAAS6xC,CAClD,CAAE,MACA,OAAOA,CACT,GAEFjnC,IAAK,CAAC5K,EAAK0H,KACT,IACE5H,aAAa+B,QAAQ7B,EAAKM,KAAKwB,UAAU4F,GAC3C,CAAE,MAAOrG,GAEP,GAAe,uBAAXA,EAAEuR,MAAiCvR,EAAE2Q,QAAQtL,SAAS,SAAU,CAClEvF,QAAQG,KAAK,gCACb,IAEExB,aAAaoB,WAAW+J,GAGxBnL,aAAa+B,QAAQ7B,EAAKM,KAAKwB,UAAU4F,GAC3C,CAAE,MAAOoqC,GAEP3wC,QAAQ2M,MAAM,0BAA2BgkC,GACrCtsC,OAAO6xB,SAAW7xB,OAAOusC,mBAC3BvsC,OAAO6xB,OAAO2E,QAAQ,yBACtBx2B,OAAOusC,kBAAmB,EAC1B9jB,WAAW,IAAOzoB,OAAOusC,kBAAmB,EAAQ,KAExD,CACF,MACE5wC,QAAQ2M,MAAM,kBAAmBzM,EAErC,IAIE81B,GAAoB,IAAMviB,GAAMnK,IAAIM,GACpCksB,GAAqBrqB,GAAKgI,GAAMhK,IAAIG,EAAwB6B,GAE5DolC,GAAqB,IAAMp9B,GAAMnK,IAAIK,GACrCmnC,GAAiBrlC,GAAKgI,GAAMhK,IAAIE,EAAyB8B,GACzDslC,GAAoB,IAAMt9B,GAAMnK,IAAIS,GAA0B,GAC9DinC,GAAqBvlC,GAAKgI,GAAMhK,IAAIM,EAA0B0B,GAE9DwlC,GAA2B,IAAMx9B,GAAMnK,IAAIU,GAA+B,GAG1EkkC,GAAe,KACnB,MAAMhvC,EAAOuU,GAAMnK,IAAIQ,GACvB,IAAK5K,EAAM,OAAO,KAElB,MAAMgyC,EAAa5yC,KAEnB,OAAIY,EAAKiyC,YAAcjyC,EAAKiyC,aAAeD,EAClC,KAEFhyC,GAIHkyC,GAAe3lC,IACdA,IAEY,iBAANA,IACTA,EAAE0lC,WAAa7yC,MAEjBmV,GAAMhK,IAAIK,EAA2B2B,KAIjCmuB,GAAkB,IAAMnmB,GAAMnK,IAAIY,EAA2B,CAAC,GAC9D2vB,GAAmBpuB,GAAKgI,GAAMhK,IAAIS,EAA2BuB,GAC7D4lC,GAAiB,IAAM59B,GAAMnK,IAAIa,EAA0B,CAAC,GAE5DmnC,GAAkB,IAAM79B,GAAMnK,IAAIc,EAA2B,IAE7DmnC,GAAmB,IAAM99B,GAAMnK,IAAIe,EAA4B,IAgB/DmnC,GAAqB3wC,IACzB,MAAMoT,EAAOs9B,KACPrwC,EAAM+S,EAAK9S,QAAQN,GAjBD4K,MAkBpBvK,GAAO,EACT+S,EAAK0E,OAAOzX,EAAK,GAEjB+S,EAAKlV,KAAK8B,GArBY4K,EAuBNwI,EAvBWR,GAAMhK,IAAIY,EAA4BoB,GAwBnEzL,QAAQC,IAAI,gCAAiCY,EAAW,YAAaK,EAAM,IAGvEuwC,GAA4BC,IAChC,MAAM9xB,EAAU+I,IAAiBC,KACjC,IAAKhJ,EAAS,MAAO,GAErB,MAAM+xB,GAAUD,GAAmC,WAAlBA,GAAuD,KAAzBA,EAAc3qC,OAE7E,IAAK,MAAMlI,KAAO+gB,EAAS,CACzB,MAAMlC,EAAQkC,EAAQ/gB,GACtB,IAAK6e,IAAUA,EAAMjM,OAASiM,EAAM3P,QAAS,SAC7C,MAAM6jC,EAAYl0B,EAAMjM,KAGxB,GACEkgC,IACCC,EAAUrsC,SAAS,OAASqsC,EAAUrsC,SAAS,OAASqsC,EAAU9R,cAAcv6B,SAAS,YAEtFmY,EAAM3P,QAAQ,GAAI,CACpB,MAAMhN,EAAU2c,EAAM3P,QAAQ,IAAM,GAC9BjN,EAAM4c,EAAM3P,QAAQ,GAC1B,IAAIyxB,EAAQ,GASZ,GARAz+B,EAAQlB,QAAQ,CAACiC,EAAGZ,KAClB,GAAIY,GAAKA,EAAEyD,SAAS,MAAO,CACVumC,GAAqBhrC,EAAII,IAAQ,IACzCrB,QAAQ42B,IACR+I,EAAMj6B,SAASkxB,EAAKhlB,OAAO+tB,EAAMzgC,KAAK03B,EAAKhlB,OAEpD,IAEE+tB,EAAM5gC,OAAS,EAAG,OAAO4gC,CAC/B,CAIF,IACGmS,IACAC,EAAUrsC,SAAS,OAClBqsC,EAAUrsC,SAAS,QACnBqsC,EAAUrsC,SAAS,OACnBqsC,EAAU9R,cAAcv6B,SAAS,cACnC,CACA,MAAMxE,EAAU2c,EAAM3P,QAAQ,IAAM,GAEpC,IAAI8jC,EAAa,EACjB,IAAK,IAAI/vC,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GACEf,EAAQe,KACPf,EAAQe,GAAGyD,SAAS,OAASxE,EAAQe,GAAGyD,SAAS,OAASxE,EAAQe,GAAGg+B,cAAcv6B,SAAS,SAC7F,CACAssC,EAAa/vC,EACb,KACF,CAGF,IAAK,IAAIpD,EAAI,EAAGA,EAAIgf,EAAM3P,QAAQnP,OAAQF,IAAK,CAC7C,MAAMoC,EAAM4c,EAAM3P,QAAQrP,GAC1B,GAAIoC,GAAOA,EAAI+wC,KAAgBH,EAAe,CAC5C,IAAIlS,EAAQ,GASZ,OARAz+B,EAAQlB,QAAQ,CAACiC,EAAGZ,KAClB,GAAIY,GAAKA,EAAEyD,SAAS,MAAO,CACVumC,GAAqBhrC,EAAII,IAAQ,IACzCrB,QAAQ42B,IACR+I,EAAMj6B,SAASkxB,EAAKhlB,OAAO+tB,EAAMzgC,KAAK03B,EAAKhlB,OAEpD,IAEK+tB,CACT,CACF,CACF,CACF,CAEA,MAAO,IAGHsS,GAAoB,CAACJ,EAAe7hB,KACxC,MAAMjQ,EAAU+I,IAAiBC,KACjC,IAAKhJ,IAAYiQ,EAAU,OAAO,KAElC,MAAM8hB,GAAUD,GAAmC,WAAlBA,GAAuD,KAAzBA,EAAc3qC,OAE7E,IAAK,MAAMlI,KAAO+gB,EAAS,CACzB,MAAMlC,EAAQkC,EAAQ/gB,GACtB,IAAK6e,IAAUA,EAAMjM,OAASiM,EAAM3P,QAAS,SAC7C,MAAM6jC,EAAYl0B,EAAMjM,KAGxB,GACEkgC,IACCC,EAAUrsC,SAAS,OAASqsC,EAAUrsC,SAAS,OAASqsC,EAAU9R,cAAcv6B,SAAS,YAEtFmY,EAAM3P,QAAQ,GAAI,CACpB,MAAMhN,EAAU2c,EAAM3P,QAAQ,IAAM,GAC9BjN,EAAM4c,EAAM3P,QAAQ,GAC1B,IAAK,IAAI7M,EAAM,EAAGA,EAAMH,EAAQnC,OAAQsC,IAAO,CAC7C,MAAMY,EAAIf,EAAQG,GAClB,GAAIY,GAAKA,EAAEyD,SAAS,MAAO,CACzB,MACMwsC,EADSjG,GAAqBhrC,EAAII,IAAQ,IAC3BiF,KAAKswB,GAAQA,EAAKhlB,OAASoe,GAChD,GAAIkiB,EAAO,OAAOA,EAAMxwC,KAC1B,CACF,CACF,CAIF,IACGowC,IACAC,EAAUrsC,SAAS,OAClBqsC,EAAUrsC,SAAS,QACnBqsC,EAAUrsC,SAAS,OACnBqsC,EAAU9R,cAAcv6B,SAAS,cACnC,CACA,MAAMxE,EAAU2c,EAAM3P,QAAQ,IAAM,GAEpC,IAAI8jC,EAAa,EACjB,IAAK,IAAI/vC,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GACEf,EAAQe,KACPf,EAAQe,GAAGyD,SAAS,OAASxE,EAAQe,GAAGyD,SAAS,OAASxE,EAAQe,GAAGg+B,cAAcv6B,SAAS,SAC7F,CACAssC,EAAa/vC,EACb,KACF,CAGF,IAAK,IAAIpD,EAAI,EAAGA,EAAIgf,EAAM3P,QAAQnP,OAAQF,IAAK,CAC7C,MAAMoC,EAAM4c,EAAM3P,QAAQrP,GAC1B,GAAIoC,GAAOA,EAAI+wC,KAAgBH,EAC7B,IAAK,IAAIxwC,EAAM,EAAGA,EAAMH,EAAQnC,OAAQsC,IAAO,CAC7C,MAAMY,EAAIf,EAAQG,GAClB,GAAIY,GAAKA,EAAEyD,SAAS,MAAO,CACzB,MACMwsC,EADSjG,GAAqBhrC,EAAII,IAAQ,IAC3BiF,KAAKswB,GAAQA,EAAKhlB,OAASoe,GAChD,GAAIkiB,EAAO,OAAOA,EAAMxwC,KAC1B,CACF,CAEJ,CACF,CACF,CAEA,OAAO,MAGHywC,GAAiB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAKhDC,GAAmB,KACvB,MAAMp9B,EAAS+oB,GAAuBpoB,kBACtC,OAAIX,GAAUA,EAAO0oB,eACZ1oB,EAAO0oB,eAAet+B,IAAIw3B,GAAQA,EAAKhlB,MAEzCugC,IAQHrR,GAAqB,KACzB,IACE,MAAM9rB,EAAS+oB,GAAuBpoB,kBACtC,GAAIX,EAAQ,CAEV,MAAMq9B,EAAW,IAAIt+B,IAsBrB,OAnBIiB,EAAO0oB,gBAAkBn6B,MAAMuQ,QAAQkB,EAAO0oB,iBAChD1oB,EAAO0oB,eAAe19B,QAAQ42B,IAC5B,MAAM5G,EAA2B,iBAAT4G,EAAoBA,EAAOA,GAAQA,EAAKhlB,KAC5Doe,GACFqiB,EAASr7B,IAAIgZ,KAMfhb,EAAO8oB,mBAAqBv6B,MAAMuQ,QAAQkB,EAAO8oB,oBACnD9oB,EAAO8oB,kBAAkB99B,QAAQ42B,IAC/B,MAAM5G,EAA2B,iBAAT4G,EAAoBA,EAAOA,GAAQA,EAAKhlB,KAC5Doe,GACFqiB,EAASr7B,IAAIgZ,KAKZzsB,MAAM8iB,KAAKgsB,EACpB,CAGA,MAAMC,EAAavU,GAAuBlpB,iBAAmB,GACvDw9B,EAAW,IAAIt+B,IAAIw+B,IAAqB,IA6B9C,OA1BIhvC,MAAMuQ,QAAQw+B,IAChBA,EAAWtyC,QAAQ8V,IACZA,IAGDA,EAAE4nB,gBAAkBn6B,MAAMuQ,QAAQgC,EAAE4nB,iBACtC5nB,EAAE4nB,eAAe19B,QAAQ42B,IACvB,MAAM5G,EAA2B,iBAAT4G,EAAoBA,EAAOA,GAAQA,EAAKhlB,KAC5Doe,GACFqiB,EAASr7B,IAAIgZ,KAMfla,EAAEgoB,mBAAqBv6B,MAAMuQ,QAAQgC,EAAEgoB,oBACzChoB,EAAEgoB,kBAAkB99B,QAAQ42B,IAC1B,MAAM5G,EAA2B,iBAAT4G,EAAoBA,EAAOA,GAAQA,EAAKhlB,KAC5Doe,GACFqiB,EAASr7B,IAAIgZ,QAOhBzsB,MAAM8iB,KAAKgsB,EACpB,CAAE,MAAOnX,GAEP,OADA/6B,QAAQ2M,MAAM,mCAAoCouB,GAC3CqX,IAAqB,EAC9B,GAIIA,GAAoB,CAExB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KAEA,OACA,OACA,OACA,MACA,SACA,OACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,MACA,KACA,MAGA,MACA,KACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,MACA,MACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,KACA,SACA,KACA,KAGA,KACA,MACA,QACA,MACA,KACA,KACA,KACA,MACA,MACA,MACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,MACA,KACA,QACA,KACA,KACA,KACA,MACA,KACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,MACA,QACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OASIC,GAAwB,CAACC,OAAgBxvC,KAE7C,GAA6B,kBAAlBwvC,EAA6B,CACtC,MAAMC,EAAQD,EACRhQ,EAAWF,GAASp2B,KAAKs0B,MAAMt0B,KAAKqC,SAAW+zB,GAAS,EACxDoQ,EAAc,IAAMlQ,EAAS,GAAKA,EAAS,GAAKA,EAAS,GAEzDmQ,EAAgB,KACpB,GAAIF,EAAO,CACT,MAAMG,EAAOF,IACPG,EAASrQ,EAAS,GAAK,EAC7B,OAAOt2B,KAAKC,IAAI,EAAGD,KAAK8G,IAAI,GAAI4/B,EAAOC,GACzC,CAAO,CACL,MAAMD,EAAuB,EAAhBF,IACPG,EAASrQ,EAAS,IAAM,EAC9B,OAAOt2B,KAAKC,IAAI,EAAGD,KAAK8G,IAAI,GAAI4/B,EAAOC,GACzC,GAGI53B,EAAS,CAAC,EAIhB,OAHAi3B,GAAenyC,QAAQ42B,IACrB1b,EAAO0b,GAAQgc,MAEV13B,CACT,CAGA,MAAMlG,EAASy9B,GAAiB1U,GAAuBpoB,kBAGvD,IAAKX,EAAQ,CACX,MAAMytB,EAAWF,GAASp2B,KAAKs0B,MAAMt0B,KAAKqC,SAAW+zB,GAAS,EACxDoQ,EAAc,IAAMlQ,EAAS,GAAK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","sources":["src://tavern_helper_template/src//emoji-maps.ts","src://tavern_helper_template/src//index.ts"],"sourcesContent":["/**\n *  Emoji \n * emoji\n *\n * \n * 1. \"\"\"\"\n * 2. \"\"\"|\"\n * 3. emoji\"\"\"|\"\n * 4. \"\"\"\"\n * 5. //\n */\nexport const EMOJI_MAP: [RegExp, string][] = [\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/RiNG|LiveHouse/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/T/, ''],\n  [//, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [//, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [//, ''],\n  [//, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // //\n  // ============================================\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n\n  // \n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/SCP||/, ''],\n\n  // \n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // \n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // \n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/BOSS||/, ''],\n  [/|||/, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  // \n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||||||/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n\n  // \n  [/||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n\n  // \n  [/|||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // \n  [//, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n\n  // \n  [/||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/||/, ''],\n  [//, ''],\n\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|||/, ''],\n\n  // \n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n\n  // \n  [/||/, ''],\n  [/|||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [//, ''],\n  [/|||/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/||/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // \n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // \n  [/||/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [/|||||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|||||/, ''],\n];\n\n// \nexport const LOCATION_EMOJI_MAP = EMOJI_MAP;\nexport const ELEMENT_EMOJI_MAP = EMOJI_MAP;\n","// @ts-nocheck\nimport { ELEMENT_EMOJI_MAP, LOCATION_EMOJI_MAP } from './emoji-maps';\nimport { MAIN_STYLES } from './styles';\n\n(function () {\n  'use strict';\n\n  const SCRIPT_ID = 'acu_visualizer_ui_v19_6_ai_overlay';\n  // ========================================\n  // LockManager - \n  // ========================================\n  const LockManager = {\n    STORAGE_KEY_PREFIX: 'acu_locked_fields_v2_',\n    MAX_CONTEXTS: 20, // \n\n    PRIMARY_KEYS: {\n      : null,\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n    },\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    //  N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) return;\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(`[DICE]LockManager  ${toDelete.length} `);\n        }\n      } catch (e) {\n        console.warn('[DICE]LockManager ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[DICE]LockManager ', e);\n      }\n    },\n\n    getRowKey(tableName, row, headers) {\n      const pkField = this.PRIMARY_KEYS[tableName];\n      if (pkField === null) return '_row_0';\n\n      let fieldIndex = 1;\n      if (pkField) {\n        const idx = headers.indexOf(pkField);\n        if (idx !== -1) fieldIndex = idx;\n      }\n\n      if (!row[fieldIndex]) return null;\n      return `${pkField || headers[fieldIndex]}=${row[fieldIndex]}`;\n    },\n\n    lockField(tableName, rowKey, fieldName, value) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n      if (!data[tableName][rowKey]) {\n        data[tableName][rowKey] = { _fullRow: false, _fields: {}, _snapshot: null };\n      }\n      data[tableName][rowKey]._fields[fieldName] = value;\n      this._save();\n    },\n\n    lockRow(tableName, rowKey, rowData, headers) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      const snapshot = {};\n      headers.forEach((h, i) => {\n        if (h && rowData[i] != null && rowData[i] !== '') {\n          snapshot[h] = rowData[i];\n        }\n      });\n\n      data[tableName][rowKey] = { _fullRow: true, _fields: {}, _snapshot: snapshot };\n      this._save();\n    },\n\n    unlockField(tableName, rowKey, fieldName) {\n      const data = this._load();\n      const lock = data[tableName]?.[rowKey];\n      if (!lock) return;\n\n      //  _snapshot \n      if (lock._fullRow && lock._snapshot) {\n        delete lock._snapshot[fieldName];\n        //  _snapshot \n        if (Object.keys(lock._snapshot).length === 0) {\n          delete data[tableName][rowKey];\n          if (Object.keys(data[tableName]).length === 0) {\n            delete data[tableName];\n          }\n        }\n      } else {\n        //  _fields \n        delete lock._fields[fieldName];\n        if (Object.keys(lock._fields).length === 0) {\n          delete data[tableName][rowKey];\n          if (Object.keys(data[tableName]).length === 0) {\n            delete data[tableName];\n          }\n        }\n      }\n      this._save();\n    },\n\n    unlockRow(tableName, rowKey) {\n      const data = this._load();\n      if (data[tableName]) {\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n        this._save();\n      }\n    },\n\n    isFieldLocked(tableName, rowKey, fieldName) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return false;\n      if (lock._fullRow) return lock._snapshot?.hasOwnProperty(fieldName);\n      return lock._fields?.hasOwnProperty(fieldName);\n    },\n\n    isRowLocked(tableName, rowKey) {\n      return this._load()[tableName]?.[rowKey]?._fullRow === true;\n    },\n\n    applyLocks(tableName, tableContent) {\n      const tableLocks = this._load()[tableName];\n      if (!tableLocks || !tableContent || tableContent.length < 2) {\n        return { modified: false, restored: [] };\n      }\n\n      const headers = tableContent[0];\n      const restored = [];\n      let modified = false;\n\n      // \n      const rowIndex = {};\n      for (let i = 1; i < tableContent.length; i++) {\n        const key = this.getRowKey(tableName, tableContent[i], headers);\n        if (key) rowIndex[key] = i;\n      }\n\n      for (const [rowKey, lock] of Object.entries(tableLocks)) {\n        const idx = rowIndex[rowKey];\n\n        if (idx === undefined) {\n          // \n          const newRow = this._rebuildRow(headers, lock);\n          if (newRow) {\n            tableContent.push(newRow);\n            restored.push(rowKey);\n            modified = true;\n          }\n          continue;\n        }\n\n        const row = tableContent[idx];\n        const fields = lock._fullRow ? lock._snapshot : lock._fields;\n\n        if (fields) {\n          for (const [field, value] of Object.entries(fields)) {\n            const colIdx = headers.indexOf(field);\n            if (colIdx !== -1 && row[colIdx] !== value) {\n              row[colIdx] = value;\n              modified = true;\n            }\n          }\n        }\n      }\n\n      return { modified, restored };\n    },\n\n    _rebuildRow(headers, lock) {\n      const fields = lock._fullRow ? lock._snapshot : lock._fields;\n      if (!fields || Object.keys(fields).length === 0) return null;\n\n      const row = new Array(headers.length).fill(null);\n      for (const [field, value] of Object.entries(fields)) {\n        const idx = headers.indexOf(field);\n        if (idx !== -1) row[idx] = value;\n      }\n      return row;\n    },\n\n    // \n    hasAnyLock(tableName, rowKey) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return false;\n      if (lock._fullRow) return true;\n      return Object.keys(lock._fields || {}).length > 0;\n    },\n\n    getLockedFields(tableName, rowKey) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return [];\n      if (lock._fullRow) return Object.keys(lock._snapshot || {});\n      return Object.keys(lock._fields || {});\n    },\n\n    // \n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  // ========================================\n  // BookmarkManager - \n  // ========================================\n  const BookmarkManager = {\n    STORAGE_KEY_PREFIX: 'acu_bookmarks_v1_',\n    MAX_CONTEXTS: 20, // bookmark\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    // bookmark N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) {\n          // \n          return;\n        }\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(\n            `[DICE]BookmarkManager  ${toDelete.length} bookmark ${this.MAX_CONTEXTS}  ${allKeys.length} `,\n          );\n        }\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    isBookmarked(tableName, rowKey) {\n      const data = this._load();\n      return !!(data[tableName] && data[tableName][rowKey]);\n    },\n\n    toggleBookmark(tableName, rowKey) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      if (data[tableName][rowKey]) {\n        // bookmark\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n      } else {\n        // bookmark\n        data[tableName][rowKey] = true;\n      }\n      this._save();\n    },\n\n    getBookmarks(tableName) {\n      const data = this._load();\n      if (!data[tableName]) return [];\n      return Object.keys(data[tableName]);\n    },\n\n    // bookmark\n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  const escapeHtml = s =>\n    String(s ?? '')\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n\n  /**\n   * \n   * - PC mousedown  mouseup \n   * - Mobile\n   * @param $overlay jQuery\n   * @param overlayClass \n   * @param onClose \n   */\n  const setupOverlayClose = ($overlay: JQuery, overlayClass: string, onClose: () => void) => {\n    const isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n\n    if (isMobile) {\n      // Mobile: \n      $overlay.on('click', function (e) {\n        if ($(e.target).hasClass(overlayClass)) {\n          onClose();\n        }\n      });\n    } else {\n      // PC:  mousedown  mouseup \n      let mouseDownOnOverlay = false;\n\n      $overlay.on('mousedown', function (e) {\n        mouseDownOnOverlay = $(e.target).hasClass(overlayClass);\n      });\n\n      $overlay.on('mouseup', function (e) {\n        if (mouseDownOnOverlay && $(e.target).hasClass(overlayClass)) {\n          onClose();\n        }\n        mouseDownOnOverlay = false;\n      });\n    }\n  };\n\n  // [] \n  const generateUniqueName = (baseName: string, existingNames: string[]): string => {\n    if (!existingNames.includes(baseName)) return baseName;\n    let counter = 2;\n    let newName = `${baseName} (${counter})`;\n    while (existingNames.includes(newName)) {\n      counter++;\n      newName = `${baseName} (${counter})`;\n    }\n    return newName;\n  };\n\n  // [] \n  const showPresetConflictDialog = (options: {\n    presetName: string;\n    presetType: string;\n    onOverwrite: () => void;\n    onRename: (newName: string) => void;\n    onCancel: () => void;\n    existingNames: string[];\n  }) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const t = getThemeColors();\n    const config = getConfig();\n    const suggestedName = generateUniqueName(options.presetName, options.existingNames);\n\n    const dialogHtml = `\n      <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-import-confirm-dialog\">\n          <div class=\"acu-import-confirm-header\">\n            <i class=\"fa-solid fa-file-import\"></i> ${options.presetType}\n          </div>\n          <div class=\"acu-import-confirm-body\">\n            <div class=\"acu-import-warning-container\">\n              <i class=\"fa-solid fa-exclamation-triangle acu-import-warning-icon\"></i>\n              <div class=\"acu-import-warning-title\"></div>\n              <div class=\"acu-import-warning-message\">${escapeHtml(options.presetName)}</div>\n            </div>\n            <div class=\"acu-import-conflict-options\">\n              <label class=\"acu-import-radio\">\n                <input type=\"radio\" name=\"preset-conflict-mode\" value=\"overwrite\" checked />\n                <span></span>\n              </label>\n              <label class=\"acu-import-radio\">\n                <input type=\"radio\" name=\"preset-conflict-mode\" value=\"rename\" />\n                <span>${escapeHtml(suggestedName)}</span>\n              </label>\n            </div>\n          </div>\n          <div class=\"acu-import-confirm-footer\">\n            <button class=\"acu-import-cancel-btn\"></button>\n            <button class=\"acu-import-confirm-btn\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n      position: fixed !important;\n      top: 0 !important;\n      left: 0 !important;\n      right: 0 !important;\n      bottom: 0 !important;\n      width: 100vw !important;\n      height: 100vh !important;\n      background: rgba(0,0,0,0.6) !important;\n      z-index: 31300 !important;\n      display: flex;\n      justify-content: center !important;\n      align-items: center !important;\n      padding: 16px;\n      box-sizing: border-box !important;\n    `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(() => {\n      closeDialog();\n      options.onCancel();\n    });\n\n    setupOverlayClose($dialog, 'acu-import-confirm-overlay', () => {\n      closeDialog();\n      options.onCancel();\n    });\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const mode = $dialog.find('input[name=\"preset-conflict-mode\"]:checked').val();\n      closeDialog();\n      if (mode === 'overwrite') {\n        options.onOverwrite();\n      } else {\n        options.onRename(suggestedName);\n      }\n    });\n  };\n  // [] \n  const smartInsertToTextarea = (newContent, contentType) => {\n    // contentType: 'action' ()  'dice' ()\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = ($ta.val() || '').trim();\n\n    // \n    // : \"XX\"\n    const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n    // \n    // : \"  vs    (...)  ......  (...)  .........\"\n    const contestDiceRegex =\n      /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n    // <user>\n    const actionRegex = /<user>(?:(?!<user>).)*?[]/g;\n\n    // \n    const placeholderRegex = /\\[\\]/g;\n\n    // [] \n    const diceCfg = getDiceConfig();\n    let contentToInsert = newContent;\n    let shouldSaveOriginal = false;\n    if (contentType === 'dice' && diceCfg.hideDiceResultFromUser) {\n      contentToInsert = '[]';\n      shouldSaveOriginal = true;\n    }\n\n    // \n    if (!currentVal) {\n      $ta.val(contentToInsert).trigger('input').trigger('change');\n      // []  data \n      if (contentType === 'dice') {\n        $ta.data('acu-original-dice-text', newContent);\n        // []  DOM  getter  jQuery\n        const textarea = $ta[0] as any;\n        textarea._acuOriginalDiceText = newContent;\n        textarea._acuHasDiceData = true;\n      }\n      return;\n    }\n\n    // \n    let workingText = currentVal;\n    let existingAction = '';\n    let existingDice = '';\n    let existingDiceOriginal = '';\n\n    // [] 0. \n    if (placeholderRegex.test(workingText)) {\n      // \n      const originalText = $ta.data('acu-original-dice-text') || '';\n      if (originalText) {\n        // \n        workingText = workingText.replace(placeholderRegex, originalText);\n        existingDice = originalText;\n        existingDiceOriginal = originalText;\n      } else {\n        // \n        workingText = workingText.replace(placeholderRegex, '').trim();\n      }\n    }\n\n    // 1. \n    const contestMatches = workingText.match(contestDiceRegex);\n    if (contestMatches && contestMatches.length > 0) {\n      existingDice = contestMatches[contestMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(contestDiceRegex, '\\u0000').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted contest roll:', existingDice);\n    }\n\n    // 2. \n    const normalMatches = workingText.match(normalDiceRegex);\n    if (normalMatches && normalMatches.length > 0) {\n      // \n      existingDice = normalMatches[normalMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(normalDiceRegex, '\\u0000').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted normal roll:', existingDice);\n    }\n\n    // 3. \n    const actionMatches = workingText.match(actionRegex);\n    if (actionMatches && actionMatches.length > 0) {\n      existingAction = actionMatches[actionMatches.length - 1];\n      workingText = workingText.replace(actionRegex, '\\u0001').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted action:', existingAction);\n    }\n\n    // 4. \n    let userInput = workingText\n      .replace(/[\\u0000\\u0001]/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .trim();\n\n    // 5. \n    if (contentType === 'dice') {\n      // [] \n      existingDice = contentToInsert;\n      existingDiceOriginal = newContent;\n      //  data \n      $ta.data('acu-original-dice-text', newContent);\n      // []  DOM  getter  jQuery\n      const textarea = $ta[0] as any;\n      textarea._acuOriginalDiceText = newContent;\n      textarea._acuHasDiceData = true;\n    } else if (contentType === 'action') {\n      existingAction = newContent;\n    }\n\n    // 6.  +  + \n    const parts = [];\n    if (userInput) parts.push(userInput);\n    if (existingAction) parts.push(existingAction);\n    if (existingDice) parts.push(existingDice);\n\n    const finalVal = parts.join(' ');\n    $ta.val(finalVal).trigger('input').trigger('change');\n  };\n\n  // [] \n  const restoreDiceResultBeforeSend = () => {\n    const { $ } = getCore();\n    const diceCfg = getDiceConfig();\n    const hideInput = diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n    if (hideInput) return;\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = $ta.val() || '';\n    const originalText = $ta.data('acu-original-dice-text');\n\n    // \n    if (currentVal.includes('[]') && originalText) {\n      const restoredVal = currentVal.replace(/\\[\\]/g, originalText);\n      $ta.val(restoredVal);\n      // \n      $ta.removeData('acu-original-dice-text');\n      // []  DOM \n      const textarea = $ta[0] as any;\n      textarea._acuOriginalDiceText = null;\n      textarea._acuHasDiceData = false;\n    }\n  };\n\n  // []  value \n  const interceptTextareaValue = () => {\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const textarea = $ta[0] as HTMLTextAreaElement;\n    if (!textarea || (textarea as any)._acuValueIntercepted) return;\n\n    // \n    (textarea as any)._acuValueIntercepted = true;\n\n    //  value \n    const originalDescriptor = Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype, 'value');\n    const originalValue = textarea.value;\n\n    //  value  getter\n    Object.defineProperty(textarea, 'value', {\n      get: function (this: HTMLTextAreaElement) {\n        // \n        let val: string;\n        if (originalDescriptor && originalDescriptor.get) {\n          val = originalDescriptor.get.call(this);\n        } else {\n          val = (this as any)._value || originalValue || '';\n        }\n\n        // [] \n        //  DOM  jQuery data getter  jQuery\n        //  ) \n        if (!(this as any)._acuHasDiceData) {\n          return val;\n        }\n\n        // \n        const originalText = (this as any)._acuOriginalDiceText;\n        if (val && typeof val === 'string' && val.includes('[]') && originalText) {\n          return val.replace(/\\[\\]/g, originalText);\n        }\n        return val;\n      },\n      set: function (this: HTMLTextAreaElement, val: string) {\n        if (originalDescriptor && originalDescriptor.set) {\n          originalDescriptor.set.call(this, val);\n        } else {\n          (this as any)._value = val;\n        }\n      },\n      configurable: true,\n    });\n  };\n  const STORAGE_KEY_TABLE_ORDER = 'acu_table_order';\n  const STORAGE_KEY_ACTION_ORDER = 'acu_action_order';\n\n  const STORAGE_KEY_ACTIVE_TAB = 'acu_active_tab';\n  const STORAGE_KEY_UI_CONFIG = 'acu_ui_config_v19';\n  const STORAGE_KEY_LAST_SNAPSHOT = 'acu_data_snapshot_v19';\n  const STORAGE_KEY_IS_COLLAPSED = 'acu_ui_collapsed_state';\n  const STORAGE_KEY_OPTIONS_COLLAPSED = 'acu_options_collapsed'; // [] \n  const STORAGE_KEY_DASHBOARD_ACTIVE = 'acu_dashboard_active';\n  // [] \n  const STORAGE_KEY_TABLE_HEIGHTS = 'acu_table_heights_v19';\n  const STORAGE_KEY_TABLE_STYLES = 'acu_table_styles_v19';\n  const STORAGE_KEY_HIDDEN_TABLES = 'acu_hidden_tables_v19';\n  const STORAGE_KEY_GM_CONFIG = 'acu_gm_engine_config_v1';\n  const STORAGE_KEY_REVERSE_TABLES = 'acu_reverse_tables_v1';\n  const MAX_ACTION_BUTTONS = 6; // \n  const MIN_PANEL_HEIGHT = 200; // \n  const MAX_PANEL_HEIGHT = 1200; // \n\n  const STORAGE_KEY_DICE_CONFIG = 'acu_dice_config_v1';\n  const STORAGE_KEY_ATTRIBUTE_PRESETS = 'acu_attribute_presets_v1';\n  const STORAGE_KEY_ACTIVE_ATTR_PRESET = 'acu_active_attr_preset_v1';\n  const STORAGE_KEY_ACTION_PRESETS = 'acu_action_presets_v1';\n  const STORAGE_KEY_ACTIVE_ACTION_PRESET = 'acu_active_action_preset_v1';\n  const STORAGE_KEY_CRAZY_MODE = 'acu_dice_crazy_mode';\n  const DEFAULT_CRAZY_MODE_CONFIG = {\n    enabled: false,\n    crazyLevel: 50,\n    playerWeight: 80,\n    inSceneNpcWeight: 15,\n    offSceneNpcWeight: 5,\n  };\n  const PRESET_FORMAT_VERSION = '1.4.0'; // \n  const SCRIPT_VERSION = 'v3.60'; // \n\n  //  \"x.y.z\"\n  const compareVersion = (v1, v2) => {\n    // \n    const normalizeVersion = v => {\n      if (typeof v === 'number') return `${v}.0.0`;\n      if (typeof v !== 'string') return '0.0.0';\n      return v;\n    };\n    const nv1 = normalizeVersion(v1);\n    const nv2 = normalizeVersion(v2);\n    const parts1 = nv1.split('.').map(Number);\n    const parts2 = nv2.split('.').map(Number);\n    for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {\n      const p1 = parts1[i] || 0;\n      const p2 = parts2[i] || 0;\n      if (p1 < p2) return -1;\n      if (p1 > p2) return 1;\n    }\n    return 0;\n  };\n\n  const STORAGE_KEY_AVATAR_MAP = 'acu_avatar_map_v1';\n  const STORAGE_KEY_MAP_FOCUS = 'acu_map_focus_v1';\n\n  // ========================================\n  // ConsoleCaptureManager - Console\n  // ========================================\n  const ConsoleCaptureManager = {\n    logs: [],\n    maxLogs: 1000,\n    filters: { log: true, info: true, warn: true, error: true },\n    originalMethods: {},\n    isIntercepted: false,\n    enabled: false, // \n\n    restore() {\n      //  localStorage \n      const saved = localStorage.getItem('acu_console_capture_enabled');\n      if (saved === 'true') {\n        this.enable();\n      }\n    },\n\n    enable() {\n      if (this.enabled) return;\n      this.enabled = true;\n      localStorage.setItem('acu_console_capture_enabled', 'true');\n      this.intercept();\n    },\n\n    disable() {\n      if (!this.enabled) return;\n      this.enabled = false;\n      localStorage.setItem('acu_console_capture_enabled', 'false');\n      // \n      localStorage.removeItem('acu_script_error_detected');\n      // \n      const emergencyBtn = document.getElementById('acu-emergency-debug-btn');\n      if (emergencyBtn) {\n        emergencyBtn.style.display = 'none';\n      }\n    },\n\n    intercept() {\n      if (this.isIntercepted) return;\n      this.isIntercepted = true;\n\n      ['log', 'info', 'warn', 'error'].forEach(type => {\n        this.originalMethods[type] = console[type];\n        const self = this;\n        console[type] = function (...args) {\n          // \n          self.originalMethods[type].apply(console, args);\n          // \n          if (self.enabled) {\n            self.capture(type, args);\n          }\n        };\n      });\n    },\n\n    capture(type, args) {\n      if (!this.enabled) return; // \n      try {\n        const timestamp = new Date();\n        const timeStr = timestamp.toLocaleTimeString('zh-CN', { hour12: false });\n\n        // \n        const content = args\n          .map(arg => {\n            if (typeof arg === 'object') {\n              try {\n                return JSON.stringify(arg, null, 2);\n              } catch {\n                return String(arg);\n              }\n            }\n            return String(arg);\n          })\n          .join(' ');\n\n        // error\n        let stack = null;\n        if (type === 'error' && args[0] instanceof Error) {\n          stack = args[0].stack || null;\n        }\n\n        const logEntry = {\n          id: Date.now() + Math.random(),\n          timestamp,\n          timeStr,\n          type,\n          content,\n          stack,\n          rawArgs: args,\n        };\n\n        this.logs.push(logEntry);\n\n        // \n        if (this.logs.length > this.maxLogs) {\n          this.logs.shift();\n        }\n      } catch (e) {\n        // console\n      }\n    },\n\n    clear() {\n      this.logs = [];\n    },\n\n    getFilteredLogs() {\n      return this.logs.filter(log => this.filters[log.type]);\n    },\n\n    setFilters(filters) {\n      this.filters = { ...this.filters, ...filters };\n    },\n  };\n\n  // \n  // ConsoleCaptureManager.intercept();\n\n  // ========================================\n  // \n  // ========================================\n  const ErrorHandler = {\n    errorCount: 0,\n    errorThreshold: 3, // 3\n    lastErrorTime: 0,\n    errorWindow: 5000, // 5\n    fatalErrorDetected: false,\n\n    // \n    isFatalError(error, source, lineno, colno, stack) {\n      // \n      const thirdPartyPatterns = [/jquery/i, /lodash/i, /vue/i, /react/i, /pixi/i, /gsap/i, /toastr/i, /node_modules/i];\n\n      const errorInfo = stack || error?.stack || '';\n      const errorSource = source || '';\n\n      // \n      for (const pattern of thirdPartyPatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          return false;\n        }\n      }\n\n      // \n      const corePatterns = [\n        /acu_visualizer/i,\n        //i,\n        /LockManager/i,\n        /Store/i,\n        /ConsoleCaptureManager/i,\n        /renderInterface/i,\n        /init\\s*\\(/i,\n      ];\n\n      let isCoreError = false;\n      for (const pattern of corePatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          isCoreError = true;\n          break;\n        }\n      }\n\n      // \n      return isCoreError;\n    },\n\n    // \n    handleError(error, source, lineno, colno, stack) {\n      try {\n        // \n        if (!this.isFatalError(error, source, lineno, colno, stack)) {\n          return; // \n        }\n\n        const now = Date.now();\n\n        // \n        if (now - this.lastErrorTime > this.errorWindow) {\n          this.errorCount = 0;\n        }\n\n        this.errorCount++;\n        this.lastErrorTime = now;\n\n        // \n        if (this.errorCount >= this.errorThreshold && !this.fatalErrorDetected) {\n          this.fatalErrorDetected = true;\n          this.triggerFatalError();\n        }\n      } catch (e) {\n        // \n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    triggerFatalError() {\n      try {\n        //  console \n        if (!ConsoleCaptureManager.enabled) {\n          ConsoleCaptureManager.enable();\n        }\n\n        // \n        localStorage.setItem('acu_script_error_detected', 'true');\n\n        // \n        this.showEmergencyButton();\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    showEmergencyButton() {\n      try {\n        // \n        let btn = document.getElementById('acu-emergency-debug-btn');\n        if (btn) {\n          btn.style.display = 'block';\n          return;\n        }\n\n        // \n        btn = document.createElement('button');\n        btn.id = 'acu-emergency-debug-btn';\n        btn.innerHTML = '<i class=\"fa-solid fa-bug\"></i> ';\n        btn.style.cssText = `\n          position: fixed;\n          bottom: 20px;\n          right: 20px;\n          z-index: 99999;\n          padding: 10px 16px;\n          background: #e74c3c;\n          color: #fff;\n          border: none;\n          border-radius: 6px;\n          font-size: 14px;\n          font-weight: bold;\n          cursor: pointer;\n          box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);\n          display: flex;\n          align-items: center;\n          gap: 6px;\n          transition: all 0.2s;\n        `;\n\n        btn.onmouseenter = function () {\n          this.style.background = '#c0392b';\n          this.style.transform = 'scale(1.05)';\n        };\n        btn.onmouseleave = function () {\n          this.style.background = '#e74c3c';\n          this.style.transform = 'scale(1)';\n        };\n\n        btn.onclick = function () {\n          try {\n            //  showDebugConsoleModal\n            if (typeof window.showDebugConsoleModal === 'function') {\n              window.showDebugConsoleModal();\n            } else {\n              // \n              alert('F12');\n            }\n          } catch (e) {\n            console.error('[DICE]:', e);\n            alert('F12');\n          }\n        };\n\n        document.body.appendChild(btn);\n      } catch (e) {\n        console.error('[DICE]:', e);\n      }\n    },\n\n    // \n    checkAndRestore() {\n      try {\n        const errorDetected = localStorage.getItem('acu_script_error_detected') === 'true';\n        if (errorDetected) {\n          //  console \n          if (!ConsoleCaptureManager.enabled) {\n            ConsoleCaptureManager.enable();\n          }\n          // \n          this.showEmergencyButton();\n        }\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n  };\n\n  // \n  window.onerror = function (message, source, lineno, colno, error) {\n    ErrorHandler.handleError(error || message, source, lineno, colno, error?.stack);\n    return false; // \n  };\n\n  //  Promise \n  window.addEventListener('unhandledrejection', function (event) {\n    ErrorHandler.handleError(event.reason, null, null, null, event.reason?.stack);\n  });\n\n  // \n  //  init \n\n  // ========================================\n  //  -  (Phase 1.1)\n  // ========================================\n\n  /**\n   * \n   * - replace: \n   * - extract: ()\n   * - delete: \n   * - validate: (ValidationEngine,)\n   */\n  type RegexOperation = 'replace' | 'extract' | 'delete' | 'validate';\n\n  /**\n   * \n   * - global: \n   * - table: \n   * - column: \n   */\n  type RegexScopeType = 'global' | 'table' | 'column';\n\n  /**\n   * \n   * - auto: \n   * - manual: \n   * - preview: ,\n   */\n  type RegexExecutionMode = 'auto' | 'manual' | 'preview';\n\n  /**\n   * \n   */\n  interface RegexFlags {\n    caseInsensitive?: boolean; // i - \n    global?: boolean; // g - \n    multiline?: boolean; // m - \n    unicode?: boolean; // u - Unicode\n    sticky?: boolean; // y - \n  }\n\n  /**\n   * \n   */\n  interface RegexScopeConfig {\n    type: RegexScopeType;\n    tableNames?: string[]; // tablecolumn\n    columnNames?: string[]; // column\n  }\n\n  /**\n   * \n   */\n  interface RegexSecurityConfig {\n    maxMatchTime: number; // (),100\n    maxMatches: number; // ,1000\n    maxInputLength: number; // ,10000\n  }\n\n  /**\n   * \n   */\n  interface RegexTestCase {\n    input: string;\n    expected: string;\n    description?: string;\n  }\n\n  /**\n   * \n   */\n  interface RegexTransformationRule {\n    id: string; // \n    name: string; // \n    description?: string; // \n    operation: RegexOperation; // \n    pattern: string; // \n    flags?: RegexFlags; // \n    replacement?: string; // (replace)\n    scope: RegexScopeConfig; // \n    enabled: boolean; // \n    priority: number; // (1-100),\n    executeMode: RegexExecutionMode; // \n    testCases?: RegexTestCase[]; // \n    security?: RegexSecurityConfig; // \n    createdAt?: number; // \n    updatedAt?: number; // \n  }\n\n  /**\n   * \n   */\n  interface RegexTransformResult {\n    success: boolean;\n    oldValue: string;\n    newValue: string;\n    matched: boolean;\n    error?: string;\n  }\n\n  /**\n   * \n   */\n  interface RegexBatchTransformResult {\n    tableName: string;\n    columnIndex: number;\n    rowIndex: number;\n    result: RegexTransformResult;\n  }\n\n  /**\n   * \n   */\n  interface RegexPreviewResult {\n    rule: RegexTransformationRule;\n    affectedCells: Array<{\n      tableName: string;\n      rowIndex: number;\n      columnIndex: number;\n      columnName: string;\n      oldValue: string;\n      newValue: string;\n    }>;\n    totalAffected: number;\n  }\n\n  /**\n   * \n   */\n  interface RegexPreset {\n    id: string;\n    name: string;\n    description?: string;\n    version: string;\n    rules: RegexTransformationRule[];\n    createdAt?: number;\n    updatedAt?: number;\n  }\n\n  // \n  const STORAGE_KEY_REGEX_RULES = 'acu_regex_rules_v1';\n  const STORAGE_KEY_REGEX_PRESETS = 'acu_regex_presets_v1';\n  const STORAGE_KEY_REGEX_ACTIVE_PRESET = 'acu_regex_active_preset_v1';\n  const STORAGE_KEY_REGEX_ENABLED = 'acu_regex_enabled_v1';\n\n  // ========================================\n  //  (Tavern Regex Import)\n  // ========================================\n\n  /**\n   * \n   * @see https://docs.sillytavern.app/usage/core-concepts/regex/\n   */\n  interface TavernRegex {\n    id?: string;\n    scriptName: string;\n    findRegex: string;\n    replaceString: string;\n    trimStrings?: string[];\n    placement?: number[];\n    disabled?: boolean;\n    markdownOnly?: boolean;\n    promptOnly?: boolean;\n    runOnEdit?: boolean;\n    substituteRegex?: number;\n    minDepth?: number | null;\n    maxDepth?: number | null;\n  }\n\n  /**\n   *  findRegex \n   * : /pattern/flags\n   */\n  function parseTavernFindRegex(findRegex: string): { pattern: string; flags: RegexFlags } {\n    //  /pattern/flags \n    const match = findRegex.match(/^\\/(.+)\\/([gimsuy]*)$/s);\n    if (match) {\n      const [, pattern, flagStr] = match;\n      return {\n        pattern,\n        flags: {\n          global: flagStr.includes('g'),\n          caseInsensitive: flagStr.includes('i'),\n          multiline: flagStr.includes('m'),\n          unicode: flagStr.includes('u'),\n          sticky: flagStr.includes('y'),\n        },\n      };\n    }\n    // pattern\n    return { pattern: findRegex, flags: { global: true } };\n  }\n\n  /**\n   *  RegexTransformationRule\n   */\n  function convertTavernRegexToRule(tavernRegex: TavernRegex): RegexTransformationRule {\n    const { pattern, flags } = parseTavernFindRegex(tavernRegex.findRegex);\n\n    // \n    const extraInfo: string[] = [];\n    if (tavernRegex.placement?.length) extraInfo.push(`placement: [${tavernRegex.placement.join(',')}]`);\n    if (tavernRegex.markdownOnly) extraInfo.push('markdownOnly');\n    if (tavernRegex.promptOnly) extraInfo.push('promptOnly');\n    if (tavernRegex.minDepth != null) extraInfo.push(`minDepth: ${tavernRegex.minDepth}`);\n    if (tavernRegex.maxDepth != null) extraInfo.push(`maxDepth: ${tavernRegex.maxDepth}`);\n\n    const description = extraInfo.length > 0 ? `[] ${extraInfo.join(', ')}` : '[]';\n\n    return {\n      id: `tavern_import_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      name: tavernRegex.scriptName,\n      description,\n      operation: 'replace',\n      pattern,\n      flags,\n      replacement: tavernRegex.replaceString || '',\n      scope: { type: 'global' },\n      enabled: !tavernRegex.disabled,\n      priority: 50,\n      executeMode: tavernRegex.runOnEdit ? 'auto' : 'manual',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    };\n  }\n\n  // ========================================\n  //  (Phase 2.2)\n  // ========================================\n  const BUILTIN_REGEX_RULES: RegexTransformationRule[] = [\n    // 1: ()\n    {\n      id: 'builtin_trim_spaces',\n      name: '',\n      description: ',',\n      operation: 'replace',\n      pattern: '^\\\\s+|\\\\s+$|\\\\s+',\n      flags: { global: true },\n      replacement: ' ',\n      scope: { type: 'global' },\n      enabled: false,\n      priority: 10,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // 2: ()\n    {\n      id: 'builtin_normalize_quotes',\n      name: '',\n      description: '',\n      operation: 'replace',\n      pattern: '[\"]|[\\']',\n      flags: { global: true },\n      replacement: '\"',\n      scope: { type: 'global' },\n      enabled: false,\n      priority: 10,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // 3: ()\n    {\n      id: 'builtin_item_quality_format',\n      name: '',\n      description: '',\n      operation: 'replace',\n      pattern: '\\\\b(|||||)\\\\b',\n      flags: { global: true },\n      replacement: '$1',\n      scope: { type: 'column', tableNames: ['', ''], columnNames: [''] },\n      enabled: false,\n      priority: 50,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n  ];\n\n  // ========================================\n  // ValidationRuleManager - \n  // ========================================\n  const STORAGE_KEY_VALIDATION_RULES = 'acu_validation_rules_v1';\n  const STORAGE_KEY_VALIDATION_ENABLED = 'acu_validation_enabled_v1';\n  const STORAGE_KEY_VALIDATION_MODE = 'acu_validation_mode'; // \n\n  //  UI \n  const RULE_TYPE_INFO = {\n    // \n    tableReadonly: { name: '', scope: 'table', icon: 'fa-lock', desc: '' },\n    rowLimit: { name: '', scope: 'table', icon: 'fa-arrows-up-down', desc: '' },\n    sequence: { name: '', scope: 'table', icon: 'fa-sort-numeric-up', desc: '' },\n    // \n    required: { name: '', scope: 'field', icon: 'fa-asterisk', desc: '' },\n    format: { name: '', scope: 'field', icon: 'fa-font', desc: '' },\n    enum: { name: '', scope: 'field', icon: 'fa-list', desc: '' },\n    numeric: { name: '', scope: 'field', icon: 'fa-hashtag', desc: '' },\n    relation: { name: '', scope: 'field', icon: 'fa-link', desc: '' },\n    keyValue: { name: '', scope: 'field', icon: 'fa-key', desc: '' },\n  };\n\n  // \n  const BUILTIN_VALIDATION_RULES = [\n    // \n    {\n      id: 'summary_code_sequence',\n      name: '',\n      description: 'AM0001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM0001',\n    },\n    // \n    {\n      id: 'outline_code_sequence',\n      name: '',\n      description: 'AM0001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM0001',\n    },\n    // \n    {\n      id: 'summary_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'outline_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_priority_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'item_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_proficiency_range',\n      name: '',\n      description: ' 0-100 ',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'numeric',\n      config: { min: 0, max: 100 },\n      errorMessage: ' 0-100 ',\n    },\n    // \n    {\n      id: 'npc_presence_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_explore_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'intel_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'player_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // NPC\n    {\n      id: 'npc_location_relation',\n      name: 'NPC',\n      description: 'NPC',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'element_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'global_detail_location_relation',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    //  - \n    {\n      id: 'player_base_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_special_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_relationships_keyvalue',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    //  - \n    {\n      id: 'npc_base_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_special_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_relationships_keyvalue',\n      name: 'NPC',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    //  - \n    {\n      id: 'quest_progress_format',\n      name: '',\n      description: '+%50%',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'format',\n      config: { pattern: '^\\\\d+%$' },\n      errorMessage: '+%50%100%',\n    },\n  ];\n\n  // ========================================\n  // BlacklistManager - MVU\n  // ========================================\n  const STORAGE_KEY_BLACKLIST = 'acu_filter_blacklist_v1';\n  const STORAGE_KEY_BLACKLIST_VERSION = 'acu_filter_blacklist_version';\n  const DEFAULT_BLACKLIST = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    'ID',\n    '',\n    '',\n    'measurements',\n    'ages',\n    '',\n    'order',\n    '',\n    'time',\n    'cost',\n  ];\n\n  const BlacklistManager = {\n    // \n    getBlacklist() {\n      const stored = Store.get(STORAGE_KEY_BLACKLIST, null);\n      const storedVersion = Store.get(STORAGE_KEY_BLACKLIST_VERSION, null);\n\n      // \n      if (!stored || !Array.isArray(stored)) {\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return [...DEFAULT_BLACKLIST];\n      }\n\n      // \n      if (!storedVersion || compareVersion(storedVersion, PRESET_FORMAT_VERSION) < 0) {\n        console.log(`[DICE]BlacklistManager  (${storedVersion || ''})`);\n\n        // \n        const userItems = new Set(stored);\n        const defaultItems = new Set(DEFAULT_BLACKLIST);\n        const mergedItems = [...DEFAULT_BLACKLIST]; // \n\n        // \n        stored.forEach(item => {\n          if (!defaultItems.has(item)) {\n            mergedItems.push(item);\n          }\n        });\n\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, mergedItems);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return mergedItems;\n      }\n\n      return stored;\n    },\n\n    // \n    setBlacklist(list) {\n      if (!Array.isArray(list)) {\n        console.warn('[DICE]BlacklistManager ');\n        return false;\n      }\n      Store.set(STORAGE_KEY_BLACKLIST, list);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // \n    resetToDefault() {\n      Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // key\n    //  \" >  >  > \" \"\"\n    isBlacklisted(key) {\n      if (!key || typeof key !== 'string') return false;\n      const blacklist = this.getBlacklist();\n      if (blacklist.length === 0) return false;\n\n      // key \">\"  \" > \"\n      const parts = key\n        .split(/>| > /)\n        .map(s => s.trim())\n        .filter(s => s);\n      const lastPart = parts.length > 0 ? parts[parts.length - 1] : key;\n\n      // key\n      return blacklist.some(item => lastPart.includes(item));\n    },\n  };\n\n  // ========================================\n  // PresetManager - \n  // ========================================\n  const STORAGE_KEY_PRESETS = 'acu_validation_presets_v1';\n  const STORAGE_KEY_ACTIVE_PRESET = 'acu_active_preset_id';\n\n  const PresetManager = {\n    _cache: null,\n\n    // \n    getAllPresets() {\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n      if (!stored) {\n        this._initDefaultPreset();\n        return this._cache;\n      }\n      // \n      let needsSave = false;\n      stored.forEach(preset => {\n        if (!preset.version || this._compareVersion(preset.version, PRESET_FORMAT_VERSION) < 0) {\n          console.log(\n            `[DICE]PresetManager  \"${preset.name}\"  (${preset.version || ''})`,\n          );\n          // \n          const customRules = preset.rules.filter(r => !r.builtin);\n          const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n          const mergedRules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r, builtin: true }))];\n          customRules.forEach(rule => {\n            const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n            if (!builtinRuleIds.has(key)) {\n              mergedRules.push({ ...rule, builtin: false });\n            }\n          });\n          preset.rules = mergedRules;\n          preset.version = PRESET_FORMAT_VERSION;\n          needsSave = true;\n        }\n      });\n      if (needsSave) {\n        this._save(stored);\n        ValidationRuleManager.clearCache();\n        // \n        this._cache = null;\n      }\n      // \n      if (!needsSave && this._cache) {\n        return this._cache;\n      }\n      this._cache = stored;\n      return stored;\n    },\n\n    // \n    getActivePreset() {\n      const presets = this.getAllPresets();\n      const activeId = Store.get(STORAGE_KEY_ACTIVE_PRESET, 'default');\n      return presets.find(p => p.id === activeId) || presets[0];\n    },\n\n    // \n    setActivePreset(id) {\n      if (!this.getAllPresets().find(p => p.id === id)) return false;\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, id);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    createPreset(name) {\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: name || '',\n        builtin: false,\n        rules: [],\n        version: PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    duplicatePreset(id) {\n      const source = this.getAllPresets().find(p => p.id === id);\n      if (!source) return null;\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: source.name + ' ()',\n        builtin: false,\n        rules: JSON.parse(JSON.stringify(source.rules)),\n        version: source.version || PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      console.log('[DICE]PresetManager :', source.name, '->', newPreset.name);\n      return newPreset;\n    },\n\n    //  id='default' \n    deletePreset(id) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset || preset.id === 'default') return false; // \n      const filtered = presets.filter(p => p.id !== id);\n      this._save(filtered);\n      if (Store.get(STORAGE_KEY_ACTIVE_PRESET) === id) {\n        Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n        ValidationRuleManager.clearCache();\n      }\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    updatePresetRules(id, rules) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return false;\n      preset.rules = rules;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      return true;\n    },\n\n    // \n    exportPreset(id) {\n      const preset = this.getAllPresets().find(p => p.id === id);\n      if (!preset) return null;\n      const json = JSON.stringify(\n        {\n          format: 'acu_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          preset: { name: preset.name, rules: preset.rules },\n        },\n        null,\n        2,\n      );\n      return json;\n    },\n\n    // \n    _compareVersion(v1, v2) {\n      return compareVersion(v1, v2);\n    },\n\n    // \n    mergePresetWithDefaults(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) return false;\n\n      // \n      const customRules = preset.rules.filter(r => !r.builtin);\n      const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n\n      // \n      const builtinRuleMap = new Map();\n      BUILTIN_VALIDATION_RULES.forEach(r => {\n        const key = r.id || r.targetTable + '_' + r.ruleType;\n        builtinRuleMap.set(key, r);\n      });\n\n      // \n      const mergedRules = [];\n      const processedCustomIds = new Set();\n\n      // 1. \n      BUILTIN_VALIDATION_RULES.forEach(newRule => {\n        const key = newRule.id || newRule.targetTable + '_' + newRule.ruleType;\n        const existingRule = preset.rules.find(r => (r.id || r.targetTable + '_' + r.ruleType) === key && r.builtin);\n        if (existingRule) {\n          // \n          const isModified = JSON.stringify(existingRule) !== JSON.stringify(newRule);\n          if (isModified) {\n            // \n            mergedRules.push({ ...existingRule, builtin: true });\n          } else {\n            // \n            mergedRules.push({ ...newRule, builtin: true });\n          }\n        } else {\n          // \n          mergedRules.push({ ...newRule, builtin: true });\n        }\n        processedCustomIds.add(key);\n      });\n\n      // 2. \n      customRules.forEach(rule => {\n        const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n        if (!builtinRuleIds.has(key)) {\n          mergedRules.push({ ...rule, builtin: false });\n        }\n      });\n\n      preset.rules = mergedRules;\n      preset.version = PRESET_FORMAT_VERSION;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', preset.name);\n      return true;\n    },\n\n    // \n    importPreset(json, autoMerge = false) {\n      try {\n        const data = JSON.parse(json);\n        if (data.format !== 'acu_preset_v1' || !data.preset) return null;\n\n        const importedVersion = data.version || '0.0.0';\n        const needsMerge = this._compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n        const presets = this.getAllPresets();\n        const newPreset = {\n          id: 'imported_' + Date.now(),\n          name: data.preset.name || '',\n          builtin: false,\n          rules: data.preset.rules || [],\n          version: importedVersion,\n          createdAt: new Date().toISOString(),\n        };\n\n        // \n        if (needsMerge && autoMerge) {\n          presets.push(newPreset);\n          this._save(presets);\n          this.mergePresetWithDefaults(newPreset.id);\n          console.log('[DICE]PresetManager :', newPreset.name);\n        } else {\n          presets.push(newPreset);\n          this._save(presets);\n          console.log('[DICE]PresetManager :', newPreset.name);\n          if (needsMerge) {\n            console.warn('[DICE]PresetManager  mergePresetWithDefaults ');\n          }\n        }\n\n        return { preset: newPreset, needsMerge: needsMerge && !autoMerge };\n      } catch (e) {\n        console.error('[DICE]PresetManager :', e);\n        return null;\n      }\n    },\n\n    // \n    _getBuiltinRulesVersion() {\n      try {\n        const rulesStr = JSON.stringify(BUILTIN_VALIDATION_RULES);\n        // \n        let hash = 0;\n        for (let i = 0; i < rulesStr.length; i++) {\n          const char = rulesStr.charCodeAt(i);\n          hash = (hash << 5) - hash + char;\n          hash = hash & hash; // Convert to 32bit integer\n        }\n        return hash.toString(36);\n      } catch (e) {\n        console.error('[DICE]PresetManager :', e);\n        return '0';\n      }\n    },\n\n    // \n    _initDefaultPreset() {\n      const currentVersion = this._getBuiltinRulesVersion();\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n\n      // \n      if (stored && Array.isArray(stored)) {\n        const defaultPreset = stored.find(p => p.id === 'default');\n        if (defaultPreset && defaultPreset._builtinVersion !== currentVersion) {\n          console.log('[DICE]PresetManager ');\n          // \n          const customRules = defaultPreset.rules.filter(r => !r.builtin);\n          defaultPreset.rules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r })), ...customRules];\n          defaultPreset._builtinVersion = currentVersion;\n          this._cache = stored;\n          this._save(stored);\n          Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n          return;\n        }\n      }\n\n      const defaultPreset = {\n        id: 'default',\n        name: '',\n        builtin: true,\n        rules: BUILTIN_VALIDATION_RULES.map(r => ({ ...r })),\n        version: PRESET_FORMAT_VERSION,\n        _builtinVersion: currentVersion,\n        createdAt: new Date().toISOString(),\n      };\n      // \n      const oldCustom = Store.get(STORAGE_KEY_VALIDATION_RULES, []);\n      if (oldCustom.length > 0) {\n        defaultPreset.rules.push(...oldCustom.map(r => ({ ...r, builtin: false })));\n        console.log('[DICE]PresetManager :', oldCustom.length, '');\n      }\n      this._cache = [defaultPreset];\n      this._save(this._cache);\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n    },\n\n    // \n    resetDefaultPreset() {\n      const presets = this.getAllPresets();\n      const defaultPreset = presets.find(p => p.id === 'default');\n      if (defaultPreset) {\n        // \n        const customRules = defaultPreset.rules.filter(r => !r.builtin);\n        defaultPreset.rules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r })), ...customRules];\n        defaultPreset._builtinVersion = this._getBuiltinRulesVersion();\n        this._save(presets);\n        ValidationRuleManager.clearCache();\n        return true;\n      }\n      return false;\n    },\n\n    _save(presets) {\n      Store.set(STORAGE_KEY_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  //  PresetManager \n  const ValidationRuleManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const preset = PresetManager.getActivePreset();\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = (preset?.rules || []).map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_VALIDATION_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n      this._cache = null; // \n    },\n\n    // \n    toggleRuleIntercept(ruleId, intercept) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const rule = preset.rules.find(r => r.id === ruleId);\n      if (!rule) return false;\n\n      rule.intercept = intercept;\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled);\n    },\n\n    // \n    addCustomRule(rule) {\n      if (!rule.id || !rule.name || !rule.targetTable) {\n        console.error('[DICE]ValidationRuleManager ');\n        return false;\n      }\n\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      //  ID \n      if (preset.rules.some(r => r.id === rule.id)) {\n        console.error('[DICE]ValidationRuleManager  ID :', rule.id);\n        return false;\n      }\n\n      const newRule = { ...rule, builtin: false, enabled: true };\n      preset.rules.push(newRule);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      console.log('[DICE]ValidationRuleManager :', newRule.name);\n      return true;\n    },\n\n    // \n    removeCustomRule(ruleId) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules.splice(index, 1);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n\n      // \n      const states = this.getEnabledStates();\n      delete states[ruleId];\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n\n      console.log('[DICE]ValidationRuleManager :', ruleId);\n      return true;\n    },\n\n    // \n    updateCustomRule(ruleId, updates) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules[index] = { ...preset.rules[index], ...updates, id: ruleId };\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getRule(ruleId) {\n      return this.getAllRules().find(r => r.id === ruleId);\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n\n    // \n    getRulesByTable(tableName) {\n      return this.getEnabledRules().filter(rule => rule.targetTable === tableName);\n    },\n  };\n\n  // ========================================\n  // RegexTransformationManager -  (Phase 1.2)\n  // ========================================\n  const RegexTransformationManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // ID\n    _generateId() {\n      return `regex_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    },\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = rules.map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_REGEX_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    _saveEnabledStates(states) {\n      Store.set(STORAGE_KEY_REGEX_ENABLED, states);\n      this._enabledCache = states;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled !== false);\n    },\n\n    // \n    getApplicableRules(tableName, columnName) {\n      const allRules = this.getEnabledRules();\n\n      return allRules\n        .filter(rule => {\n          // \n          switch (rule.scope.type) {\n            case 'global':\n              return true;\n            case 'table':\n              return rule.scope.tableNames && rule.scope.tableNames.includes(tableName);\n            case 'column':\n              return (\n                rule.scope.tableNames &&\n                rule.scope.tableNames.includes(tableName) &&\n                rule.scope.columnNames &&\n                rule.scope.columnNames.includes(columnName)\n              );\n            default:\n              return false;\n          }\n        })\n        .sort((a, b) => b.priority - a.priority); // \n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      this._saveEnabledStates(states);\n      this.clearCache();\n    },\n\n    // \n    addCustomRule(rule) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n\n      // \n      if (!rule.name || !rule.pattern || !rule.scope) {\n        console.error('[DICE]RegexTransformationManager: ');\n        return false;\n      }\n\n      const newRule: RegexTransformationRule = {\n        id: this._generateId(),\n        name: rule.name,\n        description: rule.description,\n        operation: rule.operation || 'replace',\n        pattern: rule.pattern,\n        flags: rule.flags || {},\n        replacement: rule.replacement,\n        scope: rule.scope,\n        enabled: rule.enabled !== undefined ? rule.enabled : true,\n        priority: rule.priority || 50,\n        executeMode: rule.executeMode || 'auto',\n        testCases: rule.testCases || [],\n        security: rule.security || { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      rules.push(newRule);\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n\n      // \n      this._syncRulesToActivePreset();\n\n      return newRule;\n    },\n\n    // \n    _syncRulesToActivePreset() {\n      const activePreset = RegexPresetManager.getActivePreset();\n      if (activePreset) {\n        const allRules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n        RegexPresetManager.updatePresetRules(activePreset.id, allRules);\n      }\n    },\n\n    // \n    removeRule(ruleId) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const index = rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      rules.splice(index, 1);\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n\n      // \n      this._syncRulesToActivePreset();\n\n      return true;\n    },\n\n    // \n    updateRule(ruleId, updates) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const index = rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      rules[index] = {\n        ...rules[index],\n        ...updates,\n        id: ruleId,\n        updatedAt: Date.now(),\n      };\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n\n      // \n      this._syncRulesToActivePreset();\n\n      return true;\n    },\n\n    // \n    getRule(ruleId) {\n      return this.getAllRules().find(r => r.id === ruleId);\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n  };\n\n  // ========================================\n  // RegexPresetManager -  (Phase 1.3)\n  // ========================================\n  const RegexPresetManager = {\n    _cache: null,\n\n    // \n    getAllPresets() {\n      if (this._cache) return this._cache;\n\n      const presets = Store.get(STORAGE_KEY_REGEX_PRESETS, []);\n\n      // \n      if (presets.length === 0) {\n        const defaultPreset: RegexPreset = {\n          id: 'regex_default',\n          name: '',\n          description: '',\n          version: '1.0.0',\n          rules: [],\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n        presets.push(defaultPreset);\n        Store.set(STORAGE_KEY_REGEX_PRESETS, presets);\n      }\n\n      this._cache = presets;\n      return presets;\n    },\n\n    // \n    getActivePreset() {\n      const activeId = Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET, 'regex_default');\n      const presets = this.getAllPresets();\n      return presets.find(p => p.id === activeId) || presets[0];\n    },\n\n    // \n    setActivePreset(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) {\n        console.error('[DICE]RegexPresetManager: ', presetId);\n        return false;\n      }\n\n      Store.set(STORAGE_KEY_REGEX_ACTIVE_PRESET, presetId);\n\n      // RegexTransformationManager\n      RegexTransformationManager.clearCache();\n\n      return true;\n    },\n\n    // \n    createPreset(name, sourcePresetId) {\n      const presets = this.getAllPresets();\n\n      // \n      if (presets.some(p => p.name === name)) {\n        console.error('[DICE]RegexPresetManager: ', name);\n        return false;\n      }\n\n      const sourcePreset = sourcePresetId ? presets.find(p => p.id === sourcePresetId) : this.getActivePreset();\n\n      const newPreset: RegexPreset = {\n        id: `regex_preset_${Date.now()}`,\n        name: name,\n        description: sourcePreset?.description,\n        version: '1.0.0',\n        rules: sourcePreset ? JSON.parse(JSON.stringify(sourcePreset.rules)) : [],\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    updatePresetRules(presetId, rules) {\n      const presets = this.getAllPresets();\n      const index = presets.findIndex(p => p.id === presetId);\n      if (index === -1) return false;\n\n      presets[index].rules = JSON.parse(JSON.stringify(rules));\n      presets[index].updatedAt = Date.now();\n\n      this._save(presets);\n\n      // ,\n      if (presetId === Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET)) {\n        RegexTransformationManager.clearCache();\n      }\n\n      return true;\n    },\n\n    // \n    deletePreset(presetId) {\n      const presets = this.getAllPresets();\n\n      // \n      if (presets.length <= 1) {\n        console.error('[DICE]RegexPresetManager: ');\n        return false;\n      }\n\n      const index = presets.findIndex(p => p.id === presetId);\n      if (index === -1) return false;\n\n      presets.splice(index, 1);\n      this._save(presets);\n\n      // ,\n      if (presetId === Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET)) {\n        this.setActivePreset(presets[0].id);\n      }\n\n      return true;\n    },\n\n    // JSON\n    exportPreset(presetId) {\n      const preset = this.getAllPresets().find(p => p.id === presetId);\n      if (!preset) return null;\n\n      // \n      const activePreset = this.getActivePreset();\n      const isActivePreset = activePreset && activePreset.id === presetId;\n      const rules = isActivePreset ? Store.get(STORAGE_KEY_REGEX_RULES, []) : preset.rules;\n\n      const exportData = {\n        ...preset,\n        rules: rules,\n      };\n\n      return JSON.stringify(exportData, null, 2);\n    },\n\n    // JSON\n    importPreset(jsonString) {\n      try {\n        const data = JSON.parse(jsonString);\n\n        // \n        if (!data.name || !Array.isArray(data.rules)) {\n          console.error('[DICE]RegexPresetManager: ');\n          return false;\n        }\n\n        const presets = this.getAllPresets();\n\n        // ID\n        const newPreset: RegexPreset = {\n          id: `regex_preset_${Date.now()}`,\n          name: data.name,\n          description: data.description,\n          version: data.version || '1.0.0',\n          rules: data.rules.map((rule: RegexTransformationRule) => ({\n            ...rule,\n            id: RegexTransformationManager._generateId(),\n          })),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n\n        presets.push(newPreset);\n        this._save(presets);\n        return newPreset;\n      } catch (e) {\n        console.error('[DICE]RegexPresetManager: ', e);\n        return false;\n      }\n    },\n\n    // \n    _save(presets) {\n      Store.set(STORAGE_KEY_REGEX_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  // ========================================\n  // RegexTransformationEngine -  (Phase 2.1)\n  // ========================================\n  const RegexTransformationEngine = {\n    // \n    _regexCache: new Map<string, RegExp>(),\n\n    // \n    _buildFlags(flags: RegexFlags): string {\n      const result: string[] = [];\n      if (flags.caseInsensitive) result.push('i');\n      if (flags.global) result.push('g');\n      if (flags.multiline) result.push('m');\n      if (flags.unicode) result.push('u');\n      if (flags.sticky) result.push('y');\n      return result.join('');\n    },\n\n    // ()\n    _getRegex(pattern: string, flags: RegexFlags): RegExp | null {\n      //  unicode \n      const hasLookbehind = pattern.includes('(?<') || pattern.includes('(?<=');\n      const hasLookahead = pattern.includes('(?=') || pattern.includes('(?!');\n      const needsUnicode = hasLookbehind || hasLookahead;\n\n      //  unicode \n      if (needsUnicode && !flags.unicode) {\n        flags = { ...flags, unicode: true };\n      }\n\n      const flagsStr = this._buildFlags(flags);\n      const cacheKey = `${pattern}/${flagsStr}`;\n\n      if (this._regexCache.has(cacheKey)) {\n        const regex = this._regexCache.get(cacheKey)!;\n        regex.lastIndex = 0;\n        return regex;\n      }\n\n      try {\n        const regex = new RegExp(pattern, flagsStr);\n        this._regexCache.set(cacheKey, regex);\n        return regex;\n      } catch (e) {\n        console.error('[DICE]RegexTransformationEngine: ', pattern, e);\n        return null;\n      }\n    },\n\n    // ReDoS: \n    _scoreRegexComplexity(pattern: string): number {\n      let score = 0;\n\n      //  +50\n      if (/(\\*|\\+|\\{)\\1{2,}/.test(pattern)) score += 50;\n\n      //  +30\n      if (/(\\.\\*|\\.\\+)[^\\[]*\\1/.test(pattern)) score += 30;\n\n      //  +10\n      const captureGroups = (pattern.match(/\\(/g) || []).length;\n      score += Math.min(captureGroups * 5, 20);\n\n      return score;\n    },\n\n    // ReDoS: \n    _getTimeoutForRule(rule: RegexTransformationRule): number {\n      const complexity = this._scoreRegexComplexity(rule.pattern);\n      const baseTimeout = rule.security?.maxMatchTime || 100;\n      // ,\n      return Math.max(baseTimeout - complexity * 2, 50);\n    },\n\n    // \n    _safeReplace(value: string, rule: RegexTransformationRule, regex: RegExp): RegexTransformResult {\n      const oldValue = value;\n\n      // \n      const maxInputLength = rule.security?.maxInputLength || 10000;\n      if (value.length > maxInputLength) {\n        return {\n          success: false,\n          oldValue,\n          newValue: oldValue,\n          matched: false,\n          error: `(${maxInputLength})`,\n        };\n      }\n\n      try {\n        const timeout = this._getTimeoutForRule(rule);\n        const startTime = Date.now();\n\n        // \n        let newValue: string;\n        switch (rule.operation) {\n          case 'replace':\n            newValue = value.replace(regex, rule.replacement || '');\n            break;\n          case 'delete':\n            newValue = value.replace(regex, '');\n            break;\n          case 'validate':\n            const isValid = regex.test(value);\n            newValue = value;\n            break;\n          default:\n            newValue = value;\n        }\n\n        // \n        const elapsed = Date.now() - startTime;\n        if (elapsed > timeout) {\n          console.warn('[DICE]RegexTransformationEngine: ', rule.pattern, elapsed);\n          return {\n            success: false,\n            oldValue,\n            newValue: oldValue,\n            matched: false,\n            error: `(${elapsed}ms > ${timeout}ms)`,\n          };\n        }\n\n        // \n        const matched = oldValue !== newValue || regex.test(oldValue);\n\n        return {\n          success: true,\n          oldValue,\n          newValue,\n          matched,\n        };\n      } catch (e) {\n        console.error('[DICE]RegexTransformationEngine: ', rule.pattern, e);\n        return {\n          success: false,\n          oldValue,\n          newValue: oldValue,\n          matched: false,\n          error: String(e),\n        };\n      }\n    },\n\n    // \n    applyToValue(value: string, rule: RegexTransformationRule): RegexTransformResult {\n      if (value === null || value === undefined) {\n        return {\n          success: true,\n          oldValue: '',\n          newValue: '',\n          matched: false,\n        };\n      }\n\n      const strValue = String(value);\n\n      //  pattern  flags /pattern/flags\n      let pattern = rule.pattern;\n      let flags = rule.flags || {};\n\n      //  /pattern/flags \n      const extracted = this._extractFlags(pattern);\n      if (extracted.patternWithoutFlags !== pattern) {\n        //  pattern  flags\n        pattern = extracted.patternWithoutFlags;\n        flags = { ...flags, ...extracted.flags };\n      }\n\n      // \n      //  flags  global true\n      if (flags.global === undefined) {\n        flags.global = true;\n      }\n\n      const regex = this._getRegex(pattern, flags);\n\n      if (!regex) {\n        return {\n          success: false,\n          oldValue: strValue,\n          newValue: strValue,\n          matched: false,\n          error: '',\n        };\n      }\n\n      return this._safeReplace(strValue, rule, regex);\n    },\n\n    // flags (: /test/g  'g')\n    _extractFlags(patternStr: string): { flags: RegexFlags; patternWithoutFlags: string } {\n      const flags: RegexFlags = {\n        global: false,\n        caseInsensitive: false,\n        multiline: false,\n        unicode: false,\n        sticky: false,\n      };\n\n      //  /pattern/flags \n      const inlineFlagMatch = patternStr.match(/^\\/(.+)\\/([gimuy]*)$/);\n      if (inlineFlagMatch) {\n        const [, patternWithoutFlags, flagStr] = inlineFlagMatch;\n        if (flagStr.includes('g')) flags.global = true;\n        if (flagStr.includes('i')) flags.caseInsensitive = true;\n        if (flagStr.includes('m')) flags.multiline = true;\n        if (flagStr.includes('u')) flags.unicode = true;\n        if (flagStr.includes('y')) flags.sticky = true;\n        return { flags, patternWithoutFlags };\n      }\n\n      // flags\n      return { flags, patternWithoutFlags: patternStr };\n    },\n\n    // \n    applyToTable(\n      tableData:\n        | { name: string; headers: string[]; rows: string[][] }\n        | { [key: string]: { name?: string; content?: string[][] } },\n      rules: RegexTransformationRule[],\n    ): { totalApplied: number; errors: string[] } {\n      let totalApplied = 0;\n      const errors: string[] = [];\n\n      try {\n        // \n        let isSimpleFormat = false;\n        let sheetMap: Map<\n          string,\n          { sheet: any; sheetKey: string; name: string; headers: string[]; contentRowIndex: number }\n        > = new Map();\n\n        if ('name' in tableData && 'headers' in tableData && 'rows' in tableData) {\n          // : { name, headers, rows }\n          isSimpleFormat = true;\n          const simpleTable = tableData as { name: string; headers: string[]; rows: string[][] };\n          sheetMap.set(simpleTable.name, {\n            sheet: simpleTable,\n            sheetKey: simpleTable.name,\n            name: simpleTable.name,\n            headers: simpleTable.headers,\n            contentRowIndex: -1, //  contentRowIndex\n          });\n        } else {\n          // : { sheet_xxx: { name, content: [headers, ...rows] } }\n          const dataObj = tableData as { [key: string]: { name?: string; content?: string[][] } };\n\n          Object.keys(dataObj).forEach(sheetKey => {\n            if (!sheetKey.startsWith('sheet_')) return;\n\n            const sheet = dataObj[sheetKey];\n            if (!sheet || !sheet.content || !Array.isArray(sheet.content) || sheet.content.length < 1) {\n              console.warn(`[DICE]applyToTable:  ${sheetKey}`);\n              return;\n            }\n\n            const tableName = sheet.name || sheetKey;\n            sheetMap.set(tableName, {\n              sheet,\n              sheetKey,\n              name: tableName,\n              headers: sheet.content[0] || [],\n              contentRowIndex: 0, //  content[0]\n            });\n          });\n        }\n\n        if (sheetMap.size === 0) {\n          console.warn('[DICE]applyToTable: ');\n          return { totalApplied: 0, errors: [''] };\n        }\n\n        // \n        for (const [tableName, tableInfo] of sheetMap.entries()) {\n          const { sheet, headers, contentRowIndex } = tableInfo;\n\n          for (const rule of rules) {\n            if (!rule.enabled) continue;\n\n            // \n            const scope = rule.scope;\n            const shouldProcessTable = scope.type === 'global' || scope.tableNames?.includes(tableName);\n\n            if (!shouldProcessTable) continue;\n\n            try {\n              // \n              if (isSimpleFormat) {\n                //  rows\n                const rows = (sheet as { rows: string[][] }).rows;\n                for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {\n                  const row = rows[rowIndex];\n\n                  // \n                  for (let colIndex = 0; colIndex < row.length; colIndex++) {\n                    const columnName = headers[colIndex];\n\n                    // \n                    if (scope.type === 'column') {\n                      if (!scope.columnNames?.includes(columnName)) continue;\n                    }\n\n                    // \n                    const result = this.applyToValue(row[colIndex], rule);\n                    if (result.success) {\n                      if (result.matched) {\n                        row[colIndex] = result.newValue;\n                        totalApplied++;\n                      }\n                    } else {\n                      errors.push(`${rule.name} [${tableName}]: ${result.error}`);\n                    }\n                  }\n                }\n              } else {\n                //  content  content[1] \n                const content = sheet.content;\n                for (let contentRowIndex = 1; contentRowIndex < content.length; contentRowIndex++) {\n                  const row = content[contentRowIndex];\n                  if (!Array.isArray(row)) continue;\n\n                  // \n                  for (let colIndex = 0; colIndex < row.length; colIndex++) {\n                    const columnName = headers[colIndex];\n\n                    // \n                    if (scope.type === 'column') {\n                      if (!scope.columnNames?.includes(columnName)) continue;\n                    }\n\n                    // \n                    const oldValue = row[colIndex];\n                    const result = this.applyToValue(oldValue, rule);\n\n                    if (result.success) {\n                      if (result.matched) {\n                        row[colIndex] = result.newValue;\n                        totalApplied++;\n                        console.debug(\n                          `[DICE]: ${tableName}[${contentRowIndex}].${columnName}`,\n                          `\"${result.oldValue}\" -> \"${result.newValue}\"`,\n                        );\n                      }\n                    } else {\n                      errors.push(`${rule.name} [${tableName}]: ${result.error}`);\n                    }\n                  }\n                }\n              }\n            } catch (tableError) {\n              const errorMsg = tableError instanceof Error ? tableError.message : String(tableError);\n              console.error(`[DICE]applyToTable:  ${tableName} :`, tableError);\n              errors.push(`${rule.name} [${tableName}]:  - ${errorMsg}`);\n            }\n          }\n        }\n\n        if (totalApplied > 0) {\n          console.info(`[DICE]applyToTable:  ${totalApplied} `);\n        }\n        if (errors.length > 0) {\n          console.warn(`[DICE]applyToTable:  ${errors.length} `);\n        }\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : String(e);\n        console.error('[DICE]applyToTable: :', e);\n        errors.push(`: ${errorMsg}`);\n      }\n\n      return { totalApplied, errors };\n    },\n\n    // \n    applyToCell(\n      value: string,\n      tableName: string,\n      columnName: string,\n      executeMode?: RegexExecutionMode,\n    ): RegexTransformResult {\n      // \n      const rules = RegexTransformationManager.getApplicableRules(tableName, columnName);\n\n      // ,\n      if (rules.length === 0) {\n        return {\n          success: true,\n          oldValue: value || '',\n          newValue: value || '',\n          matched: false,\n        };\n      }\n\n      // \n      let applicableRules = rules;\n      if (executeMode) {\n        applicableRules = rules.filter(r => r.executeMode === executeMode || r.executeMode === 'auto');\n      }\n\n      if (applicableRules.length === 0) {\n        return {\n          success: true,\n          oldValue: value || '',\n          newValue: value || '',\n          matched: false,\n        };\n      }\n\n      // \n      let currentValue = value || '';\n      let wasMatched = false;\n\n      for (const rule of applicableRules) {\n        const result = this.applyToValue(currentValue, rule);\n        if (!result.success) {\n          return result;\n        }\n        if (result.matched) {\n          wasMatched = true;\n        }\n        currentValue = result.newValue;\n      }\n\n      return {\n        success: true,\n        oldValue: value || '',\n        newValue: currentValue,\n        matched: wasMatched,\n      };\n    },\n\n    // \n    applyToRow(row: string[], headers: string[], tableName: string, executeMode?: RegexExecutionMode): string[] {\n      return row.map((cell, index) => {\n        const columnName = headers[index];\n        const result = this.applyToCell(cell, tableName, columnName, executeMode);\n        return result.newValue;\n      });\n    },\n\n    // \n    previewBatchTransform(\n      tableData: { name: string; headers: string[]; rows: string[][] },\n      executeMode?: RegexExecutionMode,\n    ): RegexPreviewResult[] {\n      const tableName = tableData.name;\n      const rules = RegexTransformationManager.getApplicableRules(tableName, null).filter(\n        r => r.scope.type === 'global' || r.scope.tableNames?.includes(tableName),\n      );\n\n      const results: RegexPreviewResult[] = [];\n\n      for (const rule of rules) {\n        const affectedCells: RegexPreviewResult['affectedCells'] = [];\n        let totalAffected = 0;\n\n        for (let rowIndex = 0; rowIndex < tableData.rows.length; rowIndex++) {\n          const row = tableData.rows[rowIndex];\n          for (let colIndex = 0; colIndex < row.length; colIndex++) {\n            const columnName = tableData.headers[colIndex];\n            const value = row[colIndex];\n\n            // \n            if (rule.scope.type === 'column') {\n              if (!rule.scope.columnNames?.includes(columnName) || !rule.scope.tableNames?.includes(tableName)) {\n                continue;\n              }\n            } else if (rule.scope.type === 'table') {\n              if (!rule.scope.tableNames?.includes(tableName)) {\n                continue;\n              }\n            }\n\n            const result = this.applyToValue(value, rule);\n            if (result.matched && result.oldValue !== result.newValue) {\n              affectedCells.push({\n                tableName,\n                rowIndex,\n                columnIndex: colIndex,\n                columnName,\n                oldValue: result.oldValue,\n                newValue: result.newValue,\n              });\n              totalAffected++;\n            }\n          }\n        }\n\n        if (totalAffected > 0) {\n          results.push({\n            rule,\n            affectedCells,\n            totalAffected,\n          });\n        }\n      }\n\n      return results;\n    },\n\n    // \n    clearRegexCache() {\n      this._regexCache.clear();\n    },\n  };\n\n  // ========================================\n  // ValidationEngine - \n  // ========================================\n  const ValidationEngine = {\n    // \n    validateFormat(value, pattern) {\n      if (value === null || value === undefined || value === '') return true; // \n      try {\n        const regex = new RegExp(pattern);\n        return regex.test(String(value));\n      } catch (e) {\n        console.error('[DICE]ValidationEngine :', pattern, e);\n        return true; // \n      }\n    },\n\n    // \n    validateEnum(value, allowedValues) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!Array.isArray(allowedValues) || allowedValues.length === 0) return true;\n      return allowedValues.includes(String(value));\n    },\n\n    // \n    validateNumeric(value, min, max) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      //  \"50/100\"  \":80\" \n      const strVal = String(value);\n      let numVal;\n\n      //  \"50%\"\n      if (strVal.endsWith('%')) {\n        numVal = parseFloat(strVal);\n      }\n      //  \"50/100\"\n      else if (strVal.includes('/')) {\n        const parts = strVal.split('/');\n        numVal = parseFloat(parts[0]);\n      }\n      //  \":\" \n      else if (strVal.includes(':')) {\n        const parts = strVal.split(':');\n        numVal = parseFloat(parts[parts.length - 1]);\n      }\n      // \n      else {\n        numVal = parseFloat(strVal);\n      }\n\n      if (isNaN(numVal)) return false; // \n\n      if (min !== undefined && min !== null && numVal < min) return false;\n      if (max !== undefined && max !== null && numVal > max) return false;\n      return true;\n    },\n\n    //  OR \n    validateRelation(value, rawData, refTable, refColumn) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!rawData || !refTable || !refColumn) return true;\n\n      // \n      let refSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === refTable) {\n          refSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!refSheet || !refSheet.content || refSheet.content.length < 2) {\n        return true; // \n      }\n\n      const headers = refSheet.content[0];\n      const strVal = String(value);\n\n      //  refColumn \n      const columns = Array.isArray(refColumn) ? refColumn : [refColumn];\n\n      for (const col of columns) {\n        const refColIndex = headers.indexOf(col);\n        if (refColIndex === -1) continue; // \n\n        // \n        for (let i = 1; i < refSheet.content.length; i++) {\n          if (String(refSheet.content[i][refColIndex] || '') === strVal) {\n            return true; // \n          }\n        }\n      }\n\n      return columns.length === 0; //  true false\n    },\n\n    // \n    validateRequired(value) {\n      return value !== null && value !== undefined && String(value).trim() !== '';\n    },\n\n    // \n    validateKeyValue(value, ruleConfig) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      const valueType = ruleConfig?.valueType || 'text';\n      const valueMin = ruleConfig?.valueMin;\n      const valueMax = ruleConfig?.valueMax;\n\n      // \n      let processedValue = String(value);\n\n      // \n      processedValue = processedValue\n        .replace(//g, ':') //   \n        .replace(//g, ';') //   \n        .replace(//g, ';'); //   \n\n      // \n      processedValue = processedValue.replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n\n      if (pairs.length === 0) return false; // \n\n      // \n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          return false; // /\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) return false; // \n\n        // \n        if (valueType === 'numeric') {\n          // \n          if (!/^-?\\d+(\\.\\d+)?$/.test(val.trim())) return false; // \n\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) return false; // \n\n          if (valueMin !== undefined && valueMin !== null && numVal < valueMin) return false;\n          if (valueMax !== undefined && valueMax !== null && numVal > valueMax) return false;\n        }\n        // \n      }\n\n      return true;\n    },\n\n    // \n    validateTableReadonly(oldContent, newContent) {\n      if (!oldContent || !newContent) return true;\n      return JSON.stringify(oldContent) === JSON.stringify(newContent);\n    },\n\n    // \n    validateRowLimit(rowCount, min, max) {\n      if (min !== undefined && min !== null && rowCount < min) return false;\n      if (max !== undefined && max !== null && rowCount > max) return false;\n      return true;\n    },\n\n    // \n    validateSequence(sheet, columnName, config) {\n      if (!sheet || !sheet.content || sheet.content.length < 2) return true; // \n      if (!columnName || !config) return true;\n\n      const headers = sheet.content[0] || [];\n      const rows = sheet.content.slice(1) || [];\n      const colIndex = headers.indexOf(columnName);\n      if (colIndex < 0) return true; // \n\n      const prefix = config.prefix || '';\n      const startFrom = config.startFrom !== undefined ? config.startFrom : 1;\n\n      // \n      const numbers = [];\n      const allRowValues = []; // \n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        allRowValues.push({ rowIndex: i, rawValue: value, type: typeof value });\n        if (value === null || value === undefined || value === '') continue;\n\n        const strValue = String(value).trim();\n        if (!strValue) continue;\n\n        // +\n        if (prefix) {\n          const escapedPrefix = prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n          const regex = new RegExp(`^${escapedPrefix}(\\\\d+)$`);\n          const match = strValue.match(regex);\n          if (match) {\n            const num = parseInt(match[1], 10);\n            if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n          }\n        } else {\n          // \n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n        }\n      }\n\n      if (numbers.length === 0) return true; // \n\n      // \n      numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n      // \n      const numSet = new Set(numbers.map(n => n.num));\n      if (numSet.size !== numbers.length) {\n        return false; // \n      }\n\n      // startFrom\n      // startFromstartFrom+1\n      for (let i = 0; i < numbers.length; i++) {\n        const expectedNum = startFrom + i;\n        const actualNum = numbers[i].num;\n        if (actualNum !== expectedNum) {\n          return false; // startFrom\n        }\n      }\n\n      return true;\n    },\n\n    //  intercept \n    checkTableRules(snapshot, newData, rules) {\n      const violations = [];\n      if (!snapshot || !newData || !rules) return violations;\n\n      for (const rule of rules) {\n        // \n        if (!rule.enabled || !rule.intercept) continue;\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n        if (!typeInfo) continue;\n\n        // \n        let oldSheet = null,\n          newSheet = null;\n        for (const sheetId in snapshot) {\n          if (snapshot[sheetId]?.name === rule.targetTable) {\n            oldSheet = snapshot[sheetId];\n            break;\n          }\n        }\n        for (const sheetId in newData) {\n          if (newData[sheetId]?.name === rule.targetTable) {\n            newSheet = newData[sheetId];\n            break;\n          }\n        }\n\n        if (!newSheet) continue;\n\n        // \n        if (typeInfo.scope === 'table') {\n          if (rule.ruleType === 'tableReadonly') {\n            if (!this.validateTableReadonly(oldSheet?.content, newSheet?.content)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message: rule.errorMessage || ` \"${rule.targetTable}\" `,\n              });\n            }\n          } else if (rule.ruleType === 'rowLimit') {\n            const rowCount = (newSheet.content?.length || 1) - 1; // \n            if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetTable}\"  ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n              });\n            }\n          } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n            // \n            if (!this.validateSequence(newSheet, rule.targetColumn, rule.config || {})) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(4, '0')}`,\n              });\n            }\n          }\n        }\n        // \n        else if (typeInfo.scope === 'field' && rule.targetColumn) {\n          const headers = newSheet.content?.[0] || [];\n          const colIndex = headers.indexOf(rule.targetColumn);\n          if (colIndex === -1) continue;\n\n          // \n          for (let rowIdx = 1; rowIdx < (newSheet.content?.length || 0); rowIdx++) {\n            const row = newSheet.content[rowIdx];\n            const value = row?.[colIndex];\n            const isValid = this.validateValue(value, rule, newData);\n\n            if (!isValid) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                rowIndex: rowIdx,\n                columnName: rule.targetColumn,\n                currentValue: String(value ?? ''),\n                message: rule.errorMessage || ` \"${rule.targetColumn}\" `,\n              });\n              // \n              break;\n            }\n          }\n        }\n      }\n      return violations;\n    },\n\n    // \n    validateValue(value, rule, rawData) {\n      switch (rule.ruleType) {\n        case 'format':\n          return this.validateFormat(value, rule.config?.pattern);\n        case 'enum':\n          return this.validateEnum(value, rule.config?.values);\n        case 'numeric':\n          return this.validateNumeric(value, rule.config?.min, rule.config?.max);\n        case 'relation':\n          return this.validateRelation(value, rawData, rule.config?.refTable, rule.config?.refColumn);\n        case 'required':\n          return this.validateRequired(value);\n        case 'keyValue':\n          return this.validateKeyValue(value, rule.config);\n        default:\n          return true;\n      }\n    },\n\n    // \n    validateRow(row, headers, tableName, rowIndex, rules, rawData) {\n      const errors = [];\n      // \n      const rowTitle = row[1] || row[0] || ` ${rowIndex + 1}`;\n\n      for (const rule of rules) {\n        if (rule.targetTable !== tableName) continue;\n        if (!rule.enabled) continue;\n\n        // \n        const colIndex = headers.indexOf(rule.targetColumn);\n        if (colIndex === -1) continue;\n\n        const value = row[colIndex];\n        const isValid = this.validateValue(value, rule, rawData);\n\n        if (!isValid) {\n          errors.push({\n            ruleId: rule.id,\n            ruleName: rule.name,\n            ruleType: rule.ruleType,\n            rule: rule, // \n            tableName: tableName,\n            rowIndex: rowIndex,\n            columnName: rule.targetColumn,\n            currentValue: String(value ?? ''),\n            rowTitle: rowTitle, // \n            errorMessage: rule.errorMessage,\n            severity: 'error',\n          });\n        }\n      }\n\n      return errors;\n    },\n\n    // \n    validateAllData(rawData) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getEnabledRules();\n      if (rules.length === 0) return [];\n\n      const allErrors = [];\n\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const sheet = rawData[sheetId];\n        if (!sheet?.name || !sheet?.content || sheet.content.length < 2) continue;\n\n        const tableName = sheet.name;\n        const headers = sheet.content[0];\n        const tableRules = rules.filter(r => r.targetTable === tableName);\n\n        if (tableRules.length === 0) continue;\n\n        // \n        for (const rule of tableRules) {\n          const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n          if (typeInfo?.scope === 'table') {\n            if (rule.ruleType === 'rowLimit') {\n              const rowCount = sheet.content.length - 1;\n              if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n                allErrors.push({\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: '',\n                  currentValue: `${rowCount} `,\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n                  severity: 'warning',\n                });\n              }\n            } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n              // \n              const isValid = this.validateSequence(sheet, rule.targetColumn, rule.config || {});\n              if (!isValid) {\n                const error = {\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: rule.targetColumn,\n                  currentValue: '',\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(4, '0')}`,\n                  severity: 'error',\n                };\n                allErrors.push(error);\n              }\n            }\n            // tableReadonly \n          }\n        }\n\n        // \n        const fieldRules = tableRules.filter(r => RULE_TYPE_INFO[r.ruleType]?.scope !== 'table');\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          const rowErrors = this.validateRow(row, headers, tableName, i - 1, fieldRules, rawData);\n          allErrors.push(...rowErrors);\n        }\n      }\n\n      return allErrors;\n    },\n\n    // \n    validateTable(rawData, tableName) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getRulesByTable(tableName);\n      if (rules.length === 0) return [];\n\n      // \n      let targetSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n        return [];\n      }\n\n      const headers = targetSheet.content[0];\n      const allErrors = [];\n\n      for (let i = 1; i < targetSheet.content.length; i++) {\n        const row = targetSheet.content[i];\n        const rowErrors = this.validateRow(row, headers, tableName, i - 1, rules, rawData);\n        allErrors.push(...rowErrors);\n      }\n\n      return allErrors;\n    },\n\n    // \n    groupErrorsByTable(errors) {\n      const grouped = {};\n      for (const error of errors) {\n        if (!grouped[error.tableName]) {\n          grouped[error.tableName] = [];\n        }\n        grouped[error.tableName].push(error);\n      }\n      return grouped;\n    },\n\n    // \n    getErrorCount(rawData) {\n      return this.validateAllData(rawData).length;\n    },\n  };\n\n  // ========================================\n  // LocalAvatarDB -  IndexedDB \n  // ========================================\n  const LocalAvatarDB = {\n    DB_NAME: 'acu_local_avatars',\n    STORE_NAME: 'avatars',\n    DB_VERSION: 1,\n    _db: null,\n    _urlCache: new Map(), //  ObjectURL \n\n    // \n    async init() {\n      if (this._db) return this._db;\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n        request.onerror = () => {\n          console.error('[DICE]LocalAvatarDB :', request.error);\n          reject(request.error);\n        };\n\n        request.onsuccess = () => {\n          this._db = request.result;\n          resolve(this._db);\n        };\n\n        request.onupgradeneeded = event => {\n          const db = event.target.result;\n          if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n            // \n            db.createObjectStore(this.STORE_NAME, { keyPath: 'name' });\n          }\n        };\n      });\n    },\n\n    //  name \n    async save(name, blob) {\n      if (!name || !blob) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          //  ObjectURL \n          if (this._urlCache.has(name)) {\n            URL.revokeObjectURL(this._urlCache.get(name));\n            this._urlCache.delete(name);\n          }\n\n          const data = {\n            name: name,\n            blob: blob,\n            size: blob.size,\n            type: blob.type,\n            updatedAt: Date.now(),\n          };\n\n          const request = store.put(data);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]LocalAvatarDB :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB save error:', e);\n        return false;\n      }\n    },\n\n    //  URL ObjectURL\n    async get(name) {\n      if (!name) return null;\n\n      // \n      if (this._urlCache.has(name)) {\n        return this._urlCache.get(name);\n      }\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.get(name);\n\n          request.onsuccess = () => {\n            const data = request.result;\n            if (data && data.blob) {\n              const url = URL.createObjectURL(data.blob);\n              this._urlCache.set(name, url);\n              resolve(url);\n            } else {\n              resolve(null);\n            }\n          };\n\n          request.onerror = () => resolve(null);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB get error:', e);\n        return null;\n      }\n    },\n\n    // \n    async has(name) {\n      if (!name) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getKey(name);\n\n          request.onsuccess = () => resolve(request.result !== undefined);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        return false;\n      }\n    },\n\n    // \n    async delete(name) {\n      if (!name) return false;\n\n      try {\n        //  ObjectURL \n        if (this._urlCache.has(name)) {\n          URL.revokeObjectURL(this._urlCache.get(name));\n          this._urlCache.delete(name);\n        }\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.delete(name);\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB delete error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAllNames() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAllKeys();\n\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => resolve([]);\n        });\n      } catch (e) {\n        return [];\n      }\n    },\n\n    // \n    async getStats() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAll();\n\n          request.onsuccess = () => {\n            const items = request.result || [];\n            const totalSize = items.reduce((sum, item) => sum + (item.size || 0), 0);\n            resolve({\n              count: items.length,\n              totalSize: totalSize,\n              totalSizeMB: (totalSize / 1024 / 1024).toFixed(2),\n            });\n          };\n\n          request.onerror = () => resolve({ count: 0, totalSize: 0, totalSizeMB: '0' });\n        });\n      } catch (e) {\n        return { count: 0, totalSize: 0, totalSizeMB: '0' };\n      }\n    },\n\n    // \n    async clearAll() {\n      try {\n        //  ObjectURL \n        this._urlCache.forEach(url => URL.revokeObjectURL(url));\n        this._urlCache.clear();\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.clear();\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB clearAll error:', e);\n        return false;\n      }\n    },\n  };\n\n  // ========================================\n  // FavoritesDB -  IndexedDB \n  // ========================================\n  /**\n   * @typedef {Object} FavoriteItem\n   * @property {string} id - UUID\n   * @property {string[]} header -  (null)\n   * @property {(string|number)[]} rowData -  (header)\n   * @property {string[]} tags - \n   * @property {number} createdAt - \n   * @property {number} updatedAt - \n   * @property {{tableUid: string, tableName: string, chatId: string}} [sourceInfo] - \n   */\n  interface FavoriteItem {\n    id: string;\n    header: string[];\n    rowData: (string | number)[];\n    tags: string[];\n    createdAt: number;\n    updatedAt: number;\n    sourceInfo?: {\n      tableUid: string;\n      tableName: string;\n      chatId: string;\n    };\n  }\n\n  const FavoritesDB = {\n    DB_NAME: 'acu_favorites',\n    STORE_NAME: 'items',\n    DB_VERSION: 1,\n    _db: null as IDBDatabase | null,\n\n    // \n    async init(): Promise<IDBDatabase> {\n      if (this._db) return this._db;\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n        request.onerror = () => {\n          console.error('[DICE]FavoritesDB :', request.error);\n          reject(request.error);\n        };\n\n        request.onsuccess = () => {\n          this._db = request.result;\n          resolve(this._db);\n        };\n\n        request.onupgradeneeded = event => {\n          const db = (event.target as IDBOpenDBRequest).result;\n          if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n            //  id (UUID)\n            db.createObjectStore(this.STORE_NAME, { keyPath: 'id' });\n          }\n        };\n      });\n    },\n\n    // \n    async add(item: FavoriteItem): Promise<boolean> {\n      if (!item || !item.id) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          const request = store.add(item);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]FavoritesDB add :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB add error:', e);\n        return false;\n      }\n    },\n\n    // ID\n    async get(id: string): Promise<FavoriteItem | null> {\n      if (!id) return null;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.get(id);\n\n          request.onsuccess = () => {\n            resolve(request.result || null);\n          };\n\n          request.onerror = () => resolve(null);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB get error:', e);\n        return null;\n      }\n    },\n\n    //  ()\n    async update(id: string, updates: Partial<FavoriteItem>): Promise<boolean> {\n      if (!id) return false;\n\n      try {\n        const existing = await this.get(id);\n        if (!existing) return false;\n\n        const updated = {\n          ...existing,\n          ...updates,\n          id: existing.id, //  id \n          updatedAt: Date.now(),\n        };\n\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          const request = store.put(updated);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]FavoritesDB update :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB update error:', e);\n        return false;\n      }\n    },\n\n    // \n    async delete(id: string): Promise<boolean> {\n      if (!id) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.delete(id);\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB delete error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAll(): Promise<FavoriteItem[]> {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAll();\n\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => resolve([]);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB getAll error:', e);\n        return [];\n      }\n    },\n\n    // \n    async getAllTags(): Promise<string[]> {\n      try {\n        const items = await this.getAll();\n        const tagSet = new Set<string>();\n        for (const item of items) {\n          if (item.tags && Array.isArray(item.tags)) {\n            for (const tag of item.tags) {\n              if (tag) tagSet.add(tag);\n            }\n          }\n        }\n        return Array.from(tagSet).sort();\n      } catch (e) {\n        console.error('[DICE]FavoritesDB getAllTags error:', e);\n        return [];\n      }\n    },\n\n    // \n    async getByTag(tag: string): Promise<FavoriteItem[]> {\n      if (!tag) return [];\n\n      try {\n        const items = await this.getAll();\n        return items.filter(item => item.tags && item.tags.includes(tag));\n      } catch (e) {\n        console.error('[DICE]FavoritesDB getByTag error:', e);\n        return [];\n      }\n    },\n\n    // \n    async clear(): Promise<boolean> {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.clear();\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB clear error:', e);\n        return false;\n      }\n    },\n\n    // \n    async count(): Promise<number> {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.count();\n\n          request.onsuccess = () => resolve(request.result || 0);\n          request.onerror = () => resolve(0);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB count error:', e);\n        return 0;\n      }\n    },\n  };\n\n  // ========================================\n  // FavoritesManager - \n  // ========================================\n\n  interface TableCompatibility {\n    tableUid: string;\n    tableName: string;\n    mode: 'strict' | 'loose' | 'incompatible';\n    matchedCols: string[];\n    unmatchedCols: string[];\n    matchRatio: number;\n  }\n\n  const FavoritesManager = {\n    // \n    async addFavorite(\n      tableUid: string,\n      tableName: string,\n      header: string[],\n      rowData: (string | number)[],\n      tags: string[] = [],\n    ): Promise<FavoriteItem | null> {\n      try {\n        const chatId = SillyTavern.getCurrentChatId() || '';\n        const item: FavoriteItem = {\n          id: crypto.randomUUID(),\n          header: header,\n          rowData: rowData,\n          tags: tags,\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n          sourceInfo: {\n            tableUid,\n            tableName,\n            chatId,\n          },\n        };\n\n        const success = await FavoritesDB.add(item);\n        if (success) {\n          console.log('[DICE]FavoritesManager :', item.id);\n          return item;\n        }\n        return null;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager addFavorite error:', e);\n        return null;\n      }\n    },\n\n    // \n    async updateFavorite(id: string, updates: Partial<FavoriteItem>): Promise<boolean> {\n      try {\n        const success = await FavoritesDB.update(id, updates);\n        if (success) {\n          console.log('[DICE]FavoritesManager :', id);\n        }\n        return success;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager updateFavorite error:', e);\n        return false;\n      }\n    },\n\n    // \n    async duplicateFavorite(id: string): Promise<FavoriteItem | null> {\n      try {\n        const original = await FavoritesDB.get(id);\n        if (!original) return null;\n\n        const copy: FavoriteItem = {\n          ...original,\n          id: crypto.randomUUID(),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n\n        const success = await FavoritesDB.add(copy);\n        if (success) {\n          console.log('[DICE]FavoritesManager :', id, '->', copy.id);\n          return copy;\n        }\n        return null;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager duplicateFavorite error:', e);\n        return null;\n      }\n    },\n\n    // \n    async deleteFavorite(id: string): Promise<boolean> {\n      try {\n        const success = await FavoritesDB.delete(id);\n        if (success) {\n          console.log('[DICE]FavoritesManager :', id);\n        }\n        return success;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager deleteFavorite error:', e);\n        return false;\n      }\n    },\n\n    // \n    async addTag(id: string, tag: string): Promise<boolean> {\n      try {\n        const item = await FavoritesDB.get(id);\n        if (!item) return false;\n\n        if (!item.tags.includes(tag)) {\n          item.tags.push(tag);\n          return await FavoritesDB.update(id, { tags: item.tags });\n        }\n        return true;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager addTag error:', e);\n        return false;\n      }\n    },\n\n    // \n    async removeTag(id: string, tag: string): Promise<boolean> {\n      try {\n        const item = await FavoritesDB.get(id);\n        if (!item) return false;\n\n        const index = item.tags.indexOf(tag);\n        if (index > -1) {\n          item.tags.splice(index, 1);\n          return await FavoritesDB.update(id, { tags: item.tags });\n        }\n        return true;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager removeTag error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAllTags(): Promise<string[]> {\n      return await FavoritesDB.getAllTags();\n    },\n\n    // \n    async getAll(): Promise<FavoriteItem[]> {\n      return await FavoritesDB.getAll();\n    },\n\n    // \n    async getByTag(tag: string): Promise<FavoriteItem[]> {\n      return await FavoritesDB.getByTag(tag);\n    },\n\n    // ID\n    async getById(id: string): Promise<FavoriteItem | null> {\n      return await FavoritesDB.get(id);\n    },\n\n    // \n    findCompatibleTables(favorite: FavoriteItem, currentTables: Record<string, any>): TableCompatibility[] {\n      const results: TableCompatibility[] = [];\n\n      for (const uid in currentTables) {\n        const table = currentTables[uid];\n        if (!table || !table.content || !table.content[0]) continue;\n\n        // null\n        const tableHeader: string[] = table.content[0].slice(1).map((h: any) => String(h || ''));\n\n        // \n        const isStrict =\n          favorite.header.length === tableHeader.length && favorite.header.every((h, i) => h === tableHeader[i]);\n\n        // \n        const matchedCols = favorite.header.filter(h => tableHeader.includes(h));\n        const unmatchedCols = favorite.header.filter(h => !tableHeader.includes(h));\n        const matchRatio = favorite.header.length > 0 ? matchedCols.length / favorite.header.length : 0;\n\n        if (isStrict) {\n          results.push({\n            tableUid: uid,\n            tableName: table.name || uid,\n            mode: 'strict',\n            matchedCols,\n            unmatchedCols,\n            matchRatio: 1,\n          });\n        } else if (matchRatio > 0) {\n          results.push({\n            tableUid: uid,\n            tableName: table.name || uid,\n            mode: 'loose',\n            matchedCols,\n            unmatchedCols,\n            matchRatio,\n          });\n        }\n      }\n\n      // strictmatchRatio\n      return results.sort((a, b) => {\n        if (a.mode === 'strict' && b.mode !== 'strict') return -1;\n        if (a.mode !== 'strict' && b.mode === 'strict') return 1;\n        return b.matchRatio - a.matchRatio;\n      });\n    },\n\n    // \n    mapRowToTable(favorite: FavoriteItem, targetHeader: string[]): (string | number | null)[] {\n      const newRow: (string | number | null)[] = [null]; // null\n      for (const col of targetHeader) {\n        const srcIndex = favorite.header.indexOf(col);\n        newRow.push(srcIndex >= 0 ? favorite.rowData[srcIndex] : '');\n      }\n      return newRow;\n    },\n\n    // \n    async exportFavorites(): Promise<string> {\n      try {\n        const items = await FavoritesDB.getAll();\n        const exportData = {\n          version: 1,\n          exportedAt: Date.now(),\n          items: items,\n        };\n        return JSON.stringify(exportData, null, 2);\n      } catch (e) {\n        console.error('[DICE]FavoritesManager exportFavorites error:', e);\n        return '';\n      }\n    },\n\n    // \n    async importFavorites(jsonStr: string): Promise<{ added: number; updated: number } | null> {\n      try {\n        const data = JSON.parse(jsonStr);\n        if (!data || !data.items || !Array.isArray(data.items)) {\n          console.error('[DICE]FavoritesManager ');\n          return null;\n        }\n\n        let added = 0;\n        let updated = 0;\n\n        for (const item of data.items) {\n          if (!item.id || !item.header || !item.rowData) continue;\n\n          const existing = await FavoritesDB.get(item.id);\n          if (existing) {\n            // \n            await FavoritesDB.update(item.id, {\n              header: item.header,\n              rowData: item.rowData,\n              tags: item.tags || [],\n              updatedAt: Date.now(),\n              sourceInfo: item.sourceInfo,\n            });\n            updated++;\n          } else {\n            // \n            const newItem: FavoriteItem = {\n              id: item.id,\n              header: item.header,\n              rowData: item.rowData,\n              tags: item.tags || [],\n              createdAt: item.createdAt || Date.now(),\n              updatedAt: Date.now(),\n              sourceInfo: item.sourceInfo,\n            };\n            await FavoritesDB.add(newItem);\n            added++;\n          }\n        }\n\n        console.log('[DICE]FavoritesManager :', added, ',', updated, '');\n        return { added, updated };\n      } catch (e) {\n        console.error('[DICE]FavoritesManager importFavorites error:', e);\n        return null;\n      }\n    },\n  };\n\n  // []  SillyTavern  URL\n  const getUserAvatarUrl = () => {\n    try {\n      // 1:  DOM \n      const w = window.parent || window;\n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        // SillyTavern  #user_avatar_block img  .avatar[title=\"You\"] img\n        const $avatar = $('#user_avatar_block img').first();\n        if ($avatar.length && $avatar.attr('src')) {\n          return $avatar.attr('src');\n        }\n        // \n        const $userMes = $('.mes[is_user=\"true\"]').last().find('.avatar img');\n        if ($userMes.length && $userMes.attr('src')) {\n          return $userMes.attr('src');\n        }\n      }\n      // 2:  SillyTavern API \n      const ST = w.SillyTavern || window.SillyTavern;\n      if (ST && ST.getContext) {\n        const ctx = ST.getContext();\n        if (ctx && ctx.userAvatar) {\n          return ctx.userAvatar;\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getUserAvatarUrl error:', e);\n    }\n    return null;\n  };\n\n  // [] \n  const getPlayerName = () => {\n    const rawData = cachedRawData || (typeof getTableData === 'function' ? getTableData() : null);\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]?.[1]) {\n          return sheet.content[1][1];\n        }\n      }\n    }\n    return null;\n  };\n\n  // []  SillyTavern Persona \n  const getPersonaName = () => {\n    try {\n      // 1: SillyTavern  API\n      const w = window.parent || window;\n      if (w.SillyTavern?.getContext) {\n        const ctx = w.SillyTavern.getContext();\n        if (ctx?.name1) return ctx.name1;\n      }\n      // 2: \n      if (typeof name1 !== 'undefined' && name1) return name1;\n      if (w.name1) return w.name1;\n      // 3:  DOM \n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        const $persona = $('#user_avatar_block .avatar-name, #persona_name_input').first();\n        if ($persona.length) {\n          const name = $persona.val?.() || $persona.text?.();\n          if (name && name.trim()) return name.trim();\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getPersonaName error:', e);\n    }\n    return null;\n  };\n\n  // []  Persona\n  const getDisplayPlayerName = () => {\n    return getPersonaName() || getPlayerName() || '';\n  };\n\n  // []  Persona \n  const replaceUserPlaceholders = text => {\n    if (!text || typeof text !== 'string') return text;\n    const displayName = getDisplayPlayerName();\n    //  <user>{{user}}\n    let result = text.replace(/<user>/gi, displayName);\n    result = result.replace(/\\{\\{user\\}\\}/gi, displayName);\n    return result;\n  };\n  // \n  const AvatarManager = {\n    _cache: null,\n\n    load() {\n      if (!this._cache) {\n        const raw = Store.get(STORAGE_KEY_AVATAR_MAP, {});\n        this._cache = {};\n        for (const name in raw) {\n          if (typeof raw[name] === 'string') {\n            this._cache[name] = { url: raw[name], offsetX: 50, offsetY: 50, scale: 150, aliases: [] };\n          } else {\n            this._cache[name] = {\n              url: raw[name].url || '',\n              offsetX: raw[name].offsetX ?? 50,\n              offsetY: raw[name].offsetY ?? 50,\n              scale: raw[name].scale ?? 150,\n              aliases: raw[name].aliases || [],\n            };\n          }\n        }\n      }\n      return this._cache;\n    },\n\n    save() {\n      Store.set(STORAGE_KEY_AVATAR_MAP, this._cache || {});\n      this._cache = null;\n    },\n\n    //  URL  ST \n    get(name) {\n      const data = this.load()[name];\n      if (data && data.url) return data.url;\n\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          if (this._cache[key].url) return this._cache[key].url;\n        }\n      }\n\n      return null;\n    },\n\n    //  > URL > ST\n    async getAsync(name) {\n      if (!name) return null;\n\n      // \n      const playerName = getPlayerName();\n      const isPlayer = name === '<user>' || name === '' || (playerName && name === playerName);\n\n      // 1.  IndexedDB\n      const localUrl = await LocalAvatarDB.get(name);\n      if (localUrl) return localUrl;\n\n      // 2.  <user> \n      if (isPlayer && name !== '<user>') {\n        const userLocalUrl = await LocalAvatarDB.get('<user>');\n        if (userLocalUrl) return userLocalUrl;\n      }\n\n      // 3. \n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        const aliasLocalUrl = await LocalAvatarDB.get(primaryName);\n        if (aliasLocalUrl) return aliasLocalUrl;\n      }\n\n      // 4. URL / ST\n      return this.get(name);\n    },\n\n    // \n    async hasLocalAvatar(name) {\n      if (!name) return false;\n      const has = await LocalAvatarDB.has(name);\n      if (has) return true;\n\n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        return await LocalAvatarDB.has(primaryName);\n      }\n      return false;\n    },\n\n    // \n    async saveLocalAvatar(name, blob) {\n      return await LocalAvatarDB.save(name, blob);\n    },\n\n    // \n    async deleteLocalAvatar(name) {\n      return await LocalAvatarDB.delete(name);\n    },\n\n    getOffsetX(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetX ?? 50) : 50;\n    },\n\n    getOffsetY(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetY ?? 50) : 50;\n    },\n\n    getScale(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.scale ?? 150) : 150;\n    },\n\n    // \n    _resolveByAlias(name) {\n      const data = this.load()[name];\n      if (data) return data;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return this._cache[key];\n        }\n      }\n      return null;\n    },\n\n    // \n    getPrimaryName(name) {\n      if (this.load()[name]) return name;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return key;\n        }\n      }\n      return name;\n    },\n\n    set(name, url, offsetX = 50, offsetY = 50, scale = 150, aliases = []) {\n      this.load()[name] = { url, offsetX, offsetY, scale, aliases };\n      this.save();\n    },\n\n    setPosition(name, offsetX, offsetY) {\n      const data = this.load()[name];\n      if (data) {\n        data.offsetX = offsetX;\n        data.offsetY = offsetY;\n        this.save();\n      }\n    },\n\n    setScale(name, scale) {\n      const data = this.load()[name];\n      if (data) {\n        data.scale = scale;\n        this.save();\n      }\n    },\n\n    setAliases(name, aliases) {\n      const data = this.load()[name];\n      if (data) {\n        data.aliases = aliases;\n        this.save();\n      }\n    },\n\n    remove(name) {\n      delete this.load()[name];\n      this.save();\n    },\n\n    getAll() {\n      return this.load();\n    },\n\n    // JSON\n    exportData() {\n      return {\n        version: 1,\n        exportTime: new Date().toISOString(),\n        avatars: this.load(),\n      };\n    },\n\n    // \n    importData(jsonData, overwriteConflicts = true) {\n      if (!jsonData || !jsonData.avatars) {\n        throw new Error('');\n      }\n\n      const current = this.load();\n      const stats = { added: 0, updated: 0, skipped: 0 };\n\n      for (const name in jsonData.avatars) {\n        const imported = jsonData.avatars[name];\n        if (!imported.url) continue;\n\n        if (current[name]) {\n          // \n          if (overwriteConflicts) {\n            current[name] = {\n              url: imported.url,\n              offsetX: imported.offsetX ?? 50,\n              offsetY: imported.offsetY ?? 50,\n              scale: imported.scale ?? 150,\n              aliases: imported.aliases || [],\n            };\n            stats.updated++;\n          } else {\n            stats.skipped++;\n          }\n        } else {\n          // \n          current[name] = {\n            url: imported.url,\n            offsetX: imported.offsetX ?? 50,\n            offsetY: imported.offsetY ?? 50,\n            scale: imported.scale ?? 150,\n            aliases: imported.aliases || [],\n          };\n          stats.added++;\n        }\n      }\n\n      this.save();\n      return stats;\n    },\n\n    // \n    analyzeImport(jsonData) {\n      if (!jsonData || !jsonData.avatars) {\n        return { valid: false, error: '' };\n      }\n\n      const current = this.load();\n      const result = { valid: true, total: 0, newItems: [], conflicts: [] };\n\n      for (const name in jsonData.avatars) {\n        if (!jsonData.avatars[name].url) continue;\n        result.total++;\n        if (current[name]) {\n          result.conflicts.push(name);\n        } else {\n          result.newItems.push(name);\n        }\n      }\n\n      return result;\n    },\n  };\n\n  const getLocationEmoji = name => {\n    if (!name) return null;\n    for (const [pattern, emoji] of LOCATION_EMOJI_MAP) {\n      if (pattern.test(name)) return emoji;\n    }\n    return null;\n  };\n\n  // emoji\n  const getEmojiCandidates = (name: string): string[] => {\n    if (!name) return [];\n    const candidates: string[] = [];\n    for (const [pattern, emoji] of LOCATION_EMOJI_MAP) {\n      if (pattern.test(name)) {\n        candidates.push(emoji);\n      }\n    }\n    return candidates;\n  };\n\n  // emoji\n  const resolveBatchLocationEmojis = (names: string[]): Map<string, string | null> => {\n    // 1. \n    const candidatesMap = new Map<string, string[]>();\n    for (const name of names) {\n      candidatesMap.set(name, getEmojiCandidates(name));\n    }\n\n    // 2. \n    const sortedNames = [...names].sort((a, b) => {\n      if (a.length !== b.length) return a.length - b.length;\n      return a.localeCompare(b);\n    });\n\n    // 3. \n    const usedEmojis = new Set<string>();\n    const result = new Map<string, string | null>();\n\n    for (const name of sortedNames) {\n      const candidates = candidatesMap.get(name) || [];\n      const available = candidates.find(e => !usedEmojis.has(e));\n      if (available) {\n        result.set(name, available);\n        usedEmojis.add(available);\n      } else {\n        // \n        result.set(name, candidates.length > 0 ? candidates[0] : null);\n      }\n    }\n\n    return result;\n  };\n\n  const getElementEmoji = (name, type) => {\n    if (!name && !type) return null;\n    for (const [pattern, emoji] of ELEMENT_EMOJI_MAP) {\n      if (name && pattern.test(name)) return emoji;\n    }\n    for (const [pattern, emoji] of ELEMENT_EMOJI_MAP) {\n      if (type && pattern.test(type)) return emoji;\n    }\n    return null;\n  };\n\n  // ========================================\n  // MVU  v2.0\n  //  -  UI\n  // ========================================\n  const MvuModule = (function () {\n    'use strict';\n\n    // [] MVU  - \n    function parseMvuPathForDice(path, value) {\n      try {\n        if (!path || typeof path !== 'string') {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        //  . \n        const parts = path.split('.').filter(p => p && p.trim());\n\n        if (parts.length === 0) {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        // \n        const blacklist = [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          'stat_data',\n          'delta_data',\n        ];\n\n        // \n        const filteredParts = parts.filter(p => !blacklist.includes(p));\n\n        // \n        let initiator = null;\n        if (filteredParts.length >= 2) {\n          // \n          initiator = filteredParts[filteredParts.length - 2];\n        } else if (filteredParts.length === 1) {\n          // \n          initiator = filteredParts[0];\n        }\n\n        // \n        let attrName = null;\n        if (filteredParts.length > 0) {\n          attrName = filteredParts[filteredParts.length - 1];\n        } else if (parts.length > 0) {\n          // \n          attrName = parts[parts.length - 1];\n        }\n\n        // \n        const candidates = filteredParts.length > 0 ? filteredParts : parts.slice(-1);\n\n        return {\n          initiator: initiator || null,\n          attrName: attrName || null,\n          candidates: candidates,\n        };\n      } catch (e) {\n        console.warn('[DICE]parseMvuPathForDice ', e);\n        return { initiator: null, attrName: null, candidates: [] };\n      }\n    }\n\n    // =====  =====\n    const MODULE_ID = '__mvu__';\n    let cachedEraData = null; //  ERA \n\n    // =====  =====\n    function detectMode() {\n      // \n      if (cachedEraData && cachedEraData._source) {\n        return cachedEraData._source;\n      }\n\n      //  ERA ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n\n      if (typeof eventEmit === 'function' && typeof eventOn === 'function') {\n        console.log('[DICE]MvuModule  ERA ');\n        return 'era';\n      }\n\n      //  MVU\n      if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n        console.log('[DICE]MvuModule  MVU ');\n        return 'mvu';\n      }\n\n      //  MVU\n      console.log('[DICE]MvuModule  MVU ');\n      return 'mvu';\n    }\n\n    // ===== =====\n    async function detectModeWithData() {\n      // 1.  ERA ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n\n      if (typeof eventEmit === 'function' && typeof eventOn === 'function') {\n        try {\n          //  ERA \n          const eraData = await Promise.race([\n            getEraData(),\n            new Promise((_, reject) => setTimeout(() => reject(new Error('ERA timeout')), 2000)),\n          ]);\n\n          if (eraData && eraData.stat_data) {\n            console.log('[DICE] ERA ');\n            return { mode: 'era', data: eraData };\n          }\n        } catch (e) {\n          console.warn('[DICE]ERA :', e.message);\n        }\n      }\n\n      // 2.  MVU\n      try {\n        await waitGlobalInitialized('Mvu');\n\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (mvuData && mvuData.stat_data) {\n            console.log('[DICE] MVU ');\n            return {\n              mode: 'mvu',\n              data: {\n                stat_data: mvuData.stat_data || null,\n                display_data: mvuData.display_data || {},\n                delta_data: mvuData.delta_data || {},\n                schema: mvuData.schema || null,\n                _source: 'mvu', // \n              },\n            };\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MVU :', e);\n      }\n\n      // 3.  MVU \n      console.warn('[DICE] MVU ');\n      return { mode: 'mvu', data: null };\n    }\n\n    // ===== ERA  =====\n    // ERA\n    async function getEraData() {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(null);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onResult = detail => {\n          clearTimeout(timeoutId);\n          //  eventOff \n          if (typeof eventOff === 'function') {\n            try {\n              eventOff('era:queryResult', onResult);\n            } catch (e) {\n              console.warn('[DICE]MvuModule :', e);\n            }\n          }\n\n          console.log('[DICE]MvuModule ERA:', JSON.stringify(detail, null, 2));\n          console.log('[DICE]MvuModule detail.result:', JSON.stringify(detail.result, null, 2));\n\n          if (detail.result && detail.result.error) {\n            console.error('[DICE]MvuModule ERA:', detail.result.error);\n            resolve(null);\n            return;\n          }\n\n          const statData = detail.result?.statWithoutMeta || null;\n          console.log('[DICE]MvuModule  stat_data:', JSON.stringify(statData, null, 2));\n\n          const result = {\n            stat_data: statData,\n            delta_data: {},\n            schema: null,\n            _source: 'era', // \n          };\n\n          // \n          cachedEraData = result;\n\n          resolve(result);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA...');\n          console.log('[DICE]MvuModule ERA API :', {\n            eventEmit: typeof eventEmit === 'function',\n            eventOn: typeof eventOn === 'function',\n            eventOff: typeof eventOff === 'function',\n          });\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n\n          eventOn('era:queryResult', onResult);\n          eventEmit('era:getCurrentVars');\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(null);\n        }\n      });\n    }\n\n    // ERA \n    async function setEraValue(path, newValue) {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(false);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onWriteDone = detail => {\n          clearTimeout(timeoutId);\n          if (typeof eventOff === 'function') {\n            eventOff('era:writeDone', onWriteDone);\n          }\n          console.log('[DICE]MvuModule ERA');\n          resolve(true);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA:', path, newValue);\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n\n          eventOn('era:writeDone', onWriteDone);\n          eventEmit('era:updateByPath', {\n            path: path,\n            value: newValue,\n          });\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(false);\n        }\n      });\n    }\n\n    // =====  =====\n    const STYLES = `\n            /* MVU  */\n            .acu-mvu-panel {\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n                min-height: 300px; /*  */\n                overflow: hidden; /*  */\n            }\n            .acu-mvu-panel .acu-panel-header {\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                padding: 10px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                flex-shrink: 0;\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title i {\n                color: var(--acu-accent);\n            }\n            .acu-mvu-panel .acu-header-actions {\n                display: flex;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                padding: 5px 10px;\n                font-size: 13px;\n                border-radius: 4px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn:hover {\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent);\n            }\n            .acu-mvu-panel .mvu-header-btn.active {\n                background: var(--acu-accent);\n                color: var(--acu-btn-active-text);\n                border-color: var(--acu-accent);\n            }\n            /* []  */\n            .mvu-numeric-mode {\n                padding: 0;\n            }\n            .mvu-numeric-level-controls {\n                position: sticky;\n                top: 0;\n                z-index: 10;\n            }\n            /* []  */\n            .mvu-level-controls-collapsible {\n                margin-bottom: 8px;\n            }\n            .mvu-level-controls-header {\n                transition: background 0.2s;\n            }\n            .mvu-level-controls-header:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-level-controls-body {\n                overflow-y: auto;\n                overflow-x: hidden;\n                transition: max-height 0.3s ease-out, padding-top 0.3s ease-out, padding-bottom 0.3s ease-out, border-bottom 0.3s ease-out;\n                max-height: 300px; /*  */\n                scrollbar-width: thin;\n            }\n            /*  */\n            @media (max-width: 768px) {\n                .mvu-level-controls-body {\n                    max-height: 200px;\n                }\n            }\n            .mvu-level-controls-body::-webkit-scrollbar {\n                width: 6px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-track {\n                background: transparent;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb {\n                background: var(--acu-border);\n                border-radius: 3px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb:hover {\n                background: var(--acu-text-sub);\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-body {\n                max-height: 0 !important;\n                padding-top: 0 !important;\n                padding-bottom: 0 !important;\n                border-bottom: none !important;\n                margin: 0 !important;\n            }\n            .mvu-level-controls-toggle-icon {\n                transition: transform 0.3s ease-out;\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-toggle-icon {\n                transform: rotate(-90deg);\n            }\n            .mvu-numeric-items {\n                max-height: calc(100vh - 200px);\n                overflow-y: auto;\n            }\n            .mvu-numeric-item {\n                transition: background 0.2s;\n            }\n            .mvu-numeric-item:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-dice-icon {\n                transition: opacity 0.2s, transform 0.2s;\n            }\n            .mvu-dice-icon:hover {\n                opacity: 1 !important;\n                transform: scale(1.1);\n            }\n            .mvu-level-toggle:hover {\n                opacity: 1 !important;\n            }\n            .mvu-level-toggle[data-visible=\"true\"]:hover {\n                background: var(--acu-accent) !important;\n                color: var(--acu-btn-active-text) !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .mvu-level-toggle[data-visible=\"false\"]:hover,\n            .mvu-level-toggle[data-visible=\"\"]:hover {\n                background: var(--acu-table-hover) !important;\n                color: var(--acu-text-sub) !important;\n                border-color: var(--acu-border) !important;\n            }\n\n            /* MVU  -  */\n            .mvu-content {\n                display: flex;\n                flex-direction: column;\n                overflow-x: hidden;\n                overflow-y: auto; /*  */\n                flex: 1 1 auto;\n                min-height: 0; /*  flex  */\n                max-height: 100%; /*  */\n                padding: 12px;\n                scrollbar-width: thin;\n            }\n            .mvu-content::-webkit-scrollbar {\n                display: none;\n            }\n            .mvu-content .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 100%;\n                max-width: 100%;\n                width: 100%;\n            }\n            /* MVU */\n            .acu-mvu-panel {\n                overflow-y: auto !important;\n                overflow-x: hidden !important;\n                flex: 1 1 0; /*  flex-basis: 0  */\n                min-height: 300px; /*  */\n            }\n\n            /* MVU  */\n            .mvu-card {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 10px;\n                overflow: hidden;\n            }\n            .mvu-card:last-child {\n                margin-bottom: 0;\n            }\n            .mvu-card-header {\n                background: var(--acu-table-head);\n                padding: 8px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                cursor: pointer;\n                user-select: none;\n                transition: background 0.2s;\n            }\n            .mvu-card-header:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-card-title {\n                font-weight: 600;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            .mvu-card-count {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                font-weight: normal;\n            }\n            .mvu-card-toggle {\n                color: var(--acu-text-sub);\n                font-size: 10px;\n                transition: transform 0.2s;\n            }\n            .mvu-card.collapsed .mvu-card-toggle {\n                transform: rotate(-90deg);\n            }\n            .mvu-card-body {\n                padding: 8px 12px;\n                display: block;\n                overflow: hidden; /*  slideUp/slideDown  */\n            }\n            .mvu-card.collapsed .mvu-card-body {\n                display: none;\n            }\n\n            /*  */\n            .mvu-card .mvu-card {\n                background: var(--acu-table-head);\n                margin: 6px 0;\n            }\n            .mvu-card .mvu-card .mvu-card-header {\n                background: rgba(128,128,128,0.1);\n                padding: 6px 10px;\n            }\n            .mvu-card .mvu-card .mvu-card-body {\n                padding: 6px 10px;\n            }\n\n            /*  -  */\n            .mvu-card-body.horizontal-nested {\n                display: flex;\n                flex-direction: row;\n                flex-wrap: nowrap;\n                gap: 12px;\n                overflow-x: auto;\n                overflow-y: visible;\n                -webkit-overflow-scrolling: touch;\n                padding-bottom: 8px;\n                align-items: flex-start;\n            }\n            /*  has-nested-cards  wrap  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested {\n                flex-wrap: wrap;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-row {\n                display: flex;\n                flex: 0 0 100%;\n                width: 100%;\n                max-width: 100%; /*  */\n                box-sizing: border-box;\n            }\n            /*  has-nested-cards  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                flex: 0 0 auto; /*  */\n                min-width: 100%; /*  */\n                width: auto; /*  */\n                max-width: 450px; /*  */\n                box-sizing: border-box;\n            }\n            @media (min-width: 769px) {\n                .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                    max-width: 550px; /*  */\n                }\n            }\n            /*  -  */\n            .mvu-card-body.horizontal-nested > .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 200px;\n                max-width: 350px;\n                width: auto;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                min-width: 400px; /*  */\n                max-width: none; /*  */\n            }\n            @media (min-width: 769px) {\n                .mvu-card-body.horizontal-nested > .mvu-card {\n                    min-width: 240px;\n                    max-width: 400px;\n                }\n                .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                    min-width: 500px; /*  */\n                    max-width: none; /*  */\n                }\n            }\n\n            /*  */\n            .mvu-row {\n                display: flex;\n                align-items: flex-start;\n                padding: 5px 0;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n            .mvu-row:last-child {\n                border-bottom: none;\n            }\n            .mvu-key {\n                color: var(--acu-text-sub);\n                min-width: 80px;\n                max-width: 120px;\n                flex-shrink: 0;\n                font-size: 12px;\n                padding-right: 8px;\n                word-break: break-all;\n            }\n            .mvu-value-wrap {\n                flex: 1;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                min-width: 0;\n            }\n            .mvu-value {\n                color: var(--acu-text-main);\n                font-size: var(--acu-font-size, 13px);\n                cursor: pointer;\n                padding: 1px 6px;\n                border-radius: 4px;\n                transition: background 0.2s;\n                word-break: break-word;\n                flex: 0 1 auto;\n            }\n            .mvu-value:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-value.mvu-array-value {\n                font-size: calc(var(--acu-font-size, 13px) * 0.92);\n                color: var(--acu-text-sub);\n            }\n            .mvu-change-indicator {\n                color: var(--acu-success-text);\n                font-weight: bold;\n                font-size: 12px;\n                flex-shrink: 0;\n            }\n            .mvu-row.mvu-changed {\n                background: var(--acu-success-bg);\n                margin: 0 -12px;\n                padding: 5px 12px;\n                border-radius: 4px;\n            }\n            .mvu-card .mvu-card .mvu-row.mvu-changed {\n                margin: 0 -10px;\n                padding: 5px 10px;\n            }\n\n            /*  */\n            .mvu-empty {\n                text-align: center;\n                padding: 40px 20px;\n                color: var(--acu-text-sub);\n                flex: 1;\n                min-width: 100%;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n            }\n            .mvu-empty i {\n                font-size: 32px;\n                margin-bottom: 12px;\n                display: block;\n                opacity: 0.5;\n            }\n            .mvu-empty p {\n                margin: 0 0 6px 0;\n            }\n            .mvu-empty .mvu-empty-hint {\n                font-size: 12px;\n                opacity: 0.7;\n            }\n\n            /*  */\n            .mvu-edit-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0,0,0,0.6);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 99999;\n                animation: mvuFadeIn 0.15s ease-out;\n            }\n            .mvu-edit-dialog {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                padding: 16px;\n                width: 90%;\n                max-width: 400px;\n                animation: mvuSlideIn 0.2s ease-out;\n            }\n            .mvu-edit-title {\n                font-weight: 600;\n                color: var(--acu-text-main);\n                margin-bottom: 12px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .mvu-edit-path {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                background: var(--acu-table-head);\n                padding: 6px 10px;\n                border-radius: 4px;\n                margin-bottom: 12px;\n                word-break: break-all;\n                font-family: monospace;\n            }\n            .mvu-edit-textarea {\n                width: 100%;\n                min-height: 80px;\n                padding: 10px;\n                border: 1px solid var(--acu-border);\n                border-radius: 4px;\n                background: var(--acu-input-bg, var(--acu-bg-panel));\n                color: var(--acu-text-main);\n                font-size: 13px;\n                resize: vertical;\n                box-sizing: border-box;\n            }\n            .mvu-edit-textarea:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n            }\n            .mvu-edit-hint {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                margin-top: 8px;\n                opacity: 0.7;\n            }\n            .mvu-edit-btns {\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n                margin-top: 16px;\n            }\n            .mvu-edit-btn {\n                padding: 8px 16px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 13px;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                transition: all 0.2s;\n            }\n            .mvu-edit-btn.mvu-btn-cancel {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n            }\n            .mvu-edit-btn.mvu-btn-cancel:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-edit-btn.mvu-btn-save {\n                background: var(--acu-accent);\n                border: 1px solid var(--acu-accent);\n                color: var(--acu-btn-active-text);\n            }\n            .mvu-edit-btn.mvu-btn-save:hover {\n                opacity: 0.9;\n            }\n\n            @keyframes mvuFadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes mvuSlideIn {\n                from { transform: translateY(-20px); opacity: 0; }\n                to { transform: translateY(0); opacity: 1; }\n            }\n\n            /*  */\n            .acu-nav-btn.acu-mvu-btn.active {\n                background: var(--acu-btn-active-bg);\n                color: var(--acu-btn-active-text);\n            }\n        `;\n\n    // =====  =====\n    function escapeHtml(s) {\n      return String(s ?? '')\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#039;');\n    }\n\n    function isAvailable() {\n      const mode = detectMode();\n\n      if (mode === 'era') {\n        // ERA  eventEmit  eventOn  iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const emitAvailable = typeof eventEmit === 'function';\n        const onAvailable = typeof eventOn === 'function';\n        return emitAvailable && onAvailable;\n      } else {\n        // MVU  MVU \n        const mvuAvailable = typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function';\n        return mvuAvailable;\n      }\n    }\n\n    function getData() {\n      console.warn('[DICE]: getData()  MVU  getDataWithRetry()');\n\n      //  ERA  MVU\n      if (cachedEraData) {\n        return cachedEraData;\n      }\n\n      //  MVU\n      try {\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (allVars && allVars.stat_data) {\n            const data = {\n              stat_data: allVars.stat_data || null,\n              display_data: allVars.display_data || {},\n              delta_data: allVars.delta_data || {},\n              schema: allVars.schema || null,\n              _source: 'mvu', // \n            };\n\n            cachedEraData = data; // \n            return data;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE] MVU :', e);\n      }\n\n      return null;\n    }\n\n    // ===== MVU  =====\n    async function getMvuDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // []  MVU API \n        if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n          //  MVU \n          try {\n            await Promise.race([\n              waitGlobalInitialized('Mvu'),\n              new Promise((_, reject) => setTimeout(() => reject(new Error(' MVU ')), 3000)),\n            ]);\n          } catch (e) {\n            console.warn('[DICE] MVU :', e.message);\n            //  MVU \n          }\n        }\n\n        for (let attempt = 1; attempt <= maxRetries; attempt++) {\n          try {\n            if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n              throw new Error('MVU API ');\n            }\n\n            const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n            if (allVars && allVars.stat_data) {\n              const data = {\n                stat_data: allVars.stat_data || null,\n                display_data: allVars.display_data || {},\n                delta_data: allVars.delta_data || {},\n                schema: allVars.schema || null,\n                _source: 'mvu', // \n              };\n\n              //  MVU \n              cachedEraData = data;\n              console.log('[DICE]MVU ');\n              return data;\n            }\n          } catch (e) {\n            console.warn(`[DICE]MVU  ( ${attempt}/${maxRetries}):`, e);\n          }\n\n          if (attempt < maxRetries) {\n            await new Promise(resolve => setTimeout(resolve, retryDelay));\n          }\n        }\n\n        return null;\n      } catch (e) {\n        console.error('[DICE]MVU :', e);\n        return null;\n      }\n    }\n\n    // \n    async function getDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // \n        const detection = await detectModeWithData();\n\n        // \n        if (detection.data) {\n          cachedEraData = detection.data; // \n          return detection.data;\n        }\n\n        // \n        const mode = detection.mode;\n\n        if (mode === 'era') {\n          // ERA \n          for (let attempt = 1; attempt <= maxRetries; attempt++) {\n            try {\n              const data = await getEraData();\n              if (data && data.stat_data) {\n                cachedEraData = data;\n                return data;\n              }\n            } catch (e) {\n              console.warn(`[DICE]ERA  ( ${attempt}/${maxRetries}):`, e);\n            }\n\n            if (attempt < maxRetries) {\n              await new Promise(resolve => setTimeout(resolve, retryDelay));\n            }\n          }\n\n          // ERA  MVU\n          console.warn('[DICE]ERA  MVU');\n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        } else {\n          // MVU \n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        }\n      } catch (e) {\n        console.error('[DICE]:', e);\n        return null;\n      }\n    }\n\n    //  ValueWithDescription  [, \"\"]\n    function isVWD(value) {\n      return (\n        Array.isArray(value) &&\n        value.length === 2 &&\n        typeof value[1] === 'string' &&\n        (typeof value[0] === 'number' || typeof value[0] === 'string' || typeof value[0] === 'boolean')\n      );\n    }\n\n    // \n    function isSimpleArray(value) {\n      if (!Array.isArray(value)) return false;\n      return value.every(\n        item => typeof item === 'string' || typeof item === 'number' || typeof item === 'boolean' || item === null,\n      );\n    }\n\n    // \n    function getChangeIndicator(path, deltaData) {\n      if (!deltaData || !path) return '';\n\n      const parts = path.split('.');\n      let current = deltaData;\n      for (const part of parts) {\n        if (current === null || current === undefined) return '';\n        current = current[part];\n      }\n\n      if (!current) return '';\n\n      if (typeof current === 'string' && current.includes('->')) {\n        const match = current.match(/^(-?[\\d.]+)->(-?[\\d.]+)/);\n        if (match) {\n          const oldVal = parseFloat(match[1]);\n          const newVal = parseFloat(match[2]);\n          if (!isNaN(oldVal) && !isNaN(newVal)) {\n            return newVal > oldVal ? '' : newVal < oldVal ? '' : '';\n          }\n        }\n        return '';\n      }\n      return '';\n    }\n\n    // /\n    function countChildren(value) {\n      if (Array.isArray(value)) {\n        if (isVWD(value)) return 0;\n        return value.length;\n      }\n      if (value && typeof value === 'object') {\n        return Object.keys(value).filter(k => !k.startsWith('$')).length;\n      }\n      return 0;\n    }\n\n    // =====  =====\n\n    // \n    // +++\n    function extractNumericDisplayValue(value, isArray = false) {\n      //  null/undefined\n      if (value === null || value === undefined) {\n        return '';\n      }\n\n      // \n      if (isArray || Array.isArray(value)) {\n        if (isVWD(value)) {\n          return String(value[0]);\n        } else if (isSimpleArray(value)) {\n          return value.map(v => String(v ?? '')).join(', ');\n        } else {\n          // \n          return String(value);\n        }\n      }\n\n      // \n      const str = String(value).trim();\n\n      // 1.  \"85\", \"-20\", \"100%\"\n      if (/^-?\\d+(\\.\\d+)?%?$/.test(str)) {\n        return str;\n      }\n\n      // 2. ++ \",[] \" \n      // \"0,[-20, 120] User...\"\n      const rangeMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)(,\\s*\\[[^\\]]+\\])?\\s+/);\n      if (rangeMatch) {\n        // \n        if (rangeMatch[2]) {\n          return rangeMatch[1] + rangeMatch[2].trim();\n        }\n        // \n        return rangeMatch[1];\n      }\n\n      // 2.5. /, \"/,\" \n      // \"100/100,/'/'\"\n      const slashNumericMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?\\/-?\\d+(?:\\.\\d+)?%?),/);\n      if (slashNumericMatch) {\n        return slashNumericMatch[1];\n      }\n\n      // 3. , \",\" \n      // \"150000,...\"\n      const commaDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?),/);\n      if (commaDescMatch) {\n        return commaDescMatch[1];\n      }\n\n      // 4. + \" \" \n      // \"85 \"\n      const numericDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)\\s+[^\\d]/);\n      if (numericDescMatch) {\n        return numericDescMatch[1];\n      }\n\n      // 5. \n      return str;\n    }\n\n    // \n    // \"85\" -> 85, \"85,[0,100]\" -> 85, \"0,[-20, 120]\" -> 0\n    function extractFirstNumericValue(displayValue) {\n      if (!displayValue) return 0;\n      const str = String(displayValue).trim();\n\n      // \n      const match = str.match(/^(-?\\d+(?:\\.\\d+)?)/);\n      if (match) {\n        const num = parseFloat(match[1]);\n        return isNaN(num) ? 0 : num;\n      }\n\n      return 0;\n    }\n\n    // \n    function renderRow(key, value, path, deltaData) {\n      const changeIndicator = getChangeIndicator(path, deltaData);\n      const changedClass = changeIndicator ? 'mvu-changed' : '';\n\n      let displayValue;\n      let valueClass = 'mvu-value';\n\n      if (isVWD(value)) {\n        displayValue = String(value[0]);\n      } else if (isSimpleArray(value)) {\n        displayValue = value.map(v => String(v ?? '')).join(', ');\n        valueClass += ' mvu-array-value';\n      } else {\n        // \n        displayValue = extractNumericDisplayValue(value ?? '', false);\n      }\n\n      // [] \n      let diceIconHtml = '';\n      try {\n        //  extractNumericDisplayValue \n        //  \"85,[0,100]\"  85  100\n        if (typeof isNumericCell === 'function' && isNumericCell(displayValue)) {\n          // \n          const numericValue = extractFirstNumericValue(displayValue);\n          if (numericValue > 0) {\n            //  key key \n            let attrName = key;\n            if (key.includes('.')) {\n              const parts = key.split('.');\n              attrName = parts[parts.length - 1];\n            }\n            // \n            if (path && path.includes('.')) {\n              const pathParts = path.split('.');\n              const lastPart = pathParts[pathParts.length - 1];\n              // \n              if (lastPart && !/^\\d+$/.test(lastPart) && lastPart !== key) {\n                attrName = lastPart;\n              }\n            }\n            diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon\" data-path=\"${escapeHtml(path)}\" data-attr-name=\"${escapeHtml(attrName)}\" data-attr-value=\"${numericValue}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.6;font-size:calc(var(--acu-font-size, 13px) * 0.85);flex-shrink:0;\" title=\"\"></i>`;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule renderRow: ', e);\n      }\n\n      return `\n                <div class=\"mvu-row ${changedClass}\">\n                    <div class=\"mvu-key\">${escapeHtml(key)}</div>\n                    <div class=\"mvu-value-wrap\">\n                        <span class=\"${valueClass}\" data-path=\"${escapeHtml(path)}\">${escapeHtml(displayValue)}</span>\n                        ${diceIconHtml}\n                        ${changeIndicator ? `<span class=\"mvu-change-indicator\">${changeIndicator}</span>` : ''}\n                    </div>\n                </div>\n            `;\n    }\n\n    // \n    function renderCard(key, value, path, deltaData, depth, defaultExpanded, isHorizontal) {\n      const childCount = countChildren(value);\n      const collapsedClass = defaultExpanded ? '' : 'collapsed';\n\n      let bodyHtml = '';\n      let hasNestedCards = false; // \n      let nestedCardCount = 0; // \n      let rowCount = 0; // \n\n      if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n        // \n        value.forEach((item, index) => {\n          const itemPath = `${path}[${index}]`;\n\n          if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(`[${index}]`, item, itemPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            rowCount++;\n            bodyHtml += renderRow(`[${index}]`, item, itemPath, deltaData);\n          }\n        });\n      } else if (value && typeof value === 'object' && !isVWD(value)) {\n        // \n        const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n\n        for (const [childKey, childValue] of entries) {\n          const childPath = path ? `${path}.${childKey}` : childKey;\n\n          if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n            // /  \n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(childKey, childValue, childPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            //   \n            rowCount++;\n            bodyHtml += renderRow(childKey, childValue, childPath, deltaData);\n          }\n        }\n      }\n\n      const countText = Array.isArray(value) ? `[${childCount}]` : `(${childCount})`;\n\n      //  card-body  horizontal-nested \n      const bodyClass = isHorizontal && hasNestedCards ? 'mvu-card-body horizontal-nested' : 'mvu-card-body';\n\n      // \n      let nestedCardsNeedWidth = false;\n      if (isHorizontal && hasNestedCards && depth === 0) {\n        // \n        if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n          // \n          value.forEach(item => {\n            if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n              const itemChildCount = countChildren(item);\n              if (itemChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          });\n        } else if (value && typeof value === 'object' && !isVWD(value)) {\n          // \n          const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n          for (const [childKey, childValue] of entries) {\n            if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n              const childChildCount = countChildren(childValue);\n              if (childChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          }\n        }\n      }\n\n      //  has-nested-cards \n      // \n      // depth === 0\n      //   -  >= 2  <= 1 has-nested-cards\n      //   -  has-nested-cards\n      // depth > 0rowCount === 0 >= 2  has-nested-cards\n      const shouldAddHasNestedClass =\n        isHorizontal &&\n        hasNestedCards &&\n        ((depth === 0 && ((nestedCardCount >= 2 && rowCount <= 1) || nestedCardsNeedWidth)) || //  >= 2  <= 1\n          (depth > 0 && rowCount === 0 && nestedCardCount >= 2)); //  >= 2\n      const hasNestedClass = shouldAddHasNestedClass ? ' has-nested-cards' : '';\n\n      return `\n                <div class=\"mvu-card${hasNestedClass} ${collapsedClass}\" data-path=\"${escapeHtml(path)}\" data-depth=\"${depth}\">\n                    <div class=\"mvu-card-header\">\n                        <div class=\"mvu-card-title\">\n                            <span>${escapeHtml(key)}</span>\n                            <span class=\"mvu-card-count\">${countText}</span>\n                        </div>\n                        <span class=\"mvu-card-toggle\"></span>\n                    </div>\n                    <div class=\"${bodyClass}\">\n                        ${bodyHtml}\n                    </div>\n                </div>\n            `;\n    }\n\n    // [] \n    function renderNumericMode(mvuData) {\n      if (!mvuData || !mvuData.stat_data) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-inbox\"></i><p></p></div>';\n      }\n\n      // [] \n      let visibleLevels = {};\n      try {\n        const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n        if (saved) {\n          visibleLevels = JSON.parse(saved);\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule ', e);\n      }\n\n      // \n      const numericItems = [];\n\n      // \n      function collectNumericItems(obj, path, levelNames) {\n        if (!obj || typeof obj !== 'object') return;\n\n        if (Array.isArray(obj)) {\n          if (isVWD(obj) || isSimpleArray(obj)) {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const itemValue = String(item ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: itemPath,\n                    key: `[${index}]`,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: [...levelNames],\n                  });\n                }\n              }\n            });\n          } else {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const newLevelNames = [...levelNames, `[${index}]`];\n              collectNumericItems(item, itemPath, newLevelNames);\n            });\n          }\n        } else {\n          // \n          const entries = Object.entries(obj).filter(([k]) => !k.startsWith('$'));\n          for (const [key, value] of entries) {\n            const childPath = path ? `${path}.${key}` : key;\n            const newLevelNames = [...levelNames, key];\n\n            if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n              // \n              collectNumericItems(value, childPath, newLevelNames);\n            } else {\n              // \n              const itemValue = String(value ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: childPath,\n                    key: key,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: newLevelNames,\n                  });\n                }\n              }\n            }\n          }\n        }\n      }\n\n      // \n      const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n      for (const key of topKeys) {\n        const value = mvuData.stat_data[key];\n        collectNumericItems(value, key, [key]);\n      }\n\n      // [] \n      const filteredNumericItems = numericItems.filter(item => {\n        // key\n        // levelNames\n        let lastLevelKey = item.key;\n        const nonArrayLevels = item.levelNames.filter(level => level && !level.startsWith('['));\n        if (nonArrayLevels.length > 0) {\n          lastLevelKey = nonArrayLevels[nonArrayLevels.length - 1];\n        } else if (item.path && item.path.includes('.')) {\n          // levelNamespath\n          const parts = item.path.split('.');\n          lastLevelKey = parts[parts.length - 1];\n        }\n        //  BlacklistManager \n        return !BlacklistManager.isBlacklisted(lastLevelKey);\n      });\n\n      if (filteredNumericItems.length === 0) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-filter\"></i><p></p></div>';\n      }\n\n      // \n      //  2\n      const allLevelNames = new Set();\n      filteredNumericItems.forEach(item => {\n        // \n        const hierarchyLevels =\n          item.levelNames.length > 1\n            ? item.levelNames.slice(0, -1) // \n            : [];\n\n        hierarchyLevels.forEach(level => {\n          if (level && !level.startsWith('[')) {\n            // \n            allLevelNames.add(level);\n          }\n        });\n      });\n\n      const levelNamesArray = Array.from(allLevelNames).sort();\n\n      //  toggle \n      let levelTogglesHtml = '';\n      if (levelNamesArray.length > 0) {\n        const theme = getThemeColors();\n        const buttonTextColor = theme.buttonTextOnAccent || theme.textMain || '#6B4A5A';\n\n        // \n        let levelButtonsHtml = '';\n        levelNamesArray.forEach(levelName => {\n          const isVisible = visibleLevels[levelName] !== false; // \n          const activeStyle = isVisible\n            ? `background:var(--acu-accent);color:${buttonTextColor};border-color:var(--acu-accent);opacity:1;`\n            : 'background:transparent;color:var(--acu-text-sub);border-color:var(--acu-border);opacity:0.5;';\n          levelButtonsHtml += `<button class=\"mvu-level-toggle\" data-level=\"${escapeHtml(levelName)}\" data-visible=\"${isVisible}\" style=\"display:flex;align-items:center;gap:4px;font-size:calc(var(--acu-font-size, 13px) * 0.85);cursor:pointer;padding:2px 6px;border-radius:4px;border:1px solid;${activeStyle}transition:all 0.2s;\" title=\"${isVisible ? '' : ''}: ${escapeHtml(levelName)}\"><span>${escapeHtml(levelName)}</span></button>`;\n        });\n\n        // \n        levelTogglesHtml = `\n          <div class=\"mvu-level-controls-collapsible collapsed\">\n            <div class=\"mvu-level-controls-header\" style=\"padding:6px 8px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);cursor:pointer;display:flex;align-items:center;justify-content:space-between;user-select:none;\">\n              <span style=\"font-size:calc(var(--acu-font-size, 13px) * 0.85);color:var(--acu-text-sub);\"></span>\n              <i class=\"fa-solid fa-chevron-down mvu-level-controls-toggle-icon\" style=\"font-size:10px;color:var(--acu-text-sub);transition:transform 0.2s;\"></i>\n            </div>\n            <div class=\"mvu-level-controls-body\" style=\"padding:8px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);display:flex;flex-wrap:wrap;gap:6px;align-items:center;\">\n              ${levelButtonsHtml}\n            </div>\n          </div>\n        `;\n      }\n\n      // \n      let itemsHtml = '';\n      filteredNumericItems.forEach(item => {\n        //  data-levels \n        const nonArrayLevels = item.levelNames.filter(level => !level.startsWith('['));\n\n        // \n        const visibleLevels = item.levelNames.filter(level => {\n          if (level.startsWith('[')) return false; // \n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        //  1\n        //  visibleLevels \n        const pathLevels = visibleLevels.length > 1 ? visibleLevels.slice(0, -1) : [];\n\n        // \n        //  nonArrayLevels  N-1 \n        const hierarchyLevels = nonArrayLevels.length > 1 ? nonArrayLevels.slice(0, -1) : [];\n\n        const allLevelsVisible = hierarchyLevels.every(level => {\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        // \n        const pathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n        const attrName = item.key;\n\n        // \n        let finalAttrName = attrName;\n        if (item.path && item.path.includes('.')) {\n          const parts = item.path.split('.');\n          finalAttrName = parts[parts.length - 1];\n        }\n\n        // \n        const diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon\" data-path=\"${escapeHtml(item.path)}\" data-attr-name=\"${escapeHtml(finalAttrName)}\" data-attr-value=\"${item.numericValue}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.6;font-size:calc(var(--acu-font-size, 13px) * 0.85);flex-shrink:0;\" title=\"\"></i>`;\n\n        // \n        let displayValue = extractNumericDisplayValue(item.value, false);\n        //  \",[0, 100]\"\n        displayValue = displayValue.replace(/,\\s*\\[[^\\]]+\\]/g, '');\n\n        //  data-levels \n        // data-levels \n        const displayStyle = allLevelsVisible ? '' : 'display:none;';\n        const levelsJson = JSON.stringify(hierarchyLevels);\n\n        itemsHtml += `\n          <div class=\"mvu-numeric-item\" data-levels='${escapeHtml(levelsJson)}' style=\"${displayStyle}display:flex;align-items:center;padding:6px 8px;margin-bottom:4px;background:var(--acu-table-hover);border-radius:4px;border-left:3px solid var(--acu-accent);\">\n            <div style=\"flex:1;min-width:0;\">\n              <div class=\"mvu-path-display\" style=\"font-size:calc(var(--acu-font-size, 13px) * 0.77);color:var(--acu-text-sub);margin-bottom:2px;\">${escapeHtml(pathDisplay)}</div>\n              <div style=\"display:flex;align-items:center;gap:6px;\">\n                <span style=\"font-size:calc(var(--acu-font-size, 13px) * 0.92);color:var(--acu-text-main);font-weight:bold;\">${escapeHtml(finalAttrName)}</span>\n                <span class=\"mvu-value\" data-path=\"${escapeHtml(item.path)}\" style=\"font-size:var(--acu-font-size, 13px);color:var(--acu-accent);font-weight:bold;cursor:pointer;\" title=\"\">${escapeHtml(displayValue)}</span>\n                ${diceIconHtml}\n              </div>\n            </div>\n          </div>\n        `;\n      });\n\n      return levelTogglesHtml + '<div class=\"mvu-numeric-items\" style=\"padding:0 8px;\">' + itemsHtml + '</div>';\n    }\n\n    // =====  API =====\n    return {\n      MODULE_ID: MODULE_ID,\n\n      isAvailable: isAvailable,\n      getData: getData,\n      getDataWithRetry: getDataWithRetry,\n\n      // \n      diagnoseVariableFramework: async function () {\n        const result = {\n          timestamp: new Date().toISOString(),\n          era: {\n            available: false,\n            eventEmit: typeof (window.eventEmit || window.parent?.eventEmit) === 'function',\n            eventOn: typeof (window.eventOn || window.parent?.eventOn) === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          mvu: {\n            available: false,\n            apiExists: typeof window.Mvu !== 'undefined',\n            getDataExists: typeof window.Mvu?.getMvuData === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          cache: {\n            hasCache: !!cachedEraData,\n            cacheKeys: cachedEraData ? Object.keys(cachedEraData) : [],\n          },\n          recommendation: '',\n        };\n\n        //  ERA\n        if (result.era.eventEmit && result.era.eventOn) {\n          try {\n            const eraData = await Promise.race([\n              getEraData(),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 2000)),\n            ]);\n            result.era.available = true;\n            result.era.dataAvailable = !!(eraData && eraData.stat_data);\n          } catch (e) {\n            result.era.error = e.message;\n          }\n        }\n\n        //  MVU\n        if (result.mvu.apiExists && result.mvu.getDataExists) {\n          try {\n            // [] \n            await Promise.race([\n              waitGlobalInitialized('Mvu'),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('')), 2000)),\n            ]);\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            result.mvu.available = true;\n            result.mvu.dataAvailable = !!(mvuData && mvuData.stat_data);\n          } catch (e) {\n            result.mvu.error = e.message;\n          }\n        }\n\n        // \n        if (result.era.dataAvailable) {\n          result.recommendation = 'ERA ';\n        } else if (result.mvu.dataAvailable) {\n          result.recommendation = 'MVU ';\n        } else if (result.era.available || result.mvu.available) {\n          result.recommendation = '';\n        } else {\n          result.recommendation = ' MVU  ERA ';\n        }\n\n        return result;\n      },\n\n      injectStyles: function () {\n        //  document iframe \n        const targetDoc = window.parent?.document || document;\n        if (targetDoc.getElementById('mvu-module-styles')) return;\n        const styleEl = targetDoc.createElement('style');\n        styleEl.id = 'mvu-module-styles';\n        styleEl.textContent = STYLES;\n        targetDoc.head.appendChild(styleEl);\n      },\n\n      renderNavButton: function (isActive) {\n        //  isAvailable()\n        const activeClass = isActive ? 'active' : '';\n        return `<button class=\"acu-nav-btn acu-mvu-btn $${activeClass}\" id=\"acu-btn-mvu\" data-table=\"$${MODULE_ID}\" style=\"order:-1;\">\n                    <i class=\"fa-solid fa-code-branch\"></i><span></span>\n                </button>`;\n      },\n\n      renderPanel: function () {\n        // \n        // \n\n        const mvuData = getData();\n\n        // MVU  ERA\n        const varMode = detectMode();\n        const isEraMode = varMode === 'era';\n\n        // [] \n        let isNumericMode = false;\n        try {\n          const saved = localStorage.getItem('acu_mvu_numeric_mode');\n          isNumericMode = saved === 'true';\n        } catch (e) {\n          console.warn('[DICE]MvuModule ', e);\n        }\n\n        // MVU\n        const layoutMode = 'vertical-layout';\n\n        // \n        const panelTitle = isEraMode ? 'ERA ' : 'MVU ';\n\n        // MVU  null\n        if (!mvuData) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-exclamation-circle\"></i>\n                                <p> ${isEraMode ? 'ERA' : 'MVU'} </p>\n                                <p class=\"mvu-empty-hint\"> ${isEraMode ? 'ERA ' : 'MVU '}</p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        //  stat_data  null\n        if (\n          !mvuData.stat_data ||\n          (typeof mvuData.stat_data === 'object' && Object.keys(mvuData.stat_data).length === 0)\n        ) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-inbox\"></i>\n                                <p></p>\n                                <p class=\"mvu-empty-hint\"> AI </p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        // [] \n        if (isNumericMode) {\n          const numericHtml = renderNumericMode(mvuData);\n          return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span> <span style=\"font-size:calc(var(--acu-font-size,13px) * 0.85);color:var(--acu-text-sub);margin-left:6px;\">()</span></div>\n                            <div class=\"acu-title-sub\">()</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode active\" title=\"\">\n                                <i class=\"fa-solid fa-list\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode} mvu-numeric-mode\">\n                        ${numericHtml}\n                    </div>\n                `;\n        }\n\n        // \n        const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n\n        let cardsHtml = '';\n        for (const key of topKeys) {\n          const value = mvuData.stat_data[key];\n          const childCount = countChildren(value);\n\n          if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n            // /  \n            // MVU isHorizontal  false\n            cardsHtml += renderCard(key, value, key, mvuData.delta_data, 0, true, false);\n          } else {\n            //   \n            cardsHtml += `\n                            <div class=\"mvu-card\" data-path=\"${escapeHtml(key)}\" data-depth=\"0\">\n                                <div class=\"mvu-card-body\">\n                                    ${renderRow(key, value, key, mvuData.delta_data)}\n                                </div>\n                            </div>\n                        `;\n          }\n        }\n\n        return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                            <div class=\"acu-title-sub\">(${topKeys.length})</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode\" title=\"\">\n                                <i class=\"fa-solid fa-filter\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode}\">\n                        ${cardsHtml}\n                    </div>\n                `;\n      },\n\n      bindEvents: function ($container) {\n        //  jQuery\n        const $ = window.parent?.jQuery || window.jQuery;\n        if (!$ || !$container || !$container.length) {\n          console.warn('[DICE]MvuModule bindEvents: jQuery or container not available');\n          return;\n        }\n\n        //  jQuery \n        const $panel = $('#acu-data-area');\n        if (!$panel.length) {\n          console.warn('[DICE]MvuModule bindEvents: #acu-data-area not found');\n          return;\n        }\n\n        // \n        $panel.off('.mvu');\n\n        // /\n        $panel.on('click.mvu', '.mvu-card-header', function (e) {\n          e.stopPropagation();\n          const $card = $(this).closest('.mvu-card');\n          const $body = $card.find('> .mvu-card-body').first();\n\n          // \n          if ($body.is(':animated') || $body.hasClass('animating')) return;\n\n          if ($card.hasClass('collapsed')) {\n            //  hide()  collapsed \n            $body.hide();\n            $card.removeClass('collapsed');\n            $body.addClass('animating').slideDown(180, function () {\n              $(this).removeClass('animating');\n            });\n          } else {\n            // \n            $body.addClass('animating').slideUp(180, function () {\n              $card.addClass('collapsed');\n              $(this).removeClass('animating');\n            });\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-btn-refresh', function (e) {\n          e.stopPropagation();\n          MvuModule.refresh($panel);\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-btn-numeric-mode', function (e) {\n          e.stopPropagation();\n          try {\n            const isCurrentlyNumeric = $(this).hasClass('active');\n            const newMode = !isCurrentlyNumeric;\n            localStorage.setItem('acu_mvu_numeric_mode', String(newMode));\n            // \n            if (typeof saveActiveTabState === 'function') {\n              const currentTab = getActiveTabState();\n              saveActiveTabState(currentTab);\n            }\n            if (typeof renderInterface === 'function') {\n              renderInterface();\n            }\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n            if (window.toastr) window.toastr.error('');\n          }\n        });\n\n        // [] /\n        $panel.on('click.mvu', '.mvu-level-controls-header', function (e) {\n          e.stopPropagation();\n          const $header = $(this);\n          const $collapsible = $header.closest('.mvu-level-controls-collapsible');\n\n          //  collapsed CSS \n          $collapsible.toggleClass('collapsed');\n        });\n\n        // []  toggle\n        $panel.on('click.mvu', '.mvu-level-toggle', function (e) {\n          e.stopPropagation();\n          const $button = $(this);\n          const levelName = $button.data('level');\n          const currentVisible = $button.data('visible') === 'true' || $button.data('visible') === true;\n          const isVisible = !currentVisible;\n\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            const visibleLevels = saved ? JSON.parse(saved) : {};\n            visibleLevels[levelName] = isVisible;\n            localStorage.setItem('acu_mvu_numeric_mode_visible_levels', JSON.stringify(visibleLevels));\n\n            // \n            const theme = getThemeColors();\n            const buttonTextColor = theme.buttonTextOnAccent || theme.textMain || '#6B4A5A';\n            $button.data('visible', isVisible);\n            if (isVisible) {\n              $button.css({\n                background: 'var(--acu-accent)',\n                color: buttonTextColor,\n                borderColor: 'var(--acu-accent)',\n                opacity: '1',\n              });\n              $button.attr('title', `: ${levelName}`);\n            } else {\n              $button.css({\n                background: 'transparent',\n                color: 'var(--acu-text-sub)',\n                borderColor: 'var(--acu-border)',\n                opacity: '0.5',\n              });\n              $button.attr('title', `: ${levelName}`);\n            }\n\n            //  3\n            $('.mvu-numeric-item').each(function () {\n              const $item = $(this);\n              try {\n                const levels = JSON.parse($item.attr('data-levels') || '[]');\n                if (levels.includes(levelName)) {\n                  // \n                  const visibleLevels = levels.filter(level => {\n                    const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n                    const prefs = saved ? JSON.parse(saved) : {};\n                    return prefs[level] !== false;\n                  });\n\n                  //  levels \n                  const pathLevels = visibleLevels;\n\n                  const newPathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n\n                  // \n                  $item.find('.mvu-path-display').text(newPathDisplay);\n                }\n              } catch (e) {\n                console.warn('[DICE]MvuModule ', e);\n              }\n            });\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-value', function (e) {\n          e.stopPropagation();\n          const $value = $(this);\n          const path = $value.data('path');\n          if (!path) {\n            console.warn('[DICE]MvuModule No path on value element');\n            return;\n          }\n          const currentValue = $value\n            .text()\n            .replace(/\\s*\\$\\s*$/, '')\n            .trim(); //  $\n\n          MvuModule.showEditDialog(path, currentValue, async function (newValue) {\n            if (newValue !== null && newValue !== currentValue) {\n              const success = await MvuModule.setValue(path, newValue);\n              const toastr = window.parent?.toastr || window.toastr;\n              if (success) {\n                $value.text(newValue);\n                $value.css('background', 'var(--acu-success-bg)');\n                setTimeout(() => $value.css('background', ''), 1500);\n              } else {\n                if (toastr) toastr.error('');\n              }\n            }\n          });\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-dice-icon', function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n          const $icon = $(this);\n          const path = $icon.data('path');\n          const attrName = $icon.data('attr-name') || '';\n          const attrValue = parseInt($icon.data('attr-value'), 10) || 50;\n\n          // \n          if (!path) {\n            console.warn('[DICE]MvuModule ');\n            return;\n          }\n\n          //  MVU \n          if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n            console.warn('[DICE]MvuModule MVU ');\n            // \n            if (typeof showDicePanel === 'function') {\n              showDicePanel({\n                attrValue: attrValue,\n                targetValue: null, // showDicePanel\n                targetName: attrName,\n                initiatorName: '<user>',\n                fromMvu: false,\n              });\n            }\n            return;\n          }\n\n          // \n          let parsedInfo = null;\n          try {\n            parsedInfo = parseMvuPathForDice(path, attrValue);\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n\n          // \n          if (typeof showDicePanel === 'function') {\n            showDicePanel({\n              attrValue: attrValue,\n              targetValue: null, // showDicePanel\n              targetName: attrName,\n              initiatorName: parsedInfo?.initiator || '<user>',\n              fromMvu: true,\n              mvuPath: path,\n              mvuParsedInfo: parsedInfo,\n            });\n          }\n        });\n\n        //  ST  swipe regenerate\n        (function () {\n          //  documentiframe \n          const targetDoc = window.parent?.document || document;\n          const $doc = $(targetDoc);\n\n          // \n          $doc.off('touchstart.mvuSwipeFix touchmove.mvuSwipeFix touchend.mvuSwipeFix', '#acu-data-area');\n\n          let touchStartX = 0;\n          let touchStartY = 0;\n          let isHorizontalSwipe = false;\n\n          //  #acu-data-area  MVU \n          $doc.on('touchstart.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) return;\n\n            if (e.originalEvent.touches.length === 1) {\n              touchStartX = e.originalEvent.touches[0].clientX;\n              touchStartY = e.originalEvent.touches[0].clientY;\n              isHorizontalSwipe = false;\n            }\n          });\n\n          $doc.on('touchmove.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              return;\n            }\n\n            if (e.originalEvent.touches.length !== 1) return;\n\n            const touch = e.originalEvent.touches[0];\n            const deltaX = Math.abs(touch.clientX - touchStartX);\n            const deltaY = Math.abs(touch.clientY - touchStartY);\n\n            // X > Y * 1.5\n            // deltaYdeltaX\n            const isHorizontal =\n              deltaY < 5\n                ? deltaX > 5 && deltaX > deltaY * 2 // deltaYdeltaX > 5deltaY\n                : deltaX > deltaY * 1.5 && deltaX > 10; // \n\n            if (isHorizontal) {\n              isHorizontalSwipe = true;\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n            }\n          });\n\n          $doc.on('touchend.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              isHorizontalSwipe = false;\n              touchStartX = 0;\n              touchStartY = 0;\n              return;\n            }\n\n            // \n            if (isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              isHorizontalSwipe = false;\n            }\n            touchStartX = 0;\n            touchStartY = 0;\n          });\n\n          // \n          const captureHandlerTouchStart = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1) {\n              touchStartX = e.touches[0].clientX;\n              touchStartY = e.touches[0].clientY;\n            }\n          };\n          const captureHandlerTouchMove = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1 && touchStartX && touchStartY) {\n              const touch = e.touches[0];\n              const deltaX = Math.abs(touch.clientX - touchStartX);\n              const deltaY = Math.abs(touch.clientY - touchStartY);\n              // \n              const isHorizontal =\n                deltaY < 5 ? deltaX > 5 && deltaX > deltaY * 2 : deltaX > deltaY * 1.5 && deltaX > 10;\n              if (isHorizontal) {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                e.preventDefault();\n              }\n            }\n          };\n          const captureHandlerTouchEnd = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              e.preventDefault();\n            }\n          };\n          // \n          targetDoc.addEventListener('touchstart', captureHandlerTouchStart, true);\n          targetDoc.addEventListener('touchmove', captureHandlerTouchMove, true);\n          targetDoc.addEventListener('touchend', captureHandlerTouchEnd, true);\n        })();\n\n        // \n        $panel.on('click.mvu', '.acu-close-btn', function (e) {\n          e.stopPropagation();\n          const $input = $panel.find('.acu-search-input');\n\n          // \n          if ($input.length && $input.val()) {\n            $input.val('').trigger('input').focus();\n            return;\n          }\n\n          // \n          if (typeof saveActiveTabState === 'function') {\n            saveActiveTabState(null);\n          }\n          if (typeof renderInterface === 'function') {\n            renderInterface();\n          }\n        });\n\n        // \n        $panel.on('pointerdown.mvu', '.acu-height-drag-handle', function (e) {\n          if (e.button !== 0) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const handle = this;\n          handle.setPointerCapture(e.pointerId);\n          $(handle).addClass('active');\n          const startHeight = $panel.height();\n          const startY = e.clientY;\n          const tableName = $(handle).data('table');\n\n          //  MIN_PANEL_HEIGHT  MAX_PANEL_HEIGHT\n          const MIN_PANEL_HEIGHT = typeof window.MIN_PANEL_HEIGHT !== 'undefined' ? window.MIN_PANEL_HEIGHT : 200;\n          const MAX_PANEL_HEIGHT = typeof window.MAX_PANEL_HEIGHT !== 'undefined' ? window.MAX_PANEL_HEIGHT : 800;\n\n          handle.onpointermove = function (moveE) {\n            const dy = moveE.clientY - startY;\n            let newHeight = startHeight - dy; // \n            if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n            if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n            $panel.css('height', newHeight + 'px');\n          };\n          handle.onpointerup = function (upE) {\n            $(handle).removeClass('active');\n            handle.releasePointerCapture(upE.pointerId);\n            handle.onpointermove = null;\n            handle.onpointerup = null;\n            if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n              const heights = getTableHeights();\n              heights[tableName] = parseInt($panel.css('height'));\n              saveTableHeights(heights);\n              $panel.addClass('acu-manual-mode');\n            }\n          };\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-height-drag-handle', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = $(this).data('table');\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-panel-header', function (e) {\n          if ($(e.target).closest('.acu-search-input, .acu-close-btn, .mvu-header-btn').length) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = MvuModule.MODULE_ID;\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n      },\n\n      showEditDialog: function (path, currentValue, onSave) {\n        //  jQuery  document\n        const $ = window.parent?.jQuery || window.jQuery;\n        const targetDoc = window.parent?.document || document;\n        if (!$) return;\n\n        // \n        $(targetDoc).find('.mvu-edit-overlay').remove();\n\n        const currentTheme = (typeof getConfig === 'function' ? getConfig().theme : null) || 'retro';\n\n        const html = `\n                    <div class=\"mvu-edit-overlay acu-edit-overlay acu-theme-${currentTheme}\">\n                        <div class=\"mvu-edit-dialog acu-edit-dialog\">\n                            <div class=\"acu-edit-title\">\n                                <i class=\"fa-solid fa-edit\" style=\"opacity:0.7;\"></i>\n                                <span></span>\n                            </div>\n                            <div class=\"mvu-edit-path\">${escapeHtml(path)}</div>\n                            <textarea class=\"mvu-edit-textarea acu-edit-textarea\">${escapeHtml(currentValue)}</textarea>\n                            <div class=\"mvu-edit-hint\">Ctrl+Enter  | Esc </div>\n                            <div class=\"acu-dialog-btns\">\n                                <button class=\"acu-dialog-btn mvu-btn-cancel\">\n                                    <i class=\"fa-solid fa-times\"></i> \n                                </button>\n                                <button class=\"acu-dialog-btn acu-btn-confirm mvu-btn-save\">\n                                    <i class=\"fa-solid fa-check\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `;\n\n        $(targetDoc.body).append(html);\n        const $overlay = $(targetDoc).find('.mvu-edit-overlay');\n        const $input = $overlay.find('.mvu-edit-textarea');\n\n        setTimeout(() => $input.focus().select(), 50);\n\n        // \n        $overlay.on('click', '.mvu-btn-cancel', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          $overlay.remove();\n          onSave(null);\n        });\n\n        // \n        $overlay.on('click', '.mvu-btn-save', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const newValue = $input.val();\n          $overlay.remove();\n          onSave(newValue);\n        });\n\n        // \n        setupOverlayClose($overlay, 'mvu-edit-overlay', () => {\n          $overlay.remove();\n          onSave(null);\n        });\n\n        // \n        $input.on('keydown', function (e) {\n          if (e.key === 'Escape') {\n            e.preventDefault();\n            $overlay.remove();\n            onSave(null);\n          } else if (e.key === 'Enter' && e.ctrlKey) {\n            e.preventDefault();\n            const newValue = $input.val();\n            $overlay.remove();\n            onSave(newValue);\n          }\n        });\n      },\n\n      setValue: async function (path, newValue) {\n        if (!isAvailable()) return false;\n\n        const mode = detectMode();\n\n        try {\n          let parsedValue = newValue;\n          if (newValue === 'true') parsedValue = true;\n          else if (newValue === 'false') parsedValue = false;\n          else if (!isNaN(Number(newValue)) && String(newValue).trim() !== '') {\n            parsedValue = Number(newValue);\n          }\n\n          if (mode === 'era') {\n            return await setEraValue(path, parsedValue);\n          } else {\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            if (!mvuData) {\n              console.error('[DICE]MvuModule  MVU ');\n              return false;\n            }\n\n            const success = await window.Mvu.setMvuVariable(mvuData, path, parsedValue, {\n              reason: '',\n              is_recursive: false,\n            });\n\n            if (success) {\n              await window.Mvu.replaceMvuData(mvuData, { type: 'message', message_id: 'latest' });\n            } else {\n              console.warn('[DICE]MvuModule setMvuVariable  false');\n            }\n\n            return success;\n          }\n        } catch (e) {\n          console.error('[DICE]MvuModule setValue error:', e);\n          return false;\n        }\n      },\n\n      isModuleTab: function (tableName) {\n        return tableName === MODULE_ID;\n      },\n\n      //  ERA  ERA \n      clearCache: function () {\n        cachedEraData = null;\n        console.log('[DICE]MvuModule  ERA ');\n      },\n\n      // \n      detectMode: function () {\n        return detectMode();\n      },\n\n      refresh: function ($container) {\n        // \n        this.clearCache();\n\n        if (!$container || !$container.length) {\n          const $panel = $('#acu-data-area');\n          if (!$panel.length) return;\n          $container = $panel;\n        }\n        // \n        const $refreshBtn = $container.find('.mvu-btn-refresh');\n        if ($refreshBtn.length) {\n          $refreshBtn.find('i').addClass('fa-spin');\n        }\n\n        // \n        //  10  1  10 \n        this.getDataWithRetry(10, 1000)\n          .then(mvuData => {\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            // []  toastr  renderPanel \n            //  getDataWithRetry \n            const toastr = window.parent?.toastr || window.toastr;\n            const actualData = this.getData();\n            if (toastr && !actualData) {\n              toastr.warning(' MVU ');\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error refreshing data:', err);\n\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            // [] \n            const toastr = window.parent?.toastr || window.toastr;\n            const actualData = this.getData();\n            if (toastr && !actualData) {\n              toastr.error('');\n            }\n          });\n      },\n    };\n  })();\n  // MVU \n  // COC\n  const DEFAULT_DICE_CONFIG = {\n    critSuccessMax: 5,\n    hardSuccessDiv: 5,\n    difficultSuccessDiv: 2,\n    critFailMin: 96,\n    ruleType: 'high_good',\n    lastDiceType: '1d100',\n    // DND \n    dndCritSuccess: 20,\n    dndCritFail: 1,\n    // : initiator_lose | tie | initiator_win\n    contestTieRule: 'initiator_lose',\n    // \n    hideDiceResultFromUser: false,\n    // \n    hideDiceResultInChat: false,\n  };\n\n  const getDiceConfig = () => Store.get(STORAGE_KEY_DICE_CONFIG, DEFAULT_DICE_CONFIG);\n  const saveDiceConfig = cfg => {\n    const oldCfg = getDiceConfig();\n    const newCfg = { ...oldCfg, ...cfg };\n    Store.set(STORAGE_KEY_DICE_CONFIG, newCfg);\n    // \n    const changedKeys = Object.keys(cfg).filter(k => oldCfg[k] !== newCfg[k]);\n    if (changedKeys.length > 0) {\n      console.info(`[DICE]: ${changedKeys.join(', ')}`);\n    }\n  };\n\n  // [] \n  const hideDiceResultsInUserMessages = () => {\n    try {\n      const diceCfg = getDiceConfig();\n      const hideInput = diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const hideChat = diceCfg.hideDiceResultInChat !== undefined ? diceCfg.hideDiceResultInChat : false;\n\n      // : \"XX\"\n      const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n      // : \"  vs    (...)  ......  (...)  .........\"\n      const contestDiceRegex =\n        /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n      // ==========  hideInput  ==========\n      try {\n        const $ta = $('#send_textarea');\n        if ($ta.length) {\n          let textareaVal = $ta.val() || '';\n          let modifiedText = textareaVal;\n\n          if (hideInput) {\n            // \n            const contestRegex =\n              /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n            const normalRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n            if (contestRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(contestRegex, '[]');\n            }\n            if (normalRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(normalRegex, '[]');\n            }\n          } else {\n            // \n            const originalText = $ta.data('acu-original-dice-text');\n            if (originalText && textareaVal.includes('[]')) {\n              // \n              modifiedText = textareaVal.replace(/\\[\\]/g, originalText);\n              $ta.removeData('acu-original-dice-text');\n            }\n          }\n\n          if (modifiedText !== textareaVal) {\n            $ta.val(modifiedText).trigger('input').trigger('change');\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]ACU :', e);\n      }\n\n      // ==========  hideChat  ==========\n      // \n      let lastMessageId;\n      try {\n        lastMessageId = getLastMessageId();\n      } catch (e) {\n        //  lastMessageId \n        return;\n      }\n\n      // \n      if (lastMessageId < 0) {\n        return;\n      }\n\n      try {\n        const userMessages = getChatMessages(`0-${lastMessageId}`, { role: 'user' });\n        // \n        if (!userMessages || userMessages.length === 0) {\n          return;\n        }\n\n        if (hideChat) {\n          // \n          let hiddenCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const $msgElement = retrieveDisplayedMessage(msg.message_id);\n              if (!$msgElement || !$msgElement.length) {\n                return;\n              }\n\n              // \n              let $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) {\n                // \n                $mesText = $msgElement.find('.message-text, .text, [class*=\"text\"], [class*=\"message\"]').first();\n                if (!$mesText || !$mesText.length) {\n                  // \n                  $mesText = $msgElement;\n                }\n              }\n\n              // DOM\n              const currentDomText = $mesText.text();\n              // \n              if (currentDomText.includes('[]')) {\n                return;\n              }\n\n              // AI\n              const originalText = msg.message || '';\n              if (!originalText) {\n                return;\n              }\n\n              // \n              let modifiedText = originalText;\n\n              // \n              //  lastIndex \n              const contestRegex =\n                /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n              const contestMatch = contestRegex.test(modifiedText);\n              if (contestMatch) {\n                modifiedText = modifiedText.replace(contestRegex, '[]');\n              }\n\n              // \n              const normalRegex =\n                /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n              const normalMatch = normalRegex.test(modifiedText);\n              if (normalMatch) {\n                modifiedText = modifiedText.replace(normalRegex, '[]');\n              }\n\n              // DOM\n              // HTMLHTML\n              if (modifiedText !== originalText && modifiedText !== currentDomText) {\n                // HTML\n                const currentHtml = $mesText.html();\n                // HTMLHTML\n                let modifiedHtml = currentHtml;\n\n                // \n                const contestPattern =\n                  /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n                if (contestPattern.test(currentHtml)) {\n                  modifiedHtml = modifiedHtml.replace(contestPattern, '[]');\n                }\n\n                // \n                const normalPattern =\n                  /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n                if (normalPattern.test(currentHtml)) {\n                  modifiedHtml = modifiedHtml.replace(normalPattern, '[]');\n                }\n\n                // HTML\n                if (modifiedHtml !== currentHtml) {\n                  $mesText.html(modifiedHtml);\n                  hiddenCount++;\n                }\n              }\n            } catch (e) {\n              console.warn(`[DICE]ACU  ${msg.message_id} :`, e);\n            }\n          });\n          if (hiddenCount > 0) {\n            console.info(`[DICE] ${hiddenCount} `);\n          }\n        } else {\n          // \n          let restoredCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const $msgElement = retrieveDisplayedMessage(msg.message_id);\n              if (!$msgElement || !$msgElement.length) return;\n\n              const $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) return;\n\n              // \n              const currentText = $mesText.text();\n              if (currentText.includes('[]')) {\n                // \n                const originalText = msg.message || '';\n                if (originalText) {\n                  $mesText.text(originalText);\n                  restoredCount++;\n                }\n              }\n            } catch (e) {\n              // \n            }\n          });\n          if (restoredCount > 0) {\n            console.info(`[DICE] ${restoredCount} `);\n          }\n        }\n      } catch (e) {\n        // \n        // \n        if (hideChat) {\n          console.warn('[DICE]ACU :', e);\n        }\n      }\n    } catch (e) {\n      // [] \n      // \n      const diceCfg = getDiceConfig();\n      if (diceCfg && (diceCfg.hideDiceResultFromUser || diceCfg.hideDiceResultInChat)) {\n        console.warn('[DICE]ACU :', e);\n      }\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const BUILTIN_ATTRIBUTE_PRESETS = [\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'coc7',\n      name: 'COC',\n      builtin: true,\n      description: '7816',\n      baseAttributes: [\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n      ],\n      specialAttributes: [\n        //  15-1109560\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        //  9-8547\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        //  8-6536\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        //  3-4122\n        { name: '', formula: '1+2d20', range: [3, 41] },\n        // \n        { name: '', formula: '/2', range: [1, 99] },\n        // COC \n        { name: 'SAN', formula: '', range: [1, 99] },\n        { name: '', formula: '1d5', range: [1, 5] },\n      ],\n    },\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'dnd5e',\n      name: 'DND',\n      builtin: true,\n      description: '568',\n      baseAttributes: [\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n      ],\n      specialAttributes: [\n        //  10-2015\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        //  7-1712\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        //  4-149\n        { name: '', formula: '2+2d6', range: [4, 14] },\n        { name: '', formula: '2+2d6', range: [4, 14] },\n      ],\n    },\n  ];\n\n  // \n  const AttributePresetManager = (() => {\n    let _cache = null;\n\n    return {\n      //  + \n      getAllPresets() {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        // \n        let needsSave = false;\n        stored.forEach(preset => {\n          const presetVersion = preset.version || '0.0.0';\n          if (compareVersion(presetVersion, PRESET_FORMAT_VERSION) < 0) {\n            console.log(\n              `[DICE]AttributePresetManager  \"${preset.name}\"  (${presetVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n            preset.version = PRESET_FORMAT_VERSION;\n            needsSave = true;\n          }\n        });\n        if (needsSave) {\n          Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n          // \n          _cache = null;\n        }\n        // \n        if (!needsSave && _cache) {\n          return _cache;\n        }\n        _cache = [...BUILTIN_ATTRIBUTE_PRESETS, ...stored];\n        return _cache;\n      },\n\n      // null = \n      getActivePreset() {\n        const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        if (!activeId) return null;\n        return this.getAllPresets().find(p => p.id === activeId) || null;\n      },\n\n      // \n      setActivePreset(id) {\n        try {\n          // idnull\n          const finalId = id === '' || id === undefined ? null : id;\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, finalId);\n          // \n          _cache = null;\n          console.log('[DICE]AttributePresetManager :', finalId);\n          return true;\n        } catch (err) {\n          console.error('[DICE]AttributePresetManager :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const newPreset = {\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          builtin: false,\n          version: preset.version || PRESET_FORMAT_VERSION,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates };\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        }\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getAllPresets().find(p => p.id === id);\n        if (!preset) return null;\n        const exported = {\n          format: 'acu_attr_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n        };\n        delete exported.builtin; // \n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr, autoUpdate = false) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.format !== 'acu_attr_preset_v1') {\n            throw new Error('');\n          }\n\n          // \n          if (!data.name || !data.baseAttributes || !Array.isArray(data.baseAttributes)) {\n            throw new Error('');\n          }\n\n          const importedVersion = data.version || '0.0.0';\n          const needsUpdate = compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            builtin: false,\n            version: autoUpdate && needsUpdate ? PRESET_FORMAT_VERSION : importedVersion,\n            createdAt: new Date().toISOString(),\n          };\n\n          const result = this.createPreset(imported);\n          if (result && needsUpdate && !autoUpdate) {\n            console.warn(\n              `[DICE]AttributePresetManager  \"${result.name}\"  (${importedVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n          }\n          return result;\n        } catch (e) {\n          console.error('[DICE]AttributePresetManager :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  // ActionPresetManager  JS \n  // interface ActionGroupPreset {\n  //   format: 'acu_action_preset_v1';\n  //   version: string;\n  //   id: string;\n  //   name: string;\n  //   builtin: boolean;\n  //   description?: string;\n  //   rules: ActionRule[];\n  // }\n  // interface ActionRule {\n  //   table_keywords: string[];\n  //   actions: ActionItem[];\n  // }\n  // interface ActionItem {\n  //   label: string;\n  //   icon?: string;\n  //   template?: string;\n  // }\n\n  // \n  const BUILTIN_ACTION_PRESETS = [\n    {\n      format: 'acu_action_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: '__builtin_default__',\n      name: '',\n      builtin: true,\n      description: '',\n      rules: [\n        {\n          table_keywords: ['', '', 'Location', 'Map', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', 'NPC', '', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n      ],\n    },\n  ];\n\n  const ActionPresetManager = (() => {\n    let _cache = null;\n\n    return {\n      //  + \n      getAllPresets() {\n        if (_cache) return _cache;\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        _cache = [...BUILTIN_ACTION_PRESETS, ...stored];\n        return _cache;\n      },\n\n      // ID\n      getPresetById(id) {\n        return this.getAllPresets().find(p => p.id === id) || null;\n      },\n\n      // ID\n      getActivePresetId() {\n        const stored = Store.get(STORAGE_KEY_ACTIVE_ACTION_PRESET, '__builtin_default__');\n        return stored === null ? '__builtin_default__' : stored;\n      },\n\n      // \n      getActivePreset() {\n        const activeId = this.getActivePresetId();\n        if (!activeId || activeId === '__none__') return null;\n        return this.getPresetById(activeId);\n      },\n\n      // '__none__' \n      setActivePresetId(id) {\n        try {\n          const finalId = id === '' || id === undefined || id === null ? '__none__' : id;\n          Store.set(STORAGE_KEY_ACTIVE_ACTION_PRESET, finalId);\n          _cache = null;\n          console.log('[DICE]ActionPresetManager :', finalId);\n          return true;\n        } catch (err) {\n          console.error('[DICE]ActionPresetManager :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        const newPreset = {\n          format: 'acu_action_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          builtin: false,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ACTION_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]ActionPresetManager :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates, version: PRESET_FORMAT_VERSION };\n        Store.set(STORAGE_KEY_ACTION_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]ActionPresetManager :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ACTION_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ACTION_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ACTION_PRESET, null);\n        }\n        console.log('[DICE]ActionPresetManager :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getPresetById(id);\n        if (!preset) return null;\n        const exported = {\n          format: 'acu_action_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n        };\n        delete exported.builtin;\n        delete exported.createdAt;\n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.format !== 'acu_action_preset_v1') {\n            throw new Error(' acu_action_preset_v1');\n          }\n\n          // \n          if (!data.name || !data.rules || !Array.isArray(data.rules)) {\n            throw new Error(' name  rules ');\n          }\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            builtin: false,\n            version: PRESET_FORMAT_VERSION,\n            createdAt: new Date().toISOString(),\n          };\n\n          const result = this.createPreset(imported);\n          return result;\n        } catch (e) {\n          console.error('[DICE]ActionPresetManager :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const getCrazyModeConfig = () => {\n    const stored = Store.get(STORAGE_KEY_CRAZY_MODE, null);\n    if (!stored) return { ...DEFAULT_CRAZY_MODE_CONFIG };\n    return { ...DEFAULT_CRAZY_MODE_CONFIG, ...stored };\n  };\n\n  // \n  const saveCrazyModeConfig = config => {\n    Store.set(STORAGE_KEY_CRAZY_MODE, config);\n  };\n\n  // \n  const shouldTriggerCrazyMode = () => {\n    const config = getCrazyModeConfig();\n    if (!config.enabled) return false;\n    // crazyLevel \n    const roll = Math.random() * 100;\n    return roll < config.crazyLevel;\n  };\n\n  // \n  const selectCrazyRollType = crazyLevel => {\n    // crazyLevel < 50: 100% \n    // crazyLevel 50-75: 70%  / 30% \n    // crazyLevel > 75: 50%  / 50% \n    if (crazyLevel < 50) return 'normal';\n    const contestChance = crazyLevel <= 75 ? 0.3 : 0.5;\n    return Math.random() < contestChance ? 'contest' : 'normal';\n  };\n\n  // \n  const weightedRandomSelect = items => {\n    if (!items || items.length === 0) return null;\n    const totalWeight = items.reduce((sum, item) => sum + (item.weight || 1), 0);\n    let random = Math.random() * totalWeight;\n    for (const item of items) {\n      random -= item.weight || 1;\n      if (random <= 0) return item;\n    }\n    return items[items.length - 1];\n  };\n\n  // \n  const selectCrazyParticipant = () => {\n    const config = getCrazyModeConfig();\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return null;\n\n    const allTables = processJsonData(rawData || {});\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n\n    // \n    const candidates = [];\n\n    // \n    if (playerResult?.data?.rows?.length > 0) {\n      const playerName = getDisplayPlayerName() || '';\n      const playerAttrs = getFullAttributesForCharacter('<user>');\n      candidates.push({\n        name: playerName,\n        attrs: playerAttrs,\n        isPlayer: true,\n        inScene: true,\n        weight: config.playerWeight,\n      });\n    }\n\n    // NPC\n    if (npcResult) {\n      const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n      npcParsed.forEach(npc => {\n        if (!npc.name) return;\n        const inSceneVal = String(npc.inScene || '').toLowerCase();\n        const isInScene = inSceneVal === 'true' || inSceneVal === '';\n        const npcAttrs = getFullAttributesForCharacter(npc.name);\n        candidates.push({\n          name: npc.name,\n          attrs: npcAttrs,\n          isPlayer: false,\n          inScene: isInScene,\n          weight: isInScene ? config.inSceneNpcWeight : config.offSceneNpcWeight,\n        });\n      });\n    }\n\n    if (candidates.length === 0) return null;\n    return weightedRandomSelect(candidates);\n  };\n\n  // \n  const selectCrazyAttribute = participant => {\n    if (!participant) return { name: '', value: 50 };\n\n    // 1. \n    if (participant.attrs && participant.attrs.length > 0) {\n      const randomAttr = participant.attrs[Math.floor(Math.random() * participant.attrs.length)];\n      return { name: randomAttr.name, value: randomAttr.value };\n    }\n\n    // 2. \n    const activePreset = AttributePresetManager.getActivePreset();\n    if (activePreset) {\n      const allPresetAttrs = [...(activePreset.baseAttributes || []), ...(activePreset.specialAttributes || [])];\n      if (allPresetAttrs.length > 0) {\n        const randomPresetAttr = allPresetAttrs[Math.floor(Math.random() * allPresetAttrs.length)];\n        //  range  50% \n        const range = randomPresetAttr.range || [0, 100];\n        const defaultValue = Math.floor((range[0] + range[1]) / 2);\n        return { name: randomPresetAttr.name, value: defaultValue };\n      }\n    }\n\n    // 3. \n    const skillPool = getRandomSkillPool();\n    if (skillPool && skillPool.length > 0) {\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      return { name: randomSkill, value: 50 };\n    }\n\n    return { name: '', value: 50 };\n  };\n\n  //  d100\n  const crazyRollD100 = () => Math.floor(Math.random() * 100) + 1;\n\n  // \n  const judgeCrazyRollResult = (roll, target) => {\n    if (roll <= 5) return '';\n    if (roll >= 96) return '';\n    if (roll <= target) return '';\n    return '';\n  };\n\n  // \n  const generateCrazyRoll = () => {\n    const config = getCrazyModeConfig();\n    const rollType = selectCrazyRollType(config.crazyLevel);\n\n    if (rollType === 'normal') {\n      // \n      const participant = selectCrazyParticipant();\n      if (!participant) return null;\n\n      const attr = selectCrazyAttribute(participant);\n      const roll = crazyRollD100();\n      const result = judgeCrazyRollResult(roll, attr.value);\n\n      // XXYY\n      return `${participant.name}${attr.name}${roll}${attr.value}${result}`;\n    } else {\n      // \n      const participant1 = selectCrazyParticipant();\n      if (!participant1) return null;\n\n      // \n      let participant2 = null;\n      for (let i = 0; i < 5; i++) {\n        const candidate = selectCrazyParticipant();\n        if (candidate && candidate.name !== participant1.name) {\n          participant2 = candidate;\n          break;\n        }\n      }\n\n      // \n      if (!participant2) {\n        const attr = selectCrazyAttribute(participant1);\n        const roll = crazyRollD100();\n        const result = judgeCrazyRollResult(roll, attr.value);\n        return `${participant1.name}${attr.name}${roll}${attr.value}${result}`;\n      }\n\n      const attr1 = selectCrazyAttribute(participant1);\n      const attr2 = selectCrazyAttribute(participant2);\n      const roll1 = crazyRollD100();\n      const roll2 = crazyRollD100();\n\n      // \n      const result1 = judgeCrazyRollResult(roll1, attr1.value);\n      const result2 = judgeCrazyRollResult(roll2, attr2.value);\n      const margin1 = attr1.value - roll1;\n      const margin2 = attr2.value - roll2;\n\n      let winner;\n      if (margin1 > margin2) {\n        winner = `${participant1.name}`;\n      } else if (margin2 > margin1) {\n        winner = `${participant2.name}`;\n      } else {\n        winner = '';\n      }\n\n      // \n      return (\n        `${participant1.name} ${attr1.name} vs ${participant2.name} ${attr2.name}` +\n        `${participant1.name} ${attr1.name} (${attr1.value})  ${roll1}${result1}` +\n        `${participant2.name} ${attr2.name} (${attr2.value})  ${roll2}${result2}` +\n        `${winner}`\n      );\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  /**\n   * \n   * : 3d6, 4d6kh3, 4d6dl1, 4d6dh1\n   * @returns  NaN\n   */\n  const rollDiceExpression = expr => {\n    const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n\n    const match = expr.match(/^(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?$/i);\n    if (!match) return NaN;\n\n    const [, countStr, sidesStr, keepDrop] = match;\n    const count = parseInt(countStr, 10);\n    const sides = parseInt(sidesStr, 10);\n\n    let rolls = Array.from({ length: count }, () => rollDice(sides));\n\n    //  keep/drop\n    if (keepDrop) {\n      const kd = keepDrop.toLowerCase();\n      const n = parseInt(kd.slice(2), 10);\n      rolls.sort((a, b) => b - a); // \n\n      if (kd.startsWith('kh'))\n        rolls = rolls.slice(0, n); // n\n      else if (kd.startsWith('kl'))\n        rolls = rolls.slice(-n); // n\n      else if (kd.startsWith('dh'))\n        rolls = rolls.slice(n); // n\n      else if (kd.startsWith('dl')) rolls = rolls.slice(0, -n); // n\n    }\n\n    return rolls.reduce((a, b) => a + b, 0);\n  };\n\n  /**\n   * \n   * @param formula  \"/2+1d10\"  \"3d6*5\"\n   * @param context  { : 50, : 40 }\n   * @returns \n   */\n  const evaluateFormula = (formula, context = {}) => {\n    if (!formula) return 0;\n\n    let expr = String(formula).trim();\n\n    // 1. \n    const varNames = Object.keys(context).sort((a, b) => b.length - a.length);\n    for (const name of varNames) {\n      const value = context[name];\n      if (typeof value === 'number' && !isNaN(value)) {\n        // \n        expr = expr.split(name).join(`(${value})`);\n      }\n    }\n\n    // 2. \n    expr = expr.replace(/\\d+d\\d+(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi, match => {\n      const result = rollDiceExpression(match);\n      return isNaN(result) ? '0' : String(result);\n    });\n\n    // 3. \n    if (!/^[\\d\\s+\\-*/().]+$/.test(expr)) {\n      console.warn('[DICE]evaluateFormula :', formula, '', expr);\n      return 0;\n    }\n\n    // 4. \n    try {\n      // eslint-disable-next-line no-new-func\n      const result = new Function(`return (${expr})`)();\n      return Math.round(result); // \n    } catch (e) {\n      console.error('[DICE]evaluateFormula :', formula, '', expr, e);\n      return 0;\n    }\n  };\n\n  /**\n   * \n   * @param formula \n   * @param range  [min, max]\n   * @param context \n   * @returns \n   */\n  const generateAttributeValue = (formula, range, context) => {\n    let value = evaluateFormula(formula, context);\n\n    if (range && Array.isArray(range) && range.length === 2) {\n      value = Math.max(range[0], Math.min(range[1], value));\n    }\n\n    return value;\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const DASHBOARD_TABLE_CONFIG = {\n    global: {\n      tableKeywords: ['', '', ''],\n      columns: {\n        detailLocation: { keywords: ['', '', '', ''], fallbackIndex: null },\n        currentLocation: { keywords: ['', '', '', ''], fallbackIndex: 2 },\n      },\n    },\n    player: {\n      // : user, <user>\n      tableKeywords: ['', '', '', '', 'player', '', 'user', '<user>'],\n      columns: {\n        name: { keywords: ['', '', '', 'name'], fallbackIndex: 1 },\n        status: { keywords: ['', '', '', ''], fallbackIndex: null },\n        position: { keywords: ['', '', ''], fallbackIndex: null },\n        attrs: { keywords: ['', ''], fallbackIndex: null, isMultiple: true },\n        // : , , , \n        money: {\n          keywords: ['', '', '', '', '', '', '', '', ''],\n          fallbackIndex: null,\n        },\n        resources: { keywords: ['', '', 'resources'], fallbackIndex: null },\n      },\n    },\n    location: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: {\n          keywords: ['', '', '', '', '', '', '', ''],\n          fallbackIndex: 1,\n        },\n        description: { keywords: ['', '', '', '', ''], fallbackIndex: null },\n      },\n    },\n    npc: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        'NPC',\n        '',\n        '',\n        '',\n        '',\n        'character',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', ''], fallbackIndex: 1 },\n        status: { keywords: ['', ''], fallbackIndex: null },\n        position: { keywords: ['', '', '', ''], fallbackIndex: null },\n        inScene: { keywords: ['', '', '', ''], fallbackIndex: null },\n      },\n    },\n    quest: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        progress: { keywords: ['', '', '/'], fallbackIndex: 5 },\n        status: { keywords: [''], fallbackIndex: 6 },\n      },\n      filters: {\n        active: { column: 'status', includes: ['', '', ''], excludeColumn: 'type', excludes: [''] },\n      },\n    },\n    bag: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        count: { keywords: ['', '', ''], fallbackIndex: 3 },\n      },\n    },\n    skill: {\n      // : , , , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        level: { keywords: ['', '', '', 'lv'], fallbackIndex: 3 },\n      },\n    },\n    equip: {\n      // : , , , , , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        part: { keywords: ['', '', ''], fallbackIndex: 3 },\n        isEquipped: { keywords: ['', '', '', ''], fallbackIndex: 4 },\n      },\n      filters: {\n        equipped: { column: 'isEquipped', includes: ['', '', 'true', '', 'yes', 'equipped'] },\n      },\n    },\n  };\n\n  // \n  const DashboardDataParser = {\n    // \n    findTable(allTables, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return null;\n      }\n\n      for (const keyword of config.tableKeywords) {\n        for (const tableName in allTables) {\n          if (tableName.includes(keyword)) {\n            console.info(`[DICE]: \"${moduleKey}\"\"${tableName}\" (: \"${keyword}\")`);\n            return {\n              data: allTables[tableName],\n              name: tableName,\n              key: allTables[tableName].key,\n              config: config,\n            };\n          }\n        }\n      }\n      console.info(\n        `[DICE]: \"${moduleKey}\" (: ${config.tableKeywords.join(', ')})`,\n      );\n      return null;\n    },\n\n    // \n    findColumnIndex(headers, columnKey, moduleConfig) {\n      const colConfig = moduleConfig.columns[columnKey];\n      if (!colConfig) return -1;\n\n      // \n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (colConfig.keywords.some(kw => h.includes(kw.toLowerCase()))) {\n          return i;\n        }\n      }\n\n      // \n      return colConfig.fallbackIndex ?? -1;\n    },\n\n    // \n    getValue(row, headers, columnKey, moduleConfig) {\n      const idx = this.findColumnIndex(headers, columnKey, moduleConfig);\n      if (idx < 0 || idx >= row.length) return null;\n      return row[idx];\n    },\n\n    // \n    getColumnMap(headers, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) return {};\n\n      const map = {};\n      for (const colKey in config.columns) {\n        map[colKey] = this.findColumnIndex(headers, colKey, config);\n      }\n      return map;\n    },\n\n    // \n    parseRows(tableResult, moduleKey) {\n      if (!tableResult || !tableResult.data) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return [];\n      }\n\n      const { data, config } = tableResult;\n      const headers = data.headers || [];\n      const rows = data.rows || [];\n      const colMap = this.getColumnMap(headers, moduleKey);\n\n      const parsed = rows.map((row, idx) => {\n        const obj = { _rowIndex: idx, _raw: row };\n        for (const colKey in colMap) {\n          const colIdx = colMap[colKey];\n          obj[colKey] = colIdx >= 0 && colIdx < row.length ? row[colIdx] : null;\n        }\n        return obj;\n      });\n\n      console.info(`[DICE]: \"${moduleKey}\"${parsed.length}`);\n      return parsed;\n    },\n\n    // \n    applyFilter(parsedRows, filterKey, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config || !config.filters || !config.filters[filterKey]) return parsedRows;\n\n      const filter = config.filters[filterKey];\n\n      // parsedRows\n      const hasFilterColumn = parsedRows.some(row => row[filter.column] !== null && row[filter.column] !== undefined);\n      if (!hasFilterColumn) {\n        // \n        return parsedRows;\n      }\n\n      return parsedRows.filter(row => {\n        const value = String(row[filter.column] || '').toLowerCase();\n        const matchInclude = filter.includes.some(inc => value.includes(inc.toLowerCase()));\n\n        if (filter.excludeColumn && filter.excludes) {\n          const excludeValue = String(row[filter.excludeColumn] || '').toLowerCase();\n          const matchExclude = filter.excludes.some(exc => excludeValue.includes(exc.toLowerCase()));\n          return matchInclude && !matchExclude;\n        }\n\n        return matchInclude;\n      });\n    },\n  };\n\n  const DEFAULT_GM_CONFIG = {\n    enabled: true,\n    diceSystem: '1d100',\n    showDiceIcon: true,\n    autoSendPrompt: true,\n    action_groups: [\n      {\n        table_keywords: ['', '', 'Location', 'Map', '', ''],\n        actions: [\n          { label: '', icon: 'fa-walking', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-search', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-clock', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', 'NPC', '', '', ''],\n        actions: [\n          { label: '', icon: 'fa-comments', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-hand-fist', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          { label: '', icon: 'fa-hand-pointer', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-trash', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-shield-halved',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-coins', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-wand-magic-sparkles',\n            type: 'skill_check',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-dumbbell', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-crosshairs',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          {\n            label: '',\n            icon: 'fa-list-check',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-ear-listen',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-user-plus', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          {\n            label: '',\n            icon: 'fa-handshake',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n        ],\n      },\n    ],\n  };\n  // [] \n  const THEME_COLORS = {\n    retro: {\n      bgPanel: '#e6e2d3',\n      border: '#dcd0c0',\n      textMain: '#5e4b35',\n      textSub: '#8a7a6a',\n      btnBg: '#dcd0c0',\n      btnHover: '#cbbba8',\n      accent: '#7a695f',\n      tableHead: '#efebe4',\n      successText: '#27ae60',\n      successBg: 'rgba(39, 174, 96, 0.15)',\n      inputBg: '#f5f2eb',\n      inputText: '#5e4b35',\n      placeholderText: '#a09080',\n      btnActiveBg: '#8d7b6f',\n      btnActiveText: '#fdfaf5',\n      // \n      failureText: '#e74c3c',\n      failureBg: 'rgba(231, 76, 60, 0.15)',\n      warningText: '#f39c12',\n      warningBg: 'rgba(243, 156, 18, 0.15)',\n      critSuccessText: '#9b59b6',\n      critSuccessBg: 'rgba(155, 89, 182, 0.15)',\n      critFailureText: '#c0392b',\n      critFailureBg: 'rgba(192, 57, 43, 0.15)',\n      extremeSuccessText: '#2980b9',\n      extremeSuccessBg: 'rgba(41, 128, 185, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#e74c3c',\n      errorBg: 'rgba(231, 76, 60, 0.15)',\n      errorBorder: 'rgba(231, 76, 60, 0.5)',\n      warningIcon: '#e67e22',\n      buttonTextOnAccent: '#fff',\n    },\n    dark: {\n      bgPanel: 'rgba(30, 30, 30, 0.98)',\n      border: '#444',\n      textMain: '#eee',\n      textSub: '#999',\n      btnBg: 'rgba(60, 60, 60, 0.9)',\n      btnHover: '#505050',\n      accent: '#9b8cd9',\n      tableHead: 'rgba(45, 45, 45, 0.95)',\n      successText: '#4cd964',\n      successBg: 'rgba(76, 217, 100, 0.2)',\n      inputBg: 'rgba(50, 50, 50, 0.95)',\n      inputText: '#eee',\n      placeholderText: '#777',\n      btnActiveBg: '#6a5acd',\n      btnActiveText: '#fff',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#ba68c8',\n      critSuccessBg: 'rgba(186, 104, 200, 0.2)',\n      critFailureText: '#d32f2f',\n      critFailureBg: 'rgba(211, 47, 47, 0.2)',\n      extremeSuccessText: '#42a5f5',\n      extremeSuccessBg: 'rgba(66, 165, 245, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.75)',\n      overlayBgLight: 'rgba(0,0,0,0.65)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255,255,255,0.05)',\n      veryLightBg: 'rgba(255,255,255,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(255,255,255,0.1)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#fff',\n    },\n    modern: {\n      bgPanel: '#f8f9fa',\n      border: '#e0e0e0',\n      textMain: '#333',\n      textSub: '#666',\n      btnBg: '#e9ecef',\n      btnHover: '#dee2e6',\n      accent: '#007bff',\n      tableHead: '#f1f3f5',\n      successText: '#28a745',\n      successBg: 'rgba(40, 167, 69, 0.15)',\n      inputBg: '#fff',\n      inputText: '#333',\n      placeholderText: '#999',\n      btnActiveBg: '#007bff',\n      btnActiveText: '#fff',\n      // \n      failureText: '#dc3545',\n      failureBg: 'rgba(220, 53, 69, 0.15)',\n      warningText: '#ffc107',\n      warningBg: 'rgba(255, 193, 7, 0.15)',\n      critSuccessText: '#6f42c1',\n      critSuccessBg: 'rgba(111, 66, 193, 0.15)',\n      critFailureText: '#c82333',\n      critFailureBg: 'rgba(200, 35, 51, 0.15)',\n      extremeSuccessText: '#17a2b8',\n      extremeSuccessBg: 'rgba(23, 162, 184, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#dc3545',\n      errorBg: 'rgba(220, 53, 69, 0.15)',\n      errorBorder: 'rgba(220, 53, 69, 0.5)',\n      warningIcon: '#fd7e14',\n      buttonTextOnAccent: '#fff',\n    },\n    forest: {\n      bgPanel: '#e8f5e9',\n      border: '#a5d6a7',\n      textMain: '#2e7d32',\n      textSub: '#66bb6a',\n      btnBg: '#c8e6c9',\n      btnHover: '#a5d6a7',\n      accent: '#43a047',\n      tableHead: '#dcedc8',\n      successText: '#2e7d32',\n      successBg: 'rgba(46, 125, 50, 0.2)',\n      inputBg: '#f1f8e9',\n      inputText: '#2e7d32',\n      placeholderText: '#81c784',\n      btnActiveBg: '#43a047',\n      btnActiveText: '#fff',\n      // \n      failureText: '#c62828',\n      failureBg: 'rgba(198, 40, 40, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#0277bd',\n      extremeSuccessBg: 'rgba(2, 119, 189, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#c62828',\n      errorBg: 'rgba(198, 40, 40, 0.15)',\n      errorBorder: 'rgba(198, 40, 40, 0.5)',\n      warningIcon: '#e67e22',\n      buttonTextOnAccent: '#fff',\n    },\n    ocean: {\n      bgPanel: '#e3f2fd',\n      border: '#90caf9',\n      textMain: '#1565c0',\n      textSub: '#42a5f5',\n      btnBg: '#bbdefb',\n      btnHover: '#90caf9',\n      accent: '#1976d2',\n      tableHead: '#bbdefb',\n      successText: '#0288d1',\n      successBg: 'rgba(2, 136, 209, 0.15)',\n      inputBg: '#e1f5fe',\n      inputText: '#1565c0',\n      placeholderText: '#64b5f6',\n      btnActiveBg: '#1976d2',\n      btnActiveText: '#fff',\n      // \n      failureText: '#d32f2f',\n      failureBg: 'rgba(211, 47, 47, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#0277bd',\n      extremeSuccessBg: 'rgba(2, 119, 189, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#d32f2f',\n      errorBg: 'rgba(211, 47, 47, 0.15)',\n      errorBorder: 'rgba(211, 47, 47, 0.5)',\n      warningIcon: '#f57c00',\n      buttonTextOnAccent: '#fff',\n    },\n    cyber: {\n      bgPanel: '#0a0a0a',\n      border: '#00ffcc33',\n      textMain: '#00ffcc',\n      textSub: '#00cc99',\n      btnBg: 'rgba(0, 255, 204, 0.1)',\n      btnHover: 'rgba(0, 255, 204, 0.2)',\n      accent: '#00ffcc',\n      tableHead: 'rgba(0, 255, 204, 0.05)',\n      successText: '#0f0',\n      successBg: 'rgba(0, 255, 0, 0.15)',\n      inputBg: 'rgba(0, 0, 0, 0.6)',\n      inputText: '#00ffcc',\n      placeholderText: '#006655',\n      btnActiveBg: '#ff00ff',\n      btnActiveText: '#fff',\n      // \n      failureText: '#ff0066',\n      failureBg: 'rgba(255, 0, 102, 0.2)',\n      warningText: '#ffaa00',\n      warningBg: 'rgba(255, 170, 0, 0.2)',\n      critSuccessText: '#ff00ff',\n      critSuccessBg: 'rgba(255, 0, 255, 0.2)',\n      critFailureText: '#ff0000',\n      critFailureBg: 'rgba(255, 0, 0, 0.2)',\n      extremeSuccessText: '#00ffff',\n      extremeSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,255,204,0.3)',\n      lightBg: 'rgba(0,255,204,0.05)',\n      veryLightBg: 'rgba(0,255,204,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(0,255,204,0.1)',\n      // \n      buttonBg: 'rgba(0, 200, 150, 0.6)',\n      buttonBgActive: 'rgba(0, 180, 130, 0.7)',\n      presetButtonBg: 'rgba(0, 200, 150, 0.3)',\n      presetButtonBgActive: 'rgba(0, 200, 150, 0.6)',\n      // /\n      errorText: '#ff0066',\n      errorBg: 'rgba(255, 0, 102, 0.2)',\n      errorBorder: 'rgba(255, 0, 102, 0.5)',\n      warningIcon: '#ffaa00',\n      buttonTextOnAccent: '#000',\n    },\n    nightowl: {\n      bgPanel: '#011627',\n      border: '#132e45',\n      textMain: '#e0e6f2',\n      textSub: '#a6b8cc',\n      btnBg: '#1f3a52',\n      btnHover: '#2a4a68',\n      accent: '#7fdbca',\n      tableHead: '#0a2133',\n      successText: '#addb67',\n      successBg: 'rgba(173, 219, 103, 0.15)',\n      inputBg: '#00101c',\n      inputText: '#e0e6f2',\n      placeholderText: '#6a8090',\n      btnActiveBg: '#7fdbca',\n      btnActiveText: '#011627',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#c792ea',\n      critSuccessBg: 'rgba(199, 146, 234, 0.2)',\n      critFailureText: '#ef5350',\n      critFailureBg: 'rgba(239, 83, 80, 0.2)',\n      extremeSuccessText: '#82aaff',\n      extremeSuccessBg: 'rgba(130, 170, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.75)',\n      overlayBgLight: 'rgba(0,0,0,0.65)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255,255,255,0.05)',\n      veryLightBg: 'rgba(255,255,255,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(255,255,255,0.1)',\n      // \n      buttonBg: 'rgba(127, 219, 202, 0.4)',\n      buttonBgActive: 'rgba(127, 219, 202, 0.5)',\n      presetButtonBg: 'rgba(127, 219, 202, 0.2)',\n      presetButtonBgActive: 'rgba(127, 219, 202, 0.4)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#000',\n    },\n    sakura: {\n      bgPanel: '#F9F0EF',\n      border: '#EBDCD9',\n      textMain: '#6B5552',\n      textSub: '#C08D8D',\n      btnBg: '#EBDCD9',\n      btnHover: '#D8C7C4',\n      accent: '#C08D8D',\n      tableHead: '#F9F0EF',\n      successText: '#6B5552',\n      successBg: 'rgba(192, 141, 141, 0.12)',\n      inputBg: '#F9F0EF',\n      inputText: '#6B5552',\n      placeholderText: '#C08D8D',\n      btnActiveBg: '#C08D8D',\n      btnActiveText: '#F9F0EF',\n      // \n      failureText: '#9B7A7A',\n      failureBg: 'rgba(155, 122, 122, 0.12)',\n      warningText: '#A68A7A',\n      warningBg: 'rgba(166, 138, 122, 0.12)',\n      critSuccessText: '#8B7A7A',\n      critSuccessBg: 'rgba(139, 122, 122, 0.12)',\n      critFailureText: '#8B6F6F',\n      critFailureBg: 'rgba(139, 111, 111, 0.12)',\n      extremeSuccessText: '#9B8A8A',\n      extremeSuccessBg: 'rgba(155, 138, 138, 0.12)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(107, 85, 82, 0.3)',\n      lightBg: 'rgba(192, 141, 141, 0.08)',\n      veryLightBg: 'rgba(192, 141, 141, 0.02)',\n      buttonText: '#F9F0EF',\n      grayBg: 'rgba(192, 141, 141, 0.08)',\n      // \n      buttonBg: 'rgba(192, 141, 141, 0.4)',\n      buttonBgActive: 'rgba(192, 141, 141, 0.5)',\n      presetButtonBg: 'rgba(192, 141, 141, 0.2)',\n      presetButtonBgActive: 'rgba(192, 141, 141, 0.4)',\n      // /\n      errorText: '#9B7A7A',\n      errorBg: 'rgba(155, 122, 122, 0.12)',\n      errorBorder: 'rgba(155, 122, 122, 0.4)',\n      warningIcon: '#A68A7A',\n      buttonTextOnAccent: '#fff',\n    },\n    minepink: {\n      bgPanel: '#1a1a1a',\n      border: '#333333',\n      textMain: '#ffb3d9',\n      textSub: '#ff80c1',\n      btnBg: '#2a2a2a',\n      btnHover: '#3a3a3a',\n      accent: '#ff80c1',\n      tableHead: '#252525',\n      successText: '#ff80c1',\n      successBg: 'rgba(255, 128, 193, 0.2)',\n      inputBg: '#222222',\n      inputText: '#ffb3d9',\n      placeholderText: '#666666',\n      btnActiveBg: '#ff80c1',\n      btnActiveText: '#1a1a1a',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#ff80c1',\n      critSuccessBg: 'rgba(255, 128, 193, 0.2)',\n      critFailureText: '#ff4444',\n      critFailureBg: 'rgba(255, 68, 68, 0.2)',\n      extremeSuccessText: '#ffb3d9',\n      extremeSuccessBg: 'rgba(255, 179, 217, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255, 128, 193, 0.1)',\n      veryLightBg: 'rgba(255, 128, 193, 0.02)',\n      buttonText: '#1a1a1a',\n      grayBg: 'rgba(255, 128, 193, 0.1)',\n      // \n      buttonBg: 'rgba(255, 128, 193, 0.7)',\n      buttonBgActive: 'rgba(255, 128, 193, 0.8)',\n      presetButtonBg: 'rgba(255, 128, 193, 0.2)',\n      presetButtonBgActive: 'rgba(255, 128, 193, 0.4)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#000',\n    },\n    purple: {\n      bgPanel: '#f3e5f5',\n      border: '#ce93d8',\n      textMain: '#6a1b9a',\n      textSub: '#9c27b0',\n      btnBg: '#e1bee7',\n      btnHover: '#ce93d8',\n      accent: '#9c27b0',\n      tableHead: '#f8e1f5',\n      successText: '#6a1b9a',\n      successBg: 'rgba(106, 27, 154, 0.15)',\n      inputBg: '#fce4ec',\n      inputText: '#6a1b9a',\n      placeholderText: '#ba68c8',\n      btnActiveBg: '#9c27b0',\n      btnActiveText: '#fff',\n      // \n      failureText: '#d32f2f',\n      failureBg: 'rgba(211, 47, 47, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#6a1b9a',\n      extremeSuccessBg: 'rgba(106, 27, 154, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(156, 39, 176, 0.1)',\n      veryLightBg: 'rgba(156, 39, 176, 0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(156, 39, 176, 0.1)',\n      // \n      buttonBg: 'rgba(156, 39, 176, 0.6)',\n      buttonBgActive: 'rgba(156, 39, 176, 0.7)',\n      presetButtonBg: 'rgba(156, 39, 176, 0.3)',\n      presetButtonBgActive: 'rgba(156, 39, 176, 0.6)',\n      // /\n      errorText: '#d32f2f',\n      errorBg: 'rgba(211, 47, 47, 0.15)',\n      errorBorder: 'rgba(211, 47, 47, 0.5)',\n      warningIcon: '#f57c00',\n      buttonTextOnAccent: '#fff',\n    },\n    wechat: {\n      bgPanel: '#F7F7F7',\n      border: '#E5E5E5',\n      textMain: '#333333',\n      textSub: '#666666',\n      btnBg: '#E5E5E5',\n      btnHover: '#D5D5D5',\n      accent: '#09B83E',\n      tableHead: '#F0F0F0',\n      successText: '#09B83E',\n      successBg: 'rgba(9, 184, 62, 0.12)',\n      inputBg: '#FFFFFF',\n      inputText: '#333333',\n      placeholderText: '#999999',\n      btnActiveBg: '#09B83E',\n      btnActiveText: '#FFFFFF',\n      // \n      failureText: '#E53E3E',\n      failureBg: 'rgba(229, 62, 62, 0.12)',\n      warningText: '#FF9500',\n      warningBg: 'rgba(255, 149, 0, 0.12)',\n      critSuccessText: '#07A832',\n      critSuccessBg: 'rgba(7, 168, 50, 0.15)',\n      critFailureText: '#C53030',\n      critFailureBg: 'rgba(197, 48, 48, 0.15)',\n      extremeSuccessText: '#09B83E',\n      extremeSuccessBg: 'rgba(9, 184, 62, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.2)',\n      lightBg: 'rgba(9, 184, 62, 0.08)',\n      veryLightBg: 'rgba(9, 184, 62, 0.02)',\n      buttonText: '#FFFFFF',\n      grayBg: 'rgba(9, 184, 62, 0.08)',\n      // \n      buttonBg: 'rgba(9, 184, 62, 0.7)',\n      buttonBgActive: 'rgba(9, 184, 62, 0.85)',\n      presetButtonBg: 'rgba(9, 184, 62, 0.3)',\n      presetButtonBgActive: 'rgba(9, 184, 62, 0.6)',\n      // /\n      errorText: '#E53E3E',\n      errorBg: 'rgba(229, 62, 62, 0.12)',\n      errorBorder: 'rgba(229, 62, 62, 0.5)',\n      warningIcon: '#FF9500',\n      buttonTextOnAccent: '#fff',\n    },\n    educational: {\n      bgPanel: '#000000',\n      border: '#1B1B1B',\n      textMain: '#FFFFFF',\n      textSub: '#CCCCCC',\n      btnBg: '#1B1B1B',\n      btnHover: '#2B2B2B',\n      accent: '#FF9900',\n      tableHead: '#1B1B1B',\n      successText: '#FF9900',\n      successBg: 'rgba(255, 153, 0, 0.15)',\n      inputBg: '#1B1B1B',\n      inputText: '#FFFFFF',\n      placeholderText: '#666666',\n      btnActiveBg: '#FF9900',\n      btnActiveText: '#000000',\n      // \n      failureText: '#FF6B6B',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#FFAA00',\n      warningBg: 'rgba(255, 170, 0, 0.2)',\n      critSuccessText: '#FF9900',\n      critSuccessBg: 'rgba(255, 153, 0, 0.2)',\n      critFailureText: '#FF4444',\n      critFailureBg: 'rgba(255, 68, 68, 0.2)',\n      extremeSuccessText: '#FFB84D',\n      extremeSuccessBg: 'rgba(255, 184, 77, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255, 153, 0, 0.1)',\n      veryLightBg: 'rgba(255, 153, 0, 0.02)',\n      buttonText: '#FFFFFF',\n      grayBg: 'rgba(255, 255, 255, 0.1)',\n      // \n      buttonBg: 'rgba(255, 153, 0, 0.7)',\n      buttonBgActive: 'rgba(255, 153, 0, 0.85)',\n      presetButtonBg: 'rgba(255, 153, 0, 0.3)',\n      presetButtonBgActive: 'rgba(255, 153, 0, 0.6)',\n      // /\n      errorText: '#FF6B6B',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#FFAA00',\n      buttonTextOnAccent: '#000000',\n    },\n    galgame: {\n      bgPanel: '#FFF0F5',\n      border: '#F0D4E4',\n      textMain: '#6B4A5A',\n      textSub: '#B08A9A',\n      btnBg: '#FFE4E9',\n      btnHover: '#FFD4E4',\n      accent: '#E8B4D9',\n      tableHead: '#FFF5F9',\n      successText: '#D4A5C8',\n      successBg: 'rgba(212, 165, 200, 0.15)',\n      inputBg: '#FFF8FA',\n      inputText: '#6B4A5A',\n      placeholderText: '#C8A5B0',\n      btnActiveBg: '#E8B4D9',\n      btnActiveText: '#6B4A5A',\n      // \n      failureText: '#C88A9A',\n      failureBg: 'rgba(200, 138, 154, 0.15)',\n      warningText: '#D4A5A5',\n      warningBg: 'rgba(212, 165, 165, 0.15)',\n      critSuccessText: '#E8B4D9',\n      critSuccessBg: 'rgba(232, 180, 217, 0.2)',\n      critFailureText: '#C88A9A',\n      critFailureBg: 'rgba(200, 138, 154, 0.2)',\n      extremeSuccessText: '#D4A5C8',\n      extremeSuccessBg: 'rgba(212, 165, 200, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(232, 180, 217, 0.25)',\n      lightBg: 'rgba(232, 180, 217, 0.08)',\n      veryLightBg: 'rgba(232, 180, 217, 0.02)',\n      buttonText: '#6B4A5A',\n      grayBg: 'rgba(232, 180, 217, 0.1)',\n      // \n      buttonBg: 'rgba(232, 180, 217, 0.6)',\n      buttonBgActive: 'rgba(232, 180, 217, 0.75)',\n      presetButtonBg: 'rgba(232, 180, 217, 0.3)',\n      presetButtonBgActive: 'rgba(232, 180, 217, 0.6)',\n      // /\n      errorText: '#C88A9A',\n      errorBg: 'rgba(200, 138, 154, 0.15)',\n      errorBorder: 'rgba(200, 138, 154, 0.4)',\n      warningIcon: '#D4A5A5',\n      buttonTextOnAccent: '#6B4A5A',\n    },\n    vaporwave: {\n      bgPanel: '#191970',\n      border: 'rgba(0, 255, 255, 0.3)',\n      textMain: '#00FFFF',\n      textSub: '#FF00FF',\n      btnBg: 'rgba(25, 25, 112, 0.8)',\n      btnHover: 'rgba(0, 255, 255, 0.2)',\n      accent: '#00FFFF',\n      tableHead: 'rgba(25, 25, 112, 0.9)',\n      successText: '#00FFFF',\n      successBg: 'rgba(0, 255, 255, 0.15)',\n      inputBg: 'rgba(25, 25, 112, 0.6)',\n      inputText: '#00FFFF',\n      placeholderText: '#FF00FF',\n      btnActiveBg: '#FF00FF',\n      btnActiveText: '#F0F8FF',\n      // \n      failureText: '#FF00FF',\n      failureBg: 'rgba(255, 0, 255, 0.2)',\n      warningText: '#FF00FF',\n      warningBg: 'rgba(255, 0, 255, 0.15)',\n      critSuccessText: '#00FFFF',\n      critSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      critFailureText: '#FF00FF',\n      critFailureBg: 'rgba(255, 0, 255, 0.25)',\n      extremeSuccessText: '#00FFFF',\n      extremeSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(25, 25, 112, 0.85)',\n      overlayBgLight: 'rgba(25, 25, 112, 0.75)',\n      shadowBg: 'rgba(0, 255, 255, 0.3)',\n      lightBg: 'rgba(0, 255, 255, 0.05)',\n      veryLightBg: 'rgba(0, 255, 255, 0.02)',\n      buttonText: '#F0F8FF',\n      grayBg: 'rgba(0, 255, 255, 0.1)',\n      // \n      buttonBg: 'rgba(0, 255, 255, 0.6)',\n      buttonBgActive: 'rgba(255, 0, 255, 0.7)',\n      presetButtonBg: 'rgba(0, 255, 255, 0.3)',\n      presetButtonBgActive: 'rgba(0, 255, 255, 0.6)',\n      // /\n      errorText: '#FF00FF',\n      errorBg: 'rgba(255, 0, 255, 0.2)',\n      errorBorder: 'rgba(255, 0, 255, 0.5)',\n      warningIcon: '#FF00FF',\n      buttonTextOnAccent: '#191970',\n    },\n    classicpackaging: {\n      bgPanel: '#000000',\n      border: '#FFFF00',\n      textMain: '#FFFF00',\n      textSub: '#CCCC00',\n      btnBg: '#FF0000',\n      btnHover: '#CC0000',\n      accent: '#FF0000',\n      tableHead: '#1a1a1a',\n      successText: '#0000FF',\n      successBg: 'rgba(0, 0, 255, 0.2)',\n      inputBg: '#1a1a1a',\n      inputText: '#FFFF00',\n      placeholderText: '#666600',\n      btnActiveBg: '#0000FF',\n      btnActiveText: '#FFFF00',\n      // \n      failureText: '#FF0000',\n      failureBg: 'rgba(255, 0, 0, 0.2)',\n      warningText: '#FF0000',\n      warningBg: 'rgba(255, 0, 0, 0.15)',\n      critSuccessText: '#0000FF',\n      critSuccessBg: 'rgba(0, 0, 255, 0.2)',\n      critFailureText: '#FF0000',\n      critFailureBg: 'rgba(255, 0, 0, 0.25)',\n      extremeSuccessText: '#0000FF',\n      extremeSuccessBg: 'rgba(0, 0, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0, 0, 0, 0.9)',\n      overlayBgLight: 'rgba(0, 0, 0, 0.8)',\n      shadowBg: 'rgba(0, 0, 0, 0.6)',\n      lightBg: 'rgba(255, 255, 0, 0.1)',\n      veryLightBg: 'rgba(255, 255, 0, 0.02)',\n      buttonText: '#FFFF00',\n      grayBg: 'rgba(255, 255, 0, 0.1)',\n      // \n      buttonBg: '#FF0000',\n      buttonBgActive: '#CC0000',\n      presetButtonBg: 'rgba(255, 0, 0, 0.7)',\n      presetButtonBgActive: '#FF0000',\n      // /\n      errorText: '#FF0000',\n      errorBg: 'rgba(255, 0, 0, 0.2)',\n      errorBorder: 'rgba(255, 0, 0, 0.8)',\n      warningIcon: '#FF0000',\n      buttonTextOnAccent: '#FFFF00',\n    },\n    terminal: {\n      bgPanel: '#0c0c0c',\n      border: '#00ff00',\n      textMain: '#00ff00',\n      textSub: '#00cc00',\n      btnBg: '#1a1a1a',\n      btnHover: '#2a2a2a',\n      accent: '#00ff00',\n      tableHead: '#0a0a0a',\n      successText: '#00ff00',\n      successBg: 'rgba(0, 255, 0, 0.15)',\n      inputBg: '#0c0c0c',\n      inputText: '#00ff00',\n      placeholderText: '#008800',\n      btnActiveBg: '#00ff00',\n      btnActiveText: '#0c0c0c',\n      failureText: '#ff0000',\n      failureBg: 'rgba(255, 0, 0, 0.15)',\n      warningText: '#ffff00',\n      warningBg: 'rgba(255, 255, 0, 0.15)',\n      critSuccessText: '#00ffff',\n      critSuccessBg: 'rgba(0, 255, 255, 0.15)',\n      critFailureText: '#ff00ff',\n      critFailureBg: 'rgba(255, 0, 255, 0.15)',\n      extremeSuccessText: '#00ff00',\n      extremeSuccessBg: 'rgba(0, 255, 0, 0.2)',\n      overlayBg: 'rgba(0, 0, 0, 0.9)',\n      overlayBgLight: 'rgba(0, 0, 0, 0.8)',\n      shadowBg: 'rgba(0, 0, 0, 0.7)',\n      lightBg: 'rgba(0, 255, 0, 0.05)',\n      veryLightBg: 'rgba(0, 255, 0, 0.02)',\n      buttonText: '#0c0c0c',\n      grayBg: 'rgba(0, 255, 0, 0.05)',\n      errorText: '#ff0000',\n      errorBg: 'rgba(255, 0, 0, 0.15)',\n      errorBorder: 'rgba(255, 0, 0, 0.5)',\n      warningIcon: '#ffff00',\n      buttonTextOnAccent: '#0c0c0c',\n    },\n    dreamcore: {\n      // 90VHS\n      bgPanel: '#F4F1EA',\n      border: '#D6D2C4',\n      textMain: '#5C5869',\n      textSub: '#9490A0',\n      btnBg: '#E6E1D5',\n      btnHover: '#DBD8CC',\n      accent: '#8A9AC6',\n      tableHead: '#EBE7DE',\n      successText: '#4A7A68',\n      successBg: 'rgba(74, 122, 104, 0.18)',\n      inputBg: '#FFFFFF',\n      inputText: '#4A4652',\n      placeholderText: '#B0ACC0',\n      btnActiveBg: '#8A9AC6',\n      btnActiveText: '#FFFFFF',\n      // \n      failureText: '#8F5E5E',\n      failureBg: 'rgba(143, 94, 94, 0.18)',\n      warningText: '#8A7040',\n      warningBg: 'rgba(138, 112, 64, 0.18)',\n      critSuccessText: '#2D6E58',\n      critSuccessBg: 'rgba(45, 110, 88, 0.25)',\n      critFailureText: '#7A3E3E',\n      critFailureBg: 'rgba(122, 62, 62, 0.25)',\n      extremeSuccessText: '#5C5228',\n      extremeSuccessBg: 'rgba(92, 82, 40, 0.2)',\n      // UI\n      overlayBg: 'rgba(244, 241, 234, 0.85)',\n      overlayBgLight: 'rgba(255, 255, 255, 0.4)',\n      shadowBg: 'rgba(92, 88, 105, 0.15)',\n      lightBg: 'rgba(138, 154, 198, 0.08)',\n      veryLightBg: 'rgba(138, 154, 198, 0.03)',\n      buttonText: '#5C5869',\n      grayBg: 'rgba(92, 88, 105, 0.08)',\n      // \n      buttonBg: 'rgba(138, 154, 198, 0.4)',\n      buttonBgActive: 'rgba(138, 154, 198, 0.6)',\n      presetButtonBg: 'rgba(138, 154, 198, 0.2)',\n      presetButtonBgActive: 'rgba(138, 154, 198, 0.45)',\n      // /\n      errorText: '#B85C5C',\n      errorBg: 'rgba(184, 92, 92, 0.15)',\n      errorBorder: 'rgba(184, 92, 92, 0.4)',\n      warningIcon: '#E0C080',\n      buttonTextOnAccent: '#FFFFFF',\n    },\n    //  (Chouten) - \n    // VTuber +  + \n    chouten: {\n      bgPanel: '#1A0A2E', // \n      border: '#FF6B9D', // \n      textMain: '#FFE4F0', // \n      textSub: '#B388FF', // \n      btnBg: 'rgba(255, 107, 157, 0.25)', // \n      btnHover: 'rgba(255, 107, 157, 0.4)', // \n      accent: '#7FFFD4', // \n      tableHead: 'rgba(45, 27, 78, 0.95)', // \n      successText: '#7FFFD4', // \n      successBg: 'rgba(127, 255, 212, 0.2)',\n      inputBg: 'rgba(26, 10, 46, 0.9)', // \n      inputText: '#FFE4F0',\n      placeholderText: '#9370DB', // \n      btnActiveBg: '#FF6B9D', // \n      btnActiveText: '#1A0A2E', // \n      // \n      failureText: '#FF6B6B', // \n      failureBg: 'rgba(255, 107, 107, 0.25)',\n      warningText: '#FFD93D', // \n      warningBg: 'rgba(255, 217, 61, 0.2)',\n      critSuccessText: '#00FFAB', // \n      critSuccessBg: 'rgba(0, 255, 171, 0.25)',\n      critFailureText: '#FF4757', // \n      critFailureBg: 'rgba(255, 71, 87, 0.25)',\n      extremeSuccessText: '#00D9FF', // \n      extremeSuccessBg: 'rgba(0, 217, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(26, 10, 46, 0.92)',\n      overlayBgLight: 'rgba(45, 27, 78, 0.85)',\n      shadowBg: 'rgba(255, 107, 157, 0.3)', // \n      lightBg: 'rgba(255, 107, 157, 0.08)',\n      veryLightBg: 'rgba(179, 136, 255, 0.05)',\n      buttonText: '#1A0A2E',\n      grayBg: 'rgba(179, 136, 255, 0.15)',\n      // \n      buttonBg: 'rgba(255, 107, 157, 0.6)',\n      buttonBgActive: 'rgba(255, 107, 157, 0.8)',\n      presetButtonBg: 'rgba(127, 255, 212, 0.2)',\n      presetButtonBgActive: 'rgba(127, 255, 212, 0.45)',\n      // /\n      errorText: '#FF6B6B',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#FFD93D',\n      buttonTextOnAccent: '#1A0A2E',\n    },\n  };\n  const getThemeColors = () => {\n    const theme = THEME_COLORS[getConfig().theme] || THEME_COLORS['retro'];\n    // \n    if (!theme.buttonBg) {\n      theme.buttonBg = theme.accent;\n      theme.buttonBgActive = theme.accent;\n      theme.presetButtonBg = theme.btnBg;\n      theme.presetButtonBgActive = theme.accent;\n    }\n    // \n    if (!theme.buttonTextOnAccent) {\n      // \n      // \n      const isLightTheme =\n        theme.bgPanel &&\n        (theme.bgPanel.startsWith('#F') ||\n          theme.bgPanel.startsWith('#f') ||\n          theme.bgPanel.startsWith('#e') ||\n          theme.bgPanel.startsWith('#E') ||\n          theme.bgPanel.includes('255') ||\n          theme.bgPanel.includes('fff'));\n      theme.buttonTextOnAccent = isLightTheme ? theme.textMain || '#333' : '#fff';\n    }\n    return theme;\n  };\n  const getGMConfig = () => {\n    const baseConfig = Store.get(STORAGE_KEY_GM_CONFIG, DEFAULT_GM_CONFIG);\n\n    // \n    const activePresetId = ActionPresetManager.getActivePresetId();\n    if (activePresetId === '__none__') {\n      return {\n        ...baseConfig,\n        action_rules_disabled: true, // \n      };\n    }\n\n    // \n    const activePreset = ActionPresetManager.getActivePreset();\n    if (activePreset && activePreset.rules && activePreset.rules.length > 0) {\n      //  custom_action_groups \n      const customActionGroups = activePreset.rules.map(rule => ({\n        table_keywords: rule.table_keywords || [],\n        actions: (rule.actions || []).map(action => ({\n          label: action.label,\n          icon: action.icon || ACTION_ICON_MAP[action.label] || 'fa-circle',\n          type: 'prompt',\n          template: action.template || `<user>{Name}:${action.label}`,\n          auto_send: false,\n        })),\n      }));\n\n      return {\n        ...baseConfig,\n        custom_action_groups: customActionGroups,\n      };\n    }\n\n    return baseConfig;\n  };\n\n  // \n  const getResultBadgeStyle = (resultType, t) => {\n    // resultType: 'critSuccess' | 'extremeSuccess' | 'success' | 'warning' | 'failure' | 'critFailure'\n    const styles = {\n      critSuccess: {\n        bg: t.critSuccessText,\n        text: '#fff',\n      },\n      extremeSuccess: {\n        bg: t.extremeSuccessText,\n        text: '#fff',\n      },\n      success: {\n        bg: t.successText,\n        text: '#fff',\n      },\n      warning: {\n        bg: t.warningText,\n        text: '#fff',\n      },\n      failure: {\n        bg: t.failureText,\n        text: '#fff',\n      },\n      critFailure: {\n        bg: t.critFailureText,\n        text: '#fff',\n      },\n    };\n    const style = styles[resultType] || styles.failure;\n    return {\n      'background-color': style.bg,\n      color: style.text,\n      padding: '3px 8px',\n      'border-radius': '6px',\n      'font-size': '11px',\n      'font-weight': 'bold',\n      'white-space': 'nowrap',\n      display: 'inline-flex',\n      'align-items': 'center',\n    };\n  };\n\n  // [] \n  const ACTION_ICON_MAP: Record<string, string> = {\n    // \n    : 'fa-hand-fist',\n    : 'fa-hand-fist',\n    : 'fa-shield',\n    : 'fa-person-running',\n    // \n    : 'fa-comments',\n    : 'fa-comments',\n    : 'fa-hand',\n    : 'fa-heart',\n    : 'fa-calendar-check',\n    : 'fa-gift',\n    : 'fa-gift',\n    // \n    : 'fa-eye',\n    : 'fa-eye',\n    : 'fa-magnifying-glass',\n    // \n    : 'fa-hand-pointer',\n    : 'fa-trash',\n    : 'fa-shield-halved',\n    : 'fa-circle-xmark',\n    : 'fa-coins',\n    : 'fa-shopping-cart',\n    // \n    : 'fa-walking',\n    : 'fa-search',\n    : 'fa-clock',\n    : 'fa-door-open',\n    // \n    : 'fa-dumbbell',\n    : 'fa-wand-magic-sparkles',\n    : 'fa-fire',\n    // \n    : 'fa-crosshairs',\n    : 'fa-list-check',\n    : 'fa-circle-xmark',\n    : 'fa-check',\n    // \n    : 'fa-ear-listen',\n    : 'fa-user-plus',\n    : 'fa-handshake',\n    // \n    : 'fa-music',\n    : 'fa-guitar',\n    : 'fa-microphone',\n  };\n\n  /**\n   * \n   *\n   * []  > \n   *  config.custom_action_groups \n   * \"\"\"\"\"\"\n   *\n   * @param tableName \n   * @returns \n   */\n  const getActionsForTable = (tableName: string) => {\n    const config = getGMConfig();\n    if (!config.enabled) return [];\n\n    // \n    if ((config as any).action_rules_disabled) return [];\n\n    const lowerName = tableName.toLowerCase();\n\n    // [] \n    const customRules = (config as any).custom_action_groups || [];\n    for (const group of customRules) {\n      const matched = group.table_keywords.some((keyword: string) => lowerName.includes(keyword.toLowerCase()));\n      if (matched) return [...(group.actions || [])]; // \n    }\n\n    // \n    const builtinRules = config.action_groups || [];\n    for (const group of builtinRules) {\n      const matched = group.table_keywords.some((keyword: string) => lowerName.includes(keyword.toLowerCase()));\n      if (matched) return [...(group.actions || [])]; // \n    }\n\n    return [];\n  };\n\n  /**\n   * \n   *  + AI\n   *\n   * @param tableName \n   * @param headers \n   * @param rowData \n   * @returns \n   */\n  const getInteractOptionsForRow = (tableName: string, headers: any[], rowData: any[]) => {\n    // 1. \n    const defaultActions = [...getActionsForTable(tableName)];\n\n    // 2. \"\"\n    const interactColIdx = headers.findIndex(h => h && String(h).includes(''));\n    if (interactColIdx < 0 || !rowData[interactColIdx]) {\n      return defaultActions;\n    }\n\n    // 3. \n    const invalidValues = ['-', 'null', 'none', '', '', 'n/a', 'undefined', '/'];\n    const cellValue = String(rowData[interactColIdx]).trim();\n    if (!cellValue || invalidValues.includes(cellValue.toLowerCase())) {\n      return defaultActions;\n    }\n\n    // 4. \n    const interactOptions = cellValue\n      .split(/[,;]/)\n      .map(s => s.trim())\n      .filter(s => s && !invalidValues.includes(s.toLowerCase()));\n\n    if (interactOptions.length === 0) {\n      return defaultActions;\n    }\n\n    // 5. \n    const existingLabels = defaultActions.map(a => a.label.toLowerCase());\n\n    // 6. \n    const newActions = interactOptions\n      .filter(opt => !existingLabels.includes(opt.toLowerCase()))\n      .map(opt => ({\n        label: opt,\n        icon: ACTION_ICON_MAP[opt] || 'fa-hand-pointer',\n        type: 'prompt',\n        template: `<user>{Name}:${opt}`,\n        auto_send: true,\n      }));\n\n    // 7.  + \n    return [...defaultActions, ...newActions];\n  };\n\n  const isNumericCell = value => {\n    if (value === null || value === undefined || value === '') return false;\n    const str = String(value).trim();\n    // : (50/100)/: \n    return (\n      /^-?\\d+(\\.\\d+)?%?$/.test(str) ||\n      /^\\d+\\/\\d+$/.test(str) ||\n      /^[\\u4e00-\\u9fa5a-zA-Z]+[:\\s]\\s*\\d+/i.test(str) ||\n      /\\d+/.test(str)\n    );\n  };\n\n  const extractNumericValue = value => {\n    if (!value) return 0;\n    const str = String(value).trim();\n    //  (50/100 -> )\n    if (/^\\d+\\/\\d+$/.test(str)) return parseInt(str.split('/')[0], 10);\n    // \n    if (str.endsWith('%')) return parseInt(str.replace('%', ''), 10);\n    //  \":\" \n    const matches = str.match(/\\d+/g);\n    if (matches && matches.length > 0) {\n      return parseInt(matches[matches.length - 1], 10);\n    }\n    return 0;\n  };\n\n  const parseAttributeString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    //  JSON  {\"\":, ...}\n    if (rawStr.startsWith('{') && rawStr.endsWith('}')) {\n      try {\n        const jsonObj = JSON.parse(rawStr);\n        for (const key in jsonObj) {\n          const val = jsonObj[key];\n          if (typeof val === 'number') {\n            results.push({ name: key, value: val });\n          } else if (typeof val === 'string' && /^\\d+$/.test(val)) {\n            results.push({ name: key, value: parseInt(val, 10) });\n          }\n        }\n        if (results.length > 0) return results;\n      } catch (e) {\n        // JSON \n      }\n    }\n\n    //  \":; :\" \n    const parts = rawStr.split(/[,;\\s]+/);\n    for (const part of parts) {\n      const match = part.match(/^\"?([\\u4e00-\\u9fa5a-zA-Z_]+)\"?[:\\s]\\s*\"?(-?\\d+)\"?/);\n      if (match) {\n        results.push({ name: match[1], value: parseInt(match[2], 10) });\n      }\n    }\n    return results;\n  };\n  // [] :\n  // 1: \"();()\"\n  // 2: \":;:\"\n  // 3: \":,;:\"\n  const parseRelationshipString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    // \n    const parts = rawStr.split(/[;]/);\n    for (const part of parts) {\n      const trimmed = part.trim();\n      if (!trimmed) continue;\n\n      // 2/3: \":\"  \"\"\n      const colonMatch = trimmed.match(/^?(.+?)[:\\](.+)$/);\n      if (colonMatch) {\n        const name = colonMatch[1].trim();\n        const relation = colonMatch[2].trim();\n        if (name && relation) {\n          results.push({ name: name, relation: relation });\n          continue;\n        }\n      }\n\n      // 1: \"()\"  \"\"\n      const parenMatch = trimmed.match(/^([^(]+)[(]([^)]+)[)]$/);\n      if (parenMatch) {\n        results.push({ name: parenMatch[1].trim(), relation: parenMatch[2].trim() });\n        continue;\n      }\n\n      // \n      if (trimmed.length > 0) {\n        results.push({ name: trimmed, relation: '' });\n      }\n    }\n    return results;\n  };\n\n  // [] \n  const isRelationshipCell = (value, headerName) => {\n    if (!value) return false;\n    const str = String(value).trim();\n    const lowerHeader = (headerName || '').toLowerCase();\n    // \"\"\n    if (lowerHeader.includes('') || lowerHeader.includes('')) {\n      return true;\n    }\n    //  \"();()\" \n    return /^[^(;]+[(][^)]+[)]([;][^(;]+[(][^)]+[)])*$/.test(str);\n  };\n\n  const processTemplate = (template, cardData, headers) => {\n    if (!template || !cardData) return template;\n    let result = template;\n    const name = cardData[1] || '';\n    result = result.replace(/\\{Name\\}/gi, name);\n    result = result.replace(/\\{RowIndex\\}/gi, cardData[0] || '0');\n    if (headers && headers.length > 0) {\n      headers.forEach((header, idx) => {\n        if (header && idx < cardData.length) {\n          const value = cardData[idx] || '';\n          const regex = new RegExp(`\\\\{${header}\\\\}`, 'gi');\n          result = result.replace(regex, value);\n        }\n      });\n    }\n    result = result.replace(/\\{[^}]+\\}/g, '');\n    return result;\n  };\n\n  // \n  // /\n  const ACTION_BUTTONS = [\n    // { id: 'acu-btn-save-global', icon: 'fa-save', title: '' }, // \n    { id: 'acu-btn-refresh', icon: 'fa-sync-alt', title: '' },\n    { id: 'acu-btn-open-editor', icon: 'fa-database', title: '-' },\n    { id: 'acu-btn-collapse', icon: 'fa-chevron-down', title: '' },\n    { id: 'acu-btn-refill', icon: 'fa-bolt', title: '' },\n    { id: 'acu-btn-settings', icon: 'fa-cog', title: '' },\n  ];\n\n  let isInitialized = false;\n  let isSaving = false;\n  let saveQueue: Promise<void> = Promise.resolve(); // \n  let isEditingOrder = false;\n  let isSettingsOpen = false;\n  let currentDiffMap = new Set();\n  let observer = null;\n  let _boundRenderHandler = null;\n\n  // ---  ---\n  let cachedRawData = null;\n  let hasUnsavedChanges = false;\n  // [] \n  let pendingDeletions: Record<string, number[]> = {};\n  const getPendingDeletions = () => pendingDeletions;\n  const clearPendingDeletions = () => {\n    pendingDeletions = {};\n  };\n  let isAutoTransforming = false; // \n  let tablePageStates = {};\n  let tableSearchStates = {};\n  let lastOptionHash = null;\n  let optionPanelVisible = false; // [] \n  // [] \n  const STORAGE_KEY_SCROLL = 'acu_scroll_v19_fixed';\n  let tableScrollStates = {};\n  try {\n    const saved = localStorage.getItem(STORAGE_KEY_SCROLL);\n    if (saved) tableScrollStates = JSON.parse(saved);\n  } catch (e) {\n    console.warn('[DICE]ACU Error:', e);\n  }\n  // [] \n  const UpdateController = {\n    _lastValidationCount: 0,\n    _isRollingBack: false, // \n\n    handleUpdate: () => {\n      // \n      if (UpdateController._isRollingBack) return;\n\n      // ===  intercept  ===\n      try {\n        const snapshot = loadSnapshot();\n        const newData = getTableData();\n        if (snapshot && newData) {\n          const rules = ValidationRuleManager.getEnabledRules();\n          const violations = ValidationEngine.checkTableRules(snapshot, newData, rules);\n\n          if (violations.length > 0) {\n            console.warn('[DICE]ACU :', violations);\n            UpdateController._isRollingBack = true;\n\n            //  API \n            const api = getCore().getDB();\n            if (api?.fillTable) {\n              try {\n                api.fillTable(snapshot);\n                if (window.toastr) {\n                  window.toastr.error(violations[0].message, '', {\n                    timeOut: 5000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              } catch (fillError) {\n                console.error('[DICE]ACU fillTable :', fillError);\n                // \n                if (window.toastr) {\n                  window.toastr.error(`: ${violations[0].message}`, '', {\n                    timeOut: 7000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              }\n            }\n\n            setTimeout(() => {\n              UpdateController._isRollingBack = false;\n            }, 500);\n            return;\n          }\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n      }\n\n      //  renderInterface \n      // \n      renderInterface();\n\n      // \n      setTimeout(() => {\n        try {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            const errors = ValidationEngine.validateAllData(rawData);\n            const newCount = errors.length;\n\n            // \n            if (newCount > UpdateController._lastValidationCount && newCount > 0) {\n              // \n            }\n\n            UpdateController._lastValidationCount = newCount;\n\n            // \n            updateValidationIndicator(newCount);\n          }\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n        }\n      }, 100);\n    },\n  };\n\n  // \n  const updateValidationIndicator = count => {\n    const { $ } = getCore();\n    const $indicator = $('.acu-validation-indicator');\n\n    if (count > 0) {\n      if ($indicator.length) {\n        $indicator.find('.acu-validation-count').text(count);\n        $indicator.show();\n      }\n    } else {\n      $indicator.hide();\n    }\n  };\n\n  // --- []  ---\n  const getCurrentContextFingerprint = () => {\n    try {\n      // 1:  API\n      if (typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId) {\n        return SillyTavern.getCurrentChatId();\n      }\n      // 2: \n      if (typeof SillyTavern !== 'undefined' && SillyTavern.chatId) {\n        return SillyTavern.chatId;\n      }\n      // 3:  (iframe )\n      if (window.parent?.SillyTavern?.getCurrentChatId) {\n        return window.parent.SillyTavern.getCurrentChatId();\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getCurrentContextFingerprint error:', e);\n    }\n    return 'unknown_context';\n  };\n\n  //  ()\n\n  const DEFAULT_CONFIG = {\n    layout: 'horizontal',\n    collapseStyle: 'bar',\n    collapseAlign: 'right',\n    fontFamily: 'default',\n    theme: 'retro',\n    cardWidth: 260,\n    fontSize: 13,\n    highlightNew: true,\n    itemsPerPage: 50,\n    actionsPosition: 'bottom',\n    gridColumns: 'auto', // [] \n    positionMode: 'fixed', // fixed=, embedded=\n    showOptionPanel: true, // [] \n    clickOptionToAutoSend: true, // [] \n    optionFontSize: 12, // [] \n  };\n\n  const FONTS = [\n    { id: 'default', name: ' (Modern)', val: `'Segoe UI', 'Microsoft YaHei', sans-serif` },\n    { id: 'hanchan', name: '', val: `\"\", sans-serif` },\n    { id: 'maple', name: 'Maple Mono ()', val: `\"Maple Mono NF CN\", monospace` },\n    { id: 'huiwen', name: ' (Huiwen)', val: `\"Huiwen-mincho\", serif` },\n    { id: 'cooper', name: 'Cooper', val: `\"CooperZhengKai\", serif` },\n    { id: 'yffyt', name: 'YFFYT ()', val: `\"YFFYT\", sans-serif` },\n    { id: 'fusion', name: 'Fusion Pixel ()', val: `\"Fusion Pixel 12px M latin\", monospace` },\n    { id: 'wenkai', name: ' (WenKai)', val: `\"LXGW WenKai\", serif` },\n    { id: 'notosans', name: ' (Noto Sans)', val: `\"Noto Sans CJK\", sans-serif` },\n    { id: 'zhuque', name: ' (Zhuque)', val: `\"Zhuque Fangsong (technical preview)\", serif` },\n  ];\n\n  const THEMES = [\n    { id: 'retro', name: ' (Retro)', icon: 'fa-scroll' },\n    { id: 'dark', name: ' (Dark)', icon: 'fa-moon' },\n    { id: 'modern', name: ' (Modern)', icon: 'fa-sun' },\n    { id: 'forest', name: ' (Forest)', icon: 'fa-tree' },\n    { id: 'ocean', name: ' (Ocean)', icon: 'fa-water' },\n    { id: 'cyber', name: ' (Cyber)', icon: 'fa-bolt' },\n    { id: 'nightowl', name: ' (Night Owl)', icon: 'fa-feather' },\n    { id: 'sakura', name: ' (Warm Pink)', icon: 'fa-heart' },\n    { id: 'minepink', name: ' (Mine Pink)', icon: 'fa-skull' },\n    { id: 'galgame', name: ' (Galgame Pink)', icon: 'fa-heart' },\n    { id: 'purple', name: ' (Purple)', icon: 'fa-gem' },\n    { id: 'wechat', name: ' (Green Bubble)', icon: 'fa-weixin' },\n    { id: 'educational', name: ' (Educational)', icon: 'fa-book' },\n    { id: 'vaporwave', name: ' (Vaporwave)', icon: 'fa-palette' },\n    { id: 'classicpackaging', name: ' (Classic Packaging)', icon: 'fa-box' },\n    { id: 'terminal', name: ' (Terminal)', icon: 'fa-terminal' },\n    { id: 'dreamcore', name: ' (Dreamcore)', icon: 'fa-cloud-moon' },\n    { id: 'aurora', name: ' (Aurora)', icon: 'fa-snowflake' },\n    { id: 'chouten', name: ' (Cyber Kawaii)', icon: 'fa-star' },\n  ];\n\n  // []  core  ( +  ST )\n  let _coreCache = null;\n  const getCore = () => {\n    const w = window.parent || window;\n    //  jQuery\n    const $ = window.jQuery || w.jQuery;\n\n    // ($)\n    if (_coreCache && _coreCache.$) return _coreCache;\n\n    const core = {\n      $: $,\n      getDB: () => w.AutoCardUpdaterAPI || window.AutoCardUpdaterAPI,\n      clipboard: w.navigator.clipboard,\n      //   ->  ->  ()\n      ST:\n        window.SillyTavern ||\n        w.SillyTavern ||\n        (() => {\n          try {\n            return window.top ? window.top.SillyTavern : null;\n          } catch (e) {\n            return null;\n          }\n        })(),\n    };\n\n    //  jQuery \n    if ($) _coreCache = core;\n    return core;\n  };\n\n  const updateSaveButtonState = () => {\n    const { $ } = getCore();\n    const $btn = $('#acu-btn-save-global');\n    const $icon = $btn.find('i');\n    const deletions = getPendingDeletions();\n    let hasDeletions = false;\n    if (deletions) {\n      for (const key in deletions) {\n        if (deletions[key] && deletions[key].length > 0) {\n          hasDeletions = true;\n          break;\n        }\n      }\n    }\n    if (hasUnsavedChanges || hasDeletions) {\n      $icon.addClass('acu-icon-breathe');\n      $btn.attr('title', '');\n    } else {\n      $icon.removeClass('acu-icon-breathe');\n      $btn.attr('title', '');\n      $btn.css('color', '');\n    }\n  };\n\n  const getIconForTableName = name => {\n    if (!name) return 'fa-table';\n    const n = name.toLowerCase();\n    if (n.includes('') || n.includes('')) return 'fa-user-circle';\n    if (n.includes('') || n.includes('')) return 'fa-globe-asia';\n    if (n.includes('') || n.includes('')) return 'fa-briefcase';\n    if (n.includes('') || n.includes('')) return 'fa-dragon';\n    if (n.includes('') || n.includes('')) return 'fa-user-friends';\n    if (n.includes('') || n.includes('')) return 'fa-scroll';\n    if (n.includes('') || n.includes('')) return 'fa-address-book';\n    if (n.includes('') || n.includes('')) return 'fa-book-reader';\n    if (n.includes('') || n.includes('')) return 'fa-map-location-dot';\n    if (n.includes('') || n.includes('') || n.includes('')) return 'fa-bullseye';\n    if (n.includes('') || n.includes('')) return 'fa-shield-halved';\n    if (n.includes('')) return 'fa-gem';\n    if (n.includes('') || n.includes('')) return 'fa-file-lines';\n    if (n.includes('')) return 'fa-list-check';\n    return 'fa-table';\n  };\n\n  const getBadgeStyle = text => {\n    if (!text) return '';\n    const str = String(text).trim();\n    if (/^[0-9]+%?$/.test(str) || /^Lv\\.\\d+$/.test(str)) return 'acu-badge-green';\n    if (str.length <= 6 && !str.includes('http')) return 'acu-badge-neutral';\n    if (['', '', '', '', '', ''].includes(str)) return 'acu-badge-neutral';\n    return '';\n  };\n\n  // []  ()\n  const Store = {\n    get: (key, def = null) => {\n      try {\n        return JSON.parse(localStorage.getItem(key)) ?? def;\n      } catch {\n        return def;\n      }\n    },\n    set: (key, val) => {\n      try {\n        localStorage.setItem(key, JSON.stringify(val));\n      } catch (e) {\n        // \n        if (e.name === 'QuotaExceededError' || e.message.includes('quota')) {\n          console.warn('[DICE]ACU ...');\n          try {\n            // 1.  ()\n            localStorage.removeItem(STORAGE_KEY_LAST_SNAPSHOT);\n\n            // 2. \n            localStorage.setItem(key, JSON.stringify(val));\n          } catch (retryErr) {\n            // \n            console.error('[DICE]ACU Store ', retryErr);\n            if (window.toastr && !window._acuQuotaAlerted) {\n              window.toastr.warning(' ');\n              window._acuQuotaAlerted = true;\n              setTimeout(() => (window._acuQuotaAlerted = false), 10000);\n            }\n          }\n        } else {\n          console.error('[DICE]ACU Store', e);\n        }\n      }\n    },\n  };\n\n  const getActiveTabState = () => Store.get(STORAGE_KEY_ACTIVE_TAB);\n  const saveActiveTabState = v => Store.set(STORAGE_KEY_ACTIVE_TAB, v);\n\n  const getSavedTableOrder = () => Store.get(STORAGE_KEY_TABLE_ORDER);\n  const saveTableOrder = v => Store.set(STORAGE_KEY_TABLE_ORDER, v);\n  const getCollapsedState = () => Store.get(STORAGE_KEY_IS_COLLAPSED, false);\n  const saveCollapsedState = v => Store.set(STORAGE_KEY_IS_COLLAPSED, v);\n  // [] \n  const getOptionsCollapsedState = () => Store.get(STORAGE_KEY_OPTIONS_COLLAPSED, false);\n  const saveOptionsCollapsedState = v => Store.set(STORAGE_KEY_OPTIONS_COLLAPSED, v);\n  // []  (Chat ID)\n  const loadSnapshot = () => {\n    const data = Store.get(STORAGE_KEY_LAST_SNAPSHOT);\n    if (!data) return null;\n    // \n    const currentCtx = getCurrentContextFingerprint();\n    // \n    if (data._contextId && data._contextId !== currentCtx) {\n      return null;\n    }\n    return data;\n  };\n\n  // [] \n  const saveSnapshot = v => {\n    if (!v) return;\n    //  ChatID\n    if (typeof v === 'object') {\n      v._contextId = getCurrentContextFingerprint();\n    }\n    Store.set(STORAGE_KEY_LAST_SNAPSHOT, v);\n  };\n\n  // --- []  ---\n  const getTableHeights = () => Store.get(STORAGE_KEY_TABLE_HEIGHTS, {});\n  const saveTableHeights = v => Store.set(STORAGE_KEY_TABLE_HEIGHTS, v);\n  const getTableStyles = () => Store.get(STORAGE_KEY_TABLE_STYLES, {});\n  const saveTableStyles = v => Store.set(STORAGE_KEY_TABLE_STYLES, v);\n  const getHiddenTables = () => Store.get(STORAGE_KEY_HIDDEN_TABLES, []);\n  const saveHiddenTables = v => Store.set(STORAGE_KEY_HIDDEN_TABLES, v);\n  const getReverseTables = () => Store.get(STORAGE_KEY_REVERSE_TABLES, []);\n  const saveReverseTables = v => Store.set(STORAGE_KEY_REVERSE_TABLES, v);\n\n  // \n  const shouldShowReverseButton = tableName => {\n    if (!tableName) return false;\n    const keywords = ['', '', '', '', ''];\n    return keywords.some(kw => tableName.includes(kw));\n  };\n\n  // \n  const isTableReversed = tableName => {\n    return getReverseTables().includes(tableName);\n  };\n\n  // \n  const toggleTableReverse = tableName => {\n    const list = getReverseTables();\n    const idx = list.indexOf(tableName);\n    if (idx >= 0) {\n      list.splice(idx, 1);\n    } else {\n      list.push(tableName);\n    }\n    saveReverseTables(list);\n    console.log('[DICE]ACU toggleTableReverse:', tableName, 'reversed:', idx < 0);\n  };\n  // [] \n  const getAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          let attrs = [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.includes(attr.name)) attrs.push(attr.name);\n              });\n            }\n          });\n          if (attrs.length > 0) return attrs;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            let attrs = [];\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.includes(attr.name)) attrs.push(attr.name);\n                });\n              }\n            });\n            return attrs;\n          }\n        }\n      }\n    }\n\n    return [];\n  };\n  // [] \n  const getAttributeValue = (characterName, attrName) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData || !attrName) return null;\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          for (let idx = 0; idx < headers.length; idx++) {\n            const h = headers[idx];\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              const found = parsed.find(attr => attr.name === attrName);\n              if (found) return found.value;\n            }\n          }\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            for (let idx = 0; idx < headers.length; idx++) {\n              const h = headers[idx];\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                const found = parsed.find(attr => attr.name === attrName);\n                if (found) return found.value;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n  // [] 6\n  const STANDARD_ATTRS = ['', '', '', '', '', ''];\n\n  /**\n   * \n   */\n  const getStandardAttrs = () => {\n    const preset = AttributePresetManager.getActivePreset();\n    if (preset && preset.baseAttributes) {\n      return preset.baseAttributes.map(attr => attr.name);\n    }\n    return STANDARD_ATTRS;\n  };\n\n  /**\n   * \n   * \n   *  + \n   */\n  const getRandomSkillPool = () => {\n    try {\n      const preset = AttributePresetManager.getActivePreset();\n      if (preset) {\n        //  + \n        const allAttrs = new Set();\n\n        // \n        if (preset.baseAttributes && Array.isArray(preset.baseAttributes)) {\n          preset.baseAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        // \n        if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n          preset.specialAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        return Array.from(allAttrs);\n      }\n\n      // \n      const allPresets = AttributePresetManager.getAllPresets() || [];\n      const allAttrs = new Set(RANDOM_SKILL_POOL || []); // \n\n      // \n      if (Array.isArray(allPresets)) {\n        allPresets.forEach(p => {\n          if (!p) return;\n\n          // \n          if (p.baseAttributes && Array.isArray(p.baseAttributes)) {\n            p.baseAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n\n          // \n          if (p.specialAttributes && Array.isArray(p.specialAttributes)) {\n            p.specialAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n        });\n      }\n\n      return Array.from(allAttrs);\n    } catch (err) {\n      console.error('[DICE]ACU getRandomSkillPool :', err);\n      return RANDOM_SKILL_POOL || [];\n    }\n  };\n\n  // [] \n  const RANDOM_SKILL_POOL = [\n    // ---  (Physical & Movement) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Social & Psychological) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    // /\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Technical & Crafting) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Knowledge & Investigation) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Combat & Special) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  // []  COC/DND 6\n  /**\n   * \n   * @param isDNDOrPreset ()    null()\n   * @returns { base: {...}, special: {...} }  {...}\n   */\n  const generateRPGAttributes = (isDNDOrPreset = undefined) => {\n    // \n    if (typeof isDNDOrPreset === 'boolean') {\n      const isDND = isDNDOrPreset;\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n\n      const generateValue = () => {\n        if (isDND) {\n          const base = generate3d6();\n          const adjust = rollDice(4) - 2;\n          return Math.max(3, Math.min(18, base + adjust));\n        } else {\n          const base = generate3d6() * 5;\n          const adjust = rollDice(10) - 5;\n          return Math.max(5, Math.min(95, base + adjust));\n        }\n      };\n\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        result[attr] = generateValue();\n      });\n      return result; // \n    }\n\n    // \n    const preset = isDNDOrPreset || AttributePresetManager.getActivePreset();\n\n    // \n    if (!preset) {\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        const base = generate3d6() * 5;\n        const adjust = rollDice(10) - 5;\n        result[attr] = Math.max(5, Math.min(95, base + adjust));\n      });\n      return { base: result, special: {} };\n    }\n\n    // \n    const baseResult = {};\n    preset.baseAttributes.forEach(attr => {\n      const formula = attr.modifier ? `${attr.formula}+${attr.modifier}` : attr.formula;\n      baseResult[attr.name] = generateAttributeValue(formula, attr.range, {});\n    });\n\n    // \n    const specialResult = {};\n    if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n      preset.specialAttributes.forEach(attr => {\n        specialResult[attr.name] = generateAttributeValue(attr.formula, attr.range, baseResult);\n      });\n    }\n\n    return { base: baseResult, special: specialResult };\n  };\n\n  // [] \n  const clearPresetAttributesForCharacter = async charName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // NPC//\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    const customAttrs = existingAttrs.filter(attr => !presetAttrNames.has(attr.name));\n    const newAttrString = customAttrs.map(attr => `${attr.name}:${attr.value}`).join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData);\n\n    return {\n      success: true,\n      attrString: newAttrString,\n    };\n  };\n\n  // [] \n  const writeAttributesToCharacter = async (charName, newAttrs, isDND = false) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \"\"\n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // \n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('\"\"');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const existingMap = {};\n    existingAttrs.forEach(attr => {\n      existingMap[attr.name] = attr.value;\n    });\n\n    // +\n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    let standardCount = 0;\n    standardAttrs.forEach(attrName => {\n      if (existingMap[attrName] !== undefined) {\n        standardCount++;\n      }\n    });\n    const isComplete = standardCount === standardAttrs.length;\n\n    // \n    const customAttrs = [];\n    existingAttrs.forEach(attr => {\n      if (!presetAttrNames.has(attr.name)) {\n        customAttrs.push({ name: attr.name, value: attr.value });\n      }\n    });\n\n    // \n    const resultParts = [];\n\n    // 1. \n    standardAttrs.forEach(attrName => {\n      if (isComplete) {\n        //   \n        const newValue = newAttrs[attrName] !== undefined ? newAttrs[attrName] : existingMap[attrName];\n        if (newValue !== undefined) {\n          resultParts.push(`${attrName}:${newValue}`);\n        }\n      } else {\n        //   \n        if (existingMap[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        } else if (newAttrs[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        }\n      }\n    });\n\n    // 2. \n    Object.keys(newAttrs).forEach(attrName => {\n      if (!standardAttrs.includes(attrName)) {\n        // \n        if (isComplete || !existingMap[attrName]) {\n          // \n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        } else {\n          // \n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        }\n      }\n    });\n\n    // 3. \n    customAttrs.forEach(attr => {\n      resultParts.push(`${attr.name}:${attr.value}`);\n    });\n\n    const newAttrString = resultParts.join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData);\n\n    // UI\n    const writtenAttrs = [];\n    standardAttrs.forEach(attrName => {\n      writtenAttrs.push({ name: attrName, value: newAttrs[attrName] });\n    });\n\n    return {\n      success: true,\n      attrs: writtenAttrs,\n      attrString: newAttrString,\n      wasComplete: isComplete,\n    };\n  };\n  // [] \"\"\n  const getFullAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n    let attrs = [];\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.some(a => a.name === attr.name)) {\n                  attrs.push(attr);\n                }\n              });\n            }\n          });\n          if (attrs.length > 0) break;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.some(a => a.name === attr.name)) {\n                    attrs.push(attr);\n                  }\n                });\n              }\n            });\n            break;\n          }\n        }\n        if (attrs.length > 0) break;\n      }\n    }\n\n    return attrs;\n  };\n  // [] \n  const initCustomDropdown = ($input, options, themeColors) => {\n    const { $ } = getCore();\n    const t = themeColors || {};\n    const inputId = $input.attr('id') || 'dd_' + Math.random().toString(36).substr(2, 9);\n    $input.attr('id', inputId);\n\n    // \n    $input.parent().find('.acu-dropdown-list').remove();\n\n    //  wrapper\n    if (!$input.parent().hasClass('acu-dropdown-wrapper')) {\n      $input.wrap('<div class=\"acu-dropdown-wrapper\"></div>');\n    }\n\n    // \n    const $dropdown = $(`<div class=\"acu-dropdown-list\" data-for=\"${inputId}\"></div>`);\n    $dropdown.css({\n      background: t.bgPanel || '#fff',\n      'border-color': t.border || '#ccc',\n    });\n    $input.after($dropdown);\n\n    const renderItems = (filter = '') => {\n      const lowerFilter = filter.toLowerCase();\n      const filtered = options.filter(opt => opt.toLowerCase().includes(lowerFilter));\n\n      if (filtered.length === 0) {\n        $dropdown.html(`<div class=\"acu-dropdown-empty\" style=\"color:${t.textSub || '#999'};\"></div>`);\n      } else {\n        $dropdown.html(\n          filtered\n            .map(\n              opt =>\n                `<div class=\"acu-dropdown-item\" data-value=\"${escapeHtml(opt)}\" style=\"color:${t.textMain || '#333'};\">${escapeHtml(opt)}</div>`,\n            )\n            .join(''),\n        );\n      }\n    };\n\n    const showDropdown = () => {\n      $('.acu-dropdown-list').removeClass('visible');\n      renderItems($input.val());\n      $dropdown.addClass('visible');\n    };\n\n    const hideDropdown = () => {\n      $dropdown.removeClass('visible');\n    };\n\n    // \n    $input.off('.acudd').on('focus.acudd click.acudd', function (e) {\n      e.stopPropagation();\n      showDropdown();\n    });\n\n    // \n    $input.on('input.acudd', function () {\n      renderItems($(this).val());\n    });\n\n    // hover \n    $dropdown\n      .on('mouseenter', '.acu-dropdown-item', function () {\n        $(this).css('background', t.tableHead || 'rgba(128,128,128,0.15)');\n      })\n      .on('mouseleave', '.acu-dropdown-item', function () {\n        $(this).css('background', 'transparent');\n      });\n\n    // \n    $dropdown.on('click', '.acu-dropdown-item', function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      const val = $(this).data('value');\n      $input.val(val).trigger('change');\n      hideDropdown();\n    });\n\n    // \n    $dropdown.on('click', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $input\n      .closest('.acu-dice-panel, .acu-contest-panel')\n      .off('click.acudd_' + inputId)\n      .on('click.acudd_' + inputId, function (e) {\n        if (!$(e.target).closest('.acu-dropdown-wrapper').length) {\n          hideDropdown();\n        }\n      });\n  };\n  // [] \n  const addClearButton = ($panel, inputSelector, themeColors) => {\n    const { $ } = getCore();\n    const t = themeColors || {};\n    $panel.find(inputSelector).each(function () {\n      const $input = $(this);\n      // \n      if ($input.parent().hasClass('acu-input-wrapper')) return;\n      // \n      $input.wrap('<div class=\"acu-input-wrapper\"></div>');\n      //  - \n      const $clearBtn = $(\n        `<button type=\"button\" class=\"acu-clear-btn\" title=\"\" style=\"color:${t.textSub || '#999'};\"><i class=\"fa-solid fa-times\"></i></button>`,\n      );\n      $input.after($clearBtn);\n      // \n      $clearBtn.on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        $input.val('').trigger('input').trigger('change').focus();\n      });\n      //  - \n      $clearBtn\n        .on('mouseenter', function () {\n          $(this).css({ color: t.accent || '#7a695f', opacity: '1' });\n        })\n        .on('mouseleave', function () {\n          $(this).css({ color: t.textSub || '#999', opacity: '0.5' });\n        });\n    });\n  };\n  // [] \n  const showDiceSettingsPanel = (isDND = false) => {\n    const { $ } = getCore();\n    $('.acu-dice-config-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    const ruleTitle = isDND ? 'DND ' : 'COC ';\n    const resetText = isDND ? ' DND ' : ' COC ';\n\n    // \n    const defaults = isDND\n      ? { critSuccess: 20, critFail: 1 }\n      : { critSuccess: 5, critFail: 96, hardDiv: 2, extremeDiv: 5 };\n\n    //  placeholder\n    const currentCritSuccess = isDND\n      ? diceCfg.dndCritSuccess !== undefined && diceCfg.dndCritSuccess !== defaults.critSuccess\n        ? diceCfg.dndCritSuccess\n        : ''\n      : diceCfg.critSuccessMax !== undefined && diceCfg.critSuccessMax !== defaults.critSuccess\n        ? diceCfg.critSuccessMax\n        : '';\n    const currentCritFail = isDND\n      ? diceCfg.dndCritFail !== undefined && diceCfg.dndCritFail !== defaults.critFail\n        ? diceCfg.dndCritFail\n        : ''\n      : diceCfg.critFailMin !== undefined && diceCfg.critFailMin !== defaults.critFail\n        ? diceCfg.critFailMin\n        : '';\n    const currentHardDiv =\n      !isDND && diceCfg.difficultSuccessDiv !== undefined && diceCfg.difficultSuccessDiv !== defaults.hardDiv\n        ? diceCfg.difficultSuccessDiv\n        : '';\n    const currentExtremeDiv =\n      !isDND && diceCfg.hardSuccessDiv !== undefined && diceCfg.hardSuccessDiv !== defaults.extremeDiv\n        ? diceCfg.hardSuccessDiv\n        : '';\n\n    const tieRule = diceCfg.contestTieRule || 'initiator_lose';\n    const hideDiceResultFromUser =\n      diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n    const hideDiceResultInChat = diceCfg.hideDiceResultInChat !== undefined ? diceCfg.hideDiceResultInChat : false;\n\n    const cocExtraHtml = isDND\n      ? ''\n      : `\n            <div class=\"acu-dice-cfg-row\">\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-hard-div\" data-min=\"2\" data-max=\"5\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentHardDiv || defaults.hardDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-extreme-div\" data-min=\"3\" data-max=\"10\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentExtremeDiv || defaults.extremeDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const panelHtml = `\n            <div class=\"acu-dice-config-overlay\">\n                <div class=\"acu-dice-config-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-dice-cfg-header\">\n                        <span><i class=\"fa-solid fa-cog\"></i> ${ruleTitle}</span>\n                        <button class=\"acu-config-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-dice-cfg-body\">\n                        <div class=\"acu-dice-cfg-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-success\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritSuccess || defaults.critSuccess}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-fail\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritFail || defaults.critFail}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                        ${cocExtraHtml}\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <select id=\"cfg-tie-rule\">\n                                    <option value=\"initiator_lose\" ${tieRule === 'initiator_lose' ? 'selected' : ''}> ()</option>\n                                    <option value=\"tie\" ${tieRule === 'tie' ? 'selected' : ''}></option>\n                                    <option value=\"initiator_win\" ${tieRule === 'initiator_win' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label></label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result\" ${hideDiceResultFromUser ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label></label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result-chat\" ${hideDiceResultInChat ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-actions\">\n                            <button id=\"cfg-reset-dice\">${resetText}</button>\n                            <button id=\"cfg-save-dice\"></button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $panel = $(panelHtml);\n    $('body').append($panel);\n\n    $panel.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '31300',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    // \n    const theme = getThemeColors();\n    $panel.find('#cfg-reset-dice, #cfg-save-dice').css({\n      background: theme.btnBg,\n      color: theme.textMain,\n      borderColor: theme.border,\n    });\n    $panel.find('#cfg-reset-dice, #cfg-save-dice').hover(\n      function () {\n        $(this).css({\n          background: theme.btnHover,\n          borderColor: theme.btnHover,\n        });\n      },\n      function () {\n        $(this).css({\n          background: theme.btnBg,\n          borderColor: theme.border,\n        });\n      },\n    );\n\n    const closePanel = () => $panel.remove();\n    $panel.find('.acu-config-close').click(closePanel);\n    setupOverlayClose($panel, 'acu-dice-config-overlay', closePanel);\n\n    // === Stepper  ===\n    $panel.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        $value.text(newVal);\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    $panel.find('#cfg-save-dice').click(function () {\n      const newCfg = { contestTieRule: $('#cfg-tie-rule').val() };\n\n      // stepper\n      const getStepperValue = id => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          const text = $stepper.find('.acu-stepper-value').text().replace(/[^\\d]/g, '');\n          return text !== '' ? parseInt(text, 10) : null;\n        }\n        return null;\n      };\n\n      const critSuccessVal = getStepperValue('cfg-crit-success');\n      const critFailVal = getStepperValue('cfg-crit-fail');\n\n      if (isDND) {\n        newCfg.dndCritSuccess = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.dndCritFail = critFailVal !== null ? critFailVal : defaults.critFail;\n      } else {\n        newCfg.critSuccessMax = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.critFailMin = critFailVal !== null ? critFailVal : defaults.critFail;\n\n        const hardDivVal = getStepperValue('cfg-hard-div');\n        const extremeDivVal = getStepperValue('cfg-extreme-div');\n        newCfg.difficultSuccessDiv = hardDivVal !== null ? hardDivVal : defaults.hardDiv;\n        newCfg.hardSuccessDiv = extremeDivVal !== null ? extremeDivVal : defaults.extremeDiv;\n      }\n\n      // \"\"\n      newCfg.hideDiceResultFromUser = $('#cfg-hide-dice-result').is(':checked');\n      // \"\"\n      newCfg.hideDiceResultInChat = $('#cfg-hide-dice-result-chat').is(':checked');\n\n      saveDiceConfig(newCfg);\n      // \n      console.info('[DICE]/...');\n      hideDiceResultsInUserMessages();\n      closePanel();\n    });\n\n    $panel.find('#cfg-reset-dice').click(function () {\n      // stepper\n      const resetStepper = (id, defaultValue) => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          $stepper.find('.acu-stepper-value').text(defaultValue);\n        }\n      };\n\n      resetStepper('cfg-crit-success', defaults.critSuccess);\n      resetStepper('cfg-crit-fail', defaults.critFail);\n      if (!isDND) {\n        resetStepper('cfg-hard-div', defaults.hardDiv);\n        resetStepper('cfg-extreme-div', defaults.extremeDiv);\n      }\n    });\n  };\n  // [] \n  const showDicePanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n    // 1d100\n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    // 1d100\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n    // [] \n    const rawDataForList = cachedRawData || getTableData();\n    let diceCharacterList = ['<user>'];\n    let diceAttrList = [];\n\n    if (rawDataForList) {\n      for (const key in rawDataForList) {\n        const sheet = rawDataForList[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '') {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) diceCharacterList.push(row[1]);\n          }\n        }\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const row = sheet.content[1];\n          const headers = sheet.content[0] || [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!diceAttrList.includes(attr.name)) diceAttrList.push(attr.name);\n              });\n            }\n          });\n        }\n      }\n    }\n    const {\n      targetValue = null, // []  null\n      targetName = '',\n      attrValue = null, // [] \n      diceType = savedDiceType, // \n      successCriteria = 'lte', // [] COC\n      onResult = null,\n      initiatorName = '', // [] \n      fromMvu = false, // [] MVU\n      mvuPath = null, // [] MVU\n      mvuParsedInfo = null, // [] \n    } = options;\n\n    // [] /DC\n    const isDND = diceType === '1d20' || successCriteria === 'gte';\n    let initialAttrValue = attrValue;\n    let initialTargetValue = targetValue;\n\n    // attrValuetargetValue\n    if (attrValue !== null && targetValue === null) {\n      if (isDND) {\n        initialTargetValue = Math.max(0, 20 - attrValue);\n      } else {\n        initialTargetValue = attrValue;\n      }\n    }\n\n    const t = getThemeColors();\n    const isCyberTheme = getConfig().theme === 'cyber';\n    const inputTextColor = isCyberTheme ? '#ff00ff' : t.inputText;\n    const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n    // \n    const inputStyle = `width:100%;padding:5px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:4px;color:${inputTextColor} !important;font-size:12px;text-align:center;box-sizing:border-box;`;\n\n    const overlay = $(\n      `<div class=\"acu-dice-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:${t.overlayBgLight};z-index:31200;\"></div>`,\n    );\n\n    // []  COC  DND\n    const successCriteriaOptions = [\n      { id: 'lte', name: ' (COC)' },\n      { id: 'gte', name: ' (DND)' },\n    ];\n\n    // [] \n    let defaultCriteria = successCriteria;\n    if (diceType === '1d100') defaultCriteria = 'lte';\n    else if (diceType === '1d20') defaultCriteria = 'gte';\n\n    const panel = $(`\n            <div class=\"acu-dice-panel acu-theme-${config.theme}\" style=\"\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 340px;\n                max-width: 90vw;\n                background: ${t.bgPanel};\n                border: 1px solid ${t.border};\n                border-radius: 12px;\n                box-shadow: 0 20px 60px ${t.shadowBg};\n                z-index: 31201;\n                overflow: hidden;\n            \">\n                <div style=\"padding: 12px 15px; background: ${t.tableHead}; border-bottom: 1px solid ${t.border}; display: flex; justify-content: space-between; align-items: center;\">\n                    <div style=\"font-size: 15px; font-weight: bold; color: ${t.accent}; display: flex; align-items: center; gap: 8px;\">\n                        <i class=\"fa-solid fa-dice-d20\"></i> \n                    </div>\n                    <div style=\"display: flex; align-items: center; gap: 8px;\">\n                        <button id=\"dice-switch-contest-top\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 14px; padding: 4px; transition: all 0.2s;\" title=\"\"><i class=\"fa-solid fa-people-arrows\"></i></button>\n                        <button class=\"acu-dice-config-btn\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 14px; padding: 4px; transition: all 0.2s;\" title=\"\">\n                            <i class=\"fa-solid fa-cog\"></i>\n                        </button>\n                        <button class=\"acu-dice-close\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 16px; padding: 4px;\">\n                            <i class=\"fa-solid fa-times\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div style=\"padding: 15px; max-height: 70vh; overflow-y: auto;\">\n                    <div style=\"display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; align-items: center;\" class=\"acu-dice-presets\">\n                        <button class=\"acu-dice-preset ${diceType === '1d20' ? 'active' : ''}\" data-dice=\"1d20\" data-criteria=\"gte\" style=\"padding: 4px 10px; background: ${diceType === '1d20' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${diceType === '1d20' ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\">1d20</button>\n                        <button class=\"acu-dice-preset ${diceType === '1d100' ? 'active' : ''}\" data-dice=\"1d100\" data-criteria=\"lte\" style=\"padding: 4px 10px; background: ${diceType === '1d100' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${diceType === '1d100' ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\">1d100</button>\n                        <button class=\"acu-dice-preset acu-dice-custom-btn\" data-dice=\"custom\" style=\"padding: 4px 10px; background: ${!['1d20', '1d100'].includes(diceType) ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${!['1d20', '1d100'].includes(diceType) ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\"></button>\n                        <input type=\"text\" id=\"dice-custom-input\" placeholder=\"2d6\" value=\"${!['1d20', '1d100'].includes(diceType) ? diceType : ''}\" style=\"width:60px;\">\n                    </div>\n\n                    <!--  -->\n                    <div style=\"margin-bottom: 10px;\">\n                        <div style=\"font-size: 11px; color: ${t.accent}; font-weight: bold; margin-bottom: 4px; display: flex; align-items: center; gap: 6px;\"><i class=\"fa-solid fa-user\"></i> </div>\n                        <div id=\"dice-char-buttons\" style=\"display: flex; flex-wrap: wrap; gap: 4px; max-height: 60px; overflow-y: auto;\"></div>\n                    </div>\n\n                    <!-- 1 +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-initiator-name\" value=\"${escapeHtml(initiatorName)}\" placeholder=\"<user>\" style=\"${inputStyle}\">\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; gap: 6px;\">\n                                \n                                <button type=\"button\" class=\"acu-random-skill-btn\" id=\"dice-random-skill\" title=\"\" style=\"width: 18px; height: 18px; padding: 0; background: transparent; border: 1px dashed ${t.accent}; border-radius: 4px; color: ${t.accent}; font-size: 9px; cursor: pointer; display: flex; align-items: center; justify-content: center;\">\n                                    <i class=\"fa-solid fa-dice\"></i>\n                                </button>\n                            </div>\n                            <input type=\"text\" id=\"dice-attr-name\" value=\"${escapeHtml(targetName || '')}\" placeholder=\"\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!-- 2 +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-attr-value\" value=\"${initialAttrValue !== null ? initialAttrValue : ''}\" placeholder=\"=50%\" style=\"${inputStyle}\">\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\" id=\"dice-target-label\"></div>\n                            <input type=\"text\" id=\"dice-target\" value=\"${initialTargetValue !== null ? initialTargetValue : ''}\" placeholder=\"=\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!-- 3 +  +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-bottom: 6px;\" id=\"dice-row-3\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; justify-content: center;\"></div>\n                            <select id=\"dice-success-criteria\" class=\"acu-dice-select\">\n                                ${successCriteriaOptions\n                                  .map(\n                                    opt =>\n                                      `<option value=\"${opt.id}\" ${opt.id === defaultCriteria ? 'selected' : ''}>${opt.name}</option>`,\n                                  )\n                                  .join('')}\n                            </select>\n                        </div>\n                        <div id=\"dice-difficulty-wrapper\">\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; justify-content: center;\"></div>\n                            <select id=\"dice-difficulty\" class=\"acu-dice-select\">\n                                <option value=\"normal\" selected></option>\n                                <option value=\"hard\"></option>\n                                <option value=\"extreme\"></option>\n                                <option value=\"critical\"></option>\n                            </select>\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-modifier\" value=\"0\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div style=\"margin-bottom: 10px;\">\n                        <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 4px;\"><i class=\"fa-solid fa-sliders\"></i> </div>\n                        <div id=\"dice-attr-buttons\" style=\"display: flex; flex-wrap: wrap; gap: 4px; max-height: 80px; overflow-y: auto;\"></div>\n                    </div>\n                    <!--  -->\n                    <input type=\"hidden\" id=\"dice-formula\" value=\"${diceType}\">\n\n                    <button id=\"dice-roll-btn\" style=\"width: 100%; padding: 12px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 8px; color: ${t.buttonText}; font-size: 15px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; position: relative;\">\n                        <i class=\"fa-solid fa-dice\"></i> \n                    </button>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay).append(panel);\n\n    // [] \n    const buildCharButtons = () => {\n      const $container = panel.find('#dice-char-buttons');\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.initiator) {\n        const initiator = mvuParsedInfo.initiator;\n        const shortName = initiator.length > 4 ? initiator.substring(0, 4) + '..' : initiator;\n        const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n        html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu\" data-char=\"${escapeHtml(initiator)}\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;white-space:nowrap;font-weight:bold;\" title=\": ${escapeHtml(initiator)}\">${escapeHtml(shortName)}</button>`;\n      }\n\n      // \n      diceCharacterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html += `<button class=\"acu-dice-char-btn\" data-char=\"${escapeHtml(name)}\" style=\"padding:3px 8px;background:${t.btnBg};border:1px solid ${t.border};border-radius:4px;color:${t.textMain};font-size:11px;cursor:pointer;white-space:nowrap;\" title=\"${escapeHtml(displayName)}\">${escapeHtml(shortName)}</button>`;\n      });\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.candidates && mvuParsedInfo.candidates.length > 0) {\n        mvuParsedInfo.candidates.forEach(candidate => {\n          // \n          if (mvuParsedInfo.initiator && candidate === mvuParsedInfo.initiator) return;\n          const shortName = candidate.length > 4 ? candidate.substring(0, 4) + '..' : candidate;\n          html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu-candidate\" data-char=\"${escapeHtml(candidate)}\" style=\"padding:3px 8px;background:${t.inputBg};border:1px dashed ${t.accent};border-radius:4px;color:${t.accent};font-size:11px;cursor:pointer;white-space:nowrap;\" title=\": ${escapeHtml(candidate)}\">${escapeHtml(shortName)}</button>`;\n        });\n      }\n\n      $container.html(html || `<div style=\"font-size:11px;color:${t.textSub};\"></div>`);\n      // \n      $container.find('.acu-dice-char-btn').click(function () {\n        const charName = $(this).data('char');\n        panel.find('#dice-initiator-name').val(charName).trigger('change');\n      });\n    };\n\n    // [] \n    const buildAttrButtons = charName => {\n      const $container = panel.find('#dice-attr-buttons');\n      const $parentSection = $container.parent(); // \n      const attrs = getFullAttributesForCharacter(charName);\n\n      // \n      $parentSection.show();\n\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.attrName) {\n        const attrName = mvuParsedInfo.attrName;\n        // \n        const attrValue = getAttributeValue(charName, attrName) || targetValue || '';\n        const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n        if (attrValue) {\n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"${attrValue}\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;font-weight:bold;\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}:${attrValue}</button>`;\n        } else {\n          // \n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;font-weight:bold;\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}</button>`;\n        }\n      }\n\n      // \n      attrs.forEach(attr => {\n        html += `<button class=\"acu-dice-attr-btn\" data-name=\"${escapeHtml(attr.name)}\" data-value=\"${attr.value}\" style=\"padding:3px 8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:4px;color:${t.inputText};font-size:11px;cursor:pointer;\">${escapeHtml(attr.name)}:${attr.value}</button>`;\n      });\n\n      // \n      html += `<button class=\"acu-dice-gen-attr-btn\" style=\"padding:3px 8px;background:transparent;border:1px dashed ${t.accent};border-radius:4px;color:${t.accent};font-size:11px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>`;\n\n      // \n      html += `<button class=\"acu-dice-clear-attr-btn\" style=\"padding:3px 8px;background:transparent;border:1px dashed ${t.errorText};border-radius:4px;color:${t.errorText};font-size:11px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;margin-left:4px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\"></i></button>`;\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-dice-attr-btn').click(function () {\n        const attrName = $(this).data('name');\n        const attrValue = $(this).data('value');\n        panel.find('#dice-attr-name').val(attrName);\n        panel.find('#dice-attr-value').val(attrValue);\n\n        // \n        const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n        const isDND = criteria === 'gte';\n        const numValue = parseInt(attrValue, 10) || 0;\n\n        if (isDND) {\n          // DNDDC = 20 - \n          panel.find('#dice-target').val(20 - numValue);\n        } else {\n          // COC = \n          panel.find('#dice-target').val(attrValue);\n        }\n\n        // changeUI\n        panel.find('#dice-attr-value').trigger('change');\n      });\n\n      // \n      $container.find('.acu-dice-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n          console.log('[DICE]ACU  for:', charName);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-dice-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharButtons();\n    // <user>\n    buildAttrButtons('<user>');\n    // [] \n    panel.find('#dice-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#dice-attr-name').val(randomSkill).trigger('change');\n    });\n\n    // \n    initCustomDropdown(panel.find('#dice-initiator-name'), diceCharacterList, t);\n    initCustomDropdown(panel.find('#dice-attr-name'), diceAttrList, t);\n    // [] \n    addClearButton(panel, '#dice-initiator-name, #dice-attr-name, #dice-attr-value, #dice-target', t);\n\n    // [] \n    panel.find('#dice-initiator-name').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#dice-attr-name'), newAttrList.length > 0 ? newAttrList : diceAttrList, t);\n\n      // [] \n      buildAttrButtons(charName);\n    });\n\n    // [] \n    panel.find('#dice-attr-name').on('change.acuval', function () {\n      const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#dice-attr-value').val(attrValue);\n        // /DC\n        const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n        const isDND = criteria === 'gte';\n        panel.find('#dice-target').val(isDND ? 20 - attrValue : attrValue);\n      }\n    });\n\n    // [] \n    const convertTargetForDice = (currentTarget, fromDice, toDice) => {\n      if (!currentTarget || currentTarget === '') return '';\n      const val = parseInt(currentTarget, 10);\n      if (isNaN(val)) return currentTarget;\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n\n      const fromMax = getMaxRoll(fromDice);\n      const toMax = getMaxRoll(toDice);\n\n      // \n      const ratio = val / fromMax;\n      const newVal = Math.round(ratio * toMax);\n      return Math.max(1, Math.min(newVal, toMax));\n    };\n\n    // []  UICOC/DND \n    const updateRuleMode = () => {\n      const criteria = panel.find('#dice-success-criteria').val();\n      const isDND = criteria === 'gte';\n      const $targetInput = panel.find('#dice-target');\n      const $difficultyWrapper = panel.find('#dice-difficulty-wrapper');\n      const $row3 = panel.find('#dice-row-3');\n\n      if (isDND) {\n        // DND \n        $targetInput.attr('placeholder', '=20-');\n        panel.find('#dice-target-label').text('DC');\n        $difficultyWrapper.hide();\n        $row3.css('grid-template-columns', '1fr 1fr');\n      } else {\n        // COC \n        $targetInput.attr('placeholder', '=');\n        panel.find('#dice-target-label').text('');\n        $difficultyWrapper.show();\n        $row3.css('grid-template-columns', '1fr 1fr 1fr');\n      }\n    };\n\n    panel.find('#dice-success-criteria').on('change', updateRuleMode);\n\n    // \n    updateRuleMode();\n\n    // \n    let currentDiceType = diceType;\n\n    //  - [] \n    panel.find('.acu-dice-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-dice-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n      const suggestedCriteria = $(this).data('criteria') || 'lte';\n\n      // [] \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, newDice);\n        $targetInput.val(convertedVal);\n      }\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n      const newMax = getMaxRoll(newDice);\n      panel.find('#dice-target-auto').text(`(: 1~${newMax})`);\n\n      currentDiceType = newDice;\n      panel.find('#dice-formula').val(newDice);\n\n      // [] \n      panel.find('#dice-success-criteria').val(suggestedCriteria).trigger('change');\n    });\n    // \n    panel.find('.acu-dice-custom-btn').click(function () {\n      // \n      panel.find('.acu-dice-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      const customDice = panel.find('#dice-custom-input').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#dice-custom-input').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      // \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, customDice);\n        $targetInput.val(convertedVal);\n      }\n\n      panel.find('#dice-formula').val(customDice);\n      currentDiceType = customDice;\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n\n      panel.find('#dice-success-criteria').val('gte').trigger('change');\n    });\n\n    // \n    panel.find('#dice-custom-input').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-dice-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = formula => {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], formula };\n\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      const total = rolls.reduce((a, b) => a + b, 0) + modifier;\n\n      return { total, rolls, sides, count, modifier, formula };\n    };\n\n    // 1d6, 1d6+2\n    const parseModifier = function (modStr) {\n      if (!modStr || modStr.trim() === '') return 0;\n      const trimmed = modStr.trim();\n\n      // \n      const numValue = parseFloat(trimmed);\n      if (!isNaN(numValue) && isFinite(numValue) && trimmed.match(/^-?\\d+(\\.\\d+)?$/)) {\n        return numValue;\n      }\n\n      // \n      // 1d6, 2d10, 1d6+2, 1d6-2, 2d6+1d4\n      let result = 0;\n      let remaining = trimmed;\n\n      // 1d6, 2d10\n      const dicePattern = /(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi;\n      let match;\n      while ((match = dicePattern.exec(remaining)) !== null) {\n        const diceResult = rollDiceExpression(match[0]);\n        if (!isNaN(diceResult)) {\n          result += diceResult;\n        }\n        remaining = remaining.replace(match[0], '');\n      }\n\n      // \n      const numberPattern = /([+-]?\\d+(\\.\\d+)?)/g;\n      let numMatch;\n      while ((numMatch = numberPattern.exec(remaining)) !== null) {\n        const num = parseFloat(numMatch[0]);\n        if (!isNaN(num) && isFinite(num)) {\n          result += num;\n        }\n      }\n\n      return result;\n    };\n\n    // \n    const performDiceRoll = function () {\n      const formula = panel.find('#dice-formula').val().trim() || '1d100';\n      const modStr = panel.find('#dice-modifier').val().trim() || '0';\n      const mod = parseModifier(modStr);\n      const attrName = panel.find('#dice-attr-name').val().trim() || '';\n      const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n      const difficulty = panel.find('#dice-difficulty').val() || 'normal';\n\n      // \n      const isDND = criteria === 'gte';\n\n      // \n      const diceCfg = getDiceConfig();\n      const hardDiv = diceCfg.difficultSuccessDiv || 2;\n      const extremeDiv = diceCfg.hardSuccessDiv || 5;\n      // COC:   critSuccessMax,   critFailMin\n      // DND:   dndCritSuccess,   dndCritFail\n      const critSuccessMax = isDND ? diceCfg.dndCritFail || 1 : diceCfg.critSuccessMax || 5;\n      const critFailMin = isDND ? diceCfg.dndCritSuccess || 20 : diceCfg.critFailMin || 96;\n\n      // COC  DND \n      let targetInputVal = panel.find('#dice-target').val().trim();\n      let attrInputVal = panel.find('#dice-attr-value').val().trim();\n      let attrValue = attrInputVal !== '' ? parseInt(attrInputVal, 10) : 0;\n      let target;\n      let isAutoTarget = false;\n\n      // \n      const getDefaultTarget = formulaStr => {\n        const match = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (match) {\n          const maxRoll = parseInt(match[1], 10) * parseInt(match[2], 10);\n          return Math.round(maxRoll / 2);\n        }\n        return 50;\n      };\n\n      if (targetInputVal !== '') {\n        // /DC\n        target = parseInt(targetInputVal, 10) || getDefaultTarget(formula);\n      } else if (isDND) {\n        // DND  DC = 20 - DC=10\n        if (attrValue > 0) {\n          target = 20 - attrValue;\n          isAutoTarget = true;\n        } else {\n          target = 10; // \n          isAutoTarget = true;\n        }\n      } else {\n        // COC  = \n        if (attrValue > 0) {\n          target = attrValue;\n          isAutoTarget = true;\n        } else {\n          target = getDefaultTarget(formula);\n          isAutoTarget = true;\n        }\n      }\n\n      const result = rollDice(formula);\n      const finalValue = result.total + mod;\n\n      // \n      let requiredTarget = target;\n      let difficultyLabel = '';\n      let difficultyDiv = 1;\n\n      // DND \n      if (!isDND) {\n        switch (difficulty) {\n          case 'hard':\n            requiredTarget = Math.floor(target / hardDiv);\n            difficultyLabel = '';\n            difficultyDiv = hardDiv;\n            break;\n          case 'extreme':\n            requiredTarget = Math.floor(target / extremeDiv);\n            difficultyLabel = '';\n            difficultyDiv = extremeDiv;\n            break;\n          case 'critical':\n            requiredTarget = critSuccessMax;\n            difficultyLabel = '';\n            break;\n          default:\n            difficultyLabel = '';\n            break;\n        }\n      }\n\n      // \n      let isCritSuccess = false;\n      let isCritFailure = false;\n      let isSuccess = false;\n      let outcomeText = '';\n      let outcomeClass = '';\n\n      // /\n      if (isDND) {\n        // DND:   20  1\n        isCritSuccess = finalValue >= critFailMin; //  critFailMin  DND \n        isCritFailure = finalValue <= critSuccessMax; //  critSuccessMax  DND \n      } else {\n        // COC:   5  96\n        isCritSuccess = finalValue <= critSuccessMax;\n        isCritFailure = finalValue >= critFailMin;\n      }\n\n      // /\n      if (isDND) {\n        isSuccess = finalValue >= requiredTarget;\n      } else {\n        isSuccess = finalValue <= requiredTarget;\n      }\n\n      // \n      if (isCritSuccess) {\n        outcomeText = '';\n        outcomeClass = 'success';\n        isSuccess = true;\n      } else if (isCritFailure) {\n        outcomeText = '';\n        outcomeClass = 'failure';\n        isSuccess = false;\n      } else if (isSuccess) {\n        if (isDND) {\n          outcomeText = '';\n        } else if (difficulty === 'hard') {\n          outcomeText = '';\n        } else if (difficulty === 'extreme') {\n          outcomeText = '';\n        } else {\n          // \n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            outcomeText = '';\n          } else if (finalValue <= hardTarget) {\n            outcomeText = '';\n          } else {\n            outcomeText = '';\n          }\n        }\n        outcomeClass = 'success';\n      } else {\n        outcomeText = '';\n        outcomeClass = 'failure';\n      }\n\n      const criteriaSymbol = isDND ? '' : '';\n      const hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const displayValue = hideDiceResultFromUser ? '' : finalValue;\n      const displayOutcomeText = hideDiceResultFromUser ? '' : outcomeText;\n\n      // \n      let resultType;\n      if (isCritSuccess) {\n        resultType = 'critSuccess';\n      } else if (isCritFailure) {\n        resultType = 'critFailure';\n      } else if (isSuccess) {\n        if (difficulty === 'extreme' || (difficulty === 'normal' && finalValue <= Math.floor(target / extremeDiv))) {\n          resultType = 'extremeSuccess';\n        } else if (difficulty === 'hard' || (difficulty === 'normal' && finalValue <= Math.floor(target / hardDiv))) {\n          resultType = 'success';\n        } else {\n          resultType = 'warning';\n        }\n      } else {\n        resultType = 'failure';\n      }\n\n      const badgeStyle = getResultBadgeStyle(resultType, t);\n      const badgeStyleStr = Object.entries(badgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n\n      // \n      const $rollBtn = panel.find('#dice-roll-btn');\n      $rollBtn.html(`\n        <div style=\"display:flex; align-items:center; justify-content:center; width:100%; gap:8px;\">\n          <span style=\"font-size:22px; font-weight:bold; color:${t.buttonText};\">${displayValue}</span>\n          <span style=\"font-size:11px; color:${t.buttonText}; opacity:0.9;\">${criteriaSymbol}${requiredTarget}${difficultyLabel ? '(' + difficultyLabel + ')' : ''}</span>\n          ${displayOutcomeText ? `<span style=\"${badgeStyleStr}\">${displayOutcomeText}</span>` : ''}\n          <button class=\"dice-retry-btn\" style=\"background:transparent; border:none; color:${t.buttonText}; cursor:pointer; padding:4px; display:flex; align-items:center; justify-content:center; opacity:0.8; transition:opacity 0.2s;\" title=\"\">\n            <i class=\"fa-solid fa-rotate-right\"></i>\n          </button>\n        </div>\n      `);\n\n      // \n      $rollBtn.off('click', '.dice-retry-btn').on('click', '.dice-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        // \n        performDiceRoll();\n      });\n\n      //  Prompt \n      const initiatorName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      let judgeExpr = '';\n\n      if (isCritSuccess) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        } else {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        }\n      } else if (isCritFailure) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        } else {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        }\n      } else if (isDND) {\n        // DND \n        if (isSuccess) {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}<${requiredTarget}`;\n        }\n      } else if (difficulty === 'critical') {\n        // COC \n        judgeExpr = `${critSuccessMax}${finalValue}>${critSuccessMax}`;\n      } else if (difficulty !== 'normal') {\n        // COC \n        if (isSuccess) {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}>${requiredTarget}`;\n        }\n      } else {\n        // COC \n        if (isSuccess) {\n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${extremeDiv}`;\n          } else if (finalValue <= hardTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${hardDiv}`;\n          } else {\n            judgeExpr = `${target}${finalValue}${target}`;\n          }\n        } else {\n          judgeExpr = `${target}${finalValue}>${target}`;\n        }\n      }\n\n      const diceResultText = `${initiatorName}${attrName}${finalValue}${judgeExpr}${outcomeText}`;\n      smartInsertToTextarea(diceResultText, 'dice');\n      if (onResult) {\n        onResult({\n          success: isSuccess,\n          total: finalValue,\n          target,\n          outcomeText,\n          attrName,\n          criteria,\n          isAutoTarget,\n          formula: formulaText,\n        });\n      }\n    };\n\n    // \n    panel.find('#dice-roll-btn').click(function () {\n      performDiceRoll();\n    });\n\n    // \n    panel.find('#dice-switch-contest-top').click(function () {\n      const targetInput = panel.find('#dice-target').val().trim();\n      const attrValueInput = panel.find('#dice-attr-value').val().trim();\n      const currentDice = panel.find('#dice-formula').val() || '1d100';\n      const initiatorNameVal = panel.find('#dice-initiator-name').val().trim();\n      closePanel();\n      showContestPanel({\n        //  placeholder \n        initiatorName: initiatorNameVal && initiatorNameVal !== '<user>' ? initiatorNameVal : '',\n        initiatorValue: attrValueInput !== '' ? parseInt(attrValueInput, 10) : undefined,\n        diceType: currentDice,\n      });\n    });\n    // \n    const closePanel = () => {\n      overlay.remove();\n      panel.remove();\n    };\n    overlay.click(closePanel);\n    panel.find('.acu-dice-close').click(closePanel);\n    //  - \n    panel.find('.acu-dice-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentCriteria = panel.find('#dice-success-criteria').val();\n      const isDND = currentCriteria === 'gte';\n      showDiceSettingsPanel(isDND);\n    });\n  };\n\n  // [] \n  const showContestPanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay, .acu-contest-panel, .acu-contest-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    // \n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n\n    // \n    const opponentName = options.opponentName || '';\n    const diceType = options.diceType || savedDiceType;\n    const passedInitiatorName = options.initiatorName || '';\n    const passedInitiatorValue = options.initiatorValue;\n    const passedOpponentValue = options.opponentValue;\n\n    const rawData = cachedRawData || getTableData();\n    let playerAttrs = [];\n    let opponentAttrs = [];\n\n    // [] <user> + \n    let characterList = ['<user>'];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) characterList.push(row[1]);\n          }\n          break;\n        }\n      }\n    }\n    // [] \n    let contestAttrList = [];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content && sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!contestAttrList.includes(attr.name)) contestAttrList.push(attr.name);\n              });\n            }\n          });\n          break;\n        }\n      }\n    }\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const attrStr = sheet.content[1][7] || '';\n          playerAttrs = parseAttributeString(attrStr);\n        }\n\n        if (sheet.name === '' && opponentName) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1] === opponentName) {\n              const attrStr = row[9] || '';\n              opponentAttrs = parseAttributeString(attrStr);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    const t = getThemeColors();\n    const isCyberTheme = getConfig().theme === 'cyber';\n    const inputTextColor = isCyberTheme ? '#ff00ff' : t.inputText;\n    // \n    const inputStyle = `width:100%;padding:5px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:4px;color:${inputTextColor} !important;font-size:12px;text-align:center;box-sizing:border-box;`;\n\n    const buildAttrButtons = (attrs, targetType) => {\n      let html = '';\n      // \n      for (let i = 0; i < attrs.length; i++) {\n        const attr = attrs[i];\n        html +=\n          '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n          attr.value +\n          '\" data-aname=\"' +\n          escapeHtml(attr.name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" style=\"padding:3px 8px;background:' +\n          t.inputBg +\n          ';border:1px solid ' +\n          t.border +\n          ';border-radius:4px;color:' +\n          t.inputText +\n          ';font-size:11px;cursor:pointer;margin:2px;\">' +\n          escapeHtml(attr.name) +\n          ': ' +\n          attr.value +\n          '</button>';\n      }\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.accent +\n        ';border-radius:3px;color:' +\n        t.accent +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin:2px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.errorText +\n        ';border-radius:3px;color:' +\n        t.errorText +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin:2px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\" style=\"font-size:9px;\"></i></button>';\n      return html;\n    };\n\n    const overlay = $(\n      '<div class=\"acu-contest-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:' +\n        t.overlayBg +\n        ';z-index:31200;\"></div>',\n    );\n    const panelHtml =\n      '<div class=\"acu-contest-panel acu-theme-' +\n      config.theme +\n      '\" style=\"position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:360px;max-width:92vw;background:' +\n      t.bgPanel +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:12px;box-shadow:0 20px 60px ' +\n      t.shadowBg +\n      ';z-index:31201;overflow:hidden;\">' +\n      '<div style=\"padding:12px 15px;background:' +\n      t.tableHead +\n      ';border-bottom:1px solid ' +\n      t.border +\n      ';display:flex;justify-content:space-between;align-items:center;\">' +\n      '<div style=\"font-size:15px;font-weight:bold;color:' +\n      t.accent +\n      ';display:flex;align-items:center;gap:8px;\"><i class=\"fa-solid fa-people-arrows\"></i> </div>' +\n      '<div style=\"display:flex;align-items:center;gap:8px;\">' +\n      '<button id=\"contest-switch-normal\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:14px;padding:4px;transition:all 0.2s;\" title=\"\"><i class=\"fa-solid fa-dice-d20\"></i></button>' +\n      '<button class=\"acu-contest-config-btn\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:14px;padding:4px;transition:all 0.2s;\" title=\"\"><i class=\"fa-solid fa-cog\"></i></button>' +\n      '<button class=\"acu-contest-close\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>' +\n      '</div>' +\n      '</div>' +\n      '<div style=\"padding:15px;max-height:70vh;overflow-y:auto;\">' +\n      '<div style=\"display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;align-items:center;\">' +\n      '<button class=\"acu-contest-preset' +\n      (diceType === '1d20' ? ' active' : '') +\n      '\" data-dice=\"1d20\" style=\"padding:4px 10px;background:' +\n      (diceType === '1d20' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (diceType === '1d20' ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\">1d20</button>' +\n      '<button class=\"acu-contest-preset' +\n      (diceType === '1d100' ? ' active' : '') +\n      '\" data-dice=\"1d100\" style=\"padding:4px 10px;background:' +\n      (diceType === '1d100' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (diceType === '1d100' ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\">1d100</button>' +\n      '<button class=\"acu-contest-preset acu-contest-custom-btn\" data-dice=\"custom\" style=\"padding:4px 10px;background:' +\n      (!['1d20', '1d100'].includes(diceType) ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (!['1d20', '1d100'].includes(diceType) ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\"></button>' +\n      '<input type=\"text\" id=\"contest-custom-dice\" placeholder=\"2d6\" value=\"' +\n      (!['1d20', '1d100'].includes(diceType) ? diceType : '') +\n      '\" style=\"width:60px;padding:4px 6px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      inputTextColor +\n      ' !important;font-size:11px;text-align:center;box-sizing:border-box;\" />' +\n      '</div>' +\n      '<input type=\"hidden\" id=\"contest-dice-type\" value=\"' +\n      diceType +\n      '\">' +\n      '<div style=\"font-size:11px;color:' +\n      t.accent +\n      ';font-weight:bold;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-init-char-buttons\" style=\"display:flex;flex-wrap:wrap;gap:3px;\"></div></div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-display\" value=\"\" placeholder=\"<user>\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;gap:6px;\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-init-random-skill\" title=\"\" style=\"width:18px;height:18px;padding:0;background:transparent;border:1px dashed ' +\n      t.accent +\n      ';border-radius:4px;color:' +\n      t.accent +\n      ';font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" id=\"contest-init-name\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-value\" value=\"' +\n      (passedInitiatorValue !== undefined ? passedInitiatorValue : '') +\n      '\" placeholder=\"=50%\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-target\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div id=\"init-attr-buttons\" style=\"display:flex;flex-wrap:wrap;gap:2px;margin-bottom:8px;max-height:50px;overflow-y:auto;\">' +\n      buildAttrButtons(playerAttrs, 'init') +\n      '</div>' +\n      '<div style=\"font-size:11px;color:' +\n      t.accent +\n      ';font-weight:bold;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-opp-char-buttons\" style=\"display:flex;flex-wrap:wrap;gap:3px;\"></div></div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opponent-display\" value=\"' +\n      escapeHtml(opponentName) +\n      '\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;gap:6px;\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-opp-random-skill\" title=\"\" style=\"width:18px;height:18px;padding:0;background:transparent;border:1px dashed ' +\n      t.accent +\n      ';border-radius:4px;color:' +\n      t.accent +\n      ';font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" id=\"contest-opp-name\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opp-value\" value=\"' +\n      (passedOpponentValue !== undefined ? passedOpponentValue : '') +\n      '\" placeholder=\"=50%\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opp-target\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div id=\"opp-attr-buttons\" style=\"display:flex;flex-wrap:wrap;gap:2px;margin-bottom:10px;max-height:50px;overflow-y:auto;\">' +\n      buildAttrButtons(opponentAttrs, 'opp') +\n      '</div>' +\n      '<div id=\"contest-result-display\" style=\"display:none;margin-bottom:10px;padding:8px;background:' +\n      t.inputBg +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:6px;\">' +\n      '<div style=\"display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;width:100%;\">' +\n      '<div id=\"contest-result-init\" style=\"display:flex;align-items:center;gap:4px;min-width:0;flex:1;\"></div>' +\n      '<span style=\"color:' +\n      t.textSub +\n      ';opacity:0.9;font-size:11px;font-weight:bold;white-space:nowrap;\">VS</span>' +\n      '<div id=\"contest-result-opp\" style=\"display:flex;align-items:center;gap:4px;min-width:0;flex:1;justify-content:flex-end;\"></div>' +\n      '</div>' +\n      '</div>' +\n      '<button id=\"contest-roll-btn\" style=\"width:100%;padding:12px;background:' +\n      (t.buttonBg || t.accent) +\n      ';border:none;border-radius:8px;color:' +\n      t.buttonText +\n      ';font-size:15px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;position:relative;\"><i class=\"fa-solid fa-dice\"></i> </button>' +\n      '</div>' +\n      '</div>';\n\n    const panel = $(panelHtml);\n    $('body').append(overlay).append(panel);\n\n    // []  - \n    const buildCharBtns = targetType => {\n      const containerId = targetType === 'init' ? '#contest-init-char-buttons' : '#contest-opp-char-buttons';\n      const $container = panel.find(containerId);\n      let html = '';\n      characterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html +=\n          '<button class=\"acu-contest-char-btn\" data-char=\"' +\n          escapeHtml(name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" style=\"padding:3px 8px;background:' +\n          t.btnBg +\n          ';border:1px solid ' +\n          t.border +\n          ';border-radius:4px;color:' +\n          t.textMain +\n          ';font-size:11px;cursor:pointer;white-space:nowrap;\" title=\"' +\n          escapeHtml(displayName) +\n          '\">' +\n          escapeHtml(shortName) +\n          '</button>';\n      });\n      $container.html(html);\n      $container.find('.acu-contest-char-btn').click(function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const charName = $(this).data('char');\n        const type = $(this).data('type');\n        if (type === 'init') {\n          panel.find('#contest-init-display').val(charName).trigger('change');\n        } else {\n          panel.find('#contest-opponent-display').val(charName).trigger('change');\n        }\n      });\n    };\n\n    // [] \n    const rebuildAttrBtns = (attrs, targetType) => {\n      const containerId = targetType === 'init' ? '#init-attr-buttons' : '#opp-attr-buttons';\n      const $container = panel.find(containerId);\n\n      // \n      $container.show();\n\n      let html = '';\n\n      // \n      if (attrs.length > 0) {\n        attrs.forEach(attr => {\n          html +=\n            '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n            attr.value +\n            '\" data-aname=\"' +\n            escapeHtml(attr.name) +\n            '\" data-type=\"' +\n            targetType +\n            '\" style=\"padding:2px 6px;background:' +\n            t.inputBg +\n            ';border:1px solid ' +\n            t.border +\n            ';border-radius:3px;color:' +\n            t.inputText +\n            ';font-size:10px;cursor:pointer;\">' +\n            escapeHtml(attr.name) +\n            ':' +\n            attr.value +\n            '</button>';\n        });\n      }\n\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.accent +\n        ';border-radius:3px;color:' +\n        t.accent +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.errorText +\n        ';border-radius:3px;color:' +\n        t.errorText +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin-left:4px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\" style=\"font-size:9px;\"></i></button>';\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-contest-attr-btn').click(function () {\n        const val = $(this).attr('data-val');\n        const aname = $(this).attr('data-aname');\n        const type = $(this).attr('data-type');\n        if (type === 'init') {\n          panel.find('#contest-init-value').val(val);\n          panel.find('#contest-init-name').val(aname);\n        } else {\n          panel.find('#contest-opp-value').val(val);\n          panel.find('#contest-opp-name').val(aname);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          // \n          let charName;\n          if (type === 'init') {\n            charName = panel.find('#contest-init-display').val().trim() || '<user>';\n          } else {\n            charName = panel.find('#contest-opponent-display').val().trim();\n          }\n\n          if (!charName) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        let charName;\n        if (type === 'init') {\n          charName = panel.find('#contest-init-display').val().trim() || '<user>';\n        } else {\n          charName = panel.find('#contest-opponent-display').val().trim();\n        }\n\n        if (!charName) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharBtns('init');\n    buildCharBtns('opp');\n    // [] \n    panel.find('#contest-init-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-init-name').val(randomSkill).trigger('change');\n    });\n\n    // [] \n    panel.find('#contest-opp-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-opp-name').val(randomSkill).trigger('change');\n    });\n    //  rebuildAttrBtns /\n    const initAttrs = getFullAttributesForCharacter(passedInitiatorName || '<user>');\n    rebuildAttrBtns(initAttrs, 'init');\n    const oppAttrs = getFullAttributesForCharacter(opponentName || '');\n    rebuildAttrBtns(oppAttrs, 'opp');\n\n    // \n    initCustomDropdown(panel.find('#contest-init-display'), characterList, t);\n    initCustomDropdown(panel.find('#contest-opponent-display'), characterList, t);\n    initCustomDropdown(panel.find('#contest-init-name'), contestAttrList, t);\n    initCustomDropdown(panel.find('#contest-opp-name'), contestAttrList, t);\n    addClearButton(\n      panel,\n      '#contest-init-display, #contest-init-name, #contest-init-value, #contest-init-target, #contest-opponent-display, #contest-opp-name, #contest-opp-value, #contest-opp-target',\n      t,\n    );\n\n    // \n    panel.find('#contest-init-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-init-name'), newAttrList.length > 0 ? newAttrList : contestAttrList, t);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'init');\n    });\n\n    // \n    panel.find('#contest-opponent-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim();\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-opp-name'), newAttrList.length > 0 ? newAttrList : contestAttrList, t);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'opp');\n    });\n\n    // \n    panel.find('#contest-init-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-init-display').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-init-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('#contest-opp-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-opponent-display').val().trim();\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-opp-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('.acu-contest-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-contest-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n      panel.find('#contest-dice-type').val(newDice);\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n    });\n\n    // \n    panel.find('.acu-contest-custom-btn').click(function () {\n      // \n      panel.find('.acu-contest-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      var customDice = panel.find('#contest-custom-dice').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#contest-custom-dice').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      panel.find('#contest-dice-type').val(customDice);\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n    });\n\n    // \n    panel.find('#contest-custom-dice').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-contest-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = function (formula) {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], sides: 100 };\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      return {\n        total:\n          rolls.reduce(function (a, b) {\n            return a + b;\n          }, 0) + modifier,\n        rolls: rolls,\n        sides: sides,\n      };\n    };\n\n    const getSuccessLevel = function (roll, target, sides) {\n      const t = getThemeColors();\n      if (sides === 100) {\n        if (roll <= 5) return { level: 3, name: '', color: t.critSuccessText };\n        if (roll >= 96) return { level: -1, name: '', color: t.critFailureText };\n        if (roll <= Math.floor(target / 5)) return { level: 2, name: '', color: t.extremeSuccessText };\n        if (roll <= Math.floor(target / 2)) return { level: 1, name: '', color: t.successText };\n        if (roll <= target) return { level: 0, name: '', color: t.warningText };\n        return { level: -1, name: '', color: t.failureText };\n      } else {\n        if (roll === 20) return { level: 3, name: '', color: t.critSuccessText };\n        if (roll === 1) return { level: -1, name: '', color: t.critFailureText };\n        if (roll >= target) return { level: 0, name: '', color: t.successText };\n        return { level: -1, name: '', color: t.failureText };\n      }\n    };\n\n    // \n    const performContestRoll = function () {\n      var formula = panel.find('#contest-dice-type').val() || '1d100';\n\n      var initName = panel.find('#contest-init-display').val().trim() || '<user>';\n      var initAttrName = panel.find('#contest-init-name').val().trim() || '';\n      // \n      var getHalfMax = function (formulaStr) {\n        var m = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (m) return Math.round((parseInt(m[1], 10) * parseInt(m[2], 10)) / 2);\n        return 50;\n      };\n\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var initValue;\n      if (initValueInput === '') {\n        // \n        initValue = getHalfMax(formula);\n      } else {\n        initValue = parseInt(initValueInput, 10) || getHalfMax(formula);\n      }\n      var initTargetInput = panel.find('#contest-init-target').val().trim();\n      var initTarget;\n      if (initTargetInput !== '') {\n        initTarget = parseInt(initTargetInput, 10);\n      } else {\n        // \n        initTarget = initValue;\n      }\n\n      var oppName = panel.find('#contest-opponent-display').val().trim() || '';\n      var oppAttrName = panel.find('#contest-opp-name').val().trim() || initAttrName;\n      var oppValueInput = panel.find('#contest-opp-value').val().trim();\n      var oppValue;\n      if (oppValueInput === '') {\n        // \n        oppValue = getHalfMax(formula);\n      } else {\n        oppValue = parseInt(oppValueInput, 10) || getHalfMax(formula);\n      }\n      var oppTargetInput = panel.find('#contest-opp-target').val().trim();\n      var oppTarget;\n      if (oppTargetInput !== '') {\n        oppTarget = parseInt(oppTargetInput, 10);\n      } else {\n        // \n        oppTarget = oppValue;\n      }\n\n      var initResult = rollDice(formula);\n      var oppResult = rollDice(formula);\n      var initSuccess = getSuccessLevel(initResult.total, initTarget, initResult.sides);\n      var oppSuccess = getSuccessLevel(oppResult.total, oppTarget, oppResult.sides);\n\n      var winner, winnerColor, resultDesc;\n      var diceCfg = getDiceConfig();\n      var tieRule = diceCfg.contestTieRule || 'initiator_lose';\n      var hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      var displayInitValue = hideDiceResultFromUser ? '' : initResult.total;\n      var displayOppValue = hideDiceResultFromUser ? '' : oppResult.total;\n      var displayInitSuccessName = hideDiceResultFromUser ? '' : initSuccess.name;\n      var displayOppSuccessName = hideDiceResultFromUser ? '' : oppSuccess.name;\n\n      if (initSuccess.level > oppSuccess.level) {\n        winner = initName + ' ';\n        winnerColor = t.successText;\n        resultDesc = initSuccess.name + '  ' + oppSuccess.name;\n      } else if (initSuccess.level < oppSuccess.level) {\n        winner = oppName + ' ';\n        winnerColor = t.failureText;\n        resultDesc = oppSuccess.name + '  ' + initSuccess.name;\n      } else {\n        // \n        resultDesc = ' ' + initSuccess.name;\n        if (tieRule === 'initiator_win') {\n          winner = '' + initName + ' ';\n          winnerColor = t.successText;\n        } else if (tieRule === 'tie') {\n          winner = '';\n          winnerColor = t.warningText;\n        } else {\n          // : initiator_lose\n          winner = '' + initName + ' ';\n          winnerColor = t.failureText;\n        }\n      }\n\n      var displayWinner = hideDiceResultFromUser ? '' : winner;\n\n      // \n      const getResultTypeFromSuccess = success => {\n        if (success.level === 3) return 'critSuccess';\n        if (success.level === 2) return 'extremeSuccess';\n        if (success.level === 1) return 'success';\n        if (success.level === 0) return 'warning';\n        if (success.level === -1) {\n          // name\n          return success.name === '' ? 'critFailure' : 'failure';\n        }\n        return 'failure';\n      };\n      const initResultType = getResultTypeFromSuccess(initSuccess);\n      const oppResultType = getResultTypeFromSuccess(oppSuccess);\n\n      const initBadgeStyle = getResultBadgeStyle(initResultType, t);\n      const oppBadgeStyle = getResultBadgeStyle(oppResultType, t);\n      const winnerBadgeStyle = getResultBadgeStyle(\n        winnerColor === t.successText ? 'success' : winnerColor === t.warningText ? 'warning' : 'failure',\n        t,\n      );\n\n      const initBadgeStyleStr = Object.entries(initBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n      const oppBadgeStyleStr = Object.entries(oppBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n      const winnerBadgeStyleStr = Object.entries(winnerBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n\n      // \n      const $resultDisplay = panel.find('#contest-result-display');\n      const $resultInit = panel.find('#contest-result-init');\n      const $resultOpp = panel.find('#contest-result-opp');\n\n      // \n      $resultInit.html(\n        '<span style=\"font-size:11px;color:' +\n          t.textMain +\n          ';opacity:0.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;\">' +\n          escapeHtml(initName) +\n          '</span>' +\n          '<span style=\"font-size:16px;font-weight:bold;color:' +\n          t.textMain +\n          ';\">' +\n          displayInitValue +\n          '</span>' +\n          (displayInitSuccessName\n            ? '<span style=\"' + initBadgeStyleStr + '\">' + displayInitSuccessName + '</span>'\n            : ''),\n      );\n\n      // \n      $resultOpp.html(\n        (displayOppSuccessName ? '<span style=\"' + oppBadgeStyleStr + '\">' + displayOppSuccessName + '</span>' : '') +\n          '<span style=\"font-size:16px;font-weight:bold;color:' +\n          t.textMain +\n          ';\">' +\n          displayOppValue +\n          '</span>' +\n          '<span style=\"font-size:11px;color:' +\n          t.textMain +\n          ';opacity:0.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;\">' +\n          escapeHtml(oppName) +\n          '</span>',\n      );\n\n      $resultDisplay.show();\n\n      // \n      const $contestBtn = panel.find('#contest-roll-btn');\n      $contestBtn.html(\n        '<div style=\"display:flex; align-items:center; justify-content:center; width:100%; gap:8px;\">' +\n          (displayWinner ? '<span style=\"' + winnerBadgeStyleStr + '\">' + displayWinner + '</span>' : '') +\n          '<button class=\"contest-retry-btn\" style=\"background:transparent; border:none; color:' +\n          t.buttonText +\n          '; cursor:pointer; padding:4px; display:flex; align-items:center; justify-content:center; opacity:0.8; transition:opacity 0.2s;\" title=\"\">' +\n          '<i class=\"fa-solid fa-rotate-right\"></i>' +\n          '</button>' +\n          '</div>',\n      );\n\n      // \n      $contestBtn.off('click', '.contest-retry-btn').on('click', '.contest-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        // \n        performContestRoll();\n      });\n\n      const contestResultText =\n        `${initName} ${initAttrName} vs ${oppName} ${oppAttrName}` +\n        `${initName} ${initAttrName} (${initTarget})  ${initResult.total}${initSuccess.name}` +\n        `${oppName} ${oppAttrName} (${oppTarget})  ${oppResult.total}${oppSuccess.name}` +\n        `${winner}`;\n      smartInsertToTextarea(contestResultText, 'dice');\n    };\n\n    // \n    panel.find('#contest-roll-btn').click(function () {\n      performContestRoll();\n    });\n\n    // [] \n    panel.find('#contest-switch-normal').click(function () {\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var currentInitName = panel.find('#contest-init-name').val() || '';\n      var currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      var initiatorNameVal = panel.find('#contest-init-display').val().trim();\n      closePanel();\n      showDicePanel({\n        //  null  placeholder\n        targetValue: initValueInput !== '' ? parseInt(initValueInput, 10) : null,\n        targetName: currentInitName,\n        diceType: currentDice,\n        initiatorName: initiatorNameVal,\n      });\n    });\n    //  - \n    // 1d20 -> DND,  -> COC\n    panel.find('.acu-contest-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      const isDND = currentDice === '1d20';\n      showDiceSettingsPanel(isDND);\n    });\n    var closePanel = function () {\n      overlay.remove();\n      panel.remove();\n    };\n    overlay.click(closePanel);\n    panel.find('.acu-contest-close').click(closePanel);\n  };\n\n  const parseInSceneStatus = (value, headerName) => {\n    const val = String(value || '')\n      .trim()\n      .toLowerCase();\n    const header = String(headerName || '').toLowerCase();\n    if (!val) return false;\n\n    if (header.includes('')) {\n      return val === '' || val === 'false' || val === 'no';\n    }\n\n    return val.startsWith('') || val === 'true' || val === '' || val === 'yes';\n  };\n\n  const buildMapViewModel = async () => {\n    const rawData = cachedRawData || getTableData();\n    const allTables = processJsonData(rawData || {});\n    if (!rawData || Object.keys(allTables).length === 0) return null;\n\n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const elementResult = (() => {\n      const keywords = ['', '', '', '', ''];\n      for (const tableName in allTables) {\n        if (keywords.some(keyword => tableName.includes(keyword))) {\n          return {\n            data: allTables[tableName],\n            name: tableName,\n            key: allTables[tableName].key,\n          };\n        }\n      }\n      return null;\n    })();\n\n    const globalHeaders = globalResult?.data?.headers || [];\n    const globalRows = globalResult?.data?.rows || [];\n    const globalRow = globalRows[0] || [];\n    const globalConfig = DASHBOARD_TABLE_CONFIG.global;\n    const detailIdx = DashboardDataParser.findColumnIndex(globalHeaders, 'detailLocation', globalConfig);\n    const regionIdx = DashboardDataParser.findColumnIndex(globalHeaders, 'currentLocation', globalConfig);\n    const detailLocation = detailIdx >= 0 ? String(globalRow[detailIdx] || '').trim() : '';\n    const currentRegion = regionIdx >= 0 ? String(globalRow[regionIdx] || '').trim() : '';\n\n    if (!locationResult?.data) return null;\n\n    const findColumnIndex = (headers, keywords, fallbackIndex = null) => {\n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (keywords.some(keyword => h.includes(keyword.toLowerCase()))) return i;\n      }\n      return fallbackIndex ?? -1;\n    };\n\n    const locations = new Map();\n    const locationHeaders = locationResult.data.headers || [];\n    const locationRows = locationResult.data.rows || [];\n    const locationNameIdx = findColumnIndex(locationHeaders, ['', '', '', '', ''], 1);\n    const locationRegionIdx = findColumnIndex(locationHeaders, ['', '', '', ''], null);\n    const locationTypeIdx = findColumnIndex(locationHeaders, ['', '', ''], null);\n    const locationDescIdx = findColumnIndex(locationHeaders, ['', '', '', '', ''], null);\n    const locationImportanceIdx = findColumnIndex(locationHeaders, ['', ''], null);\n    const locationExploreIdx = findColumnIndex(locationHeaders, ['', '', ''], null);\n\n    // emoji\n    const allLocationNames: string[] = [];\n    locationRows.forEach(row => {\n      const name = String(row[locationNameIdx] || '')\n        .trim()\n        .replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n      if (name) allLocationNames.push(name);\n    });\n    const emojiMap = resolveBatchLocationEmojis(allLocationNames);\n\n    locationRows.forEach((row, idx) => {\n      const name = String(row[locationNameIdx] || '')\n        .trim()\n        .replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n      if (!name) return;\n      const region = locationRegionIdx >= 0 ? String(row[locationRegionIdx] || '').trim() : '';\n\n      const location = {\n        name,\n        region,\n        locationType: locationTypeIdx >= 0 ? row[locationTypeIdx] || '' : '',\n        description: locationDescIdx >= 0 ? row[locationDescIdx] || '' : '',\n        importance: locationImportanceIdx >= 0 ? row[locationImportanceIdx] || '' : '',\n        exploreStatus: locationExploreIdx >= 0 ? row[locationExploreIdx] || '' : '',\n        emoji: emojiMap.get(name) ?? null,\n        tableKey: locationResult.key || '',\n        rowIndex: idx,\n      };\n      locations.set(name, location);\n    });\n\n    const elements = new Map();\n    const addElement = (locationName, element) => {\n      if (!elements.has(locationName)) {\n        elements.set(locationName, []);\n      }\n      elements.get(locationName).push(element);\n    };\n\n    if (elementResult?.data) {\n      const elementHeaders = elementResult.data.headers || [];\n      const elementRows = elementResult.data.rows || [];\n      const elementNameIdx = findColumnIndex(elementHeaders, ['', '', ''], 1);\n      const elementTypeIdx = findColumnIndex(elementHeaders, ['', '', ''], 2);\n      const elementLocationIdx = findColumnIndex(elementHeaders, ['', '', ''], 3);\n      const elementDescIdx = findColumnIndex(elementHeaders, ['', '', ''], null);\n      const elementStatusIdx = findColumnIndex(elementHeaders, ['', ''], null);\n      const elementInteractIdx = findColumnIndex(elementHeaders, ['', '', '', ''], null);\n\n      elementRows.forEach((row, idx) => {\n        const name = String(row[elementNameIdx] || '').trim();\n        if (!name) return;\n        const locationName = String(row[elementLocationIdx] || '').trim();\n        if (!locationName) return;\n        if (currentRegion && locations.size > 0 && !locations.has(locationName)) return;\n\n        const rawInteractions = elementInteractIdx >= 0 ? row[elementInteractIdx] : '';\n        const interactions = String(rawInteractions || '')\n          .split(/[,;]/)\n          .map(item => item.trim())\n          .filter(Boolean);\n        const typeValue = elementTypeIdx >= 0 ? row[elementTypeIdx] || '' : '';\n        const element = {\n          name,\n          type: typeValue,\n          location: locationName,\n          description: elementDescIdx >= 0 ? row[elementDescIdx] || '' : '',\n          status: elementStatusIdx >= 0 ? row[elementStatusIdx] || '' : '',\n          interactions,\n          emoji: getElementEmoji(name, typeValue),\n          tableKey: elementResult.key || '',\n          rowIndex: idx,\n        };\n        addElement(locationName, element);\n      });\n    }\n\n    const characters = new Map();\n    const addCharacter = async character => {\n      const avatarUrl = await AvatarManager.getAsync(character.name);\n      const full = {\n        ...character,\n        avatarUrl,\n        avatarOffsetX: AvatarManager.getOffsetX(character.name),\n        avatarOffsetY: AvatarManager.getOffsetY(character.name),\n        avatarScale: AvatarManager.getScale(character.name),\n      };\n      if (!characters.has(full.location)) {\n        characters.set(full.location, []);\n      }\n      characters.get(full.location).push(full);\n    };\n\n    let playerLocation = '';\n\n    if (playerResult?.data) {\n      const playerConfig = DASHBOARD_TABLE_CONFIG.player;\n      const playerHeaders = playerResult.data.headers || [];\n      const playerRows = playerResult.data.rows || [];\n      const playerRow = playerRows[0] || [];\n      const playerNameIdx = DashboardDataParser.findColumnIndex(playerHeaders, 'name', playerConfig);\n      const playerPosIdx = DashboardDataParser.findColumnIndex(playerHeaders, 'position', playerConfig);\n      const playerNameRaw = playerNameIdx >= 0 ? playerRow[playerNameIdx] : getPlayerName();\n      const playerPosRaw = playerPosIdx >= 0 ? playerRow[playerPosIdx] : '';\n      const playerName = String(playerNameRaw || '').trim();\n      playerLocation = String(playerPosRaw || '').trim();\n\n      if (!playerLocation && detailLocation) {\n        playerLocation = detailLocation;\n      }\n\n      if (playerName && playerLocation) {\n        await addCharacter({\n          name: playerName,\n          location: playerLocation,\n          isPlayer: true,\n          isInScene: true,\n          tableKey: playerResult.key || '',\n          rowIndex: 0,\n        });\n      }\n    }\n\n    if (npcResult?.data) {\n      const npcConfig = DASHBOARD_TABLE_CONFIG.npc;\n      const npcHeaders = npcResult.data.headers || [];\n      const npcRows = npcResult.data.rows || [];\n      const npcNameIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'name', npcConfig);\n      const npcPosIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'position', npcConfig);\n      const npcInSceneIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'inScene', npcConfig);\n\n      for (let idx = 0; idx < npcRows.length; idx++) {\n        const row = npcRows[idx];\n        const npcName = String(row[npcNameIdx] || '').trim();\n        if (!npcName) continue;\n        const locationName = String(row[npcPosIdx] || '').trim();\n        if (!locationName) continue;\n        if (currentRegion && locations.size > 0 && !locations.has(locationName)) continue;\n        const inSceneValue = npcInSceneIdx >= 0 ? row[npcInSceneIdx] : '';\n        const inSceneHeader = npcHeaders[npcInSceneIdx] || '';\n        const isInScene = parseInSceneStatus(inSceneValue, inSceneHeader);\n\n        await addCharacter({\n          name: npcName,\n          location: locationName,\n          isPlayer: false,\n          isInScene,\n          tableKey: npcResult.key || '',\n          rowIndex: idx,\n        });\n      }\n    }\n\n    const locationIterator = locations.values();\n    const firstLocation = locationIterator.next().value;\n\n    const allRegions = [...new Set(Array.from(locations.values()).map(l => l.region || ''))].sort();\n    // \"\"\n    const otherIndex = allRegions.indexOf('');\n    if (otherIndex > -1) {\n      allRegions.splice(otherIndex, 1);\n      allRegions.push('');\n    }\n\n    const getHotLocationsInRegion = region => {\n      const regionName = region || '';\n      return Array.from(locations.values())\n        .filter(l => (l.region || '') === regionName)\n        .sort((a, b) => {\n          const scoreA = (characters.get(a.name)?.length || 0) + (elements.get(a.name)?.length || 0);\n          const scoreB = (characters.get(b.name)?.length || 0) + (elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n    };\n\n    const focusLocation = (() => {\n      if (detailLocation && locations.has(detailLocation)) return detailLocation;\n      if (playerLocation && locations.has(playerLocation)) return playerLocation;\n      const fallbackRegion = allRegions[0];\n      if (fallbackRegion) {\n        const regionLocations = getHotLocationsInRegion(fallbackRegion);\n        if (regionLocations.length > 0) return regionLocations[0].name;\n      }\n      return firstLocation ? firstLocation.name : '';\n    })();\n\n    return {\n      currentRegion: currentRegion || locations.get(playerLocation)?.region || '',\n      detailLocation,\n      focusLocation,\n      playerLocation,\n      locations,\n      elements,\n      characters,\n      allRegions,\n    };\n  };\n\n  // \n  let isMapOpening = false;\n\n  const showMapVisualization = async () => {\n    const { $ } = getCore();\n\n    // \n    if (isMapOpening) return;\n    isMapOpening = true;\n\n    // overlay\n    $('.acu-map-overlay').remove();\n\n    let viewModel = await buildMapViewModel();\n    if (!viewModel) {\n      isMapOpening = false;\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const config = getConfig();\n\n    // \n    const tabSelectionCache = new Map<string, string>();\n\n    // \n    const getHotLocationsInRegion = (region: string) => {\n      const regionName = region || '';\n      return Array.from(viewModel.locations.values())\n        .filter(l => (l.region || '') === regionName)\n        .sort((a, b) => {\n          const scoreA =\n            (viewModel.characters.get(a.name)?.length || 0) + (viewModel.elements.get(a.name)?.length || 0);\n          const scoreB =\n            (viewModel.characters.get(b.name)?.length || 0) + (viewModel.elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n    };\n\n    // \"\"\n    const detailLocation = viewModel.detailLocation || '';\n    const playerLocation = viewModel.playerLocation || '';\n    let focusLocation = '';\n    let selectedRegion = viewModel.currentRegion;\n\n    // :  >  > viewModel.focusLocation\n    if (detailLocation && viewModel.locations.has(detailLocation)) {\n      focusLocation = detailLocation;\n      const targetLocation = viewModel.locations.get(detailLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n      focusLocation = playerLocation;\n      const targetLocation = viewModel.locations.get(playerLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    } else if (viewModel.focusLocation && viewModel.locations.has(viewModel.focusLocation)) {\n      focusLocation = viewModel.focusLocation;\n      const targetLocation = viewModel.locations.get(focusLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    }\n\n    if (focusLocation) {\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      // \n      tabSelectionCache.set(selectedRegion, focusLocation);\n    }\n\n    const overlay = $(`\n            <div class=\"acu-map-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-map-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-map-title\">\n                            <i class=\"fa-solid fa-map-location-dot\"></i>\n                            <span class=\"acu-map-region-name\">${escapeHtml(viewModel.currentRegion || '')}</span>\n                        </div>\n                        <div class=\"acu-map-region-tabs\"></div>\n                        <div class=\"acu-map-actions\">\n                            <button class=\"acu-map-back-btn\" title=\"\"><i class=\"fa-solid fa-location-crosshairs\"></i></button>\n                            <button class=\"acu-close-btn acu-map-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-map-body\">\n                        <div class=\"acu-map-focus-area\"></div>\n                        <div class=\"acu-map-thumbnails\"></div>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const overlayEl = overlay[0];\n    overlayEl.style.setProperty('position', 'fixed', 'important');\n    overlayEl.style.setProperty('top', '0', 'important');\n    overlayEl.style.setProperty('left', '0', 'important');\n    overlayEl.style.setProperty('right', '0', 'important');\n    overlayEl.style.setProperty('bottom', '0', 'important');\n    overlayEl.style.setProperty('width', '100vw', 'important');\n    overlayEl.style.setProperty('height', '100vh', 'important');\n    overlayEl.style.setProperty('display', 'flex', 'important');\n    overlayEl.style.setProperty('justify-content', 'center', 'important');\n    overlayEl.style.setProperty('align-items', 'center', 'important');\n    overlayEl.style.setProperty('z-index', '31100', 'important');\n\n    // selectedRegion \n    const $focusArea = overlay.find('.acu-map-focus-area');\n    const $thumbnails = overlay.find('.acu-map-thumbnails');\n\n    const renderElementChip = element => {\n      const name = element.name || element.type || '';\n      const emoji = element.emoji ? `<span class=\"acu-map-chip-emoji\">${element.emoji}</span>` : '';\n      return `\n                 <div class=\"acu-map-element-chip acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n                   element.tableKey || '',\n                 )}\" data-row-index=\"${element.rowIndex}\">\n                     ${emoji}\n                     <span class=\"acu-map-chip-name\" title=\"${escapeHtml(name)}\">${escapeHtml(name)}</span>\n                 </div>\n             `;\n    };\n\n    const renderFocusArea = (model, locationName) => {\n      const location = model.locations.get(locationName);\n      if (!location) {\n        return '<div class=\"acu-map-loading\" style=\"grid-column: 1 / -1;\"><div class=\"acu-map-spinner\"></div></div>';\n      }\n\n      const characters = model.characters.get(locationName) || [];\n      const elements = model.elements.get(locationName) || [];\n\n      // \n      const leftChars = characters.slice(0, Math.ceil(characters.length / 2));\n      const rightChars = characters.slice(Math.ceil(characters.length / 2));\n      const leftElems = elements.slice(0, Math.ceil(elements.length / 2));\n      const rightElems = elements.slice(Math.ceil(elements.length / 2));\n\n      const renderAvatarHtml = char => {\n        const displayName = replaceUserPlaceholders(char.name);\n        const avatarStyle = char.avatarUrl\n          ? `background-image:url('${char.avatarUrl}');background-size:${char.avatarScale}%;background-position:${char.avatarOffsetX}% ${char.avatarOffsetY}%;`\n          : '';\n        return `\n            <div class=\"acu-map-avatar acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n              char.tableKey || '',\n            )}\" data-row-index=\"${char.rowIndex}\">\n                <div class=\"acu-map-avatar-circle\" style=\"${avatarStyle}\">\n                    ${char.avatarUrl ? '' : `<span>${escapeHtml(displayName.charAt(0))}</span>`}\n                </div>\n                <div class=\"acu-map-avatar-name\" title=\"${escapeHtml(displayName)}\">${escapeHtml(\n                  displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName,\n                )}</div>\n            </div>\n        `;\n      };\n\n      const leftAvatarsHtml = leftChars.length ? leftChars.map(renderAvatarHtml).join('') : '';\n      const rightAvatarsHtml = rightChars.length ? rightChars.map(renderAvatarHtml).join('') : '';\n      const leftElemsHtml = leftElems.length ? leftElems.map(e => renderElementChip(e)).join('') : '';\n      const rightElemsHtml = rightElems.length ? rightElems.map(e => renderElementChip(e)).join('') : '';\n\n      const emojiHtml = location.emoji\n        ? `<div class=\"acu-map-location-emoji\">${location.emoji}</div>`\n        : `<div class=\"acu-map-location-text\">${escapeHtml(location.name.charAt(0) || '')}</div>`;\n\n      return `\n        <div class=\"acu-map-wing left\">\n            <div class=\"acu-map-avatar-group acu-group-left\">${leftAvatarsHtml || ''}</div>\n            <div class=\"acu-map-element-group acu-group-left\">${leftElemsHtml || ''}</div>\n        </div>\n        <div class=\"acu-map-stage-center acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n          location.tableKey,\n        )}\" data-row-index=\"${location.rowIndex}\">\n            ${emojiHtml}\n            <div class=\"acu-map-location-name\" title=\"${escapeHtml(location.name)}\">${escapeHtml(location.name)}</div>\n        </div>\n        <div class=\"acu-map-wing right\">\n            <div class=\"acu-map-avatar-group acu-group-right\">${rightAvatarsHtml || ''}</div>\n            <div class=\"acu-map-element-group acu-group-right\">${rightElemsHtml || ''}</div>\n        </div>\n        <div class=\"acu-map-mobile-stack\">\n            <div class=\"acu-map-mobile-avatars\">${leftAvatarsHtml || ''}${rightAvatarsHtml || ''}</div>\n            <div class=\"acu-map-mobile-elements\">${leftElemsHtml || ''}${rightElemsHtml || ''}</div>\n        </div>\n    `;\n    };\n\n    const renderThumbnailLocation = (model, location, isActive) => {\n      const charCount = (model.characters.get(location.name) || []).length;\n      const elementCount = (model.elements.get(location.name) || []).length;\n      const totalCount = charCount + elementCount;\n      const emoji = location.emoji\n        ? `<div class=\"acu-map-thumbnail-emoji\">${location.emoji}</div>`\n        : `<div class=\"acu-map-thumbnail-placeholder\">${escapeHtml(location.name.charAt(0) || '')}</div>`;\n      const badgeHtml = totalCount > 0 ? `<div class=\"acu-map-thumbnail-badge\">${totalCount}</div>` : '';\n      return `\n        <div class=\"acu-map-thumbnail ${isActive ? 'active' : ''}\" data-location=\"${escapeHtml(location.name)}\">\n            ${badgeHtml}\n            ${emoji}\n            <div class=\"acu-map-thumbnail-name\" title=\"${escapeHtml(location.name)}\">${escapeHtml(\n              location.name.length > 6 ? location.name.substring(0, 6) + '..' : location.name,\n            )}</div>\n        </div>\n    `;\n    };\n\n    const renderRegionTabs = (regions, currentRegion) => {\n      if (regions.length <= 1) return '';\n      return regions\n        .map(\n          r =>\n            `<button class=\"acu-map-region-tab ${r === currentRegion ? 'active' : ''}\" data-region=\"${escapeHtml(\n              r,\n            )}\">${escapeHtml(r)}</button>`,\n        )\n        .join('');\n    };\n\n    const refreshPanel = () => {\n      $focusArea.html(renderFocusArea(viewModel, focusLocation));\n\n      const regionLocations = Array.from(viewModel.locations.values())\n        .filter(l => (l.region || '') === selectedRegion)\n        .sort((a, b) => {\n          // :  + \n          const scoreA =\n            (viewModel.characters.get(a.name)?.length || 0) + (viewModel.elements.get(a.name)?.length || 0);\n          const scoreB =\n            (viewModel.characters.get(b.name)?.length || 0) + (viewModel.elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n\n      const thumbnails = regionLocations\n        .map(location => renderThumbnailLocation(viewModel, location, location.name === focusLocation))\n        .join('');\n      $thumbnails.html(thumbnails || '<div class=\"acu-map-empty\"></div>');\n\n      overlay.find('.acu-map-region-name').text(selectedRegion || '');\n      overlay.find('.acu-map-region-tabs').html(renderRegionTabs(viewModel.allRegions, selectedRegion));\n    };\n\n    const setFocusLocation = name => {\n      if (!name) return;\n      focusLocation = name;\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      // \n      tabSelectionCache.set(selectedRegion, focusLocation);\n      refreshPanel();\n    };\n\n    refreshPanel();\n\n    // [] \n    overlay.data('refreshMapData', async () => {\n      const newViewModel = await buildMapViewModel();\n      if (newViewModel) {\n        viewModel = newViewModel;\n\n        // [] \n        if (!viewModel.locations.has(focusLocation)) {\n          // [] \n          const detailLocation = viewModel.detailLocation || '';\n          const playerLocation = viewModel.playerLocation || '';\n\n          let newFocus = '';\n          let newRegion = selectedRegion;\n\n          // 1: \n          const regionLocs = Array.from(viewModel.locations.values()).filter(\n            l => (l.region || '') === selectedRegion,\n          );\n          if (regionLocs.length > 0) {\n            newFocus = regionLocs[0].name;\n          } else if (detailLocation && viewModel.locations.has(detailLocation)) {\n            // 2: detailLocation\n            newFocus = detailLocation;\n            const loc = viewModel.locations.get(detailLocation);\n            newRegion = loc?.region || newRegion;\n          } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n            // 3: playerLocation\n            newFocus = playerLocation;\n            const loc = viewModel.locations.get(playerLocation);\n            newRegion = loc?.region || newRegion;\n          } else if (viewModel.focusLocation && viewModel.locations.has(viewModel.focusLocation)) {\n            // 4: focusLocation\n            newFocus = viewModel.focusLocation;\n            const loc = viewModel.locations.get(newFocus);\n            newRegion = loc?.region || newRegion;\n          } else {\n            // \n            const firstLoc = Array.from(viewModel.locations.values())[0];\n            if (firstLoc) {\n              newFocus = firstLoc.name;\n              newRegion = firstLoc.region || '';\n            }\n          }\n\n          if (newFocus) {\n            focusLocation = newFocus;\n            selectedRegion = newRegion;\n            // Store\n            Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n            // tab\n            tabSelectionCache.set(selectedRegion, focusLocation);\n          }\n        }\n\n        refreshPanel();\n      }\n    });\n\n    // [] \n    const $closeBtn = overlay.find('.acu-map-close');\n    $closeBtn.on('click', e => {\n      e.preventDefault();\n      e.stopPropagation();\n      e.stopImmediatePropagation();\n      overlay.remove();\n    });\n    overlay.on('click', '.acu-map-region-tab', function () {\n      const newRegion = $(this).data('region');\n      if (newRegion === selectedRegion) return;\n      selectedRegion = newRegion;\n\n      //  focusLocation \n      const regionLocations = Array.from(viewModel.locations.values()).filter(\n        l => (l.region || '') === selectedRegion,\n      );\n      const currentInNewRegion = regionLocations.find(l => l.name === focusLocation);\n\n      if (!currentInNewRegion && regionLocations.length > 0) {\n        // :  > \n        const cachedLocation = tabSelectionCache.get(selectedRegion);\n        const cachedInRegion = cachedLocation && regionLocations.find(l => l.name === cachedLocation);\n\n        if (cachedInRegion) {\n          // \n          focusLocation = cachedLocation;\n        } else {\n          // \n          const hotLocations = getHotLocationsInRegion(selectedRegion);\n          focusLocation = hotLocations.length > 0 ? hotLocations[0].name : regionLocations[0].name;\n        }\n        Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      }\n\n      refreshPanel();\n    });\n    setupOverlayClose(overlay, 'acu-map-overlay', () => {\n      overlay.remove();\n    });\n\n    overlay.on('click', '.acu-map-thumbnail', function () {\n      const locationName = $(this).data('location');\n      if (locationName) setFocusLocation(locationName);\n    });\n\n    overlay.on('click', '.acu-map-back-btn', () => {\n      const fallbackFocus = viewModel.focusLocation;\n      const detailLocation = viewModel.detailLocation || '';\n      const playerLocation = viewModel.playerLocation || '';\n\n      let target = '';\n      if (detailLocation && viewModel.locations.has(detailLocation)) {\n        target = detailLocation;\n      } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n        target = playerLocation;\n      } else if (fallbackFocus && viewModel.locations.has(fallbackFocus)) {\n        target = fallbackFocus;\n      }\n\n      if (!target) return;\n\n      // \n      const targetLocation = viewModel.locations.get(target);\n      const targetRegion = targetLocation?.region || viewModel.currentRegion || '';\n      if (targetRegion !== selectedRegion) {\n        selectedRegion = targetRegion;\n      }\n\n      focusLocation = target;\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      refreshPanel();\n    });\n\n    // \n    isMapOpening = false;\n\n    // \n    // \n  };\n\n  // \n  const showRelationshipGraph = npcTable => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n    $('.acu-relation-graph-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    const headers = npcTable.headers || [];\n    const rows = npcTable.rows || [];\n\n    const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n    const relationIdx = headers.findIndex(h => h && h.includes(''));\n    const npcTableKey = npcTable.key || '';\n\n    console.info(`[DICE]: \"${npcTableKey || ''}\"${rows.length}`);\n\n    if (relationIdx < 0) {\n      console.warn('[DICE]: \"\"');\n      if (window.toastr) window.toastr.warning('\"\"');\n      return;\n    }\n\n    const nodes = new Map();\n    const edges = [];\n\n    // {{user}}\n    const resolveUserPlaceholder = name => {\n      if (!name) return name;\n      const playerName = getPlayerName();\n      const personaName = getPersonaName();\n\n      // \n      const explicitUserVariants = ['<user>', '{{user}}'];\n      const isExplicitUserVariant = explicitUserVariants.some(\n        v => name === v || name.toLowerCase() === v.toLowerCase(),\n      );\n\n      // persona\n      const isPersonaName = personaName && name === personaName;\n\n      // \"\"\n      const isPlayerName = (() => {\n        if (!playerName) return false;\n        // \n        if (name === playerName) return true;\n        // \n        const primaryName = AvatarManager.getPrimaryName(name);\n        return primaryName === playerName;\n      })();\n\n      // {{user}}\n      if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n        return '{{user}}';\n      }\n\n      // \n      return AvatarManager.getPrimaryName(name);\n    };\n\n    const resolveName = name => resolveUserPlaceholder(name);\n\n    const rawData = cachedRawData || getTableData();\n    let playerName = '';\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]) {\n          playerName = sheet.content[1][1] || '';\n          break;\n        }\n      }\n    }\n    const resolvedPlayerName = resolveName(playerName);\n    const playerTableKey = (() => {\n      for (const k in rawData) {\n        if (rawData[k]?.name?.includes('')) return k;\n      }\n      return '';\n    })();\n    nodes.set(resolvedPlayerName, {\n      name: resolvedPlayerName,\n      isPlayer: true,\n      x: 0,\n      y: 0,\n      tableKey: playerTableKey,\n      rowIndex: 0,\n    });\n\n    // \"\"\n    const inSceneColIdx = headers.findIndex(h => h && h.includes(''));\n\n    rows.forEach((row, idx) => {\n      const rawNpcName = row[nameIdx];\n      if (!rawNpcName) return;\n\n      const npcName = resolveName(rawNpcName);\n\n      // \n      let isInScene = false;\n      if (inSceneColIdx > 0) {\n        const inSceneVal = String(row[inSceneColIdx] || '')\n          .trim()\n          .toLowerCase();\n        const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n        if (header.includes('')) {\n          isInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n        } else {\n          isInScene =\n            inSceneVal.startsWith('') || inSceneVal === 'true' || inSceneVal === '' || inSceneVal === 'yes';\n        }\n      }\n\n      if (!nodes.has(npcName)) {\n        nodes.set(npcName, {\n          name: npcName,\n          isPlayer: false,\n          x: 0,\n          y: 0,\n          tableKey: npcTableKey,\n          rowIndex: idx,\n          isInScene: isInScene,\n        });\n      }\n\n      const relationStr = row[relationIdx] || '';\n      const relations = parseRelationshipString(relationStr);\n\n      relations.forEach(rel => {\n        if (!rel.name) return;\n        const resolvedRelName = resolveName(rel.name);\n\n        if (resolvedRelName === npcName) return;\n\n        if (!nodes.has(resolvedRelName)) {\n          // NPC\n          let relRowIndex = -1;\n          let relIsInScene = false;\n          for (let ri = 0; ri < rows.length; ri++) {\n            if (resolveName(rows[ri][nameIdx]) === resolvedRelName) {\n              relRowIndex = ri;\n              // \n              if (inSceneColIdx > 0) {\n                const inSceneVal = String(rows[ri][inSceneColIdx] || '')\n                  .trim()\n                  .toLowerCase();\n                const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n                if (header.includes('')) {\n                  relIsInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n                } else {\n                  relIsInScene =\n                    inSceneVal.startsWith('') ||\n                    inSceneVal === 'true' ||\n                    inSceneVal === '' ||\n                    inSceneVal === 'yes';\n                }\n              }\n              break;\n            }\n          }\n          nodes.set(resolvedRelName, {\n            name: resolvedRelName,\n            isPlayer: resolvedRelName === resolvedPlayerName,\n            x: 0,\n            y: 0,\n            tableKey: relRowIndex >= 0 ? npcTableKey : '',\n            rowIndex: relRowIndex >= 0 ? relRowIndex : undefined,\n            isInScene: relIsInScene,\n          });\n        }\n\n        // /\n        const cleanRelation = rawRel => {\n          if (!rawRel) return [];\n          const parts = String(rawRel)\n            .split(/[,;\\/\\|]+|\\s*[&]\\s*|\\s{2,}|\\n/)\n            .map(s => s.trim())\n            .filter(s => s && s.length < 30); // \n\n          // \n          const commonRelations = [\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n          ];\n\n          return parts\n            .map(p => {\n              // [] \n              p = p.replace(/[(][^)]*[)]/g, '').trim();\n              // === XX/  XX ===\n              const specialSuffixMatch = p.match(/^(.+)(|)$/);\n              if (specialSuffixMatch) {\n                p = specialSuffixMatch[1]; // \"\"  \"\"\n              } else {\n                // === XXYY  YY ===\n                p = p.replace(/^[\\u4e00-\\u9fa5]{2,4}(?=[\\u4e00-\\u9fa5]{1,4}$)/, '');\n              }\n\n              // ===  ===\n              p = p.replace(/^(?:|||?|?|)/, '');\n              p = p.replace(/^(?:?|?|?|)/, '');\n              p = p.replace(/^(?:|?|?)/, '');\n\n              // ===  ===\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n\n              // ===  ===\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^(?:||?)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n\n              p = p.trim();\n\n              // === []  ===\n              if (p.length > 8) {\n                // \n                for (const rel of commonRelations) {\n                  if (p.endsWith(rel)) {\n                    return rel;\n                  }\n                }\n                // 2-4\n                const lastChars = p.slice(-4);\n                for (const rel of commonRelations) {\n                  if (lastChars.includes(rel)) {\n                    return rel;\n                  }\n                }\n                // 3\n                return p.slice(-3);\n              }\n\n              return p;\n            })\n            .filter(s => s && s.length > 0 && s.length <= 8);\n        };\n\n        const cleanedLabels = cleanRelation(rel.relation);\n        if (cleanedLabels.length === 0) cleanedLabels.push('');\n\n        // \n        let existingEdge = edges.find(\n          e =>\n            (e.source === npcName && e.target === resolvedRelName) ||\n            (e.source === resolvedRelName && e.target === npcName),\n        );\n\n        if (!existingEdge) {\n          // \n          edges.push({\n            source: npcName,\n            target: resolvedRelName,\n            // \n            labelsFromSource: cleanedLabels.slice(0, 2), // sourcetarget 2\n            labelsFromTarget: [], // targetsource \n          });\n        } else {\n          // \n          if (existingEdge.source === npcName) {\n            // npcsource labelsFromSource\n            const combined = [...(existingEdge.labelsFromSource || []), ...cleanedLabels];\n            // 2\n            existingEdge.labelsFromSource = [...new Set(combined)].slice(0, 2);\n          } else {\n            // npctarget labelsFromTarget\n            const combined = [...(existingEdge.labelsFromTarget || []), ...cleanedLabels];\n            existingEdge.labelsFromTarget = [...new Set(combined)].slice(0, 2);\n          }\n        }\n      });\n    });\n\n    const nodeArr = Array.from(nodes.values());\n    console.info(`[DICE]${nodeArr.length}${edges.length}`);\n    const centerX = 400,\n      centerY = 300;\n\n    // [] \n    const connectionCount = new Map();\n    nodeArr.forEach(node => connectionCount.set(node.name, 0));\n    edges.forEach(edge => {\n      connectionCount.set(edge.source, (connectionCount.get(edge.source) || 0) + 1);\n      connectionCount.set(edge.target, (connectionCount.get(edge.target) || 0) + 1);\n    });\n\n    // [] \n    const isMobileView = window.innerWidth <= 768;\n    const baseRadius = isMobileView ? 22 : 28;\n    const maxRadius = isMobileView ? 38 : 50;\n    const playerBaseRadius = isMobileView ? 28 : 35;\n    const radiusPerConnection = isMobileView ? 2.5 : 3.5;\n\n    //  getNodeRadius \n    let nodeSizeMultiplier = 1.0; // 1.0\n    let filterInScene = false; // +\n    let filterDirectOnly = false; // \n\n    const getNodeRadius = (nodeName, isPlayer) => {\n      const base = isPlayer ? playerBaseRadius : baseRadius;\n      const count = connectionCount.get(nodeName) || 0;\n      const calculated = Math.min(maxRadius, base + Math.sqrt(count) * radiusPerConnection);\n      // \n      return calculated * nodeSizeMultiplier;\n    };\n\n    // \n    nodeArr.forEach(node => {\n      node.radius = getNodeRadius(node.name, node.isPlayer);\n    });\n\n    // \n    const getFilteredNodes = () => {\n      // \n      if (!filterInScene && !filterDirectOnly) return nodeArr;\n\n      // \n      let directNodes: Set<string> | null = null;\n      if (filterDirectOnly) {\n        directNodes = new Set([resolvedPlayerName]);\n        edges.forEach(edge => {\n          if (edge.source === resolvedPlayerName) directNodes!.add(edge.target);\n          if (edge.target === resolvedPlayerName) directNodes!.add(edge.source);\n        });\n      }\n\n      return nodeArr.filter(n => {\n        // \n        const passInScene = !filterInScene || n.isInScene || n.isPlayer;\n        // \n        const passDirectOnly = !filterDirectOnly || directNodes!.has(n.name);\n        // \n        return passInScene && passDirectOnly;\n      });\n    };\n\n    // [Modified] \n    // ---------------------------------------------------------\n    //  ()\n    const kRepulsion = 20000; //  () - \n    const kSpring = 0.02; //  () - \n    const kGravity = 0.01; //  - \n    const idealLen = 250; //  - \n    const iterations = 300; // \n    const timeStep = 0.5; // \n    const damping = 0.8; //  ()\n\n    // \n    const LAYOUT_CACHE_KEY = 'acu-relation-graph-layout-cache';\n\n    // \n    const getLayoutCacheKey = () => {\n      const nodeNames = nodeArr\n        .map(n => n.name)\n        .sort()\n        .join('|');\n      return `${LAYOUT_CACHE_KEY}-${nodeNames}`;\n    };\n\n    // \n    const saveLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const layoutData = {};\n        nodeArr.forEach(node => {\n          layoutData[node.name] = { x: node.x, y: node.y };\n        });\n        localStorage.setItem(cacheKey, JSON.stringify(layoutData));\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const loadLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const cached = localStorage.getItem(cacheKey);\n        if (!cached) return false;\n\n        const layoutData = JSON.parse(cached);\n        let allNodesFound = true;\n\n        // \n        for (const node of nodeArr) {\n          if (!layoutData[node.name]) {\n            allNodesFound = false;\n            break;\n          }\n        }\n\n        if (allNodesFound) {\n          // \n          nodeArr.forEach(node => {\n            const cached = layoutData[node.name];\n            if (cached) {\n              node.x = cached.x;\n              node.y = cached.y;\n              node.vx = 0;\n              node.vy = 0;\n            }\n          });\n          return true;\n        }\n        return false;\n      } catch (e) {\n        console.warn('[DICE] :', e);\n        return false;\n      }\n    };\n\n    // \n    const clearLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        localStorage.removeItem(cacheKey);\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const runForceDirectedLayout = () => {\n      // \n      nodeArr.forEach(node => {\n        if (node.isPlayer) {\n          node.x = centerX;\n          node.y = centerY;\n          node.vx = 0;\n          node.vy = 0;\n        } else {\n          //  100px \n          const angle = Math.random() * 2 * Math.PI;\n          const dist = 50 + Math.random() * 100;\n          node.x = centerX + Math.cos(angle) * dist;\n          node.y = centerY + Math.sin(angle) * dist;\n          node.vx = 0;\n          node.vy = 0;\n        }\n      });\n\n      //  O(1) \n      const nodeMap = new Map();\n      nodeArr.forEach(n => nodeMap.set(n.name, n));\n\n      //  ()\n      for (let iter = 0; iter < iterations; iter++) {\n        // 1.  ( vs )\n        for (let i = 0; i < nodeArr.length; i++) {\n          const u = nodeArr[i];\n          for (let j = i + 1; j < nodeArr.length; j++) {\n            const v = nodeArr[j];\n            const dx = v.x - u.x;\n            const dy = v.y - u.y;\n            let distSq = dx * dx + dy * dy;\n            if (distSq < 1) distSq = 1; // \n\n            const dist = Math.sqrt(distSq);\n            const force = kRepulsion / distSq;\n\n            const fx = (dx / dist) * force;\n            const fy = (dy / dist) * force;\n\n            if (!u.isPlayer) {\n              u.vx -= fx;\n              u.vy -= fy;\n            }\n            if (!v.isPlayer) {\n              v.vx += fx;\n              v.vy += fy;\n            }\n          }\n        }\n\n        // 2.  ()\n        edges.forEach(edge => {\n          const u = nodeMap.get(edge.source);\n          const v = nodeMap.get(edge.target);\n          if (!u || !v) return;\n\n          const dx = v.x - u.x;\n          const dy = v.y - u.y;\n          const dist = Math.sqrt(dx * dx + dy * dy) || 1;\n\n          // : F = k * ( - )\n          const force = (dist - idealLen) * kSpring;\n\n          const fx = (dx / dist) * force;\n          const fy = (dy / dist) * force;\n\n          if (!u.isPlayer) {\n            u.vx += fx;\n            u.vy += fy;\n          }\n          if (!v.isPlayer) {\n            v.vx -= fx;\n            v.vy -= fy;\n          }\n        });\n\n        // 3.  ()\n        nodeArr.forEach(node => {\n          if (node.isPlayer) return;\n          const dx = centerX - node.x;\n          const dy = centerY - node.y;\n          node.vx += dx * kGravity;\n          node.vy += dy * kGravity;\n        });\n\n        // 4. \n        // \n        const maxSpeed = 50 * (1 - iter / iterations); // \n\n        nodeArr.forEach(node => {\n          if (node.isPlayer) return; //  ()\n\n          // \n          node.vx *= damping;\n          node.vy *= damping;\n\n          // \n          const vMag = Math.sqrt(node.vx * node.vx + node.vy * node.vy);\n          if (vMag > maxSpeed) {\n            node.vx = (node.vx / vMag) * maxSpeed;\n            node.vy = (node.vy / vMag) * maxSpeed;\n          }\n\n          node.x += node.vx * timeStep;\n          node.y += node.vy * timeStep;\n        });\n      }\n\n      // \n      saveLayoutCache();\n    };\n\n    // \n    if (!loadLayoutCache()) {\n      // \n      runForceDirectedLayout();\n    }\n\n    // \n    let scale = 1;\n    let panX = 0;\n    let panY = 0;\n    const minScale = 0.3;\n    const maxScale = 4;\n\n    const overlay = $(`\n            <div class=\"acu-relation-graph-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-relation-graph-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-graph-title\">\n                            <i class=\"fa-solid fa-project-diagram\"></i>\n                            <button class=\"acu-graph-btn acu-filter-toggle\" id=\"filter-in-scene\" title=\"\" style=\"margin-left:8px;padding:4px 6px;font-size:12px;\"><i class=\"fa-solid fa-map-marker-alt\"></i></button>\n                            <button class=\"acu-graph-btn acu-filter-toggle\" id=\"filter-direct-only\" title=\"\" style=\"padding:4px 6px;font-size:12px;\"><i class=\"fa-solid fa-link\"></i></button>\n                        </div>\n                        <div class=\"acu-graph-actions\">\n                            <button class=\"acu-graph-btn\" id=\"graph-relayout\" title=\"\"><i class=\"fa-solid fa-sync\"></i></button>\n                            <button class=\"acu-graph-btn\" id=\"graph-manage-avatar\" title=\"\"><i class=\"fa-solid fa-user-circle\"></i></button>\n                            <button class=\"acu-graph-btn acu-graph-close\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-canvas-wrapper\">\n                        <svg class=\"acu-graph-svg\" viewBox=\"0 0 800 600\">\n                            <defs>\n                                <marker id=\"arrowhead-end\" markerWidth=\"6\" markerHeight=\"5\" refX=\"5\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 6 2.5, 0 5\" fill=\"${t.textSub}\" />\n                                </marker>\n                                <marker id=\"arrowhead-start\" markerWidth=\"6\" markerHeight=\"5\" refX=\"1\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"6 0, 0 2.5, 6 5\" fill=\"${t.textSub}\" />\n                                </marker>\n                                <marker id=\"arrowhead-end-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"6\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 7 3, 0 6\" fill=\"${t.accent}\" />\n                                </marker>\n                                <marker id=\"arrowhead-start-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"1\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"7 0, 0 3, 7 6\" fill=\"${t.accent}\" />\n                                </marker>\n                            </defs>\n                            <g class=\"acu-graph-transform\">\n                                <g class=\"acu-graph-edges\"></g>\n                                <g class=\"acu-graph-nodes\"></g>\n                            </g>\n                        </svg>\n                        <div class=\"acu-node-size-slider-container\" style=\"\n                            position: absolute;\n                            display: none;\n                            width: 200px;\n                            padding: 10px;\n                            background: ${t.bgPanel};\n                            border: 1px solid ${t.border};\n                            border-radius: 8px;\n                            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n                            z-index: 10;\n                        \">\n                            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:6px;\">\n                                <span style=\"font-size:11px;color:${t.textSub};white-space:nowrap;\"></span>\n                                <span id=\"slider-size-display\" style=\"font-size:11px;color:${t.accent};font-weight:bold;min-width:35px;text-align:right;\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                            </div>\n                            <input type=\"range\" id=\"node-size-slider\" min=\"0.5\" max=\"2.0\" step=\"0.1\" value=\"${nodeSizeMultiplier}\" style=\"\n                                width: 100%;\n                                height: 8px;\n                                border-radius: 4px;\n                                background: ${t.btnBg};\n                                outline: none;\n                                cursor: pointer;\n                                -webkit-appearance: none;\n                            \" />\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-legend\">\n                        <button class=\"acu-graph-btn\" id=\"graph-zoom-reset\" title=\"\" style=\"width:auto;height:auto;padding:4px 10px;font-size:11px;display:flex;align-items:center;gap:4px;\"><i class=\"fa-solid fa-compress-arrows-alt\"></i><span></span></button>\n                        <div class=\"acu-node-size-stepper-wrapper\" style=\"display:flex;align-items:center;justify-content:center;gap:6px;\">\n                            <span style=\"font-size:11px;color:var(--acu-text-sub);white-space:nowrap;\">:</span>\n                            <div class=\"acu-stepper\" data-id=\"graph-node-size\" data-min=\"50\" data-max=\"200\" data-step=\"10\" style=\"display:flex;align-items:center;\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\" id=\"node-size-display\" style=\"display:flex;align-items:center;justify-content:center;\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <span class=\"acu-zoom-display\" style=\"display:flex;align-items:center;gap:4px;color:var(--acu-text-sub);font-size:11px;\">\n                            <span>:</span>\n                            <span>${Math.round(scale * 100)}%</span>\n                        </span>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const $svg = overlay.find('.acu-graph-svg');\n    const $transform = overlay.find('.acu-graph-transform');\n    const $edgesGroup = overlay.find('.acu-graph-edges');\n    const $nodesGroup = overlay.find('.acu-graph-nodes');\n    const $zoomDisplay = overlay.find('.acu-zoom-display span:last-child');\n    const $nodeSizeDisplay = overlay.find('#node-size-display');\n    const $wrapper = overlay.find('.acu-graph-canvas-wrapper');\n\n    const updateTransform = () => {\n      $transform.attr('transform', `translate(${panX}, ${panY}) scale(${scale})`);\n      $zoomDisplay.text(`${Math.round(scale * 100)}%`);\n    };\n\n    const updateNodeSizeDisplay = () => {\n      if ($nodeSizeDisplay.length) {\n        $nodeSizeDisplay.text(`${Math.round(nodeSizeMultiplier * 100)}%`);\n      }\n    };\n\n    const zoomTo = (newScale, centerX = 400, centerY = 300) => {\n      const oldScale = scale;\n      scale = Math.max(minScale, Math.min(maxScale, newScale));\n      const scaleChange = scale / oldScale;\n      panX = centerX - (centerX - panX) * scaleChange;\n      panY = centerY - (centerY - panY) * scaleChange;\n      updateTransform();\n    };\n\n    const render = async () => {\n      // \n      const filteredNodes = getFilteredNodes();\n      const filteredNodeNames = new Set(filteredNodes.map(n => n.name));\n\n      // \n      const filteredEdges = edges.filter(\n        edge => filteredNodeNames.has(edge.source) && filteredNodeNames.has(edge.target),\n      );\n\n      let edgesHtml = '';\n      filteredEdges.forEach((edge, edgeIdx) => {\n        const source = nodes.get(edge.source);\n        const target = nodes.get(edge.target);\n        if (!source || !target) return;\n\n        // \n        const dx = target.x - source.x;\n        const dy = target.y - source.y;\n        const len = Math.sqrt(dx * dx + dy * dy) || 1;\n        const nx = dx / len; // \n        const ny = dy / len;\n\n        // \n        const px = -ny;\n        const py = nx;\n\n        // \n        const hasFromSource =\n          edge.labelsFromSource && edge.labelsFromSource.length > 0 && edge.labelsFromSource.some(l => l);\n        const hasFromTarget =\n          edge.labelsFromTarget && edge.labelsFromTarget.length > 0 && edge.labelsFromTarget.some(l => l);\n\n        // \n        const sourceRadius = source.radius || 28;\n        const targetRadius = target.radius || 28;\n        const arrowGap = 10; // \n        const x1 = source.x + nx * (sourceRadius + arrowGap);\n        const y1 = source.y + ny * (sourceRadius + arrowGap);\n        const x2 = target.x - nx * (targetRadius + arrowGap);\n        const y2 = target.y - ny * (targetRadius + arrowGap);\n\n        // \n        let srcLabels = (edge.labelsFromSource || []).filter(l => l);\n        let tgtLabels = (edge.labelsFromTarget || []).filter(l => l);\n\n        // \n        const srcSet = new Set(srcLabels);\n        const tgtSet = new Set(tgtLabels);\n        const commonLabels = [...srcSet].filter(l => tgtSet.has(l));\n\n        // \n        const srcUnique = srcLabels.filter(l => !commonLabels.includes(l));\n        const tgtUnique = tgtLabels.filter(l => !commonLabels.includes(l));\n\n        // \n        let markerStart = '';\n        let markerEnd = '';\n        if (hasFromSource) markerEnd = 'url(#arrowhead-end)';\n        if (hasFromTarget) markerStart = 'url(#arrowhead-start)';\n\n        edgesHtml += `<line class=\"acu-graph-edge\" x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                    ${markerEnd ? `marker-end=\"${markerEnd}\"` : ''}\n                    ${markerStart ? `marker-start=\"${markerStart}\"` : ''}\n                    data-edge-idx=\"${edgeIdx}\" />`;\n\n        // \n        const midX = (source.x + target.x) / 2;\n        const midY = (source.y + target.y) / 2;\n\n        // \n        const lineLen = Math.sqrt(dx * dx + dy * dy);\n\n        // \"\"\n        const isBidirectional = hasFromSource && hasFromTarget;\n        const isBidirectionalSame =\n          isBidirectional && commonLabels.length > 0 && srcUnique.length === 0 && tgtUnique.length === 0;\n\n        // \n        if (isBidirectionalSame) {\n          // \n          commonLabels.slice(0, 2).forEach((lbl, i) => {\n            if (!lbl) return;\n            const offsetDir = i === 0 ? 1 : -1;\n            const offsetDist = 6 + i * 10;\n            const lx = midX + px * offsetDir * offsetDist;\n            const ly = midY + py * offsetDir * offsetDist;\n            edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(lbl)}</text>`;\n          });\n        } else {\n          // \n          // source/target\n          // 25%\n          const safeOffset = Math.max(30, Math.min(lineLen * 0.25, 60));\n\n          // Emoji\n          const relationEmojiMap = [\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', ''] },\n          ];\n\n          // Emoji\n          const addRelationEmoji = lbl => {\n            if (!lbl) return '';\n            for (const group of relationEmojiMap) {\n              for (const kw of group.keywords) {\n                if (lbl.includes(kw)) {\n                  return lbl + group.emoji;\n                }\n              }\n            }\n            return lbl;\n          };\n\n          // emoji\n          const truncateLabel = (lbl, maxLen = 4) => {\n            if (!lbl) return '';\n            const truncated = lbl.length > maxLen ? lbl.substring(0, maxLen) + '..' : lbl;\n            return addRelationEmoji(truncated);\n          };\n\n          // 1. \n          if (commonLabels.length > 0) {\n            commonLabels.slice(0, 1).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const lx = midX + px * 8;\n              const ly = midY + py * 8 - 3;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n\n          // 2. Sourcesource\n          if (srcUnique.length > 0 || (hasFromSource && !hasFromTarget && commonLabels.length === 0)) {\n            const labelsToShow = srcUnique.length > 0 ? srcUnique : srcLabels;\n            // source\n            const labelBaseX = midX - nx * safeOffset;\n            const labelBaseY = midY - ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? 1 : -1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n\n          // 3. Targettarget\n          if (tgtUnique.length > 0 || (hasFromTarget && !hasFromSource && commonLabels.length === 0)) {\n            const labelsToShow = tgtUnique.length > 0 ? tgtUnique : tgtLabels;\n            // target\n            const labelBaseX = midX + nx * safeOffset;\n            const labelBaseY = midY + ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? -1 : 1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n        }\n      });\n      $edgesGroup.html(edgesHtml);\n\n      // [] \n      let nodesHtml = '';\n      for (const node of filteredNodes) {\n        //  > URL > ST\n        const nodeAvatar = await AvatarManager.getAsync(node.name);\n        const isPlayer = node.isPlayer;\n\n        // Discord\n        const indicatorRadius = node.radius * 0.22;\n        const indicatorOffset = node.radius * 0.62;\n        const inSceneIndicator = node.isInScene\n          ? `<circle class=\"acu-node-inscene-indicator\" cx=\"${indicatorOffset}\" cy=\"${indicatorOffset}\" r=\"${indicatorRadius}\" style=\"fill:var(--acu-accent);stroke:var(--acu-bg-panel);stroke-width:3;\" />`\n          : '';\n\n        const nodeDisplayName = replaceUserPlaceholders(node.name);\n        nodesHtml += `\n                <g class=\"acu-graph-node acu-dash-preview-trigger\" data-name=\"${escapeHtml(node.name)}\" data-table-key=\"${node.tableKey || ''}\" data-row-index=\"${node.rowIndex !== undefined ? node.rowIndex : ''}\" transform=\"translate(${node.x}, ${node.y})\">\n                    <circle class=\"acu-node-bg\" r=\"${node.radius}\" />\n                    ${\n                      nodeAvatar\n                        ? (() => {\n                            const offsetX = AvatarManager.getOffsetX(node.name);\n                            const offsetY = AvatarManager.getOffsetY(node.name);\n                            const scaleVal = AvatarManager.getScale(node.name);\n                            const size = (node.radius - 2) * 2;\n                            const shadowWidth = 4; // box-shadow\n                            const foSize = size + shadowWidth * 2;\n                            const foOffset = foSize / 2;\n                            return `<foreignObject x=\"${-foOffset}\" y=\"${-foOffset}\" width=\"${foSize}\" height=\"${foSize}\">\n                            <div class=\"acu-node-avatar\" xmlns=\"http://www.w3.org/1999/xhtml\" style=\"\n                                width: ${size}px;\n                                height: ${size}px;\n                                margin: ${shadowWidth}px;\n                                border-radius: 50%;\n                                background-image: url('${nodeAvatar}');\n                                background-size: ${scaleVal}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                                background-repeat: no-repeat;\n                            \"></div>\n                        </foreignObject>`;\n                          })()\n                        : `<text class=\"acu-node-char\" dy=\"0.35em\">${escapeHtml(nodeDisplayName.charAt(0))}</text>`\n                    }\n                    ${inSceneIndicator}\n                    <text class=\"acu-node-label\" dy=\"${node.radius + 14}\">${escapeHtml(nodeDisplayName)}</text>\n                </g>\n            `;\n      }\n      $nodesGroup.html(nodesHtml);\n    };\n\n    // [] \n    const highlightNode = nodeName => {\n      $svg.addClass('highlighting');\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if ($(this).data('name') === nodeName) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedNodes = new Set([nodeName]);\n\n      // \n      edges.forEach(edge => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          const otherNode = edge.source === nodeName ? edge.target : edge.source;\n          connectedNodes.add(otherNode);\n        }\n      });\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if (connectedNodes.has($(this).data('name'))) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedEdgeIndices = new Set();\n      edges.forEach((edge, idx) => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          connectedEdgeIndices.add(idx);\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n          if ($(this).attr('marker-end')) {\n            $(this).attr('marker-end', 'url(#arrowhead-end-hl)');\n          }\n          if ($(this).attr('marker-start')) {\n            $(this).attr('marker-start', 'url(#arrowhead-start-hl)');\n          }\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge-label').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n        }\n      });\n    };\n\n    const clearHighlight = () => {\n      $svg.removeClass('highlighting');\n      $nodesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        if ($(this).attr('marker-end')) {\n          $(this).attr('marker-end', 'url(#arrowhead-end)');\n        }\n        if ($(this).attr('marker-start')) {\n          $(this).attr('marker-start', 'url(#arrowhead-start)');\n        }\n      });\n    };\n\n    // []  - PC +  + \n    // pointerfine()coarse()\n    const hasFinePointer = window.matchMedia('(pointer: fine)').matches;\n    const isTouchDevice = !hasFinePointer;\n\n    // \n    let currentHighlightedNode = null; // \n    let longPressTimer = null;\n\n    if (isTouchDevice) {\n      // ==========  ==========\n      let currentHighlightedNode = null;\n\n      $nodesGroup.on('pointerdown', '.acu-graph-node', function (e) {\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        const startX = e.clientX;\n        const startY = e.clientY;\n        const startTime = Date.now();\n        let hasMoved = false;\n        let longPressTriggered = false;\n\n        // \n        if (currentHighlightedNode) {\n          clearHighlight();\n          currentHighlightedNode = null;\n          // return\n          e.preventDefault();\n          e.stopPropagation();\n          return;\n        }\n\n        // \n        const longPressTimer = setTimeout(() => {\n          if (!hasMoved && nodeName) {\n            longPressTriggered = true;\n            currentHighlightedNode = nodeName;\n            highlightNode(nodeName);\n            if (navigator.vibrate) navigator.vibrate(30);\n          }\n        }, 300);\n\n        const onMove = moveE => {\n          const dx = Math.abs(moveE.clientX - startX);\n          const dy = Math.abs(moveE.clientY - startY);\n          if (dx > 8 || dy > 8) {\n            hasMoved = true;\n            clearTimeout(longPressTimer);\n          }\n        };\n\n        const onUp = () => {\n          $(document).off('pointermove.mobilenode pointerup.mobilenode pointercancel.mobilenode');\n          clearTimeout(longPressTimer);\n\n          const elapsed = Date.now() - startTime;\n\n          //   \n          if (longPressTriggered) {\n            return;\n          }\n\n          //   \n          if (hasMoved) {\n            return;\n          }\n\n          // <300ms  \n          if (elapsed < 300) {\n            const nodeName = $node.data('name');\n            // \n            const primaryName = AvatarManager.getPrimaryName(nodeName);\n            const tableKey = $node.data('table-key');\n            let rowIndex = $node.data('row-index');\n\n            // tableKey\n            if (!tableKey || rowIndex === '' || rowIndex === undefined) {\n              // NPC\n              const rawData = cachedRawData || getTableData();\n              if (rawData) {\n                for (const key in rawData) {\n                  const table = rawData[key];\n                  if (!table?.content || !table.name?.includes('NPC')) continue;\n                  const headers = table.content[0] || [];\n                  const nameIdx = headers.findIndex(\n                    h => h && (h.includes('') || h.includes('') || h.includes('')),\n                  );\n                  if (nameIdx < 0) continue;\n                  for (let i = 1; i < table.content.length; i++) {\n                    const rowName = String(table.content[i][nameIdx] || '').trim();\n                    if (rowName === primaryName || AvatarManager.getPrimaryName(rowName) === primaryName) {\n                      // \n                      const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n                        .data('table-key', key)\n                        .data('row-index', i - 1);\n                      $('body').append(tempNode);\n                      tempNode.trigger('click.acu_dash_preview');\n                      tempNode.remove();\n                      return;\n                    }\n                  }\n                }\n              }\n              // \n              if (window.toastr) {\n                window.toastr.info(`${primaryName}`, '', { timeOut: 2000 });\n              }\n              return;\n            }\n\n            // tableKey\n            const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n              .data('table-key', tableKey)\n              .data('row-index', parseInt(rowIndex, 10));\n            $('body').append(tempNode);\n            tempNode.trigger('click.acu_dash_preview');\n            tempNode.remove();\n          }\n        };\n\n        $(document).on('pointermove.mobilenode', onMove);\n        $(document).on('pointerup.mobilenode pointercancel.mobilenode', onUp);\n      });\n\n      // \n      $wrapper.on('pointerup.mobileclear', function (e) {\n        if (currentHighlightedNode && !$(e.target).closest('.acu-graph-node').length) {\n          clearHighlight();\n          currentHighlightedNode = null;\n        }\n      });\n    } else {\n      // ========== PC ==========\n\n      $nodesGroup.on('pointerenter.pchover', '.acu-graph-node', function () {\n        const nodeName = $(this).data('name');\n        if (nodeName) {\n          highlightNode(nodeName);\n        }\n      });\n\n      $nodesGroup.on('pointerleave.pchover', '.acu-graph-node', function () {\n        clearHighlight();\n      });\n\n      // PC\n      $nodesGroup.on('click.pcclick', '.acu-graph-node', function (e) {\n        e.stopPropagation();\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        // \n        const primaryName = AvatarManager.getPrimaryName(nodeName);\n        const tableKey = $node.data('table-key');\n        let rowIndex = $node.data('row-index');\n\n        // tableKey\n        if (!tableKey || rowIndex === '' || rowIndex === undefined) {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            for (const key in rawData) {\n              const table = rawData[key];\n              if (!table?.content || !table.name?.includes('NPC')) continue;\n              const headers = table.content[0] || [];\n              const nameIdx = headers.findIndex(\n                h => h && (h.includes('') || h.includes('') || h.includes('')),\n              );\n              if (nameIdx < 0) continue;\n              for (let i = 1; i < table.content.length; i++) {\n                const rowName = String(table.content[i][nameIdx] || '').trim();\n                if (rowName === primaryName || AvatarManager.getPrimaryName(rowName) === primaryName) {\n                  const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n                    .data('table-key', key)\n                    .data('row-index', i - 1);\n                  $('body').append(tempNode);\n                  tempNode.trigger('click.acu_dash_preview');\n                  tempNode.remove();\n                  return;\n                }\n              }\n            }\n          }\n          if (window.toastr) {\n            window.toastr.info(`${primaryName}`, '', { timeOut: 2000 });\n          }\n          return;\n        }\n\n        // tableKey\n        const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n          .data('table-key', tableKey)\n          .data('row-index', parseInt(rowIndex, 10));\n        $('body').append(tempNode);\n        tempNode.trigger('click.acu_dash_preview');\n        tempNode.remove();\n      });\n    }\n\n    // \n    render().then(() => {\n      updateTransform();\n    });\n\n    //  -  Pointer Events API\n    let isPanning = false;\n    let panStartX = 0,\n      panStartY = 0;\n    let panStartPanX = 0,\n      panStartPanY = 0;\n    let lastPinchDist = 0;\n    let activePointerId = null;\n\n    const wrapperEl = $wrapper[0];\n    const svgEl = $svg[0];\n\n    // Pointer Down - \n    wrapperEl.onpointerdown = function (e) {\n      if (e.button !== 0) return;\n      // [] \n      if ($(e.target).closest('.acu-graph-node').length) return;\n      // [] \n      if ($(e.target).closest('.acu-node-size-slider-container').length) return;\n      e.preventDefault();\n      wrapperEl.setPointerCapture(e.pointerId);\n      activePointerId = e.pointerId;\n      isPanning = true;\n      panStartX = e.clientX;\n      panStartY = e.clientY;\n      panStartPanX = panX;\n      panStartPanY = panY;\n      svgEl.style.cursor = 'grabbing';\n    };\n\n    // Pointer Move - \n    wrapperEl.onpointermove = function (e) {\n      if (!isPanning || e.pointerId !== activePointerId) return;\n      const dx = e.clientX - panStartX;\n      const dy = e.clientY - panStartY;\n      const rect = svgEl.getBoundingClientRect();\n      panX = panStartPanX + (dx / rect.width) * 800;\n      panY = panStartPanY + (dy / rect.height) * 600;\n      updateTransform();\n    };\n\n    // Pointer Up - \n    wrapperEl.onpointerup = function (e) {\n      if (e.pointerId === activePointerId) {\n        wrapperEl.releasePointerCapture(e.pointerId);\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // Pointer Cancel - \n    wrapperEl.onpointercancel = function (e) {\n      if (e.pointerId === activePointerId) {\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // \n    wrapperEl.onwheel = function (e) {\n      e.preventDefault();\n      const delta = e.deltaY > 0 ? -0.15 : 0.15;\n      zoomTo(scale + delta);\n    };\n\n    // \n    wrapperEl.addEventListener(\n      'touchstart',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          isPanning = false;\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener(\n      'touchmove',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            zoomTo(scale * (newDist / lastPinchDist));\n          }\n          lastPinchDist = newDist;\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener('touchend', function (e) {\n      if (e.touches.length < 2) lastPinchDist = 0;\n    });\n\n    // \n    const cleanupEvents = () => {\n      wrapperEl.onpointerdown = null;\n      wrapperEl.onpointermove = null;\n      wrapperEl.onpointerup = null;\n      wrapperEl.onpointercancel = null;\n      wrapperEl.onwheel = null;\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n      $(document).off('click.slider-hide');\n    };\n\n    // \n    const $nodeSizeSlider = overlay.find('#node-size-slider');\n    const $sliderSizeDisplay = overlay.find('#slider-size-display');\n    const $sliderContainer = overlay.find('.acu-node-size-slider-container');\n    const $nodeSizeDisplayTrigger = overlay.find('#node-size-display-trigger');\n    const $legend = overlay.find('.acu-graph-legend');\n\n    let sliderVisible = false;\n    let sliderHideTimer: ReturnType<typeof setTimeout> | null = null;\n    const SLIDER_AUTO_HIDE_DELAY = 4000; // 4\n\n    // \n    const showSlider = () => {\n      if (sliderVisible) return;\n\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = true;\n\n      // \"\"wrappertriggerlegendlegendwrapper\n      // getBoundingClientRectviewport\n      const triggerRect = $nodeSizeDisplayTrigger[0].getBoundingClientRect();\n      const wrapperRect = $wrapper[0].getBoundingClientRect();\n\n      // wrappertrigger\n      const sliderHeight = 60; // \n      const top = wrapperRect.height - sliderHeight - 10; // wrapper\n      const left = triggerRect.left - wrapperRect.left;\n\n      $sliderContainer.css({\n        display: 'block',\n        top: `${top}px`,\n        left: `${left}px`,\n      });\n\n      // \n      resetSliderHideTimer();\n    };\n\n    // \n    const hideSlider = () => {\n      if (!sliderVisible) return;\n\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = false;\n      $sliderContainer.hide();\n    };\n\n    // \n    const resetSliderHideTimer = () => {\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n      }\n      sliderHideTimer = setTimeout(() => {\n        hideSlider();\n      }, SLIDER_AUTO_HIDE_DELAY);\n    };\n\n    // \"\"/\n    overlay.on('click', '#node-size-display-trigger, #node-size-display-trigger *', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        hideSlider();\n      } else {\n        showSlider();\n      }\n    });\n\n    // \n    $nodeSizeSlider.on('input mousedown touchstart', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        resetSliderHideTimer();\n      }\n    });\n\n    // \n    $sliderContainer.on('pointerdown mousedown touchstart', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $(document).on('click.slider-hide', function (e) {\n      if (\n        sliderVisible &&\n        !$sliderContainer.is(e.target) &&\n        $sliderContainer.has(e.target).length === 0 &&\n        !$nodeSizeDisplayTrigger.is(e.target) &&\n        $nodeSizeDisplayTrigger.has(e.target).length === 0\n      ) {\n        hideSlider();\n      }\n    });\n\n    $nodeSizeSlider.on('input', function () {\n      nodeSizeMultiplier = parseFloat($(this).val());\n      $sliderSizeDisplay.text(Math.round(nodeSizeMultiplier * 100) + '%');\n      updateNodeSizeDisplay();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n      render();\n\n      // \n      resetSliderHideTimer();\n    });\n\n    //  toggle \n    const $filterInSceneBtn = overlay.find('#filter-in-scene');\n    const $filterDirectOnlyBtn = overlay.find('#filter-direct-only');\n\n    const updateFilterToggleStyles = () => {\n      $filterInSceneBtn.css({\n        background: filterInScene ? t.accent : t.btnBg,\n        color: filterInScene ? t.btnActiveText : t.textMain,\n        borderColor: filterInScene ? t.accent : t.border,\n      });\n      $filterDirectOnlyBtn.css({\n        background: filterDirectOnly ? t.accent : t.btnBg,\n        color: filterDirectOnly ? t.btnActiveText : t.textMain,\n        borderColor: filterDirectOnly ? t.accent : t.border,\n      });\n    };\n\n    // \n    updateFilterToggleStyles();\n\n    $filterInSceneBtn.click(function (e) {\n      e.stopPropagation();\n      filterInScene = !filterInScene;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    $filterDirectOnlyBtn.click(function (e) {\n      e.stopPropagation();\n      filterDirectOnly = !filterDirectOnly;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    //  +  + \n    overlay.find('#graph-zoom-reset').click(() => {\n      // \n      scale = 1;\n      panX = 0;\n      panY = 0;\n      updateTransform();\n\n      // \n      nodeSizeMultiplier = 1.0;\n      $nodeSizeSlider.val(1.0);\n      $sliderSizeDisplay.text('100%');\n      updateNodeSizeDisplay();\n\n      // stepper\n      const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n      if ($nodeSizeStepper.length) {\n        $nodeSizeStepper.find('.acu-stepper-value').text('100%');\n      }\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      if (!loadLayoutCache()) {\n        // \n        runForceDirectedLayout();\n      }\n      render();\n    });\n\n    // Stepper  - \n    const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n    if ($nodeSizeStepper.length) {\n      const min = parseInt($nodeSizeStepper.data('min')); // 50\n      const max = parseInt($nodeSizeStepper.data('max')); // 200\n      const step = parseInt($nodeSizeStepper.data('step')); // 10\n      const $value = $nodeSizeStepper.find('.acu-stepper-value');\n\n      const updateNodeSizeValue = (newPercent: number) => {\n        newPercent = Math.max(min, Math.min(max, newPercent));\n        nodeSizeMultiplier = newPercent / 100; //  (0.5-2.0)\n        $value.text(`${newPercent}%`);\n        updateNodeSizeDisplay();\n\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      };\n\n      const getCurrentPercent = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || 100;\n      };\n\n      $nodeSizeStepper.find('.acu-stepper-dec').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() - step);\n      });\n\n      $nodeSizeStepper.find('.acu-stepper-inc').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() + step);\n      });\n    }\n\n    // \n    overlay.find('#graph-relayout').click(() => {\n      // \n      clearLayoutCache();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      runForceDirectedLayout();\n      render();\n    });\n\n    overlay.find('#graph-manage-avatar').click(() => {\n      // \n      showAvatarManager(nodeArr, () => {\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      });\n    });\n\n    const closeGraph = () => {\n      cleanupEvents();\n      overlay.remove();\n    };\n    overlay.find('.acu-graph-close').click(closeGraph);\n    setupOverlayClose(overlay, 'acu-relation-graph-overlay', closeGraph);\n  };\n  // ========================================\n  //  - PC/\n  // ========================================\n\n  const showAvatarCropModal = (imageSource, characterName, onSave) => {\n    const { $ } = getCore();\n    $('.acu-crop-modal-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // \n    let scale = 150;\n    let offsetX = 50;\n    let offsetY = 50;\n\n    // \n    const existing = AvatarManager.getAll()[characterName];\n    if (existing) {\n      scale = existing.scale ?? 150;\n      offsetX = existing.offsetX ?? 50;\n      offsetY = existing.offsetY ?? 50;\n    }\n\n    const modalHtml = `\n            <div class=\"acu-crop-modal-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-crop-modal\">\n                    <div class=\"acu-crop-header\">\n                        <span><i class=\"fa-solid fa-crop-simple\"></i>  - ${escapeHtml(characterName)}</span>\n                        <button class=\"acu-crop-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-crop-body\">\n                        <div class=\"acu-crop-container\">\n                            <div class=\"acu-crop-image\" style=\"\n                                background-image: url('${imageSource}');\n                                background-size: ${scale}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                            \"></div>\n                            <div class=\"acu-crop-mask\"></div>\n                        </div>\n                        <div class=\"acu-crop-hint\">  /</div>\n                    </div>\n                    <div class=\"acu-crop-footer\">\n                        <label class=\"acu-crop-btn acu-crop-reupload\" title=\"\">\n                            <i class=\"fa-solid fa-camera\"></i>\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-crop-file-input\" style=\"display:none;\" />\n                        </label>\n                        <button class=\"acu-crop-btn acu-crop-cancel\"></button>\n                        <button class=\"acu-crop-btn acu-crop-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      'z-index': '31310',\n    });\n\n    const $image = $modal.find('.acu-crop-image');\n    const $container = $modal.find('.acu-crop-container');\n    const containerEl = $container[0];\n    const imageEl = $image[0];\n\n    // \n    const updateImageStyle = () => {\n      imageEl.style.backgroundSize = `${scale}%`;\n      imageEl.style.backgroundPosition = `${offsetX}% ${offsetY}%`;\n    };\n\n    // ===  Pointer Events  ===\n    let isDragging = false;\n    let startX = 0,\n      startY = 0;\n    let startOffsetX = 0,\n      startOffsetY = 0;\n    let activePointerId = null;\n\n    imageEl.addEventListener('pointerdown', e => {\n      // \n      if (activePointerId !== null) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      isDragging = true;\n      activePointerId = e.pointerId;\n      startX = e.clientX;\n      startY = e.clientY;\n      startOffsetX = offsetX;\n      startOffsetY = offsetY;\n\n      imageEl.setPointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grabbing';\n    });\n\n    imageEl.addEventListener('pointermove', e => {\n      if (!isDragging || e.pointerId !== activePointerId) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      const deltaX = e.clientX - startX;\n      const deltaY = e.clientY - startY;\n\n      // \n      const sensitivity = 100 / scale;\n      offsetX = Math.max(0, Math.min(100, startOffsetX - deltaX * sensitivity));\n      offsetY = Math.max(0, Math.min(100, startOffsetY - deltaY * sensitivity));\n      updateImageStyle();\n    });\n\n    imageEl.addEventListener('pointerup', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.releasePointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grab';\n    });\n\n    imageEl.addEventListener('pointercancel', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.style.cursor = 'grab';\n    });\n\n    // ===  ===\n    // \n    containerEl.addEventListener(\n      'wheel',\n      e => {\n        e.preventDefault();\n        e.stopPropagation();\n        const delta = e.deltaY > 0 ? -10 : 10;\n        scale = Math.max(100, Math.min(300, scale + delta));\n        updateImageStyle();\n      },\n      { passive: false },\n    );\n\n    // \n    let lastPinchDist = 0;\n    let pinchStartScale = scale;\n\n    containerEl.addEventListener(\n      'touchstart',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          pinchStartScale = scale;\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener(\n      'touchmove',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            const pinchRatio = newDist / lastPinchDist;\n            scale = Math.max(100, Math.min(300, pinchStartScale * pinchRatio));\n            updateImageStyle();\n          }\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener('touchend', e => {\n      if (e.touches.length < 2) {\n        lastPinchDist = 0;\n        pinchStartScale = scale;\n      }\n    });\n\n    // ===  ===\n    // \n    $modal.find('.acu-crop-file-input').on('change', async function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      if (!file.type.startsWith('image/')) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        if (window.toastr) window.toastr.warning(' 5MB');\n        return;\n      }\n\n      try {\n        // \n        const success = await AvatarManager.saveLocalAvatar(characterName, file);\n        if (success) {\n          //  URL \n          const newUrl = await LocalAvatarDB.get(characterName);\n          imageSource = newUrl;\n\n          // \n          scale = 150;\n          offsetX = 50;\n          offsetY = 50;\n\n          // \n          $image.css('background-image', `url('${newUrl}')`);\n          updateImageStyle();\n        }\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n\n      $(this).val('');\n    });\n    $modal.find('.acu-crop-close, .acu-crop-cancel').on('click', () => {\n      $modal.remove();\n    });\n\n    $modal.find('.acu-crop-confirm').on('click', () => {\n      onSave({ scale, offsetX, offsetY });\n      $modal.remove();\n    });\n\n    // \n    setupOverlayClose($modal, 'acu-crop-modal-overlay', () => {\n      $modal.remove();\n    });\n  };\n  //  - \n  const showAvatarManager = (nodeArr, onUpdate) => {\n    try {\n      const { $ } = getCore();\n      $('.acu-avatar-manager-overlay').remove();\n\n      const config = getConfig();\n      const t = getThemeColors();\n      const avatars = AvatarManager.getAll();\n\n      // {{user}}\n      const resolveUserPlaceholderForAvatar = name => {\n        if (!name) return name;\n        const playerName = getPlayerName();\n        const personaName = getPersonaName();\n\n        // \n        const explicitUserVariants = ['<user>', '{{user}}'];\n        const isExplicitUserVariant = explicitUserVariants.some(\n          v => name === v || name.toLowerCase() === v.toLowerCase(),\n        );\n\n        // persona\n        const isPersonaName = personaName && name === personaName;\n\n        // \"\"\n        const isPlayerName = (() => {\n          if (!playerName) return false;\n          // \n          if (name === playerName) return true;\n          // \n          const primaryName = AvatarManager.getPrimaryName(name);\n          return primaryName === playerName;\n        })();\n\n        // {{user}}\n        if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n          return '{{user}}';\n        }\n\n        // \n        return AvatarManager.getPrimaryName(name);\n      };\n\n      // \n      const buildList = async () => {\n        let listHtml = '';\n\n        // {{user}}\n        const userNode = nodeArr.find(n => {\n          const resolved = resolveUserPlaceholderForAvatar(n.name);\n          return resolved === '{{user}}';\n        });\n        const otherNodes = nodeArr.filter(n => {\n          const resolved = resolveUserPlaceholderForAvatar(n.name);\n          return resolved !== '{{user}}';\n        });\n\n        // {{user}}\n        if (userNode) {\n          // {{user}}'{{user}}'\n          const userNodeForDisplay = {\n            ...userNode,\n            name: '{{user}}', // {{user}}\n          };\n\n          const data = avatars[userNodeForDisplay.name] || {};\n          let currentUrl = data.url || '';\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(userNodeForDisplay.name);\n          let displayUrl = '';\n          let sourceLabel = '';\n\n          if (hasLocal) {\n            displayUrl = await LocalAvatarDB.get(userNodeForDisplay.name);\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n          } else if (currentUrl) {\n            displayUrl = currentUrl;\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n          }\n\n          const aliases = (data.aliases || []).join(', ');\n          const hasAvatar = !!displayUrl;\n\n          listHtml += `\n                    <div class=\"acu-avatar-item\" data-name=\"${escapeHtml(userNodeForDisplay.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <div class=\"acu-avatar-preview-wrap\">\n                            <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" style=\"${hasAvatar ? `background-image: url('${displayUrl}'); background-position: ${data.offsetX ?? 50}% ${data.offsetY ?? 50}%; background-size: ${data.scale ?? 150}%;` : ''}\">\n                                ${!hasAvatar ? `<span>${escapeHtml(userNodeForDisplay.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                            </div>\n                            ${sourceLabel}\n                        </div>\n                        <div class=\"acu-avatar-info\">\n                            <div class=\"acu-avatar-name-row\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(userNodeForDisplay.name)}</div>\n                                <div class=\"acu-avatar-actions\">\n                                    <button class=\"acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                    <button class=\"acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                </div>\n                            </div>\n                            <input type=\"text\" class=\"acu-avatar-url\" placeholder=\"URL...\" value=\"${escapeHtml(currentUrl)}\" />\n                            <input type=\"text\" class=\"acu-avatar-aliases\" placeholder=\"...\" value=\"${escapeHtml(aliases)}\" title=\": , \" />\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none;\" />\n                        </div>\n                    </div>\n                `;\n        }\n\n        // \n        for (const node of otherNodes) {\n          const data = avatars[node.name] || {};\n          let currentUrl = data.url || '';\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(node.name);\n          let displayUrl = '';\n          let sourceLabel = '';\n\n          if (hasLocal) {\n            displayUrl = await LocalAvatarDB.get(node.name);\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n          } else if (currentUrl) {\n            displayUrl = currentUrl;\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n          }\n\n          const aliases = (data.aliases || []).join(', ');\n          const hasAvatar = !!displayUrl;\n\n          listHtml += `\n                    <div class=\"acu-avatar-item\" data-name=\"${escapeHtml(node.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <div class=\"acu-avatar-preview-wrap\">\n                            <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" style=\"${hasAvatar ? `background-image: url('${displayUrl}'); background-position: ${data.offsetX ?? 50}% ${data.offsetY ?? 50}%; background-size: ${data.scale ?? 150}%;` : ''}\">\n                                ${!hasAvatar ? `<span>${escapeHtml(node.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                            </div>\n                            ${sourceLabel}\n                        </div>\n                        <div class=\"acu-avatar-info\">\n                            <div class=\"acu-avatar-name-row\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(node.name)}</div>\n                                <div class=\"acu-avatar-actions\">\n                                    <button class=\"acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                    <button class=\"acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                </div>\n                            </div>\n                            <input type=\"text\" class=\"acu-avatar-url\" placeholder=\"URL...\" value=\"${escapeHtml(currentUrl)}\" />\n                            <input type=\"text\" class=\"acu-avatar-aliases\" placeholder=\"...\" value=\"${escapeHtml(aliases)}\" title=\": , \" />\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none;\" />\n                        </div>\n                    </div>\n                `;\n        }\n\n        return listHtml;\n      };\n\n      // \n      const managerHtml = `\n            <div class=\"acu-avatar-manager-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-avatar-manager\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-avatar-title\"><i class=\"fa-solid fa-user-circle\"></i> </div>\n                        <div style=\"display:flex;gap:4px;align-items:center;\">\n                            <button class=\"acu-avatar-import-btn\" title=\"\"><i class=\"fa-solid fa-file-import\"></i></button>\n                            <button class=\"acu-avatar-export-btn\" title=\"\"><i class=\"fa-solid fa-file-export\"></i></button>\n                            <button class=\"acu-avatar-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-avatar-list\" id=\"acu-avatar-list-container\">\n                        <div style=\"text-align:center;padding:20px;color:${t.textSub};\">\n                            <i class=\"fa-solid fa-spinner fa-spin\"></i> ...\n                        </div>\n                    </div>\n                </div>\n                <input type=\"file\" id=\"acu-avatar-file-input\" accept=\".json\" style=\"display:none;\" />\n            </div>\n        `;\n\n      const $manager = $(managerHtml);\n      $('body').append($manager);\n\n      // \n      buildList().then(listHtml => {\n        $manager.find('#acu-avatar-list-container').html(listHtml);\n        bindAvatarEvents();\n      });\n\n      // \n      const refreshItem = async name => {\n        const $item = $manager.find(`.acu-avatar-item[data-name=\"${name}\"]`);\n        if (!$item.length) return;\n\n        const data = AvatarManager.getAll()[name] || {};\n        const hasLocal = await AvatarManager.hasLocalAvatar(name);\n        let displayUrl = '';\n        let sourceLabel = '';\n\n        if (hasLocal) {\n          displayUrl = await LocalAvatarDB.get(name);\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n        } else if (data.url) {\n          displayUrl = data.url;\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n        }\n\n        const $preview = $item.find('.acu-avatar-preview');\n        $item.find('.acu-avatar-source').remove();\n\n        if (displayUrl) {\n          $preview\n            .addClass('has-image')\n            .css({\n              'background-image': `url('${displayUrl}')`,\n              'background-position': `${data.offsetX ?? 50}% ${data.offsetY ?? 50}%`,\n              'background-size': `${data.scale ?? 150}%`,\n            })\n            .find('span')\n            .remove();\n          $item.find('.acu-avatar-preview-wrap').append(sourceLabel);\n        } else {\n          $preview\n            .removeClass('has-image')\n            .css({ 'background-image': '', 'background-position': '', 'background-size': '' })\n            .html(\n              `<span>${escapeHtml(name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>`,\n            );\n        }\n\n        $item.attr('data-has-local', hasLocal);\n        $item.attr('data-display-url', displayUrl);\n      };\n\n      const bindAvatarEvents = () => {\n        // \n        $manager.on('click', '.acu-avatar-preview', async function (e) {\n          e.stopPropagation();\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const displayUrl = $item.attr('data-display-url');\n\n          if (displayUrl) {\n            //   \n            showAvatarCropModal(displayUrl, name, async result => {\n              const data = AvatarManager.getAll()[name] || {};\n              AvatarManager.set(name, data.url || '', result.offsetX, result.offsetY, result.scale, data.aliases || []);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          } else {\n            //   \n            $item.find('.acu-avatar-file-input').click();\n          }\n        });\n\n        // \n        $manager.on('change', '.acu-avatar-file-input', async function (e) {\n          const file = e.target.files[0];\n          if (!file) return;\n\n          if (!file.type.startsWith('image/')) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          if (file.size > 5 * 1024 * 1024) {\n            if (window.toastr) window.toastr.warning(' 5MB');\n            return;\n          }\n\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n\n          try {\n            const success = await AvatarManager.saveLocalAvatar(name, file);\n            if (success) {\n              const newUrl = await LocalAvatarDB.get(name);\n              await refreshItem(name);\n\n              // \n              showAvatarCropModal(newUrl, name, async result => {\n                const data = AvatarManager.getAll()[name] || {};\n                AvatarManager.set(\n                  name,\n                  data.url || '',\n                  result.offsetX,\n                  result.offsetY,\n                  result.scale,\n                  data.aliases || [],\n                );\n                await refreshItem(name);\n                onUpdate && onUpdate();\n              });\n            }\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            if (window.toastr) window.toastr.error('');\n          }\n\n          $(this).val('');\n        });\n\n        // URL  \n        $manager.on('click', '.acu-avatar-save-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const url = $item.find('.acu-avatar-url').val().trim();\n          const aliasesStr = $item.find('.acu-avatar-aliases').val().trim();\n          const aliases = aliasesStr\n            ? aliasesStr\n                .split(/[,]/)\n                .map(s => s.trim())\n                .filter(s => s && s !== name)\n            : [];\n\n          const data = AvatarManager.getAll()[name] || {};\n\n          // \n          AvatarManager.set(name, url, data.offsetX ?? 50, data.offsetY ?? 50, data.scale ?? 150, aliases);\n\n          // URL\n          const hasLocal = $item.attr('data-has-local') === 'true';\n          if (url && !hasLocal) {\n            await refreshItem(name);\n            showAvatarCropModal(url, name, async result => {\n              AvatarManager.set(name, url, result.offsetX, result.offsetY, result.scale, aliases);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          } else {\n            await refreshItem(name);\n            onUpdate && onUpdate();\n          }\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-clear-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n\n          await AvatarManager.deleteLocalAvatar(name);\n          AvatarManager.remove(name);\n\n          $item.find('.acu-avatar-url').val('');\n          $item.find('.acu-avatar-aliases').val('');\n          await refreshItem(name);\n          onUpdate && onUpdate();\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-export-btn', function () {\n          const exportData = AvatarManager.exportData();\n          const jsonStr = JSON.stringify(exportData, null, 2);\n          const blob = new Blob([jsonStr], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `avatar-config-${new Date().toISOString().slice(0, 10)}.json`;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-import-btn', function () {\n          $manager.find('#acu-avatar-file-input').click();\n        });\n\n        $manager.on('change', '#acu-avatar-file-input', function (e) {\n          const file = e.target.files[0];\n          if (!file) return;\n\n          const reader = new FileReader();\n          reader.onload = function (evt) {\n            try {\n              const jsonData = JSON.parse(evt.target.result);\n              const analysis = AvatarManager.analyzeImport(jsonData);\n\n              if (!analysis.valid) {\n                if (window.toastr) window.toastr.error(analysis.error);\n                return;\n              }\n\n              showImportConfirmDialog(jsonData, analysis, () => {\n                $manager.remove();\n                showAvatarManager(nodeArr, onUpdate);\n                onUpdate && onUpdate();\n              });\n            } catch (err) {\n              console.error('[DICE]ACU :', err);\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n          reader.readAsText(file);\n          $(this).val('');\n        });\n      };\n\n      // \n      const closeManager = () => $manager.remove();\n      $manager.on('click', '.acu-avatar-close', closeManager);\n      setupOverlayClose($manager, 'acu-avatar-manager-overlay', closeManager);\n    } catch (error) {\n      console.error(':', error);\n      if (window.toastr) {\n        const errorMsg = error instanceof Error ? error.message : '';\n        window.toastr.error(`: ${errorMsg}`);\n      }\n      // DOM\n      $('.acu-avatar-manager-overlay').remove();\n    }\n  };\n\n  // \n  const clearDiceSystemCache = async (): Promise<void> => {\n    if (!('caches' in window)) {\n      console.log('[DICE] Cache API ');\n      return;\n    }\n\n    try {\n      const cacheNames = await caches.keys();\n      const urlPatterns = ['jsdelivr.net/gh/jerryzmtz/my-tavern-scripts', '/dist//'];\n\n      for (const cacheName of cacheNames) {\n        const cache = await caches.open(cacheName);\n        const requests = await cache.keys();\n\n        for (const request of requests) {\n          const url = request.url;\n          //  jsDelivr \n          if (urlPatterns.some(pattern => url.includes(pattern))) {\n            await cache.delete(request);\n            console.log('[DICE] :', url);\n          }\n        }\n      }\n      console.log('[DICE] ');\n    } catch (err) {\n      console.warn('[DICE] :', err);\n    }\n  };\n\n  // \n  const showManualUpdateConfirmDialog = (): void => {\n    const { $ } = getCore();\n    $('.acu-manual-update-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    const dialogHtml = `\n    <div class=\"acu-manual-update-overlay acu-theme-${config.theme}\">\n      <div class=\"acu-manual-update-dialog\" style=\"background:${t.bgPanel};border-color:${t.border};\">\n        <div class=\"acu-manual-update-header\" style=\"background:${t.tableHead};color:${t.textMain};border-color:${t.border};\">\n          <i class=\"fa-solid fa-rotate\"></i> \n        </div>\n        <div class=\"acu-manual-update-body\" style=\"color:${t.textMain};\">\n          <p style=\"color:${t.textMain};\"></p>\n          <div class=\"acu-manual-update-safe-box\" style=\"background:${t.btnBg};border:1px solid ${t.border};\">\n            <i class=\"fa-solid fa-shield-check\" style=\"color:${t.accent};\"></i>\n            <div class=\"safe-text\">\n              <strong style=\"color:${t.textMain};\"></strong>\n              <span style=\"color:${t.textSub};\"></span>\n            </div>\n          </div>\n        </div>\n        <div class=\"acu-manual-update-footer\" style=\"background:${t.tableHead};border-color:${t.border};\">\n          <button class=\"acu-manual-update-cancel-btn\" style=\"background:${t.btnBg};color:${t.textSub};border-color:${t.border};\"></button>\n          <button class=\"acu-manual-update-confirm-btn\" style=\"background:${t.accent};color:${t.btnActiveText};\"></button>\n        </div>\n      </div>\n    </div>\n  `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    const overlayEl = $dialog[0];\n\n    // \n    $dialog.find('.acu-manual-update-cancel-btn').on('click', () => {\n      $dialog.remove();\n    });\n\n    $dialog.find('.acu-manual-update-confirm-btn').on('click', async () => {\n      const $btn = $dialog.find('.acu-manual-update-confirm-btn');\n      $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n\n      await clearDiceSystemCache();\n      //  Ctrl+Shift+R\n      if (window.parent !== window) {\n        window.parent.location.reload();\n      } else {\n        window.location.reload();\n      }\n    });\n\n    // \n    $dialog.on('click', e => {\n      if (e.target === overlayEl) {\n        $dialog.remove();\n      }\n    });\n  };\n\n  // \n  const showImportConfirmDialog = (jsonData, analysis, onComplete) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const t = getThemeColors();\n    const config = getConfig();\n\n    const hasConflicts = analysis.conflicts.length > 0;\n    const conflictListHtml =\n      analysis.conflicts.length > 0\n        ? `<div style=\"max-height:80px;overflow-y:auto;background:rgba(0,0,0,0.1);border-radius:4px;padding:6px 8px;margin-top:6px;font-size:11px;color:${t.textSub};\">${analysis.conflicts.map(n => escapeHtml(n)).join(', ')}</div>`\n        : '';\n\n    const dialogHtml = `\n            <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-import-confirm-dialog\">\n                    <div class=\"acu-import-confirm-header\">\n                        <i class=\"fa-solid fa-file-import\"></i> \n                    </div>\n                    <div class=\"acu-import-confirm-body\">\n                        <div class=\"acu-import-stats\">\n                            <div class=\"acu-import-stat\">\n                                <span class=\"acu-stat-num\">${analysis.total}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-new\">\n                                <span class=\"acu-stat-num\">${analysis.newItems.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-conflict\">\n                                <span class=\"acu-stat-num\">${analysis.conflicts.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                        </div>\n\n                        ${\n                          hasConflicts\n                            ? `\n                            <div class=\"acu-import-conflict-section\">\n                                <div style=\"font-size:12px;font-weight:bold;color:${t.textMain};margin-bottom:4px;\">\n                                    <i class=\"fa-solid fa-exclamation-triangle\" style=\"color:${t.warningIcon};\"></i> \n                                </div>\n                                ${conflictListHtml}\n                                <div class=\"acu-import-conflict-options\">\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"overwrite\" checked />\n                                        <span></span>\n                                    </label>\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"skip\" />\n                                        <span></span>\n                                    </label>\n                                </div>\n                            </div>\n                        `\n                            : `\n                            <div style=\"text-align:center;padding:10px;color:${t.successText};\">\n                                <i class=\"fa-solid fa-check-circle\"></i> \n                            </div>\n                        `\n                        }\n                    </div>\n                    <div class=\"acu-import-confirm-footer\">\n                        <button class=\"acu-import-cancel-btn\"></button>\n                        <button class=\"acu-import-confirm-btn\"></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n            position: fixed !important;\n            top: 0 !important;\n            left: 0 !important;\n            right: 0 !important;\n            bottom: 0 !important;\n            width: 100vw !important;\n            height: 100vh !important;\n            background: rgba(0,0,0,0.6) !important;\n            z-index: 31300 !important;\n            display: flex;\n            justify-content: center !important;\n            align-items: center !important;\n            padding: 16px;\n            box-sizing: border-box !important;\n        `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(closeDialog);\n    setupOverlayClose($dialog, 'acu-import-confirm-overlay', closeDialog);\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const overwrite = $dialog.find('input[name=\"conflict-mode\"]:checked').val() !== 'skip';\n      try {\n        const stats = AvatarManager.importData(jsonData, overwrite);\n        closeDialog();\n        onComplete && onComplete();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + err.message);\n      }\n    });\n  };\n  // []  ()\n  const showCardEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    let rawData = cachedRawData || getTableData() || loadSnapshot();\n\n    let displayRow = row;\n    // \n    if (rawData && rawData[tableKey] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n      displayRow = rawData[tableKey]?.content?.[rowIndex + 1];\n    }\n\n    const inputsHtml = displayRow\n      .map((cell, idx) => {\n        if (idx === 0) return ''; // \n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        //  textarea\n        return `\n                <div class=\"acu-card-edit-field\" style=\"margin-bottom: 10px;\">\n                    <label style=\"display:block;font-size:12px;color:var(--acu-accent);font-weight:bold;margin-bottom:4px;\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\"\n                    style=\"width:100%;min-height:40px;max-height:500px;padding:10px;resize:none;overflow-y:hidden;\">${escapeHtml(val)}</textarea>\n                </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${inputsHtml}\n                    </div>\n                     <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-card-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-card-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // --- []  ---\n    const adjustHeight = el => {\n      //  auto  0px shrinking  scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    // -----------------------------\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-card-cancel').click(closeDialog);\n\n    //  + AI\n    dialog.find('#dlg-card-save').click(async () => {\n      let rawData = cachedRawData || getTableData() || loadSnapshot();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n        if (hasChanges) {\n          try {\n            //  saveRowInstantly  + \n            await saveRowInstantly(tableKey, rowIndex, [...currentRow]);\n            renderInterface();\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            // \n            return;\n          }\n        }\n      }\n      closeDialog();\n    });\n    // \n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n    // \n    dialog.on('click', function (e) {\n      if ($(e.target).closest('#dlg-close-x, #dlg-close, .acu-close-btn').length) {\n        closeDialog();\n      }\n    });\n  };\n\n  // [] \n  let _configCache = null;\n  const getConfig = () => {\n    if (!_configCache) _configCache = { ...DEFAULT_CONFIG, ...Store.get(STORAGE_KEY_UI_CONFIG, {}) };\n    return _configCache;\n  };\n  const saveConfig = newCfg => {\n    _configCache = { ...getConfig(), ...newCfg };\n    Store.set(STORAGE_KEY_UI_CONFIG, _configCache);\n    applyConfigStyles(_configCache);\n  };\n\n  const generateDiffMap = currentData => {\n    const lastData = loadSnapshot();\n    const diffSet = new Set();\n    if (!lastData) return diffSet;\n\n    for (const sheetId in currentData) {\n      const newSheet = currentData[sheetId];\n      const oldSheet = lastData[sheetId];\n      if (!newSheet || !newSheet.name) continue;\n      const tableName = newSheet.name;\n\n      if (!oldSheet) {\n        // \n        if (newSheet.content) {\n          newSheet.content.forEach((row, rIdx) => {\n            if (rIdx > 0) diffSet.add(`${tableName}-row-${rIdx - 1}`);\n          });\n        }\n        continue;\n      }\n\n      const newRows = newSheet.content || [];\n      const oldRows = oldSheet.content || [];\n\n      // [] \n      // : {  -> [{index, row}, ...] } ()\n      const oldRowMap = new Map();\n      oldRows.forEach((row, rIdx) => {\n        if (rIdx === 0) return; // \n        const title = String(row[1] ?? '').trim();\n        if (title) {\n          if (!oldRowMap.has(title)) {\n            oldRowMap.set(title, []);\n          }\n          oldRowMap.get(title).push({ index: rIdx, row: row });\n        }\n      });\n\n      // \n      const matchedOldIndices = new Set();\n\n      // \n      newRows.forEach((row, rIdx) => {\n        if (rIdx === 0) return; // \n        const title = String(row[1] ?? '').trim();\n\n        let matchedOldRow = null;\n\n        if (title && oldRowMap.has(title)) {\n          // \n          const candidates = oldRowMap.get(title);\n          if (candidates.length > 0) {\n            const matched = candidates.shift(); // \n            matchedOldRow = matched.row;\n            matchedOldIndices.add(matched.index);\n            if (candidates.length === 0) {\n              oldRowMap.delete(title);\n            }\n          }\n        }\n\n        if (!matchedOldRow && !title) {\n          // \n          const oldRow = oldRows[rIdx];\n          if (oldRow && !matchedOldIndices.has(rIdx)) {\n            matchedOldRow = oldRow;\n            matchedOldIndices.add(rIdx);\n          }\n        }\n\n        if (!matchedOldRow) {\n          // \n          diffSet.add(`${tableName}-row-${rIdx - 1}`);\n        } else {\n          // \n          row.forEach((cell, cIdx) => {\n            if (cIdx === 0) return; // \n            const oldCell = matchedOldRow[cIdx];\n            if (String(cell ?? '') !== String(oldCell ?? '')) {\n              diffSet.add(`${tableName}-${rIdx - 1}-${cIdx}`);\n            }\n          });\n        }\n      });\n    }\n    return diffSet;\n  };\n\n  const applyConfigStyles = config => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    const fontVal = FONTS.find(f => f.id === config.fontFamily)?.val || FONTS[0].val;\n\n    // []  ID  Style \n    const $styleTag = $('#acu-dynamic-font');\n    const currentFontId = $styleTag.data('font-id');\n\n    if (currentFontId !== config.fontFamily) {\n      $styleTag.remove();\n      const fontImport = `\n                @import url(\"https://fontsapi.zeoseven.com/3/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/442/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/256/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/482/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/446/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/570/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/292/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/69/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/7/main/result.css\");\n            `;\n      $('head').append(`\n                <style id=\"acu-dynamic-font\" data-font-id=\"${config.fontFamily}\">\n                    ${fontImport}\n                    .acu-wrapper, .acu-edit-dialog, .acu-cell-menu, .acu-nav-container, .acu-data-card, .acu-panel-title, .acu-settings-label, .acu-btn-block, .acu-nav-btn, .acu-edit-textarea,\n                    .acu-dice-panel, .acu-contest-panel, .acu-dice-config-dialog,\n                    .acu-relation-graph-container, .acu-avatar-manager, .acu-import-confirm-dialog,\n                    .acu-embedded-options-container, .acu-option-panel, .acu-opt-btn {\n                        font-family: ${fontVal} !important;\n                    }\n                </style>\n            `);\n    }\n\n    // []  CSS \n    const cssVars = {\n      '--acu-card-width': `${config.cardWidth}px`,\n      '--acu-font-size': `${config.fontSize}px`,\n      '--acu-opt-font-size': `${config.optionFontSize || 12}px`,\n      '--acu-grid-cols': config.gridColumns,\n    };\n\n    if ($wrapper.length) {\n      $wrapper.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $wrapper.addClass(`acu-theme-${config.theme}`);\n      $wrapper.css(cssVars);\n    }\n\n    const $optContainer = $('.acu-embedded-options-container');\n    if ($optContainer.length) {\n      $optContainer.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $optContainer.addClass(`acu-theme-${config.theme}`);\n      $optContainer.css(cssVars);\n    }\n  };\n\n  /**\n   * \n   *\n   * CSS  ./styles.ts \n   *  styles.ts  MAIN_STYLES \n   *\n   * @see ./styles.ts - MAIN_STYLES \n   */\n  const addStyles = () => {\n    if (window._acuStylesInjected && $(`#${SCRIPT_ID}-styles`).length) return;\n    window._acuStylesInjected = true;\n    const { $ } = getCore();\n    $('style').each(function () {\n      if (this.id && this.id.startsWith('acu_') && this.id.endsWith('-styles') && this.id !== `${SCRIPT_ID}-styles`)\n        $(this).remove();\n    });\n    $(`#${SCRIPT_ID}-styles`).remove();\n    const styles = `<style id=\"${SCRIPT_ID}-styles\">${MAIN_STYLES}</style>`;\n    $('head').append(styles);\n  };\n\n  const getTableData = () => {\n    const api = getCore().getDB();\n    if (!api || !api.exportTableAsJson) {\n      console.warn('[DICE] API ');\n      return null;\n    }\n    try {\n      const data = api.exportTableAsJson();\n      if (data) {\n        const sheetCount = Object.keys(data).filter(k => k.startsWith('sheet_')).length;\n        console.info(`[DICE] ${sheetCount} `);\n      }\n      return data;\n    } catch (e) {\n      console.error('[DICE]:', e);\n      return null;\n    }\n  };\n\n  const saveDataToDatabase = async (tableData, skipRender = false, commitDeletes = false) => {\n    if (isSaving) {\n      console.warn('[DICE]');\n      return; // \n    }\n    console.info('[DICE]...');\n    isSaving = true;\n    const { $ } = getCore();\n    const $saveBtn = $('#acu-btn-save-global');\n\n    // UI \n    if (!skipRender && $saveBtn.length) {\n      $saveBtn.find('i').removeClass('fa-save').addClass('fa-spinner fa-spin');\n      $saveBtn.prop('disabled', true);\n    }\n\n    try {\n      // 1.  sheet_  ( = )\n      const dataToSave = {};\n      //  mate \n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // 2.  ()\n      if (commitDeletes) {\n        const deletions = getPendingDeletions();\n        Object.keys(deletions).forEach(key => {\n          if (dataToSave[key] && dataToSave[key].content) {\n            deletions[key]\n              .sort((a, b) => b - a)\n              .forEach(idx => {\n                if (dataToSave[key].content[idx + 1]) dataToSave[key].content.splice(idx + 1, 1);\n              });\n          }\n        });\n      }\n\n      // 3. \n      let jsonString;\n      try {\n        jsonString = JSON.stringify(dataToSave);\n        //  10MB \n        const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n        if (sizeInMB > 10) {\n          throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n        }\n        console.info(`[DICE]: ${sizeInMB.toFixed(2)}MB`);\n      } catch (stringifyError) {\n        console.error('[DICE]ACU JSON :', stringifyError);\n        throw new Error(`: ${stringifyError.message || stringifyError}`);\n      }\n\n      // 4.  API  ()\n      const api = getCore().getDB();\n      if (!api || !api.importTableAsJson) {\n        throw new Error(' API ');\n      }\n\n      try {\n        //  importTableAsJson saveChat()\n        //  saveChat()  \"Settings could not be saved\" \n        const result = await api.importTableAsJson(jsonString);\n        //  false \n        if (result === false) {\n          throw new Error(' false');\n        }\n        console.info('[DICE]');\n      } catch (apiError) {\n        console.error('[DICE]ACU API :', apiError);\n        //  \"Settings could not be saved\" \n        const errorMsg = apiError.message || String(apiError);\n        if (\n          errorMsg.includes('Settings could not be saved') ||\n          errorMsg.includes('server connection') ||\n          errorMsg.includes('data loss')\n        ) {\n          throw new Error('');\n        }\n        throw new Error(`: ${errorMsg}`);\n      }\n\n      // 5. \n      cachedRawData = dataToSave;\n      saveSnapshot(dataToSave);\n      hasUnsavedChanges = false;\n      currentDiffMap = new Set();\n      if (window.acuModifiedSet) window.acuModifiedSet.clear();\n      console.info('[DICE]');\n\n      if (!skipRender) {\n        renderInterface();\n      }\n    } catch (e) {\n      const errorMessage = e.message || '';\n      console.error('[DICE]:', {\n        error: e,\n        message: errorMessage,\n        stack: e.stack,\n      });\n      if (window.toastr) {\n        window.toastr.error(errorMessage, '', { timeOut: 5000 });\n      } else {\n        alert(`: ${errorMessage}`);\n      }\n      // \n      throw e;\n    } finally {\n      isSaving = false;\n      console.info('[DICE]');\n      if (!skipRender && $saveBtn.length) {\n        $saveBtn.find('i').removeClass('fa-spinner fa-spin').addClass('fa-save');\n        $saveBtn.prop('disabled', false);\n      }\n    }\n  };\n\n  // [] \n  // \n  const saveDataOnly = async tableData => {\n    // \n    const saveOperation = saveQueue\n      .then(async () => {\n        try {\n          const dataToSave = {};\n          if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n          else dataToSave.mate = tableData.mate;\n\n          Object.keys(tableData).forEach(k => {\n            if (k.startsWith('sheet_')) {\n              dataToSave[k] = tableData[k];\n            }\n          });\n\n          // \n          let jsonString;\n          try {\n            jsonString = JSON.stringify(dataToSave);\n            //  10MB \n            const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n            if (sizeInMB > 10) {\n              throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n            }\n          } catch (stringifyError) {\n            console.error('[DICE]ACU JSON :', stringifyError);\n            throw new Error(`: ${stringifyError.message || stringifyError}`);\n          }\n\n          const api = getCore().getDB();\n          if (!api || !api.importTableAsJson) {\n            throw new Error(' API ');\n          }\n\n          try {\n            //  importTableAsJson saveChat()\n            const result = await api.importTableAsJson(jsonString);\n            //  false \n            if (result === false) {\n              throw new Error(' false');\n            }\n          } catch (apiError) {\n            console.error('[DICE]ACU API :', apiError);\n            //  \"Settings could not be saved\" \n            const errorMsg = apiError.message || String(apiError);\n            if (\n              errorMsg.includes('Settings could not be saved') ||\n              errorMsg.includes('server connection') ||\n              errorMsg.includes('data loss')\n            ) {\n              throw new Error('');\n            }\n            throw new Error(`: ${errorMsg}`);\n          }\n\n          cachedRawData = dataToSave;\n          //  saveSnapshot() hasUnsavedChanges\n        } catch (e) {\n          console.error('[DICE]ACU saveDataOnly error:', e);\n          // \n          throw e;\n        }\n      })\n      .catch(e => {\n        // \n        console.error('[DICE]ACU saveDataOnly queue error:', e);\n      });\n\n    // \n    saveQueue = saveOperation;\n    return saveOperation;\n  };\n\n  // [] \n  // AI\n  //  saveDataToDatabase\n  const saveRowInstantly = async (tableKey: string, rowIndex: number, newRowData: unknown[]): Promise<void> => {\n    try {\n      // 1. \n      const rawData = cachedRawData || getTableData();\n      if (!rawData || !rawData[tableKey]) {\n        throw new Error(` \"${tableKey}\" `);\n      }\n      if (!rawData[tableKey].content) {\n        throw new Error(` \"${tableKey}\" `);\n      }\n\n      // 2. rowIndex 0content[0] \n      rawData[tableKey].content[rowIndex + 1] = newRowData;\n\n      // 3. \n      await saveDataOnly(rawData);\n\n      // 4. \n      const snapshot = loadSnapshot();\n      if (snapshot && snapshot[tableKey] && snapshot[tableKey].content) {\n        snapshot[tableKey].content[rowIndex + 1] = [...newRowData];\n        saveSnapshot(snapshot);\n      }\n    } catch (e) {\n      const errorMsg = e instanceof Error ? e.message : String(e);\n      console.error('[DICE]ACU saveRowInstantly error:', e);\n      toastr.error(`: ${errorMsg}`);\n      throw e;\n    }\n  };\n\n  const processJsonData = json => {\n    const tables = {};\n    if (!json || typeof json !== 'object') return tables;\n    for (const sheetId in json) {\n      if (json[sheetId]?.name) {\n        const sheet = json[sheetId];\n        tables[sheet.name] = {\n          key: sheetId,\n          headers: sheet.content ? sheet.content[0] || [] : [],\n          rows: sheet.content ? sheet.content.slice(1) : [],\n          rawContent: sheet.content || [],\n          exportConfig: sheet.exportConfig || {},\n          updateConfig: sheet.updateConfig || {},\n          ...sheet,\n        };\n      }\n    }\n    return tables;\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function suggestFormatValue(pattern, rowIndex, existingValues = [], tableContent = null) {\n    if (!pattern || rowIndex === undefined || rowIndex < 0) return null;\n\n    try {\n      //  \"+\"  ^AM\\d{3}$\n      // pattern  JavaScript  '^AM\\\\d{3}$' '^AM\\d{3}$'\n      //  \\d{3} /\\\\d\\{3\\}/+d\n      // ^?[]+\\d\\{\\}$?\n      const prefixMatch = pattern.match(/^\\^?([A-Za-z]+)\\\\d\\{(\\d+)\\}\\$?$/);\n\n      if (prefixMatch) {\n        const prefix = prefixMatch[1]; // \"AM\"\n        const digits = parseInt(prefixMatch[2], 10); // 3\n\n        // \n        if (tableContent && (tableContent.name === '' || tableContent.name === '')) {\n          const headers = tableContent.content?.[0] || [];\n          const rows = tableContent.content?.slice(1) || [];\n          const codeIndex = headers.indexOf('');\n\n          if (codeIndex >= 0) {\n            // \n            const existingNumbers = [];\n            rows.forEach(row => {\n              const codeValue = row?.[codeIndex];\n              if (codeValue && typeof codeValue === 'string') {\n                const match = codeValue.match(new RegExp(`^${prefix}(\\\\d+)$`));\n                if (match) {\n                  const num = parseInt(match[1], 10);\n                  if (!isNaN(num)) existingNumbers.push(num);\n                }\n              }\n            });\n\n            // \n            const maxNum = existingNumbers.length > 0 ? Math.max(...existingNumbers) : 0;\n            const nextNum = String(maxNum + 1).padStart(digits, '0');\n            return prefix + nextNum;\n          }\n        }\n\n        // \n        const nextNum = String(rowIndex + 1).padStart(digits, '0');\n        return prefix + nextNum;\n      }\n\n      //  \\d{3} \n      const numOnlyMatch = pattern.match(/^\\^?\\\\d\\{(\\d+)\\}\\$?$/);\n      if (numOnlyMatch) {\n        const digits = parseInt(numOnlyMatch[1], 10);\n        return String(rowIndex + 1).padStart(digits, '0');\n      }\n    } catch (e) {\n      console.error('[DICE]ACU :', e);\n    }\n\n    return null; // \n  }\n\n  //  OR \n  function getRelationOptions(refTable, refColumns, rawData) {\n    const options = new Set();\n    if (!refTable || !refColumns || !rawData) return Array.from(options);\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        columns.forEach(col => {\n          const colIdx = headers.indexOf(col);\n          if (colIdx >= 0) {\n            rows.forEach(row => {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                options.add(String(value).trim());\n              }\n            });\n          }\n        });\n\n        break; // \n      }\n    }\n\n    return Array.from(options).sort();\n  }\n\n  // \n  function isValueInRelationTable(value, refTable, refColumns, rawData) {\n    if (!value || !refTable || !refColumns || !rawData) return false;\n    if (String(value).trim() === '') return false;\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n    const strVal = String(value).trim();\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        for (const col of columns) {\n          const colIdx = headers.indexOf(col);\n          if (colIdx === -1) continue;\n\n          // \n          for (let i = 0; i < rows.length; i++) {\n            const cellValue = rows[i]?.[colIdx];\n            if (cellValue !== null && cellValue !== undefined && String(cellValue).trim() === strVal) {\n              return true; // \n            }\n          }\n        }\n\n        break; // \n      }\n    }\n\n    return false; // \n  }\n\n  //  required \n  function getColumnExamples(tableName, columnName, currentRowIndex, rawData, maxCount = 5) {\n    const examples = new Set();\n    if (!tableName || !columnName || !rawData) return [];\n\n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === tableName) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n        const colIdx = headers.indexOf(columnName);\n\n        if (colIdx >= 0) {\n          rows.forEach((row, idx) => {\n            if (idx !== currentRowIndex) {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                examples.add(String(value).trim());\n              }\n            }\n          });\n        }\n        break;\n      }\n    }\n\n    return Array.from(examples).slice(0, maxCount);\n  }\n\n  // \n  function getNearestValidNumber(currentValue, min, max) {\n    const num = parseFloat(currentValue);\n    if (isNaN(num)) return min !== undefined ? min : 0;\n    if (min !== undefined && num < min) return min;\n    if (max !== undefined && num > max) return max;\n    return num;\n  }\n\n  // ========================================\n  // []  - \n  // ========================================\n  const refreshRegexRulesList = () => {\n    const { $ } = getCore();\n    const dialog = $('.acu-settings-dialog');\n    if (!dialog.length) return;\n\n    const $rulesList = dialog.find('#regex-rules-list');\n    if (!$rulesList.length) return;\n\n    // HTML\n    const rules = RegexTransformationManager.getAllRules();\n    const html = rules\n      .map(rule => {\n        const scopeIcon =\n          rule.scope.type === 'global' ? 'fa-globe' : rule.scope.type === 'table' ? 'fa-table' : 'fa-columns';\n        const scopeText =\n          rule.scope.type === 'global'\n            ? ''\n            : rule.scope.type === 'table'\n              ? rule.scope.tableNames?.join(',')\n              : `${rule.scope.tableNames?.join(',')}.${rule.scope.columnNames?.join(',')}`;\n        return `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n              <div class=\"acu-rule-type-icon\" title=\": ${escapeHtml(rule.scope.type)}\">\n                  <i class=\"fa-solid ${scopeIcon}\"></i>\n              </div>\n              <div class=\"acu-rule-info\">\n                  <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                  <div class=\"acu-rule-target\" style=\"font-size:10px;\">${escapeHtml(scopeText)} | ${escapeHtml(rule.operation)}</div>\n              </div>\n              <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n              <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                  <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n              </div>\n              <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n      `;\n      })\n      .join('');\n\n    // HTML,\n    $rulesList.html(html);\n  };\n\n  // ========================================\n  // /\n  // ========================================\n  const showAddValidationRuleModal = (parentDialog: JQuery, editRuleId?: string) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const tables = processJsonData(rawData || {});\n    const tableNames = Object.keys(tables);\n\n    // \n    const isEditMode = !!editRuleId;\n    const existingRule = isEditMode ? ValidationRuleManager.getRule(editRuleId) : null;\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\" ${isEditMode ? 'style=\"opacity:0;transition:opacity 0.15s ease-in;\"' : ''}>\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-dice-cfg-header\">\n            <span><i class=\"fa-solid ${isEditMode ? 'fa-pen' : 'fa-plus'}\"></i> ${isEditMode ? '' : ''}</span>\n            <button class=\"acu-config-close\" id=\"dlg-rule-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-table\" class=\"acu-setting-select\">\n                <option value=\"\">...</option>\n                ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"row-column\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-column\" class=\"acu-setting-select\" disabled>\n                <option value=\"\">...</option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-type\" class=\"acu-setting-select\">\n                <optgroup label=\"  \">\n                  <option value=\"tableReadonly\"></option>\n                  <option value=\"rowLimit\"></option>\n                  <option value=\"sequence\"></option>\n                </optgroup>\n                <optgroup label=\"  \">\n                  <option value=\"required\"></option>\n                  <option value=\"format\"></option>\n                  <option value=\"enum\"></option>\n                  <option value=\"numeric\"></option>\n                  <option value=\"relation\"></option>\n                  <option value=\"keyValue\"></option>\n                </optgroup>\n              </select>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-tableReadonly\">\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ,\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-rowLimit\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-max\" class=\"acu-panel-input\" placeholder=\"\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-sequence\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-sequence-prefix\" class=\"acu-panel-input\" placeholder=\"AM\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-sequence-start\" class=\"acu-panel-input\" placeholder=\"1\" value=\"1\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-sequence-paired-table\" class=\"acu-setting-select\" style=\"flex:1;\">\n                  <option value=\"\"></option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> \"+\"(AM0001, AM0002, AM0003...),<br>\n                <i class=\"fa-solid fa-link\" style=\"margin-top:4px;display:block;color:var(--acu-warning-icon);margin-right:6px;\"></i> ,,\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-required\" style=\"display:none;\">\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-format\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-pattern\" class=\"acu-panel-input\" placeholder=\"^AM\\\\d{3}$\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-enum\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-values\" class=\"acu-panel-input\" placeholder=\",,\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-numeric\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-relation\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-table\" class=\"acu-setting-select\">\n                  <option value=\"\">...</option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-column\" class=\"acu-setting-select\" multiple style=\"flex:1;min-height:80px;\">\n                  <option value=\"\">...</option>\n                </select>\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ,(OR ) Ctrl/Cmd \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-keyValue\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-keyvalue-type\" class=\"acu-setting-select\">\n                  <option value=\"text\"></option>\n                  <option value=\"numeric\"></option>\n                </select>\n              </div>\n              <div class=\"acu-setting-row\" id=\"row-keyvalue-range\" style=\"display:none;\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ::;:(,)\n              </div>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-error-msg\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n          </div>\n          <div class=\"acu-dice-cfg-actions\">\n            <button id=\"dlg-rule-cancel\"></button>\n            <button id=\"dlg-rule-save\">${isEditMode ? '' : ''}</button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // select\n    const updateSelectColor = $select => {\n      const val = $select.val();\n      if (!val || val === '') {\n        $select.css('color', 'var(--acu-text-sub)');\n        $select.css('opacity', '0.7');\n      } else {\n        $select.css('color', 'var(--acu-text-main)');\n        $select.css('opacity', '1');\n      }\n    };\n\n    // select\n    dialog.find('select').each(function () {\n      updateSelectColor($(this));\n      $(this).on('change', function () {\n        updateSelectColor($(this));\n      });\n    });\n\n    // \n    dialog.find('#rule-table').on('change', function () {\n      const tableName = $(this).val();\n      const $colSelect = dialog.find('#rule-column');\n      const $pairedTableSelect = dialog.find('#cfg-sequence-paired-table');\n      updateSelectColor($(this));\n\n      // \n      if ($pairedTableSelect.length > 0) {\n        const currentPairedValue = $pairedTableSelect.val();\n        $pairedTableSelect.empty();\n        $pairedTableSelect.append('<option value=\"\"></option>');\n        tableNames\n          .filter(name => name !== tableName)\n          .forEach(name => {\n            $pairedTableSelect.append(`<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`);\n          });\n        // \n        if (currentPairedValue && currentPairedValue !== tableName) {\n          $pairedTableSelect.val(currentPairedValue);\n        }\n        updateSelectColor($pairedTableSelect);\n      }\n\n      if (!tableName || !tables[tableName]) {\n        $colSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($colSelect);\n        return;\n      }\n\n      const headers = tables[tableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $colSelect.html('<option value=\"\">...</option>' + options).prop('disabled', false);\n      updateSelectColor($colSelect);\n    });\n\n    // \n    dialog.find('#cfg-ref-table').on('change', function () {\n      const refTableName = $(this).val();\n      const $refColSelect = dialog.find('#cfg-ref-column');\n      updateSelectColor($(this));\n\n      if (!refTableName || !tables[refTableName]) {\n        $refColSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($refColSelect);\n        return;\n      }\n\n      const headers = tables[refTableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $refColSelect.html(options).prop('disabled', false);\n      updateSelectColor($refColSelect);\n    });\n\n    // \n    dialog.find('#rule-type').on('change', function () {\n      const type = $(this).val();\n      const typeInfo = RULE_TYPE_INFO[type];\n      const isTableRule = typeInfo?.scope === 'table';\n      updateSelectColor($(this));\n\n      // \n      dialog.find('.acu-rule-config-section').hide();\n      dialog.find('#config-' + type).show();\n\n      // sequence\n      if (isTableRule && type !== 'sequence') {\n        dialog.find('#row-column').hide();\n        dialog.find('#rule-column').val('').prop('disabled', true);\n      } else {\n        dialog.find('#row-column').show();\n        // \n        if (dialog.find('#rule-table').val()) {\n          dialog.find('#rule-column').prop('disabled', false);\n        }\n      }\n    });\n\n    // /\n    dialog.find('#cfg-keyvalue-type').on('change', function () {\n      const valueType = $(this).val();\n      if (valueType === 'numeric') {\n        dialog.find('#row-keyvalue-range').show();\n      } else {\n        dialog.find('#row-keyvalue-range').hide();\n      }\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#dlg-rule-close, #dlg-rule-cancel', function (e) {\n      e.stopPropagation(); // \n      closeDialog();\n    });\n    setupOverlayClose(dialog, 'acu-validation-modal-overlay', () => {\n      closeDialog();\n    });\n\n    // \n    dialog.find('#dlg-rule-save').on('click', function () {\n      const name = dialog.find('#rule-name').val()?.trim();\n      const targetTable = dialog.find('#rule-table').val();\n      const targetColumn = dialog.find('#rule-column').val();\n      const ruleType = dialog.find('#rule-type').val();\n      const errorMessage = dialog.find('#rule-error-msg').val()?.trim();\n      const typeInfo = RULE_TYPE_INFO[ruleType];\n      const isTableRule = typeInfo?.scope === 'table';\n\n      // \n      if (!name) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!targetTable) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      // sequence\n      if ((!isTableRule || ruleType === 'sequence') && !targetColumn) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      const ruleConfig = {};\n      if (ruleType === 'tableReadonly') {\n        // \n      } else if (ruleType === 'rowLimit') {\n        const min = dialog.find('#cfg-row-min').val();\n        const max = dialog.find('#cfg-row-max').val();\n        if (min !== '') ruleConfig.min = parseInt(min, 10);\n        if (max !== '') ruleConfig.max = parseInt(max, 10);\n      } else if (ruleType === 'required') {\n        // \n      } else if (ruleType === 'format') {\n        const pattern = dialog.find('#cfg-pattern').val()?.trim();\n        if (!pattern) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        // \n        try {\n          new RegExp(pattern);\n        } catch (e) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n        ruleConfig.pattern = pattern;\n      } else if (ruleType === 'enum') {\n        const valuesStr = dialog.find('#cfg-values').val()?.trim();\n        if (!valuesStr) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        ruleConfig.values = valuesStr\n          .split(',')\n          .map(v => v.trim())\n          .filter(v => v);\n      } else if (ruleType === 'numeric') {\n        const min = dialog.find('#cfg-min').val();\n        const max = dialog.find('#cfg-max').val();\n        if (min !== '') ruleConfig.min = parseFloat(min);\n        if (max !== '') ruleConfig.max = parseFloat(max);\n      } else if (ruleType === 'relation') {\n        const refTable = dialog.find('#cfg-ref-table').val();\n        const refColumns = dialog.find('#cfg-ref-column').val(); // \n\n        if (!refTable) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        const selectedColumns = Array.isArray(refColumns) ? refColumns : refColumns ? [refColumns] : [];\n        if (selectedColumns.length === 0 || (selectedColumns.length === 1 && !selectedColumns[0])) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        ruleConfig.refTable = refTable;\n        // \n        ruleConfig.refColumn = selectedColumns.length === 1 ? selectedColumns[0] : selectedColumns;\n      } else if (ruleType === 'keyValue') {\n        const valueType = dialog.find('#cfg-keyvalue-type').val();\n        ruleConfig.valueType = valueType || 'text';\n\n        if (valueType === 'numeric') {\n          const min = dialog.find('#cfg-keyvalue-min').val();\n          const max = dialog.find('#cfg-keyvalue-max').val();\n          if (min !== '') ruleConfig.valueMin = parseFloat(min);\n          if (max !== '') ruleConfig.valueMax = parseFloat(max);\n        }\n      } else if (ruleType === 'sequence') {\n        const prefix = dialog.find('#cfg-sequence-prefix').val()?.trim() || '';\n        const startFrom = dialog.find('#cfg-sequence-start').val();\n        const pairedTable = dialog.find('#cfg-sequence-paired-table').val()?.trim() || null;\n        ruleConfig.prefix = prefix;\n        ruleConfig.startFrom = startFrom !== '' ? parseInt(startFrom, 10) : 1;\n        if (isNaN(ruleConfig.startFrom)) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        if (pairedTable) {\n          ruleConfig.pairedTable = pairedTable;\n        }\n      }\n\n      // IDID\n      const finalRuleId = isEditMode\n        ? editRuleId\n        : 'custom_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);\n\n      // \n      const ruleData = {\n        id: finalRuleId,\n        name: name,\n        description: existingRule?.description || '',\n        targetTable: targetTable,\n        targetColumn: isTableRule && ruleType !== 'sequence' ? '' : targetColumn, //  targetColumnsequence\n        ruleType: ruleType,\n        config: ruleConfig,\n        errorMessage: errorMessage || typeInfo?.desc || '',\n        intercept: existingRule?.intercept ?? false, // \n        enabled: existingRule?.enabled ?? true, // \n      };\n\n      let success = false;\n      if (isEditMode) {\n        // \n        success = ValidationRuleManager.updateCustomRule(editRuleId, ruleData);\n      } else {\n        // \n        success = ValidationRuleManager.addCustomRule(ruleData);\n      }\n\n      if (success) {\n        closeDialog();\n\n        // \n        ValidationRuleManager.clearCache();\n\n        // \n        const $rulesList = parentDialog.find('#validation-rules-list');\n\n        if (isEditMode) {\n          // \n          const $existingItem = $rulesList.find(`.acu-validation-rule-item[data-rule-id=\"${escapeHtml(editRuleId)}\"]`);\n          if ($existingItem.length) {\n            const hasIntercept = ruleData.intercept;\n            const isEnabled = ruleData.enabled;\n            $existingItem.find('.acu-rule-name').text(name);\n            $existingItem\n              .find('.acu-rule-target')\n              .text(`${targetTable}${isTableRule && ruleType !== 'sequence' ? ' ()' : '.' + targetColumn}`);\n            $existingItem\n              .find('.acu-rule-type-icon')\n              .attr('title', `${typeInfo?.name || ruleType}${isTableRule ? ' ()' : ''}`)\n              .find('i')\n              .attr('class', `fa-solid ${typeInfo?.icon || 'fa-question'}`);\n            $existingItem.toggleClass('disabled', !isEnabled);\n          }\n        } else {\n          // \n          const ruleHtml = `\n          <div class=\"acu-validation-rule-item\" data-rule-id=\"${escapeHtml(finalRuleId)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo?.name || ruleType)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo?.icon || 'fa-question'}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(targetTable)}${isTableRule && ruleType !== 'sequence' ? ' ()' : '.' + escapeHtml(targetColumn)}</div>\n            </div>\n            <div class=\"acu-rule-intercept\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n            <div class=\"acu-rule-toggle active\" title=\"/\">\n              <i class=\"fa-solid fa-toggle-on\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n        `;\n          $rulesList.append(ruleHtml);\n        }\n        // \n      } else {\n        if (window.toastr) window.toastr.error(isEditMode ? '' : '');\n      }\n    });\n\n    // \n    if (isEditMode && existingRule) {\n      dialog.find('#rule-name').val(existingRule.name || '');\n      dialog.find('#rule-error-msg').val(existingRule.errorMessage || '');\n\n      //  change \n      dialog\n        .find('#rule-table')\n        .val(existingRule.targetTable || '')\n        .trigger('change');\n\n      //  change \n      dialog\n        .find('#rule-type')\n        .val(existingRule.ruleType || 'required')\n        .trigger('change');\n\n      // / change \n      setTimeout(() => {\n        // \n        if (existingRule.targetColumn) {\n          dialog.find('#rule-column').val(existingRule.targetColumn);\n          updateSelectColor(dialog.find('#rule-column'));\n        }\n\n        // \n        const cfg = existingRule.config || {};\n        const ruleType = existingRule.ruleType;\n\n        if (ruleType === 'rowLimit') {\n          if (cfg.min !== undefined) dialog.find('#cfg-row-min').val(cfg.min);\n          if (cfg.max !== undefined) dialog.find('#cfg-row-max').val(cfg.max);\n        } else if (ruleType === 'sequence') {\n          dialog.find('#cfg-sequence-prefix').val(cfg.prefix || '');\n          dialog.find('#cfg-sequence-start').val(cfg.startFrom ?? 1);\n          if (cfg.pairedTable) {\n            dialog.find('#cfg-sequence-paired-table').val(cfg.pairedTable);\n            updateSelectColor(dialog.find('#cfg-sequence-paired-table'));\n          }\n        } else if (ruleType === 'format') {\n          dialog.find('#cfg-pattern').val(cfg.pattern || '');\n        } else if (ruleType === 'enum') {\n          dialog.find('#cfg-values').val((cfg.values || []).join(','));\n        } else if (ruleType === 'numeric') {\n          if (cfg.min !== undefined) dialog.find('#cfg-min').val(cfg.min);\n          if (cfg.max !== undefined) dialog.find('#cfg-max').val(cfg.max);\n        } else if (ruleType === 'relation') {\n          if (cfg.refTable) {\n            dialog.find('#cfg-ref-table').val(cfg.refTable).trigger('change');\n            // \n            setTimeout(() => {\n              const refColumns = Array.isArray(cfg.refColumn) ? cfg.refColumn : cfg.refColumn ? [cfg.refColumn] : [];\n              dialog.find('#cfg-ref-column').val(refColumns);\n              updateSelectColor(dialog.find('#cfg-ref-column'));\n              // \n              dialog.css('opacity', '1');\n            }, 100);\n            return; // relation  setTimeout \n          }\n        } else if (ruleType === 'keyValue') {\n          dialog\n            .find('#cfg-keyvalue-type')\n            .val(cfg.valueType || 'text')\n            .trigger('change');\n          if (cfg.valueMin !== undefined) dialog.find('#cfg-keyvalue-min').val(cfg.valueMin);\n          if (cfg.valueMax !== undefined) dialog.find('#cfg-keyvalue-max').val(cfg.valueMax);\n        }\n\n        // \n        dialog.css('opacity', '1');\n      }, 100);\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showSmartFixModal = error => {\n    if (!error || !error.rule) {\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const rule = error.rule;\n    const ruleType = error.ruleType || rule.ruleType;\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n    const isTableRule = typeInfo?.scope === 'table';\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const snapshot = loadSnapshot();\n\n    //  rowTitle\n    if (!error.rowTitle && error.rowIndex >= 0 && rawData && error.tableName) {\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          const row = rawData[sheetId].content?.[error.rowIndex + 1];\n          if (row) {\n            error.rowTitle = row[1] || row[0] || ` ${error.rowIndex + 1}`;\n          }\n          break;\n        }\n      }\n    }\n\n    // \n    let snapshotValue = '';\n    if (!isTableRule && snapshot && error.tableName && error.columnName !== undefined) {\n      for (const sheetId in snapshot) {\n        if (snapshot[sheetId]?.name === error.tableName) {\n          const headers = snapshot[sheetId].content?.[0] || [];\n          const colIdx = headers.indexOf(error.columnName);\n          const rowIdx = error.rowIndex + 1;\n          if (colIdx >= 0 && snapshot[sheetId].content?.[rowIdx]) {\n            snapshotValue = snapshot[sheetId].content[rowIdx][colIdx] ?? '';\n          }\n          break;\n        }\n      }\n    }\n\n    const hasSnapshotValue = snapshotValue !== '' && String(snapshotValue) !== String(error.currentValue || '');\n\n    // ========================================\n    // \n    // ========================================\n    if (isTableRule) {\n      showTableRuleFixModal(error, rule, ruleType, rawData, snapshot, currentThemeClass);\n      return;\n    }\n\n    // ========================================\n    // \n    // ========================================\n\n    // UI\n    let inputHtml = '';\n\n    if (ruleType === 'enum' && rule.config?.values) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'numeric') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'keyValue') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else {\n      // \n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    }\n\n    // \n    let smartSuggestHtml = '';\n\n    if (ruleType === 'required') {\n      // \n      const examples = getColumnExamples(error.tableName, error.columnName, error.rowIndex, rawData, 5);\n      if (examples.length > 0) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            <div class=\"acu-smart-fix-suggest-label\">\n              <i class=\"fa-solid fa-lightbulb\"></i> :\n            </div>\n            <div class=\"acu-smart-fix-suggest-options\">\n              ${examples\n                .map(\n                  val => `\n                <span class=\"acu-smart-fix-option\" data-value=\"${escapeHtml(val)}\" title=\"\">\n                  ${escapeHtml(val.length > 20 ? val.substring(0, 20) + '...' : val)}\n                </span>\n              `,\n                )\n                .join('')}\n            </div>\n          </div>\n        `;\n      }\n    } else if (ruleType === 'enum' && rule.config?.values) {\n      // \n      const validValues = rule.config.values;\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-list\"></i>  ():\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\">\n            ${validValues\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        </div>\n      `;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      // \n      // \n      let tableContent = null;\n      if (rawData && error.tableName) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            tableContent = rawData[sheetId];\n            break;\n          }\n        }\n      }\n      const suggestedValue = suggestFormatValue(rule.config.pattern, error.rowIndex, [], tableContent);\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-font\"></i> : <code>${escapeHtml(rule.config.pattern)}</code>\n          </div>\n          ${\n            suggestedValue\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:4px;display:block;\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </span>\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(suggestedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> ${escapeHtml(suggestedValue)}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'numeric') {\n      // \n      const min = rule.config?.min;\n      const max = rule.config?.max;\n      const currentNum = parseFloat(error.currentValue);\n      const isOutOfRange =\n        !isNaN(currentNum) && ((min !== undefined && currentNum < min) || (max !== undefined && currentNum > max));\n      const nearestValid = isOutOfRange ? getNearestValidNumber(error.currentValue, min, max) : null;\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-hashtag\"></i> : ${min !== undefined ? min : '-'} ~ ${max !== undefined ? max : '+'}\n          </div>\n          ${\n            isOutOfRange && nearestValid !== null\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${nearestValid}\">\n                <i class=\"fa-solid fa-arrow-right\"></i>  ${nearestValid}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      // \n      const options = getRelationOptions(rule.config.refTable, rule.config.refColumn, rawData);\n      const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n      const hasMultipleColumns = refColumns.length > 1;\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      const valueExists = isValueInRelationTable(\n        currentInvalidValue,\n        rule.config.refTable,\n        rule.config.refColumn,\n        rawData,\n      );\n\n      // HTML\n      let optionsHtml = '';\n      if (options.length > 0) {\n        optionsHtml = `\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-link\"></i>  \"${escapeHtml(rule.config.refTable)}\"  (${options.length}):\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\" id=\"smart-fix-options-container\">\n            ${options\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      // \n      let reverseWriteHtml = '';\n      if (currentInvalidValue && !valueExists) {\n        if (hasMultipleColumns) {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <select id=\"smart-fix-reverse-column\" class=\"acu-edit-select\" style=\"width:100%;margin-bottom:8px;\">\n                  ${refColumns.map(col => `<option value=\"${escapeHtml(col)}\">${escapeHtml(col)}</option>`).join('')}\n                </select>\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}\"\n                </button>\n              </div>\n            </div>\n          `;\n        } else {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" data-column=\"${escapeHtml(refColumns[0])}\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}.${escapeHtml(refColumns[0])}\"\n                </button>\n              </div>\n            </div>\n          `;\n        }\n      }\n\n      if (optionsHtml || reverseWriteHtml) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            ${optionsHtml}\n            ${reverseWriteHtml}\n          </div>\n        `;\n      }\n    } else if (ruleType === 'keyValue') {\n      // \n      const valueType = rule.config?.valueType || 'text';\n      const valueMin = rule.config?.valueMin;\n      const valueMax = rule.config?.valueMax;\n\n      // \n      let processedValue = String(error.currentValue || '');\n      processedValue = processedValue.replace(//g, ':').replace(//g, ';').replace(//g, ';').replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n      const issues = [];\n      const fixedPairs = [];\n\n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          issues.push({ pair, error: '/' });\n          continue;\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) {\n          issues.push({ pair, error: '' });\n          continue;\n        }\n\n        let fixedVal = val;\n        let hasIssue = false;\n\n        if (valueType === 'numeric') {\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) {\n            issues.push({ pair, error: `\"${val}\" ` });\n            hasIssue = true;\n          } else {\n            if (valueMin !== undefined && valueMin !== null && numVal < valueMin) {\n              fixedVal = String(valueMin);\n              issues.push({ pair, error: ` ${numVal}  ${valueMin}` });\n              hasIssue = true;\n            } else if (valueMax !== undefined && valueMax !== null && numVal > valueMax) {\n              fixedVal = String(valueMax);\n              issues.push({ pair, error: ` ${numVal}  ${valueMax}` });\n              hasIssue = true;\n            }\n          }\n        }\n\n        fixedPairs.push({ key, val: fixedVal, originalVal: val, hasIssue });\n      }\n\n      // \n      const fixedValue = fixedPairs.map(p => `${p.key}:${p.val}`).join(';');\n      const hasIssues = issues.length > 0 || fixedPairs.some(p => p.hasIssue);\n\n      let issuesHtml = '';\n      if (hasIssues) {\n        issuesHtml = `\n          <div class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:8px;\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i> :\n          </div>\n          <div style=\"margin-bottom:8px;\">\n            ${issues\n              .map(\n                issue => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(issue.pair)} - ${escapeHtml(issue.error)}\n              </div>\n            `,\n              )\n              .join('')}\n            ${fixedPairs\n              .filter(p => p.hasIssue)\n              .map(\n                p => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(p.key)}:${escapeHtml(p.originalVal)}  ${escapeHtml(p.val)}\n              </div>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-key\"></i> : :;:\n          </div>\n          ${\n            valueType === 'numeric'\n              ? `\n            <div class=\"acu-smart-fix-suggest-label\" style=\"margin-top:8px;\">\n              <i class=\"fa-solid fa-hashtag\"></i> : ${valueMin !== undefined ? valueMin : '-'} ~ ${valueMax !== undefined ? valueMax : '+'}\n            </div>\n          `\n              : ''\n          }\n          ${issuesHtml}\n          ${\n            hasIssues\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(fixedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> \n              </span>\n            </div>\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-card-bg);border-radius:4px;font-size:11px;color:var(--acu-text-sub);\">\n              <div style=\"margin-bottom:4px;\"><strong>:</strong></div>\n              <code style=\"color:var(--acu-success-text);\">${escapeHtml(fixedValue)}</code>\n            </div>\n          `\n              : `\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-success-bg);border-radius:4px;font-size:11px;color:var(--acu-success-text);\">\n              <i class=\"fa-solid fa-check-circle\"></i> \n            </div>\n          `\n          }\n        </div>\n      `;\n    }\n\n    // HTML\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} - ${escapeHtml(error.columnName || '')}</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            <!--  -->\n            <div class=\"acu-smart-fix-rule-info\">\n              <div class=\"acu-smart-fix-rule-header\">\n                <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                <span>${escapeHtml(error.ruleName || rule.name || '')}</span>\n              </div>\n              <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || typeInfo.desc || '')}</div>\n            </div>\n\n            <!--  -->\n            ${\n              hasSnapshotValue\n                ? `\n              <div class=\"acu-diff-section acu-diff-old-section\">\n                <div class=\"acu-diff-label\">\n                  <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                </div>\n                <div class=\"acu-diff-readonly\">${escapeHtml(snapshotValue)}</div>\n              </div>\n              <div class=\"acu-diff-arrow-down\"><i class=\"fa-solid fa-arrow-down\"></i></div>\n            `\n                : ''\n            }\n\n            <!--  -->\n            <div class=\"acu-diff-section acu-diff-new-section\">\n              ${\n                error.rowTitle && error.rowIndex >= 0\n                  ? `<div style=\"font-size:12px;color:var(--acu-text-sub);margin-bottom:8px;padding:4px 8px;background:var(--acu-bg-sub);border-radius:4px;\">\n                <i class=\"fa-solid fa-tag\" style=\"margin-right:4px;\"></i>${escapeHtml(error.rowTitle)}\n              </div>`\n                  : ''\n              }\n              <div class=\"acu-diff-label\">\n                <i class=\"fa-solid fa-pen\"></i> \n              </div>\n              ${inputHtml}\n            </div>\n\n            <!--  -->\n            ${\n              smartSuggestHtml\n                ? `\n              <div class=\"acu-smart-fix-suggest-section\">\n                ${smartSuggestHtml}\n              </div>\n            `\n                : ''\n            }\n          </div>\n          <div class=\"acu-dialog-btns\">\n            <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n            ${hasSnapshotValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n            <button class=\"acu-dialog-btn acu-btn-clear\" id=\"smart-fix-clear\"><i class=\"fa-solid fa-eraser\"></i> </button>\n            <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    dialog.on('click', '.acu-smart-fix-option, .acu-smart-fix-quick-btn', function () {\n      // \n      if ($(this).attr('id') === 'smart-fix-reverse-write-btn') return;\n      if ($(this).hasClass('acu-smart-fix-option-current')) return;\n      const optionValue = $(this).data('value') || $(this).text().trim();\n      dialog.find('#smart-fix-value').val(optionValue).trigger('input');\n    });\n\n    // \n    dialog.on('click', '#smart-fix-reverse-write-btn', async function () {\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      if (!currentInvalidValue) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      let targetColumn;\n      if (ruleType === 'relation' && rule.config?.refColumn) {\n        const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n        if (refColumns.length > 1) {\n          // \n          targetColumn = dialog.find('#smart-fix-reverse-column').val();\n        } else {\n          // data\n          targetColumn = $(this).data('column') || refColumns[0];\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      if (!targetColumn || !rule.config?.refTable) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      try {\n        const rawData = cachedRawData || getTableData();\n        let refSheet = null;\n        let refSheetId = null;\n\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === rule.config.refTable) {\n            refSheet = rawData[sheetId];\n            refSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!refSheet || !refSheet.content) {\n          if (window.toastr) window.toastr.error(` \"${rule.config.refTable}\"`);\n          return;\n        }\n\n        const headers = refSheet.content[0] || [];\n        const targetColIdx = headers.indexOf(targetColumn);\n\n        if (targetColIdx === -1) {\n          if (window.toastr) window.toastr.error(` \"${targetColumn}\"`);\n          return;\n        }\n\n        // \n        const newRow = new Array(headers.length).fill('');\n        newRow[targetColIdx] = currentInvalidValue;\n\n        // \n        refSheet.content.push(newRow);\n\n        // \n        await saveDataToDatabase(rawData, false, false);\n\n        // \n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-revert', function () {\n      dialog.find('#smart-fix-value').val(snapshotValue);\n    });\n\n    // \n    dialog.on('click', '#smart-fix-clear', function () {\n      dialog.find('#smart-fix-value').val('').trigger('input');\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-close, #smart-fix-cancel', closeDialog);\n    setupOverlayClose(dialog, 'acu-validation-modal-overlay', closeDialog);\n\n    // \n    dialog.find('#smart-fix-confirm').on('click', async function () {\n      const newValue = dialog.find('#smart-fix-value').val()?.trim() || '';\n\n      if (newValue === '' && ruleType === 'required') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      try {\n        const rawData = cachedRawData || getTableData();\n        let updated = false;\n\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            const sheet = rawData[sheetId];\n            const headers = sheet.content?.[0] || [];\n\n            if (error.rowIndex >= 0 && error.columnName) {\n              const colIdx = headers.indexOf(error.columnName);\n              const rowIdx = error.rowIndex + 1;\n\n              if (colIdx >= 0 && sheet.content && sheet.content[rowIdx]) {\n                sheet.content[rowIdx][colIdx] = newValue;\n                updated = true;\n                break;\n              }\n            }\n          }\n        }\n\n        if (updated) {\n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function extractCodesFromTable(sheet, columnName, prefix) {\n    if (!sheet || !sheet.content || sheet.content.length < 2) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const headers = sheet.content[0] || [];\n    const rows = sheet.content.slice(1) || [];\n    const colIndex = headers.indexOf(columnName);\n\n    if (colIndex < 0) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const codes = new Map(); // Map<, >\n    const allCodes = new Set(); // Set<>\n    const codeToRows = new Map(); // Map<, >\n\n    for (let i = 0; i < rows.length; i++) {\n      const value = rows[i]?.[colIndex];\n      if (value === null || value === undefined || value === '') continue;\n\n      const strValue = String(value).trim();\n      if (!strValue) continue;\n\n      // \n      let isValid = false;\n      if (prefix) {\n        const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          isValid = true;\n        }\n      } else {\n        const num = parseInt(strValue, 10);\n        if (!isNaN(num)) {\n          isValid = true;\n        }\n      }\n\n      if (isValid) {\n        allCodes.add(strValue);\n        if (!codeToRows.has(strValue)) {\n          codeToRows.set(strValue, []);\n        }\n        codeToRows.get(strValue).push(i);\n      }\n    }\n\n    return { codes, allCodes, codeToRows };\n  }\n\n  //   \n  function buildCodeMapping(codes1, codes2, prefix, startFrom) {\n    // \n    const allUniqueCodes = new Set([...codes1, ...codes2]);\n\n    // \n    const codeNumbers = [];\n    for (const code of allUniqueCodes) {\n      let num = null;\n      if (prefix) {\n        const match = code.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          num = parseInt(match[1], 10);\n        }\n      } else {\n        num = parseInt(code, 10);\n      }\n\n      if (!isNaN(num)) {\n        codeNumbers.push({ code, num });\n      }\n    }\n\n    // \n    codeNumbers.sort((a, b) => a.num - b.num);\n\n    //   \n    const mapping = new Map();\n    for (let i = 0; i < codeNumbers.length; i++) {\n      const oldCode = codeNumbers[i].code;\n      const newNum = startFrom + i;\n      const newCode = prefix + String(newNum).padStart(4, '0');\n      mapping.set(oldCode, newCode);\n    }\n\n    return mapping;\n  }\n\n  // \n  // \n  // 1. \n  // 2. \n  // 3. \n  function alignAndFixPairedTables(\n    table1Sheet,\n    table1SheetId,\n    table2Sheet,\n    table2SheetId,\n    columnName,\n    mapping,\n    prefix,\n    startFrom,\n    rawData,\n  ) {\n    if (!table1Sheet || !table2Sheet) return { fixedCount1: 0, fixedCount2: 0 };\n\n    const headers1 = table1Sheet.content[0] || [];\n    const rows1 = table1Sheet.content.slice(1) || [];\n    const colIndex1 = headers1.indexOf(columnName);\n\n    const headers2 = table2Sheet.content[0] || [];\n    const rows2 = table2Sheet.content.slice(1) || [];\n    const colIndex2 = headers2.indexOf(columnName);\n\n    if (colIndex1 < 0 || colIndex2 < 0) return { fixedCount1: 0, fixedCount2: 0 };\n\n    let fixedCount1 = 0;\n    let fixedCount2 = 0;\n\n    //  -> \n    const reverseMapping = new Map();\n    for (const [oldCode, newCode] of mapping.entries()) {\n      reverseMapping.set(newCode, oldCode);\n    }\n\n    // \n    const sortedNewCodes = Array.from(mapping.values()).sort((a, b) => {\n      const numA = parseInt(a.replace(prefix, ''), 10);\n      const numB = parseInt(b.replace(prefix, ''), 10);\n      return numA - numB;\n    });\n\n    // \n    const analyzeTable = (rows, colIndex) => {\n      const codeRows = []; // {rowIndex, oldCode, row}\n      const emptyRows = []; // {rowIndex, row, prevOldCode, nextOldCode}\n\n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        const strValue = value === null || value === undefined ? '' : String(value).trim();\n\n        // \n        let isValid = false;\n        if (strValue && prefix) {\n          const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          if (match) isValid = true;\n        } else if (strValue) {\n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) isValid = true;\n        }\n\n        if (isValid) {\n          codeRows.push({ rowIndex: i, oldCode: strValue, row: rows[i] });\n        } else {\n          emptyRows.push({ rowIndex: i, row: rows[i], prevOldCode: null, nextOldCode: null });\n        }\n      }\n\n      // \n      for (const emptyRow of emptyRows) {\n        let prevCode = null;\n        let nextCode = null;\n\n        for (const codeRow of codeRows) {\n          if (codeRow.rowIndex < emptyRow.rowIndex) {\n            prevCode = codeRow.oldCode;\n          }\n          if (codeRow.rowIndex > emptyRow.rowIndex && nextCode === null) {\n            nextCode = codeRow.oldCode;\n            break;\n          }\n        }\n\n        emptyRow.prevOldCode = prevCode;\n        emptyRow.nextOldCode = nextCode;\n      }\n\n      return { codeRows, emptyRows };\n    };\n\n    const analysis1 = analyzeTable(rows1, colIndex1);\n    const analysis2 = analyzeTable(rows2, colIndex2);\n\n    // \n    const buildNewRows = (analysis, headers, colIndex, allOldCodes) => {\n      const newRows = [];\n      const codeRowMap = new Map(); // oldCode -> row data\n\n      // \n      for (const cr of analysis.codeRows) {\n        codeRowMap.set(cr.oldCode, cr.row);\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n\n        if (codeRowMap.has(oldCode)) {\n          // \n          const oldRow = codeRowMap.get(oldCode);\n          const newRow = oldRow.map(cell => cell);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true });\n        } else {\n          // \n          const newRow = new Array(headers.length).fill(null);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true, isInserted: true });\n        }\n      }\n\n      // \n      //  prevOldCode  nextOldCode \n      const result = [];\n      let codeRowIndex = 0;\n\n      // \n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode === null && emptyRow.nextOldCode !== null) {\n          // \n          const nextNewCode = mapping.get(emptyRow.nextOldCode);\n          // \n          while (codeRowIndex < newRows.length && newRows[codeRowIndex].newCode !== nextNewCode) {\n            result.push(newRows[codeRowIndex].row);\n            codeRowIndex++;\n          }\n          result.push(emptyRow.row);\n        } else if (emptyRow.prevOldCode === null && emptyRow.nextOldCode === null) {\n          // \n          result.push(emptyRow.row);\n        }\n      }\n\n      // \n      for (; codeRowIndex < newRows.length; codeRowIndex++) {\n        result.push(newRows[codeRowIndex].row);\n        const currentNewCode = newRows[codeRowIndex].newCode;\n        const currentOldCode = reverseMapping.get(currentNewCode);\n\n        // \n        for (const emptyRow of analysis.emptyRows) {\n          if (emptyRow.prevOldCode === currentOldCode) {\n            result.push(emptyRow.row);\n          }\n        }\n      }\n\n      // prevOldCode nextOldCode  null\n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode !== null && emptyRow.nextOldCode === null) {\n          // \n        }\n      }\n\n      return result;\n    };\n\n    // \n    const newRows1 = buildNewRows(analysis1, headers1, colIndex1, new Set(analysis1.codeRows.map(r => r.oldCode)));\n    const newRows2 = buildNewRows(analysis2, headers2, colIndex2, new Set(analysis2.codeRows.map(r => r.oldCode)));\n\n    // \n    const countCodeChanges = (oldAnalysis, newRows, colIndex) => {\n      let count = 0;\n      // \n      const oldCodes = new Set(oldAnalysis.codeRows.map(r => r.oldCode));\n      const newCodes = new Set();\n\n      for (const row of newRows) {\n        const code = row[colIndex];\n        if (code) newCodes.add(code);\n      }\n\n      // \n      for (const [oldCode, newCode] of mapping.entries()) {\n        if (oldCodes.has(oldCode) && oldCode !== newCode) {\n          count++; // \n        }\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n        if (!oldCodes.has(oldCode)) {\n          count++; // \n        }\n      }\n\n      return count;\n    };\n\n    fixedCount1 = countCodeChanges(analysis1, newRows1, colIndex1);\n    fixedCount2 = countCodeChanges(analysis2, newRows2, colIndex2);\n\n    // \n    table1Sheet.content = [headers1, ...newRows1];\n    table2Sheet.content = [headers2, ...newRows2];\n\n    return { fixedCount1, fixedCount2 };\n  }\n\n  // \n  // ========================================\n  const showTableRuleFixModal = (error, rule, ruleType, rawData, snapshot, currentThemeClass) => {\n    const { $ } = getCore();\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n\n    let contentHtml = '';\n    let actionBtns = '';\n\n    if (ruleType === 'tableReadonly') {\n      // \n      let changeCount = 0;\n      let changeDetails = [];\n\n      if (snapshot && rawData) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            const newRows = rawData[sheetId].content?.slice(1) || [];\n            const oldRows = snapshot[sheetId].content?.slice(1) || [];\n\n            // \n            newRows.forEach((row, idx) => {\n              const oldRow = oldRows[idx];\n              if (!oldRow) {\n                changeDetails.push(`${idx + 1}: `);\n                changeCount++;\n              } else {\n                for (let c = 0; c < row.length; c++) {\n                  if (String(row[c] || '') !== String(oldRow[c] || '')) {\n                    changeDetails.push(`${idx + 1}: `);\n                    changeCount++;\n                    break;\n                  }\n                }\n              }\n            });\n\n            // \n            if (oldRows.length > newRows.length) {\n              for (let i = newRows.length; i < oldRows.length; i++) {\n                changeDetails.push(`${i + 1}: `);\n                changeCount++;\n              }\n            }\n            break;\n          }\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-lock\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\"></div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${changeCount}</strong> \n          </div>\n          ${\n            changeDetails.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\">\n              ${changeDetails\n                .slice(0, 10)\n                .map(d => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(d)}</div>`)\n                .join('')}\n              ${changeDetails.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${changeDetails.length - 10} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n      actionBtns = `\n        <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n        <button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-restore-table\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n      `;\n    } else if (ruleType === 'rowLimit') {\n      // \n      const minRows = rule.config?.min;\n      const maxRows = rule.config?.max;\n      let currentRowCount = 0;\n      let excessRows = [];\n\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          currentRowCount = (rawData[sheetId].content?.length || 1) - 1; // \n          break;\n        }\n      }\n\n      const isTooMany = maxRows !== undefined && currentRowCount > maxRows;\n      const isTooFew = minRows !== undefined && currentRowCount < minRows;\n\n      if (isTooMany) {\n        for (let i = maxRows + 1; i <= currentRowCount; i++) {\n          excessRows.push(i);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-arrows-up-down\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            : <strong>${currentRowCount}</strong> \n            ${minRows !== undefined || maxRows !== undefined ? ` | : ${minRows !== undefined ? minRows : 0} ~ ${maxRows !== undefined ? maxRows : ''} ` : ''}\n          </div>\n          ${\n            isTooMany && excessRows.length > 0\n              ? `\n            <div class=\"acu-smart-fix-excess-rows\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-trash\"></i>  ( ${excessRows[0]} ):\n              </div>\n              <div class=\"acu-smart-fix-change-list\">\n                ${excessRows\n                  .slice(0, 10)\n                  .map(r => `<div class=\"acu-smart-fix-change-item\"> ${r} </div>`)\n                  .join('')}\n                ${excessRows.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${excessRows.length} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n          ${\n            isTooFew\n              ? `\n            <div class=\"acu-smart-fix-hint\">\n              <i class=\"fa-solid fa-info-circle\"></i>  ${minRows - currentRowCount} \n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (isTooMany && excessRows.length > 0) {\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-delete-rows\" data-start=\"${maxRows}\" data-table=\"${escapeHtml(error.tableName)}\">\n            <i class=\"fa-solid fa-trash\"></i>  ${excessRows.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    } else if (ruleType === 'sequence' && rule.targetColumn) {\n      // \n      const prefix = rule.config?.prefix || '';\n      const startFrom = rule.config?.startFrom !== undefined ? rule.config?.startFrom : 1;\n      let targetSheet = null;\n      let issues = [];\n      let fixSuggestions = [];\n\n      // \n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (targetSheet && targetSheet.content && targetSheet.content.length > 1) {\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = headers.indexOf(rule.targetColumn);\n\n        if (colIndex >= 0) {\n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num, originalRowIndex: i + 2 }); // +2 +1\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          const numCountMap = new Map(); // \n          const duplicates = [];\n          const gaps = [];\n          const outOfOrder = [];\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const actualNum = numbers[i].num;\n            if (!numCountMap.has(actualNum)) {\n              numCountMap.set(actualNum, []);\n            }\n            numCountMap.get(actualNum).push(i);\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n\n            // \n            const occurrences = numCountMap.get(actualNum) || [];\n            if (occurrences.length > 1) {\n              // \n              if (occurrences[0] === i) {\n                duplicates.push({\n                  rowNum,\n                  value: numbers[i].value,\n                  num: actualNum,\n                  expectedNum,\n                  count: occurrences.length,\n                });\n              }\n            }\n\n            // \n            if (actualNum !== expectedNum) {\n              if (actualNum < expectedNum) {\n                // \n                outOfOrder.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              } else {\n                // \n                gaps.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              }\n            }\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n            const currentValue = numbers[i].value;\n            const fixedValue = prefix + String(expectedNum).padStart(4, '0');\n\n            if (actualNum !== expectedNum || duplicates.some(d => d.num === actualNum && d.rowNum === rowNum)) {\n              fixSuggestions.push({\n                rowNum,\n                currentValue,\n                fixedValue,\n                reason: actualNum < expectedNum ? '' : actualNum > expectedNum ? '' : '',\n              });\n            }\n          }\n\n          // \n          const issueSet = new Set();\n          duplicates.forEach(d => {\n            issueSet.add(`${d.rowNum}: \"${d.value}\"  (${d.count})`);\n          });\n          gaps.forEach(g => {\n            issueSet.add(\n              `${g.rowNum}: \"${g.value}\"  \"${prefix}${String(g.expectedNum).padStart(4, '0')}\" ()`,\n            );\n          });\n          outOfOrder.forEach(o => {\n            issueSet.add(\n              `${o.rowNum}: \"${o.value}\"  \"${prefix}${String(o.expectedNum).padStart(4, '0')}\" ()`,\n            );\n          });\n          issues = Array.from(issueSet);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-sort-numeric-up\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${issues.length}</strong> \n          </div>\n          ${\n            issues.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n              ${issues\n                .slice(0, 20)\n                .map(issue => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(issue)}</div>`)\n                .join('')}\n              ${issues.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${issues.length - 20} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n          ${\n            fixSuggestions.length > 0\n              ? `\n            <div class=\"acu-smart-fix-suggest\" style=\"margin-top:12px;\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </div>\n              <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n                ${fixSuggestions\n                  .slice(0, 20)\n                  .map(\n                    fix => `\n                  <div class=\"acu-smart-fix-change-item\">\n                    <span style=\"color:var(--acu-text-sub);\">${fix.rowNum}:</span>\n                    <span style=\"color:var(--acu-hl-manual);\">${escapeHtml(fix.currentValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);\">  </span>\n                    <span style=\"color:var(--acu-hl-auto);\">${escapeHtml(fix.fixedValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);font-size:11px;\"> (${escapeHtml(fix.reason)})</span>\n                  </div>\n                `,\n                  )\n                  .join('')}\n                ${fixSuggestions.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${fixSuggestions.length - 20} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (fixSuggestions.length > 0) {\n        // \n        const pairedTable =\n          rule.config?.pairedTable ||\n          (error.tableName === '' ? '' : error.tableName === '' ? '' : null);\n        const pairedTableAttr = pairedTable ? `data-paired-table=\"${escapeHtml(pairedTable)}\"` : '';\n\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-fix-sequence\" data-table=\"${escapeHtml(error.tableName)}\" data-column=\"${escapeHtml(rule.targetColumn)}\" data-prefix=\"${escapeHtml(prefix)}\" data-start=\"${startFrom}\" ${pairedTableAttr}>\n            <i class=\"fa-solid fa-magic\"></i>  ${fixSuggestions.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    }\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} ()</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            ${contentHtml}\n          </div>\n          <div class=\"acu-dialog-btns\">\n            ${actionBtns}\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-cancel', closeDialog);\n    setupOverlayClose(dialog, 'acu-validation-modal-overlay', closeDialog);\n\n    // \n    dialog.on('click', '#smart-fix-restore-table', async function () {\n      if (!snapshot) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      try {\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            rawData[sheetId] = JSON.parse(JSON.stringify(snapshot[sheetId]));\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-fix-sequence', async function () {\n      const $btn = $(this);\n      const tableName = $btn.data('table');\n      const columnName = $btn.data('column');\n      const prefix = $btn.data('prefix') || '';\n      const startFrom = parseInt($btn.data('start') || '1', 10);\n      const pairedTableName = $btn.data('paired-table') || null;\n\n      try {\n        $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n\n        // \n        let targetSheet = null;\n        let targetSheetId = null;\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            targetSheet = rawData[sheetId];\n            targetSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = headers.indexOf(columnName);\n\n        if (colIndex < 0) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        // \n        if (pairedTableName) {\n          // \n          let pairedSheet = null;\n          let pairedSheetId = null;\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === pairedTableName) {\n              pairedSheet = rawData[sheetId];\n              pairedSheetId = sheetId;\n              break;\n            }\n          }\n\n          if (!pairedSheet || !pairedSheet.content || pairedSheet.content.length < 1) {\n            if (window.toastr) window.toastr.warning(`: ${pairedTableName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          const pairedHeaders = pairedSheet.content[0] || [];\n          const pairedColIndex = pairedHeaders.indexOf(columnName);\n\n          if (pairedColIndex < 0) {\n            if (window.toastr) window.toastr.warning(`: ${columnName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          // \n          const extract1 = extractCodesFromTable(targetSheet, columnName, prefix);\n          const extract2 = extractCodesFromTable(pairedSheet, columnName, prefix);\n\n          // \n          const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n          // \n          const { fixedCount1, fixedCount2 } = alignAndFixPairedTables(\n            targetSheet,\n            targetSheetId,\n            pairedSheet,\n            pairedSheetId,\n            columnName,\n            mapping,\n            prefix,\n            startFrom,\n            rawData,\n          );\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          // \n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num });\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          let fixedCount = 0;\n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowIndex = numbers[i].rowIndex;\n\n            if (actualNum !== expectedNum) {\n              const fixedValue = prefix + String(expectedNum).padStart(4, '0');\n              rows[rowIndex][colIndex] = fixedValue;\n              fixedCount++;\n            }\n          }\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n        $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-delete-rows', async function () {\n      const startRow = parseInt($(this).data('start'), 10);\n      const tableName = $(this).data('table');\n\n      try {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            // (index 0) startRow (index 1  startRow)\n            rawData[sheetId].content = rawData[sheetId].content.slice(0, startRow + 1);\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const showBlacklistManagerModal = () => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const theme = getThemeColors();\n    const t = theme;\n\n    $('.acu-blacklist-manager-overlay').remove();\n\n    const blacklist = BlacklistManager.getBlacklist();\n\n    const modalHtml = `\n      <div class=\"acu-blacklist-manager-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width: 600px; width: 90%;\">\n          <div class=\"acu-edit-title\" style=\"position: relative;\">\n            <i class=\"fa-solid fa-filter\"></i> \n            <button class=\"acu-close-btn\" style=\"position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: ${t.textMain}; cursor: pointer; font-size: 18px; z-index: 10;\">\n              <i class=\"fa-solid fa-times\"></i>\n            </button>\n          </div>\n          <div class=\"acu-settings-content\" style=\"flex: 1; overflow-y: auto; padding: 20px;\">\n            <div style=\"margin-bottom: 15px;\">\n              <div style=\"margin-bottom: 8px; font-size: 12px; color: ${t.textSub};\">\n                \n              </div>\n              <textarea id=\"blacklist-textarea\" style=\"width: 100%; min-height: 120px; max-height: 300px; padding: 10px !important; border: 1px solid ${t.border} !important; border-radius: 4px !important; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-size: 13px !important; box-sizing: border-box !important; resize: vertical; font-family: monospace; line-height: 1.5;\" placeholder=\"\"></textarea>\n              <div style=\"display: flex; gap: 8px; margin-top: 8px; flex-wrap: nowrap;\">\n                <input type=\"text\" id=\"blacklist-input\" placeholder=\"...\" style=\"flex: 1; min-width: 0; padding: 8px !important; border: 1px solid ${t.border} !important; border-radius: 4px !important; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-size: 13px !important; box-sizing: border-box !important;\">\n                <button id=\"blacklist-add-btn\" style=\"padding: 8px 16px; background: ${t.accent}; color: ${t.buttonTextOnAccent || t.textMain || '#6B4A5A'}; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; white-space: nowrap; flex-shrink: 0;\">\n                  <i class=\"fa-solid fa-plus\"></i> \n                </button>\n              </div>\n            </div>\n            <div style=\"display: flex; gap: 8px; margin-top: 15px;\">\n              <button id=\"blacklist-reset-btn\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; color: ${t.textMain}; border: 1px solid ${t.border}; border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-undo\"></i> \n              </button>\n              <button id=\"blacklist-close-btn\" style=\"flex: 1; padding: 10px; background: ${t.accent}; color: ${t.buttonTextOnAccent || t.textMain || '#6B4A5A'}; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-check\"></i> \n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '31300',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    // textarea\n    const updateTextarea = () => {\n      const blacklist = BlacklistManager.getBlacklist();\n      const $textarea = $modal.find('#blacklist-textarea');\n      $textarea.val(blacklist.join(''));\n    };\n\n    // textareaBlacklistManager\n    const syncFromTextarea = () => {\n      const $textarea = $modal.find('#blacklist-textarea');\n      const text = $textarea.val().trim();\n      if (!text) {\n        BlacklistManager.setBlacklist([]);\n        return;\n      }\n      // \n      const items = text\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n      // \n      const uniqueItems = [...new Set(items)];\n      BlacklistManager.setBlacklist(uniqueItems);\n      // textarea\n      if (uniqueItems.length !== items.length) {\n        updateTextarea();\n      }\n    };\n\n    // textarea\n    updateTextarea();\n\n    // textarea\n    $modal.find('#blacklist-textarea').on('input', function () {\n      syncFromTextarea();\n    });\n\n    // \n    $modal.find('#blacklist-add-btn').click(function () {\n      const input = $modal.find('#blacklist-input');\n      const value = input.val().trim();\n      if (!value) return;\n\n      // \n      const newItems = value\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n\n      if (newItems.length === 0) return;\n\n      const blacklist = BlacklistManager.getBlacklist();\n      const existingSet = new Set(blacklist);\n      const addedItems = [];\n\n      newItems.forEach(item => {\n        if (!existingSet.has(item)) {\n          blacklist.push(item);\n          existingSet.add(item);\n          addedItems.push(item);\n        }\n      });\n\n      if (addedItems.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      BlacklistManager.setBlacklist(blacklist);\n      input.val('');\n      updateTextarea();\n    });\n\n    $modal.find('#blacklist-input').on('keypress', function (e) {\n      if (e.which === 13) {\n        $modal.find('#blacklist-add-btn').click();\n      }\n    });\n\n    $modal.find('#blacklist-reset-btn').click(function () {\n      if (confirm('')) {\n        BlacklistManager.resetToDefault();\n        updateTextarea();\n      }\n    });\n\n    const closeModal = () => {\n      $modal.remove();\n      // \n      renderInterface();\n    };\n\n    $modal.find('#blacklist-close-btn, .acu-close-btn').click(closeModal);\n    setupOverlayClose($modal, 'acu-blacklist-manager-overlay', closeModal);\n  };\n\n  const showAttributePresetManager = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const presets = AttributePresetManager.getAllPresets();\n    const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n\n    // HTMLactiveIdnull\n    const isDefaultActive = activeId === null;\n    const defaultPresetHtml = `\n      <div class=\"acu-preset-item\" data-id=\"__default__\">\n        <div class=\"acu-preset-info\">\n          <div class=\"acu-preset-name\">\n            \n            <span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>\n          </div>\n          <div class=\"acu-preset-desc\">5-95</div>\n          <div class=\"acu-preset-stats\">\n            : 6 | : 0\n          </div>\n        </div>\n        <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n          <label class=\"acu-toggle\" style=\"margin: 0;\">\n            <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"__default__\" ${isDefaultActive ? 'checked' : ''}>\n            <span class=\"acu-toggle-slider\"></span>\n          </label>\n        </div>\n      </div>\n    `;\n\n    // HTML\n    const presetsHtml = presets\n      .map(preset => {\n        const isActive = preset.id === activeId;\n        const isBuiltin = preset.builtin;\n\n        return `\n        <div class=\"acu-preset-item\" data-id=\"${preset.id}\">\n          <div class=\"acu-preset-info\">\n            <div class=\"acu-preset-name\">\n              ${escapeHtml(preset.name)}\n              ${isBuiltin ? `<span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>` : ''}\n            </div>\n            ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n            <div class=\"acu-preset-stats\">\n              : ${preset.baseAttributes.length} | : ${preset.specialAttributes?.length || 0}\n            </div>\n          </div>\n          <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n            <label class=\"acu-toggle\" style=\"margin: 0;\">\n              <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"${preset.id}\" ${isActive ? 'checked' : ''}>\n              <span class=\"acu-toggle-slider\"></span>\n            </label>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>` : ''}\n            <button class=\"acu-preset-btn acu-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: #e74c3c;\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n          </div>\n        </div>\n      `;\n      })\n      .join('');\n\n    // \n    const allPresetsHtml = defaultPresetHtml + presetsHtml;\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 80vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-dice-d20\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div id=\"acu-presets-list\">\n              ${allPresetsHtml || `<div style=\"text-align: center; padding: 40px; color: ${t.textSub};\"></div>`}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"acu-preset-new\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-preset-import\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-preset-back\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n\n          <input type=\"file\" id=\"acu-preset-file-input\" accept=\".json\" style=\"display: none;\" />\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn, #acu-preset-back').on('click', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n\n    // Toggle\n    overlay.on('change', '.acu-preset-toggle', function () {\n      const $toggle = $(this);\n      const id = $toggle.data('id');\n      const isChecked = $toggle.is(':checked');\n\n      if (isChecked) {\n        // id\"__default__\"null\n        const finalId = id === '__default__' ? null : id;\n        AttributePresetManager.setActivePreset(finalId);\n\n        // toggle\n        overlay.find('.acu-preset-toggle').each(function () {\n          const $thisToggle = $(this);\n          const thisId = $thisToggle.data('id');\n          if (thisId !== id) {\n            $thisToggle.prop('checked', false);\n          }\n        });\n      } else {\n        // null\n        AttributePresetManager.setActivePreset(null);\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showAttributePresetEditor(id);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-export', function () {\n      const id = $(this).data('id');\n      const json = AttributePresetManager.exportPreset(id);\n      if (!json) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      const preset = presets.find(p => p.id === id);\n      const filename = `acu_preset_${preset?.name || id}_${Date.now()}.json`;\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        const success = AttributePresetManager.deletePreset(id);\n        if (success) {\n          overlay.remove();\n          showAttributePresetManager();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      }\n    });\n\n    // \n    overlay.find('#acu-preset-new').on('click', () => {\n      overlay.remove();\n      showAttributePresetEditor();\n    });\n\n    // \n    overlay.find('#acu-preset-import').on('click', () => {\n      overlay.find('#acu-preset-file-input').click();\n    });\n\n    overlay.find('#acu-preset-file-input').on('change', function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      const reader = new FileReader();\n      reader.onload = evt => {\n        try {\n          const jsonStr = evt.target.result as string;\n          if (!jsonStr?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(jsonStr.trim());\n          } catch {\n            if (window.toastr) window.toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.name || '';\n          const existingPresets = AttributePresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = jsonStr.trim();\n            if (newName) {\n              parsedData.name = newName;\n              // IDID\n              parsedData.id = `attr_preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset && !existingPreset.builtin) {\n                AttributePresetManager.deletePreset(existingPreset.id);\n              }\n            }\n\n            const imported = AttributePresetManager.importPreset(finalJson);\n            if (imported) {\n              overlay.remove();\n              showAttributePresetManager();\n            } else {\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      };\n      reader.readAsText(file);\n\n      // \n      $(this).val('');\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n  };\n\n  // \n  const showAttributePresetEditor = (presetId = null) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? AttributePresetManager.getAllPresets().find(p => p.id === presetId) : null;\n\n    // \n    const defaultData = {\n      name: existingPreset?.name || '',\n      description: existingPreset?.description || '',\n      baseAttributes: existingPreset?.baseAttributes || [\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n      ],\n      specialAttributes: existingPreset?.specialAttributes || [],\n    };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 650px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-pen\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 8px;\">\n                JSON <span style=\"font-size: 10px; color: ${t.textSub};\">()</span>\n              </label>\n              <textarea id=\"preset-json\" class=\"acu-preset-editor-textarea\" style=\"width: 100%; height: 320px; padding: 10px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-family: 'Consolas', 'Monaco', monospace !important; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: ${t.textSub}; padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n               baseAttributes:  nameformularangemodifier()<br/>\n               specialAttributes:  nameformularange()<br/>\n               : 3d6, 4d6kh3, (/2), (+-*/)\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"preset-save\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"preset-cancel\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#preset-json');\n\n    // JSON\n    const updateJSON = () => {\n      const data = {\n        baseAttributes: defaultData.baseAttributes,\n        specialAttributes: defaultData.specialAttributes,\n      };\n      $jsonTextarea.val(JSON.stringify(data, null, 2));\n    };\n    updateJSON();\n\n    // \n    overlay.find('.acu-close-btn, #preset-cancel').on('click', () => {\n      overlay.remove();\n      showAttributePresetManager();\n    });\n\n    // \n    overlay.find('#preset-save').on('click', () => {\n      try {\n        const name = overlay.find('#preset-name').val().trim();\n        const description = overlay.find('#preset-desc').val().trim();\n        const jsonStr = $jsonTextarea.val().trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const jsonData = JSON.parse(jsonStr);\n\n        // \n        if (\n          !jsonData.baseAttributes ||\n          !Array.isArray(jsonData.baseAttributes) ||\n          jsonData.baseAttributes.length === 0\n        ) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n\n        // \n        const preset = {\n          format: 'acu_attr_preset_v1',\n          version: 1,\n          id: presetId || `custom_${Date.now()}`,\n          name,\n          description,\n          baseAttributes: jsonData.baseAttributes,\n          specialAttributes: jsonData.specialAttributes || [],\n        };\n\n        // \n        if (isEdit) {\n          AttributePresetManager.updatePreset(presetId, preset);\n        } else {\n          AttributePresetManager.createPreset(preset);\n        }\n\n        overlay.remove();\n        showAttributePresetManager();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + (err.message || 'JSON'));\n      }\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showActionPresetManager = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const presets = ActionPresetManager.getAllPresets();\n    const activeId = ActionPresetManager.getActivePresetId();\n\n    // HTML\n    const presetsHtml =\n      presets.length === 0\n        ? `<div style=\"text-align: center; padding: 40px; color: ${t.textSub};\"></div>`\n        : presets\n            .map(preset => {\n              const isActive = preset.id === activeId;\n              const isBuiltin = (preset as any).builtin === true;\n              const keywordsSummary =\n                (preset.rules || [])\n                  .flatMap(r => r.table_keywords || [])\n                  .slice(0, 3)\n                  .join('') || '';\n              const actionsSummary =\n                (preset.rules || [])\n                  .flatMap(r => (r.actions || []).map(a => a.label))\n                  .slice(0, 4)\n                  .join('') || '';\n\n              return `\n          <div class=\"acu-preset-item\" data-id=\"${preset.id}\">\n            <div class=\"acu-preset-info\">\n              <div class=\"acu-preset-name\">${escapeHtml(preset.name)}${isBuiltin ? `<span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>` : ''}</div>\n              ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n              <div class=\"acu-preset-stats\" style=\"font-size: 11px; color: ${t.textSub};\">\n                : ${escapeHtml(keywordsSummary)} | : ${escapeHtml(actionsSummary)}\n              </div>\n            </div>\n            <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n              <label class=\"acu-toggle\" style=\"margin: 0;\">\n                <input type=\"checkbox\" class=\"acu-action-preset-toggle\" data-id=\"${preset.id}\" ${isActive ? 'checked' : ''}>\n                <span class=\"acu-toggle-slider\"></span>\n              </label>\n              ${\n                isBuiltin\n                  ? `<button class=\"acu-preset-btn acu-action-preset-copy\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-copy\"></i></button>`\n                  : `<button class=\"acu-preset-btn acu-action-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>`\n              }\n              <button class=\"acu-preset-btn acu-action-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n              ${!isBuiltin ? `<button class=\"acu-preset-btn acu-action-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: #e74c3c;\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n            </div>\n          </div>\n        `;\n            })\n            .join('');\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 80vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-wand-magic-sparkles\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div id=\"acu-action-presets-list\">\n              ${presetsHtml}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"acu-action-preset-new\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-action-preset-import\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-action-preset-back\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn, #acu-action-preset-back').on('click', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n\n    // Toggle\n    overlay.on('change', '.acu-action-preset-toggle', function () {\n      const $toggle = $(this);\n      const id = $toggle.data('id');\n      const isChecked = $toggle.is(':checked');\n\n      if (isChecked) {\n        ActionPresetManager.setActivePresetId(id);\n        // toggle\n        overlay.find('.acu-action-preset-toggle').each(function () {\n          if ($(this).data('id') !== id) {\n            $(this).prop('checked', false);\n          }\n        });\n      } else {\n        // \n        if (ActionPresetManager.getActivePresetId() === id) {\n          ActionPresetManager.setActivePresetId(null);\n          if (window.toastr) window.toastr.info('');\n        }\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showActionPresetEditor(id);\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-export', function () {\n      const id = $(this).data('id');\n      const json = ActionPresetManager.exportPreset(id);\n      if (!json) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      // \n      navigator.clipboard\n        .writeText(json)\n        .then(() => {\n          if (window.toastr) window.toastr.success('');\n        })\n        .catch(() => {\n          // textarea\n          const ta = document.createElement('textarea');\n          ta.value = json;\n          document.body.appendChild(ta);\n          ta.select();\n          document.execCommand('copy');\n          document.body.removeChild(ta);\n          if (window.toastr) window.toastr.success('');\n        });\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-copy', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return;\n\n      const copyData = {\n        name: preset.name + ' ()',\n        description: preset.description || '',\n        rules: JSON.parse(JSON.stringify(preset.rules)),\n      };\n\n      const newPreset = ActionPresetManager.createPreset(copyData);\n      if (newPreset) {\n        if (window.toastr)\n          window.toastr.success(`${newPreset.name} ${newPreset.rules.length} `);\n        overlay.remove();\n        showActionPresetManager(); // \n      }\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        const success = ActionPresetManager.deletePreset(id);\n        if (success) {\n          overlay.remove();\n          showActionPresetManager();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      }\n    });\n\n    // \n    overlay.find('#acu-action-preset-new').on('click', () => {\n      overlay.remove();\n      showActionPresetEditor();\n    });\n\n    // \n    overlay.find('#acu-action-preset-import').on('click', () => {\n      const jsonStr = prompt('JSON:');\n      if (!jsonStr?.trim()) return;\n\n      const result = ActionPresetManager.importPreset(jsonStr.trim());\n      if (result) {\n        if (window.toastr) window.toastr.success(`${result.name}`);\n        overlay.remove();\n        showActionPresetManager();\n      } else {\n        if (window.toastr) window.toastr.error('JSON');\n      }\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n  };\n\n  // JSON\n  const showActionPresetEditor = (presetId?: string) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? ActionPresetManager.getPresetById(presetId) : null;\n\n    // \n    const defaultData = {\n      name: existingPreset?.name || '',\n      description: existingPreset?.description || '',\n      rules: existingPreset?.rules || [\n        {\n          table_keywords: [''],\n          actions: [{ label: '', template: '<user>{Name}:' }],\n        },\n      ],\n    };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 700px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-wand-magic-sparkles\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"action-preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border}; border-radius: 6px; background: ${t.inputBg}; color: ${t.textMain}; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"action-preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border}; border-radius: 6px; background: ${t.inputBg}; color: ${t.textMain}; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 8px;\">\n                 <span style=\"font-size: 10px; color: ${t.textSub};\">(JSON)</span>\n              </label>\n              <textarea id=\"action-preset-json\" style=\"width: 100%; height: 300px; padding: 10px; border: 1px solid ${t.border}; border-radius: 6px; background: ${t.inputBg}; color: ${t.textMain}; font-family: 'Consolas', 'Monaco', monospace; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: ${t.textSub}; padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n                table_keywords actions<br/>\n                label template{Name}<br/>\n               : { \"table_keywords\": [\"\"], \"actions\": [{ \"label\": \"\", \"template\": \"<user>{Name}\" }] }\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"action-preset-save\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"action-preset-cancel\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#action-preset-json');\n\n    // JSON rules \n    $jsonTextarea.val(JSON.stringify(defaultData.rules, null, 2));\n\n    // \n    overlay.find('.acu-close-btn, #action-preset-cancel').on('click', () => {\n      overlay.remove();\n      showActionPresetManager();\n    });\n\n    // \n    overlay.find('#action-preset-save').on('click', () => {\n      try {\n        const name = (overlay.find('#action-preset-name').val() as string).trim();\n        const description = (overlay.find('#action-preset-desc').val() as string).trim();\n        const jsonStr = ($jsonTextarea.val() as string).trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const rules = JSON.parse(jsonStr);\n\n        // \n        if (!Array.isArray(rules) || rules.length === 0) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n\n        // \n        for (let i = 0; i < rules.length; i++) {\n          const rule = rules[i];\n          if (!rule.table_keywords || !Array.isArray(rule.table_keywords) || rule.table_keywords.length === 0) {\n            if (window.toastr) window.toastr.error(` ${i + 1}  table_keywords`);\n            return;\n          }\n          if (!rule.actions || !Array.isArray(rule.actions) || rule.actions.length === 0) {\n            if (window.toastr) window.toastr.error(` ${i + 1}  actions`);\n            return;\n          }\n        }\n\n        if (isEdit && presetId) {\n          // \n          ActionPresetManager.updatePreset(presetId, { name, description, rules });\n          if (window.toastr) window.toastr.success('');\n        } else {\n          // \n          ActionPresetManager.createPreset({ name, description, rules });\n          if (window.toastr) window.toastr.success('');\n        }\n\n        overlay.remove();\n        showActionPresetManager();\n      } catch (e) {\n        if (window.toastr) window.toastr.error('JSON : ' + (e as Error).message);\n      }\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      showActionPresetManager();\n    });\n  };\n  // ========================================\n  const showDebugConsoleModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-debug-console-dialog)').remove();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const t = getThemeColors();\n\n    // localStorage\n    const savedFilters = Store.get('acu_debug_filters', { log: true, info: true, warn: true, error: true });\n    ConsoleCaptureManager.setFilters(savedFilters);\n\n    const renderLogs = () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      const $logContainer = dialog.find('.acu-debug-log-container');\n      $logContainer.empty();\n\n      if (filteredLogs.length === 0) {\n        $logContainer.html(\n          '<div style=\"text-align:center;padding:40px;color:var(--acu-text-sub);\"><i class=\"fa-solid fa-inbox\"></i><br/></div>',\n        );\n        return;\n      }\n\n      filteredLogs.forEach(log => {\n        const typeColors = {\n          error: '#e74c3c',\n          warn: '#f39c12',\n          info: '#3498db',\n          log: '#95a5a6',\n        };\n        const typeIcons = {\n          error: 'fa-exclamation-circle',\n          warn: 'fa-exclamation-triangle',\n          info: 'fa-info-circle',\n          log: 'fa-circle',\n        };\n        const color = typeColors[log.type] || typeColors.log;\n        const icon = typeIcons[log.type] || typeIcons.log;\n\n        const logItem = $(`\n          <div class=\"acu-debug-log-item\" data-type=\"${log.type}\" style=\"padding:8px 12px;border-bottom:1px solid var(--acu-border);font-family:monospace;font-size:12px;line-height:1.5;\">\n            <div style=\"display:flex;align-items:flex-start;gap:8px;\">\n              <span style=\"color:${color};min-width:60px;font-size:11px;\">\n                <i class=\"fa-solid ${icon}\"></i> [${log.timeStr}]\n              </span>\n              <span style=\"color:${color};min-width:50px;font-size:11px;text-transform:uppercase;\">[${log.type}]</span>\n              <span style=\"flex:1;color:var(--acu-text-main);word-break:break-word;white-space:pre-wrap;\">${escapeHtml(log.content)}</span>\n            </div>\n            ${log.stack ? `<div style=\"margin-top:4px;margin-left:128px;color:var(--acu-text-sub);font-size:11px;white-space:pre-wrap;font-family:monospace;\">${escapeHtml(log.stack)}</div>` : ''}\n          </div>\n        `);\n        $logContainer.append(logItem);\n      });\n    };\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-debug-console-dialog ${currentThemeClass}\" style=\"max-width:90vw;max-height:90vh;width:800px;height:600px;display:flex;flex-direction:column;\">\n          <div class=\"acu-settings-header\" style=\"flex-shrink:0;\">\n            <div class=\"acu-settings-title\"><i class=\"fa-solid fa-bug\"></i> Debug</div>\n            <button class=\"acu-close-btn\" id=\"debug-console-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex:1;display:flex;flex-direction:column;overflow:hidden;\">\n            <!--  -->\n            <div style=\"padding:12px;border-bottom:1px solid var(--acu-border);flex-shrink:0;display:flex;flex-direction:column;gap:8px;\">\n              <!-- Console -->\n              <div style=\"display:flex;align-items:center;gap:8px;padding-bottom:8px;border-bottom:1px solid var(--acu-border);\">\n                <span style=\"font-size:12px;color:var(--acu-text-sub);flex:1;\">Console:</span>\n                <label class=\"acu-toggle\">\n                  <input type=\"checkbox\" id=\"debug-console-capture-toggle\" ${ConsoleCaptureManager.enabled ? 'checked' : ''}>\n                  <span class=\"acu-toggle-slider\"></span>\n                </label>\n                <span id=\"debug-console-capture-status\" style=\"font-size:11px;color:var(--acu-text-sub);\">${ConsoleCaptureManager.enabled ? '' : ''}</span>\n              </div>\n              <!--  -->\n              <div style=\"display:flex;flex-wrap:wrap;gap:8px;align-items:center;\">\n                <div style=\"display:flex;gap:8px;align-items:center;flex:1;\">\n                  <span style=\"font-size:12px;color:var(--acu-text-sub);\">:</span>\n                  <button class=\"acu-btn ${savedFilters.log ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"log\" style=\"padding:4px 10px;font-size:12px;${savedFilters.log ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Log</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.info ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"info\" style=\"padding:4px 10px;font-size:12px;${savedFilters.info ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Info</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.warn ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"warn\" style=\"padding:4px 10px;font-size:12px;${savedFilters.warn ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Warn</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.error ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"error\" style=\"padding:4px 10px;font-size:12px;${savedFilters.error ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Error</span>\n                  </button>\n                </div>\n                <div style=\"display:flex;gap:6px;\">\n                  <button class=\"acu-btn acu-btn-secondary\" id=\"debug-console-clear\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-trash\"></i> \n                  </button>\n                  <button class=\"acu-btn acu-btn-secondary\" id=\"debug-console-copy\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-copy\"></i> \n                  </button>\n                  <button class=\"acu-btn acu-btn-primary\" id=\"debug-console-export\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-download\"></i> \n                  </button>\n                </div>\n              </div>\n            </div>\n\n            <!--  -->\n            <div class=\"acu-debug-log-scroll\" style=\"flex:1;overflow-y:auto;overflow-x:hidden;background:var(--acu-card-bg);\">\n              <div class=\"acu-debug-log-container\"></div>\n            </div>\n\n            <!--  -->\n            <div style=\"padding:8px 12px;border-top:1px solid var(--acu-border);flex-shrink:0;font-size:11px;color:var(--acu-text-sub);display:flex;justify-content:space-between;\">\n              <span>: <span id=\"debug-total-count\">0</span> | : <span id=\"debug-filtered-count\">0</span></span>\n            </div>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const updateCounts = () => {\n      const total = ConsoleCaptureManager.logs.length;\n      const filtered = ConsoleCaptureManager.getFilteredLogs().length;\n      dialog.find('#debug-total-count').text(total);\n      dialog.find('#debug-filtered-count').text(filtered);\n    };\n\n    // \n    renderLogs();\n    updateCounts();\n\n    // Console\n    dialog.find('#debug-console-capture-toggle').on('change', function () {\n      const checked = $(this).is(':checked');\n      const $status = dialog.find('#debug-console-capture-status');\n      if (checked) {\n        ConsoleCaptureManager.enable();\n        $status.text('');\n        // \n        console.log('[DICE]Debug');\n      } else {\n        ConsoleCaptureManager.disable();\n        $status.text('');\n      }\n    });\n\n    // \n    dialog.find('[data-filter-type]').on('click', function () {\n      const type = $(this).data('filter-type');\n      const isActive = $(this).hasClass('acu-btn-primary');\n      const newState = !isActive;\n\n      // \n      if (newState) {\n        $(this).removeClass('acu-btn-secondary').addClass('acu-btn-primary');\n        $(this).css('opacity', '1');\n      } else {\n        $(this).removeClass('acu-btn-primary').addClass('acu-btn-secondary');\n        $(this).css('opacity', '0.5');\n      }\n\n      // \n      ConsoleCaptureManager.setFilters({ [type]: newState });\n      Store.set('acu_debug_filters', ConsoleCaptureManager.filters);\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-clear').on('click', () => {\n      ConsoleCaptureManager.clear();\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-copy').on('click', async () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n');\n\n      try {\n        // \n        if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n          const safeContent = text.replace(/\\\"/g, '\\\\\"').replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          return;\n        }\n        // API\n        if (navigator.clipboard && window.isSecureContext) {\n          await navigator.clipboard.writeText(text);\n        } else {\n          // execCommand\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n          document.body.appendChild(textArea);\n          textArea.select();\n          textArea.setSelectionRange(0, 99999);\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n          if (!successful) {\n            throw new Error('execCommand failed');\n          }\n        }\n      } catch (err) {\n        console.error('[DICE]DebugConsole :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // \n    dialog.find('#debug-console-export').on('click', () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n\\n');\n\n      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `debug-console-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    dialog.find('#debug-console-close, .acu-edit-overlay').on('click', function (e) {\n      if (e.target === this || $(e.target).closest('.acu-close-btn').length) {\n        dialog.remove();\n      }\n    });\n\n    // \n    // [] \n    const refreshInterval = setInterval(() => {\n      if (dialog.length && dialog.is(':visible')) {\n        renderLogs();\n        updateCounts();\n      }\n    }, 500);\n\n    // \n    dialog.on('remove', () => {\n      clearInterval(refreshInterval);\n    });\n  };\n\n  // ========================================\n  // showAddRegexRuleModal - / (Phase 4.2)\n  // ========================================\n  const showAddRegexRuleModal = (editRuleId?: string) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // ()\n    const editRule = editRuleId ? RegexTransformationManager.getRule(editRuleId) : null;\n\n    // \n    const tableData = cachedRawData || getTableData();\n    const tableNames = Object.keys(tableData || {})\n      .filter(k => k.startsWith('sheet_'))\n      .map(k => tableData[k]?.name || k)\n      .sort();\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-dice-cfg-header\">\n            <span><i class=\"fa-solid fa-magic\"></i> ${editRule ? '' : ''}</span>\n            <button class=\"acu-config-close\" id=\"acu-close-regex-rule\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.name) : ''}\" placeholder=\": \" style=\"flex:1;\" required>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <textarea id=\"rule-description\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1; resize: none; overflow-wrap: break-word; overflow-y: hidden; min-height: 34px; height: 34px; line-height: 1.4;\">${editRule ? escapeHtml(editRule.description || '') : ''}</textarea>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <input type=\"text\" id=\"rule-pattern\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.pattern) : ''}\" placeholder=\": \\\\s+  /test/g\" style=\"flex:1; font-family: monospace;\" required>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-replacement\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.replacement || '') : ''}\" placeholder=\", $1, $2 \" style=\"flex:1; font-family: monospace;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <select id=\"rule-scope-type\" class=\"acu-setting-select\" style=\"width:120px;\">\n                <option value=\"global\" ${editRule?.scope?.type === 'global' ? 'selected' : ''}></option>\n                <option value=\"table\" ${editRule?.scope?.type === 'table' ? 'selected' : ''}></option>\n                <option value=\"column\" ${editRule?.scope?.type === 'column' ? 'selected' : ''}></option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"field-table-names\" style=\"display: ${editRule?.scope?.type === 'global' ? 'none' : 'flex'};\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> ()</span></div>\n              <input type=\"text\" id=\"rule-table-names\" class=\"acu-panel-input\" value=\"${editRule?.scope?.tableNames?.join(',') || ''}\" placeholder=\": ,\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\" id=\"field-column-names\" style=\"display: ${editRule?.scope?.type === 'column' ? 'flex' : 'none'};\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> ()</span></div>\n              <input type=\"text\" id=\"rule-column-names\" class=\"acu-panel-input\" value=\"${editRule?.scope?.columnNames?.join(',') || ''}\" placeholder=\": ,\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"number\" id=\"rule-priority\" class=\"acu-panel-input\" value=\"${editRule?.priority || 50}\" min=\"1\" max=\"100\" style=\"width:80px;\">\n            </div>\n\n          </div>\n          <div class=\"acu-dice-cfg-actions\">\n            <button id=\"acu-regex-rule-cancel\"></button>\n            <button id=\"acu-regex-rule-confirm\"></button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    // /\n    const updateScopeFields = () => {\n      const scopeType = dialog.find('#rule-scope-type').val();\n      if (scopeType === 'global') {\n        dialog.find('#field-table-names, #field-column-names').hide();\n      } else if (scopeType === 'table') {\n        dialog.find('#field-table-names').css('display', 'flex').show();\n        dialog.find('#field-column-names').hide();\n      } else if (scopeType === 'column') {\n        dialog.find('#field-table-names, #field-column-names').css('display', 'flex').show();\n      }\n    };\n\n    dialog.find('#rule-scope-type').on('change', updateScopeFields);\n\n    // Textarea\n    const $textarea = dialog.find('#rule-description');\n    const autoResizeTextarea = () => {\n      // scrollHeight\n      $textarea.css('height', '34px');\n      // ,1\n      const scrollHeight = $textarea[0].scrollHeight;\n      $textarea.css('height', Math.max(34, scrollHeight) + 'px');\n    };\n    // \n    $textarea.on('input', autoResizeTextarea);\n\n    // ()\n    dialog.find('#acu-regex-rule-confirm').on('click', async function () {\n      const name = dialog.find('#rule-name').val();\n      const pattern = dialog.find('#rule-pattern').val();\n      const scopeType = dialog.find('#rule-scope-type').val();\n\n      if (!name || !pattern) {\n        toastr.error('');\n        return;\n      }\n\n      //  scope \n      const scope: RegexScopeConfig = { type: scopeType as RegexScopeType };\n      if (scopeType !== 'global') {\n        const tableNames = dialog.find('#rule-table-names').val();\n        if (tableNames)\n          scope.tableNames = String(tableNames)\n            .split(',')\n            .map(s => s.trim())\n            .filter(s => s);\n      }\n      if (scopeType === 'column') {\n        const columnNames = dialog.find('#rule-column-names').val();\n        if (columnNames)\n          scope.columnNames = String(columnNames)\n            .split(',')\n            .map(s => s.trim())\n            .filter(s => s);\n      }\n\n      //  pattern  flags\n      const patternStr = String(pattern);\n      const { flags: extractedFlags, patternWithoutFlags } = RegexTransformationEngine._extractFlags(patternStr);\n\n      //  UI  flags\n      const $flagGlobal = dialog.find('#flag-global');\n      const $flagIgnoreCase = dialog.find('#flag-ignorecase');\n      const $flagMultiline = dialog.find('#flag-multiline');\n\n      const uiFlags = {\n        global: $flagGlobal.length > 0 ? $flagGlobal.is(':checked') : false,\n        caseInsensitive: $flagIgnoreCase.length > 0 ? $flagIgnoreCase.is(':checked') : false,\n        multiline: $flagMultiline.length > 0 ? $flagMultiline.is(':checked') : false,\n      };\n\n      //  pattern  flags pattern  flags\n      const finalPattern = patternWithoutFlags !== patternStr ? patternWithoutFlags : patternStr;\n      const finalFlags =\n        patternWithoutFlags !== patternStr\n          ? { ...uiFlags, ...extractedFlags } //  flags  UI flags\n          : uiFlags; //  flags UI flags\n\n      const ruleData = {\n        name: String(name),\n        description: dialog.find('#rule-description').val(),\n        operation: 'replace', // \n        pattern: finalPattern, //  pattern flags\n        flags: finalFlags, //  flags\n        replacement: dialog.find('#rule-replacement').val(),\n        scope,\n        enabled: true, // \n        priority: parseInt(dialog.find('#rule-priority').val(), 10),\n        executeMode: 'auto', // \n      };\n\n      // \n      if (editRuleId) {\n        // \n        RegexTransformationManager.updateRule(editRuleId, ruleData);\n      } else {\n        // \n        const newRule = RegexTransformationManager.addCustomRule(ruleData);\n        if (newRule) {\n          editRuleId = newRule.id;\n        }\n      }\n\n      // [] \n      dialog.remove();\n      $(document).off('keydown.regex-rule-modal'); // ESC\n      refreshRegexRulesList(); // \n    });\n\n    //  isSettingsOpen\n    const closeDialog = () => {\n      dialog.remove();\n      $(document).off('keydown.regex-rule-modal'); // ESC\n    };\n\n    // \n    dialog.find('#acu-regex-rule-cancel, #acu-close-regex-rule').on('click', function (e) {\n      e.stopPropagation();\n      closeDialog();\n    });\n\n    // \n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n\n    // ESC \n    $(document).on('keydown.regex-rule-modal', function (e) {\n      if (e.key === 'Escape' && dialog.length && dialog.is(':visible')) {\n        e.preventDefault();\n        closeDialog();\n        $(document).off('keydown.regex-rule-modal'); // \n      }\n    });\n\n    $('body').append(dialog);\n\n    // DOMtextarea\n    requestAnimationFrame(() => {\n      const $textarea = dialog.find('#rule-description');\n      if ($textarea.length && $textarea[0].scrollHeight > 34) {\n        $textarea.css('height', $textarea[0].scrollHeight + 'px');\n      }\n    });\n  };\n\n  // \n  window.showAddRegexRuleModal = showAddRegexRuleModal;\n\n  // \n  window.showDebugConsoleModal = showDebugConsoleModal;\n\n  // ========================================\n  // AcuDice  API - \n  // ========================================\n\n  /**\n   * AcuDice  API\n   * \n   */\n  const AcuDiceAPI = {\n    /** API  */\n    version: '1.0.0',\n\n    /**\n     * \n     * @param formula  \"2d6\", \"1d20+5\", \"4d6kh3\"\n     * @returns \n     * @example\n     * AcuDice.roll('2d6') // => { total: 7, formula: '2d6', breakdown: '2d6 = 7' }\n     * AcuDice.roll('1d20+5') // => { total: 15, formula: '1d20+5', breakdown: '1d20+5 = 15' }\n     */\n    roll(formula: string): { total: number; formula: string; breakdown: string } {\n      if (!formula || typeof formula !== 'string') {\n        throw new Error('[AcuDice] roll() ');\n      }\n      const total = evaluateFormula(formula, {});\n      return {\n        total,\n        formula,\n        breakdown: `${formula} = ${total}`,\n      };\n    },\n\n    /**\n     * /\n     * @param options \n     * @returns \n     * @example\n     * await AcuDice.check({ attribute: '' })\n     * await AcuDice.check({ attribute: '', targetValue: 50, diceType: '1d100' })\n     */\n    async check(\n      options: {\n        attribute?: string;\n        skill?: string;\n        targetValue?: number;\n        diceType?: string;\n        successCriteria?: 'lte' | 'gte';\n        modifier?: number;\n      } = {},\n    ): Promise<{\n      success: boolean;\n      roll: number;\n      target: number;\n      margin: number;\n      criticalSuccess: boolean;\n      criticalFailure: boolean;\n      message: string;\n      diceType: string;\n      rule: 'coc' | 'dnd';\n    }> {\n      const diceCfg = getDiceConfig();\n      const diceType = options.diceType || diceCfg.lastDiceType || '1d100';\n      const successCriteria = options.successCriteria || (diceType === '1d20' ? 'gte' : 'lte');\n      const isDND = successCriteria === 'gte';\n      const modifier = options.modifier || 0;\n\n      // \n      let targetValue = options.targetValue;\n\n      // \n      if (targetValue === undefined && (options.attribute || options.skill)) {\n        const attrName = options.attribute || options.skill || '';\n        const rawData = cachedRawData || getTableData();\n\n        if (rawData) {\n          // \n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (sheet?.name === '' && sheet.content?.[1]) {\n              const headers = sheet.content[0] || [];\n              const row = sheet.content[1];\n              for (let idx = 0; idx < headers.length; idx++) {\n                const h = headers[idx];\n                if (h && (h.includes('') || h.includes(''))) {\n                  const parsed = parseAttributeString(row[idx] || '');\n                  const found = parsed.find((attr: { name: string; value: number }) => attr.name === attrName);\n                  if (found) {\n                    targetValue = found.value;\n                    break;\n                  }\n                }\n              }\n              if (targetValue !== undefined) break;\n            }\n          }\n        }\n\n        if (targetValue === undefined) {\n          throw new Error(`[AcuDice] : ${attrName}`);\n        }\n      }\n\n      if (targetValue === undefined) {\n        throw new Error('[AcuDice] check()  targetValue  attribute/skill ');\n      }\n\n      // \n      const rollResult = rollDiceExpression(diceType);\n      if (isNaN(rollResult)) {\n        throw new Error(`[AcuDice] : ${diceType}`);\n      }\n\n      const finalRoll = rollResult + modifier;\n      const target = targetValue;\n\n      // \n      let success = false;\n      let criticalSuccess = false;\n      let criticalFailure = false;\n      let message = '';\n\n      if (isDND) {\n        // DND : roll >= target \n        success = finalRoll >= target;\n        criticalSuccess = rollResult === diceCfg.dndCritSuccess;\n        criticalFailure = rollResult === diceCfg.dndCritFail;\n\n        if (criticalSuccess) {\n          success = true;\n          message = ` ${rollResult}${modifier ? ` + ${modifier}` : ''} = ${finalRoll}DC ${target}`;\n        } else if (criticalFailure) {\n          success = false;\n          message = ` ${rollResult}${modifier ? ` + ${modifier}` : ''} = ${finalRoll}DC ${target}`;\n        } else if (success) {\n          message = ` ${finalRoll} >= DC ${target}`;\n        } else {\n          message = ` ${finalRoll} < DC ${target}`;\n        }\n      } else {\n        // COC : roll <= target \n        success = finalRoll <= target;\n        criticalSuccess = finalRoll <= diceCfg.critSuccessMax;\n        criticalFailure = finalRoll >= diceCfg.critFailMin;\n\n        if (criticalSuccess) {\n          success = true;\n          message = ` ${finalRoll} ${target}`;\n        } else if (criticalFailure) {\n          success = false;\n          message = ` ${finalRoll} ${target}`;\n        } else if (success) {\n          const hardSuccess = finalRoll <= Math.floor(target / diceCfg.hardSuccessDiv);\n          const extremeSuccess = finalRoll <= Math.floor(target / diceCfg.difficultSuccessDiv);\n          if (extremeSuccess) {\n            message = ` ${finalRoll} <= ${Math.floor(target / diceCfg.difficultSuccessDiv)}`;\n          } else if (hardSuccess) {\n            message = ` ${finalRoll} <= ${Math.floor(target / diceCfg.hardSuccessDiv)}`;\n          } else {\n            message = ` ${finalRoll} <= ${target}`;\n          }\n        } else {\n          message = ` ${finalRoll} > ${target}`;\n        }\n      }\n\n      return {\n        success,\n        roll: finalRoll,\n        target,\n        margin: isDND ? finalRoll - target : target - finalRoll,\n        criticalSuccess,\n        criticalFailure,\n        message,\n        diceType,\n        rule: isDND ? 'dnd' : 'coc',\n      };\n    },\n\n    /**\n     *  - API \n     * @param callback \n     */\n    onReady(callback: () => void): void {\n      if (typeof callback === 'function') {\n        callback();\n      }\n    },\n\n    /**\n     * \n     */\n    on(event: string, handler: Function): void {\n      console.warn('[AcuDice] event:', event);\n    },\n\n    /**\n     * \n     */\n    off(event: string, handler: Function): void {\n      console.warn('[AcuDice] event:', event);\n    },\n  };\n\n  //  Object.defineProperty \n  Object.defineProperty(window, 'AcuDice', {\n    value: AcuDiceAPI,\n    writable: false,\n    configurable: false,\n  });\n\n  console.info('[AcuDice] API v1.0.0 ');\n\n  // ========================================\n  // ========================================\n  //  ( - )\n  //  renderFavoritesPanel() + bindFavoritesEvents() \n  // ========================================\n  /** @deprecated  renderFavoritesPanel()  */\n  const showFavoritesPanel = async () => {\n    const { $ } = getCore();\n    $('.acu-favorites-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // \n    const allFavorites = await FavoritesManager.getAll();\n    const allTags = await FavoritesManager.getAllTags();\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const currentTables = rawData || {};\n\n    // \n    const groupedByTag: Record<string, FavoriteItem[]> = {};\n    const untagged: FavoriteItem[] = [];\n\n    for (const fav of allFavorites) {\n      if (fav.tags && fav.tags.length > 0) {\n        for (const tag of fav.tags) {\n          if (!groupedByTag[tag]) groupedByTag[tag] = [];\n          groupedByTag[tag].push(fav);\n        }\n      } else {\n        untagged.push(fav);\n      }\n    }\n\n    // HTML\n    const renderFavoriteCard = (fav: FavoriteItem) => {\n      const preview = fav.header\n        .slice(0, 3)\n        .map(\n          (h, i) =>\n            `<span class=\"acu-fav-preview-item\"><b>${escapeHtml(h)}:</b> ${escapeHtml(String(fav.rowData[i] || ''))}</span>`,\n        )\n        .join('');\n      const tagsHtml = fav.tags.map(tag => `<span class=\"acu-favorites-tag\">${escapeHtml(tag)}</span>`).join('');\n      const sourceInfo = fav.sourceInfo ? `: ${escapeHtml(fav.sourceInfo.tableName)}` : '';\n\n      return `\n        <div class=\"acu-favorites-card\" data-id=\"${escapeHtml(fav.id)}\">\n          <div class=\"acu-favorites-card-header\">\n            <div class=\"acu-favorites-card-preview\">${preview}</div>\n            <div class=\"acu-favorites-card-source\">${sourceInfo}</div>\n          </div>\n          <div class=\"acu-favorites-card-tags\">${tagsHtml}</div>\n          <div class=\"acu-favorites-card-actions\">\n            <button class=\"acu-fav-btn acu-fav-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n            <button class=\"acu-fav-btn acu-fav-copy\" title=\"\"><i class=\"fa-solid fa-copy\"></i></button>\n            <button class=\"acu-fav-btn acu-fav-send\" title=\"\"><i class=\"fa-solid fa-paper-plane\"></i></button>\n            <button class=\"acu-fav-btn acu-fav-delete\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n        </div>\n      `;\n    };\n\n    // HTML\n    let contentHtml = '';\n\n    // \n    for (const tag of Object.keys(groupedByTag).sort()) {\n      contentHtml += `\n        <div class=\"acu-favorites-group\">\n          <div class=\"acu-favorites-group-title\"><i class=\"fa-solid fa-tag\"></i> ${escapeHtml(tag)} (${groupedByTag[tag].length})</div>\n          <div class=\"acu-favorites-group-cards\">\n            ${groupedByTag[tag].map(renderFavoriteCard).join('')}\n          </div>\n        </div>\n      `;\n    }\n\n    // \n    if (untagged.length > 0) {\n      contentHtml += `\n        <div class=\"acu-favorites-group\">\n          <div class=\"acu-favorites-group-title\"><i class=\"fa-solid fa-inbox\"></i>  (${untagged.length})</div>\n          <div class=\"acu-favorites-group-cards\">\n            ${untagged.map(renderFavoriteCard).join('')}\n          </div>\n        </div>\n      `;\n    }\n\n    if (allFavorites.length === 0) {\n      contentHtml = `\n        <div class=\"acu-favorites-empty\">\n          <i class=\"fa-solid fa-star\" style=\"font-size: 48px; opacity: 0.3;\"></i>\n          <p></p>\n          <p style=\"font-size: 12px; opacity: 0.7;\">  \"\"</p>\n        </div>\n      `;\n    }\n\n    // \n    const tagFilterOptions = allTags\n      .map(tag => `<option value=\"${escapeHtml(tag)}\">${escapeHtml(tag)}</option>`)\n      .join('');\n\n    const overlayHtml = `\n      <div class=\"acu-favorites-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-favorites-panel\">\n          <div class=\"acu-favorites-header\">\n            <h3><i class=\"fa-solid fa-star\"></i> </h3>\n            <div class=\"acu-favorites-header-actions\">\n              <button class=\"acu-fav-header-btn\" id=\"acu-fav-new\" title=\"\"><i class=\"fa-solid fa-plus\"></i> </button>\n              <button class=\"acu-fav-header-btn\" id=\"acu-fav-import\" title=\"\"><i class=\"fa-solid fa-file-import\"></i> </button>\n              <button class=\"acu-fav-header-btn\" id=\"acu-fav-export\" title=\"\"><i class=\"fa-solid fa-file-export\"></i> </button>\n              <button class=\"acu-fav-header-btn acu-fav-close\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n          </div>\n          <div class=\"acu-favorites-filter\">\n            <select id=\"acu-fav-tag-filter\">\n              <option value=\"\"></option>\n              ${tagFilterOptions}\n            </select>\n            <input type=\"text\" id=\"acu-fav-search\" placeholder=\"...\" />\n          </div>\n          <div class=\"acu-favorites-content\">\n            ${contentHtml}\n          </div>\n        </div>\n      </div>\n    `;\n\n    $('body').append(overlayHtml);\n\n    const $overlay = $('.acu-favorites-overlay');\n    const $panel = $overlay.find('.acu-favorites-panel');\n\n    // \n    const closePanel = () => {\n      $overlay.remove();\n    };\n\n    $overlay.on('click', e => {\n      if ($(e.target).hasClass('acu-favorites-overlay')) {\n        closePanel();\n      }\n    });\n\n    $panel.find('.acu-fav-close').on('click', closePanel);\n\n    // \n    $panel.find('#acu-fav-tag-filter').on('change', async function () {\n      const tag = $(this).val() as string;\n      const filtered = tag ? await FavoritesManager.getByTag(tag) : await FavoritesManager.getAll();\n      const $content = $panel.find('.acu-favorites-content');\n\n      if (filtered.length === 0) {\n        $content.html('<div class=\"acu-favorites-empty\"><p></p></div>');\n      } else {\n        $content.html(`<div class=\"acu-favorites-group-cards\">${filtered.map(renderFavoriteCard).join('')}</div>`);\n      }\n    });\n\n    // \n    $panel.find('#acu-fav-search').on('input', async function () {\n      const query = ($(this).val() as string).toLowerCase().trim();\n      const all = await FavoritesManager.getAll();\n      const filtered = query\n        ? all.filter(fav => {\n            const headerMatch = fav.header.some(h => h.toLowerCase().includes(query));\n            const dataMatch = fav.rowData.some(d => String(d).toLowerCase().includes(query));\n            const tagMatch = fav.tags.some(t => t.toLowerCase().includes(query));\n            return headerMatch || dataMatch || tagMatch;\n          })\n        : all;\n\n      const $content = $panel.find('.acu-favorites-content');\n      if (filtered.length === 0) {\n        $content.html('<div class=\"acu-favorites-empty\"><p></p></div>');\n      } else {\n        $content.html(`<div class=\"acu-favorites-group-cards\">${filtered.map(renderFavoriteCard).join('')}</div>`);\n      }\n    });\n\n    // \n    $panel.on('click', '.acu-fav-edit', async function () {\n      const id = $(this).closest('.acu-favorites-card').data('id');\n      const fav = await FavoritesManager.getById(id);\n      if (!fav) return;\n\n      showFavoriteEditModal(fav, async updated => {\n        await FavoritesManager.updateFavorite(id, updated);\n        toastr.success('');\n        closePanel();\n        showFavoritesPanel();\n      });\n    });\n\n    // \n    $panel.on('click', '.acu-fav-copy', async function () {\n      const id = $(this).closest('.acu-favorites-card').data('id');\n      const result = await FavoritesManager.duplicateFavorite(id);\n      if (result) {\n        toastr.success('');\n        closePanel();\n        showFavoritesPanel();\n      } else {\n        toastr.error('');\n      }\n    });\n\n    // \n    $panel.on('click', '.acu-fav-send', async function () {\n      const id = $(this).closest('.acu-favorites-card').data('id');\n      const fav = await FavoritesManager.getById(id);\n      if (!fav) return;\n\n      const compatible = FavoritesManager.findCompatibleTables(fav, currentTables);\n      if (compatible.length === 0) {\n        toastr.warning('');\n        return;\n      }\n\n      showSendToTableModal(fav, compatible, currentTables, () => {\n        toastr.success('');\n        closePanel();\n        renderInterface();\n      });\n    });\n\n    // \n    $panel.on('click', '.acu-fav-delete', async function () {\n      const id = $(this).closest('.acu-favorites-card').data('id');\n      if (!confirm('')) return;\n\n      const result = await FavoritesManager.deleteFavorite(id);\n      if (result) {\n        toastr.success('');\n        $(this)\n          .closest('.acu-favorites-card')\n          .fadeOut(200, function () {\n            $(this).remove();\n          });\n      } else {\n        toastr.error('');\n      }\n    });\n\n    // \n    $panel.find('#acu-fav-new').on('click', () => {\n      const tableKeys = Object.keys(currentTables);\n      if (tableKeys.length === 0) {\n        toastr.warning('');\n        return;\n      }\n\n      showNewFavoriteModal(currentTables, async (header, tableName) => {\n        const emptyRowData = header.map(() => '');\n        const newFav = await FavoritesManager.addFavorite('', tableName, header, emptyRowData, []);\n        if (newFav) {\n          toastr.success('');\n          closePanel();\n          showFavoritesPanel();\n          // \n          setTimeout(async () => {\n            const freshFav = await FavoritesManager.getById(newFav.id);\n            if (freshFav) {\n              showFavoriteEditModal(freshFav, async updated => {\n                await FavoritesManager.updateFavorite(newFav.id, updated);\n                toastr.success('');\n                $('.acu-favorites-overlay').remove();\n                showFavoritesPanel();\n              });\n            }\n          }, 100);\n        }\n      });\n    });\n\n    // \n    $panel.find('#acu-fav-export').on('click', async () => {\n      const json = await FavoritesManager.exportFavorites();\n      if (!json) {\n        toastr.error('');\n        return;\n      }\n\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      const now = new Date();\n      const dateStr = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}${String(now.getSeconds()).padStart(2, '0')}`;\n      a.href = url;\n      a.download = `favorites_${dateStr}.json`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      toastr.success('');\n    });\n\n    // \n    $panel.find('#acu-fav-import').on('click', () => {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const text = await file.text();\n          const result = await FavoritesManager.importFavorites(text);\n          if (result) {\n            toastr.success(`: ${result.added}, ${result.updated}`);\n            closePanel();\n            showFavoritesPanel();\n          } else {\n            toastr.error(': ');\n          }\n        } catch (err) {\n          toastr.error(': ' + (err instanceof Error ? err.message : String(err)));\n        }\n      };\n      input.click();\n    });\n  };\n\n  // \n  const showFavoriteEditModal = (fav: FavoriteItem, onSave: (updated: Partial<FavoriteItem>) => void) => {\n    const { $ } = getCore();\n    $('.acu-fav-edit-overlay').remove();\n\n    const config = getConfig();\n\n    // HTML\n    const renderEditRows = (header: string[], rowData: (string | number)[]) => {\n      return header\n        .map(\n          (h, i) => `\n        <div class=\"acu-fav-edit-row\" data-index=\"${i}\">\n          <input type=\"text\" class=\"acu-fav-edit-header\" value=\"${escapeHtml(h)}\" placeholder=\"\" />\n          <input type=\"text\" class=\"acu-fav-edit-value\" value=\"${escapeHtml(String(rowData[i] || ''))}\" placeholder=\"\" />\n          <button class=\"acu-fav-edit-remove\" title=\"\"><i class=\"fa-solid fa-minus\"></i></button>\n        </div>\n      `,\n        )\n        .join('');\n    };\n\n    const overlayHtml = `\n      <div class=\"acu-fav-edit-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-fav-edit-modal\">\n          <div class=\"acu-fav-edit-modal-header\">\n            <h4></h4>\n            <button class=\"acu-fav-edit-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-fav-edit-modal-body\">\n            <div class=\"acu-fav-edit-tags-section\">\n              <label> ():</label>\n              <input type=\"text\" id=\"acu-fav-edit-tags\" value=\"${escapeHtml(fav.tags.join(', '))}\" />\n            </div>\n            <div class=\"acu-fav-edit-rows\">\n              ${renderEditRows(fav.header, fav.rowData)}\n            </div>\n            <button class=\"acu-fav-edit-add-col\"><i class=\"fa-solid fa-plus\"></i> </button>\n          </div>\n          <div class=\"acu-fav-edit-modal-footer\">\n            <button class=\"acu-fav-edit-cancel\"></button>\n            <button class=\"acu-fav-edit-save\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    $('body').append(overlayHtml);\n\n    const $overlay = $('.acu-fav-edit-overlay');\n    const $modal = $overlay.find('.acu-fav-edit-modal');\n\n    const closeModal = () => $overlay.remove();\n\n    $overlay.on('click', e => {\n      if ($(e.target).hasClass('acu-fav-edit-overlay')) closeModal();\n    });\n\n    $modal.find('.acu-fav-edit-close, .acu-fav-edit-cancel').on('click', closeModal);\n\n    // \n    $modal.on('click', '.acu-fav-edit-remove', function () {\n      $(this).closest('.acu-fav-edit-row').remove();\n    });\n\n    // \n    $modal.find('.acu-fav-edit-add-col').on('click', () => {\n      const newIndex = $modal.find('.acu-fav-edit-row').length;\n      const newRowHtml = `\n        <div class=\"acu-fav-edit-row\" data-index=\"${newIndex}\">\n          <input type=\"text\" class=\"acu-fav-edit-header\" value=\"\" placeholder=\"\" />\n          <input type=\"text\" class=\"acu-fav-edit-value\" value=\"\" placeholder=\"\" />\n          <button class=\"acu-fav-edit-remove\" title=\"\"><i class=\"fa-solid fa-minus\"></i></button>\n        </div>\n      `;\n      $modal.find('.acu-fav-edit-rows').append(newRowHtml);\n    });\n\n    // \n    $modal.find('.acu-fav-edit-save').on('click', () => {\n      const newHeader: string[] = [];\n      const newRowData: (string | number)[] = [];\n\n      $modal.find('.acu-fav-edit-row').each(function () {\n        const h = $(this).find('.acu-fav-edit-header').val() as string;\n        const v = $(this).find('.acu-fav-edit-value').val() as string;\n        if (h.trim()) {\n          newHeader.push(h.trim());\n          newRowData.push(v);\n        }\n      });\n\n      const tagsStr = ($modal.find('#acu-fav-edit-tags').val() as string) || '';\n      const newTags = tagsStr\n        .split(',')\n        .map(t => t.trim())\n        .filter(t => t.length > 0);\n\n      onSave({\n        header: newHeader,\n        rowData: newRowData,\n        tags: newTags,\n      });\n\n      closeModal();\n    });\n  };\n\n  // \n  const showNewFavoriteModal = (\n    currentTables: Record<string, any>,\n    onCreate: (header: string[], tableName: string) => void,\n  ) => {\n    const { $ } = getCore();\n    $('.acu-fav-new-overlay').remove();\n\n    const config = getConfig();\n\n    const tableOptions = Object.keys(currentTables)\n      .map(key => {\n        const table = currentTables[key];\n        const name = table.name || key;\n        return `<option value=\"${escapeHtml(key)}\">${escapeHtml(name)}</option>`;\n      })\n      .join('');\n\n    const overlayHtml = `\n      <div class=\"acu-fav-new-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-fav-new-modal\">\n          <div class=\"acu-fav-new-modal-header\">\n            <h4></h4>\n            <button class=\"acu-fav-new-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-fav-new-modal-body\">\n            <label>:</label>\n            <select id=\"acu-fav-new-template\">\n              ${tableOptions}\n            </select>\n          </div>\n          <div class=\"acu-fav-new-modal-footer\">\n            <button class=\"acu-fav-new-cancel\"></button>\n            <button class=\"acu-fav-new-create\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    $('body').append(overlayHtml);\n\n    const $overlay = $('.acu-fav-new-overlay');\n    const $modal = $overlay.find('.acu-fav-new-modal');\n\n    const closeModal = () => $overlay.remove();\n\n    $overlay.on('click', e => {\n      if ($(e.target).hasClass('acu-fav-new-overlay')) closeModal();\n    });\n\n    $modal.find('.acu-fav-new-close, .acu-fav-new-cancel').on('click', closeModal);\n\n    $modal.find('.acu-fav-new-create').on('click', () => {\n      const key = $modal.find('#acu-fav-new-template').val() as string;\n      const table = currentTables[key];\n      if (!table || !table.content || !table.content[0]) {\n        toastr.error('');\n        return;\n      }\n\n      const fullHeader = table.content[0];\n      const header: string[] = fullHeader.slice(1).map((h: any) => String(h || ''));\n      const tableName = table.name || key;\n\n      onCreate(header, tableName);\n      closeModal();\n    });\n  };\n\n  // \n  const showSendToTableModal = (\n    fav: FavoriteItem,\n    compatible: TableCompatibility[],\n    currentTables: Record<string, any>,\n    onSuccess: () => void,\n  ) => {\n    const { $ } = getCore();\n    $('.acu-fav-send-overlay').remove();\n\n    const config = getConfig();\n\n    const tableListHtml = compatible\n      .map(c => {\n        const modeLabel =\n          c.mode === 'strict'\n            ? '<span style=\"color:#27ae60;\"> </span>'\n            : `<span style=\"color:#f39c12;\">  (${c.matchedCols.length}/${fav.header.length})</span>`;\n        const unmatchedInfo =\n          c.unmatchedCols.length > 0\n            ? `<div class=\"acu-fav-send-unmatched\">: ${c.unmatchedCols.join(', ')}</div>`\n            : '';\n\n        return `\n        <div class=\"acu-fav-send-option\" data-uid=\"${escapeHtml(c.tableUid)}\" data-mode=\"${c.mode}\">\n          <div class=\"acu-fav-send-option-name\">${escapeHtml(c.tableName)}</div>\n          <div class=\"acu-fav-send-option-mode\">${modeLabel}</div>\n          ${unmatchedInfo}\n        </div>\n      `;\n      })\n      .join('');\n\n    const overlayHtml = `\n      <div class=\"acu-fav-send-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-fav-send-modal\">\n          <div class=\"acu-fav-send-modal-header\">\n            <h4></h4>\n            <button class=\"acu-fav-send-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-fav-send-modal-body\">\n            ${tableListHtml}\n          </div>\n          <div class=\"acu-fav-send-modal-footer\">\n            <button class=\"acu-fav-send-cancel\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    $('body').append(overlayHtml);\n\n    const $overlay = $('.acu-fav-send-overlay');\n    const $modal = $overlay.find('.acu-fav-send-modal');\n\n    const closeModal = () => $overlay.remove();\n\n    $overlay.on('click', e => {\n      if ($(e.target).hasClass('acu-fav-send-overlay')) closeModal();\n    });\n\n    $modal.find('.acu-fav-send-close, .acu-fav-send-cancel').on('click', closeModal);\n\n    // \n    $modal.on('click', '.acu-fav-send-option', async function () {\n      const uid = $(this).data('uid') as string;\n      const mode = $(this).data('mode') as string;\n      const table = currentTables[uid];\n\n      if (!table || !table.content) {\n        toastr.error('');\n        return;\n      }\n\n      const targetHeader: string[] = table.content[0].slice(1).map((h: any) => String(h || ''));\n      const newRow = FavoritesManager.mapRowToTable(fav, targetHeader);\n\n      // \n      table.content.push(newRow);\n\n      // \n      if (cachedRawData && cachedRawData[uid]) {\n        cachedRawData[uid].content = table.content;\n      }\n\n      // \n      try {\n        const api = getCore().getDB();\n        if (!api || !api.importTableAsJson) {\n          toastr.error(' API ');\n          return;\n        }\n        const jsonString = JSON.stringify(cachedRawData);\n        const result = await api.importTableAsJson(jsonString);\n        if (result === false) {\n          toastr.error('');\n          return;\n        }\n        console.log('[DICE]FavoritesManager ');\n      } catch (err) {\n        console.error('[DICE]FavoritesManager :', err);\n        toastr.error(': ' + (err.message || err));\n        return;\n      }\n\n      // \n      if (mode === 'loose') {\n        const unmatchedCount = fav.header.filter(h => !targetHeader.includes(h)).length;\n        if (unmatchedCount > 0) {\n          toastr.info(`${unmatchedCount}`);\n        }\n      }\n\n      closeModal();\n      onSuccess();\n    });\n  };\n\n  const showSettingsModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-settings-dialog)').remove();\n    isSettingsOpen = true;\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const t = getThemeColors();\n\n    // \n    const expandedGroups = Store.get('acu_settings_expanded', ['appearance']);\n\n    const isGroupExpanded = groupId => expandedGroups.includes(groupId);\n    // HTMLMVU\n    const SPECIAL_BUTTONS_CONFIG = [\n      { key: '__dice__', name: '', icon: 'fa-dice-d20' },\n      { key: '__changes__', name: '', icon: 'fa-code-compare' },\n      { key: '__mvu__', name: 'MVU', icon: 'fa-code-branch' },\n      { key: '__favorites__', name: '', icon: 'fa-star' },\n    ];\n\n    const tableManagerHtml = (() => {\n      const rawData = cachedRawData || getTableData();\n      const tables = processJsonData(rawData || {});\n      const savedOrder = getSavedTableOrder() || [];\n      const hiddenList = getHiddenTables();\n\n      //  + \n      let allItems = [];\n\n      // \n      SPECIAL_BUTTONS_CONFIG.forEach(btn => {\n        // MVU \n        allItems.push({ key: btn.key, name: btn.name, icon: btn.icon, isSpecial: true });\n      });\n\n      // \n      Object.keys(tables).forEach(name => {\n        allItems.push({ key: name, name: name, icon: getIconForTableName(name), isSpecial: false });\n      });\n\n      // \n      if (savedOrder.length > 0) {\n        const orderMap = new Map(savedOrder.map((k, i) => [k, i]));\n        allItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      return allItems\n        .map(item => {\n          const isHidden = hiddenList.includes(item.key);\n          const specialClass = item.isSpecial ? ' acu-special-item' : '';\n          const displayName = item.name;\n          return (\n            '<div class=\"acu-table-manager-item' +\n            specialClass +\n            (isHidden ? ' hidden-table' : '') +\n            '\" data-table-name=\"' +\n            escapeHtml(item.key) +\n            '\" draggable=\"false\">' +\n            '<div class=\"acu-table-item-check\" title=\"/\">' +\n            '<i class=\"fa-solid ' +\n            (isHidden ? 'fa-eye-slash' : 'fa-eye') +\n            '\"></i>' +\n            '</div>' +\n            '<div class=\"acu-table-item-icon\"><i class=\"fa-solid ' +\n            item.icon +\n            '\"></i></div>' +\n            '<div class=\"acu-table-item-name\">' +\n            escapeHtml(displayName) +\n            '</div>' +\n            '<div class=\"acu-table-item-handle\" title=\"\">' +\n            '<i class=\"fa-solid fa-grip-vertical\"></i>' +\n            '</div>' +\n            '</div>'\n          );\n        })\n        .join('');\n    })();\n    const chevron = groupId => (isGroupExpanded(groupId) ? 'fa-chevron-down' : 'fa-chevron-right');\n\n    const dialog = $(`\n        <div class=\"acu-edit-overlay\">\n            <div class=\"acu-edit-dialog acu-settings-dialog ${currentThemeClass}\">\n                <div class=\"acu-settings-header\">\n                    <div class=\"acu-settings-title\">\n                        <span class=\"acu-settings-text\">\n                            <i class=\"fa-solid fa-cog\"></i> \n                            <span class=\"acu-version-badge\">${SCRIPT_VERSION}</span><button class=\"acu-manual-update-btn\" id=\"acu-manual-update-btn\" title=\"\"><i class=\"fa-solid fa-rotate\"></i></button>\n                        </span>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-help-btn\" id=\"acu-help-btn\" title=\"\"><i class=\"fa-solid fa-question-circle\"></i></button>\n                        <button class=\"acu-close-btn\" id=\"dlg-close-x\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n\n                <div class=\"acu-settings-body\">\n                <!--  -->\n                <div class=\"acu-settings-group ${isGroupExpanded('appearance') ? '' : 'collapsed'}\" data-group=\"appearance\">                    <div class=\"acu-settings-group-title\">\n                        <i class=\"fa-solid ${chevron('appearance')} acu-group-chevron\"></i>\n                        <i class=\"fa-solid fa-palette\"></i> \n                    </div>\n                    <div class=\"acu-settings-group-body\">\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-theme\" class=\"acu-setting-select\">\n                                ${THEMES.map(t => `<option value=\"${t.id}\" ${t.id === config.theme ? 'selected' : ''}>${t.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-font-family\" class=\"acu-setting-select\">\n                                ${FONTS.map(f => `<option value=\"${f.id}\" ${f.id === config.fontFamily ? 'selected' : ''}>${f.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-main\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.fontSize}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-opt\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.optionFontSize || 12}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row acu-setting-row-toggle\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <label class=\"acu-toggle\">\n                                <input type=\"checkbox\" id=\"cfg-new\" ${config.highlightNew ? 'checked' : ''}>\n                                <span class=\"acu-toggle-slider\"></span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('layout') ? '' : 'collapsed'}\" data-group=\"layout\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('layout')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-th-large\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-width\" data-min=\"200\" data-max=\"500\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.cardWidth}px</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-layout\" class=\"acu-setting-select\">\n                                    <option value=\"horizontal\" ${config.layout !== 'vertical' ? 'selected' : ''}></option>\n                                    <option value=\"vertical\" ${config.layout === 'vertical' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                    <span class=\"acu-setting-hint\"></span>\n                                </div>\n                                <select id=\"cfg-grid-cols\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"2\" ${config.gridColumns == 2 ? 'selected' : ''}>2</option>\n                                    <option value=\"3\" ${config.gridColumns == 3 ? 'selected' : ''}>3</option>\n                                    <option value=\"4\" ${config.gridColumns == 4 ? 'selected' : ''}>4</option>\n                                    <option value=\"auto\" ${config.gridColumns === 'auto' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-per-page\" data-min=\"10\" data-max=\"200\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.itemsPerPage}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('position') ? '' : 'collapsed'}\" data-group=\"position\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('position')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-arrows-alt\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-position\" class=\"acu-setting-select\">\n                                    <option value=\"fixed\" ${config.positionMode !== 'embedded' ? 'selected' : ''}></option>\n                                    <option value=\"embedded\" ${config.positionMode === 'embedded' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-action-pos\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bottom\" ${config.actionsPosition !== 'top' ? 'selected' : ''}></option>\n                                    <option value=\"top\" ${config.actionsPosition === 'top' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-style\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bar\" ${config.collapseStyle === 'bar' ? 'selected' : ''}></option>\n                                    <option value=\"pill\" ${config.collapseStyle === 'pill' ? 'selected' : ''}></option>\n                                    <option value=\"mini\" ${config.collapseStyle === 'mini' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-align\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"right\" ${config.collapseAlign !== 'left' ? 'selected' : ''}></option>\n                                    <option value=\"left\" ${config.collapseAlign === 'left' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('options') ? '' : 'collapsed'}\" data-group=\"options\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('options')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-gamepad\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row acu-setting-row-toggle\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-show-opt\" ${config.showOptionPanel !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                            <div class=\"acu-setting-row acu-setting-row-toggle\" id=\"row-auto-send\" style=\"${config.showOptionPanel !== false ? '' : 'display:none;'}\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-auto-send\" ${config.clickOptionToAutoSend !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('tables') ? '' : 'collapsed'}\" data-group=\"tables\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('tables')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-table\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-table-manager-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <div class=\"acu-table-manager-list\" id=\"table-manager-list\">\n                                ${tableManagerHtml}\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('validation') ? '' : 'collapsed'}\" data-group=\"validation\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('validation')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-clipboard-check\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${PresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === PresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}${p.builtin ? ' ()' : ''}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-reset\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> <i class=\"fa-solid fa-shield-halved\"></i> \n                            </div>\n                            <div class=\"acu-validation-rules-list\" id=\"validation-rules-list\">\n                                ${ValidationRuleManager.getAllRules()\n                                  .map(rule => {\n                                    const typeInfo = RULE_TYPE_INFO[rule.ruleType] || {\n                                      name: rule.ruleType,\n                                      icon: 'fa-question',\n                                    };\n                                    const isTableRule = typeInfo.scope === 'table';\n                                    const hasIntercept = rule.intercept;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n                                            <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n                                        </div>\n                                        <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n                                        <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <button class=\"acu-add-rule-btn\" id=\"btn-add-validation-rule\">\n                                <i class=\"fa-solid fa-plus\"></i> \n                            </button>\n                        </div>\n                    </div>\n\n                    <!--  - Phase 4.1 -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('regex') ? '' : 'collapsed'}\" data-group=\"regex\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('regex')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-wand-magic-sparkles\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"regex-preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${RegexPresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === RegexPresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <!--  -->\n                            <div class=\"acu-validation-rules-list\" id=\"regex-rules-list\">\n                                ${RegexTransformationManager.getAllRules()\n                                  .map(rule => {\n                                    const scopeIcon =\n                                      rule.scope.type === 'global'\n                                        ? 'fa-globe'\n                                        : rule.scope.type === 'table'\n                                          ? 'fa-table'\n                                          : 'fa-columns';\n                                    const scopeText =\n                                      rule.scope.type === 'global'\n                                        ? ''\n                                        : rule.scope.type === 'table'\n                                          ? rule.scope.tableNames?.join(',')\n                                          : `${rule.scope.tableNames?.join(',')}.${rule.scope.columnNames?.join(',')}`;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\": ${escapeHtml(rule.scope.type)}\">\n                                            <i class=\"fa-solid ${scopeIcon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\" style=\"font-size:10px;\">${escapeHtml(scopeText)} | ${escapeHtml(rule.operation)}</div>\n                                        </div>\n                                        <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <div style=\"display:flex;gap:8px;margin-top:8px;\">\n                                <button class=\"acu-add-rule-btn\" id=\"btn-add-regex-rule\" style=\"flex:1;\">\n                                    <i class=\"fa-solid fa-plus\"></i> \n                                </button>\n                                <button class=\"acu-add-rule-btn\" id=\"btn-import-tavern-regex\" style=\"flex:1;\">\n                                    <i class=\"fa-solid fa-file-import\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('advanced') ? '' : 'collapsed'}\" data-group=\"advanced\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('advanced')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-sliders-h\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-fire\"></i> </span>\n                                </div>\n                                <select id=\"cfg-crazy-mode\" class=\"acu-setting-select\" style=\"width: 90px; min-width: 90px; text-align: center; text-align-last: center;\">\n                                    <option value=\"0\"> </option>\n                                    <option value=\"25\"> </option>\n                                    <option value=\"50\"> </option>\n                                    <option value=\"75\"> </option>\n                                    <option value=\"100\"> </option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-dice-d20\"></i> </span>\n                                </div>\n                                <button id=\"cfg-attr-preset-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-wand-magic-sparkles\"></i> </span>\n                                </div>\n                                <button id=\"cfg-action-preset-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-filter\"></i> </span>\n                                </div>\n                                <button id=\"cfg-blacklist-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-bug\"></i> Debug</span>\n                                </div>\n                                <button id=\"btn-open-debug-console\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-terminal\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                </div><!--  .acu-settings-body -->\n            </div>\n        </div>\n    `);\n    $('body').append(dialog);\n\n    // ===  ===\n    dialog.find('.acu-settings-group-title').on('click', function () {\n      const $group = $(this).closest('.acu-settings-group');\n      const $body = $group.find('.acu-settings-group-body');\n\n      // \n      if ($body.hasClass('acu-animating')) return;\n\n      const groupId = $group.data('group');\n      const $chevron = $(this).find('.acu-group-chevron');\n      let expanded = Store.get('acu_settings_expanded', ['appearance']);\n\n      if ($group.hasClass('collapsed')) {\n        // \n        $group.removeClass('collapsed');\n        $chevron.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n        if (!expanded.includes(groupId)) expanded.push(groupId);\n\n        $body.addClass('acu-animating').show();\n        const targetHeight = $body.prop('scrollHeight');\n        $body.css('height', 0).animate({ height: targetHeight }, 180, function () {\n          $(this).css('height', '').removeClass('acu-animating');\n        });\n      } else {\n        // \n        $group.addClass('collapsed');\n        $chevron.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n        expanded = expanded.filter(id => id !== groupId);\n\n        const currentHeight = $body.outerHeight();\n        $body\n          .addClass('acu-animating')\n          .css('height', currentHeight)\n          .animate({ height: 0 }, 180, function () {\n            $(this).hide().css('height', '').removeClass('acu-animating');\n          });\n      }\n\n      Store.set('acu_settings_expanded', expanded);\n    });\n\n    // ===  ===\n    // \n    dialog.find('#cfg-theme').on('change', function () {\n      const newTheme = $(this).val();\n      saveConfig({ theme: newTheme });\n      dialog\n        .find('.acu-edit-dialog')\n        .removeClass(THEMES.map(t => `acu-theme-${t.id}`).join(' '))\n        .addClass(`acu-theme-${newTheme}`);\n\n      // \n      const t = getThemeColors();\n      dialog.find('#cfg-attr-preset-manage').css({\n        background: t.btnBg,\n        borderColor: t.border,\n        color: t.textMain,\n      });\n      dialog.find('#cfg-action-preset-manage').css({\n        background: t.btnBg,\n        borderColor: t.border,\n        color: t.textMain,\n      });\n    });\n\n    // \n    dialog.find('#cfg-font-family').on('change', function () {\n      saveConfig({ fontFamily: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-attr-preset-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showAttributePresetManager();\n    });\n\n    // \n    dialog.find('#cfg-action-preset-manage').on('click', function (e) {\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showActionPresetManager();\n    });\n\n    // \n    const initCrazyModeUI = () => {\n      const crazyConfig = getCrazyModeConfig();\n      // enabledcrazyLevel\n      const selectValue = crazyConfig.enabled ? crazyConfig.crazyLevel : 0;\n      dialog.find('#cfg-crazy-mode').val(selectValue);\n\n      // \n      dialog.find('#cfg-crazy-mode').on('change', function () {\n        const value = parseInt($(this).val() as string, 10);\n        if (value === 0) {\n          saveCrazyModeConfig({ enabled: false, crazyLevel: 50 });\n        } else {\n          saveCrazyModeConfig({ enabled: true, crazyLevel: value });\n        }\n      });\n    };\n    initCrazyModeUI();\n\n    // \n    dialog.find('#cfg-blacklist-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      showBlacklistManagerModal();\n    });\n\n    // \n    dialog.find('#cfg-layout').on('change', function () {\n      saveConfig({ layout: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-grid-cols').on('change', function () {\n      saveConfig({ gridColumns: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-position').on('change', function () {\n      saveConfig({ positionMode: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-action-pos').on('change', function () {\n      saveConfig({ actionsPosition: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-style').on('change', function () {\n      saveConfig({ collapseStyle: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-align').on('change', function () {\n      saveConfig({ collapseAlign: $(this).val() });\n      renderInterface();\n    });\n\n    // \n    dialog.find('#cfg-show-opt').on('change', function () {\n      const checked = $(this).is(':checked');\n      saveConfig({ showOptionPanel: checked });\n      if (checked) dialog.find('#row-auto-send').slideDown(200);\n      else dialog.find('#row-auto-send').slideUp(200);\n      renderInterface();\n    });\n    dialog.find('#cfg-auto-send').on('change', function () {\n      saveConfig({ clickOptionToAutoSend: $(this).is(':checked') });\n    });\n    dialog.find('#cfg-new').on('change', function () {\n      saveConfig({ highlightNew: $(this).is(':checked') });\n      renderInterface();\n    });\n\n    // === / ===\n    dialog.find('.acu-table-item-check').on('click', function (e) {\n      e.stopPropagation();\n      const $item = $(this).closest('.acu-table-manager-item');\n      const tableName = $item.data('table-name');\n      let hiddenList = getHiddenTables();\n      const $icon = $(this).find('i');\n\n      if (hiddenList.includes(tableName)) {\n        // \n        hiddenList = hiddenList.filter(n => n !== tableName);\n        $item.removeClass('hidden-table');\n        $icon.removeClass('fa-eye-slash').addClass('fa-eye');\n      } else {\n        // \n        hiddenList.push(tableName);\n        $item.addClass('hidden-table');\n        $icon.removeClass('fa-eye').addClass('fa-eye-slash');\n      }\n\n      saveHiddenTables(hiddenList);\n      renderInterface();\n    });\n\n    // ===  ===\n    const $list = dialog.find('#table-manager-list');\n    let dragState = {\n      isDragging: false,\n      element: null,\n      timer: null,\n      startY: 0,\n    };\n\n    const clearDragState = () => {\n      if (dragState.timer) {\n        clearTimeout(dragState.timer);\n        dragState.timer = null;\n      }\n      if (dragState.element) {\n        $(dragState.element).removeClass('acu-dragging');\n      }\n      $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n      dragState.isDragging = false;\n      dragState.element = null;\n    };\n\n    const startDrag = $item => {\n      dragState.isDragging = true;\n      dragState.element = $item[0];\n      $item.addClass('acu-dragging');\n    };\n\n    const finishDrag = () => {\n      if (!dragState.isDragging || !dragState.element) {\n        clearDragState();\n        return;\n      }\n\n      const $dragged = $(dragState.element);\n      const $target = $list.find('.acu-drag-above, .acu-drag-below').first();\n\n      if ($target.length && $target[0] !== dragState.element) {\n        if ($target.hasClass('acu-drag-above')) {\n          $dragged.insertBefore($target);\n        } else {\n          $dragged.insertAfter($target);\n        }\n\n        // \n        const newOrder = [];\n        $list.find('.acu-table-manager-item').each(function () {\n          newOrder.push($(this).data('table-name'));\n        });\n        saveTableOrder(newOrder);\n      }\n\n      clearDragState();\n    };\n\n    // \n    $list[0].addEventListener(\n      'pointerdown',\n      function (e) {\n        const handle = e.target.closest('.acu-table-item-handle');\n        if (!handle) return;\n\n        e.preventDefault();\n        const $item = $(handle).closest('.acu-table-manager-item');\n        dragState.startY = e.clientY;\n        startDrag($item);\n        handle.setPointerCapture(e.pointerId);\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerdown', function (e) {\n      const item = e.target.closest('.acu-table-manager-item');\n      if (!item) return;\n      // \n      if (e.target.closest('.acu-table-item-check, .acu-table-item-handle')) return;\n\n      dragState.startY = e.clientY;\n      const $item = $(item);\n\n      dragState.timer = setTimeout(() => {\n        startDrag($item);\n      }, 350);\n    });\n\n    // \n    $list[0].addEventListener(\n      'pointermove',\n      function (e) {\n        // \n        if (dragState.timer && Math.abs(e.clientY - dragState.startY) > 8) {\n          clearTimeout(dragState.timer);\n          dragState.timer = null;\n        }\n\n        if (!dragState.isDragging || !dragState.element) return;\n        e.preventDefault();\n\n        // \n        const items = $list.find('.acu-table-manager-item').not('.acu-dragging');\n        let targetItem = null;\n        let insertBefore = true;\n\n        items.each(function () {\n          const rect = this.getBoundingClientRect();\n          const midY = rect.top + rect.height / 2;\n\n          if (e.clientY < midY && !targetItem) {\n            targetItem = this;\n            insertBefore = true;\n          } else if (e.clientY >= rect.top && e.clientY <= rect.bottom) {\n            targetItem = this;\n            insertBefore = e.clientY < midY;\n          }\n        });\n\n        // \n        $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n        if (targetItem && targetItem !== dragState.element) {\n          $(targetItem).addClass(insertBefore ? 'acu-drag-above' : 'acu-drag-below');\n        }\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerup', finishDrag);\n    $list[0].addEventListener('pointercancel', clearDragState);\n\n    // \n    $list[0].addEventListener(\n      'touchmove',\n      function (e) {\n        if (dragState.isDragging) {\n          e.preventDefault();\n        }\n      },\n      { passive: false },\n    );\n\n    // === Stepper  ===\n    dialog.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        const unit = id === 'cfg-per-page' ? '' : 'px';\n        $value.text(newVal + unit);\n\n        // \n        if (id === 'cfg-width') {\n          $('.acu-wrapper').css('--acu-card-width', newVal + 'px');\n          saveConfig({ cardWidth: newVal });\n        } else if (id === 'cfg-font-main') {\n          $('.acu-wrapper').css('--acu-font-size', newVal + 'px');\n          saveConfig({ fontSize: newVal });\n        } else if (id === 'cfg-font-opt') {\n          $('.acu-wrapper, .acu-embedded-options-container').css('--acu-opt-font-size', newVal + 'px');\n          saveConfig({ optionFontSize: newVal });\n        } else if (id === 'cfg-per-page') {\n          saveConfig({ itemsPerPage: newVal });\n        }\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    // === /===\n    dialog.on('click', '.acu-rule-toggle', function (e) {\n      e.stopPropagation();\n      const $toggle = $(this);\n      const $item = $toggle.closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const $icon = $toggle.find('i');\n      const isCurrentlyActive = $toggle.hasClass('active');\n\n      // \n      ValidationRuleManager.toggleRuleEnabled(ruleId, !isCurrentlyActive);\n\n      //  UI\n      if (isCurrentlyActive) {\n        $toggle.removeClass('active');\n        $icon.removeClass('fa-toggle-on').addClass('fa-toggle-off');\n        $item.addClass('disabled');\n      } else {\n        $toggle.addClass('active');\n        $icon.removeClass('fa-toggle-off').addClass('fa-toggle-on');\n        $item.removeClass('disabled');\n      }\n    });\n\n    // ===  ===\n    dialog.on('click', '#validation-rules-list .acu-rule-edit', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const rule = ValidationRuleManager.getRule(ruleId);\n      if (!rule) return;\n\n      // \n      showAddValidationRuleModal(dialog, ruleId);\n    });\n\n    // === ===\n    dialog.on('click', '#validation-rules-list .acu-rule-delete', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const $item = $(this).closest('.acu-validation-rule-item');\n\n      if (confirm('')) {\n        if (ValidationRuleManager.removeCustomRule(ruleId)) {\n          $item.fadeOut(200, function () {\n            $(this).remove();\n          });\n        }\n      }\n    });\n\n    // === ===\n    dialog.on('click', '.acu-rule-intercept', function (e) {\n      e.stopPropagation();\n      const $btn = $(this);\n      const ruleId = $btn.data('rule-id');\n      const isCurrentlyActive = $btn.hasClass('active');\n\n      if (ValidationRuleManager.toggleRuleIntercept(ruleId, !isCurrentlyActive)) {\n        if (isCurrentlyActive) {\n          $btn.removeClass('active').attr('title', '');\n        } else {\n          $btn.addClass('active').attr('title', '');\n        }\n      }\n    });\n\n    // ===  ===\n    const refreshPresetUI = () => {\n      ValidationRuleManager.clearCache();\n      const rules = ValidationRuleManager.getAllRules();\n      let html = '';\n      rules.forEach(rule => {\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType] || { name: rule.ruleType, icon: 'fa-question' };\n        const isTableRule = typeInfo.scope === 'table';\n        const hasIntercept = rule.intercept;\n        html += `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo.icon}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n            </div>\n            <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n            <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n              <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>`;\n      });\n      dialog.find('#validation-rules-list').html(html);\n    };\n\n    // \n    dialog.find('#preset-select').on('change', function () {\n      if (PresetManager.setActivePreset($(this).val())) {\n        refreshPresetUI();\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-dup').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const newPreset = PresetManager.duplicatePreset(preset.id);\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-new').on('click', function () {\n      const name = prompt(':', '');\n      if (!name?.trim()) return;\n      const newPreset = PresetManager.createPreset(name.trim());\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-del').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      if (preset.id === 'default') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!confirm(`\"${preset.name}\"`)) return;\n      if (PresetManager.deletePreset(preset.id)) {\n        dialog.find(`#preset-select option[value=\"${preset.id}\"]`).remove();\n        dialog.find('#preset-select').val('default').trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-export').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const json = PresetManager.exportPreset(preset.id);\n      if (json) {\n        // \n        try {\n          const filename = `acu_validation_preset_${preset.name || preset.id}_${Date.now()}.json`;\n          const blob = new Blob([json], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = filename;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        } catch (e) {\n          //  Blob /\n          navigator.clipboard\n            .writeText(json)\n            .then(() => {})\n            .catch(() => {\n              prompt(':', json);\n            });\n        }\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-import').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const json = await file.text();\n          if (!json?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(json.trim());\n          } catch {\n            if (window.toastr) window.toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.preset?.name || '';\n          const existingPresets = PresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = json.trim();\n            if (newName && parsedData?.preset) {\n              parsedData.preset.name = newName;\n              // IDID\n              parsedData.preset.id = `preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset && existingPreset.id !== 'default') {\n                PresetManager.deletePreset(existingPreset.id);\n                dialog.find(`#preset-select option[value=\"${existingPreset.id}\"]`).remove();\n              }\n            }\n\n            const result = PresetManager.importPreset(finalJson, false);\n            if (result && result.preset) {\n              const newPreset = result.preset;\n              dialog\n                .find('#preset-select')\n                .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n              dialog.find('#preset-select').val(newPreset.id).trigger('change');\n\n              // \n              if (result.needsMerge) {\n                if (\n                  confirm(\n                    '\\n\\n',\n                  )\n                ) {\n                  if (PresetManager.mergePresetWithDefaults(newPreset.id)) {\n                    refreshPresetUI();\n                  } else {\n                    if (window.toastr) window.toastr.error('');\n                  }\n                }\n              }\n            } else {\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          console.error('[DICE]PresetManager :', err);\n          if (window.toastr) window.toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // \n    dialog.find('#btn-preset-reset').on('click', function () {\n      if (!confirm('\\n')) return;\n      if (PresetManager.resetDefaultPreset()) {\n        // \n        if (PresetManager.getActivePreset()?.id === 'default') {\n          refreshPresetUI();\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // === :/ ===\n    dialog.on('click', '#regex-rules-list .acu-rule-toggle', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const currentState = RegexTransformationManager.getAllRules().find(r => r.id === ruleId)?.enabled;\n      const newState = !currentState;\n      const rule = RegexTransformationManager.getRule(ruleId);\n\n      RegexTransformationManager.toggleRuleEnabled(ruleId, newState);\n\n      if (newState) {\n      } else {\n        toastr.info('');\n      }\n\n      refreshRegexRulesList(); // [] ,\n    });\n\n    // ===  ===\n    dialog.on('click', '#regex-rules-list .acu-rule-edit', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const rule = RegexTransformationManager.getRule(ruleId);\n      if (!rule) return;\n\n      // \n      showAddRegexRuleModal(ruleId);\n    });\n\n    // === : ===\n    dialog.on('click', '#regex-rules-list .acu-rule-delete', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const rule = RegexTransformationManager.getRule(ruleId);\n      if (!rule) return;\n\n      if (confirm(`\"${rule.name}\"`)) {\n        RegexTransformationManager.removeRule(ruleId);\n        refreshRegexRulesList(); // [] ,\n      }\n    });\n\n    // === : ===\n    dialog.find('#regex-preset-select').on('change', function () {\n      const presetId = $(this).val();\n      RegexPresetManager.setActivePreset(String(presetId));\n\n      refreshRegexRulesList(); // [] ,\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-dup').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      const name = prompt(':', `${currentPreset.name} ()`);\n      if (!name) return;\n\n      const newPreset = RegexPresetManager.createPreset(name, currentPreset.id);\n      if (newPreset) {\n        // [] \n        const $presetSelect = dialog.find('#regex-preset-select');\n        $presetSelect.append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        $presetSelect.val(newPreset.id);\n\n        refreshRegexRulesList(); // \n      } else {\n        toastr.error('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-new').on('click', function () {\n      const name = prompt(':');\n      if (!name) return;\n\n      const newPreset = RegexPresetManager.createPreset(name, null);\n      if (newPreset) {\n        RegexPresetManager.setActivePreset(newPreset.id);\n\n        // [] \n        const $presetSelect = dialog.find('#regex-preset-select');\n        $presetSelect.append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        $presetSelect.val(newPreset.id);\n\n        refreshRegexRulesList(); // \n      } else {\n        toastr.error('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-del').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      if (confirm(`\"${currentPreset.name}\"`)) {\n        const success = RegexPresetManager.deletePreset(currentPreset.id);\n        if (success) {\n          // [] \n          const $presetSelect = dialog.find('#regex-preset-select');\n          $presetSelect.find(`option[value=\"${currentPreset.id}\"]`).remove();\n\n          // \n          const defaultPresetId = RegexPresetManager.getActivePreset()?.id;\n          if (defaultPresetId) {\n            $presetSelect.val(defaultPresetId);\n          }\n\n          refreshRegexRulesList(); // \n        } else {\n          toastr.error('');\n        }\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-export').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      const json = RegexPresetManager.exportPreset(currentPreset.id);\n      if (json) {\n        const blob = new Blob([json], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `regex-preset-${currentPreset.name}-${Date.now()}.json`;\n        a.click();\n        URL.revokeObjectURL(url);\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-import').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const text = await file.text();\n          if (!text?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(text.trim());\n          } catch {\n            toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.name || '';\n          const existingPresets = RegexPresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = text.trim();\n            if (newName) {\n              parsedData.name = newName;\n              // IDID\n              parsedData.id = `regex_preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset) {\n                // \n                if (existingPresets.length > 1) {\n                  RegexPresetManager.deletePreset(existingPreset.id);\n                  dialog.find(`#regex-preset-select option[value=\"${existingPreset.id}\"]`).remove();\n                }\n              }\n            }\n\n            const preset = RegexPresetManager.importPreset(finalJson);\n            if (preset) {\n              // [] \n              const $presetSelect = dialog.find('#regex-preset-select');\n              $presetSelect.append(`<option value=\"${escapeHtml(preset.id)}\">${escapeHtml(preset.name)}</option>`);\n              $presetSelect.val(preset.id);\n\n              // [] \n              RegexPresetManager.setActivePreset(preset.id);\n              Store.set(STORAGE_KEY_REGEX_RULES, preset.rules || []);\n              RegexTransformationManager.clearCache();\n\n              refreshRegexRulesList(); // \n            } else {\n              toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // === : ===\n    dialog.find('#btn-add-regex-rule').on('click', function () {\n      showAddRegexRuleModal();\n    });\n\n    // === : ===\n    dialog.find('#btn-import-tavern-regex').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const text = await file.text();\n          if (!text?.trim()) return;\n\n          let parsed;\n          try {\n            parsed = JSON.parse(text.trim());\n          } catch {\n            toastr.error('JSON');\n            return;\n          }\n\n          // \n          const tavernRegexList: TavernRegex[] = Array.isArray(parsed) ? parsed : [parsed];\n\n          //  scriptName  findRegex\n          if (!tavernRegexList.every(r => r.scriptName && r.findRegex)) {\n            toastr.error(' scriptName  findRegex ');\n            return;\n          }\n\n          const existingRules = RegexTransformationManager.getAllRules();\n          const existingNames = existingRules.map(r => r.name);\n\n          let importedCount = 0;\n          let skippedCount = 0;\n\n          // \n          const processNext = (index: number): void => {\n            if (index >= tavernRegexList.length) {\n              // \n              refreshRegexRulesList();\n              if (skippedCount > 0) {\n                toastr.info(`: ${importedCount} , ${skippedCount} `);\n              } else if (importedCount > 0) {\n                toastr.success(` ${importedCount} `);\n              }\n              return;\n            }\n\n            const tavernRegex = tavernRegexList[index];\n            const convertedRule = convertTavernRegexToRule(tavernRegex);\n            const hasConflict = existingNames.includes(convertedRule.name);\n\n            if (hasConflict) {\n              // \n              showPresetConflictDialog({\n                presetName: convertedRule.name,\n                presetType: '',\n                existingNames,\n                onOverwrite: () => {\n                  // \n                  const oldRule = RegexTransformationManager.getAllRules().find(r => r.name === convertedRule.name);\n                  if (oldRule) RegexTransformationManager.removeRule(oldRule.id);\n                  RegexTransformationManager.addCustomRule(convertedRule);\n                  existingNames.push(convertedRule.name);\n                  importedCount++;\n                  processNext(index + 1);\n                },\n                onRename: newName => {\n                  convertedRule.name = newName;\n                  convertedRule.id = `tavern_import_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n                  RegexTransformationManager.addCustomRule(convertedRule);\n                  existingNames.push(newName);\n                  importedCount++;\n                  processNext(index + 1);\n                },\n                onCancel: () => {\n                  skippedCount++;\n                  processNext(index + 1);\n                },\n              });\n            } else {\n              // \n              RegexTransformationManager.addCustomRule(convertedRule);\n              existingNames.push(convertedRule.name);\n              importedCount++;\n              processNext(index + 1);\n            }\n          };\n\n          // \n          processNext(0);\n        } catch (err) {\n          toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // === : ===\n    dialog.find('#btn-add-validation-rule').on('click', function () {\n      showAddValidationRuleModal(dialog);\n    });\n\n    // === Debug ===\n    dialog.find('#btn-open-debug-console').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showDebugConsoleModal();\n    });\n\n    // ===  ===\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n      renderInterface();\n    };\n    dialog.on('click', '#dlg-close-x, .acu-settings-header .acu-close-btn', closeDialog);\n\n    // \n    dialog.on('click', '#acu-help-btn', function (e) {\n      e.stopPropagation();\n      window.open('https://jerryzmtz.github.io/DiceSystemManual//', '_blank');\n    });\n\n    // \n    dialog.on('click', '#acu-manual-update-btn', function (e) {\n      e.stopPropagation();\n      showManualUpdateConfirmDialog();\n    });\n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n  };\n\n  // [] \n  let renderInterfaceTimer = null;\n  let renderInterfacePending = false;\n\n  const renderInterface = () => {\n    // \n    if (isSettingsOpen) {\n      if (!renderInterfacePending) {\n        console.info('[DICE]');\n        renderInterfacePending = true;\n      }\n      return;\n    }\n\n    // \n    if (renderInterfaceTimer) {\n      clearTimeout(renderInterfaceTimer);\n    }\n\n    // 50ms\n    renderInterfaceTimer = setTimeout(() => {\n      renderInterfaceTimer = null;\n      renderInterfacePending = false;\n      _renderInterfaceImpl();\n    }, 50);\n  };\n\n  // \n  const _renderInterfaceImpl = () => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n\n    // [] Observer  ()\n    if (!observer && $('#chat').length) {\n      const $chat = $('#chat');\n      let mutationLock = false;\n      const handleMutation = () => {\n        if (mutationLock) return;\n        mutationLock = true;\n        requestAnimationFrame(() => {\n          const config = getConfig();\n          if (config.positionMode === 'embedded') {\n            mutationLock = false;\n            return;\n          }\n          const children = $chat.children();\n          const lastChild = children.last()[0];\n          const wrapper = $('.acu-wrapper')[0];\n          if (wrapper && lastChild && lastChild !== wrapper) {\n            if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n              $chat.append(wrapper);\n            }\n          }\n\n          // [] \n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            // 1\n            const children = $chat.children();\n            const lastChild = children.last();\n            if (lastChild.hasClass('mes') || lastChild.hasClass('message-body')) {\n              lastChild.addClass('acu-dice-result-revealing');\n            }\n\n            // 2RAF\n            requestAnimationFrame(() => {\n              hideDiceResultsInUserMessages();\n\n              // 3\n              requestAnimationFrame(() => {\n                lastChild.removeClass('acu-dice-result-revealing').addClass('acu-dice-result-revealed');\n                // \n                setTimeout(() => {\n                  lastChild.removeClass('acu-dice-result-revealed');\n                }, 200);\n              });\n            });\n          }\n\n          mutationLock = false;\n        });\n      };\n      observer = new MutationObserver(handleMutation);\n      observer.observe($chat[0], { childList: true });\n    }\n    let rawData;\n    let isDataFromDatabase = false; // \n    if (hasUnsavedChanges && cachedRawData) {\n      rawData = cachedRawData;\n    } else {\n      rawData = getTableData();\n      isDataFromDatabase = true; // \n\n      // [] \n      if (rawData) {\n        let anyLockApplied = false;\n        for (const sheetId in rawData) {\n          if (!sheetId.startsWith('sheet_')) continue;\n          const sheet = rawData[sheetId];\n          if (!sheet || !sheet.name || !sheet.content) continue;\n\n          const result = LockManager.applyLocks(sheet.name, sheet.content);\n          if (result.modified) {\n            anyLockApplied = true;\n          }\n          if (result.restored.length > 0) {\n          }\n        }\n        if (anyLockApplied) {\n        }\n      }\n\n      // [] auto\n      // \n      // \n      if (rawData && !isAutoTransforming && isDataFromDatabase) {\n        try {\n          const enabledRules = RegexTransformationManager.getEnabledRules();\n\n          if (enabledRules.length > 0) {\n            console.info(`[DICE] ${enabledRules.length} ...`);\n\n            isAutoTransforming = true; // \n            const transformResult = RegexTransformationEngine.applyToTable(rawData, enabledRules);\n            if (transformResult.totalApplied > 0) {\n              console.info(`[DICE] ${transformResult.totalApplied} `);\n\n              // \n              //  saveDataOnly \n              // saveDataOnly  UpdateController.handleUpdate() isAutoTransforming \n              // \n              saveDataOnly(rawData).catch(err => {\n                console.warn('[DICE]:', err);\n              });\n            }\n            if (transformResult.errors.length > 0) {\n              console.warn(`[DICE] ${transformResult.errors.length} :`, transformResult.errors);\n            } else if (transformResult.totalApplied === 0) {\n              console.info('[DICE]');\n            }\n            isAutoTransforming = false; // \n          } else {\n            isAutoTransforming = false; // \n          }\n        } catch (transformError) {\n          isAutoTransforming = false; // \n          const errorMsg = transformError instanceof Error ? transformError.message : String(transformError);\n          console.error('[DICE]:', transformError);\n        }\n      }\n\n      if (rawData) {\n        cachedRawData =\n          typeof structuredClone === 'function' ? structuredClone(rawData) : JSON.parse(JSON.stringify(rawData));\n\n        const existingSnapshot = loadSnapshot();\n        const currentCtx = getCurrentContextFingerprint();\n\n        // \n        const hasValidSnapshotData =\n          existingSnapshot && Object.keys(existingSnapshot).some(k => k.startsWith('sheet_'));\n\n        if (!existingSnapshot || !hasValidSnapshotData) {\n          // 1    \n          saveSnapshot({ ...cachedRawData, _contextId: currentCtx });\n        } else if (!existingSnapshot._contextId) {\n          // 2 ID \n          saveSnapshot({ ...existingSnapshot, _contextId: currentCtx });\n        } else if (existingSnapshot._contextId !== currentCtx) {\n          // 3  \n          cachedRawData._contextId = currentCtx;\n          saveSnapshot(cachedRawData);\n        }\n        // 4  \n      }\n    }\n\n    const $searchInput = $('.acu-search-input');\n    if ($('.acu-wrapper').length && $searchInput.is(':focus')) {\n      if (rawData) {\n        if (!isSaving) currentDiffMap = generateDiffMap(rawData);\n        const tables = processJsonData(rawData);\n        const activeTab = getActiveTabState();\n        const currentTabName = activeTab && tables[activeTab] ? activeTab : null;\n\n        if (currentTabName && tables[currentTabName]) {\n          const newHtml = renderTableContent(tables[currentTabName], currentTabName);\n          const $virtualDom = $('<div>').html(newHtml);\n          $('.acu-card-grid').replaceWith($virtualDom.find('.acu-card-grid'));\n          $('.acu-panel-title').html($virtualDom.find('.acu-panel-title').html());\n          // [] \n          bindEvents(tables);\n          bindOptionEvents(); // <--- \n          return;\n        }\n      }\n    }\n\n    let lastScrollX = 0;\n    let lastScrollY = 0;\n\n    const $oldContent = $('.acu-panel-content');\n    if ($oldContent.length) {\n      lastScrollX = $oldContent.scrollLeft();\n      lastScrollY = $oldContent.scrollTop();\n    }\n\n    $('.acu-wrapper').remove();\n    const tables = processJsonData(rawData || {});\n\n    if (isSaving) {\n      currentDiffMap = new Set();\n    } else {\n      currentDiffMap = generateDiffMap(rawData);\n    }\n\n    const savedOrder = getSavedTableOrder();\n    let orderedNames = Object.keys(tables);\n    if (savedOrder)\n      orderedNames = savedOrder.filter(n => tables[n]).concat(orderedNames.filter(n => !savedOrder.includes(n)));\n\n    const hiddenList = getHiddenTables();\n    orderedNames = orderedNames.filter(n => !hiddenList.includes(n));\n\n    const activeTab = getActiveTabState();\n    let currentTabName = activeTab && tables[activeTab] && !hiddenList.includes(activeTab) ? activeTab : null;\n\n    const config = getConfig();\n    const isCollapsed = getCollapsedState();\n\n    const layoutClass = config.layout === 'vertical' ? 'acu-layout-vertical' : '';\n    // []  (/)\n    const positionClass = `acu-mode-${config.positionMode || 'fixed'}`;\n\n    // []  () \n    let finalGridCols = config.gridColumns;\n    if (finalGridCols === 'auto') {\n      const n = orderedNames.length;\n\n      if (n <= 4) {\n        finalGridCols = n < 2 ? 2 : n;\n      } else {\n        const empty3 = Math.ceil(n / 3) * 3 - n;\n        const empty4 = Math.ceil(n / 4) * 4 - n;\n        finalGridCols = empty4 <= empty3 ? 4 : 3;\n      }\n    }\n\n    // --- []  +  ---\n    let optionHtml = '';\n    let currentOptionHash = null; // \n\n    if (config.showOptionPanel !== false) {\n      const optionTables = [];\n      Object.keys(tables).forEach(k => {\n        if (k.includes('')) optionTables.push(tables[k]);\n      });\n\n      // []  - \n      if (optionTables.length > 0) {\n        const isOptionsCollapsed = getOptionsCollapsedState();\n        const collapseIcon = isOptionsCollapsed ? 'fa-chevron-right' : 'fa-chevron-down';\n        const collapseText = isOptionsCollapsed ? '' : '';\n        const collapsedClass = isOptionsCollapsed ? 'collapsed' : '';\n\n        let optionCount = 0;\n        let hasBtns = false;\n        // []\n        let optionValues = []; // \n\n        // \n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  optionCount++;\n                }\n              });\n            });\n          }\n        });\n\n        // \n        let buttonsHtml = `\n                    <div class=\"acu-opt-header\" data-action=\"toggle-options\">\n                        <span>\n                            <i class=\"fa-solid ${collapseIcon}\" style=\"margin-right:6px;font-size:10px;\"></i>\n                             (${optionCount})\n                        </span>\n                    </div>`;\n\n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  const cellStr = String(cell).trim();\n                  buttonsHtml += `<button class=\"acu-opt-btn\" data-val=\"${encodeURIComponent(cellStr)}\">${escapeHtml(cellStr)}</button>`;\n                  optionValues.push(cellStr);\n                  hasBtns = true;\n                }\n              });\n            });\n          }\n        });\n\n        if (hasBtns) {\n          optionHtml = `<div class=\"acu-option-panel acu-theme-${config.theme} ${collapsedClass}\">${buttonsHtml}</div>`;\n          //  ()\n          // [] \n          currentOptionHash =\n            optionValues.join('|||') +\n            (isOptionsCollapsed ? '_collapsed' : '_expanded') +\n            `_theme_${config.theme}` +\n            `_optSize_${config.optionFontSize || 12}`;\n        }\n      }\n    }\n\n    // [] \n    const optionChanged = currentOptionHash !== lastOptionHash;\n    if (optionChanged && currentOptionHash !== null) {\n      // \n      optionPanelVisible = true;\n    }\n    lastOptionHash = currentOptionHash; // \n\n    let html = `<div class=\"acu-wrapper ${positionClass} acu-theme-${config.theme} ${layoutClass}\" style=\"--acu-card-width:${config.cardWidth}px; --acu-font-size:${config.fontSize}px; --acu-opt-font-size:${config.optionFontSize || 12}px; --acu-grid-cols:${finalGridCols}\">`;\n\n    // []  DOM  column-reverse\n    // []  optionPanelVisible \n    if (config.positionMode === 'embedded' && optionHtml && optionPanelVisible) {\n      html += optionHtml;\n    }\n\n    if (isCollapsed) {\n      const colStyleClass = `acu-col-${config.collapseStyle || 'bar'}`;\n      const alignClass = `acu-align-${config.collapseAlign || 'right'}`;\n      html += `\n                <div class=\"acu-expand-trigger ${colStyleClass} ${alignClass}\" id=\"acu-btn-expand\">\n                    <i class=\"fa-solid fa-table\"></i> <span> (${Object.keys(tables).length})</span>\n                </div>\n            `;\n    } else {\n      // [] \n      const savedHeight = currentTabName ? getTableHeights()[currentTabName] : null;\n      // [] \n      const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n      const isChangesPanelActive = Store.get('acu_changes_panel_active', false);\n      const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n      const mvuSavedHeight = isMvuActive ? getTableHeights()[MvuModule.MODULE_ID] : null;\n      const finalSavedHeight = mvuSavedHeight || savedHeight;\n      const shouldShowPanel = isDashboardActive || isChangesPanelActive || isMvuActive || currentTabName;\n\n      html += `\n                <div class=\"acu-data-display ${shouldShowPanel ? 'visible' : ''} ${finalSavedHeight ? 'acu-manual-mode' : ''}\" id=\"acu-data-area\" style=\"${finalSavedHeight ? 'height:' + finalSavedHeight + 'px;' : ''}\">\n                    ${\n                      isChangesPanelActive\n                        ? renderChangesPanel(rawData)\n                        : isDashboardActive\n                          ? renderDashboard(tables)\n                          : isMvuActive\n                            ? '<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>'\n                            : currentTabName\n                              ? renderTableContent(tables[currentTabName], currentTabName)\n                              : ''\n                    }\n                </div>\n                `;\n\n      // [] \n      // PC(>768px) CSS display:flex !important grid \n      const gridFixStyle = `grid-template-columns: repeat(${finalGridCols}, 1fr);`;\n\n      html += `\n                <div class=\"acu-nav-container ${config.actionsPosition === 'top' ? 'acu-pos-top' : ''}\" id=\"acu-nav-bar\" style=\"${gridFixStyle}\">\n                    <div class=\"acu-order-controls\" id=\"acu-order-hint\"><i class=\"fa-solid fa-arrows-alt\"></i> </div>\n            `;\n\n      // ===  +  ===\n      const isChangesActive = Store.get('acu_changes_panel_active', false);\n      const isFavoritesActive = Store.get('acu_favorites_panel_active', false);\n      const isSimpleModeNav = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n      let changesCount = 0;\n      let validationErrorCount = 0;\n      if (rawData) {\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          for (const sheetId in rawData) {\n            if (!sheetId.startsWith('sheet_')) continue;\n            const newSheet = rawData[sheetId];\n            const oldSheet = snapshot[sheetId];\n            if (!newSheet?.content) continue;\n            const newRows = newSheet.content.slice(1);\n            const oldRows = oldSheet?.content?.slice(1) || [];\n\n            // [] detectChanges\n            const oldRowsByTitle = new Map<string, Array<{ index: number; row: (typeof oldRows)[0] }>>();\n            oldRows.forEach((row, rIdx) => {\n              const title = String(row[1] ?? '').trim();\n              if (!oldRowsByTitle.has(title)) {\n                oldRowsByTitle.set(title, []);\n              }\n              oldRowsByTitle.get(title)!.push({ index: rIdx, row });\n            });\n\n            newRows.forEach((row, rowIdx) => {\n              const title = String(row[1] ?? '').trim();\n              let oldRow: (typeof oldRows)[0] | undefined;\n\n              if (title && oldRowsByTitle.has(title)) {\n                const queue = oldRowsByTitle.get(title)!;\n                if (queue.length > 0) {\n                  const matched = queue.shift()!;\n                  oldRow = matched.row;\n                }\n              } else if (!title) {\n                oldRow = oldRows[rowIdx];\n              }\n\n              if (!oldRow) {\n                changesCount++; // \n              } else {\n                // \n                let hasChange = false;\n                row.forEach((cell, colIdx) => {\n                  if (colIdx === 0) return;\n                  if (String(cell ?? '') !== String(oldRow![colIdx] ?? '')) hasChange = true;\n                });\n                if (hasChange) changesCount++;\n              }\n            });\n\n            // \n            const newTitleCounts = new Map<string, number>();\n            const oldTitleCounts = new Map<string, number>();\n            newRows.forEach(row => {\n              const title = String(row[1] ?? '').trim();\n              if (title) newTitleCounts.set(title, (newTitleCounts.get(title) || 0) + 1);\n            });\n            oldRows.forEach(row => {\n              const title = String(row[1] ?? '').trim();\n              if (title) oldTitleCounts.set(title, (oldTitleCounts.get(title) || 0) + 1);\n            });\n            oldTitleCounts.forEach((oldCount, title) => {\n              const newCount = newTitleCounts.get(title) || 0;\n              if (oldCount > newCount) changesCount += oldCount - newCount;\n            });\n            // \n            const emptyOldCount = oldRows.filter(r => !String(r[1] ?? '').trim()).length;\n            const emptyNewCount = newRows.filter(r => !String(r[1] ?? '').trim()).length;\n            if (emptyOldCount > emptyNewCount) changesCount += emptyOldCount - emptyNewCount;\n          }\n          for (const sheetId in snapshot) {\n            if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n          }\n        }\n        // \n        validationErrorCount = ValidationEngine.getErrorCount(rawData);\n      }\n      // \n      const isValidationMode = isSimpleModeNav;\n      const displayCount = isValidationMode ? validationErrorCount : changesCount;\n      // \n      const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n      // ===  ===\n      const navHiddenList = getHiddenTables();\n      const navSavedOrder = getSavedTableOrder() || [];\n\n      //  + \n      const SPECIAL_NAV_ITEMS = [\n        { key: '__dice__', icon: 'fa-dice-d20', label: '', id: 'acu-btn-dice-nav', extraClass: 'acu-dice-nav-btn' },\n        {\n          key: '__changes__',\n          icon: 'fa-code-compare',\n          label: `${displayCount > 0 ? '(' + displayCount + ')' : ''}`,\n          id: 'acu-btn-changes',\n          extraClass: `acu-changes-btn${showWarningIcon ? ' has-validation-errors' : ''}`,\n          isActive: isChangesActive,\n          warningIcon: showWarningIcon,\n        },\n        {\n          key: '__mvu__',\n          icon: 'fa-code-branch',\n          label: '',\n          id: 'acu-btn-mvu',\n          extraClass: 'acu-mvu-btn',\n          isActive: getActiveTabState() === MvuModule.MODULE_ID,\n        },\n        {\n          key: '__favorites__',\n          icon: 'fa-star',\n          label: '',\n          id: 'acu-btn-favorites',\n          extraClass: 'acu-favorites-btn',\n          isActive: isFavoritesActive,\n        },\n      ];\n\n      // \n      let allNavItems = [];\n\n      // \n      SPECIAL_NAV_ITEMS.forEach(item => {\n        // \n        if (navHiddenList.includes(item.key)) return;\n\n        // MVU\n        if (item.key === '__mvu__') {\n          allNavItems.push({ ...item, isSpecial: true });\n          return;\n        }\n\n        // checkAvailable\n        if (item.checkAvailable && !item.checkAvailable()) return;\n        allNavItems.push({ ...item, isSpecial: true });\n      });\n\n      // \n      orderedNames.forEach(name => {\n        allNavItems.push({\n          key: name,\n          icon: getIconForTableName(name),\n          label: name,\n          isSpecial: false,\n          isActive: !isDashboardActive && !isChangesActive && currentTabName === name,\n        });\n      });\n\n      // \n      if (navSavedOrder.length > 0) {\n        const orderMap = new Map(navSavedOrder.map((k, i) => [k, i]));\n        allNavItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      // [] /\n      // order  1  Grid \n      html += `<button class=\"acu-nav-btn acu-dashboard-btn ${isDashboardActive ? 'active' : ''}\" id=\"acu-btn-dashboard\" style=\"order: 1;\">\n                <i class=\"fa-solid fa-chart-line\"></i><span></span>\n            </button>`;\n\n      // order  2 \n      allNavItems.forEach((item, idx) => {\n        const activeClass = item.isActive ? 'active' : '';\n        const extraClass = item.extraClass || '';\n        const orderVal = idx + 2; //  2  1\n\n        if (item.isSpecial) {\n          // \n          const warningIconHtml = item.warningIcon\n            ? '<i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>'\n            : '';\n          html += `<button class=\"acu-nav-btn ${extraClass} ${activeClass}\" id=\"${item.id}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>${warningIconHtml}\n                    </button>`;\n        } else {\n          // \n          html += `<button class=\"acu-nav-btn ${activeClass}\" data-table=\"${escapeHtml(item.key)}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>\n                    </button>`;\n        }\n      });\n\n      // order \n      html += `<div class=\"acu-actions-group\" id=\"acu-active-actions\" style=\"order: 9999;\">`;\n      ACTION_BUTTONS.forEach(btn => {\n        html += `<button class=\"acu-action-btn\" id=\"${btn.id}\" title=\"${btn.title}\"><i class=\"fa-solid ${btn.icon}\"></i></button>`;\n      });\n      html += `</div>`;\n\n      html += `</div>`; //  acu-nav-container\n    }\n\n    html += `</div>`; //  acu-wrapper\n\n    const $existing = $('.acu-wrapper');\n    if ($existing.length) {\n      $existing.replaceWith(html);\n    } else {\n      insertHtmlToPage(html);\n    }\n\n    // --- []  ---\n    if (config.positionMode !== 'embedded' && optionHtml && optionPanelVisible) {\n      if (optionChanged) {\n        //  AI \n        injectIndependentOptions(optionHtml);\n      } else {\n        // \n        const $existing = $('.acu-embedded-options-container');\n        if ($existing.length === 0) {\n          // \n          injectIndependentOptions(optionHtml);\n        }\n        // \n      }\n    } else if (config.positionMode !== 'embedded') {\n      // \n      $('.acu-embedded-options-container').remove();\n    } else {\n      // [] \n      $('.acu-embedded-options-container').remove();\n    }\n\n    bindEvents(tables);\n    bindOptionEvents();\n    updateSaveButtonState();\n    // [] \n    if (Store.get('acu_changes_panel_active', false)) {\n      bindChangesEvents();\n    }\n    // [] \n    if (getActiveTabState() === MvuModule.MODULE_ID) {\n      const $panel = $('#acu-data-area');\n      if ($panel.length) {\n        // \n        // \n        // \n        $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n        MvuModule.bindEvents($panel);\n\n        // \n        MvuModule.getDataWithRetry(5, 800)\n          .then(mvuData => {\n            // \n            if (mvuData) {\n              $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n              MvuModule.bindEvents($panel);\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error getting data:', err);\n            // \n            $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n            MvuModule.bindEvents($panel);\n          });\n      }\n    }\n\n    setTimeout(() => {\n      const $newContent = $('.acu-panel-content');\n      const activeTab = getActiveTabState();\n      const savedState = tableScrollStates[activeTab];\n\n      if ($newContent.length) {\n        // 1. \n        //  savedState () lastScrollY ()\n        if (savedState) {\n          $newContent.scrollTop(savedState.top);\n          $newContent.scrollLeft(savedState.left);\n        } else {\n          if (lastScrollY > 0) $newContent.scrollTop(lastScrollY);\n          if (lastScrollX > 0) $newContent.scrollLeft(lastScrollX);\n        }\n\n        // 2.  ()\n        if (savedState && savedState.inner) {\n          Object.keys(savedState.inner).forEach(key => {\n            const scrollTop = savedState.inner[key];\n            // \n            const $targetTitle = $newContent.find(`.acu-editable-title[data-row=\"${key}\"]`);\n            if ($targetTitle.length) {\n              const $card = $targetTitle.closest('.acu-data-card');\n              //  ( overflow on card)\n              $card.scrollTop(scrollTop);\n              //  body  ( overflow on body)\n              $card.find('.acu-card-body').scrollTop(scrollTop);\n            }\n          });\n        }\n      }\n    }, 0);\n    console.info('[DICE]');\n  };\n\n  // [] \n  const injectIndependentOptions = htmlContent => {\n    const { $ } = getCore();\n    $('.acu-embedded-options-container').remove();\n\n    //  AI \n    const getTargetContainer = () => {\n      const $allMes = $('#chat .mes');\n      const $aiMes = $allMes.filter(function () {\n        const $this = $(this);\n        if ($this.attr('is_user') === 'true' || $this.attr('is_system') === 'true' || $this.hasClass('sys_mes'))\n          return false;\n        //  data-is-system \n        if ($this.find('.name_text').text().trim() === 'System' || $this.attr('data-is-system') === 'true')\n          return false;\n        // [] \n        if ($this.find('.mes_text').length === 0) return false;\n        if ($this.css('display') === 'none') return false;\n        return true;\n      });\n      if ($aiMes.length === 0) return null;\n\n      const $targetMes = $aiMes.last();\n      const $targetText = $targetMes.find('.mes_text');\n      const $targetBlock = $targetMes.find('.mes_block');\n      if ($targetText.length) return $targetText;\n      if ($targetBlock.length) return $targetBlock;\n      return $targetMes;\n    };\n\n    const $target = getTargetContainer();\n    if ($target && $target.length) {\n      const optConfig = getConfig();\n      const $container = $(\n        `<div class=\"acu-embedded-options-container acu-theme-${optConfig.theme}\" style=\"--acu-opt-font-size:${optConfig.optionFontSize || 12}px;\"></div>`,\n      );\n      $container.html(htmlContent);\n      $target.append($container);\n    }\n  };\n\n  // []  ( + )\n  const bindOptionEvents = () => {\n    const { $ } = getCore();\n    //  Body \n    $('body')\n      .off('click.acu_opt')\n      .on('click.acu_opt', '.acu-opt-btn', async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const config = getConfig();\n        const val = decodeURIComponent($(this).data('val'));\n\n        // 1:  -> \n        if (!config.clickOptionToAutoSend) {\n          smartInsertToTextarea(val, 'action');\n          $('#send_textarea').focus();\n          return;\n        }\n\n        // 2: \n        // A: TavernHelper ( refresh: 'affected' )\n        if (window.TavernHelper) {\n          try {\n            // 1.  createChatMessages \n            if (window.TavernHelper.createChatMessages) {\n              await window.TavernHelper.createChatMessages(\n                [\n                  {\n                    role: 'user',\n                    message: val,\n                  },\n                ],\n                {\n                  //  TavernHelper \n                  refresh: 'affected',\n                },\n              );\n\n              // 2. \n              if (window.TavernHelper.triggerSlash) {\n                await window.TavernHelper.triggerSlash('/trigger');\n              }\n              return;\n            }\n          } catch (err) {\n            console.warn('[DICE]ACU TavernHelper ', err);\n          }\n        }\n\n        // B: SillyTavern  (Slash Command)\n        const ST = window.SillyTavern || window.parent?.SillyTavern;\n        if (ST && ST.executeSlashCommandsWithOptions) {\n          try {\n            //  raw=true  ( slash_command.txt)\n            const safeVal = val.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n            const cmd = `/send raw=true \"${safeVal}\"`;\n\n            const sendResult = await ST.executeSlashCommandsWithOptions(cmd);\n\n            if (!sendResult.isError && !sendResult.isAborted) {\n              await ST.executeSlashCommandsWithOptions('/trigger');\n              return;\n            }\n            console.warn('[DICE]ACU ST send :', sendResult);\n          } catch (err) {\n            console.warn('[DICE]ACU ST', err);\n          }\n        }\n\n        // C:  +  ()\n        const ta = $('#send_textarea');\n        if (ta.length) {\n          ta.val(val);\n          ta.trigger('input').trigger('change');\n          //  React \n          await new Promise(r => setTimeout(r, 50));\n          const sendBtn = $('#send_but').filter(':visible');\n          if (sendBtn.length) {\n            sendBtn[0].click();\n          } else {\n            // \n            const enterEvent = $.Event('keydown', { keyCode: 13, which: 13, bubbles: true });\n            ta.trigger(enterEvent);\n          }\n        }\n      });\n  };\n\n  const insertHtmlToPage = html => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // ---  ---\n\n    // 1.  (Embedded) v19 \n    if (config.positionMode === 'embedded') {\n      $('.acu-wrapper').remove(); // \n\n      const getTargetContainer = () => {\n        const $allMes = $('#chat .mes');\n        const $aiMes = $allMes.filter(function () {\n          const $this = $(this);\n          if ($this.attr('is_user') === 'true') return false;\n          if ($this.attr('is_system') === 'true') return false;\n          if ($this.hasClass('sys_mes')) return false;\n          const name = $this.find('.name_text').text().trim();\n          if (name === 'System') return false;\n          if ($this.css('display') === 'none') return false;\n          const $textDiv = $this.find('.mes_text');\n          if ($textDiv.length === 0) return false;\n          const textContent = $textDiv.text().trim();\n          const hasImage = $textDiv.find('img').length > 0;\n          if (textContent.length === 0 && !hasImage) return false;\n          return true;\n        });\n        //  AI  chat\n        if ($aiMes.length === 0) return $('#chat');\n\n        // \n\n        let targetIndex = $aiMes.length - 1;\n        const $targetMes = $aiMes.eq(targetIndex);\n        const $targetBlock = $targetMes.find('.mes_block');\n        return $targetBlock.length ? $targetBlock : $targetMes;\n      };\n\n      const $target = getTargetContainer();\n      if ($target.length) {\n        if ($target.hasClass('mes_block') || $target.hasClass('mes')) {\n          if ($target.find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          } else {\n            $target.find('.acu-wrapper').replaceWith(html);\n          }\n        } else {\n          // Fallback\n          if ($('#chat').find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          }\n        }\n      } else {\n        $('body').append(html);\n      }\n      return;\n    }\n\n    // 2.  (Fixed) B \n    // \n    const $chat = $('#chat');\n    const $oldWrapper = $('.acu-wrapper');\n\n    if ($oldWrapper.length) {\n      $oldWrapper.replaceWith(html);\n    } else {\n      if ($chat.length) {\n        $chat.append(html);\n      } else {\n        $('body').append(html);\n      }\n    }\n  };\n  // [] \n  const renderChangesPanel = rawData => {\n    const snapshot = loadSnapshot();\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // \n    const validationErrors = rawData ? ValidationEngine.validateAllData(rawData) : [];\n\n    if (!snapshot || !rawData) {\n      // \n      if (validationErrors.length === 0) {\n        return `\n                <div class=\"acu-panel-header\">\n                    <div class=\"acu-panel-title\">\n                        <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-compare\"></i> <span class=\"acu-title-text\"></span></div>\n                        <div class=\"acu-title-sub\"></div>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-panel-content\" style=\"display:flex;align-items:center;justify-content:center;\">\n                    <div class=\"acu-empty-hint\"></div>\n                </div>`;\n      }\n    }\n\n    // \n    const changes = [];\n\n    for (const sheetId in rawData) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      const newSheet = rawData[sheetId];\n      const oldSheet = snapshot[sheetId];\n      if (!newSheet?.name || !newSheet?.content) continue;\n\n      const tableName = newSheet.name;\n      const headers = newSheet.content[0] || [];\n      const newRows = newSheet.content.slice(1);\n      const oldRows = oldSheet?.content?.slice(1) || [];\n\n      // [] \n      // \n      const oldRowsByTitle = new Map<string, Array<{ index: number; row: (typeof oldRows)[0] }>>();\n      oldRows.forEach((row, rIdx) => {\n        const title = String(row[1] ?? '').trim();\n        if (!oldRowsByTitle.has(title)) {\n          oldRowsByTitle.set(title, []);\n        }\n        oldRowsByTitle.get(title)!.push({ index: rIdx, row });\n      });\n\n      newRows.forEach((row, rowIdx) => {\n        const title = String(row[1] ?? '').trim();\n\n        // \n        let oldRow: (typeof oldRows)[0] | undefined;\n        let oldRowIndex: number | undefined;\n\n        if (title && oldRowsByTitle.has(title)) {\n          const queue = oldRowsByTitle.get(title)!;\n          if (queue.length > 0) {\n            const matched = queue.shift()!; // \n            oldRow = matched.row;\n            oldRowIndex = matched.index;\n          }\n        } else if (!title) {\n          // \n          oldRow = oldRows[rowIdx];\n          oldRowIndex = rowIdx;\n        }\n\n        if (!oldRow) {\n          // \n          changes.push({\n            type: 'row_added',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: rowIdx,\n            headers,\n            row,\n            title: row[1] || ` ${rowIdx + 1}`,\n          });\n        } else {\n          // \n          const rowChanges: Array<{\n            colIndex: number;\n            header: string;\n            oldValue: string;\n            newValue: string;\n          }> = [];\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return; // \n            const oldVal = String(oldRow![colIdx] ?? '');\n            const newVal = String(cell ?? '');\n            if (oldVal !== newVal) {\n              rowChanges.push({\n                colIndex: colIdx,\n                header: headers[colIdx] || `${colIdx}`,\n                oldValue: oldVal,\n                newValue: newVal,\n              });\n            }\n          });\n\n          if (rowChanges.length === 1) {\n            // \n            const c = rowChanges[0];\n            changes.push({\n              type: 'cell_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              colIndex: c.colIndex,\n              header: c.header,\n              oldValue: c.oldValue,\n              newValue: c.newValue,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          } else if (rowChanges.length > 1) {\n            // \n            changes.push({\n              type: 'row_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              headers,\n              row,\n              oldRow,\n              changedFields: rowChanges,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          }\n        }\n      });\n\n      // [] \n      // \n      const newTitleCounts = new Map();\n      newRows.forEach((row, rIdx) => {\n        const title = String(row[1] ?? '').trim();\n        if (title) {\n          newTitleCounts.set(title, (newTitleCounts.get(title) || 0) + 1);\n        }\n      });\n\n      // \n      const oldTitleCounts = new Map();\n      oldRows.forEach((row, rIdx) => {\n        const title = String(row[1] ?? '').trim();\n        if (title) {\n          oldTitleCounts.set(title, (oldTitleCounts.get(title) || 0) + 1);\n        }\n      });\n\n      // \n      const processedTitles = new Set();\n      oldRows.forEach((oldRow, rIdx) => {\n        const title = String(oldRow[1] ?? '').trim();\n\n        if (!title) {\n          // \n          if (rIdx >= newRows.length) {\n            changes.push({\n              type: 'row_deleted',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rIdx,\n              headers,\n              row: oldRow,\n              title: ` ${rIdx + 1}`,\n            });\n          }\n        } else if (!processedTitles.has(title)) {\n          processedTitles.add(title);\n          const oldCount = oldTitleCounts.get(title) || 0;\n          const newCount = newTitleCounts.get(title) || 0;\n          const deletedCount = oldCount - newCount;\n\n          if (deletedCount > 0) {\n            // deletedCount\n            const matchingOldRows = oldRows\n              .map((r, i) => ({ row: r, index: i }))\n              .filter(item => String(item.row[1] ?? '').trim() === title);\n\n            const deletedRows = matchingOldRows.slice(-deletedCount);\n            deletedRows.forEach(item => {\n              changes.push({\n                type: 'row_deleted',\n                tableName,\n                tableKey: sheetId,\n                rowIndex: item.index,\n                headers,\n                row: item.row,\n                title: title,\n              });\n            });\n          }\n        }\n      });\n    }\n\n    // \n    for (const sheetId in snapshot) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      if (!rawData[sheetId]) {\n        const oldSheet = snapshot[sheetId];\n        changes.push({\n          type: 'table_deleted',\n          tableName: oldSheet?.name || sheetId,\n          tableKey: sheetId,\n        });\n      }\n    }\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n\n    // \n    const panelTitle = isValidationMode ? '' : '';\n    const panelIcon = isValidationMode ? 'fa-shield-halved' : 'fa-code-compare';\n    const toggleTitle = isValidationMode ? '' : '';\n\n    //  HTML\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n                    <div class=\"acu-title-main\"><i class=\"fa-solid ${panelIcon}\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                </div>\n                <div class=\"acu-header-actions\">\n                    ${!isValidationMode ? '<button class=\"acu-changes-batch-btn acu-batch-accept\" title=\"\"><i class=\"fa-solid fa-check-double\"></i></button>' : ''}\n                    <button class=\"acu-changes-batch-btn acu-batch-reject\" title=\"${isValidationMode ? '' : ''}\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                    <button class=\"acu-changes-batch-btn acu-simple-mode-toggle ${isValidationMode ? 'active' : ''}\" title=\"${toggleTitle}\">\n                        <i class=\"fa-solid ${isValidationMode ? 'fa-filter-circle-xmark' : 'fa-filter'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                    </div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>`;\n\n    html += `<div class=\"acu-panel-content acu-changes-content ${config.layout === 'horizontal' ? 'acu-changes-horizontal' : ''}\">`;\n\n    // ===  ===\n    if (isValidationMode) {\n      if (validationErrors.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedErrors = ValidationEngine.groupErrorsByTable(validationErrors);\n        const collapsedGroups = Store.get('acu_validation_collapsed_groups', []);\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        for (const tableName in groupedErrors) {\n          const tableErrors = groupedErrors[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header acu-validation-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\" style=\"background:${t.errorText};\">${tableErrors.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableErrors.forEach(error => {\n            const ruleData = error.rule\n              ? escapeHtml(\n                  JSON.stringify({\n                    ruleId: error.ruleId,\n                    ruleType: error.ruleType,\n                    tableName: error.tableName,\n                    rowIndex: error.rowIndex,\n                    columnName: error.columnName || '',\n                    currentValue: error.currentValue || '',\n                    rowTitle: error.rowTitle || '', //  rowTitle  ruleData\n                    rule: error.rule,\n                  }),\n                )\n              : '';\n\n            html += `<div class=\"acu-change-item acu-validation-error-item\"\n                         data-table=\"${escapeHtml(error.tableName)}\"\n                         data-row=\"${error.rowIndex}\"\n                         data-column=\"${escapeHtml(error.columnName || '')}\"\n                         data-rule-id=\"${escapeHtml(error.ruleId || '')}\"\n                         data-rule-type=\"${escapeHtml(error.ruleType || '')}\"\n                         data-rule-data=\"${ruleData}\">\n                        <span class=\"acu-change-badge\" style=\"background:var(--acu-hl-manual-bg);color:var(--acu-hl-manual);\">!</span>\n                        ${error.rowTitle && error.rowIndex >= 0 ? `<div class=\"acu-validation-row-title\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:2px;\">${escapeHtml(error.rowTitle)}</div>` : ''}\n                        <span class=\"acu-change-title\">${escapeHtml(error.columnName || '')}${error.currentValue ? `: ${escapeHtml(error.currentValue.length > 15 ? error.currentValue.substring(0, 15) + '...' : error.currentValue)}` : ''}</span>\n                        <span class=\"acu-validation-error-msg\">${escapeHtml(error.errorMessage.length > 25 ? error.errorMessage.substring(0, 25) + '...' : error.errorMessage)}</span>\n                        <div class=\"acu-change-actions\">\n                            <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                        </div>\n                    </div>`;\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    } else {\n      // ===  ===\n      if (changes.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedChanges = {};\n        changes.forEach(c => {\n          const key = c.tableName;\n          if (!groupedChanges[key]) groupedChanges[key] = [];\n          groupedChanges[key].push(c);\n        });\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        const collapsedGroups = Store.get('acu_changes_collapsed_groups', []);\n\n        for (const tableName in groupedChanges) {\n          const tableChanges = groupedChanges[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\">${tableChanges.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableChanges.forEach(change => {\n            if (change.type === 'row_added') {\n              html += `<div class=\"acu-change-item acu-change-added\"\n                            data-change-type=\"row_added\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-added\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"row_deleted\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'cell_modified') {\n              const oldShort = change.oldValue.length > 15 ? change.oldValue.substring(0, 15) + '...' : change.oldValue;\n              const newShort = change.newValue.length > 15 ? change.newValue.substring(0, 15) + '...' : change.newValue;\n\n              const isOptionTable = change.tableName && change.tableName.includes('');\n              let fieldDisplay;\n              if (isOptionTable) {\n                fieldDisplay = `${escapeHtml(change.tableName)}.${escapeHtml(change.header)}`;\n              } else {\n                fieldDisplay = `${escapeHtml(change.rowTitle)}.${escapeHtml(change.header)}`;\n              }\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"cell_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\"\n                            data-col-index=\"${change.colIndex}\"\n                            data-old-value=\"${encodeURIComponent(change.oldValue)}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-field\">${fieldDisplay}</span>\n                            <span class=\"acu-change-diff\">\n                                <span class=\"acu-diff-old\">${escapeHtml(oldShort || '()')}</span>\n                                <span class=\"acu-diff-arrow\"></span>\n                                <span class=\"acu-diff-new\">${escapeHtml(newShort || '()')}</span>\n                            </span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_modified') {\n              // \n              const fieldCount = change.changedFields.length;\n              const fieldNames = change.changedFields\n                .slice(0, 2)\n                .map(f => f.header)\n                .join('');\n              const moreText = fieldCount > 2 ? ` ${fieldCount}` : '';\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"row_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.rowTitle)}</span>\n                            <span class=\"acu-change-field-count\">${escapeHtml(fieldNames)}${moreText}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'table_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"table_deleted\"\n                            data-table-key=\"${change.tableKey}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\"></span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            }\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    }\n\n    html += `</div>`;\n    return html;\n  };\n  // [] \n  const bindChangesEvents = () => {\n    const { $ } = getCore();\n\n    // \n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-close-btn')\n      .off('click')\n      .on('click', function () {\n        Store.set('acu_changes_panel_active', false);\n        $('#acu-data-area').removeClass('visible');\n        $('.acu-nav-btn').removeClass('active');\n      });\n\n    // === ===\n    const TOUCH_MOVE_THRESHOLD = 10; // 10px\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const tableName = $item.data('table');\n        const rowIndex = parseInt($item.data('row'), 10);\n        const columnName = $item.data('column');\n\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        try {\n          const rawData = cachedRawData || getTableData();\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === tableName && snapshot[sheetId]) {\n              const headers = rawData[sheetId].content?.[0] || [];\n              const colIdx = headers.indexOf(columnName);\n              if (colIdx >= 0 && snapshot[sheetId].content?.[rowIndex + 1]) {\n                const snapshotValue = snapshot[sheetId].content[rowIndex + 1][colIdx];\n                rawData[sheetId].content[rowIndex + 1][colIdx] = snapshotValue;\n                await saveDataToDatabase(rawData, false, false);\n                renderInterface();\n                return;\n              }\n              break;\n            }\n          }\n          if (window.toastr) window.toastr.warning('');\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const ruleData = $item.data('rule-data');\n        if (!ruleData) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        try {\n          const parsed = typeof ruleData === 'string' ? JSON.parse(ruleData) : ruleData;\n          const error = {\n            ruleId: parsed.ruleId,\n            ruleType: parsed.ruleType,\n            rule: parsed.rule,\n            tableName: $item.data('table') || parsed.tableName || '',\n            rowIndex: parseInt($item.data('row'), 10) || parsed.rowIndex || 0,\n            columnName: $item.data('column') || parsed.columnName || '',\n            currentValue: parsed.currentValue || '',\n            rowTitle: parsed.rowTitle || '', //  rowTitle \n            ruleName: parsed.ruleName || parsed.rule?.name || '',\n            errorMessage: parsed.errorMessage || parsed.rule?.errorMessage || '',\n          };\n          showSmartFixModal(error);\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    let validationItemTouchStartPos: { x: number; y: number } | null = null;\n\n    $('.acu-validation-error-item')\n      .off('click touchstart touchend touchmove')\n      .on('touchstart', function (e) {\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        validationItemTouchStartPos = { x: touch.clientX, y: touch.clientY };\n      })\n      .on('touchmove', function (e) {\n        if (!validationItemTouchStartPos) return;\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        const deltaX = Math.abs(touch.clientX - validationItemTouchStartPos.x);\n        const deltaY = Math.abs(touch.clientY - validationItemTouchStartPos.y);\n        // \n        if (deltaX > TOUCH_MOVE_THRESHOLD || deltaY > TOUCH_MOVE_THRESHOLD) {\n          validationItemTouchStartPos = null;\n        }\n      })\n      .on('touchend', function (e) {\n        // \n        if (!validationItemTouchStartPos) return;\n        validationItemTouchStartPos = null;\n\n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      })\n      .on('click', function (e) {\n        //  click \n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        //  touchend \n        if ('ontouchstart' in window) return;\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      });\n\n    // /\n    $('.acu-changes-group-header')\n      .off('click')\n      .on('click', function (e) {\n        if ($(e.target).closest('.acu-change-item').length) return;\n\n        const tableName = $(this).data('table');\n        const $group = $(this).closest('.acu-changes-group');\n        const $body = $group.find('.acu-changes-group-body');\n        const $icon = $(this).find('.acu-collapse-icon');\n\n        // \n        const isValidationMode = $(this).hasClass('acu-validation-group-header');\n        const storageKey = isValidationMode ? 'acu_validation_collapsed_groups' : 'acu_changes_collapsed_groups';\n        let collapsedGroups = Store.get(storageKey, []);\n\n        if ($group.hasClass('collapsed')) {\n          $group.removeClass('collapsed');\n          $body.slideDown(200);\n          $icon.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n          collapsedGroups = collapsedGroups.filter(n => n !== tableName);\n        } else {\n          $group.addClass('collapsed');\n          $body.slideUp(200);\n          $icon.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n          if (!collapsedGroups.includes(tableName)) {\n            collapsedGroups.push(tableName);\n          }\n        }\n\n        Store.set(storageKey, collapsedGroups);\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-accept')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n\n        const snapshot = loadSnapshot();\n        const rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = rawData[tableKey].content[rowIndex + 1][colIndex];\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            if (!snapshot[tableKey]) {\n              snapshot[tableKey] = JSON.parse(JSON.stringify(rawData[tableKey]));\n            } else {\n              snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n            }\n          }\n        } else if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          delete snapshot[tableKey];\n        }\n\n        saveSnapshot(snapshot);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n        const oldValue = decodeURIComponent($item.data('old-value') || '');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content[rowIndex + 1][colIndex] = oldValue;\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content) {\n            rawData[tableKey].content[rowIndex + 1] = [...snapshot[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === /===\n    $('.acu-action-restore')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            const restoredRow = [...snapshot[tableKey].content[rowIndex + 1]];\n            if (!rawData[tableKey]) {\n              rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n              rawData[tableKey].content = [snapshot[tableKey].content[0]];\n            }\n            // \n            rawData[tableKey].content.splice(rowIndex + 1, 0, restoredRow);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          if (snapshot[tableKey]) {\n            rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item:not(.acu-validation-error-item) .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const changeType = $item.data('change-type');\n\n        if (!tableKey || rowIndex === undefined) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const sheet = rawData[tableKey];\n        const headers = sheet.content ? sheet.content[0] : [];\n        const row = sheet.content ? sheet.content[rowIndex + 1] : null;\n\n        if (!row) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        if (changeType === 'row_modified') {\n          // \n          showRowCompareEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        } else if (changeType === 'cell_modified') {\n          const colIndex = $item.data('col-index');\n          const headerName = headers[colIndex] || `${colIndex}`;\n          const cellValue = row[colIndex] || '';\n          showChangeSingleFieldModal(cellValue, headerName, sheet.name, rowIndex, colIndex, tableKey);\n        } else {\n          showChangeEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        }\n      });\n\n    // ===  ===\n    $('.acu-batch-accept')\n      .off('click')\n      .on('click', async function () {\n        const rawData = cachedRawData || getTableData();\n        if (!rawData) return;\n\n        // \n        saveSnapshot(JSON.parse(JSON.stringify(rawData)));\n        currentDiffMap = new Set();\n\n        // \n        refreshChangesPanel();\n      });\n\n    // ===  ===\n    $('.acu-batch-reject')\n      .off('click')\n      .on('click', async function () {\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const restoredData = JSON.parse(JSON.stringify(snapshot));\n        cachedRawData = restoredData;\n        await saveDataToDatabase(restoredData, false, false);\n      });\n\n    // ===  ===\n    $('.acu-simple-mode-toggle')\n      .off('click')\n      .on('click', function () {\n        const currentMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        const newMode = !currentMode;\n        Store.set(STORAGE_KEY_VALIDATION_MODE, newMode);\n\n        // \n        const rawData = cachedRawData || getTableData();\n        $('#acu-data-area').html(renderChangesPanel(rawData));\n        bindChangesEvents();\n\n        // \n        updateChangesCount(rawData);\n      });\n\n    // ===  ===\n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          // \n          const finalHeight = $panel.height();\n          const heights = getTableHeights();\n          heights[tableName] = finalHeight;\n          saveTableHeights(heights);\n        };\n      })\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const $panel = $('#acu-data-area');\n        $panel.css('height', ''); // \n        // \n        const heights = getTableHeights();\n        delete heights[tableName];\n        saveTableHeights(heights);\n      });\n\n    // ===  ===\n    const $horizontalScroller = $('.acu-changes-content.acu-changes-horizontal');\n    if ($horizontalScroller.length) {\n      $horizontalScroller[0].addEventListener(\n        'touchstart',\n        function (e) {\n          this._touchStartX = e.touches[0].clientX;\n          this._touchStartY = e.touches[0].clientY;\n          this._scrollDirection = null; // \n        },\n        { passive: true },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchmove',\n        function (e) {\n          if (!this._touchStartX) return;\n\n          const deltaX = Math.abs(e.touches[0].clientX - this._touchStartX);\n          const deltaY = Math.abs(e.touches[0].clientY - this._touchStartY);\n\n          // \n          if (!this._scrollDirection && (deltaX > 5 || deltaY > 5)) {\n            this._scrollDirection = deltaX > deltaY ? 'horizontal' : 'vertical';\n          }\n\n          // \n          // \n          if (this._scrollDirection === 'horizontal' && deltaX > 10) {\n            e.stopPropagation();\n          }\n        },\n        { passive: false },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchend',\n        function () {\n          this._touchStartX = null;\n          this._touchStartY = null;\n          this._scrollDirection = null;\n        },\n        { passive: true },\n      );\n    }\n  };\n\n  // [] \n  const refreshChangesPanel = () => {\n    const { $ } = getCore();\n    const rawData = cachedRawData || getTableData();\n    currentDiffMap = generateDiffMap(rawData);\n\n    const $panel = $('#acu-data-area');\n    if ($panel.length && Store.get('acu_changes_panel_active', false)) {\n      $panel.html(renderChangesPanel(rawData));\n      bindChangesEvents();\n\n      // \n      updateChangesCount(rawData);\n    }\n  };\n\n  // []  + \n  const updateChangesCount = rawData => {\n    const { $ } = getCore();\n    const snapshot = loadSnapshot();\n    let changesCount = 0;\n\n    if (snapshot && rawData) {\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const newSheet = rawData[sheetId];\n        const oldSheet = snapshot[sheetId];\n        if (!newSheet?.content) continue;\n        const newRows = newSheet.content.slice(1);\n        const oldRows = oldSheet?.content?.slice(1) || [];\n\n        // [] detectChanges\n        const oldRowsByTitle = new Map<string, Array<{ index: number; row: (typeof oldRows)[0] }>>();\n        oldRows.forEach((row, rIdx) => {\n          const title = String(row[1] ?? '').trim();\n          if (!oldRowsByTitle.has(title)) {\n            oldRowsByTitle.set(title, []);\n          }\n          oldRowsByTitle.get(title)!.push({ index: rIdx, row });\n        });\n\n        newRows.forEach((row, rowIdx) => {\n          const title = String(row[1] ?? '').trim();\n          let oldRow: (typeof oldRows)[0] | undefined;\n\n          if (title && oldRowsByTitle.has(title)) {\n            const queue = oldRowsByTitle.get(title)!;\n            if (queue.length > 0) {\n              const matched = queue.shift()!;\n              oldRow = matched.row;\n            }\n          } else if (!title) {\n            oldRow = oldRows[rowIdx];\n          }\n\n          if (!oldRow) {\n            changesCount++; // \n          } else {\n            // \n            let hasChange = false;\n            row.forEach((cell, colIdx) => {\n              if (colIdx === 0) return;\n              if (String(cell ?? '') !== String(oldRow![colIdx] ?? '')) hasChange = true;\n            });\n            if (hasChange) changesCount++;\n          }\n        });\n\n        // \n        const newTitleCounts = new Map<string, number>();\n        const oldTitleCounts = new Map<string, number>();\n        newRows.forEach(row => {\n          const title = String(row[1] ?? '').trim();\n          if (title) newTitleCounts.set(title, (newTitleCounts.get(title) || 0) + 1);\n        });\n        oldRows.forEach(row => {\n          const title = String(row[1] ?? '').trim();\n          if (title) oldTitleCounts.set(title, (oldTitleCounts.get(title) || 0) + 1);\n        });\n        oldTitleCounts.forEach((oldCount, title) => {\n          const newCount = newTitleCounts.get(title) || 0;\n          if (oldCount > newCount) changesCount += oldCount - newCount;\n        });\n        // \n        const emptyOldCount = oldRows.filter(r => !String(r[1] ?? '').trim()).length;\n        const emptyNewCount = newRows.filter(r => !String(r[1] ?? '').trim()).length;\n        if (emptyOldCount > emptyNewCount) changesCount += emptyOldCount - emptyNewCount;\n      }\n      for (const sheetId in snapshot) {\n        if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n      }\n    }\n\n    // \n    const validationErrorCount = rawData ? ValidationEngine.getErrorCount(rawData) : 0;\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n    const displayCount = isValidationMode ? validationErrorCount : changesCount;\n    // \n    const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n    const $btn = $('#acu-btn-changes');\n    const $span = $btn.find('span');\n    $span.html(displayCount > 0 ? `(${displayCount})` : '');\n\n    // \n    if (showWarningIcon) {\n      if (!$btn.find('.acu-nav-warning-icon').length) {\n        $span.append(' <i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>');\n      }\n      $btn.addClass('has-validation-errors');\n    } else {\n      $btn.find('.acu-nav-warning-icon').remove();\n      $btn.removeClass('has-validation-errors');\n    }\n  };\n  // [] \n  const showChangeEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const inputsHtml = row\n      .map((cell, idx) => {\n        if (idx === 0) return '';\n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        return `\n                <div class=\"acu-card-edit-field\" style=\"margin-bottom: 10px;\">\n                    <label style=\"display:block;font-size:12px;color:var(--acu-accent);font-weight:bold;margin-bottom:4px;\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\"\n                                                        style=\"width:100%;min-height:40px;max-height:500px;padding:10px;resize:none;overflow-y:hidden;\">${escapeHtml(val)}</textarea>                            </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${inputsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-change-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-change-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // [] \n    const adjustHeight = el => {\n      //  auto  0px scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n    };\n    dialog.find('#dlg-change-cancel').click(closeDialog);\n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n\n    dialog.find('#dlg-change-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n\n        if (hasChanges) {\n          // 1. \n          try {\n            const api = getCore().getDB();\n            if (!api || !api.importTableAsJson) {\n              throw new Error(' API ');\n            }\n\n            const dataToSave = { mate: rawData.mate || { type: 'chatSheets', version: 1 } };\n            Object.keys(rawData).forEach(k => {\n              if (k.startsWith('sheet_')) dataToSave[k] = rawData[k];\n            });\n\n            // \n            let jsonString;\n            try {\n              jsonString = JSON.stringify(dataToSave);\n              //  10MB \n              const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n              if (sizeInMB > 10) {\n                throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n              }\n            } catch (stringifyError) {\n              console.error('[DICE]ACU JSON :', stringifyError);\n              throw new Error(`: ${stringifyError.message || stringifyError}`);\n            }\n\n            //  importTableAsJson saveChat()\n            const result = await api.importTableAsJson(jsonString);\n            //  false \n            if (result === false) {\n              throw new Error(' false');\n            }\n            cachedRawData = rawData;\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            let errorMessage = e.message || '';\n            //  \"Settings could not be saved\" \n            const errorMsg = String(e);\n            if (\n              errorMsg.includes('Settings could not be saved') ||\n              errorMsg.includes('server connection') ||\n              errorMsg.includes('data loss')\n            ) {\n              errorMessage = '';\n            }\n            if (window.toastr) {\n              window.toastr.error(errorMessage, '', { timeOut: 7000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n            // \n            return;\n          }\n\n          // 2. \n          const snapshot = loadSnapshot();\n          if (snapshot && snapshot[tableKey] && snapshot[tableKey].content) {\n            snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n            saveSnapshot(snapshot);\n          }\n\n          // 3.  diffMap \n          currentDiffMap = generateDiffMap(rawData);\n\n          // 4. \n          const $panel = $('#acu-data-area');\n          $panel.html(renderChangesPanel(rawData));\n          bindChangesEvents();\n        }\n      }\n      closeDialog();\n    });\n  };\n  // [] \n  const showChangeSingleFieldModal = (value, headerName, tableName, rowIndex, colIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldValue = snapshot?.[tableKey]?.content?.[rowIndex + 1]?.[colIndex] ?? '';\n    const hasOldValue = oldValue !== '' && String(oldValue) !== String(value);\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:450px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(headerName)}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${\n                          hasOldValue\n                            ? `\n                        <div class=\"acu-diff-section acu-diff-old-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                            </div>\n                            <div class=\"acu-diff-readonly\">${escapeHtml(oldValue)}</div>\n                        </div>\n                        <div class=\"acu-diff-arrow-down\">\n                            <i class=\"fa-solid fa-arrow-down\"></i>\n                        </div>\n                        `\n                            : ''\n                        }\n                        <div class=\"acu-diff-section acu-diff-new-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-pen\"></i> ${hasOldValue ? '' : ''}\n                            </div>\n                            <textarea class=\"acu-change-single-input acu-edit-textarea\" spellcheck=\"false\"\n                                style=\"width:100%;min-height:60px;max-height:300px;padding:12px;resize:none;\">${escapeHtml(value)}</textarea>\n                        </div>\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-single-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        ${hasOldValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"dlg-single-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-single-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const $textarea = dialog.find('.acu-change-single-input');\n    const adjustHeight = () => {\n      $textarea[0].style.height = 'auto';\n      const h = Math.max(60, Math.min($textarea[0].scrollHeight + 2, 300));\n      $textarea[0].style.height = h + 'px';\n    };\n    setTimeout(adjustHeight, 0);\n    $textarea.on('input', adjustHeight);\n    $textarea.focus();\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-single-cancel').click(closeDialog);\n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n\n    // [] \n    dialog.find('#dlg-single-revert').click(function () {\n      $textarea.val(oldValue).trigger('input');\n    });\n\n    dialog.find('#dlg-single-save').click(async () => {\n      const newVal = $textarea.val();\n      let rawData = cachedRawData || getTableData();\n\n      if (rawData && rawData[tableKey] && rawData[tableKey].content) {\n        const currentRow = rawData[tableKey].content[rowIndex + 1];\n        if (currentRow && String(currentRow[colIndex]) !== String(newVal)) {\n          currentRow[colIndex] = newVal;\n\n          // \n          await saveDataOnly(rawData);\n\n          // \n          const snapshot = loadSnapshot();\n          if (\n            snapshot &&\n            snapshot[tableKey] &&\n            snapshot[tableKey].content &&\n            snapshot[tableKey].content[rowIndex + 1]\n          ) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = newVal;\n            saveSnapshot(snapshot);\n          }\n\n          // \n          currentDiffMap = generateDiffMap(rawData);\n          refreshChangesPanel();\n        }\n      }\n      closeDialog();\n    });\n  };\n\n  // [] \n  const showRowCompareEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldRow = snapshot?.[tableKey]?.content?.[rowIndex + 1] || [];\n\n    // \n    let fieldsHtml = '';\n    for (let idx = 1; idx < headers.length; idx++) {\n      const headerName = headers[idx] || ` ${idx}`;\n      const oldVal = oldRow[idx] ?? '';\n      const newVal = row[idx] ?? '';\n      const isChanged = String(oldVal) !== String(newVal);\n\n      fieldsHtml += `\n                <div class=\"acu-row-edit-field ${isChanged ? 'acu-field-changed' : ''}\">\n                    <div class=\"acu-row-edit-label\">${escapeHtml(headerName)} ${isChanged ? '<span class=\"acu-changed-badge\"></span>' : ''}</div>\n                    ${isChanged ? `<div class=\"acu-row-edit-old\">${escapeHtml(oldVal) || '<span class=\"acu-empty-val\">()</span>'}</div>` : ''}\n                    <textarea class=\"acu-row-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\">${escapeHtml(newVal)}</textarea>\n                </div>\n            `;\n    }\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:550px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(row[1] || ' ' + (rowIndex + 1))}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px; max-height:60vh;\">\n                        ${fieldsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-row-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = Math.min(el.scrollHeight + 2, 200) + 'px';\n    };\n    dialog.find('textarea').each(function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-row-cancel').click(closeDialog);\n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n\n    // \n    dialog.find('#dlg-row-revert').click(function () {\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        $(this)\n          .val(oldRow[colIdx] ?? '')\n          .trigger('input');\n      });\n    });\n\n    // \n    dialog.find('#dlg-row-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (!rawData?.[tableKey]?.content?.[rowIndex + 1]) {\n        closeDialog();\n        return;\n      }\n\n      const currentRow = rawData[tableKey].content[rowIndex + 1];\n      let hasChanges = false;\n\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        const newVal = $(this).val();\n        if (String(currentRow[colIdx]) !== String(newVal)) {\n          hasChanges = true;\n          currentRow[colIdx] = newVal;\n        }\n      });\n\n      if (hasChanges) {\n        await saveDataOnly(rawData);\n\n        // \n        const snapshot = loadSnapshot();\n        if (snapshot?.[tableKey]?.content) {\n          snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n          saveSnapshot(snapshot);\n        }\n\n        currentDiffMap = generateDiffMap(rawData);\n        refreshChangesPanel();\n      }\n      closeDialog();\n    });\n  };\n  const renderDashboard = allTables => {\n    console.info('[DICE]...');\n    const config = getConfig();\n\n    // [] \n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const questResult = DashboardDataParser.findTable(allTables, 'quest');\n    const bagResult = DashboardDataParser.findTable(allTables, 'bag');\n    const skillResult = DashboardDataParser.findTable(allTables, 'skill');\n    const equipResult = DashboardDataParser.findTable(allTables, 'equip');\n\n    // []  - \n    let player = { name: '', status: '', position: '', attrs: '', money: '0' };\n    const playerParsed = DashboardDataParser.parseRows(playerResult, 'player');\n\n    if (playerParsed.length > 0) {\n      const p = playerParsed[0];\n      player.name = p.name || '';\n      player.status = p.status || '';\n      player.position = p.position || '';\n      player.money = p.money || '';\n      player.resources = '';\n\n      // [] \n      if (playerResult?.data?.headers && playerResult?.data?.rows?.[0]) {\n        const headers = playerResult.data.headers;\n        const row = playerResult.data.rows[0];\n        let allAttrsStr = '';\n        headers.forEach((h, idx) => {\n          if (h && h.includes('')) {\n            const val = row[idx];\n            if (val) allAttrsStr += (allAttrsStr ? '; ' : '') + val;\n          }\n        });\n        player.attrs = allAttrsStr;\n\n        // \n        headers.forEach((h, idx) => {\n          if (h && (h.includes('') || h.includes(''))) {\n            const val = row[idx];\n            if (val) player.resources = val;\n          }\n        });\n      }\n    }\n\n    // [] HTML\n    const playerRows = playerResult?.data?.rows || [];\n    const playerHeaders = playerResult?.data?.headers || [];\n\n    // []  - \n    let globalDetailLocation = ''; // \n    let globalLocation = ''; // \n\n    if (globalResult?.data?.rows?.length > 0) {\n      const headers = globalResult.data.headers || [];\n      const row = globalResult.data.rows[0];\n\n      // \n      const detailIdx = DashboardDataParser.findColumnIndex(headers, 'detailLocation', globalResult.config);\n      if (detailIdx >= 0 && row[detailIdx]) {\n        globalDetailLocation = row[detailIdx];\n      }\n\n      // \n      const locIdx = DashboardDataParser.findColumnIndex(headers, 'currentLocation', globalResult.config);\n      globalLocation = locIdx >= 0 && row[locIdx] ? row[locIdx] : row[2] || '';\n    }\n\n    // currentPlaceName \n    let currentPlaceName =\n      globalDetailLocation ||\n      globalLocation ||\n      (player.position.includes('-') ? player.position.split('-')[0].trim() : player.position);\n\n    // [] NPC - \n    const npcTableName = npcResult?.name || '';\n    const npcTableKey = npcResult?.key || '';\n\n    const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n\n    // NPC\n    let inSceneNPCs = [];\n    let offSceneNPCs = [];\n    npcParsed.forEach(npc => {\n      const inSceneVal = String(npc.inScene || '').toLowerCase();\n      const npcData = {\n        name: npc.name || '',\n        status: npc.status || '',\n        position: npc.position || '',\n        index: npc._rowIndex,\n      };\n      if (inSceneVal === 'true' || inSceneVal === '') {\n        inSceneNPCs.push(npcData);\n      } else {\n        offSceneNPCs.push(npcData);\n      }\n    });\n    // \n    let allNPCs = [...inSceneNPCs, ...offSceneNPCs];\n\n    // []  -  + \n    const questTableName = questResult?.name || '';\n    const questParsed = DashboardDataParser.parseRows(questResult, 'quest');\n    const activeQuestParsed = DashboardDataParser.applyFilter(questParsed, 'active', 'quest');\n\n    //  >  >  > \n    const questTypeOrder = type => {\n      const t = String(type || '').toLowerCase();\n      if (t.includes('')) return 0;\n      if (t.includes('')) return 1;\n      if (t.includes('')) return 2;\n      return 3;\n    };\n    let activeTasks = activeQuestParsed\n      .map(q => ({\n        name: q.name || '',\n        type: q.type || '',\n        progress: q.progress || '',\n        _rowIndex: q._rowIndex,\n      }))\n      .sort((a, b) => questTypeOrder(a.type) - questTypeOrder(b.type));\n    // []  - \n    const bagTableName = bagResult?.name || '';\n\n    const bagParsed = DashboardDataParser.parseRows(bagResult, 'bag');\n    let bagItems = bagParsed.map(item => ({\n      name: item.name || '',\n      count: item.count || '1',\n      type: item.type || '',\n    }));\n\n    // []  - \n    const skillTableName = skillResult?.name || '';\n\n    const skillParsed = DashboardDataParser.parseRows(skillResult, 'skill');\n    let skills = skillParsed.map(s => ({\n      name: s.name || '',\n      level: s.level || '',\n      type: s.type || '',\n    }));\n\n    // []  -  + \n    const equipTableName = equipResult?.name || '';\n\n    const equipParsed = DashboardDataParser.parseRows(equipResult, 'equip');\n    const equippedParsed = DashboardDataParser.applyFilter(equipParsed, 'equipped', 'equip');\n\n    let equippedItems = equippedParsed.map(e => ({\n      name: e.name || '',\n      type: e.type || '',\n      part: e.part || '',\n    }));\n    // []  - \n    const locationTableName = locationResult?.name || '';\n    const locationTableKey = locationResult?.key || '';\n\n    const locationParsed = DashboardDataParser.parseRows(locationResult, 'location');\n\n    // HTML\n    let html = `\n        <div class=\"acu-panel-header\">\n            <div class=\"acu-panel-title\">\n                <div class=\"acu-title-main\"><i class=\"fa-solid fa-chart-line\"></i> <span class=\"acu-title-text\"></span></div>\n                <div class=\"acu-title-sub\"></div>\n            </div>\n            <div class=\"acu-header-actions\">\n                <div class=\"acu-height-control\">\n                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                </div>\n                <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n        </div>\n        <div class=\"acu-panel-content acu-dashboard-content\">\n            <div class=\"acu-dash-body ${config.layout === 'horizontal' ? 'acu-dash-horizontal' : ''}\">\n            <!--  +  -->\n                <div class=\"acu-dash-player\">\n                    <h3 class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                        data-table-key=\"${playerResult?.key || ''}\"\n                        data-row-index=\"0\"\n                        data-preview-type=\"player\"\n                        style=\"cursor:pointer;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-user-circle\"></i> ${escapeHtml(replaceUserPlaceholders(player.name))}</span>\n                        <span style=\"font-size:11px;font-weight:normal;color:var(--acu-text-main);background:var(--acu-badge-bg);padding:2px 8px;border-radius:10px;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;\" title=\"${escapeHtml(player.status)}\">${escapeHtml(player.status.length > 6 ? player.status.substring(0, 6) + '..' : player.status)}</span>\n                    </h3>\n                    <div class=\"acu-player-status\" style=\"min-height:110px;max-height:110px;overflow-y:auto;margin-bottom:10px;\">\n                        ${(() => {\n                          // \n                          const resourcesStr = player.resources || player.money || '';\n                          const parsedResources = parseAttributeString(resourcesStr);\n\n                          // \n                          let allAttrs = [];\n                          if (playerRows.length > 0 && playerHeaders.length > 0) {\n                            const row = playerRows[0];\n                            playerHeaders.forEach((h, idx) => {\n                              if (h && h.includes('')) {\n                                const parsed = parseAttributeString(row[idx] || '');\n                                parsed.forEach(attr => {\n                                  if (!allAttrs.some(a => a.name === attr.name)) {\n                                    allAttrs.push(attr);\n                                  }\n                                });\n                              }\n                            });\n                          }\n\n                          // \n                          if (parsedResources.length === 0 && allAttrs.length === 0) {\n                            return '<div class=\"acu-empty-hint\"></div>';\n                          }\n\n                          let html = '';\n                          if (parsedResources.length > 0) {\n                            html += `<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:52px;overflow-y:auto;margin-bottom:6px;padding-bottom:6px;border-bottom:1px dashed var(--acu-border);\">\n                                    ${parsedResources\n                                      .map(\n                                        res => `\n                                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;\">\n                                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(res.name)}\">${escapeHtml(res.name.substring(0, 3))}</span>\n                                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                                <span style=\"color:var(--acu-accent);font-size:11px;font-weight:bold;\">${res.value}</span>\n                                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${res.value}\" data-name=\"${escapeHtml(res.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${res.name}(${res.value})\"></i>\n                                            </div>\n                                        </div>\n                                    `,\n                                      )\n                                      .join('')}\n                                </div>`;\n                          }\n\n                          if (allAttrs.length > 0) {\n                            // 598px\n                            html += `<div style=\"display:grid;grid-template-columns:repeat(3,1fr);gap:2px 6px;max-height:98px;overflow-y:auto;overflow-x:hidden;\">\n                                    ${allAttrs\n                                      .map(\n                                        attr => `\n                                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;\">\n                                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(attr.name)}\">${escapeHtml(attr.name.substring(0, 2))}</span>\n                                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                                <span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${attr.value}</span>\n                                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${attr.value}\" data-name=\"${escapeHtml(attr.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${attr.name}(${attr.value})\"></i>\n                                            </div>\n                                        </div>\n                                    `,\n                                      )\n                                      .join('')}\n                                </div>`;\n                          }\n\n                          return html;\n                        })()}\n                    </div>\n\n                    <h4 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(skillTableName)}\" style=\"font-size:14px;color:var(--acu-accent);margin:10px 0 6px 0;\"><i class=\"fa-solid fa-bolt\"></i>  (${skillParsed.length})</h4>\n                    <div style=\"display:grid;grid-template-columns:repeat(2,1fr);gap:2px 6px;max-height:78px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      skills.length > 0\n                        ? skills\n                            .map((skill, idx) => {\n                              const skillValue = extractNumericValue(skill.level);\n                              const hasNumeric = skillValue > 0;\n                              const skillRowIndex = skillParsed.findIndex(s => s.name === skill.name);\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${skillResult?.key || ''}\"\n                            data-row-index=\"${skillRowIndex >= 0 ? skillRowIndex : idx}\"\n                            data-preview-type=\"skill\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;cursor:pointer;\">\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(skill.name)}\">${escapeHtml(skill.name.length > 5 ? skill.name.substring(0, 5) + '..' : skill.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                ${\n                                  hasNumeric\n                                    ? `<span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${skillValue}</span>\n                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${skillValue}\" data-name=\"${escapeHtml(skill.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${skill.name}(${skillValue})\"></i>`\n                                    : `<span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(skill.level || '-')}</span>`\n                                }\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  + NPC -->\n                <div class=\"acu-dash-locations\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(locationTableName)}\" style=\"display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-map\"></i>  (${locationParsed.length})</span>\n                        <i class=\"fa-solid fa-map acu-dash-map-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;align-content:start;max-height:110px;overflow-y:auto;overflow-x:hidden;margin-bottom:10px;\">\n                    ${\n                      locationParsed.length > 0\n                        ? locationParsed\n                            .map((loc, idx) => {\n                              const areaName = loc.name || '';\n                              const isCurrent =\n                                currentPlaceName &&\n                                (areaName.includes(currentPlaceName) || currentPlaceName.includes(areaName));\n                              return `<div class=\"acu-location-item acu-dash-clickable acu-dash-preview-trigger ${isCurrent ? 'acu-current-location' : ''}\"\n                            data-table-key=\"${escapeHtml(locationTableKey)}\"\n                            data-row-index=\"${loc._rowIndex}\"\n                            data-preview-type=\"location\">\n                            <span>\n                                ${isCurrent ? '<i class=\"fa-solid fa-location-dot\"></i>' : '<i class=\"fa-solid fa-map-pin\" style=\"font-size:9px;opacity:0.4;\"></i>'}\n                                <span title=\"${escapeHtml(areaName)}\">${escapeHtml(areaName)}</span>\n                            </span>\n                            ${!isCurrent ? `<i class=\"fa-solid fa-walking acu-dash-goto-btn\" data-location=\"${escapeHtml(areaName)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;flex-shrink:0;\" title=\"${areaName}\"></i>` : '<i class=\"fa-solid fa-street-view\" style=\"flex-shrink:0;\" title=\"\"></i>'}\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(npcTableName)}\" style=\"margin-top:10px;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-users\"></i>  (${allNPCs.length})</span>\n                        <span style=\"display:flex;gap:8px;\">\n                            <i class=\"fa-solid fa-project-diagram acu-dash-relation-graph-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                            <i class=\"fa-solid fa-user-circle acu-dash-avatar-manager-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                        </span>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;align-content:start;max-height:150px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      allNPCs.length > 0\n                        ? allNPCs\n                            .map((npc, npcIdx) => {\n                              const isInScene = inSceneNPCs.some(n => n.name === npc.name);\n                              const isLastNpc = npcIdx === allNPCs.length - 1;\n                              const npcAvatar = AvatarManager.get(npc.name);\n                              const avatarOffsetX = AvatarManager.getOffsetX(npc.name);\n                              const avatarOffsetY = AvatarManager.getOffsetY(npc.name);\n                              const avatarScale = AvatarManager.getScale(npc.name);\n                              const avatarStyle = npcAvatar\n                                ? `background-image:url('${npcAvatar}');background-size:${avatarScale}%;background-position:${avatarOffsetX}% ${avatarOffsetY}%;`\n                                : '';\n                              const offSceneFilter = isInScene\n                                ? ''\n                                : 'filter:grayscale(80%) brightness(0.7);opacity:0.5;';\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${escapeHtml(npcTableKey)}\"\n                            data-row-index=\"${npc.index}\"\n                            data-preview-type=\"npc\"\n                            style=\"padding:6px 4px;${!isLastNpc ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <span class=\"acu-task-name\" style=\"font-size:12px;display:flex;align-items:center;gap:6px;\">\n                                    <span class=\"acu-dash-npc-avatar\" style=\"width:22px;height:22px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border:1.5px solid ${isInScene ? 'var(--acu-accent)' : 'var(--acu-border)'};${avatarStyle}${offSceneFilter}\" title=\"${isInScene ? '' : ''}\">\n                                        ${!npcAvatar ? `<span style=\"font-size:10px;font-weight:bold;color:var(--acu-text-sub);${offSceneFilter}\">${escapeHtml(npc.name.charAt(0))}</span>` : ''}\n                                    </span>\n                                    <span title=\"${escapeHtml(npc.name)}\" style=\"${isInScene ? '' : 'opacity:0.6;'}\">${escapeHtml(npc.name.length > 4 ? npc.name.substring(0, 4) + '..' : npc.name)}</span>\n                                </span>\n                                <div style=\"display:flex;align-items:center;\">\n                                    <i class=\"fa-solid fa-people-arrows acu-dash-contest-btn\" data-npc=\"${escapeHtml(npc.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:8px;\" title=\"${npc.name}\"></i>\n                                </div>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  +  +  -->\n                <div class=\"acu-dash-intel\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(bagTableName)}\"><i class=\"fa-solid fa-bag-shopping\"></i>  (${bagParsed.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:90px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      bagItems.length > 0\n                        ? bagItems\n                            .map((item, idx) => {\n                              const isLastBag = idx === bagItems.length - 1;\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${bagResult?.key || ''}\"\n                            data-row-index=\"${idx}\"\n                            data-preview-type=\"bag\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLastBag ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);flex:1;white-space:nowrap;\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name.length > 4 ? item.name.substring(0, 4) + '..' : item.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:6px;\">\n                                <i class=\"fa-solid fa-hand-pointer acu-dash-use-item-btn\" data-item=\"${escapeHtml(item.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${item.name}\"></i>\n                                <span style=\"color:var(--acu-accent);font-weight:bold;\">${escapeHtml(item.count)}</span>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(equipTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-shield-halved\"></i>  (${equippedItems.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      equippedItems.length > 0\n                        ? equippedItems\n                            .map((item, idx) => {\n                              const isLast = idx === equippedItems.length - 1;\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${equipResult?.key || ''}\"\n                            data-row-index=\"${equipParsed.findIndex(r => r.name === item.name)}\"\n                            data-preview-type=\"equipment\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLast ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name.length > 5 ? item.name.substring(0, 5) + '..' : item.name)}</span>\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(item.part || item.type)}</span>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(questTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-clipboard-list\"></i>  (${activeTasks.length})</h3>\n                    <div style=\"max-height:50px;overflow-y:auto;\">\n                    ${\n                      activeTasks.length > 0\n                        ? activeTasks\n                            .map((t, idx) => {\n                              const isMain = String(t.type || '').includes('');\n                              // \n                              let progressPercent = null;\n                              const progressMatch = String(t.progress || '').match(/(\\d+)\\s*%/);\n                              if (progressMatch) {\n                                progressPercent = Math.min(100, Math.max(0, parseInt(progressMatch[1], 10)));\n                              }\n                              const progressBar =\n                                progressPercent !== null\n                                  ? `<div style=\"width:40px;height:4px;background:var(--acu-border);border-radius:2px;overflow:hidden;\"><div style=\"width:${progressPercent}%;height:100%;background:var(--acu-accent);\"></div></div>`\n                                  : '';\n                              return `<div class=\"acu-task-item acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${questResult?.key || ''}\"\n                            data-row-index=\"${t._rowIndex !== undefined ? t._rowIndex : questParsed.findIndex(q => q.name === t.name)}\"\n                            data-preview-type=\"quest\"\n                            style=\"padding:4px 8px;margin-bottom:3px;cursor:pointer;\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <div class=\"acu-task-name\" style=\"font-size:11px;${isMain ? 'font-weight:600;' : ''}\">${escapeHtml(t.name)}</div>\n                                ${progressBar}\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n            </div>\n    `;\n\n    // \n    const loadedModules = [\n      globalResult ? '' : null,\n      playerResult ? '' : null,\n      locationResult ? '' : null,\n      npcResult ? 'NPC' : null,\n      questResult ? '' : null,\n      bagResult ? '' : null,\n      skillResult ? '' : null,\n      equipResult ? '' : null,\n    ].filter(Boolean);\n\n    console.info(`[DICE]${loadedModules.length}: ${loadedModules.join(', ')}`);\n    return html;\n  };\n\n  // ========== []  ==========\n  const renderFavoritesPanel = async (): Promise<string> => {\n    const allFavorites = await FavoritesManager.getAll();\n    const allTags = await FavoritesManager.getAllTags();\n\n    // \n    const groupedByTag: Record<string, FavoriteItem[]> = {};\n    const untagged: FavoriteItem[] = [];\n\n    for (const fav of allFavorites) {\n      if (fav.tags && fav.tags.length > 0) {\n        for (const tag of fav.tags) {\n          if (!groupedByTag[tag]) groupedByTag[tag] = [];\n          groupedByTag[tag].push(fav);\n        }\n      } else {\n        untagged.push(fav);\n      }\n    }\n\n    // HTML ( acu-data-card)\n    const renderFavoriteCard = (fav: FavoriteItem) => {\n      // \n      const rowsHtml = fav.header\n        .map(\n          (h, i) => `\n        <div class=\"acu-card-row\">\n          <div class=\"acu-card-label\">${escapeHtml(h)}</div>\n          <div class=\"acu-card-value\">${escapeHtml(String(fav.rowData[i] || ''))}</div>\n        </div>\n      `,\n        )\n        .join('');\n      const tagsHtml = fav.tags.map(tag => `<span class=\"acu-fav-tag\">${escapeHtml(tag)}</span>`).join('');\n      const sourceLabel = fav.sourceInfo ? escapeHtml(fav.sourceInfo.tableName) : '';\n\n      //  acu-data-card \n      return `\n        <div class=\"acu-data-card acu-fav-card\" data-id=\"${escapeHtml(fav.id)}\">\n          <div class=\"acu-card-header\">\n            <span class=\"acu-card-index\">${sourceLabel}</span>\n            <span class=\"acu-editable-title\">${escapeHtml(String(fav.rowData[0] || ''))}</span>\n          </div>\n          <div class=\"acu-card-body view-list\">${rowsHtml}</div>\n          ${tagsHtml ? `<div class=\"acu-fav-card-tags\">${tagsHtml}</div>` : ''}\n        </div>\n      `;\n    };\n\n    // \n    const config = getConfig();\n\n    // \n    let contentHtml = '';\n\n    //  acu-card-grid \n    for (const tag of Object.keys(groupedByTag).sort()) {\n      contentHtml += `\n        <div class=\"acu-fav-group\">\n          <div class=\"acu-fav-group-title\"><i class=\"fa-solid fa-tag\"></i> ${escapeHtml(tag)}</div>\n          <div class=\"acu-card-grid\">${groupedByTag[tag].map(renderFavoriteCard).join('')}</div>\n        </div>\n      `;\n    }\n\n    // \n    if (untagged.length > 0) {\n      contentHtml += `\n        <div class=\"acu-fav-group\">\n          <div class=\"acu-fav-group-title\"><i class=\"fa-solid fa-inbox\"></i> </div>\n          <div class=\"acu-card-grid\">${untagged.map(renderFavoriteCard).join('')}</div>\n        </div>\n      `;\n    }\n\n    if (allFavorites.length === 0) {\n      contentHtml += `\n        <div class=\"acu-fav-empty\">\n          <i class=\"fa-solid fa-star\"></i>\n          <p></p>\n          <p>  \"\"</p>\n        </div>\n      `;\n    }\n\n    return `\n      <div class=\"acu-fav-wrapper acu-theme-${config.theme}\" style=\"--acu-card-width:${config.cardWidth}px; --acu-font-size:${config.fontSize}px;\">\n      <div class=\"acu-panel-header\">\n        <div class=\"acu-panel-title\">\n          <div class=\"acu-title-main\"><i class=\"fa-solid fa-star\"></i> <span class=\"acu-title-text\"></span></div>\n          <div class=\"acu-title-sub\">(${allFavorites.length})</div>\n        </div>\n        <div class=\"acu-header-actions\">\n          <button class=\"acu-view-btn\" id=\"acu-fav-import\" title=\"\"><i class=\"fa-solid fa-file-import\"></i></button>\n          <button class=\"acu-view-btn\" id=\"acu-fav-export\" title=\"\"><i class=\"fa-solid fa-file-export\"></i></button>\n          <div class=\"acu-search-wrapper\"><i class=\"fa-solid fa-search acu-search-icon\"></i><input type=\"text\" class=\"acu-search-input\" id=\"acu-fav-search\" placeholder=\"...\" /></div>\n          <div class=\"acu-height-control\"><i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\"></i></div>\n          <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n        </div>\n      </div>\n      <div class=\"acu-fav-panel-content\">\n        <div class=\"acu-fav-tag-filter-collapsible collapsed\">\n          <div class=\"acu-fav-tag-filter-header\">\n            <span></span>\n            <i class=\"fa-solid fa-chevron-down acu-fav-tag-toggle-icon\"></i>\n          </div>\n          <div class=\"acu-fav-tag-filter-body\">\n            ${untagged.length > 0 ? '<button class=\"acu-fav-tag-btn active\" data-tag=\"__untagged__\"></button>' : ''}\n            ${allTags.map(tag => `<button class=\"acu-fav-tag-btn active\" data-tag=\"${escapeHtml(tag)}\">${escapeHtml(tag)}</button>`).join('')}\n          </div>\n        </div>\n        ${contentHtml}\n      </div>\n      </div>\n    `;\n  };\n\n  // ========== []  ==========\n  const bindFavoritesEvents = ($panel: JQuery) => {\n    const { $ } = getCore();\n    const rawData = cachedRawData || getTableData();\n    const currentTables = rawData || {};\n\n    // \n    $panel.off('.favEvents');\n\n    // === []  ST  swipe regenerate ===\n    (function () {\n      const panelEl = $panel[0];\n      if (!panelEl) return;\n\n      // \n      if ((panelEl as any)._favSwipeFixApplied) return;\n      (panelEl as any)._favSwipeFixApplied = true;\n\n      let touchStartX = 0;\n      let touchStartY = 0;\n      let isHorizontalSwipe = false;\n\n      const onTouchStart = (e: TouchEvent) => {\n        if (e.touches.length === 1) {\n          touchStartX = e.touches[0].clientX;\n          touchStartY = e.touches[0].clientY;\n          isHorizontalSwipe = false;\n        }\n      };\n\n      const onTouchMove = (e: TouchEvent) => {\n        if (e.touches.length !== 1) return;\n\n        const touch = e.touches[0];\n        const deltaX = Math.abs(touch.clientX - touchStartX);\n        const deltaY = Math.abs(touch.clientY - touchStartY);\n\n        // deltaY\n        const isHorizontal = deltaY < 5 ? deltaX > 5 && deltaX > deltaY * 2 : deltaX > deltaY * 1.5 && deltaX > 10;\n\n        if (isHorizontal) {\n          isHorizontalSwipe = true;\n          e.stopImmediatePropagation();\n          e.stopPropagation();\n        }\n      };\n\n      const onTouchEnd = (e: TouchEvent) => {\n        if (isHorizontalSwipe) {\n          e.stopImmediatePropagation();\n          e.stopPropagation();\n          isHorizontalSwipe = false;\n        }\n        touchStartX = 0;\n        touchStartY = 0;\n      };\n\n      //  ST \n      panelEl.addEventListener('touchstart', onTouchStart, true);\n      panelEl.addEventListener('touchmove', onTouchMove, true);\n      panelEl.addEventListener('touchend', onTouchEnd, true);\n\n      // \n      $(window).on('pagehide.favSwipeFix', () => {\n        panelEl.removeEventListener('touchstart', onTouchStart, true);\n        panelEl.removeEventListener('touchmove', onTouchMove, true);\n        panelEl.removeEventListener('touchend', onTouchEnd, true);\n      });\n    })();\n\n    // \n    $panel.on('click.favEvents', '.acu-close-btn', function (e) {\n      e.stopPropagation();\n      Store.set('acu_favorites_panel_active', false);\n      // [] \n      $panel.html('');\n      $('#acu-btn-favorites').removeClass('active');\n    });\n\n    // []  - \n    $panel.on('pointerdown.favEvents', '.acu-height-drag-handle', function (e) {\n      if (e.button !== 0) return;\n      e.preventDefault();\n      e.stopPropagation();\n      const handle = this;\n      handle.setPointerCapture(e.pointerId);\n      $(handle).addClass('active');\n      const $dataArea = $('#acu-data-area');\n      const startHeight = $dataArea.height() || 400;\n      const startY = e.clientY;\n      const tableName = $(handle).data('table');\n\n      handle.onpointermove = function (moveE: PointerEvent) {\n        const dy = moveE.clientY - startY;\n        let newHeight = startHeight - dy;\n        if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n        if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n        $dataArea.css('height', newHeight + 'px');\n      };\n      handle.onpointerup = function (upE: PointerEvent) {\n        $(handle).removeClass('active');\n        handle.releasePointerCapture(upE.pointerId);\n        handle.onpointermove = null;\n        handle.onpointerup = null;\n        if (tableName) {\n          const heights = getTableHeights();\n          heights[tableName] = parseInt($dataArea.css('height'));\n          saveTableHeights(heights);\n          $dataArea.addClass('acu-manual-mode');\n        }\n      };\n    });\n\n    // []  - \n    $panel.on('dblclick.favEvents', '.acu-height-drag-handle', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const tableName = $(this).data('table');\n      if (tableName) {\n        const heights = getTableHeights();\n        delete heights[tableName];\n        saveTableHeights(heights);\n        $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n      }\n    });\n\n    // /\n    $panel.on('click.favEvents', '.acu-fav-tag-filter-header', function () {\n      const $collapsible = $(this).closest('.acu-fav-tag-filter-collapsible');\n      $collapsible.toggleClass('collapsed');\n    });\n\n    // toggle\n    $panel.on('click.favEvents', '.acu-fav-tag-btn', function () {\n      const $btn = $(this);\n      const tag = $btn.data('tag') as string;\n      const isActive = $btn.hasClass('active');\n\n      // \n      $btn.toggleClass('active');\n\n      // \n      if (tag === '__untagged__') {\n        // \"\"\n        $panel.find('.acu-fav-group').each(function () {\n          const groupTitle = $(this).find('.acu-fav-group-title').text();\n          if (groupTitle.includes('')) {\n            $(this).toggle(!isActive);\n          }\n        });\n      } else {\n        // \n        $panel.find('.acu-fav-group').each(function () {\n          const groupTitle = $(this).find('.acu-fav-group-title').text();\n          if (groupTitle.includes(tag) && !groupTitle.includes('')) {\n            $(this).toggle(!isActive);\n          }\n        });\n      }\n    });\n\n    // \n    $panel.find('#acu-fav-search').on(\n      'input.favEvents',\n      _.debounce(function () {\n        const searchTerm = ($(this).val() as string).toLowerCase().trim();\n        $panel.find('.acu-fav-card').each(function () {\n          const cardText = $(this).text().toLowerCase();\n          $(this).toggle(cardText.includes(searchTerm));\n        });\n      }, 300),\n    );\n\n    // \n    const showFavCardMenu = (e: JQuery.ClickEvent, cardId: string) => {\n      $('.acu-cell-menu, .acu-menu-backdrop').remove();\n\n      const backdrop = $('<div class=\"acu-menu-backdrop\"></div>');\n      $('body').append(backdrop);\n\n      const config = getConfig();\n      const menu = $(`\n        <div class=\"acu-cell-menu acu-theme-${config.theme}\" data-fav-id=\"${escapeHtml(cardId)}\">\n          <div class=\"acu-cell-menu-item\" data-action=\"edit\"><i class=\"fa-solid fa-pen\"></i> </div>\n          <div class=\"acu-cell-menu-item\" data-action=\"copy\"><i class=\"fa-solid fa-copy\"></i> </div>\n          <div class=\"acu-cell-menu-item\" data-action=\"send\" style=\"color:#3498db\"><i class=\"fa-solid fa-paper-plane\"></i> </div>\n          <div class=\"acu-cell-menu-item\" data-action=\"delete\" style=\"color:#e74c3c\"><i class=\"fa-solid fa-trash\"></i> </div>\n          <div class=\"acu-cell-menu-item\" data-action=\"close\"><i class=\"fa-solid fa-times\"></i> </div>\n        </div>\n      `);\n      $('body').append(menu);\n\n      // \n      const winWidth = $(window).width() || 800;\n      const winHeight = $(window).height() || 600;\n      const mWidth = menu.outerWidth() || 150;\n      const mHeight = menu.outerHeight() || 150;\n      let posX = e.clientX || winWidth / 2;\n      let posY = e.clientY || winHeight / 2;\n      if (posX + mWidth > winWidth) posX = winWidth - mWidth - 10;\n      if (posY + mHeight > winHeight) posY = winHeight - mHeight - 10;\n      menu.css({ left: posX, top: posY });\n\n      // backdrop\n      backdrop.on('click', () => {\n        $('.acu-cell-menu, .acu-menu-backdrop').remove();\n      });\n\n      // \n      menu.on('click', '.acu-cell-menu-item', async function () {\n        const action = $(this).data('action');\n        const id = menu.data('fav-id');\n        $('.acu-cell-menu, .acu-menu-backdrop').remove();\n\n        if (action === 'close') return;\n\n        const fav = await FavoritesManager.getById(id);\n        if (!fav) return;\n\n        if (action === 'edit') {\n          showFavoriteEditModal(fav, async updated => {\n            await FavoritesManager.updateFavorite(id, updated);\n            $panel.html(await renderFavoritesPanel());\n            bindFavoritesEvents($panel);\n          });\n        } else if (action === 'copy') {\n          const copied = await FavoritesManager.duplicateFavorite(id);\n          if (copied) {\n            $panel.html(await renderFavoritesPanel());\n            bindFavoritesEvents($panel);\n          }\n        } else if (action === 'send') {\n          const compatible = FavoritesManager.findCompatibleTables(fav, currentTables);\n          if (compatible.length === 0) {\n            toastr.warning('');\n            return;\n          }\n          showSendToTableModal(fav, compatible, currentTables, async () => {\n            $panel.html(await renderFavoritesPanel());\n            bindFavoritesEvents($panel);\n          });\n        } else if (action === 'delete') {\n          await FavoritesManager.deleteFavorite(id);\n          $panel.html(await renderFavoritesPanel());\n          bindFavoritesEvents($panel);\n        }\n      });\n    };\n\n    // \n    $panel.on('click.favEvents', '.acu-fav-card', function (e) {\n      e.stopPropagation();\n      const $card = $(this);\n      const cardId = $card.data('id');\n\n      // Toggle\n      const existingMenu = $('.acu-cell-menu');\n      if (existingMenu.length && existingMenu.data('fav-id') === cardId) {\n        $('.acu-cell-menu, .acu-menu-backdrop').remove();\n        return;\n      }\n\n      showFavCardMenu(e, cardId);\n    });\n\n    // \n    $panel.on('click.favEvents', '#acu-fav-import', async function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (file) {\n          const text = await file.text();\n          const result = await FavoritesManager.importFavorites(text);\n          // [] importFavorites  { added, updated } \n          if (result && (result.added > 0 || result.updated > 0)) {\n            if (window.toastr) window.toastr.success(`: ${result.added}, ${result.updated}`);\n            $panel.html(await renderFavoritesPanel());\n            bindFavoritesEvents($panel);\n          } else {\n            if (window.toastr) window.toastr.warning('');\n          }\n        }\n      };\n      input.click();\n    });\n\n    // \n    $panel.on('click.favEvents', '#acu-fav-export', async function () {\n      const json = await FavoritesManager.exportFavorites();\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `favorites_${new Date().toISOString().slice(0, 10)}.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n      if (window.toastr) window.toastr.success('');\n    });\n\n    console.log('[DICE] bindFavoritesEvents initialized');\n  };\n\n  const renderTableContent = (tableData, tableName) => {\n    if (!tableData || !tableData.rows.length)\n      return `\n            <div class=\"acu-panel-header\"><div class=\"acu-panel-title\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${tableName}</div><button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button></div>\n            <div class=\"acu-panel-content\"><div style=\"text-align:center;color:var(--acu-text-sub);padding:20px;\"></div></div>`;\n\n    const config = getConfig();\n    const headers = (tableData.headers || []).slice(1);\n\n    //  ( list)\n    const currentStyle = (getTableStyles() || {})[tableName] || 'list';\n    const isGridMode = currentStyle === 'grid';\n\n    let titleColIndex = 1;\n    if (tableData.headers.length === 1) {\n      titleColIndex = 0;\n    } else if (tableName.includes('') || tableName.includes('')) {\n      const idx = tableData.headers.findIndex(\n        h => h && (h.includes('') || h.includes('') || h.includes('')),\n      );\n      if (idx > 0) titleColIndex = idx;\n    }\n\n    // ---  ---\n    let processedRows = tableData.rows.map((row, index) => {\n      const rowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n      const isBookmarked = rowKey && BookmarkManager.isBookmarked(tableName, rowKey);\n      return { data: row, originalIndex: index, rowKey, isBookmarked };\n    });\n    const searchTerm = (tableSearchStates[tableName] || '').toLowerCase().trim();\n\n    // \n    const isReversed = isTableReversed(tableName);\n\n    if (searchTerm) {\n      processedRows = processedRows.filter(item =>\n        item.data.some(cell => String(cell).toLowerCase().includes(searchTerm)),\n      );\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        const titleA = String(a.data[titleColIndex] || '').toLowerCase();\n        const titleB = String(b.data[titleColIndex] || '').toLowerCase();\n        const aHitTitle = titleA.includes(searchTerm);\n        const bHitTitle = titleB.includes(searchTerm);\n        if (titleA === searchTerm && titleB !== searchTerm) return -1;\n        if (titleA !== searchTerm && titleB === searchTerm) return 1;\n        if (aHitTitle && !bHitTitle) return -1;\n        if (!aHitTitle && bHitTitle) return 1;\n        return a.originalIndex - b.originalIndex;\n      });\n    } else {\n      // \n      // bookmark\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        if (isReversed) {\n          return b.originalIndex - a.originalIndex;\n        } else {\n          return a.originalIndex - b.originalIndex;\n        }\n      });\n    }\n\n    const itemsPerPage = config.itemsPerPage || 50;\n    const totalItems = processedRows.length;\n    const totalPages = Math.ceil(totalItems / itemsPerPage) || 1;\n    let currentPage = tablePageStates[tableName] || 1;\n    if (currentPage > totalPages) currentPage = totalPages;\n    if (currentPage < 1) currentPage = 1;\n    tablePageStates[tableName] = currentPage;\n\n    const startIdx = (currentPage - 1) * itemsPerPage;\n    const endIdx = startIdx + itemsPerPage;\n    const rowsToRender = processedRows.slice(startIdx, endIdx);\n    // []    \n    // \n    const showReverseBtn = shouldShowReverseButton(tableName);\n    const reverseBtnHtml = showReverseBtn\n      ? `\n            <button class=\"acu-view-btn acu-reverse-btn\" data-table=\"${escapeHtml(tableName)}\" title=\"${isReversed ? '' : ''}\">\n                <i class=\"fa-solid ${isReversed ? 'fa-sort-amount-up' : 'fa-sort-amount-down'}\"></i>\n            </button>\n        `\n      : '';\n\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n    <div class=\"acu-title-main\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> <span class=\"acu-title-text\">${escapeHtml(tableName)}</span></div>\n    <div class=\"acu-title-sub\">(${startIdx + 1}-${Math.min(endIdx, totalItems)} / ${totalItems})${isReversed ? ' <span style=\"color:var(--acu-accent);\"></span>' : ''}</div>\n</div>\n                <div class=\"acu-header-actions\">\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn\" id=\"acu-btn-relation-graph\" data-table=\"${escapeHtml(tableName)}\" title=\"\"><i class=\"fa-solid fa-project-diagram\"></i></button>` : ''}\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn acu-table-map-btn\" title=\"\"><i class=\"fa-solid fa-map\"></i></button>` : ''}\n                    ${reverseBtnHtml}\n                    <button class=\"acu-view-btn\" id=\"acu-btn-switch-style\" data-table=\"${escapeHtml(tableName)}\" title=\"  (: ${isGridMode ? '' : ''})\">\n                        <i class=\"fa-solid ${isGridMode ? 'fa-th-large' : 'fa-list'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${escapeHtml(tableName)}\" title=\"  | \"></i>\n                    </div>\n\n                    <div class=\"acu-search-wrapper\"><i class=\"fa-solid fa-search acu-search-icon\"></i><input type=\"text\" class=\"acu-search-input\" placeholder=\"...\" value=\"${(tableSearchStates[tableName] || '').replace(/\"/g, '&quot;')}\" /></div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>\n            <div class=\"acu-panel-content\"><div class=\"acu-card-grid\">`;\n\n    html += rowsToRender\n      .map(item => {\n        const realRowIdx = item.originalIndex;\n        const row = item.data;\n        const cardTitle = row[titleColIndex] || '';\n        const showDefaultIndex = titleColIndex === 1;\n        const titleCellId = `${tableData.key}-${realRowIdx}-${titleColIndex}`;\n        const isTitleModified = window.acuModifiedSet && window.acuModifiedSet.has(titleCellId);\n        const isRowNew = currentDiffMap.has(`${tableName}-row-${realRowIdx}`);\n        let rowClass = '';\n        if (config.highlightNew) {\n          if (isTitleModified) rowClass = 'acu-highlight-manual';\n          else if (isRowNew) rowClass = 'acu-highlight-diff';\n        }\n\n        // \n        const validColIndices = row.map((_, i) => i).filter(i => i > 0 && i !== titleColIndex);\n        const isOddValidCount = validColIndices.length % 2 === 1;\n\n        const cardBody = row\n          .map((cell, cIdx) => {\n            if (cIdx <= 0 || cIdx === titleColIndex) return '';\n            // [] \"\"\n            const currentHeader = headers[cIdx - 1] || '';\n            if (currentHeader.includes('')) return '';\n            const isLastValidCol = cIdx === validColIndices[validColIndices.length - 1];\n            const spanFullRow = isLastValidCol && isOddValidCount;\n            // /\n            const rawHeaderName = headers[cIdx - 1] || '' + cIdx;\n\n            // [] \n            const lockRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n            const isThisFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, headers[cIdx - 1]);\n            const inlineLockIcon = isThisFieldLocked\n              ? '<i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:10px;opacity:0.7;margin-left:4px;\" title=\"\"></i>'\n              : '';\n\n            const headerName = rawHeaderName.replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n            const safeStr = str =>\n              String(str)\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#039;');\n            const rawStrOriginal = String(cell).trim();\n            const rawStr = replaceUserPlaceholders(rawStrOriginal);\n            const invalidPlaceholders = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n            if (invalidPlaceholders.includes(rawStr.toLowerCase())) {\n              return ''; // \n            }\n\n            let contentHtml = '';\n            let hideLabel = false; // \n            const splitRegex = /[;]/;\n\n            // [] \n            const isIdentityField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return lowerHeader.includes('');\n            };\n\n            const isAttributeField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return (\n                lowerHeader.includes('') || lowerHeader.includes('') || lowerHeader.includes('')\n              );\n            };\n\n            //  ( \":92\"  \":92, :88\")\n            // [] \n            const parsedAttrs = isIdentityField(rawHeaderName) ? [] : parseAttributeString(rawStr);\n            // [] \n            if (isIdentityField(rawHeaderName)) {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            } else if (isRelationshipCell(rawStr, headerName)) {\n              // [] \n              const relations = parseRelationshipString(rawStr);\n              // [] \n              const validRelations = relations.filter(rel => {\n                if (!rel.relation) return true; // \n                return !invalidPlaceholders.includes(rel.relation.toLowerCase());\n              });\n\n              if (validRelations.length > 1) {\n                hideLabel = true;\n                let relHtml = '';\n                for (let i = 0; i < validRelations.length; i++) {\n                  const rel = validRelations[i];\n                  const borderStyle =\n                    i < validRelations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                  relHtml += '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;' + borderStyle + '\">';\n                  relHtml +=\n                    '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' +\n                    safeStr(rel.name) +\n                    inlineLockIcon +\n                    '</span>';\n                  if (rel.relation) {\n                    relHtml +=\n                      '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                      safeStr(rel.relation) +\n                      '</span>';\n                  }\n                  relHtml += '</div>';\n                }\n                contentHtml = '<div class=\"acu-relation-container\">' + relHtml + '</div>';\n              } else if (validRelations.length === 1) {\n                hideLabel = true;\n                const rel = validRelations[0];\n                contentHtml = '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;\">';\n                contentHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' +\n                  safeStr(rel.name) +\n                  inlineLockIcon +\n                  '</span>';\n                if (rel.relation) {\n                  contentHtml +=\n                    '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                    safeStr(rel.relation) +\n                    '</span>';\n                }\n                contentHtml += '</div>';\n              }\n            } else if (parsedAttrs.length > 1) {\n              // 2\n              hideLabel = true;\n              let attrsHtml = '';\n              for (let i = 0; i < parsedAttrs.length; i++) {\n                const attr = parsedAttrs[i];\n                const showDice = !BlacklistManager.isBlacklisted(attr.name);\n                attrsHtml +=\n                  '<div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 0;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.9em;white-space:nowrap;\" title=\"' +\n                  safeStr(attr.name) +\n                  '\">' +\n                  safeStr(attr.name.length > 3 ? attr.name.substring(0, 5) : attr.name) +\n                  inlineLockIcon +\n                  '</span>';\n                attrsHtml += '<div style=\"display:flex;align-items:center;gap:4px;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-main);font-weight:bold;font-size:0.95em;\">' +\n                  attr.value +\n                  '</span>';\n                if (showDice) {\n                  attrsHtml +=\n                    '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                    safeStr(attr.name) +\n                    '\" data-attr-value=\"' +\n                    attr.value +\n                    '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:10px;\" title=\"\"></i>';\n                }\n                attrsHtml += '</div></div>';\n              }\n              contentHtml = '<div class=\"acu-multi-attr-container\">' + attrsHtml + '</div>';\n            } else if (parsedAttrs.length === 1) {\n              //  ( \":92\") - \n              hideLabel = true;\n              const attr = parsedAttrs[0];\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml +=\n                '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' +\n                safeStr(attr.name) +\n                inlineLockIcon +\n                '</span>';\n              contentHtml += '<div style=\"display:flex;align-items:center;gap:6px;\">';\n              contentHtml += '<span style=\"color:var(--acu-text-main);font-weight:bold;\">' + attr.value + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(attr.name) +\n                  '\" data-attr-value=\"' +\n                  attr.value +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div></div>';\n            } else if (rawStr.length > 0 && splitRegex.test(rawStr) && !rawStr.includes('http')) {\n              // [] \n              const invalidTagValues = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n              const parts = rawStr\n                .split(splitRegex)\n                .map(s => s.trim())\n                .filter(s => s && !invalidTagValues.includes(s.toLowerCase()));\n              const allShort = parts.length > 1 && parts.every(p => p.length <= 6);\n              if (allShort) {\n                const tagsHtml = parts\n                  .map(part => {\n                    const subStyle = getBadgeStyle(part) || 'acu-badge-neutral';\n                    return '<span class=\"acu-badge ' + subStyle + '\">' + safeStr(part) + '</span>';\n                  })\n                  .join('');\n                contentHtml = '<div class=\"acu-tag-container\">' + tagsHtml + '</div>';\n              } else if (parts.length > 0) {\n                // \n                contentHtml = safeStr(parts.join('; '));\n              } else {\n                // \n                contentHtml = '';\n              }\n            } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n              // \n              const numVal = extractNumericValue(rawStr);\n              const showDice = !BlacklistManager.isBlacklisted(headerName);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml += '<span>' + safeStr(rawStr) + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(headerName) +\n                  '\" data-attr-value=\"' +\n                  numVal +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div>';\n            } else {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            }\n\n            const isDiffChanged = currentDiffMap.has(tableName + '-' + realRowIdx + '-' + cIdx);\n            const cellId = tableData.key + '-' + realRowIdx + '-' + cIdx;\n            const isUserModified = window.acuModifiedSet && window.acuModifiedSet.has(cellId);\n            let cellHighlight = '';\n            if (config.highlightNew) {\n              if (isUserModified) cellHighlight = 'acu-highlight-manual';\n              else if (isDiffChanged) cellHighlight = 'acu-highlight-diff';\n            }\n\n            //  class\n            //  ()\n\n            const rowClass =\n              'acu-card-row acu-cell' +\n              (spanFullRow ? ' acu-grid-span-full' : '') +\n              (hideLabel ? ' acu-hide-label' : '');\n\n            return (\n              '<div class=\"' +\n              rowClass +\n              '\" data-key=\"' +\n              escapeHtml(tableData.key) +\n              '\" data-tname=\"' +\n              escapeHtml(tableName) +\n              '\" data-row=\"' +\n              realRowIdx +\n              '\" data-col=\"' +\n              cIdx +\n              '\" data-val=\"' +\n              encodeURIComponent(cell ?? '') +\n              '\"><div class=\"acu-card-label\">' +\n              headerName +\n              inlineLockIcon +\n              '</div><div class=\"acu-card-value ' +\n              cellHighlight +\n              '\">' +\n              contentHtml +\n              '</div></div>'\n            );\n          })\n          .join('');\n\n        // []  acu-card-body  view-grid  view-list \n        // []  tableData.headers  slice  headers getInteractOptionsForRow \n        const tableActions = getInteractOptionsForRow(tableName, tableData.headers, row);\n        let actionsHtml = '';\n\n        if (tableActions.length > 0) {\n          const cardTitle = row[titleColIndex] || '';\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardLockRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n        const isCardRowLocked = cardLockRowKey && LockManager.isRowLocked(tableName, cardLockRowKey);\n        const cardLockIcon = isCardRowLocked\n          ? ' <i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:11px;opacity:0.8;\" title=\"\"></i>'\n          : '';\n\n        // bookmark\n        const cardBookmarkRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n        const isBookmarked = cardBookmarkRowKey && BookmarkManager.isBookmarked(tableName, cardBookmarkRowKey);\n        const bookmarkIcon = cardBookmarkRowKey\n          ? `<i class=\"${isBookmarked ? 'fa-solid' : 'fa-regular'} fa-bookmark acu-bookmark-icon ${isBookmarked ? 'bookmarked' : ''}\" data-table=\"${escapeHtml(tableName)}\" data-row-key=\"${escapeHtml(cardBookmarkRowKey)}\" title=\"${isBookmarked ? '' : ''}\"></i>`\n          : '';\n\n        return `<div class=\"acu-data-card\"><div class=\"acu-card-header\"><span class=\"acu-card-index\">${showDefaultIndex ? '#' + (realRowIdx + 1) : ''}</span><span class=\"acu-cell acu-editable-title ${rowClass}\" data-key=\"${escapeHtml(tableData.key)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(cardTitle ?? '')}\" title=\"\">${escapeHtml(cardTitle)}${cardLockIcon}</span>${bookmarkIcon}</div><div class=\"acu-card-body ${isGridMode ? 'view-grid' : 'view-list'}\">${cardBody}</div>${actionsHtml}</div>`;\n      })\n      .join('');\n    html += `</div></div>`;\n\n    if (totalPages > 1) {\n      html += `<div class=\"acu-panel-footer\"><button class=\"acu-page-btn ${currentPage === 1 ? 'disabled' : ''}\" data-page=\"${currentPage - 1}\" ${currentPage === 1 ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-left\"></i></button>`;\n      const range = [];\n      if (totalPages <= 7) {\n        for (let i = 1; i <= totalPages; i++) range.push(i);\n      } else {\n        if (currentPage <= 4) range.push(1, 2, 3, 4, 5, '...', totalPages);\n        else if (currentPage >= totalPages - 3)\n          range.push(1, '...', totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1, totalPages);\n        else range.push(1, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages);\n      }\n      range.forEach(p => {\n        if (p === '...') html += `<span class=\"acu-page-info\">...</span>`;\n        else html += `<button class=\"acu-page-btn ${p === currentPage ? 'active' : ''}\" data-page=\"${p}\">${p}</button>`;\n      });\n      html += `<button class=\"acu-page-btn ${currentPage === totalPages ? 'disabled' : ''}\" data-page=\"${currentPage + 1}\" ${currentPage === totalPages ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-right\"></i></button></div>`;\n    }\n    return html;\n  };\n\n  // []  ( + )\n  const saveCurrentTabState = () => {\n    const { $ } = getCore();\n    const activeTab = getActiveTabState();\n    const $content = $('.acu-panel-content');\n\n    if (activeTab && $content.length) {\n      const innerScrolls = {};\n      // \n      $content.find('.acu-data-card, .acu-card-body, .acu-edit-textarea').each(function () {\n        if (this.scrollTop > 0) {\n          //  (Row Index)\n          const $card = $(this).closest('.acu-data-card');\n          const rIdx = $card.find('.acu-editable-title').data('row');\n          // \n          const isEdit = $(this).hasClass('acu-edit-textarea');\n\n          if (rIdx !== undefined) {\n            const key = isEdit ? `edit-${rIdx}` : rIdx;\n            innerScrolls[key] = this.scrollTop;\n          }\n        }\n      });\n\n      // \n      tableScrollStates[activeTab] = {\n        left: $content.scrollLeft(),\n        top: $content.scrollTop(),\n        inner: innerScrolls,\n        timestamp: Date.now(), // \n      };\n    }\n  };\n\n  const closePanel = () => {\n    const { $ } = getCore();\n    saveCurrentTabState(); // <--- \n\n    $('#acu-data-area').removeClass('visible');\n    $('.acu-nav-btn').removeClass('active');\n    saveActiveTabState(null);\n    // [] \n    // $('.acu-embedded-options-container').remove();\n  };\n\n  /**\n   *  - \n   * CSS opacity + visibility \n   * @param {Function} updateContentFn -  $panel \n   */\n  const switchPanel = updateContentFn => {\n    const { $ } = getCore();\n    const $panel = $('#acu-data-area');\n    const isVisible = $panel.hasClass('visible');\n\n    if (!isVisible) {\n      // \n      updateContentFn($panel);\n      $panel.addClass('visible');\n    } else {\n      // CSS transition \n      updateContentFn($panel);\n    }\n  };\n\n  const bindEvents = tables => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    // [] -\n    $wrapper.on('click', '.acu-dash-relation-graph-btn', function (e) {\n      e.stopPropagation();\n      const allTables = processJsonData(cachedRawData || getTableData());\n      const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n      if (npcResult && npcResult.data) {\n        showRelationshipGraph(npcResult.data);\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-map-btn', function (e) {\n      e.stopPropagation();\n      showMapVisualization();\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-avatar-manager-btn', function (e) {\n      e.stopPropagation();\n\n      try {\n        // \n        let allTables;\n        try {\n          const rawData = cachedRawData || getTableData();\n          allTables = processJsonData(rawData);\n        } catch (dataError) {\n          console.error(':', dataError);\n          throw new Error('');\n        }\n\n        if (!allTables || allTables.length === 0) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n        const playerResult = DashboardDataParser.findTable(allTables, 'player');\n\n        const nodeArr = [];\n\n        // \n        if (playerResult?.data?.rows?.[0]) {\n          const playerName = playerResult.data.rows[0][1];\n          if (playerName && typeof playerName === 'string' && playerName.trim()) {\n            nodeArr.push({ name: playerName.trim(), isPlayer: true });\n          }\n        }\n\n        // NPC\n        if (npcResult?.data?.rows && Array.isArray(npcResult.data.rows)) {\n          npcResult.data.rows.forEach((row, idx) => {\n            if (Array.isArray(row) && row[1]) {\n              const npcName = row[1];\n              if (typeof npcName === 'string' && npcName.trim()) {\n                nodeArr.push({ name: npcName.trim(), isPlayer: false, rowIndex: idx });\n              }\n            }\n          });\n        }\n\n        // \n        if (nodeArr.length === 0) {\n          if (window.toastr) {\n            window.toastr.warning('NPC');\n          }\n          return;\n        }\n\n        // \n        try {\n          showAvatarManager(nodeArr, () => renderInterface());\n        } catch (managerError) {\n          console.error('showAvatarManager :', managerError);\n          throw new Error('');\n        }\n      } catch (error) {\n        // \n        console.error(':', error);\n\n        // \n        const errorMsg = error instanceof Error ? error.message : '';\n        if (window.toastr) {\n          window.toastr.error(`: ${errorMsg}`);\n        }\n      }\n    });\n    // \n    $wrapper.on('click', '.acu-dash-table-link', function (e) {\n      e.stopPropagation();\n      const tableName = $(this).data('table');\n      if (tableName) {\n        Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        saveActiveTabState(tableName);\n        renderInterface();\n      }\n    });\n\n    // []  SillyTavern\"\"\n    $('.acu-panel-content')\n      .off('touchstart.acu_swipe touchmove.acu_swipe')\n      .on('touchstart.acu_swipe', function (e) {\n        this._touchStartX = e.originalEvent.touches[0].clientX;\n        this._touchStartY = e.originalEvent.touches[0].clientY;\n      })\n      .on('touchmove.acu_swipe', function (e) {\n        if (!this._touchStartX) return;\n        const deltaX = Math.abs(e.originalEvent.touches[0].clientX - this._touchStartX);\n        const deltaY = Math.abs(e.originalEvent.touches[0].clientY - this._touchStartY);\n        // 45\n        if (deltaX > deltaY && deltaX > 10) {\n          e.stopPropagation();\n        }\n      });\n\n    $('body')\n      .off('click.acu_nav_toggle')\n      .on('click.acu_nav_toggle', '.acu-nav-toggle-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        const currentState = getCollapsedState();\n        saveCollapsedState(!currentState);\n        renderInterface();\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_opt_toggle')\n      .on('click.acu_opt_toggle', '.acu-opt-header[data-action=\"toggle-options\"]', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const currentState = getOptionsCollapsedState();\n        saveOptionsCollapsedState(!currentState);\n        renderInterface();\n      });\n\n    const $panel = $('.acu-panel-content');\n    if ($panel.length) {\n      // [] \n      let scrollTimer = null;\n      $panel.off('scroll.acu_save').on('scroll.acu_save', function () {\n        const $this = $(this);\n        if (scrollTimer) clearTimeout(scrollTimer);\n        scrollTimer = setTimeout(() => {\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            if (!tableScrollStates[activeTab]) tableScrollStates[activeTab] = { top: 0, left: 0, inner: {} };\n            tableScrollStates[activeTab].top = $this.scrollTop();\n            tableScrollStates[activeTab].left = $this.scrollLeft();\n            // \n          }\n        }, 200);\n      });\n    }\n\n    $('body')\n      .off('click.acu_delegate')\n      .on('click.acu_delegate', '.acu-wrapper', function (e) {\n        if (isEditingOrder) return;\n        const $target = $(e.target);\n\n        // []  - \n        const $settingsBtn = $target.closest('#acu-btn-settings');\n        if ($settingsBtn.length) {\n          e.stopPropagation();\n          e.preventDefault();\n          showSettingsModal();\n          return;\n        }\n\n        const $navBtn = $target.closest('.acu-nav-btn');\n        if ($navBtn.length) {\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-dashboard') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isDashboardActive && isPanelVisible) {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, true);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                const rawData = cachedRawData || getTableData();\n                const tables = processJsonData(rawData || {});\n                $panel.html(renderDashboard(tables));\n                bindEvents(tables);\n              });\n            }\n            return false;\n          }\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-changes') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isChangesActive = Store.get('acu_changes_panel_active', false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isChangesActive && isPanelVisible) {\n              // \n              Store.set('acu_changes_panel_active', false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set('acu_changes_panel_active', true);\n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                const rawData = cachedRawData || getTableData();\n                $panel.html(renderChangesPanel(rawData));\n                bindChangesEvents();\n              });\n            }\n            return false;\n          }\n          // []  - \n          if ($navBtn.attr('id') === 'acu-btn-favorites') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isFavoritesActive = Store.get('acu_favorites_panel_active', false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isFavoritesActive && isPanelVisible) {\n              // \n              Store.set('acu_favorites_panel_active', false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set('acu_favorites_panel_active', true);\n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              Store.set('acu_changes_panel_active', false);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel(async $panel => {\n                $panel.html(await renderFavoritesPanel());\n                bindFavoritesEvents($panel);\n              });\n            }\n            return false;\n          }\n          // [] MVU\n          if ($navBtn.attr('id') === 'acu-btn-mvu') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isMvuActive && isPanelVisible) {\n              // \n              saveActiveTabState(null);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              Store.set('acu_changes_panel_active', false);\n              saveActiveTabState(MvuModule.MODULE_ID);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                try {\n                  const panelHtml = MvuModule.renderPanel();\n                  // \n                  const mvuSavedHeight = getTableHeights()[MvuModule.MODULE_ID];\n                  if (mvuSavedHeight) {\n                    $panel.css('height', mvuSavedHeight + 'px').addClass('acu-manual-mode');\n                  } else {\n                    $panel.css('height', '').removeClass('acu-manual-mode');\n                  }\n                  $panel.html('<div class=\"acu-mvu-panel\">' + panelHtml + '</div>');\n                  MvuModule.bindEvents($panel);\n                } catch (error) {\n                  console.error('[MVU] Error rendering panel:', error);\n                }\n\n                // \n                MvuModule.getDataWithRetry(5, 800)\n                  .then(mvuData => {\n                    // \n                    if (mvuData) {\n                      $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                      MvuModule.bindEvents($panel);\n                    }\n                  })\n                  .catch(err => {\n                    console.error('[DICE]MvuModule Error getting data:', err);\n                    // \n                    $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                    MvuModule.bindEvents($panel);\n                  });\n              });\n            }\n            return false;\n          }\n          e.stopPropagation();\n          // [] \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          Store.set('acu_changes_panel_active', false);\n          Store.set('acu_favorites_panel_active', false);\n          const tableName = $navBtn.data('table');\n          const currentActiveTab = getActiveTabState();\n          if (currentActiveTab === tableName && $('#acu-data-area').hasClass('visible')) {\n            closePanel();\n            return;\n          }\n          $('.acu-nav-btn').removeClass('active');\n          $navBtn.addClass('active');\n          if ($('.acu-panel-content').length && currentActiveTab) {\n            saveCurrentTabState();\n          }\n          saveActiveTabState(tableName);\n          setTimeout(() => renderInterface(), 0);\n          return;\n        }\n        const $cell = $target.closest('.acu-cell');\n        if ($cell.length) {\n          e.stopPropagation();\n          showCellMenu(e, $cell[0]);\n          return;\n        }\n        const $pageBtn = $target.closest('.acu-page-btn');\n        if ($pageBtn.length) {\n          e.stopPropagation();\n          if ($pageBtn.hasClass('disabled') || $pageBtn.hasClass('active')) return;\n          const newPage = parseInt($pageBtn.data('page'));\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tablePageStates[activeTab] = newPage;\n            renderInterface();\n            requestAnimationFrame(() => {\n              $('.acu-panel-content').scrollTop(0);\n            });\n          }\n          return;\n        }\n        return;\n      });\n\n    $('#acu-btn-expand')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(false);\n        renderInterface();\n      });\n    // [] \n    $('#acu-btn-collapse')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(true);\n        renderInterface();\n      });\n\n    // []  =  (Instant Revert)\n    $('#acu-btn-refresh')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n\n        // [] \n        if (isEditingOrder) return;\n\n        // 1. \n        if (isSaving) {\n          if (window.toastr) window.toastr.warning(' ...');\n          return;\n        }\n\n        const $btn = $(e.currentTarget);\n        const $icon = $btn.find('i');\n        // $icon.addClass('fa-spin'); // \n\n        // 2.  ()\n        // (1)  -> \n        cachedRawData = null;\n\n        // (2) \n        hasUnsavedChanges = false;\n        currentDiffMap.clear();\n        if (window.acuModifiedSet) window.acuModifiedSet.clear();\n\n        // (4)  ()\n        const $saveBtn = $('#acu-btn-save-global');\n        $saveBtn.find('i').removeClass('acu-icon-breathe');\n        $saveBtn.attr('title', '').css('color', '');\n\n        // 3.  300ms \n        // await new Promise(r => setTimeout(r, 300)); // <--- \n\n        // Last SnapshotAPI\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          cachedRawData = snapshot; // \n        }\n\n        // 4. \n        // \n        $('.acu-edit-overlay, .acu-cell-menu, .acu-menu-backdrop').remove();\n\n        // \n        renderInterface();\n\n        // $icon.removeClass('fa-spin');\n      });\n\n    // [] \n    $('#acu-btn-force-update')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          if (window.toastr) {\n            window.toastr.warning('  manualUpdate ', '', {\n              timeOut: 5000,\n            });\n          }\n        }\n      });\n    $('body')\n      .off('click.acu_settings')\n      .on('click.acu_settings', '#acu-btn-settings', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        showSettingsModal();\n      });\n    // [] \n    $('#acu-btn-dice-nav')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        showDicePanel({\n          targetValue: null,\n          targetName: '',\n          //  diceType\n        });\n      });\n\n    // -\n    $('#acu-btn-open-editor')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.openSettings === 'function') {\n          api.openSettings(); // /\n        } else if (window.toastr) {\n          window.toastr.warning('()');\n        }\n      });\n\n    // \n    $('#acu-btn-refill')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            console.log('[DICE]ACU ');\n            //  manualUpdate \n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          console.warn('[DICE]ACU manualUpdate API ');\n          if (window.toastr) {\n            window.toastr.warning(' manualUpdate ', '', { timeOut: 3000 });\n          }\n        }\n      });\n    $('#acu-btn-save-global')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        let dataToSave = null;\n        if (hasUnsavedChanges && cachedRawData) {\n          dataToSave = cachedRawData;\n        } else {\n          dataToSave = getTableData();\n        }\n\n        if (dataToSave) {\n          // 1.  false  true\n          await saveDataToDatabase(dataToSave, true, true);\n\n          // 2. \n          // \n          $('.acu-highlight-manual').removeClass('acu-highlight-manual');\n\n          // 3. \n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          hasUnsavedChanges = false;\n\n          // 4. \n          const $btn = $(this);\n          const $icon = $btn.find('i');\n          $icon.removeClass('acu-icon-breathe fa-spinner fa-spin').addClass('fa-save');\n          $btn.attr('title', '').css('color', '');\n          $btn.prop('disabled', false);\n\n          // 5. \n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    const $searchInput = $('.acu-search-input');\n    if ($searchInput.length) {\n      let searchTimeout;\n      let isComposing = false;\n      $searchInput\n        .off('compositionstart compositionend input')\n        .on('compositionstart', () => {\n          isComposing = true;\n        })\n        .on('compositionend', function () {\n          isComposing = false;\n          const val = $(this).val();\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tableSearchStates[activeTab] = val;\n            tablePageStates[activeTab] = 1;\n            renderInterface();\n            setTimeout(() => {\n              $('.acu-search-input').focus();\n            }, 0);\n          }\n        })\n        .on('input', function () {\n          if (isComposing) return;\n          const val = $(this).val();\n          const selectionStart = this.selectionStart;\n          const selectionEnd = this.selectionEnd;\n          clearTimeout(searchTimeout);\n          searchTimeout = setTimeout(() => {\n            const activeTab = getActiveTabState();\n            if (activeTab) {\n              tableSearchStates[activeTab] = val;\n              tablePageStates[activeTab] = 1;\n              const isFocus = document.activeElement && document.activeElement.classList.contains('acu-search-input');\n              renderInterface();\n              if (isFocus) {\n                const $newInput = $('.acu-search-input');\n                $newInput.focus();\n                if ($newInput.length && $newInput[0].setSelectionRange) {\n                  try {\n                    $newInput[0].setSelectionRange(selectionStart, selectionEnd);\n                  } catch (e) {}\n                }\n              }\n            }\n          }, 300);\n        });\n    }\n    // \n    $('#acu-btn-relation-graph')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const rawData = cachedRawData || getTableData();\n        if (rawData) {\n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (sheet?.name === tableName) {\n              const tableData = {\n                headers: sheet.content?.[0] || [],\n                rows: sheet.content?.slice(1) || [],\n                key: key,\n              };\n              showRelationshipGraph(tableData);\n              return;\n            }\n          }\n        }\n        if (window.toastr) window.toastr.warning('');\n      });\n    // \n    $('.acu-table-map-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        showMapVisualization();\n      });\n    // --- []  ---\n\n    // 1. \n    $('#acu-btn-switch-style')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const styles = getTableStyles();\n        const current = styles[tableName] || 'list';\n        styles[tableName] = current === 'grid' ? 'list' : 'grid'; // \n        saveTableStyles(styles);\n        renderInterface(); // \n      });\n\n    // 2. \n    $('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          if (tableName) {\n            const heights = getTableHeights();\n            heights[tableName] = parseInt($panel.css('height'));\n            saveTableHeights(heights);\n            $panel.addClass('acu-manual-mode');\n          }\n        };\n      });\n\n    // 3.  - \n    $('.acu-height-drag-handle')\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    // [] \n    $wrapper.on('click', '.acu-reverse-btn', function (e) {\n      e.stopPropagation();\n      const tName = $(this).data('table');\n      if (!tName) return;\n\n      toggleTableReverse(tName);\n\n      // \n      renderInterface();\n    });\n    // [] \n    $('.acu-panel-header')\n      .off('dblclick.acu')\n      .on('dblclick.acu', function (e) {\n        if ($(e.target).closest('.acu-search-input, .acu-close-btn, .acu-view-btn').length) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = getActiveTabState();\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    $wrapper\n      .find('.acu-close-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $input = $('.acu-search-input');\n\n        // \n        if ($input.length && $input.val()) {\n          $input.val('').trigger('input').focus();\n          return;\n        }\n\n        // \n        const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        if (isDashboardActive) {\n          // \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n        if (isMvuActive) {\n          // \n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        closePanel();\n      });\n    // [] bookmark\n    $('body')\n      .off('click.acu_bookmark')\n      .on('click.acu_bookmark', '.acu-bookmark-icon', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $icon = $(this);\n        const tableName = $icon.data('table');\n        const rowKey = $icon.data('row-key');\n\n        if (!tableName || !rowKey) return;\n\n        // bookmark\n        BookmarkManager.toggleBookmark(tableName, rowKey);\n\n        // \n        if (typeof renderInterface === 'function') {\n          renderInterface();\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_action')\n      .on('click.acu_action', '.acu-action-item', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $btn = $(this);\n        const rowIdx = parseInt($btn.data('row'), 10);\n        const actionIdx = parseInt($btn.data('action-idx'), 10);\n\n        // \n        const $card = $btn.closest('.acu-data-card');\n        const $title = $card.find('.acu-editable-title');\n        const tableKey = $title.data('key');\n        const tableName = $title.data('tname') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const headers = rawData[tableKey].content[0] || [];\n        const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n\n        // []  + AI\n        const actions = getInteractOptionsForRow(tableName, headers, rowData);\n\n        const action = actions[actionIdx];\n\n        // [] \n        if (action && action.type === 'skill_check') {\n          const skillName = rowData[1] || '';\n\n          // \n          let checkValue = null;\n          const attrValIdx = headers.findIndex(h => h && h.includes(''));\n          const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n          // \n          if (attrValIdx > 0 && rowData[attrValIdx]) {\n            const val = extractNumericValue(rowData[attrValIdx]);\n            if (val > 0) checkValue = val;\n          }\n          // \n          if (checkValue === null && profIdx > 0 && rowData[profIdx]) {\n            const val = extractNumericValue(rowData[profIdx]);\n            if (val > 0) checkValue = val;\n          }\n\n          // \n          const promptText = processTemplate(action.template, rowData, headers);\n          smartInsertToTextarea(promptText, 'action');\n\n          // \n          if (checkValue !== null && checkValue > 0) {\n            showDicePanel({\n              targetValue: checkValue,\n              targetName: skillName,\n              initiatorName: '<user>',\n            });\n          } else {\n            $('#send_textarea').focus();\n          }\n          return;\n        }\n\n        if (action && action.template) {\n          // \n          const rawData = cachedRawData || getTableData();\n          if (rawData && rawData[tableKey]) {\n            const headers = rawData[tableKey].content[0] || [];\n            const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n            const npcName = rowData[1] || '';\n\n            // \"\"\n            if (action.label === '') {\n              const config = getConfig();\n              $('.acu-msg-overlay').remove();\n\n              const t = getThemeColors();\n\n              const overlay = $(`\n                        <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:31200;display:flex;justify-content:center;align-items:center;\">\n                            <div style=\"background:${t.bgPanel};border:1px solid ${t.border};border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                                <div style=\"font-size:14px;font-weight:bold;color:${t.accent};margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                                    <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                                </div>\n                                <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:6px;color:${t.textMain} !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                                <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                                    <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:6px;color:${t.textMain};cursor:pointer;\"></button>\n                                    <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:${t.btnActiveBg};border:none;border-radius:6px;color:${t.btnActiveText};cursor:pointer;font-weight:bold;\"></button>\n                                </div>\n                            </div>\n                        </div>\n                    `);\n\n              $('body').append(overlay);\n              // []  JS  overlay \n              const overlayEl = overlay[0];\n              overlayEl.style.setProperty('position', 'fixed', 'important');\n              overlayEl.style.setProperty('top', '0', 'important');\n              overlayEl.style.setProperty('left', '0', 'important');\n              overlayEl.style.setProperty('right', '0', 'important');\n              overlayEl.style.setProperty('bottom', '0', 'important');\n              overlayEl.style.setProperty('width', '100vw', 'important');\n              overlayEl.style.setProperty('height', '100vh', 'important');\n              overlayEl.style.setProperty('display', 'flex', 'important');\n              overlayEl.style.setProperty('justify-content', 'center', 'important');\n              overlayEl.style.setProperty('align-items', 'center', 'important');\n              overlayEl.style.setProperty('z-index', '31100', 'important');\n              setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n              const sendMessage = () => {\n                const msg = overlay.find('#acu-msg-input').val().trim();\n                if (msg) {\n                  const promptText = `<user>${npcName}\"${msg}\"`;\n                  smartInsertToTextarea(promptText, 'action');\n                  $('#send_textarea').focus();\n                }\n                overlay.remove();\n              };\n\n              overlay.find('#acu-msg-send').click(sendMessage);\n              overlay.find('#acu-msg-input').on('keydown', function (ev) {\n                if (ev.key === 'Enter') {\n                  ev.preventDefault();\n                  sendMessage();\n                }\n              });\n              overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n              setupOverlayClose(overlay, 'acu-msg-overlay', () => overlay.remove());\n              return;\n            }\n\n            //  processTemplate \n            const promptText = processTemplate(action.template, rowData, headers);\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_global_dice')\n      .on('click.acu_global_dice', '#acu-btn-dice', function (e) {\n        e.stopPropagation();\n        showDicePanel({\n          targetValue: 50,\n          targetName: '',\n          diceType: '1d100',\n        });\n      });\n    // ========== [] ==========\n    // /\n    $('body')\n      .off('click.acu_location_toggle')\n      .on('click.acu_location_toggle', '.acu-location-header', function (e) {\n        e.stopPropagation();\n        const $group = $(this).closest('.acu-location-group');\n        $group.toggleClass('expanded');\n      });\n\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_jump')\n      .on('click.acu_dash_jump', '.acu-dash-jump-link, .acu-dash-loc-item', function (e) {\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const searchTerm = $(this).data('search') || '';\n\n        if (tableName) {\n          // 1. \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n\n          // 2. \n          saveActiveTabState(tableName);\n\n          // 3. \n          if (searchTerm) {\n            tableSearchStates[tableName] = searchTerm;\n            tablePageStates[tableName] = 1;\n          }\n\n          // 4. \n          renderInterface();\n\n          // 5. \n          if (searchTerm) {\n            setTimeout(() => {\n              const $input = $('.acu-search-input');\n              if ($input.length) $input.focus();\n            }, 100);\n          }\n        }\n      });\n    // ========== [] ==========\n    // [] \n    $('body')\n      .off('click.acu_inline_dice')\n      .on('click.acu_inline_dice', '.acu-inline-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        //  .attr()  jQuery \n        const attrName = $(this).attr('data-attr-name') || '';\n        const attrValue = parseInt($(this).attr('data-attr-value'), 10) || 50;\n\n        // NPC\n        const $card = $(this).closest('.acu-data-card');\n        const cardTitle = $card.find('.acu-editable-title').text().trim();\n\n        // <user>\n        const tableName = $card.find('.acu-editable-title').data('tname') || '';\n        const isPlayerTable = tableName.includes('');\n        const initiatorName = isPlayerTable ? '<user>' : cardTitle;\n\n        showDicePanel({\n          attrValue: attrValue,\n          targetValue: null, // showDicePanel\n          targetName: attrName,\n          initiatorName: initiatorName,\n          //  diceType\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_dice')\n      .on('click.acu_dash_dice', '.acu-dash-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const targetValue = parseInt($(this).data('target'), 10) || 50;\n        const targetName = $(this).data('name') || '';\n        const npcName = $(this).data('npc') || '';\n\n        // NPC\n        if (npcName) {\n          // \n          const playerAttrValue = getAttributeValue('<user>', targetName) || 50;\n          showContestPanel({\n            initiatorName: '<user>',\n            initiatorValue: playerAttrValue,\n            opponentName: npcName,\n            opponentValue: targetValue,\n          });\n        } else {\n          showDicePanel({\n            targetValue: targetValue,\n            targetName: targetName,\n            initiatorName: '<user>',\n          });\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_goto')\n      .on('click.acu_dash_goto', '.acu-dash-goto-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const locationName = $(this).data('location') || '';\n        const promptText = `<user>${locationName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_use_item')\n      .on('click.acu_dash_use_item', '.acu-dash-use-item-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const itemName = $(this).data('item') || '';\n        const promptText = `<user>${itemName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\" - \n    $('body')\n      .off('click.acu_dash_use_skill')\n      .on('click.acu_dash_use_skill', '.acu-dash-use-skill-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const skillName = $(this).data('skill') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        let checkValue = null;\n\n        if (rawData) {\n          // \n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n            if (sheet.name.includes('') || sheet.name.includes('')) {\n              const headers = sheet.content[0] || [];\n              // \n              const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n              const attrValIdx = headers.findIndex(h => h && h.includes(''));\n              const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n              for (let i = 1; i < sheet.content.length; i++) {\n                const row = sheet.content[i];\n                if (row && row[nameIdx === -1 ? 1 : nameIdx] === skillName) {\n                  // \n                  if (attrValIdx > 0 && row[attrValIdx]) {\n                    const val = extractNumericValue(row[attrValIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  // \n                  if (profIdx > 0 && row[profIdx]) {\n                    const val = extractNumericValue(row[profIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n              if (checkValue !== null) break;\n            }\n          }\n        }\n\n        // \n        const promptText = `<user>${skillName}`;\n        smartInsertToTextarea(promptText, 'action');\n\n        // \n        if (checkValue !== null && checkValue > 0) {\n          showDicePanel({\n            targetValue: checkValue,\n            targetName: skillName,\n            initiatorName: '<user>',\n          });\n        } else {\n          // \n          $('#send_textarea').focus();\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_track_task')\n      .on('click.acu_dash_track_task', '.acu-dash-track-task-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const taskName = $(this).data('task') || '';\n        const promptText = `<user>${taskName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_msg')\n      .on('click.acu_dash_msg', '.acu-dash-msg-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n        const config = getConfig();\n\n        // \n        $('.acu-msg-overlay').remove();\n\n        // \n        const t = getThemeColors();\n\n        const overlay = $(`\n            <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:31200;display:flex;justify-content:center;align-items:center;\">\n                <div class=\"acu-msg-dialog\" style=\"background:${t.bgPanel};border:1px solid ${t.border};border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                    <div style=\"font-size:14px;font-weight:bold;color:${t.accent};margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                        <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                    </div>\n                    <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:6px;color:${t.textMain} !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                    <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                        <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:6px;color:${t.textMain};cursor:pointer;\"></button>\n                        <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:${t.btnActiveBg};border:none;border-radius:6px;color:${t.btnActiveText};cursor:pointer;font-weight:bold;\"></button>\n                    </div>\n                </div>\n            </div>\n        `);\n\n        $('body').append(overlay);\n        const overlayEl = overlay[0];\n        overlayEl.style.setProperty('position', 'fixed', 'important');\n        overlayEl.style.setProperty('top', '0', 'important');\n        overlayEl.style.setProperty('left', '0', 'important');\n        overlayEl.style.setProperty('right', '0', 'important');\n        overlayEl.style.setProperty('bottom', '0', 'important');\n        overlayEl.style.setProperty('width', '100vw', 'important');\n        overlayEl.style.setProperty('height', '100vh', 'important');\n        overlayEl.style.setProperty('display', 'flex', 'important');\n        overlayEl.style.setProperty('justify-content', 'center', 'important');\n        overlayEl.style.setProperty('align-items', 'center', 'important');\n        overlayEl.style.setProperty('z-index', '31100', 'important');\n        setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n        const sendMessage = () => {\n          const msg = overlay.find('#acu-msg-input').val().trim();\n          if (msg) {\n            const promptText = `<user>${npcName}\"${msg}\"`;\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n          overlay.remove();\n        };\n\n        // \n        overlay.find('#acu-msg-send').click(sendMessage);\n\n        // \n        overlay.find('#acu-msg-input').on('keydown', function (ev) {\n          if (ev.key === 'Enter') {\n            ev.preventDefault();\n            sendMessage();\n          }\n        });\n\n        // \n        overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n        setupOverlayClose(overlay, 'acu-msg-overlay', () => overlay.remove());\n      });\n    // [] NPC\n    $('body')\n      .off('click.acu_dash_contest')\n      .on('click.acu_dash_contest', '.acu-dash-contest-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n\n        const rawData = cachedRawData || getTableData();\n\n        var playerAttrValue = 50;\n        var npcAttrValue = 50;\n        var foundPlayer = false;\n        var foundNPC = false;\n\n        if (rawData) {\n          for (var key in rawData) {\n            var sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n\n            // \n            if (sheet.name === '') {\n              if (sheet.content[1]) {\n                var attrStr = sheet.content[1][7] || '';\n                var parts = attrStr.split(/[,;\\s]+/);\n                for (var i = 0; i < parts.length; i++) {\n                  var match = parts[i].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                  if (match) {\n                    playerAttrValue = parseInt(match[2], 10);\n                    foundPlayer = true;\n                    break;\n                  }\n                }\n              }\n            }\n\n            // \n            if (sheet.name === '' && npcName) {\n              for (var j = 1; j < sheet.content.length; j++) {\n                var row = sheet.content[j];\n                if (row && row[1] === npcName) {\n                  var npcAttrStr = row[9] || '';\n                  var npcParts = npcAttrStr.split(/[,;\\s]+/);\n                  for (var k = 0; k < npcParts.length; k++) {\n                    var npcMatch = npcParts[k].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                    if (npcMatch) {\n                      npcAttrValue = parseInt(npcMatch[2], 10);\n                      foundNPC = true;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n            }\n          }\n        }\n\n        showContestPanel({\n          initiatorName: '<user>',\n          initiatorValue: playerAttrValue,\n          opponentName: npcName,\n          opponentValue: npcAttrValue,\n          diceType: '1d100',\n        });\n      });\n\n    // [] \n    //  $('body')  $(document) iframe \n    $('body')\n      .off('click.acu_preview_cell_menu')\n      .on('click.acu_preview_cell_menu', '.acu-preview-overlay .acu-cell', function (e) {\n        console.log('[DICE] preview cell click triggered', this, $(this).data());\n        // \n        if ($(e.target).closest('.acu-preview-close').length) return;\n\n        const $this = $(this);\n        const existingMenu = $('.acu-cell-menu');\n\n        // [] Toggle \n        if (existingMenu.length) {\n          const menuCellId = existingMenu.data('cell-id');\n          const thisCellId = `${$this.data('key')}-${$this.data('row')}-${$this.data('col')}`;\n          if (menuCellId === thisCellId) {\n            $('.acu-cell-menu, .acu-menu-backdrop').remove();\n            return;\n          }\n        }\n\n        e.stopPropagation();\n        e.preventDefault();\n        showCellMenu(e, this);\n\n        // ID toggle \n        const cellId = `${$this.data('key')}-${$this.data('row')}-${$this.data('col')}`;\n        $('.acu-cell-menu').data('cell-id', cellId);\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_dash_preview')\n      .on('click.acu_dash_preview', '.acu-dash-preview-trigger', function (e) {\n        e.stopPropagation();\n\n        const tableKey = $(this).data('table-key');\n        const rowIndex = parseInt($(this).data('row-index'), 10);\n\n        if (!tableKey || isNaN(rowIndex)) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const table = rawData[tableKey];\n        const tableName = table.name || '';\n        const headers = table.content[0] || [];\n        const rowData = table.content[rowIndex + 1];\n\n        if (!rowData) return;\n\n        const config = getConfig();\n        const title = rowData[1] || '';\n\n        //  renderTableContent \n        const titleColIndex = 1;\n        const realRowIdx = rowIndex;\n\n        // \n        let cardBody = '';\n        rowData.forEach((cell, cIdx) => {\n          if (cIdx <= 0 || cIdx === titleColIndex) return;\n          const currentHeader = headers[cIdx] || '';\n          if (currentHeader.includes('')) return; // \n\n          const headerName = headers[cIdx] || '' + cIdx;\n          const rawStr = String(cell || '').trim();\n          if (!rawStr) return;\n\n          // [] \n          const lockRowKey = LockManager.getRowKey(tableName, rowData, headers);\n          const isThisFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, headerName);\n          const inlineLockIcon = isThisFieldLocked\n            ? '<i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:10px;opacity:0.7;margin-left:4px;\" title=\"\"></i>'\n            : '';\n\n          let contentHtml = '';\n          let hideLabel = false;\n\n          const parsedAttrs = parseAttributeString(rawStr);\n          // [] \n          if (isRelationshipCell(rawStr, headerName)) {\n            const relations = parseRelationshipString(rawStr);\n            if (relations.length > 1) {\n              hideLabel = true;\n              let relHtml = '';\n              relations.forEach((rel, i) => {\n                const borderStyle = i < relations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                relHtml += `<div style=\"display:flex;justify-content:flex-start;align-items:center;gap:8px;padding:3px 0;${borderStyle}\">\n                              <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(rel.name)}${inlineLockIcon}</span>\n                              ${rel.relation ? `<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>` : ''}\n                          </div>`;\n              });\n              contentHtml = `<div class=\"acu-relation-container\">${relHtml}</div>`;\n            } else if (relations.length === 1 && relations[0].relation) {\n              hideLabel = true; // [] \n              const rel = relations[0];\n              contentHtml = `<div style=\"display:flex;justify-content:flex-start;align-items:center;gap:8px;\">\n                          <span style=\"color:var(--acu-text-sub);\">${escapeHtml(rel.name)}${inlineLockIcon}</span>\n                          <span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>\n                      </div>`;\n            }\n          } else if (parsedAttrs.length > 1) {\n            hideLabel = true;\n            let attrsHtml = '';\n            parsedAttrs.forEach((attr, i) => {\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              const borderStyle = i < parsedAttrs.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n              attrsHtml += `<div style=\"display:flex;justify-content:space-between;align-items:center;padding:3px 0;${borderStyle}\">\n                          <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(attr.name)}${inlineLockIcon}</span>\n                          <div style=\"display:flex;align-items:center;gap:6px;\">\n                              <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                              ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                          </div></div>`;\n            });\n            contentHtml = `<div class=\"acu-multi-attr-container\">${attrsHtml}</div>`;\n          } else if (parsedAttrs.length === 1) {\n            hideLabel = true;\n            const attr = parsedAttrs[0];\n            const showDice = !BlacklistManager.isBlacklisted(attr.name);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                      <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(attr.name)}${inlineLockIcon}</span>\n                      <div style=\"display:flex;align-items:center;gap:6px;\">\n                          <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                          ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                      </div></div>`;\n          } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n            const numVal = extractNumericValue(rawStr);\n            const showDice = !BlacklistManager.isBlacklisted(headerName);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                      <span>${escapeHtml(rawStr)}</span>\n                      ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(headerName)}\" data-attr-value=\"${numVal}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;margin-left:6px;\" title=\"\"></i>` : ''}\n                  </div>`;\n          } else {\n            const badgeStyle = getBadgeStyle(rawStr);\n            contentHtml = badgeStyle\n              ? `<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(rawStr)}</span>`\n              : escapeHtml(rawStr);\n          }\n\n          const rowClass = 'acu-card-row acu-cell' + (hideLabel ? ' acu-hide-label' : '');\n          cardBody += `<div class=\"${rowClass}\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${cIdx}\" data-val=\"${encodeURIComponent(cell ?? '')}\">\n                <div class=\"acu-card-label\">${escapeHtml(headerName)}</div>\n                <div class=\"acu-card-value\">${contentHtml}</div>\n            </div>`;\n        });\n\n        // []  + AI\n        // [] \n        const tableActions = getInteractOptionsForRow(tableName, headers, rowData);\n        let actionsHtml = '';\n        if (tableActions.length > 0) {\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardHtml = `\n            <div class=\"acu-preview-overlay acu-theme-${config.theme}\" style=\"--acu-card-width:${config.cardWidth}px;--acu-font-size:${config.fontSize}px;\">\n                <div class=\"acu-data-card\" style=\"width:90vw;max-width:420px;max-height:85vh;overflow-y:auto;\">\n                    <div class=\"acu-card-header\">\n                        <span class=\"acu-card-index\">#${realRowIdx + 1}</span>\n                        <span class=\"acu-cell acu-editable-title\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(title)}\">${escapeHtml(title)}</span>\n                        <button class=\"acu-preview-close\" style=\"margin-left:auto;background:none;border:none;color:var(--acu-text-sub);cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-card-body view-list\">${cardBody}</div>\n                    ${actionsHtml}\n                </div>\n            </div>\n        `;\n\n        $('.acu-preview-overlay').remove();\n        $('body').append(cardHtml);\n\n        // \n        const overlayEl = $('.acu-preview-overlay')[0];\n        if (overlayEl) {\n          overlayEl.style.setProperty('position', 'fixed', 'important');\n          overlayEl.style.setProperty('top', '0', 'important');\n          overlayEl.style.setProperty('left', '0', 'important');\n          overlayEl.style.setProperty('right', '0', 'important');\n          overlayEl.style.setProperty('bottom', '0', 'important');\n          overlayEl.style.setProperty('width', '100vw', 'important');\n          overlayEl.style.setProperty('height', '100vh', 'important');\n          overlayEl.style.setProperty('display', 'flex', 'important');\n          overlayEl.style.setProperty('justify-content', 'center', 'important');\n          overlayEl.style.setProperty('align-items', 'center', 'important');\n          overlayEl.style.setProperty('z-index', '31100', 'important');\n        }\n\n        // \n        const $previewOverlay = $('.acu-preview-overlay');\n        setupOverlayClose($previewOverlay, 'acu-preview-overlay', () => $previewOverlay.remove());\n        $previewOverlay.on('click', function (ev) {\n          if ($(ev.target).closest('.acu-preview-close').length) {\n            $(this).remove();\n          }\n        });\n      });\n\n    // === []  ST  swipe regenerate ===\n    (function () {\n      const $doc = $(document);\n      let touchStartX = 0;\n      let touchStartY = 0;\n\n      //  data-area\n      $doc.on('touchstart.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length === 1) {\n          touchStartX = e.originalEvent.touches[0].clientX;\n          touchStartY = e.originalEvent.touches[0].clientY;\n        }\n      });\n\n      $doc.on('touchmove.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length !== 1) return;\n\n        const touch = e.originalEvent.touches[0];\n        const deltaX = Math.abs(touch.clientX - touchStartX);\n        const deltaY = Math.abs(touch.clientY - touchStartY);\n\n        // X > Y * 1.5\n        if (deltaX > deltaY * 1.5 && deltaX > 10) {\n          e.stopPropagation();\n          console.log('[DICE]ACU  ST swipe');\n        }\n      });\n    })();\n  };\n\n  let selectedSwapSource = null;\n  const toggleOrderEditMode = () => {\n    const { $ } = getCore();\n    isEditingOrder = !isEditingOrder;\n\n    const $container = $('#acu-nav-bar');\n    const $hint = $('#acu-order-hint');\n    const $pool = $('#acu-action-pool');\n\n    // \n    if (!$container.length) {\n      console.error('[DICE]ACU ');\n      isEditingOrder = false;\n      return;\n    }\n\n    selectedSwapSource = null;\n    $('.acu-swap-selected').removeClass('acu-swap-selected');\n\n    if (isEditingOrder) {\n      // \n      $container.addClass('editing-order');\n      if ($pool.length) $pool.addClass('visible');\n\n      if ($hint.length) {\n        $hint\n          .html(\n            `\n                    <div style=\"display:flex; justify-content:space-between; align-items:center; width:100%; flex-wrap:wrap; gap:8px;\">\n                        <div style=\"display:flex; align-items:center; gap:10px; flex:1; min-width:200px;\">\n                            <span><i class=\"fa-solid fa-layer-group\"></i> </span>\n                            <span style=\"font-size:11px; opacity:0.9; font-weight:normal;\"></span>\n                        </div>\n                        <button id=\"acu-btn-finish-sort\" style=\"background:rgba(255,255,255,0.2); color:#fff; border:1px solid rgba(255,255,255,0.4); padding:4px 14px; border-radius:4px; cursor:pointer; font-size:12px; transition:all 0.2s; white-space:nowrap;\">\n                            <i class=\"fa-solid fa-check\"></i> \n                        </button>\n                    </div>\n                `,\n          )\n          .addClass('visible')\n          .css('display', 'flex');\n\n        $('#acu-btn-finish-sort').hover(\n          function () {\n            $(this).css({ background: '#fff', color: 'var(--acu-accent)' });\n          },\n          function () {\n            $(this).css({ background: 'rgba(255,255,255,0.2)', color: '#fff' });\n          },\n        );\n\n        $('#acu-btn-finish-sort')\n          .off('click')\n          .on('click', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            toggleOrderEditMode();\n          });\n      }\n\n      // \n      $('#acu-data-area').removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn').not('#acu-btn-dashboard, #acu-btn-dice-nav').attr('draggable', 'true');\n      $container.find('.acu-action-btn').attr('draggable', 'true');\n\n      // \n      initSortable();\n    } else {\n      // \n      $container.removeClass('editing-order');\n      if ($hint.length) $hint.removeClass('visible').hide();\n      if ($pool.length) $pool.removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn, .acu-action-btn').attr('draggable', 'false');\n      $('.acu-nav-btn, .acu-action-btn').off('.sort');\n      $('#acu-action-pool, #acu-active-actions').off('.sort');\n\n      // \n      const newTableOrder = [];\n      $container.find('.acu-nav-btn[data-table]').each(function () {\n        const tableName = $(this).data('table');\n        if (tableName) {\n          newTableOrder.push(tableName);\n        }\n      });\n      if (newTableOrder.length > 0) {\n        saveTableOrder(newTableOrder);\n      }\n\n      // \n      const newActionOrder = [];\n      $('#acu-active-actions .acu-action-btn').each(function () {\n        const btnId = $(this).attr('id');\n        if (btnId) {\n          newActionOrder.push(btnId);\n        }\n      });\n\n      // \n      if (!newActionOrder.includes('acu-btn-settings')) {\n        newActionOrder.push('acu-btn-settings');\n      }\n\n      Store.set(STORAGE_KEY_ACTION_ORDER, newActionOrder);\n\n      // \n      renderInterface();\n    }\n  };\n\n  const initSortable = () => {\n    const { $ } = getCore();\n    let $dragSrcEl = null;\n\n    // \n    $('.acu-nav-btn, .acu-action-btn, #acu-action-pool, #acu-active-actions').off('.sort');\n\n    // --- 1.  () ---\n    const $items = $('.acu-nav-btn, .acu-action-btn');\n\n    $items.on('dragstart.sort', function (e) {\n      $dragSrcEl = $(this);\n      $(this).css('opacity', '0.4');\n      e.originalEvent.dataTransfer.effectAllowed = 'move';\n    });\n\n    $items.on('dragend.sort', function (e) {\n      $(this).css('opacity', '1');\n      $('.acu-drag-over').removeClass('acu-drag-over');\n      $('.acu-actions-group, .acu-unused-pool').removeClass('dragging-over');\n    });\n\n    $items.on('dragover.sort', function (e) {\n      e.preventDefault();\n      return false;\n    });\n    $items.on('dragenter.sort', function () {\n      if ($dragSrcEl && this !== $dragSrcEl[0]) $(this).addClass('acu-drag-over');\n    });\n    $items.on('dragleave.sort', function () {\n      $(this).removeClass('acu-drag-over');\n    });\n\n    $items.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('acu-drag-over');\n      if (!$dragSrcEl || $dragSrcEl[0] === this) return false;\n\n      const isSrcAction = $dragSrcEl.hasClass('acu-action-btn');\n      const isTgtAction = $(this).hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) return false;\n\n      if (isSrcAction) {\n        const targetPoolId = $(this).parent().attr('id');\n        const srcPoolId = $dragSrcEl.parent().attr('id');\n\n        if (srcPoolId === 'acu-action-pool' && targetPoolId === 'acu-active-actions') {\n          if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n            if (window.toastr) window.toastr.warning('6');\n            return false;\n          }\n        }\n\n        if (srcPoolId !== targetPoolId) {\n          $(this).before($dragSrcEl);\n          return false;\n        }\n      }\n\n      const $temp = $('<span>').hide();\n      $dragSrcEl.before($temp);\n      $(this).before($dragSrcEl);\n      $temp.replaceWith($(this));\n      return false;\n    });\n\n    // --- 2.  (/) ---\n    const $containers = $('#acu-action-pool, #acu-active-actions');\n\n    $containers.on('dragover.sort', function (e) {\n      e.preventDefault();\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        $(this).addClass('dragging-over');\n      }\n    });\n\n    $containers.on('dragleave.sort', function (e) {\n      $(this).removeClass('dragging-over');\n    });\n\n    $containers.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('dragging-over');\n\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        const currentParentId = $dragSrcEl.parent().attr('id');\n        const targetId = $(this).attr('id');\n        const btnId = $dragSrcEl.attr('id');\n\n        if (currentParentId !== targetId) {\n          if (targetId === 'acu-action-pool') {\n            if (btnId === 'acu-btn-settings') {\n              if (window.toastr) window.toastr.warning('');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          } else if (targetId === 'acu-active-actions') {\n            if ($(this).children().length >= 6) {\n              if (window.toastr) window.toastr.warning('6');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          }\n        }\n      }\n      return false;\n    });\n\n    // --- 3.  -  ---\n    $containers.on('click.sort', function (e) {\n      e.stopPropagation();\n\n      // \n      if ($(e.target).closest('.acu-action-btn, .acu-nav-btn').length > 0) return;\n\n      // \n      if (!selectedSwapSource) return;\n\n      const $src = $(selectedSwapSource);\n\n      // \n      if (!$src.hasClass('acu-action-btn')) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const targetId = $(this).attr('id');\n      const btnId = $src.attr('id');\n\n      // \n      if (srcPoolId === targetId) {\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      //   \n      if (targetId === 'acu-action-pool') {\n        if (btnId === 'acu-btn-settings') {\n          if (window.toastr) window.toastr.warning('');\n          $src.removeClass('acu-swap-selected');\n          selectedSwapSource = null;\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n      //   \n      else if (targetId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n    });\n\n    // --- 4.  (Click-to-Swap) -  ---\n    $items.on('click.sort', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (selectedSwapSource && selectedSwapSource === this) {\n        $(this).removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      if (!selectedSwapSource) {\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const $src = $(selectedSwapSource);\n      const $tgt = $(this);\n\n      const isSrcAction = $src.hasClass('acu-action-btn');\n      const isTgtAction = $tgt.hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const tgtPoolId = $tgt.parent().attr('id');\n\n      if (isSrcAction && srcPoolId === 'acu-action-pool' && tgtPoolId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n      }\n\n      if (srcPoolId !== tgtPoolId) {\n        $tgt.before($src);\n      } else {\n        const $temp = $('<span>').hide();\n        $src.before($temp);\n        $tgt.before($src);\n        $temp.replaceWith($tgt);\n      }\n\n      $src.removeClass('acu-swap-selected');\n      selectedSwapSource = null;\n    });\n  };\n\n  const showCellMenu = (e, cell) => {\n    const { $ } = getCore();\n    $('.acu-cell-menu, .acu-menu-backdrop').remove();\n    const backdrop = $('<div class=\"acu-menu-backdrop\"></div>');\n    $('body').append(backdrop);\n\n    const rowIdx = parseInt($(cell).data('row'), 10);\n    const colIdx = parseInt($(cell).data('col'), 10);\n    if (isNaN(rowIdx) || isNaN(colIdx)) {\n      console.warn('[DICE]ACU /');\n      backdrop.remove();\n      return;\n    }\n    const tableKey = $(cell).data('key');\n    // v19.x  tname\n    const tableName = $(cell).data('tname') || $(cell).closest('.acu-data-card').find('.acu-editable-title').text();\n    const content = decodeURIComponent($(cell).data('val'));\n    const config = getConfig();\n\n    //  ID\n    const cellId = `${tableKey}-${rowIdx}-${colIdx}`;\n    if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n\n    // \n    const isModified = window.acuModifiedSet.has(cellId);\n\n    // \n    const headers = cachedRawData?.[tableKey]?.content?.[0] || [];\n    const rowData = cachedRawData?.[tableKey]?.content?.[rowIdx + 1] || [];\n    const lockRowKey = LockManager.getRowKey(tableName, rowData, headers);\n    const currentHeader = headers[colIdx] || '';\n\n    const isFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, currentHeader);\n    const hasAnyLockInRow = lockRowKey && LockManager.hasAnyLock(tableName, lockRowKey);\n\n    // \n    let lockMenuHtml = '';\n    if (lockRowKey) {\n      lockMenuHtml = '<div style=\"border-top:1px dashed var(--acu-border); margin:4px 0;\"></div>';\n\n      // \"\"\"\"\n      if (isFieldLocked) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-field\" style=\"color:#27ae60;\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-field\" style=\"color:#f39c12;\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n\n      // \"\"\"\"\n      if (hasAnyLockInRow) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-row\" style=\"color:#27ae60;\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-row\" style=\"color:#f39c12;\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n    }\n\n    const menu = $(`\n            <div class=\"acu-cell-menu acu-theme-${config.theme}\">\n                <div class=\"acu-cell-menu-item\" id=\"act-edit\"><i class=\"fa-solid fa-pen\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-edit-card\" style=\"color:#9b59b6\"><i class=\"fa-solid fa-edit\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-insert\" style=\"color:#2980b9\"><i class=\"fa-solid fa-plus\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-copy\"><i class=\"fa-solid fa-copy\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-favorite\" style=\"color:#f1c40f\"><i class=\"fa-solid fa-star\"></i> </div>\n                ${lockMenuHtml}\n                ${isModified ? '<div class=\"acu-cell-menu-item\" id=\"act-undo\" style=\"color:#e67e22; border-top:1px solid #eee;\"><i class=\"fa-solid fa-undo\"></i> </div>' : ''}\n                <div class=\"acu-cell-menu-item\" id=\"act-delete\" style=\"color:#e74c3c\"><i class=\"fa-solid fa-trash\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-close\"><i class=\"fa-solid fa-times\"></i> </div>\n            </div>\n        `);\n    $('body').append(menu);\n\n    // \n    const winWidth = $(window).width();\n    const winHeight = $(window).height();\n    const mWidth = menu.outerWidth() || 150;\n    const mHeight = menu.outerHeight() || 150;\n    let clientX = e.clientX;\n    let clientY = e.clientY;\n    if (!clientX && e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length) {\n      clientX = e.originalEvent.touches[0].clientX;\n      clientY = e.originalEvent.touches[0].clientY;\n    } else if (!clientX && e.changedTouches && e.changedTouches.length) {\n      clientX = e.changedTouches[0].clientX;\n      clientY = e.changedTouches[0].clientY;\n    }\n\n    // \n    if (clientX === undefined) clientX = winWidth / 2;\n    if (clientY === undefined) clientY = winHeight / 2;\n\n    let left = clientX + 5;\n    let top = clientY + 5;\n    if (left + mWidth > winWidth) left = clientX - mWidth - 5;\n    if (top + mHeight > winHeight) top = clientY - mHeight - 5;\n\n    // \n    if (left < 5) left = 5;\n    if (top < 5) top = 5;\n\n    menu.css({ top: top + 'px', left: left + 'px' });\n\n    const closeAll = () => {\n      menu.remove();\n      backdrop.remove();\n    };\n    backdrop.on('click', closeAll);\n    menu.find('#act-close').click(closeAll);\n    // \n    menu.find('#act-lock-field').click(() => {\n      if (lockRowKey && currentHeader) {\n        LockManager.lockField(tableName, lockRowKey, currentHeader, content);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-field').click(() => {\n      if (lockRowKey && currentHeader) {\n        LockManager.unlockField(tableName, lockRowKey, currentHeader);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-lock-row').click(() => {\n      if (lockRowKey) {\n        LockManager.lockRow(tableName, lockRowKey, rowData, headers);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-row').click(() => {\n      if (lockRowKey) {\n        LockManager.unlockRow(tableName, lockRowKey);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    //  (v7.9 )\n    menu.find('#act-copy').click(async e => {\n      e.stopPropagation();\n\n      //  v7.7  (/PWA )\n      // : slash_command.txt /clipboard-set\n      if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n        try {\n          // \n          const safeContent = content\n            .replace(/\\\\/g, '\\\\\\\\')\n            .replace(/\"/g, '\\\\\"')\n            .replace(/\\n/g, '\\\\n')\n            .replace(/\\{/g, '\\\\{')\n            .replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          closeAll();\n          return; // \n        } catch (err) {\n          console.warn('[DICE]ACU ', err);\n        }\n      }\n\n      //  (v7.8 )\n      const doCopy = text => {\n        // A:  API ( HTTPS  localhost )\n        if (navigator.clipboard && window.isSecureContext) {\n          navigator.clipboard\n            .writeText(text)\n            .then(() => {})\n            .catch(() => {\n              fallbackCopy(text);\n            });\n        } else {\n          // B:  execCommand ( HTTP)\n          fallbackCopy(text);\n        }\n      };\n\n      const fallbackCopy = text => {\n        try {\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n\n          // \n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n\n          document.body.appendChild(textArea);\n\n          textArea.select();\n          textArea.setSelectionRange(0, 99999); //  iOS Safari\n\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n\n          if (successful) {\n          } else {\n            throw new Error('execCommand failed');\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          prompt(':', text);\n        }\n      };\n\n      doCopy(content);\n      closeAll();\n    });\n\n    // \n    menu.find('#act-favorite').click(async () => {\n      try {\n        // \n        const tableData = cachedRawData?.[tableKey];\n        if (!tableData || !tableData.content) {\n          toastr.error('');\n          closeAll();\n          return;\n        }\n\n        // null\n        const fullHeader = tableData.content[0] || [];\n        const header: string[] = fullHeader.slice(1).map((h: any) => String(h || ''));\n\n        // null\n        const fullRowData = tableData.content[rowIdx + 1] || [];\n        const rowDataValues: (string | number)[] = fullRowData.slice(1);\n\n        if (header.length === 0 || rowDataValues.length === 0) {\n          toastr.error('');\n          closeAll();\n          return;\n        }\n\n        // \n        const tagInput = prompt('', '');\n        const tags: string[] = tagInput\n          ? tagInput\n              .split(',')\n              .map(t => t.trim())\n              .filter(t => t.length > 0)\n          : [];\n\n        // \n        const result = await FavoritesManager.addFavorite(tableKey, tableName, header, rowDataValues, tags);\n\n        if (result) {\n          toastr.success('');\n        } else {\n          toastr.error('');\n        }\n      } catch (e) {\n        console.error('[DICE]:', e);\n        toastr.error(': ' + (e instanceof Error ? e.message : String(e)));\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-undo').click(() => {\n      const snapshot = loadSnapshot();\n      let originalValue = null;\n      if (snapshot && snapshot[tableKey]?.content[rowIdx + 1]) {\n        originalValue = snapshot[tableKey].content[rowIdx + 1][colIdx];\n      }\n\n      if (originalValue !== null) {\n        if (!cachedRawData) cachedRawData = getTableData();\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = originalValue;\n        }\n\n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(originalValue));\n        $cell.data('val', encodeURIComponent(originalValue));\n\n        // [1]  Label\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length > 0) {\n          $displayTarget = $cell.find('.acu-card-value');\n        } else if ($cell.hasClass('acu-grid-item')) {\n          $displayTarget = $cell.find('.acu-grid-value');\n        } else if ($cell.hasClass('acu-full-item')) {\n          $displayTarget = $cell.find('.acu-full-value');\n        }\n\n        const badgeStyle = getBadgeStyle(originalValue);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${originalValue}</span>`);\n        } else {\n          $displayTarget.text(originalValue);\n        }\n\n        // [] \n        $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n        if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n        window.acuModifiedSet.delete(cellId);\n\n        if (window.acuModifiedSet.size === 0) {\n          hasUnsavedChanges = false;\n          updateSaveButtonState();\n        }\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n      closeAll();\n    });\n\n    // []  ()\n    menu.find('#act-delete').click(async () => {\n      // [] DOM\n      const $panelContent = $('.acu-panel-content');\n      const savedScrollTop = $panelContent.length ? $panelContent.scrollTop() : 0;\n      const savedScrollLeft = $panelContent.length ? $panelContent.scrollLeft() : 0;\n\n      // \n      closeAll();\n\n      // [Bug 1 ] preview cardoverlay\n      const $mapOverlay = $('.acu-map-overlay');\n      const isFromMap = $mapOverlay.length > 0;\n\n      // preview card overlay\n      $('.acu-preview-overlay').remove();\n\n      // ---  DOM ---\n      if (isFromMap) {\n        // chip data-table-key  data-row-index \n        $mapOverlay.find(`.acu-map-element-chip[data-table-key=\"${tableKey}\"][data-row-index=\"${rowIdx}\"]`).remove();\n        $mapOverlay.find(`.acu-map-thumbnail[data-table-key=\"${tableKey}\"][data-row-index=\"${rowIdx}\"]`).remove();\n      }\n\n      // \n      const $card = $(cell).closest('.acu-data-card');\n      if ($card.length && !isFromMap) {\n        $card.css('transition', 'all 0.2s ease').css('opacity', '0').css('transform', 'scale(0.9)');\n        setTimeout(() => $card.slideUp(200, () => $card.remove()), 200);\n      }\n\n      // ---  ---\n      if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n      if (cachedRawData && cachedRawData[tableKey]?.content) {\n        cachedRawData[tableKey].content.splice(rowIdx + 1, 1);\n\n        try {\n          // \n          await saveDataOnly(cachedRawData);\n\n          // [Bug 3 ] diffMap\n          currentDiffMap = generateDiffMap(cachedRawData);\n\n          // \n          renderInterface();\n\n          // [] overlayviewModel\n          if (isFromMap) {\n            const refreshMapData = $mapOverlay.data('refreshMapData');\n            if (typeof refreshMapData === 'function') {\n              await refreshMapData();\n            }\n          }\n\n          // [] renderInterface\n          setTimeout(() => {\n            const $newContent = $('.acu-panel-content');\n            if ($newContent.length && (savedScrollTop > 0 || savedScrollLeft > 0)) {\n              $newContent.scrollTop(savedScrollTop);\n              $newContent.scrollLeft(savedScrollLeft);\n            }\n          }, 60);\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n          toastr.error(': ' + (e instanceof Error ? e.message : String(e)));\n          renderInterface();\n\n          // [] \n          setTimeout(() => {\n            const $newContent = $('.acu-panel-content');\n            if ($newContent.length && (savedScrollTop > 0 || savedScrollLeft > 0)) {\n              $newContent.scrollTop(savedScrollTop);\n              $newContent.scrollLeft(savedScrollLeft);\n            }\n          }, 60);\n        }\n      }\n    });\n\n    // []  ()\n    menu.find('#act-insert').click(async () => {\n      closeAll();\n      // 1.  ()\n      if (!cachedRawData) cachedRawData = getTableData();\n      if (!cachedRawData) cachedRawData = loadSnapshot();\n\n      if (cachedRawData && cachedRawData[tableKey]?.content) {\n        const sheet = cachedRawData[tableKey];\n        // 2.  ()\n        const colCount = sheet.content[0] ? sheet.content[0].length : 2;\n        const newRow = new Array(colCount).fill('');\n        //  ()\n        if (colCount > 0) newRow[0] = String(sheet.content.length);\n\n        // 3.  (rowIdx+2  content )\n        sheet.content.splice(rowIdx + 2, 0, newRow);\n\n        // 4. \n        // \n        await saveDataToDatabase(cachedRawData, false, true);\n\n        // \n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $panel = $('.acu-panel-content');\n          // \n          if ($panel.length && $panel[0].scrollHeight > $panel.height()) {\n            $panel.scrollTop($panel.scrollTop() + 10);\n          }\n        }, 100);\n      }\n    });\n\n    // [] \n    menu.find('#act-edit-card').click(() => {\n      closeAll();\n      const rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const headers = rawData[tableKey].content[0];\n        const row = rawData[tableKey].content[rowIdx + 1];\n        if (row) {\n          showCardEditModal(row, headers, tableName, rowIdx, tableKey);\n        }\n      }\n    });\n\n    menu.find('#act-edit').click(() => {\n      closeAll();\n      showEditDialog(content, async newVal => {\n        // 1. \n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = newVal;\n        } else {\n          alert('');\n          return;\n        }\n\n        // 2.  UI \n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(newVal)).data('val', encodeURIComponent(newVal));\n\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length) $displayTarget = $cell.find('.acu-card-value');\n        else if ($cell.hasClass('acu-grid-item')) $displayTarget = $cell.find('.acu-grid-value');\n        else if ($cell.hasClass('acu-editable-title')) $displayTarget = $cell;\n\n        // 3.  UI / ()\n        const badgeStyle = getBadgeStyle(newVal);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(newVal)}</span>`);\n        } else {\n          $displayTarget.text(newVal);\n        }\n\n        // 4.  + AI\n        //  ()\n        $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n        if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n        //  saveRowInstantly  + \n        try {\n          const currentRow = cachedRawData[tableKey].content[rowIdx + 1];\n          await saveRowInstantly(tableKey, rowIdx, [...currentRow]);\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n          toastr.error(': ' + (e instanceof Error ? e.message : String(e)));\n        }\n      });\n    });\n  };\n\n  const showEditDialog = (content, onSave) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <!-- 2. []  acu-theme-${config.theme} -->\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"></div>\n                    <textarea class=\"acu-edit-textarea\" spellcheck=\"false\">${escapeHtml(content)}</textarea>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = el.scrollHeight + 2 + 'px';\n    };\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    dialog.find('#dlg-cancel').click(() => dialog.remove());\n    // \n    setupOverlayClose(dialog, 'acu-edit-overlay', () => dialog.remove());\n\n    dialog.find('#dlg-save').click(() => {\n      onSave(dialog.find('textarea').val());\n      dialog.remove();\n    });\n  };\n\n  // ==========================================\n  // []  (Observer )\n  // ==========================================\n  // \n  const detectVisualizerConflict = () => {\n    const { $ } = getCore();\n    if (!$) return false;\n\n    // 1:  DOM \n    //  .acu-wrapper\n    const $wrapper = $('.acu-wrapper');\n    if ($wrapper.length > 0) {\n      //  wrapper \n      //  v12.60  'acu_visualizer_ui_v20_pagination'  SCRIPT_ID\n      // \n      const hasVisualizerNav = $wrapper.find('.acu-nav-container').length > 0;\n      const hasVisualizerDataDisplay = $wrapper.find('.acu-data-display').length > 0;\n\n      //  wrapper \n      //  wrapper  data  id\n      const wrapperId = $wrapper.attr('id') || '';\n      const wrapperClass = $wrapper.attr('class') || '';\n\n      // \n      if (hasVisualizerNav && hasVisualizerDataDisplay) {\n        // \n        const hasDiceFeatures = $wrapper.find('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceFeatures) {\n          return true; // \n        }\n      }\n    }\n\n    // 2: \n    try {\n      const scripts = document.querySelectorAll('script');\n      for (const script of scripts) {\n        const content = script.textContent || script.innerHTML || '';\n        //  v12.60 \n        if (content.includes('acu_visualizer_ui_v20_pagination') && content.includes('acu_ui_config_v18')) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // \n    }\n\n    // 3:  localStorage\n    //  localStorage \n    try {\n      const visualizerConfig = localStorage.getItem('acu_ui_config_v18');\n      const diceConfig = localStorage.getItem('acu_ui_config_v19');\n\n      //  DOM \n      if (visualizerConfig && !diceConfig) {\n        //  DOM\n        const hasDiceInDOM = $('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceInDOM) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // localStorage \n    }\n\n    return false;\n  };\n\n  // \n  const showConflictDialog = () => {\n    const { $ } = getCore();\n    if (!$) return;\n\n    // \n    $('.dice-conflict-dialog-overlay').remove();\n\n    const dialogHtml = `\n      <div class=\"dice-conflict-dialog-overlay\" style=\"\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0, 0, 0, 0.75);\n        backdrop-filter: blur(4px);\n        z-index: 31200;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 20px;\n        box-sizing: border-box;\n      \">\n        <div class=\"dice-conflict-dialog\" style=\"\n          background: #fff;\n          border-radius: 16px;\n          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n          max-width: 500px;\n          width: 100%;\n          padding: 30px;\n          box-sizing: border-box;\n          animation: diceDialogPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n        \">\n          <div style=\"\n            text-align: center;\n            margin-bottom: 20px;\n          \">\n            <div style=\"\n              font-size: 48px;\n              color: #e74c3c;\n              margin-bottom: 15px;\n            \"></div>\n            <h2 style=\"\n              font-size: 24px;\n              font-weight: bold;\n              color: #333;\n              margin: 0 0 10px 0;\n            \"></h2>\n            <p style=\"\n              font-size: 16px;\n              color: #666;\n              line-height: 1.6;\n              margin: 0;\n            \">\"\"</p>\n          </div>\n          <div style=\"\n            background: #fff3cd;\n            border: 1px solid #ffc107;\n            border-radius: 8px;\n            padding: 15px;\n            margin-bottom: 20px;\n          \">\n            <p style=\"\n              font-size: 14px;\n              color: #856404;\n              line-height: 1.6;\n              margin: 0;\n            \">\n              <strong></strong><br>\n              <strong></strong>\n            </p>\n          </div>\n          <div style=\"\n            display: flex;\n            gap: 10px;\n            justify-content: center;\n            flex-wrap: wrap;\n          \">\n            <button id=\"dice-conflict-close\" style=\"\n              background: #6c757d;\n              color: #fff;\n              border: none;\n              border-radius: 8px;\n              padding: 12px 24px;\n              font-size: 16px;\n              font-weight: bold;\n              cursor: pointer;\n              transition: all 0.2s;\n              min-width: 120px;\n            \"></button>\n          </div>\n        </div>\n      </div>\n      <style>\n        @keyframes diceDialogPop {\n          from {\n            opacity: 0;\n            transform: translateY(20px) scale(0.95);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0) scale(1);\n          }\n        }\n        .dice-conflict-dialog button:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        }\n        .dice-conflict-dialog button:active {\n          transform: translateY(0);\n        }\n        @media (max-width: 768px) {\n          .dice-conflict-dialog {\n            padding: 20px !important;\n            margin: 10px !important;\n            max-width: calc(100% - 20px) !important;\n          }\n          .dice-conflict-dialog h2 {\n            font-size: 20px !important;\n          }\n          .dice-conflict-dialog p {\n            font-size: 14px !important;\n          }\n        }\n      </style>\n    `;\n\n    $('body').append(dialogHtml);\n\n    // \n    $('#dice-conflict-close').on('click', function () {\n      $('.dice-conflict-dialog-overlay').fadeOut(200, function () {\n        $(this).remove();\n      });\n    });\n\n    // \n    const $conflictOverlay = $('.dice-conflict-dialog-overlay');\n    setupOverlayClose($conflictOverlay, 'dice-conflict-dialog-overlay', () => {\n      $conflictOverlay.fadeOut(200, function () {\n        $(this).remove();\n      });\n    });\n\n    //  toastr \n    if (window.toastr) {\n      window.toastr.error('', '', {\n        timeOut: 0,\n        extendedTimeOut: 0,\n        closeButton: true,\n        preventDuplicates: true,\n      });\n    }\n  };\n\n  const init = () => {\n    if (isInitialized) return;\n\n    console.log('[DICE]...');\n\n    //  ConsoleCaptureManager  localStorage\n    try {\n      ConsoleCaptureManager.restore();\n      console.info('[DICE]ConsoleCaptureManager ');\n    } catch (e) {\n      console.error('[DICE] ConsoleCaptureManager :', e);\n    }\n\n    // \n    try {\n      ErrorHandler.checkAndRestore();\n      console.info('[DICE]');\n    } catch (e) {\n      console.error('[DICE]:', e);\n    }\n\n    // \n    if (detectVisualizerConflict()) {\n      showConflictDialog();\n      console.error('[DICE] ');\n      return; // \n    }\n\n    console.info('[DICE] MVU ...');\n    MvuModule.injectStyles();\n\n    //  Observer\n    if (observer) {\n      observer.disconnect();\n      observer = null;\n      console.info('[DICE] MutationObserver');\n    }\n    addStyles();\n    // 2.  SillyTavern \n    if (window.SillyTavern && window.SillyTavern.eventSource) {\n      console.info('[DICE] SillyTavern ...');\n      const events = window.SillyTavern.eventTypes;\n      const source = window.SillyTavern.eventSource;\n      const triggers = [events.CHAT_CHANGED, events.MESSAGE_SWIPED, events.MESSAGE_DELETED, events.MESSAGE_UPDATED];\n\n      // \n      if (!_boundRenderHandler) {\n        _boundRenderHandler = () => {\n          if (!isEditingOrder) {\n            console.info('[DICE]');\n            setTimeout(renderInterface, 500);\n          } else {\n            console.info('[DICE]');\n          }\n        };\n      }\n\n      // \n      if (!window._acuBoundChatChangeHandler) {\n        window._acuBoundChatChangeHandler = () => {\n          console.info('[DICE]');\n          cachedRawData = null;\n          tablePageStates = {};\n          tableSearchStates = {};\n          tableScrollStates = {};\n          hasUnsavedChanges = false;\n          currentDiffMap.clear();\n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          setTimeout(renderInterface, 500);\n        };\n      }\n      const _boundChatChangeHandler = window._acuBoundChatChangeHandler;\n\n      triggers.forEach(evt => {\n        if (evt) {\n          source.removeListener(evt, _boundRenderHandler);\n          source.removeListener(evt, _boundChatChangeHandler); // \n          if (evt === events.CHAT_CHANGED) {\n            source.on(evt, _boundChatChangeHandler);\n          } else {\n            source.on(evt, _boundRenderHandler);\n          }\n        }\n      });\n      console.info(`[DICE] ${triggers.length} `);\n    } else {\n      console.warn('[DICE]SillyTavern ');\n    }\n\n    // 3.  API \n    const loop = () => {\n      const api = getCore().getDB();\n      if (api?.exportTableAsJson) {\n        isInitialized = true;\n        console.log('[DICE]');\n        console.info('[DICE] API ');\n\n        // --- [Fix]  API  #chat  () ---\n        const $chat = $('#chat');\n        if ($chat.length && !observer) {\n          console.info('[DICE] MutationObserver');\n          let mutationLock = false;\n          const handleMutation = () => {\n            if (mutationLock) return;\n            mutationLock = true;\n            requestAnimationFrame(() => {\n              const config = getConfig();\n              if (config.positionMode === 'embedded') {\n                mutationLock = false;\n                return;\n              }\n\n              const children = $chat.children();\n              const lastChild = children.last()[0];\n              const wrapper = $('.acu-wrapper')[0];\n\n              if (wrapper && lastChild && lastChild !== wrapper) {\n                if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n                  $chat.append(wrapper);\n                }\n              }\n\n              // [] \n              const diceCfg = getDiceConfig();\n              if (diceCfg && diceCfg.hideDiceResultInChat) {\n                // 1\n                const children = $chat.children();\n                const lastChild = children.last();\n                if (lastChild.hasClass('mes') || lastChild.hasClass('message-body')) {\n                  lastChild.addClass('acu-dice-result-revealing');\n                }\n\n                // 2RAF\n                requestAnimationFrame(() => {\n                  hideDiceResultsInUserMessages();\n\n                  // 3\n                  requestAnimationFrame(() => {\n                    lastChild.removeClass('acu-dice-result-revealing').addClass('acu-dice-result-revealed');\n                    // \n                    setTimeout(() => {\n                      lastChild.removeClass('acu-dice-result-revealed');\n                    }, 200);\n                  });\n                });\n              }\n\n              mutationLock = false;\n            });\n          };\n          observer = new MutationObserver(handleMutation);\n          observer.observe($chat[0], { childList: true });\n        } else if (!$chat.length) {\n          console.warn('[DICE] (#chat)  MutationObserver ');\n        }\n        // --------------------------------------------------\n\n        console.info('[DICE]...');\n        renderInterface(); // \n        // [] \n        setTimeout(() => {\n          hideDiceResultsInUserMessages();\n        }, 500);\n        // \n        if (api.registerTableUpdateCallback) {\n          api.registerTableUpdateCallback(UpdateController.handleUpdate);\n          console.info('[DICE]');\n\n          // \n          if (api.registerTableFillStartCallback) {\n            api.registerTableFillStartCallback(() => {\n              const current = api.exportTableAsJson();\n              if (current) saveSnapshot(current);\n            });\n            console.info('[DICE]');\n          }\n        } else {\n          console.warn('[DICE] API ');\n        }\n      } else {\n        //  ( 60)\n        if (!isInitialized) {\n          window._acuInitRetries = (window._acuInitRetries || 0) + 1;\n          if (window._acuInitRetries < 60) {\n            if (window._acuInitRetries % 10 === 0) {\n              console.info(`[DICE] API ... (${window._acuInitRetries}/60)`);\n            }\n            setTimeout(loop, 1000);\n          } else {\n            console.error('[DICE] API');\n          }\n        }\n      }\n    };\n    loop();\n\n    // []  - \n    const setupOptionHideListener = () => {\n      const { $ } = getCore();\n      const hideOptionPanel = () => {\n        optionPanelVisible = false;\n        $('.acu-option-panel, .acu-embedded-options-container').fadeOut(200, function () {\n          $(this).remove();\n        });\n      };\n\n      const pendingCrazyAppend = new Map<number, { result: string; createdAt: number }>();\n      const CRAZY_APPEND_TTL_MS = 12000;\n      let lastCrazyPreSendAt = 0;\n\n      const normalizeMessageId = (messageId: number | string) => {\n        const id = typeof messageId === 'string' ? Number(messageId) : messageId;\n        return Number.isFinite(id) ? id : null;\n      };\n\n      const hasDiceResultInText = (text: string) => {\n        if (!text) return false;\n        const contestRegex =\n          /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n        const normalRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n        return contestRegex.test(text) || normalRegex.test(text);\n      };\n\n      const insertDiceIntoUserInputBlock = (text: string, diceResult: string) => {\n        if (!text || !diceResult) return '';\n        const blockRegex = /(<>)([\\s\\S]*?)(<\\/>)/;\n        const blockMatch = text.match(blockRegex);\n        if (!blockMatch) return '';\n        const inner = blockMatch[2];\n        if (inner.includes(diceResult)) return '';\n        const prefix = inner.startsWith('\\n') ? '\\n' : '';\n        const suffix = inner.endsWith('\\n') ? '\\n' : '';\n        const trimmedInner = inner.trim();\n        const newInner = trimmedInner ? `${trimmedInner} ${diceResult}` : diceResult;\n        const textWithoutDice = text.includes(diceResult) ? text.replace(diceResult, '').trim() : text;\n        return textWithoutDice.replace(blockRegex, `${blockMatch[1]}${prefix}${newInner}${suffix}${blockMatch[3]}`);\n      };\n\n      const applyCrazyModeToPrompt = (type: string, params: unknown, dryRun: boolean) => {\n        if (dryRun) return;\n        const safeParams = params && typeof params === 'object' ? (params as Record<string, unknown>) : {};\n        const quietPrompt = typeof safeParams.quiet_prompt === 'string' ? safeParams.quiet_prompt : '';\n        const automaticTrigger = safeParams.automatic_trigger === true;\n        const alreadyApplied = safeParams._acu_crazy_applied === true;\n        if (alreadyApplied || automaticTrigger) return;\n        if (type === 'quiet' || quietPrompt.trim().length > 0) return;\n\n        const now = Date.now();\n        if (now - lastCrazyPreSendAt < 300) return;\n\n        const originalPrompt = typeof safeParams.prompt === 'string' ? safeParams.prompt : '';\n        if (!originalPrompt || !originalPrompt.trim()) return;\n        if (hasDiceResultInText(originalPrompt)) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        let finalPrompt = '';\n        if (originalPrompt.includes('<>')) {\n          const inserted = insertDiceIntoUserInputBlock(originalPrompt, crazyRollResult);\n          finalPrompt =\n            inserted && inserted !== originalPrompt ? inserted : `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n        } else {\n          finalPrompt = `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n        }\n\n        safeParams.prompt = finalPrompt;\n        safeParams._acu_crazy_applied = true;\n        lastCrazyPreSendAt = now;\n      };\n\n      const triggerCrazyModeBeforeSend = () => {\n        const now = Date.now();\n        if (now - lastCrazyPreSendAt < 300) return;\n\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        const content = ($ta.val() || '').toString().trim();\n        if (!content) return;\n        if (hasDiceResultInText(content)) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        smartInsertToTextarea(crazyRollResult, 'dice');\n        const updatedValue = ($ta.val() || '').toString();\n        if (updatedValue) {\n          const textarea = $ta[0] as HTMLTextAreaElement;\n          textarea.value = updatedValue;\n          textarea.dispatchEvent(new Event('input', { bubbles: true }));\n          textarea.dispatchEvent(new Event('change', { bubbles: true }));\n        }\n        lastCrazyPreSendAt = now;\n      };\n\n      const queueCrazyAppend = (messageId: number | string) => {\n        const id = normalizeMessageId(messageId);\n        if (id === null) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        pendingCrazyAppend.set(id, { result: crazyRollResult, createdAt: Date.now() });\n        void applyCrazyAppend(id);\n      };\n\n      const applyCrazyAppend = async (messageId: number | string) => {\n        const id = normalizeMessageId(messageId);\n        if (id === null) return;\n\n        const pending = pendingCrazyAppend.get(id);\n        if (!pending) return;\n\n        if (Date.now() - pending.createdAt > CRAZY_APPEND_TTL_MS) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        const stChat = ST?.chat || window.parent?.SillyTavern?.chat;\n        const stMsg = stChat && typeof id === 'number' ? stChat[id] : null;\n        const msg = getChatMessages(id)[0];\n        if (!msg || msg.role !== 'user') {\n          if (!stMsg || !stMsg.is_user) {\n            pendingCrazyAppend.delete(id);\n            return;\n          }\n        }\n\n        const originalText = String(stMsg?.mes ?? msg?.message ?? '');\n        if (hasDiceResultInText(originalText)) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        const extra = msg?.extra || stMsg?.extra || {};\n        if ((extra as { acuCrazyModeApplied?: boolean }).acuCrazyModeApplied) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        let newMessage = '';\n        if (originalText.includes('<>')) {\n          const inserted = insertDiceIntoUserInputBlock(originalText, pending.result);\n          newMessage = inserted && inserted !== originalText ? inserted : `${originalText} ${pending.result}`.trim();\n        } else {\n          newMessage = originalText ? `${originalText} ${pending.result}` : pending.result;\n        }\n        pendingCrazyAppend.delete(id);\n\n        if (stMsg && stMsg.is_user) {\n          stMsg.mes = newMessage;\n        }\n\n        try {\n          await setChatMessages(\n            [{ message_id: id, message: newMessage, extra: { ...extra, acuCrazyModeApplied: true } }],\n            { refresh: 'affected' },\n          );\n        } catch (e) {\n          console.warn('[DICE]: ', e);\n        }\n\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        if ($ta.length) {\n          const currentVal = ($ta.val() || '').toString();\n          if (currentVal === newMessage) {\n            $ta.val('').trigger('input').trigger('change');\n          }\n        }\n      };\n\n      // [] \n      const setupSendButtonListener = () => {\n        // []  value \n        interceptTextareaValue();\n\n        // [] \n        const sendButton = document.getElementById('send_but');\n        if (sendButton) {\n          const onSendCapture = () => {\n            // \n            triggerCrazyModeBeforeSend();\n            // \n            restoreDiceResultBeforeSend();\n          };\n          sendButton.addEventListener('click', onSendCapture, true);\n          sendButton.addEventListener('pointerup', onSendCapture, true);\n          sendButton.addEventListener('touchend', onSendCapture, true);\n        }\n\n        // jQuery\n        $(document)\n          .off('click.acu_restore_dice', '#send_but')\n          .on('click.acu_restore_dice', '#send_but', function (e) {\n            // \n            triggerCrazyModeBeforeSend();\n            // \n            restoreDiceResultBeforeSend();\n          });\n\n        // \n        const textarea = document.getElementById('send_textarea');\n        if (textarea) {\n          textarea.addEventListener(\n            'keydown',\n            function (e) {\n              //  ShiftShift+Enter \n              if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n                // \n                triggerCrazyModeBeforeSend();\n                // \n                restoreDiceResultBeforeSend();\n              }\n            },\n            true, // \n          );\n          textarea.addEventListener(\n            'keyup',\n            function (e) {\n              if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n                triggerCrazyModeBeforeSend();\n                restoreDiceResultBeforeSend();\n              }\n            },\n            true,\n          );\n        }\n\n        $('#send_textarea')\n          .off('keydown.acu_restore_dice')\n          .on('keydown.acu_restore_dice', function (e) {\n            //  ShiftShift+Enter \n            if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n              // \n              triggerCrazyModeBeforeSend();\n              // \n              restoreDiceResultBeforeSend();\n            }\n          })\n          .off('keyup.acu_restore_dice')\n          .on('keyup.acu_restore_dice', function (e) {\n            if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n              triggerCrazyModeBeforeSend();\n              restoreDiceResultBeforeSend();\n            }\n          });\n\n        // [] /\n        const observer = new MutationObserver(() => {\n          const $ta = $('#send_textarea');\n          if ($ta.length && !$ta[0]._acuValueIntercepted) {\n            interceptTextareaValue();\n          }\n        });\n        observer.observe(document.body, { childList: true, subtree: true });\n      };\n\n      const installCrazyGenerateHook = () => {\n        const rootWindow = window as Window & {\n          __acuCrazyGenerateHookInstalled?: boolean;\n          __acuCrazyGenerateOriginal?: (...args: unknown[]) => unknown;\n        };\n        if (rootWindow.__acuCrazyGenerateHookInstalled) return;\n        if (!rootWindow.TavernHelper || typeof rootWindow.TavernHelper.generate !== 'function') return;\n\n        rootWindow.__acuCrazyGenerateOriginal = rootWindow.TavernHelper.generate;\n        rootWindow.TavernHelper.generate = async function (...args: unknown[]) {\n          const options =\n            args.length > 0 && args[0] && typeof args[0] === 'object' ? (args[0] as Record<string, unknown>) : null;\n\n          if (options) {\n            const quietPrompt = typeof options.quiet_prompt === 'string' ? options.quiet_prompt : '';\n            const automaticTrigger = options.automatic_trigger === true;\n            const alreadyApplied = options._acu_crazy_applied === true;\n            if (!alreadyApplied && !automaticTrigger && quietPrompt.trim().length === 0) {\n              let originalPrompt = '';\n              const injects = options.injects;\n              if (Array.isArray(injects) && injects.length > 0) {\n                const first = injects[0];\n                if (first && typeof first === 'object') {\n                  const content = (first as Record<string, unknown>).content;\n                  if (typeof content === 'string') originalPrompt = content;\n                }\n              }\n              if (!originalPrompt && typeof options.prompt === 'string') {\n                originalPrompt = options.prompt;\n              }\n              if (!originalPrompt && typeof options.user_input === 'string') {\n                originalPrompt = options.user_input;\n              }\n\n              if (originalPrompt && !hasDiceResultInText(originalPrompt) && shouldTriggerCrazyMode()) {\n                const crazyRollResult = generateCrazyRoll();\n                if (crazyRollResult) {\n                  const mergedPrompt = `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n                  if (Array.isArray(injects) && injects.length > 0) {\n                    const first = injects[0];\n                    if (first && typeof first === 'object') {\n                      (first as Record<string, unknown>).content = mergedPrompt;\n                    }\n                  } else if (typeof options.prompt === 'string') {\n                    options.prompt = mergedPrompt;\n                  } else {\n                    options.user_input = mergedPrompt;\n                  }\n                  options._acu_crazy_applied = true;\n                  lastCrazyPreSendAt = Date.now();\n                  console.info('[DICE]: ');\n                }\n              }\n            }\n          }\n\n          return (rootWindow.__acuCrazyGenerateOriginal as (...args: unknown[]) => unknown).apply(this, args);\n        };\n        rootWindow.__acuCrazyGenerateHookInstalled = true;\n      };\n\n      // []  ( ST  -> )\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      // \n      const evtName =\n        ST?.eventTypes?.MESSAGE_SENT || (window.tavern_events ? window.tavern_events.MESSAGE_SENT : 'message_sent');\n\n      // 1.  ST.eventSource ()\n      if (ST?.eventSource) {\n        ST.eventSource.on(evtName, hideOptionPanel);\n        // [] \n        ST.eventSource.on(evtName, messageId => {\n          // \n          queueCrazyAppend(messageId);\n\n          // DOM\n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            setTimeout(() => {\n              hideDiceResultsInUserMessages();\n            }, 300);\n          }\n        });\n\n        // []  GENERATION_AFTER_COMMANDS \n        const afterCommandsEvtName =\n          ST?.eventTypes?.GENERATION_AFTER_COMMANDS ||\n          (window.tavern_events ? window.tavern_events.GENERATION_AFTER_COMMANDS : 'GENERATION_AFTER_COMMANDS');\n        if (afterCommandsEvtName) {\n          ST.eventSource.on(afterCommandsEvtName, (type, params, dryRun) => {\n            applyCrazyModeToPrompt(type, params, dryRun);\n          });\n        }\n\n        installCrazyGenerateHook();\n        setupSendButtonListener();\n        return;\n      }\n\n      // 2.  eventOn (TavernHelper )\n      if (typeof window.eventOn === 'function') {\n        window.eventOn(evtName, hideOptionPanel);\n        // [] \n        window.eventOn(evtName, messageId => {\n          // \n          queueCrazyAppend(messageId);\n\n          // DOM\n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            setTimeout(() => {\n              hideDiceResultsInUserMessages();\n            }, 300);\n          }\n        });\n\n        // []  GENERATION_AFTER_COMMANDS \n        const afterCommandsEvtName = window.tavern_events\n          ? window.tavern_events.GENERATION_AFTER_COMMANDS\n          : 'GENERATION_AFTER_COMMANDS';\n        window.eventOn(afterCommandsEvtName, (type, params, dryRun) => {\n          applyCrazyModeToPrompt(type, params, dryRun);\n        });\n\n        installCrazyGenerateHook();\n        setupSendButtonListener();\n        return;\n      }\n    };\n\n    // \n    setTimeout(setupOptionHideListener, 2000);\n\n    // [] \n    setTimeout(() => {\n      interceptTextareaValue();\n    }, 500);\n\n    // [] ERA\n    const eventOn = window.eventOn || window.parent?.eventOn;\n    if (typeof eventOn === 'function') {\n      eventOn('era:writeDone', detail => {\n        //  ERA \n        if (typeof MvuModule === 'object' && typeof MvuModule.clearCache === 'function') {\n          MvuModule.clearCache();\n        }\n\n        // ERA\n        const mode = MvuModule.detectMode();\n        if (mode === 'era' && getActiveTabState() === MvuModule.MODULE_ID) {\n          console.log('[DICE]ERA');\n          renderInterface();\n        }\n      });\n    } else {\n      console.warn('[DICE] ERA eventOn ');\n    }\n\n    // [] \n    $(window)\n      .off('beforeunload.acu pagehide.acu')\n      .on('beforeunload.acu pagehide.acu', () => {\n        try {\n          localStorage.setItem(STORAGE_KEY_SCROLL, JSON.stringify(tableScrollStates));\n          if (observer) {\n            observer.disconnect();\n            observer = null;\n          }\n        } catch (e) {}\n      });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  // window.testPairedTableFix()\n  window.testPairedTableFix = function () {\n    // \n    const prefix = 'AM';\n    const startFrom = 1;\n    const columnName = '';\n\n    // 1AM0001, AM0002, (), AM0030, ()\n    // AM0001, AM0002, AM0030\n    const table1Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        ['AM0001', '1', '1'],\n        ['AM0002', '2', '2'],\n        [null, '3-', '3-'], // \n        ['AM0030', '4', '4'],\n        [null, '5-', '5-'], // \n      ],\n    };\n\n    // 2(), AM0002, AM0030, AM0040, AM0050\n    // AM0002, AM0030, AM0040, AM0050\n    const table2Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        [null, 'A-', 'A-'], // \n        ['AM0002', 'B', 'B'],\n        ['AM0030', 'C', 'C'],\n        ['AM0040', 'D', 'D'],\n        ['AM0050', 'E', 'E'],\n      ],\n    };\n\n    // \n    const extract1 = extractCodesFromTable(table1Sheet, columnName, prefix);\n    const extract2 = extractCodesFromTable(table2Sheet, columnName, prefix);\n\n    // \n    const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n    // \n    const rawData = {};\n    const result = alignAndFixPairedTables(\n      table1Sheet,\n      'sheet1',\n      table2Sheet,\n      'sheet2',\n      columnName,\n      mapping,\n      prefix,\n      startFrom,\n      rawData,\n    );\n\n    // \n    const getValidCodes = sheet =>\n      sheet.content\n        .slice(1)\n        .map(r => r[0])\n        .filter(c => c && String(c).match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\d+$`)));\n\n    const codes1 = getValidCodes(table1Sheet);\n    const codes2 = getValidCodes(table2Sheet);\n\n    // \n    const emptyRows1 = table1Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\d+$`)));\n    const emptyRows2 = table2Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\d+$`)));\n\n    // \n    const validateSequence = (codes, prefix, startFrom) => {\n      const numbers = codes\n        .map(c => {\n          if (!c) return null;\n          const match = c.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          return match ? parseInt(match[1], 10) : null;\n        })\n        .filter(n => n !== null);\n\n      for (let i = 0; i < numbers.length; i++) {\n        if (numbers[i] !== startFrom + i) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    const isValid1 = validateSequence(codes1, prefix, startFrom);\n    const isValid2 = validateSequence(codes2, prefix, startFrom);\n\n    // \n    const set1 = new Set(codes1);\n    const set2 = new Set(codes2);\n    const setsEqual = set1.size === set2.size && [...set1].every(c => set2.has(c));\n\n    // \n    const emptyRowsPreserved1 = emptyRows1.some(r => r[1] && r[1].includes(''));\n    const emptyRowsPreserved2 = emptyRows2.some(r => r[1] && r[1].includes(''));\n\n    return {\n      table1Sheet,\n      table2Sheet,\n      result,\n      codes1,\n      codes2,\n      emptyRows1,\n      emptyRows2,\n      isValid1,\n      isValid2,\n      setsEqual,\n      emptyRowsPreserved1,\n      emptyRowsPreserved2,\n      //  +  + \n      isValid: isValid1 && isValid2 && setsEqual && emptyRowsPreserved1 && emptyRowsPreserved2,\n    };\n  };\n\n  // \n  window.diagnoseDiceVariables = async function () {\n    if (typeof MvuModule !== 'undefined' && typeof MvuModule.diagnoseVariableFramework === 'function') {\n      return await MvuModule.diagnoseVariableFramework();\n    } else {\n      console.error('[DICE]MvuModule ');\n      return null;\n    }\n  };\n\n  const { $ } = getCore();\n  if ($) $(document).ready(init);\n  else window.addEventListener('load', init);\n})();\n"],"names":["EMOJI_MAP","LOCATION_EMOJI_MAP","ELEMENT_EMOJI_MAP","SCRIPT_ID","LockManager","STORAGE_KEY_PREFIX","MAX_CONTEXTS","PRIMARY_KEYS","_cache","_currentContextId","_getStorageKey","ctxId","this","getCurrentContextFingerprint","_cleanupOldContexts","prefix","allKeys","i","localStorage","length","key","startsWith","push","keyWithTime","map","data","JSON","parse","getItem","time","_lastAccess","sort","a","b","toDelete","slice","forEach","item","removeItem","console","log","e","warn","_load","stored","_save","dataToSave","Date","now","setItem","stringify","getRowKey","tableName","row","headers","pkField","fieldIndex","idx","indexOf","lockField","rowKey","fieldName","value","_fullRow","_fields","_snapshot","lockRow","rowData","snapshot","h","unlockField","lock","Object","keys","unlockRow","isFieldLocked","hasOwnProperty","isRowLocked","applyLocks","tableContent","tableLocks","modified","restored","rowIndex","entries","undefined","newRow","_rebuildRow","fields","field","colIdx","Array","fill","hasAnyLock","getLockedFields","clearCurrentContext","BookmarkManager","isBookmarked","toggleBookmark","getBookmarks","escapeHtml","s","String","replace","setupOverlayClose","$overlay","overlayClass","onClose","window","navigator","maxTouchPoints","on","$","target","hasClass","mouseDownOnOverlay","showPresetConflictDialog","options","getCore","remove","getThemeColors","config","getConfig","suggestedName","baseName","existingNames","includes","counter","newName","generateUniqueName","presetName","$dialog","theme","presetType","append","style","cssText","closeDialog","find","click","onCancel","mode","val","onOverwrite","onRename","smartInsertToTextarea","newContent","contentType","$ta","currentVal","trim","normalDiceRegex","contestDiceRegex","actionRegex","placeholderRegex","diceCfg","getDiceConfig","contentToInsert","shouldSaveOriginal","hideDiceResultFromUser","trigger","textarea","_acuOriginalDiceText","_acuHasDiceData","workingText","existingAction","existingDice","existingDiceOriginal","test","originalText","contestMatches","match","normalMatches","actionMatches","userInput","parts","finalVal","join","restoreDiceResultBeforeSend","restoredVal","removeData","interceptTextareaValue","_acuValueIntercepted","originalDescriptor","getOwnPropertyDescriptor","HTMLTextAreaElement","prototype","originalValue","defineProperty","get","call","_value","set","configurable","STORAGE_KEY_TABLE_ORDER","STORAGE_KEY_ACTIVE_TAB","STORAGE_KEY_UI_CONFIG","STORAGE_KEY_LAST_SNAPSHOT","STORAGE_KEY_IS_COLLAPSED","STORAGE_KEY_OPTIONS_COLLAPSED","STORAGE_KEY_DASHBOARD_ACTIVE","STORAGE_KEY_TABLE_HEIGHTS","STORAGE_KEY_TABLE_STYLES","STORAGE_KEY_HIDDEN_TABLES","STORAGE_KEY_REVERSE_TABLES","MIN_PANEL_HEIGHT","MAX_PANEL_HEIGHT","STORAGE_KEY_DICE_CONFIG","STORAGE_KEY_ATTRIBUTE_PRESETS","STORAGE_KEY_ACTIVE_ATTR_PRESET","STORAGE_KEY_ACTION_PRESETS","STORAGE_KEY_ACTIVE_ACTION_PRESET","STORAGE_KEY_CRAZY_MODE","DEFAULT_CRAZY_MODE_CONFIG","enabled","crazyLevel","playerWeight","inSceneNpcWeight","offSceneNpcWeight","PRESET_FORMAT_VERSION","compareVersion","v1","v2","normalizeVersion","v","nv1","nv2","parts1","split","Number","parts2","Math","max","p1","p2","STORAGE_KEY_AVATAR_MAP","STORAGE_KEY_MAP_FOCUS","ConsoleCaptureManager","logs","maxLogs","filters","info","error","originalMethods","isIntercepted","restore","enable","intercept","disable","emergencyBtn","document","getElementById","display","type","self","args","apply","capture","timestamp","timeStr","toLocaleTimeString","hour12","content","arg","stack","Error","logEntry","id","random","rawArgs","shift","clear","getFilteredLogs","filter","setFilters","ErrorHandler","errorCount","errorThreshold","lastErrorTime","errorWindow","fatalErrorDetected","isFatalError","source","lineno","colno","thirdPartyPatterns","errorInfo","errorSource","pattern","corePatterns","isCoreError","handleError","triggerFatalError","showEmergencyButton","btn","createElement","innerHTML","onmouseenter","background","transform","onmouseleave","onclick","showDebugConsoleModal","alert","body","appendChild","checkAndRestore","onerror","message","addEventListener","event","reason","STORAGE_KEY_REGEX_RULES","STORAGE_KEY_REGEX_PRESETS","STORAGE_KEY_REGEX_ACTIVE_PRESET","STORAGE_KEY_REGEX_ENABLED","STORAGE_KEY_VALIDATION_ENABLED","STORAGE_KEY_VALIDATION_MODE","RULE_TYPE_INFO","tableReadonly","name","scope","icon","desc","rowLimit","sequence","required","format","enum","numeric","relation","keyValue","BUILTIN_VALIDATION_RULES","description","builtin","targetTable","targetColumn","ruleType","startFrom","errorMessage","values","min","refTable","refColumn","valueType","valueMin","valueMax","STORAGE_KEY_BLACKLIST","STORAGE_KEY_BLACKLIST_VERSION","DEFAULT_BLACKLIST","BlacklistManager","getBlacklist","Store","storedVersion","isArray","Set","defaultItems","mergedItems","has","setBlacklist","list","resetToDefault","isBlacklisted","blacklist","lastPart","some","STORAGE_KEY_PRESETS","STORAGE_KEY_ACTIVE_PRESET","PresetManager","getAllPresets","_initDefaultPreset","needsSave","preset","version","_compareVersion","customRules","rules","r","builtinRuleIds","mergedRules","rule","ValidationRuleManager","clearCache","getActivePreset","presets","activeId","p","setActivePreset","createPreset","newPreset","createdAt","toISOString","duplicatePreset","deletePreset","filtered","updatePresetRules","exportPreset","mergePresetWithDefaults","presetId","builtinRuleMap","Map","processedCustomIds","newRule","existingRule","add","importPreset","json","autoMerge","importedVersion","needsMerge","_getBuiltinRulesVersion","rulesStr","hash","charCodeAt","toString","currentVersion","defaultPreset","_builtinVersion","oldCustom","resetDefaultPreset","_enabledCache","getAllRules","enabledStates","getEnabledStates","allRules","toggleRuleEnabled","ruleId","states","toggleRuleIntercept","getEnabledRules","addCustomRule","removeCustomRule","index","findIndex","splice","updateCustomRule","updates","getRule","getRulesByTable","RegexTransformationManager","_generateId","substr","_saveEnabledStates","getApplicableRules","columnName","tableNames","columnNames","priority","operation","flags","replacement","executeMode","testCases","security","maxMatchTime","maxMatches","maxInputLength","updatedAt","_syncRulesToActivePreset","activePreset","RegexPresetManager","removeRule","updateRule","sourcePresetId","sourcePreset","exportData","jsonString","RegexTransformationEngine","_regexCache","_buildFlags","result","caseInsensitive","global","multiline","unicode","sticky","_getRegex","hasLookbehind","hasLookahead","flagsStr","cacheKey","regex","lastIndex","RegExp","_scoreRegexComplexity","score","captureGroups","_getTimeoutForRule","complexity","baseTimeout","_safeReplace","oldValue","success","newValue","matched","timeout","startTime","elapsed","applyToValue","strValue","extracted","_extractFlags","patternWithoutFlags","patternStr","inlineFlagMatch","flagStr","applyToTable","tableData","totalApplied","errors","isSimpleFormat","sheetMap","simpleTable","sheet","sheetKey","contentRowIndex","dataObj","size","tableInfo","rows","colIndex","debug","tableError","errorMsg","applyToCell","applicableRules","currentValue","wasMatched","applyToRow","cell","previewBatchTransform","results","affectedCells","totalAffected","columnIndex","clearRegexCache","ValidationEngine","validateFormat","validateEnum","allowedValues","validateNumeric","strVal","numVal","endsWith","parseFloat","isNaN","validateRelation","rawData","refSheet","sheetId","columns","col","refColIndex","validateRequired","validateKeyValue","ruleConfig","processedValue","pairs","pair","colonIndex","substring","validateTableReadonly","oldContent","validateRowLimit","rowCount","validateSequence","numbers","allRowValues","rawValue","escapedPrefix","num","parseInt","n","expectedNum","checkTableRules","newData","violations","typeInfo","oldSheet","newSheet","padStart","rowIdx","validateValue","validateRow","rowTitle","ruleName","severity","validateAllData","allErrors","tableRules","fieldRules","rowErrors","validateTable","targetSheet","groupErrorsByTable","grouped","getErrorCount","LocalAvatarDB","DB_NAME","STORE_NAME","DB_VERSION","_db","_urlCache","init","Promise","resolve","reject","request","indexedDB","open","onsuccess","onupgradeneeded","db","objectStoreNames","contains","createObjectStore","keyPath","save","blob","store","transaction","objectStore","URL","revokeObjectURL","delete","put","url","createObjectURL","getKey","getAllNames","getAllKeys","getStats","getAll","items","totalSize","reduce","sum","count","totalSizeMB","toFixed","clearAll","FavoritesDB","update","existing","updated","getAllTags","tagSet","tags","tag","from","getByTag","FavoritesManager","addFavorite","tableUid","header","chatId","SillyTavern","getCurrentChatId","crypto","randomUUID","sourceInfo","updateFavorite","duplicateFavorite","original","copy","deleteFavorite","addTag","removeTag","async","findCompatibleTables","favorite","currentTables","uid","table","tableHeader","isStrict","every","matchedCols","unmatchedCols","matchRatio","mapRowToTable","targetHeader","srcIndex","exportFavorites","exportedAt","importFavorites","jsonStr","added","newItem","getPlayerName","cachedRawData","getTableData","getPersonaName","w","parent","getContext","ctx","name1","jQuery","$persona","first","text","getDisplayPlayerName","replaceUserPlaceholders","displayName","AvatarManager","load","raw","offsetX","offsetY","scale","aliases","getAsync","playerName","isPlayer","localUrl","userLocalUrl","primaryName","getPrimaryName","aliasLocalUrl","hasLocalAvatar","getOffsetX","_resolveByAlias","getOffsetY","getScale","setPosition","setScale","setAliases","exportTime","avatars","importData","jsonData","overwriteConflicts","current","stats","skipped","imported","analyzeImport","valid","total","newItems","conflicts","getEmojiCandidates","candidates","emoji","getElementEmoji","MvuModule","MODULE_ID","cachedEraData","detectMode","_source","eventEmit","eventOn","Mvu","getMvuData","getEraData","timeoutId","setTimeout","eventOff","onResult","detail","clearTimeout","statData","statWithoutMeta","stat_data","delta_data","schema","isAvailable","getData","allVars","message_id","display_data","getMvuDataWithRetry","maxRetries","retryDelay","race","waitGlobalInitialized","_","attempt","isVWD","isSimpleArray","countChildren","k","extractNumericDisplayValue","str","rangeMatch","slashNumericMatch","commaDescMatch","numericDescMatch","extractFirstNumericValue","displayValue","renderRow","path","deltaData","changeIndicator","part","oldVal","newVal","getChangeIndicator","changedClass","valueClass","diceIconHtml","isNumericCell","numericValue","attrName","pathParts","renderCard","depth","defaultExpanded","isHorizontal","childCount","collapsedClass","bodyHtml","hasNestedCards","nestedCardCount","childKey","childValue","childPath","itemPath","countText","bodyClass","nestedCardsNeedWidth","getDataWithRetry","detection","eraData","mvuData","detectModeWithData","diagnoseVariableFramework","era","available","dataAvailable","mvu","apiExists","getDataExists","cache","hasCache","cacheKeys","recommendation","injectStyles","targetDoc","styleEl","textContent","head","renderNavButton","isActive","renderPanel","isEraMode","isNumericMode","layoutMode","panelTitle","numericHtml","visibleLevels","saved","numericItems","collectNumericItems","obj","levelNames","itemValue","numValue","newLevelNames","topKeys","filteredNumericItems","lastLevelKey","nonArrayLevels","level","allLevelNames","levelNamesArray","levelTogglesHtml","buttonTextColor","buttonTextOnAccent","textMain","levelButtonsHtml","levelName","isVisible","activeStyle","itemsHtml","pathLevels","hierarchyLevels","allLevelsVisible","pathDisplay","finalAttrName","displayStyle","levelsJson","renderNumericMode","cardsHtml","bindEvents","$container","$panel","off","stopPropagation","$card","closest","$body","is","hide","removeClass","addClass","slideDown","slideUp","refresh","newMode","saveActiveTabState","currentTab","getActiveTabState","renderInterface","toastr","toggleClass","$button","css","color","borderColor","opacity","attr","each","$item","levels","newPathDisplay","$value","showEditDialog","setValue","preventDefault","$icon","attrValue","showDicePanel","targetValue","targetName","initiatorName","fromMvu","parsedInfo","initiator","filteredParts","parseMvuPathForDice","mvuPath","mvuParsedInfo","$doc","touchStartX","touchStartY","isHorizontalSwipe","originalEvent","touches","clientX","clientY","touch","deltaX","abs","deltaY","stopImmediatePropagation","$input","focus","button","handle","setPointerCapture","pointerId","startHeight","height","startY","onpointermove","moveE","dy","newHeight","onpointerup","upE","releasePointerCapture","getTableHeights","saveTableHeights","heights","onSave","html","select","ctrlKey","parsedValue","onWriteDone","setEraValue","setMvuVariable","is_recursive","replaceMvuData","isModuleTab","$refreshBtn","then","actualData","warning","catch","err","DEFAULT_DICE_CONFIG","critSuccessMax","hardSuccessDiv","difficultSuccessDiv","critFailMin","lastDiceType","dndCritSuccess","dndCritFail","contestTieRule","hideDiceResultInChat","saveDiceConfig","cfg","oldCfg","newCfg","changedKeys","hideDiceResultsInUserMessages","hideInput","hideChat","textareaVal","modifiedText","contestRegex","normalRegex","lastMessageId","getLastMessageId","userMessages","getChatMessages","role","hiddenCount","msg","$msgElement","retrieveDisplayedMessage","$mesText","currentDomText","currentHtml","modifiedHtml","contestPattern","normalPattern","restoredCount","BUILTIN_ATTRIBUTE_PRESETS","baseAttributes","formula","range","modifier","specialAttributes","AttributePresetManager","presetVersion","finalId","updatePreset","exported","autoUpdate","needsUpdate","BUILTIN_ACTION_PRESETS","table_keywords","actions","label","template","ActionPresetManager","getPresetById","getActivePresetId","setActivePresetId","getCrazyModeConfig","saveCrazyModeConfig","shouldTriggerCrazyMode","selectCrazyParticipant","allTables","processJsonData","playerResult","DashboardDataParser","findTable","npcResult","playerAttrs","getFullAttributesForCharacter","attrs","inScene","weight","parseRows","npc","inSceneVal","toLowerCase","isInScene","npcAttrs","totalWeight","weightedRandomSelect","selectCrazyAttribute","participant","randomAttr","floor","allPresetAttrs","randomPresetAttr","defaultValue","skillPool","getRandomSkillPool","crazyRollD100","judgeCrazyRollResult","roll","generateCrazyRoll","contestChance","selectCrazyRollType","participant1","participant2","candidate","attr1","attr2","roll1","roll2","result1","result2","margin1","margin2","winner","rollDiceExpression","expr","NaN","countStr","sidesStr","keepDrop","sides","rolls","rollDice","kd","evaluateFormula","context","varNames","Function","round","generateAttributeValue","DASHBOARD_TABLE_CONFIG","tableKeywords","detailLocation","keywords","fallbackIndex","currentLocation","player","status","position","isMultiple","money","resources","location","quest","progress","active","column","excludeColumn","excludes","bag","skill","equip","isEquipped","equipped","moduleKey","keyword","findColumnIndex","columnKey","moduleConfig","colConfig","kw","getValue","getColumnMap","colKey","tableResult","colMap","parsed","_rowIndex","_raw","applyFilter","parsedRows","filterKey","matchInclude","inc","excludeValue","matchExclude","exc","DEFAULT_GM_CONFIG","diceSystem","showDiceIcon","autoSendPrompt","action_groups","auto_send","THEME_COLORS","retro","bgPanel","border","textSub","btnBg","btnHover","accent","tableHead","successText","successBg","inputBg","inputText","placeholderText","btnActiveBg","btnActiveText","failureText","failureBg","warningText","warningBg","critSuccessText","critSuccessBg","critFailureText","critFailureBg","extremeSuccessText","extremeSuccessBg","overlayBg","overlayBgLight","shadowBg","lightBg","veryLightBg","buttonText","grayBg","errorText","errorBg","errorBorder","warningIcon","dark","modern","forest","ocean","cyber","buttonBg","buttonBgActive","presetButtonBg","presetButtonBgActive","nightowl","sakura","minepink","purple","wechat","educational","galgame","vaporwave","classicpackaging","terminal","dreamcore","chouten","isLightTheme","getResultBadgeStyle","resultType","t","styles","critSuccess","bg","extremeSuccess","failure","critFailure","padding","ACTION_ICON_MAP","getActionsForTable","baseConfig","action_rules_disabled","customActionGroups","action","custom_action_groups","getGMConfig","lowerName","group","builtinRules","getInteractOptionsForRow","defaultActions","interactColIdx","invalidValues","cellValue","interactOptions","existingLabels","newActions","opt","extractNumericValue","matches","parseAttributeString","rawStr","jsonObj","parseRelationshipString","trimmed","colonMatch","parenMatch","isRelationshipCell","headerName","lowerHeader","processTemplate","cardData","ACTION_BUTTONS","title","isInitialized","isSaving","saveQueue","isEditingOrder","isSettingsOpen","currentDiffMap","observer","_boundRenderHandler","hasUnsavedChanges","pendingDeletions","getPendingDeletions","isAutoTransforming","tablePageStates","tableSearchStates","lastOptionHash","optionPanelVisible","STORAGE_KEY_SCROLL","tableScrollStates","UpdateController","_lastValidationCount","_isRollingBack","handleUpdate","loadSnapshot","api","getDB","fillTable","timeOut","positionClass","fillError","newCount","updateValidationIndicator","$indicator","show","DEFAULT_CONFIG","layout","collapseStyle","collapseAlign","fontFamily","cardWidth","fontSize","highlightNew","itemsPerPage","actionsPosition","gridColumns","positionMode","showOptionPanel","clickOptionToAutoSend","optionFontSize","FONTS","THEMES","_coreCache","core","AutoCardUpdaterAPI","clipboard","ST","top","updateSaveButtonState","$btn","deletions","hasDeletions","getIconForTableName","getBadgeStyle","def","retryErr","_acuQuotaAlerted","getSavedTableOrder","saveTableOrder","getCollapsedState","saveCollapsedState","getOptionsCollapsedState","currentCtx","_contextId","saveSnapshot","getTableStyles","getHiddenTables","getReverseTables","toggleTableReverse","getAttributesForCharacter","characterName","isUser","sheetName","nameColIdx","getAttributeValue","found","STANDARD_ATTRS","getStandardAttrs","allAttrs","allPresets","RANDOM_SKILL_POOL","generateRPGAttributes","isDNDOrPreset","isDND","generate3d6","generateValue","base","adjust","special","baseResult","specialResult","clearPresetAttributesForCharacter","charName","targetRowIndex","targetColIndex","existingStr","existingAttrs","standardAttrs","presetAttrNames","newAttrString","saveDataOnly","attrString","writeAttributesToCharacter","newAttrs","existingMap","standardCount","isComplete","customAttrs","resultParts","writtenAttrs","wasComplete","initCustomDropdown","themeColors","inputId","wrap","$dropdown","after","renderItems","lowerFilter","hideDropdown","addClearButton","inputSelector","$clearBtn","showDiceSettingsPanel","ruleTitle","resetText","defaults","critFail","hardDiv","extremeDiv","currentCritSuccess","currentCritFail","currentHardDiv","currentExtremeDiv","tieRule","cocExtraHtml","panelHtml","left","right","bottom","width","hover","closePanel","$stepper","step","updateValue","getCurrentValue","getStepperValue","critSuccessVal","critFailVal","hardDivVal","extremeDivVal","resetStepper","savedDiceType","rawDataForList","diceCharacterList","diceAttrList","diceType","successCriteria","initialAttrValue","initialTargetValue","inputTextColor","inputStyle","overlay","defaultCriteria","panel","buildAttrButtons","$parentSection","prop","originalHtml","originalHandler","generated","baseAttrs","specialAttrs","confirm","shortName","buildCharButtons","randomSkill","newAttrList","convertTargetForDice","currentTarget","fromDice","toDice","getMaxRoll","dice","fromMax","toMax","ratio","updateRuleMode","$targetInput","$difficultyWrapper","$row3","currentDiceType","newDice","suggestedCriteria","currentTargetVal","convertedVal","newMax","customDice","performDiceRoll","mod","modStr","isFinite","remaining","dicePattern","exec","diceResult","numberPattern","numMatch","parseModifier","criteria","difficulty","targetInputVal","attrInputVal","isAutoTarget","getDefaultTarget","formulaStr","maxRoll","finalValue","requiredTarget","difficultyLabel","difficultyDiv","isCritSuccess","isCritFailure","isSuccess","outcomeText","outcomeClass","extremeTarget","hardTarget","criteriaSymbol","displayOutcomeText","badgeStyle","badgeStyleStr","$rollBtn","judgeExpr","formulaText","attrValueInput","currentDice","initiatorNameVal","showContestPanel","initiatorValue","currentCriteria","opponentName","passedInitiatorName","passedInitiatorValue","passedOpponentValue","opponentValue","opponentAttrs","characterList","contestAttrList","attrStr","targetType","buildCharBtns","containerId","rebuildAttrBtns","aname","refreshedAttrs","initAttrs","oppAttrs","fullAttrs","getSuccessLevel","performContestRoll","initValue","initName","initAttrName","getHalfMax","m","initValueInput","initTarget","initTargetInput","oppValue","oppName","oppAttrName","oppValueInput","oppTarget","oppTargetInput","winnerColor","initResult","oppResult","initSuccess","oppSuccess","displayInitValue","displayOppValue","displayInitSuccessName","displayOppSuccessName","displayWinner","getResultTypeFromSuccess","initResultType","oppResultType","initBadgeStyle","oppBadgeStyle","winnerBadgeStyle","initBadgeStyleStr","oppBadgeStyleStr","winnerBadgeStyleStr","$resultDisplay","$resultInit","$resultOpp","$contestBtn","contestResultText","currentInitName","parseInSceneStatus","buildMapViewModel","globalResult","locationResult","elementResult","globalHeaders","globalRow","globalConfig","detailIdx","regionIdx","currentRegion","locations","locationHeaders","locationRows","locationNameIdx","locationRegionIdx","locationTypeIdx","locationDescIdx","locationImportanceIdx","locationExploreIdx","allLocationNames","emojiMap","names","candidatesMap","sortedNames","localeCompare","usedEmojis","resolveBatchLocationEmojis","region","locationType","importance","exploreStatus","tableKey","elements","elementHeaders","elementRows","elementNameIdx","elementTypeIdx","elementLocationIdx","elementDescIdx","elementStatusIdx","elementInteractIdx","locationName","rawInteractions","interactions","Boolean","typeValue","element","addElement","characters","addCharacter","character","avatarUrl","full","avatarOffsetX","avatarOffsetY","avatarScale","playerLocation","playerConfig","playerHeaders","playerRow","playerNameIdx","playerPosIdx","playerNameRaw","playerPosRaw","npcConfig","npcHeaders","npcRows","npcNameIdx","npcPosIdx","npcInSceneIdx","npcName","inSceneValue","inSceneHeader","firstLocation","next","allRegions","l","otherIndex","focusLocation","fallbackRegion","regionLocations","regionName","scoreA","getHotLocationsInRegion","isMapOpening","showMapVisualization","viewModel","tabSelectionCache","selectedRegion","targetLocation","overlayEl","setProperty","$focusArea","$thumbnails","renderElementChip","refreshPanel","model","leftChars","ceil","rightChars","leftElems","rightElems","renderAvatarHtml","char","avatarStyle","charAt","leftAvatarsHtml","rightAvatarsHtml","leftElemsHtml","rightElemsHtml","emojiHtml","renderFocusArea","thumbnails","totalCount","badgeHtml","renderThumbnailLocation","regions","newViewModel","newFocus","newRegion","regionLocs","loc","firstLoc","cachedLocation","hotLocations","fallbackFocus","targetRegion","showRelationshipGraph","npcTable","nameIdx","relationIdx","npcTableKey","nodes","edges","resolveName","personaName","isExplicitUserVariant","isPersonaName","isPlayerName","resolveUserPlaceholder","resolvedPlayerName","playerTableKey","x","y","inSceneColIdx","rawNpcName","relationStr","rel","resolvedRelName","relRowIndex","relIsInScene","ri","cleanedLabels","rawRel","commonRelations","specialSuffixMatch","lastChars","cleanRelation","existingEdge","combined","labelsFromSource","labelsFromTarget","nodeArr","connectionCount","node","edge","isMobileView","innerWidth","baseRadius","maxRadius","playerBaseRadius","radiusPerConnection","nodeSizeMultiplier","filterInScene","filterDirectOnly","getNodeRadius","nodeName","sqrt","radius","getLayoutCacheKey","loadLayoutCache","cached","layoutData","allNodesFound","vx","vy","runForceDirectedLayout","angle","PI","dist","cos","sin","nodeMap","iter","u","j","dx","distSq","force","fx","fy","maxSpeed","vMag","saveLayoutCache","panX","panY","$svg","$transform","$edgesGroup","$nodesGroup","$zoomDisplay","$nodeSizeDisplay","$wrapper","updateTransform","updateNodeSizeDisplay","zoomTo","newScale","centerX","centerY","oldScale","scaleChange","render","filteredNodes","directNodes","passInScene","passDirectOnly","getFilteredNodes","filteredNodeNames","filteredEdges","edgesHtml","edgeIdx","len","nx","ny","px","py","hasFromSource","hasFromTarget","sourceRadius","targetRadius","x1","y1","x2","y2","srcLabels","tgtLabels","srcSet","tgtSet","commonLabels","srcUnique","tgtUnique","markerStart","markerEnd","midX","midY","lineLen","lbl","offsetDir","offsetDist","safeOffset","relationEmojiMap","addRelationEmoji","truncateLabel","maxLen","truncated","labelsToShow","labelBaseX","labelBaseY","perpOffset","nodesHtml","nodeAvatar","indicatorRadius","indicatorOffset","inSceneIndicator","nodeDisplayName","scaleVal","foSize","shadowWidth","foOffset","highlightNode","connectedNodes","otherNode","connectedEdgeIndices","clearHighlight","matchMedia","currentHighlightedNode","$node","startX","hasMoved","longPressTriggered","longPressTimer","vibrate","rowName","tempNode","isPanning","panStartX","panStartY","panStartPanX","panStartPanY","lastPinchDist","activePointerId","wrapperEl","svgEl","onpointerdown","cursor","rect","getBoundingClientRect","onpointercancel","onwheel","delta","hypot","passive","newDist","$nodeSizeSlider","$sliderSizeDisplay","$sliderContainer","$nodeSizeDisplayTrigger","sliderVisible","sliderHideTimer","hideSlider","resetSliderHideTimer","triggerRect","wrapperRect","showSlider","$filterInSceneBtn","$filterDirectOnlyBtn","updateFilterToggleStyles","$nodeSizeStepper","updateNodeSizeValue","newPercent","getCurrentPercent","clearLayoutCache","showAvatarManager","closeGraph","showAvatarCropModal","imageSource","modalHtml","$modal","$image","containerEl","imageEl","updateImageStyle","backgroundSize","backgroundPosition","isDragging","startOffsetX","startOffsetY","sensitivity","pinchStartScale","pinchRatio","file","files","saveLocalAvatar","newUrl","onUpdate","resolveUserPlaceholderForAvatar","buildList","listHtml","userNode","otherNodes","userNodeForDisplay","currentUrl","hasLocal","displayUrl","sourceLabel","hasAvatar","managerHtml","$manager","bindAvatarEvents","refreshItem","$preview","aliasesStr","deleteLocalAvatar","Blob","href","download","removeChild","reader","FileReader","onload","evt","analysis","showImportConfirmDialog","readAsText","closeManager","showManualUpdateConfirmDialog","cacheNames","caches","urlPatterns","cacheName","requests","clearDiceSystemCache","reload","onComplete","hasConflicts","conflictListHtml","overwrite","showCardEditModal","displayRow","inputsHtml","dialog","adjustHeight","el","contentHeight","scrollHeight","overflowY","requestAnimationFrame","currentRow","hasChanges","saveRowInstantly","_configCache","saveConfig","applyConfigStyles","generateDiffMap","currentData","lastData","diffSet","rIdx","newRows","oldRows","oldRowMap","matchedOldIndices","matchedOldRow","oldRow","cIdx","oldCell","fontVal","f","$styleTag","fontImport","cssVars","cls","$optContainer","addStyles","_acuStylesInjected","exportTableAsJson","sheetCount","saveDataToDatabase","skipRender","commitDeletes","$saveBtn","mate","sizeInMB","stringifyError","importTableAsJson","apiError","acuModifiedSet","saveOperation","newRowData","tables","rawContent","exportConfig","updateConfig","refreshRegexRulesList","$rulesList","scopeIcon","scopeText","showAddValidationRuleModal","parentDialog","editRuleId","currentThemeClass","isEditMode","updateSelectColor","$select","$colSelect","$pairedTableSelect","currentPairedValue","empty","refTableName","$refColSelect","isTableRule","valuesStr","refColumns","selectedColumns","pairedTable","finalRuleId","ruleData","$existingItem","isEnabled","ruleHtml","showSmartFixModal","snapshotValue","hasSnapshotValue","showTableRuleFixModal","inputHtml","smartSuggestHtml","examples","currentRowIndex","maxCount","getColumnExamples","suggestedValue","existingValues","prefixMatch","digits","codeIndex","existingNumbers","codeValue","maxNum","nextNum","numOnlyMatch","suggestFormatValue","currentNum","isOutOfRange","nearestValid","getNearestValidNumber","getRelationOptions","hasMultipleColumns","currentInvalidValue","valueExists","isValueInRelationTable","optionsHtml","reverseWriteHtml","issues","fixedPairs","fixedVal","hasIssue","originalVal","fixedValue","hasIssues","issuesHtml","issue","optionValue","refSheetId","targetColIdx","extractCodesFromTable","codes","allCodes","codeToRows","isValid","buildCodeMapping","codes1","codes2","allUniqueCodes","codeNumbers","code","mapping","oldCode","newCode","alignAndFixPairedTables","table1Sheet","table1SheetId","table2Sheet","table2SheetId","fixedCount1","fixedCount2","headers1","rows1","colIndex1","headers2","rows2","colIndex2","reverseMapping","sortedNewCodes","analyzeTable","codeRows","emptyRows","prevOldCode","nextOldCode","emptyRow","prevCode","nextCode","codeRow","analysis1","analysis2","buildNewRows","allOldCodes","codeRowMap","cr","isCodeRow","isInserted","codeRowIndex","nextNewCode","currentNewCode","currentOldCode","newRows1","newRows2","countCodeChanges","oldAnalysis","oldCodes","newCodes","contentHtml","actionBtns","changeCount","changeDetails","c","d","minRows","maxRows","currentRowCount","excessRows","isTooMany","isTooFew","fixSuggestions","originalRowIndex","numCountMap","duplicates","gaps","outOfOrder","actualNum","rowNum","occurrences","issueSet","g","o","fix","pairedTableAttr","pairedTableName","targetSheetId","pairedSheet","pairedSheetId","pairedHeaders","extract1","extract2","fixedCount","startRow","showBlacklistManagerModal","updateTextarea","uniqueItems","syncFromTextarea","input","existingSet","addedItems","which","closeModal","showAttributePresetManager","isDefaultActive","allPresetsHtml","isBuiltin","showSettingsModal","$toggle","$thisToggle","showAttributePresetEditor","filename","parsedData","importingName","existingPresets","hasConflict","doImport","finalJson","existingPreset","isEdit","defaultData","$jsonTextarea","updateJSON","showActionPresetManager","presetsHtml","keywordsSummary","flatMap","actionsSummary","showActionPresetEditor","writeText","ta","execCommand","copyData","prompt","not","savedFilters","renderLogs","filteredLogs","$logContainer","typeColors","typeIcons","logItem","updateCounts","checked","$status","newState","line","toUpperCase","TavernHelper","triggerSlash","safeContent","isSecureContext","textArea","setAttribute","setSelectionRange","successful","refreshInterval","setInterval","clearInterval","showAddRegexRuleModal","editRule","scopeType","$textarea","extractedFlags","$flagGlobal","$flagIgnoreCase","$flagMultiline","uiFlags","finalPattern","finalFlags","AcuDiceAPI","breakdown","check","attribute","rollResult","finalRoll","criticalSuccess","criticalFailure","hardSuccess","margin","onReady","callback","handler","writable","showFavoriteEditModal","fav","overlayHtml","newRowHtml","newHeader","newTags","showSendToTableModal","compatible","onSuccess","tableListHtml","modeLabel","unmatchedInfo","unmatchedCount","expandedGroups","isGroupExpanded","groupId","SPECIAL_BUTTONS_CONFIG","tableManagerHtml","savedOrder","hiddenList","allItems","isSpecial","orderMap","isHidden","specialClass","chevron","hasIntercept","$group","$chevron","expanded","targetHeight","animate","currentHeight","outerHeight","newTheme","crazyConfig","selectValue","initCrazyModeUI","$list","dragState","timer","clearDragState","startDrag","targetItem","insertBefore","$dragged","$target","insertAfter","newOrder","unit","isCurrentlyActive","fadeOut","refreshPresetUI","accept","onchange","currentState","currentPreset","$presetSelect","defaultPresetId","tavernRegexList","scriptName","findRegex","importedCount","skippedCount","processNext","convertedRule","tavernRegex","parseTavernFindRegex","extraInfo","placement","markdownOnly","promptOnly","minDepth","maxDepth","replaceString","disabled","runOnEdit","convertTavernRegexToRule","oldRule","renderInterfaceTimer","renderInterfacePending","_renderInterfaceImpl","$chat","mutationLock","MutationObserver","lastChild","children","last","wrapper","observe","childList","isDataFromDatabase","anyLockApplied","enabledRules","transformResult","transformError","structuredClone","existingSnapshot","hasValidSnapshotData","$searchInput","activeTab","currentTabName","newHtml","renderTableContent","$virtualDom","replaceWith","bindOptionEvents","lastScrollX","lastScrollY","$oldContent","scrollLeft","scrollTop","orderedNames","concat","isCollapsed","layoutClass","finalGridCols","empty3","optionHtml","currentOptionHash","optionTables","isOptionsCollapsed","collapseIcon","optionCount","hasBtns","optionValues","buttonsHtml","cellStr","encodeURIComponent","optionChanged","colStyleClass","alignClass","savedHeight","isDashboardActive","isChangesPanelActive","isMvuActive","finalSavedHeight","renderChangesPanel","renderDashboard","gridFixStyle","isChangesActive","isFavoritesActive","isSimpleModeNav","changesCount","validationErrorCount","oldRowsByTitle","queue","hasChange","newTitleCounts","oldTitleCounts","oldCount","emptyOldCount","emptyNewCount","displayCount","showWarningIcon","navHiddenList","navSavedOrder","SPECIAL_NAV_ITEMS","extraClass","allNavItems","checkAvailable","activeClass","orderVal","warningIconHtml","$existing","insertHtmlToPage","injectIndependentOptions","bindChangesEvents","$newContent","savedState","inner","$targetTitle","htmlContent","$aiMes","$this","$targetMes","$targetText","$targetBlock","getTargetContainer","optConfig","decodeURIComponent","createChatMessages","executeSlashCommandsWithOptions","cmd","sendResult","isError","isAborted","sendBtn","enterEvent","Event","keyCode","bubbles","$textDiv","hasImage","targetIndex","eq","$oldWrapper","validationErrors","changes","oldRowIndex","rowChanges","changedFields","processedTitles","deletedCount","isValidationMode","groupedErrors","collapsedGroups","tableErrors","groupedChanges","tableChanges","change","oldShort","newShort","fieldDisplay","fieldCount","fieldNames","moreText","validationItemTouchStartPos","$targetCard","scrollIntoView","behavior","block","storageKey","changeType","refreshChangesPanel","restoredRow","showRowCompareEditModal","showChangeSingleFieldModal","showChangeEditModal","restoredData","updateChangesCount","finalHeight","$horizontalScroller","_touchStartX","_touchStartY","_scrollDirection","$span","hasOldValue","fieldsHtml","isChanged","questResult","bagResult","skillResult","equipResult","playerParsed","allAttrsStr","playerRows","globalDetailLocation","globalLocation","locIdx","currentPlaceName","npcTableName","npcParsed","inSceneNPCs","offSceneNPCs","npcData","allNPCs","questTableName","questParsed","activeQuestParsed","questTypeOrder","activeTasks","q","bagTableName","bagParsed","bagItems","skillTableName","skillParsed","skills","equipTableName","equipParsed","equippedItems","locationTableName","locationTableKey","locationParsed","resourcesStr","parsedResources","res","skillValue","hasNumeric","skillRowIndex","areaName","isCurrent","npcIdx","isLastNpc","npcAvatar","offSceneFilter","isLastBag","isLast","isMain","progressPercent","progressMatch","progressBar","loadedModules","renderFavoritesPanel","allFavorites","allTags","groupedByTag","untagged","renderFavoriteCard","rowsHtml","tagsHtml","bindFavoritesEvents","panelEl","_favSwipeFixApplied","onTouchStart","onTouchMove","onTouchEnd","removeEventListener","$dataArea","toggle","groupTitle","debounce","searchTerm","cardText","showFavCardMenu","cardId","backdrop","menu","winWidth","winHeight","mWidth","outerWidth","mHeight","posX","posY","getById","existingMenu","isGridMode","titleColIndex","processedRows","originalIndex","isReversed","isTableReversed","titleA","titleB","aHitTitle","bHitTitle","totalItems","totalPages","currentPage","startIdx","endIdx","rowsToRender","showReverseBtn","shouldShowReverseButton","reverseBtnHtml","realRowIdx","cardTitle","showDefaultIndex","titleCellId","isTitleModified","isRowNew","rowClass","validColIndices","isOddValidCount","cardBody","spanFullRow","rawHeaderName","lockRowKey","inlineLockIcon","safeStr","rawStrOriginal","invalidPlaceholders","hideLabel","splitRegex","isIdentityField","parsedAttrs","displayCell","validRelations","relHtml","attrsHtml","showDice","invalidTagValues","isDiffChanged","cellId","isUserModified","cellHighlight","tableActions","actionsHtml","act","actIdx","cardLockRowKey","cardLockIcon","cardBookmarkRowKey","bookmarkIcon","saveCurrentTabState","$content","innerScrolls","switchPanel","updateContentFn","dataError","managerError","scrollTimer","$navBtn","isPanelVisible","mvuSavedHeight","currentActiveTab","$cell","showCellMenu","$pageBtn","newPage","manualUpdate","openSettings","searchTimeout","isComposing","selectionStart","selectionEnd","isFocus","activeElement","classList","$newInput","tName","actionIdx","$title","skillName","checkValue","attrValIdx","profIdx","promptText","sendMessage","ev","isPlayerTable","playerAttrValue","itemName","taskName","npcAttrValue","npcParts","npcMatch","relations","borderStyle","cardHtml","$previewOverlay","isModified","currentHeader","hasAnyLockInRow","lockMenuHtml","changedTouches","closeAll","fallbackCopy","rowDataValues","tagInput","$displayTarget","$panelContent","savedScrollTop","savedScrollLeft","$mapOverlay","isFromMap","refreshMapData","colCount","showConflictDialog","$conflictOverlay","extendedTimeOut","closeButton","preventDuplicates","hasVisualizerNav","hasVisualizerDataDisplay","scripts","querySelectorAll","script","visualizerConfig","diceConfig","detectVisualizerConflict","disconnect","eventSource","events","eventTypes","triggers","CHAT_CHANGED","MESSAGE_SWIPED","MESSAGE_DELETED","MESSAGE_UPDATED","_acuBoundChatChangeHandler","_boundChatChangeHandler","removeListener","loop","registerTableUpdateCallback","registerTableFillStartCallback","_acuInitRetries","hideOptionPanel","pendingCrazyAppend","lastCrazyPreSendAt","normalizeMessageId","messageId","hasDiceResultInText","insertDiceIntoUserInputBlock","blockRegex","blockMatch","suffix","trimmedInner","newInner","applyCrazyModeToPrompt","params","dryRun","safeParams","quietPrompt","quiet_prompt","automaticTrigger","automatic_trigger","_acu_crazy_applied","originalPrompt","crazyRollResult","finalPrompt","inserted","triggerCrazyModeBeforeSend","updatedValue","dispatchEvent","queueCrazyAppend","applyCrazyAppend","pending","stChat","chat","stMsg","is_user","mes","extra","acuCrazyModeApplied","newMessage","setChatMessages","setupSendButtonListener","sendButton","onSendCapture","subtree","installCrazyGenerateHook","rootWindow","__acuCrazyGenerateHookInstalled","generate","__acuCrazyGenerateOriginal","injects","user_input","mergedPrompt","evtName","MESSAGE_SENT","tavern_events","afterCommandsEvtName","GENERATION_AFTER_COMMANDS","testPairedTableFix","getValidCodes","emptyRows1","emptyRows2","isValid1","isValid2","set1","set2","setsEqual","emptyRowsPreserved1","emptyRowsPreserved2","diagnoseDiceVariables","ready"],"ignoreList":[],"sourceRoot":""}