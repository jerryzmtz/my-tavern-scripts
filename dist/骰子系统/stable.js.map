{"version":3,"file":"stable.js","mappings":"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ACvB,MAAMrG,EAA2B,iBAATqG,EAAoBA,EAAOA,GAAQA,EAAKt2B,KAC5DiwB,GACFuhB,EAASl7B,IAAI2Z,KAMf9a,EAAE4oB,mBAAqBv9B,MAAMC,QAAQ0U,EAAE4oB,oBACzC5oB,EAAE4oB,kBAAkBl/B,QAAQy3B,IAC1B,MAAMrG,EAA2B,iBAATqG,EAAoBA,EAAOA,GAAQA,EAAKt2B,KAC5DiwB,GACFuhB,EAASl7B,IAAI2Z,QAOhBzvB,MAAMwkB,KAAKwsB,EACpB,CAAE,MAAOtW,GAEP,OADAj7B,QAAQgM,MAAM,mCAAoCivB,GAC3CwW,IAAqB,EAC9B,GAIIA,GAAoB,CAExB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KAEA,OACA,OACA,OACA,MACA,SACA,OACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,MACA,KACA,MAGA,MACA,KACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,MACA,MACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,KACA,SACA,KACA,KAGA,KACA,MACA,QACA,MACA,KACA,KACA,KACA,MACA,MACA,MACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,MACA,KACA,QACA,KACA,KACA,KACA,MACA,KACA,OACA,OACA,KACA,KACA,KACA,K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","sources":["src://tavern_helper_template/src//emoji-maps.ts","src://tavern_helper_template/src//database-ui-override.ts","src://tavern_helper_template/src//index.ts"],"sourcesContent":["/**\n * \n * \n *\n * \n * - fa:xxx   Font Awesome \n * - ti:xxx   Tabler Icons \n * - emoji  \n *\n * \n * 1. \"\"\"\"\n * 2. \"\"\"|\"\n * 3. \"\"\"|\"\n * 4. \"\"\"\"\n * 5. //\n */\nexport const EMOJI_MAP: [RegExp, string][] = [\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'ti:soup'],\n  [/ring|livehouse/, 'fa:guitar'],\n  [//, 'ti:plant'],\n  [//, 'ti:lemon'],\n  [//, 'fa:scroll'],\n  [//, 'fa:guitar'],\n  [//, 'ti:apple'],\n  [//, 'ti:salad'],\n  [//, 'ti:cup'],\n  [//, 'fa:music'],\n  [//, 'ti:lemon'],\n  [//, 'fa:volume-high'],\n  [//, 'fa:compact-disc'],\n  [//, 'fa:glasses'],\n  [//, 'ti:shirt'],\n  [//, 'fa:utensils'],\n  [//, 'fa:pencil'],\n  [//, 'ti:plant'],\n  [//, 'ti:ice-cream'],\n  [//, 'fa:apple-whole'],\n  [//, 'ti:cookie'],\n  [/|/, 'fa:palette'],\n  [/t/, 'ti:shirt'],\n  [//, 'fa:microphone'],\n  [//, 'ti:wind'],\n  [//, 'ti:apple'],\n  [//, 'fa:palette'],\n  [//, 'ti:shirt'],\n  [//, 'ti:brush'],\n  [/|/, 'fa:ribbon'],\n  [//, 'ti:palm'],\n\n  // ============================================\n  // \n  // ============================================\n  [/||/, 'fa:couch'],\n  [//, 'ti:escalator'],\n  [/||/, 'ti:armchair'],\n  [//, 'fa:chair'],\n  [/|/, 'ti:flower'],\n  [//, 'fa:book'],\n  [/|/, 'fa:monument'],\n  [//, 'fa:bed'],\n  [/|/, 'ti:flame'],\n  [//, 'ti:pool'],\n  [//, 'ti:home'],\n  [//, 'fa:hammer'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:floppy-disk'],\n  [/|/, 'fa:door-open'],\n  [/||/, 'ti:alert-triangle'],\n  [/||/, 'fa:gamepad'],\n  [/||/, 'fa:fire'],\n  [/|||/, 'ti:certificate'],\n  [//, 'ti:candle'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:plane'],\n  [/|/, 'fa:cable-car'],\n  [/|||/, 'fa:train'],\n  [/|/, 'fa:square-parking'],\n  [/||/, 'fa:road'],\n  [/||/, 'fa:bus'],\n  [//, 'fa:bus-simple'],\n\n  // ============================================\n  // \n  // ============================================\n  [//, 'ti:chef-hat'],\n  [//, 'fa:shower'],\n  [//, 'fa:bath'],\n  [/||/, 'fa:toilet'],\n  [/||/, 'ti:telescope'],\n  [/|/, 'ti:stairs-down'],\n  [/|/, 'fa:arrow-down'],\n  [//, 'fa:book-open'],\n  [/||/, 'fa:couch'],\n  [//, 'fa:ribbon'],\n  [//, 'fa:building-columns'],\n  [//, 'fa:users'],\n  [//, 'fa:music'],\n  [//, 'fa:masks-theater'],\n  [/|/, 'ti:ripple'],\n\n  // ============================================\n  // \n  // ============================================\n  [/||/, 'fa:film'],\n  [/|/, 'fa:gavel'],\n  [//, 'fa:shield-halved'],\n  [/|/, 'fa:bag-shopping'],\n  [/|/, 'ti:bath'],\n  [/||/, 'ti:cards'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:flask'],\n  [//, 'fa:hospital'],\n  [/|/, 'fa:industry'],\n  [/|/, 'fa:building-shield'],\n  [/|||/, 'fa:scale-balanced'],\n  [/|||||/, 'fa:handcuffs'],\n  [/||/, 'fa:folder'],\n  [/|/, 'fa:rocket'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:umbrella-beach'],\n  [/||/, 'fa:snowflake'],\n  [/|/, 'fa:volcano'],\n  [//, 'fa:water'],\n  [/|/, 'ti:cactus'],\n  [//, 'fa:water'],\n  [//, 'ti:fish'],\n  [/|/, 'ti:droplet'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:crown'],\n  [/|/, 'ti:horse'],\n  [//, 'ti:building-castle'],\n  [/||/, 'ti:grave'],\n  [/|/, 'ti:spider'],\n  [/|/, 'fa:swords'],\n\n  // ============================================\n  // //\n  // ============================================\n  // \n  [/|/, 'fa:mountain'],\n  [/|/, 'ti:topology-star-3'],\n  [/|/, 'fa:pills'],\n  [/|/, 'ti:flask'],\n  [/|/, 'ti:hexagon'],\n  [/|/, 'fa:mountain-sun'],\n  [/|/, 'fa:bolt'],\n  [/|/, 'ti:sword'],\n  [/|/, 'fa:swords'],\n\n  // \n  [/|/, 'ti:wand'],\n  [/|/, 'ti:flask'],\n  [/|/, 'ti:wand'],\n  [/|/, 'fa:book-open'],\n\n  // \n  [/|/, 'ti:ripple'],\n  [/|/, 'fa:book-skull'],\n  [/|/, 'ti:candle'],\n  [/||/, 'fa:eye'],\n\n  // \n  [//, 'ti:robot'],\n  [//, 'ti:device-projector'],\n  [/|/, 'fa:server'],\n  [/|/, 'fa:microchip'],\n  [/scp||/, 'fa:shield-halved'],\n  [//, 'fa:gear'],\n\n  // \n  [//, 'ti:air-balloon'],\n  [//, 'fa:gears'],\n  [/|/, 'ti:flask'],\n  [//, 'ti:clock'],\n\n  // \n  [//, 'fa:house-crack'],\n  [//, 'fa:radiation'],\n  [/|/, 'ti:home-off'],\n  [//, 'fa:recycle'],\n  [/|/, 'fa:biohazard'],\n\n  // \n  [/|/, 'fa:rocket'],\n  [//, 'fa:satellite'],\n  [/|/, 'fa:circle-notch'],\n  [//, 'ti:alien'],\n\n  // \n  [//, 'fa:clone'],\n  [/|/, 'fa:scale-balanced'],\n  [/|/, 'fa:skull'],\n  [/|/, 'ti:candle'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'ti:snowflake'],\n  [/|/, 'ti:palm'],\n  [//, 'ti:plant'],\n  [//, 'ti:deer'],\n  [//, 'ti:cactus'],\n  [//, 'ti:flower'],\n  [/||/, 'fa:cloud'],\n  [/|/, 'fa:fire'],\n  [/|/, 'ti:mushroom'],\n\n  // ============================================\n  // \n  // ============================================\n  [//, 'fa:snowflake'],\n  [//, 'fa:tornado'],\n  [//, 'fa:tornado'],\n  [//, 'ti:meteor'],\n  [/|/, 'fa:moon'],\n  [/|/, 'fa:cloud-rain'],\n  [/|/, 'ti:stars'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:hammer'],\n  [//, 'ti:sparkles'],\n  [//, 'ti:tool'],\n  [//, 'ti:flask'],\n  [//, 'ti:beer'],\n  [//, 'ti:needle'],\n  [/|/, 'ti:horse'],\n\n  // ============================================\n  //  (///)\n  // ============================================\n  // []\n  [/|||/, 'fa:key'],\n  [/|||/, 'fa:file-lines'],\n  [/||/, 'fa:magnifying-glass'],\n  [/||/, 'fa:id-card'],\n\n  // []\n  [/|||/, 'fa:skull'],\n  [/|/, 'fa:explosion'],\n  [/|/, 'ti:paw'],\n  [/|/, 'fa:skull'],\n\n  // []\n  [/|||/, 'fa:user-tie'],\n  [/||/, 'fa:user'],\n  [/|/, 'fa:shop'],\n\n  // []\n  [/||/, 'fa:monument'],\n  [/||/, 'fa:gears'],\n  [/|/, 'fa:dungeon'],\n  [/|/, 'fa:door-open'],\n\n  // ============================================\n  //  ()\n  // ============================================\n  [/|/, 'fa:fire'],\n  [/|/, 'fa:droplet'],\n  [/|/, 'fa:wind'],\n  [//, 'fa:mountain'],\n  [//, 'fa:bolt'],\n  [/|/, 'ti:sparkles'],\n  [/|/, 'fa:moon'],\n  [//, 'ti:clock'],\n\n  // ============================================\n  // \n  // ============================================\n  [//, 'ti:flower'],\n  [/|/, 'ti:leaf'],\n  [/|/, 'ti:flower'],\n  [//, 'ti:flower'],\n  [//, 'ti:flower'],\n  [//, 'ti:butterfly'],\n  [//, 'ti:bug'],\n  [//, 'ti:bat'],\n  [/|/, 'ti:feather'],\n  [/|/, 'fa:fire'],\n  [//, 'ti:feather'],\n  [//, 'ti:cat'],\n  [//, 'ti:deer'],\n\n  // ============================================\n  // \n  // ============================================\n  [/boss||/, 'ti:skull'],\n  [/|||/, 'fa:skull'],\n  [//, 'ti:paw'],\n  [/|/, 'fa:droplet'],\n  [//, 'fa:skull'],\n  [/|/, 'fa:robot'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:coins'],\n  [/|/, 'fa:gem'],\n  [//, 'fa:gem'],\n  [/|/, 'fa:flask'],\n  [/|/, 'fa:key'],\n  [//, 'fa:map'],\n  [//, 'fa:box'],\n  [/|/, 'ti:shirt'],\n  [//, 'ti:sword'],\n  [//, 'ti:bow'],\n  [//, 'fa:gun'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:droplet'],\n  [//, 'ti:shoe'],\n  [/|/, 'fa:skull-crossbones'],\n  [//, 'ti:mist'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'fa:fire'],\n  [/|/, 'ti:snowflake'],\n  [//, 'ti:flask-off'],\n  [/|/, 'fa:droplet'],\n  [/|/, 'ti:stars'],\n  [//, 'ti:volume-off'],\n  [/|/, 'ti:mood-sad'],\n  [/|/, 'ti:mood-angry'],\n  [/|/, 'fa:ghost'],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, 'ti:heart'],\n  [/|/, 'ti:ghost'],\n  [/|/, 'fa:heart'],\n  [/|/, 'ti:alert-triangle'],\n  [/|/, 'ti:leaf'],\n  [/|/, 'ti:flame'],\n  [/|/, 'ti:mood-sad'],\n  [/|/, 'fa:party-horn'],\n  [/|/, 'ti:mood-empty'],\n\n  // ============================================\n  // \n  // ============================================\n  // \n  [//, 'fa:floppy-disk'],\n  [/|/, 'ti:stairs'],\n  [/|/, 'ti:armchair'],\n  [/|/, 'fa:bed'],\n  [//, 'ti:hanger'],\n  [//, 'ti:table'],\n  [//, 'fa:box'],\n  [//, 'ti:wall'],\n  [/|/, 'fa:chalkboard'],\n  [/||||||/, 'fa:desktop'],\n  [//, 'fa:video'],\n  [//, 'fa:satellite-dish'],\n  [/|/, 'ti:window'],\n  [//, 'ti:escalator'],\n  [/|/, 'fa:gears'],\n  [/|/, 'fa:lock'],\n  [/|||/, 'fa:door-open'],\n\n  // \n  [/|||/, 'fa:person-walking'],\n  [//, 'ti:lane'],\n  [/|/, 'fa:bridge'],\n  [//, 'fa:square-full'],\n  [//, 'fa:flag'],\n\n  // \n  [/|||/, 'ti:shoe'],\n  [/|/, 'fa:building'],\n  [/|/, 'fa:bed'],\n  [//, 'fa:door-closed'],\n  [/|/, 'ti:plant'],\n  [//, 'fa:door-open'],\n\n  // \n  [//, 'fa:bag-shopping'],\n  [/|/, 'fa:building'],\n  [/|||/, 'fa:hotel'],\n  [/||/, 'fa:store'],\n  [/||/, 'fa:utensils'],\n  [/|/, 'fa:mug-hot'],\n  [/|/, 'fa:wine-glass'],\n  [/|/, 'fa:guitar'],\n\n  // \n  [/|/, 'fa:warehouse'],\n  [/|/, 'fa:hospital'],\n  [/|||/, 'fa:building-columns'],\n  [/||/, 'fa:briefcase'],\n\n  // \n  [/|||/, 'fa:umbrella-beach'],\n  [/|/, 'fa:water'],\n  [/||/, 'fa:droplet'],\n  [/|/, 'fa:circle-dot'],\n  [/|||/, 'fa:tree'],\n  [/||/, 'ti:plant'],\n  [/||/, 'fa:mountain'],\n  [/|/, 'fa:tree'],\n\n  // \n  [/|/, 'fa:campground'],\n  [//, 'fa:building'],\n  [/|/, 'fa:crown'],\n  [//, 'fa:building-columns'],\n  [/|/, 'fa:chess-rook'],\n  [/|/, 'fa:church'],\n  [/|||/, 'fa:place-of-worship'],\n  [/|/, 'fa:building-columns'],\n  [//, 'ti:spider'],\n  [/||/, 'ti:tower'],\n  [//, 'fa:shield-halved'],\n\n  // \n  [/|/, 'ti:wand'],\n  [/|/, 'fa:school'],\n  [//, 'fa:book'],\n  [/|/, 'fa:bell-concierge'],\n  [/||/, 'ti:run'],\n  [/||/, 'fa:building-columns'],\n  [/|||/, 'fa:school'],\n\n  // \n  [//, 'fa:eye'],\n  [/|/, 'fa:user-secret'],\n  [/|/, 'fa:coins'],\n  [/||/, 'fa:user'],\n  [/||/, 'fa:shield-halved'],\n  [/||/, 'fa:users'],\n\n  // \n  [/||/, 'ti:wheat'],\n  [/|||/, 'fa:swords'],\n  [/||/, 'ti:shirt'],\n  [/|/, 'ti:meat'],\n  [/|||/, 'fa:file'],\n  [//, 'fa:link'],\n  [/|||/, 'ti:cake'],\n  [//, 'fa:wine-glass'],\n  [//, 'ti:fish'],\n  [//, 'ti:bread'],\n  [//, 'ti:bread'],\n  [/|/, 'ti:cup'],\n  [//, 'fa:camera'],\n  [/||/, 'fa:gamepad'],\n  [//, 'fa:mobile'],\n  [//, 'fa:gift'],\n  [/|/, 'fa:book'],\n  [//, 'fa:clipboard-list'],\n  [//, 'fa:scroll'],\n  [/|/, 'fa:suitcase'],\n  [/|/, 'fa:bag-shopping'],\n  [/|/, 'fa:screwdriver-wrench'],\n\n  // \n  [/||/, 'fa:lightbulb'],\n  [/|/, 'ti:shoe'],\n  [/|/, 'ti:mist'],\n  [/|/, 'fa:shield-halved'],\n  [//, 'fa:wind'],\n  [/|/, 'fa:heart'],\n\n  // \n  [/||/, 'fa:circle-notch'],\n  [/|/, 'fa:eye'],\n  [/||||/, 'fa:city'],\n  [/|||||/, 'fa:house'],\n  [/|/, 'fa:house'],\n  [/|/, 'fa:brain'],\n  [/|/, 'fa:dna'],\n  [/|/, 'fa:magnifying-glass'],\n  [//, 'ti:walk'],\n  [/||||/, 'fa:mountain'],\n];\n\n// \nexport const LOCATION_EMOJI_MAP = EMOJI_MAP;\nexport const ELEMENT_EMOJI_MAP = EMOJI_MAP;\n\n/**\n * \n * \n *\n * index.ts  showRelationshipGraph() \n *  foreignObject  SVG  HTML \n *\n * \n * - fa:xxx   Font Awesome  ( fa:heart)\n * - ti:xxx   Tabler Icons  ( ti:swords)\n *\n * \n * 1. \n * 2.  includes() \n * 3. \n * 4.  fa fa  ti\n */\nexport const RELATION_ICON_MAP: { icon: string; keywords: string[] }[] = [\n  {\n    icon: 'fa:heart',\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n  },\n  {\n    icon: 'fa:ring',\n    keywords: ['', '', '', '', '', '', '', '', '', '', ''],\n  },\n  {\n    icon: 'fa:child',\n    keywords: ['', '', '', '', '', ''],\n  },\n  {\n    icon: 'fa:people-roof',\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n  },\n  {\n    icon: 'fa:star',\n    keywords: ['', '', '', '', '', '', '', '', '', '', '', ''],\n  },\n  {\n    icon: 'fa:user-group',\n    keywords: ['', '', '', '', '', '', '', '', '', '', '', ''],\n  },\n  { icon: 'fa:handshake-angle', keywords: ['', '', '', '', ''] },\n  { icon: 'fa:shield-heart', keywords: ['', '', '', '', '', '', ''] },\n  { icon: 'fa:house-user', keywords: ['', '', '', ''] },\n  {\n    icon: 'fa:graduation-cap',\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n  },\n  { icon: 'fa:compass', keywords: ['', '', '', '', '', ''] },\n  { icon: 'fa:file-signature', keywords: ['', '', '', '', '', '', '', '', ''] },\n  { icon: 'fa:handshake', keywords: ['', '', '', '', '', '', '', ''] },\n  {\n    icon: 'fa:gavel',\n    keywords: ['', '', '', '', '', '', '', '', '', '', '', ''],\n  },\n  { icon: 'fa:thumbs-up', keywords: ['', '', '', '', '', '', ''] },\n  { icon: 'fa:hand-holding-heart', keywords: ['', '', '', '', '', '', '', ''] },\n  { icon: 'fa:eye', keywords: ['', '', '', '', '', '', ''] },\n  {\n    icon: 'ti:swords',\n    keywords: ['', '', '', '', '', '', '', '', '', '', '', ''],\n  },\n  { icon: 'fa:skull', keywords: ['', '', '', '', '', '', '', '', '', ''] },\n  {\n    icon: 'ti:ghost',\n    keywords: ['', '', '', '', '', '', '', '', '', ''],\n  },\n  {\n    icon: 'fa:thumbs-down',\n    keywords: ['', '', '', '', '', '', '', '', '', '', ''],\n  },\n  { icon: 'fa:ban', keywords: ['', '', '', '', '', '', '', '', ''] },\n  {\n    icon: 'fa:hands-praying',\n    keywords: ['', '', '', '', '', '', '', '', '', '', ''],\n  },\n  {\n    icon: 'fa:face-meh',\n    keywords: ['', '', '', '', '', '', '', '', '', '', ''],\n  },\n  { icon: 'ti:circles-relation', keywords: ['', '', '', '', ''] },\n  { icon: 'fa:link', keywords: ['', '', '', '', '', '', ''] },\n  { icon: 'fa:crosshairs', keywords: ['', '', '', '', '', '', '', ''] },\n  { icon: 'fa:medal', keywords: ['', '', '', '', '', '', '', ''] },\n];\n","/**\n * -UI\n *\n *  index.ts \n *\n * ## \n * - index.ts \n * - \n *\n * ## \n * -  index.ts  `import { injectDatabaseStyles } from './database-ui-override'` \n * - \n *\n * ## \n * -  DATABASE_THEME_MAP  injectDatabaseStyles \n * -  `pnpm build` \n *\n * @see index.ts - injectDatabaseStyles()  9491 \n */\n\ninterface ThemeColors {\n  bgNav: string;\n  bgPanel: string;\n  border: string;\n  textMain: string;\n  textSub: string;\n  btnBg: string;\n  btnHover: string;\n  btnActiveBg: string;\n  btnActiveText: string;\n  accent: string;\n  inputBg: string;\n}\n\ntype DatabaseThemeMap = Record<string, ThemeColors>;\n\nconst DATABASE_THEME_MAP: DatabaseThemeMap = {\n  retro: {\n    bgNav: '#e6e2d3',\n    bgPanel: '#e6e2d3',\n    border: '#dcd0c0',\n    textMain: '#5e4b35',\n    textSub: '#999',\n    btnBg: '#dcd0c0',\n    btnHover: '#cbbba8',\n    btnActiveBg: '#8d7b6f',\n    btnActiveText: '#fdfaf5',\n    accent: '#7a695f',\n    inputBg: '#f5f2eb',\n  },\n  dark: {\n    bgNav: '#2b2b2b',\n    bgPanel: '#252525',\n    border: '#444',\n    textMain: '#eee',\n    textSub: '#aaa',\n    btnBg: '#3a3a3a',\n    btnHover: '#4a4a4a',\n    btnActiveBg: '#6a5acd',\n    btnActiveText: '#fff',\n    accent: '#9b8cd9',\n    inputBg: '#3a3a3a',\n  },\n  modern: {\n    bgNav: '#ffffff',\n    bgPanel: '#f8f9fa',\n    border: '#e0e0e0',\n    textMain: '#333',\n    textSub: '#666',\n    btnBg: '#f1f3f5',\n    btnHover: '#e9ecef',\n    btnActiveBg: '#007bff',\n    btnActiveText: '#fff',\n    accent: '#007bff',\n    inputBg: '#f1f3f5',\n  },\n  forest: {\n    bgNav: '#e8f5e9',\n    bgPanel: '#e8f5e9',\n    border: '#c8e6c9',\n    textMain: '#2e7d32',\n    textSub: '#81c784',\n    btnBg: '#c8e6c9',\n    btnHover: '#a5d6a7',\n    btnActiveBg: '#43a047',\n    btnActiveText: '#fff',\n    accent: '#4caf50',\n    inputBg: '#c8e6c9',\n  },\n  ocean: {\n    bgNav: '#e3f2fd',\n    bgPanel: '#e3f2fd',\n    border: '#90caf9',\n    textMain: '#1565c0',\n    textSub: '#64b5f6',\n    btnBg: '#bbdefb',\n    btnHover: '#90caf9',\n    btnActiveBg: '#1976d2',\n    btnActiveText: '#fff',\n    accent: '#2196f3',\n    inputBg: '#bbdefb',\n  },\n  cyber: {\n    bgNav: '#000000',\n    bgPanel: '#0a0a0a',\n    border: '#333',\n    textMain: '#00ffcc',\n    textSub: '#ff00ff',\n    btnBg: '#111',\n    btnHover: '#222',\n    btnActiveBg: '#ff00ff',\n    btnActiveText: '#000',\n    accent: '#00ffcc',\n    inputBg: '#111',\n  },\n  nightowl: {\n    bgNav: '#0a2133',\n    bgPanel: '#011627',\n    border: '#132e45',\n    textMain: '#e0e6f2',\n    textSub: '#a6b8cc',\n    btnBg: '#1f3a52',\n    btnHover: '#2a4a68',\n    btnActiveBg: '#7fdbca',\n    btnActiveText: '#011627',\n    accent: '#7fdbca',\n    inputBg: '#1f3a52',\n  },\n  sakura: {\n    bgNav: '#F9F0EF',\n    bgPanel: '#F9F0EF',\n    border: '#EBDCD9',\n    textMain: '#6B5552',\n    textSub: '#C08D8D',\n    btnBg: '#EBDCD9',\n    btnHover: '#D8C7C4',\n    btnActiveBg: '#C08D8D',\n    btnActiveText: '#F9F0EF',\n    accent: '#C08D8D',\n    inputBg: '#EBDCD9',\n  },\n  minepink: {\n    bgNav: '#1a1a1a',\n    bgPanel: '#1a1a1a',\n    border: '#333333',\n    textMain: '#ffb3d9',\n    textSub: '#ff80c1',\n    btnBg: '#2a2a2a',\n    btnHover: '#3a3a3a',\n    btnActiveBg: '#ff80c1',\n    btnActiveText: '#1a1a1a',\n    accent: '#ff80c1',\n    inputBg: '#2a2a2a',\n  },\n  purple: {\n    bgNav: '#f3e5f5',\n    bgPanel: '#f3e5f5',\n    border: '#ce93d8',\n    textMain: '#6a1b9a',\n    textSub: '#9c27b0',\n    btnBg: '#e1bee7',\n    btnHover: '#ce93d8',\n    btnActiveBg: '#9c27b0',\n    btnActiveText: '#fff',\n    accent: '#9c27b0',\n    inputBg: '#e1bee7',\n  },\n  wechat: {\n    bgNav: '#F7F7F7',\n    bgPanel: '#F7F7F7',\n    border: '#E5E5E5',\n    textMain: '#333333',\n    textSub: '#666666',\n    btnBg: '#E5E5E5',\n    btnHover: '#D5D5D5',\n    btnActiveBg: '#09B83E',\n    btnActiveText: '#FFFFFF',\n    accent: '#09B83E',\n    inputBg: '#E5E5E5',\n  },\n  educational: {\n    bgNav: '#000000',\n    bgPanel: '#000000',\n    border: '#1B1B1B',\n    textMain: '#FFFFFF',\n    textSub: '#CCCCCC',\n    btnBg: '#1B1B1B',\n    btnHover: '#2B2B2B',\n    btnActiveBg: '#FF9900',\n    btnActiveText: '#000000',\n    accent: '#FF9900',\n    inputBg: '#1B1B1B',\n  },\n  vaporwave: {\n    bgNav: '#191970',\n    bgPanel: '#191970',\n    border: 'rgba(0,255,255,0.3)',\n    textMain: '#00FFFF',\n    textSub: '#FF00FF',\n    btnBg: 'rgba(25,25,112,0.8)',\n    btnHover: 'rgba(0,255,255,0.2)',\n    btnActiveBg: '#FF00FF',\n    btnActiveText: '#191970',\n    accent: '#00FFFF',\n    inputBg: 'rgba(25,25,112,0.6)',\n  },\n  classicpackaging: {\n    bgNav: '#000000',\n    bgPanel: '#000000',\n    border: '#FFFF00',\n    textMain: '#FFFF00',\n    textSub: '#CCCC00',\n    btnBg: '#FF0000',\n    btnHover: '#CC0000',\n    btnActiveBg: '#0000FF',\n    btnActiveText: '#FFFF00',\n    accent: '#FF0000',\n    inputBg: '#1a1a1a',\n  },\n  galgame: {\n    bgNav: '#FFF0F5',\n    bgPanel: '#FFF0F5',\n    border: '#F0D4E4',\n    textMain: '#6B4A5A',\n    textSub: '#B08A9A',\n    btnBg: '#FFE4E9',\n    btnHover: '#FFD4E4',\n    btnActiveBg: '#E8B4D9',\n    btnActiveText: '#6B4A5A',\n    accent: '#E8B4D9',\n    inputBg: '#FFF8FA',\n  },\n  terminal: {\n    bgNav: '#0c0c0c',\n    bgPanel: '#0c0c0c',\n    border: '#00ff00',\n    textMain: '#00ff00',\n    textSub: '#00cc00',\n    btnBg: '#1a1a1a',\n    btnHover: '#2a2a2a',\n    btnActiveBg: '#00ff00',\n    btnActiveText: '#0c0c0c',\n    accent: '#00ff00',\n    inputBg: '#0c0c0c',\n  },\n  dreamcore: {\n    bgNav: '#F4F1EA',\n    bgPanel: '#F4F1EA',\n    border: '#D6D2C4',\n    textMain: '#5C5869',\n    textSub: '#9490A0',\n    btnBg: '#E6E1D5',\n    btnHover: '#DBD8CC',\n    btnActiveBg: '#8A9AC6',\n    btnActiveText: '#FFFFFF',\n    accent: '#8A9AC6',\n    inputBg: '#FFFFFF',\n  },\n  aurora: {\n    bgNav: 'linear-gradient(135deg,#0f172a,#1e293b)',\n    bgPanel: 'linear-gradient(180deg,#0f172a 0%,#334155 100%)',\n    border: '#38bdf8',\n    textMain: '#e2e8f0',\n    textSub: '#94a3b8',\n    btnBg: 'linear-gradient(135deg,#162a3d,#25224d)',\n    btnHover: 'linear-gradient(135deg,#1e3a5f,#312e81)',\n    btnActiveBg: 'linear-gradient(135deg,#38bdf8,#a855f7)',\n    btnActiveText: '#fff',\n    accent: '#38bdf8',\n    inputBg: '#0f172a',\n  },\n  chouten: {\n    bgNav: 'linear-gradient(135deg,rgba(26,10,46,0.95) 0%,rgba(45,27,78,0.95) 50%,rgba(26,10,46,0.95) 100%)',\n    bgPanel: 'rgba(26,10,46,0.95)',\n    border: '#FF7EB6',\n    textMain: '#FFFFFF',\n    textSub: '#D0BFFF',\n    btnBg: 'rgba(255,255,255,0.1)',\n    btnHover: 'rgba(255,107,157,0.3)',\n    btnActiveBg: 'linear-gradient(90deg,#FF6B9D,#B388FF)',\n    btnActiveText: '#FFFFFF',\n    accent: '#7FFFD4',\n    inputBg: 'rgba(0,0,0,0.3)',\n  },\n};\n\n/**\n * \n * @param themeId  ID\n */\nexport function injectDatabaseStyles(themeId: string, fontFamily?: string) {\n  try {\n    const getJQuery = (w: Window | null | undefined) => {\n      try {\n        return (w as any)?.jQuery as any;\n      } catch {\n        return null;\n      }\n    };\n\n    // // document\n    const targets = [getJQuery(window), getJQuery(window.parent), getJQuery(window.top)].filter(\n      (v, idx, arr) => !!v && arr.indexOf(v) === idx,\n    );\n    if (!targets.length) return;\n\n    const t = DATABASE_THEME_MAP[themeId] || DATABASE_THEME_MAP.aurora;\n    const darkThemeIds = new Set(['cyber', 'terminal', 'aurora', 'chouten', 'classicpackaging']);\n    const isDarkTheme = darkThemeIds.has(themeId);\n    const stepperSpinFilter = isDarkTheme ? 'invert(1) brightness(1.05)' : 'none';\n    const stepperSpinOpacity = isDarkTheme ? '0.85' : '0.55';\n    const stepperColorScheme = isDarkTheme ? 'dark' : 'light';\n\n    const fontCss = fontFamily\n      ? `\n        /*  / pseudo-element  */\n        html body .auto-card-updater-popup,\n        html body #shujuku_v104-main-window,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"],\n        html body #shujuku_v104-popup.auto-card-updater-popup,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup {\n          --acu-font-family: ${fontFamily};\n          font-family: var(--acu-font-family) !important;\n        }\n\n        html body .auto-card-updater-popup :is(div, p, span, label, a, button:not(.acu-window-btn), input, select, textarea, th, td, li, ul, ol, h1, h2, h3, h4, h5, h6, small, strong, em),\n        html body #shujuku_v104-main-window :is(div, p, span, label, a, button:not(.acu-window-btn), input, select, textarea, th, td, li, ul, ol, h1, h2, h3, h4, h5, h6, small, strong, em),\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] :is(div, p, span, label, a, button:not(.acu-window-btn), input, select, textarea, th, td, li, ul, ol, h1, h2, h3, h4, h5, h6, small, strong, em),\n        html body #shujuku_v104-popup.auto-card-updater-popup :is(div, p, span, label, a, button:not(.acu-window-btn), input, select, textarea, th, td, li, ul, ol, h1, h2, h3, h4, h5, h6, small, strong, em),\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup :is(div, p, span, label, a, button:not(.acu-window-btn), input, select, textarea, th, td, li, ul, ol, h1, h2, h3, h4, h5, h6, small, strong, em) {\n          font-family: var(--acu-font-family) !important;\n        }\n      `\n      : '';\n\n    const css = `\n      <style id=\"dice-db-theme-sync\">\n        ${fontCss}\n        html body .auto-card-updater-popup {\n          --acu-bg-0: ${t.bgPanel} !important;\n          --acu-bg-1: ${t.bgNav} !important;\n          --acu-bg-2: ${t.btnBg} !important;\n          --acu-border: ${t.border} !important;\n          --acu-border-2: ${t.border} !important;\n          --acu-text-1: ${t.textMain} !important;\n          --acu-text-2: ${t.textSub} !important;\n          --acu-text-3: ${t.textSub} !important;\n          --acu-accent: ${t.accent} !important;\n          --acu-accent-glow: ${t.accent}1a !important;\n        }\n        html body .auto-card-updater-popup button,\n        html body .auto-card-updater-popup .button {\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n        }\n        html body .auto-card-updater-popup button:hover,\n        html body .auto-card-updater-popup .button:hover {\n          background: ${t.btnHover} !important;\n        }\n        html body .auto-card-updater-popup button.primary,\n        html body .auto-card-updater-popup .button.primary {\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .button-group.acu-data-mgmt-buttons button,\n        html body #shujuku_v104-popup.auto-card-updater-popup .button-group.acu-data-mgmt-buttons .button,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .button-group.acu-data-mgmt-buttons button,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .button-group.acu-data-mgmt-buttons .button {\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .button-group.acu-data-mgmt-buttons button:hover,\n        html body #shujuku_v104-popup.auto-card-updater-popup .button-group.acu-data-mgmt-buttons .button:hover,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .button-group.acu-data-mgmt-buttons button:hover,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .button-group.acu-data-mgmt-buttons .button:hover {\n          background: ${t.btnHover} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup code,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup code {\n          background-color: ${t.inputBg} !important;\n          background: ${t.inputBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          border-left: 2px solid ${t.accent} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup table thead th,\n        html body #shujuku_v104-popup.auto-card-updater-popup table th,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table thead th,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table th {\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          border-color: ${t.border} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-window-header,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-window-header,\n        html body #shujuku_v104-main-window .acu-window-header,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] .acu-window-header,\n        html body #shujuku_v104-visualizer-window .acu-window-header,\n        html body [id^=\"shujuku\"][id$=\"-visualizer-window\"] .acu-window-header {\n          background: ${t.bgNav} !important;\n          border-bottom: 1px solid ${t.border} !important;\n          color: ${t.textMain} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-window-title,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-window-title,\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-window-title span,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-window-title span,\n        html body #shujuku_v104-main-window .acu-window-title,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] .acu-window-title,\n        html body #shujuku_v104-main-window .acu-window-title span,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] .acu-window-title span,\n        html body #shujuku_v104-visualizer-window .acu-window-title,\n        html body [id^=\"shujuku\"][id$=\"-visualizer-window\"] .acu-window-title,\n        html body #shujuku_v104-visualizer-window .acu-window-title span,\n        html body [id^=\"shujuku\"][id$=\"-visualizer-window\"] .acu-window-title span {\n          color: ${t.textMain} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-window-title i,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-window-title i,\n        html body #shujuku_v104-main-window .acu-window-title i,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] .acu-window-title i,\n        html body #shujuku_v104-visualizer-window .acu-window-title i,\n        html body [id^=\"shujuku\"][id$=\"-visualizer-window\"] .acu-window-title i {\n          color: ${t.accent} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-window-btn,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-window-btn,\n        html body #shujuku_v104-main-window .acu-window-btn,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] .acu-window-btn,\n        html body #shujuku_v104-visualizer-window .acu-window-btn,\n        html body [id^=\"shujuku\"][id$=\"-visualizer-window\"] .acu-window-btn {\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-window-btn:hover,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-window-btn:hover,\n        html body #shujuku_v104-main-window .acu-window-btn:hover,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] .acu-window-btn:hover,\n        html body #shujuku_v104-visualizer-window .acu-window-btn:hover,\n        html body [id^=\"shujuku\"][id$=\"-visualizer-window\"] .acu-window-btn:hover {\n          background: ${t.btnHover} !important;\n          color: ${t.textMain} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-window-btn.close:hover,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-window-btn.close:hover,\n        html body #shujuku_v104-main-window .acu-window-btn.close:hover,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] .acu-window-btn.close:hover,\n        html body #shujuku_v104-visualizer-window .acu-window-btn.close:hover,\n        html body [id^=\"shujuku\"][id$=\"-visualizer-window\"] .acu-window-btn.close:hover {\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-stepper,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-stepper {\n          background-color: ${t.inputBg} !important;\n          border-color: ${t.border} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-stepper-btn,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-stepper-btn {\n          background-color: ${t.btnBg} !important;\n          color: ${t.textSub} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-stepper-btn:hover,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-stepper-btn:hover {\n          background-color: ${t.btnHover} !important;\n          color: ${t.accent} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-stepper-btn:active,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-stepper-btn:active {\n          background-color: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-stepper-value,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-stepper-value {\n          background-color: ${t.inputBg} !important;\n          color: ${t.textMain} !important;\n          border-left: 1px solid ${t.border} !important;\n          border-right: 1px solid ${t.border} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup input[type=\"number\"],\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup input[type=\"number\"] {\n          color-scheme: ${stepperColorScheme} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup input[type=\"number\"]::-webkit-inner-spin-button,\n        html body #shujuku_v104-popup.auto-card-updater-popup input[type=\"number\"]::-webkit-outer-spin-button,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup input[type=\"number\"]::-webkit-inner-spin-button,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup input[type=\"number\"]::-webkit-outer-spin-button {\n          filter: ${stepperSpinFilter} !important;\n          opacity: ${stepperSpinOpacity} !important;\n        }\n        html body .auto-card-updater-popup input,\n        html body .auto-card-updater-popup select,\n        html body .auto-card-updater-popup textarea,\n        html body #shujuku_v104-popup input,\n        html body #shujuku_v104-popup select,\n        html body #shujuku_v104-popup textarea,\n        html body div[id^=\"shujuku\"][id$=\"-popup\"] input,\n        html body div[id^=\"shujuku\"][id$=\"-popup\"] select,\n        html body div[id^=\"shujuku\"][id$=\"-popup\"] textarea {\n          background-color: ${t.inputBg} !important;\n          background: ${t.inputBg} !important;\n          background-image: none !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          border-color: ${t.border} !important;\n          box-shadow: none !important;\n          text-shadow: none !important;\n        }\n\n        /*  placeholder  */\n        html body .auto-card-updater-popup input::placeholder,\n        html body .auto-card-updater-popup textarea::placeholder,\n        [id^=\"shujuku\"][id$=\"-popup\"] input::placeholder,\n        [id^=\"shujuku\"][id$=\"-popup\"] textarea::placeholder {\n          color: ${t.textSub} !important;\n          opacity: 0.7;\n        }\n\n        /* ========== Checkbox  ========== */\n        /* Checkbox Container (Group) */\n        html body #shujuku_v104-popup.auto-card-updater-popup .checkbox-group,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .checkbox-group {\n          background-color: transparent !important; /*  */\n          color: ${t.textMain} !important;\n        }\n\n        /* Checkbox Label */\n        html body #shujuku_v104-popup.auto-card-updater-popup .checkbox-group label,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .checkbox-group label {\n          color: ${t.textMain} !important;\n        }\n\n        /* Checkbox Input Element (/) */\n        html body #shujuku_v104-popup.auto-card-updater-popup input[type=\"checkbox\"],\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup input[type=\"checkbox\"],\n        html body #shujuku_v104-popup.auto-card-updater-popup .checkbox-group input[type=\"checkbox\"],\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .checkbox-group input[type=\"checkbox\"] {\n          -webkit-appearance: none !important;\n          appearance: none !important;\n          width: 16px !important;\n          height: 16px !important;\n          min-width: 16px !important;\n          min-height: 16px !important;\n          border-radius: 4px !important;\n          border: 1px solid ${t.border} !important;\n          background-color: ${t.inputBg} !important;\n          background-image: none !important;\n          background-repeat: no-repeat !important;\n          background-position: center !important;\n          background-size: 12px 10px !important;\n          box-shadow: none !important;\n          padding: 0 !important;\n          margin: 2px 8px 2px 0 !important;\n          cursor: pointer !important;\n          vertical-align: middle !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup input[type=\"checkbox\"]::before,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup input[type=\"checkbox\"]::before,\n        html body #shujuku_v104-popup.auto-card-updater-popup input[type=\"checkbox\"]::after,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup input[type=\"checkbox\"]::after {\n          content: none !important;\n          display: none !important;\n        }\n\n        /* Checked State */\n        html body #shujuku_v104-popup.auto-card-updater-popup input[type=\"checkbox\"]:checked,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup input[type=\"checkbox\"]:checked {\n          background-color: ${t.accent} !important;\n          border-color: ${t.accent} !important;\n          background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 10'%3E%3Cpath fill='none' stroke='%23fff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' d='M1 5l3 3 7-7'/%3E%3C/svg%3E\") !important;\n        }\n        html body .auto-card-updater-popup th,\n        html body .auto-card-updater-popup thead th {\n          color: ${t.textMain} !important;\n          background-color: ${t.btnActiveBg} !important;\n        }\n        /* ========== Status & Messages Display  () ========== */\n        html body .auto-card-updater-popup span[id$=\"-status-display\"],\n        html body .auto-card-updater-popup span[id$=\"-messages-display\"],\n        html body .auto-card-updater-popup p.notes,\n        html body div[id$=\"-popup\"] span[id$=\"-status-display\"],\n        html body div[id$=\"-popup\"] span[id$=\"-messages-display\"],\n        html body div[id$=\"-popup\"] p.notes,\n        html body span[id$=\"-card-update-status-display\"],\n        html body span[id$=\"-total-messages-display\"],\n        html body [id$=\"-status-message\"] {\n          display: block !important;\n          background-color: var(--acu-bg-2) !important;\n          color: var(--acu-text-1) !important;\n          border: 1px solid var(--acu-border) !important;\n          border-radius: 6px !important;\n          padding: 8px 12px !important;\n          margin: 8px 0 !important;\n          font-size: 13px !important;\n          line-height: 1.4 !important;\n          box-shadow: inset 0 0 10px rgba(0,0,0,0.05) !important;\n          word-break: break-all !important;\n        }\n        html body .auto-card-updater-popup span[id$=\"-status-display\"] b,\n        html body div[id$=\"-popup\"] span[id$=\"-status-display\"] b,\n        html body span[id$=\"-card-update-status-display\"] b {\n          color: var(--acu-accent) !important;\n          font-weight: bold !important;\n        }\n        html body .auto-card-updater-popup span[id$=\"-status-display\"] *:not(b):not([style*=\"color\"]),\n        html body div[id$=\"-popup\"] span[id$=\"-status-display\"] *:not(b):not([style*=\"color\"]),\n        html body span[id$=\"-card-update-status-display\"] *:not(b):not([style*=\"color\"]) {\n          color: inherit !important;\n        }\n        html body .auto-card-updater-popup table tbody tr,\n        html body .auto-card-updater-popup table tbody tr:nth-child(odd),\n        html body .auto-card-updater-popup table tbody tr:nth-child(even) {\n          background-color: ${t.bgPanel} !important;\n        }\n        html body .auto-card-updater-popup table tbody tr:hover {\n          background-color: ${t.btnHover} !important;\n        }\n        html body .auto-card-updater-popup table tbody td {\n          color: ${t.textMain} !important;\n        }\n\n        /* ========== Table Layout & Column Alignment  ========== */\n        html body .auto-card-updater-popup table,\n        html body #shujuku_v104-popup.auto-card-updater-popup table,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table {\n          table-layout: fixed !important;\n          width: 100% !important;\n          border-collapse: collapse !important;\n          max-width: 100% !important;\n          overflow: hidden !important;\n          /*  */\n          box-sizing: border-box !important;\n        }\n\n        html body .auto-card-updater-popup table thead,\n        html body .auto-card-updater-popup table tbody,\n        html body .auto-card-updater-popup table tr,\n        html body #shujuku_v104-popup.auto-card-updater-popup table thead,\n        html body #shujuku_v104-popup.auto-card-updater-popup table tbody,\n        html body #shujuku_v104-popup.auto-card-updater-popup table tr,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table thead,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table tbody,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table tr {\n          width: 100% !important;\n          box-sizing: border-box !important;\n        }\n\n        html body .auto-card-updater-popup table th,\n        html body .auto-card-updater-popup table td,\n        html body #shujuku_v104-popup.auto-card-updater-popup table th,\n        html body #shujuku_v104-popup.auto-card-updater-popup table td,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table th,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table td {\n          text-align: left !important;\n          padding: 5px 8px !important;\n          border: 1px solid ${t.border} !important;\n          overflow: hidden !important;\n          text-overflow: ellipsis !important;\n          white-space: nowrap !important;\n          box-sizing: border-box !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table th:first-child,\n        html body .auto-card-updater-popup table td:first-child,\n        html body #shujuku_v104-popup.auto-card-updater-popup table th:first-child,\n        html body #shujuku_v104-popup.auto-card-updater-popup table td:first-child,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table th:first-child,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table td:first-child {\n          text-align: left !important;\n          width: 25% !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table th:not(:first-child):not(:last-child),\n        html body .auto-card-updater-popup table td:not(:first-child):not(:last-child),\n        html body #shujuku_v104-popup.auto-card-updater-popup table th:not(:first-child):not(:last-child),\n        html body #shujuku_v104-popup.auto-card-updater-popup table td:not(:first-child):not(:last-child),\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table th:not(:first-child):not(:last-child),\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table td:not(:first-child):not(:last-child) {\n          text-align: center !important;\n          width: calc((100% - 25%) / 4) !important;\n        }\n\n        /*  */\n        html body .auto-card-updater-popup table th:last-child,\n        html body .auto-card-updater-popup table td:last-child,\n        html body #shujuku_v104-popup.auto-card-updater-popup table th:last-child,\n        html body #shujuku_v104-popup.auto-card-updater-popup table td:last-child,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table th:last-child,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table td:last-child {\n          text-align: center !important;\n          width: 25% !important;\n        }\n\n        /* ========== Mobile Responsive  ========== */\n        @media (max-width: 768px) {\n          html body .auto-card-updater-popup table,\n          html body #shujuku_v104-popup.auto-card-updater-popup table,\n          html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table {\n            font-size: 0.8em !important;\n          }\n\n          html body .auto-card-updater-popup table th,\n          html body .auto-card-updater-popup table td,\n          html body #shujuku_v104-popup.auto-card-updater-popup table th,\n          html body #shujuku_v104-popup.auto-card-updater-popup table td,\n          html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table th,\n          html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup table td {\n            padding: 4px 6px !important;\n          }\n        }\n\n        /* ========== Radio group  ========== */\n        #shujuku_v104-popup.auto-card-updater-popup .qrf_radio_group,\n        [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .qrf_radio_group {\n          background-color: ${t.btnBg} !important;\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          border-radius: 6px;\n          padding: 8px 12px !important;\n        }\n        #shujuku_v104-popup.auto-card-updater-popup .qrf_radio_group label,\n        #shujuku_v104-popup.auto-card-updater-popup .qrf_radio_group span,\n        [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .qrf_radio_group label,\n        [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .qrf_radio_group span {\n          color: ${t.textMain} !important;\n        }\n        #shujuku_v104-popup.auto-card-updater-popup input[type=\"radio\"],\n        [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup input[type=\"radio\"] {\n          -webkit-appearance: none !important;\n          appearance: none !important;\n          width: 16px !important;\n          height: 16px !important;\n          min-width: 16px !important;\n          min-height: 16px !important;\n          border-radius: 50% !important;\n          border: 1px solid ${t.border} !important;\n          background-color: ${t.inputBg} !important;\n          box-shadow: none !important;\n          position: relative !important;\n          cursor: pointer !important;\n          vertical-align: middle !important;\n        }\n        #shujuku_v104-popup.auto-card-updater-popup input[type=\"radio\"]:checked,\n        [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup input[type=\"radio\"]:checked {\n          border-color: ${t.accent} !important;\n        }\n        #shujuku_v104-popup.auto-card-updater-popup input[type=\"radio\"]:checked::after,\n        [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup input[type=\"radio\"]:checked::after {\n          content: '' !important;\n          position: absolute !important;\n          width: 8px !important;\n          height: 8px !important;\n          border-radius: 50% !important;\n          background: ${t.accent} !important;\n          top: 50% !important;\n          left: 50% !important;\n          transform: translate(-50%, -50%) !important;\n        }\n\n        /* ========== Worldbook entry list  ========== */\n        #shujuku_v104-popup .qrf_worldbook_entry_list,\n        #shujuku_v104-popup [class*=\"worldbook-entry-list\"],\n        [id^=\"shujuku\"][id$=\"-popup\"] .qrf_worldbook_entry_list,\n        [id^=\"shujuku\"][id$=\"-popup\"] [class*=\"worldbook-entry-list\"] {\n          background-color: ${t.btnBg} !important;\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          border-radius: 6px;\n        }\n        #shujuku_v104-popup .qrf_worldbook_entry_list label,\n        #shujuku_v104-popup .qrf_worldbook_entry_list span,\n        #shujuku_v104-popup .qrf_worldbook_entry_list div,\n        [id^=\"shujuku\"][id$=\"-popup\"] .qrf_worldbook_entry_list label,\n        [id^=\"shujuku\"][id$=\"-popup\"] .qrf_worldbook_entry_list span,\n        [id^=\"shujuku\"][id$=\"-popup\"] .qrf_worldbook_entry_list div {\n          color: ${t.textMain} !important;\n        }\n\n        /* ========== Plot prompt segment textarea ========== */\n        #shujuku_v104-popup textarea.plot-prompt-segment-content,\n        #shujuku_v104-popup .plot-prompt-segment-content,\n        [id^=\"shujuku\"][id$=\"-popup\"] textarea.plot-prompt-segment-content,\n        [id^=\"shujuku\"][id$=\"-popup\"] .plot-prompt-segment-content {\n          background-color: ${t.inputBg} !important;\n          background: ${t.inputBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n        }\n\n        /* ========== Plot prompt segment container ========== */\n        #shujuku_v104-popup .plot-prompt-segment,\n        [id^=\"shujuku\"][id$=\"-popup\"] .plot-prompt-segment {\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n        }\n\n        /* Toggle switch  checkbox  */\n        html body #shujuku_v104-popup.auto-card-updater-popup .toggle-switch input[type=\"checkbox\"],\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .toggle-switch input[type=\"checkbox\"] {\n          -webkit-appearance: auto !important;\n          appearance: auto !important;\n          background: transparent !important;\n          border: 0 !important;\n          box-shadow: none !important;\n          width: 0 !important;\n          height: 0 !important;\n          min-width: 0 !important;\n          min-height: 0 !important;\n          opacity: 0 !important;\n          margin: 0 !important;\n        }\n\n        /*  lightgreen */\n        html body #shujuku_v104-popup.auto-card-updater-popup span[style*=\"lightgreen\"],\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup span[style*=\"lightgreen\"] {\n          color: ${t.accent} !important;\n        }\n\n        /* Toggle switch  */\n        html body #shujuku_v104-popup.auto-card-updater-popup .toggle-switch .slider,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .toggle-switch .slider {\n          background-color: ${t.inputBg} !important;\n          background: ${t.inputBg} !important;\n          border: 1px solid ${t.border} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .toggle-switch .slider:before,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .toggle-switch .slider:before {\n          background-color: ${t.btnActiveText} !important;\n          border: 1px solid ${t.border} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .toggle-switch input:checked + .slider,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .toggle-switch input:checked + .slider {\n          background-color: ${t.btnActiveBg} !important;\n          background: ${t.btnActiveBg} !important;\n          border-color: ${t.btnActiveBg} !important;\n        }\n        html body #shujuku_v104-popup.auto-card-updater-popup .toggle-switch input:checked + .slider:before,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .toggle-switch input:checked + .slider:before {\n          background-color: ${t.btnActiveText} !important;\n          border-color: ${t.btnActiveText} !important;\n        }\n\n        /* ========== Prompt Segment Toolbar (/) ========== */\n        /* Container */\n        html body #shujuku_v104-popup.auto-card-updater-popup .prompt-segment,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .prompt-segment {\n          background-color: ${t.bgPanel} !important;\n          border: 1px solid ${t.border} !important;\n          color: ${t.textMain} !important;\n        }\n\n        /* Toolbar Container */\n        html body #shujuku_v104-popup.auto-card-updater-popup .prompt-segment-toolbar,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .prompt-segment-toolbar {\n          background-color: transparent !important;\n          color: ${t.textMain} !important;\n        }\n\n        /* Controls: Role Select, Main Slot Select, Delete Button */\n        html body #shujuku_v104-popup.auto-card-updater-popup .prompt-segment-toolbar .prompt-segment-role,\n        html body #shujuku_v104-popup.auto-card-updater-popup .prompt-segment-toolbar .prompt-segment-main-slot,\n        html body #shujuku_v104-popup.auto-card-updater-popup .prompt-segment-toolbar .prompt-segment-delete-btn,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .prompt-segment-toolbar .prompt-segment-role,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .prompt-segment-toolbar .prompt-segment-main-slot,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .prompt-segment-toolbar .prompt-segment-delete-btn {\n          background-color: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n        }\n\n        /* Hover states */\n        html body #shujuku_v104-popup.auto-card-updater-popup .prompt-segment-toolbar .prompt-segment-role:hover,\n        html body #shujuku_v104-popup.auto-card-updater-popup .prompt-segment-toolbar .prompt-segment-main-slot:hover,\n        html body #shujuku_v104-popup.auto-card-updater-popup .prompt-segment-toolbar .prompt-segment-delete-btn:hover,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .prompt-segment-toolbar .prompt-segment-role:hover,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .prompt-segment-toolbar .prompt-segment-main-slot:hover,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .prompt-segment-toolbar .prompt-segment-delete-btn:hover {\n          background-color: ${t.btnHover} !important;\n        }\n\n        /* ========== Tabs Navigation  ========== */\n        /* Container */\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-tabs-nav,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-tabs-nav,\n        html body #shujuku_v104-main-window .acu-tabs-nav,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] .acu-tabs-nav {\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          color: ${t.textMain} !important;\n          border-bottom: 1px solid ${t.border} !important;\n        }\n\n        /* Section Title */\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-nav-section-title,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-nav-section-title,\n        html body #shujuku_v104-main-window .acu-nav-section-title,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] .acu-nav-section-title {\n          color: ${t.textSub} !important;\n          font-size: 11px !important;\n          text-transform: uppercase !important;\n          letter-spacing: 0.5px !important;\n          font-weight: 600 !important;\n        }\n\n        /* Tab Button (default state) */\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-tab-button,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-tab-button,\n        html body #shujuku_v104-main-window .acu-tab-button,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] .acu-tab-button {\n          background-color: transparent !important;\n          background: transparent !important;\n          color: ${t.textSub} !important;\n          border: 1px solid transparent !important;\n          border-radius: 6px !important;\n          transition: all 0.2s ease !important;\n        }\n\n        /* Tab Button (hover) */\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-tab-button:hover,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-tab-button:hover,\n        html body #shujuku_v104-main-window .acu-tab-button:hover,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] .acu-tab-button:hover {\n          background-color: ${t.btnBg} !important;\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n        }\n\n        /* Tab Button (active state) */\n        html body #shujuku_v104-popup.auto-card-updater-popup .acu-tab-button.active,\n        html body [id^=\"shujuku\"][id$=\"-popup\"].auto-card-updater-popup .acu-tab-button.active,\n        html body #shujuku_v104-main-window .acu-tab-button.active,\n        html body [id^=\"shujuku\"][id$=\"-main-window\"] .acu-tab-button.active {\n          background-color: ${t.btnActiveBg} !important;\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          border-color: ${t.btnActiveBg} !important;\n        }\n\n        /*  -  */\n        /* Header */\n        #acu-visualizer-content .acu-vis-header {\n          background-color: ${t.bgNav} !important;\n          background: ${t.bgNav} !important;\n          border-bottom: 1px solid ${t.border} !important;\n          color: ${t.textMain} !important;\n        }\n\n        /* Content Area */\n        #acu-visualizer-content .acu-vis-content {\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n        }\n\n        /* Sidebar */\n        #acu-visualizer-content .acu-vis-sidebar {\n          background-color: ${t.bgNav} !important;\n          background: ${t.bgNav} !important;\n          border-right: 1px solid ${t.border} !important;\n        }\n\n        /* Main Section */\n        #acu-visualizer-content .acu-vis-main {\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          color: ${t.textMain} !important;\n        }\n\n        /* Title & Actions */\n        #acu-visualizer-content .acu-vis-title {\n          color: ${t.textMain} !important;\n        }\n\n        #acu-visualizer-content .acu-vis-actions {\n          color: ${t.textSub} !important;\n        }\n\n        /*  -  */\n        /* Card Grid Layout */\n        #acu-visualizer-content .acu-card-grid {\n          display: grid !important;\n          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;\n          gap: 16px !important;\n          padding: 16px !important;\n        }\n\n        /* Data Card Container */\n        #acu-visualizer-content .acu-data-card {\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          border: 1px solid ${t.border} !important;\n          border-radius: 10px !important;\n          /*  */\n          overflow: visible !important;\n          overflow-y: auto !important;\n          max-height: 70vh !important;\n          display: flex !important;\n          flex-direction: column !important;\n          transition: transform 0.2s ease, box-shadow 0.2s ease !important;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;\n        }\n\n        #acu-visualizer-content .acu-data-card:hover {\n          transform: translateY(-4px) !important;\n          box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25) !important;\n          border-color: ${t.btnActiveBg} !important;\n        }\n\n        /* Add Row Card -  */\n        #acu-visualizer-content #acu-vis-add-row,\n        #acu-visualizer-content .acu-data-card#acu-vis-add-row {\n          background: ${t.bgPanel} !important;\n          background-color: ${t.bgPanel} !important;\n          border: 2px dashed ${t.accent} !important;\n          border-color: ${t.accent} !important;\n        }\n        #acu-visualizer-content #acu-vis-add-row i,\n        #acu-visualizer-content #acu-vis-add-row div,\n        #acu-visualizer-content #acu-vis-add-row i.fa-solid,\n        #acu-visualizer-content #acu-vis-add-row i.fa-plus,\n        #acu-visualizer-content .acu-data-card#acu-vis-add-row > i,\n        #acu-visualizer-content .acu-data-card#acu-vis-add-row > div,\n        #acu-vis-add-row i[style],\n        #acu-vis-add-row div[style] {\n          color: ${t.accent} !important;\n        }\n        #acu-visualizer-content #acu-vis-add-row:hover {\n          background: ${t.btnBg} !important;\n          background-color: ${t.btnBg} !important;\n          border-color: ${t.btnActiveBg} !important;\n        }\n        #acu-visualizer-content #acu-vis-add-row:hover i,\n        #acu-visualizer-content #acu-vis-add-row:hover div,\n        #acu-vis-add-row:hover i[style],\n        #acu-vis-add-row:hover div[style] {\n          color: ${t.btnActiveBg} !important;\n        }\n\n        /* Card Header */\n        #acu-visualizer-content .acu-card-header {\n          background-color: ${t.btnActiveBg} !important;\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          padding: 12px 16px !important;\n          font-weight: 600 !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: space-between !important;\n          border-bottom: 1px solid ${t.border} !important;\n        }\n\n        /* Card Body */\n        #acu-visualizer-content .acu-card-body {\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          padding: 16px !important;\n          flex: 1 !important;\n          color: ${t.textMain} !important;\n          font-size: 14px !important;\n          line-height: 1.6 !important;\n        }\n        /*  -  */\n        /* Lock Buttons -  */\n        #acu-visualizer-content [class*=\"acu-lock\"],\n        #acu-visualizer-content [class*=\"acu-vis-lock\"] {\n          background: ${t.btnBg} !important;\n          color: ${t.textSub} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 4px 6px !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n          /*  -  */\n          min-width: unset !important;\n          min-height: unset !important;\n          width: auto !important;\n          height: auto !important;\n          font-size: 12px !important;\n          line-height: 1 !important;\n          border-radius: 4px !important;\n          flex-shrink: 0 !important;\n        }\n\n        #acu-visualizer-content [class*=\"acu-lock\"]:hover,\n        #acu-visualizer-content [class*=\"acu-vis-lock\"]:hover {\n          background: ${t.btnHover} !important;\n          color: ${t.textMain} !important;\n        }\n\n        /* Delete Buttons (Red warning) */\n        #acu-visualizer-content .acu-vis-del-row,\n        #acu-visualizer-content .acu-vis-del-table-btn {\n          background: ${t.btnBg} !important;\n          color: ${t.textSub} !important;\n          border: 1px solid ${t.border} !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n        }\n\n        #acu-visualizer-content .acu-vis-del-row:hover,\n        #acu-visualizer-content .acu-vis-del-table-btn:hover {\n          background: #ff4444 !important;\n          color: #fff !important;\n          border-color: #cc0000 !important;\n        }\n\n        /* Add Table Button */\n        #acu-visualizer-content .acu-add-table-btn {\n          background: ${t.accent} !important;\n          color: #fff !important;\n          border: none !important;\n          padding: 10px 16px !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n        }\n\n        #acu-visualizer-content .acu-add-table-btn:hover {\n          background: ${t.btnActiveBg} !important;\n        }\n\n        /*  -  */\n        #acu-visualizer-content .acu-vis-toolbar {\n          display: flex !important;\n          align-items: center !important;\n          justify-content: space-between !important;\n          padding: 8px 12px !important;\n          background: ${t.bgNav} !important;\n          border-bottom: 1px solid ${t.border} !important;\n          flex-shrink: 0 !important;\n          flex-wrap: wrap !important;\n          gap: 8px !important;\n        }\n\n        /*  -  */\n        /* Mode Switch Container */\n        #acu-visualizer-content .acu-mode-switch {\n          display: flex !important;\n          gap: 4px !important;\n          padding: 4px !important;\n          background: ${t.bgPanel} !important;\n          border-radius: 6px !important;\n          border: 1px solid ${t.border} !important;\n          flex-shrink: 0 !important;\n        }\n\n        /* Mode Button (default) */\n        #acu-visualizer-content .acu-mode-btn {\n          background: transparent !important;\n          color: ${t.textSub} !important;\n          border: 1px solid transparent !important;\n          padding: 6px 10px !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n          border-radius: 4px !important;\n          font-size: 12px !important;\n          white-space: nowrap !important;\n          min-width: unset !important;\n          min-height: unset !important;\n        }\n\n        #acu-visualizer-content .acu-mode-btn:hover {\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n        }\n\n        /* Mode Button (active) */\n        #acu-visualizer-content .acu-mode-btn.active {\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          border-color: ${t.btnActiveBg} !important;\n        }\n\n        /*  */\n        #acu-visualizer-content .acu-vis-actions {\n          display: flex !important;\n          gap: 6px !important;\n          flex-wrap: wrap !important;\n          justify-content: flex-end !important;\n          flex-shrink: 1 !important;\n          min-width: 0 !important;\n        }\n\n        /* Primary Button */\n        #acu-visualizer-content .acu-btn-primary {\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          border: none !important;\n          padding: 6px 12px !important;\n          border-radius: 4px !important;\n          cursor: pointer !important;\n          font-weight: 600 !important;\n          font-size: 12px !important;\n          white-space: nowrap !important;\n          min-width: unset !important;\n          min-height: unset !important;\n        }\n\n        #acu-visualizer-content .acu-btn-primary:hover {\n          filter: brightness(1.1) !important;\n        }\n\n        /* Secondary Button */\n        #acu-visualizer-content .acu-btn-secondary {\n          background: ${t.btnBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 6px 12px !important;\n          border-radius: 4px !important;\n          cursor: pointer !important;\n          font-size: 12px !important;\n          white-space: nowrap !important;\n          min-width: unset !important;\n          min-height: unset !important;\n        }\n\n        #acu-visualizer-content .acu-btn-secondary:hover {\n          background: ${t.btnHover} !important;\n        }\n        /*  -  */\n        /* Field Row */\n        #acu-visualizer-content .acu-field-row {\n          display: flex !important;\n          align-items: flex-start !important;\n          gap: 12px !important;\n          padding: 10px 0 !important;\n          border-bottom: 1px solid ${t.border} !important;\n          transition: background-color 0.2s ease !important;\n        }\n\n        #acu-visualizer-content .acu-field-row:last-child {\n          border-bottom: none !important;\n        }\n\n        /* Field Label - inline stylejustify-content:space-between */\n        #acu-visualizer-content .acu-field-label {\n          color: ${t.textSub} !important;\n          font-weight: 600 !important;\n          min-width: 140px !important;\n          max-width: 200px !important;\n          font-size: 13px !important;\n          padding-top: 8px !important;\n          user-select: none !important;\n          overflow: visible !important;\n          text-overflow: ellipsis !important;\n          white-space: nowrap !important;\n          /* inline style */\n          justify-content: flex-start !important;\n        }\n\n        /* Field Value Wrapper -  */\n        #acu-visualizer-content .acu-field-value-wrap {\n          flex: 1 1 0 !important;\n          min-width: 0 !important;\n          display: flex !important;\n          flex-direction: row !important;\n          align-items: flex-start !important;\n          gap: 8px !important;\n          width: 100% !important;\n        }\n\n        /*  -  */\n        #acu-visualizer-content .acu-field-value-wrap > .acu-lock-btn {\n          flex-shrink: 0 !important;\n          padding: 4px 6px !important;\n          font-size: 12px !important;\n          border-radius: 4px !important;\n          min-width: unset !important;\n          min-height: unset !important;\n          width: auto !important;\n          height: auto !important;\n        }\n\n        /* Field Value (editable) */\n        #acu-visualizer-content .acu-field-value {\n          background-color: ${t.inputBg} !important;\n          background: ${t.inputBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 8px 12px !important;\n          border-radius: 6px !important;\n          font-size: 14px !important;\n          min-height: 38px !important;\n          /*  */\n          flex: 1 1 0 !important;\n          min-width: 0 !important;\n          width: 100% !important;\n          box-sizing: border-box !important;\n          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\n          cursor: text !important;\n          line-height: 1.5 !important;\n          /*  */\n          white-space: pre-wrap !important;\n          word-wrap: break-word !important;\n          word-break: break-word !important;\n          overflow-wrap: break-word !important;\n        }\n\n        #acu-visualizer-content .acu-field-value:hover {\n          border-color: ${t.accent} !important;\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;\n        }\n\n        #acu-visualizer-content .acu-field-value:focus {\n          border-color: ${t.accent} !important;\n          background-color: ${t.bgPanel} !important;\n          background: ${t.bgPanel} !important;\n          outline: none !important;\n          box-shadow: 0 0 0 3px ${t.accent}33 !important;\n        }\n\n        /*  -  */\n        /* Panel Container */\n        #acu-visualizer-content .acu-config-panel {\n          background: ${t.bgPanel} !important;\n          padding: 20px !important;\n          border-radius: 8px !important;\n        }\n\n        /* Config Section */\n        #acu-visualizer-content .acu-config-section {\n          margin-bottom: 24px !important;\n        }\n\n        #acu-visualizer-content .acu-config-section h4 {\n          color: ${t.textMain} !important;\n          font-size: 16px !important;\n          font-weight: 600 !important;\n          margin-bottom: 12px !important;\n        }\n\n        /* Form Group */\n        #acu-visualizer-content .acu-form-group {\n          margin-bottom: 16px !important;\n        }\n\n        #acu-visualizer-content .acu-form-group label {\n          color: ${t.textSub} !important;\n          display: block !important;\n          margin-bottom: 6px !important;\n          font-weight: 500 !important;\n        }\n\n        /* Form Inputs */\n        #acu-visualizer-content .acu-form-input,\n        #acu-visualizer-content .acu-form-textarea {\n          background: ${t.inputBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 8px 12px !important;\n          border-radius: 4px !important;\n          width: 100% !important;\n        }\n\n        #acu-visualizer-content .acu-form-input:focus,\n        #acu-visualizer-content .acu-form-textarea:focus {\n          border-color: ${t.accent} !important;\n          outline: none !important;\n        }\n\n        /* Hint Text */\n        #acu-visualizer-content .acu-hint {\n          color: ${t.textSub} !important;\n          font-size: 12px !important;\n          opacity: 0.7 !important;\n          margin-top: 4px !important;\n        }\n\n        /* ==========  -  ========== */\n        /*  */\n        #acu-visualizer-content .acu-vis-sidebar {\n          background: ${t.bgNav} !important;\n          border-right: 1px solid ${t.border} !important;\n          padding: 8px !important;\n          overflow-y: auto !important;\n        }\n\n        /* :  -  */\n        #acu-visualizer-content .acu-vis-sidebar button,\n        #acu-visualizer-content [class*=\"acu-table-nav-\"] button,\n        #acu-visualizer-content [class*=\"acu-vis-del-\"] {\n          min-width: unset !important;\n          min-height: unset !important;\n          width: auto !important;\n          height: auto !important;\n          padding: 4px 6px !important;\n          font-size: 12px !important;\n          line-height: 1 !important;\n          border-radius: 4px !important;\n          background: ${t.btnBg} !important;\n          color: ${t.textSub} !important;\n          border: 1px solid ${t.border} !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n          flex-shrink: 0 !important;\n        }\n\n        #acu-visualizer-content .acu-vis-sidebar button:hover,\n        #acu-visualizer-content [class*=\"acu-table-nav-\"] button:hover {\n          background: ${t.btnHover} !important;\n          color: ${t.textMain} !important;\n        }\n\n        /*  */\n        #acu-visualizer-content [class*=\"acu-vis-del-\"]:hover {\n          background: #ff4444 !important;\n          color: #fff !important;\n          border-color: #cc0000 !important;\n        }\n\n        /* Table Nav Item (default) */\n        #acu-visualizer-content .acu-table-nav-item {\n          background: transparent !important;\n          color: ${t.textSub} !important;\n          border: 1px solid transparent !important;\n          padding: 6px 8px !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: space-between !important;\n          gap: 6px !important;\n          border-radius: 6px !important;\n          margin-bottom: 2px !important;\n          font-size: 16px !important;\n        }\n\n        /* Table Nav Item (hover) */\n        #acu-visualizer-content .acu-table-nav-item:hover {\n          background: ${t.btnHover} !important;\n          color: ${t.textMain} !important;\n        }\n\n        /* Table Nav Item (active) */\n        #acu-visualizer-content .acu-table-nav-item.active {\n          background: ${t.btnActiveBg} !important;\n          color: ${t.btnActiveText} !important;\n          border-color: ${t.btnActiveBg} !important;\n        }\n\n        /*  */\n        #acu-visualizer-content .acu-table-nav-content {\n          display: flex !important;\n          align-items: center !important;\n          gap: 6px !important;\n          flex: 1 !important;\n          min-width: 0 !important;\n          overflow: hidden !important;\n        }\n\n        /*  */\n        #acu-visualizer-content .acu-table-nav-actions {\n          display: flex !important;\n          align-items: center !important;\n          gap: 4px !important;\n          flex-shrink: 0 !important;\n        }\n\n        /* Table Name */\n        #acu-visualizer-content .acu-table-name {\n          font-weight: 500 !important;\n          flex: 1 !important;\n          overflow: hidden !important;\n          text-overflow: ellipsis !important;\n          white-space: nowrap !important;\n        }\n\n        /* Table Index */\n        #acu-visualizer-content .acu-table-index {\n          font-size: 10px !important;\n          color: ${t.textSub} !important;\n          opacity: 0.7 !important;\n        }\n\n        /*  */\n        #acu-visualizer-content .acu-add-table-btn {\n          width: 100% !important;\n          margin-top: 8px !important;\n          padding: 8px 12px !important;\n          background: ${t.accent} !important;\n          color: ${t.btnActiveText} !important;\n          border: none !important;\n          border-radius: 6px !important;\n          font-size: 12px !important;\n          cursor: pointer !important;\n          min-width: unset !important;\n          min-height: unset !important;\n        }\n\n        #acu-visualizer-content .acu-add-table-btn:hover {\n          filter: brightness(1.1) !important;\n        }\n\n        /*  -  */\n        .acu-table-order-btn,\n        .acu-vis-del-table-btn,\n        .acu-vis-sidebar .acu-table-order-btn,\n        .acu-vis-sidebar .acu-vis-del-table-btn,\n        .acu-table-nav-actions .acu-table-order-btn,\n        .acu-table-nav-actions .acu-vis-del-table-btn,\n        #acu-visualizer-content .acu-table-order-btn,\n        #acu-visualizer-content .acu-vis-del-table-btn {\n          background: transparent !important;\n          background-color: transparent !important;\n          border: none !important;\n          color: ${t.textSub} !important;\n          opacity: 0.7 !important;\n        }\n\n        .acu-table-order-btn:hover,\n        .acu-vis-del-table-btn:hover,\n        .acu-vis-sidebar .acu-table-order-btn:hover,\n        .acu-vis-sidebar .acu-vis-del-table-btn:hover,\n        .acu-table-nav-actions .acu-table-order-btn:hover,\n        .acu-table-nav-actions .acu-vis-del-table-btn:hover,\n        #acu-visualizer-content .acu-table-order-btn:hover,\n        #acu-visualizer-content .acu-vis-del-table-btn:hover {\n          background: ${t.btnHover} !important;\n          background-color: ${t.btnHover} !important;\n          color: ${t.textMain} !important;\n          opacity: 1 !important;\n        }\n\n        .acu-table-order-btn:disabled,\n        #acu-visualizer-content .acu-table-order-btn:disabled {\n          opacity: 0.3 !important;\n          cursor: not-allowed !important;\n        }\n\n        /*  -  */\n        /* Scrollbar Styles */\n        #acu-visualizer-content ::-webkit-scrollbar {\n          width: 8px !important;\n          height: 8px !important;\n        }\n\n        #acu-visualizer-content ::-webkit-scrollbar-track {\n          background: ${t.bgNav} !important;\n          border-radius: 4px !important;\n        }\n\n        #acu-visualizer-content ::-webkit-scrollbar-thumb {\n          background: ${t.btnBg} !important;\n          border-radius: 4px !important;\n          border: 2px solid ${t.bgNav} !important;\n        }\n\n        #acu-visualizer-content ::-webkit-scrollbar-thumb:hover {\n          background: ${t.btnHover} !important;\n        }\n\n        /* Responsive Styles */\n        @media (max-width: 768px) {\n          /*  -  */\n          #acu-visualizer-content .acu-vis-toolbar {\n            flex-direction: column !important;\n            align-items: stretch !important;\n            padding: 8px !important;\n            gap: 8px !important;\n          }\n\n          #acu-visualizer-content .acu-mode-switch {\n            width: 100% !important;\n            justify-content: center !important;\n          }\n\n          #acu-visualizer-content .acu-mode-btn {\n            flex: 1 !important;\n            text-align: center !important;\n            padding: 8px 6px !important;\n          }\n\n          #acu-visualizer-content .acu-vis-actions {\n            width: 100% !important;\n            justify-content: center !important;\n          }\n\n          #acu-visualizer-content .acu-btn-primary,\n          #acu-visualizer-content .acu-btn-secondary {\n            flex: 1 !important;\n            text-align: center !important;\n            padding: 8px 10px !important;\n          }\n\n          #acu-visualizer-content .acu-vis-header {\n            flex-direction: column !important;\n            height: auto !important;\n            padding: 10px !important;\n          }\n\n          #acu-visualizer-content .acu-vis-sidebar {\n            width: 100% !important;\n            border-right: none !important;\n            border-bottom: 1px solid ${t.border} !important;\n            max-height: 200px !important;\n            overflow-y: auto !important;\n          }\n\n          #acu-visualizer-content .acu-vis-content {\n            flex-direction: column !important;\n          }\n\n          #acu-visualizer-content .acu-card-grid {\n            grid-template-columns: 1fr !important;\n            padding: 10px !important;\n          }\n\n          #acu-visualizer-content .acu-field-row {\n            flex-direction: column !important;\n            align-items: stretch !important;\n          }\n\n          #acu-visualizer-content .acu-field-label {\n            min-width: unset !important;\n            width: 100% !important;\n            padding-bottom: 4px !important;\n          }\n\n          #acu-visualizer-content .acu-vis-actions {\n            justify-content: center !important;\n            width: 100% !important;\n            margin-top: 10px !important;\n          }\n        }\n\n        /*  -  */\n        /* Column List */\n        #acu-visualizer-content .acu-col-list {\n          display: flex !important;\n          flex-direction: column !important;\n          gap: 8px !important;\n          padding: 8px 0 !important;\n        }\n\n        /* Column Item */\n        #acu-visualizer-content .acu-col-item {\n          background: ${t.btnBg} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 8px 12px !important;\n          border-radius: 6px !important;\n          display: flex !important;\n          align-items: center !important;\n          gap: 8px !important;\n          transition: all 0.2s ease !important;\n        }\n\n        #acu-visualizer-content .acu-col-item:hover {\n          background: ${t.btnHover} !important;\n        }\n\n        /* Column Input */\n        #acu-visualizer-content .acu-col-input {\n          background-color: ${t.inputBg} !important;\n          background: ${t.inputBg} !important;\n          color: ${t.textMain} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 6px 10px !important;\n          border-radius: 4px !important;\n          flex: 1 !important;\n          font-size: 13px !important;\n        }\n\n        #acu-visualizer-content .acu-col-input:focus {\n          border-color: ${t.accent} !important;\n          outline: none !important;\n        }\n\n        /* Column Delete Button */\n        #acu-visualizer-content .acu-col-btn {\n          background: ${t.btnBg} !important;\n          color: ${t.textSub} !important;\n          border: 1px solid ${t.border} !important;\n          padding: 4px 8px !important;\n          border-radius: 4px !important;\n          cursor: pointer !important;\n          transition: all 0.2s ease !important;\n        }\n\n        #acu-visualizer-content .acu-col-btn:hover {\n          background: #ff4444 !important;\n          color: #fff !important;\n          border-color: #cc0000 !important;\n        }\n      </style>\n    `;\n\n    for (const $ of targets) {\n      $('#dice-db-theme-sync').remove();\n      $('head').append(css);\n    }\n  } catch (e) {\n    // \n  }\n}\n\nconst DB_TOAST_MUTE_STYLE_ID = 'dice-db-toast-mute';\n\nconst collectDatabaseToastDocuments = (): Document[] => {\n  const docs: Document[] = [];\n  const tryAddDoc = (w: Window | null | undefined) => {\n    try {\n      const doc = w?.document;\n      if (doc && !docs.includes(doc)) docs.push(doc);\n    } catch {\n      return;\n    }\n  };\n\n  tryAddDoc(window);\n  tryAddDoc(window.parent);\n  tryAddDoc(window.top);\n  return docs;\n};\n\nexport function setDatabaseToastMute(enabled: boolean) {\n  try {\n    const css = `\n#toast-container .acu-toast,\n.toast.acu-toast,\n.acu-toast.toast {\n  display: none !important;\n}\n`;\n    const docs = collectDatabaseToastDocuments();\n    for (const doc of docs) {\n      const existing = doc.getElementById(DB_TOAST_MUTE_STYLE_ID);\n      if (enabled) {\n        if (!existing) {\n          const style = doc.createElement('style');\n          style.id = DB_TOAST_MUTE_STYLE_ID;\n          style.textContent = css;\n          (doc.head || doc.documentElement).appendChild(style);\n        }\n        doc.querySelectorAll('.acu-toast').forEach(node => node.remove());\n      } else if (existing) {\n        existing.remove();\n      }\n    }\n  } catch {\n    return;\n  }\n}\n","// @ts-nocheck\nimport { ELEMENT_EMOJI_MAP, LOCATION_EMOJI_MAP, RELATION_ICON_MAP } from './emoji-maps';\nimport { MAIN_STYLES } from './styles';\nimport { injectDatabaseStyles, setDatabaseToastMute } from './database-ui-override';\n\n(function () {\n  'use strict';\n\n  const SCRIPT_ID = 'acu_visualizer_ui_v19_6_ai_overlay';\n  // ========================================\n  //  ()\n  const PRIMARY_KEYS = {\n    : null,\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n    : '',\n  };\n\n  /**\n   * \n   * @param tableName \n   * @param row \n   * @param headers \n   */\n  function getRowKey(tableName, row, headers) {\n    const pkField = PRIMARY_KEYS[tableName];\n    if (pkField === null) return '_row_0';\n\n    let fieldIndex = 1;\n    if (pkField) {\n      const idx = headers.indexOf(pkField);\n      if (idx !== -1) fieldIndex = idx;\n    }\n\n    if (!row[fieldIndex]) return null;\n    return `${pkField || headers[fieldIndex]}=${row[fieldIndex]}`;\n  }\n\n  // ========================================\n  // - (LockManager -> GodDB API)\n  // ========================================\n\n  /**\n   * -API\n   * @returns APInull\n   */\n  function getDbLockAPI(): any {\n    // iframe\n    let topWindow: Window = window;\n    try {\n      while (topWindow.parent && topWindow.parent !== topWindow) {\n        topWindow = topWindow.parent;\n      }\n    } catch (e) {\n      // parentwindow\n    }\n\n    // \n    const api = (topWindow as any).AutoCardUpdaterAPI || (window as any).AutoCardUpdaterAPI;\n    return api || null;\n  }\n\n  /**\n   * sheetKey\n   * @param tableName - \"\"\n   * @returns sheetKey\"sheet_0\"null\n   */\n  function getSheetKeyByTableName(tableName: string): string | null {\n    const api = getDbLockAPI();\n    if (!api || typeof api.exportTableAsJson !== 'function') return null;\n\n    try {\n      const data = api.exportTableAsJson() as Record<string, { name: string; content: (string | number | null)[][] }>;\n      if (!data) return null;\n\n      for (const key in data) {\n        if (key.startsWith('sheet_') && data[key]?.name === tableName) {\n          return key;\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]getSheetKeyByTableName :', e);\n    }\n    return null;\n  }\n\n  /**\n   * \n   * @param sheetKey - \n   * @param tableName - \n   * @param primaryKeyValue -  \"=\" \n   * @returns 0null\n   */\n  function findRowIndexByPrimaryKey(sheetKey: string, tableName: string, primaryKeyValue: string): number | null {\n    const api = getDbLockAPI();\n    if (!api || typeof api.exportTableAsJson !== 'function') return null;\n\n    try {\n      const data = api.exportTableAsJson() as Record<string, { name: string; content: (string | number | null)[][] }>;\n      const sheet = data?.[sheetKey];\n      if (!sheet || !sheet.content || !Array.isArray(sheet.content) || sheet.content.length < 2) {\n        return null;\n      }\n\n      const headers = sheet.content[0] as string[];\n      const pkField = PRIMARY_KEYS[tableName as keyof typeof PRIMARY_KEYS];\n\n      // \n      if (pkField === null) {\n        return primaryKeyValue === '_row_0' ? 0 : null;\n      }\n\n      if (!pkField) return null;\n\n      const pkIndex = headers.indexOf(pkField);\n      if (pkIndex === -1) {\n        console.warn(`[DICE]findRowIndexByPrimaryKey:  ${tableName}  ${pkField}`);\n        return null;\n      }\n\n      //  primaryKeyValue\n      // getRowKey() : \"=\" ->  \"\"\n      let actualValue = primaryKeyValue;\n      const eqIdx = primaryKeyValue.indexOf('=');\n      if (eqIdx !== -1) {\n        actualValue = primaryKeyValue.substring(eqIdx + 1);\n      }\n\n      // 1\n      for (let i = 1; i < sheet.content.length; i++) {\n        const row = sheet.content[i];\n        if (row && String(row[pkIndex]) === String(actualValue)) {\n          // - rowIndex  0  content[1]\n          return i - 1;\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]findRowIndexByPrimaryKey :', e);\n    }\n    return null;\n  }\n\n  // ========================================\n  // BookmarkManager - \n  // ========================================\n  const BookmarkManager = {\n    STORAGE_KEY_PREFIX: 'acu_bookmarks_v1_',\n    MAX_CONTEXTS: 20, // bookmark\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    // bookmark N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) {\n          // \n          return;\n        }\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(\n            `[DICE]BookmarkManager  ${toDelete.length} bookmark ${this.MAX_CONTEXTS}  ${allKeys.length} `,\n          );\n        }\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    isBookmarked(tableName, rowKey) {\n      const data = this._load();\n      return !!(data[tableName] && data[tableName][rowKey]);\n    },\n\n    toggleBookmark(tableName, rowKey) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      if (data[tableName][rowKey]) {\n        // bookmark\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n      } else {\n        // bookmark\n        data[tableName][rowKey] = true;\n      }\n      this._save();\n    },\n\n    getBookmarks(tableName) {\n      const data = this._load();\n      if (!data[tableName]) return [];\n      return Object.keys(data[tableName]);\n    },\n\n    // bookmark\n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  const escapeHtml = s =>\n    String(s ?? '')\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n\n  /**\n   * \n   * - PC mousedown  mouseup \n   * - Mobile\n   * @param $overlay jQuery\n   * @param overlayClass \n   * @param onClose \n   */\n  const setupOverlayClose = ($overlay: JQuery, overlayClass: string, onClose: () => void) => {\n    const isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n\n    if (isMobile) {\n      // Mobile: \n      $overlay.on('click', function (e) {\n        if ($(e.target).hasClass(overlayClass)) {\n          onClose();\n        }\n      });\n    } else {\n      // PC:  mousedown  mouseup \n      let mouseDownOnOverlay = false;\n\n      $overlay.on('mousedown', function (e) {\n        mouseDownOnOverlay = $(e.target).hasClass(overlayClass);\n      });\n\n      $overlay.on('mouseup', function (e) {\n        if (mouseDownOnOverlay && $(e.target).hasClass(overlayClass)) {\n          onClose();\n        }\n        mouseDownOnOverlay = false;\n      });\n    }\n  };\n\n  // [] \n  const generateUniqueName = (baseName: string, existingNames: string[]): string => {\n    if (!existingNames.includes(baseName)) return baseName;\n    let counter = 2;\n    let newName = `${baseName} (${counter})`;\n    while (existingNames.includes(newName)) {\n      counter++;\n      newName = `${baseName} (${counter})`;\n    }\n    return newName;\n  };\n\n  // [] \n  const showPresetConflictDialog = (options: {\n    presetName: string;\n    presetType: string;\n    onOverwrite: () => void;\n    onRename: (newName: string) => void;\n    onCancel: () => void;\n    existingNames: string[];\n  }) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const config = getConfig();\n    const suggestedName = generateUniqueName(options.presetName, options.existingNames);\n\n    const dialogHtml = `\n      <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-import-confirm-dialog\">\n          <div class=\"acu-import-confirm-header\">\n            <i class=\"fa-solid fa-file-import\"></i> ${options.presetType}\n          </div>\n          <div class=\"acu-import-confirm-body\">\n            <div class=\"acu-import-warning-container\">\n              <i class=\"fa-solid fa-exclamation-triangle acu-import-warning-icon\"></i>\n              <div class=\"acu-import-warning-title\"></div>\n              <div class=\"acu-import-warning-message\">${escapeHtml(options.presetName)}</div>\n            </div>\n            <div class=\"acu-import-conflict-options\">\n              <label class=\"acu-import-radio\">\n                <input type=\"radio\" name=\"preset-conflict-mode\" value=\"overwrite\" checked />\n                <span></span>\n              </label>\n              <label class=\"acu-import-radio\">\n                <input type=\"radio\" name=\"preset-conflict-mode\" value=\"rename\" />\n                <span>${escapeHtml(suggestedName)}</span>\n              </label>\n            </div>\n          </div>\n          <div class=\"acu-import-confirm-footer\">\n            <button class=\"acu-import-cancel-btn\"></button>\n            <button class=\"acu-import-confirm-btn\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n      position: fixed !important;\n      top: 0 !important;\n      left: 0 !important;\n      right: 0 !important;\n      bottom: 0 !important;\n      width: 100vw !important;\n      height: 100vh !important;\n      background: rgba(0,0,0,0.6) !important;\n      z-index: 31300 !important;\n      display: flex;\n      justify-content: center !important;\n      align-items: center !important;\n      padding: 16px;\n      box-sizing: border-box !important;\n    `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(() => {\n      closeDialog();\n      options.onCancel();\n    });\n\n    setupOverlayClose($dialog, 'acu-import-confirm-overlay', () => {\n      closeDialog();\n      options.onCancel();\n    });\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const mode = $dialog.find('input[name=\"preset-conflict-mode\"]:checked').val();\n      closeDialog();\n      if (mode === 'overwrite') {\n        options.onOverwrite();\n      } else {\n        options.onRename(suggestedName);\n      }\n    });\n  };\n  // [] \n  const smartInsertToTextarea = (newContent, contentType) => {\n    // contentType: 'action' ()  'dice' ()\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = ($ta.val() || '').trim();\n\n    // \n    // : \"XX\"\n    const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n    // \n    // : \"  vs    (...)  ......  (...)  .........\"\n    const contestDiceRegex =\n      /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n    // <user>\n    const actionRegex = /<user>(?:(?!<user>).)*?[]/g;\n\n    // \n    const placeholderRegex = /\\[\\]/g;\n\n    // [] \n    const diceCfg = getDiceConfig();\n    let contentToInsert = newContent;\n    let shouldSaveOriginal = false;\n    if (contentType === 'dice' && diceCfg.hideDiceResultFromUser) {\n      contentToInsert = '[]';\n      shouldSaveOriginal = true;\n    }\n\n    // \n    if (!currentVal) {\n      $ta.val(contentToInsert).trigger('input').trigger('change');\n      // []  data \n      if (contentType === 'dice') {\n        $ta.data('acu-original-dice-text', newContent);\n        // []  DOM  getter  jQuery\n        const textarea = $ta[0] as any;\n        textarea._acuOriginalDiceText = newContent;\n        textarea._acuHasDiceData = true;\n      }\n      return;\n    }\n\n    // \n    let workingText = currentVal;\n    let existingAction = '';\n    let existingDice = '';\n    let existingDiceOriginal = '';\n\n    // [] 0. \n    if (placeholderRegex.test(workingText)) {\n      // \n      const originalText = $ta.data('acu-original-dice-text') || '';\n      if (originalText) {\n        // \n        workingText = workingText.replace(placeholderRegex, originalText);\n        existingDice = originalText;\n        existingDiceOriginal = originalText;\n      } else {\n        // \n        workingText = workingText.replace(placeholderRegex, '').trim();\n      }\n    }\n\n    // 1. \n    const contestMatches = workingText.match(contestDiceRegex);\n    if (contestMatches && contestMatches.length > 0) {\n      existingDice = contestMatches[contestMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(contestDiceRegex, '\\u0000').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted contest roll:', existingDice);\n    }\n\n    // 2. \n    const normalMatches = workingText.match(normalDiceRegex);\n    if (normalMatches && normalMatches.length > 0) {\n      // \n      existingDice = normalMatches[normalMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(normalDiceRegex, '\\u0000').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted normal roll:', existingDice);\n    }\n\n    // 3. \n    const actionMatches = workingText.match(actionRegex);\n    if (actionMatches && actionMatches.length > 0) {\n      existingAction = actionMatches[actionMatches.length - 1];\n      workingText = workingText.replace(actionRegex, '\\u0001').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted action:', existingAction);\n    }\n\n    // 4. \n    let userInput = workingText\n      .replace(/[\\u0000\\u0001]/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .trim();\n\n    // 5. \n    if (contentType === 'dice') {\n      // [] \n      existingDice = contentToInsert;\n      existingDiceOriginal = newContent;\n      //  data \n      $ta.data('acu-original-dice-text', newContent);\n      // []  DOM  getter  jQuery\n      const textarea = $ta[0] as any;\n      textarea._acuOriginalDiceText = newContent;\n      textarea._acuHasDiceData = true;\n    } else if (contentType === 'action') {\n      existingAction = newContent;\n    }\n\n    // 6.  +  + \n    const parts = [];\n    if (userInput) parts.push(userInput);\n    if (existingAction) parts.push(existingAction);\n    if (existingDice) parts.push(existingDice);\n\n    const finalVal = parts.join(' ');\n    $ta.val(finalVal).trigger('input').trigger('change');\n  };\n\n  // [] \n  const restoreDiceResultBeforeSend = () => {\n    const { $ } = getCore();\n    const diceCfg = getDiceConfig();\n    const hideInput = diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n    if (hideInput) return;\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = $ta.val() || '';\n    const originalText = $ta.data('acu-original-dice-text');\n\n    // \n    if (currentVal.includes('[]') && originalText) {\n      const restoredVal = currentVal.replace(/\\[\\]/g, originalText);\n      $ta.val(restoredVal);\n      // \n      $ta.removeData('acu-original-dice-text');\n      // []  DOM \n      const textarea = $ta[0] as any;\n      textarea._acuOriginalDiceText = null;\n      textarea._acuHasDiceData = false;\n    }\n  };\n\n  // []  value \n  const interceptTextareaValue = () => {\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const textarea = $ta[0] as HTMLTextAreaElement;\n    if (!textarea || (textarea as any)._acuValueIntercepted) return;\n\n    // \n    (textarea as any)._acuValueIntercepted = true;\n\n    //  value \n    const originalDescriptor = Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype, 'value');\n    const originalValue = textarea.value;\n\n    //  value  getter\n    Object.defineProperty(textarea, 'value', {\n      get: function (this: HTMLTextAreaElement) {\n        // \n        let val: string;\n        if (originalDescriptor && originalDescriptor.get) {\n          val = originalDescriptor.get.call(this);\n        } else {\n          val = (this as any)._value || originalValue || '';\n        }\n\n        // [] \n        //  DOM  jQuery data getter  jQuery\n        //  ) \n        if (!(this as any)._acuHasDiceData) {\n          return val;\n        }\n\n        // \n        const originalText = (this as any)._acuOriginalDiceText;\n        if (val && typeof val === 'string' && val.includes('[]') && originalText) {\n          return val.replace(/\\[\\]/g, originalText);\n        }\n        return val;\n      },\n      set: function (this: HTMLTextAreaElement, val: string) {\n        if (originalDescriptor && originalDescriptor.set) {\n          originalDescriptor.set.call(this, val);\n        } else {\n          (this as any)._value = val;\n        }\n      },\n      configurable: true,\n    });\n  };\n  const STORAGE_KEY_TABLE_ORDER = 'acu_table_order';\n  const STORAGE_KEY_ACTION_ORDER = 'acu_action_order';\n\n  const STORAGE_KEY_ACTIVE_TAB = 'acu_active_tab';\n  const STORAGE_KEY_UI_CONFIG = 'acu_ui_config_v19';\n  const STORAGE_KEY_LAST_SNAPSHOT = 'acu_data_snapshot_v19';\n  const STORAGE_KEY_IS_COLLAPSED = 'acu_ui_collapsed_state';\n  const STORAGE_KEY_OPTIONS_COLLAPSED = 'acu_options_collapsed'; // [] \n  const STORAGE_KEY_DASHBOARD_ACTIVE = 'acu_dashboard_active';\n  // [] \n  const STORAGE_KEY_TABLE_HEIGHTS = 'acu_table_heights_v19';\n  const STORAGE_KEY_TABLE_STYLES = 'acu_table_styles_v19';\n  const STORAGE_KEY_HIDDEN_TABLES = 'acu_hidden_tables_v19';\n  const STORAGE_KEY_GM_CONFIG = 'acu_gm_engine_config_v1';\n  const STORAGE_KEY_REVERSE_TABLES = 'acu_reverse_tables_v1';\n  const MAX_ACTION_BUTTONS = 6; // \n  const MIN_PANEL_HEIGHT = 200; // \n  const MAX_PANEL_HEIGHT = 1200; // \n\n  const STORAGE_KEY_DICE_CONFIG = 'acu_dice_config_v1';\n  const STORAGE_KEY_ATTRIBUTE_PRESETS = 'acu_attribute_presets_v1';\n  const STORAGE_KEY_ACTIVE_ATTR_PRESET = 'acu_active_attr_preset_v1';\n  const STORAGE_KEY_ACTION_PRESETS = 'acu_action_presets_v1';\n  const STORAGE_KEY_ACTIVE_ACTION_PRESET = 'acu_active_action_preset_v1';\n  const STORAGE_KEY_CRAZY_MODE = 'acu_dice_crazy_mode';\n  const DEFAULT_CRAZY_MODE_CONFIG = {\n    enabled: false,\n    crazyLevel: 50,\n    playerWeight: 80,\n    inSceneNpcWeight: 15,\n    offSceneNpcWeight: 5,\n  };\n  const PRESET_FORMAT_VERSION = '1.6.6'; // \n  const SCRIPT_VERSION = 'v3.90'; // \n\n  //  \"x.y.z\"\n  const compareVersion = (v1, v2) => {\n    // \n    const normalizeVersion = v => {\n      if (typeof v === 'number') return `${v}.0.0`;\n      if (typeof v !== 'string') return '0.0.0';\n      return v;\n    };\n    const nv1 = normalizeVersion(v1);\n    const nv2 = normalizeVersion(v2);\n    const parts1 = nv1.split('.').map(Number);\n    const parts2 = nv2.split('.').map(Number);\n    for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {\n      const p1 = parts1[i] || 0;\n      const p2 = parts2[i] || 0;\n      if (p1 < p2) return -1;\n      if (p1 > p2) return 1;\n    }\n    return 0;\n  };\n\n  const STORAGE_KEY_AVATAR_MAP = 'acu_avatar_map_v1';\n  const STORAGE_KEY_MAP_FOCUS = 'acu_map_focus_v1';\n\n  // ========================================\n  // ConsoleCaptureManager - Console\n  // ========================================\n  const ConsoleCaptureManager = {\n    logs: [],\n    maxLogs: 1000,\n    filters: { log: true, info: true, warn: true, error: true },\n    originalMethods: {},\n    isIntercepted: false,\n    enabled: false, // \n\n    restore() {\n      //  localStorage \n      const saved = localStorage.getItem('acu_console_capture_enabled');\n      if (saved === 'true') {\n        this.enable();\n      }\n    },\n\n    enable() {\n      if (this.enabled) return;\n      this.enabled = true;\n      localStorage.setItem('acu_console_capture_enabled', 'true');\n      this.intercept();\n    },\n\n    disable() {\n      if (!this.enabled) return;\n      this.enabled = false;\n      localStorage.setItem('acu_console_capture_enabled', 'false');\n      // \n      localStorage.removeItem('acu_script_error_detected');\n      // \n      const emergencyBtn = document.getElementById('acu-emergency-debug-btn');\n      if (emergencyBtn) {\n        emergencyBtn.style.display = 'none';\n      }\n    },\n\n    intercept() {\n      if (this.isIntercepted) return;\n      this.isIntercepted = true;\n\n      ['log', 'info', 'warn', 'error'].forEach(type => {\n        this.originalMethods[type] = console[type];\n        const self = this;\n        console[type] = function (...args) {\n          // \n          self.originalMethods[type].apply(console, args);\n          // \n          if (self.enabled) {\n            self.capture(type, args);\n          }\n        };\n      });\n    },\n\n    capture(type, args) {\n      if (!this.enabled) return; // \n      try {\n        const timestamp = new Date();\n        const timeStr = timestamp.toLocaleTimeString('zh-CN', { hour12: false });\n\n        // \n        const content = args\n          .map(arg => {\n            if (typeof arg === 'object') {\n              try {\n                return JSON.stringify(arg, null, 2);\n              } catch {\n                return String(arg);\n              }\n            }\n            return String(arg);\n          })\n          .join(' ');\n\n        // error\n        let stack = null;\n        if (type === 'error' && args[0] instanceof Error) {\n          stack = args[0].stack || null;\n        }\n\n        const logEntry = {\n          id: Date.now() + Math.random(),\n          timestamp,\n          timeStr,\n          type,\n          content,\n          stack,\n          rawArgs: args,\n        };\n\n        this.logs.push(logEntry);\n\n        // \n        if (this.logs.length > this.maxLogs) {\n          this.logs.shift();\n        }\n      } catch (e) {\n        // console\n      }\n    },\n\n    clear() {\n      this.logs = [];\n    },\n\n    getFilteredLogs() {\n      return this.logs.filter(log => this.filters[log.type]);\n    },\n\n    setFilters(filters) {\n      this.filters = { ...this.filters, ...filters };\n    },\n  };\n\n  // \n  // ConsoleCaptureManager.intercept();\n\n  // ========================================\n  // \n  // ========================================\n  const ErrorHandler = {\n    errorCount: 0,\n    errorThreshold: 3, // 3\n    lastErrorTime: 0,\n    errorWindow: 5000, // 5\n    fatalErrorDetected: false,\n\n    // \n    isFatalError(error, source, lineno, colno, stack) {\n      // \n      const thirdPartyPatterns = [/jquery/i, /lodash/i, /vue/i, /react/i, /pixi/i, /gsap/i, /toastr/i, /node_modules/i];\n\n      const errorInfo = stack || error?.stack || '';\n      const errorSource = source || '';\n\n      // \n      for (const pattern of thirdPartyPatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          return false;\n        }\n      }\n\n      // \n      const corePatterns = [\n        /acu_visualizer/i,\n        //i,\n        /LockManager/i,\n        /Store/i,\n        /ConsoleCaptureManager/i,\n        /renderInterface/i,\n        /init\\s*\\(/i,\n      ];\n\n      let isCoreError = false;\n      for (const pattern of corePatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          isCoreError = true;\n          break;\n        }\n      }\n\n      // \n      return isCoreError;\n    },\n\n    // \n    handleError(error, source, lineno, colno, stack) {\n      try {\n        // \n        if (!this.isFatalError(error, source, lineno, colno, stack)) {\n          return; // \n        }\n\n        const now = Date.now();\n\n        // \n        if (now - this.lastErrorTime > this.errorWindow) {\n          this.errorCount = 0;\n        }\n\n        this.errorCount++;\n        this.lastErrorTime = now;\n\n        // \n        if (this.errorCount >= this.errorThreshold && !this.fatalErrorDetected) {\n          this.fatalErrorDetected = true;\n          this.triggerFatalError();\n        }\n      } catch (e) {\n        // \n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    triggerFatalError() {\n      try {\n        //  console \n        if (!ConsoleCaptureManager.enabled) {\n          ConsoleCaptureManager.enable();\n        }\n\n        // \n        localStorage.setItem('acu_script_error_detected', 'true');\n\n        // \n        this.showEmergencyButton();\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    showEmergencyButton() {\n      try {\n        // \n        let btn = document.getElementById('acu-emergency-debug-btn');\n        if (btn) {\n          btn.style.display = 'block';\n          return;\n        }\n\n        // \n        btn = document.createElement('button');\n        btn.id = 'acu-emergency-debug-btn';\n        btn.innerHTML = '<i class=\"fa-solid fa-bug\"></i> ';\n        btn.style.cssText = `\n          position: fixed;\n          bottom: 20px;\n          right: 20px;\n          z-index: 99999;\n          padding: 10px 16px;\n          background: #e74c3c;\n          color: #fff;\n          border: none;\n          border-radius: 6px;\n          font-size: 14px;\n          font-weight: bold;\n          cursor: pointer;\n          box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);\n          display: flex;\n          align-items: center;\n          gap: 6px;\n          transition: all 0.2s;\n        `;\n\n        btn.onmouseenter = function () {\n          this.style.background = '#c0392b';\n          this.style.transform = 'scale(1.05)';\n        };\n        btn.onmouseleave = function () {\n          this.style.background = '#e74c3c';\n          this.style.transform = 'scale(1)';\n        };\n\n        btn.onclick = function () {\n          try {\n            //  showDebugConsoleModal\n            if (typeof window.showDebugConsoleModal === 'function') {\n              window.showDebugConsoleModal();\n            } else {\n              // \n              alert('F12');\n            }\n          } catch (e) {\n            console.error('[DICE]:', e);\n            alert('F12');\n          }\n        };\n\n        document.body.appendChild(btn);\n      } catch (e) {\n        console.error('[DICE]:', e);\n      }\n    },\n\n    // \n    checkAndRestore() {\n      try {\n        const errorDetected = localStorage.getItem('acu_script_error_detected') === 'true';\n        if (errorDetected) {\n          //  console \n          if (!ConsoleCaptureManager.enabled) {\n            ConsoleCaptureManager.enable();\n          }\n          // \n          this.showEmergencyButton();\n        }\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n  };\n\n  // \n  window.onerror = function (message, source, lineno, colno, error) {\n    ErrorHandler.handleError(error || message, source, lineno, colno, error?.stack);\n    return false; // \n  };\n\n  //  Promise \n  window.addEventListener('unhandledrejection', function (event) {\n    ErrorHandler.handleError(event.reason, null, null, null, event.reason?.stack);\n  });\n\n  // \n  //  init \n\n  // ========================================\n  //  -  (Phase 1.1)\n  // ========================================\n\n  /**\n   * \n   * - replace: \n   * - extract: ()\n   * - delete: \n   * - validate: (ValidationEngine,)\n   */\n  type RegexOperation = 'replace' | 'extract' | 'delete' | 'validate';\n\n  /**\n   * \n   * - global: \n   * - table: \n   * - column: \n   */\n  type RegexScopeType = 'global' | 'table' | 'column';\n\n  /**\n   * \n   * - auto: \n   * - manual: \n   * - preview: ,\n   */\n  type RegexExecutionMode = 'auto' | 'manual' | 'preview';\n\n  /**\n   * \n   */\n  interface RegexFlags {\n    caseInsensitive?: boolean; // i - \n    global?: boolean; // g - \n    multiline?: boolean; // m - \n    unicode?: boolean; // u - Unicode\n    sticky?: boolean; // y - \n  }\n\n  /**\n   * \n   */\n  interface RegexScopeConfig {\n    type: RegexScopeType;\n    tableNames?: string[]; // tablecolumn\n    columnNames?: string[]; // column\n  }\n\n  /**\n   * \n   */\n  interface RegexSecurityConfig {\n    maxMatchTime: number; // (),100\n    maxMatches: number; // ,1000\n    maxInputLength: number; // ,10000\n  }\n\n  /**\n   * \n   */\n  interface RegexTestCase {\n    input: string;\n    expected: string;\n    description?: string;\n  }\n\n  /**\n   * \n   */\n  interface RegexTransformationRule {\n    id: string; // \n    name: string; // \n    description?: string; // \n    operation: RegexOperation; // \n    pattern: string; // \n    flags?: RegexFlags; // \n    replacement?: string; // (replace)\n    scope: RegexScopeConfig; // \n    enabled: boolean; // \n    priority: number; // (1-100),\n    executeMode: RegexExecutionMode; // \n    testCases?: RegexTestCase[]; // \n    security?: RegexSecurityConfig; // \n    createdAt?: number; // \n    updatedAt?: number; // \n  }\n\n  /**\n   * \n   */\n  interface RegexTransformResult {\n    success: boolean;\n    oldValue: string;\n    newValue: string;\n    matched: boolean;\n    error?: string;\n  }\n\n  /**\n   * \n   */\n  interface RegexBatchTransformResult {\n    tableName: string;\n    columnIndex: number;\n    rowIndex: number;\n    result: RegexTransformResult;\n  }\n\n  /**\n   * \n   */\n  interface RegexPreviewResult {\n    rule: RegexTransformationRule;\n    affectedCells: Array<{\n      tableName: string;\n      rowIndex: number;\n      columnIndex: number;\n      columnName: string;\n      oldValue: string;\n      newValue: string;\n    }>;\n    totalAffected: number;\n  }\n\n  /**\n   * \n   */\n  interface RegexPreset {\n    id: string;\n    name: string;\n    description?: string;\n    version: string;\n    rules: RegexTransformationRule[];\n    createdAt?: number;\n    updatedAt?: number;\n  }\n\n  // \n  const STORAGE_KEY_REGEX_RULES = 'acu_regex_rules_v1';\n  const STORAGE_KEY_REGEX_PRESETS = 'acu_regex_presets_v1';\n  const STORAGE_KEY_REGEX_ACTIVE_PRESET = 'acu_regex_active_preset_v1';\n  const STORAGE_KEY_REGEX_ENABLED = 'acu_regex_enabled_v1';\n\n  // ========================================\n  //  (Tavern Regex Import)\n  // ========================================\n\n  /**\n   * \n   * @see https://docs.sillytavern.app/usage/core-concepts/regex/\n   */\n  interface TavernRegex {\n    id?: string;\n    scriptName: string;\n    findRegex: string;\n    replaceString: string;\n    trimStrings?: string[];\n    placement?: number[];\n    disabled?: boolean;\n    markdownOnly?: boolean;\n    promptOnly?: boolean;\n    runOnEdit?: boolean;\n    substituteRegex?: number;\n    minDepth?: number | null;\n    maxDepth?: number | null;\n  }\n\n  /**\n   *  findRegex \n   * : /pattern/flags\n   */\n  function parseTavernFindRegex(findRegex: string): { pattern: string; flags: RegexFlags } {\n    //  /pattern/flags \n    const match = findRegex.match(/^\\/(.+)\\/([gimsuy]*)$/s);\n    if (match) {\n      const [, pattern, flagStr] = match;\n      return {\n        pattern,\n        flags: {\n          global: flagStr.includes('g'),\n          caseInsensitive: flagStr.includes('i'),\n          multiline: flagStr.includes('m'),\n          unicode: flagStr.includes('u'),\n          sticky: flagStr.includes('y'),\n        },\n      };\n    }\n    // pattern\n    return { pattern: findRegex, flags: { global: true } };\n  }\n\n  /**\n   *  RegexTransformationRule\n   */\n  function convertTavernRegexToRule(tavernRegex: TavernRegex): RegexTransformationRule {\n    const { pattern, flags } = parseTavernFindRegex(tavernRegex.findRegex);\n\n    // \n    const extraInfo: string[] = [];\n    if (tavernRegex.placement?.length) extraInfo.push(`placement: [${tavernRegex.placement.join(',')}]`);\n    if (tavernRegex.markdownOnly) extraInfo.push('markdownOnly');\n    if (tavernRegex.promptOnly) extraInfo.push('promptOnly');\n    if (tavernRegex.minDepth != null) extraInfo.push(`minDepth: ${tavernRegex.minDepth}`);\n    if (tavernRegex.maxDepth != null) extraInfo.push(`maxDepth: ${tavernRegex.maxDepth}`);\n\n    const description = extraInfo.length > 0 ? `[] ${extraInfo.join(', ')}` : '[]';\n\n    return {\n      id: `tavern_import_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      name: tavernRegex.scriptName,\n      description,\n      operation: 'replace',\n      pattern,\n      flags,\n      replacement: tavernRegex.replaceString || '',\n      scope: { type: 'global' },\n      enabled: !tavernRegex.disabled,\n      priority: 50,\n      executeMode: tavernRegex.runOnEdit ? 'auto' : 'manual',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n      createdAt: Date.now(),\n      updatedAt: Date.now(),\n    };\n  }\n\n  // ========================================\n  //  (Phase 2.2)\n  // ========================================\n  const BUILTIN_REGEX_RULES: RegexTransformationRule[] = [\n    // \n    {\n      id: 'builtin_clear_extreme_words',\n      name: '',\n      description: 'AI',\n      operation: 'replace',\n      pattern: '||||||||',\n      flags: { global: false, caseInsensitive: false, multiline: false },\n      replacement: '',\n      scope: { type: 'global' },\n      enabled: true,\n      priority: 50,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // \n    {\n      id: 'builtin_remove_cliche',\n      name: '',\n      description: 'AI',\n      operation: 'replace',\n      pattern:\n        '(+)|(?)([]?)|(?)(|)(|)([]?)|(|)(||)([]?)|([^]*?)(||)(.*?)|([^]*?)(|)(.*?)([^]*?)(?=[])|||',\n      flags: { global: false, caseInsensitive: false, multiline: false },\n      replacement: '',\n      scope: { type: 'global' },\n      enabled: true,\n      priority: 50,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // \n    {\n      id: 'builtin_replace_user',\n      name: '',\n      description: '',\n      operation: 'replace',\n      pattern: '|user|<user>|{{user}}',\n      flags: { global: false, caseInsensitive: false, multiline: false },\n      replacement: '',\n      scope: { type: 'global' },\n      enabled: false,\n      priority: 50,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // \n    {\n      id: 'builtin_remove_negative_traits',\n      name: '',\n      description: '',\n      operation: 'replace',\n      pattern: '[^;:\\\\s]*(||||NTR||||||||)[^;:\\\\s]*[:]\\\\d+;?\\\\s?',\n      flags: { global: false, caseInsensitive: false, multiline: false },\n      replacement: '',\n      scope: { type: 'table', tableNames: ['', ''] },\n      enabled: true,\n      priority: 50,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n  ];\n\n  // ========================================\n  // ValidationRuleManager - \n  // ========================================\n  const STORAGE_KEY_VALIDATION_RULES = 'acu_validation_rules_v1';\n  const STORAGE_KEY_VALIDATION_ENABLED = 'acu_validation_enabled_v1';\n  const STORAGE_KEY_VALIDATION_MODE = 'acu_validation_mode'; // \n\n  //  UI \n  const RULE_TYPE_INFO = {\n    // \n    tableReadonly: { name: '', scope: 'table', icon: 'fa-lock', desc: '' },\n    rowLimit: { name: '', scope: 'table', icon: 'fa-arrows-up-down', desc: '' },\n    sequence: { name: '', scope: 'table', icon: 'fa-sort-numeric-up', desc: '' },\n    // \n    required: { name: '', scope: 'field', icon: 'fa-asterisk', desc: '' },\n    format: { name: '', scope: 'field', icon: 'fa-font', desc: '' },\n    enum: { name: '', scope: 'field', icon: 'fa-list', desc: '' },\n    numeric: { name: '', scope: 'field', icon: 'fa-hashtag', desc: '' },\n    relation: { name: '', scope: 'field', icon: 'fa-link', desc: '' },\n    keyValue: { name: '', scope: 'field', icon: 'fa-key', desc: '' },\n  };\n\n  // \n  const BUILTIN_VALIDATION_RULES = [\n    // \n    {\n      id: 'summary_code_sequence',\n      name: '',\n      description: 'AM0001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM0001',\n    },\n    // \n    {\n      id: 'outline_code_sequence',\n      name: '',\n      description: 'AM0001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM0001',\n    },\n    // \n    {\n      id: 'summary_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'outline_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '(Enum Tag)',\n      ruleType: 'enum',\n      config: { values: ['', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_priority_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_progress_format',\n      name: '',\n      description: '0%~100%',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '(%)',\n      ruleType: 'format',\n      config: { pattern: '^(100|[1-9]?\\\\d)%$' },\n      errorMessage: '0%~100%0%50%100%',\n    },\n    // \n    {\n      id: 'equip_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'item_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_proficiency_range',\n      name: '',\n      description: ' 0-100 ',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'numeric',\n      config: { min: 0, max: 100 },\n      errorMessage: ' 0-100 ',\n    },\n    // \n    {\n      id: 'npc_presence_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_explore_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'intel_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'player_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // NPC\n    {\n      id: 'npc_location_relation',\n      name: 'NPC',\n      description: 'NPC',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'element_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'global_detail_location_relation',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    //  - \n    {\n      id: 'player_base_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_special_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_relationships_keyvalue',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    //  - \n    {\n      id: 'npc_base_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_special_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_relationships_keyvalue',\n      name: 'NPC',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    // \n    {\n      id: 'option_table_single_row',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: null,\n      ruleType: 'rowLimit',\n      config: { min: 0, max: 1 },\n      errorMessage: '',\n    },\n  ];\n\n  // ========================================\n  // BlacklistManager - MVU\n  // ========================================\n  const STORAGE_KEY_BLACKLIST = 'acu_filter_blacklist_v1';\n  const STORAGE_KEY_BLACKLIST_VERSION = 'acu_filter_blacklist_version';\n  const DEFAULT_BLACKLIST = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    'ID',\n    '',\n    '',\n    'measurements',\n    'ages',\n    '',\n    'order',\n    '',\n    'time',\n    'cost',\n    'chapter',\n    'location',\n    'calendar',\n    'day',\n    'year',\n    'month',\n  ];\n\n  const BlacklistManager = {\n    // \n    getBlacklist() {\n      const stored = Store.get(STORAGE_KEY_BLACKLIST, null);\n      const storedVersion = Store.get(STORAGE_KEY_BLACKLIST_VERSION, null);\n\n      // \n      if (!stored || !Array.isArray(stored)) {\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return [...DEFAULT_BLACKLIST];\n      }\n\n      // \n      if (!storedVersion || compareVersion(storedVersion, PRESET_FORMAT_VERSION) < 0) {\n        console.log(`[DICE]BlacklistManager  (${storedVersion || ''})`);\n\n        // \n        const userItems = new Set(stored);\n        const defaultItems = new Set(DEFAULT_BLACKLIST);\n        const mergedItems = [...DEFAULT_BLACKLIST]; // \n\n        // \n        stored.forEach(item => {\n          if (!defaultItems.has(item)) {\n            mergedItems.push(item);\n          }\n        });\n\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, mergedItems);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return mergedItems;\n      }\n\n      return stored;\n    },\n\n    // \n    setBlacklist(list) {\n      if (!Array.isArray(list)) {\n        console.warn('[DICE]BlacklistManager ');\n        return false;\n      }\n      Store.set(STORAGE_KEY_BLACKLIST, list);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // \n    resetToDefault() {\n      Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // key\n    //  \" >  >  > \" \"\"\n    isBlacklisted(key) {\n      if (!key || typeof key !== 'string') return false;\n      const blacklist = this.getBlacklist();\n      if (blacklist.length === 0) return false;\n\n      // key \">\"  \" > \"\n      const parts = key\n        .split(/>| > /)\n        .map(s => s.trim())\n        .filter(s => s);\n      const lastPart = parts.length > 0 ? parts[parts.length - 1] : key;\n\n      // key\n      return blacklist.some(item => lastPart.includes(item));\n    },\n  };\n\n  // ========================================\n  // PresetManager - \n  // ========================================\n  const STORAGE_KEY_PRESETS = 'acu_validation_presets_v1';\n  const STORAGE_KEY_ACTIVE_PRESET = 'acu_active_preset_id';\n\n  const PresetManager = {\n    _cache: null,\n\n    // \n    getAllPresets() {\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n      if (!stored) {\n        this._initDefaultPreset();\n        return this._cache;\n      }\n\n      let needsSave = false;\n      stored.forEach(preset => {\n        if (!preset.version || this._compareVersion(preset.version, PRESET_FORMAT_VERSION) < 0) {\n          console.log(\n            `[DICE]PresetManager  \"${preset.name}\"  (${preset.version || ''})`,\n          );\n\n          if (preset.id === 'default') {\n            // \n            const customRules = preset.rules.filter(r => !r.builtin);\n            // \n            const existingBuiltinMap = new Map();\n            preset.rules\n              .filter(r => r.builtin)\n              .forEach(r => {\n                const key = r.id || r.targetTable + '_' + r.ruleType;\n                existingBuiltinMap.set(key, { enabled: r.enabled, intercept: r.intercept });\n              });\n            // \n            preset.rules = [\n              ...BUILTIN_VALIDATION_RULES.map(r => {\n                const key = r.id || r.targetTable + '_' + r.ruleType;\n                const existing = existingBuiltinMap.get(key);\n                return {\n                  ...r,\n                  builtin: true,\n                  ...(existing ? { enabled: existing.enabled, intercept: existing.intercept } : {}),\n                };\n              }),\n              ...customRules,\n            ];\n          } else {\n            // \n            this._mergeBuiltinRules(preset);\n          }\n\n          preset.version = PRESET_FORMAT_VERSION;\n          needsSave = true;\n        }\n      });\n\n      if (needsSave) {\n        this._save(stored);\n        ValidationRuleManager.clearCache();\n        this._cache = null;\n      }\n\n      if (!needsSave && this._cache) {\n        return this._cache;\n      }\n      this._cache = stored;\n      return stored;\n    },\n\n    // \n    getActivePreset() {\n      const presets = this.getAllPresets();\n      const activeId = Store.get(STORAGE_KEY_ACTIVE_PRESET, 'default');\n      return presets.find(p => p.id === activeId) || presets[0];\n    },\n\n    // \n    setActivePreset(id) {\n      if (!this.getAllPresets().find(p => p.id === id)) return false;\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, id);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    createPreset(name) {\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: name || '',\n        builtin: false,\n        rules: [],\n        version: PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    duplicatePreset(id) {\n      const source = this.getAllPresets().find(p => p.id === id);\n      if (!source) return null;\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: source.name + ' ()',\n        builtin: false,\n        rules: JSON.parse(JSON.stringify(source.rules)),\n        version: source.version || PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      console.log('[DICE]PresetManager :', source.name, '->', newPreset.name);\n      return newPreset;\n    },\n\n    //  id='default' \n    deletePreset(id) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset || preset.id === 'default') return false; // \n      const filtered = presets.filter(p => p.id !== id);\n      this._save(filtered);\n      if (Store.get(STORAGE_KEY_ACTIVE_PRESET) === id) {\n        Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n        ValidationRuleManager.clearCache();\n      }\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    updatePresetRules(id, rules) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return false;\n      preset.rules = rules;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      return true;\n    },\n\n    // \n    exportPreset(id) {\n      const preset = this.getAllPresets().find(p => p.id === id);\n      if (!preset) return null;\n      const json = JSON.stringify(\n        {\n          format: 'acu_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          preset: { name: preset.name, rules: preset.rules },\n        },\n        null,\n        2,\n      );\n      return json;\n    },\n\n    // \n    _compareVersion(v1, v2) {\n      return compareVersion(v1, v2);\n    },\n\n    // \n    mergePresetWithDefaults(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) return false;\n\n      // \n      const customRules = preset.rules.filter(r => !r.builtin);\n      const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n\n      // \n      const builtinRuleMap = new Map();\n      BUILTIN_VALIDATION_RULES.forEach(r => {\n        const key = r.id || r.targetTable + '_' + r.ruleType;\n        builtinRuleMap.set(key, r);\n      });\n\n      // \n      const mergedRules = [];\n      const processedCustomIds = new Set();\n\n      // 1. \n      BUILTIN_VALIDATION_RULES.forEach(newRule => {\n        const key = newRule.id || newRule.targetTable + '_' + newRule.ruleType;\n        const existingRule = preset.rules.find(r => (r.id || r.targetTable + '_' + r.ruleType) === key && r.builtin);\n        if (existingRule) {\n          // \n          const isModified = JSON.stringify(existingRule) !== JSON.stringify(newRule);\n          if (isModified) {\n            // \n            mergedRules.push({ ...existingRule, builtin: true });\n          } else {\n            // \n            mergedRules.push({ ...newRule, builtin: true });\n          }\n        } else {\n          // \n          mergedRules.push({ ...newRule, builtin: true });\n        }\n        processedCustomIds.add(key);\n      });\n\n      // 2. \n      customRules.forEach(rule => {\n        const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n        if (!builtinRuleIds.has(key)) {\n          mergedRules.push({ ...rule, builtin: false });\n        }\n      });\n\n      preset.rules = mergedRules;\n      preset.version = PRESET_FORMAT_VERSION;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', preset.name);\n      return true;\n    },\n\n    // \n    importPreset(json, autoMerge = false) {\n      try {\n        const data = JSON.parse(json);\n        if (data.format !== 'acu_preset_v1' || !data.preset) return null;\n\n        const importedVersion = data.version || '0.0.0';\n        const needsMerge = this._compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n        const presets = this.getAllPresets();\n        const newPreset = {\n          id: 'imported_' + Date.now(),\n          name: data.preset.name || '',\n          builtin: false,\n          rules: data.preset.rules || [],\n          version: importedVersion,\n          createdAt: new Date().toISOString(),\n        };\n\n        // \n        if (needsMerge && autoMerge) {\n          presets.push(newPreset);\n          this._save(presets);\n          this.mergePresetWithDefaults(newPreset.id);\n          console.log('[DICE]PresetManager :', newPreset.name);\n        } else {\n          presets.push(newPreset);\n          this._save(presets);\n          console.log('[DICE]PresetManager :', newPreset.name);\n          if (needsMerge) {\n            console.warn('[DICE]PresetManager  mergePresetWithDefaults ');\n          }\n        }\n\n        return { preset: newPreset, needsMerge: needsMerge && !autoMerge };\n      } catch (e) {\n        console.error('[DICE]PresetManager :', e);\n        return null;\n      }\n    },\n\n    // \n    _initDefaultPreset() {\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n\n      //  getAllPresets \n      if (stored && Array.isArray(stored)) {\n        this._cache = stored;\n        return;\n      }\n\n      // \n      const defaultPreset = {\n        id: 'default',\n        name: '',\n        builtin: true,\n        rules: BUILTIN_VALIDATION_RULES.map(r => ({ ...r })),\n        version: PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n\n      // \n      const oldCustom = Store.get(STORAGE_KEY_VALIDATION_RULES, []);\n      if (oldCustom.length > 0) {\n        defaultPreset.rules.push(...oldCustom.map(r => ({ ...r, builtin: false })));\n        console.log('[DICE]PresetManager :', oldCustom.length, '');\n      }\n\n      this._cache = [defaultPreset];\n      this._save(this._cache);\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n    },\n\n    // \n    resetDefaultPreset() {\n      const presets = this.getAllPresets();\n      const defaultPreset = presets.find(p => p.id === 'default');\n      if (defaultPreset) {\n        // \n        const customRules = defaultPreset.rules.filter(r => !r.builtin);\n        defaultPreset.rules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r })), ...customRules];\n        defaultPreset.version = PRESET_FORMAT_VERSION;\n        this._save(presets);\n        ValidationRuleManager.clearCache();\n        return true;\n      }\n      return false;\n    },\n\n    // \n    _mergeBuiltinRules(preset) {\n      const customRules = preset.rules.filter(r => !r.builtin);\n      const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n\n      // \n      const existingBuiltinMap = new Map();\n      preset.rules\n        .filter(r => r.builtin)\n        .forEach(r => {\n          const key = r.id || r.targetTable + '_' + r.ruleType;\n          existingBuiltinMap.set(key, r);\n        });\n\n      const mergedRules = [];\n\n      // \n      BUILTIN_VALIDATION_RULES.forEach(newRule => {\n        const key = newRule.id || newRule.targetTable + '_' + newRule.ruleType;\n        const existing = existingBuiltinMap.get(key);\n        if (existing) {\n          // \n          mergedRules.push({\n            ...newRule,\n            enabled: existing.enabled,\n            intercept: existing.intercept,\n            errorMessage: existing.errorMessage,\n            builtin: true,\n          });\n        } else {\n          mergedRules.push({ ...newRule, builtin: true });\n        }\n      });\n\n      // ID\n      customRules.forEach(rule => {\n        const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n        if (!builtinRuleIds.has(key)) {\n          mergedRules.push({ ...rule, builtin: false });\n        }\n      });\n\n      preset.rules = mergedRules;\n    },\n\n    _save(presets) {\n      Store.set(STORAGE_KEY_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  //  PresetManager \n  const ValidationRuleManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const preset = PresetManager.getActivePreset();\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = (preset?.rules || []).map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_VALIDATION_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n      this._cache = null; // \n    },\n\n    // \n    toggleRuleIntercept(ruleId, intercept) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const rule = preset.rules.find(r => r.id === ruleId);\n      if (!rule) return false;\n\n      rule.intercept = intercept;\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled);\n    },\n\n    // \n    addCustomRule(rule) {\n      if (!rule.id || !rule.name || !rule.targetTable) {\n        console.error('[DICE]ValidationRuleManager ');\n        return false;\n      }\n\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      //  ID \n      if (preset.rules.some(r => r.id === rule.id)) {\n        console.error('[DICE]ValidationRuleManager  ID :', rule.id);\n        return false;\n      }\n\n      const newRule = { ...rule, builtin: false, enabled: true };\n      preset.rules.push(newRule);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      console.log('[DICE]ValidationRuleManager :', newRule.name);\n      return true;\n    },\n\n    // \n    removeCustomRule(ruleId) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules.splice(index, 1);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n\n      // \n      const states = this.getEnabledStates();\n      delete states[ruleId];\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n\n      console.log('[DICE]ValidationRuleManager :', ruleId);\n      return true;\n    },\n\n    // \n    updateCustomRule(ruleId, updates) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules[index] = { ...preset.rules[index], ...updates, id: ruleId };\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getRule(ruleId) {\n      return this.getAllRules().find(r => r.id === ruleId);\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n\n    // \n    getRulesByTable(tableName) {\n      return this.getEnabledRules().filter(rule => rule.targetTable === tableName);\n    },\n  };\n\n  // ========================================\n  // RegexTransformationManager -  (Phase 1.2)\n  // ========================================\n  const RegexTransformationManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // ID\n    _generateId() {\n      return `regex_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    },\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = rules.map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_REGEX_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    _saveEnabledStates(states) {\n      Store.set(STORAGE_KEY_REGEX_ENABLED, states);\n      this._enabledCache = states;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled !== false);\n    },\n\n    // \n    getApplicableRules(tableName, columnName) {\n      const allRules = this.getEnabledRules();\n\n      return allRules\n        .filter(rule => {\n          // \n          switch (rule.scope.type) {\n            case 'global':\n              return true;\n            case 'table':\n              return rule.scope.tableNames && rule.scope.tableNames.includes(tableName);\n            case 'column':\n              return (\n                rule.scope.tableNames &&\n                rule.scope.tableNames.includes(tableName) &&\n                rule.scope.columnNames &&\n                rule.scope.columnNames.includes(columnName)\n              );\n            default:\n              return false;\n          }\n        })\n        .sort((a, b) => b.priority - a.priority); // \n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      this._saveEnabledStates(states);\n      this.clearCache();\n    },\n\n    // \n    addCustomRule(rule) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n\n      // \n      if (!rule.name || !rule.pattern || !rule.scope) {\n        console.error('[DICE]RegexTransformationManager: ');\n        return false;\n      }\n\n      const newRule: RegexTransformationRule = {\n        id: this._generateId(),\n        name: rule.name,\n        description: rule.description,\n        operation: rule.operation || 'replace',\n        pattern: rule.pattern,\n        flags: rule.flags || {},\n        replacement: rule.replacement,\n        scope: rule.scope,\n        enabled: rule.enabled !== undefined ? rule.enabled : true,\n        priority: rule.priority || 50,\n        executeMode: rule.executeMode || 'auto',\n        testCases: rule.testCases || [],\n        security: rule.security || { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      rules.push(newRule);\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n\n      // \n      this._syncRulesToActivePreset();\n\n      return newRule;\n    },\n\n    // \n    _syncRulesToActivePreset() {\n      const activePreset = RegexPresetManager.getActivePreset();\n      if (activePreset) {\n        const allRules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n        RegexPresetManager.updatePresetRules(activePreset.id, allRules);\n      }\n    },\n\n    // \n    removeRule(ruleId) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const index = rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      rules.splice(index, 1);\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n\n      // \n      this._syncRulesToActivePreset();\n\n      return true;\n    },\n\n    // \n    updateRule(ruleId, updates) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const index = rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      rules[index] = {\n        ...rules[index],\n        ...updates,\n        id: ruleId,\n        updatedAt: Date.now(),\n      };\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n\n      // \n      this._syncRulesToActivePreset();\n\n      return true;\n    },\n\n    // \n    getRule(ruleId) {\n      return this.getAllRules().find(r => r.id === ruleId);\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n  };\n\n  // ========================================\n  // RegexPresetManager -  (Phase 1.3)\n  // ========================================\n  const RegexPresetManager = {\n    _cache: null,\n\n    //  compareVersion\n    _compareVersion(v1, v2) {\n      return compareVersion(v1, v2);\n    },\n\n    // \n    getAllPresets() {\n      const stored = Store.get(STORAGE_KEY_REGEX_PRESETS, null);\n\n      // \n      if (!stored || stored.length === 0) {\n        const defaultPreset: RegexPreset = {\n          id: 'regex_default',\n          name: '',\n          description: '',\n          version: PRESET_FORMAT_VERSION,\n          rules: BUILTIN_REGEX_RULES.map(r => ({ ...r, builtin: true })),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n        this._cache = [defaultPreset];\n        Store.set(STORAGE_KEY_REGEX_PRESETS, this._cache);\n        return this._cache;\n      }\n\n      // \n      let needsSave = false;\n      stored.forEach(preset => {\n        if (!preset.version || this._compareVersion(preset.version, PRESET_FORMAT_VERSION) < 0) {\n          console.log(\n            `[DICE]RegexPresetManager  \"${preset.name}\"  (${preset.version || ''})`,\n          );\n\n          if (preset.id === 'regex_default') {\n            // \n            const customRules = (preset.rules || []).filter(r => !r.builtin);\n            // \n            const existingBuiltinMap = new Map();\n            (preset.rules || [])\n              .filter(r => r.builtin)\n              .forEach(r => {\n                existingBuiltinMap.set(r.id, { enabled: r.enabled });\n              });\n            // \n            preset.rules = [\n              ...BUILTIN_REGEX_RULES.map(r => {\n                const existing = existingBuiltinMap.get(r.id);\n                return {\n                  ...r,\n                  builtin: true,\n                  ...(existing ? { enabled: existing.enabled } : {}),\n                };\n              }),\n              ...customRules,\n            ];\n          } else {\n            // \n            this._mergeBuiltinRules(preset);\n          }\n\n          preset.version = PRESET_FORMAT_VERSION;\n          preset.updatedAt = Date.now();\n          needsSave = true;\n        }\n      });\n\n      if (needsSave) {\n        this._save(stored);\n        RegexTransformationManager.clearCache();\n        this._cache = null;\n      }\n\n      if (!needsSave && this._cache) {\n        return this._cache;\n      }\n      this._cache = stored;\n      return stored;\n    },\n\n    // \n    _mergeBuiltinRules(preset) {\n      const customRules = (preset.rules || []).filter(r => !r.builtin);\n      const builtinRuleIds = new Set(BUILTIN_REGEX_RULES.map(r => r.id));\n\n      // \n      const existingBuiltinMap = new Map();\n      (preset.rules || [])\n        .filter(r => r.builtin)\n        .forEach(r => {\n          existingBuiltinMap.set(r.id, r);\n        });\n\n      const mergedRules = [];\n\n      // \n      BUILTIN_REGEX_RULES.forEach(newRule => {\n        const existing = existingBuiltinMap.get(newRule.id);\n        if (existing) {\n          // \n          mergedRules.push({\n            ...newRule,\n            enabled: existing.enabled,\n            builtin: true,\n          });\n        } else {\n          mergedRules.push({ ...newRule, builtin: true });\n        }\n      });\n\n      // ID\n      customRules.forEach(rule => {\n        if (!builtinRuleIds.has(rule.id)) {\n          mergedRules.push({ ...rule, builtin: false });\n        }\n      });\n\n      preset.rules = mergedRules;\n    },\n\n    // \n    getActivePreset() {\n      const activeId = Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET, 'regex_default');\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === activeId) || presets[0];\n\n      // \n      // \n      const storedRules: RegexTransformationRule[] = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      if (preset && preset.rules && preset.rules.length > 0) {\n        //  builtin \n        const storedRuleIds = new Set(storedRules.map(r => r.id));\n        const missingBuiltinRules = preset.rules.filter(r => r.builtin && !storedRuleIds.has(r.id));\n\n        if (missingBuiltinRules.length > 0) {\n          // \n          const mergedRules = [...missingBuiltinRules, ...storedRules];\n          Store.set(STORAGE_KEY_REGEX_RULES, mergedRules);\n          RegexTransformationManager.clearCache();\n          console.log(`[DICE]RegexPresetManager:  ${missingBuiltinRules.length} `);\n        }\n      }\n\n      return preset;\n    },\n\n    // \n    setActivePreset(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) {\n        console.error('[DICE]RegexPresetManager: ', presetId);\n        return false;\n      }\n\n      Store.set(STORAGE_KEY_REGEX_ACTIVE_PRESET, presetId);\n\n      // \n      Store.set(STORAGE_KEY_REGEX_RULES, preset.rules || []);\n\n      // RegexTransformationManager\n      RegexTransformationManager.clearCache();\n\n      return true;\n    },\n\n    // \n    createPreset(name, sourcePresetId) {\n      const presets = this.getAllPresets();\n\n      // \n      if (presets.some(p => p.name === name)) {\n        console.error('[DICE]RegexPresetManager: ', name);\n        return false;\n      }\n\n      const sourcePreset = sourcePresetId ? presets.find(p => p.id === sourcePresetId) : this.getActivePreset();\n\n      const newPreset: RegexPreset = {\n        id: `regex_preset_${Date.now()}`,\n        name: name,\n        description: sourcePreset?.description,\n        version: PRESET_FORMAT_VERSION,\n        rules: sourcePreset ? JSON.parse(JSON.stringify(sourcePreset.rules)) : [],\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    updatePresetRules(presetId, rules) {\n      const presets = this.getAllPresets();\n      const index = presets.findIndex(p => p.id === presetId);\n      if (index === -1) return false;\n\n      presets[index].rules = JSON.parse(JSON.stringify(rules));\n      presets[index].updatedAt = Date.now();\n\n      this._save(presets);\n\n      // ,\n      if (presetId === Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET)) {\n        RegexTransformationManager.clearCache();\n      }\n\n      return true;\n    },\n\n    // \n    deletePreset(presetId) {\n      const presets = this.getAllPresets();\n\n      // \n      if (presets.length <= 1) {\n        console.error('[DICE]RegexPresetManager: ');\n        return false;\n      }\n\n      const index = presets.findIndex(p => p.id === presetId);\n      if (index === -1) return false;\n\n      presets.splice(index, 1);\n      this._save(presets);\n\n      // ,\n      if (presetId === Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET)) {\n        this.setActivePreset(presets[0].id);\n      }\n\n      return true;\n    },\n\n    // JSON\n    exportPreset(presetId) {\n      const preset = this.getAllPresets().find(p => p.id === presetId);\n      if (!preset) return null;\n\n      // \n      const activePreset = this.getActivePreset();\n      const isActivePreset = activePreset && activePreset.id === presetId;\n      const rules = isActivePreset ? Store.get(STORAGE_KEY_REGEX_RULES, []) : preset.rules;\n\n      const exportData = {\n        ...preset,\n        rules: rules,\n      };\n\n      return JSON.stringify(exportData, null, 2);\n    },\n\n    // JSON\n    importPreset(jsonString) {\n      try {\n        const data = JSON.parse(jsonString);\n\n        // \n        if (!data.name || !Array.isArray(data.rules)) {\n          console.error('[DICE]RegexPresetManager: ');\n          return false;\n        }\n\n        const presets = this.getAllPresets();\n\n        // ID\n        const newPreset: RegexPreset = {\n          id: `regex_preset_${Date.now()}`,\n          name: data.name,\n          description: data.description,\n          version: data.version || PRESET_FORMAT_VERSION,\n          rules: data.rules.map((rule: RegexTransformationRule) => ({\n            ...rule,\n            id: RegexTransformationManager._generateId(),\n          })),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n\n        presets.push(newPreset);\n        this._save(presets);\n        return newPreset;\n      } catch (e) {\n        console.error('[DICE]RegexPresetManager: ', e);\n        return false;\n      }\n    },\n\n    // \n    _save(presets) {\n      Store.set(STORAGE_KEY_REGEX_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  // ========================================\n  // RegexTransformationEngine -  (Phase 2.1)\n  // ========================================\n  const RegexTransformationEngine = {\n    // \n    _regexCache: new Map<string, RegExp>(),\n\n    // \n    _buildFlags(flags: RegexFlags): string {\n      const result: string[] = [];\n      if (flags.caseInsensitive) result.push('i');\n      if (flags.global) result.push('g');\n      if (flags.multiline) result.push('m');\n      if (flags.unicode) result.push('u');\n      if (flags.sticky) result.push('y');\n      return result.join('');\n    },\n\n    // ()\n    _getRegex(pattern: string, flags: RegexFlags): RegExp | null {\n      //  unicode \n      const hasLookbehind = pattern.includes('(?<') || pattern.includes('(?<=');\n      const hasLookahead = pattern.includes('(?=') || pattern.includes('(?!');\n      const needsUnicode = hasLookbehind || hasLookahead;\n\n      //  unicode \n      if (needsUnicode && !flags.unicode) {\n        flags = { ...flags, unicode: true };\n      }\n\n      const flagsStr = this._buildFlags(flags);\n      const cacheKey = `${pattern}/${flagsStr}`;\n\n      if (this._regexCache.has(cacheKey)) {\n        const regex = this._regexCache.get(cacheKey)!;\n        regex.lastIndex = 0;\n        return regex;\n      }\n\n      try {\n        const regex = new RegExp(pattern, flagsStr);\n        this._regexCache.set(cacheKey, regex);\n        return regex;\n      } catch (e) {\n        console.error('[DICE]RegexTransformationEngine: ', pattern, e);\n        return null;\n      }\n    },\n\n    // ReDoS: \n    _scoreRegexComplexity(pattern: string): number {\n      let score = 0;\n\n      //  +50\n      if (/(\\*|\\+|\\{)\\1{2,}/.test(pattern)) score += 50;\n\n      //  +30\n      if (/(\\.\\*|\\.\\+)[^\\[]*\\1/.test(pattern)) score += 30;\n\n      //  +10\n      const captureGroups = (pattern.match(/\\(/g) || []).length;\n      score += Math.min(captureGroups * 5, 20);\n\n      return score;\n    },\n\n    // ReDoS: \n    _getTimeoutForRule(rule: RegexTransformationRule): number {\n      const complexity = this._scoreRegexComplexity(rule.pattern);\n      const baseTimeout = rule.security?.maxMatchTime || 100;\n      // ,\n      return Math.max(baseTimeout - complexity * 2, 50);\n    },\n\n    // \n    _safeReplace(value: string, rule: RegexTransformationRule, regex: RegExp): RegexTransformResult {\n      const oldValue = value;\n\n      // \n      const maxInputLength = rule.security?.maxInputLength || 10000;\n      if (value.length > maxInputLength) {\n        return {\n          success: false,\n          oldValue,\n          newValue: oldValue,\n          matched: false,\n          error: `(${maxInputLength})`,\n        };\n      }\n\n      try {\n        const timeout = this._getTimeoutForRule(rule);\n        const startTime = Date.now();\n\n        // \n        let newValue: string;\n        switch (rule.operation) {\n          case 'replace':\n            newValue = value.replace(regex, rule.replacement || '');\n            break;\n          case 'delete':\n            newValue = value.replace(regex, '');\n            break;\n          case 'validate':\n            const isValid = regex.test(value);\n            newValue = value;\n            break;\n          default:\n            newValue = value;\n        }\n\n        // \n        const elapsed = Date.now() - startTime;\n        if (elapsed > timeout) {\n          console.warn('[DICE]RegexTransformationEngine: ', rule.pattern, elapsed);\n          return {\n            success: false,\n            oldValue,\n            newValue: oldValue,\n            matched: false,\n            error: `(${elapsed}ms > ${timeout}ms)`,\n          };\n        }\n\n        // \n        const matched = oldValue !== newValue || regex.test(oldValue);\n\n        return {\n          success: true,\n          oldValue,\n          newValue,\n          matched,\n        };\n      } catch (e) {\n        console.error('[DICE]RegexTransformationEngine: ', rule.pattern, e);\n        return {\n          success: false,\n          oldValue,\n          newValue: oldValue,\n          matched: false,\n          error: String(e),\n        };\n      }\n    },\n\n    // \n    applyToValue(value: string, rule: RegexTransformationRule): RegexTransformResult {\n      if (value === null || value === undefined) {\n        return {\n          success: true,\n          oldValue: '',\n          newValue: '',\n          matched: false,\n        };\n      }\n\n      const strValue = String(value);\n\n      //  pattern  flags /pattern/flags\n      let pattern = rule.pattern;\n      let flags = rule.flags || {};\n\n      //  /pattern/flags \n      const extracted = this._extractFlags(pattern);\n      if (extracted.patternWithoutFlags !== pattern) {\n        //  pattern  flags\n        pattern = extracted.patternWithoutFlags;\n        flags = { ...flags, ...extracted.flags };\n      }\n\n      // \n      //  flags  global true\n      if (flags.global === undefined) {\n        flags.global = true;\n      }\n\n      const regex = this._getRegex(pattern, flags);\n\n      if (!regex) {\n        return {\n          success: false,\n          oldValue: strValue,\n          newValue: strValue,\n          matched: false,\n          error: '',\n        };\n      }\n\n      return this._safeReplace(strValue, rule, regex);\n    },\n\n    // flags (: /test/g  'g')\n    _extractFlags(patternStr: string): { flags: RegexFlags; patternWithoutFlags: string } {\n      const flags: RegexFlags = {\n        global: false,\n        caseInsensitive: false,\n        multiline: false,\n        unicode: false,\n        sticky: false,\n      };\n\n      //  /pattern/flags \n      const inlineFlagMatch = patternStr.match(/^\\/(.+)\\/([gimuy]*)$/);\n      if (inlineFlagMatch) {\n        const [, patternWithoutFlags, flagStr] = inlineFlagMatch;\n        if (flagStr.includes('g')) flags.global = true;\n        if (flagStr.includes('i')) flags.caseInsensitive = true;\n        if (flagStr.includes('m')) flags.multiline = true;\n        if (flagStr.includes('u')) flags.unicode = true;\n        if (flagStr.includes('y')) flags.sticky = true;\n        return { flags, patternWithoutFlags };\n      }\n\n      // flags\n      return { flags, patternWithoutFlags: patternStr };\n    },\n\n    // \n    applyToTable(\n      tableData:\n        | { name: string; headers: string[]; rows: string[][] }\n        | { [key: string]: { name?: string; content?: string[][] } },\n      rules: RegexTransformationRule[],\n    ): { totalApplied: number; errors: string[]; modifiedSheetKeys: string[] } {\n      let totalApplied = 0;\n      const errors: string[] = [];\n      const modifiedSheetKeys: string[] = [];\n\n      try {\n        // \n        let isSimpleFormat = false;\n        let sheetMap: Map<\n          string,\n          { sheet: any; sheetKey: string; name: string; headers: string[]; contentRowIndex: number }\n        > = new Map();\n\n        if ('name' in tableData && 'headers' in tableData && 'rows' in tableData) {\n          // : { name, headers, rows }\n          isSimpleFormat = true;\n          const simpleTable = tableData as { name: string; headers: string[]; rows: string[][] };\n          sheetMap.set(simpleTable.name, {\n            sheet: simpleTable,\n            sheetKey: simpleTable.name,\n            name: simpleTable.name,\n            headers: simpleTable.headers,\n            contentRowIndex: -1, //  contentRowIndex\n          });\n        } else {\n          // : { sheet_xxx: { name, content: [headers, ...rows] } }\n          const dataObj = tableData as { [key: string]: { name?: string; content?: string[][] } };\n\n          Object.keys(dataObj).forEach(sheetKey => {\n            if (!sheetKey.startsWith('sheet_')) return;\n\n            const sheet = dataObj[sheetKey];\n            if (!sheet || !sheet.content || !Array.isArray(sheet.content) || sheet.content.length < 1) {\n              console.warn(`[DICE]applyToTable:  ${sheetKey}`);\n              return;\n            }\n\n            const tableName = sheet.name || sheetKey;\n            sheetMap.set(tableName, {\n              sheet,\n              sheetKey,\n              name: tableName,\n              headers: sheet.content[0] || [],\n              contentRowIndex: 0, //  content[0]\n            });\n          });\n        }\n\n        if (sheetMap.size === 0) {\n          console.warn('[DICE]applyToTable: ');\n          return { totalApplied: 0, errors: [''], modifiedSheetKeys: [] };\n        }\n\n        // \n        for (const [tableName, tableInfo] of sheetMap.entries()) {\n          const { sheet, headers, sheetKey } = tableInfo;\n          let tableModified = false;\n\n          for (const rule of rules) {\n            if (!rule.enabled) continue;\n\n            // \n            const scope = rule.scope;\n            const shouldProcessTable = scope.type === 'global' || scope.tableNames?.includes(tableName);\n\n            if (!shouldProcessTable) continue;\n\n            try {\n              // \n              if (isSimpleFormat) {\n                //  rows\n                const rows = (sheet as { rows: string[][] }).rows;\n                for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {\n                  const row = rows[rowIndex];\n\n                  // \n                  for (let colIndex = 0; colIndex < row.length; colIndex++) {\n                    const columnName = headers[colIndex];\n\n                    // \n                    if (scope.type === 'column') {\n                      if (!scope.columnNames?.includes(columnName)) continue;\n                    }\n\n                    // \n                    const result = this.applyToValue(row[colIndex], rule);\n                    if (result.success) {\n                      if (result.matched) {\n                        row[colIndex] = result.newValue;\n                        totalApplied++;\n                        tableModified = true;\n                      }\n                    } else {\n                      errors.push(`${rule.name} [${tableName}]: ${result.error}`);\n                    }\n                  }\n                }\n              } else {\n                //  content  content[1] \n                const content = sheet.content;\n                for (let contentRowIndex = 1; contentRowIndex < content.length; contentRowIndex++) {\n                  const row = content[contentRowIndex];\n                  if (!Array.isArray(row)) continue;\n\n                  // \n                  for (let colIndex = 0; colIndex < row.length; colIndex++) {\n                    const columnName = headers[colIndex];\n\n                    // \n                    if (scope.type === 'column') {\n                      if (!scope.columnNames?.includes(columnName)) continue;\n                    }\n\n                    // \n                    const oldValue = row[colIndex];\n                    const result = this.applyToValue(oldValue, rule);\n\n                    if (result.success) {\n                      if (result.matched) {\n                        row[colIndex] = result.newValue;\n                        totalApplied++;\n                        tableModified = true;\n                        console.debug(\n                          `[DICE]: ${tableName}[${contentRowIndex}].${columnName}`,\n                          `\"${result.oldValue}\" -> \"${result.newValue}\"`,\n                        );\n                      }\n                    } else {\n                      errors.push(`${rule.name} [${tableName}]: ${result.error}`);\n                    }\n                  }\n                }\n              }\n            } catch (tableError) {\n              const errorMsg = tableError instanceof Error ? tableError.message : String(tableError);\n              console.error(`[DICE]applyToTable:  ${tableName} :`, tableError);\n              errors.push(`${rule.name} [${tableName}]:  - ${errorMsg}`);\n            }\n          }\n          if (tableModified && sheetKey) {\n            modifiedSheetKeys.push(sheetKey);\n          }\n        }\n\n        if (totalApplied > 0) {\n          console.info(`[DICE]applyToTable:  ${totalApplied} `);\n        }\n        if (errors.length > 0) {\n          console.warn(`[DICE]applyToTable:  ${errors.length} `);\n        }\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : String(e);\n        console.error('[DICE]applyToTable: :', e);\n        errors.push(`: ${errorMsg}`);\n      }\n\n      return { totalApplied, errors, modifiedSheetKeys };\n    },\n\n    // \n    applyToCell(\n      value: string,\n      tableName: string,\n      columnName: string,\n      executeMode?: RegexExecutionMode,\n    ): RegexTransformResult {\n      // \n      const rules = RegexTransformationManager.getApplicableRules(tableName, columnName);\n\n      // ,\n      if (rules.length === 0) {\n        return {\n          success: true,\n          oldValue: value || '',\n          newValue: value || '',\n          matched: false,\n        };\n      }\n\n      // \n      let applicableRules = rules;\n      if (executeMode) {\n        applicableRules = rules.filter(r => r.executeMode === executeMode || r.executeMode === 'auto');\n      }\n\n      if (applicableRules.length === 0) {\n        return {\n          success: true,\n          oldValue: value || '',\n          newValue: value || '',\n          matched: false,\n        };\n      }\n\n      // \n      let currentValue = value || '';\n      let wasMatched = false;\n\n      for (const rule of applicableRules) {\n        const result = this.applyToValue(currentValue, rule);\n        if (!result.success) {\n          return result;\n        }\n        if (result.matched) {\n          wasMatched = true;\n        }\n        currentValue = result.newValue;\n      }\n\n      return {\n        success: true,\n        oldValue: value || '',\n        newValue: currentValue,\n        matched: wasMatched,\n      };\n    },\n\n    // \n    applyToRow(row: string[], headers: string[], tableName: string, executeMode?: RegexExecutionMode): string[] {\n      return row.map((cell, index) => {\n        const columnName = headers[index];\n        const result = this.applyToCell(cell, tableName, columnName, executeMode);\n        return result.newValue;\n      });\n    },\n\n    // \n    previewBatchTransform(\n      tableData: { name: string; headers: string[]; rows: string[][] },\n      executeMode?: RegexExecutionMode,\n    ): RegexPreviewResult[] {\n      const tableName = tableData.name;\n      const rules = RegexTransformationManager.getApplicableRules(tableName, null).filter(\n        r => r.scope.type === 'global' || r.scope.tableNames?.includes(tableName),\n      );\n\n      const results: RegexPreviewResult[] = [];\n\n      for (const rule of rules) {\n        const affectedCells: RegexPreviewResult['affectedCells'] = [];\n        let totalAffected = 0;\n\n        for (let rowIndex = 0; rowIndex < tableData.rows.length; rowIndex++) {\n          const row = tableData.rows[rowIndex];\n          for (let colIndex = 0; colIndex < row.length; colIndex++) {\n            const columnName = tableData.headers[colIndex];\n            const value = row[colIndex];\n\n            // \n            if (rule.scope.type === 'column') {\n              if (!rule.scope.columnNames?.includes(columnName) || !rule.scope.tableNames?.includes(tableName)) {\n                continue;\n              }\n            } else if (rule.scope.type === 'table') {\n              if (!rule.scope.tableNames?.includes(tableName)) {\n                continue;\n              }\n            }\n\n            const result = this.applyToValue(value, rule);\n            if (result.matched && result.oldValue !== result.newValue) {\n              affectedCells.push({\n                tableName,\n                rowIndex,\n                columnIndex: colIndex,\n                columnName,\n                oldValue: result.oldValue,\n                newValue: result.newValue,\n              });\n              totalAffected++;\n            }\n          }\n        }\n\n        if (totalAffected > 0) {\n          results.push({\n            rule,\n            affectedCells,\n            totalAffected,\n          });\n        }\n      }\n\n      return results;\n    },\n\n    // \n    clearRegexCache() {\n      this._regexCache.clear();\n    },\n  };\n\n  // ========================================\n  // ValidationEngine - \n  // ========================================\n  const ValidationEngine = {\n    //  fallback\n    //  fallback \"\"\n    findColumnIndex(headers: (string | null)[], targetColumn: string): number {\n      // 1. \n      const exactIndex = headers.indexOf(targetColumn);\n      if (exactIndex !== -1) return exactIndex;\n\n      // 2.  fallback\n      for (let i = 0; i < headers.length; i++) {\n        const header = headers[i];\n        if (header && header.includes(targetColumn)) {\n          return i;\n        }\n      }\n\n      return -1; // \n    },\n\n    // \n    validateFormat(value, pattern) {\n      if (value === null || value === undefined || value === '') return true; // \n      try {\n        const regex = new RegExp(pattern);\n        return regex.test(String(value));\n      } catch (e) {\n        console.error('[DICE]ValidationEngine :', pattern, e);\n        return true; // \n      }\n    },\n\n    // \n    validateEnum(value, allowedValues) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!Array.isArray(allowedValues) || allowedValues.length === 0) return true;\n      return allowedValues.includes(String(value));\n    },\n\n    // \n    validateNumeric(value, min, max) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      //  \"50/100\"  \":80\" \n      const strVal = String(value);\n      let numVal;\n\n      //  \"50%\"\n      if (strVal.endsWith('%')) {\n        numVal = parseFloat(strVal);\n      }\n      //  \"50/100\"\n      else if (strVal.includes('/')) {\n        const parts = strVal.split('/');\n        numVal = parseFloat(parts[0]);\n      }\n      //  \":\" \n      else if (strVal.includes(':')) {\n        const parts = strVal.split(':');\n        numVal = parseFloat(parts[parts.length - 1]);\n      }\n      // \n      else {\n        numVal = parseFloat(strVal);\n      }\n\n      if (isNaN(numVal)) return false; // \n\n      if (min !== undefined && min !== null && numVal < min) return false;\n      if (max !== undefined && max !== null && numVal > max) return false;\n      return true;\n    },\n\n    //  OR \n    validateRelation(value, rawData, refTable, refColumn) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!rawData || !refTable || !refColumn) return true;\n\n      // \n      let refSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === refTable) {\n          refSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!refSheet || !refSheet.content || refSheet.content.length < 2) {\n        return true; // \n      }\n\n      const headers = refSheet.content[0];\n      const strVal = String(value);\n\n      //  refColumn \n      const columns = Array.isArray(refColumn) ? refColumn : [refColumn];\n\n      for (const col of columns) {\n        const refColIndex = headers.indexOf(col);\n        if (refColIndex === -1) continue; // \n\n        // \n        for (let i = 1; i < refSheet.content.length; i++) {\n          if (String(refSheet.content[i][refColIndex] || '') === strVal) {\n            return true; // \n          }\n        }\n      }\n\n      return columns.length === 0; //  true false\n    },\n\n    // \n    validateRequired(value) {\n      return value !== null && value !== undefined && String(value).trim() !== '';\n    },\n\n    // \n    validateKeyValue(value, ruleConfig) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      const valueType = ruleConfig?.valueType || 'text';\n      const valueMin = ruleConfig?.valueMin;\n      const valueMax = ruleConfig?.valueMax;\n\n      // \n      let processedValue = String(value);\n\n      // \n      processedValue = processedValue\n        .replace(//g, ':') //   \n        .replace(//g, ';') //   \n        .replace(//g, ';'); //   \n\n      // \n      processedValue = processedValue.replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n\n      if (pairs.length === 0) return false; // \n\n      // \n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          return false; // /\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) return false; // \n\n        // \n        if (valueType === 'numeric') {\n          // \n          if (!/^-?\\d+(\\.\\d+)?$/.test(val.trim())) return false; // \n\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) return false; // \n\n          if (valueMin !== undefined && valueMin !== null && numVal < valueMin) return false;\n          if (valueMax !== undefined && valueMax !== null && numVal > valueMax) return false;\n        }\n        // \n      }\n\n      return true;\n    },\n\n    // \n    validateTableReadonly(oldContent, newContent) {\n      if (!oldContent || !newContent) return true;\n      return JSON.stringify(oldContent) === JSON.stringify(newContent);\n    },\n\n    // \n    validateRowLimit(rowCount, min, max) {\n      if (min !== undefined && min !== null && rowCount < min) return false;\n      if (max !== undefined && max !== null && rowCount > max) return false;\n      return true;\n    },\n\n    // \n    validateSequence(sheet, columnName, config) {\n      if (!sheet || !sheet.content || sheet.content.length < 2) return true; // \n      if (!columnName || !config) return true;\n\n      const headers = sheet.content[0] || [];\n      const rows = sheet.content.slice(1) || [];\n      const colIndex = headers.indexOf(columnName);\n      if (colIndex < 0) return true; // \n\n      const prefix = config.prefix || '';\n      const startFrom = config.startFrom !== undefined ? config.startFrom : 1;\n\n      // \n      const numbers = [];\n      const allRowValues = []; // \n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        allRowValues.push({ rowIndex: i, rawValue: value, type: typeof value });\n        if (value === null || value === undefined || value === '') continue;\n\n        const strValue = String(value).trim();\n        if (!strValue) continue;\n\n        // +\n        if (prefix) {\n          const escapedPrefix = prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n          const regex = new RegExp(`^${escapedPrefix}(\\\\d+)$`);\n          const match = strValue.match(regex);\n          if (match) {\n            const num = parseInt(match[1], 10);\n            if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n          }\n        } else {\n          // \n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n        }\n      }\n\n      if (numbers.length === 0) return true; // \n\n      // \n      numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n      // \n      const numSet = new Set(numbers.map(n => n.num));\n      if (numSet.size !== numbers.length) {\n        return false; // \n      }\n\n      // startFrom\n      // startFromstartFrom+1\n      for (let i = 0; i < numbers.length; i++) {\n        const expectedNum = startFrom + i;\n        const actualNum = numbers[i].num;\n        if (actualNum !== expectedNum) {\n          return false; // startFrom\n        }\n      }\n\n      return true;\n    },\n\n    //  intercept \n    checkTableRules(snapshot, newData, rules) {\n      const violations = [];\n      if (!snapshot || !newData || !rules) return violations;\n\n      for (const rule of rules) {\n        // \n        if (!rule.enabled || !rule.intercept) continue;\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n        if (!typeInfo) continue;\n\n        // \n        let oldSheet = null,\n          newSheet = null;\n        for (const sheetId in snapshot) {\n          if (snapshot[sheetId]?.name === rule.targetTable) {\n            oldSheet = snapshot[sheetId];\n            break;\n          }\n        }\n        for (const sheetId in newData) {\n          if (newData[sheetId]?.name === rule.targetTable) {\n            newSheet = newData[sheetId];\n            break;\n          }\n        }\n\n        //  rowLimit  0 \n        if (!newSheet) {\n          if (rule.ruleType === 'rowLimit' && rule.config?.min && rule.config.min > 0) {\n            violations.push({\n              rule,\n              tableName: rule.targetTable,\n              message: rule.errorMessage || ` \"${rule.targetTable}\"  ( ${rule.config.min} )`,\n            });\n          }\n          continue;\n        }\n\n        // \n        if (typeInfo.scope === 'table') {\n          if (rule.ruleType === 'tableReadonly') {\n            if (!this.validateTableReadonly(oldSheet?.content, newSheet?.content)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message: rule.errorMessage || ` \"${rule.targetTable}\" `,\n              });\n            }\n          } else if (rule.ruleType === 'rowLimit') {\n            const rowCount = (newSheet.content?.length || 1) - 1; // \n            if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetTable}\"  ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n              });\n            }\n          } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n            // \n            if (!this.validateSequence(newSheet, rule.targetColumn, rule.config || {})) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(4, '0')}`,\n              });\n            }\n          }\n        }\n        // \n        else if (typeInfo.scope === 'field' && rule.targetColumn) {\n          const headers = newSheet.content?.[0] || [];\n          const colIndex = this.findColumnIndex(headers, rule.targetColumn);\n          if (colIndex === -1) continue;\n\n          // \n          for (let rowIdx = 1; rowIdx < (newSheet.content?.length || 0); rowIdx++) {\n            const row = newSheet.content[rowIdx];\n            const value = row?.[colIndex];\n            const isValid = this.validateValue(value, rule, newData);\n\n            if (!isValid) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                rowIndex: rowIdx,\n                columnName: rule.targetColumn,\n                currentValue: String(value ?? ''),\n                message: rule.errorMessage || ` \"${rule.targetColumn}\" `,\n              });\n              // \n              break;\n            }\n          }\n        }\n      }\n      return violations;\n    },\n\n    // \n    validateValue(value, rule, rawData) {\n      switch (rule.ruleType) {\n        case 'format':\n          return this.validateFormat(value, rule.config?.pattern);\n        case 'enum':\n          return this.validateEnum(value, rule.config?.values);\n        case 'numeric':\n          return this.validateNumeric(value, rule.config?.min, rule.config?.max);\n        case 'relation':\n          return this.validateRelation(value, rawData, rule.config?.refTable, rule.config?.refColumn);\n        case 'required':\n          return this.validateRequired(value);\n        case 'keyValue':\n          return this.validateKeyValue(value, rule.config);\n        default:\n          return true;\n      }\n    },\n\n    // \n    validateRow(row, headers, tableName, rowIndex, rules, rawData) {\n      const errors = [];\n      // \n      const rowTitle = row[1] || row[0] || ` ${rowIndex + 1}`;\n\n      for (const rule of rules) {\n        if (rule.targetTable !== tableName) continue;\n        if (!rule.enabled) continue;\n\n        // \n        const colIndex = this.findColumnIndex(headers, rule.targetColumn);\n        if (colIndex === -1) continue;\n\n        const value = row[colIndex];\n        const isValid = this.validateValue(value, rule, rawData);\n\n        if (!isValid) {\n          errors.push({\n            ruleId: rule.id,\n            ruleName: rule.name,\n            ruleType: rule.ruleType,\n            rule: rule, // \n            tableName: tableName,\n            rowIndex: rowIndex,\n            columnName: rule.targetColumn,\n            currentValue: String(value ?? ''),\n            rowTitle: rowTitle, // \n            errorMessage: rule.errorMessage,\n            severity: 'error',\n          });\n        }\n      }\n\n      return errors;\n    },\n\n    // \n    validateAllData(rawData) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getEnabledRules();\n      if (rules.length === 0) return [];\n\n      const allErrors = [];\n\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const sheet = rawData[sheetId];\n        if (!sheet?.name || !sheet?.content) continue;\n\n        const tableName = sheet.name;\n        const headers = sheet.content[0];\n        const tableRules = rules.filter(r => r.targetTable === tableName);\n\n        if (tableRules.length === 0) continue;\n\n        //  \n        for (const rule of tableRules) {\n          const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n          if (typeInfo?.scope === 'table') {\n            if (rule.ruleType === 'rowLimit') {\n              const rowCount = sheet.content.length - 1;\n              if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n                allErrors.push({\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: '',\n                  currentValue: `${rowCount} `,\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n                  severity: 'warning',\n                });\n              }\n            } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n              // \n              const isValid = this.validateSequence(sheet, rule.targetColumn, rule.config || {});\n              if (!isValid) {\n                const error = {\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: rule.targetColumn,\n                  currentValue: '',\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(4, '0')}`,\n                  severity: 'error',\n                };\n                allErrors.push(error);\n              }\n            }\n            // tableReadonly \n          }\n        }\n\n        // \n        const fieldRules = tableRules.filter(r => RULE_TYPE_INFO[r.ruleType]?.scope !== 'table');\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          const rowErrors = this.validateRow(row, headers, tableName, i - 1, fieldRules, rawData);\n          allErrors.push(...rowErrors);\n        }\n      }\n\n      return allErrors;\n    },\n\n    // \n    validateTable(rawData, tableName) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getRulesByTable(tableName);\n      if (rules.length === 0) return [];\n\n      // \n      let targetSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n        return [];\n      }\n\n      const headers = targetSheet.content[0];\n      const allErrors = [];\n\n      for (let i = 1; i < targetSheet.content.length; i++) {\n        const row = targetSheet.content[i];\n        const rowErrors = this.validateRow(row, headers, tableName, i - 1, rules, rawData);\n        allErrors.push(...rowErrors);\n      }\n\n      return allErrors;\n    },\n\n    // \n    groupErrorsByTable(errors) {\n      const grouped = {};\n      for (const error of errors) {\n        if (!grouped[error.tableName]) {\n          grouped[error.tableName] = [];\n        }\n        grouped[error.tableName].push(error);\n      }\n      return grouped;\n    },\n\n    // \n    getErrorCount(rawData) {\n      return this.validateAllData(rawData).length;\n    },\n  };\n\n  // ========================================\n  // LocalAvatarDB -  IndexedDB \n  // ========================================\n  const LocalAvatarDB = {\n    DB_NAME: 'acu_local_avatars',\n    STORE_NAME: 'avatars',\n    DB_VERSION: 1,\n    _db: null,\n    _urlCache: new Map(), //  ObjectURL \n\n    // \n    async init() {\n      if (this._db) return this._db;\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n        request.onerror = () => {\n          console.error('[DICE]LocalAvatarDB :', request.error);\n          reject(request.error);\n        };\n\n        request.onsuccess = () => {\n          this._db = request.result;\n          resolve(this._db);\n        };\n\n        request.onupgradeneeded = event => {\n          const db = event.target.result;\n          if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n            // \n            db.createObjectStore(this.STORE_NAME, { keyPath: 'name' });\n          }\n        };\n      });\n    },\n\n    //  name \n    async save(name, blob) {\n      if (!name || !blob) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          //  ObjectURL \n          if (this._urlCache.has(name)) {\n            URL.revokeObjectURL(this._urlCache.get(name));\n            this._urlCache.delete(name);\n          }\n\n          const data = {\n            name: name,\n            blob: blob,\n            size: blob.size,\n            type: blob.type,\n            updatedAt: Date.now(),\n          };\n\n          const request = store.put(data);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]LocalAvatarDB :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB save error:', e);\n        return false;\n      }\n    },\n\n    //  URL ObjectURL\n    async get(name) {\n      if (!name) return null;\n\n      // \n      if (this._urlCache.has(name)) {\n        return this._urlCache.get(name);\n      }\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.get(name);\n\n          request.onsuccess = () => {\n            const data = request.result;\n            if (data && data.blob) {\n              const url = URL.createObjectURL(data.blob);\n              this._urlCache.set(name, url);\n              resolve(url);\n            } else {\n              resolve(null);\n            }\n          };\n\n          request.onerror = () => resolve(null);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB get error:', e);\n        return null;\n      }\n    },\n\n    // \n    async has(name) {\n      if (!name) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getKey(name);\n\n          request.onsuccess = () => resolve(request.result !== undefined);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        return false;\n      }\n    },\n\n    // \n    async delete(name) {\n      if (!name) return false;\n\n      try {\n        //  ObjectURL \n        if (this._urlCache.has(name)) {\n          URL.revokeObjectURL(this._urlCache.get(name));\n          this._urlCache.delete(name);\n        }\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.delete(name);\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB delete error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAllNames() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAllKeys();\n\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => resolve([]);\n        });\n      } catch (e) {\n        return [];\n      }\n    },\n\n    // \n    async getStats() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAll();\n\n          request.onsuccess = () => {\n            const items = request.result || [];\n            const totalSize = items.reduce((sum, item) => sum + (item.size || 0), 0);\n            resolve({\n              count: items.length,\n              totalSize: totalSize,\n              totalSizeMB: (totalSize / 1024 / 1024).toFixed(2),\n            });\n          };\n\n          request.onerror = () => resolve({ count: 0, totalSize: 0, totalSizeMB: '0' });\n        });\n      } catch (e) {\n        return { count: 0, totalSize: 0, totalSizeMB: '0' };\n      }\n    },\n\n    // \n    async clearAll() {\n      try {\n        //  ObjectURL \n        this._urlCache.forEach(url => URL.revokeObjectURL(url));\n        this._urlCache.clear();\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.clear();\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB clearAll error:', e);\n        return false;\n      }\n    },\n  };\n\n  // ========================================\n  // FavoritesDB -  IndexedDB \n  // ========================================\n  /**\n   * @typedef {Object} FavoriteItem\n   * @property {string} id - UUID\n   * @property {string[]} header -  (null)\n   * @property {(string|number)[]} rowData -  (header)\n   * @property {string[]} tags - \n   * @property {number} createdAt - \n   * @property {number} updatedAt - \n   * @property {{tableUid: string, tableName: string, chatId: string}} [sourceInfo] - \n   */\n  interface FavoriteItem {\n    id: string;\n    header: string[];\n    rowData: (string | number)[];\n    tags: string[];\n    createdAt: number;\n    updatedAt: number;\n    sourceInfo?: {\n      tableUid: string;\n      tableName: string;\n      chatId: string;\n    };\n  }\n\n  const FavoritesDB = {\n    DB_NAME: 'acu_favorites',\n    STORE_NAME: 'items',\n    DB_VERSION: 1,\n    _db: null as IDBDatabase | null,\n\n    // \n    async init(): Promise<IDBDatabase> {\n      if (this._db) return this._db;\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n        request.onerror = () => {\n          console.error('[DICE]FavoritesDB :', request.error);\n          reject(request.error);\n        };\n\n        request.onsuccess = () => {\n          this._db = request.result;\n          resolve(this._db);\n        };\n\n        request.onupgradeneeded = event => {\n          const db = (event.target as IDBOpenDBRequest).result;\n          if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n            //  id (UUID)\n            db.createObjectStore(this.STORE_NAME, { keyPath: 'id' });\n          }\n        };\n      });\n    },\n\n    // \n    async add(item: FavoriteItem): Promise<boolean> {\n      if (!item || !item.id) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          const request = store.add(item);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]FavoritesDB add :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB add error:', e);\n        return false;\n      }\n    },\n\n    // ID\n    async get(id: string): Promise<FavoriteItem | null> {\n      if (!id) return null;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.get(id);\n\n          request.onsuccess = () => {\n            resolve(request.result || null);\n          };\n\n          request.onerror = () => resolve(null);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB get error:', e);\n        return null;\n      }\n    },\n\n    //  ()\n    async update(id: string, updates: Partial<FavoriteItem>): Promise<boolean> {\n      if (!id) return false;\n\n      try {\n        const existing = await this.get(id);\n        if (!existing) return false;\n\n        const updated = {\n          ...existing,\n          ...updates,\n          id: existing.id, //  id \n          updatedAt: Date.now(),\n        };\n\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          const request = store.put(updated);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]FavoritesDB update :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB update error:', e);\n        return false;\n      }\n    },\n\n    // \n    async delete(id: string): Promise<boolean> {\n      if (!id) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.delete(id);\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB delete error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAll(): Promise<FavoriteItem[]> {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAll();\n\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => resolve([]);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB getAll error:', e);\n        return [];\n      }\n    },\n\n    // \n    async getAllTags(): Promise<string[]> {\n      try {\n        const items = await this.getAll();\n        const tagSet = new Set<string>();\n        for (const item of items) {\n          if (item.tags && Array.isArray(item.tags)) {\n            for (const tag of item.tags) {\n              if (tag) tagSet.add(tag);\n            }\n          }\n        }\n        return Array.from(tagSet).sort();\n      } catch (e) {\n        console.error('[DICE]FavoritesDB getAllTags error:', e);\n        return [];\n      }\n    },\n\n    // \n    async getByTag(tag: string): Promise<FavoriteItem[]> {\n      if (!tag) return [];\n\n      try {\n        const items = await this.getAll();\n        return items.filter(item => item.tags && item.tags.includes(tag));\n      } catch (e) {\n        console.error('[DICE]FavoritesDB getByTag error:', e);\n        return [];\n      }\n    },\n\n    // \n    async clear(): Promise<boolean> {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.clear();\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB clear error:', e);\n        return false;\n      }\n    },\n\n    // \n    async count(): Promise<number> {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.count();\n\n          request.onsuccess = () => resolve(request.result || 0);\n          request.onerror = () => resolve(0);\n        });\n      } catch (e) {\n        console.error('[DICE]FavoritesDB count error:', e);\n        return 0;\n      }\n    },\n  };\n\n  // ========================================\n  // FavoritesManager - \n  // ========================================\n\n  interface TableCompatibility {\n    tableUid: string;\n    tableName: string;\n    mode: 'strict' | 'loose' | 'incompatible';\n    matchedCols: string[];\n    unmatchedCols: string[];\n    matchRatio: number;\n  }\n\n  const FavoritesManager = {\n    // \n    async addFavorite(\n      tableUid: string,\n      tableName: string,\n      header: string[],\n      rowData: (string | number)[],\n      tags: string[] = [],\n    ): Promise<FavoriteItem | null> {\n      try {\n        const chatId = SillyTavern.getCurrentChatId() || '';\n        const item: FavoriteItem = {\n          id: crypto.randomUUID(),\n          header: header,\n          rowData: rowData,\n          tags: tags,\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n          sourceInfo: {\n            tableUid,\n            tableName,\n            chatId,\n          },\n        };\n\n        const success = await FavoritesDB.add(item);\n        if (success) {\n          console.log('[DICE]FavoritesManager :', item.id);\n          return item;\n        }\n        return null;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager addFavorite error:', e);\n        return null;\n      }\n    },\n\n    // \n    async updateFavorite(id: string, updates: Partial<FavoriteItem>): Promise<boolean> {\n      try {\n        const success = await FavoritesDB.update(id, updates);\n        if (success) {\n          console.log('[DICE]FavoritesManager :', id);\n        }\n        return success;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager updateFavorite error:', e);\n        return false;\n      }\n    },\n\n    // \n    async duplicateFavorite(id: string): Promise<FavoriteItem | null> {\n      try {\n        const original = await FavoritesDB.get(id);\n        if (!original) return null;\n\n        const copy: FavoriteItem = {\n          ...original,\n          id: crypto.randomUUID(),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n\n        const success = await FavoritesDB.add(copy);\n        if (success) {\n          console.log('[DICE]FavoritesManager :', id, '->', copy.id);\n          return copy;\n        }\n        return null;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager duplicateFavorite error:', e);\n        return null;\n      }\n    },\n\n    // \n    async deleteFavorite(id: string): Promise<boolean> {\n      try {\n        const success = await FavoritesDB.delete(id);\n        if (success) {\n          console.log('[DICE]FavoritesManager :', id);\n        }\n        return success;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager deleteFavorite error:', e);\n        return false;\n      }\n    },\n\n    // \n    async addTag(id: string, tag: string): Promise<boolean> {\n      try {\n        const item = await FavoritesDB.get(id);\n        if (!item) return false;\n\n        if (!item.tags.includes(tag)) {\n          item.tags.push(tag);\n          return await FavoritesDB.update(id, { tags: item.tags });\n        }\n        return true;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager addTag error:', e);\n        return false;\n      }\n    },\n\n    // \n    async removeTag(id: string, tag: string): Promise<boolean> {\n      try {\n        const item = await FavoritesDB.get(id);\n        if (!item) return false;\n\n        const index = item.tags.indexOf(tag);\n        if (index > -1) {\n          item.tags.splice(index, 1);\n          return await FavoritesDB.update(id, { tags: item.tags });\n        }\n        return true;\n      } catch (e) {\n        console.error('[DICE]FavoritesManager removeTag error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAllTags(): Promise<string[]> {\n      return await FavoritesDB.getAllTags();\n    },\n\n    // \n    async getAll(): Promise<FavoriteItem[]> {\n      return await FavoritesDB.getAll();\n    },\n\n    // \n    async getByTag(tag: string): Promise<FavoriteItem[]> {\n      return await FavoritesDB.getByTag(tag);\n    },\n\n    // ID\n    async getById(id: string): Promise<FavoriteItem | null> {\n      return await FavoritesDB.get(id);\n    },\n\n    // \n    findCompatibleTables(favorite: FavoriteItem, currentTables: Record<string, any>): TableCompatibility[] {\n      const results: TableCompatibility[] = [];\n\n      for (const uid in currentTables) {\n        const table = currentTables[uid];\n        if (!table || !table.content || !table.content[0]) continue;\n\n        // null\n        const tableHeader: string[] = table.content[0].slice(1).map((h: any) => String(h || ''));\n\n        // \n        const isStrict =\n          favorite.header.length === tableHeader.length && favorite.header.every((h, i) => h === tableHeader[i]);\n\n        // \n        const matchedCols = favorite.header.filter(h => tableHeader.includes(h));\n        const unmatchedCols = favorite.header.filter(h => !tableHeader.includes(h));\n        const matchRatio = favorite.header.length > 0 ? matchedCols.length / favorite.header.length : 0;\n\n        if (isStrict) {\n          results.push({\n            tableUid: uid,\n            tableName: table.name || uid,\n            mode: 'strict',\n            matchedCols,\n            unmatchedCols,\n            matchRatio: 1,\n          });\n        } else if (matchRatio > 0) {\n          results.push({\n            tableUid: uid,\n            tableName: table.name || uid,\n            mode: 'loose',\n            matchedCols,\n            unmatchedCols,\n            matchRatio,\n          });\n        }\n      }\n\n      // strictmatchRatio\n      return results.sort((a, b) => {\n        if (a.mode === 'strict' && b.mode !== 'strict') return -1;\n        if (a.mode !== 'strict' && b.mode === 'strict') return 1;\n        return b.matchRatio - a.matchRatio;\n      });\n    },\n\n    // \n    mapRowToTable(favorite: FavoriteItem, targetHeader: string[]): (string | number | null)[] {\n      const newRow: (string | number | null)[] = [null]; // null\n      for (const col of targetHeader) {\n        const srcIndex = favorite.header.indexOf(col);\n        newRow.push(srcIndex >= 0 ? favorite.rowData[srcIndex] : '');\n      }\n      return newRow;\n    },\n\n    // \n    async exportFavorites(): Promise<string> {\n      try {\n        const items = await FavoritesDB.getAll();\n        const exportData = {\n          version: 1,\n          exportedAt: Date.now(),\n          items: items,\n        };\n        return JSON.stringify(exportData, null, 2);\n      } catch (e) {\n        console.error('[DICE]FavoritesManager exportFavorites error:', e);\n        return '';\n      }\n    },\n\n    // \n    async importFavorites(jsonStr: string): Promise<{ added: number; updated: number } | null> {\n      try {\n        const data = JSON.parse(jsonStr);\n        if (!data || !data.items || !Array.isArray(data.items)) {\n          console.error('[DICE]FavoritesManager ');\n          return null;\n        }\n\n        let added = 0;\n        let updated = 0;\n\n        for (const item of data.items) {\n          if (!item.id || !item.header || !item.rowData) continue;\n\n          const existing = await FavoritesDB.get(item.id);\n          if (existing) {\n            // \n            await FavoritesDB.update(item.id, {\n              header: item.header,\n              rowData: item.rowData,\n              tags: item.tags || [],\n              updatedAt: Date.now(),\n              sourceInfo: item.sourceInfo,\n            });\n            updated++;\n          } else {\n            // \n            const newItem: FavoriteItem = {\n              id: item.id,\n              header: item.header,\n              rowData: item.rowData,\n              tags: item.tags || [],\n              createdAt: item.createdAt || Date.now(),\n              updatedAt: Date.now(),\n              sourceInfo: item.sourceInfo,\n            };\n            await FavoritesDB.add(newItem);\n            added++;\n          }\n        }\n\n        console.log('[DICE]FavoritesManager :', added, ',', updated, '');\n        return { added, updated };\n      } catch (e) {\n        console.error('[DICE]FavoritesManager importFavorites error:', e);\n        return null;\n      }\n    },\n  };\n\n  // []  SillyTavern  URL\n  const getUserAvatarUrl = () => {\n    try {\n      // 1:  DOM \n      const w = window.parent || window;\n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        // SillyTavern  #user_avatar_block img  .avatar[title=\"You\"] img\n        const $avatar = $('#user_avatar_block img').first();\n        if ($avatar.length && $avatar.attr('src')) {\n          return $avatar.attr('src');\n        }\n        // \n        const $userMes = $('.mes[is_user=\"true\"]').last().find('.avatar img');\n        if ($userMes.length && $userMes.attr('src')) {\n          return $userMes.attr('src');\n        }\n      }\n      // 2:  SillyTavern API \n      const ST = w.SillyTavern || window.SillyTavern;\n      if (ST && ST.getContext) {\n        const ctx = ST.getContext();\n        if (ctx && ctx.userAvatar) {\n          return ctx.userAvatar;\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getUserAvatarUrl error:', e);\n    }\n    return null;\n  };\n\n  // [] \n  const getPlayerName = () => {\n    const rawData = cachedRawData || (typeof getTableData === 'function' ? getTableData() : null);\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]?.[1]) {\n          return sheet.content[1][1];\n        }\n      }\n    }\n    return null;\n  };\n\n  // []  SillyTavern Persona \n  const getPersonaName = () => {\n    try {\n      // 1: SillyTavern  API\n      const w = window.parent || window;\n      if (w.SillyTavern?.getContext) {\n        const ctx = w.SillyTavern.getContext();\n        if (ctx?.name1) return ctx.name1;\n      }\n      // 2: \n      if (typeof name1 !== 'undefined' && name1) return name1;\n      if (w.name1) return w.name1;\n      // 3:  DOM \n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        const $persona = $('#user_avatar_block .avatar-name, #persona_name_input').first();\n        if ($persona.length) {\n          const name = $persona.val?.() || $persona.text?.();\n          if (name && name.trim()) return name.trim();\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getPersonaName error:', e);\n    }\n    return null;\n  };\n\n  // []  Persona\n  const getDisplayPlayerName = () => {\n    return getPersonaName() || getPlayerName() || '';\n  };\n\n  // []  Persona \n  const replaceUserPlaceholders = text => {\n    if (!text || typeof text !== 'string') return text;\n    const displayName = getDisplayPlayerName();\n    //  <user>{{user}}\n    let result = text.replace(/<user>/gi, displayName);\n    result = result.replace(/\\{\\{user\\}\\}/gi, displayName);\n    return result;\n  };\n  // \n  const AvatarManager = {\n    _cache: null,\n\n    load() {\n      if (!this._cache) {\n        const raw = Store.get(STORAGE_KEY_AVATAR_MAP, {});\n        this._cache = {};\n        for (const name in raw) {\n          if (typeof raw[name] === 'string') {\n            this._cache[name] = { url: raw[name], offsetX: 50, offsetY: 50, scale: 150, aliases: [], createdAt: 0 };\n          } else {\n            this._cache[name] = {\n              url: raw[name].url || '',\n              offsetX: raw[name].offsetX ?? 50,\n              offsetY: raw[name].offsetY ?? 50,\n              scale: raw[name].scale ?? 150,\n              aliases: raw[name].aliases || [],\n              createdAt: raw[name].createdAt ?? 0,\n            };\n          }\n        }\n      }\n      return this._cache;\n    },\n\n    save() {\n      Store.set(STORAGE_KEY_AVATAR_MAP, this._cache || {});\n      this._cache = null;\n    },\n\n    //  URL  ST \n    get(name) {\n      const data = this.load()[name];\n      if (data && data.url) return data.url;\n\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          if (this._cache[key].url) return this._cache[key].url;\n        }\n      }\n\n      return null;\n    },\n\n    //  > URL > ST\n    async getAsync(name) {\n      if (!name) return null;\n\n      // \n      const playerName = getPlayerName();\n      const isPlayer = name === '<user>' || name === '' || (playerName && name === playerName);\n\n      // 1.  IndexedDB\n      const localUrl = await LocalAvatarDB.get(name);\n      if (localUrl) return localUrl;\n\n      // 2.  <user> \n      if (isPlayer && name !== '<user>') {\n        const userLocalUrl = await LocalAvatarDB.get('<user>');\n        if (userLocalUrl) return userLocalUrl;\n      }\n\n      // 3. \n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        const aliasLocalUrl = await LocalAvatarDB.get(primaryName);\n        if (aliasLocalUrl) return aliasLocalUrl;\n      }\n\n      // 4. URL / ST\n      return this.get(name);\n    },\n\n    // \n    async hasLocalAvatar(name) {\n      if (!name) return false;\n      const has = await LocalAvatarDB.has(name);\n      if (has) return true;\n\n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        return await LocalAvatarDB.has(primaryName);\n      }\n      return false;\n    },\n\n    // \n    async saveLocalAvatar(name, blob) {\n      return await LocalAvatarDB.save(name, blob);\n    },\n\n    // \n    async deleteLocalAvatar(name) {\n      return await LocalAvatarDB.delete(name);\n    },\n\n    getOffsetX(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetX ?? 50) : 50;\n    },\n\n    getOffsetY(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetY ?? 50) : 50;\n    },\n\n    getScale(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.scale ?? 150) : 150;\n    },\n\n    // \n    _resolveByAlias(name) {\n      const data = this.load()[name];\n      if (data) return data;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return this._cache[key];\n        }\n      }\n      return null;\n    },\n\n    // \n    getPrimaryName(name) {\n      if (this.load()[name]) return name;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return key;\n        }\n      }\n      return name;\n    },\n\n    set(name, url, offsetX = 50, offsetY = 50, scale = 150, aliases = []) {\n      const existing = this.load()[name];\n      const createdAt = existing ? (existing.createdAt ?? 0) : Date.now();\n      this.load()[name] = { url, offsetX, offsetY, scale, aliases, createdAt };\n      this.save();\n    },\n\n    setPosition(name, offsetX, offsetY) {\n      const data = this.load()[name];\n      if (data) {\n        data.offsetX = offsetX;\n        data.offsetY = offsetY;\n        this.save();\n      }\n    },\n\n    setScale(name, scale) {\n      const data = this.load()[name];\n      if (data) {\n        data.scale = scale;\n        this.save();\n      }\n    },\n\n    setAliases(name, aliases) {\n      const data = this.load()[name];\n      if (data) {\n        data.aliases = aliases;\n        this.save();\n      }\n    },\n\n    remove(name) {\n      delete this.load()[name];\n      this.save();\n    },\n\n    getAll() {\n      return this.load();\n    },\n\n    // JSON\n    exportData() {\n      return {\n        version: 1,\n        exportTime: new Date().toISOString(),\n        avatars: this.load(),\n      };\n    },\n\n    // \n    importData(jsonData, overwriteConflicts = true) {\n      if (!jsonData || !jsonData.avatars) {\n        throw new Error('');\n      }\n\n      const current = this.load();\n      const stats = { added: 0, updated: 0, skipped: 0 };\n\n      for (const name in jsonData.avatars) {\n        const imported = jsonData.avatars[name];\n        if (!imported.url) continue;\n\n        if (current[name]) {\n          // \n          if (overwriteConflicts) {\n            current[name] = {\n              url: imported.url,\n              offsetX: imported.offsetX ?? 50,\n              offsetY: imported.offsetY ?? 50,\n              scale: imported.scale ?? 150,\n              aliases: imported.aliases || [],\n              createdAt: imported.createdAt ?? 0,\n            };\n            stats.updated++;\n          } else {\n            stats.skipped++;\n          }\n        } else {\n          // \n          current[name] = {\n            url: imported.url,\n            offsetX: imported.offsetX ?? 50,\n            offsetY: imported.offsetY ?? 50,\n            scale: imported.scale ?? 150,\n            aliases: imported.aliases || [],\n            createdAt: imported.createdAt ?? 0,\n          };\n          stats.added++;\n        }\n      }\n\n      this.save();\n      return stats;\n    },\n\n    // \n    analyzeImport(jsonData) {\n      if (!jsonData || !jsonData.avatars) {\n        return { valid: false, error: '' };\n      }\n\n      const current = this.load();\n      const result = { valid: true, total: 0, newItems: [], conflicts: [] };\n\n      for (const name in jsonData.avatars) {\n        if (!jsonData.avatars[name].url) continue;\n        result.total++;\n        if (current[name]) {\n          result.conflicts.push(name);\n        } else {\n          result.newItems.push(name);\n        }\n      }\n\n      return result;\n    },\n  };\n\n  //  fa:xxx emoji\n  const renderIcon = (icon: string | null): string => {\n    if (!icon) return '';\n    if (icon.startsWith('fa:')) {\n      const name = icon.slice(3);\n      return `<i class=\"fa-solid fa-${name} acu-icon\"></i>`;\n    }\n    return icon; // emoji\n  };\n\n  const getLocationEmoji = name => {\n    if (!name) return null;\n    const lowerName = name.toLowerCase();\n    for (const [pattern, emoji] of LOCATION_EMOJI_MAP) {\n      if (pattern.test(lowerName)) return emoji;\n    }\n    return null;\n  };\n\n  // emoji\n  const getEmojiCandidates = (name: string): string[] => {\n    if (!name) return [];\n    const lowerName = name.toLowerCase();\n    const candidates: string[] = [];\n    for (const [pattern, emoji] of LOCATION_EMOJI_MAP) {\n      if (pattern.test(lowerName)) {\n        candidates.push(emoji);\n      }\n    }\n    return candidates;\n  };\n\n  // emoji\n  const resolveBatchLocationEmojis = (names: string[]): Map<string, string | null> => {\n    // 1. \n    const candidatesMap = new Map<string, string[]>();\n    for (const name of names) {\n      candidatesMap.set(name, getEmojiCandidates(name));\n    }\n\n    // 2. \n    const sortedNames = [...names].sort((a, b) => {\n      if (a.length !== b.length) return a.length - b.length;\n      return a.localeCompare(b);\n    });\n\n    // 3. \n    const usedEmojis = new Set<string>();\n    const result = new Map<string, string | null>();\n\n    for (const name of sortedNames) {\n      const candidates = candidatesMap.get(name) || [];\n      const available = candidates.find(e => !usedEmojis.has(e));\n      if (available) {\n        result.set(name, available);\n        usedEmojis.add(available);\n      } else {\n        // \n        result.set(name, candidates.length > 0 ? candidates[0] : null);\n      }\n    }\n\n    return result;\n  };\n\n  const getElementEmoji = (name, type) => {\n    if (!name && !type) return null;\n    const lowerName = name?.toLowerCase();\n    const lowerType = type?.toLowerCase();\n    for (const [pattern, emoji] of ELEMENT_EMOJI_MAP) {\n      if (lowerName && pattern.test(lowerName)) return emoji;\n    }\n    for (const [pattern, emoji] of ELEMENT_EMOJI_MAP) {\n      if (lowerType && pattern.test(lowerType)) return emoji;\n    }\n    return null;\n  };\n\n  // ========================================\n  // MVU  v2.0\n  //  -  UI\n  // ========================================\n  const MvuModule = (function () {\n    'use strict';\n\n    // [] MVU  - \n    function parseMvuPathForDice(path, value) {\n      try {\n        if (!path || typeof path !== 'string') {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        //  . \n        const parts = path.split('.').filter(p => p && p.trim());\n\n        if (parts.length === 0) {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        // \n        const blacklist = [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          'stat_data',\n          'delta_data',\n        ];\n\n        // \n        const filteredParts = parts.filter(p => !blacklist.includes(p));\n\n        // \n        let initiator = null;\n        if (filteredParts.length >= 2) {\n          // \n          initiator = filteredParts[filteredParts.length - 2];\n        } else if (filteredParts.length === 1) {\n          // \n          initiator = filteredParts[0];\n        }\n\n        // \n        let attrName = null;\n        if (filteredParts.length > 0) {\n          attrName = filteredParts[filteredParts.length - 1];\n        } else if (parts.length > 0) {\n          // \n          attrName = parts[parts.length - 1];\n        }\n\n        // \n        const candidates = filteredParts.length > 0 ? filteredParts : parts.slice(-1);\n\n        return {\n          initiator: initiator || null,\n          attrName: attrName || null,\n          candidates: candidates,\n        };\n      } catch (e) {\n        console.warn('[DICE]parseMvuPathForDice ', e);\n        return { initiator: null, attrName: null, candidates: [] };\n      }\n    }\n\n    // =====  =====\n    const MODULE_ID = '__mvu__';\n    let cachedEraData = null; //  ERA \n    let cachedEraDataChatId: string | null = null;\n\n    function getCurrentChatIdSafe(): string | null {\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      try {\n        return typeof ST?.getCurrentChatId === 'function' ? ST.getCurrentChatId() : null;\n      } catch {\n        return null;\n      }\n    }\n\n    function clearMvuCacheIfChatChanged() {\n      const chatId = getCurrentChatIdSafe();\n      if (!cachedEraData) return;\n      if (!chatId) return;\n      if (cachedEraDataChatId && cachedEraDataChatId !== chatId) {\n        cachedEraData = null;\n        cachedEraDataChatId = null;\n      }\n    }\n\n    function isLwbChatContext(): boolean {\n      const lwbGuard = globalThis.LWB_Guard || window.LWB_Guard || window.parent?.LWB_Guard;\n      if (typeof lwbGuard !== 'object' || lwbGuard === null) return false;\n\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      const chatMetadata = ST?.chatMetadata;\n      if (typeof chatMetadata !== 'object' || chatMetadata === null) return false;\n\n      //  ERA  ERA  ERA  LWB\n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n      if (typeof eventEmit === 'function' && typeof eventOn === 'function') {\n        const variablesUnknown = (chatMetadata as { variables?: unknown }).variables;\n        if (typeof variablesUnknown === 'object' && variablesUnknown !== null) {\n          const variables = variablesUnknown as Record<string, unknown>;\n          //  ERA  ERA \n          if (variables.ERAMetaData !== undefined || variables.stat_data !== undefined) {\n            return false;\n          }\n        }\n      }\n\n      //  MVU  MVU  LWB\n      // MVU  chatMetadata.variables \n      //  chatMetadata  LWB_*  MVU\n      if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n        // MVU  MVU \n        try {\n          const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n          //  MVU  stat_data  MVU \n          if (mvuData !== null && mvuData !== undefined) {\n            return false;\n          }\n        } catch {\n          // MVU  LWB\n        }\n      }\n\n      // LWB_Guard \n      //  LWB  LWB \n\n      //  chatMetadata  LWB_* \n      const hasLwbMetaKey = Object.keys(chatMetadata).some(k => k.startsWith('LWB_') || k.startsWith('lwb_'));\n      if (hasLwbMetaKey) return true;\n\n      const variablesUnknown = (chatMetadata as { variables?: unknown }).variables;\n      if (typeof variablesUnknown !== 'object' || variablesUnknown === null) return false;\n\n      const variables = variablesUnknown as Record<string, unknown>;\n\n      //  variables  LWB_* \n      const hasLwbVarKey = Object.keys(variables).some(k => k.startsWith('LWB_') || k.startsWith('lwb_'));\n      if (hasLwbVarKey) return true;\n\n      //  LWB  LWB\n      // JSON  MVU \n      // MVU  chatMetadata.variables \n      //  LWB_*  LWB \n      return false;\n    }\n\n    // =====  ERA  =====\n    function hasEraDataInCurrentChat(): boolean {\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      const chatMetadata = ST?.chatMetadata;\n      if (typeof chatMetadata !== 'object' || chatMetadata === null) return false;\n\n      const variablesUnknown = (chatMetadata as { variables?: unknown }).variables;\n      if (typeof variablesUnknown !== 'object' || variablesUnknown === null) return false;\n\n      const variables = variablesUnknown as Record<string, unknown>;\n      // ERA  ERAMetaData  stat_data \n      return variables.ERAMetaData !== undefined || variables.stat_data !== undefined;\n    }\n\n    // =====  =====\n    function detectMode() {\n      clearMvuCacheIfChatChanged();\n\n      // \n      if (cachedEraData && cachedEraData._source) {\n        return cachedEraData._source;\n      }\n\n      // []  LWB (X) LWB \n      if (isLwbChatContext()) {\n        console.log('[DICE]MvuModule  LWB (X) ');\n        return 'lwb';\n      }\n\n      //  ERA   ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n      const eraFrameworkExists = typeof eventEmit === 'function' && typeof eventOn === 'function';\n\n      if (eraFrameworkExists && hasEraDataInCurrentChat()) {\n        console.log('[DICE]MvuModule  ERA  ERA ');\n        return 'era';\n      }\n\n      //  MVU\n      if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n        console.log('[DICE]MvuModule  MVU ');\n        return 'mvu';\n      }\n\n      //  ERA  ERA\n      if (eraFrameworkExists) {\n        console.log('[DICE]MvuModule  ERA ');\n        return 'era';\n      }\n\n      //  MVU\n      console.log('[DICE]MvuModule  MVU ');\n      return 'mvu';\n    }\n\n    // ===== =====\n    async function detectModeWithData() {\n      // [] 1.  LWB\n      if (isLwbChatContext()) {\n        const lwbData = getLwbData();\n        console.log('[DICE] LWB :', Object.keys(lwbData.stat_data).length);\n        return { mode: 'lwb', data: lwbData };\n      }\n\n      // 2.  ERA   ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n      const eraFrameworkExists = typeof eventEmit === 'function' && typeof eventOn === 'function';\n\n      if (eraFrameworkExists && hasEraDataInCurrentChat()) {\n        try {\n          //  ERA \n          const eraData = await Promise.race([\n            getEraData(),\n            new Promise((_, reject) => setTimeout(() => reject(new Error('ERA timeout')), 2000)),\n          ]);\n\n          if (eraData && eraData.stat_data) {\n            console.log('[DICE] ERA ');\n            return { mode: 'era', data: eraData };\n          }\n        } catch (e) {\n          console.warn('[DICE]ERA :', e.message);\n        }\n      }\n\n      // 3.  MVU\n      try {\n        await waitGlobalInitialized('Mvu');\n\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (mvuData && mvuData.stat_data) {\n            console.log('[DICE] MVU ');\n            return {\n              mode: 'mvu',\n              data: {\n                stat_data: mvuData.stat_data || null,\n                display_data: mvuData.display_data || {},\n                delta_data: mvuData.delta_data || {},\n                schema: mvuData.schema || null,\n                _source: 'mvu', // \n              },\n            };\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MVU :', e);\n      }\n\n      // 3.  MVU \n      console.warn('[DICE] MVU ');\n      return { mode: 'mvu', data: null };\n    }\n\n    // ===== LWB (X)  =====\n    // JSON LWB \n    // LWB  JSON.parse\n    function parseJsonSafe(value: unknown): unknown {\n      if (typeof value !== 'string') return value;\n\n      const trimmed = value.trim();\n      if (!trimmed.startsWith('{') && !trimmed.startsWith('[')) return value;\n\n      try {\n        return JSON.parse(trimmed) as unknown;\n      } catch {\n        return value;\n      }\n    }\n\n    // X\n    function getLwbData() {\n      try {\n        // iframe  SillyTavern \n        const ST = window.SillyTavern || window.parent?.SillyTavern;\n        const variables = ST?.chatMetadata?.variables || {};\n        const stat_data: Record<string, unknown> = {};\n\n        for (const [key, value] of Object.entries(variables)) {\n          // X\n          if (key.startsWith('LWB_') || key.startsWith('lwb_')) continue;\n\n          //  parseJsonSafe  JSON \n          const parsed = parseJsonSafe(value);\n\n          // plot-log\n          if (typeof parsed === 'object' && parsed !== null) {\n            stat_data[key] = parsed;\n          }\n        }\n\n        //  stat_data \n        //  _source: 'lwb'  detectMode()  'lwb'\n        //  cachedEraData\n        return {\n          stat_data,\n          display_data: {},\n          delta_data: {},\n          _source: 'lwb',\n        };\n      } catch (e) {\n        console.warn('[DICE]LWB:', e);\n        //  LWB \n        return {\n          stat_data: {},\n          display_data: {},\n          delta_data: {},\n          _source: 'lwb',\n        };\n      }\n    }\n\n    // ===== ERA  =====\n    // ERA\n    async function getEraData() {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(null);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onResult = detail => {\n          clearTimeout(timeoutId);\n          //  eventOff \n          if (typeof eventOff === 'function') {\n            try {\n              eventOff('era:queryResult', onResult);\n            } catch (e) {\n              console.warn('[DICE]MvuModule :', e);\n            }\n          }\n\n          console.log('[DICE]MvuModule ERA:', JSON.stringify(detail, null, 2));\n          console.log('[DICE]MvuModule detail.result:', JSON.stringify(detail.result, null, 2));\n\n          if (detail.result && detail.result.error) {\n            console.error('[DICE]MvuModule ERA:', detail.result.error);\n            resolve(null);\n            return;\n          }\n\n          const statData = detail.result?.statWithoutMeta || null;\n          console.log('[DICE]MvuModule  stat_data:', JSON.stringify(statData, null, 2));\n\n          const result = {\n            stat_data: statData,\n            delta_data: {},\n            schema: null,\n            _source: 'era', // \n          };\n\n          // \n          cachedEraData = result;\n          cachedEraDataChatId = getCurrentChatIdSafe();\n\n          resolve(result);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA...');\n          console.log('[DICE]MvuModule ERA API :', {\n            eventEmit: typeof eventEmit === 'function',\n            eventOn: typeof eventOn === 'function',\n            eventOff: typeof eventOff === 'function',\n          });\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n\n          eventOn('era:queryResult', onResult);\n          eventEmit('era:getCurrentVars');\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(null);\n        }\n      });\n    }\n\n    // ERA \n    async function setEraValue(path, newValue) {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(false);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onWriteDone = detail => {\n          clearTimeout(timeoutId);\n          if (typeof eventOff === 'function') {\n            eventOff('era:writeDone', onWriteDone);\n          }\n          console.log('[DICE]MvuModule ERA');\n          resolve(true);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA:', path, newValue);\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n\n          eventOn('era:writeDone', onWriteDone);\n          eventEmit('era:updateByPath', {\n            path: path,\n            value: newValue,\n          });\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(false);\n        }\n      });\n    }\n\n    // =====  =====\n    const STYLES = `\n            /* MVU  */\n            .acu-mvu-panel {\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n                min-height: 300px; /*  */\n                overflow: hidden; /*  */\n            }\n            .acu-mvu-panel .acu-panel-header {\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                padding: 10px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                flex-shrink: 0;\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title i {\n                color: var(--acu-accent);\n            }\n            .acu-mvu-panel .acu-header-actions {\n                display: flex;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn {\n                background: transparent;\n                border: none;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                padding: 4px;\n                font-size: 14px;\n                border-radius: 4px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn:hover {\n                background: transparent;\n                color: var(--acu-accent);\n            }\n            .acu-mvu-panel .mvu-header-btn.active {\n                background: transparent;\n                color: var(--acu-accent);\n                font-weight: bold;\n            }\n            /* []  */\n            .mvu-numeric-mode {\n                padding: 0;\n            }\n            .mvu-numeric-level-controls {\n                position: sticky;\n                top: 0;\n                z-index: 10;\n            }\n            /* []  */\n            .mvu-level-controls-collapsible {\n                margin-bottom: 8px;\n            }\n            .mvu-level-controls-header {\n                transition: background 0.2s;\n            }\n            .mvu-level-controls-header:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-level-controls-body {\n                overflow-y: auto;\n                overflow-x: hidden;\n                transition: max-height 0.3s ease-out, padding-top 0.3s ease-out, padding-bottom 0.3s ease-out, border-bottom 0.3s ease-out;\n                max-height: 300px; /*  */\n                scrollbar-width: thin;\n            }\n            /*  */\n            @media (max-width: 768px) {\n                .mvu-level-controls-body {\n                    max-height: 200px;\n                }\n            }\n            .mvu-level-controls-body::-webkit-scrollbar {\n                width: 6px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-track {\n                background: transparent;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb {\n                background: var(--acu-border);\n                border-radius: 3px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb:hover {\n                background: var(--acu-text-sub);\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-body {\n                max-height: 0 !important;\n                padding-top: 0 !important;\n                padding-bottom: 0 !important;\n                border-bottom: none !important;\n                margin: 0 !important;\n            }\n            .mvu-level-controls-toggle-icon {\n                transition: transform 0.3s ease-out;\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-toggle-icon {\n                transform: rotate(-90deg);\n            }\n            .mvu-numeric-items {\n                max-height: calc(100vh - 200px);\n                overflow-y: auto;\n            }\n            .mvu-numeric-item {\n                transition: background 0.2s;\n            }\n            .mvu-numeric-item:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-dice-icon {\n                transition: opacity 0.2s, transform 0.2s;\n            }\n            .mvu-dice-icon:hover {\n                opacity: 1 !important;\n                transform: scale(1.1);\n            }\n            .mvu-level-toggle:hover {\n                opacity: 1 !important;\n            }\n            .mvu-level-toggle[data-visible=\"true\"]:hover {\n                background: var(--acu-accent) !important;\n                color: var(--acu-btn-active-text) !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .mvu-level-toggle[data-visible=\"false\"]:hover,\n            .mvu-level-toggle[data-visible=\"\"]:hover {\n                background: var(--acu-table-hover) !important;\n                color: var(--acu-text-sub) !important;\n                border-color: var(--acu-border) !important;\n            }\n\n            /* MVU  -  */\n            .mvu-content {\n                display: flex;\n                flex-direction: column;\n                overflow-x: hidden;\n                overflow-y: auto; /*  */\n                flex: 1 1 auto;\n                min-height: 0; /*  flex  */\n                max-height: 100%; /*  */\n                padding: 12px;\n                scrollbar-width: thin;\n            }\n            .mvu-content::-webkit-scrollbar {\n                display: none;\n            }\n            .mvu-content .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 100%;\n                max-width: 100%;\n                width: 100%;\n            }\n            /* MVU */\n            .acu-mvu-panel {\n                overflow-y: auto !important;\n                overflow-x: hidden !important;\n                flex: 1 1 0; /*  flex-basis: 0  */\n                min-height: 300px; /*  */\n            }\n\n            /* MVU  */\n            .mvu-card {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 10px;\n                overflow: hidden;\n            }\n            .mvu-card:last-child {\n                margin-bottom: 0;\n            }\n            .mvu-card-header {\n                background: var(--acu-table-head);\n                padding: 8px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                cursor: pointer;\n                user-select: none;\n                transition: background 0.2s;\n            }\n            .mvu-card-header:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-card-title {\n                font-weight: 600;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            .mvu-card-count {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                font-weight: normal;\n            }\n            .mvu-card-toggle {\n                color: var(--acu-text-sub);\n                font-size: 10px;\n                transition: transform 0.2s;\n            }\n            .mvu-card.collapsed .mvu-card-toggle {\n                transform: rotate(-90deg);\n            }\n            .mvu-card-body {\n                padding: 8px 12px;\n                display: block;\n                overflow: hidden; /*  slideUp/slideDown  */\n            }\n            .mvu-card.collapsed .mvu-card-body {\n                display: none;\n            }\n\n            /*  */\n            .mvu-card .mvu-card {\n                background: var(--acu-table-head);\n                margin: 6px 0;\n            }\n            .mvu-card .mvu-card .mvu-card-header {\n                background: rgba(128,128,128,0.1);\n                padding: 6px 10px;\n            }\n            .mvu-card .mvu-card .mvu-card-body {\n                padding: 6px 10px;\n            }\n\n            /*  -  */\n            .mvu-card-body.horizontal-nested {\n                display: flex;\n                flex-direction: row;\n                flex-wrap: nowrap;\n                gap: 12px;\n                overflow-x: auto;\n                overflow-y: visible;\n                -webkit-overflow-scrolling: touch;\n                padding-bottom: 8px;\n                align-items: flex-start;\n            }\n            /*  has-nested-cards  wrap  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested {\n                flex-wrap: wrap;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-row {\n                display: flex;\n                flex: 0 0 100%;\n                width: 100%;\n                max-width: 100%; /*  */\n                box-sizing: border-box;\n            }\n            /*  has-nested-cards  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                flex: 0 0 auto; /*  */\n                min-width: 100%; /*  */\n                width: auto; /*  */\n                max-width: 450px; /*  */\n                box-sizing: border-box;\n            }\n            @media (min-width: 769px) {\n                .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                    max-width: 550px; /*  */\n                }\n            }\n            /*  -  */\n            .mvu-card-body.horizontal-nested > .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 200px;\n                max-width: 350px;\n                width: auto;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                min-width: 400px; /*  */\n                max-width: none; /*  */\n            }\n            @media (min-width: 769px) {\n                .mvu-card-body.horizontal-nested > .mvu-card {\n                    min-width: 240px;\n                    max-width: 400px;\n                }\n                .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                    min-width: 500px; /*  */\n                    max-width: none; /*  */\n                }\n            }\n\n            /*  */\n            .mvu-row {\n                display: flex;\n                align-items: flex-start;\n                padding: 5px 0;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n            .mvu-row:last-child {\n                border-bottom: none;\n            }\n            .mvu-key {\n                color: var(--acu-text-sub);\n                min-width: 80px;\n                max-width: 120px;\n                flex-shrink: 0;\n                font-size: 12px;\n                padding-right: 8px;\n                word-break: break-all;\n            }\n            .mvu-value-wrap {\n                flex: 1;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                min-width: 0;\n            }\n            .mvu-value {\n                color: var(--acu-text-main);\n                font-size: var(--acu-font-size, 13px);\n                cursor: pointer;\n                padding: 1px 6px;\n                border-radius: 4px;\n                transition: background 0.2s;\n                word-break: break-word;\n                flex: 0 1 auto;\n            }\n            .mvu-value:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-value.mvu-array-value {\n                font-size: calc(var(--acu-font-size, 13px) * 0.92);\n                color: var(--acu-text-sub);\n            }\n            .mvu-change-indicator {\n                color: var(--acu-success-text);\n                font-weight: bold;\n                font-size: 12px;\n                flex-shrink: 0;\n            }\n            .mvu-row.mvu-changed {\n                background: var(--acu-success-bg);\n                margin: 0 -12px;\n                padding: 5px 12px;\n                border-radius: 4px;\n            }\n            .mvu-card .mvu-card .mvu-row.mvu-changed {\n                margin: 0 -10px;\n                padding: 5px 10px;\n            }\n\n            /*  */\n            .mvu-empty {\n                text-align: center;\n                padding: 40px 20px;\n                color: var(--acu-text-sub);\n                flex: 1;\n                min-width: 100%;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n            }\n            .mvu-empty i {\n                font-size: 32px;\n                margin-bottom: 12px;\n                display: block;\n                opacity: 0.5;\n            }\n            .mvu-empty p {\n                margin: 0 0 6px 0;\n            }\n            .mvu-empty .mvu-empty-hint {\n                font-size: 12px;\n                opacity: 0.7;\n            }\n\n            /*  */\n            .mvu-edit-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0,0,0,0.6);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 99999;\n                animation: mvuFadeIn 0.15s ease-out;\n            }\n            .mvu-edit-dialog {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                padding: 16px;\n                width: 90%;\n                max-width: 400px;\n                animation: mvuSlideIn 0.2s ease-out;\n            }\n            .mvu-edit-title {\n                font-weight: 600;\n                color: var(--acu-text-main);\n                margin-bottom: 12px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .mvu-edit-path {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                background: var(--acu-table-head);\n                padding: 6px 10px;\n                border-radius: 4px;\n                margin-bottom: 12px;\n                word-break: break-all;\n                font-family: monospace;\n            }\n            .mvu-edit-textarea {\n                width: 100%;\n                min-height: 80px;\n                padding: 10px;\n                border: 1px solid var(--acu-border);\n                border-radius: 4px;\n                background: var(--acu-input-bg, var(--acu-bg-panel));\n                color: var(--acu-text-main);\n                font-size: 13px;\n                resize: vertical;\n                box-sizing: border-box;\n            }\n            .mvu-edit-textarea:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n            }\n            .mvu-edit-hint {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                margin-top: 8px;\n                opacity: 0.7;\n            }\n            .mvu-edit-btns {\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n                margin-top: 16px;\n            }\n            .mvu-edit-btn {\n                padding: 8px 16px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 13px;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                transition: all 0.2s;\n            }\n            .mvu-edit-btn.mvu-btn-cancel {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n            }\n            .mvu-edit-btn.mvu-btn-cancel:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-edit-btn.mvu-btn-save {\n                background: var(--acu-accent);\n                border: 1px solid var(--acu-accent);\n                color: var(--acu-btn-active-text);\n            }\n            .mvu-edit-btn.mvu-btn-save:hover {\n                opacity: 0.9;\n            }\n\n            @keyframes mvuFadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes mvuSlideIn {\n                from { transform: translateY(-20px); opacity: 0; }\n                to { transform: translateY(0); opacity: 1; }\n            }\n\n            /*  */\n            .acu-nav-btn.acu-mvu-btn.active {\n                background: var(--acu-btn-active-bg);\n                color: var(--acu-btn-active-text);\n            }\n        `;\n\n    // =====  =====\n    function escapeHtml(s) {\n      return String(s ?? '')\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#039;');\n    }\n\n    function isAvailable() {\n      const mode = detectMode();\n\n      if (mode === 'era') {\n        // ERA  eventEmit  eventOn  iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const emitAvailable = typeof eventEmit === 'function';\n        const onAvailable = typeof eventOn === 'function';\n        return emitAvailable && onAvailable;\n      } else if (mode === 'lwb') {\n        // [] LWB  chatMetadata.variables \n        const ST = window.SillyTavern || window.parent?.SillyTavern;\n        return ST?.chatMetadata !== undefined;\n      } else {\n        // MVU  MVU \n        const mvuAvailable = typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function';\n        return mvuAvailable;\n      }\n    }\n\n    function getData() {\n      console.warn('[DICE]: getData()  MVU  getDataWithRetry()');\n\n      clearMvuCacheIfChatChanged();\n\n      //  ERA  MVU\n      if (cachedEraData) {\n        return cachedEraData;\n      }\n\n      // []  LWB\n      if (isLwbChatContext()) {\n        const lwbData = getLwbData();\n        cachedEraData = lwbData;\n        cachedEraDataChatId = getCurrentChatIdSafe();\n        console.log('[DICE]LWB ');\n        return lwbData;\n      }\n\n      //  MVU\n      try {\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (allVars && allVars.stat_data) {\n            const data = {\n              stat_data: allVars.stat_data || null,\n              display_data: allVars.display_data || {},\n              delta_data: allVars.delta_data || {},\n              schema: allVars.schema || null,\n              _source: 'mvu', // \n            };\n\n            cachedEraData = data; // \n            cachedEraDataChatId = getCurrentChatIdSafe();\n            return data;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE] MVU :', e);\n      }\n\n      return null;\n    }\n\n    // ===== MVU  =====\n    async function getMvuDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // []  MVU API \n        if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n          //  MVU \n          try {\n            await Promise.race([\n              waitGlobalInitialized('Mvu'),\n              new Promise((_, reject) => setTimeout(() => reject(new Error(' MVU ')), 3000)),\n            ]);\n          } catch (e) {\n            console.warn('[DICE] MVU :', e.message);\n            //  MVU \n          }\n        }\n\n        for (let attempt = 1; attempt <= maxRetries; attempt++) {\n          try {\n            if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n              throw new Error('MVU API ');\n            }\n\n            const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n            if (allVars && allVars.stat_data) {\n              const data = {\n                stat_data: allVars.stat_data || null,\n                display_data: allVars.display_data || {},\n                delta_data: allVars.delta_data || {},\n                schema: allVars.schema || null,\n                _source: 'mvu', // \n              };\n\n              //  MVU \n              cachedEraData = data;\n              cachedEraDataChatId = getCurrentChatIdSafe();\n              console.log('[DICE]MVU ');\n              return data;\n            }\n          } catch (e) {\n            console.warn(`[DICE]MVU  ( ${attempt}/${maxRetries}):`, e);\n          }\n\n          if (attempt < maxRetries) {\n            await new Promise(resolve => setTimeout(resolve, retryDelay));\n          }\n        }\n\n        return null;\n      } catch (e) {\n        console.error('[DICE]MVU :', e);\n        return null;\n      }\n    }\n\n    // \n    async function getDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // \n        const detection = await detectModeWithData();\n\n        // \n        if (detection.data) {\n          cachedEraData = detection.data; // \n          cachedEraDataChatId = getCurrentChatIdSafe();\n          return detection.data;\n        }\n\n        // \n        const mode = detection.mode;\n\n        if (mode === 'era') {\n          // ERA \n          for (let attempt = 1; attempt <= maxRetries; attempt++) {\n            try {\n              const data = await getEraData();\n              if (data && data.stat_data) {\n                cachedEraData = data;\n                cachedEraDataChatId = getCurrentChatIdSafe();\n                return data;\n              }\n            } catch (e) {\n              console.warn(`[DICE]ERA  ( ${attempt}/${maxRetries}):`, e);\n            }\n\n            if (attempt < maxRetries) {\n              await new Promise(resolve => setTimeout(resolve, retryDelay));\n            }\n          }\n\n          // ERA  MVU\n          console.warn('[DICE]ERA  MVU');\n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        } else if (mode === 'lwb') {\n          // [] LWB \n          const lwbData = getLwbData();\n          cachedEraData = lwbData;\n          cachedEraDataChatId = getCurrentChatIdSafe();\n          return lwbData;\n        } else {\n          // MVU \n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        }\n      } catch (e) {\n        console.error('[DICE]:', e);\n        return null;\n      }\n    }\n\n    //  ValueWithDescription  [, \"\"]\n    function isVWD(value) {\n      return (\n        Array.isArray(value) &&\n        value.length === 2 &&\n        typeof value[1] === 'string' &&\n        (typeof value[0] === 'number' || typeof value[0] === 'string' || typeof value[0] === 'boolean')\n      );\n    }\n\n    // \n    function isSimpleArray(value) {\n      if (!Array.isArray(value)) return false;\n      return value.every(\n        item => typeof item === 'string' || typeof item === 'number' || typeof item === 'boolean' || item === null,\n      );\n    }\n\n    // \n    function getChangeIndicator(path, deltaData) {\n      if (!deltaData || !path) return '';\n\n      const parts = path.split('.');\n      let current = deltaData;\n      for (const part of parts) {\n        if (current === null || current === undefined) return '';\n        current = current[part];\n      }\n\n      if (!current) return '';\n\n      if (typeof current === 'string' && current.includes('->')) {\n        const match = current.match(/^(-?[\\d.]+)->(-?[\\d.]+)/);\n        if (match) {\n          const oldVal = parseFloat(match[1]);\n          const newVal = parseFloat(match[2]);\n          if (!isNaN(oldVal) && !isNaN(newVal)) {\n            return newVal > oldVal ? '' : newVal < oldVal ? '' : '';\n          }\n        }\n        return '';\n      }\n      return '';\n    }\n\n    // /\n    function countChildren(value) {\n      if (Array.isArray(value)) {\n        if (isVWD(value)) return 0;\n        return value.length;\n      }\n      if (value && typeof value === 'object') {\n        return Object.keys(value).filter(k => !k.startsWith('$')).length;\n      }\n      return 0;\n    }\n\n    // =====  =====\n\n    // \n    // +++\n    function extractNumericDisplayValue(value, isArray = false) {\n      //  null/undefined\n      if (value === null || value === undefined) {\n        return '';\n      }\n\n      // \n      if (isArray || Array.isArray(value)) {\n        if (isVWD(value)) {\n          return String(value[0]);\n        } else if (isSimpleArray(value)) {\n          return value.map(v => String(v ?? '')).join(', ');\n        } else {\n          // \n          return String(value);\n        }\n      }\n\n      // \n      const str = String(value).trim();\n\n      // 1.  \"85\", \"-20\", \"100%\"\n      if (/^-?\\d+(\\.\\d+)?%?$/.test(str)) {\n        return str;\n      }\n\n      // 2. ++ \",[] \" \n      // \"0,[-20, 120] User...\"\n      const rangeMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)(,\\s*\\[[^\\]]+\\])?\\s+/);\n      if (rangeMatch) {\n        // \n        if (rangeMatch[2]) {\n          return rangeMatch[1] + rangeMatch[2].trim();\n        }\n        // \n        return rangeMatch[1];\n      }\n\n      // 2.5. /, \"/,\" \n      // \"100/100,/'/'\"\n      const slashNumericMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?\\/-?\\d+(?:\\.\\d+)?%?),/);\n      if (slashNumericMatch) {\n        return slashNumericMatch[1];\n      }\n\n      // 3. , \",\" \n      // \"150000,...\"\n      const commaDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?),/);\n      if (commaDescMatch) {\n        return commaDescMatch[1];\n      }\n\n      // 4. + \" \" \n      // \"85 \"\n      const numericDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)\\s+[^\\d]/);\n      if (numericDescMatch) {\n        return numericDescMatch[1];\n      }\n\n      // 5. \n      return str;\n    }\n\n    // \n    // \"85\" -> 85, \"85,[0,100]\" -> 85, \"0,[-20, 120]\" -> 0\n    function extractFirstNumericValue(displayValue) {\n      if (!displayValue) return 0;\n      const str = String(displayValue).trim();\n\n      // \n      const match = str.match(/^(-?\\d+(?:\\.\\d+)?)/);\n      if (match) {\n        const num = parseFloat(match[1]);\n        return isNaN(num) ? 0 : num;\n      }\n\n      return 0;\n    }\n\n    // \n    function renderRow(key, value, path, deltaData) {\n      const changeIndicator = getChangeIndicator(path, deltaData);\n      const changedClass = changeIndicator ? 'mvu-changed' : '';\n\n      let displayValue;\n      let valueClass = 'mvu-value';\n\n      if (isVWD(value)) {\n        displayValue = String(value[0]);\n      } else if (isSimpleArray(value)) {\n        displayValue = value.map(v => String(v ?? '')).join(', ');\n        valueClass += ' mvu-array-value';\n      } else {\n        // \n        displayValue = extractNumericDisplayValue(value ?? '', false);\n      }\n\n      // [] \n      let diceIconHtml = '';\n      try {\n        //  extractNumericDisplayValue \n        //  \"85,[0,100]\"  85  100\n        if (typeof isNumericCell === 'function' && isNumericCell(displayValue)) {\n          // \n          const numericValue = extractFirstNumericValue(displayValue);\n          if (numericValue > 0) {\n            //  key key \n            let attrName = key;\n            if (key.includes('.')) {\n              const parts = key.split('.');\n              attrName = parts[parts.length - 1];\n            }\n            // \n            if (path && path.includes('.')) {\n              const pathParts = path.split('.');\n              const lastPart = pathParts[pathParts.length - 1];\n              // \n              if (lastPart && !/^\\d+$/.test(lastPart) && lastPart !== key) {\n                attrName = lastPart;\n              }\n            }\n            diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon acu-mvu-dice-icon\" data-path=\"${escapeHtml(path)}\" data-attr-name=\"${escapeHtml(attrName)}\" data-attr-value=\"${numericValue}\" title=\"\"></i>`;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule renderRow: ', e);\n      }\n\n      return `\n                <div class=\"mvu-row ${changedClass}\">\n                    <div class=\"mvu-key\">${escapeHtml(key)}</div>\n                    <div class=\"mvu-value-wrap\">\n                        <span class=\"${valueClass}\" data-path=\"${escapeHtml(path)}\">${escapeHtml(displayValue)}</span>\n                        ${diceIconHtml}\n                        ${changeIndicator ? `<span class=\"mvu-change-indicator\">${changeIndicator}</span>` : ''}\n                    </div>\n                </div>\n            `;\n    }\n\n    // \n    function renderCard(key, value, path, deltaData, depth, defaultExpanded, isHorizontal) {\n      const childCount = countChildren(value);\n      const collapsedClass = defaultExpanded ? '' : 'collapsed';\n\n      let bodyHtml = '';\n      let hasNestedCards = false; // \n      let nestedCardCount = 0; // \n      let rowCount = 0; // \n\n      if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n        // \n        value.forEach((item, index) => {\n          const itemPath = `${path}[${index}]`;\n\n          if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(`[${index}]`, item, itemPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            rowCount++;\n            bodyHtml += renderRow(`[${index}]`, item, itemPath, deltaData);\n          }\n        });\n      } else if (value && typeof value === 'object' && !isVWD(value)) {\n        // \n        const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n\n        for (const [childKey, childValue] of entries) {\n          const childPath = path ? `${path}.${childKey}` : childKey;\n\n          if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n            // /  \n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(childKey, childValue, childPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            //   \n            rowCount++;\n            bodyHtml += renderRow(childKey, childValue, childPath, deltaData);\n          }\n        }\n      }\n\n      const countText = Array.isArray(value) ? `[${childCount}]` : `(${childCount})`;\n\n      //  card-body  horizontal-nested \n      const bodyClass = isHorizontal && hasNestedCards ? 'mvu-card-body horizontal-nested' : 'mvu-card-body';\n\n      // \n      let nestedCardsNeedWidth = false;\n      if (isHorizontal && hasNestedCards && depth === 0) {\n        // \n        if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n          // \n          value.forEach(item => {\n            if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n              const itemChildCount = countChildren(item);\n              if (itemChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          });\n        } else if (value && typeof value === 'object' && !isVWD(value)) {\n          // \n          const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n          for (const [childKey, childValue] of entries) {\n            if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n              const childChildCount = countChildren(childValue);\n              if (childChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          }\n        }\n      }\n\n      //  has-nested-cards \n      // \n      // depth === 0\n      //   -  >= 2  <= 1 has-nested-cards\n      //   -  has-nested-cards\n      // depth > 0rowCount === 0 >= 2  has-nested-cards\n      const shouldAddHasNestedClass =\n        isHorizontal &&\n        hasNestedCards &&\n        ((depth === 0 && ((nestedCardCount >= 2 && rowCount <= 1) || nestedCardsNeedWidth)) || //  >= 2  <= 1\n          (depth > 0 && rowCount === 0 && nestedCardCount >= 2)); //  >= 2\n      const hasNestedClass = shouldAddHasNestedClass ? ' has-nested-cards' : '';\n\n      return `\n                <div class=\"mvu-card${hasNestedClass} ${collapsedClass}\" data-path=\"${escapeHtml(path)}\" data-depth=\"${depth}\">\n                    <div class=\"mvu-card-header\">\n                        <div class=\"mvu-card-title\">\n                            <span>${escapeHtml(key)}</span>\n                            <span class=\"mvu-card-count\">${countText}</span>\n                        </div>\n                        <span class=\"mvu-card-toggle\"></span>\n                    </div>\n                    <div class=\"${bodyClass}\">\n                        ${bodyHtml}\n                    </div>\n                </div>\n            `;\n    }\n\n    // [] \n    function renderNumericMode(mvuData) {\n      if (!mvuData || !mvuData.stat_data) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-inbox\"></i><p></p></div>';\n      }\n\n      // [] \n      let visibleLevels = {};\n      try {\n        const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n        if (saved) {\n          visibleLevels = JSON.parse(saved);\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule ', e);\n      }\n\n      // \n      const numericItems = [];\n\n      // \n      function collectNumericItems(obj, path, levelNames) {\n        if (!obj || typeof obj !== 'object') return;\n\n        if (Array.isArray(obj)) {\n          if (isVWD(obj) || isSimpleArray(obj)) {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const itemValue = String(item ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: itemPath,\n                    key: `[${index}]`,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: [...levelNames],\n                  });\n                }\n              }\n            });\n          } else {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const newLevelNames = [...levelNames, `[${index}]`];\n              collectNumericItems(item, itemPath, newLevelNames);\n            });\n          }\n        } else {\n          // \n          const entries = Object.entries(obj).filter(([k]) => !k.startsWith('$'));\n          for (const [key, value] of entries) {\n            const childPath = path ? `${path}.${key}` : key;\n            const newLevelNames = [...levelNames, key];\n\n            if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n              // \n              collectNumericItems(value, childPath, newLevelNames);\n            } else {\n              // \n              const itemValue = String(value ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: childPath,\n                    key: key,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: newLevelNames,\n                  });\n                }\n              }\n            }\n          }\n        }\n      }\n\n      // \n      const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n      for (const key of topKeys) {\n        const value = mvuData.stat_data[key];\n        collectNumericItems(value, key, [key]);\n      }\n\n      // [] \n      const filteredNumericItems = numericItems.filter(item => {\n        // \n        const nonArrayLevels = item.levelNames.filter(level => level && !level.startsWith('['));\n        // \n        // \n        for (const levelKey of nonArrayLevels) {\n          if (BlacklistManager.isBlacklisted(levelKey)) {\n            return false;\n          }\n        }\n        return true;\n      });\n\n      if (filteredNumericItems.length === 0) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-filter\"></i><p></p></div>';\n      }\n\n      // \n      //  2\n      const allLevelNames = new Set();\n      filteredNumericItems.forEach(item => {\n        // \n        const hierarchyLevels =\n          item.levelNames.length > 1\n            ? item.levelNames.slice(0, -1) // \n            : [];\n\n        hierarchyLevels.forEach(level => {\n          if (level && !level.startsWith('[')) {\n            // \n            allLevelNames.add(level);\n          }\n        });\n      });\n\n      const levelNamesArray = Array.from(allLevelNames).sort();\n\n      //  toggle \n      let levelTogglesHtml = '';\n      if (levelNamesArray.length > 0) {\n        // \n        let levelButtonsHtml = '';\n        levelNamesArray.forEach(levelName => {\n          const isVisible = visibleLevels[levelName] !== false; // \n          const activeClass = isVisible ? 'active' : '';\n          levelButtonsHtml += `<button class=\"mvu-level-toggle acu-mvu-level-toggle ${activeClass}\" data-level=\"${escapeHtml(levelName)}\" data-visible=\"${isVisible}\" title=\"${isVisible ? '' : ''}: ${escapeHtml(levelName)}\"><span>${escapeHtml(levelName)}</span></button>`;\n        });\n\n        // \n        levelTogglesHtml = `\n          <div class=\"mvu-level-controls-collapsible collapsed\">\n            <div class=\"mvu-level-controls-header acu-mvu-header\">\n              <span class=\"acu-mvu-header-text\"></span>\n              <i class=\"fa-solid fa-chevron-down mvu-level-controls-toggle-icon acu-mvu-toggle-icon\"></i>\n            </div>\n            <div class=\"mvu-level-controls-body acu-mvu-body\">\n              ${levelButtonsHtml}\n            </div>\n          </div>\n        `;\n      }\n\n      // \n      let itemsHtml = '';\n      filteredNumericItems.forEach(item => {\n        //  data-levels \n        const nonArrayLevels = item.levelNames.filter(level => !level.startsWith('['));\n\n        // \n        const visibleLevels = item.levelNames.filter(level => {\n          if (level.startsWith('[')) return false; // \n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        //  1\n        //  visibleLevels \n        const pathLevels = visibleLevels.length > 1 ? visibleLevels.slice(0, -1) : [];\n\n        // \n        //  nonArrayLevels  N-1 \n        const hierarchyLevels = nonArrayLevels.length > 1 ? nonArrayLevels.slice(0, -1) : [];\n\n        const allLevelsVisible = hierarchyLevels.every(level => {\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        // \n        const pathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n        const attrName = item.key;\n\n        // \n        let finalAttrName = attrName;\n        if (item.path && item.path.includes('.')) {\n          const parts = item.path.split('.');\n          finalAttrName = parts[parts.length - 1];\n        }\n\n        // \n        const diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon acu-mvu-dice-icon\" data-path=\"${escapeHtml(item.path)}\" data-attr-name=\"${escapeHtml(finalAttrName)}\" data-attr-value=\"${item.numericValue}\" title=\"\"></i>`;\n\n        // \n        let displayValue = extractNumericDisplayValue(item.value, false);\n        //  \",[0, 100]\"\n        displayValue = displayValue.replace(/,\\s*\\[[^\\]]+\\]/g, '');\n\n        //  data-levels \n        // data-levels \n        const displayStyle = allLevelsVisible ? '' : 'display:none;';\n        const levelsJson = JSON.stringify(hierarchyLevels);\n\n        itemsHtml += `\n          <div class=\"mvu-numeric-item acu-mvu-item\" data-levels='${escapeHtml(levelsJson)}' style=\"${displayStyle}\">\n            <div class=\"acu-mvu-item-content\">\n              <div class=\"mvu-path-display acu-mvu-path\">${escapeHtml(pathDisplay)}</div>\n              <div class=\"acu-mvu-item-row\">\n                <span class=\"acu-mvu-attr-name\">${escapeHtml(finalAttrName)}</span>\n                <span class=\"mvu-value acu-mvu-val\" data-path=\"${escapeHtml(item.path)}\" title=\"\">${escapeHtml(displayValue)}</span>\n                ${diceIconHtml}\n              </div>\n            </div>\n          </div>\n        `;\n      });\n\n      return levelTogglesHtml + '<div class=\"mvu-numeric-items acu-mvu-list\">' + itemsHtml + '</div>';\n    }\n\n    // =====  API =====\n    return {\n      MODULE_ID: MODULE_ID,\n\n      isAvailable: isAvailable,\n      getData: getData,\n      getDataWithRetry: getDataWithRetry,\n\n      // \n      diagnoseVariableFramework: async function () {\n        const result = {\n          timestamp: new Date().toISOString(),\n          era: {\n            available: false,\n            eventEmit: typeof (window.eventEmit || window.parent?.eventEmit) === 'function',\n            eventOn: typeof (window.eventOn || window.parent?.eventOn) === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          mvu: {\n            available: false,\n            apiExists: typeof window.Mvu !== 'undefined',\n            getDataExists: typeof window.Mvu?.getMvuData === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          cache: {\n            hasCache: !!cachedEraData,\n            cacheKeys: cachedEraData ? Object.keys(cachedEraData) : [],\n          },\n          recommendation: '',\n        };\n\n        //  ERA\n        if (result.era.eventEmit && result.era.eventOn) {\n          try {\n            const eraData = await Promise.race([\n              getEraData(),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 2000)),\n            ]);\n            result.era.available = true;\n            result.era.dataAvailable = !!(eraData && eraData.stat_data);\n          } catch (e) {\n            result.era.error = e.message;\n          }\n        }\n\n        //  MVU\n        if (result.mvu.apiExists && result.mvu.getDataExists) {\n          try {\n            // [] \n            await Promise.race([\n              waitGlobalInitialized('Mvu'),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('')), 2000)),\n            ]);\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            result.mvu.available = true;\n            result.mvu.dataAvailable = !!(mvuData && mvuData.stat_data);\n          } catch (e) {\n            result.mvu.error = e.message;\n          }\n        }\n\n        // \n        if (result.era.dataAvailable) {\n          result.recommendation = 'ERA ';\n        } else if (result.mvu.dataAvailable) {\n          result.recommendation = 'MVU ';\n        } else if (result.era.available || result.mvu.available) {\n          result.recommendation = '';\n        } else {\n          result.recommendation = ' MVU  ERA ';\n        }\n\n        return result;\n      },\n\n      injectStyles: function () {\n        //  document iframe \n        const targetDoc = window.parent?.document || document;\n        if (targetDoc.getElementById('mvu-module-styles')) return;\n        const styleEl = targetDoc.createElement('style');\n        styleEl.id = 'mvu-module-styles';\n        styleEl.textContent = STYLES;\n        targetDoc.head.appendChild(styleEl);\n      },\n\n      renderNavButton: function (isActive) {\n        //  isAvailable()\n        const activeClass = isActive ? 'active' : '';\n        return `<button class=\"acu-nav-btn acu-mvu-btn $${activeClass}\" id=\"acu-btn-mvu\" data-table=\"$${MODULE_ID}\" style=\"order:-1;\">\n                    <i class=\"fa-solid fa-code-branch\"></i><span></span>\n                </button>`;\n      },\n\n      renderPanel: function () {\n        // \n        // \n\n        const mvuData = getData();\n\n        // MVU  ERA\n        const varMode = (mvuData && mvuData._source) || detectMode();\n        const isEraMode = varMode === 'era';\n\n        // [] \n        let isNumericMode = false;\n        try {\n          const saved = localStorage.getItem('acu_mvu_numeric_mode');\n          isNumericMode = saved === 'true';\n        } catch (e) {\n          console.warn('[DICE]MvuModule ', e);\n        }\n\n        // MVU\n        const layoutMode = 'vertical-layout';\n\n        // \n        const panelTitle = varMode === 'lwb' ? 'LWB ' : varMode === 'era' ? 'ERA ' : 'MVU ';\n\n        // MVU  null\n        if (!mvuData) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-exclamation-circle\"></i>\n                                <p> ${isEraMode ? 'ERA' : 'MVU'} </p>\n                                <p class=\"mvu-empty-hint\"> ${isEraMode ? 'ERA ' : 'MVU '}</p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        //  stat_data  null\n        if (\n          !mvuData.stat_data ||\n          (typeof mvuData.stat_data === 'object' && Object.keys(mvuData.stat_data).length === 0)\n        ) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-inbox\"></i>\n                                <p></p>\n                                <p class=\"mvu-empty-hint\">${varMode === 'lwb' ? ' AI  plot-log ' : ' AI '}</p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        // [] \n        if (isNumericMode) {\n          const numericHtml = renderNumericMode(mvuData);\n          return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span> <span style=\"font-size:calc(var(--acu-font-size,13px) * 0.85);color:var(--acu-text-sub);margin-left:6px;\">()</span></div>\n                            <div class=\"acu-title-sub\">()</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode active\" title=\"\">\n                                <i class=\"fa-solid fa-list\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode} mvu-numeric-mode\">\n                        ${numericHtml}\n                    </div>\n                `;\n        }\n\n        // \n        const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n\n        let cardsHtml = '';\n        for (const key of topKeys) {\n          const value = mvuData.stat_data[key];\n          const childCount = countChildren(value);\n\n          if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n            // /  \n            // MVU isHorizontal  false\n            cardsHtml += renderCard(key, value, key, mvuData.delta_data, 0, true, false);\n          } else {\n            //   \n            cardsHtml += `\n                            <div class=\"mvu-card\" data-path=\"${escapeHtml(key)}\" data-depth=\"0\">\n                                <div class=\"mvu-card-body\">\n                                    ${renderRow(key, value, key, mvuData.delta_data)}\n                                </div>\n                            </div>\n                        `;\n          }\n        }\n\n        return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                            <div class=\"acu-title-sub\">(${topKeys.length})</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode\" title=\"\">\n                                <i class=\"fa-solid fa-filter\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode}\">\n                        ${cardsHtml}\n                    </div>\n                `;\n      },\n\n      bindEvents: function ($container) {\n        //  jQuery\n        const $ = window.parent?.jQuery || window.jQuery;\n        if (!$ || !$container || !$container.length) {\n          console.warn('[DICE]MvuModule bindEvents: jQuery or container not available');\n          return;\n        }\n\n        //  jQuery \n        const $panel = $('#acu-data-area');\n        if (!$panel.length) {\n          console.warn('[DICE]MvuModule bindEvents: #acu-data-area not found');\n          return;\n        }\n\n        // \n        $panel.off('.mvu');\n\n        // /\n        $panel.on('click.mvu', '.mvu-card-header', function (e) {\n          e.stopPropagation();\n          const $card = $(this).closest('.mvu-card');\n          const $body = $card.find('> .mvu-card-body').first();\n\n          // \n          if ($body.is(':animated') || $body.hasClass('animating')) return;\n\n          if ($card.hasClass('collapsed')) {\n            //  hide()  collapsed \n            $body.hide();\n            $card.removeClass('collapsed');\n            $body.addClass('animating').slideDown(180, function () {\n              $(this).removeClass('animating');\n            });\n          } else {\n            // \n            $body.addClass('animating').slideUp(180, function () {\n              $card.addClass('collapsed');\n              $(this).removeClass('animating');\n            });\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-btn-refresh', function (e) {\n          e.stopPropagation();\n          MvuModule.refresh($panel);\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-btn-numeric-mode', function (e) {\n          e.stopPropagation();\n          try {\n            const isCurrentlyNumeric = $(this).hasClass('active');\n            const newMode = !isCurrentlyNumeric;\n            localStorage.setItem('acu_mvu_numeric_mode', String(newMode));\n            // \n            if (typeof saveActiveTabState === 'function') {\n              const currentTab = getActiveTabState();\n              saveActiveTabState(currentTab);\n            }\n            if (typeof renderInterface === 'function') {\n              renderInterface();\n            }\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n            if (window.toastr) window.toastr.error('');\n          }\n        });\n\n        // [] /\n        $panel.on('click.mvu', '.mvu-level-controls-header', function (e) {\n          e.stopPropagation();\n          const $header = $(this);\n          const $collapsible = $header.closest('.mvu-level-controls-collapsible');\n\n          //  collapsed CSS \n          $collapsible.toggleClass('collapsed');\n        });\n\n        // []  toggle\n        $panel.on('click.mvu', '.mvu-level-toggle', function (e) {\n          e.stopPropagation();\n          const $button = $(this);\n          const levelName = $button.data('level');\n          const currentVisible = $button.data('visible') === 'true' || $button.data('visible') === true;\n          const isVisible = !currentVisible;\n\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            const visibleLevels = saved ? JSON.parse(saved) : {};\n            visibleLevels[levelName] = isVisible;\n            localStorage.setItem('acu_mvu_numeric_mode_visible_levels', JSON.stringify(visibleLevels));\n\n            // \n            $button.data('visible', isVisible);\n            if (isVisible) {\n              $button.css({\n                background: 'var(--acu-accent)',\n                color: 'var(--acu-btn-active-text)',\n                borderColor: 'var(--acu-accent)',\n                opacity: '1',\n              });\n              $button.attr('title', `: ${levelName}`);\n            } else {\n              $button.css({\n                background: 'transparent',\n                color: 'var(--acu-text-sub)',\n                borderColor: 'var(--acu-border)',\n                opacity: '0.5',\n              });\n              $button.attr('title', `: ${levelName}`);\n            }\n\n            //  3\n            $('.mvu-numeric-item').each(function () {\n              const $item = $(this);\n              try {\n                const levels = JSON.parse($item.attr('data-levels') || '[]');\n                if (levels.includes(levelName)) {\n                  // \n                  const visibleLevels = levels.filter(level => {\n                    const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n                    const prefs = saved ? JSON.parse(saved) : {};\n                    return prefs[level] !== false;\n                  });\n\n                  //  levels \n                  const pathLevels = visibleLevels;\n\n                  const newPathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n\n                  // \n                  $item.find('.mvu-path-display').text(newPathDisplay);\n                }\n              } catch (e) {\n                console.warn('[DICE]MvuModule ', e);\n              }\n            });\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-value', function (e) {\n          e.stopPropagation();\n          const $value = $(this);\n          const path = $value.data('path');\n          if (!path) {\n            console.warn('[DICE]MvuModule No path on value element');\n            return;\n          }\n          const currentValue = $value\n            .text()\n            .replace(/\\s*\\$\\s*$/, '')\n            .trim(); //  $\n\n          MvuModule.showEditDialog(path, currentValue, async function (newValue) {\n            if (newValue !== null && newValue !== currentValue) {\n              const success = await MvuModule.setValue(path, newValue);\n              const toastr = window.parent?.toastr || window.toastr;\n              if (success) {\n                $value.text(newValue);\n                $value.css('background', 'var(--acu-success-bg)');\n                setTimeout(() => $value.css('background', ''), 1500);\n              } else {\n                if (toastr) toastr.error('');\n              }\n            }\n          });\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-dice-icon', function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n          const $icon = $(this);\n          const path = $icon.data('path');\n          const attrName = $icon.data('attr-name') || '';\n          const attrValue = parseInt($icon.data('attr-value'), 10) || 50;\n\n          // \n          if (!path) {\n            console.warn('[DICE]MvuModule ');\n            return;\n          }\n\n          //  MVU \n          if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n            console.warn('[DICE]MvuModule MVU ');\n            // \n            if (typeof showDicePanel === 'function') {\n              showDicePanel({\n                attrValue: attrValue,\n                targetValue: null, // showDicePanel\n                targetName: attrName,\n                initiatorName: '<user>',\n                fromMvu: false,\n              });\n            }\n            return;\n          }\n\n          // \n          let parsedInfo = null;\n          try {\n            parsedInfo = parseMvuPathForDice(path, attrValue);\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n\n          // \n          if (typeof showDicePanel === 'function') {\n            showDicePanel({\n              attrValue: attrValue,\n              targetValue: null, // showDicePanel\n              targetName: attrName,\n              initiatorName: parsedInfo?.initiator || '<user>',\n              fromMvu: true,\n              mvuPath: path,\n              mvuParsedInfo: parsedInfo,\n            });\n          }\n        });\n\n        //  ST  swipe regenerate\n        (function () {\n          //  documentiframe \n          const targetDoc = window.parent?.document || document;\n          const $doc = $(targetDoc);\n\n          // \n          $doc.off('touchstart.mvuSwipeFix touchmove.mvuSwipeFix touchend.mvuSwipeFix', '#acu-data-area');\n\n          let touchStartX = 0;\n          let touchStartY = 0;\n          let isHorizontalSwipe = false;\n\n          //  #acu-data-area  MVU \n          $doc.on('touchstart.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) return;\n\n            if (e.originalEvent.touches.length === 1) {\n              touchStartX = e.originalEvent.touches[0].clientX;\n              touchStartY = e.originalEvent.touches[0].clientY;\n              isHorizontalSwipe = false;\n            }\n          });\n\n          $doc.on('touchmove.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              return;\n            }\n\n            if (e.originalEvent.touches.length !== 1) return;\n\n            const touch = e.originalEvent.touches[0];\n            const deltaX = Math.abs(touch.clientX - touchStartX);\n            const deltaY = Math.abs(touch.clientY - touchStartY);\n\n            // X > Y * 1.5\n            // deltaYdeltaX\n            const isHorizontal =\n              deltaY < 5\n                ? deltaX > 5 && deltaX > deltaY * 2 // deltaYdeltaX > 5deltaY\n                : deltaX > deltaY * 1.5 && deltaX > 10; // \n\n            if (isHorizontal) {\n              isHorizontalSwipe = true;\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n            }\n          });\n\n          $doc.on('touchend.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              isHorizontalSwipe = false;\n              touchStartX = 0;\n              touchStartY = 0;\n              return;\n            }\n\n            // \n            if (isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              isHorizontalSwipe = false;\n            }\n            touchStartX = 0;\n            touchStartY = 0;\n          });\n\n          // \n          const captureHandlerTouchStart = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1) {\n              touchStartX = e.touches[0].clientX;\n              touchStartY = e.touches[0].clientY;\n            }\n          };\n          const captureHandlerTouchMove = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1 && touchStartX && touchStartY) {\n              const touch = e.touches[0];\n              const deltaX = Math.abs(touch.clientX - touchStartX);\n              const deltaY = Math.abs(touch.clientY - touchStartY);\n              // \n              const isHorizontal =\n                deltaY < 5 ? deltaX > 5 && deltaX > deltaY * 2 : deltaX > deltaY * 1.5 && deltaX > 10;\n              if (isHorizontal) {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                e.preventDefault();\n              }\n            }\n          };\n          const captureHandlerTouchEnd = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              e.preventDefault();\n            }\n          };\n          // \n          targetDoc.addEventListener('touchstart', captureHandlerTouchStart, true);\n          targetDoc.addEventListener('touchmove', captureHandlerTouchMove, true);\n          targetDoc.addEventListener('touchend', captureHandlerTouchEnd, true);\n        })();\n\n        // \n        $panel.on('click.mvu', '.acu-close-btn', function (e) {\n          e.stopPropagation();\n          const $input = $panel.find('.acu-search-input');\n\n          // \n          if ($input.length && $input.val()) {\n            $input.val('').trigger('input').focus();\n            return;\n          }\n\n          // \n          if (typeof saveActiveTabState === 'function') {\n            saveActiveTabState(null);\n          }\n          if (typeof renderInterface === 'function') {\n            renderInterface();\n          }\n        });\n\n        // \n        $panel.on('pointerdown.mvu', '.acu-height-drag-handle', function (e) {\n          if (e.button !== 0) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const handle = this;\n          handle.setPointerCapture(e.pointerId);\n          $(handle).addClass('active');\n          const startHeight = $panel.height();\n          const startY = e.clientY;\n          const tableName = $(handle).data('table');\n\n          //  MIN_PANEL_HEIGHT  MAX_PANEL_HEIGHT\n          const MIN_PANEL_HEIGHT = typeof window.MIN_PANEL_HEIGHT !== 'undefined' ? window.MIN_PANEL_HEIGHT : 200;\n          const MAX_PANEL_HEIGHT = typeof window.MAX_PANEL_HEIGHT !== 'undefined' ? window.MAX_PANEL_HEIGHT : 800;\n\n          handle.onpointermove = function (moveE) {\n            const dy = moveE.clientY - startY;\n            let newHeight = startHeight - dy; // \n            if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n            if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n            $panel.css('height', newHeight + 'px');\n          };\n          handle.onpointerup = function (upE) {\n            $(handle).removeClass('active');\n            handle.releasePointerCapture(upE.pointerId);\n            handle.onpointermove = null;\n            handle.onpointerup = null;\n            if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n              const heights = getTableHeights();\n              heights[tableName] = parseInt($panel.css('height'));\n              saveTableHeights(heights);\n              $panel.addClass('acu-manual-mode');\n            }\n          };\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-height-drag-handle', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = $(this).data('table');\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-panel-header', function (e) {\n          if ($(e.target).closest('.acu-search-input, .acu-close-btn, .mvu-header-btn').length) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = MvuModule.MODULE_ID;\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n      },\n\n      showEditDialog: function (path, currentValue, onSave) {\n        //  jQuery  document\n        const $ = window.parent?.jQuery || window.jQuery;\n        const targetDoc = window.parent?.document || document;\n        if (!$) return;\n\n        // \n        $(targetDoc).find('.mvu-edit-overlay').remove();\n\n        const currentTheme = (typeof getConfig === 'function' ? getConfig().theme : null) || 'retro';\n\n        const html = `\n                    <div class=\"mvu-edit-overlay acu-edit-overlay acu-theme-${currentTheme}\">\n                        <div class=\"mvu-edit-dialog acu-edit-dialog\">\n                            <div class=\"acu-edit-title\">\n                                <i class=\"fa-solid fa-edit acu-edit-icon-muted\"></i>\n                                <span></span>\n                            </div>\n                            <div class=\"mvu-edit-path\">${escapeHtml(path)}</div>\n                            <textarea class=\"mvu-edit-textarea acu-edit-textarea\">${escapeHtml(currentValue)}</textarea>\n                            <div class=\"mvu-edit-hint\">Ctrl+Enter  | Esc </div>\n                            <div class=\"acu-dialog-btns\">\n                                <button class=\"acu-dialog-btn mvu-btn-cancel\">\n                                    <i class=\"fa-solid fa-times\"></i> \n                                </button>\n                                <button class=\"acu-dialog-btn acu-btn-confirm mvu-btn-save\">\n                                    <i class=\"fa-solid fa-check\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `;\n\n        $(targetDoc.body).append(html);\n        const $overlay = $(targetDoc).find('.mvu-edit-overlay');\n        const $input = $overlay.find('.mvu-edit-textarea');\n\n        setTimeout(() => $input.focus().select(), 50);\n\n        // \n        $overlay.on('click', '.mvu-btn-cancel', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          $overlay.remove();\n          onSave(null);\n        });\n\n        // \n        $overlay.on('click', '.mvu-btn-save', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const newValue = $input.val();\n          $overlay.remove();\n          onSave(newValue);\n        });\n\n        // \n        setupOverlayClose($overlay, 'mvu-edit-overlay', () => {\n          $overlay.remove();\n          onSave(null);\n        });\n\n        // \n        $input.on('keydown', function (e) {\n          if (e.key === 'Escape') {\n            e.preventDefault();\n            $overlay.remove();\n            onSave(null);\n          } else if (e.key === 'Enter' && e.ctrlKey) {\n            e.preventDefault();\n            const newValue = $input.val();\n            $overlay.remove();\n            onSave(newValue);\n          }\n        });\n      },\n\n      // ===== LWB  =====\n      //  \".\"  \"[0].\" \n      parsePath: function (path: string): { rootName: string; subPath: string } {\n        const match = path.match(/^([^.\\[]+)/);\n        const rootName = match ? match[1] : path;\n\n        let subPath = path.slice(rootName.length);\n        if (subPath.startsWith('.')) subPath = subPath.slice(1);\n\n        return { rootName, subPath };\n      },\n\n      // LWB \n      setLwbValue: function (path: string, value: unknown) {\n        try {\n          const ST = window.SillyTavern || window.parent?.SillyTavern;\n          if (!ST?.chatMetadata) {\n            console.error('[DICE] chatMetadata');\n            return;\n          }\n\n          if (!ST.chatMetadata.variables) {\n            ST.chatMetadata.variables = {};\n          }\n\n          const { rootName, subPath } = this.parsePath(path);\n\n          if (!subPath) {\n            // \n            ST.chatMetadata.variables[rootName] =\n              typeof value === 'object' && value !== null ? JSON.stringify(value) : String(value ?? '');\n          } else {\n            // \n            const currentRaw = ST.chatMetadata.variables[rootName];\n            let current = parseJsonSafe(currentRaw);\n\n            if (typeof current !== 'object' || current === null) {\n              current = {};\n            }\n\n            // lodash _.set  \"a[0].b\" \n            _.set(current as object, subPath, value);\n\n            ST.chatMetadata.variables[rootName] = JSON.stringify(current);\n          }\n\n          // \n          ST.saveMetadata?.();\n\n          // \n          cachedEraData = null;\n          cachedEraDataChatId = null;\n\n          console.log('[DICE]LWB :', path, '=', value);\n        } catch (e) {\n          console.error('[DICE]LWB :', e);\n        }\n      },\n\n      setValue: async function (path, newValue) {\n        if (!isAvailable()) return false;\n\n        const mode = detectMode();\n\n        try {\n          let parsedValue = newValue;\n          if (newValue === 'true') parsedValue = true;\n          else if (newValue === 'false') parsedValue = false;\n          else if (!isNaN(Number(newValue)) && String(newValue).trim() !== '') {\n            parsedValue = Number(newValue);\n          }\n\n          if (mode === 'era') {\n            return await setEraValue(path, parsedValue);\n          } else if (mode === 'lwb') {\n            // [] LWB  chatMetadata.variables\n            this.setLwbValue(path, parsedValue);\n            return true;\n          } else {\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            if (!mvuData) {\n              console.error('[DICE]MvuModule  MVU ');\n              return false;\n            }\n\n            const success = await window.Mvu.setMvuVariable(mvuData, path, parsedValue, {\n              reason: '',\n              is_recursive: false,\n            });\n\n            if (success) {\n              await window.Mvu.replaceMvuData(mvuData, { type: 'message', message_id: 'latest' });\n            } else {\n              console.warn('[DICE]MvuModule setMvuVariable  false');\n            }\n\n            return success;\n          }\n        } catch (e) {\n          console.error('[DICE]MvuModule setValue error:', e);\n          return false;\n        }\n      },\n\n      isModuleTab: function (tableName) {\n        return tableName === MODULE_ID;\n      },\n\n      //  ERA  ERA \n      clearCache: function () {\n        cachedEraData = null;\n        cachedEraDataChatId = null;\n        console.log('[DICE]MvuModule  ERA ');\n      },\n\n      // \n      detectMode: function () {\n        return detectMode();\n      },\n\n      refresh: function ($container) {\n        // \n        this.clearCache();\n\n        if (!$container || !$container.length) {\n          const $panel = $('#acu-data-area');\n          if (!$panel.length) return;\n          $container = $panel;\n        }\n        // \n        const $refreshBtn = $container.find('.mvu-btn-refresh');\n        if ($refreshBtn.length) {\n          $refreshBtn.find('i').addClass('fa-spin');\n        }\n\n        // \n        //  10  1  10 \n        this.getDataWithRetry(10, 1000)\n          .then(mvuData => {\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            // [] \n            if (!canWriteMvuPanel()) return;\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            // []  toastr  renderPanel \n            //  getDataWithRetry \n            const toastr = window.parent?.toastr || window.toastr;\n            const actualData = this.getData();\n            if (toastr && !actualData) {\n              toastr.warning(' MVU ');\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error refreshing data:', err);\n\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            // [] \n            if (!canWriteMvuPanel()) return;\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            // [] \n            const toastr = window.parent?.toastr || window.toastr;\n            const actualData = this.getData();\n            if (toastr && !actualData) {\n              toastr.error('');\n            }\n          });\n      },\n    };\n  })();\n  // MVU \n  // COC\n  const DEFAULT_DICE_CONFIG = {\n    critSuccessMax: 5,\n    hardSuccessDiv: 5,\n    difficultSuccessDiv: 2,\n    critFailMin: 96,\n    ruleType: 'high_good',\n    lastDiceType: '1d100',\n    // DND \n    dndCritSuccess: 20,\n    dndCritFail: 1,\n    // : initiator_lose | tie | initiator_win\n    contestTieRule: 'initiator_lose',\n    // \n    hideDiceResultFromUser: false,\n    // \n    hideDiceResultInChat: false,\n    autoMergeProtagonist: true,\n  };\n\n  const getDiceConfig = () => Store.get(STORAGE_KEY_DICE_CONFIG, DEFAULT_DICE_CONFIG);\n  const saveDiceConfig = cfg => {\n    const oldCfg = getDiceConfig();\n    const newCfg = { ...oldCfg, ...cfg };\n    Store.set(STORAGE_KEY_DICE_CONFIG, newCfg);\n    // \n    const changedKeys = Object.keys(cfg).filter(k => oldCfg[k] !== newCfg[k]);\n    if (changedKeys.length > 0) {\n      console.info(`[DICE]: ${changedKeys.join(', ')}`);\n    }\n  };\n\n  // [] \n  const hideDiceResultsInUserMessages = () => {\n    try {\n      const diceCfg = getDiceConfig();\n      const hideInput = diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const hideChat = diceCfg.hideDiceResultInChat !== undefined ? diceCfg.hideDiceResultInChat : false;\n\n      // : \"XX\"\n      const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n      // : \"  vs    (...)  ......  (...)  .........\"\n      const contestDiceRegex =\n        /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n      // ==========  hideInput  ==========\n      try {\n        const $ta = $('#send_textarea');\n        if ($ta.length) {\n          let textareaVal = $ta.val() || '';\n          let modifiedText = textareaVal;\n\n          if (hideInput) {\n            // \n            const contestRegex =\n              /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n            const normalRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n            if (contestRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(contestRegex, '[]');\n            }\n            if (normalRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(normalRegex, '[]');\n            }\n          } else {\n            // \n            const originalText = $ta.data('acu-original-dice-text');\n            if (originalText && textareaVal.includes('[]')) {\n              // \n              modifiedText = textareaVal.replace(/\\[\\]/g, originalText);\n              $ta.removeData('acu-original-dice-text');\n            }\n          }\n\n          if (modifiedText !== textareaVal) {\n            $ta.val(modifiedText).trigger('input').trigger('change');\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]ACU :', e);\n      }\n\n      // ==========  hideChat  ==========\n      // \n      let lastMessageId;\n      try {\n        lastMessageId = getLastMessageId();\n      } catch (e) {\n        //  lastMessageId \n        return;\n      }\n\n      // \n      if (lastMessageId < 0) {\n        return;\n      }\n\n      try {\n        const userMessages = getChatMessages(`0-${lastMessageId}`, { role: 'user' });\n        // \n        if (!userMessages || userMessages.length === 0) {\n          return;\n        }\n\n        if (hideChat) {\n          // \n          let hiddenCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const $msgElement = retrieveDisplayedMessage(msg.message_id);\n              if (!$msgElement || !$msgElement.length) {\n                return;\n              }\n\n              // \n              let $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) {\n                // \n                $mesText = $msgElement.find('.message-text, .text, [class*=\"text\"], [class*=\"message\"]').first();\n                if (!$mesText || !$mesText.length) {\n                  // \n                  $mesText = $msgElement;\n                }\n              }\n\n              // DOM\n              const currentDomText = $mesText.text();\n              // \n              if (currentDomText.includes('[]')) {\n                return;\n              }\n\n              // AI\n              const originalText = msg.message || '';\n              if (!originalText) {\n                return;\n              }\n\n              // \n              let modifiedText = originalText;\n\n              // \n              //  lastIndex \n              const contestRegex =\n                /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n              const contestMatch = contestRegex.test(modifiedText);\n              if (contestMatch) {\n                modifiedText = modifiedText.replace(contestRegex, '[]');\n              }\n\n              // \n              const normalRegex =\n                /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n              const normalMatch = normalRegex.test(modifiedText);\n              if (normalMatch) {\n                modifiedText = modifiedText.replace(normalRegex, '[]');\n              }\n\n              // DOM\n              // HTMLHTML\n              if (modifiedText !== originalText && modifiedText !== currentDomText) {\n                // HTML\n                const currentHtml = $mesText.html();\n                // HTMLHTML\n                let modifiedHtml = currentHtml;\n\n                // \n                const contestPattern =\n                  /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n                if (contestPattern.test(currentHtml)) {\n                  modifiedHtml = modifiedHtml.replace(contestPattern, '[]');\n                }\n\n                // \n                const normalPattern =\n                  /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n                if (normalPattern.test(currentHtml)) {\n                  modifiedHtml = modifiedHtml.replace(normalPattern, '[]');\n                }\n\n                // HTML\n                if (modifiedHtml !== currentHtml) {\n                  $mesText.html(modifiedHtml);\n                  hiddenCount++;\n                }\n              }\n            } catch (e) {\n              console.warn(`[DICE]ACU  ${msg.message_id} :`, e);\n            }\n          });\n          if (hiddenCount > 0) {\n            console.info(`[DICE] ${hiddenCount} `);\n          }\n        } else {\n          // \n          let restoredCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const $msgElement = retrieveDisplayedMessage(msg.message_id);\n              if (!$msgElement || !$msgElement.length) return;\n\n              const $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) return;\n\n              // \n              const currentText = $mesText.text();\n              if (currentText.includes('[]')) {\n                // \n                const originalText = msg.message || '';\n                if (originalText) {\n                  $mesText.text(originalText);\n                  restoredCount++;\n                }\n              }\n            } catch (e) {\n              // \n            }\n          });\n          if (restoredCount > 0) {\n            console.info(`[DICE] ${restoredCount} `);\n          }\n        }\n      } catch (e) {\n        // \n        // \n        if (hideChat) {\n          console.warn('[DICE]ACU :', e);\n        }\n      }\n    } catch (e) {\n      // [] \n      // \n      const diceCfg = getDiceConfig();\n      if (diceCfg && (diceCfg.hideDiceResultFromUser || diceCfg.hideDiceResultInChat)) {\n        console.warn('[DICE]ACU :', e);\n      }\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const BUILTIN_ATTRIBUTE_PRESETS = [\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'coc7',\n      name: 'COC',\n      builtin: true,\n      description: '7816',\n      baseAttributes: [\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n      ],\n      specialAttributes: [\n        //  15-1109560\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        //  9-8547\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        //  8-6536\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        //  3-4122\n        { name: '', formula: '1+2d20', range: [3, 41] },\n        // \n        { name: '', formula: '/2', range: [1, 99] },\n        // COC \n        { name: 'SAN', formula: '', range: [1, 99] },\n        { name: '', formula: '1d5', range: [1, 5] },\n      ],\n    },\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'dnd5e',\n      name: 'DND',\n      builtin: true,\n      description: '568',\n      baseAttributes: [\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n      ],\n      specialAttributes: [\n        //  10-2015\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        //  7-1712\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        //  4-149\n        { name: '', formula: '2+2d6', range: [4, 14] },\n        { name: '', formula: '2+2d6', range: [4, 14] },\n      ],\n    },\n  ];\n\n  // \n  const AttributePresetManager = (() => {\n    let _cache = null;\n\n    return {\n      //  + \n      getAllPresets() {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        // \n        let needsSave = false;\n        stored.forEach(preset => {\n          const presetVersion = preset.version || '0.0.0';\n          if (compareVersion(presetVersion, PRESET_FORMAT_VERSION) < 0) {\n            console.log(\n              `[DICE]AttributePresetManager  \"${preset.name}\"  (${presetVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n            preset.version = PRESET_FORMAT_VERSION;\n            needsSave = true;\n          }\n        });\n        if (needsSave) {\n          Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n          // \n          _cache = null;\n        }\n        // \n        if (!needsSave && _cache) {\n          return _cache;\n        }\n        _cache = [...BUILTIN_ATTRIBUTE_PRESETS, ...stored];\n        return _cache;\n      },\n\n      // null = \n      getActivePreset() {\n        const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        if (!activeId) return null;\n        return this.getAllPresets().find(p => p.id === activeId) || null;\n      },\n\n      // \n      setActivePreset(id) {\n        try {\n          // idnull\n          const finalId = id === '' || id === undefined ? null : id;\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, finalId);\n          // \n          _cache = null;\n          console.log('[DICE]AttributePresetManager :', finalId);\n          //  AttributePresetManager \n          setTimeout(() => {\n            if (typeof updateTemplateForActivePreset === 'function') {\n              updateTemplateForActivePreset(finalId);\n            }\n          }, 0);\n          return true;\n        } catch (err) {\n          console.error('[DICE]AttributePresetManager :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const newPreset = {\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          builtin: false,\n          version: preset.version || PRESET_FORMAT_VERSION,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates };\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        }\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getAllPresets().find(p => p.id === id);\n        if (!preset) return null;\n        const exported = {\n          format: 'acu_attr_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n        };\n        delete exported.builtin; // \n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr, autoUpdate = false) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.format !== 'acu_attr_preset_v1') {\n            throw new Error('');\n          }\n\n          // \n          if (!data.name || !data.baseAttributes || !Array.isArray(data.baseAttributes)) {\n            throw new Error('');\n          }\n\n          const importedVersion = data.version || '0.0.0';\n          const needsUpdate = compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            builtin: false,\n            version: autoUpdate && needsUpdate ? PRESET_FORMAT_VERSION : importedVersion,\n            createdAt: new Date().toISOString(),\n          };\n\n          const result = this.createPreset(imported);\n          if (result && needsUpdate && !autoUpdate) {\n            console.warn(\n              `[DICE]AttributePresetManager  \"${result.name}\"  (${importedVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n          }\n          return result;\n        } catch (e) {\n          console.error('[DICE]AttributePresetManager :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  /**\n   * \n   * 6/////\n   * @param min \n   * @param max \n   * @returns \n   */\n  const generateAttributeScale = (min: number, max: number): string => {\n    const range = max - min;\n\n    // \n    const threshold1 = Math.floor(min + range * 0.1); // \n    const threshold2 = Math.floor(min + range * 0.4); // \n    const threshold3 = Math.floor(min + range * 0.6); // \n    const threshold4 = Math.floor(min + range * 0.8); // \n    const threshold5 = Math.floor(min + range * 0.9); // \n\n    //  \"3-3\" \n    const formatRange = (start: number, end: number): string => {\n      if (start === end) return `${start}`;\n      return `${start}-${end}`;\n    };\n\n    const scales = [\n      `${formatRange(min, threshold1)}:`,\n      `${formatRange(threshold1 + 1, threshold2)}:`,\n      `${formatRange(threshold2 + 1, threshold3)}:`,\n      `${formatRange(threshold3 + 1, threshold4)}:`,\n      `${formatRange(threshold4 + 1, threshold5)}:`,\n      `${formatRange(threshold5 + 1, max)}:`,\n    ];\n\n    const scaleStr = scales.join(' | ');\n\n    // \n    // \"40-60\"  \n    // \"90+\"  \n    // \"0-10\"  \n    // \"80\"  \n    const avgStart = threshold2 + 1;\n    const avgEnd = threshold3;\n    const rareThreshold = threshold5 + 1; // \n    const debuffRange = formatRange(min, threshold1); // \n    const buffRange = formatRange(threshold4 + 1, threshold5); // \n\n    const baseDescription = `: (+10)(${avgStart}-${avgEnd}${rareThreshold}+)[][]:${debuffRange}; ${buffRange}`;\n\n    return `${scaleStr}${baseDescription}`;\n  };\n\n  // \n  const DEFAULT_SPECIAL_ATTR_TEMPLATE = {\n    // \n    protagonist: {\n      range: [0, 100] as [number, number],\n      example1: ':45; :60; :40',\n      example2: ':80; :50; :35',\n    },\n    // \n    npc: {\n      range: [0, 100] as [number, number],\n      example: ':25; :45; :60',\n    },\n  };\n\n  // \n  const DEFAULT_VIRTUAL_PRESET = {\n    id: '__default__',\n    name: '',\n    baseAttributes: ['', '', '', '', '', ''].map(name => ({\n      name,\n      formula: '3d6*5',\n      range: [5, 95] as [number, number],\n      modifier: '1d10-5',\n    })),\n    specialAttributes: [] as { name: string; formula: string; range: [number, number]; modifier: string }[],\n  };\n\n  /**\n   * \n   * @param presetId IDnull \n   */\n  const updateTemplateForActivePreset = (presetId: string | null): void => {\n    // 1. \n    type AttributePreset = (typeof BUILTIN_ATTRIBUTE_PRESETS)[number];\n    let preset: AttributePreset;\n    if (presetId === null || presetId === '__default__') {\n      // \n      preset = DEFAULT_VIRTUAL_PRESET as AttributePreset;\n    } else {\n      const found = AttributePresetManager.getAllPresets().find((p: AttributePreset) => p.id === presetId);\n      preset = found || (DEFAULT_VIRTUAL_PRESET as AttributePreset);\n    }\n\n    // 2. \n    //  null  generateRPGAttributes \n    const attrs = generateRPGAttributes(presetId === null || presetId === '__default__' ? null : preset);\n    // attrs = { base: {...}, special: {...} }\n\n    // 3.  preset \n    let baseRangeMin = 0;\n    let baseRangeMax = 100;\n    let specialRangeMin = 0;\n    let specialRangeMax = 100;\n\n    //  baseAttributes.range  min/max\n    if (preset.baseAttributes && preset.baseAttributes.length > 0) {\n      const baseRanges = preset.baseAttributes.map(attr => attr.range);\n      baseRangeMin = Math.min(...baseRanges.map(r => r[0]));\n      baseRangeMax = Math.max(...baseRanges.map(r => r[1]));\n    }\n    //  specialAttributes.range  min/max\n    if (preset.specialAttributes && preset.specialAttributes.length > 0) {\n      const specialRanges = preset.specialAttributes.map(attr => attr.range);\n      specialRangeMin = Math.min(...specialRanges.map(r => r[0]));\n      specialRangeMax = Math.max(...specialRanges.map(r => r[1]));\n    }\n\n    // 4. \n    const baseEntries = Object.entries(attrs.base as Record<string, number>);\n    const specialEntries = Object.entries(attrs.special as Record<string, number>);\n\n    const baseExampleStr = baseEntries.map(([name, value]) => `${name}:${value}`).join('; ');\n    const specialExampleStr = specialEntries.map(([name, value]) => `${name}:${value}`).join('; ');\n\n    // 5.  API \n    const dbApi = getCore().getDB();\n    if (!dbApi || typeof dbApi.getTableTemplate !== 'function') {\n      console.warn('[DICE] updateTemplateForActivePreset:  API ');\n      return;\n    }\n\n    const template = dbApi.getTableTemplate();\n    if (!template) {\n      console.warn('[DICE] updateTemplateForActivePreset: ');\n      return;\n    }\n\n    // 6. \n\n    // \n    // : : \"{}:{}\"[0,100]\\n: \":35; ...\"\n    const protagonistBaseExampleRegex = /(:[^\\n]*)\\[[\\d,]+\\](\\n: )\"[^\"]+\"/;\n    const protagonistBaseRangeRegex = /(:[^\\n]*)\\[\\d+,\\d+\\]/;\n\n    // \n    // : : ...[0,100]\\n: \":45; ...\" | \":80; ...\"\n    const protagonistSpecialExampleRegex = /(:[^\\n]*)\\[[\\d,]+\\](\\n: )\"[^\"]+\"\\s*\\|\\s*\"[^\"]+\"/;\n    const protagonistSpecialSingleExampleRegex = /(:[^\\n]*)\\[[\\d,]+\\](\\n: )\"[^\"]+\"/;\n    const protagonistSpecialRangeRegex = /(:[^\\n]*)\\[\\d+,\\d+\\]/;\n\n    // \n    // : : \"{}:{}\"[0,100]\\n: \":41; ...\"\n    const npcBaseRangeRegex = /(:[^\\n]*)\\[\\d+,\\d+\\]/;\n    const npcBaseExampleRegex = /(:[^\\n]*)\\[[\\d,]+\\](\\n: )\"[^\"]+\"/;\n\n    // \n    // : : ...[0,100]\\n: \":25; ...\"\n    const npcSpecialExampleRegex = /(:[^\\n]*)\\[[\\d,]+\\](\\n: )\"[^\"]+\"/;\n    const npcSpecialRangeRegex = /(:[^\\n]*)\\[\\d+,\\d+\\]/;\n\n    //   \n    // : 0-10: | ... | 90-100:: ...\n    const attributeScaleRegex = /(\\n)\\d+-?\\d*:[^\\n]+/;\n\n    // \n    const newAttributeScale = generateAttributeScale(baseRangeMin, baseRangeMax) + '';\n\n    let modified = false;\n\n    // 7.  sheet_protagonist  note\n    const protagonistSheet = template.sheet_protagonist;\n    if (protagonistSheet?.sourceData?.note) {\n      let note = protagonistSheet.sourceData.note as string;\n      const originalNote = note;\n\n      // \n      note = note.replace(protagonistBaseRangeRegex, `$1[${baseRangeMin},${baseRangeMax}]`);\n\n      // \n      if (baseEntries.length > 0) {\n        note = note.replace(protagonistBaseExampleRegex, `$1[${baseRangeMin},${baseRangeMax}]$2\"${baseExampleStr}\"`);\n      }\n\n      // \n      if (specialEntries.length > 0) {\n        // \n        note = note.replace(protagonistSpecialRangeRegex, `$1[${specialRangeMin},${specialRangeMax}]`);\n\n        // \n        if (protagonistSpecialExampleRegex.test(note)) {\n          // \n          const attrs2 = generateRPGAttributes(presetId === null || presetId === '__default__' ? null : preset);\n          const special2Entries = Object.entries(attrs2.special as Record<string, number>);\n          const specialExample2Str = special2Entries.map(([name, value]) => `${name}:${value}`).join('; ');\n          note = note.replace(\n            protagonistSpecialExampleRegex,\n            `$1[${specialRangeMin},${specialRangeMax}]$2\"${specialExampleStr}\" | \"${specialExample2Str}\"`,\n          );\n        } else if (protagonistSpecialSingleExampleRegex.test(note)) {\n          // \n          note = note.replace(\n            protagonistSpecialSingleExampleRegex,\n            `$1[${specialRangeMin},${specialRangeMax}]$2\"${specialExampleStr}\"`,\n          );\n        }\n      } else {\n        // \n        const defaultRange = DEFAULT_SPECIAL_ATTR_TEMPLATE.protagonist.range;\n        const defaultEx1 = DEFAULT_SPECIAL_ATTR_TEMPLATE.protagonist.example1;\n        const defaultEx2 = DEFAULT_SPECIAL_ATTR_TEMPLATE.protagonist.example2;\n\n        // \n        note = note.replace(protagonistSpecialRangeRegex, `$1[${defaultRange[0]},${defaultRange[1]}]`);\n\n        // \n        if (protagonistSpecialExampleRegex.test(note)) {\n          note = note.replace(\n            protagonistSpecialExampleRegex,\n            `$1[${defaultRange[0]},${defaultRange[1]}]$2\"${defaultEx1}\" | \"${defaultEx2}\"`,\n          );\n        } else if (protagonistSpecialSingleExampleRegex.test(note)) {\n          // \n          note = note.replace(\n            protagonistSpecialSingleExampleRegex,\n            `$1[${defaultRange[0]},${defaultRange[1]}]$2\"${defaultEx1}\" | \"${defaultEx2}\"`,\n          );\n        }\n      }\n\n      // \n      note = note.replace(attributeScaleRegex, `$1${newAttributeScale}`);\n\n      if (note !== originalNote) {\n        protagonistSheet.sourceData.note = note;\n        modified = true;\n      }\n    }\n\n    // 8.  sheet_important_npc  note\n    const npcSheet = template.sheet_important_npc;\n    if (npcSheet?.sourceData?.note) {\n      let note = npcSheet.sourceData.note as string;\n      const originalNote = note;\n\n      // \n      note = note.replace(npcBaseRangeRegex, `$1[${baseRangeMin},${baseRangeMax}]`);\n\n      // \n      if (baseEntries.length > 0) {\n        note = note.replace(npcBaseExampleRegex, `$1[${baseRangeMin},${baseRangeMax}]$2\"${baseExampleStr}\"`);\n      }\n\n      // \n      if (specialEntries.length > 0) {\n        // \n        note = note.replace(npcSpecialRangeRegex, `$1[${specialRangeMin},${specialRangeMax}]`);\n\n        // \n        note = note.replace(\n          npcSpecialExampleRegex,\n          `$1[${specialRangeMin},${specialRangeMax}]$2\"${specialExampleStr}\"`,\n        );\n      } else {\n        // \n        const defaultRange = DEFAULT_SPECIAL_ATTR_TEMPLATE.npc.range;\n        const defaultEx = DEFAULT_SPECIAL_ATTR_TEMPLATE.npc.example;\n\n        // \n        note = note.replace(npcSpecialRangeRegex, `$1[${defaultRange[0]},${defaultRange[1]}]`);\n\n        // \n        note = note.replace(npcSpecialExampleRegex, `$1[${defaultRange[0]},${defaultRange[1]}]$2\"${defaultEx}\"`);\n      }\n\n      if (note !== originalNote) {\n        npcSheet.sourceData.note = note;\n        modified = true;\n      }\n    }\n\n    // 9.  API \n    if (modified && typeof dbApi.importTemplateFromData === 'function') {\n      dbApi\n        .importTemplateFromData(template)\n        .then((result: { success: boolean; message: string }) => {\n          if (result.success) {\n            console.log('[DICE] updateTemplateForActivePreset :', presetId);\n          } else {\n            console.error('[DICE] updateTemplateForActivePreset :', result.message);\n          }\n        })\n        .catch((err: Error) => {\n          console.error('[DICE] updateTemplateForActivePreset :', err);\n        });\n    } else if (!modified) {\n      console.log('[DICE] updateTemplateForActivePreset :', presetId);\n    } else {\n      console.warn('[DICE] updateTemplateForActivePreset: importTemplateFromData ');\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // ActionPresetManager  JS \n  // interface ActionGroupPreset {\n  //   format: 'acu_action_preset_v1';\n  //   version: string;\n  //   id: string;\n  //   name: string;\n  //   builtin: boolean;\n  //   description?: string;\n  //   rules: ActionRule[];\n  // }\n  // interface ActionRule {\n  //   table_keywords: string[];\n  //   actions: ActionItem[];\n  // }\n  // interface ActionItem {\n  //   label: string;\n  //   icon?: string;\n  //   template?: string;\n  // }\n\n  // \n  const BUILTIN_ACTION_PRESETS = [\n    {\n      format: 'acu_action_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: '__builtin_default__',\n      name: '',\n      builtin: true,\n      description: '',\n      rules: [\n        {\n          table_keywords: ['', '', 'Location', 'Map', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', 'NPC', '', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n        {\n          table_keywords: ['', '', ''],\n          actions: [\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n            { label: '', template: '<user>{Name}' },\n          ],\n        },\n      ],\n    },\n  ];\n\n  const ActionPresetManager = (() => {\n    let _cache = null;\n\n    return {\n      //  + \n      getAllPresets() {\n        if (_cache) return _cache;\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        _cache = [...BUILTIN_ACTION_PRESETS, ...stored];\n        return _cache;\n      },\n\n      // ID\n      getPresetById(id) {\n        return this.getAllPresets().find(p => p.id === id) || null;\n      },\n\n      // ID\n      getActivePresetId() {\n        const stored = Store.get(STORAGE_KEY_ACTIVE_ACTION_PRESET, '__builtin_default__');\n        return stored === null ? '__builtin_default__' : stored;\n      },\n\n      // \n      getActivePreset() {\n        const activeId = this.getActivePresetId();\n        if (!activeId || activeId === '__none__') return null;\n        return this.getPresetById(activeId);\n      },\n\n      // '__none__' \n      setActivePresetId(id) {\n        try {\n          const finalId = id === '' || id === undefined || id === null ? '__none__' : id;\n          Store.set(STORAGE_KEY_ACTIVE_ACTION_PRESET, finalId);\n          _cache = null;\n          console.log('[DICE]ActionPresetManager :', finalId);\n          return true;\n        } catch (err) {\n          console.error('[DICE]ActionPresetManager :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        const newPreset = {\n          format: 'acu_action_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          builtin: false,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ACTION_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]ActionPresetManager :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates, version: PRESET_FORMAT_VERSION };\n        Store.set(STORAGE_KEY_ACTION_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]ActionPresetManager :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        const stored = Store.get(STORAGE_KEY_ACTION_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ACTION_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ACTION_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ACTION_PRESET, null);\n        }\n        console.log('[DICE]ActionPresetManager :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getPresetById(id);\n        if (!preset) return null;\n        const exported = {\n          format: 'acu_action_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n        };\n        delete exported.builtin;\n        delete exported.createdAt;\n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.format !== 'acu_action_preset_v1') {\n            throw new Error(' acu_action_preset_v1');\n          }\n\n          // \n          if (!data.name || !data.rules || !Array.isArray(data.rules)) {\n            throw new Error(' name  rules ');\n          }\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            builtin: false,\n            version: PRESET_FORMAT_VERSION,\n            createdAt: new Date().toISOString(),\n          };\n\n          const result = this.createPreset(imported);\n          return result;\n        } catch (e) {\n          console.error('[DICE]ActionPresetManager :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const getCrazyModeConfig = () => {\n    const stored = Store.get(STORAGE_KEY_CRAZY_MODE, null);\n    if (!stored) return { ...DEFAULT_CRAZY_MODE_CONFIG };\n    return { ...DEFAULT_CRAZY_MODE_CONFIG, ...stored };\n  };\n\n  // \n  const saveCrazyModeConfig = config => {\n    Store.set(STORAGE_KEY_CRAZY_MODE, config);\n  };\n\n  // \n  const shouldTriggerCrazyMode = () => {\n    const config = getCrazyModeConfig();\n    if (!config.enabled) return false;\n    // crazyLevel \n    const roll = Math.random() * 100;\n    return roll < config.crazyLevel;\n  };\n\n  // \n  const selectCrazyRollType = crazyLevel => {\n    // crazyLevel < 50: 100% \n    // crazyLevel 50-75: 70%  / 30% \n    // crazyLevel > 75: 50%  / 50% \n    if (crazyLevel < 50) return 'normal';\n    const contestChance = crazyLevel <= 75 ? 0.3 : 0.5;\n    return Math.random() < contestChance ? 'contest' : 'normal';\n  };\n\n  // \n  const weightedRandomSelect = items => {\n    if (!items || items.length === 0) return null;\n    const totalWeight = items.reduce((sum, item) => sum + (item.weight || 1), 0);\n    let random = Math.random() * totalWeight;\n    for (const item of items) {\n      random -= item.weight || 1;\n      if (random <= 0) return item;\n    }\n    return items[items.length - 1];\n  };\n\n  // \n  const selectCrazyParticipant = () => {\n    const config = getCrazyModeConfig();\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return null;\n\n    const allTables = processJsonData(rawData || {});\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n\n    // \n    const candidates = [];\n\n    // \n    if (playerResult?.data?.rows?.length > 0) {\n      const playerName = getDisplayPlayerName() || '';\n      const playerAttrs = getFullAttributesForCharacter('<user>');\n      candidates.push({\n        name: playerName,\n        attrs: playerAttrs,\n        isPlayer: true,\n        inScene: true,\n        weight: config.playerWeight,\n      });\n    }\n\n    // NPC\n    if (npcResult) {\n      const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n      npcParsed.forEach(npc => {\n        if (!npc.name) return;\n        const inSceneVal = String(npc.inScene || '').toLowerCase();\n        const isInScene = inSceneVal === 'true' || inSceneVal === '';\n        const npcAttrs = getFullAttributesForCharacter(npc.name);\n        candidates.push({\n          name: npc.name,\n          attrs: npcAttrs,\n          isPlayer: false,\n          inScene: isInScene,\n          weight: isInScene ? config.inSceneNpcWeight : config.offSceneNpcWeight,\n        });\n      });\n    }\n\n    if (candidates.length === 0) return null;\n    return weightedRandomSelect(candidates);\n  };\n\n  // \n  const selectCrazyAttribute = participant => {\n    if (!participant) return { name: '', value: 50 };\n\n    // 1. \n    if (participant.attrs && participant.attrs.length > 0) {\n      const randomAttr = participant.attrs[Math.floor(Math.random() * participant.attrs.length)];\n      return { name: randomAttr.name, value: randomAttr.value };\n    }\n\n    // 2. \n    const activePreset = AttributePresetManager.getActivePreset();\n    if (activePreset) {\n      const allPresetAttrs = [...(activePreset.baseAttributes || []), ...(activePreset.specialAttributes || [])];\n      if (allPresetAttrs.length > 0) {\n        const randomPresetAttr = allPresetAttrs[Math.floor(Math.random() * allPresetAttrs.length)];\n        //  range  50% \n        const range = randomPresetAttr.range || [0, 100];\n        const defaultValue = Math.floor((range[0] + range[1]) / 2);\n        return { name: randomPresetAttr.name, value: defaultValue };\n      }\n    }\n\n    // 3. \n    const skillPool = getRandomSkillPool();\n    if (skillPool && skillPool.length > 0) {\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      return { name: randomSkill, value: 50 };\n    }\n\n    return { name: '', value: 50 };\n  };\n\n  //  d100\n  const crazyRollD100 = () => Math.floor(Math.random() * 100) + 1;\n\n  // \n  const judgeCrazyRollResult = (roll, target) => {\n    if (roll <= 5) return '';\n    if (roll >= 96) return '';\n    if (roll <= target) return '';\n    return '';\n  };\n\n  // \n  const generateCrazyRoll = () => {\n    const config = getCrazyModeConfig();\n    const rollType = selectCrazyRollType(config.crazyLevel);\n\n    if (rollType === 'normal') {\n      // \n      const participant = selectCrazyParticipant();\n      if (!participant) return null;\n\n      const attr = selectCrazyAttribute(participant);\n      const roll = crazyRollD100();\n      const result = judgeCrazyRollResult(roll, attr.value);\n\n      // XXYY\n      return `${participant.name}${attr.name}${roll}${attr.value}${result}`;\n    } else {\n      // \n      const participant1 = selectCrazyParticipant();\n      if (!participant1) return null;\n\n      // \n      let participant2 = null;\n      for (let i = 0; i < 5; i++) {\n        const candidate = selectCrazyParticipant();\n        if (candidate && candidate.name !== participant1.name) {\n          participant2 = candidate;\n          break;\n        }\n      }\n\n      // \n      if (!participant2) {\n        const attr = selectCrazyAttribute(participant1);\n        const roll = crazyRollD100();\n        const result = judgeCrazyRollResult(roll, attr.value);\n        return `${participant1.name}${attr.name}${roll}${attr.value}${result}`;\n      }\n\n      const attr1 = selectCrazyAttribute(participant1);\n      const attr2 = selectCrazyAttribute(participant2);\n      const roll1 = crazyRollD100();\n      const roll2 = crazyRollD100();\n\n      // \n      const result1 = judgeCrazyRollResult(roll1, attr1.value);\n      const result2 = judgeCrazyRollResult(roll2, attr2.value);\n      const margin1 = attr1.value - roll1;\n      const margin2 = attr2.value - roll2;\n\n      let winner;\n      if (margin1 > margin2) {\n        winner = `${participant1.name}`;\n      } else if (margin2 > margin1) {\n        winner = `${participant2.name}`;\n      } else {\n        winner = '';\n      }\n\n      // \n      return (\n        `${participant1.name} ${attr1.name} vs ${participant2.name} ${attr2.name}` +\n        `${participant1.name} ${attr1.name} (${attr1.value})  ${roll1}${result1}` +\n        `${participant2.name} ${attr2.name} (${attr2.value})  ${roll2}${result2}` +\n        `${winner}`\n      );\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  /**\n   * \n   * : 3d6, 4d6kh3, 4d6dl1, 4d6dh1\n   * @returns  NaN\n   */\n  const rollDiceExpression = expr => {\n    const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n\n    const match = expr.match(/^(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?$/i);\n    if (!match) return NaN;\n\n    const [, countStr, sidesStr, keepDrop] = match;\n    const count = parseInt(countStr, 10);\n    const sides = parseInt(sidesStr, 10);\n\n    let rolls = Array.from({ length: count }, () => rollDice(sides));\n\n    //  keep/drop\n    if (keepDrop) {\n      const kd = keepDrop.toLowerCase();\n      const n = parseInt(kd.slice(2), 10);\n      rolls.sort((a, b) => b - a); // \n\n      if (kd.startsWith('kh'))\n        rolls = rolls.slice(0, n); // n\n      else if (kd.startsWith('kl'))\n        rolls = rolls.slice(-n); // n\n      else if (kd.startsWith('dh'))\n        rolls = rolls.slice(n); // n\n      else if (kd.startsWith('dl')) rolls = rolls.slice(0, -n); // n\n    }\n\n    return rolls.reduce((a, b) => a + b, 0);\n  };\n\n  /**\n   * \n   * @param formula  \"/2+1d10\"  \"3d6*5\"\n   * @param context  { : 50, : 40 }\n   * @returns \n   */\n  const evaluateFormula = (formula, context = {}) => {\n    if (!formula) return 0;\n\n    let expr = String(formula).trim();\n\n    // 1. \n    const varNames = Object.keys(context).sort((a, b) => b.length - a.length);\n    for (const name of varNames) {\n      const value = context[name];\n      if (typeof value === 'number' && !isNaN(value)) {\n        // \n        expr = expr.split(name).join(`(${value})`);\n      }\n    }\n\n    // 2. \n    expr = expr.replace(/\\d+d\\d+(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi, match => {\n      const result = rollDiceExpression(match);\n      return isNaN(result) ? '0' : String(result);\n    });\n\n    // 3. \n    if (!/^[\\d\\s+\\-*/().]+$/.test(expr)) {\n      console.warn('[DICE]evaluateFormula :', formula, '', expr);\n      return 0;\n    }\n\n    // 4. \n    try {\n      // eslint-disable-next-line no-new-func\n      const result = new Function(`return (${expr})`)();\n      return Math.round(result); // \n    } catch (e) {\n      console.error('[DICE]evaluateFormula :', formula, '', expr, e);\n      return 0;\n    }\n  };\n\n  /**\n   * \n   * @param formula \n   * @param range  [min, max]\n   * @param context \n   * @returns \n   */\n  const generateAttributeValue = (formula, range, context) => {\n    let value = evaluateFormula(formula, context);\n\n    if (range && Array.isArray(range) && range.length === 2) {\n      value = Math.max(range[0], Math.min(range[1], value));\n    }\n\n    return value;\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const DASHBOARD_TABLE_CONFIG = {\n    global: {\n      tableKeywords: ['', '', ''],\n      columns: {\n        detailLocation: { keywords: ['', '', '', ''], fallbackIndex: null },\n        currentLocation: { keywords: ['', '', '', ''], fallbackIndex: 2 },\n      },\n    },\n    player: {\n      // : user, <user>\n      tableKeywords: ['', '', '', '', 'player', '', 'user', '<user>'],\n      columns: {\n        name: { keywords: ['', '', '', 'name'], fallbackIndex: 1 },\n        status: { keywords: ['', '', '', ''], fallbackIndex: null },\n        position: { keywords: ['', '', ''], fallbackIndex: null },\n        attrs: { keywords: ['', ''], fallbackIndex: null, isMultiple: true },\n        // : , , , \n        money: {\n          keywords: ['', '', '', '', '', '', '', '', ''],\n          fallbackIndex: null,\n        },\n        resources: { keywords: ['', '', 'resources'], fallbackIndex: null },\n      },\n    },\n    location: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: {\n          keywords: ['', '', '', '', '', '', '', ''],\n          fallbackIndex: 1,\n        },\n        description: { keywords: ['', '', '', '', ''], fallbackIndex: null },\n      },\n    },\n    npc: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        'NPC',\n        '',\n        '',\n        '',\n        '',\n        'character',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', ''], fallbackIndex: 1 },\n        status: { keywords: ['', ''], fallbackIndex: null },\n        position: { keywords: ['', '', '', ''], fallbackIndex: null },\n        inScene: { keywords: ['', '', '', ''], fallbackIndex: null },\n      },\n    },\n    quest: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        progress: { keywords: ['', '', '/'], fallbackIndex: 5 },\n        status: { keywords: [''], fallbackIndex: 6 },\n      },\n      filters: {\n        active: { column: 'status', includes: ['', '', ''], excludeColumn: 'type', excludes: [''] },\n      },\n    },\n    bag: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        count: { keywords: ['', '', ''], fallbackIndex: 3 },\n      },\n    },\n    skill: {\n      // : , , , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        level: { keywords: ['', '', '', 'lv'], fallbackIndex: 3 },\n      },\n    },\n    equip: {\n      // : , , , , , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        part: { keywords: ['', '', ''], fallbackIndex: 3 },\n        isEquipped: { keywords: ['', '', '', ''], fallbackIndex: 4 },\n      },\n      filters: {\n        equipped: { column: 'isEquipped', includes: ['', '', 'true', '', 'yes', 'equipped'] },\n      },\n    },\n  };\n\n  // \n  const DashboardDataParser = {\n    // \n    findTable(allTables, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return null;\n      }\n\n      for (const keyword of config.tableKeywords) {\n        for (const tableName in allTables) {\n          if (tableName.includes(keyword)) {\n            console.info(`[DICE]: \"${moduleKey}\"\"${tableName}\" (: \"${keyword}\")`);\n            return {\n              data: allTables[tableName],\n              name: tableName,\n              key: allTables[tableName].key,\n              config: config,\n            };\n          }\n        }\n      }\n      console.info(\n        `[DICE]: \"${moduleKey}\" (: ${config.tableKeywords.join(', ')})`,\n      );\n      return null;\n    },\n\n    // \n    findColumnIndex(headers, columnKey, moduleConfig) {\n      const colConfig = moduleConfig.columns[columnKey];\n      if (!colConfig) return -1;\n\n      // \n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (colConfig.keywords.some(kw => h.includes(kw.toLowerCase()))) {\n          return i;\n        }\n      }\n\n      // \n      return colConfig.fallbackIndex ?? -1;\n    },\n\n    // \n    getValue(row, headers, columnKey, moduleConfig) {\n      const idx = this.findColumnIndex(headers, columnKey, moduleConfig);\n      if (idx < 0 || idx >= row.length) return null;\n      return row[idx];\n    },\n\n    // \n    getColumnMap(headers, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) return {};\n\n      const map = {};\n      for (const colKey in config.columns) {\n        map[colKey] = this.findColumnIndex(headers, colKey, config);\n      }\n      return map;\n    },\n\n    // \n    parseRows(tableResult, moduleKey) {\n      if (!tableResult || !tableResult.data) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return [];\n      }\n\n      const { data, config } = tableResult;\n      const headers = data.headers || [];\n      const rows = data.rows || [];\n      const colMap = this.getColumnMap(headers, moduleKey);\n\n      const parsed = rows.map((row, idx) => {\n        const obj = { _rowIndex: idx, _raw: row };\n        for (const colKey in colMap) {\n          const colIdx = colMap[colKey];\n          obj[colKey] = colIdx >= 0 && colIdx < row.length ? row[colIdx] : null;\n        }\n        return obj;\n      });\n\n      console.info(`[DICE]: \"${moduleKey}\"${parsed.length}`);\n      return parsed;\n    },\n\n    // \n    applyFilter(parsedRows, filterKey, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config || !config.filters || !config.filters[filterKey]) return parsedRows;\n\n      const filter = config.filters[filterKey];\n\n      // parsedRows\n      const hasFilterColumn = parsedRows.some(row => row[filter.column] !== null && row[filter.column] !== undefined);\n      if (!hasFilterColumn) {\n        // \n        return parsedRows;\n      }\n\n      return parsedRows.filter(row => {\n        const value = String(row[filter.column] || '').toLowerCase();\n        const matchInclude = filter.includes.some(inc => value.includes(inc.toLowerCase()));\n\n        if (filter.excludeColumn && filter.excludes) {\n          const excludeValue = String(row[filter.excludeColumn] || '').toLowerCase();\n          const matchExclude = filter.excludes.some(exc => excludeValue.includes(exc.toLowerCase()));\n          return matchInclude && !matchExclude;\n        }\n\n        return matchInclude;\n      });\n    },\n  };\n\n  const DEFAULT_GM_CONFIG = {\n    enabled: true,\n    diceSystem: '1d100',\n    showDiceIcon: true,\n    autoSendPrompt: true,\n    action_groups: [\n      {\n        table_keywords: ['', '', 'Location', 'Map', '', ''],\n        actions: [\n          { label: '', icon: 'fa-walking', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-search', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-clock', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', 'NPC', '', '', ''],\n        actions: [\n          { label: '', icon: 'fa-comments', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-hand-fist', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          { label: '', icon: 'fa-hand-pointer', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-trash', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-shield-halved',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-coins', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-wand-magic-sparkles',\n            type: 'skill_check',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-dumbbell', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-crosshairs',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          {\n            label: '',\n            icon: 'fa-list-check',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-ear-listen',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-user-plus', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          {\n            label: '',\n            icon: 'fa-handshake',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n        ],\n      },\n    ],\n  };\n  const getGMConfig = () => {\n    const baseConfig = Store.get(STORAGE_KEY_GM_CONFIG, DEFAULT_GM_CONFIG);\n\n    // \n    const activePresetId = ActionPresetManager.getActivePresetId();\n    if (activePresetId === '__none__') {\n      return {\n        ...baseConfig,\n        action_rules_disabled: true, // \n      };\n    }\n\n    // \n    const activePreset = ActionPresetManager.getActivePreset();\n    if (activePreset && activePreset.rules && activePreset.rules.length > 0) {\n      //  custom_action_groups \n      const customActionGroups = activePreset.rules.map(rule => ({\n        table_keywords: rule.table_keywords || [],\n        actions: (rule.actions || []).map(action => ({\n          label: action.label,\n          icon: action.icon || ACTION_ICON_MAP[action.label] || 'fa-circle',\n          type: 'prompt',\n          template: action.template || `<user>{Name}:${action.label}`,\n          auto_send: false,\n        })),\n      }));\n\n      return {\n        ...baseConfig,\n        custom_action_groups: customActionGroups,\n      };\n    }\n\n    return baseConfig;\n  };\n\n  //  -  CSS \n  const getResultBadgeClass = resultType => {\n    // resultType: 'critSuccess' | 'extremeSuccess' | 'success' | 'warning' | 'failure' | 'critFailure'\n    const classMap = {\n      critSuccess: 'acu-result-badge acu-result-badge-crit-success',\n      extremeSuccess: 'acu-result-badge acu-result-badge-extreme-success',\n      success: 'acu-result-badge acu-result-badge-success',\n      warning: 'acu-result-badge acu-result-badge-warning',\n      failure: 'acu-result-badge acu-result-badge-failure',\n      critFailure: 'acu-result-badge acu-result-badge-crit-failure',\n    };\n    return classMap[resultType] || classMap.failure;\n  };\n\n  // [] \n  const ACTION_ICON_MAP: Record<string, string> = {\n    // \n    : 'fa-hand-fist',\n    : 'fa-hand-fist',\n    : 'fa-shield',\n    : 'fa-person-running',\n    // \n    : 'fa-comments',\n    : 'fa-comments',\n    : 'fa-hand',\n    : 'fa-heart',\n    : 'fa-calendar-check',\n    : 'fa-gift',\n    : 'fa-gift',\n    // \n    : 'fa-eye',\n    : 'fa-eye',\n    : 'fa-magnifying-glass',\n    // \n    : 'fa-hand-pointer',\n    : 'fa-trash',\n    : 'fa-shield-halved',\n    : 'fa-circle-xmark',\n    : 'fa-coins',\n    : 'fa-shopping-cart',\n    // \n    : 'fa-walking',\n    : 'fa-search',\n    : 'fa-clock',\n    : 'fa-door-open',\n    // \n    : 'fa-dumbbell',\n    : 'fa-wand-magic-sparkles',\n    : 'fa-fire',\n    // \n    : 'fa-crosshairs',\n    : 'fa-list-check',\n    : 'fa-circle-xmark',\n    : 'fa-check',\n    // \n    : 'fa-ear-listen',\n    : 'fa-user-plus',\n    : 'fa-handshake',\n    // \n    : 'fa-music',\n    : 'fa-guitar',\n    : 'fa-microphone',\n  };\n\n  /**\n   * \n   *\n   * []  > \n   *  config.custom_action_groups \n   * \"\"\"\"\"\"\n   *\n   * @param tableName \n   * @returns \n   */\n  const getActionsForTable = (tableName: string) => {\n    const config = getGMConfig();\n    if (!config.enabled) return [];\n\n    // \n    if ((config as any).action_rules_disabled) return [];\n\n    const lowerName = tableName.toLowerCase();\n\n    // [] \n    const customRules = (config as any).custom_action_groups || [];\n    for (const group of customRules) {\n      const matched = group.table_keywords.some((keyword: string) => lowerName.includes(keyword.toLowerCase()));\n      if (matched) return [...(group.actions || [])]; // \n    }\n\n    // \n    const builtinRules = config.action_groups || [];\n    for (const group of builtinRules) {\n      const matched = group.table_keywords.some((keyword: string) => lowerName.includes(keyword.toLowerCase()));\n      if (matched) return [...(group.actions || [])]; // \n    }\n\n    return [];\n  };\n\n  /**\n   * \n   *  + AI\n   *\n   * @param tableName \n   * @param headers \n   * @param rowData \n   * @returns \n   */\n  const getInteractOptionsForRow = (tableName: string, headers: any[], rowData: any[]) => {\n    // 1. \n    const defaultActions = [...getActionsForTable(tableName)];\n\n    // 2. \"\"\n    const interactColIdx = headers.findIndex(h => h && String(h).includes(''));\n    if (interactColIdx < 0 || !rowData[interactColIdx]) {\n      return defaultActions;\n    }\n\n    // 3. \n    const invalidValues = ['-', 'null', 'none', '', '', 'n/a', 'undefined', '/'];\n    const cellValue = String(rowData[interactColIdx]).trim();\n    if (!cellValue || invalidValues.includes(cellValue.toLowerCase())) {\n      return defaultActions;\n    }\n\n    // 4. \n    const interactOptions = cellValue\n      .split(/[,;]/)\n      .map(s => s.trim())\n      .filter(s => s && !invalidValues.includes(s.toLowerCase()));\n\n    if (interactOptions.length === 0) {\n      return defaultActions;\n    }\n\n    // 5. \n    const existingLabels = defaultActions.map(a => a.label.toLowerCase());\n\n    // 6. \n    const newActions = interactOptions\n      .filter(opt => !existingLabels.includes(opt.toLowerCase()))\n      .map(opt => ({\n        label: opt,\n        icon: ACTION_ICON_MAP[opt] || 'fa-hand-pointer',\n        type: 'prompt',\n        template: `<user>{Name}:${opt}`,\n        auto_send: true,\n      }));\n\n    // 7.  + \n    return [...defaultActions, ...newActions];\n  };\n\n  const isNumericCell = value => {\n    if (value === null || value === undefined || value === '') return false;\n    const str = String(value).trim();\n    // : (50/100)/: \n    return (\n      /^-?\\d+(\\.\\d+)?%?$/.test(str) ||\n      /^\\d+\\/\\d+$/.test(str) ||\n      /^[\\u4e00-\\u9fa5a-zA-Z]+[:\\s]\\s*\\d+/i.test(str) ||\n      /\\d+/.test(str)\n    );\n  };\n\n  const extractNumericValue = value => {\n    if (!value) return 0;\n    const str = String(value).trim();\n    //  (50/100 -> )\n    if (/^\\d+\\/\\d+$/.test(str)) return parseInt(str.split('/')[0], 10);\n    // \n    if (str.endsWith('%')) return parseInt(str.replace('%', ''), 10);\n    //  \":\" \n    const matches = str.match(/\\d+/g);\n    if (matches && matches.length > 0) {\n      return parseInt(matches[matches.length - 1], 10);\n    }\n    return 0;\n  };\n\n  const parseAttributeString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    //  JSON  {\"\":, ...}\n    if (rawStr.startsWith('{') && rawStr.endsWith('}')) {\n      try {\n        const jsonObj = JSON.parse(rawStr);\n        for (const key in jsonObj) {\n          const val = jsonObj[key];\n          if (typeof val === 'number') {\n            results.push({ name: key, value: val });\n          } else if (typeof val === 'string' && /^\\d+$/.test(val)) {\n            results.push({ name: key, value: parseInt(val, 10) });\n          }\n        }\n        if (results.length > 0) return results;\n      } catch (e) {\n        // JSON \n      }\n    }\n\n    //  \":; :\" \n    const parts = rawStr.split(/[,;\\s]+/);\n    for (const part of parts) {\n      const match = part.match(/^\"?([\\u4e00-\\u9fa5a-zA-Z_]+)\"?[:\\s]\\s*\"?(-?\\d+)\"?/);\n      if (match) {\n        results.push({ name: match[1], value: parseInt(match[2], 10) });\n      }\n    }\n    return results;\n  };\n  // [] :\n  // 1: \"();()\"\n  // 2: \":;:\"\n  // 3: \":,;:\"\n  const parseRelationshipString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    // \n    const parts = rawStr.split(/[;]/);\n    for (const part of parts) {\n      const trimmed = part.trim();\n      if (!trimmed) continue;\n\n      // 2/3: \":\"  \"\"\n      const colonMatch = trimmed.match(/^?(.+?)[:\\](.+)$/);\n      if (colonMatch) {\n        const name = colonMatch[1].trim();\n        const relation = colonMatch[2].trim();\n        if (name && relation) {\n          results.push({ name: name, relation: relation });\n          continue;\n        }\n      }\n\n      // 1: \"()\"  \"\"\n      const parenMatch = trimmed.match(/^([^(]+)[(]([^)]+)[)]$/);\n      if (parenMatch) {\n        results.push({ name: parenMatch[1].trim(), relation: parenMatch[2].trim() });\n        continue;\n      }\n\n      // \n      if (trimmed.length > 0) {\n        results.push({ name: trimmed, relation: '' });\n      }\n    }\n    return results;\n  };\n\n  // [] \n  const isRelationshipCell = (value, headerName) => {\n    if (!value) return false;\n    const str = String(value).trim();\n    const lowerHeader = (headerName || '').toLowerCase();\n    // \"\"\n    if (lowerHeader.includes('') || lowerHeader.includes('')) {\n      return true;\n    }\n    //  \"();()\" \n    return /^[^(;]+[(][^)]+[)]([;][^(;]+[(][^)]+[)])*$/.test(str);\n  };\n\n  const processTemplate = (template, cardData, headers) => {\n    if (!template || !cardData) return template;\n    let result = template;\n    const name = cardData[1] || '';\n    result = result.replace(/\\{Name\\}/gi, name);\n    result = result.replace(/\\{RowIndex\\}/gi, cardData[0] || '0');\n    if (headers && headers.length > 0) {\n      headers.forEach((header, idx) => {\n        if (header && idx < cardData.length) {\n          const value = cardData[idx] || '';\n          const regex = new RegExp(`\\\\{${header}\\\\}`, 'gi');\n          result = result.replace(regex, value);\n        }\n      });\n    }\n    result = result.replace(/\\{[^}]+\\}/g, '');\n    return result;\n  };\n\n  // \n  // /\n  const ACTION_BUTTONS = [\n    // { id: 'acu-btn-save-global', icon: 'fa-save', title: '' }, // \n    { id: 'acu-btn-open-editor', icon: 'fa-database', title: '-' },\n    { id: 'acu-btn-open-visualizer', icon: 'fa-table-columns', title: '' },\n    { id: 'acu-btn-collapse', icon: 'fa-chevron-down', title: '' },\n    { id: 'acu-btn-refill', icon: 'fa-bolt', title: '' },\n    { id: 'acu-btn-settings', icon: 'fa-cog', title: '' },\n  ];\n\n  let isInitialized = false;\n  let isSaving = false;\n  let saveQueue: Promise<void> = Promise.resolve(); // \n  let isEditingOrder = false;\n  let isSettingsOpen = false;\n  let currentDiffMap = new Set();\n  let observer = null;\n  let _boundRenderHandler = null;\n\n  // ---  ---\n  let cachedRawData = null;\n  let hasUnsavedChanges = false;\n  // [] \n  let pendingDeletions: Record<string, number[]> = {};\n  const getPendingDeletions = () => pendingDeletions;\n  const clearPendingDeletions = () => {\n    pendingDeletions = {};\n  };\n  let isAutoTransforming = false; // \n  let tablePageStates = {};\n  let tableSearchStates = {};\n  let lastOptionHash = null;\n  let optionPanelVisible = false; // [] \n  // [] \n  const STORAGE_KEY_SCROLL = 'acu_scroll_v19_fixed';\n  let tableScrollStates = {};\n  try {\n    const saved = localStorage.getItem(STORAGE_KEY_SCROLL);\n    if (saved) tableScrollStates = JSON.parse(saved);\n  } catch (e) {\n    console.warn('[DICE]ACU Error:', e);\n  }\n  // [] \n  const UpdateController = {\n    _lastValidationCount: 0,\n    _isRollingBack: false, // \n\n    handleUpdate: () => {\n      // \n      if (UpdateController._isRollingBack) return;\n\n      // ===  intercept  ===\n      try {\n        const snapshot = loadSnapshot();\n        const newData = getTableData();\n        if (snapshot && newData) {\n          const rules = ValidationRuleManager.getEnabledRules();\n          const violations = ValidationEngine.checkTableRules(snapshot, newData, rules);\n\n          if (violations.length > 0) {\n            console.warn('[DICE]ACU :', violations);\n            UpdateController._isRollingBack = true;\n\n            //  API \n            const api = getCore().getDB();\n            if (api?.fillTable) {\n              try {\n                api.fillTable(snapshot);\n                if (window.toastr) {\n                  window.toastr.error(violations[0].message, '', {\n                    timeOut: 5000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              } catch (fillError) {\n                console.error('[DICE]ACU fillTable :', fillError);\n                // \n                if (window.toastr) {\n                  window.toastr.error(`: ${violations[0].message}`, '', {\n                    timeOut: 7000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              }\n            }\n\n            setTimeout(() => {\n              UpdateController._isRollingBack = false;\n            }, 500);\n            return;\n          }\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n      }\n\n      //  renderInterface \n      // \n      renderInterface();\n\n      // \n      setTimeout(() => {\n        try {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            const errors = ValidationEngine.validateAllData(rawData);\n            const newCount = errors.length;\n\n            // \n            if (newCount > UpdateController._lastValidationCount && newCount > 0) {\n              // \n            }\n\n            UpdateController._lastValidationCount = newCount;\n\n            // \n            updateValidationIndicator(newCount);\n          }\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n        }\n      }, 100);\n    },\n  };\n\n  // \n  const updateValidationIndicator = count => {\n    const { $ } = getCore();\n    const $indicator = $('.acu-validation-indicator');\n\n    if (count > 0) {\n      if ($indicator.length) {\n        $indicator.find('.acu-validation-count').text(count);\n        $indicator.show();\n      }\n    } else {\n      $indicator.hide();\n    }\n  };\n\n  // --- []  ---\n  const getCurrentContextFingerprint = () => {\n    try {\n      // 1:  API\n      if (typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId) {\n        return SillyTavern.getCurrentChatId();\n      }\n      // 2: \n      if (typeof SillyTavern !== 'undefined' && SillyTavern.chatId) {\n        return SillyTavern.chatId;\n      }\n      // 3:  (iframe )\n      if (window.parent?.SillyTavern?.getCurrentChatId) {\n        return window.parent.SillyTavern.getCurrentChatId();\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getCurrentContextFingerprint error:', e);\n    }\n    return 'unknown_context';\n  };\n\n  //  ()\n\n  const DEFAULT_CONFIG = {\n    layout: 'horizontal',\n    collapseStyle: 'bar',\n    collapseAlign: 'right',\n    fontFamily: 'default',\n    theme: 'retro',\n    cardWidth: 260,\n    fontSize: 13,\n    highlightNew: true,\n    itemsPerPage: 50,\n    actionsPosition: 'bottom',\n    gridColumns: 'auto', // [] \n    positionMode: 'fixed', // fixed=, embedded=\n    showOptionPanel: true, // [] \n    clickOptionToAutoSend: true, // [] \n    optionFontSize: 12, // [] \n    muteDatabaseToasts: false,\n  };\n\n  const FONTS = [\n    { id: 'default', name: ' (Modern)', val: `'Segoe UI', 'Microsoft YaHei', sans-serif` },\n    { id: 'hanchan', name: '', val: `\"\", sans-serif` },\n    { id: 'maple', name: 'Maple Mono ()', val: `\"Maple Mono NF CN\", monospace` },\n    { id: 'huiwen', name: ' (Huiwen)', val: `\"Huiwen-mincho\", serif` },\n    { id: 'cooper', name: 'Cooper', val: `\"CooperZhengKai\", serif` },\n    { id: 'yffyt', name: 'YFFYT ()', val: `\"YFFYT\", sans-serif` },\n    { id: 'fusion', name: 'Fusion Pixel ()', val: `\"Fusion Pixel 12px M latin\", monospace` },\n    { id: 'wenkai', name: ' (WenKai)', val: `\"LXGW WenKai\", serif` },\n    { id: 'notosans', name: ' (Noto Sans)', val: `\"Noto Sans CJK\", sans-serif` },\n    { id: 'zhuque', name: ' (Zhuque)', val: `\"Zhuque Fangsong (technical preview)\", serif` },\n  ];\n\n  const THEMES = [\n    { id: 'retro', name: ' (Retro)', icon: 'fa-scroll' },\n    { id: 'dark', name: ' (Dark)', icon: 'fa-moon' },\n    { id: 'modern', name: ' (Modern)', icon: 'fa-sun' },\n    { id: 'forest', name: ' (Forest)', icon: 'fa-tree' },\n    { id: 'ocean', name: ' (Ocean)', icon: 'fa-water' },\n    { id: 'cyber', name: ' (Cyber)', icon: 'fa-bolt' },\n    { id: 'nightowl', name: ' (Night Owl)', icon: 'fa-feather' },\n    { id: 'sakura', name: ' (Warm Pink)', icon: 'fa-heart' },\n    { id: 'minepink', name: ' (Mine Pink)', icon: 'fa-skull' },\n    { id: 'galgame', name: ' (Galgame Pink)', icon: 'fa-heart' },\n    { id: 'purple', name: ' (Purple)', icon: 'fa-gem' },\n    { id: 'wechat', name: ' (Green Bubble)', icon: 'fa-weixin' },\n    { id: 'educational', name: ' (Educational)', icon: 'fa-book' },\n    { id: 'vaporwave', name: ' (Vaporwave)', icon: 'fa-palette' },\n    { id: 'classicpackaging', name: ' (Classic Packaging)', icon: 'fa-box' },\n    { id: 'terminal', name: ' (Terminal)', icon: 'fa-terminal' },\n    { id: 'dreamcore', name: ' (Dreamcore)', icon: 'fa-cloud-moon' },\n    { id: 'aurora', name: ' (Aurora)', icon: 'fa-snowflake' },\n    { id: 'chouten', name: ' (Cyber Kawaii)', icon: 'fa-star' },\n  ];\n\n  // []  core  ( +  ST )\n  let _coreCache = null;\n  const getCore = () => {\n    const w = window.parent || window;\n    //  jQuery\n    const $ = window.jQuery || w.jQuery;\n\n    // ($)\n    if (_coreCache && _coreCache.$) return _coreCache;\n\n    const core = {\n      $: $,\n      getDB: () => w.AutoCardUpdaterAPI || window.AutoCardUpdaterAPI,\n      clipboard: w.navigator.clipboard,\n      //   ->  ->  ()\n      ST:\n        window.SillyTavern ||\n        w.SillyTavern ||\n        (() => {\n          try {\n            return window.top ? window.top.SillyTavern : null;\n          } catch (e) {\n            return null;\n          }\n        })(),\n    };\n\n    //  jQuery \n    if ($) _coreCache = core;\n    return core;\n  };\n\n  const updateSaveButtonState = () => {\n    const { $ } = getCore();\n    const $btn = $('#acu-btn-save-global');\n    const $icon = $btn.find('i');\n    const deletions = getPendingDeletions();\n    let hasDeletions = false;\n    if (deletions) {\n      for (const key in deletions) {\n        if (deletions[key] && deletions[key].length > 0) {\n          hasDeletions = true;\n          break;\n        }\n      }\n    }\n    if (hasUnsavedChanges || hasDeletions) {\n      $icon.addClass('acu-icon-breathe');\n      $btn.attr('title', '');\n    } else {\n      $icon.removeClass('acu-icon-breathe');\n      $btn.attr('title', '');\n      $btn.css('color', '');\n    }\n  };\n\n  const getIconForTableName = name => {\n    if (!name) return 'fa-table';\n    const n = name.toLowerCase();\n    if (n.includes('') || n.includes('')) return 'fa-user-circle';\n    if (n.includes('') || n.includes('')) return 'fa-globe-asia';\n    if (n.includes('') || n.includes('')) return 'fa-briefcase';\n    if (n.includes('') || n.includes('')) return 'fa-dragon';\n    if (n.includes('') || n.includes('')) return 'fa-user-friends';\n    if (n.includes('') || n.includes('')) return 'fa-scroll';\n    if (n.includes('') || n.includes('')) return 'fa-address-book';\n    if (n.includes('') || n.includes('')) return 'fa-book-reader';\n    if (n.includes('') || n.includes('')) return 'fa-map-location-dot';\n    if (n.includes('') || n.includes('') || n.includes('')) return 'fa-bullseye';\n    if (n.includes('') || n.includes('')) return 'fa-shield-halved';\n    if (n.includes('')) return 'fa-gem';\n    if (n.includes('') || n.includes('')) return 'fa-file-lines';\n    if (n.includes('')) return 'fa-list-check';\n    return 'fa-table';\n  };\n\n  const getBadgeStyle = text => {\n    if (!text) return '';\n    const str = String(text).trim();\n    if (/^[0-9]+%?$/.test(str) || /^Lv\\.\\d+$/.test(str)) return 'acu-badge-green';\n    if (str.length <= 6 && !str.includes('http')) return 'acu-badge-neutral';\n    if (['', '', '', '', '', ''].includes(str)) return 'acu-badge-neutral';\n    return '';\n  };\n\n  // []  ()\n  const Store = {\n    get: (key, def = null) => {\n      try {\n        return JSON.parse(localStorage.getItem(key)) ?? def;\n      } catch {\n        return def;\n      }\n    },\n    set: (key, val) => {\n      try {\n        localStorage.setItem(key, JSON.stringify(val));\n      } catch (e) {\n        // \n        if (e.name === 'QuotaExceededError' || e.message.includes('quota')) {\n          console.warn('[DICE]ACU ...');\n          try {\n            // 1.  ()\n            localStorage.removeItem(STORAGE_KEY_LAST_SNAPSHOT);\n\n            // 2. \n            localStorage.setItem(key, JSON.stringify(val));\n          } catch (retryErr) {\n            // \n            console.error('[DICE]ACU Store ', retryErr);\n            if (window.toastr && !window._acuQuotaAlerted) {\n              window.toastr.warning(' ');\n              window._acuQuotaAlerted = true;\n              setTimeout(() => (window._acuQuotaAlerted = false), 10000);\n            }\n          }\n        } else {\n          console.error('[DICE]ACU Store', e);\n        }\n      }\n    },\n  };\n\n  const getActiveTabState = () => Store.get(STORAGE_KEY_ACTIVE_TAB);\n  const saveActiveTabState = v => Store.set(STORAGE_KEY_ACTIVE_TAB, v);\n\n  // [] \n  const clearAllPanelStates = () => {\n    Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n    Store.set('acu_changes_panel_active', false);\n    Store.set('acu_favorites_panel_active', false);\n    saveActiveTabState(null);\n  };\n\n  // [] MVU  MVU \n  function canWriteMvuPanel() {\n    if (getActiveTabState() !== MvuModule.MODULE_ID) return false;\n    if (Store.get('acu_changes_panel_active', false)) return false;\n    if (Store.get('acu_favorites_panel_active', false)) return false;\n    if (Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false)) return false;\n    return true;\n  }\n\n  const getSavedTableOrder = () => Store.get(STORAGE_KEY_TABLE_ORDER);\n  const saveTableOrder = v => Store.set(STORAGE_KEY_TABLE_ORDER, v);\n  const getCollapsedState = () => Store.get(STORAGE_KEY_IS_COLLAPSED, false);\n  const saveCollapsedState = v => Store.set(STORAGE_KEY_IS_COLLAPSED, v);\n  // [] \n  const getOptionsCollapsedState = () => Store.get(STORAGE_KEY_OPTIONS_COLLAPSED, false);\n  const saveOptionsCollapsedState = v => Store.set(STORAGE_KEY_OPTIONS_COLLAPSED, v);\n  // []  (Chat ID)\n  const loadSnapshot = () => {\n    const data = Store.get(STORAGE_KEY_LAST_SNAPSHOT);\n    if (!data) return null;\n    // \n    const currentCtx = getCurrentContextFingerprint();\n    // \n    if (data._contextId && data._contextId !== currentCtx) {\n      return null;\n    }\n    return data;\n  };\n\n  // [] \n  const saveSnapshot = v => {\n    if (!v) return;\n    //  ChatID\n    if (typeof v === 'object') {\n      v._contextId = getCurrentContextFingerprint();\n    }\n    Store.set(STORAGE_KEY_LAST_SNAPSHOT, v);\n  };\n\n  // --- []  ---\n  const getTableHeights = () => Store.get(STORAGE_KEY_TABLE_HEIGHTS, {});\n  const saveTableHeights = v => Store.set(STORAGE_KEY_TABLE_HEIGHTS, v);\n  const getTableStyles = () => Store.get(STORAGE_KEY_TABLE_STYLES, {});\n  const saveTableStyles = v => Store.set(STORAGE_KEY_TABLE_STYLES, v);\n  const getHiddenTables = () => Store.get(STORAGE_KEY_HIDDEN_TABLES, []);\n  const saveHiddenTables = v => Store.set(STORAGE_KEY_HIDDEN_TABLES, v);\n  const getReverseTables = () => Store.get(STORAGE_KEY_REVERSE_TABLES, []);\n  const saveReverseTables = v => Store.set(STORAGE_KEY_REVERSE_TABLES, v);\n\n  // \n  const shouldShowReverseButton = tableName => {\n    if (!tableName) return false;\n    const keywords = ['', '', '', '', ''];\n    return keywords.some(kw => tableName.includes(kw));\n  };\n\n  // \n  const isTableReversed = tableName => {\n    return getReverseTables().includes(tableName);\n  };\n\n  // \n  const toggleTableReverse = tableName => {\n    const list = getReverseTables();\n    const idx = list.indexOf(tableName);\n    if (idx >= 0) {\n      list.splice(idx, 1);\n    } else {\n      list.push(tableName);\n    }\n    saveReverseTables(list);\n    console.log('[DICE]ACU toggleTableReverse:', tableName, 'reversed:', idx < 0);\n  };\n  // [] \n  const getAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          let attrs = [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.includes(attr.name)) attrs.push(attr.name);\n              });\n            }\n          });\n          if (attrs.length > 0) return attrs;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            let attrs = [];\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.includes(attr.name)) attrs.push(attr.name);\n                });\n              }\n            });\n            return attrs;\n          }\n        }\n      }\n    }\n\n    return [];\n  };\n  // [] \n  const getAttributeValue = (characterName, attrName) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData || !attrName) return null;\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          for (let idx = 0; idx < headers.length; idx++) {\n            const h = headers[idx];\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              const found = parsed.find(attr => attr.name === attrName);\n              if (found) return found.value;\n            }\n          }\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            for (let idx = 0; idx < headers.length; idx++) {\n              const h = headers[idx];\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                const found = parsed.find(attr => attr.name === attrName);\n                if (found) return found.value;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n  // [] 6\n  const STANDARD_ATTRS = ['', '', '', '', '', ''];\n\n  /**\n   * \n   */\n  const getStandardAttrs = () => {\n    const preset = AttributePresetManager.getActivePreset();\n    if (preset && preset.baseAttributes) {\n      return preset.baseAttributes.map(attr => attr.name);\n    }\n    return STANDARD_ATTRS;\n  };\n\n  /**\n   * \n   * \n   *  + \n   */\n  const getRandomSkillPool = () => {\n    try {\n      const preset = AttributePresetManager.getActivePreset();\n      if (preset) {\n        //  + \n        const allAttrs = new Set();\n\n        // \n        if (preset.baseAttributes && Array.isArray(preset.baseAttributes)) {\n          preset.baseAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        // \n        if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n          preset.specialAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        return Array.from(allAttrs);\n      }\n\n      // \n      const allPresets = AttributePresetManager.getAllPresets() || [];\n      const allAttrs = new Set(RANDOM_SKILL_POOL || []); // \n\n      // \n      if (Array.isArray(allPresets)) {\n        allPresets.forEach(p => {\n          if (!p) return;\n\n          // \n          if (p.baseAttributes && Array.isArray(p.baseAttributes)) {\n            p.baseAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n\n          // \n          if (p.specialAttributes && Array.isArray(p.specialAttributes)) {\n            p.specialAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n        });\n      }\n\n      return Array.from(allAttrs);\n    } catch (err) {\n      console.error('[DICE]ACU getRandomSkillPool :', err);\n      return RANDOM_SKILL_POOL || [];\n    }\n  };\n\n  // [] \n  const RANDOM_SKILL_POOL = [\n    // ---  (Physical & Movement) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Social & Psychological) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    // /\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Technical & Crafting) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Knowledge & Investigation) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Combat & Special) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  // []  COC/DND 6\n  /**\n   * \n   * @param isDNDOrPreset ()    null()\n   * @returns { base: {...}, special: {...} }  {...}\n   */\n  const generateRPGAttributes = (isDNDOrPreset = undefined) => {\n    // \n    if (typeof isDNDOrPreset === 'boolean') {\n      const isDND = isDNDOrPreset;\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n\n      const generateValue = () => {\n        if (isDND) {\n          const base = generate3d6();\n          const adjust = rollDice(4) - 2;\n          return Math.max(3, Math.min(18, base + adjust));\n        } else {\n          const base = generate3d6() * 5;\n          const adjust = rollDice(10) - 5;\n          return Math.max(5, Math.min(95, base + adjust));\n        }\n      };\n\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        result[attr] = generateValue();\n      });\n      return result; // \n    }\n\n    // \n    const preset = isDNDOrPreset || AttributePresetManager.getActivePreset();\n\n    // \n    if (!preset) {\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        const base = generate3d6() * 5;\n        const adjust = rollDice(10) - 5;\n        result[attr] = Math.max(5, Math.min(95, base + adjust));\n      });\n      return { base: result, special: {} };\n    }\n\n    // \n    const baseResult = {};\n    preset.baseAttributes.forEach(attr => {\n      const formula = attr.modifier ? `${attr.formula}+${attr.modifier}` : attr.formula;\n      baseResult[attr.name] = generateAttributeValue(formula, attr.range, {});\n    });\n\n    // \n    const specialResult = {};\n    if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n      preset.specialAttributes.forEach(attr => {\n        specialResult[attr.name] = generateAttributeValue(attr.formula, attr.range, baseResult);\n      });\n    }\n\n    return { base: baseResult, special: specialResult };\n  };\n\n  // [] \n  const clearPresetAttributesForCharacter = async charName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // NPC//\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    const customAttrs = existingAttrs.filter(attr => !presetAttrNames.has(attr.name));\n    const newAttrString = customAttrs.map(attr => `${attr.name}:${attr.value}`).join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData, [sheetKey]);\n\n    return {\n      success: true,\n      attrString: newAttrString,\n    };\n  };\n\n  // [] \n  const writeAttributesToCharacter = async (charName, newAttrs, isDND = false) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \"\"\n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // \n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('\"\"');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const existingMap = {};\n    existingAttrs.forEach(attr => {\n      existingMap[attr.name] = attr.value;\n    });\n\n    // +\n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    let standardCount = 0;\n    standardAttrs.forEach(attrName => {\n      if (existingMap[attrName] !== undefined) {\n        standardCount++;\n      }\n    });\n    const isComplete = standardCount === standardAttrs.length;\n\n    // \n    const customAttrs = [];\n    existingAttrs.forEach(attr => {\n      if (!presetAttrNames.has(attr.name)) {\n        customAttrs.push({ name: attr.name, value: attr.value });\n      }\n    });\n\n    // \n    const resultParts = [];\n\n    // 1. \n    standardAttrs.forEach(attrName => {\n      if (isComplete) {\n        //   \n        const newValue = newAttrs[attrName] !== undefined ? newAttrs[attrName] : existingMap[attrName];\n        if (newValue !== undefined) {\n          resultParts.push(`${attrName}:${newValue}`);\n        }\n      } else {\n        //   \n        if (existingMap[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        } else if (newAttrs[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        }\n      }\n    });\n\n    // 2. \n    Object.keys(newAttrs).forEach(attrName => {\n      if (!standardAttrs.includes(attrName)) {\n        // \n        if (isComplete || !existingMap[attrName]) {\n          // \n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        } else {\n          // \n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        }\n      }\n    });\n\n    // 3. \n    customAttrs.forEach(attr => {\n      resultParts.push(`${attr.name}:${attr.value}`);\n    });\n\n    const newAttrString = resultParts.join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData, [sheetKey]);\n\n    // UI\n    const writtenAttrs = [];\n    standardAttrs.forEach(attrName => {\n      writtenAttrs.push({ name: attrName, value: newAttrs[attrName] });\n    });\n\n    return {\n      success: true,\n      attrs: writtenAttrs,\n      attrString: newAttrString,\n      wasComplete: isComplete,\n    };\n  };\n  // [] \"\"\n  const getFullAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n    let attrs = [];\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.some(a => a.name === attr.name)) {\n                  attrs.push(attr);\n                }\n              });\n            }\n          });\n          if (attrs.length > 0) break;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.some(a => a.name === attr.name)) {\n                    attrs.push(attr);\n                  }\n                });\n              }\n            });\n            break;\n          }\n        }\n        if (attrs.length > 0) break;\n      }\n    }\n\n    return attrs;\n  };\n  // [] \n  const initCustomDropdown = ($input, options) => {\n    const { $ } = getCore();\n    const inputId = $input.attr('id') || 'dd_' + Math.random().toString(36).substr(2, 9);\n    $input.attr('id', inputId);\n\n    // \n    $input.parent().find('.acu-dropdown-list').remove();\n\n    //  wrapper\n    if (!$input.parent().hasClass('acu-dropdown-wrapper')) {\n      $input.wrap('<div class=\"acu-dropdown-wrapper\"></div>');\n    }\n\n    //  -  CSS \n    const $dropdown = $(`<div class=\"acu-dropdown-list\" data-for=\"${inputId}\"></div>`);\n    $input.after($dropdown);\n\n    const renderItems = (filter = '') => {\n      const lowerFilter = filter.toLowerCase();\n      const filtered = options.filter(opt => opt.toLowerCase().includes(lowerFilter));\n\n      if (filtered.length === 0) {\n        $dropdown.html(`<div class=\"acu-dropdown-empty\"></div>`);\n      } else {\n        $dropdown.html(\n          filtered\n            .map(opt => `<div class=\"acu-dropdown-item\" data-value=\"${escapeHtml(opt)}\">${escapeHtml(opt)}</div>`)\n            .join(''),\n        );\n      }\n    };\n\n    const showDropdown = () => {\n      $('.acu-dropdown-list').removeClass('visible');\n      renderItems($input.val());\n      $dropdown.addClass('visible');\n    };\n\n    const hideDropdown = () => {\n      $dropdown.removeClass('visible');\n    };\n\n    // \n    $input.off('.acudd').on('focus.acudd click.acudd', function (e) {\n      e.stopPropagation();\n      showDropdown();\n    });\n\n    // \n    $input.on('input.acudd', function () {\n      renderItems($(this).val());\n    });\n\n    // hover  CSS :hover  JS\n\n    // \n    $dropdown.on('click', '.acu-dropdown-item', function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      const val = $(this).data('value');\n      $input.val(val).trigger('change');\n      hideDropdown();\n    });\n\n    // \n    $dropdown.on('click', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $input\n      .closest('.acu-dice-panel, .acu-contest-panel')\n      .off('click.acudd_' + inputId)\n      .on('click.acudd_' + inputId, function (e) {\n        if (!$(e.target).closest('.acu-dropdown-wrapper').length) {\n          hideDropdown();\n        }\n      });\n  };\n  // [] \n  const addClearButton = ($panel, inputSelector) => {\n    const { $ } = getCore();\n    $panel.find(inputSelector).each(function () {\n      const $input = $(this);\n      // \n      if ($input.parent().hasClass('acu-input-wrapper')) return;\n      // \n      $input.wrap('<div class=\"acu-input-wrapper\"></div>');\n      //  -  CSS \n      const $clearBtn = $(\n        `<button type=\"button\" class=\"acu-clear-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>`,\n      );\n      $input.after($clearBtn);\n      // \n      $clearBtn.on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        $input.val('').trigger('input').trigger('change').focus();\n      });\n      // hover  CSS :hover  JS\n    });\n  };\n  // [] \n  const showDiceSettingsPanel = (isDND = false) => {\n    const { $ } = getCore();\n    $('.acu-dice-config-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    const ruleTitle = isDND ? 'DND ' : 'COC ';\n    const resetText = isDND ? ' DND ' : ' COC ';\n\n    // \n    const defaults = isDND\n      ? { critSuccess: 20, critFail: 1 }\n      : { critSuccess: 5, critFail: 96, hardDiv: 2, extremeDiv: 5 };\n\n    //  placeholder\n    const currentCritSuccess = isDND\n      ? diceCfg.dndCritSuccess !== undefined && diceCfg.dndCritSuccess !== defaults.critSuccess\n        ? diceCfg.dndCritSuccess\n        : ''\n      : diceCfg.critSuccessMax !== undefined && diceCfg.critSuccessMax !== defaults.critSuccess\n        ? diceCfg.critSuccessMax\n        : '';\n    const currentCritFail = isDND\n      ? diceCfg.dndCritFail !== undefined && diceCfg.dndCritFail !== defaults.critFail\n        ? diceCfg.dndCritFail\n        : ''\n      : diceCfg.critFailMin !== undefined && diceCfg.critFailMin !== defaults.critFail\n        ? diceCfg.critFailMin\n        : '';\n    const currentHardDiv =\n      !isDND && diceCfg.difficultSuccessDiv !== undefined && diceCfg.difficultSuccessDiv !== defaults.hardDiv\n        ? diceCfg.difficultSuccessDiv\n        : '';\n    const currentExtremeDiv =\n      !isDND && diceCfg.hardSuccessDiv !== undefined && diceCfg.hardSuccessDiv !== defaults.extremeDiv\n        ? diceCfg.hardSuccessDiv\n        : '';\n\n    const tieRule = diceCfg.contestTieRule || 'initiator_lose';\n    const hideDiceResultFromUser =\n      diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n    const hideDiceResultInChat = diceCfg.hideDiceResultInChat !== undefined ? diceCfg.hideDiceResultInChat : false;\n\n    const cocExtraHtml = isDND\n      ? ''\n      : `\n            <div class=\"acu-dice-cfg-row\">\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-hard-div\" data-min=\"2\" data-max=\"5\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentHardDiv || defaults.hardDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-extreme-div\" data-min=\"3\" data-max=\"10\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentExtremeDiv || defaults.extremeDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const panelHtml = `\n            <div class=\"acu-dice-config-overlay\">\n                <div class=\"acu-dice-config-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-dice-cfg-header\">\n                        <span><i class=\"fa-solid fa-cog\"></i> ${ruleTitle}</span>\n                        <button class=\"acu-config-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-dice-cfg-body\">\n                        <div class=\"acu-dice-cfg-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-success\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritSuccess || defaults.critSuccess}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-fail\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritFail || defaults.critFail}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                        ${cocExtraHtml}\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <select id=\"cfg-tie-rule\">\n                                    <option value=\"initiator_lose\" ${tieRule === 'initiator_lose' ? 'selected' : ''}> ()</option>\n                                    <option value=\"tie\" ${tieRule === 'tie' ? 'selected' : ''}></option>\n                                    <option value=\"initiator_win\" ${tieRule === 'initiator_win' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label></label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result\" ${hideDiceResultFromUser ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label></label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result-chat\" ${hideDiceResultInChat ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-actions\">\n                            <button id=\"cfg-reset-dice\">${resetText}</button>\n                            <button id=\"cfg-save-dice\"></button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $panel = $(panelHtml);\n    $('body').append($panel);\n\n    $panel.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '31300',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    const closePanel = () => $panel.remove();\n    $panel.find('.acu-config-close').click(closePanel);\n    setupOverlayClose($panel, 'acu-dice-config-overlay', closePanel);\n\n    // === Stepper  ===\n    $panel.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        $value.text(newVal);\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    $panel.find('#cfg-save-dice').click(function () {\n      const newCfg = { contestTieRule: $('#cfg-tie-rule').val() };\n\n      // stepper\n      const getStepperValue = id => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          const text = $stepper.find('.acu-stepper-value').text().replace(/[^\\d]/g, '');\n          return text !== '' ? parseInt(text, 10) : null;\n        }\n        return null;\n      };\n\n      const critSuccessVal = getStepperValue('cfg-crit-success');\n      const critFailVal = getStepperValue('cfg-crit-fail');\n\n      if (isDND) {\n        newCfg.dndCritSuccess = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.dndCritFail = critFailVal !== null ? critFailVal : defaults.critFail;\n      } else {\n        newCfg.critSuccessMax = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.critFailMin = critFailVal !== null ? critFailVal : defaults.critFail;\n\n        const hardDivVal = getStepperValue('cfg-hard-div');\n        const extremeDivVal = getStepperValue('cfg-extreme-div');\n        newCfg.difficultSuccessDiv = hardDivVal !== null ? hardDivVal : defaults.hardDiv;\n        newCfg.hardSuccessDiv = extremeDivVal !== null ? extremeDivVal : defaults.extremeDiv;\n      }\n\n      // \"\"\n      newCfg.hideDiceResultFromUser = $('#cfg-hide-dice-result').is(':checked');\n      // \"\"\n      newCfg.hideDiceResultInChat = $('#cfg-hide-dice-result-chat').is(':checked');\n\n      saveDiceConfig(newCfg);\n      // \n      console.info('[DICE]/...');\n      hideDiceResultsInUserMessages();\n      closePanel();\n    });\n\n    $panel.find('#cfg-reset-dice').click(function () {\n      // stepper\n      const resetStepper = (id, defaultValue) => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          $stepper.find('.acu-stepper-value').text(defaultValue);\n        }\n      };\n\n      resetStepper('cfg-crit-success', defaults.critSuccess);\n      resetStepper('cfg-crit-fail', defaults.critFail);\n      if (!isDND) {\n        resetStepper('cfg-hard-div', defaults.hardDiv);\n        resetStepper('cfg-extreme-div', defaults.extremeDiv);\n      }\n    });\n  };\n  // [] \n  const showDicePanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n    // 1d100\n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    // 1d100\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n    // [] \n    const rawDataForList = cachedRawData || getTableData();\n    let diceCharacterList = ['<user>'];\n    let diceAttrList = [];\n\n    if (rawDataForList) {\n      for (const key in rawDataForList) {\n        const sheet = rawDataForList[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '') {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) diceCharacterList.push(row[1]);\n          }\n        }\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const row = sheet.content[1];\n          const headers = sheet.content[0] || [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!diceAttrList.includes(attr.name)) diceAttrList.push(attr.name);\n              });\n            }\n          });\n        }\n      }\n    }\n    const {\n      targetValue = null, // []  null\n      targetName = '',\n      attrValue = null, // [] \n      diceType = savedDiceType, // \n      successCriteria = 'lte', // [] COC\n      onResult = null,\n      initiatorName = '', // [] \n      fromMvu = false, // [] MVU\n      mvuPath = null, // [] MVU\n      mvuParsedInfo = null, // [] \n    } = options;\n\n    // [] /DC\n    const isDND = diceType === '1d20' || successCriteria === 'gte';\n    let initialAttrValue = attrValue;\n    let initialTargetValue = targetValue;\n\n    // attrValuetargetValue\n    if (attrValue !== null && targetValue === null) {\n      if (isDND) {\n        initialTargetValue = Math.max(0, 20 - attrValue);\n      } else {\n        initialTargetValue = attrValue;\n      }\n    }\n\n    const overlay = $(`<div class=\"acu-dice-overlay\"></div>`);\n\n    // []  COC  DND\n    const successCriteriaOptions = [\n      { id: 'lte', name: ' (COC)' },\n      { id: 'gte', name: ' (DND)' },\n    ];\n\n    // [] \n    let defaultCriteria = successCriteria;\n    if (diceType === '1d100') defaultCriteria = 'lte';\n    else if (diceType === '1d20') defaultCriteria = 'gte';\n\n    const panel = $(`\n            <div class=\"acu-dice-panel acu-theme-${config.theme}\">\n                <div class=\"acu-dice-panel-header\">\n                    <div class=\"acu-dice-panel-title\">\n                        <i class=\"fa-solid fa-dice-d20\"></i> \n                    </div>\n                    <div class=\"acu-dice-panel-actions\">\n                        <button id=\"dice-switch-contest-top\" title=\"\"><i class=\"fa-solid fa-people-arrows\"></i></button>\n                        <button class=\"acu-dice-config-btn\" title=\"\">\n                            <i class=\"fa-solid fa-cog\"></i>\n                        </button>\n                        <button class=\"acu-dice-close\">\n                            <i class=\"fa-solid fa-times\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div class=\"acu-dice-panel-body\">\n                    <div class=\"acu-dice-presets\">\n                        <button class=\"acu-dice-preset ${diceType === '1d20' ? 'active' : ''}\" data-dice=\"1d20\" data-criteria=\"gte\">1d20</button>\n                        <button class=\"acu-dice-preset ${diceType === '1d100' ? 'active' : ''}\" data-dice=\"1d100\" data-criteria=\"lte\">1d100</button>\n                        <button class=\"acu-dice-preset acu-dice-custom-btn ${!['1d20', '1d100'].includes(diceType) ? 'active' : ''}\" data-dice=\"custom\"></button>\n                        <input type=\"text\" id=\"dice-custom-input\" class=\"acu-dice-input\" placeholder=\"2d6\" value=\"${!['1d20', '1d100'].includes(diceType) ? diceType : ''}\">\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-dice-quick-section\">\n                        <div class=\"acu-dice-section-title\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"dice-char-buttons\" class=\"acu-dice-quick-inline\"></div></div>\n                    </div>\n\n                    <!-- 1 +  -->\n                    <div class=\"acu-dice-form-row cols-2\">\n                        <div>\n                            <div class=\"acu-dice-form-label\"></div>\n                            <input type=\"text\" id=\"dice-initiator-name\" class=\"acu-dice-input\" value=\"${escapeHtml(initiatorName)}\" placeholder=\"<user>\">\n                        </div>\n                        <div>\n                            <div class=\"acu-dice-form-label\">\n                                \n                                <button type=\"button\" class=\"acu-random-skill-btn\" id=\"dice-random-skill\" title=\"\">\n                                    <i class=\"fa-solid fa-dice\"></i>\n                                </button>\n                            </div>\n                            <input type=\"text\" id=\"dice-attr-name\" class=\"acu-dice-input\" value=\"${escapeHtml(targetName || '')}\" placeholder=\"\">\n                        </div>\n                    </div>\n\n                    <!-- 2 +  -->\n                    <div class=\"acu-dice-form-row cols-2\">\n                        <div>\n                            <div class=\"acu-dice-form-label\"></div>\n                            <input type=\"text\" id=\"dice-attr-value\" class=\"acu-dice-input\" value=\"${initialAttrValue !== null ? initialAttrValue : ''}\" placeholder=\"=50%\">\n                        </div>\n                        <div>\n                            <div class=\"acu-dice-form-label\" id=\"dice-target-label\"></div>\n                            <input type=\"text\" id=\"dice-target\" class=\"acu-dice-input\" value=\"${initialTargetValue !== null ? initialTargetValue : ''}\" placeholder=\"=\">\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div id=\"dice-attr-buttons\" class=\"acu-dice-quick-compact\"></div>\n\n                    <!-- 3 +  +  -->\n                    <div class=\"acu-dice-form-row cols-3\" id=\"dice-row-3\">\n                        <div>\n                            <div class=\"acu-dice-form-label centered\"></div>\n                            <select id=\"dice-success-criteria\" class=\"acu-dice-select\">\n                                ${successCriteriaOptions\n                                  .map(\n                                    opt =>\n                                      `<option value=\"${opt.id}\" ${opt.id === defaultCriteria ? 'selected' : ''}>${opt.name}</option>`,\n                                  )\n                                  .join('')}\n                            </select>\n                        </div>\n                        <div id=\"dice-difficulty-wrapper\">\n                            <div class=\"acu-dice-form-label centered\"></div>\n                            <select id=\"dice-difficulty\" class=\"acu-dice-select\">\n                                <option value=\"normal\" selected></option>\n                                <option value=\"hard\"></option>\n                                <option value=\"extreme\"></option>\n                                <option value=\"critical\"></option>\n                            </select>\n                        </div>\n                        <div>\n                            <div class=\"acu-dice-form-label\"></div>\n                            <input type=\"text\" id=\"dice-modifier\" class=\"acu-dice-input\" value=\"0\">\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <input type=\"hidden\" id=\"dice-formula\" value=\"${diceType}\">\n\n                    <button id=\"dice-roll-btn\" class=\"acu-dice-roll-btn\">\n                        <i class=\"fa-solid fa-dice\"></i> \n                    </button>\n                </div>\n            </div>\n        `);\n\n    overlay.append(panel);\n    $('body').append(overlay);\n\n    // [] \n    const buildCharButtons = () => {\n      const $container = panel.find('#dice-char-buttons');\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.initiator) {\n        const initiator = mvuParsedInfo.initiator;\n        const shortName = initiator.length > 4 ? initiator.substring(0, 4) + '..' : initiator;\n        html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu\" data-char=\"${escapeHtml(initiator)}\" title=\": ${escapeHtml(initiator)}\">${escapeHtml(shortName)}</button>`;\n      }\n\n      // \n      diceCharacterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html += `<button class=\"acu-dice-char-btn\" data-char=\"${escapeHtml(name)}\" title=\"${escapeHtml(displayName)}\">${escapeHtml(shortName)}</button>`;\n      });\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.candidates && mvuParsedInfo.candidates.length > 0) {\n        mvuParsedInfo.candidates.forEach(candidate => {\n          // \n          if (mvuParsedInfo.initiator && candidate === mvuParsedInfo.initiator) return;\n          const shortName = candidate.length > 4 ? candidate.substring(0, 4) + '..' : candidate;\n          html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu-candidate\" data-char=\"${escapeHtml(candidate)}\" title=\": ${escapeHtml(candidate)}\">${escapeHtml(shortName)}</button>`;\n        });\n      }\n\n      $container.html(html || `<div class=\"acu-dice-empty-hint\"></div>`);\n      // \n      $container.find('.acu-dice-char-btn').click(function () {\n        const charName = $(this).data('char');\n        panel.find('#dice-initiator-name').val(charName).trigger('change');\n      });\n    };\n\n    // [] \n    const buildAttrButtons = charName => {\n      const $container = panel.find('#dice-attr-buttons');\n      const $parentSection = $container.parent(); // \n      const attrs = getFullAttributesForCharacter(charName);\n\n      // \n      $parentSection.show();\n\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.attrName) {\n        const attrName = mvuParsedInfo.attrName;\n        // \n        const attrValue = getAttributeValue(charName, attrName) || targetValue || '';\n        if (attrValue) {\n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"${attrValue}\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}:${attrValue}</button>`;\n        } else {\n          // \n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}</button>`;\n        }\n      }\n\n      // \n      attrs.forEach(attr => {\n        html += `<button class=\"acu-dice-attr-btn\" data-name=\"${escapeHtml(attr.name)}\" data-value=\"${attr.value}\">${escapeHtml(attr.name)}:${attr.value}</button>`;\n      });\n\n      // \n      html += `<button class=\"acu-dice-gen-attr-btn\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>`;\n\n      // \n      html += `<button class=\"acu-dice-clear-attr-btn\" title=\"\"><i class=\"fa-solid fa-trash-alt\"></i></button>`;\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-dice-attr-btn').click(function () {\n        const attrName = $(this).data('name');\n        const attrValue = $(this).data('value');\n        panel.find('#dice-attr-name').val(attrName);\n        panel.find('#dice-attr-value').val(attrValue);\n\n        // \n        const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n        const isDND = criteria === 'gte';\n        const numValue = parseInt(attrValue, 10) || 0;\n\n        if (isDND) {\n          // DNDDC = 20 - \n          panel.find('#dice-target').val(20 - numValue);\n        } else {\n          // COC = \n          panel.find('#dice-target').val(attrValue);\n        }\n\n        // changeUI\n        panel.find('#dice-attr-value').trigger('change');\n      });\n\n      // \n      $container.find('.acu-dice-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n          console.log('[DICE]ACU  for:', charName);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-dice-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharButtons();\n    // <user>\n    buildAttrButtons('<user>');\n    // [] \n    panel.find('#dice-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#dice-attr-name').val(randomSkill).trigger('change');\n    });\n\n    // \n    initCustomDropdown(panel.find('#dice-initiator-name'), diceCharacterList);\n    initCustomDropdown(panel.find('#dice-attr-name'), diceAttrList);\n    // [] \n    addClearButton(panel, '#dice-initiator-name, #dice-attr-name, #dice-attr-value, #dice-target');\n\n    // [] \n    panel.find('#dice-initiator-name').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#dice-attr-name'), newAttrList.length > 0 ? newAttrList : diceAttrList);\n\n      // [] \n      buildAttrButtons(charName);\n    });\n\n    // [] \n    panel.find('#dice-attr-name').on('change.acuval', function () {\n      const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#dice-attr-value').val(attrValue);\n        // /DC\n        const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n        const isDND = criteria === 'gte';\n        panel.find('#dice-target').val(isDND ? 20 - attrValue : attrValue);\n      }\n    });\n\n    // [] \n    const convertTargetForDice = (currentTarget, fromDice, toDice) => {\n      if (!currentTarget || currentTarget === '') return '';\n      const val = parseInt(currentTarget, 10);\n      if (isNaN(val)) return currentTarget;\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n\n      const fromMax = getMaxRoll(fromDice);\n      const toMax = getMaxRoll(toDice);\n\n      // \n      const ratio = val / fromMax;\n      const newVal = Math.round(ratio * toMax);\n      return Math.max(0, Math.min(newVal, toMax));\n    };\n\n    // []  UICOC/DND \n    const updateRuleMode = () => {\n      const criteria = panel.find('#dice-success-criteria').val();\n      const isDND = criteria === 'gte';\n      const $targetInput = panel.find('#dice-target');\n      const $difficultyWrapper = panel.find('#dice-difficulty-wrapper');\n      const $row3 = panel.find('#dice-row-3');\n\n      if (isDND) {\n        // DND \n        $targetInput.attr('placeholder', '=20-');\n        panel.find('#dice-target-label').text('DC');\n        $difficultyWrapper.hide();\n        $row3.css('grid-template-columns', '1fr 1fr');\n      } else {\n        // COC \n        $targetInput.attr('placeholder', '=');\n        panel.find('#dice-target-label').text('');\n        $difficultyWrapper.show();\n        $row3.css('grid-template-columns', '1fr 1fr 1fr');\n      }\n    };\n\n    panel.find('#dice-success-criteria').on('change', updateRuleMode);\n\n    // \n    updateRuleMode();\n\n    // \n    let currentDiceType = diceType;\n\n    //  - [] \n    panel.find('.acu-dice-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-dice-preset').removeClass('active');\n      $(this).addClass('active');\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n      const suggestedCriteria = $(this).data('criteria') || 'lte';\n\n      // [] \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, newDice);\n        $targetInput.val(convertedVal);\n      }\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n      const newMax = getMaxRoll(newDice);\n      panel.find('#dice-target-auto').text(`(: 1~${newMax})`);\n\n      currentDiceType = newDice;\n      panel.find('#dice-formula').val(newDice);\n\n      // [] \n      panel.find('#dice-success-criteria').val(suggestedCriteria).trigger('change');\n    });\n    // \n    panel.find('.acu-dice-custom-btn').click(function () {\n      // \n      panel.find('.acu-dice-preset').removeClass('active');\n      $(this).addClass('active');\n\n      const customDice = panel.find('#dice-custom-input').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#dice-custom-input').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      // \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, customDice);\n        $targetInput.val(convertedVal);\n      }\n\n      panel.find('#dice-formula').val(customDice);\n      currentDiceType = customDice;\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n\n      panel.find('#dice-success-criteria').val('gte').trigger('change');\n    });\n\n    // \n    panel.find('#dice-custom-input').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-dice-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = formula => {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], formula };\n\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      const total = rolls.reduce((a, b) => a + b, 0) + modifier;\n\n      return { total, rolls, sides, count, modifier, formula };\n    };\n\n    // 1d6, 1d6+2\n    const parseModifier = function (modStr) {\n      if (!modStr || modStr.trim() === '') return 0;\n      const trimmed = modStr.trim();\n\n      // \n      const numValue = parseFloat(trimmed);\n      if (!isNaN(numValue) && isFinite(numValue) && trimmed.match(/^-?\\d+(\\.\\d+)?$/)) {\n        return numValue;\n      }\n\n      // \n      // 1d6, 2d10, 1d6+2, 1d6-2, 2d6+1d4\n      let result = 0;\n      let remaining = trimmed;\n\n      // 1d6, 2d10\n      const dicePattern = /(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi;\n      let match;\n      while ((match = dicePattern.exec(remaining)) !== null) {\n        const diceResult = rollDiceExpression(match[0]);\n        if (!isNaN(diceResult)) {\n          result += diceResult;\n        }\n        remaining = remaining.replace(match[0], '');\n      }\n\n      // \n      const numberPattern = /([+-]?\\d+(\\.\\d+)?)/g;\n      let numMatch;\n      while ((numMatch = numberPattern.exec(remaining)) !== null) {\n        const num = parseFloat(numMatch[0]);\n        if (!isNaN(num) && isFinite(num)) {\n          result += num;\n        }\n      }\n\n      return result;\n    };\n\n    let lastDiceRollAt = 0;\n    // \n    const performDiceRoll = function () {\n      const $btn = panel.find('#dice-roll-btn');\n      const now = Date.now();\n      if (now - lastDiceRollAt < 100) return;\n      lastDiceRollAt = now;\n      if ($btn.prop('disabled')) return;\n\n      // \n      $btn.prop('disabled', true).addClass('disabled');\n      setTimeout(() => {\n        $btn.prop('disabled', false).removeClass('disabled');\n      }, 100);\n\n      const formula = panel.find('#dice-formula').val().trim() || '1d100';\n      const modStr = panel.find('#dice-modifier').val().trim() || '0';\n      const mod = parseModifier(modStr);\n      const attrName = panel.find('#dice-attr-name').val().trim() || '';\n      const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n      const difficulty = panel.find('#dice-difficulty').val() || 'normal';\n\n      // \n      const isDND = criteria === 'gte';\n\n      // \n      const diceCfg = getDiceConfig();\n      const hardDiv = diceCfg.difficultSuccessDiv || 2;\n      const extremeDiv = diceCfg.hardSuccessDiv || 5;\n      // COC:   critSuccessMax,   critFailMin\n      // DND:   dndCritSuccess,   dndCritFail\n      const critSuccessMax = isDND ? diceCfg.dndCritFail || 1 : diceCfg.critSuccessMax || 5;\n      const critFailMin = isDND ? diceCfg.dndCritSuccess || 20 : diceCfg.critFailMin || 96;\n\n      // COC  DND \n      let targetInputVal = panel.find('#dice-target').val().trim();\n      let attrInputVal = panel.find('#dice-attr-value').val().trim();\n      let attrValue = attrInputVal !== '' ? parseInt(attrInputVal, 10) : 0;\n      let target;\n      let isAutoTarget = false;\n\n      // \n      const getDefaultTarget = formulaStr => {\n        const match = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (match) {\n          const maxRoll = parseInt(match[1], 10) * parseInt(match[2], 10);\n          return Math.round(maxRoll / 2);\n        }\n        return 50;\n      };\n\n      if (targetInputVal !== '') {\n        // /DC\n        const parsedTarget = parseInt(targetInputVal, 10);\n        target = !Number.isNaN(parsedTarget) ? parsedTarget : getDefaultTarget(formula);\n      } else if (isDND) {\n        // DND  DC = 20 - DC=10\n        if (attrValue > 0) {\n          target = 20 - attrValue;\n          isAutoTarget = true;\n        } else {\n          target = 10; // \n          isAutoTarget = true;\n        }\n      } else {\n        // COC  = \n        if (attrValue > 0) {\n          target = attrValue;\n          isAutoTarget = true;\n        } else {\n          target = getDefaultTarget(formula);\n          isAutoTarget = true;\n        }\n      }\n\n      const result = rollDice(formula);\n      const finalValue = result.total + mod;\n\n      // \n      let requiredTarget = target;\n      let difficultyLabel = '';\n      let difficultyDiv = 1;\n\n      // DND \n      if (!isDND) {\n        switch (difficulty) {\n          case 'hard':\n            requiredTarget = Math.floor(target / hardDiv);\n            difficultyLabel = '';\n            difficultyDiv = hardDiv;\n            break;\n          case 'extreme':\n            requiredTarget = Math.floor(target / extremeDiv);\n            difficultyLabel = '';\n            difficultyDiv = extremeDiv;\n            break;\n          case 'critical':\n            requiredTarget = critSuccessMax;\n            difficultyLabel = '';\n            break;\n          default:\n            difficultyLabel = '';\n            break;\n        }\n      }\n\n      // \n      let isCritSuccess = false;\n      let isCritFailure = false;\n      let isSuccess = false;\n      let outcomeText = '';\n      let outcomeClass = '';\n\n      // /\n      if (isDND) {\n        // DND:   20  1\n        isCritSuccess = finalValue >= critFailMin; //  critFailMin  DND \n        isCritFailure = finalValue <= critSuccessMax; //  critSuccessMax  DND \n      } else {\n        // COC:   5  96\n        isCritSuccess = finalValue <= critSuccessMax;\n        isCritFailure = finalValue >= critFailMin;\n      }\n\n      // /\n      if (isDND) {\n        isSuccess = finalValue >= requiredTarget;\n      } else {\n        isSuccess = finalValue <= requiredTarget;\n      }\n\n      // \n      if (isCritSuccess) {\n        outcomeText = '';\n        outcomeClass = 'success';\n        isSuccess = true;\n      } else if (isCritFailure) {\n        outcomeText = '';\n        outcomeClass = 'failure';\n        isSuccess = false;\n      } else if (isSuccess) {\n        if (isDND) {\n          outcomeText = '';\n        } else if (difficulty === 'hard') {\n          outcomeText = '';\n        } else if (difficulty === 'extreme') {\n          outcomeText = '';\n        } else {\n          // \n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            outcomeText = '';\n          } else if (finalValue <= hardTarget) {\n            outcomeText = '';\n          } else {\n            outcomeText = '';\n          }\n        }\n        outcomeClass = 'success';\n      } else {\n        outcomeText = '';\n        outcomeClass = 'failure';\n      }\n\n      const criteriaSymbol = isDND ? '' : '';\n      const hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const displayValue = hideDiceResultFromUser ? '' : finalValue;\n      const displayOutcomeText = hideDiceResultFromUser ? '' : outcomeText;\n\n      // \n      let resultType;\n      if (isCritSuccess) {\n        resultType = 'critSuccess';\n      } else if (isCritFailure) {\n        resultType = 'critFailure';\n      } else if (isSuccess) {\n        if (difficulty === 'extreme' || (difficulty === 'normal' && finalValue <= Math.floor(target / extremeDiv))) {\n          resultType = 'extremeSuccess';\n        } else if (difficulty === 'hard' || (difficulty === 'normal' && finalValue <= Math.floor(target / hardDiv))) {\n          resultType = 'success';\n        } else {\n          resultType = 'warning';\n        }\n      } else {\n        resultType = 'failure';\n      }\n\n      const badgeClass = getResultBadgeClass(resultType);\n\n      // \n      const $rollBtn = panel.find('#dice-roll-btn');\n      $rollBtn.html(`\n        <div class=\"acu-dice-result-display\">\n          <span class=\"acu-dice-result-value\">${displayValue}</span>\n          <span class=\"acu-dice-result-target\">${criteriaSymbol}${requiredTarget}${difficultyLabel ? '(' + difficultyLabel + ')' : ''}</span>\n          ${displayOutcomeText ? `<span class=\"${badgeClass}\">${displayOutcomeText}</span>` : ''}\n          <button class=\"dice-retry-btn acu-dice-retry-btn\" title=\"\">\n            <i class=\"fa-solid fa-rotate-right\"></i>\n          </button>\n        </div>\n      `);\n\n      // \n      $rollBtn.off('click', '.dice-retry-btn').on('click', '.dice-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        // \n        performDiceRoll();\n      });\n\n      //  Prompt \n      const initiatorName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      let judgeExpr = '';\n\n      if (isCritSuccess) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        } else {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        }\n      } else if (isCritFailure) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        } else {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        }\n      } else if (isDND) {\n        // DND \n        if (isSuccess) {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}<${requiredTarget}`;\n        }\n      } else if (difficulty === 'critical') {\n        // COC \n        judgeExpr = `${critSuccessMax}${finalValue}>${critSuccessMax}`;\n      } else if (difficulty !== 'normal') {\n        // COC \n        if (isSuccess) {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}>${requiredTarget}`;\n        }\n      } else {\n        // COC \n        if (isSuccess) {\n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${extremeDiv}`;\n          } else if (finalValue <= hardTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${hardDiv}`;\n          } else {\n            judgeExpr = `${target}${finalValue}${target}`;\n          }\n        } else {\n          judgeExpr = `${target}${finalValue}>${target}`;\n        }\n      }\n\n      const diceResultText = `${initiatorName}${attrName}${finalValue}${judgeExpr}${outcomeText}`;\n      smartInsertToTextarea(diceResultText, 'dice');\n\n      // \n      const checkResult: AcuDice.CheckResult = {\n        success: isSuccess,\n        total: finalValue,\n        target,\n        outcomeText,\n        attrName,\n        criteria,\n        isAutoTarget,\n        formula,\n      };\n\n      // \n      const checkResultWithTimestamp = { ...checkResult, timestamp: Date.now() };\n      checkHistory.push(checkResultWithTimestamp);\n      if (checkHistory.length > MAX_HISTORY) {\n        checkHistory.shift();\n      }\n\n      // \n      emitEvent('check', checkResultWithTimestamp);\n\n      if (onResult) {\n        onResult(checkResult);\n      }\n    };\n\n    // \n    panel.find('#dice-roll-btn').click(function () {\n      performDiceRoll();\n    });\n\n    // \n    panel.find('#dice-switch-contest-top').click(function () {\n      const targetInput = panel.find('#dice-target').val().trim();\n      const attrValueInput = panel.find('#dice-attr-value').val().trim();\n      const currentDice = panel.find('#dice-formula').val() || '1d100';\n      const initiatorNameVal = panel.find('#dice-initiator-name').val().trim();\n      closePanel();\n      showContestPanel({\n        //  placeholder \n        initiatorName: initiatorNameVal && initiatorNameVal !== '<user>' ? initiatorNameVal : '',\n        initiatorValue: attrValueInput !== '' ? parseInt(attrValueInput, 10) : undefined,\n        diceType: currentDice,\n      });\n    });\n    // \n    const closePanel = () => {\n      overlay.remove();\n      panel.remove();\n    };\n    panel.on('click', e => {\n      e.stopPropagation();\n    });\n    overlay.click(closePanel);\n    panel.find('.acu-dice-close').click(closePanel);\n    //  - \n    panel.find('.acu-dice-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentCriteria = panel.find('#dice-success-criteria').val();\n      const isDND = currentCriteria === 'gte';\n      showDiceSettingsPanel(isDND);\n    });\n  };\n\n  // [] \n  const showContestPanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay, .acu-contest-panel, .acu-contest-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    // \n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n\n    // \n    const opponentName = options.opponentName || '';\n    const diceType = options.diceType || savedDiceType;\n    const passedInitiatorName = options.initiatorName || '';\n    const passedInitiatorValue = options.initiatorValue;\n    const passedOpponentValue = options.opponentValue;\n\n    const rawData = cachedRawData || getTableData();\n    let playerAttrs = [];\n    let opponentAttrs = [];\n\n    // [] <user> + \n    let characterList = ['<user>'];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) characterList.push(row[1]);\n          }\n          break;\n        }\n      }\n    }\n    // [] \n    let contestAttrList = [];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content && sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!contestAttrList.includes(attr.name)) contestAttrList.push(attr.name);\n              });\n            }\n          });\n          break;\n        }\n      }\n    }\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const attrStr = sheet.content[1][7] || '';\n          playerAttrs = parseAttributeString(attrStr);\n        }\n\n        if (sheet.name === '' && opponentName) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1] === opponentName) {\n              const attrStr = row[9] || '';\n              opponentAttrs = parseAttributeString(attrStr);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    const buildAttrButtons = (attrs, targetType) => {\n      let html = '';\n      // \n      for (let i = 0; i < attrs.length; i++) {\n        const attr = attrs[i];\n        html +=\n          '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n          attr.value +\n          '\" data-aname=\"' +\n          escapeHtml(attr.name) +\n          '\" data-type=\"' +\n          targetType +\n          '\">' +\n          escapeHtml(attr.name) +\n          ': ' +\n          attr.value +\n          '</button>';\n      }\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" title=\"\"><i class=\"fa-solid fa-trash-alt\"></i></button>';\n      return html;\n    };\n\n    const overlay = $('<div class=\"acu-contest-overlay\"></div>');\n    const panelHtml =\n      '<div class=\"acu-contest-panel acu-theme-' +\n      config.theme +\n      '\">' +\n      '<div class=\"acu-dice-panel-header\">' +\n      '<div class=\"acu-dice-panel-title\"><i class=\"fa-solid fa-people-arrows\"></i> </div>' +\n      '<div class=\"acu-dice-panel-actions\">' +\n      '<button id=\"contest-switch-normal\" class=\"acu-dice-panel-action-btn\" title=\"\"><i class=\"fa-solid fa-dice-d20\"></i></button>' +\n      '<button class=\"acu-contest-config-btn acu-dice-panel-action-btn\" title=\"\"><i class=\"fa-solid fa-cog\"></i></button>' +\n      '<button class=\"acu-contest-close acu-dice-panel-action-btn\"><i class=\"fa-solid fa-times\"></i></button>' +\n      '</div>' +\n      '</div>' +\n      '<div class=\"acu-dice-panel-body\">' +\n      '<div class=\"acu-dice-presets\">' +\n      '<button class=\"acu-dice-preset' +\n      (diceType === '1d20' ? ' active' : '') +\n      '\" data-dice=\"1d20\">1d20</button>' +\n      '<button class=\"acu-dice-preset' +\n      (diceType === '1d100' ? ' active' : '') +\n      '\" data-dice=\"1d100\">1d100</button>' +\n      '<button class=\"acu-dice-preset acu-contest-custom-btn' +\n      (!['1d20', '1d100'].includes(diceType) ? ' active' : '') +\n      '\" data-dice=\"custom\"></button>' +\n      '<input type=\"text\" class=\"acu-dice-custom-input\" id=\"contest-custom-dice\" placeholder=\"2d6\" value=\"' +\n      (!['1d20', '1d100'].includes(diceType) ? diceType : '') +\n      '\" />' +\n      '</div>' +\n      '<input type=\"hidden\" id=\"contest-dice-type\" value=\"' +\n      diceType +\n      '\">' +\n      '<div class=\"acu-dice-section-title\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-init-char-buttons\" class=\"acu-dice-quick-inline\"></div></div>' +\n      '<div class=\"acu-dice-form-row cols-2\">' +\n      '<div><div class=\"acu-dice-form-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-init-display\" value=\"\" placeholder=\"<user>\"></div>' +\n      '<div><div class=\"acu-dice-form-label\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-init-random-skill\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-init-name\" value=\"\" placeholder=\"\"></div>' +\n      '</div>' +\n      '<div class=\"acu-dice-form-row cols-2\">' +\n      '<div><div class=\"acu-dice-form-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-init-value\" value=\"' +\n      (passedInitiatorValue !== undefined ? passedInitiatorValue : '') +\n      '\" placeholder=\"=50%\"></div>' +\n      '<div><div class=\"acu-dice-form-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-init-target\" value=\"\" placeholder=\"\"></div>' +\n      '</div>' +\n      '<div id=\"init-attr-buttons\" class=\"acu-dice-quick-compact\">' +\n      buildAttrButtons(playerAttrs, 'init') +\n      '</div>' +\n      '<div class=\"acu-dice-section-title\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-opp-char-buttons\" class=\"acu-dice-quick-inline\"></div></div>' +\n      '<div class=\"acu-dice-form-row cols-2\">' +\n      '<div><div class=\"acu-dice-form-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-opponent-display\" value=\"' +\n      escapeHtml(opponentName) +\n      '\" placeholder=\"\"></div>' +\n      '<div><div class=\"acu-dice-form-label\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-opp-random-skill\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-opp-name\" value=\"\" placeholder=\"\"></div>' +\n      '</div>' +\n      '<div class=\"acu-dice-form-row cols-2\">' +\n      '<div><div class=\"acu-dice-form-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-opp-value\" value=\"' +\n      (passedOpponentValue !== undefined ? passedOpponentValue : '') +\n      '\" placeholder=\"=50%\"></div>' +\n      '<div><div class=\"acu-dice-form-label\"></div><input type=\"text\" class=\"acu-dice-input\" id=\"contest-opp-target\" value=\"\" placeholder=\"\"></div>' +\n      '</div>' +\n      '<div id=\"opp-attr-buttons\" class=\"acu-dice-quick-compact\">' +\n      buildAttrButtons(opponentAttrs, 'opp') +\n      '</div>' +\n      '<div id=\"contest-result-display\" class=\"acu-contest-result-display\">' +\n      '<div class=\"acu-contest-result-inner\">' +\n      '<div id=\"contest-result-init\" class=\"acu-contest-result-side\"></div>' +\n      '<span class=\"acu-contest-vs\">VS</span>' +\n      '<div id=\"contest-result-opp\" class=\"acu-contest-result-side right\"></div>' +\n      '</div>' +\n      '</div>' +\n      '<button id=\"contest-roll-btn\" class=\"acu-dice-roll-btn\"><i class=\"fa-solid fa-dice\"></i> </button>' +\n      '</div>' +\n      '</div>';\n\n    const panel = $(panelHtml);\n    overlay.append(panel);\n    $('body').append(overlay);\n\n    // []  - \n    const buildCharBtns = targetType => {\n      const containerId = targetType === 'init' ? '#contest-init-char-buttons' : '#contest-opp-char-buttons';\n      const $container = panel.find(containerId);\n      let html = '';\n      characterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html +=\n          '<button class=\"acu-dice-char-btn\" data-char=\"' +\n          escapeHtml(name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" title=\"' +\n          escapeHtml(displayName) +\n          '\">' +\n          escapeHtml(shortName) +\n          '</button>';\n      });\n      $container.html(html);\n      $container.find('.acu-dice-char-btn').click(function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const charName = $(this).data('char');\n        const type = $(this).data('type');\n        if (type === 'init') {\n          panel.find('#contest-init-display').val(charName).trigger('change');\n        } else {\n          panel.find('#contest-opponent-display').val(charName).trigger('change');\n        }\n      });\n    };\n\n    // [] \n    const rebuildAttrBtns = (attrs, targetType) => {\n      const containerId = targetType === 'init' ? '#init-attr-buttons' : '#opp-attr-buttons';\n      const $container = panel.find(containerId);\n\n      // \n      $container.show();\n\n      let html = '';\n\n      // \n      if (attrs.length > 0) {\n        attrs.forEach(attr => {\n          html +=\n            '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n            attr.value +\n            '\" data-aname=\"' +\n            escapeHtml(attr.name) +\n            '\" data-type=\"' +\n            targetType +\n            '\">' +\n            escapeHtml(attr.name) +\n            ':' +\n            attr.value +\n            '</button>';\n        });\n      }\n\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" title=\"\"><i class=\"fa-solid fa-trash-alt\"></i></button>';\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-contest-attr-btn').click(function () {\n        const val = $(this).attr('data-val');\n        const aname = $(this).attr('data-aname');\n        const type = $(this).attr('data-type');\n        if (type === 'init') {\n          panel.find('#contest-init-value').val(val);\n          panel.find('#contest-init-name').val(aname);\n        } else {\n          panel.find('#contest-opp-value').val(val);\n          panel.find('#contest-opp-name').val(aname);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          // \n          let charName;\n          if (type === 'init') {\n            charName = panel.find('#contest-init-display').val().trim() || '<user>';\n          } else {\n            charName = panel.find('#contest-opponent-display').val().trim();\n          }\n\n          if (!charName) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        let charName;\n        if (type === 'init') {\n          charName = panel.find('#contest-init-display').val().trim() || '<user>';\n        } else {\n          charName = panel.find('#contest-opponent-display').val().trim();\n        }\n\n        if (!charName) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharBtns('init');\n    buildCharBtns('opp');\n    // [] \n    panel.find('#contest-init-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-init-name').val(randomSkill).trigger('change');\n    });\n\n    // [] \n    panel.find('#contest-opp-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-opp-name').val(randomSkill).trigger('change');\n    });\n    //  rebuildAttrBtns /\n    const initAttrs = getFullAttributesForCharacter(passedInitiatorName || '<user>');\n    rebuildAttrBtns(initAttrs, 'init');\n    const oppAttrs = getFullAttributesForCharacter(opponentName || '');\n    rebuildAttrBtns(oppAttrs, 'opp');\n\n    // \n    initCustomDropdown(panel.find('#contest-init-display'), characterList);\n    initCustomDropdown(panel.find('#contest-opponent-display'), characterList);\n    initCustomDropdown(panel.find('#contest-init-name'), contestAttrList);\n    initCustomDropdown(panel.find('#contest-opp-name'), contestAttrList);\n    addClearButton(\n      panel,\n      '#contest-init-display, #contest-init-name, #contest-init-value, #contest-init-target, #contest-opponent-display, #contest-opp-name, #contest-opp-value, #contest-opp-target',\n    );\n\n    // \n    panel.find('#contest-init-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-init-name'), newAttrList.length > 0 ? newAttrList : contestAttrList);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'init');\n    });\n\n    // \n    panel.find('#contest-opponent-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim();\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-opp-name'), newAttrList.length > 0 ? newAttrList : contestAttrList);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'opp');\n    });\n\n    // \n    panel.find('#contest-init-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-init-display').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-init-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('#contest-opp-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-opponent-display').val().trim();\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-opp-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('.acu-dice-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-dice-preset').removeClass('active');\n      $(this).addClass('active');\n      panel.find('#contest-dice-type').val(newDice);\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n    });\n\n    // \n    panel.find('.acu-contest-custom-btn').click(function () {\n      // \n      panel.find('.acu-dice-preset').removeClass('active');\n      $(this).addClass('active');\n\n      var customDice = panel.find('#contest-custom-dice').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#contest-custom-dice').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      panel.find('#contest-dice-type').val(customDice);\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n    });\n\n    // \n    panel.find('#contest-custom-dice').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-contest-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = function (formula) {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], sides: 100 };\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      return {\n        total:\n          rolls.reduce(function (a, b) {\n            return a + b;\n          }, 0) + modifier,\n        rolls: rolls,\n        sides: sides,\n      };\n    };\n\n    const getSuccessLevel = function (roll, target, sides) {\n      if (sides === 100) {\n        if (roll <= 5) return { level: 3, name: '', color: 'var(--acu-crit-success-text)' };\n        if (roll >= 96) return { level: -1, name: '', color: 'var(--acu-crit-failure-text)' };\n        if (roll <= Math.floor(target / 5))\n          return { level: 2, name: '', color: 'var(--acu-extreme-success-text)' };\n        if (roll <= Math.floor(target / 2)) return { level: 1, name: '', color: 'var(--acu-success-text)' };\n        if (roll <= target) return { level: 0, name: '', color: 'var(--acu-warning-text)' };\n        return { level: -1, name: '', color: 'var(--acu-failure-text)' };\n      } else {\n        if (roll === 20) return { level: 3, name: '', color: 'var(--acu-crit-success-text)' };\n        if (roll === 1) return { level: -1, name: '', color: 'var(--acu-crit-failure-text)' };\n        if (roll >= target) return { level: 0, name: '', color: 'var(--acu-success-text)' };\n        return { level: -1, name: '', color: 'var(--acu-failure-text)' };\n      }\n    };\n\n    let lastContestRollAt = 0;\n    // \n    const performContestRoll = function () {\n      const $btn = panel.find('#contest-roll-btn');\n      const $row = panel.find('.acu-contest-result-row');\n      const now = Date.now();\n      if (now - lastContestRollAt < 100) return;\n      lastContestRollAt = now;\n\n      // \n      if ($btn.prop('disabled') || $row.hasClass('disabled')) return;\n\n      const lockUI = () => {\n        $btn.prop('disabled', true).addClass('disabled');\n        $row.addClass('disabled').css('pointer-events', 'none');\n      };\n      const unlockUI = () => {\n        $btn.prop('disabled', false).removeClass('disabled');\n        $row.removeClass('disabled').css('pointer-events', '');\n      };\n\n      lockUI();\n      setTimeout(unlockUI, 100);\n\n      var formula = panel.find('#contest-dice-type').val() || '1d100';\n\n      var initName = panel.find('#contest-init-display').val().trim() || '<user>';\n      var initAttrName = panel.find('#contest-init-name').val().trim() || '';\n      // \n      var getHalfMax = function (formulaStr) {\n        var m = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (m) return Math.round((parseInt(m[1], 10) * parseInt(m[2], 10)) / 2);\n        return 50;\n      };\n\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var initValue;\n      if (initValueInput === '') {\n        // \n        initValue = getHalfMax(formula);\n      } else {\n        initValue = parseInt(initValueInput, 10) || getHalfMax(formula);\n      }\n      var initTargetInput = panel.find('#contest-init-target').val().trim();\n      var initTarget;\n      if (initTargetInput !== '') {\n        initTarget = parseInt(initTargetInput, 10);\n      } else {\n        // \n        initTarget = initValue;\n      }\n\n      var oppName = panel.find('#contest-opponent-display').val().trim() || '';\n      var oppAttrName = panel.find('#contest-opp-name').val().trim() || initAttrName;\n      var oppValueInput = panel.find('#contest-opp-value').val().trim();\n      var oppValue;\n      if (oppValueInput === '') {\n        // \n        oppValue = getHalfMax(formula);\n      } else {\n        oppValue = parseInt(oppValueInput, 10) || getHalfMax(formula);\n      }\n      var oppTargetInput = panel.find('#contest-opp-target').val().trim();\n      var oppTarget;\n      if (oppTargetInput !== '') {\n        oppTarget = parseInt(oppTargetInput, 10);\n      } else {\n        // \n        oppTarget = oppValue;\n      }\n\n      var initResult = rollDice(formula);\n      var oppResult = rollDice(formula);\n      var initSuccess = getSuccessLevel(initResult.total, initTarget, initResult.sides);\n      var oppSuccess = getSuccessLevel(oppResult.total, oppTarget, oppResult.sides);\n\n      var winner, winnerResultType, resultDesc;\n      var diceCfg = getDiceConfig();\n      var tieRule = diceCfg.contestTieRule || 'initiator_lose';\n      var hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      var displayInitValue = hideDiceResultFromUser ? '' : initResult.total;\n      var displayOppValue = hideDiceResultFromUser ? '' : oppResult.total;\n      var displayInitSuccessName = hideDiceResultFromUser ? '' : initSuccess.name;\n      var displayOppSuccessName = hideDiceResultFromUser ? '' : oppSuccess.name;\n\n      if (initSuccess.level > oppSuccess.level) {\n        winner = initName + ' ';\n        winnerResultType = 'success';\n        resultDesc = initSuccess.name + '  ' + oppSuccess.name;\n      } else if (initSuccess.level < oppSuccess.level) {\n        winner = oppName + ' ';\n        winnerResultType = 'failure';\n        resultDesc = oppSuccess.name + '  ' + initSuccess.name;\n      } else {\n        // \n        resultDesc = ' ' + initSuccess.name;\n        if (tieRule === 'initiator_win') {\n          winner = '' + initName + ' ';\n          winnerResultType = 'success';\n        } else if (tieRule === 'tie') {\n          winner = '';\n          winnerResultType = 'warning';\n        } else {\n          // : initiator_lose\n          winner = '' + initName + ' ';\n          winnerResultType = 'failure';\n        }\n      }\n\n      var displayWinner = hideDiceResultFromUser ? '' : winner;\n\n      // \n      const getResultTypeFromSuccess = success => {\n        if (success.level === 3) return 'critSuccess';\n        if (success.level === 2) return 'extremeSuccess';\n        if (success.level === 1) return 'success';\n        if (success.level === 0) return 'warning';\n        if (success.level === -1) {\n          // name\n          return success.name === '' ? 'critFailure' : 'failure';\n        }\n        return 'failure';\n      };\n      const initResultType = getResultTypeFromSuccess(initSuccess);\n      const oppResultType = getResultTypeFromSuccess(oppSuccess);\n\n      const initBadgeClass = getResultBadgeClass(initResultType);\n      const oppBadgeClass = getResultBadgeClass(oppResultType);\n      const winnerBadgeClass = getResultBadgeClass(winnerResultType);\n      // \n      const winnerColorClass =\n        winnerResultType === 'success'\n          ? 'acu-contest-winner-success'\n          : winnerResultType === 'warning'\n            ? 'acu-contest-winner-warning'\n            : 'acu-contest-winner-failure';\n\n      // \n      const $resultDisplay = panel.find('#contest-result-display');\n      const $resultInit = panel.find('#contest-result-init');\n      const $resultOpp = panel.find('#contest-result-opp');\n\n      // \n      $resultInit.html(\n        '<span class=\"acu-contest-result-name\">' +\n          escapeHtml(initName) +\n          '</span>' +\n          '<span class=\"acu-contest-result-value\">' +\n          displayInitValue +\n          '</span>' +\n          (displayInitSuccessName ? '<span class=\"' + initBadgeClass + '\">' + displayInitSuccessName + '</span>' : ''),\n      );\n\n      // \n      $resultOpp.html(\n        (displayOppSuccessName ? '<span class=\"' + oppBadgeClass + '\">' + displayOppSuccessName + '</span>' : '') +\n          '<span class=\"acu-contest-result-value\">' +\n          displayOppValue +\n          '</span>' +\n          '<span class=\"acu-contest-result-name\">' +\n          escapeHtml(oppName) +\n          '</span>',\n      );\n\n      // roll\n      $resultDisplay.html(\n        '<div class=\"acu-contest-result-container\" title=\"\">' +\n          // \n          '<div class=\"acu-contest-result-row\">' +\n          '<div class=\"acu-contest-result-inner\">' +\n          '<div id=\"contest-result-init\" class=\"acu-contest-result-side\">' +\n          '<span class=\"acu-contest-result-name\">' +\n          escapeHtml(initName) +\n          '</span>' +\n          '<span class=\"acu-contest-result-value\">' +\n          displayInitValue +\n          '</span>' +\n          (displayInitSuccessName ? '<span class=\"' + initBadgeClass + '\">' + displayInitSuccessName + '</span>' : '') +\n          '</div>' +\n          '<span class=\"acu-contest-vs\">VS</span>' +\n          '<div id=\"contest-result-opp\" class=\"acu-contest-result-side right\">' +\n          (displayOppSuccessName ? '<span class=\"' + oppBadgeClass + '\">' + displayOppSuccessName + '</span>' : '') +\n          '<span class=\"acu-contest-result-value\">' +\n          displayOppValue +\n          '</span>' +\n          '<span class=\"acu-contest-result-name\">' +\n          escapeHtml(oppName) +\n          '</span>' +\n          '</div>' +\n          '</div>' +\n          '</div>' +\n          //  + roll\n          '<div class=\"acu-contest-result-winner-row\">' +\n          '<span class=\"acu-contest-winner-text ' +\n          winnerColorClass +\n          '\">' +\n          displayWinner +\n          '</span>' +\n          '<i class=\"fa-solid fa-rotate-right acu-contest-reroll-icon\"></i>' +\n          '</div>' +\n          '</div>',\n      );\n      $resultDisplay.show();\n\n      // \n      $resultDisplay.off('click').on('click', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        performContestRoll();\n      });\n\n      // \n      const $contestBtn = panel.find('#contest-roll-btn');\n      $contestBtn.hide();\n\n      const contestResultText =\n        `${initName} ${initAttrName} vs ${oppName} ${oppAttrName}` +\n        `${initName} ${initAttrName} (${initTarget})  ${initResult.total}${initSuccess.name}` +\n        `${oppName} ${oppAttrName} (${oppTarget})  ${oppResult.total}${oppSuccess.name}` +\n        `${winner}`;\n      smartInsertToTextarea(contestResultText, 'dice');\n\n      // \n      const contestResult: AcuDice.ContestResult = {\n        left: {\n          name: initName,\n          attribute: initAttrName,\n          roll: initResult.total,\n          target: initTarget,\n          successLevel: initSuccess.level,\n        },\n        right: {\n          name: oppName,\n          attribute: oppAttrName,\n          roll: oppResult.total,\n          target: oppTarget,\n          successLevel: oppSuccess.level,\n        },\n        winner: initSuccess.level > oppSuccess.level ? 'left' : initSuccess.level < oppSuccess.level ? 'right' : 'tie',\n        message: winner,\n      };\n\n      // \n      const contestResultWithTimestamp = { ...contestResult, timestamp: Date.now() };\n      contestHistory.push(contestResultWithTimestamp);\n      if (contestHistory.length > MAX_HISTORY) {\n        contestHistory.shift();\n      }\n\n      // \n      emitEvent('contest', contestResultWithTimestamp);\n    };\n\n    // \n    panel.find('#contest-roll-btn').click(function () {\n      performContestRoll();\n    });\n\n    // [] \n    panel.find('#contest-switch-normal').click(function () {\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var currentInitName = panel.find('#contest-init-name').val() || '';\n      var currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      var initiatorNameVal = panel.find('#contest-init-display').val().trim();\n      closePanel();\n      showDicePanel({\n        //  null  placeholder\n        targetValue: initValueInput !== '' ? parseInt(initValueInput, 10) : null,\n        targetName: currentInitName,\n        diceType: currentDice,\n        initiatorName: initiatorNameVal,\n      });\n    });\n    //  - \n    // 1d20 -> DND,  -> COC\n    panel.find('.acu-contest-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      const isDND = currentDice === '1d20';\n      showDiceSettingsPanel(isDND);\n    });\n    var closePanel = function () {\n      overlay.remove();\n      panel.remove();\n    };\n    panel.on('click', function (e) {\n      e.stopPropagation();\n    });\n    overlay.click(closePanel);\n    panel.find('.acu-contest-close').click(closePanel);\n  };\n\n  const parseInSceneStatus = (value, headerName) => {\n    const val = String(value || '')\n      .trim()\n      .toLowerCase();\n    const header = String(headerName || '').toLowerCase();\n    if (!val) return false;\n\n    if (header.includes('')) {\n      return val === '' || val === 'false' || val === 'no';\n    }\n\n    return val.startsWith('') || val === 'true' || val === '' || val === 'yes';\n  };\n\n  const buildMapViewModel = async () => {\n    const rawData = cachedRawData || getTableData();\n    const allTables = processJsonData(rawData || {});\n    if (!rawData || Object.keys(allTables).length === 0) return null;\n\n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const elementResult = (() => {\n      const keywords = ['', '', '', '', ''];\n      for (const tableName in allTables) {\n        if (keywords.some(keyword => tableName.includes(keyword))) {\n          return {\n            data: allTables[tableName],\n            name: tableName,\n            key: allTables[tableName].key,\n          };\n        }\n      }\n      return null;\n    })();\n\n    const globalHeaders = globalResult?.data?.headers || [];\n    const globalRows = globalResult?.data?.rows || [];\n    const globalRow = globalRows[0] || [];\n    const globalConfig = DASHBOARD_TABLE_CONFIG.global;\n    const detailIdx = DashboardDataParser.findColumnIndex(globalHeaders, 'detailLocation', globalConfig);\n    const regionIdx = DashboardDataParser.findColumnIndex(globalHeaders, 'currentLocation', globalConfig);\n    const detailLocation = detailIdx >= 0 ? String(globalRow[detailIdx] || '').trim() : '';\n    const currentRegion = regionIdx >= 0 ? String(globalRow[regionIdx] || '').trim() : '';\n\n    if (!locationResult?.data) return null;\n\n    const findColumnIndex = (headers, keywords, fallbackIndex = null) => {\n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (keywords.some(keyword => h.includes(keyword.toLowerCase()))) return i;\n      }\n      return fallbackIndex ?? -1;\n    };\n\n    const locations = new Map();\n    const locationHeaders = locationResult.data.headers || [];\n    const locationRows = locationResult.data.rows || [];\n    const locationNameIdx = findColumnIndex(locationHeaders, ['', '', '', '', ''], 1);\n    const locationRegionIdx = findColumnIndex(locationHeaders, ['', '', '', ''], null);\n    const locationTypeIdx = findColumnIndex(locationHeaders, ['', '', ''], null);\n    const locationDescIdx = findColumnIndex(locationHeaders, ['', '', '', '', ''], null);\n    const locationImportanceIdx = findColumnIndex(locationHeaders, ['', ''], null);\n    const locationExploreIdx = findColumnIndex(locationHeaders, ['', '', ''], null);\n\n    // emoji\n    const allLocationNames: string[] = [];\n    locationRows.forEach(row => {\n      const name = String(row[locationNameIdx] || '')\n        .trim()\n        .replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n      if (name) allLocationNames.push(name);\n    });\n    const emojiMap = resolveBatchLocationEmojis(allLocationNames);\n\n    locationRows.forEach((row, idx) => {\n      const name = String(row[locationNameIdx] || '')\n        .trim()\n        .replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n      if (!name) return;\n      const region = locationRegionIdx >= 0 ? String(row[locationRegionIdx] || '').trim() : '';\n\n      const location = {\n        name,\n        region,\n        locationType: locationTypeIdx >= 0 ? row[locationTypeIdx] || '' : '',\n        description: locationDescIdx >= 0 ? row[locationDescIdx] || '' : '',\n        importance: locationImportanceIdx >= 0 ? row[locationImportanceIdx] || '' : '',\n        exploreStatus: locationExploreIdx >= 0 ? row[locationExploreIdx] || '' : '',\n        emoji: emojiMap.get(name) ?? null,\n        tableKey: locationResult.key || '',\n        rowIndex: idx,\n      };\n      locations.set(name, location);\n    });\n\n    const elements = new Map();\n    const addElement = (locationName, element) => {\n      if (!elements.has(locationName)) {\n        elements.set(locationName, []);\n      }\n      elements.get(locationName).push(element);\n    };\n\n    if (elementResult?.data) {\n      const elementHeaders = elementResult.data.headers || [];\n      const elementRows = elementResult.data.rows || [];\n      const elementNameIdx = findColumnIndex(elementHeaders, ['', '', ''], 1);\n      const elementTypeIdx = findColumnIndex(elementHeaders, ['', '', ''], 2);\n      const elementLocationIdx = findColumnIndex(elementHeaders, ['', '', ''], 3);\n      const elementDescIdx = findColumnIndex(elementHeaders, ['', '', ''], null);\n      const elementStatusIdx = findColumnIndex(elementHeaders, ['', ''], null);\n      const elementInteractIdx = findColumnIndex(elementHeaders, ['', '', '', ''], null);\n\n      elementRows.forEach((row, idx) => {\n        const name = String(row[elementNameIdx] || '').trim();\n        if (!name) return;\n        const locationName = String(row[elementLocationIdx] || '').trim();\n        if (!locationName) return;\n        if (currentRegion && locations.size > 0 && !locations.has(locationName)) return;\n\n        const rawInteractions = elementInteractIdx >= 0 ? row[elementInteractIdx] : '';\n        const interactions = String(rawInteractions || '')\n          .split(/[,;]/)\n          .map(item => item.trim())\n          .filter(Boolean);\n        const typeValue = elementTypeIdx >= 0 ? row[elementTypeIdx] || '' : '';\n        const element = {\n          name,\n          type: typeValue,\n          location: locationName,\n          description: elementDescIdx >= 0 ? row[elementDescIdx] || '' : '',\n          status: elementStatusIdx >= 0 ? row[elementStatusIdx] || '' : '',\n          interactions,\n          emoji: getElementEmoji(name, typeValue),\n          tableKey: elementResult.key || '',\n          rowIndex: idx,\n        };\n        addElement(locationName, element);\n      });\n    }\n\n    const characters = new Map();\n    const addCharacter = async character => {\n      const avatarUrl = await AvatarManager.getAsync(character.name);\n      const full = {\n        ...character,\n        avatarUrl,\n        avatarOffsetX: AvatarManager.getOffsetX(character.name),\n        avatarOffsetY: AvatarManager.getOffsetY(character.name),\n        avatarScale: AvatarManager.getScale(character.name),\n      };\n      if (!characters.has(full.location)) {\n        characters.set(full.location, []);\n      }\n      characters.get(full.location).push(full);\n    };\n\n    let playerLocation = '';\n\n    if (playerResult?.data) {\n      const playerConfig = DASHBOARD_TABLE_CONFIG.player;\n      const playerHeaders = playerResult.data.headers || [];\n      const playerRows = playerResult.data.rows || [];\n      const playerRow = playerRows[0] || [];\n      const playerNameIdx = DashboardDataParser.findColumnIndex(playerHeaders, 'name', playerConfig);\n      const playerPosIdx = DashboardDataParser.findColumnIndex(playerHeaders, 'position', playerConfig);\n      const playerNameRaw = playerNameIdx >= 0 ? playerRow[playerNameIdx] : getPlayerName();\n      const playerPosRaw = playerPosIdx >= 0 ? playerRow[playerPosIdx] : '';\n      const playerName = String(playerNameRaw || '').trim();\n      playerLocation = String(playerPosRaw || '').trim();\n\n      if (!playerLocation && detailLocation) {\n        playerLocation = detailLocation;\n      }\n\n      if (playerName && playerLocation) {\n        await addCharacter({\n          name: playerName,\n          location: playerLocation,\n          isPlayer: true,\n          isInScene: true,\n          tableKey: playerResult.key || '',\n          rowIndex: 0,\n        });\n      }\n    }\n\n    if (npcResult?.data) {\n      const npcConfig = DASHBOARD_TABLE_CONFIG.npc;\n      const npcHeaders = npcResult.data.headers || [];\n      const npcRows = npcResult.data.rows || [];\n      const npcNameIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'name', npcConfig);\n      const npcPosIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'position', npcConfig);\n      const npcInSceneIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'inScene', npcConfig);\n\n      for (let idx = 0; idx < npcRows.length; idx++) {\n        const row = npcRows[idx];\n        const npcName = String(row[npcNameIdx] || '').trim();\n        if (!npcName) continue;\n        const locationName = String(row[npcPosIdx] || '').trim();\n        if (!locationName) continue;\n        if (currentRegion && locations.size > 0 && !locations.has(locationName)) continue;\n        const inSceneValue = npcInSceneIdx >= 0 ? row[npcInSceneIdx] : '';\n        const inSceneHeader = npcHeaders[npcInSceneIdx] || '';\n        const isInScene = parseInSceneStatus(inSceneValue, inSceneHeader);\n\n        await addCharacter({\n          name: npcName,\n          location: locationName,\n          isPlayer: false,\n          isInScene,\n          tableKey: npcResult.key || '',\n          rowIndex: idx,\n        });\n      }\n    }\n\n    const locationIterator = locations.values();\n    const firstLocation = locationIterator.next().value;\n\n    const allRegions = [...new Set(Array.from(locations.values()).map(l => l.region || ''))].sort();\n    // \"\"\n    const otherIndex = allRegions.indexOf('');\n    if (otherIndex > -1) {\n      allRegions.splice(otherIndex, 1);\n      allRegions.push('');\n    }\n\n    const getHotLocationsInRegion = region => {\n      const regionName = region || '';\n      return Array.from(locations.values())\n        .filter(l => (l.region || '') === regionName)\n        .sort((a, b) => {\n          const scoreA = (characters.get(a.name)?.length || 0) + (elements.get(a.name)?.length || 0);\n          const scoreB = (characters.get(b.name)?.length || 0) + (elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n    };\n\n    const focusLocation = (() => {\n      if (detailLocation && locations.has(detailLocation)) return detailLocation;\n      if (playerLocation && locations.has(playerLocation)) return playerLocation;\n      const fallbackRegion = allRegions[0];\n      if (fallbackRegion) {\n        const regionLocations = getHotLocationsInRegion(fallbackRegion);\n        if (regionLocations.length > 0) return regionLocations[0].name;\n      }\n      return firstLocation ? firstLocation.name : '';\n    })();\n\n    return {\n      currentRegion: currentRegion || locations.get(playerLocation)?.region || '',\n      detailLocation,\n      focusLocation,\n      playerLocation,\n      locations,\n      elements,\n      characters,\n      allRegions,\n    };\n  };\n\n  // \n  let isMapOpening = false;\n\n  const showMapVisualization = async () => {\n    const { $ } = getCore();\n\n    // \n    if (isMapOpening) return;\n    isMapOpening = true;\n\n    // overlay\n    $('.acu-map-overlay').remove();\n\n    let viewModel = await buildMapViewModel();\n    if (!viewModel) {\n      isMapOpening = false;\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const config = getConfig();\n\n    // \n    const tabSelectionCache = new Map<string, string>();\n\n    // \n    const getHotLocationsInRegion = (region: string) => {\n      const regionName = region || '';\n      return Array.from(viewModel.locations.values())\n        .filter(l => (l.region || '') === regionName)\n        .sort((a, b) => {\n          const scoreA =\n            (viewModel.characters.get(a.name)?.length || 0) + (viewModel.elements.get(a.name)?.length || 0);\n          const scoreB =\n            (viewModel.characters.get(b.name)?.length || 0) + (viewModel.elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n    };\n\n    // \"\"\n    const detailLocation = viewModel.detailLocation || '';\n    const playerLocation = viewModel.playerLocation || '';\n    let focusLocation = '';\n    let selectedRegion = viewModel.currentRegion;\n\n    // :  >  > viewModel.focusLocation\n    if (detailLocation && viewModel.locations.has(detailLocation)) {\n      focusLocation = detailLocation;\n      const targetLocation = viewModel.locations.get(detailLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n      focusLocation = playerLocation;\n      const targetLocation = viewModel.locations.get(playerLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    } else if (viewModel.focusLocation && viewModel.locations.has(viewModel.focusLocation)) {\n      focusLocation = viewModel.focusLocation;\n      const targetLocation = viewModel.locations.get(focusLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    }\n\n    if (focusLocation) {\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      // \n      tabSelectionCache.set(selectedRegion, focusLocation);\n    }\n\n    const overlay = $(`\n            <div class=\"acu-map-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-map-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-map-title\">\n                            <i class=\"fa-solid fa-map-location-dot\"></i>\n                            <span class=\"acu-map-region-name\"></span>\n                        </div>\n                        <div class=\"acu-map-region-tabs\"></div>\n                        <div class=\"acu-map-actions\">\n                            <button class=\"acu-map-back-btn\" title=\"\"><i class=\"fa-solid fa-location-crosshairs\"></i></button>\n                            <button class=\"acu-close-btn acu-map-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-map-body\">\n                        <div class=\"acu-map-focus-area\"></div>\n                        <div class=\"acu-map-thumbnails\"></div>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const overlayEl = overlay[0];\n    overlayEl.style.setProperty('position', 'fixed', 'important');\n    overlayEl.style.setProperty('top', '0', 'important');\n    overlayEl.style.setProperty('left', '0', 'important');\n    overlayEl.style.setProperty('right', '0', 'important');\n    overlayEl.style.setProperty('bottom', '0', 'important');\n    overlayEl.style.setProperty('width', '100vw', 'important');\n    overlayEl.style.setProperty('height', '100vh', 'important');\n    overlayEl.style.setProperty('display', 'flex', 'important');\n    overlayEl.style.setProperty('justify-content', 'center', 'important');\n    overlayEl.style.setProperty('align-items', 'center', 'important');\n    overlayEl.style.setProperty('z-index', '31100', 'important');\n\n    // selectedRegion \n    const $focusArea = overlay.find('.acu-map-focus-area');\n    const $thumbnails = overlay.find('.acu-map-thumbnails');\n\n    //  fa:xxx / ti:xxx emoji\n    const renderIconContent = (icon: string): string => {\n      if (icon.startsWith('fa:')) {\n        const name = icon.slice(3);\n        return `<i class=\"fa-solid fa-${name} acu-theme-icon\"></i>`;\n      }\n      if (icon.startsWith('ti:')) {\n        const name = icon.slice(3);\n        return `<i class=\"ti ti-${name} acu-theme-icon\"></i>`;\n      }\n      return icon;\n    };\n\n    const renderElementChip = element => {\n      const name = element.name || element.type || '';\n      const emoji = element.emoji ? `<span class=\"acu-map-chip-emoji\">${renderIconContent(element.emoji)}</span>` : '';\n      return `\n                 <div class=\"acu-map-element-chip acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n                   element.tableKey || '',\n                 )}\" data-row-index=\"${element.rowIndex}\">\n                     ${emoji}\n                     <span class=\"acu-map-chip-name\" title=\"${escapeHtml(name)}\">${escapeHtml(name)}</span>\n                 </div>\n             `;\n    };\n\n    const renderFocusArea = (model, locationName) => {\n      const location = model.locations.get(locationName);\n      if (!location) {\n        return '<div class=\"acu-map-loading\" style=\"grid-column: 1 / -1;\"><div class=\"acu-map-spinner\"></div></div>';\n      }\n\n      const characters = model.characters.get(locationName) || [];\n      const elements = model.elements.get(locationName) || [];\n\n      // \n      const leftChars = characters.slice(0, Math.ceil(characters.length / 2));\n      const rightChars = characters.slice(Math.ceil(characters.length / 2));\n      const leftElems = elements.slice(0, Math.ceil(elements.length / 2));\n      const rightElems = elements.slice(Math.ceil(elements.length / 2));\n\n      const renderAvatarHtml = char => {\n        const displayName = replaceUserPlaceholders(char.name);\n        const avatarStyle = char.avatarUrl\n          ? `background-image:url('${char.avatarUrl}');background-size:${char.avatarScale}%;background-position:${char.avatarOffsetX}% ${char.avatarOffsetY}%;`\n          : '';\n        return `\n            <div class=\"acu-map-avatar acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n              char.tableKey || '',\n            )}\" data-row-index=\"${char.rowIndex}\">\n                <div class=\"acu-map-avatar-circle\" style=\"${avatarStyle}\">\n                    ${char.avatarUrl ? '' : `<span>${escapeHtml(displayName.charAt(0))}</span>`}\n                </div>\n                <div class=\"acu-map-avatar-name\" title=\"${escapeHtml(displayName)}\">${escapeHtml(\n                  displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName,\n                )}</div>\n            </div>\n        `;\n      };\n\n      const leftAvatarsHtml = leftChars.length ? leftChars.map(renderAvatarHtml).join('') : '';\n      const rightAvatarsHtml = rightChars.length ? rightChars.map(renderAvatarHtml).join('') : '';\n      const leftElemsHtml = leftElems.length ? leftElems.map(e => renderElementChip(e)).join('') : '';\n      const rightElemsHtml = rightElems.length ? rightElems.map(e => renderElementChip(e)).join('') : '';\n\n      const emojiHtml = location.emoji\n        ? `<div class=\"acu-map-location-emoji\">${renderIconContent(location.emoji)}</div>`\n        : `<div class=\"acu-map-location-text\">${escapeHtml(location.name.charAt(0) || '')}</div>`;\n\n      return `\n        <div class=\"acu-map-wing left\">\n            <div class=\"acu-map-avatar-group acu-group-left\">${leftAvatarsHtml || ''}</div>\n            <div class=\"acu-map-element-group acu-group-left\">${leftElemsHtml || ''}</div>\n        </div>\n        <div class=\"acu-map-stage-center acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n          location.tableKey,\n        )}\" data-row-index=\"${location.rowIndex}\">\n            ${emojiHtml}\n            <div class=\"acu-map-location-name\" title=\"${escapeHtml(location.name)}\">${escapeHtml(location.name)}</div>\n        </div>\n        <div class=\"acu-map-wing right\">\n            <div class=\"acu-map-avatar-group acu-group-right\">${rightAvatarsHtml || ''}</div>\n            <div class=\"acu-map-element-group acu-group-right\">${rightElemsHtml || ''}</div>\n        </div>\n        <div class=\"acu-map-mobile-stack\">\n            <div class=\"acu-map-mobile-avatars\">${leftAvatarsHtml || ''}${rightAvatarsHtml || ''}</div>\n            <div class=\"acu-map-mobile-elements\">${leftElemsHtml || ''}${rightElemsHtml || ''}</div>\n        </div>\n    `;\n    };\n\n    const renderThumbnailLocation = (model, location, isActive) => {\n      const charCount = (model.characters.get(location.name) || []).length;\n      const elementCount = (model.elements.get(location.name) || []).length;\n      const totalCount = charCount + elementCount;\n      const emoji = location.emoji\n        ? `<div class=\"acu-map-thumbnail-emoji\">${renderIconContent(location.emoji)}</div>`\n        : `<div class=\"acu-map-thumbnail-placeholder\">${escapeHtml(location.name.charAt(0) || '')}</div>`;\n      const badgeHtml = totalCount > 0 ? `<div class=\"acu-map-thumbnail-badge\">${totalCount}</div>` : '';\n      return `\n        <div class=\"acu-map-thumbnail ${isActive ? 'active' : ''}\" data-location=\"${escapeHtml(location.name)}\">\n            ${badgeHtml}\n            ${emoji}\n            <div class=\"acu-map-thumbnail-name\" title=\"${escapeHtml(location.name)}\">${escapeHtml(\n              location.name.length > 6 ? location.name.substring(0, 6) + '..' : location.name,\n            )}</div>\n        </div>\n    `;\n    };\n\n    const renderRegionTabs = (regions, currentRegion) => {\n      if (regions.length <= 1) return '';\n      return regions\n        .map(\n          r =>\n            `<button class=\"acu-map-region-tab ${r === currentRegion ? 'active' : ''}\" data-region=\"${escapeHtml(\n              r,\n            )}\">${escapeHtml(r)}</button>`,\n        )\n        .join('');\n    };\n\n    const refreshPanel = () => {\n      $focusArea.html(renderFocusArea(viewModel, focusLocation));\n\n      const regionLocations = Array.from(viewModel.locations.values())\n        .filter(l => (l.region || '') === selectedRegion)\n        .sort((a, b) => {\n          // :  + \n          const scoreA =\n            (viewModel.characters.get(a.name)?.length || 0) + (viewModel.elements.get(a.name)?.length || 0);\n          const scoreB =\n            (viewModel.characters.get(b.name)?.length || 0) + (viewModel.elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n\n      const thumbnails = regionLocations\n        .map(location => renderThumbnailLocation(viewModel, location, location.name === focusLocation))\n        .join('');\n      $thumbnails.html(thumbnails || '<div class=\"acu-map-empty\"></div>');\n\n      overlay.find('.acu-map-region-tabs').html(renderRegionTabs(viewModel.allRegions, selectedRegion));\n    };\n\n    const setFocusLocation = name => {\n      if (!name) return;\n      focusLocation = name;\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      // \n      tabSelectionCache.set(selectedRegion, focusLocation);\n      refreshPanel();\n    };\n\n    refreshPanel();\n\n    // [] \n    overlay.data('refreshMapData', async () => {\n      const newViewModel = await buildMapViewModel();\n      if (newViewModel) {\n        viewModel = newViewModel;\n\n        // [] \n        if (!viewModel.locations.has(focusLocation)) {\n          // [] \n          const detailLocation = viewModel.detailLocation || '';\n          const playerLocation = viewModel.playerLocation || '';\n\n          let newFocus = '';\n          let newRegion = selectedRegion;\n\n          // 1: \n          const regionLocs = Array.from(viewModel.locations.values()).filter(\n            l => (l.region || '') === selectedRegion,\n          );\n          if (regionLocs.length > 0) {\n            newFocus = regionLocs[0].name;\n          } else if (detailLocation && viewModel.locations.has(detailLocation)) {\n            // 2: detailLocation\n            newFocus = detailLocation;\n            const loc = viewModel.locations.get(detailLocation);\n            newRegion = loc?.region || newRegion;\n          } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n            // 3: playerLocation\n            newFocus = playerLocation;\n            const loc = viewModel.locations.get(playerLocation);\n            newRegion = loc?.region || newRegion;\n          } else if (viewModel.focusLocation && viewModel.locations.has(viewModel.focusLocation)) {\n            // 4: focusLocation\n            newFocus = viewModel.focusLocation;\n            const loc = viewModel.locations.get(newFocus);\n            newRegion = loc?.region || newRegion;\n          } else {\n            // \n            const firstLoc = Array.from(viewModel.locations.values())[0];\n            if (firstLoc) {\n              newFocus = firstLoc.name;\n              newRegion = firstLoc.region || '';\n            }\n          }\n\n          if (newFocus) {\n            focusLocation = newFocus;\n            selectedRegion = newRegion;\n            // Store\n            Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n            // tab\n            tabSelectionCache.set(selectedRegion, focusLocation);\n          }\n        }\n\n        refreshPanel();\n      }\n    });\n\n    // [] \n    const $closeBtn = overlay.find('.acu-map-close');\n    $closeBtn.on('click', e => {\n      e.preventDefault();\n      e.stopPropagation();\n      e.stopImmediatePropagation();\n      overlay.remove();\n    });\n    overlay.on('click', '.acu-map-region-tab', function () {\n      const newRegion = $(this).data('region');\n      if (newRegion === selectedRegion) return;\n      selectedRegion = newRegion;\n\n      //  focusLocation \n      const regionLocations = Array.from(viewModel.locations.values()).filter(\n        l => (l.region || '') === selectedRegion,\n      );\n      const currentInNewRegion = regionLocations.find(l => l.name === focusLocation);\n\n      if (!currentInNewRegion && regionLocations.length > 0) {\n        // :  > \n        const cachedLocation = tabSelectionCache.get(selectedRegion);\n        const cachedInRegion = cachedLocation && regionLocations.find(l => l.name === cachedLocation);\n\n        if (cachedInRegion) {\n          // \n          focusLocation = cachedLocation;\n        } else {\n          // \n          const hotLocations = getHotLocationsInRegion(selectedRegion);\n          focusLocation = hotLocations.length > 0 ? hotLocations[0].name : regionLocations[0].name;\n        }\n        Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      }\n\n      refreshPanel();\n    });\n    setupOverlayClose(overlay, 'acu-map-overlay', () => {\n      overlay.remove();\n    });\n\n    overlay.on('click', '.acu-map-thumbnail', function () {\n      const locationName = $(this).data('location');\n      if (locationName) setFocusLocation(locationName);\n    });\n\n    overlay.on('click', '.acu-map-back-btn', () => {\n      const fallbackFocus = viewModel.focusLocation;\n      const detailLocation = viewModel.detailLocation || '';\n      const playerLocation = viewModel.playerLocation || '';\n\n      let target = '';\n      if (detailLocation && viewModel.locations.has(detailLocation)) {\n        target = detailLocation;\n      } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n        target = playerLocation;\n      } else if (fallbackFocus && viewModel.locations.has(fallbackFocus)) {\n        target = fallbackFocus;\n      }\n\n      if (!target) return;\n\n      // \n      const targetLocation = viewModel.locations.get(target);\n      const targetRegion = targetLocation?.region || viewModel.currentRegion || '';\n      if (targetRegion !== selectedRegion) {\n        selectedRegion = targetRegion;\n      }\n\n      focusLocation = target;\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      refreshPanel();\n    });\n\n    // \n    isMapOpening = false;\n\n    // \n    // \n  };\n\n  // \n  const showRelationshipGraph = npcTable => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n    $('.acu-relation-graph-overlay').remove();\n\n    const config = getConfig();\n\n    const headers = npcTable.headers || [];\n    const rows = npcTable.rows || [];\n\n    const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n    const relationIdx = headers.findIndex(h => h && h.includes(''));\n    const npcTableKey = npcTable.key || '';\n\n    console.info(`[DICE]: \"${npcTableKey || ''}\"${rows.length}`);\n\n    if (relationIdx < 0) {\n      console.warn('[DICE]: \"\"');\n      if (window.toastr) window.toastr.warning('\"\"');\n      return;\n    }\n\n    const nodes = new Map();\n    const edges = [];\n\n    // {{user}}\n    const resolveUserPlaceholder = name => {\n      if (!name) return name;\n      const playerName = getPlayerName();\n      const personaName = getPersonaName();\n\n      // \n      const diceCfg = getDiceConfig();\n      const explicitUserVariants = ['<user>', '{{user}}'];\n      if (diceCfg.autoMergeProtagonist !== false) {\n        explicitUserVariants.push('');\n      }\n      const isExplicitUserVariant = explicitUserVariants.some(\n        v => name === v || name.toLowerCase() === v.toLowerCase(),\n      );\n\n      // persona\n      const isPersonaName = personaName && name === personaName;\n\n      // \"\"\n      const isPlayerName = (() => {\n        if (!playerName) return false;\n        // \n        if (name === playerName) return true;\n        // \n        const primaryName = AvatarManager.getPrimaryName(name);\n        return primaryName === playerName;\n      })();\n\n      // {{user}}\n      if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n        return '{{user}}';\n      }\n\n      // \n      return AvatarManager.getPrimaryName(name);\n    };\n\n    const resolveName = name => resolveUserPlaceholder(name);\n\n    const rawData = cachedRawData || getTableData();\n    let playerName = '';\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]) {\n          playerName = sheet.content[1][1] || '';\n          break;\n        }\n      }\n    }\n    const resolvedPlayerName = resolveName(playerName);\n    const playerTableKey = (() => {\n      for (const k in rawData) {\n        if (rawData[k]?.name?.includes('')) return k;\n      }\n      return '';\n    })();\n    nodes.set(resolvedPlayerName, {\n      name: resolvedPlayerName,\n      isPlayer: true,\n      x: 0,\n      y: 0,\n      tableKey: playerTableKey,\n      rowIndex: 0,\n    });\n\n    // \"\"\n    const inSceneColIdx = headers.findIndex(h => h && h.includes(''));\n\n    rows.forEach((row, idx) => {\n      const rawNpcName = row[nameIdx];\n      if (!rawNpcName) return;\n\n      const npcName = resolveName(rawNpcName);\n\n      // \n      let isInScene = false;\n      if (inSceneColIdx > 0) {\n        const inSceneVal = String(row[inSceneColIdx] || '')\n          .trim()\n          .toLowerCase();\n        const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n        if (header.includes('')) {\n          isInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n        } else {\n          isInScene =\n            inSceneVal.startsWith('') || inSceneVal === 'true' || inSceneVal === '' || inSceneVal === 'yes';\n        }\n      }\n\n      if (!nodes.has(npcName)) {\n        nodes.set(npcName, {\n          name: npcName,\n          isPlayer: false,\n          x: 0,\n          y: 0,\n          tableKey: npcTableKey,\n          rowIndex: idx,\n          isInScene: isInScene,\n        });\n      }\n\n      const relationStr = row[relationIdx] || '';\n      const relations = parseRelationshipString(relationStr);\n\n      relations.forEach(rel => {\n        if (!rel.name) return;\n        const resolvedRelName = resolveName(rel.name);\n\n        if (resolvedRelName === npcName) return;\n\n        if (!nodes.has(resolvedRelName)) {\n          // NPC\n          let relRowIndex = -1;\n          let relIsInScene = false;\n          for (let ri = 0; ri < rows.length; ri++) {\n            if (resolveName(rows[ri][nameIdx]) === resolvedRelName) {\n              relRowIndex = ri;\n              // \n              if (inSceneColIdx > 0) {\n                const inSceneVal = String(rows[ri][inSceneColIdx] || '')\n                  .trim()\n                  .toLowerCase();\n                const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n                if (header.includes('')) {\n                  relIsInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n                } else {\n                  relIsInScene =\n                    inSceneVal.startsWith('') ||\n                    inSceneVal === 'true' ||\n                    inSceneVal === '' ||\n                    inSceneVal === 'yes';\n                }\n              }\n              break;\n            }\n          }\n          nodes.set(resolvedRelName, {\n            name: resolvedRelName,\n            isPlayer: resolvedRelName === resolvedPlayerName,\n            x: 0,\n            y: 0,\n            tableKey: relRowIndex >= 0 ? npcTableKey : '',\n            rowIndex: relRowIndex >= 0 ? relRowIndex : undefined,\n            isInScene: relIsInScene,\n          });\n        }\n\n        // /\n        const cleanRelation = rawRel => {\n          if (!rawRel) return [];\n          const parts = String(rawRel)\n            .split(/[,;\\/\\|]+|\\s*[&]\\s*|\\s{2,}|\\n/)\n            .map(s => s.trim())\n            .filter(s => s && s.length < 30); // \n\n          // \n          const commonRelations = [\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n          ];\n\n          return parts\n            .map(p => {\n              // [] \n              p = p.replace(/[(][^)]*[)]/g, '').trim();\n              // === XX/  XX ===\n              const specialSuffixMatch = p.match(/^(.+)(|)$/);\n              if (specialSuffixMatch) {\n                p = specialSuffixMatch[1]; // \"\"  \"\"\n              } else {\n                // === XXYY  YY ===\n                p = p.replace(/^[\\u4e00-\\u9fa5]{2,4}(?=[\\u4e00-\\u9fa5]{1,4}$)/, '');\n              }\n\n              // ===  ===\n              p = p.replace(/^(?:|||?|?|)/, '');\n              p = p.replace(/^(?:?|?|?|)/, '');\n              p = p.replace(/^(?:|?|?)/, '');\n\n              // ===  ===\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n\n              // ===  ===\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^(?:||?)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n\n              p = p.trim();\n\n              // === []  ===\n              if (p.length > 8) {\n                // \n                for (const rel of commonRelations) {\n                  if (p.endsWith(rel)) {\n                    return rel;\n                  }\n                }\n                // 2-4\n                const lastChars = p.slice(-4);\n                for (const rel of commonRelations) {\n                  if (lastChars.includes(rel)) {\n                    return rel;\n                  }\n                }\n                // 3\n                return p.slice(-3);\n              }\n\n              return p;\n            })\n            .filter(s => s && s.length > 0 && s.length <= 8);\n        };\n\n        const cleanedLabels = cleanRelation(rel.relation);\n        if (cleanedLabels.length === 0) cleanedLabels.push('');\n\n        // \n        let existingEdge = edges.find(\n          e =>\n            (e.source === npcName && e.target === resolvedRelName) ||\n            (e.source === resolvedRelName && e.target === npcName),\n        );\n\n        if (!existingEdge) {\n          // \n          edges.push({\n            source: npcName,\n            target: resolvedRelName,\n            // \n            labelsFromSource: cleanedLabels.slice(0, 2), // sourcetarget 2\n            labelsFromTarget: [], // targetsource \n          });\n        } else {\n          // \n          if (existingEdge.source === npcName) {\n            // npcsource labelsFromSource\n            const combined = [...(existingEdge.labelsFromSource || []), ...cleanedLabels];\n            // 2\n            existingEdge.labelsFromSource = [...new Set(combined)].slice(0, 2);\n          } else {\n            // npctarget labelsFromTarget\n            const combined = [...(existingEdge.labelsFromTarget || []), ...cleanedLabels];\n            existingEdge.labelsFromTarget = [...new Set(combined)].slice(0, 2);\n          }\n        }\n      });\n    });\n\n    const nodeArr = Array.from(nodes.values());\n    console.info(`[DICE]${nodeArr.length}${edges.length}`);\n    const centerX = 400,\n      centerY = 300;\n\n    // [] \n    const connectionCount = new Map();\n    nodeArr.forEach(node => connectionCount.set(node.name, 0));\n    edges.forEach(edge => {\n      connectionCount.set(edge.source, (connectionCount.get(edge.source) || 0) + 1);\n      connectionCount.set(edge.target, (connectionCount.get(edge.target) || 0) + 1);\n    });\n\n    // [] \n    const isMobileView = window.innerWidth <= 768;\n    const baseRadius = isMobileView ? 22 : 28;\n    const maxRadius = isMobileView ? 38 : 50;\n    const playerBaseRadius = isMobileView ? 28 : 35;\n    const radiusPerConnection = isMobileView ? 2.5 : 3.5;\n\n    //  getNodeRadius \n    let nodeSizeMultiplier = 1.0; // 1.0\n    let filterInScene = false; // +\n    let filterDirectOnly = false; // \n\n    const getNodeRadius = (nodeName, isPlayer) => {\n      const base = isPlayer ? playerBaseRadius : baseRadius;\n      const count = connectionCount.get(nodeName) || 0;\n      const calculated = Math.min(maxRadius, base + Math.sqrt(count) * radiusPerConnection);\n      // \n      return calculated * nodeSizeMultiplier;\n    };\n\n    // \n    nodeArr.forEach(node => {\n      node.radius = getNodeRadius(node.name, node.isPlayer);\n    });\n\n    // \n    const getFilteredNodes = () => {\n      // \n      if (!filterInScene && !filterDirectOnly) return nodeArr;\n\n      // \n      let directNodes: Set<string> | null = null;\n      if (filterDirectOnly) {\n        directNodes = new Set([resolvedPlayerName]);\n        edges.forEach(edge => {\n          if (edge.source === resolvedPlayerName) directNodes!.add(edge.target);\n          if (edge.target === resolvedPlayerName) directNodes!.add(edge.source);\n        });\n      }\n\n      return nodeArr.filter(n => {\n        // \n        const passInScene = !filterInScene || n.isInScene || n.isPlayer;\n        // \n        const passDirectOnly = !filterDirectOnly || directNodes!.has(n.name);\n        // \n        return passInScene && passDirectOnly;\n      });\n    };\n\n    // [Modified] \n    // ---------------------------------------------------------\n    //  ()\n    const kRepulsion = 20000; //  () - \n    const kSpring = 0.02; //  () - \n    const kGravity = 0.01; //  - \n    const idealLen = 250; //  - \n    const iterations = 300; // \n    const timeStep = 0.5; // \n    const damping = 0.8; //  ()\n\n    // \n    const LAYOUT_CACHE_KEY = 'acu-relation-graph-layout-cache';\n\n    // \n    const getLayoutCacheKey = () => {\n      const nodeNames = nodeArr\n        .map(n => n.name)\n        .sort()\n        .join('|');\n      return `${LAYOUT_CACHE_KEY}-${nodeNames}`;\n    };\n\n    // \n    const saveLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const layoutData = {};\n        nodeArr.forEach(node => {\n          layoutData[node.name] = { x: node.x, y: node.y };\n        });\n        localStorage.setItem(cacheKey, JSON.stringify(layoutData));\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const loadLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const cached = localStorage.getItem(cacheKey);\n        if (!cached) return false;\n\n        const layoutData = JSON.parse(cached);\n        let allNodesFound = true;\n\n        // \n        for (const node of nodeArr) {\n          if (!layoutData[node.name]) {\n            allNodesFound = false;\n            break;\n          }\n        }\n\n        if (allNodesFound) {\n          // \n          nodeArr.forEach(node => {\n            const cached = layoutData[node.name];\n            if (cached) {\n              node.x = cached.x;\n              node.y = cached.y;\n              node.vx = 0;\n              node.vy = 0;\n            }\n          });\n          return true;\n        }\n        return false;\n      } catch (e) {\n        console.warn('[DICE] :', e);\n        return false;\n      }\n    };\n\n    // \n    const clearLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        localStorage.removeItem(cacheKey);\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const runForceDirectedLayout = () => {\n      // \n      nodeArr.forEach(node => {\n        if (node.isPlayer) {\n          node.x = centerX;\n          node.y = centerY;\n          node.vx = 0;\n          node.vy = 0;\n        } else {\n          //  100px \n          const angle = Math.random() * 2 * Math.PI;\n          const dist = 50 + Math.random() * 100;\n          node.x = centerX + Math.cos(angle) * dist;\n          node.y = centerY + Math.sin(angle) * dist;\n          node.vx = 0;\n          node.vy = 0;\n        }\n      });\n\n      //  O(1) \n      const nodeMap = new Map();\n      nodeArr.forEach(n => nodeMap.set(n.name, n));\n\n      //  ()\n      for (let iter = 0; iter < iterations; iter++) {\n        // 1.  ( vs )\n        for (let i = 0; i < nodeArr.length; i++) {\n          const u = nodeArr[i];\n          for (let j = i + 1; j < nodeArr.length; j++) {\n            const v = nodeArr[j];\n            const dx = v.x - u.x;\n            const dy = v.y - u.y;\n            let distSq = dx * dx + dy * dy;\n            if (distSq < 1) distSq = 1; // \n\n            const dist = Math.sqrt(distSq);\n            const force = kRepulsion / distSq;\n\n            const fx = (dx / dist) * force;\n            const fy = (dy / dist) * force;\n\n            if (!u.isPlayer) {\n              u.vx -= fx;\n              u.vy -= fy;\n            }\n            if (!v.isPlayer) {\n              v.vx += fx;\n              v.vy += fy;\n            }\n          }\n        }\n\n        // 2.  ()\n        edges.forEach(edge => {\n          const u = nodeMap.get(edge.source);\n          const v = nodeMap.get(edge.target);\n          if (!u || !v) return;\n\n          const dx = v.x - u.x;\n          const dy = v.y - u.y;\n          const dist = Math.sqrt(dx * dx + dy * dy) || 1;\n\n          // : F = k * ( - )\n          const force = (dist - idealLen) * kSpring;\n\n          const fx = (dx / dist) * force;\n          const fy = (dy / dist) * force;\n\n          if (!u.isPlayer) {\n            u.vx += fx;\n            u.vy += fy;\n          }\n          if (!v.isPlayer) {\n            v.vx -= fx;\n            v.vy -= fy;\n          }\n        });\n\n        // 3.  ()\n        nodeArr.forEach(node => {\n          if (node.isPlayer) return;\n          const dx = centerX - node.x;\n          const dy = centerY - node.y;\n          node.vx += dx * kGravity;\n          node.vy += dy * kGravity;\n        });\n\n        // 4. \n        // \n        const maxSpeed = 50 * (1 - iter / iterations); // \n\n        nodeArr.forEach(node => {\n          if (node.isPlayer) return; //  ()\n\n          // \n          node.vx *= damping;\n          node.vy *= damping;\n\n          // \n          const vMag = Math.sqrt(node.vx * node.vx + node.vy * node.vy);\n          if (vMag > maxSpeed) {\n            node.vx = (node.vx / vMag) * maxSpeed;\n            node.vy = (node.vy / vMag) * maxSpeed;\n          }\n\n          node.x += node.vx * timeStep;\n          node.y += node.vy * timeStep;\n        });\n      }\n\n      // \n      saveLayoutCache();\n    };\n\n    // \n    if (!loadLayoutCache()) {\n      // \n      runForceDirectedLayout();\n    }\n\n    // \n    let scale = 1;\n    let panX = 0;\n    let panY = 0;\n    const minScale = 0.3;\n    const maxScale = 4;\n\n    const overlay = $(`\n            <div class=\"acu-relation-graph-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-relation-graph-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-graph-title\">\n                            <i class=\"fa-solid fa-project-diagram\"></i>\n                            <button class=\"acu-graph-btn acu-filter-toggle acu-graph-filter-btn ml-8\" id=\"filter-in-scene\" title=\"\"><i class=\"fa-solid fa-map-marker-alt\"></i></button>\n                            <button class=\"acu-graph-btn acu-filter-toggle acu-graph-filter-btn\" id=\"filter-direct-only\" title=\"\"><i class=\"fa-solid fa-link\"></i></button>\n                        </div>\n                        <div class=\"acu-graph-actions\">\n                            <button class=\"acu-graph-btn\" id=\"graph-relayout\" title=\"\"><i class=\"fa-solid fa-sync\"></i></button>\n                            <button class=\"acu-graph-btn\" id=\"graph-manage-avatar\" title=\"\"><i class=\"fa-solid fa-user-circle\"></i></button>\n                            <button class=\"acu-graph-btn acu-graph-close\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-canvas-wrapper\">\n                        <svg class=\"acu-graph-svg\" viewBox=\"0 0 800 600\">\n                            <defs>\n                                <marker id=\"arrowhead-end\" markerWidth=\"6\" markerHeight=\"5\" refX=\"5\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 6 2.5, 0 5\" />\n                                </marker>\n                                <marker id=\"arrowhead-start\" markerWidth=\"6\" markerHeight=\"5\" refX=\"1\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"6 0, 0 2.5, 6 5\" />\n                                </marker>\n                                <marker id=\"arrowhead-end-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"6\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 7 3, 0 6\" />\n                                </marker>\n                                <marker id=\"arrowhead-start-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"1\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"7 0, 0 3, 7 6\" />\n                                </marker>\n                            </defs>\n                            <g class=\"acu-graph-transform\">\n                                <g class=\"acu-graph-edges\"></g>\n                                <g class=\"acu-graph-nodes\"></g>\n                            </g>\n                        </svg>\n                        <div class=\"acu-node-size-slider-container\">\n                            <div class=\"acu-slider-header\">\n                                <span class=\"acu-slider-label\"></span>\n                                <span id=\"slider-size-display\" class=\"acu-slider-value\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                            </div>\n                            <input type=\"range\" id=\"node-size-slider\" min=\"0.5\" max=\"2.0\" step=\"0.1\" value=\"${nodeSizeMultiplier}\" class=\"acu-range-input\" />\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-legend\">\n                        <button class=\"acu-graph-btn acu-graph-reset-btn\" id=\"graph-zoom-reset\" title=\"\"><i class=\"fa-solid fa-compress-arrows-alt\"></i><span></span></button>\n                        <div class=\"acu-node-size-stepper-wrapper acu-node-size-wrapper\">\n                            <span style=\"font-size:11px;color:var(--acu-text-sub);white-space:nowrap;\">:</span>\n                            <div class=\"acu-stepper acu-stepper-container\" data-id=\"graph-node-size\" data-min=\"50\" data-max=\"200\" data-step=\"10\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value acu-stepper-value-display\" id=\"node-size-display\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <span class=\"acu-zoom-display acu-zoom-info\">\n                            <span>:</span>\n                            <span>${Math.round(scale * 100)}%</span>\n                        </span>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const $svg = overlay.find('.acu-graph-svg');\n    const $transform = overlay.find('.acu-graph-transform');\n    const $edgesGroup = overlay.find('.acu-graph-edges');\n    const $nodesGroup = overlay.find('.acu-graph-nodes');\n    const $zoomDisplay = overlay.find('.acu-zoom-display span:last-child');\n    const $nodeSizeDisplay = overlay.find('#node-size-display');\n    const $wrapper = overlay.find('.acu-graph-canvas-wrapper');\n\n    const updateTransform = () => {\n      $transform.attr('transform', `translate(${panX}, ${panY}) scale(${scale})`);\n      $zoomDisplay.text(`${Math.round(scale * 100)}%`);\n    };\n\n    const updateNodeSizeDisplay = () => {\n      if ($nodeSizeDisplay.length) {\n        $nodeSizeDisplay.text(`${Math.round(nodeSizeMultiplier * 100)}%`);\n      }\n    };\n\n    const zoomTo = (newScale, centerX = 400, centerY = 300) => {\n      const oldScale = scale;\n      scale = Math.max(minScale, Math.min(maxScale, newScale));\n      const scaleChange = scale / oldScale;\n      panX = centerX - (centerX - panX) * scaleChange;\n      panY = centerY - (centerY - panY) * scaleChange;\n      updateTransform();\n    };\n\n    const render = async () => {\n      // \n      const filteredNodes = getFilteredNodes();\n      const filteredNodeNames = new Set(filteredNodes.map(n => n.name));\n\n      // \n      const filteredEdges = edges.filter(\n        edge => filteredNodeNames.has(edge.source) && filteredNodeNames.has(edge.target),\n      );\n\n      let edgesHtml = '';\n      filteredEdges.forEach((edge, edgeIdx) => {\n        const source = nodes.get(edge.source);\n        const target = nodes.get(edge.target);\n        if (!source || !target) return;\n\n        // \n        const dx = target.x - source.x;\n        const dy = target.y - source.y;\n        const len = Math.sqrt(dx * dx + dy * dy) || 1;\n        const nx = dx / len; // \n        const ny = dy / len;\n\n        // \n        const px = -ny;\n        const py = nx;\n\n        // \n        const hasFromSource =\n          edge.labelsFromSource && edge.labelsFromSource.length > 0 && edge.labelsFromSource.some(l => l);\n        const hasFromTarget =\n          edge.labelsFromTarget && edge.labelsFromTarget.length > 0 && edge.labelsFromTarget.some(l => l);\n\n        // \n        const sourceRadius = source.radius || 28;\n        const targetRadius = target.radius || 28;\n        const arrowGap = 10; // \n        const x1 = source.x + nx * (sourceRadius + arrowGap);\n        const y1 = source.y + ny * (sourceRadius + arrowGap);\n        const x2 = target.x - nx * (targetRadius + arrowGap);\n        const y2 = target.y - ny * (targetRadius + arrowGap);\n\n        // \n        let srcLabels = (edge.labelsFromSource || []).filter(l => l);\n        let tgtLabels = (edge.labelsFromTarget || []).filter(l => l);\n\n        // \n        const srcSet = new Set(srcLabels);\n        const tgtSet = new Set(tgtLabels);\n        const commonLabels = [...srcSet].filter(l => tgtSet.has(l));\n\n        // \n        const srcUnique = srcLabels.filter(l => !commonLabels.includes(l));\n        const tgtUnique = tgtLabels.filter(l => !commonLabels.includes(l));\n\n        // \n        let markerStart = '';\n        let markerEnd = '';\n        if (hasFromSource) markerEnd = 'url(#arrowhead-end)';\n        if (hasFromTarget) markerStart = 'url(#arrowhead-start)';\n\n        edgesHtml += `<line class=\"acu-graph-edge\" x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                    ${markerEnd ? `marker-end=\"${markerEnd}\"` : ''}\n                    ${markerStart ? `marker-start=\"${markerStart}\"` : ''}\n                    data-edge-idx=\"${edgeIdx}\" />`;\n\n        // \n        const midX = (source.x + target.x) / 2;\n        const midY = (source.y + target.y) / 2;\n\n        // \n        const lineLen = Math.sqrt(dx * dx + dy * dy);\n\n        // \"\"\n        const isBidirectional = hasFromSource && hasFromTarget;\n        const isBidirectionalSame =\n          isBidirectional && commonLabels.length > 0 && srcUnique.length === 0 && tgtUnique.length === 0;\n\n        // \n        if (isBidirectionalSame) {\n          // \n          // []  renderRelationIcon  addRelationIcon \n          const renderRelationIconInline = (iconStr: string): string => {\n            if (iconStr.startsWith('fa:')) {\n              return `<i class=\"fa-solid fa-${iconStr.slice(3)}\" style=\"font-size:10px;margin-left:2px;opacity:0.8;\"></i>`;\n            } else if (iconStr.startsWith('ti:')) {\n              return `<i class=\"ti ti-${iconStr.slice(3)}\" style=\"font-size:10px;margin-left:2px;opacity:0.8;\"></i>`;\n            }\n            return iconStr;\n          };\n\n          const addRelationIconInline = (lbl: string): string => {\n            if (!lbl) return '';\n            for (const group of RELATION_ICON_MAP) {\n              for (const kw of group.keywords) {\n                if (lbl.includes(kw)) {\n                  return lbl + renderRelationIconInline(group.icon);\n                }\n              }\n            }\n            return lbl;\n          };\n\n          commonLabels.slice(0, 2).forEach((lbl, i) => {\n            if (!lbl) return;\n            const offsetDir = i === 0 ? 1 : -1;\n            const offsetDist = 6 + i * 10;\n            const lx = midX + px * offsetDir * offsetDist;\n            const ly = midY + py * offsetDir * offsetDist;\n            // [] \n            const content = addRelationIconInline(lbl);\n            if (content.includes('<i ')) {\n              // foreignObjectHTML\n              edgesHtml += `<foreignObject x=\"${lx - 50}\" y=\"${ly - 10}\" width=\"100\" height=\"20\" style=\"overflow:visible;\">\n                <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"acu-graph-edge-label-html\" data-edge-idx=\"${edgeIdx}\" style=\"\n                  display:flex;align-items:center;justify-content:center;\n                  font-size:11px;color:var(--acu-text-sub);white-space:nowrap;\n                  pointer-events:none;\n                \">${content}</div>\n              </foreignObject>`;\n            } else {\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(lbl)}</text>`;\n            }\n          });\n        } else {\n          // \n          // source/target\n          // 25%\n          const safeOffset = Math.max(30, Math.min(lineLen * 0.25, 60));\n\n          // HTML\n          const renderRelationIcon = (iconStr: string): string => {\n            if (iconStr.startsWith('fa:')) {\n              return `<i class=\"fa-solid fa-${iconStr.slice(3)}\" style=\"font-size:10px;margin-left:2px;opacity:0.8;\"></i>`;\n            } else if (iconStr.startsWith('ti:')) {\n              return `<i class=\"ti ti-${iconStr.slice(3)}\" style=\"font-size:10px;margin-left:2px;opacity:0.8;\"></i>`;\n            }\n            return iconStr;\n          };\n\n          // \n          const addRelationIcon = (lbl: string): string => {\n            if (!lbl) return '';\n            for (const group of RELATION_ICON_MAP) {\n              for (const kw of group.keywords) {\n                if (lbl.includes(kw)) {\n                  return lbl + renderRelationIcon(group.icon);\n                }\n              }\n            }\n            return lbl;\n          };\n\n          // \n          const truncateLabel = (lbl: string, maxLen = 4): string => {\n            if (!lbl) return '';\n            const truncated = lbl.length > maxLen ? lbl.substring(0, maxLen) + '..' : lbl;\n            return addRelationIcon(truncated);\n          };\n\n          // HTMLforeignObjectHTML\n          const createLabelHtml = (lbl: string, x: number, y: number, edgeIdx: number, maxLen = 5): string => {\n            const content = truncateLabel(lbl, maxLen);\n            // HTML\n            if (content.includes('<i ')) {\n              // foreignObjectHTML\n              return `<foreignObject x=\"${x - 50}\" y=\"${y - 10}\" width=\"100\" height=\"20\" style=\"overflow:visible;\">\n                <div xmlns=\"http://www.w3.org/1999/xhtml\" class=\"acu-graph-edge-label-html\" data-edge-idx=\"${edgeIdx}\" style=\"\n                  display:flex;align-items:center;justify-content:center;\n                  font-size:11px;color:var(--acu-text-sub);white-space:nowrap;\n                  pointer-events:none;\n                \">${content}</div>\n              </foreignObject>`;\n            }\n            // text\n            return `<text class=\"acu-graph-edge-label\" x=\"${x}\" y=\"${y}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(content)}</text>`;\n          };\n\n          // 1. \n          if (commonLabels.length > 0) {\n            commonLabels.slice(0, 1).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const lx = midX + px * 8;\n              const ly = midY + py * 8 - 3;\n              edgesHtml += createLabelHtml(lbl, lx, ly, edgeIdx, 5);\n            });\n          }\n\n          // 2. Sourcesource\n          if (srcUnique.length > 0 || (hasFromSource && !hasFromTarget && commonLabels.length === 0)) {\n            const labelsToShow = srcUnique.length > 0 ? srcUnique : srcLabels;\n            // source\n            const labelBaseX = midX - nx * safeOffset;\n            const labelBaseY = midY - ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? 1 : -1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += createLabelHtml(lbl, lx, ly, edgeIdx, 5);\n            });\n          }\n\n          // 3. Targettarget\n          if (tgtUnique.length > 0 || (hasFromTarget && !hasFromSource && commonLabels.length === 0)) {\n            const labelsToShow = tgtUnique.length > 0 ? tgtUnique : tgtLabels;\n            // target\n            const labelBaseX = midX + nx * safeOffset;\n            const labelBaseY = midY + ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? -1 : 1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += createLabelHtml(lbl, lx, ly, edgeIdx, 5);\n            });\n          }\n        }\n      });\n      $edgesGroup.html(edgesHtml);\n\n      // [] \n      let nodesHtml = '';\n      for (const node of filteredNodes) {\n        //  > URL > ST\n        const nodeAvatar = await AvatarManager.getAsync(node.name);\n        const isPlayer = node.isPlayer;\n\n        // Discord\n        const indicatorRadius = node.radius * 0.22;\n        const indicatorOffset = node.radius * 0.62;\n        const inSceneIndicator = node.isInScene\n          ? `<circle class=\"acu-node-inscene-indicator\" cx=\"${indicatorOffset}\" cy=\"${indicatorOffset}\" r=\"${indicatorRadius}\" style=\"fill:var(--acu-accent);stroke:var(--acu-bg-panel);stroke-width:3;\" />`\n          : '';\n\n        const nodeDisplayName = replaceUserPlaceholders(node.name);\n        nodesHtml += `\n                <g class=\"acu-graph-node acu-dash-preview-trigger\" data-name=\"${escapeHtml(node.name)}\" data-table-key=\"${node.tableKey || ''}\" data-row-index=\"${node.rowIndex !== undefined ? node.rowIndex : ''}\" transform=\"translate(${node.x}, ${node.y})\">\n                    <circle class=\"acu-node-bg\" r=\"${node.radius}\" />\n                    ${\n                      nodeAvatar\n                        ? (() => {\n                            const offsetX = AvatarManager.getOffsetX(node.name);\n                            const offsetY = AvatarManager.getOffsetY(node.name);\n                            const scaleVal = AvatarManager.getScale(node.name);\n                            const size = (node.radius - 2) * 2;\n                            const shadowWidth = 4; // box-shadow\n                            const foSize = size + shadowWidth * 2;\n                            const foOffset = foSize / 2;\n                            return `<foreignObject x=\"${-foOffset}\" y=\"${-foOffset}\" width=\"${foSize}\" height=\"${foSize}\">\n                            <div class=\"acu-node-avatar\" xmlns=\"http://www.w3.org/1999/xhtml\" style=\"\n                                width: ${size}px;\n                                height: ${size}px;\n                                margin: ${shadowWidth}px;\n                                border-radius: 50%;\n                                background-image: url('${nodeAvatar}');\n                                background-size: ${scaleVal}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                                background-repeat: no-repeat;\n                            \"></div>\n                        </foreignObject>`;\n                          })()\n                        : `<text class=\"acu-node-char\" dy=\"0.35em\">${escapeHtml(nodeDisplayName.charAt(0))}</text>`\n                    }\n                    ${inSceneIndicator}\n                    <text class=\"acu-node-label\" dy=\"${node.radius + 14}\">${escapeHtml(nodeDisplayName)}</text>\n                </g>\n            `;\n      }\n      $nodesGroup.html(nodesHtml);\n    };\n\n    // [] \n    const highlightNode = nodeName => {\n      $svg.addClass('highlighting');\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if ($(this).data('name') === nodeName) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedNodes = new Set([nodeName]);\n\n      // \n      edges.forEach(edge => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          const otherNode = edge.source === nodeName ? edge.target : edge.source;\n          connectedNodes.add(otherNode);\n        }\n      });\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if (connectedNodes.has($(this).data('name'))) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedEdgeIndices = new Set();\n      edges.forEach((edge, idx) => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          connectedEdgeIndices.add(idx);\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n          if ($(this).attr('marker-end')) {\n            $(this).attr('marker-end', 'url(#arrowhead-end-hl)');\n          }\n          if ($(this).attr('marker-start')) {\n            $(this).attr('marker-start', 'url(#arrowhead-start-hl)');\n          }\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge-label').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n        }\n      });\n    };\n\n    const clearHighlight = () => {\n      $svg.removeClass('highlighting');\n      $nodesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        if ($(this).attr('marker-end')) {\n          $(this).attr('marker-end', 'url(#arrowhead-end)');\n        }\n        if ($(this).attr('marker-start')) {\n          $(this).attr('marker-start', 'url(#arrowhead-start)');\n        }\n      });\n    };\n\n    // []  - PC +  + \n    // pointerfine()coarse()\n    const hasFinePointer = window.matchMedia('(pointer: fine)').matches;\n    const isTouchDevice = !hasFinePointer;\n\n    // \n    let currentHighlightedNode = null; // \n    let longPressTimer = null;\n\n    if (isTouchDevice) {\n      // ==========  ==========\n      let currentHighlightedNode = null;\n\n      $nodesGroup.on('pointerdown', '.acu-graph-node', function (e) {\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        const startX = e.clientX;\n        const startY = e.clientY;\n        const startTime = Date.now();\n        let hasMoved = false;\n        let longPressTriggered = false;\n\n        // \n        if (currentHighlightedNode) {\n          clearHighlight();\n          currentHighlightedNode = null;\n          // return\n          e.preventDefault();\n          e.stopPropagation();\n          return;\n        }\n\n        // \n        const longPressTimer = setTimeout(() => {\n          if (!hasMoved && nodeName) {\n            longPressTriggered = true;\n            currentHighlightedNode = nodeName;\n            highlightNode(nodeName);\n            if (navigator.vibrate) navigator.vibrate(30);\n          }\n        }, 300);\n\n        const onMove = moveE => {\n          const dx = Math.abs(moveE.clientX - startX);\n          const dy = Math.abs(moveE.clientY - startY);\n          if (dx > 8 || dy > 8) {\n            hasMoved = true;\n            clearTimeout(longPressTimer);\n          }\n        };\n\n        const onUp = () => {\n          $(document).off('pointermove.mobilenode pointerup.mobilenode pointercancel.mobilenode');\n          clearTimeout(longPressTimer);\n\n          const elapsed = Date.now() - startTime;\n\n          //   \n          if (longPressTriggered) {\n            return;\n          }\n\n          //   \n          if (hasMoved) {\n            return;\n          }\n\n          // <300ms  \n          if (elapsed < 300) {\n            const nodeName = $node.data('name');\n            // \n            const primaryName = AvatarManager.getPrimaryName(nodeName);\n            const tableKey = $node.data('table-key');\n            let rowIndex = $node.data('row-index');\n\n            // tableKey\n            if (!tableKey || rowIndex === '' || rowIndex === undefined) {\n              // NPC\n              const rawData = cachedRawData || getTableData();\n              if (rawData) {\n                for (const key in rawData) {\n                  const table = rawData[key];\n                  if (!table?.content || !table.name?.includes('NPC')) continue;\n                  const headers = table.content[0] || [];\n                  const nameIdx = headers.findIndex(\n                    h => h && (h.includes('') || h.includes('') || h.includes('')),\n                  );\n                  if (nameIdx < 0) continue;\n                  for (let i = 1; i < table.content.length; i++) {\n                    const rowName = String(table.content[i][nameIdx] || '').trim();\n                    if (rowName === primaryName || AvatarManager.getPrimaryName(rowName) === primaryName) {\n                      // \n                      const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n                        .data('table-key', key)\n                        .data('row-index', i - 1);\n                      $('body').append(tempNode);\n                      tempNode.trigger('click.acu_dash_preview');\n                      tempNode.remove();\n                      return;\n                    }\n                  }\n                }\n              }\n              // \n              if (window.toastr) {\n                window.toastr.info(`${primaryName}`, '', { timeOut: 2000 });\n              }\n              return;\n            }\n\n            // tableKey\n            const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n              .data('table-key', tableKey)\n              .data('row-index', parseInt(rowIndex, 10));\n            $('body').append(tempNode);\n            tempNode.trigger('click.acu_dash_preview');\n            tempNode.remove();\n          }\n        };\n\n        $(document).on('pointermove.mobilenode', onMove);\n        $(document).on('pointerup.mobilenode pointercancel.mobilenode', onUp);\n      });\n\n      // \n      $wrapper.on('pointerup.mobileclear', function (e) {\n        if (currentHighlightedNode && !$(e.target).closest('.acu-graph-node').length) {\n          clearHighlight();\n          currentHighlightedNode = null;\n        }\n      });\n    } else {\n      // ========== PC ==========\n\n      $nodesGroup.on('pointerenter.pchover', '.acu-graph-node', function () {\n        const nodeName = $(this).data('name');\n        if (nodeName) {\n          highlightNode(nodeName);\n        }\n      });\n\n      $nodesGroup.on('pointerleave.pchover', '.acu-graph-node', function () {\n        clearHighlight();\n      });\n\n      // PC\n      $nodesGroup.on('click.pcclick', '.acu-graph-node', function (e) {\n        e.stopPropagation();\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        // \n        const primaryName = AvatarManager.getPrimaryName(nodeName);\n        const tableKey = $node.data('table-key');\n        let rowIndex = $node.data('row-index');\n\n        // tableKey\n        if (!tableKey || rowIndex === '' || rowIndex === undefined) {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            for (const key in rawData) {\n              const table = rawData[key];\n              if (!table?.content || !table.name?.includes('NPC')) continue;\n              const headers = table.content[0] || [];\n              const nameIdx = headers.findIndex(\n                h => h && (h.includes('') || h.includes('') || h.includes('')),\n              );\n              if (nameIdx < 0) continue;\n              for (let i = 1; i < table.content.length; i++) {\n                const rowName = String(table.content[i][nameIdx] || '').trim();\n                if (rowName === primaryName || AvatarManager.getPrimaryName(rowName) === primaryName) {\n                  const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n                    .data('table-key', key)\n                    .data('row-index', i - 1);\n                  $('body').append(tempNode);\n                  tempNode.trigger('click.acu_dash_preview');\n                  tempNode.remove();\n                  return;\n                }\n              }\n            }\n          }\n          if (window.toastr) {\n            window.toastr.info(`${primaryName}`, '', { timeOut: 2000 });\n          }\n          return;\n        }\n\n        // tableKey\n        const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n          .data('table-key', tableKey)\n          .data('row-index', parseInt(rowIndex, 10));\n        $('body').append(tempNode);\n        tempNode.trigger('click.acu_dash_preview');\n        tempNode.remove();\n      });\n    }\n\n    // \n    render().then(() => {\n      updateTransform();\n    });\n\n    //  -  Pointer Events API\n    let isPanning = false;\n    let panStartX = 0,\n      panStartY = 0;\n    let panStartPanX = 0,\n      panStartPanY = 0;\n    let lastPinchDist = 0;\n    let activePointerId = null;\n\n    const wrapperEl = $wrapper[0];\n    const svgEl = $svg[0];\n\n    // Pointer Down - \n    wrapperEl.onpointerdown = function (e) {\n      if (e.button !== 0) return;\n      // [] \n      if ($(e.target).closest('.acu-graph-node').length) return;\n      // [] \n      if ($(e.target).closest('.acu-node-size-slider-container').length) return;\n      e.preventDefault();\n      wrapperEl.setPointerCapture(e.pointerId);\n      activePointerId = e.pointerId;\n      isPanning = true;\n      panStartX = e.clientX;\n      panStartY = e.clientY;\n      panStartPanX = panX;\n      panStartPanY = panY;\n      svgEl.style.cursor = 'grabbing';\n    };\n\n    // Pointer Move - \n    wrapperEl.onpointermove = function (e) {\n      if (!isPanning || e.pointerId !== activePointerId) return;\n      const dx = e.clientX - panStartX;\n      const dy = e.clientY - panStartY;\n      const rect = svgEl.getBoundingClientRect();\n      panX = panStartPanX + (dx / rect.width) * 800;\n      panY = panStartPanY + (dy / rect.height) * 600;\n      updateTransform();\n    };\n\n    // Pointer Up - \n    wrapperEl.onpointerup = function (e) {\n      if (e.pointerId === activePointerId) {\n        wrapperEl.releasePointerCapture(e.pointerId);\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // Pointer Cancel - \n    wrapperEl.onpointercancel = function (e) {\n      if (e.pointerId === activePointerId) {\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // \n    wrapperEl.onwheel = function (e) {\n      e.preventDefault();\n      const delta = e.deltaY > 0 ? -0.15 : 0.15;\n      zoomTo(scale + delta);\n    };\n\n    // \n    wrapperEl.addEventListener(\n      'touchstart',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          isPanning = false;\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener(\n      'touchmove',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            zoomTo(scale * (newDist / lastPinchDist));\n          }\n          lastPinchDist = newDist;\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener('touchend', function (e) {\n      if (e.touches.length < 2) lastPinchDist = 0;\n    });\n\n    // \n    const cleanupEvents = () => {\n      wrapperEl.onpointerdown = null;\n      wrapperEl.onpointermove = null;\n      wrapperEl.onpointerup = null;\n      wrapperEl.onpointercancel = null;\n      wrapperEl.onwheel = null;\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n      $(document).off('click.slider-hide');\n    };\n\n    // \n    const $nodeSizeSlider = overlay.find('#node-size-slider');\n    const $sliderSizeDisplay = overlay.find('#slider-size-display');\n    const $sliderContainer = overlay.find('.acu-node-size-slider-container');\n    const $nodeSizeDisplayTrigger = overlay.find('#node-size-display-trigger');\n    const $legend = overlay.find('.acu-graph-legend');\n\n    let sliderVisible = false;\n    let sliderHideTimer: ReturnType<typeof setTimeout> | null = null;\n    const SLIDER_AUTO_HIDE_DELAY = 4000; // 4\n\n    // \n    const showSlider = () => {\n      if (sliderVisible) return;\n\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = true;\n\n      // \"\"wrappertriggerlegendlegendwrapper\n      // getBoundingClientRectviewport\n      const triggerRect = $nodeSizeDisplayTrigger[0].getBoundingClientRect();\n      const wrapperRect = $wrapper[0].getBoundingClientRect();\n\n      // wrappertrigger\n      const sliderHeight = 60; // \n      const top = wrapperRect.height - sliderHeight - 10; // wrapper\n      const left = triggerRect.left - wrapperRect.left;\n\n      $sliderContainer.css({\n        display: 'block',\n        top: `${top}px`,\n        left: `${left}px`,\n      });\n\n      // \n      resetSliderHideTimer();\n    };\n\n    // \n    const hideSlider = () => {\n      if (!sliderVisible) return;\n\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = false;\n      $sliderContainer.hide();\n    };\n\n    // \n    const resetSliderHideTimer = () => {\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n      }\n      sliderHideTimer = setTimeout(() => {\n        hideSlider();\n      }, SLIDER_AUTO_HIDE_DELAY);\n    };\n\n    // \"\"/\n    overlay.on('click', '#node-size-display-trigger, #node-size-display-trigger *', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        hideSlider();\n      } else {\n        showSlider();\n      }\n    });\n\n    // \n    $nodeSizeSlider.on('input mousedown touchstart', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        resetSliderHideTimer();\n      }\n    });\n\n    // \n    $sliderContainer.on('pointerdown mousedown touchstart', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $(document).on('click.slider-hide', function (e) {\n      if (\n        sliderVisible &&\n        !$sliderContainer.is(e.target) &&\n        $sliderContainer.has(e.target).length === 0 &&\n        !$nodeSizeDisplayTrigger.is(e.target) &&\n        $nodeSizeDisplayTrigger.has(e.target).length === 0\n      ) {\n        hideSlider();\n      }\n    });\n\n    $nodeSizeSlider.on('input', function () {\n      nodeSizeMultiplier = parseFloat($(this).val());\n      $sliderSizeDisplay.text(Math.round(nodeSizeMultiplier * 100) + '%');\n      updateNodeSizeDisplay();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n      render();\n\n      // \n      resetSliderHideTimer();\n    });\n\n    //  toggle \n    const $filterInSceneBtn = overlay.find('#filter-in-scene');\n    const $filterDirectOnlyBtn = overlay.find('#filter-direct-only');\n\n    const updateFilterToggleStyles = () => {\n      $filterInSceneBtn.toggleClass('active', filterInScene);\n      $filterDirectOnlyBtn.toggleClass('active', filterDirectOnly);\n    };\n\n    // \n    updateFilterToggleStyles();\n\n    $filterInSceneBtn.click(function (e) {\n      e.stopPropagation();\n      filterInScene = !filterInScene;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    $filterDirectOnlyBtn.click(function (e) {\n      e.stopPropagation();\n      filterDirectOnly = !filterDirectOnly;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    //  +  + \n    overlay.find('#graph-zoom-reset').click(() => {\n      // \n      scale = 1;\n      panX = 0;\n      panY = 0;\n      updateTransform();\n\n      // \n      nodeSizeMultiplier = 1.0;\n      $nodeSizeSlider.val(1.0);\n      $sliderSizeDisplay.text('100%');\n      updateNodeSizeDisplay();\n\n      // stepper\n      const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n      if ($nodeSizeStepper.length) {\n        $nodeSizeStepper.find('.acu-stepper-value').text('100%');\n      }\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      if (!loadLayoutCache()) {\n        // \n        runForceDirectedLayout();\n      }\n      render();\n    });\n\n    // Stepper  - \n    const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n    if ($nodeSizeStepper.length) {\n      const min = parseInt($nodeSizeStepper.data('min')); // 50\n      const max = parseInt($nodeSizeStepper.data('max')); // 200\n      const step = parseInt($nodeSizeStepper.data('step')); // 10\n      const $value = $nodeSizeStepper.find('.acu-stepper-value');\n\n      const updateNodeSizeValue = (newPercent: number) => {\n        newPercent = Math.max(min, Math.min(max, newPercent));\n        nodeSizeMultiplier = newPercent / 100; //  (0.5-2.0)\n        $value.text(`${newPercent}%`);\n        updateNodeSizeDisplay();\n\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      };\n\n      const getCurrentPercent = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || 100;\n      };\n\n      $nodeSizeStepper.find('.acu-stepper-dec').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() - step);\n      });\n\n      $nodeSizeStepper.find('.acu-stepper-inc').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() + step);\n      });\n    }\n\n    // \n    overlay.find('#graph-relayout').click(() => {\n      // \n      clearLayoutCache();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      runForceDirectedLayout();\n      render();\n    });\n\n    overlay.find('#graph-manage-avatar').click(() => {\n      // \n      showAvatarManager(nodeArr, () => {\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      });\n    });\n\n    const closeGraph = () => {\n      cleanupEvents();\n      overlay.remove();\n    };\n    overlay.find('.acu-graph-close').click(closeGraph);\n    setupOverlayClose(overlay, 'acu-relation-graph-overlay', closeGraph);\n  };\n  // ========================================\n  //  - PC/\n  // ========================================\n\n  const showAvatarCropModal = (imageSource, characterName, onSave) => {\n    const { $ } = getCore();\n    $('.acu-crop-modal-overlay').remove();\n\n    const config = getConfig();\n\n    // \n    let scale = 150;\n    let offsetX = 50;\n    let offsetY = 50;\n\n    // \n    const existing = AvatarManager.getAll()[characterName];\n    if (existing) {\n      scale = existing.scale ?? 150;\n      offsetX = existing.offsetX ?? 50;\n      offsetY = existing.offsetY ?? 50;\n    }\n\n    const modalHtml = `\n            <div class=\"acu-crop-modal-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-crop-modal\">\n                    <div class=\"acu-crop-header\">\n                        <span><i class=\"fa-solid fa-crop-simple\"></i>  - ${escapeHtml(characterName)}</span>\n                        <button class=\"acu-crop-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-crop-body\">\n                        <div class=\"acu-crop-container\">\n                            <div class=\"acu-crop-image\" style=\"\n                                background-image: url('${imageSource}');\n                                background-size: ${scale}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                            \"></div>\n                            <div class=\"acu-crop-mask\"></div>\n                        </div>\n                        <div class=\"acu-crop-hint\">  /</div>\n                    </div>\n                    <div class=\"acu-crop-footer\">\n                        <label class=\"acu-crop-btn acu-crop-reupload\" title=\"\">\n                            <i class=\"fa-solid fa-camera\"></i>\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-crop-file-input\" />\n                        </label>\n                        <button class=\"acu-crop-btn acu-crop-cancel\"></button>\n                        <button class=\"acu-crop-btn acu-crop-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    const $image = $modal.find('.acu-crop-image');\n    const $container = $modal.find('.acu-crop-container');\n    const containerEl = $container[0];\n    const imageEl = $image[0];\n\n    // \n    const updateImageStyle = () => {\n      imageEl.style.backgroundSize = `${scale}%`;\n      imageEl.style.backgroundPosition = `${offsetX}% ${offsetY}%`;\n    };\n\n    // ===  Pointer Events  ===\n    let isDragging = false;\n    let startX = 0,\n      startY = 0;\n    let startOffsetX = 0,\n      startOffsetY = 0;\n    let activePointerId = null;\n\n    imageEl.addEventListener('pointerdown', e => {\n      // \n      if (activePointerId !== null) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      isDragging = true;\n      activePointerId = e.pointerId;\n      startX = e.clientX;\n      startY = e.clientY;\n      startOffsetX = offsetX;\n      startOffsetY = offsetY;\n\n      imageEl.setPointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grabbing';\n    });\n\n    imageEl.addEventListener('pointermove', e => {\n      if (!isDragging || e.pointerId !== activePointerId) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      const deltaX = e.clientX - startX;\n      const deltaY = e.clientY - startY;\n\n      // \n      const sensitivity = 100 / scale;\n      offsetX = Math.max(0, Math.min(100, startOffsetX - deltaX * sensitivity));\n      offsetY = Math.max(0, Math.min(100, startOffsetY - deltaY * sensitivity));\n      updateImageStyle();\n    });\n\n    imageEl.addEventListener('pointerup', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.releasePointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grab';\n    });\n\n    imageEl.addEventListener('pointercancel', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.style.cursor = 'grab';\n    });\n\n    // ===  ===\n    // \n    containerEl.addEventListener(\n      'wheel',\n      e => {\n        e.preventDefault();\n        e.stopPropagation();\n        const delta = e.deltaY > 0 ? -10 : 10;\n        scale = Math.max(100, Math.min(300, scale + delta));\n        updateImageStyle();\n      },\n      { passive: false },\n    );\n\n    // \n    let lastPinchDist = 0;\n    let pinchStartScale = scale;\n\n    containerEl.addEventListener(\n      'touchstart',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          pinchStartScale = scale;\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener(\n      'touchmove',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            const pinchRatio = newDist / lastPinchDist;\n            scale = Math.max(100, Math.min(300, pinchStartScale * pinchRatio));\n            updateImageStyle();\n          }\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener('touchend', e => {\n      if (e.touches.length < 2) {\n        lastPinchDist = 0;\n        pinchStartScale = scale;\n      }\n    });\n\n    // ===  ===\n    // \n    $modal.find('.acu-crop-file-input').on('change', async function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      if (!file.type.startsWith('image/')) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        if (window.toastr) window.toastr.warning(' 5MB');\n        return;\n      }\n\n      try {\n        // \n        const success = await AvatarManager.saveLocalAvatar(characterName, file);\n        if (success) {\n          //  URL \n          const newUrl = await LocalAvatarDB.get(characterName);\n          imageSource = newUrl;\n\n          // \n          scale = 150;\n          offsetX = 50;\n          offsetY = 50;\n\n          // \n          $image.css('background-image', `url('${newUrl}')`);\n          updateImageStyle();\n        }\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n\n      $(this).val('');\n    });\n    $modal.find('.acu-crop-close, .acu-crop-cancel').on('click', () => {\n      $modal.remove();\n    });\n\n    $modal.find('.acu-crop-confirm').on('click', () => {\n      onSave({ scale, offsetX, offsetY });\n      $modal.remove();\n    });\n\n    // \n    setupOverlayClose($modal, 'acu-crop-modal-overlay', () => {\n      $modal.remove();\n    });\n  };\n  //  - \n  const showAvatarManager = (nodeArr, onUpdate) => {\n    try {\n      const { $ } = getCore();\n      $('.acu-avatar-manager-overlay').remove();\n\n      const config = getConfig();\n      const avatars = AvatarManager.getAll();\n\n      // \n      let currentView = 'chat'; // 'chat' | 'global'\n      let sortBy = 'name'; // 'name' | 'date' | 'source'\n      let sortOrder = 'asc'; // 'asc' | 'desc'\n      let searchQuery = '';\n      const expandedItems = new Set<string>(); // \n      let isInitialLoad = true; // \n\n      // {{user}}\n      const resolveUserPlaceholderForAvatar = name => {\n        if (!name) return name;\n        const playerName = getPlayerName();\n        const personaName = getPersonaName();\n\n        // \n        const diceCfg = getDiceConfig();\n        const explicitUserVariants = ['<user>', '{{user}}'];\n        if (diceCfg.autoMergeProtagonist !== false) {\n          explicitUserVariants.push('');\n        }\n        const isExplicitUserVariant = explicitUserVariants.some(\n          v => name === v || name.toLowerCase() === v.toLowerCase(),\n        );\n\n        // persona\n        const isPersonaName = personaName && name === personaName;\n\n        // \"\"\n        const isPlayerName = (() => {\n          if (!playerName) return false;\n          // \n          if (name === playerName) return true;\n          // \n          const primaryName = AvatarManager.getPrimaryName(name);\n          return primaryName === playerName;\n        })();\n\n        // {{user}}\n        if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n          return '{{user}}';\n        }\n\n        // \n        return AvatarManager.getPrimaryName(name);\n      };\n\n      // \n      const buildList = async () => {\n        let listHtml = '';\n\n        //  ()\n        const allAvatarData = AvatarManager.getAll();\n\n        // \n        let workingNodes = [];\n        if (currentView === 'chat') {\n          //  nodeArr\n          workingNodes = nodeArr.map(n => ({ name: n.name, isPlayer: n.isPlayer }));\n        } else {\n          //  + \n          const seenNames = new Set<string>();\n          const merged: { name: string; isPlayer: boolean }[] = [];\n\n          // \n          for (const n of nodeArr) {\n            if (!seenNames.has(n.name)) {\n              seenNames.add(n.name);\n              merged.push({ name: n.name, isPlayer: n.isPlayer });\n            }\n          }\n\n          // \n          for (const name of Object.keys(allAvatarData)) {\n            if (!seenNames.has(name)) {\n              seenNames.add(name);\n              merged.push({ name, isPlayer: false });\n            }\n          }\n\n          workingNodes = merged;\n        }\n\n        // {{user}}\n        const userNode = workingNodes.find(n => {\n          const resolved = resolveUserPlaceholderForAvatar(n.name);\n          return resolved === '{{user}}';\n        });\n        let otherNodes = workingNodes.filter(n => {\n          const resolved = resolveUserPlaceholderForAvatar(n.name);\n          return resolved !== '{{user}}';\n        });\n\n        // \n        if (searchQuery) {\n          const query = searchQuery.toLowerCase();\n          otherNodes = otherNodes.filter(n => {\n            const nameMatch = n.name.toLowerCase().includes(query);\n            const aliasMatch = (allAvatarData[n.name]?.aliases || []).some(alias =>\n              alias.toLowerCase().includes(query),\n            );\n            return nameMatch || aliasMatch;\n          });\n        }\n\n        // \n        const nodeSourceMap = new Map<string, { hasLocal: boolean; hasUrl: boolean }>();\n        if (sortBy === 'source') {\n          for (const node of otherNodes) {\n            const hasLocal = await AvatarManager.hasLocalAvatar(node.name);\n            const hasUrl = !!allAvatarData[node.name]?.url;\n            nodeSourceMap.set(node.name, { hasLocal, hasUrl });\n          }\n        }\n\n        // \n        if (sortBy === 'source') {\n          //  > URL > \n          // : local(0) < url(1) < none(2)\n          // : none(2) < url(1) < local(0)\n          const getSourcePriority = (name: string) => {\n            const info = nodeSourceMap.get(name);\n            if (info?.hasLocal) return 0; // \n            if (info?.hasUrl) return 1; // URL\n            return 2; // \n          };\n          otherNodes.sort((a, b) => {\n            const priorityA = getSourcePriority(a.name);\n            const priorityB = getSourcePriority(b.name);\n            const cmp = priorityA - priorityB;\n            return sortOrder === 'asc' ? cmp : -cmp;\n          });\n        } else if (sortBy === 'name') {\n          otherNodes.sort((a, b) => {\n            const cmp = a.name.localeCompare(b.name, 'zh-CN');\n            return sortOrder === 'asc' ? cmp : -cmp;\n          });\n        } else {\n          // \n          otherNodes.sort((a, b) => {\n            const timeA = allAvatarData[a.name]?.createdAt ?? 0;\n            const timeB = allAvatarData[b.name]?.createdAt ?? 0;\n            return sortOrder === 'asc' ? timeA - timeB : timeB - timeA;\n          });\n        }\n\n        // \n        if (currentView === 'global' && workingNodes.length === 0) {\n          return `\n            <div class=\"acu-avatar-empty-state\">\n              <i class=\"fa-solid fa-images\"></i>\n              <p></p>\n            </div>\n          `;\n        }\n\n        // \n        if (currentView === 'chat' && workingNodes.length === 0) {\n          return `\n            <div class=\"acu-avatar-empty-state\">\n              <i class=\"fa-solid fa-user-slash\"></i>\n              <p>NPC</p>\n            </div>\n          `;\n        }\n\n        // {{user}}\n        if (userNode) {\n          // {{user}}'{{user}}'\n          const userNodeForDisplay = {\n            ...userNode,\n            name: '{{user}}', // {{user}}\n          };\n\n          const data = avatars[userNodeForDisplay.name] || {};\n          let currentUrl = data.url || '';\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(userNodeForDisplay.name);\n          let displayUrl = '';\n          let sourceLabel = '';\n\n          if (hasLocal) {\n            displayUrl = await LocalAvatarDB.get(userNodeForDisplay.name);\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n          } else if (currentUrl) {\n            displayUrl = currentUrl;\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n          }\n\n          const aliases = (data.aliases || []).join(', ');\n          const hasAvatar = !!displayUrl;\n\n          // URL\n          if (isInitialLoad && !hasAvatar && !data.url) {\n            expandedItems.add(userNodeForDisplay.name);\n          }\n          const isExpanded = expandedItems.has(userNodeForDisplay.name);\n\n          listHtml += `\n                    <div class=\"acu-avatar-item ${isExpanded ? 'expanded' : ''}\" data-name=\"${escapeHtml(userNodeForDisplay.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <!--  -->\n                        <div class=\"acu-avatar-row-collapsed\">\n                            <div class=\"acu-avatar-preview-wrap\">\n                                <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" data-avatar-url=\"${escapeHtml(displayUrl)}\" data-avatar-x=\"${data.offsetX ?? 50}\" data-avatar-y=\"${data.offsetY ?? 50}\" data-avatar-scale=\"${data.scale ?? 150}\">\n                                    ${!hasAvatar ? `<span>${escapeHtml(userNodeForDisplay.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                                </div>\n                                ${sourceLabel}\n                            </div>\n                            <div class=\"acu-avatar-info-summary\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(userNodeForDisplay.name)}<button class=\"acu-protagonist-toggle ${getDiceConfig().autoMergeProtagonist !== false ? 'active' : ''}\" title=\"&quot;&quot;{{user}}\"><i class=\"fa-solid ${getDiceConfig().autoMergeProtagonist !== false ? 'fa-link' : 'fa-link-slash'}\"></i></button></div>\n                                <div class=\"acu-avatar-url-preview\">${escapeHtml(currentUrl || '')}</div>\n                            </div>\n                            <div class=\"acu-avatar-actions-collapsed\">\n                                <button class=\"acu-btn-action acu-btn-edit\" title=\"\"><i class=\"fa-solid ${isExpanded ? 'fa-chevron-up' : 'fa-pencil'}\"></i></button>\n                                <button class=\"acu-btn-action acu-btn-delete acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                            </div>\n                        </div>\n\n                        <!--  -->\n                        <div class=\"acu-avatar-row-expanded\">\n                            <div class=\"acu-avatar-details\">\n                                <div class=\"acu-input-group\">\n                                    <label class=\"acu-input-group-label\">URL</label>\n                                    <div class=\"acu-url-container\">\n                                        <input type=\"text\" class=\"acu-input acu-avatar-url\" placeholder=\"...\" value=\"${escapeHtml(currentUrl)}\" />\n                                    </div>\n                                </div>\n                                <div class=\"acu-input-group\">\n                                    <label class=\"acu-input-group-label\"></label>\n                                    <div class=\"acu-alias-tags-container\">\n                                        ${(data.aliases || []).map(a => `<span class=\"acu-alias-tag\" data-alias=\"${escapeHtml(a)}\">${escapeHtml(a)} <i class=\"fa-solid fa-xmark\"></i></span>`).join('')}\n                                        <input type=\"text\" class=\"acu-alias-input\" placeholder=\"...\" />\n                                    </div>\n                                </div>\n                                <div class=\"acu-avatar-expanded-footer\">\n                                    <button class=\"acu-btn-action acu-avatar-clear-all-btn\" title=\"\"><i class=\"fa-solid fa-user-slash\"></i></button>\n                                    <button class=\"acu-btn-action acu-avatar-clear-alias-btn\" title=\"\"><i class=\"fa-solid fa-tags\"></i></button>\n                                    <label class=\"acu-avatar-upload-trigger\">\n                                        <i class=\"fa-solid fa-cloud-arrow-up\"></i> \n                                        <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none\" />\n                                    </label>\n                                    <button class=\"acu-btn-action acu-btn-save acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i>&nbsp;</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `;\n        }\n\n        // \n        for (const node of otherNodes) {\n          const data = avatars[node.name] || {};\n          let currentUrl = data.url || '';\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(node.name);\n          let displayUrl = '';\n          let sourceLabel = '';\n\n          if (hasLocal) {\n            displayUrl = await LocalAvatarDB.get(node.name);\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n          } else if (currentUrl) {\n            displayUrl = currentUrl;\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n          }\n\n          const aliases = (data.aliases || []).join(', ');\n          const hasAvatar = !!displayUrl;\n\n          // URL\n          if (isInitialLoad && !hasAvatar && !data.url) {\n            expandedItems.add(node.name);\n          }\n          const isExpanded = expandedItems.has(node.name);\n\n          listHtml += `\n                    <div class=\"acu-avatar-item ${isExpanded ? 'expanded' : ''}\" data-name=\"${escapeHtml(node.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <!--  -->\n                        <div class=\"acu-avatar-row-collapsed\">\n                            <div class=\"acu-avatar-preview-wrap\">\n                                <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" data-avatar-url=\"${escapeHtml(displayUrl)}\" data-avatar-x=\"${data.offsetX ?? 50}\" data-avatar-y=\"${data.offsetY ?? 50}\" data-avatar-scale=\"${data.scale ?? 150}\">\n                                    ${!hasAvatar ? `<span>${escapeHtml(node.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                                </div>\n                                ${sourceLabel}\n                            </div>\n                            <div class=\"acu-avatar-info-summary\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(node.name)}</div>\n                                <div class=\"acu-avatar-url-preview\">${escapeHtml(currentUrl || '')}</div>\n                            </div>\n                            <div class=\"acu-avatar-actions-collapsed\">\n                                <button class=\"acu-btn-action acu-btn-edit\" title=\"\"><i class=\"fa-solid ${isExpanded ? 'fa-chevron-up' : 'fa-pencil'}\"></i></button>\n                                <button class=\"acu-btn-action acu-btn-delete acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                            </div>\n                        </div>\n\n                        <!--  -->\n                        <div class=\"acu-avatar-row-expanded\">\n                            <div class=\"acu-avatar-details\">\n                                <div class=\"acu-input-group\">\n                                    <label class=\"acu-input-group-label\">URL</label>\n                                    <div class=\"acu-url-container\">\n                                        <input type=\"text\" class=\"acu-input acu-avatar-url\" placeholder=\"...\" value=\"${escapeHtml(currentUrl)}\" />\n                                    </div>\n                                </div>\n                                <div class=\"acu-input-group\">\n                                    <label class=\"acu-input-group-label\"></label>\n                                    <div class=\"acu-alias-tags-container\">\n                                        ${(data.aliases || []).map(a => `<span class=\"acu-alias-tag\" data-alias=\"${escapeHtml(a)}\">${escapeHtml(a)} <i class=\"fa-solid fa-xmark\"></i></span>`).join('')}\n                                        <input type=\"text\" class=\"acu-alias-input\" placeholder=\"...\" />\n                                    </div>\n                                </div>\n                                <div class=\"acu-avatar-expanded-footer\">\n                                    <button class=\"acu-btn-action acu-avatar-clear-all-btn\" title=\"\"><i class=\"fa-solid fa-user-slash\"></i></button>\n                                    <button class=\"acu-btn-action acu-avatar-clear-alias-btn\" title=\"\"><i class=\"fa-solid fa-tags\"></i></button>\n                                    <label class=\"acu-avatar-upload-trigger\">\n                                        <i class=\"fa-solid fa-cloud-arrow-up\"></i> \n                                        <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none\" />\n                                    </label>\n                                    <button class=\"acu-btn-action acu-btn-save acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i>&nbsp;</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                `;\n        }\n\n        return listHtml;\n      };\n\n      const applyAvatarPreviewStyles = $root => {\n        $root.find('.acu-avatar-preview').each(function () {\n          const $preview = $(this);\n          const url = $preview.attr('data-avatar-url');\n          if (!url) return;\n          const offsetX = Number($preview.attr('data-avatar-x') || 50);\n          const offsetY = Number($preview.attr('data-avatar-y') || 50);\n          const scale = Number($preview.attr('data-avatar-scale') || 150);\n          $preview.css({\n            '--acu-avatar-image': `url('${url}')`,\n            '--acu-avatar-x': `${offsetX}%`,\n            '--acu-avatar-y': `${offsetY}%`,\n            '--acu-avatar-scale': `${scale}%`,\n          });\n        });\n      };\n\n      // \n      const managerHtml = `\n            <div class=\"acu-avatar-manager-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-avatar-manager\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-avatar-title\"><i class=\"fa-solid fa-user-circle\"></i> </div>\n                        <div class=\"acu-avatar-header-actions\">\n                            <button class=\"acu-btn-icon acu-avatar-import-btn\" title=\"\"><i class=\"fa-solid fa-file-import\"></i></button>\n                            <button class=\"acu-btn-icon acu-avatar-export-btn\" title=\"\"><i class=\"fa-solid fa-file-export\"></i></button>\n                            <button class=\"acu-avatar-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-avatar-toolbar\">\n                        <!-- : -->\n                        <div class=\"acu-toolbar-group left\">\n                            <button class=\"acu-btn-icon acu-view-toggle\" title=\" / \" data-view=\"chat\">\n                                <i class=\"fa-solid fa-comments\"></i>\n                            </button>\n                            <div class=\"acu-select-wrapper sort-field\">\n                                <select class=\"acu-toolbar-select acu-sort-field\" title=\"\">\n                                    <option value=\"name\"></option>\n                                    <option value=\"date\"></option>\n                                    <option value=\"source\"></option>\n                                </select>\n                            </div>\n                            <button class=\"acu-btn-icon acu-sort-order\" title=\"\" data-dir=\"asc\">\n                                <i class=\"fa-solid fa-arrow-down-a-z\"></i>\n                            </button>\n                            <div class=\"acu-search-wrapper\">\n                                <i class=\"fa-solid fa-magnifying-glass acu-search-icon\"></i>\n                                <input type=\"text\" class=\"acu-avatar-search\" placeholder=\"...\" autocomplete=\"off\">\n                                <i class=\"fa-solid fa-xmark acu-search-clear\" style=\"display:none;\"></i>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"acu-avatar-list\" id=\"acu-avatar-list-container\">\n                        <div class=\"acu-import-empty\">\n                            <i class=\"fa-solid fa-spinner fa-spin\"></i> ...\n                        </div>\n                    </div>\n                </div>\n                <input type=\"file\" id=\"acu-avatar-file-input\" accept=\".json\" />\n            </div>\n        `;\n\n      const $manager = $(managerHtml);\n      $('body').append($manager);\n\n      // \n      buildList().then(listHtml => {\n        $manager.find('#acu-avatar-list-container').html(listHtml);\n        applyAvatarPreviewStyles($manager);\n        bindAvatarEvents();\n      });\n\n      // \n      const refreshItem = async name => {\n        const $item = $manager.find(`.acu-avatar-item[data-name=\"${name}\"]`);\n        if (!$item.length) return;\n\n        const data = AvatarManager.getAll()[name] || {};\n        const hasLocal = await AvatarManager.hasLocalAvatar(name);\n        let displayUrl = '';\n        let sourceLabel = '';\n\n        if (hasLocal) {\n          displayUrl = await LocalAvatarDB.get(name);\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n        } else if (data.url) {\n          displayUrl = data.url;\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n        }\n\n        const $preview = $item.find('.acu-avatar-preview');\n        $item.find('.acu-avatar-source').remove();\n\n        if (displayUrl) {\n          $preview\n            .addClass('has-image')\n            .attr('data-avatar-url', displayUrl)\n            .attr('data-avatar-x', data.offsetX ?? 50)\n            .attr('data-avatar-y', data.offsetY ?? 50)\n            .attr('data-avatar-scale', data.scale ?? 150)\n            .css({\n              '--acu-avatar-image': `url('${displayUrl}')`,\n              '--acu-avatar-x': `${data.offsetX ?? 50}%`,\n              '--acu-avatar-y': `${data.offsetY ?? 50}%`,\n              '--acu-avatar-scale': `${data.scale ?? 150}%`,\n            })\n            .find('span')\n            .remove();\n          $item.find('.acu-avatar-preview-wrap').append(sourceLabel);\n          $item.find('.acu-avatar-url-preview').text(data.url || '');\n        } else {\n          $preview\n            .removeClass('has-image')\n            .attr('data-avatar-url', '')\n            .attr('data-avatar-x', 50)\n            .attr('data-avatar-y', 50)\n            .attr('data-avatar-scale', 150)\n            .css({\n              '--acu-avatar-image': '',\n              '--acu-avatar-x': '',\n              '--acu-avatar-y': '',\n              '--acu-avatar-scale': '',\n            })\n            .html(\n              `<span>${escapeHtml(name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>`,\n            );\n          $item.find('.acu-avatar-url-preview').text('');\n        }\n\n        $item.attr('data-has-local', hasLocal);\n        $item.attr('data-display-url', displayUrl);\n      };\n\n      // \n      const refreshList = async () => {\n        const listHtml = await buildList();\n        $manager.find('#acu-avatar-list-container').html(listHtml);\n        applyAvatarPreviewStyles($manager);\n        // \n        isInitialLoad = false;\n      };\n\n      // ==========  ==========\n\n      // Part A: \n      const findCharacterInTable = (\n        name: string,\n      ): { tableKey: string; rowIndex: number; row: Record<string, unknown> } | null => {\n        try {\n          const rawData = typeof getTableData === 'function' ? getTableData() : null;\n          if (!rawData) return null;\n\n          // \n          const avatarData = AvatarManager.getAll()[name];\n          const aliases = avatarData?.aliases || [];\n          const allNames = [name, ...aliases].map(n => n.toLowerCase());\n\n          // \n          for (const [tableKey, tableData] of Object.entries(rawData)) {\n            if (!tableData || typeof tableData !== 'object') continue;\n            const rows = (tableData as { rows?: unknown[] }).rows;\n            if (!Array.isArray(rows)) continue;\n\n            for (let i = 0; i < rows.length; i++) {\n              const row = rows[i] as Record<string, unknown>;\n              if (!row) continue;\n\n              // \n              const nameColumns = ['', '', '', 'name', 'Name', ''];\n              for (const col of nameColumns) {\n                const cellValue = row[col];\n                if (cellValue && typeof cellValue === 'string') {\n                  if (allNames.includes(cellValue.toLowerCase())) {\n                    return { tableKey, rowIndex: i, row };\n                  }\n                }\n              }\n            }\n          }\n          return null;\n        } catch (err) {\n          console.error('[DICE] findCharacterInTable :', err);\n          return null;\n        }\n      };\n\n      // Part A: \n      const findRelationshipReferences = (\n        name: string,\n        aliases: string[] = [],\n      ): Array<{\n        tableName: string;\n        rowIndex: number;\n        characterName: string;\n        relationText: string;\n        matchedRelation: string;\n      }> => {\n        const references: Array<{\n          tableName: string;\n          rowIndex: number;\n          characterName: string;\n          relationText: string;\n          matchedRelation: string;\n        }> = [];\n\n        try {\n          const rawData = typeof getTableData === 'function' ? getTableData() : null;\n          if (!rawData) return references;\n\n          const allNames = [name, ...aliases].map(n => n.toLowerCase());\n\n          for (const [tKey, tData] of Object.entries(rawData)) {\n            if (!tKey.startsWith('sheet_')) continue;\n            if (!tData || typeof tData !== 'object') continue;\n\n            const sheet = tData as { name?: string; content?: unknown[][] };\n            if (!Array.isArray(sheet.content) || sheet.content.length < 2) continue;\n\n            const headers = sheet.content[0] as string[];\n            const tableName = sheet.name || tKey.replace('sheet_', '');\n\n            // \"\"\n            const nameColumns = ['', '', '', 'name', 'Name', ''];\n            let nameColIndex = -1;\n            for (const col of nameColumns) {\n              const idx = headers.findIndex(h => h === col);\n              if (idx !== -1) {\n                nameColIndex = idx;\n                break;\n              }\n            }\n\n            // \"\"\n            const relationColIndex = headers.findIndex(h => h === '');\n            if (relationColIndex === -1) continue;\n\n            // \n            for (let i = 1; i < sheet.content.length; i++) {\n              const row = sheet.content[i];\n              if (!Array.isArray(row)) continue;\n\n              // \n              let rowCharacterName = '';\n              if (nameColIndex !== -1) {\n                const cellValue = row[nameColIndex];\n                if (cellValue && typeof cellValue === 'string') {\n                  rowCharacterName = cellValue;\n                }\n              }\n\n              // \n              const relationValue = row[relationColIndex];\n              if (relationValue && typeof relationValue === 'string') {\n                // : \":;:\"\n                const parts = relationValue.split(/[;]/);\n                for (const part of parts) {\n                  const splitResult = part.split(/[:]/);\n                  const refName = splitResult[0];\n                  const relationWord = splitResult[1] || '';\n                  if (refName && allNames.includes(refName.trim().toLowerCase())) {\n                    references.push({\n                      tableName,\n                      rowIndex: i - 1, // 1\n                      characterName: rowCharacterName || `${i}`,\n                      relationText: relationValue,\n                      matchedRelation: relationWord.trim(),\n                    });\n                    break; // \n                  }\n                }\n              }\n            }\n          }\n        } catch (err) {\n          console.error('[DICE] findRelationshipReferences :', err);\n        }\n\n        return references;\n      };\n\n      // Part B:  (Redesigned)\n      const showDeleteConfirmModal = (\n        info: {\n          name: string;\n          avatarUrl: string;\n          tableRow: { tableKey: string; rowIndex: number; row: Record<string, unknown> } | null;\n          relationships: Array<{\n            tableName: string;\n            rowIndex: number;\n            characterName: string;\n            relationText: string;\n            matchedRelation: string;\n          }>;\n        },\n        onConfirm: () => void,\n        onClose?: () => void,\n      ) => {\n        const { name, tableRow, relationships } = info;\n\n        // 1.  (//)\n        const avatarData = AvatarManager.getAll()[name] || {};\n        const aliases = avatarData.aliases || [];\n        const avX = avatarData.offsetX ?? 50;\n        const avY = avatarData.offsetY ?? 50;\n        const avScale = avatarData.scale ?? 150;\n        const displayUrl = avatarData.url || info.avatarUrl;\n\n        // 2. \n        const aliasRows: Array<{ tableKey: string; alias: string }> = [];\n        if (aliases.length > 0) {\n          try {\n            const rawData = typeof getTableData === 'function' ? getTableData() : null;\n            if (rawData) {\n              const lowerAliases = aliases.map((a: string) => a.toLowerCase());\n              for (const [tKey, tData] of Object.entries(rawData)) {\n                if (!tKey.startsWith('sheet_')) continue;\n                if (!tData || typeof tData !== 'object') continue;\n                const sheet = tData as { content?: unknown[][] };\n                if (!Array.isArray(sheet.content) || sheet.content.length < 2) continue;\n\n                const headers = sheet.content[0] as string[];\n                const nameColumns = ['', '', '', 'name', 'Name', ''];\n                let nameColIndex = -1;\n                for (const col of nameColumns) {\n                  const idx = headers.findIndex(h => h === col);\n                  if (idx !== -1) {\n                    nameColIndex = idx;\n                    break;\n                  }\n                }\n                if (nameColIndex === -1) continue;\n\n                for (let i = 1; i < sheet.content.length; i++) {\n                  const row = sheet.content[i];\n                  if (!Array.isArray(row)) continue;\n                  const cellValue = row[nameColIndex];\n                  if (cellValue && typeof cellValue === 'string') {\n                    if (lowerAliases.includes(cellValue.toLowerCase())) {\n                      aliasRows.push({ tableKey: tKey.replace('sheet_', ''), alias: cellValue });\n                    }\n                  }\n                }\n              }\n            }\n          } catch (e) {\n            console.warn('[DeleteModal] Alias scan failed', e);\n          }\n        }\n\n        // 3.  HTML \n        const modalHtml = `\n          <div class=\"acu-delete-confirm-overlay acu-theme-${config.theme}\">\n            <div class=\"acu-delete-confirm-modal redesign\">\n\n              <!--  -->\n              <div class=\"acu-delete-header destruct\">\n                <i class=\"fa-solid fa-triangle-exclamation\"></i>\n                \n                <button class=\"acu-delete-close-btn\" title=\"\">\n                  <i class=\"fa-solid fa-xmark\"></i>\n                </button>\n              </div>\n\n              <div class=\"acu-delete-content\">\n\n                <!--  () -->\n                <div class=\"acu-del-section destruct\">\n                  <div class=\"acu-del-section-head\">\n                    <i class=\"fa-solid fa-id-card\"></i> \n                  </div>\n                  <div class=\"acu-del-card main-identity\">\n                    <div class=\"acu-del-avatar-box\">\n                      <div class=\"acu-avatar-preview ${displayUrl ? 'has-image' : ''}\"\n                           data-avatar-url=\"${escapeHtml(displayUrl || '')}\"\n                           data-avatar-x=\"${avX}\"\n                           data-avatar-y=\"${avY}\"\n                           data-avatar-scale=\"${avScale}\">\n                        ${!displayUrl ? `<span>${escapeHtml(name.charAt(0))}</span>` : ''}\n                      </div>\n                    </div>\n                    <div class=\"acu-del-info\">\n                      <div class=\"acu-del-name\">${escapeHtml(name)}</div>\n                      <div class=\"acu-del-meta\"></div>\n                    </div>\n                  </div>\n                </div>\n\n                <!--  () -->\n                ${\n                  tableRow || aliases.length > 0\n                    ? `\n                <div class=\"acu-del-section warning\">\n                  <div class=\"acu-del-section-head\">\n                    <i class=\"fa-solid fa-database\"></i> \n                  </div>\n                  <ul class=\"acu-del-list\">\n                    ${\n                      tableRow\n                        ? `\n                      <li>\n                        <i class=\"fa-solid fa-table\"></i>\n                        <span>: <strong>${escapeHtml(tableRow.tableKey)}</strong></span>\n                      </li>\n                    `\n                        : ''\n                    }\n                    ${\n                      aliases.length > 0\n                        ? `\n                      <li class=\"sub-group\">\n                        <div class=\"group-title\"><i class=\"fa-solid fa-tags\"></i>  (${aliases.length})</div>\n                        <div class=\"group-content\">${aliases.map((a: string) => `<span class=\"tag\">${escapeHtml(a)}</span>`).join('')}</div>\n                        ${\n                          aliasRows.length > 0\n                            ? `\n                          <div class=\"group-warning\">\n                            <i class=\"fa-solid fa-trash-can\"></i>  ${aliasRows.length} \n                            <span class=\"detail\">(${aliasRows\n                              .map(r => r.tableKey)\n                              .slice(0, 3)\n                              .join(', ')}${aliasRows.length > 3 ? '...' : ''})</span>\n                          </div>\n                        `\n                            : ''\n                        }\n                      </li>\n                    `\n                        : ''\n                    }\n                  </ul>\n                </div>\n                `\n                    : ''\n                }\n\n                <!--  ( - ) -->\n                ${\n                  relationships.length > 0\n                    ? `\n                <div class=\"acu-del-section warning\">\n                  <div class=\"acu-del-section-head\">\n                    <i class=\"fa-solid fa-link\"></i> \n                  </div>\n                  <div class=\"acu-del-summary\">\n                     <strong>${relationships.length}</strong> \n                  </div>\n                  <ul class=\"acu-del-list compact\">\n                    ${relationships\n                      .slice(0, 5)\n                      .map(\n                        rel => `\n                      <li>\n                        <i class=\"fa-solid fa-user-tag\"></i>\n                        <span>${escapeHtml(rel.tableName)}.${escapeHtml(rel.characterName)}${rel.matchedRelation ? ` <span class=\"relation-tag\">${escapeHtml(rel.matchedRelation)}</span>` : ''}</span>\n                      </li>\n                    `,\n                      )\n                      .join('')}\n                    ${relationships.length > 5 ? `<li class=\"more\">...  ${relationships.length - 5} </li>` : ''}\n                  </ul>\n                </div>\n                `\n                    : ''\n                }\n\n                <div class=\"acu-del-final-warn\">\n                   <strong></strong>\n                </div>\n              </div>\n\n              <!--  -->\n              <div class=\"acu-delete-actions\">\n                <button class=\"acu-delete-cancel-btn\">\n                  \n                </button>\n                <button class=\"acu-delete-confirm-btn destruct\">\n                  <i class=\"fa-solid fa-trash\"></i> \n                </button>\n              </div>\n            </div>\n          </div>\n        `;\n\n        const $modal = $(modalHtml);\n        $('body').append($modal);\n\n        //  ( applyAvatarPreviewStyles )\n        $modal.find('.acu-avatar-preview').each(function () {\n          const $preview = $(this);\n          const url = $preview.attr('data-avatar-url');\n          if (!url) return;\n          const offsetX = Number($preview.attr('data-avatar-x') || 50);\n          const offsetY = Number($preview.attr('data-avatar-y') || 50);\n          const scale = Number($preview.attr('data-avatar-scale') || 150);\n          $preview.css({\n            '--acu-avatar-image': `url('${url}')`,\n            '--acu-avatar-x': `${offsetX}%`,\n            '--acu-avatar-y': `${offsetY}%`,\n            '--acu-avatar-scale': `${scale}%`,\n          });\n        });\n\n        // \n        const closeModal = () => {\n          $modal.addClass('closing');\n          setTimeout(() => {\n            $modal.remove();\n            onClose?.();\n          }, 200);\n        };\n\n        // ESC \n        const handleKeydown = (e: KeyboardEvent) => {\n          if (e.key === 'Escape') {\n            closeModal();\n            $(document).off(\n              'keydown',\n              handleKeydown as unknown as JQuery.TypeEventHandler<Document, unknown, Document, Document, 'keydown'>,\n            );\n          }\n        };\n        $(document).on(\n          'keydown',\n          handleKeydown as unknown as JQuery.TypeEventHandler<Document, unknown, Document, Document, 'keydown'>,\n        );\n\n        // \n        $modal.on('click', function (e) {\n          if ($(e.target).hasClass('acu-delete-confirm-overlay')) {\n            closeModal();\n          }\n        });\n\n        // \n        $modal.find('.acu-delete-cancel-btn').on('click', closeModal);\n\n        //  ()\n        $modal.find('.acu-delete-close-btn').on('click', closeModal);\n\n        // \n        $modal.find('.acu-delete-confirm-btn').on('click', () => {\n          const $btn = $modal.find('.acu-delete-confirm-btn');\n          $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n          setTimeout(() => {\n            closeModal();\n            onConfirm();\n          }, 50);\n        });\n      };\n\n      // Part D: \n      const executeCharacterDelete = async (name: string) => {\n        try {\n          const avatarData = AvatarManager.getAll()[name];\n          const aliases = avatarData?.aliases || [];\n\n          // 1. \n          await AvatarManager.deleteLocalAvatar(name);\n          AvatarManager.remove(name);\n\n          // keys\n          const modifiedSheetKeys = new Set<string>();\n\n          // 2.  cachedRawData  getTableData\n          let rawData = typeof getTableData === 'function' ? getTableData() : null;\n          if (!rawData) {\n            console.warn('[DICE] ');\n          }\n\n          // 3. content \n          if (rawData) {\n            const allNames = [name, ...aliases].map(n => n.toLowerCase());\n\n            // \n            for (const [tableKey, tableData] of Object.entries(rawData)) {\n              if (!tableKey.startsWith('sheet_')) continue;\n              if (!tableData || typeof tableData !== 'object') continue;\n\n              const sheet = tableData as { content?: unknown[][] };\n              if (!Array.isArray(sheet.content) || sheet.content.length < 2) continue;\n\n              // \"\"\n              const headers = sheet.content[0] as string[];\n              const nameColumns = ['', '', '', 'name', 'Name', ''];\n              let nameColIndex = -1;\n              for (const col of nameColumns) {\n                const idx = headers.findIndex(h => h === col);\n                if (idx !== -1) {\n                  nameColIndex = idx;\n                  break;\n                }\n              }\n\n              if (nameColIndex === -1) continue; // \n\n              //  content[0]\n              for (let i = sheet.content.length - 1; i >= 1; i--) {\n                const row = sheet.content[i];\n                if (!Array.isArray(row)) continue;\n\n                const cellValue = row[nameColIndex];\n                if (cellValue && typeof cellValue === 'string') {\n                  if (allNames.includes(cellValue.toLowerCase())) {\n                    // \n                    sheet.content.splice(i, 1);\n                    modifiedSheetKeys.add(tableKey);\n                    console.log(`[DICE]  ${tableKey}  [${i}]: ${cellValue}`);\n                    // break\n                  }\n                }\n              }\n            }\n          }\n\n          // 4.  rawData  content \n          if (rawData) {\n            const allNames = [name, ...aliases].map(n => n.toLowerCase());\n\n            for (const [tableKey, tableData] of Object.entries(rawData)) {\n              if (!tableKey.startsWith('sheet_')) continue;\n              if (!tableData || typeof tableData !== 'object') continue;\n\n              const sheet = tableData as { content?: unknown[][] };\n              if (!Array.isArray(sheet.content) || sheet.content.length < 2) continue;\n\n              // \"\"\n              const headers = sheet.content[0] as string[];\n              const relationColIndex = headers.findIndex(h => h === '');\n              if (relationColIndex === -1) continue;\n\n              // \n              for (let i = 1; i < sheet.content.length; i++) {\n                const row = sheet.content[i];\n                if (!Array.isArray(row)) continue;\n\n                const relationValue = row[relationColIndex];\n                if (typeof relationValue !== 'string' || !relationValue) continue;\n\n                // \n                const parts = relationValue.split(/[;]/);\n                const filteredParts = parts.filter(part => {\n                  const [refName] = part.split(/[:]/);\n                  return !refName || !allNames.includes(refName.trim().toLowerCase());\n                });\n\n                const newValue = filteredParts.join(';');\n                if (newValue !== relationValue) {\n                  row[relationColIndex] = newValue;\n                  modifiedSheetKeys.add(tableKey);\n                }\n              }\n            }\n          }\n\n          // 5. \n          if (rawData && modifiedSheetKeys.size > 0) {\n            await saveDataOnly(rawData, Array.from(modifiedSheetKeys));\n            // \n            if (typeof renderInterface === 'function') {\n              renderInterface();\n            }\n          }\n\n          // 6.  nodeArr \n          const idx = nodeArr.findIndex(n => n.name === name);\n          if (idx !== -1) {\n            nodeArr.splice(idx, 1);\n          }\n\n          // 7. \n          await refreshList();\n\n          // 8. \n          if (window.toastr) {\n            window.toastr.success(` \"${name}\"`);\n          }\n\n          onUpdate?.();\n        } catch (err) {\n          console.error('[DICE] :', err);\n          if (window.toastr) {\n            window.toastr.error('');\n          }\n        }\n      };\n\n      // ==========  ==========\n\n      const bindAvatarEvents = () => {\n        // (toggle)\n        $manager.on('click', '.acu-view-toggle', async function () {\n          const $btn = $(this);\n          const isChat = $btn.attr('data-view') === 'chat';\n          const newView = isChat ? 'global' : 'chat';\n\n          $btn.attr('data-view', newView);\n          currentView = newView;\n\n          const $icon = $btn.find('i');\n          if (newView === 'global') {\n            $icon.removeClass('fa-comments').addClass('fa-globe');\n            $btn.addClass('active');\n          } else {\n            $icon.removeClass('fa-globe').addClass('fa-comments');\n            $btn.removeClass('active');\n          }\n\n          await refreshList();\n        });\n\n        // ()\n        const debouncedSearch = _.debounce(async () => {\n          await refreshList();\n        }, 300);\n\n        $manager.on('input', '.acu-avatar-search', function () {\n          searchQuery = $(this).val().trim();\n          const $clear = $manager.find('.acu-search-clear');\n          $clear.toggle(!!searchQuery);\n          debouncedSearch();\n        });\n\n        $manager.on('click', '.acu-search-clear', async function () {\n          searchQuery = '';\n          $manager.find('.acu-avatar-search').val('');\n          $(this).hide();\n          await refreshList();\n        });\n\n        // \n        $manager.on('change', '.acu-sort-field', async function () {\n          sortBy = $(this).val();\n          await refreshList();\n        });\n\n        // (toggle)\n        $manager.on('click', '.acu-sort-order', async function () {\n          const $btn = $(this);\n          const isAsc = $btn.attr('data-dir') === 'asc';\n          const newDir = isAsc ? 'desc' : 'asc';\n\n          $btn.attr('data-dir', newDir);\n          sortOrder = newDir;\n\n          const $icon = $btn.find('i');\n          if (newDir === 'desc') {\n            $icon.removeClass('fa-arrow-down-a-z').addClass('fa-arrow-up-a-z');\n          } else {\n            $icon.removeClass('fa-arrow-up-a-z').addClass('fa-arrow-down-a-z');\n          }\n\n          await refreshList();\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-preview', async function (e) {\n          e.stopPropagation();\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const displayUrl = $item.attr('data-display-url');\n\n          if (displayUrl) {\n            //   \n            showAvatarCropModal(displayUrl, name, async result => {\n              const data = AvatarManager.getAll()[name] || {};\n              AvatarManager.set(name, data.url || '', result.offsetX, result.offsetY, result.scale, data.aliases || []);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          } else {\n            //   \n            $item.find('.acu-avatar-file-input').click();\n          }\n        });\n\n        // /\n        $manager.on('click', '.acu-btn-edit', function (e) {\n          e.stopPropagation();\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const isExpanded = $item.hasClass('expanded');\n\n          if (isExpanded) {\n            $item.removeClass('expanded');\n            expandedItems.delete(name);\n            $(this).find('i').removeClass('fa-chevron-up').addClass('fa-pencil');\n          } else {\n            $item.addClass('expanded');\n            expandedItems.add(name);\n            $(this).find('i').removeClass('fa-pencil').addClass('fa-chevron-up');\n          }\n        });\n\n        // \n        $manager.on('keydown', '.acu-alias-input', function (e) {\n          if (e.key === 'Enter' || e.key === ',') {\n            e.preventDefault();\n            const val = $(this).val().trim();\n            if (val) {\n              const $container = $(this).closest('.acu-alias-tags-container');\n              // \n              let exists = false;\n              $container.find('.acu-alias-tag').each(function () {\n                if ($(this).data('alias') === val) exists = true;\n              });\n\n              if (!exists) {\n                const tagHtml = `<span class=\"acu-alias-tag\" data-alias=\"${escapeHtml(val)}\">${escapeHtml(val)} <i class=\"fa-solid fa-xmark\"></i></span>`;\n                $(this).before(tagHtml);\n              }\n              $(this).val('');\n            }\n          } else if (e.key === 'Backspace' && !$(this).val()) {\n            // \n            $(this).prev('.acu-alias-tag').remove();\n          }\n        });\n\n        //  ()\n        $manager.on('input', '.acu-alias-input', function (e) {\n          const val = $(this).val();\n          if (val.includes(',') || val.includes('')) {\n            const parts = val.split(/[,]/);\n            const lastPart = parts.pop(); // \n            const $container = $(this).closest('.acu-alias-tags-container');\n\n            parts.forEach(part => {\n              const cleanPart = part.trim();\n              if (cleanPart) {\n                let exists = false;\n                $container.find('.acu-alias-tag').each(function () {\n                  if ($(this).data('alias') === cleanPart) exists = true;\n                });\n                if (!exists) {\n                  const tagHtml = `<span class=\"acu-alias-tag\" data-alias=\"${escapeHtml(cleanPart)}\">${escapeHtml(cleanPart)} <i class=\"fa-solid fa-xmark\"></i></span>`;\n                  $(this).before(tagHtml);\n                }\n              }\n            });\n            $(this).val(lastPart);\n          }\n        });\n\n        // \n        $manager.on('paste', '.acu-alias-input', function (e) {\n          e.preventDefault();\n          const clipboardData = (e.originalEvent || e).clipboardData;\n          const pastedData = clipboardData.getData('text');\n          if (!pastedData) return;\n\n          const parts = pastedData.split(/[,\\n]/);\n          const $container = $(this).closest('.acu-alias-tags-container');\n\n          parts.forEach(part => {\n            const cleanPart = part.trim();\n            if (cleanPart) {\n              let exists = false;\n              $container.find('.acu-alias-tag').each(function () {\n                if ($(this).data('alias') === cleanPart) exists = true;\n              });\n              if (!exists) {\n                const tagHtml = `<span class=\"acu-alias-tag\" data-alias=\"${escapeHtml(cleanPart)}\">${escapeHtml(cleanPart)} <i class=\"fa-solid fa-xmark\"></i></span>`;\n                $(this).before(tagHtml);\n              }\n            }\n          });\n        });\n\n        // \n        $manager.on('click', '.acu-alias-tag i', function () {\n          $(this).parent().remove();\n        });\n\n        // \n        $manager.on('click', '.acu-alias-tags-container', function (e) {\n          if (e.target === this) {\n            $(this).find('.acu-alias-input').focus();\n          }\n        });\n\n        // \n        $manager.on('change', '.acu-avatar-file-input', async function (e) {\n          const file = e.target.files[0];\n          if (!file) return;\n\n          if (!file.type.startsWith('image/')) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          if (file.size > 5 * 1024 * 1024) {\n            if (window.toastr) window.toastr.warning(' 5MB');\n            return;\n          }\n\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n\n          try {\n            const success = await AvatarManager.saveLocalAvatar(name, file);\n            if (success) {\n              const newUrl = await LocalAvatarDB.get(name);\n              await refreshItem(name);\n\n              // \n              showAvatarCropModal(newUrl, name, async result => {\n                const data = AvatarManager.getAll()[name] || {};\n                AvatarManager.set(\n                  name,\n                  data.url || '',\n                  result.offsetX,\n                  result.offsetY,\n                  result.scale,\n                  data.aliases || [],\n                );\n                await refreshItem(name);\n                onUpdate && onUpdate();\n              });\n            }\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            if (window.toastr) window.toastr.error('');\n          }\n\n          $(this).val('');\n        });\n\n        // \"\"\n        $manager.on('click', '.acu-protagonist-toggle', function () {\n          const $btn = $(this);\n          const diceCfg = getDiceConfig();\n          const newValue = diceCfg.autoMergeProtagonist === false ? true : false;\n          saveDiceConfig({ autoMergeProtagonist: newValue });\n\n          $btn.toggleClass('active', newValue);\n          $btn.find('i').attr('class', `fa-solid ${newValue ? 'fa-link' : 'fa-link-slash'}`);\n\n          if (window.toastr) window.toastr.info(newValue ? '\"\"' : '\"\"');\n        });\n\n        // URL  \n        $manager.on('click', '.acu-avatar-save-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const url = $item.find('.acu-avatar-url').val().trim();\n\n          // \n          const aliases = [];\n          $item.find('.acu-alias-tag').each(function () {\n            aliases.push($(this).data('alias'));\n          });\n          // \n          const pendingAlias = $item.find('.acu-alias-input').val().trim();\n          if (pendingAlias && !aliases.includes(pendingAlias)) {\n            aliases.push(pendingAlias);\n          }\n\n          const data = AvatarManager.getAll()[name] || {};\n\n          // \n          AvatarManager.set(name, url, data.offsetX ?? 50, data.offsetY ?? 50, data.scale ?? 150, aliases);\n\n          // URL\n          const hasLocal = $item.attr('data-has-local') === 'true';\n          if (url && !hasLocal) {\n            await refreshItem(name);\n            showAvatarCropModal(url, name, async result => {\n              AvatarManager.set(name, url, result.offsetX, result.offsetY, result.scale, aliases);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          } else {\n            await refreshItem(name);\n            onUpdate && onUpdate();\n          }\n        });\n\n        // URL\n        $manager.on('click', '.acu-avatar-clear-all-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name') as string;\n\n          // URL\n          $item.find('.acu-avatar-url').val('');\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(name);\n          if (hasLocal) {\n            await LocalAvatarDB.delete(name);\n          }\n\n          // URL\n          const data = AvatarManager.getAll()[name] || {};\n          AvatarManager.set(name, '', data.offsetX ?? 50, data.offsetY ?? 50, data.scale ?? 150, data.aliases || []);\n\n          // \n          await refreshItem(name);\n          onUpdate && onUpdate();\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-clear-alias-btn', function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          $item.find('.acu-alias-tag').remove();\n          $item.find('.acu-alias-input').val('');\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-clear-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name') as string;\n\n          // {{user}} \n          if (name === '{{user}}') {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          // \n          const avatarData = AvatarManager.getAll()[name];\n          const aliases = avatarData?.aliases || [];\n          const tableRow = findCharacterInTable(name);\n          const relationships = findRelationshipReferences(name, aliases);\n\n          //  URL \n          let avatarUrl = '';\n          const hasLocal = await AvatarManager.hasLocalAvatar(name);\n          if (hasLocal) {\n            avatarUrl = (await LocalAvatarDB.get(name)) || '';\n          } else if (avatarData?.url) {\n            avatarUrl = avatarData.url;\n          }\n\n          // \n          showDeleteConfirmModal({ name, avatarUrl, tableRow, relationships }, () => executeCharacterDelete(name));\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-export-btn', function () {\n          const exportData = AvatarManager.exportData();\n          const jsonStr = JSON.stringify(exportData, null, 2);\n          const blob = new Blob([jsonStr], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `avatar-config-${new Date().toISOString().slice(0, 10)}.json`;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-import-btn', function () {\n          $manager.find('#acu-avatar-file-input').click();\n        });\n\n        $manager.on('change', '#acu-avatar-file-input', function (e) {\n          const file = e.target.files[0];\n          if (!file) return;\n\n          const reader = new FileReader();\n          reader.onload = function (evt) {\n            try {\n              const jsonData = JSON.parse(evt.target.result);\n              const analysis = AvatarManager.analyzeImport(jsonData);\n\n              if (!analysis.valid) {\n                if (window.toastr) window.toastr.error(analysis.error);\n                return;\n              }\n\n              showImportConfirmDialog(jsonData, analysis, () => {\n                $manager.remove();\n                showAvatarManager(nodeArr, onUpdate);\n                onUpdate && onUpdate();\n              });\n            } catch (err) {\n              console.error('[DICE]ACU :', err);\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n          reader.readAsText(file);\n          $(this).val('');\n        });\n      };\n\n      // \n      const closeManager = () => $manager.remove();\n      $manager.on('click', '.acu-avatar-close', closeManager);\n      setupOverlayClose($manager, 'acu-avatar-manager-overlay', closeManager);\n    } catch (error) {\n      console.error(':', error);\n      if (window.toastr) {\n        const errorMsg = error instanceof Error ? error.message : '';\n        window.toastr.error(`: ${errorMsg}`);\n      }\n      // DOM\n      $('.acu-avatar-manager-overlay').remove();\n    }\n  };\n\n  // \n  const clearDiceSystemCache = async (): Promise<void> => {\n    if (!('caches' in window)) {\n      console.log('[DICE] Cache API ');\n      return;\n    }\n\n    try {\n      const cacheNames = await caches.keys();\n      const urlPatterns = ['jsdelivr.net/gh/jerryzmtz/my-tavern-scripts', '/dist//'];\n\n      for (const cacheName of cacheNames) {\n        const cache = await caches.open(cacheName);\n        const requests = await cache.keys();\n\n        for (const request of requests) {\n          const url = request.url;\n          //  jsDelivr \n          if (urlPatterns.some(pattern => url.includes(pattern))) {\n            await cache.delete(request);\n            console.log('[DICE] :', url);\n          }\n        }\n      }\n      console.log('[DICE] ');\n    } catch (err) {\n      console.warn('[DICE] :', err);\n    }\n  };\n\n  // \n  const showManualUpdateDialog = () => {\n    const { $ } = getCore();\n    $('.acu-manual-update-overlay').remove();\n\n    const config = getConfig();\n\n    const dialogHtml = `\n    <div class=\"acu-manual-update-overlay acu-theme-${config.theme}\">\n      <div class=\"acu-manual-update-dialog\" style=\"background:var(--acu-bg-panel);border-color:var(--acu-border);\">\n        <div class=\"acu-manual-update-header\" style=\"background:var(--acu-table-head);color:var(--acu-text-main);border-color:var(--acu-border);\">\n          <i class=\"fa-solid fa-rotate\"></i> \n        </div>\n        <div class=\"acu-manual-update-body\" style=\"color:var(--acu-text-main);\">\n          <p style=\"color:var(--acu-text-main);\"></p>\n          <div class=\"acu-manual-update-safe-box\" style=\"background:var(--acu-btn-bg);border:1px solid var(--acu-border);\">\n            <i class=\"fa-solid fa-shield-check\" style=\"color:var(--acu-accent);\"></i>\n            <div class=\"safe-text\">\n              <strong style=\"color:var(--acu-text-main);\"></strong>\n              <span style=\"color:var(--acu-text-sub);\"></span>\n            </div>\n          </div>\n        </div>\n        <div class=\"acu-manual-update-footer\" style=\"background:var(--acu-table-head);border-color:var(--acu-border);\">\n          <button class=\"acu-manual-update-cancel-btn\" style=\"background:var(--acu-btn-bg);color:var(--acu-text-sub);border-color:var(--acu-border);\"></button>\n          <button class=\"acu-manual-update-confirm-btn\" style=\"background:var(--acu-accent);color:var(--acu-btn-active-text);\"></button>\n        </div>\n      </div>\n    </div>\n  `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    const overlayEl = $dialog[0];\n\n    // \n    $dialog.find('.acu-manual-update-cancel-btn').on('click', () => {\n      $dialog.remove();\n    });\n\n    $dialog.find('.acu-manual-update-confirm-btn').on('click', async () => {\n      const $btn = $dialog.find('.acu-manual-update-confirm-btn');\n      $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n\n      await clearDiceSystemCache();\n      //  Ctrl+Shift+R\n      if (window.parent !== window) {\n        window.parent.location.reload();\n      } else {\n        window.location.reload();\n      }\n    });\n\n    // \n    $dialog.on('click', e => {\n      if (e.target === overlayEl) {\n        $dialog.remove();\n      }\n    });\n  };\n\n  // \n  const showImportConfirmDialog = (jsonData, analysis, onComplete) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const config = getConfig();\n\n    const hasConflicts = analysis.conflicts.length > 0;\n    const conflictListHtml =\n      analysis.conflicts.length > 0\n        ? `<div style=\"max-height:80px;overflow-y:auto;background:rgba(0,0,0,0.1);border-radius:4px;padding:6px 8px;margin-top:6px;font-size:11px;color:var(--acu-text-sub);\">${analysis.conflicts.map(n => escapeHtml(n)).join(', ')}</div>`\n        : '';\n\n    const dialogHtml = `\n            <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-import-confirm-dialog\">\n                    <div class=\"acu-import-confirm-header\">\n                        <span class=\"acu-import-confirm-title\"><i class=\"fa-solid fa-file-import\"></i> </span>\n                        <button class=\"acu-import-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-import-confirm-body\">\n                        <div class=\"acu-import-stats\">\n                            <div class=\"acu-import-stat\">\n                                <span class=\"acu-stat-num\">${analysis.total}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-new\">\n                                <span class=\"acu-stat-num\">${analysis.newItems.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-conflict\">\n                                <span class=\"acu-stat-num\">${analysis.conflicts.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                        </div>\n\n                        ${\n                          hasConflicts\n                            ? `\n                            <div class=\"acu-import-conflict-section\">\n                                <div class=\"acu-import-warning\">\n                                    <i class=\"fa-solid fa-exclamation-triangle\"></i> \n                                </div>\n                                ${conflictListHtml}\n                                <div class=\"acu-import-conflict-options\">\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"overwrite\" checked />\n                                        <span></span>\n                                    </label>\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"skip\" />\n                                        <span></span>\n                                    </label>\n                                </div>\n                            </div>\n                        `\n                            : `\n                            <div class=\"acu-import-success\">\n                                <i class=\"fa-solid fa-check-circle\"></i> \n                            </div>\n                        `\n                        }\n                    </div>\n                    <div class=\"acu-import-confirm-footer\">\n                        <button class=\"acu-import-cancel-btn\"></button>\n                        <button class=\"acu-import-confirm-btn\"></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n            position: fixed !important;\n            top: 0 !important;\n            left: 0 !important;\n            right: 0 !important;\n            bottom: 0 !important;\n            width: 100vw !important;\n            height: 100vh !important;\n            background: rgba(0,0,0,0.6) !important;\n            z-index: 31300 !important;\n            display: flex;\n            justify-content: center !important;\n            align-items: center !important;\n            padding: 16px;\n            box-sizing: border-box !important;\n        `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(closeDialog);\n    $dialog.find('.acu-import-close-btn').click(closeDialog);\n    setupOverlayClose($dialog, 'acu-import-confirm-overlay', closeDialog);\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const overwrite = $dialog.find('input[name=\"conflict-mode\"]:checked').val() !== 'skip';\n      try {\n        const stats = AvatarManager.importData(jsonData, overwrite);\n        closeDialog();\n        onComplete && onComplete();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + err.message);\n      }\n    });\n  };\n  // []  ()\n  const showCardEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    let rawData = cachedRawData || getTableData() || loadSnapshot();\n\n    let displayRow = row;\n    // \n    if (rawData && rawData[tableKey] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n      displayRow = rawData[tableKey]?.content?.[rowIndex + 1];\n    }\n\n    const inputsHtml = displayRow\n      .map((cell, idx) => {\n        if (idx === 0) return ''; // \n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        //  textarea\n        return `\n                <div class=\"acu-card-edit-field\">\n                    <label class=\"acu-card-edit-label\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-card-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\">${escapeHtml(val)}</textarea>\n                </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content acu-settings-content-scroll\">\n                        ${inputsHtml}\n                    </div>\n                     <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-card-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-card-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // --- []  ---\n    const adjustHeight = el => {\n      //  auto  0px shrinking  scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    // -----------------------------\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-card-cancel').click(closeDialog);\n\n    //  + AI\n    dialog.find('#dlg-card-save').click(async () => {\n      let rawData = cachedRawData || getTableData() || loadSnapshot();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n        if (hasChanges) {\n          try {\n            //  saveRowInstantly  + \n            await saveRowInstantly(tableKey, rowIndex, [...currentRow]);\n            renderInterface();\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            // \n            return;\n          }\n        }\n      }\n      closeDialog();\n    });\n    // \n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n    // \n    dialog.on('click', function (e) {\n      if ($(e.target).closest('#dlg-close-x, #dlg-close, .acu-close-btn').length) {\n        closeDialog();\n      }\n    });\n  };\n\n  // [] \n  let _configCache = null;\n  const getConfig = () => {\n    if (!_configCache) _configCache = { ...DEFAULT_CONFIG, ...Store.get(STORAGE_KEY_UI_CONFIG, {}) };\n    return _configCache;\n  };\n  const saveConfig = newCfg => {\n    _configCache = { ...getConfig(), ...newCfg };\n    Store.set(STORAGE_KEY_UI_CONFIG, _configCache);\n    const fontVal = applyConfigStyles(_configCache);\n    injectDatabaseStyles(_configCache.theme, fontVal);\n    setDatabaseToastMute(_configCache.muteDatabaseToasts === true);\n  };\n\n  const generateDiffMap = currentData => {\n    const lastData = loadSnapshot();\n    const diffSet = new Set();\n    if (!lastData) return diffSet;\n\n    for (const sheetId in currentData) {\n      const newSheet = currentData[sheetId];\n      const oldSheet = lastData[sheetId];\n      if (!newSheet || !newSheet.name) continue;\n      const tableName = newSheet.name;\n\n      if (!oldSheet) {\n        // \n        if (newSheet.content) {\n          newSheet.content.forEach((row, rIdx) => {\n            if (rIdx > 0) diffSet.add(`${tableName}-row-${rIdx - 1}`);\n          });\n        }\n        continue;\n      }\n\n      const newRows = newSheet.content || [];\n      const oldRows = oldSheet.content || [];\n\n      // [] \n      // : {  -> [{index, row}, ...] } ()\n      const oldRowMap = new Map();\n      oldRows.forEach((row, rIdx) => {\n        if (rIdx === 0) return; // \n        const title = String(row[1] ?? '').trim();\n        if (title) {\n          if (!oldRowMap.has(title)) {\n            oldRowMap.set(title, []);\n          }\n          oldRowMap.get(title).push({ index: rIdx, row: row });\n        }\n      });\n\n      // \n      const matchedOldIndices = new Set();\n\n      // \n      newRows.forEach((row, rIdx) => {\n        if (rIdx === 0) return; // \n        const title = String(row[1] ?? '').trim();\n\n        let matchedOldRow = null;\n\n        if (title && oldRowMap.has(title)) {\n          // \n          const candidates = oldRowMap.get(title);\n          if (candidates.length > 0) {\n            const matched = candidates.shift(); // \n            matchedOldRow = matched.row;\n            matchedOldIndices.add(matched.index);\n            if (candidates.length === 0) {\n              oldRowMap.delete(title);\n            }\n          }\n        }\n\n        if (!matchedOldRow && !title) {\n          // \n          const oldRow = oldRows[rIdx];\n          if (oldRow && !matchedOldIndices.has(rIdx)) {\n            matchedOldRow = oldRow;\n            matchedOldIndices.add(rIdx);\n          }\n        }\n\n        if (!matchedOldRow) {\n          // \n          diffSet.add(`${tableName}-row-${rIdx - 1}`);\n        } else {\n          // \n          row.forEach((cell, cIdx) => {\n            if (cIdx === 0) return; // \n            const oldCell = matchedOldRow[cIdx];\n            if (String(cell ?? '') !== String(oldCell ?? '')) {\n              diffSet.add(`${tableName}-${rIdx - 1}-${cIdx}`);\n            }\n          });\n        }\n      });\n    }\n    return diffSet;\n  };\n\n  const applyConfigStyles = config => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    const fontVal = FONTS.find(f => f.id === config.fontFamily)?.val || FONTS[0].val;\n\n    // []  ID  Style \n    const $styleTag = $('#acu-dynamic-font');\n    const currentFontId = $styleTag.data('font-id');\n\n    if (currentFontId !== config.fontFamily) {\n      $styleTag.remove();\n      const fontImport = `\n                @import url(\"https://fontsapi.zeoseven.com/3/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/442/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/256/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/482/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/446/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/570/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/292/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/69/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/7/main/result.css\");\n            `;\n      $('head').append(`\n                <style id=\"acu-dynamic-font\" data-font-id=\"${config.fontFamily}\">\n                    ${fontImport}\n                    .acu-wrapper, .acu-edit-dialog, .acu-cell-menu, .acu-nav-container, .acu-data-card, .acu-panel-title, .acu-settings-label, .acu-btn-block, .acu-nav-btn, .acu-edit-textarea,\n                    .acu-dice-panel, .acu-contest-panel, .acu-dice-config-dialog,\n                    .acu-relation-graph-container, .acu-avatar-manager, .acu-import-confirm-dialog,\n                    .acu-embedded-options-container, .acu-option-panel, .acu-opt-btn {\n                        font-family: ${fontVal} !important;\n                    }\n                </style>\n            `);\n    }\n\n    // []  CSS \n    const cssVars = {\n      '--acu-card-width': `${config.cardWidth}px`,\n      '--acu-font-size': `${config.fontSize}px`,\n      '--acu-opt-font-size': `${config.optionFontSize || 12}px`,\n      '--acu-grid-cols': config.gridColumns,\n    };\n\n    if ($wrapper.length) {\n      $wrapper.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $wrapper.addClass(`acu-theme-${config.theme}`);\n      $wrapper.css(cssVars);\n    }\n\n    const $optContainer = $('.acu-embedded-options-container');\n    if ($optContainer.length) {\n      $optContainer.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $optContainer.addClass(`acu-theme-${config.theme}`);\n      $optContainer.css(cssVars);\n    }\n\n    return fontVal;\n  };\n\n  /**\n   * \n   *\n   * CSS  ./styles.ts \n   *  styles.ts  MAIN_STYLES \n   *\n   * @see ./styles.ts - MAIN_STYLES \n   */\n  const addStyles = () => {\n    if (window._acuStylesInjected && $(`#${SCRIPT_ID}-styles`).length) return;\n    window._acuStylesInjected = true;\n    const { $ } = getCore();\n\n    //  Tabler Icons  ti:xxx \n    if (!$('#tabler-icons-css').length) {\n      $('head').append(\n        '<link id=\"tabler-icons-css\" rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css\">',\n      );\n    }\n\n    $('style').each(function () {\n      if (this.id && this.id.startsWith('acu_') && this.id.endsWith('-styles') && this.id !== `${SCRIPT_ID}-styles`)\n        $(this).remove();\n    });\n    $(`#${SCRIPT_ID}-styles`).remove();\n    const styles = `<style id=\"${SCRIPT_ID}-styles\">${MAIN_STYLES}</style>`;\n    $('head').append(styles);\n  };\n\n  const getTableData = () => {\n    const api = getCore().getDB();\n    if (!api || !api.exportTableAsJson) {\n      console.warn('[DICE] API ');\n      return null;\n    }\n    try {\n      const data = api.exportTableAsJson();\n      if (data) {\n        const sheetCount = Object.keys(data).filter(k => k.startsWith('sheet_')).length;\n        console.info(`[DICE] ${sheetCount} `);\n      }\n      return data;\n    } catch (e) {\n      console.error('[DICE]:', e);\n      return null;\n    }\n  };\n\n  type DbChatMessage = {\n    is_user?: boolean;\n    TavernDB_ACU_IsolatedData?: unknown;\n    TavernDB_ACU_Identity?: unknown;\n    TavernDB_ACU_IndependentData?: unknown;\n    TavernDB_ACU_ModifiedKeys?: unknown;\n    TavernDB_ACU_UpdateGroupKeys?: unknown;\n    TavernDB_ACU_Data?: unknown;\n    TavernDB_ACU_SummaryData?: unknown;\n  };\n\n  const getDbChatMessages = (): DbChatMessage[] | null => {\n    const st = window.SillyTavern || window.parent?.SillyTavern;\n    const rawChat = st?.chat;\n    return Array.isArray(rawChat) ? (rawChat as DbChatMessage[]) : null;\n  };\n\n  const parseIsolatedData = (value: unknown): Record<string, unknown> | null => {\n    if (!value) return null;\n    if (typeof value === 'string') {\n      try {\n        const parsed = JSON.parse(value);\n        if (parsed && typeof parsed === 'object') return parsed as Record<string, unknown>;\n      } catch {\n        return null;\n      }\n      return null;\n    }\n    if (typeof value === 'object') return value as Record<string, unknown>;\n    return null;\n  };\n\n  const hasSheetKeys = (value: unknown): boolean => {\n    if (!value || typeof value !== 'object') return false;\n    return Object.keys(value as Record<string, unknown>).some(key => key.startsWith('sheet_'));\n  };\n\n  const hasDbPayload = (msg: DbChatMessage): boolean => {\n    if (hasSheetKeys(msg.TavernDB_ACU_IndependentData)) return true;\n    if (hasSheetKeys(msg.TavernDB_ACU_Data)) return true;\n    if (hasSheetKeys(msg.TavernDB_ACU_SummaryData)) return true;\n    const isolated = parseIsolatedData(msg.TavernDB_ACU_IsolatedData);\n    if (!isolated) return false;\n    return Object.values(isolated).some(tagData => {\n      if (!tagData || typeof tagData !== 'object') return false;\n      const data = (tagData as Record<string, unknown>).independentData;\n      return hasSheetKeys(data);\n    });\n  };\n\n  const findLatestDbMessageIndex = (includeUser = false): number => {\n    const chat = getDbChatMessages();\n    if (!chat) return -1;\n    for (let i = chat.length - 1; i >= 0; i--) {\n      const msg = chat[i];\n      if (!includeUser && msg?.is_user) continue;\n      if (hasDbPayload(msg)) return i;\n    }\n    return -1;\n  };\n\n  const resolveIsolationKey = (msg: DbChatMessage, isolated: Record<string, unknown> | null): string | null => {\n    if (typeof msg?.TavernDB_ACU_Identity === 'string') {\n      const identity = msg.TavernDB_ACU_Identity;\n      if (isolated && Object.prototype.hasOwnProperty.call(isolated, identity)) return identity;\n    }\n    if (isolated && Object.prototype.hasOwnProperty.call(isolated, '')) return '';\n    if (isolated) {\n      const keys = Object.keys(isolated);\n      if (keys.length === 1) return keys[0];\n    }\n    return null;\n  };\n\n  const relocateDbPayloadToAnchor = async (anchorIndex: number): Promise<void> => {\n    if (anchorIndex < 0) return;\n    const chat = getDbChatMessages();\n    if (!chat || anchorIndex >= chat.length) return;\n    const latestIndex = findLatestDbMessageIndex(true);\n    if (latestIndex < 0 || latestIndex === anchorIndex) return;\n\n    const source = chat[latestIndex];\n    const target = chat[anchorIndex];\n    if (!source || !target) return;\n    if (target.is_user && !hasDbPayload(target)) return;\n\n    let moved = false;\n\n    const sourceIsolated = parseIsolatedData(source.TavernDB_ACU_IsolatedData);\n    if (sourceIsolated) {\n      const targetIsolated = parseIsolatedData(target.TavernDB_ACU_IsolatedData) || {};\n      const isolationKey = resolveIsolationKey(source, sourceIsolated);\n      if (isolationKey !== null) {\n        if (Object.prototype.hasOwnProperty.call(sourceIsolated, isolationKey)) {\n          targetIsolated[isolationKey] = sourceIsolated[isolationKey];\n          const nextSource = { ...sourceIsolated };\n          delete nextSource[isolationKey];\n          if (Object.keys(nextSource).length > 0) {\n            source.TavernDB_ACU_IsolatedData = nextSource;\n          } else {\n            delete source.TavernDB_ACU_IsolatedData;\n          }\n          target.TavernDB_ACU_IsolatedData = targetIsolated;\n          moved = true;\n        }\n      } else {\n        target.TavernDB_ACU_IsolatedData = sourceIsolated;\n        delete source.TavernDB_ACU_IsolatedData;\n        moved = true;\n      }\n    }\n\n    if (source.TavernDB_ACU_Identity !== undefined) {\n      target.TavernDB_ACU_Identity = source.TavernDB_ACU_Identity;\n      delete source.TavernDB_ACU_Identity;\n      moved = true;\n    }\n    if (source.TavernDB_ACU_IndependentData !== undefined) {\n      target.TavernDB_ACU_IndependentData = source.TavernDB_ACU_IndependentData;\n      delete source.TavernDB_ACU_IndependentData;\n      moved = true;\n    }\n    if (source.TavernDB_ACU_ModifiedKeys !== undefined) {\n      target.TavernDB_ACU_ModifiedKeys = source.TavernDB_ACU_ModifiedKeys;\n      delete source.TavernDB_ACU_ModifiedKeys;\n      moved = true;\n    }\n    if (source.TavernDB_ACU_UpdateGroupKeys !== undefined) {\n      target.TavernDB_ACU_UpdateGroupKeys = source.TavernDB_ACU_UpdateGroupKeys;\n      delete source.TavernDB_ACU_UpdateGroupKeys;\n      moved = true;\n    }\n    if (source.TavernDB_ACU_Data !== undefined) {\n      target.TavernDB_ACU_Data = source.TavernDB_ACU_Data;\n      delete source.TavernDB_ACU_Data;\n      moved = true;\n    }\n    if (source.TavernDB_ACU_SummaryData !== undefined) {\n      target.TavernDB_ACU_SummaryData = source.TavernDB_ACU_SummaryData;\n      delete source.TavernDB_ACU_SummaryData;\n      moved = true;\n    }\n\n    if (moved) {\n      await triggerSlash('savechat');\n    }\n  };\n\n  const saveDataToDatabase = async (tableData, skipRender = false, commitDeletes = false) => {\n    if (isSaving) {\n      console.warn('[DICE]');\n      return; // \n    }\n    console.info('[DICE]...');\n    isSaving = true;\n    const { $ } = getCore();\n    const $saveBtn = $('#acu-btn-save-global');\n\n    // UI \n    if (!skipRender && $saveBtn.length) {\n      $saveBtn.find('i').removeClass('fa-save').addClass('fa-spinner fa-spin');\n      $saveBtn.prop('disabled', true);\n    }\n\n    try {\n      // 1.  sheet_  ( = )\n      const dataToSave = {};\n      //  mate \n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // 2.  ()\n      if (commitDeletes) {\n        const deletions = getPendingDeletions();\n        Object.keys(deletions).forEach(key => {\n          if (dataToSave[key] && dataToSave[key].content) {\n            deletions[key]\n              .sort((a, b) => b - a)\n              .forEach(idx => {\n                if (dataToSave[key].content[idx + 1]) dataToSave[key].content.splice(idx + 1, 1);\n              });\n          }\n        });\n      }\n\n      // 3. \n      let jsonString;\n      try {\n        jsonString = JSON.stringify(dataToSave);\n        //  10MB \n        const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n        if (sizeInMB > 10) {\n          throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n        }\n        console.info(`[DICE]: ${sizeInMB.toFixed(2)}MB`);\n      } catch (stringifyError) {\n        console.error('[DICE]ACU JSON :', stringifyError);\n        throw new Error(`: ${stringifyError.message || stringifyError}`);\n      }\n\n      // 4.  API  ()\n      const api = getCore().getDB();\n      if (!api || !api.importTableAsJson) {\n        throw new Error(' API ');\n      }\n      const anchorIndex = findLatestDbMessageIndex();\n\n      try {\n        //  importTableAsJson saveChat()\n        //  saveChat()  \"Settings could not be saved\" \n        const result = await api.importTableAsJson(jsonString);\n        //  false \n        if (result === false) {\n          throw new Error(' false');\n        }\n        await relocateDbPayloadToAnchor(anchorIndex);\n        console.info('[DICE]');\n      } catch (apiError) {\n        console.error('[DICE]ACU API :', apiError);\n        //  \"Settings could not be saved\" \n        const errorMsg = apiError.message || String(apiError);\n        if (\n          errorMsg.includes('Settings could not be saved') ||\n          errorMsg.includes('server connection') ||\n          errorMsg.includes('data loss')\n        ) {\n          throw new Error('');\n        }\n        throw new Error(`: ${errorMsg}`);\n      }\n\n      // 5. \n      cachedRawData = dataToSave;\n      saveSnapshot(dataToSave);\n      hasUnsavedChanges = false;\n      currentDiffMap = new Set();\n      if (window.acuModifiedSet) window.acuModifiedSet.clear();\n      console.info('[DICE]');\n\n      if (!skipRender) {\n        renderInterface();\n      }\n    } catch (e) {\n      const errorMessage = e.message || '';\n      console.error('[DICE]:', {\n        error: e,\n        message: errorMessage,\n        stack: e.stack,\n      });\n      if (window.toastr) {\n        window.toastr.error(errorMessage, '', { timeOut: 5000 });\n      } else {\n        alert(`: ${errorMessage}`);\n      }\n      // \n      throw e;\n    } finally {\n      isSaving = false;\n      console.info('[DICE]');\n      if (!skipRender && $saveBtn.length) {\n        $saveBtn.find('i').removeClass('fa-spinner fa-spin').addClass('fa-save');\n        $saveBtn.prop('disabled', false);\n      }\n    }\n  };\n\n  // [] \n  // \n  const saveDataOnly = async (tableData, modifiedSheetKeys?: string[]) => {\n    // \n    const saveOperation = saveQueue\n      .then(async () => {\n        try {\n          const dataToSave = {};\n          if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n          else dataToSave.mate = tableData.mate;\n\n          Object.keys(tableData).forEach(k => {\n            if (k.startsWith('sheet_')) {\n              dataToSave[k] = tableData[k];\n            }\n          });\n\n          // \n          let jsonString;\n          try {\n            jsonString = JSON.stringify(dataToSave);\n            //  10MB \n            const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n            if (sizeInMB > 10) {\n              throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n            }\n          } catch (stringifyError) {\n            console.error('[DICE]ACU JSON :', stringifyError);\n            throw new Error(`: ${stringifyError.message || stringifyError}`);\n          }\n\n          const api = getCore().getDB();\n          if (!api || !api.importTableAsJson) {\n            throw new Error(' API ');\n          }\n          const anchorIndex = findLatestDbMessageIndex();\n\n          try {\n            //  importTableAsJson saveChat()\n            const result = await api.importTableAsJson(jsonString);\n            //  false \n            if (result === false) {\n              throw new Error(' false');\n            }\n            await relocateDbPayloadToAnchor(anchorIndex);\n          } catch (apiError) {\n            console.error('[DICE]ACU API :', apiError);\n            //  \"Settings could not be saved\" \n            const errorMsg = apiError.message || String(apiError);\n            if (\n              errorMsg.includes('Settings could not be saved') ||\n              errorMsg.includes('server connection') ||\n              errorMsg.includes('data loss')\n            ) {\n              throw new Error('');\n            }\n            throw new Error(`: ${errorMsg}`);\n          }\n\n          cachedRawData = dataToSave;\n          //  saveSnapshot() hasUnsavedChanges\n        } catch (e) {\n          console.error('[DICE]ACU saveDataOnly error:', e);\n          // \n          throw e;\n        }\n      })\n      .catch(e => {\n        // \n        console.error('[DICE]ACU saveDataOnly queue error:', e);\n      });\n\n    // \n    saveQueue = saveOperation;\n    return saveOperation;\n  };\n\n  // [] \n  // AI\n  //  saveDataToDatabase\n  const saveRowInstantly = async (tableKey: string, rowIndex: number, newRowData: unknown[]): Promise<void> => {\n    try {\n      // 1. \n      const rawData = cachedRawData || getTableData();\n      if (!rawData || !rawData[tableKey]) {\n        throw new Error(` \"${tableKey}\" `);\n      }\n      if (!rawData[tableKey].content) {\n        throw new Error(` \"${tableKey}\" `);\n      }\n\n      // 2. rowIndex 0content[0] \n      rawData[tableKey].content[rowIndex + 1] = newRowData;\n\n      // 3. \n      await saveDataOnly(rawData, [tableKey]);\n\n      // 4. \n      const snapshot = loadSnapshot();\n      if (snapshot && snapshot[tableKey] && snapshot[tableKey].content) {\n        snapshot[tableKey].content[rowIndex + 1] = [...newRowData];\n        saveSnapshot(snapshot);\n      }\n    } catch (e) {\n      const errorMsg = e instanceof Error ? e.message : String(e);\n      console.error('[DICE]ACU saveRowInstantly error:', e);\n      toastr.error(`: ${errorMsg}`);\n      throw e;\n    }\n  };\n\n  const processJsonData = json => {\n    const tables = {};\n    if (!json || typeof json !== 'object') return tables;\n    for (const sheetId in json) {\n      if (json[sheetId]?.name) {\n        const sheet = json[sheetId];\n        tables[sheet.name] = {\n          key: sheetId,\n          headers: sheet.content ? sheet.content[0] || [] : [],\n          rows: sheet.content ? sheet.content.slice(1) : [],\n          rawContent: sheet.content || [],\n          exportConfig: sheet.exportConfig || {},\n          updateConfig: sheet.updateConfig || {},\n          ...sheet,\n        };\n      }\n    }\n    return tables;\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function suggestFormatValue(pattern, rowIndex, existingValues = [], tableContent = null) {\n    if (!pattern || rowIndex === undefined || rowIndex < 0) return null;\n\n    try {\n      //  \"+\"  ^AM\\d{3}$\n      // pattern  JavaScript  '^AM\\\\d{3}$' '^AM\\d{3}$'\n      //  \\d{3} /\\\\d\\{3\\}/+d\n      // ^?[]+\\d\\{\\}$?\n      const prefixMatch = pattern.match(/^\\^?([A-Za-z]+)\\\\d\\{(\\d+)\\}\\$?$/);\n\n      if (prefixMatch) {\n        const prefix = prefixMatch[1]; // \"AM\"\n        const digits = parseInt(prefixMatch[2], 10); // 3\n\n        // \n        if (tableContent && (tableContent.name === '' || tableContent.name === '')) {\n          const headers = tableContent.content?.[0] || [];\n          const rows = tableContent.content?.slice(1) || [];\n          const codeIndex = headers.indexOf('');\n\n          if (codeIndex >= 0) {\n            // \n            const existingNumbers = [];\n            rows.forEach(row => {\n              const codeValue = row?.[codeIndex];\n              if (codeValue && typeof codeValue === 'string') {\n                const match = codeValue.match(new RegExp(`^${prefix}(\\\\d+)$`));\n                if (match) {\n                  const num = parseInt(match[1], 10);\n                  if (!isNaN(num)) existingNumbers.push(num);\n                }\n              }\n            });\n\n            // \n            const maxNum = existingNumbers.length > 0 ? Math.max(...existingNumbers) : 0;\n            const nextNum = String(maxNum + 1).padStart(digits, '0');\n            return prefix + nextNum;\n          }\n        }\n\n        // \n        const nextNum = String(rowIndex + 1).padStart(digits, '0');\n        return prefix + nextNum;\n      }\n\n      //  \\d{3} \n      const numOnlyMatch = pattern.match(/^\\^?\\\\d\\{(\\d+)\\}\\$?$/);\n      if (numOnlyMatch) {\n        const digits = parseInt(numOnlyMatch[1], 10);\n        return String(rowIndex + 1).padStart(digits, '0');\n      }\n    } catch (e) {\n      console.error('[DICE]ACU :', e);\n    }\n\n    return null; // \n  }\n\n  //  OR \n  function getRelationOptions(refTable, refColumns, rawData) {\n    const options = new Set();\n    if (!refTable || !refColumns || !rawData) return Array.from(options);\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        columns.forEach(col => {\n          const colIdx = headers.indexOf(col);\n          if (colIdx >= 0) {\n            rows.forEach(row => {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                options.add(String(value).trim());\n              }\n            });\n          }\n        });\n\n        break; // \n      }\n    }\n\n    return Array.from(options).sort();\n  }\n\n  // \n  function isValueInRelationTable(value, refTable, refColumns, rawData) {\n    if (!value || !refTable || !refColumns || !rawData) return false;\n    if (String(value).trim() === '') return false;\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n    const strVal = String(value).trim();\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        for (const col of columns) {\n          const colIdx = headers.indexOf(col);\n          if (colIdx === -1) continue;\n\n          // \n          for (let i = 0; i < rows.length; i++) {\n            const cellValue = rows[i]?.[colIdx];\n            if (cellValue !== null && cellValue !== undefined && String(cellValue).trim() === strVal) {\n              return true; // \n            }\n          }\n        }\n\n        break; // \n      }\n    }\n\n    return false; // \n  }\n\n  //  required \n  function getColumnExamples(tableName, columnName, currentRowIndex, rawData, maxCount = 5) {\n    const examples = new Set();\n    if (!tableName || !columnName || !rawData) return [];\n\n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === tableName) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n        const colIdx = headers.indexOf(columnName);\n\n        if (colIdx >= 0) {\n          rows.forEach((row, idx) => {\n            if (idx !== currentRowIndex) {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                examples.add(String(value).trim());\n              }\n            }\n          });\n        }\n        break;\n      }\n    }\n\n    return Array.from(examples).slice(0, maxCount);\n  }\n\n  // \n  function getNearestValidNumber(currentValue, min, max) {\n    const num = parseFloat(currentValue);\n    if (isNaN(num)) return min !== undefined ? min : 0;\n    if (min !== undefined && num < min) return min;\n    if (max !== undefined && num > max) return max;\n    return num;\n  }\n\n  // ========================================\n  // []  - \n  // ========================================\n  const refreshRegexRulesList = () => {\n    const { $ } = getCore();\n    const dialog = $('.acu-settings-dialog');\n    if (!dialog.length) return;\n\n    const $rulesList = dialog.find('#regex-rules-list');\n    if (!$rulesList.length) return;\n\n    // HTML\n    const rules = RegexTransformationManager.getAllRules();\n    const html = rules\n      .map(rule => {\n        const scopeIcon =\n          rule.scope.type === 'global' ? 'fa-globe' : rule.scope.type === 'table' ? 'fa-table' : 'fa-columns';\n        const scopeText =\n          rule.scope.type === 'global'\n            ? ''\n            : rule.scope.type === 'table'\n              ? rule.scope.tableNames?.join(',')\n              : `${rule.scope.tableNames?.join(',')}.${rule.scope.columnNames?.join(',')}`;\n        return `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n              <div class=\"acu-rule-type-icon\" title=\": ${escapeHtml(rule.scope.type)}\">\n                  <i class=\"fa-solid ${scopeIcon}\"></i>\n              </div>\n              <div class=\"acu-rule-info\">\n                  <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                  <div class=\"acu-rule-target\" style=\"font-size:10px;\">${escapeHtml(scopeText)} | ${escapeHtml(rule.operation)}</div>\n              </div>\n              <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n              <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                  <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n              </div>\n              <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n      `;\n      })\n      .join('');\n\n    // HTML,\n    $rulesList.html(html);\n  };\n\n  // ========================================\n  // /\n  // ========================================\n  const showAddValidationRuleModal = (parentDialog: JQuery, editRuleId?: string) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const tables = processJsonData(rawData || {});\n    const tableNames = Object.keys(tables);\n\n    // \n    const isEditMode = !!editRuleId;\n    const existingRule = isEditMode ? ValidationRuleManager.getRule(editRuleId) : null;\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\" ${isEditMode ? 'style=\"opacity:0;transition:opacity 0.15s ease-in;\"' : ''}>\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-dice-cfg-header\">\n            <span><i class=\"fa-solid ${isEditMode ? 'fa-pen' : 'fa-plus'}\"></i> ${isEditMode ? '' : ''}</span>\n            <button class=\"acu-config-close\" id=\"dlg-rule-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-table\" class=\"acu-setting-select\">\n                <option value=\"\">...</option>\n                ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"row-column\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-column\" class=\"acu-setting-select\" disabled>\n                <option value=\"\">...</option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-type\" class=\"acu-setting-select\">\n                <optgroup label=\"  \">\n                  <option value=\"tableReadonly\"></option>\n                  <option value=\"rowLimit\"></option>\n                  <option value=\"sequence\"></option>\n                </optgroup>\n                <optgroup label=\"  \">\n                  <option value=\"required\"></option>\n                  <option value=\"format\"></option>\n                  <option value=\"enum\"></option>\n                  <option value=\"numeric\"></option>\n                  <option value=\"relation\"></option>\n                  <option value=\"keyValue\"></option>\n                </optgroup>\n              </select>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-tableReadonly\">\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ,\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-rowLimit\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-max\" class=\"acu-panel-input\" placeholder=\"\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-sequence\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-sequence-prefix\" class=\"acu-panel-input\" placeholder=\"AM\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-sequence-start\" class=\"acu-panel-input\" placeholder=\"1\" value=\"1\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-sequence-paired-table\" class=\"acu-setting-select\" style=\"flex:1;\">\n                  <option value=\"\"></option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> \"+\"(AM0001, AM0002, AM0003...),<br>\n                <i class=\"fa-solid fa-link\" style=\"margin-top:4px;display:block;color:var(--acu-warning-icon);margin-right:6px;\"></i> ,,\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-required\" style=\"display:none;\">\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-format\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-pattern\" class=\"acu-panel-input\" placeholder=\"^AM\\\\d{3}$\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-enum\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-values\" class=\"acu-panel-input\" placeholder=\",,\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-numeric\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-relation\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-table\" class=\"acu-setting-select\">\n                  <option value=\"\">...</option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-column\" class=\"acu-setting-select\" multiple style=\"flex:1;min-height:80px;\">\n                  <option value=\"\">...</option>\n                </select>\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ,(OR ) Ctrl/Cmd \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-keyValue\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-keyvalue-type\" class=\"acu-setting-select\">\n                  <option value=\"text\"></option>\n                  <option value=\"numeric\"></option>\n                </select>\n              </div>\n              <div class=\"acu-setting-row\" id=\"row-keyvalue-range\" style=\"display:none;\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ::;:(,)\n              </div>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-error-msg\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n          </div>\n          <div class=\"acu-dice-cfg-actions\">\n            <button id=\"dlg-rule-cancel\"></button>\n            <button id=\"dlg-rule-save\">${isEditMode ? '' : ''}</button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // select\n    const updateSelectColor = $select => {\n      const val = $select.val();\n      if (!val || val === '') {\n        $select.css('color', 'var(--acu-text-sub)');\n        $select.css('opacity', '0.7');\n      } else {\n        $select.css('color', 'var(--acu-text-main)');\n        $select.css('opacity', '1');\n      }\n    };\n\n    // select\n    dialog.find('select').each(function () {\n      updateSelectColor($(this));\n      $(this).on('change', function () {\n        updateSelectColor($(this));\n      });\n    });\n\n    // \n    dialog.find('#rule-table').on('change', function () {\n      const tableName = $(this).val();\n      const $colSelect = dialog.find('#rule-column');\n      const $pairedTableSelect = dialog.find('#cfg-sequence-paired-table');\n      updateSelectColor($(this));\n\n      // \n      if ($pairedTableSelect.length > 0) {\n        const currentPairedValue = $pairedTableSelect.val();\n        $pairedTableSelect.empty();\n        $pairedTableSelect.append('<option value=\"\"></option>');\n        tableNames\n          .filter(name => name !== tableName)\n          .forEach(name => {\n            $pairedTableSelect.append(`<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`);\n          });\n        // \n        if (currentPairedValue && currentPairedValue !== tableName) {\n          $pairedTableSelect.val(currentPairedValue);\n        }\n        updateSelectColor($pairedTableSelect);\n      }\n\n      if (!tableName || !tables[tableName]) {\n        $colSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($colSelect);\n        return;\n      }\n\n      const headers = tables[tableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $colSelect.html('<option value=\"\">...</option>' + options).prop('disabled', false);\n      updateSelectColor($colSelect);\n    });\n\n    // \n    dialog.find('#cfg-ref-table').on('change', function () {\n      const refTableName = $(this).val();\n      const $refColSelect = dialog.find('#cfg-ref-column');\n      updateSelectColor($(this));\n\n      if (!refTableName || !tables[refTableName]) {\n        $refColSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($refColSelect);\n        return;\n      }\n\n      const headers = tables[refTableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $refColSelect.html(options).prop('disabled', false);\n      updateSelectColor($refColSelect);\n    });\n\n    // \n    dialog.find('#rule-type').on('change', function () {\n      const type = $(this).val();\n      const typeInfo = RULE_TYPE_INFO[type];\n      const isTableRule = typeInfo?.scope === 'table';\n      updateSelectColor($(this));\n\n      // \n      dialog.find('.acu-rule-config-section').hide();\n      dialog.find('#config-' + type).show();\n\n      // sequence\n      if (isTableRule && type !== 'sequence') {\n        dialog.find('#row-column').hide();\n        dialog.find('#rule-column').val('').prop('disabled', true);\n      } else {\n        dialog.find('#row-column').show();\n        // \n        if (dialog.find('#rule-table').val()) {\n          dialog.find('#rule-column').prop('disabled', false);\n        }\n      }\n    });\n\n    // /\n    dialog.find('#cfg-keyvalue-type').on('change', function () {\n      const valueType = $(this).val();\n      if (valueType === 'numeric') {\n        dialog.find('#row-keyvalue-range').show();\n      } else {\n        dialog.find('#row-keyvalue-range').hide();\n      }\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#dlg-rule-close, #dlg-rule-cancel', function (e) {\n      e.stopPropagation(); // \n      closeDialog();\n    });\n    setupOverlayClose(dialog, 'acu-validation-modal-overlay', () => {\n      closeDialog();\n    });\n\n    // \n    dialog.find('#dlg-rule-save').on('click', function () {\n      const name = dialog.find('#rule-name').val()?.trim();\n      const targetTable = dialog.find('#rule-table').val();\n      const targetColumn = dialog.find('#rule-column').val();\n      const ruleType = dialog.find('#rule-type').val();\n      const errorMessage = dialog.find('#rule-error-msg').val()?.trim();\n      const typeInfo = RULE_TYPE_INFO[ruleType];\n      const isTableRule = typeInfo?.scope === 'table';\n\n      // \n      if (!name) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!targetTable) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      // sequence\n      if ((!isTableRule || ruleType === 'sequence') && !targetColumn) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      const ruleConfig = {};\n      if (ruleType === 'tableReadonly') {\n        // \n      } else if (ruleType === 'rowLimit') {\n        const min = dialog.find('#cfg-row-min').val();\n        const max = dialog.find('#cfg-row-max').val();\n        if (min !== '') ruleConfig.min = parseInt(min, 10);\n        if (max !== '') ruleConfig.max = parseInt(max, 10);\n      } else if (ruleType === 'required') {\n        // \n      } else if (ruleType === 'format') {\n        const pattern = dialog.find('#cfg-pattern').val()?.trim();\n        if (!pattern) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        // \n        try {\n          new RegExp(pattern);\n        } catch (e) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n        ruleConfig.pattern = pattern;\n      } else if (ruleType === 'enum') {\n        const valuesStr = dialog.find('#cfg-values').val()?.trim();\n        if (!valuesStr) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        ruleConfig.values = valuesStr\n          .split(',')\n          .map(v => v.trim())\n          .filter(v => v);\n      } else if (ruleType === 'numeric') {\n        const min = dialog.find('#cfg-min').val();\n        const max = dialog.find('#cfg-max').val();\n        if (min !== '') ruleConfig.min = parseFloat(min);\n        if (max !== '') ruleConfig.max = parseFloat(max);\n      } else if (ruleType === 'relation') {\n        const refTable = dialog.find('#cfg-ref-table').val();\n        const refColumns = dialog.find('#cfg-ref-column').val(); // \n\n        if (!refTable) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        const selectedColumns = Array.isArray(refColumns) ? refColumns : refColumns ? [refColumns] : [];\n        if (selectedColumns.length === 0 || (selectedColumns.length === 1 && !selectedColumns[0])) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        ruleConfig.refTable = refTable;\n        // \n        ruleConfig.refColumn = selectedColumns.length === 1 ? selectedColumns[0] : selectedColumns;\n      } else if (ruleType === 'keyValue') {\n        const valueType = dialog.find('#cfg-keyvalue-type').val();\n        ruleConfig.valueType = valueType || 'text';\n\n        if (valueType === 'numeric') {\n          const min = dialog.find('#cfg-keyvalue-min').val();\n          const max = dialog.find('#cfg-keyvalue-max').val();\n          if (min !== '') ruleConfig.valueMin = parseFloat(min);\n          if (max !== '') ruleConfig.valueMax = parseFloat(max);\n        }\n      } else if (ruleType === 'sequence') {\n        const prefix = dialog.find('#cfg-sequence-prefix').val()?.trim() || '';\n        const startFrom = dialog.find('#cfg-sequence-start').val();\n        const pairedTable = dialog.find('#cfg-sequence-paired-table').val()?.trim() || null;\n        ruleConfig.prefix = prefix;\n        ruleConfig.startFrom = startFrom !== '' ? parseInt(startFrom, 10) : 1;\n        if (isNaN(ruleConfig.startFrom)) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        if (pairedTable) {\n          ruleConfig.pairedTable = pairedTable;\n        }\n      }\n\n      // IDID\n      const finalRuleId = isEditMode\n        ? editRuleId\n        : 'custom_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);\n\n      // \n      const ruleData = {\n        id: finalRuleId,\n        name: name,\n        description: existingRule?.description || '',\n        targetTable: targetTable,\n        targetColumn: isTableRule && ruleType !== 'sequence' ? '' : targetColumn, //  targetColumnsequence\n        ruleType: ruleType,\n        config: ruleConfig,\n        errorMessage: errorMessage || typeInfo?.desc || '',\n        intercept: existingRule?.intercept ?? false, // \n        enabled: existingRule?.enabled ?? true, // \n      };\n\n      let success = false;\n      if (isEditMode) {\n        // \n        success = ValidationRuleManager.updateCustomRule(editRuleId, ruleData);\n      } else {\n        // \n        success = ValidationRuleManager.addCustomRule(ruleData);\n      }\n\n      if (success) {\n        closeDialog();\n\n        // \n        ValidationRuleManager.clearCache();\n\n        // \n        const $rulesList = parentDialog.find('#validation-rules-list');\n\n        if (isEditMode) {\n          // \n          const $existingItem = $rulesList.find(`.acu-validation-rule-item[data-rule-id=\"${escapeHtml(editRuleId)}\"]`);\n          if ($existingItem.length) {\n            const hasIntercept = ruleData.intercept;\n            const isEnabled = ruleData.enabled;\n            $existingItem.find('.acu-rule-name').text(name);\n            $existingItem\n              .find('.acu-rule-target')\n              .text(`${targetTable}${isTableRule && ruleType !== 'sequence' ? ' ()' : '.' + targetColumn}`);\n            $existingItem\n              .find('.acu-rule-type-icon')\n              .attr('title', `${typeInfo?.name || ruleType}${isTableRule ? ' ()' : ''}`)\n              .find('i')\n              .attr('class', `fa-solid ${typeInfo?.icon || 'fa-question'}`);\n            $existingItem.toggleClass('disabled', !isEnabled);\n          }\n        } else {\n          // \n          const ruleHtml = `\n          <div class=\"acu-validation-rule-item\" data-rule-id=\"${escapeHtml(finalRuleId)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo?.name || ruleType)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo?.icon || 'fa-question'}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(targetTable)}${isTableRule && ruleType !== 'sequence' ? ' ()' : '.' + escapeHtml(targetColumn)}</div>\n            </div>\n            <div class=\"acu-rule-intercept\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n            <div class=\"acu-rule-toggle active\" title=\"/\">\n              <i class=\"fa-solid fa-toggle-on\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n        `;\n          $rulesList.append(ruleHtml);\n        }\n        // \n      } else {\n        if (window.toastr) window.toastr.error(isEditMode ? '' : '');\n      }\n    });\n\n    // \n    if (isEditMode && existingRule) {\n      dialog.find('#rule-name').val(existingRule.name || '');\n      dialog.find('#rule-error-msg').val(existingRule.errorMessage || '');\n\n      //  change \n      dialog\n        .find('#rule-table')\n        .val(existingRule.targetTable || '')\n        .trigger('change');\n\n      //  change \n      dialog\n        .find('#rule-type')\n        .val(existingRule.ruleType || 'required')\n        .trigger('change');\n\n      // / change \n      setTimeout(() => {\n        // \n        if (existingRule.targetColumn) {\n          dialog.find('#rule-column').val(existingRule.targetColumn);\n          updateSelectColor(dialog.find('#rule-column'));\n        }\n\n        // \n        const cfg = existingRule.config || {};\n        const ruleType = existingRule.ruleType;\n\n        if (ruleType === 'rowLimit') {\n          if (cfg.min !== undefined) dialog.find('#cfg-row-min').val(cfg.min);\n          if (cfg.max !== undefined) dialog.find('#cfg-row-max').val(cfg.max);\n        } else if (ruleType === 'sequence') {\n          dialog.find('#cfg-sequence-prefix').val(cfg.prefix || '');\n          dialog.find('#cfg-sequence-start').val(cfg.startFrom ?? 1);\n          if (cfg.pairedTable) {\n            dialog.find('#cfg-sequence-paired-table').val(cfg.pairedTable);\n            updateSelectColor(dialog.find('#cfg-sequence-paired-table'));\n          }\n        } else if (ruleType === 'format') {\n          dialog.find('#cfg-pattern').val(cfg.pattern || '');\n        } else if (ruleType === 'enum') {\n          dialog.find('#cfg-values').val((cfg.values || []).join(','));\n        } else if (ruleType === 'numeric') {\n          if (cfg.min !== undefined) dialog.find('#cfg-min').val(cfg.min);\n          if (cfg.max !== undefined) dialog.find('#cfg-max').val(cfg.max);\n        } else if (ruleType === 'relation') {\n          if (cfg.refTable) {\n            dialog.find('#cfg-ref-table').val(cfg.refTable).trigger('change');\n            // \n            setTimeout(() => {\n              const refColumns = Array.isArray(cfg.refColumn) ? cfg.refColumn : cfg.refColumn ? [cfg.refColumn] : [];\n              dialog.find('#cfg-ref-column').val(refColumns);\n              updateSelectColor(dialog.find('#cfg-ref-column'));\n              // \n              dialog.css('opacity', '1');\n            }, 100);\n            return; // relation  setTimeout \n          }\n        } else if (ruleType === 'keyValue') {\n          dialog\n            .find('#cfg-keyvalue-type')\n            .val(cfg.valueType || 'text')\n            .trigger('change');\n          if (cfg.valueMin !== undefined) dialog.find('#cfg-keyvalue-min').val(cfg.valueMin);\n          if (cfg.valueMax !== undefined) dialog.find('#cfg-keyvalue-max').val(cfg.valueMax);\n        }\n\n        // \n        dialog.css('opacity', '1');\n      }, 100);\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showSmartFixModal = error => {\n    if (!error || !error.rule) {\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const rule = error.rule;\n    const ruleType = error.ruleType || rule.ruleType;\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n    const isTableRule = typeInfo?.scope === 'table';\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const snapshot = loadSnapshot();\n\n    //  rowTitle\n    if (!error.rowTitle && error.rowIndex >= 0 && rawData && error.tableName) {\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          const row = rawData[sheetId].content?.[error.rowIndex + 1];\n          if (row) {\n            error.rowTitle = row[1] || row[0] || ` ${error.rowIndex + 1}`;\n          }\n          break;\n        }\n      }\n    }\n\n    // \n    let snapshotValue = '';\n    if (!isTableRule && snapshot && error.tableName && error.columnName !== undefined) {\n      for (const sheetId in snapshot) {\n        if (snapshot[sheetId]?.name === error.tableName) {\n          const headers = snapshot[sheetId].content?.[0] || [];\n          const colIdx = headers.indexOf(error.columnName);\n          const rowIdx = error.rowIndex + 1;\n          if (colIdx >= 0 && snapshot[sheetId].content?.[rowIdx]) {\n            snapshotValue = snapshot[sheetId].content[rowIdx][colIdx] ?? '';\n          }\n          break;\n        }\n      }\n    }\n\n    const hasSnapshotValue = snapshotValue !== '' && String(snapshotValue) !== String(error.currentValue || '');\n\n    // ========================================\n    // \n    // ========================================\n    if (isTableRule) {\n      showTableRuleFixModal(error, rule, ruleType, rawData, snapshot, currentThemeClass);\n      return;\n    }\n\n    // ========================================\n    // \n    // ========================================\n\n    // UI\n    let inputHtml = '';\n\n    if (ruleType === 'enum' && rule.config?.values) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'numeric') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'keyValue') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else {\n      // \n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    }\n\n    // \n    let smartSuggestHtml = '';\n\n    if (ruleType === 'required') {\n      // \n      const examples = getColumnExamples(error.tableName, error.columnName, error.rowIndex, rawData, 5);\n      if (examples.length > 0) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            <div class=\"acu-smart-fix-suggest-label\">\n              <i class=\"fa-solid fa-lightbulb\"></i> :\n            </div>\n            <div class=\"acu-smart-fix-suggest-options\">\n              ${examples\n                .map(\n                  val => `\n                <span class=\"acu-smart-fix-option\" data-value=\"${escapeHtml(val)}\" title=\"\">\n                  ${escapeHtml(val.length > 20 ? val.substring(0, 20) + '...' : val)}\n                </span>\n              `,\n                )\n                .join('')}\n            </div>\n          </div>\n        `;\n      }\n    } else if (ruleType === 'enum' && rule.config?.values) {\n      // \n      const validValues = rule.config.values;\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-list\"></i>  ():\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\">\n            ${validValues\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        </div>\n      `;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      // \n      // \n      let tableContent = null;\n      if (rawData && error.tableName) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            tableContent = rawData[sheetId];\n            break;\n          }\n        }\n      }\n      const suggestedValue = suggestFormatValue(rule.config.pattern, error.rowIndex, [], tableContent);\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-font\"></i> : <code>${escapeHtml(rule.config.pattern)}</code>\n          </div>\n          ${\n            suggestedValue\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:4px;display:block;\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </span>\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(suggestedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> ${escapeHtml(suggestedValue)}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'numeric') {\n      // \n      const min = rule.config?.min;\n      const max = rule.config?.max;\n      const currentNum = parseFloat(error.currentValue);\n      const isOutOfRange =\n        !isNaN(currentNum) && ((min !== undefined && currentNum < min) || (max !== undefined && currentNum > max));\n      const nearestValid = isOutOfRange ? getNearestValidNumber(error.currentValue, min, max) : null;\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-hashtag\"></i> : ${min !== undefined ? min : '-'} ~ ${max !== undefined ? max : '+'}\n          </div>\n          ${\n            isOutOfRange && nearestValid !== null\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${nearestValid}\">\n                <i class=\"fa-solid fa-arrow-right\"></i>  ${nearestValid}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      // \n      const options = getRelationOptions(rule.config.refTable, rule.config.refColumn, rawData);\n      const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n      const hasMultipleColumns = refColumns.length > 1;\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      const valueExists = isValueInRelationTable(\n        currentInvalidValue,\n        rule.config.refTable,\n        rule.config.refColumn,\n        rawData,\n      );\n\n      // HTML\n      let optionsHtml = '';\n      if (options.length > 0) {\n        optionsHtml = `\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-link\"></i>  \"${escapeHtml(rule.config.refTable)}\"  (${options.length}):\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\" id=\"smart-fix-options-container\">\n            ${options\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      // \n      let reverseWriteHtml = '';\n      if (currentInvalidValue && !valueExists) {\n        if (hasMultipleColumns) {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <select id=\"smart-fix-reverse-column\" class=\"acu-edit-select\" style=\"width:100%;margin-bottom:8px;\">\n                  ${refColumns.map(col => `<option value=\"${escapeHtml(col)}\">${escapeHtml(col)}</option>`).join('')}\n                </select>\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}\"\n                </button>\n              </div>\n            </div>\n          `;\n        } else {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" data-column=\"${escapeHtml(refColumns[0])}\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}.${escapeHtml(refColumns[0])}\"\n                </button>\n              </div>\n            </div>\n          `;\n        }\n      }\n\n      if (optionsHtml || reverseWriteHtml) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            ${optionsHtml}\n            ${reverseWriteHtml}\n          </div>\n        `;\n      }\n    } else if (ruleType === 'keyValue') {\n      // \n      const valueType = rule.config?.valueType || 'text';\n      const valueMin = rule.config?.valueMin;\n      const valueMax = rule.config?.valueMax;\n\n      // \n      let processedValue = String(error.currentValue || '');\n      processedValue = processedValue.replace(//g, ':').replace(//g, ';').replace(//g, ';').replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n      const issues = [];\n      const fixedPairs = [];\n\n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          issues.push({ pair, error: '/' });\n          continue;\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) {\n          issues.push({ pair, error: '' });\n          continue;\n        }\n\n        let fixedVal = val;\n        let hasIssue = false;\n\n        if (valueType === 'numeric') {\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) {\n            issues.push({ pair, error: `\"${val}\" ` });\n            hasIssue = true;\n          } else {\n            if (valueMin !== undefined && valueMin !== null && numVal < valueMin) {\n              fixedVal = String(valueMin);\n              issues.push({ pair, error: ` ${numVal}  ${valueMin}` });\n              hasIssue = true;\n            } else if (valueMax !== undefined && valueMax !== null && numVal > valueMax) {\n              fixedVal = String(valueMax);\n              issues.push({ pair, error: ` ${numVal}  ${valueMax}` });\n              hasIssue = true;\n            }\n          }\n        }\n\n        fixedPairs.push({ key, val: fixedVal, originalVal: val, hasIssue });\n      }\n\n      // \n      const fixedValue = fixedPairs.map(p => `${p.key}:${p.val}`).join(';');\n      const hasIssues = issues.length > 0 || fixedPairs.some(p => p.hasIssue);\n\n      let issuesHtml = '';\n      if (hasIssues) {\n        issuesHtml = `\n          <div class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:8px;\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i> :\n          </div>\n          <div style=\"margin-bottom:8px;\">\n            ${issues\n              .map(\n                issue => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(issue.pair)} - ${escapeHtml(issue.error)}\n              </div>\n            `,\n              )\n              .join('')}\n            ${fixedPairs\n              .filter(p => p.hasIssue)\n              .map(\n                p => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(p.key)}:${escapeHtml(p.originalVal)}  ${escapeHtml(p.val)}\n              </div>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-key\"></i> : :;:\n          </div>\n          ${\n            valueType === 'numeric'\n              ? `\n            <div class=\"acu-smart-fix-suggest-label\" style=\"margin-top:8px;\">\n              <i class=\"fa-solid fa-hashtag\"></i> : ${valueMin !== undefined ? valueMin : '-'} ~ ${valueMax !== undefined ? valueMax : '+'}\n            </div>\n          `\n              : ''\n          }\n          ${issuesHtml}\n          ${\n            hasIssues\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(fixedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> \n              </span>\n            </div>\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-card-bg);border-radius:4px;font-size:11px;color:var(--acu-text-sub);\">\n              <div style=\"margin-bottom:4px;\"><strong>:</strong></div>\n              <code style=\"color:var(--acu-success-text);\">${escapeHtml(fixedValue)}</code>\n            </div>\n          `\n              : `\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-success-bg);border-radius:4px;font-size:11px;color:var(--acu-success-text);\">\n              <i class=\"fa-solid fa-check-circle\"></i> \n            </div>\n          `\n          }\n        </div>\n      `;\n    }\n\n    // HTML\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} - ${escapeHtml(error.columnName || '')}</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            <!--  -->\n            <div class=\"acu-smart-fix-rule-info\">\n              <div class=\"acu-smart-fix-rule-header\">\n                <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                <span>${escapeHtml(error.ruleName || rule.name || '')}</span>\n              </div>\n              <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || typeInfo.desc || '')}</div>\n            </div>\n\n            <!--  -->\n            ${\n              hasSnapshotValue\n                ? `\n              <div class=\"acu-diff-section acu-diff-old-section\">\n                <div class=\"acu-diff-label\">\n                  <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                </div>\n                <div class=\"acu-diff-readonly\">${escapeHtml(snapshotValue)}</div>\n              </div>\n              <div class=\"acu-diff-arrow-down\"><i class=\"fa-solid fa-arrow-down\"></i></div>\n            `\n                : ''\n            }\n\n            <!--  -->\n            <div class=\"acu-diff-section acu-diff-new-section\">\n              ${\n                error.rowTitle && error.rowIndex >= 0\n                  ? `<div style=\"font-size:12px;color:var(--acu-text-sub);margin-bottom:8px;padding:4px 8px;background:var(--acu-bg-sub);border-radius:4px;\">\n                <i class=\"fa-solid fa-tag\" style=\"margin-right:4px;\"></i>${escapeHtml(error.rowTitle)}\n              </div>`\n                  : ''\n              }\n              <div class=\"acu-diff-label\">\n                <i class=\"fa-solid fa-pen\"></i> \n              </div>\n              ${inputHtml}\n            </div>\n\n            <!--  -->\n            ${\n              smartSuggestHtml\n                ? `\n              <div class=\"acu-smart-fix-suggest-section\">\n                ${smartSuggestHtml}\n              </div>\n            `\n                : ''\n            }\n          </div>\n          <div class=\"acu-dialog-btns\">\n            <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n            ${hasSnapshotValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n            <button class=\"acu-dialog-btn acu-btn-clear\" id=\"smart-fix-clear\"><i class=\"fa-solid fa-eraser\"></i> </button>\n            <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    dialog.on('click', '.acu-smart-fix-option, .acu-smart-fix-quick-btn', function () {\n      // \n      if ($(this).attr('id') === 'smart-fix-reverse-write-btn') return;\n      if ($(this).hasClass('acu-smart-fix-option-current')) return;\n      const optionValue = $(this).data('value') || $(this).text().trim();\n      dialog.find('#smart-fix-value').val(optionValue).trigger('input');\n    });\n\n    // \n    dialog.on('click', '#smart-fix-reverse-write-btn', async function () {\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      if (!currentInvalidValue) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      let targetColumn;\n      if (ruleType === 'relation' && rule.config?.refColumn) {\n        const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n        if (refColumns.length > 1) {\n          // \n          targetColumn = dialog.find('#smart-fix-reverse-column').val();\n        } else {\n          // data\n          targetColumn = $(this).data('column') || refColumns[0];\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      if (!targetColumn || !rule.config?.refTable) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      try {\n        const rawData = cachedRawData || getTableData();\n        let refSheet = null;\n        let refSheetId = null;\n\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === rule.config.refTable) {\n            refSheet = rawData[sheetId];\n            refSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!refSheet || !refSheet.content) {\n          if (window.toastr) window.toastr.error(` \"${rule.config.refTable}\"`);\n          return;\n        }\n\n        const headers = refSheet.content[0] || [];\n        const targetColIdx = headers.indexOf(targetColumn);\n\n        if (targetColIdx === -1) {\n          if (window.toastr) window.toastr.error(` \"${targetColumn}\"`);\n          return;\n        }\n\n        // \n        const newRow = new Array(headers.length).fill('');\n        newRow[targetColIdx] = currentInvalidValue;\n\n        // \n        refSheet.content.push(newRow);\n\n        // \n        await saveDataToDatabase(rawData, false, false);\n\n        // \n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-revert', function () {\n      dialog.find('#smart-fix-value').val(snapshotValue);\n    });\n\n    // \n    dialog.on('click', '#smart-fix-clear', function () {\n      dialog.find('#smart-fix-value').val('').trigger('input');\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-close, #smart-fix-cancel', closeDialog);\n    setupOverlayClose(dialog, 'acu-validation-modal-overlay', closeDialog);\n\n    // \n    dialog.find('#smart-fix-confirm').on('click', async function () {\n      const newValue = dialog.find('#smart-fix-value').val()?.trim() || '';\n\n      if (newValue === '' && ruleType === 'required') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      try {\n        const rawData = cachedRawData || getTableData();\n        let updated = false;\n\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            const sheet = rawData[sheetId];\n            const headers = sheet.content?.[0] || [];\n\n            if (error.rowIndex >= 0 && error.columnName) {\n              const colIdx = headers.indexOf(error.columnName);\n              const rowIdx = error.rowIndex + 1;\n\n              if (colIdx >= 0 && sheet.content && sheet.content[rowIdx]) {\n                sheet.content[rowIdx][colIdx] = newValue;\n                updated = true;\n                break;\n              }\n            }\n          }\n        }\n\n        if (updated) {\n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function extractCodesFromTable(sheet, columnName, prefix) {\n    if (!sheet || !sheet.content || sheet.content.length < 2) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const headers = sheet.content[0] || [];\n    const rows = sheet.content.slice(1) || [];\n    const colIndex = headers.indexOf(columnName);\n\n    if (colIndex < 0) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const codes = new Map(); // Map<, >\n    const allCodes = new Set(); // Set<>\n    const codeToRows = new Map(); // Map<, >\n\n    for (let i = 0; i < rows.length; i++) {\n      const value = rows[i]?.[colIndex];\n      if (value === null || value === undefined || value === '') continue;\n\n      const strValue = String(value).trim();\n      if (!strValue) continue;\n\n      // \n      let isValid = false;\n      if (prefix) {\n        const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          isValid = true;\n        }\n      } else {\n        const num = parseInt(strValue, 10);\n        if (!isNaN(num)) {\n          isValid = true;\n        }\n      }\n\n      if (isValid) {\n        allCodes.add(strValue);\n        if (!codeToRows.has(strValue)) {\n          codeToRows.set(strValue, []);\n        }\n        codeToRows.get(strValue).push(i);\n      }\n    }\n\n    return { codes, allCodes, codeToRows };\n  }\n\n  //   \n  function buildCodeMapping(codes1, codes2, prefix, startFrom) {\n    // \n    const allUniqueCodes = new Set([...codes1, ...codes2]);\n\n    // \n    const codeNumbers = [];\n    for (const code of allUniqueCodes) {\n      let num = null;\n      if (prefix) {\n        const match = code.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          num = parseInt(match[1], 10);\n        }\n      } else {\n        num = parseInt(code, 10);\n      }\n\n      if (!isNaN(num)) {\n        codeNumbers.push({ code, num });\n      }\n    }\n\n    // \n    codeNumbers.sort((a, b) => a.num - b.num);\n\n    //   \n    const mapping = new Map();\n    for (let i = 0; i < codeNumbers.length; i++) {\n      const oldCode = codeNumbers[i].code;\n      const newNum = startFrom + i;\n      const newCode = prefix + String(newNum).padStart(4, '0');\n      mapping.set(oldCode, newCode);\n    }\n\n    return mapping;\n  }\n\n  // \n  // \n  // 1. \n  // 2. \n  // 3. \n  function alignAndFixPairedTables(\n    table1Sheet,\n    table1SheetId,\n    table2Sheet,\n    table2SheetId,\n    columnName,\n    mapping,\n    prefix,\n    startFrom,\n    rawData,\n  ) {\n    if (!table1Sheet || !table2Sheet) return { fixedCount1: 0, fixedCount2: 0 };\n\n    const headers1 = table1Sheet.content[0] || [];\n    const rows1 = table1Sheet.content.slice(1) || [];\n    const colIndex1 = headers1.indexOf(columnName);\n\n    const headers2 = table2Sheet.content[0] || [];\n    const rows2 = table2Sheet.content.slice(1) || [];\n    const colIndex2 = headers2.indexOf(columnName);\n\n    if (colIndex1 < 0 || colIndex2 < 0) return { fixedCount1: 0, fixedCount2: 0 };\n\n    let fixedCount1 = 0;\n    let fixedCount2 = 0;\n\n    //  -> \n    const reverseMapping = new Map();\n    for (const [oldCode, newCode] of mapping.entries()) {\n      reverseMapping.set(newCode, oldCode);\n    }\n\n    // \n    const sortedNewCodes = Array.from(mapping.values()).sort((a, b) => {\n      const numA = parseInt(a.replace(prefix, ''), 10);\n      const numB = parseInt(b.replace(prefix, ''), 10);\n      return numA - numB;\n    });\n\n    // \n    const analyzeTable = (rows, colIndex) => {\n      const codeRows = []; // {rowIndex, oldCode, row}\n      const emptyRows = []; // {rowIndex, row, prevOldCode, nextOldCode}\n\n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        const strValue = value === null || value === undefined ? '' : String(value).trim();\n\n        // \n        let isValid = false;\n        if (strValue && prefix) {\n          const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          if (match) isValid = true;\n        } else if (strValue) {\n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) isValid = true;\n        }\n\n        if (isValid) {\n          codeRows.push({ rowIndex: i, oldCode: strValue, row: rows[i] });\n        } else {\n          emptyRows.push({ rowIndex: i, row: rows[i], prevOldCode: null, nextOldCode: null });\n        }\n      }\n\n      // \n      for (const emptyRow of emptyRows) {\n        let prevCode = null;\n        let nextCode = null;\n\n        for (const codeRow of codeRows) {\n          if (codeRow.rowIndex < emptyRow.rowIndex) {\n            prevCode = codeRow.oldCode;\n          }\n          if (codeRow.rowIndex > emptyRow.rowIndex && nextCode === null) {\n            nextCode = codeRow.oldCode;\n            break;\n          }\n        }\n\n        emptyRow.prevOldCode = prevCode;\n        emptyRow.nextOldCode = nextCode;\n      }\n\n      return { codeRows, emptyRows };\n    };\n\n    const analysis1 = analyzeTable(rows1, colIndex1);\n    const analysis2 = analyzeTable(rows2, colIndex2);\n\n    // \n    const buildNewRows = (analysis, headers, colIndex, allOldCodes) => {\n      const newRows = [];\n      const codeRowMap = new Map(); // oldCode -> row data\n\n      // \n      for (const cr of analysis.codeRows) {\n        codeRowMap.set(cr.oldCode, cr.row);\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n\n        if (codeRowMap.has(oldCode)) {\n          // \n          const oldRow = codeRowMap.get(oldCode);\n          const newRow = oldRow.map(cell => cell);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true });\n        } else {\n          // \n          const newRow = new Array(headers.length).fill(null);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true, isInserted: true });\n        }\n      }\n\n      // \n      //  prevOldCode  nextOldCode \n      const result = [];\n      let codeRowIndex = 0;\n\n      // \n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode === null && emptyRow.nextOldCode !== null) {\n          // \n          const nextNewCode = mapping.get(emptyRow.nextOldCode);\n          // \n          while (codeRowIndex < newRows.length && newRows[codeRowIndex].newCode !== nextNewCode) {\n            result.push(newRows[codeRowIndex].row);\n            codeRowIndex++;\n          }\n          result.push(emptyRow.row);\n        } else if (emptyRow.prevOldCode === null && emptyRow.nextOldCode === null) {\n          // \n          result.push(emptyRow.row);\n        }\n      }\n\n      // \n      for (; codeRowIndex < newRows.length; codeRowIndex++) {\n        result.push(newRows[codeRowIndex].row);\n        const currentNewCode = newRows[codeRowIndex].newCode;\n        const currentOldCode = reverseMapping.get(currentNewCode);\n\n        // \n        for (const emptyRow of analysis.emptyRows) {\n          if (emptyRow.prevOldCode === currentOldCode) {\n            result.push(emptyRow.row);\n          }\n        }\n      }\n\n      // prevOldCode nextOldCode  null\n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode !== null && emptyRow.nextOldCode === null) {\n          // \n        }\n      }\n\n      return result;\n    };\n\n    // \n    const newRows1 = buildNewRows(analysis1, headers1, colIndex1, new Set(analysis1.codeRows.map(r => r.oldCode)));\n    const newRows2 = buildNewRows(analysis2, headers2, colIndex2, new Set(analysis2.codeRows.map(r => r.oldCode)));\n\n    // \n    const countCodeChanges = (oldAnalysis, newRows, colIndex) => {\n      let count = 0;\n      // \n      const oldCodes = new Set(oldAnalysis.codeRows.map(r => r.oldCode));\n      const newCodes = new Set();\n\n      for (const row of newRows) {\n        const code = row[colIndex];\n        if (code) newCodes.add(code);\n      }\n\n      // \n      for (const [oldCode, newCode] of mapping.entries()) {\n        if (oldCodes.has(oldCode) && oldCode !== newCode) {\n          count++; // \n        }\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n        if (!oldCodes.has(oldCode)) {\n          count++; // \n        }\n      }\n\n      return count;\n    };\n\n    fixedCount1 = countCodeChanges(analysis1, newRows1, colIndex1);\n    fixedCount2 = countCodeChanges(analysis2, newRows2, colIndex2);\n\n    // \n    table1Sheet.content = [headers1, ...newRows1];\n    table2Sheet.content = [headers2, ...newRows2];\n\n    return { fixedCount1, fixedCount2 };\n  }\n\n  // \n  // ========================================\n  const showTableRuleFixModal = (error, rule, ruleType, rawData, snapshot, currentThemeClass) => {\n    const { $ } = getCore();\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n\n    let contentHtml = '';\n    let actionBtns = '';\n\n    if (ruleType === 'tableReadonly') {\n      // \n      let changeCount = 0;\n      let changeDetails = [];\n\n      if (snapshot && rawData) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            const newRows = rawData[sheetId].content?.slice(1) || [];\n            const oldRows = snapshot[sheetId].content?.slice(1) || [];\n\n            // \n            newRows.forEach((row, idx) => {\n              const oldRow = oldRows[idx];\n              if (!oldRow) {\n                changeDetails.push(`${idx + 1}: `);\n                changeCount++;\n              } else {\n                for (let c = 0; c < row.length; c++) {\n                  if (String(row[c] || '') !== String(oldRow[c] || '')) {\n                    changeDetails.push(`${idx + 1}: `);\n                    changeCount++;\n                    break;\n                  }\n                }\n              }\n            });\n\n            // \n            if (oldRows.length > newRows.length) {\n              for (let i = newRows.length; i < oldRows.length; i++) {\n                changeDetails.push(`${i + 1}: `);\n                changeCount++;\n              }\n            }\n            break;\n          }\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-lock\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\"></div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${changeCount}</strong> \n          </div>\n          ${\n            changeDetails.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\">\n              ${changeDetails\n                .slice(0, 10)\n                .map(d => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(d)}</div>`)\n                .join('')}\n              ${changeDetails.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${changeDetails.length - 10} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n      actionBtns = `\n        <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n        <button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-restore-table\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n      `;\n    } else if (ruleType === 'rowLimit') {\n      // \n      const minRows = rule.config?.min;\n      const maxRows = rule.config?.max;\n      let currentRowCount = 0;\n      let excessRows = [];\n\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          currentRowCount = (rawData[sheetId].content?.length || 1) - 1; // \n          break;\n        }\n      }\n\n      const isTooMany = maxRows !== undefined && currentRowCount > maxRows;\n      const isTooFew = minRows !== undefined && currentRowCount < minRows;\n\n      if (isTooMany) {\n        for (let i = maxRows + 1; i <= currentRowCount; i++) {\n          excessRows.push(i);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-arrows-up-down\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            : <strong>${currentRowCount}</strong> \n            ${minRows !== undefined || maxRows !== undefined ? ` | : ${minRows !== undefined ? minRows : 0} ~ ${maxRows !== undefined ? maxRows : ''} ` : ''}\n          </div>\n          ${\n            isTooMany && excessRows.length > 0\n              ? `\n            <div class=\"acu-smart-fix-excess-rows\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-trash\"></i>  ( ${excessRows[0]} ):\n              </div>\n              <div class=\"acu-smart-fix-change-list\">\n                ${excessRows\n                  .slice(0, 10)\n                  .map(r => `<div class=\"acu-smart-fix-change-item\"> ${r} </div>`)\n                  .join('')}\n                ${excessRows.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${excessRows.length} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n          ${\n            isTooFew\n              ? `\n            <div class=\"acu-smart-fix-hint\">\n              <i class=\"fa-solid fa-info-circle\"></i>  ${minRows - currentRowCount} \n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (isTooMany && excessRows.length > 0) {\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-delete-rows\" data-start=\"${maxRows}\" data-table=\"${escapeHtml(error.tableName)}\">\n            <i class=\"fa-solid fa-trash\"></i>  ${excessRows.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    } else if (ruleType === 'sequence' && rule.targetColumn) {\n      // \n      const prefix = rule.config?.prefix || '';\n      const startFrom = rule.config?.startFrom !== undefined ? rule.config?.startFrom : 1;\n      let targetSheet = null;\n      let issues = [];\n      let fixSuggestions = [];\n\n      // \n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (targetSheet && targetSheet.content && targetSheet.content.length > 1) {\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = ValidationEngine.findColumnIndex(headers, rule.targetColumn);\n\n        if (colIndex >= 0) {\n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num, originalRowIndex: i + 2 }); // +2 +1\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          const numCountMap = new Map(); // \n          const duplicates = [];\n          const gaps = [];\n          const outOfOrder = [];\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const actualNum = numbers[i].num;\n            if (!numCountMap.has(actualNum)) {\n              numCountMap.set(actualNum, []);\n            }\n            numCountMap.get(actualNum).push(i);\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n\n            // \n            const occurrences = numCountMap.get(actualNum) || [];\n            if (occurrences.length > 1) {\n              // \n              if (occurrences[0] === i) {\n                duplicates.push({\n                  rowNum,\n                  value: numbers[i].value,\n                  num: actualNum,\n                  expectedNum,\n                  count: occurrences.length,\n                });\n              }\n            }\n\n            // \n            if (actualNum !== expectedNum) {\n              if (actualNum < expectedNum) {\n                // \n                outOfOrder.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              } else {\n                // \n                gaps.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              }\n            }\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n            const currentValue = numbers[i].value;\n            const fixedValue = prefix + String(expectedNum).padStart(4, '0');\n\n            if (actualNum !== expectedNum || duplicates.some(d => d.num === actualNum && d.rowNum === rowNum)) {\n              fixSuggestions.push({\n                rowNum,\n                currentValue,\n                fixedValue,\n                reason: actualNum < expectedNum ? '' : actualNum > expectedNum ? '' : '',\n              });\n            }\n          }\n\n          // \n          const issueSet = new Set();\n          duplicates.forEach(d => {\n            issueSet.add(`${d.rowNum}: \"${d.value}\"  (${d.count})`);\n          });\n          gaps.forEach(g => {\n            issueSet.add(\n              `${g.rowNum}: \"${g.value}\"  \"${prefix}${String(g.expectedNum).padStart(4, '0')}\" ()`,\n            );\n          });\n          outOfOrder.forEach(o => {\n            issueSet.add(\n              `${o.rowNum}: \"${o.value}\"  \"${prefix}${String(o.expectedNum).padStart(4, '0')}\" ()`,\n            );\n          });\n          issues = Array.from(issueSet);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-sort-numeric-up\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${issues.length}</strong> \n          </div>\n          ${\n            issues.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n              ${issues\n                .slice(0, 20)\n                .map(issue => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(issue)}</div>`)\n                .join('')}\n              ${issues.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${issues.length - 20} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n          ${\n            fixSuggestions.length > 0\n              ? `\n            <div class=\"acu-smart-fix-suggest\" style=\"margin-top:12px;\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </div>\n              <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n                ${fixSuggestions\n                  .slice(0, 20)\n                  .map(\n                    fix => `\n                  <div class=\"acu-smart-fix-change-item\">\n                    <span style=\"color:var(--acu-text-sub);\">${fix.rowNum}:</span>\n                    <span style=\"color:var(--acu-hl-manual);\">${escapeHtml(fix.currentValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);\">  </span>\n                    <span style=\"color:var(--acu-hl-auto);\">${escapeHtml(fix.fixedValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);font-size:11px;\"> (${escapeHtml(fix.reason)})</span>\n                  </div>\n                `,\n                  )\n                  .join('')}\n                ${fixSuggestions.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${fixSuggestions.length - 20} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (fixSuggestions.length > 0) {\n        // \n        const pairedTable =\n          rule.config?.pairedTable ||\n          (error.tableName === '' ? '' : error.tableName === '' ? '' : null);\n        const pairedTableAttr = pairedTable ? `data-paired-table=\"${escapeHtml(pairedTable)}\"` : '';\n\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-fix-sequence\" data-table=\"${escapeHtml(error.tableName)}\" data-column=\"${escapeHtml(rule.targetColumn)}\" data-prefix=\"${escapeHtml(prefix)}\" data-start=\"${startFrom}\" ${pairedTableAttr}>\n            <i class=\"fa-solid fa-magic\"></i>  ${fixSuggestions.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    }\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} ()</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            ${contentHtml}\n          </div>\n          <div class=\"acu-dialog-btns\">\n            ${actionBtns}\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-cancel', closeDialog);\n    setupOverlayClose(dialog, 'acu-validation-modal-overlay', closeDialog);\n\n    // \n    dialog.on('click', '#smart-fix-restore-table', async function () {\n      if (!snapshot) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      try {\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            rawData[sheetId] = JSON.parse(JSON.stringify(snapshot[sheetId]));\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-fix-sequence', async function () {\n      const $btn = $(this);\n      const tableName = $btn.data('table');\n      const columnName = $btn.data('column');\n      const prefix = $btn.data('prefix') || '';\n      const startFrom = parseInt($btn.data('start') || '1', 10);\n      const pairedTableName = $btn.data('paired-table') || null;\n\n      try {\n        $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n\n        // \n        let targetSheet = null;\n        let targetSheetId = null;\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            targetSheet = rawData[sheetId];\n            targetSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = headers.indexOf(columnName);\n\n        if (colIndex < 0) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        // \n        if (pairedTableName) {\n          // \n          let pairedSheet = null;\n          let pairedSheetId = null;\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === pairedTableName) {\n              pairedSheet = rawData[sheetId];\n              pairedSheetId = sheetId;\n              break;\n            }\n          }\n\n          if (!pairedSheet || !pairedSheet.content || pairedSheet.content.length < 1) {\n            if (window.toastr) window.toastr.warning(`: ${pairedTableName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          const pairedHeaders = pairedSheet.content[0] || [];\n          const pairedColIndex = pairedHeaders.indexOf(columnName);\n\n          if (pairedColIndex < 0) {\n            if (window.toastr) window.toastr.warning(`: ${columnName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          // \n          const extract1 = extractCodesFromTable(targetSheet, columnName, prefix);\n          const extract2 = extractCodesFromTable(pairedSheet, columnName, prefix);\n\n          // \n          const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n          // \n          const { fixedCount1, fixedCount2 } = alignAndFixPairedTables(\n            targetSheet,\n            targetSheetId,\n            pairedSheet,\n            pairedSheetId,\n            columnName,\n            mapping,\n            prefix,\n            startFrom,\n            rawData,\n          );\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          // \n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num });\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          let fixedCount = 0;\n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowIndex = numbers[i].rowIndex;\n\n            if (actualNum !== expectedNum) {\n              const fixedValue = prefix + String(expectedNum).padStart(4, '0');\n              rows[rowIndex][colIndex] = fixedValue;\n              fixedCount++;\n            }\n          }\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n        $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-delete-rows', async function () {\n      const startRow = parseInt($(this).data('start'), 10);\n      const tableName = $(this).data('table');\n\n      try {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            // (index 0) startRow (index 1  startRow)\n            rawData[sheetId].content = rawData[sheetId].content.slice(0, startRow + 1);\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const showBlacklistManagerModal = () => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    $('.acu-blacklist-manager-overlay').remove();\n\n    const blacklist = BlacklistManager.getBlacklist();\n\n    const modalHtml = `\n      <div class=\"acu-blacklist-manager-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width: 600px; width: 90%;\">\n          <div class=\"acu-edit-title\" style=\"position: relative;\">\n            <i class=\"fa-solid fa-filter\"></i> \n            <button class=\"acu-close-btn\" style=\"position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--acu-text-main); cursor: pointer; font-size: 18px; z-index: 10;\">\n              <i class=\"fa-solid fa-times\"></i>\n            </button>\n          </div>\n          <div class=\"acu-settings-content\" style=\"flex: 1; overflow-y: auto; padding: 20px;\">\n            <div style=\"margin-bottom: 15px;\">\n              <div style=\"margin-bottom: 8px; font-size: 12px; color: var(--acu-text-sub);\">\n                \n              </div>\n              <textarea id=\"blacklist-textarea\" style=\"width: 100%; min-height: 120px; max-height: 300px; padding: 10px !important; border: 1px solid var(--acu-border) !important; border-radius: 4px !important; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; font-size: 13px !important; box-sizing: border-box !important; resize: vertical; font-family: monospace; line-height: 1.5;\" placeholder=\"\"></textarea>\n              <div style=\"display: flex; gap: 8px; margin-top: 8px; flex-wrap: nowrap;\">\n                <input type=\"text\" id=\"blacklist-input\" placeholder=\"...\" style=\"flex: 1; min-width: 0; padding: 8px !important; border: 1px solid var(--acu-border) !important; border-radius: 4px !important; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; font-size: 13px !important; box-sizing: border-box !important;\">\n                <button id=\"blacklist-add-btn\" style=\"padding: 8px 16px; background: var(--acu-accent); color: var(--acu-btn-active-text); border: none; border-radius: 4px; cursor: pointer; font-size: 13px; white-space: nowrap; flex-shrink: 0;\">\n                  <i class=\"fa-solid fa-plus\"></i> \n                </button>\n              </div>\n            </div>\n            <div style=\"display: flex; gap: 8px; margin-top: 15px;\">\n              <button id=\"blacklist-reset-btn\" style=\"flex: 1; padding: 10px; background: var(--acu-btn-bg); color: var(--acu-text-main); border: 1px solid var(--acu-border); border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-undo\"></i> \n              </button>\n              <button id=\"blacklist-close-btn\" style=\"flex: 1; padding: 10px; background: var(--acu-accent); color: var(--acu-btn-active-text); border: none; border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-check\"></i> \n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '31300',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    // textarea\n    const updateTextarea = () => {\n      const blacklist = BlacklistManager.getBlacklist();\n      const $textarea = $modal.find('#blacklist-textarea');\n      $textarea.val(blacklist.join(''));\n    };\n\n    // textareaBlacklistManager\n    const syncFromTextarea = () => {\n      const $textarea = $modal.find('#blacklist-textarea');\n      const text = $textarea.val().trim();\n      if (!text) {\n        BlacklistManager.setBlacklist([]);\n        return;\n      }\n      // \n      const items = text\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n      // \n      const uniqueItems = [...new Set(items)];\n      BlacklistManager.setBlacklist(uniqueItems);\n      // textarea\n      if (uniqueItems.length !== items.length) {\n        updateTextarea();\n      }\n    };\n\n    // textarea\n    updateTextarea();\n\n    // textarea\n    $modal.find('#blacklist-textarea').on('input', function () {\n      syncFromTextarea();\n    });\n\n    // \n    $modal.find('#blacklist-add-btn').click(function () {\n      const input = $modal.find('#blacklist-input');\n      const value = input.val().trim();\n      if (!value) return;\n\n      // \n      const newItems = value\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n\n      if (newItems.length === 0) return;\n\n      const blacklist = BlacklistManager.getBlacklist();\n      const existingSet = new Set(blacklist);\n      const addedItems = [];\n\n      newItems.forEach(item => {\n        if (!existingSet.has(item)) {\n          blacklist.push(item);\n          existingSet.add(item);\n          addedItems.push(item);\n        }\n      });\n\n      if (addedItems.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      BlacklistManager.setBlacklist(blacklist);\n      input.val('');\n      updateTextarea();\n    });\n\n    $modal.find('#blacklist-input').on('keypress', function (e) {\n      if (e.which === 13) {\n        $modal.find('#blacklist-add-btn').click();\n      }\n    });\n\n    $modal.find('#blacklist-reset-btn').click(function () {\n      if (confirm('')) {\n        BlacklistManager.resetToDefault();\n        updateTextarea();\n      }\n    });\n\n    const closeModal = () => {\n      $modal.remove();\n      // \n      renderInterface();\n    };\n\n    $modal.find('#blacklist-close-btn, .acu-close-btn').click(closeModal);\n    setupOverlayClose($modal, 'acu-blacklist-manager-overlay', closeModal);\n  };\n\n  const showAttributePresetManager = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const presets = AttributePresetManager.getAllPresets();\n    const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n\n    // HTMLactiveIdnull\n    const isDefaultActive = activeId === null;\n    const defaultPresetHtml = `\n      <div class=\"acu-preset-item\" data-id=\"__default__\">\n        <div class=\"acu-preset-info\">\n          <div class=\"acu-preset-name\">\n            \n            <span style=\"font-size: 10px; color: var(--acu-text-sub); margin-left: 6px;\">()</span>\n          </div>\n          <div class=\"acu-preset-desc\">5-95</div>\n          <div class=\"acu-preset-stats\">\n            : 6 | : 0\n          </div>\n        </div>\n<div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n            <label class=\"acu-toggle\" style=\"margin: 0;\">\n              <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"__default__\" ${isDefaultActive ? 'checked' : ''}>\n              <span class=\"acu-toggle-slider\"></span>\n            </label>\n            <button class=\"acu-preset-btn acu-preset-copy\" data-id=\"__default__\" title=\"\"><i class=\"fa-solid fa-copy\"></i></button>\n            <button class=\"acu-preset-btn acu-preset-export\" data-id=\"__default__\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n          </div>\n        </div>\n    `;\n\n    // HTML\n    const presetsHtml = presets\n      .map(preset => {\n        const isActive = preset.id === activeId;\n        const isBuiltin = preset.builtin;\n\n        return `\n        <div class=\"acu-preset-item\" data-id=\"${preset.id}\">\n          <div class=\"acu-preset-info\">\n            <div class=\"acu-preset-name\">\n              ${escapeHtml(preset.name)}\n              ${isBuiltin ? `<span style=\"font-size: 10px; color: var(--acu-text-sub); margin-left: 6px;\">()</span>` : ''}\n            </div>\n            ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n            <div class=\"acu-preset-stats\">\n              : ${preset.baseAttributes.length} | : ${preset.specialAttributes?.length || 0}\n            </div>\n          </div>\n          <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n            <label class=\"acu-toggle\" style=\"margin: 0;\">\n              <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"${preset.id}\" ${isActive ? 'checked' : ''}>\n              <span class=\"acu-toggle-slider\"></span>\n            </label>\n            ${\n              isBuiltin\n                ? `<button class=\"acu-preset-btn acu-preset-copy\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-copy\"></i></button>`\n                : `<button class=\"acu-preset-btn acu-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>`\n            }\n            <button class=\"acu-preset-btn acu-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: var(--acu-error-text);\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n          </div>\n        </div>\n      `;\n      })\n      .join('');\n\n    // \n    const allPresetsHtml = defaultPresetHtml + presetsHtml;\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 80vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid var(--acu-border);\">\n            <div style=\"font-size: 16px; font-weight: bold; color: var(--acu-text-main);\">\n              <i class=\"fa-solid fa-dice-d20\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div id=\"acu-presets-list\">\n              ${allPresetsHtml || `<div style=\"text-align: center; padding: 40px; color: var(--acu-text-sub);\"></div>`}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--acu-border);\">\n            <button id=\"acu-preset-new\" style=\"flex: 1; padding: 10px; background: var(--acu-accent); border: none; border-radius: 6px; color: var(--acu-btn-active-text); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-preset-import\" style=\"flex: 1; padding: 10px; background: var(--acu-btn-bg); border: 1px solid var(--acu-border); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-preset-back\" style=\"padding: 10px 16px; background: var(--acu-btn-bg); border: 1px solid var(--acu-border); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n\n          <input type=\"file\" id=\"acu-preset-file-input\" accept=\".json\" style=\"display: none;\" />\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn, #acu-preset-back').on('click', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n\n    // Toggle\n    overlay.on('change', '.acu-preset-toggle', function () {\n      const $toggle = $(this);\n      const id = $toggle.data('id');\n      const isChecked = $toggle.is(':checked');\n\n      if (isChecked) {\n        // id\"__default__\"null\n        const finalId = id === '__default__' ? null : id;\n        AttributePresetManager.setActivePreset(finalId);\n\n        // toggle\n        overlay.find('.acu-preset-toggle').each(function () {\n          const $thisToggle = $(this);\n          const thisId = $thisToggle.data('id');\n          if (thisId !== id) {\n            $thisToggle.prop('checked', false);\n          }\n        });\n      } else {\n        // null\n        AttributePresetManager.setActivePreset(null);\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showAttributePresetEditor(id);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-export', function () {\n      const id = $(this).data('id');\n\n      let json;\n      let filename;\n\n      if (id === '__default__') {\n        // \n        const STANDARD_ATTRS = ['', '', '', '', '', ''];\n        const defaultPresetData = {\n          format: 'acu_attr_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          id: 'default_percentile',\n          name: '',\n          description: '5-95',\n          baseAttributes: STANDARD_ATTRS.map(name => ({\n            name,\n            formula: '3d6*5',\n            range: [15, 90],\n            modifier: '1d10-5',\n          })),\n          specialAttributes: [],\n        };\n        json = JSON.stringify(defaultPresetData, null, 2);\n        filename = `acu_preset__${Date.now()}.json`;\n      } else {\n        json = AttributePresetManager.exportPreset(id);\n        if (!json) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n        const preset = presets.find(p => p.id === id);\n        filename = `acu_preset_${preset?.name || id}_${Date.now()}.json`;\n      }\n\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        const success = AttributePresetManager.deletePreset(id);\n        if (success) {\n          overlay.remove();\n          showAttributePresetManager();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-preset-copy', function () {\n      const id = $(this).data('id');\n\n      let copyData;\n      if (id === '__default__') {\n        // \n        // formula + range + modifier\n        const STANDARD_ATTRS = ['', '', '', '', '', ''];\n        copyData = {\n          name: ' ()',\n          description: '5-95',\n          baseAttributes: STANDARD_ATTRS.map(name => ({\n            name,\n            formula: '3d6*5',\n            range: [15, 90],\n            modifier: '1d10-5',\n          })),\n          specialAttributes: [],\n        };\n      } else {\n        // \n        const preset = presets.find(p => p.id === id);\n        if (!preset) return;\n\n        copyData = {\n          name: preset.name + ' ()',\n          description: preset.description || '',\n          baseAttributes: JSON.parse(JSON.stringify(preset.baseAttributes)),\n          specialAttributes: JSON.parse(JSON.stringify(preset.specialAttributes || [])),\n        };\n      }\n\n      const newPreset = AttributePresetManager.createPreset(copyData);\n      if (newPreset) {\n        if (window.toastr) window.toastr.success(`${newPreset.name}`);\n        overlay.remove();\n        showAttributePresetManager(); // \n      }\n    });\n\n    // \n    overlay.find('#acu-preset-new').on('click', () => {\n      overlay.remove();\n      showAttributePresetEditor();\n    });\n\n    // \n    overlay.find('#acu-preset-import').on('click', () => {\n      overlay.find('#acu-preset-file-input').click();\n    });\n\n    overlay.find('#acu-preset-file-input').on('change', function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      const reader = new FileReader();\n      reader.onload = evt => {\n        try {\n          const jsonStr = evt.target.result as string;\n          if (!jsonStr?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(jsonStr.trim());\n          } catch {\n            if (window.toastr) window.toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.name || '';\n          const existingPresets = AttributePresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = jsonStr.trim();\n            if (newName) {\n              parsedData.name = newName;\n              // IDID\n              parsedData.id = `attr_preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset && !existingPreset.builtin) {\n                AttributePresetManager.deletePreset(existingPreset.id);\n              }\n            }\n\n            const imported = AttributePresetManager.importPreset(finalJson);\n            if (imported) {\n              overlay.remove();\n              showAttributePresetManager();\n            } else {\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      };\n      reader.readAsText(file);\n\n      // \n      $(this).val('');\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n  };\n\n  // \n  const showAttributePresetEditor = (presetId = null) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? AttributePresetManager.getAllPresets().find(p => p.id === presetId) : null;\n\n    // \n    const defaultData = {\n      name: existingPreset?.name || '',\n      description: existingPreset?.description || '',\n      baseAttributes: existingPreset?.baseAttributes || [\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n      ],\n      specialAttributes: existingPreset?.specialAttributes || [],\n    };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 650px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid var(--acu-border);\">\n            <div style=\"font-size: 16px; font-weight: bold; color: var(--acu-text-main);\">\n              <i class=\"fa-solid fa-pen\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 4px;\"></label>\n              <input id=\"preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 4px;\"></label>\n              <input id=\"preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 8px;\">\n                JSON <span style=\"font-size: 10px; color: var(--acu-text-sub);\">()</span>\n              </label>\n              <textarea id=\"preset-json\" class=\"acu-preset-editor-textarea\" style=\"width: 100%; height: 320px; padding: 10px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; font-family: 'Consolas', 'Monaco', monospace !important; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: var(--acu-text-sub); padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n               baseAttributes:  nameformularangemodifier()<br/>\n               specialAttributes:  nameformularange()<br/>\n               : 3d6, 4d6kh3, (/2), (+-*/)\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--acu-border);\">\n            <button id=\"preset-save\" style=\"flex: 1; padding: 10px; background: var(--acu-accent); border: none; border-radius: 6px; color: var(--acu-btn-active-text); cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"preset-cancel\" style=\"padding: 10px 16px; background: var(--acu-btn-bg); border: 1px solid var(--acu-border); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#preset-json');\n\n    // JSON\n    const updateJSON = () => {\n      const data = {\n        baseAttributes: defaultData.baseAttributes,\n        specialAttributes: defaultData.specialAttributes,\n      };\n      $jsonTextarea.val(JSON.stringify(data, null, 2));\n    };\n    updateJSON();\n\n    // \n    overlay.find('.acu-close-btn, #preset-cancel').on('click', () => {\n      overlay.remove();\n      showAttributePresetManager();\n    });\n\n    // \n    overlay.find('#preset-save').on('click', () => {\n      try {\n        const name = overlay.find('#preset-name').val().trim();\n        const description = overlay.find('#preset-desc').val().trim();\n        const jsonStr = $jsonTextarea.val().trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const jsonData = JSON.parse(jsonStr);\n\n        // \n        if (\n          !jsonData.baseAttributes ||\n          !Array.isArray(jsonData.baseAttributes) ||\n          jsonData.baseAttributes.length === 0\n        ) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n\n        // \n        const preset = {\n          format: 'acu_attr_preset_v1',\n          version: 1,\n          id: presetId || `custom_${Date.now()}`,\n          name,\n          description,\n          baseAttributes: jsonData.baseAttributes,\n          specialAttributes: jsonData.specialAttributes || [],\n        };\n\n        // \n        if (isEdit) {\n          AttributePresetManager.updatePreset(presetId, preset);\n        } else {\n          AttributePresetManager.createPreset(preset);\n        }\n\n        overlay.remove();\n        showAttributePresetManager();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + (err.message || 'JSON'));\n      }\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showActionPresetManager = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const presets = ActionPresetManager.getAllPresets();\n    const activeId = ActionPresetManager.getActivePresetId();\n\n    // HTML\n    const presetsHtml =\n      presets.length === 0\n        ? `<div style=\"text-align: center; padding: 40px; color: var(--acu-text-sub);\"></div>`\n        : presets\n            .map(preset => {\n              const isActive = preset.id === activeId;\n              const isBuiltin = (preset as any).builtin === true;\n              const keywordsSummary =\n                (preset.rules || [])\n                  .flatMap(r => r.table_keywords || [])\n                  .slice(0, 3)\n                  .join('') || '';\n              const actionsSummary =\n                (preset.rules || [])\n                  .flatMap(r => (r.actions || []).map(a => a.label))\n                  .slice(0, 4)\n                  .join('') || '';\n\n              return `\n          <div class=\"acu-preset-item\" data-id=\"${preset.id}\">\n            <div class=\"acu-preset-info\">\n              <div class=\"acu-preset-name\">${escapeHtml(preset.name)}${isBuiltin ? `<span style=\"font-size: 10px; color: var(--acu-text-sub); margin-left: 6px;\">()</span>` : ''}</div>\n              ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n              <div class=\"acu-preset-stats\" style=\"font-size: 11px; color: var(--acu-text-sub);\">\n                : ${escapeHtml(keywordsSummary)} | : ${escapeHtml(actionsSummary)}\n              </div>\n            </div>\n            <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n              <label class=\"acu-toggle\" style=\"margin: 0;\">\n                <input type=\"checkbox\" class=\"acu-action-preset-toggle\" data-id=\"${preset.id}\" ${isActive ? 'checked' : ''}>\n                <span class=\"acu-toggle-slider\"></span>\n              </label>\n              ${\n                isBuiltin\n                  ? `<button class=\"acu-preset-btn acu-action-preset-copy\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-copy\"></i></button>`\n                  : `<button class=\"acu-preset-btn acu-action-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>`\n              }\n              <button class=\"acu-preset-btn acu-action-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n              ${!isBuiltin ? `<button class=\"acu-preset-btn acu-action-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: var(--acu-error-text);\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n            </div>\n          </div>\n        `;\n            })\n            .join('');\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 80vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid var(--acu-border);\">\n            <div style=\"font-size: 16px; font-weight: bold; color: var(--acu-text-main);\">\n              <i class=\"fa-solid fa-wand-magic-sparkles\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div id=\"acu-action-presets-list\">\n              ${presetsHtml}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--acu-border);\">\n            <button id=\"acu-action-preset-new\" style=\"flex: 1; padding: 10px; background: var(--acu-accent); border: none; border-radius: 6px; color: var(--acu-btn-active-text); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-action-preset-import\" style=\"flex: 1; padding: 10px; background: var(--acu-btn-bg); border: 1px solid var(--acu-border); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-action-preset-back\" style=\"padding: 10px 16px; background: var(--acu-btn-bg); border: 1px solid var(--acu-border); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn, #acu-action-preset-back').on('click', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n\n    // Toggle\n    overlay.on('change', '.acu-action-preset-toggle', function () {\n      const $toggle = $(this);\n      const id = $toggle.data('id');\n      const isChecked = $toggle.is(':checked');\n\n      if (isChecked) {\n        ActionPresetManager.setActivePresetId(id);\n        // toggle\n        overlay.find('.acu-action-preset-toggle').each(function () {\n          if ($(this).data('id') !== id) {\n            $(this).prop('checked', false);\n          }\n        });\n      } else {\n        // \n        if (ActionPresetManager.getActivePresetId() === id) {\n          ActionPresetManager.setActivePresetId(null);\n          if (window.toastr) window.toastr.info('');\n        }\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showActionPresetEditor(id);\n    });\n\n    //  - JSON\n    overlay.on('click', '.acu-action-preset-export', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n      const json = ActionPresetManager.exportPreset(id);\n      if (!json) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      // JSON\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `${preset?.name || ''}.json`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      if (window.toastr) window.toastr.success('');\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-copy', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return;\n\n      const copyData = {\n        name: preset.name + ' ()',\n        description: preset.description || '',\n        rules: JSON.parse(JSON.stringify(preset.rules)),\n      };\n\n      const newPreset = ActionPresetManager.createPreset(copyData);\n      if (newPreset) {\n        if (window.toastr)\n          window.toastr.success(`${newPreset.name} ${newPreset.rules.length} `);\n        overlay.remove();\n        showActionPresetManager(); // \n      }\n    });\n\n    // \n    overlay.on('click', '.acu-action-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        const success = ActionPresetManager.deletePreset(id);\n        if (success) {\n          overlay.remove();\n          showActionPresetManager();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      }\n    });\n\n    // \n    overlay.find('#acu-action-preset-new').on('click', () => {\n      overlay.remove();\n      showActionPresetEditor();\n    });\n\n    //  - JSON\n    overlay.find('#acu-action-preset-import').on('click', () => {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = () => {\n        const file = input.files?.[0];\n        if (!file) return;\n\n        const reader = new FileReader();\n        reader.onload = e => {\n          const jsonStr = e.target?.result as string;\n          if (!jsonStr?.trim()) {\n            if (window.toastr) window.toastr.error('');\n            return;\n          }\n\n          const result = ActionPresetManager.importPreset(jsonStr.trim());\n          if (result) {\n            if (window.toastr) window.toastr.success(`${result.name}`);\n            overlay.remove();\n            showActionPresetManager();\n          } else {\n            if (window.toastr) window.toastr.error('JSON');\n          }\n        };\n        reader.onerror = () => {\n          if (window.toastr) window.toastr.error('');\n        };\n        reader.readAsText(file);\n      };\n      input.click();\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n  };\n\n  // JSON\n  const showActionPresetEditor = (presetId?: string) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? ActionPresetManager.getPresetById(presetId) : null;\n\n    // \n    const defaultData = {\n      name: existingPreset?.name || '',\n      description: existingPreset?.description || '',\n      rules: existingPreset?.rules || [\n        {\n          table_keywords: ['', ''],\n          actions: [\n            {\n              label: '',\n              template:\n                '<user>{Name}:{Name}',\n            },\n            {\n              label: '',\n              template: '<user>{Name}',\n            },\n          ],\n        },\n        {\n          table_keywords: ['', ''],\n          actions: [\n            {\n              label: '',\n              template: '<user>{Name}',\n            },\n            {\n              label: '',\n              template: '<user>{Name}',\n            },\n          ],\n        },\n      ],\n    };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 700px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid var(--acu-border);\">\n            <div style=\"font-size: 16px; font-weight: bold; color: var(--acu-text-main);\">\n              <i class=\"fa-solid fa-wand-magic-sparkles\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 4px;\"></label>\n              <input id=\"action-preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 4px;\"></label>\n              <input id=\"action-preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: var(--acu-text-sub); margin-bottom: 8px;\">\n                 <span style=\"font-size: 10px; color: var(--acu-text-sub);\">(JSON)</span>\n              </label>\n              <textarea id=\"action-preset-json\" class=\"acu-preset-editor-textarea\" style=\"width: 100%; height: 300px; padding: 10px; border: 1px solid var(--acu-border) !important; border-radius: 6px; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; font-family: 'Consolas', 'Monaco', monospace; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: var(--acu-text-sub); padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n                table_keywords actions<br/>\n                label template{Name}<br/>\n               : { \"table_keywords\": [\"\"], \"actions\": [{ \"label\": \"\", \"template\": \"<user>{Name}\" }] }\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--acu-border);\">\n            <button id=\"action-preset-save\" style=\"flex: 1; padding: 10px; background: var(--acu-accent); border: none; border-radius: 6px; color: var(--acu-btn-active-text); cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"action-preset-cancel\" style=\"padding: 10px 16px; background: var(--acu-btn-bg); border: 1px solid var(--acu-border); border-radius: 6px; color: var(--acu-text-main); cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#action-preset-json');\n\n    // JSON rules \n    $jsonTextarea.val(JSON.stringify(defaultData.rules, null, 2));\n\n    // \n    overlay.find('.acu-close-btn, #action-preset-cancel').on('click', () => {\n      overlay.remove();\n      showActionPresetManager();\n    });\n\n    // \n    overlay.find('#action-preset-save').on('click', () => {\n      try {\n        const name = (overlay.find('#action-preset-name').val() as string).trim();\n        const description = (overlay.find('#action-preset-desc').val() as string).trim();\n        const jsonStr = ($jsonTextarea.val() as string).trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const rules = JSON.parse(jsonStr);\n\n        // \n        if (!Array.isArray(rules) || rules.length === 0) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n\n        // \n        for (let i = 0; i < rules.length; i++) {\n          const rule = rules[i];\n          if (!rule.table_keywords || !Array.isArray(rule.table_keywords) || rule.table_keywords.length === 0) {\n            if (window.toastr) window.toastr.error(` ${i + 1}  table_keywords`);\n            return;\n          }\n          if (!rule.actions || !Array.isArray(rule.actions) || rule.actions.length === 0) {\n            if (window.toastr) window.toastr.error(` ${i + 1}  actions`);\n            return;\n          }\n        }\n\n        if (isEdit && presetId) {\n          // \n          ActionPresetManager.updatePreset(presetId, { name, description, rules });\n          if (window.toastr) window.toastr.success('');\n        } else {\n          // \n          ActionPresetManager.createPreset({ name, description, rules });\n          if (window.toastr) window.toastr.success('');\n        }\n\n        overlay.remove();\n        showActionPresetManager();\n      } catch (e) {\n        if (window.toastr) window.toastr.error('JSON : ' + (e as Error).message);\n      }\n    });\n\n    // \n    setupOverlayClose(overlay, 'acu-edit-overlay', () => {\n      overlay.remove();\n      showActionPresetManager();\n    });\n  };\n  // ========================================\n  const showDebugConsoleModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-debug-console-dialog)').remove();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // localStorage\n    const savedFilters = Store.get('acu_debug_filters', { log: true, info: true, warn: true, error: true });\n    ConsoleCaptureManager.setFilters(savedFilters);\n\n    const renderLogs = () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      const $logContainer = dialog.find('.acu-debug-log-container');\n      $logContainer.empty();\n\n      if (filteredLogs.length === 0) {\n        $logContainer.html(\n          '<div style=\"text-align:center;padding:40px;color:var(--acu-text-sub);\"><i class=\"fa-solid fa-inbox\"></i><br/></div>',\n        );\n        return;\n      }\n\n      filteredLogs.forEach(log => {\n        const typeColors = {\n          error: 'var(--acu-error-text)',\n          warn: 'var(--acu-warning-text)',\n          info: 'var(--acu-hl-diff)',\n          log: 'var(--acu-text-sub)',\n        };\n        const typeIcons = {\n          error: 'fa-exclamation-circle',\n          warn: 'fa-exclamation-triangle',\n          info: 'fa-info-circle',\n          log: 'fa-circle',\n        };\n        const color = typeColors[log.type] || typeColors.log;\n        const icon = typeIcons[log.type] || typeIcons.log;\n\n        const logItem = $(`\n          <div class=\"acu-debug-log-item\" data-type=\"${log.type}\" style=\"padding:8px 12px;border-bottom:1px solid var(--acu-border);font-family:monospace;font-size:12px;line-height:1.5;\">\n            <div style=\"display:flex;align-items:flex-start;gap:8px;\">\n              <span style=\"color:${color};min-width:60px;font-size:11px;\">\n                <i class=\"fa-solid ${icon}\"></i> [${log.timeStr}]\n              </span>\n              <span style=\"color:${color};min-width:50px;font-size:11px;text-transform:uppercase;\">[${log.type}]</span>\n              <span style=\"flex:1;color:var(--acu-text-main);word-break:break-word;white-space:pre-wrap;\">${escapeHtml(log.content)}</span>\n            </div>\n            ${log.stack ? `<div style=\"margin-top:4px;margin-left:128px;color:var(--acu-text-sub);font-size:11px;white-space:pre-wrap;font-family:monospace;\">${escapeHtml(log.stack)}</div>` : ''}\n          </div>\n        `);\n        $logContainer.append(logItem);\n      });\n    };\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-debug-console-dialog ${currentThemeClass}\" style=\"max-width:90vw;max-height:90vh;width:800px;height:600px;display:flex;flex-direction:column;\">\n          <div class=\"acu-settings-header\" style=\"flex-shrink:0;\">\n            <div class=\"acu-settings-title\"><i class=\"fa-solid fa-bug\"></i> Debug</div>\n            <button class=\"acu-close-btn\" id=\"debug-console-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex:1;display:flex;flex-direction:column;overflow:hidden;\">\n            <!--  -->\n            <div style=\"padding:12px;border-bottom:1px solid var(--acu-border);flex-shrink:0;display:flex;flex-direction:column;gap:8px;\">\n              <!-- Console -->\n              <div style=\"display:flex;align-items:center;gap:8px;padding-bottom:8px;border-bottom:1px solid var(--acu-border);\">\n                <span style=\"font-size:12px;color:var(--acu-text-sub);flex:1;\">Console:</span>\n                <label class=\"acu-toggle\">\n                  <input type=\"checkbox\" id=\"debug-console-capture-toggle\" ${ConsoleCaptureManager.enabled ? 'checked' : ''}>\n                  <span class=\"acu-toggle-slider\"></span>\n                </label>\n                <span id=\"debug-console-capture-status\" style=\"font-size:11px;color:var(--acu-text-sub);\">${ConsoleCaptureManager.enabled ? '' : ''}</span>\n              </div>\n              <!--  -->\n              <div style=\"display:flex;flex-wrap:wrap;gap:8px;align-items:center;\">\n                <div style=\"display:flex;gap:8px;align-items:center;flex:1;\">\n                  <span style=\"font-size:12px;color:var(--acu-text-sub);\">:</span>\n                  <button class=\"acu-btn ${savedFilters.log ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"log\" style=\"padding:4px 10px;font-size:12px;${savedFilters.log ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Log</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.info ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"info\" style=\"padding:4px 10px;font-size:12px;${savedFilters.info ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Info</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.warn ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"warn\" style=\"padding:4px 10px;font-size:12px;${savedFilters.warn ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Warn</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.error ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"error\" style=\"padding:4px 10px;font-size:12px;${savedFilters.error ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Error</span>\n                  </button>\n                </div>\n                <div style=\"display:flex;gap:6px;\">\n                  <button class=\"acu-btn acu-btn-secondary\" id=\"debug-console-clear\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-trash\"></i> \n                  </button>\n                  <button class=\"acu-btn acu-btn-secondary\" id=\"debug-console-copy\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-copy\"></i> \n                  </button>\n                  <button class=\"acu-btn acu-btn-primary\" id=\"debug-console-export\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-download\"></i> \n                  </button>\n                </div>\n              </div>\n            </div>\n\n            <!--  -->\n            <div class=\"acu-debug-log-scroll\" style=\"flex:1;overflow-y:auto;overflow-x:hidden;background:var(--acu-card-bg);\">\n              <div class=\"acu-debug-log-container\"></div>\n            </div>\n\n            <!--  -->\n            <div style=\"padding:8px 12px;border-top:1px solid var(--acu-border);flex-shrink:0;font-size:11px;color:var(--acu-text-sub);display:flex;justify-content:space-between;\">\n              <span>: <span id=\"debug-total-count\">0</span> | : <span id=\"debug-filtered-count\">0</span></span>\n            </div>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const updateCounts = () => {\n      const total = ConsoleCaptureManager.logs.length;\n      const filtered = ConsoleCaptureManager.getFilteredLogs().length;\n      dialog.find('#debug-total-count').text(total);\n      dialog.find('#debug-filtered-count').text(filtered);\n    };\n\n    // \n    renderLogs();\n    updateCounts();\n\n    // Console\n    dialog.find('#debug-console-capture-toggle').on('change', function () {\n      const checked = $(this).is(':checked');\n      const $status = dialog.find('#debug-console-capture-status');\n      if (checked) {\n        ConsoleCaptureManager.enable();\n        $status.text('');\n        // \n        console.log('[DICE]Debug');\n      } else {\n        ConsoleCaptureManager.disable();\n        $status.text('');\n      }\n    });\n\n    // \n    dialog.find('[data-filter-type]').on('click', function () {\n      const type = $(this).data('filter-type');\n      const isActive = $(this).hasClass('acu-btn-primary');\n      const newState = !isActive;\n\n      // \n      if (newState) {\n        $(this).removeClass('acu-btn-secondary').addClass('acu-btn-primary');\n        $(this).css('opacity', '1');\n      } else {\n        $(this).removeClass('acu-btn-primary').addClass('acu-btn-secondary');\n        $(this).css('opacity', '0.5');\n      }\n\n      // \n      ConsoleCaptureManager.setFilters({ [type]: newState });\n      Store.set('acu_debug_filters', ConsoleCaptureManager.filters);\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-clear').on('click', () => {\n      ConsoleCaptureManager.clear();\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-copy').on('click', async () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n');\n\n      try {\n        // \n        if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n          const safeContent = text.replace(/\\\"/g, '\\\\\"').replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          return;\n        }\n        // API\n        if (navigator.clipboard && window.isSecureContext) {\n          await navigator.clipboard.writeText(text);\n        } else {\n          // execCommand\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n          document.body.appendChild(textArea);\n          textArea.select();\n          textArea.setSelectionRange(0, 99999);\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n          if (!successful) {\n            throw new Error('execCommand failed');\n          }\n        }\n      } catch (err) {\n        console.error('[DICE]DebugConsole :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // \n    dialog.find('#debug-console-export').on('click', () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n\\n');\n\n      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `debug-console-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    dialog.find('#debug-console-close, .acu-edit-overlay').on('click', function (e) {\n      if (e.target === this || $(e.target).closest('.acu-close-btn').length) {\n        dialog.remove();\n      }\n    });\n\n    // \n    // [] \n    const refreshInterval = setInterval(() => {\n      if (dialog.length && dialog.is(':visible')) {\n        renderLogs();\n        updateCounts();\n      }\n    }, 500);\n\n    // \n    dialog.on('remove', () => {\n      clearInterval(refreshInterval);\n    });\n  };\n\n  // ========================================\n  // showAddRegexRuleModal - / (Phase 4.2)\n  // ========================================\n  const showAddRegexRuleModal = (editRuleId?: string) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // ()\n    const editRule = editRuleId ? RegexTransformationManager.getRule(editRuleId) : null;\n\n    // \n    const tableData = cachedRawData || getTableData();\n    const tableNames = Object.keys(tableData || {})\n      .filter(k => k.startsWith('sheet_'))\n      .map(k => tableData[k]?.name || k)\n      .sort();\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-dice-cfg-header\">\n            <span><i class=\"fa-solid fa-magic\"></i> ${editRule ? '' : ''}</span>\n            <button class=\"acu-config-close\" id=\"acu-close-regex-rule\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.name) : ''}\" placeholder=\": \" style=\"flex:1;\" required>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <textarea id=\"rule-description\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1; resize: none; overflow-wrap: break-word; overflow-y: hidden; min-height: 34px; height: 34px; line-height: 1.4;\">${editRule ? escapeHtml(editRule.description || '') : ''}</textarea>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <input type=\"text\" id=\"rule-pattern\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.pattern) : ''}\" placeholder=\": \\\\s+  /test/g\" style=\"flex:1; font-family: monospace;\" required>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-replacement\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.replacement || '') : ''}\" placeholder=\", $1, $2 \" style=\"flex:1; font-family: monospace;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <select id=\"rule-scope-type\" class=\"acu-setting-select\" style=\"width:120px;\">\n                <option value=\"global\" ${editRule?.scope?.type === 'global' ? 'selected' : ''}></option>\n                <option value=\"table\" ${editRule?.scope?.type === 'table' ? 'selected' : ''}></option>\n                <option value=\"column\" ${editRule?.scope?.type === 'column' ? 'selected' : ''}></option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"field-table-names\" style=\"display: ${editRule?.scope?.type === 'global' ? 'none' : 'flex'};\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> ()</span></div>\n              <input type=\"text\" id=\"rule-table-names\" class=\"acu-panel-input\" value=\"${editRule?.scope?.tableNames?.join(',') || ''}\" placeholder=\": ,\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\" id=\"field-column-names\" style=\"display: ${editRule?.scope?.type === 'column' ? 'flex' : 'none'};\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> ()</span></div>\n              <input type=\"text\" id=\"rule-column-names\" class=\"acu-panel-input\" value=\"${editRule?.scope?.columnNames?.join(',') || ''}\" placeholder=\": ,\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"number\" id=\"rule-priority\" class=\"acu-panel-input\" value=\"${editRule?.priority || 50}\" min=\"1\" max=\"100\" style=\"width:80px;\">\n            </div>\n\n          </div>\n          <div class=\"acu-dice-cfg-actions\">\n            <button id=\"acu-regex-rule-cancel\"></button>\n            <button id=\"acu-regex-rule-confirm\"></button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    // /\n    const updateScopeFields = () => {\n      const scopeType = dialog.find('#rule-scope-type').val();\n      if (scopeType === 'global') {\n        dialog.find('#field-table-names, #field-column-names').hide();\n      } else if (scopeType === 'table') {\n        dialog.find('#field-table-names').css('display', 'flex').show();\n        dialog.find('#field-column-names').hide();\n      } else if (scopeType === 'column') {\n        dialog.find('#field-table-names, #field-column-names').css('display', 'flex').show();\n      }\n    };\n\n    dialog.find('#rule-scope-type').on('change', updateScopeFields);\n\n    // Textarea\n    const $textarea = dialog.find('#rule-description');\n    const autoResizeTextarea = () => {\n      // scrollHeight\n      $textarea.css('height', '34px');\n      // ,1\n      const scrollHeight = $textarea[0].scrollHeight;\n      $textarea.css('height', Math.max(34, scrollHeight) + 'px');\n    };\n    // \n    $textarea.on('input', autoResizeTextarea);\n\n    // ()\n    dialog.find('#acu-regex-rule-confirm').on('click', async function () {\n      const name = dialog.find('#rule-name').val();\n      const pattern = dialog.find('#rule-pattern').val();\n      const scopeType = dialog.find('#rule-scope-type').val();\n\n      if (!name || !pattern) {\n        toastr.error('');\n        return;\n      }\n\n      //  scope \n      const scope: RegexScopeConfig = { type: scopeType as RegexScopeType };\n      if (scopeType !== 'global') {\n        const tableNames = dialog.find('#rule-table-names').val();\n        if (tableNames)\n          scope.tableNames = String(tableNames)\n            .split(',')\n            .map(s => s.trim())\n            .filter(s => s);\n      }\n      if (scopeType === 'column') {\n        const columnNames = dialog.find('#rule-column-names').val();\n        if (columnNames)\n          scope.columnNames = String(columnNames)\n            .split(',')\n            .map(s => s.trim())\n            .filter(s => s);\n      }\n\n      //  pattern  flags\n      const patternStr = String(pattern);\n      const { flags: extractedFlags, patternWithoutFlags } = RegexTransformationEngine._extractFlags(patternStr);\n\n      // \n      try {\n        new RegExp(patternWithoutFlags);\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : String(e);\n        toastr.error(`: ${errorMsg}`, '');\n        return;\n      }\n\n      //  UI  flags\n      const $flagGlobal = dialog.find('#flag-global');\n      const $flagIgnoreCase = dialog.find('#flag-ignorecase');\n      const $flagMultiline = dialog.find('#flag-multiline');\n\n      const uiFlags = {\n        global: $flagGlobal.length > 0 ? $flagGlobal.is(':checked') : false,\n        caseInsensitive: $flagIgnoreCase.length > 0 ? $flagIgnoreCase.is(':checked') : false,\n        multiline: $flagMultiline.length > 0 ? $flagMultiline.is(':checked') : false,\n      };\n\n      //  pattern  flags pattern  flags\n      const finalPattern = patternWithoutFlags !== patternStr ? patternWithoutFlags : patternStr;\n      const finalFlags =\n        patternWithoutFlags !== patternStr\n          ? { ...uiFlags, ...extractedFlags } //  flags  UI flags\n          : uiFlags; //  flags UI flags\n\n      const ruleData = {\n        name: String(name),\n        description: dialog.find('#rule-description').val(),\n        operation: 'replace', // \n        pattern: finalPattern, //  pattern flags\n        flags: finalFlags, //  flags\n        replacement: dialog.find('#rule-replacement').val(),\n        scope,\n        enabled: true, // \n        priority: parseInt(dialog.find('#rule-priority').val(), 10),\n        executeMode: 'auto', // \n      };\n\n      // \n      if (editRuleId) {\n        // \n        RegexTransformationManager.updateRule(editRuleId, ruleData);\n      } else {\n        // \n        const newRule = RegexTransformationManager.addCustomRule(ruleData);\n        if (newRule) {\n          editRuleId = newRule.id;\n        }\n      }\n\n      // [] \n      dialog.remove();\n      $(document).off('keydown.regex-rule-modal'); // ESC\n      refreshRegexRulesList(); // \n    });\n\n    //  isSettingsOpen\n    const closeDialog = () => {\n      dialog.remove();\n      $(document).off('keydown.regex-rule-modal'); // ESC\n    };\n\n    // \n    dialog.find('#acu-regex-rule-cancel, #acu-close-regex-rule').on('click', function (e) {\n      e.stopPropagation();\n      closeDialog();\n    });\n\n    // \n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n\n    // ESC \n    $(document).on('keydown.regex-rule-modal', function (e) {\n      if (e.key === 'Escape' && dialog.length && dialog.is(':visible')) {\n        e.preventDefault();\n        closeDialog();\n        $(document).off('keydown.regex-rule-modal'); // \n      }\n    });\n\n    $('body').append(dialog);\n\n    // DOMtextarea\n    requestAnimationFrame(() => {\n      const $textarea = dialog.find('#rule-description');\n      if ($textarea.length && $textarea[0].scrollHeight > 34) {\n        $textarea.css('height', $textarea[0].scrollHeight + 'px');\n      }\n    });\n  };\n\n  // \n  window.showAddRegexRuleModal = showAddRegexRuleModal;\n\n  // \n  window.showDebugConsoleModal = showDebugConsoleModal;\n\n  // ========================================\n  // AcuDice  API - \n  // ========================================\n\n  const ACUDICE_READY_EVENT = 'acudice:ready';\n\n  const resolveRootWindow = (): Window => {\n    try {\n      return window.top ?? window;\n    } catch (error) {\n      return window;\n    }\n  };\n\n  const rootWindow = resolveRootWindow();\n  const readyCallbacks: Array<() => void> = [];\n  let isAcuDiceReady = false;\n\n  const runReadyCallback = (callback: () => void) => {\n    try {\n      callback();\n    } catch (error) {\n      console.error('[AcuDice] onReady ', error);\n    }\n  };\n\n  const notifyReady = () => {\n    if (isAcuDiceReady) return;\n    isAcuDiceReady = true;\n    for (const callback of readyCallbacks) {\n      runReadyCallback(callback);\n    }\n    readyCallbacks.length = 0;\n  };\n\n  const defineAcuDiceOnWindow = (target: Window) => {\n    if ('AcuDice' in target) return;\n    Object.defineProperty(target, 'AcuDice', {\n      value: AcuDiceAPI,\n      writable: false,\n      configurable: false,\n    });\n  };\n\n  const dispatchReadyEvent = (target: Window) => {\n    try {\n      target.dispatchEvent(new CustomEvent(ACUDICE_READY_EVENT));\n    } catch (error) {\n      console.warn('[AcuDice] ready ', error);\n    }\n  };\n\n  // \n  const eventHandlers: Map<string, Set<Function>> = new Map();\n  const checkHistory: Array<AcuDice.CheckResult & { timestamp: number }> = [];\n  const contestHistory: Array<AcuDice.ContestResult & { timestamp: number }> = [];\n  const MAX_HISTORY = 100;\n\n  function emitEvent(event: string, data: any) {\n    const handlers = eventHandlers.get(event);\n    if (handlers) {\n      handlers.forEach(handler => {\n        try {\n          handler(data);\n        } catch (e) {\n          console.error('[AcuDice] Event handler error:', e);\n        }\n      });\n    }\n  }\n\n  /**\n   * AcuDice  API\n   * \n   */\n  const AcuDiceAPI = {\n    /** API  */\n    version: '1.0.0',\n\n    /**\n     * \n     * @param formula  \"2d6\", \"1d20+5\", \"4d6kh3\"\n     * @returns \n     * @example\n     * AcuDice.roll('2d6') // => { total: 7, formula: '2d6', breakdown: '2d6 = 7' }\n     * AcuDice.roll('1d20+5') // => { total: 15, formula: '1d20+5', breakdown: '1d20+5 = 15' }\n     */\n    roll(formula: string): { total: number; formula: string; breakdown: string } {\n      if (!formula || typeof formula !== 'string') {\n        throw new Error('[AcuDice] roll() ');\n      }\n      const total = evaluateFormula(formula, {});\n      return {\n        total,\n        formula,\n        breakdown: `${formula} = ${total}`,\n      };\n    },\n\n    /**\n     * /\n     * @param options \n     * @returns \n     * @example\n     * await AcuDice.check({ attribute: '' })\n     * await AcuDice.check({ attribute: '', targetValue: 50, diceType: '1d100' })\n     */\n    async check(\n      options: {\n        attribute?: string;\n        skill?: string;\n        targetValue?: number;\n        diceType?: string;\n        successCriteria?: 'lte' | 'gte';\n        modifier?: number;\n      } = {},\n    ): Promise<{\n      success: boolean;\n      roll: number;\n      target: number;\n      margin: number;\n      criticalSuccess: boolean;\n      criticalFailure: boolean;\n      message: string;\n      diceType: string;\n      rule: 'coc' | 'dnd';\n    }> {\n      const diceCfg = getDiceConfig();\n      const diceType = options.diceType || diceCfg.lastDiceType || '1d100';\n      const successCriteria = options.successCriteria || (diceType === '1d20' ? 'gte' : 'lte');\n      const isDND = successCriteria === 'gte';\n      const modifier = options.modifier || 0;\n\n      // \n      let targetValue = options.targetValue;\n\n      // \n      if (targetValue === undefined && (options.attribute || options.skill)) {\n        const attrName = options.attribute || options.skill || '';\n        const rawData = cachedRawData || getTableData();\n\n        if (rawData) {\n          // \n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (sheet?.name === '' && sheet.content?.[1]) {\n              const headers = sheet.content[0] || [];\n              const row = sheet.content[1];\n              for (let idx = 0; idx < headers.length; idx++) {\n                const h = headers[idx];\n                if (h && (h.includes('') || h.includes(''))) {\n                  const parsed = parseAttributeString(row[idx] || '');\n                  const found = parsed.find((attr: { name: string; value: number }) => attr.name === attrName);\n                  if (found) {\n                    targetValue = found.value;\n                    break;\n                  }\n                }\n              }\n              if (targetValue !== undefined) break;\n            }\n          }\n        }\n\n        if (targetValue === undefined) {\n          throw new Error(`[AcuDice] : ${attrName}`);\n        }\n      }\n\n      if (targetValue === undefined) {\n        throw new Error('[AcuDice] check()  targetValue  attribute/skill ');\n      }\n\n      // \n      const rollResult = rollDiceExpression(diceType);\n      if (isNaN(rollResult)) {\n        throw new Error(`[AcuDice] : ${diceType}`);\n      }\n\n      const finalRoll = rollResult + modifier;\n      const target = targetValue;\n\n      // \n      let success = false;\n      let criticalSuccess = false;\n      let criticalFailure = false;\n      let message = '';\n\n      if (isDND) {\n        // DND : roll >= target \n        success = finalRoll >= target;\n        criticalSuccess = rollResult === diceCfg.dndCritSuccess;\n        criticalFailure = rollResult === diceCfg.dndCritFail;\n\n        if (criticalSuccess) {\n          success = true;\n          message = ` ${rollResult}${modifier ? ` + ${modifier}` : ''} = ${finalRoll}DC ${target}`;\n        } else if (criticalFailure) {\n          success = false;\n          message = ` ${rollResult}${modifier ? ` + ${modifier}` : ''} = ${finalRoll}DC ${target}`;\n        } else if (success) {\n          message = ` ${finalRoll} >= DC ${target}`;\n        } else {\n          message = ` ${finalRoll} < DC ${target}`;\n        }\n      } else {\n        // COC : roll <= target \n        success = finalRoll <= target;\n        criticalSuccess = finalRoll <= diceCfg.critSuccessMax;\n        criticalFailure = finalRoll >= diceCfg.critFailMin;\n\n        if (criticalSuccess) {\n          success = true;\n          message = ` ${finalRoll} ${target}`;\n        } else if (criticalFailure) {\n          success = false;\n          message = ` ${finalRoll} ${target}`;\n        } else if (success) {\n          const hardSuccess = finalRoll <= Math.floor(target / diceCfg.hardSuccessDiv);\n          const extremeSuccess = finalRoll <= Math.floor(target / diceCfg.difficultSuccessDiv);\n          if (extremeSuccess) {\n            message = ` ${finalRoll} <= ${Math.floor(target / diceCfg.difficultSuccessDiv)}`;\n          } else if (hardSuccess) {\n            message = ` ${finalRoll} <= ${Math.floor(target / diceCfg.hardSuccessDiv)}`;\n          } else {\n            message = ` ${finalRoll} <= ${target}`;\n          }\n        } else {\n          message = ` ${finalRoll} > ${target}`;\n        }\n      }\n\n      return {\n        success,\n        roll: finalRoll,\n        target,\n        margin: isDND ? finalRoll - target : target - finalRoll,\n        criticalSuccess,\n        criticalFailure,\n        message,\n        diceType,\n        rule: isDND ? 'dnd' : 'coc',\n      };\n    },\n\n    /**\n     *  - API \n     * @param callback \n     */\n    onReady(callback: () => void): void {\n      if (typeof callback !== 'function') {\n        console.warn('[AcuDice] onReady() ');\n        return;\n      }\n\n      if (isAcuDiceReady) {\n        runReadyCallback(callback);\n        return;\n      }\n\n      readyCallbacks.push(callback);\n    },\n\n    /**\n     * \n     * @param event  ('check' | 'contest')\n     * @param handler \n     */\n    on(event: string, handler: Function): void {\n      if (!eventHandlers.has(event)) {\n        eventHandlers.set(event, new Set());\n      }\n      eventHandlers.get(event)!.add(handler);\n    },\n\n    /**\n     * \n     * @param event  ('check' | 'contest')\n     * @param handler \n     */\n    off(event: string, handler: Function): void {\n      const handlers = eventHandlers.get(event);\n      if (handlers) {\n        handlers.delete(handler);\n      }\n    },\n\n    /**\n     * \n     */\n    getLatestCheck(): (AcuDice.CheckResult & { timestamp: number }) | null {\n      return checkHistory.length > 0 ? checkHistory[checkHistory.length - 1] : null;\n    },\n\n    /**\n     * \n     */\n    getLatestContest(): (AcuDice.ContestResult & { timestamp: number }) | null {\n      return contestHistory.length > 0 ? contestHistory[contestHistory.length - 1] : null;\n    },\n\n    /**\n     * \n     * @param options \n     * @param options.limit \n     * @param options.type  ('check' | 'contest')\n     */\n    getHistory(options?: { limit?: number; type?: 'check' | 'contest' }): Array<any> {\n      const limit = options?.limit;\n      const type = options?.type;\n\n      let results: Array<any> = [];\n\n      if (!type || type === 'check') {\n        results = results.concat(checkHistory.map(item => ({ ...item, _type: 'check' })));\n      }\n      if (!type || type === 'contest') {\n        results = results.concat(contestHistory.map(item => ({ ...item, _type: 'contest' })));\n      }\n\n      // \n      results.sort((a, b) => b.timestamp - a.timestamp);\n\n      //  limit\n      if (limit && limit > 0) {\n        results = results.slice(0, limit);\n      }\n\n      return results;\n    },\n\n    /**\n     * \n     * @returns  '<user>'  NPC\n     * @example\n     * AcuDice.listCharacters() // => ['<user>', 'NPC1', 'NPC2']\n     */\n    listCharacters(): string[] {\n      const rawData = cachedRawData || getTableData();\n      if (!rawData) return [];\n\n      const allTables = processJsonData(rawData || {});\n      const characters: string[] = [];\n\n      // \n      const playerResult = DashboardDataParser.findTable(allTables, 'player');\n      if (playerResult?.data?.rows?.length > 0) {\n        characters.push('<user>');\n      }\n\n      //  NPC\n      const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n      if (npcResult) {\n        const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n        npcParsed.forEach(npc => {\n          if (npc.name && typeof npc.name === 'string') {\n            characters.push(npc.name);\n          }\n        });\n      }\n\n      return characters;\n    },\n\n    /**\n     * \n     * @param name  '<user>'  NPC \n     * @returns  name  value\n     * @example\n     * AcuDice.getCharacterAttributes('<user>') // => [{ name: '', value: 50 }, { name: '', value: 60 }]\n     * AcuDice.getCharacterAttributes('') // => [{ name: '', value: 70 }]\n     */\n    getCharacterAttributes(name: string): Array<{ name: string; value: number }> {\n      if (!name || typeof name !== 'string') {\n        throw new Error('[AcuDice] getCharacterAttributes() ');\n      }\n      return getFullAttributesForCharacter(name);\n    },\n\n    /**\n     * \n     * @param name \n     * @param attribute \n     * @returns  null\n     * @example\n     * AcuDice.getAttributeValue('<user>', '') // => 50\n     * AcuDice.getAttributeValue('', '') // => 60\n     */\n    getAttributeValue(name: string, attribute: string): number | null {\n      if (!name || typeof name !== 'string') {\n        throw new Error('[AcuDice] getAttributeValue() ');\n      }\n      if (!attribute || typeof attribute !== 'string') {\n        throw new Error('[AcuDice] getAttributeValue() ');\n      }\n      return getAttributeValue(name, attribute);\n    },\n\n    /**\n     * \n     * @param options \n     * @returns \n     * @example\n     * await AcuDice.checkByCharacter({ name: '<user>', attribute: '' })\n     * await AcuDice.checkByCharacter({ name: 'NPC1', attribute: '', modifier: 5 })\n     */\n    async checkByCharacter(options: {\n      name: string;\n      attribute: string;\n      modifier?: number;\n      diceType?: string;\n      successCriteria?: 'lte' | 'gte';\n    }): Promise<{\n      success: boolean;\n      roll: number;\n      target: number;\n      margin: number;\n      criticalSuccess: boolean;\n      criticalFailure: boolean;\n      message: string;\n      diceType: string;\n      rule: 'coc' | 'dnd';\n    }> {\n      if (!options || !options.name || !options.attribute) {\n        throw new Error('[AcuDice] checkByCharacter()  name  attribute ');\n      }\n\n      // \n      const targetValue = getAttributeValue(options.name, options.attribute);\n      if (targetValue === null) {\n        throw new Error(`[AcuDice]  \"${options.name}\"  \"${options.attribute}\"`);\n      }\n\n      //  check \n      return this.check({\n        attribute: options.attribute,\n        targetValue,\n        modifier: options.modifier,\n        diceType: options.diceType,\n        successCriteria: options.successCriteria,\n      });\n    },\n\n    /**\n     * \n     * @param options \n     * @returns \n     * @example\n     * await AcuDice.contest({\n     *   left: { name: '<user>', attribute: '' },\n     *   right: { name: 'NPC1', attribute: '' }\n     * })\n     */\n    async contest(options: {\n      left: { name: string; attribute: string };\n      right: { name: string; attribute: string };\n      rule?: 'initiator_win' | 'initiator_lose' | 'tie';\n    }): Promise<{\n      left: { name: string; attribute: string; roll: number; target: number; successLevel: number };\n      right: { name: string; attribute: string; roll: number; target: number; successLevel: number };\n      winner: 'left' | 'right' | 'tie';\n      message: string;\n    }> {\n      if (!options?.left?.name || !options?.left?.attribute) {\n        throw new Error('[AcuDice] contest()  left.name  left.attribute ');\n      }\n      if (!options?.right?.name || !options?.right?.attribute) {\n        throw new Error('[AcuDice] contest()  right.name  right.attribute ');\n      }\n\n      // \n      const leftTarget = getAttributeValue(options.left.name, options.left.attribute);\n      if (leftTarget === null) {\n        throw new Error(`[AcuDice]  \"${options.left.name}\"  \"${options.left.attribute}\"`);\n      }\n\n      const rightTarget = getAttributeValue(options.right.name, options.right.attribute);\n      if (rightTarget === null) {\n        throw new Error(`[AcuDice]  \"${options.right.name}\"  \"${options.right.attribute}\"`);\n      }\n\n      // \n      const diceCfg = getDiceConfig();\n      const formula = diceCfg.lastDiceType || '1d100';\n\n      // \n      const leftResult = rollDiceExpression(formula);\n      const rightResult = rollDiceExpression(formula);\n\n      //  sides\n      const sidesMatch = formula.match(/\\d+d(\\d+)/i);\n      const sides = sidesMatch ? parseInt(sidesMatch[1], 10) : 100;\n\n      // \n      const leftSuccessLevel = getSuccessLevel(leftResult, leftTarget, sides);\n      const rightSuccessLevel = getSuccessLevel(rightResult, rightTarget, sides);\n\n      // \n      let winner: 'left' | 'right' | 'tie';\n      let message: string;\n\n      if (leftSuccessLevel.level > rightSuccessLevel.level) {\n        winner = 'left';\n        message = `${options.left.name} (${leftSuccessLevel.name}  ${rightSuccessLevel.name})`;\n      } else if (leftSuccessLevel.level < rightSuccessLevel.level) {\n        winner = 'right';\n        message = `${options.right.name} (${rightSuccessLevel.name}  ${leftSuccessLevel.name})`;\n      } else {\n        // \n        const tieRule = options.rule || diceCfg.contestTieRule || 'initiator_lose';\n        message = `( ${leftSuccessLevel.name})`;\n\n        if (tieRule === 'initiator_win') {\n          winner = 'left';\n          message += ` - ${options.left.name} `;\n        } else if (tieRule === 'tie') {\n          winner = 'tie';\n        } else {\n          // initiator_lose\n          winner = 'right';\n          message += ` - ${options.left.name} `;\n        }\n      }\n\n      const result = {\n        left: {\n          name: options.left.name,\n          attribute: options.left.attribute,\n          roll: leftResult,\n          target: leftTarget,\n          successLevel: leftSuccessLevel.level,\n        },\n        right: {\n          name: options.right.name,\n          attribute: options.right.attribute,\n          roll: rightResult,\n          target: rightTarget,\n          successLevel: rightSuccessLevel.level,\n        },\n        winner,\n        message,\n      };\n\n      // \n      emitEvent('contest', result);\n\n      // \n      contestHistory.push({ ...result, timestamp: Date.now() });\n      if (contestHistory.length > MAX_HISTORY) {\n        contestHistory.shift();\n      }\n\n      return result;\n    },\n  };\n\n  //  Object.defineProperty \n  defineAcuDiceOnWindow(window);\n\n  if (rootWindow !== window) {\n    try {\n      defineAcuDiceOnWindow(rootWindow);\n    } catch (error) {\n      console.warn('[AcuDice] ', error);\n    }\n  }\n\n  notifyReady();\n  dispatchReadyEvent(window);\n  if (rootWindow !== window) {\n    dispatchReadyEvent(rootWindow);\n  }\n\n  console.info('[AcuDice] API v1.0.0 ');\n\n  // ========================================\n  // ========================================\n  //  ( - )\n  //  renderFavoritesPanel() + bindFavoritesEvents() \n  // ========================================\n  /** @deprecated  renderFavoritesPanel()  */\n  const showFavoritesPanel = async () => {\n    const { $ } = getCore();\n    $('.acu-favorites-overlay').remove();\n\n    const config = getConfig();\n\n    // \n    const allFavorites = await FavoritesManager.getAll();\n    const allTags = await FavoritesManager.getAllTags();\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const currentTables = rawData || {};\n\n    // \n    const groupedByTag: Record<string, FavoriteItem[]> = {};\n    const untagged: FavoriteItem[] = [];\n\n    for (const fav of allFavorites) {\n      if (fav.tags && fav.tags.length > 0) {\n        for (const tag of fav.tags) {\n          if (!groupedByTag[tag]) groupedByTag[tag] = [];\n          groupedByTag[tag].push(fav);\n        }\n      } else {\n        untagged.push(fav);\n      }\n    }\n\n    // HTML\n    const renderFavoriteCard = (fav: FavoriteItem) => {\n      const preview = fav.header\n        .slice(0, 3)\n        .map(\n          (h, i) =>\n            `<span class=\"acu-fav-preview-item\"><b>${escapeHtml(h)}:</b> ${escapeHtml(String(fav.rowData[i] || ''))}</span>`,\n        )\n        .join('');\n      const tagsHtml = fav.tags.map(tag => `<span class=\"acu-favorites-tag\">${escapeHtml(tag)}</span>`).join('');\n      const sourceInfo = fav.sourceInfo ? `: ${escapeHtml(fav.sourceInfo.tableName)}` : '';\n\n      return `\n        <div class=\"acu-favorites-card\" data-id=\"${escapeHtml(fav.id)}\">\n          <div class=\"acu-favorites-card-header\">\n            <div class=\"acu-favorites-card-preview\">${preview}</div>\n            <div class=\"acu-favorites-card-source\">${sourceInfo}</div>\n          </div>\n          <div class=\"acu-favorites-card-tags\">${tagsHtml}</div>\n          <div class=\"acu-favorites-card-actions\">\n            <button class=\"acu-fav-btn acu-fav-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n            <button class=\"acu-fav-btn acu-fav-copy\" title=\"\"><i class=\"fa-solid fa-copy\"></i></button>\n            <button class=\"acu-fav-btn acu-fav-send\" title=\"\"><i class=\"fa-solid fa-paper-plane\"></i></button>\n            <button class=\"acu-fav-btn acu-fav-delete\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n        </div>\n      `;\n    };\n\n    // HTML\n    let contentHtml = '';\n\n    // \n    for (const tag of Object.keys(groupedByTag).sort()) {\n      contentHtml += `\n        <div class=\"acu-favorites-group\">\n          <div class=\"acu-favorites-group-title\"><i class=\"fa-solid fa-tag\"></i> ${escapeHtml(tag)} (${groupedByTag[tag].length})</div>\n          <div class=\"acu-favorites-group-cards\">\n            ${groupedByTag[tag].map(renderFavoriteCard).join('')}\n          </div>\n        </div>\n      `;\n    }\n\n    // \n    if (untagged.length > 0) {\n      contentHtml += `\n        <div class=\"acu-favorites-group\">\n          <div class=\"acu-favorites-group-title\"><i class=\"fa-solid fa-inbox\"></i>  (${untagged.length})</div>\n          <div class=\"acu-favorites-group-cards\">\n            ${untagged.map(renderFavoriteCard).join('')}\n          </div>\n        </div>\n      `;\n    }\n\n    if (allFavorites.length === 0) {\n      contentHtml = `\n        <div class=\"acu-favorites-empty\">\n          <i class=\"fa-solid fa-star\" style=\"font-size: 48px; opacity: 0.3;\"></i>\n          <p></p>\n          <p style=\"font-size: 12px; opacity: 0.7;\">  \"\"</p>\n        </div>\n      `;\n    }\n\n    // \n    const tagFilterOptions = allTags\n      .map(tag => `<option value=\"${escapeHtml(tag)}\">${escapeHtml(tag)}</option>`)\n      .join('');\n\n    const overlayHtml = `\n      <div class=\"acu-favorites-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-favorites-panel\">\n          <div class=\"acu-favorites-header\">\n            <h3><i class=\"fa-solid fa-star\"></i> </h3>\n            <div class=\"acu-favorites-header-actions\">\n              <button class=\"acu-fav-header-btn\" id=\"acu-fav-new\" title=\"\"><i class=\"fa-solid fa-plus\"></i> </button>\n              <button class=\"acu-fav-header-btn\" id=\"acu-fav-import\" title=\"\"><i class=\"fa-solid fa-file-import\"></i> </button>\n              <button class=\"acu-fav-header-btn\" id=\"acu-fav-export\" title=\"\"><i class=\"fa-solid fa-file-export\"></i> </button>\n              <button class=\"acu-fav-header-btn acu-fav-close\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n          </div>\n          <div class=\"acu-favorites-filter\">\n            <select id=\"acu-fav-tag-filter\">\n              <option value=\"\"></option>\n              ${tagFilterOptions}\n            </select>\n            <input type=\"text\" id=\"acu-fav-search\" placeholder=\"...\" />\n          </div>\n          <div class=\"acu-favorites-content\">\n            ${contentHtml}\n          </div>\n        </div>\n      </div>\n    `;\n\n    $('body').append(overlayHtml);\n\n    const $overlay = $('.acu-favorites-overlay');\n    const $panel = $overlay.find('.acu-favorites-panel');\n\n    // \n    const closePanel = () => {\n      $overlay.remove();\n    };\n\n    $overlay.on('click', e => {\n      if ($(e.target).hasClass('acu-favorites-overlay')) {\n        closePanel();\n      }\n    });\n\n    $panel.find('.acu-fav-close').on('click', closePanel);\n\n    // \n    $panel.find('#acu-fav-tag-filter').on('change', async function () {\n      const tag = $(this).val() as string;\n      const filtered = tag ? await FavoritesManager.getByTag(tag) : await FavoritesManager.getAll();\n      const $content = $panel.find('.acu-favorites-content');\n\n      if (filtered.length === 0) {\n        $content.html('<div class=\"acu-favorites-empty\"><p></p></div>');\n      } else {\n        $content.html(`<div class=\"acu-favorites-group-cards\">${filtered.map(renderFavoriteCard).join('')}</div>`);\n      }\n    });\n\n    // \n    $panel.find('#acu-fav-search').on('input', async function () {\n      const query = ($(this).val() as string).toLowerCase().trim();\n      const all = await FavoritesManager.getAll();\n      const filtered = query\n        ? all.filter(fav => {\n            const headerMatch = fav.header.some(h => h.toLowerCase().includes(query));\n            const dataMatch = fav.rowData.some(d => String(d).toLowerCase().includes(query));\n            const tagMatch = fav.tags.some(t => t.toLowerCase().includes(query));\n            return headerMatch || dataMatch || tagMatch;\n          })\n        : all;\n\n      const $content = $panel.find('.acu-favorites-content');\n      if (filtered.length === 0) {\n        $content.html('<div class=\"acu-favorites-empty\"><p></p></div>');\n      } else {\n        $content.html(`<div class=\"acu-favorites-group-cards\">${filtered.map(renderFavoriteCard).join('')}</div>`);\n      }\n    });\n\n    // \n    $panel.on('click', '.acu-fav-edit', async function () {\n      const id = $(this).closest('.acu-favorites-card').data('id');\n      const fav = await FavoritesManager.getById(id);\n      if (!fav) return;\n\n      showFavoriteEditModal(fav, async updated => {\n        await FavoritesManager.updateFavorite(id, updated);\n        toastr.success('');\n        closePanel();\n        showFavoritesPanel();\n      });\n    });\n\n    // \n    $panel.on('click', '.acu-fav-copy', async function () {\n      const id = $(this).closest('.acu-favorites-card').data('id');\n      const result = await FavoritesManager.duplicateFavorite(id);\n      if (result) {\n        toastr.success('');\n        closePanel();\n        showFavoritesPanel();\n      } else {\n        toastr.error('');\n      }\n    });\n\n    // \n    $panel.on('click', '.acu-fav-send', async function () {\n      const id = $(this).closest('.acu-favorites-card').data('id');\n      const fav = await FavoritesManager.getById(id);\n      if (!fav) return;\n\n      const compatible = FavoritesManager.findCompatibleTables(fav, currentTables);\n      if (compatible.length === 0) {\n        toastr.warning('');\n        return;\n      }\n\n      showSendToTableModal(fav, compatible, currentTables, () => {\n        toastr.success('');\n        closePanel();\n        renderInterface();\n      });\n    });\n\n    // \n    $panel.on('click', '.acu-fav-delete', async function () {\n      const id = $(this).closest('.acu-favorites-card').data('id');\n      if (!confirm('')) return;\n\n      const result = await FavoritesManager.deleteFavorite(id);\n      if (result) {\n        toastr.success('');\n        $(this)\n          .closest('.acu-favorites-card')\n          .fadeOut(200, function () {\n            $(this).remove();\n          });\n      } else {\n        toastr.error('');\n      }\n    });\n\n    // \n    $panel.find('#acu-fav-new').on('click', () => {\n      const tableKeys = Object.keys(currentTables);\n      if (tableKeys.length === 0) {\n        toastr.warning('');\n        return;\n      }\n\n      showNewFavoriteModal(currentTables, async (header, tableName) => {\n        const emptyRowData = header.map(() => '');\n        const newFav = await FavoritesManager.addFavorite('', tableName, header, emptyRowData, []);\n        if (newFav) {\n          toastr.success('');\n          closePanel();\n          showFavoritesPanel();\n          // \n          setTimeout(async () => {\n            const freshFav = await FavoritesManager.getById(newFav.id);\n            if (freshFav) {\n              showFavoriteEditModal(freshFav, async updated => {\n                await FavoritesManager.updateFavorite(newFav.id, updated);\n                toastr.success('');\n                $('.acu-favorites-overlay').remove();\n                showFavoritesPanel();\n              });\n            }\n          }, 100);\n        }\n      });\n    });\n\n    // \n    $panel.find('#acu-fav-export').on('click', async () => {\n      const json = await FavoritesManager.exportFavorites();\n      if (!json) {\n        toastr.error('');\n        return;\n      }\n\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      const now = new Date();\n      const dateStr = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}${String(now.getSeconds()).padStart(2, '0')}`;\n      a.href = url;\n      a.download = `favorites_${dateStr}.json`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      toastr.success('');\n    });\n\n    // \n    $panel.find('#acu-fav-import').on('click', () => {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const text = await file.text();\n          const result = await FavoritesManager.importFavorites(text);\n          if (result) {\n            toastr.success(`: ${result.added}, ${result.updated}`);\n            closePanel();\n            showFavoritesPanel();\n          } else {\n            toastr.error(': ');\n          }\n        } catch (err) {\n          toastr.error(': ' + (err instanceof Error ? err.message : String(err)));\n        }\n      };\n      input.click();\n    });\n  };\n\n  // \n  const showFavoriteEditModal = (fav: FavoriteItem, onSave: (updated: Partial<FavoriteItem>) => void) => {\n    const { $ } = getCore();\n    $('.acu-fav-edit-overlay').remove();\n\n    const config = getConfig();\n\n    // HTML\n    const renderEditRows = (header: string[], rowData: (string | number)[]) => {\n      return header\n        .map(\n          (h, i) => `\n        <div class=\"acu-fav-edit-row\" data-index=\"${i}\">\n          <input type=\"text\" class=\"acu-fav-edit-header\" value=\"${escapeHtml(h)}\" placeholder=\"\" />\n          <input type=\"text\" class=\"acu-fav-edit-value\" value=\"${escapeHtml(String(rowData[i] || ''))}\" placeholder=\"\" />\n          <button class=\"acu-fav-edit-remove\" title=\"\"><i class=\"fa-solid fa-minus\"></i></button>\n        </div>\n      `,\n        )\n        .join('');\n    };\n\n    const overlayHtml = `\n      <div class=\"acu-fav-edit-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-fav-edit-modal\">\n          <div class=\"acu-fav-edit-modal-header\">\n            <h4></h4>\n            <button class=\"acu-fav-edit-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-fav-edit-modal-body\">\n            <div class=\"acu-fav-edit-tags-section\">\n              <label> ():</label>\n              <input type=\"text\" id=\"acu-fav-edit-tags\" value=\"${escapeHtml(fav.tags.join(', '))}\" />\n            </div>\n            <div class=\"acu-fav-edit-rows\">\n              ${renderEditRows(fav.header, fav.rowData)}\n            </div>\n            <button class=\"acu-fav-edit-add-col\"><i class=\"fa-solid fa-plus\"></i> </button>\n          </div>\n          <div class=\"acu-fav-edit-modal-footer\">\n            <button class=\"acu-fav-edit-cancel\"></button>\n            <button class=\"acu-fav-edit-save\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    $('body').append(overlayHtml);\n\n    const $overlay = $('.acu-fav-edit-overlay');\n    const $modal = $overlay.find('.acu-fav-edit-modal');\n\n    const closeModal = () => $overlay.remove();\n\n    $overlay.on('click', e => {\n      if ($(e.target).hasClass('acu-fav-edit-overlay')) closeModal();\n    });\n\n    $modal.find('.acu-fav-edit-close, .acu-fav-edit-cancel').on('click', closeModal);\n\n    // \n    $modal.on('click', '.acu-fav-edit-remove', function () {\n      $(this).closest('.acu-fav-edit-row').remove();\n    });\n\n    // \n    $modal.find('.acu-fav-edit-add-col').on('click', () => {\n      const newIndex = $modal.find('.acu-fav-edit-row').length;\n      const newRowHtml = `\n        <div class=\"acu-fav-edit-row\" data-index=\"${newIndex}\">\n          <input type=\"text\" class=\"acu-fav-edit-header\" value=\"\" placeholder=\"\" />\n          <input type=\"text\" class=\"acu-fav-edit-value\" value=\"\" placeholder=\"\" />\n          <button class=\"acu-fav-edit-remove\" title=\"\"><i class=\"fa-solid fa-minus\"></i></button>\n        </div>\n      `;\n      $modal.find('.acu-fav-edit-rows').append(newRowHtml);\n    });\n\n    // \n    $modal.find('.acu-fav-edit-save').on('click', () => {\n      const newHeader: string[] = [];\n      const newRowData: (string | number)[] = [];\n\n      $modal.find('.acu-fav-edit-row').each(function () {\n        const h = $(this).find('.acu-fav-edit-header').val() as string;\n        const v = $(this).find('.acu-fav-edit-value').val() as string;\n        if (h.trim()) {\n          newHeader.push(h.trim());\n          newRowData.push(v);\n        }\n      });\n\n      const tagsStr = ($modal.find('#acu-fav-edit-tags').val() as string) || '';\n      const newTags = tagsStr\n        .split(',')\n        .map(t => t.trim())\n        .filter(t => t.length > 0);\n\n      onSave({\n        header: newHeader,\n        rowData: newRowData,\n        tags: newTags,\n      });\n\n      closeModal();\n    });\n  };\n\n  // \n  const showNewFavoriteModal = (\n    currentTables: Record<string, any>,\n    onCreate: (header: string[], tableName: string) => void,\n  ) => {\n    const { $ } = getCore();\n    $('.acu-fav-new-overlay').remove();\n\n    const config = getConfig();\n\n    const tableOptions = Object.keys(currentTables)\n      .map(key => {\n        const table = currentTables[key];\n        const name = table.name || key;\n        return `<option value=\"${escapeHtml(key)}\">${escapeHtml(name)}</option>`;\n      })\n      .join('');\n\n    const overlayHtml = `\n      <div class=\"acu-fav-new-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-fav-new-modal\">\n          <div class=\"acu-fav-new-modal-header\">\n            <h4></h4>\n            <button class=\"acu-fav-new-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-fav-new-modal-body\">\n            <label>:</label>\n            <select id=\"acu-fav-new-template\">\n              ${tableOptions}\n            </select>\n          </div>\n          <div class=\"acu-fav-new-modal-footer\">\n            <button class=\"acu-fav-new-cancel\"></button>\n            <button class=\"acu-fav-new-create\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    $('body').append(overlayHtml);\n\n    const $overlay = $('.acu-fav-new-overlay');\n    const $modal = $overlay.find('.acu-fav-new-modal');\n\n    const closeModal = () => $overlay.remove();\n\n    $overlay.on('click', e => {\n      if ($(e.target).hasClass('acu-fav-new-overlay')) closeModal();\n    });\n\n    $modal.find('.acu-fav-new-close, .acu-fav-new-cancel').on('click', closeModal);\n\n    $modal.find('.acu-fav-new-create').on('click', () => {\n      const key = $modal.find('#acu-fav-new-template').val() as string;\n      const table = currentTables[key];\n      if (!table || !table.content || !table.content[0]) {\n        toastr.error('');\n        return;\n      }\n\n      const fullHeader = table.content[0];\n      const header: string[] = fullHeader.slice(1).map((h: any) => String(h || ''));\n      const tableName = table.name || key;\n\n      onCreate(header, tableName);\n      closeModal();\n    });\n  };\n\n  // \n  const showSendToTableModal = (\n    fav: FavoriteItem,\n    compatible: TableCompatibility[],\n    currentTables: Record<string, any>,\n    onSuccess: () => void,\n  ) => {\n    const { $ } = getCore();\n    $('.acu-fav-send-overlay').remove();\n\n    const config = getConfig();\n\n    const tableListHtml = compatible\n      .map(c => {\n        const modeLabel =\n          c.mode === 'strict'\n            ? '<span class=\"acu-match-full\"> </span>'\n            : `<span class=\"acu-match-partial\">  (${c.matchedCols.length}/${fav.header.length})</span>`;\n        const unmatchedInfo =\n          c.unmatchedCols.length > 0\n            ? `<div class=\"acu-fav-send-unmatched\">: ${c.unmatchedCols.join(', ')}</div>`\n            : '';\n\n        return `\n        <div class=\"acu-fav-send-option\" data-uid=\"${escapeHtml(c.tableUid)}\" data-mode=\"${c.mode}\">\n          <div class=\"acu-fav-send-option-name\">${escapeHtml(c.tableName)}</div>\n          <div class=\"acu-fav-send-option-mode\">${modeLabel}</div>\n          ${unmatchedInfo}\n        </div>\n      `;\n      })\n      .join('');\n\n    const overlayHtml = `\n      <div class=\"acu-fav-send-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-fav-send-modal\">\n          <div class=\"acu-fav-send-modal-header\">\n            <h4></h4>\n            <button class=\"acu-fav-send-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-fav-send-modal-body\">\n            ${tableListHtml}\n          </div>\n          <div class=\"acu-fav-send-modal-footer\">\n            <button class=\"acu-fav-send-cancel\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    $('body').append(overlayHtml);\n\n    const $overlay = $('.acu-fav-send-overlay');\n    const $modal = $overlay.find('.acu-fav-send-modal');\n\n    const closeModal = () => $overlay.remove();\n\n    $overlay.on('click', e => {\n      if ($(e.target).hasClass('acu-fav-send-overlay')) closeModal();\n    });\n\n    $modal.find('.acu-fav-send-close, .acu-fav-send-cancel').on('click', closeModal);\n\n    // \n    $modal.on('click', '.acu-fav-send-option', async function () {\n      const uid = $(this).data('uid') as string;\n      const mode = $(this).data('mode') as string;\n      const table = currentTables[uid];\n\n      if (!table || !table.content) {\n        toastr.error('');\n        return;\n      }\n\n      const targetHeader: string[] = table.content[0].slice(1).map((h: any) => String(h || ''));\n      const newRow = FavoritesManager.mapRowToTable(fav, targetHeader);\n\n      // \n      table.content.push(newRow);\n\n      //  saveDataOnly \n      const rawData = cachedRawData || getTableData();\n      if (!rawData || !rawData[uid]?.content) {\n        toastr.error('');\n        return;\n      }\n      rawData[uid].content = table.content;\n      cachedRawData = rawData;\n\n      try {\n        await saveDataOnly(rawData, [uid]);\n        console.log('[DICE]FavoritesManager ');\n      } catch (err) {\n        console.error('[DICE]FavoritesManager :', err);\n        toastr.error(': ' + (err.message || err));\n        return;\n      }\n\n      // \n      if (mode === 'loose') {\n        const unmatchedCount = fav.header.filter(h => !targetHeader.includes(h)).length;\n        if (unmatchedCount > 0) {\n          toastr.info(`${unmatchedCount}`);\n        }\n      }\n\n      closeModal();\n      onSuccess();\n    });\n  };\n\n  const showSettingsModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-settings-dialog)').remove();\n    isSettingsOpen = true;\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // \n    const expandedGroups = Store.get('acu_settings_expanded', ['appearance']);\n\n    const isGroupExpanded = groupId => expandedGroups.includes(groupId);\n    // HTMLMVU\n    const SPECIAL_BUTTONS_CONFIG = [\n      { key: '__dice__', name: '', icon: 'fa-dice-d20' },\n      { key: '__changes__', name: '', icon: 'fa-code-compare' },\n      { key: '__mvu__', name: 'MVU', icon: 'fa-code-branch' },\n      { key: '__favorites__', name: '', icon: 'fa-star' },\n    ];\n\n    const tableManagerHtml = (() => {\n      const rawData = cachedRawData || getTableData();\n      const tables = processJsonData(rawData || {});\n      const savedOrder = getSavedTableOrder() || [];\n      const hiddenList = getHiddenTables();\n\n      //  + \n      let allItems = [];\n\n      // \n      SPECIAL_BUTTONS_CONFIG.forEach(btn => {\n        // MVU \n        allItems.push({ key: btn.key, name: btn.name, icon: btn.icon, isSpecial: true });\n      });\n\n      // \n      Object.keys(tables).forEach(name => {\n        allItems.push({ key: name, name: name, icon: getIconForTableName(name), isSpecial: false });\n      });\n\n      // \n      if (savedOrder.length > 0) {\n        const orderMap = new Map(savedOrder.map((k, i) => [k, i]));\n        allItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      return allItems\n        .map(item => {\n          const isHidden = hiddenList.includes(item.key);\n          const specialClass = item.isSpecial ? ' acu-special-item' : '';\n          const displayName = item.name;\n          return (\n            '<div class=\"acu-table-manager-item' +\n            specialClass +\n            (isHidden ? ' hidden-table' : '') +\n            '\" data-table-name=\"' +\n            escapeHtml(item.key) +\n            '\" draggable=\"false\">' +\n            '<div class=\"acu-table-item-check\" title=\"/\">' +\n            '<i class=\"fa-solid ' +\n            (isHidden ? 'fa-eye-slash' : 'fa-eye') +\n            '\"></i>' +\n            '</div>' +\n            '<div class=\"acu-table-item-icon\"><i class=\"fa-solid ' +\n            item.icon +\n            '\"></i></div>' +\n            '<div class=\"acu-table-item-name\">' +\n            escapeHtml(displayName) +\n            '</div>' +\n            '<div class=\"acu-table-item-handle\" title=\"\">' +\n            '<i class=\"fa-solid fa-grip-vertical\"></i>' +\n            '</div>' +\n            '</div>'\n          );\n        })\n        .join('');\n    })();\n    const chevron = groupId => (isGroupExpanded(groupId) ? 'fa-chevron-down' : 'fa-chevron-right');\n\n    const dialog = $(`\n        <div class=\"acu-edit-overlay\">\n            <div class=\"acu-edit-dialog acu-settings-dialog ${currentThemeClass}\">\n                <div class=\"acu-settings-header\">\n                    <div class=\"acu-settings-title\">\n                        <span class=\"acu-settings-text\">\n                            <i class=\"fa-solid fa-cog\"></i> \n                            <span class=\"acu-version-badge\">${SCRIPT_VERSION}</span><button class=\"acu-manual-update-btn\" id=\"acu-manual-update-btn\" title=\"\"><i class=\"fa-solid fa-rotate\"></i></button>\n                        </span>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-help-btn\" id=\"acu-help-btn\" title=\"\"><i class=\"fa-solid fa-question-circle\"></i></button>\n                        <button class=\"acu-close-btn\" id=\"dlg-close-x\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n\n                <div class=\"acu-settings-body\">\n                <!--  -->\n                <div class=\"acu-settings-group ${isGroupExpanded('appearance') ? '' : 'collapsed'}\" data-group=\"appearance\">                    <div class=\"acu-settings-group-title\">\n                        <i class=\"fa-solid ${chevron('appearance')} acu-group-chevron\"></i>\n                        <i class=\"fa-solid fa-palette\"></i> \n                    </div>\n                    <div class=\"acu-settings-group-body\">\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-theme\" class=\"acu-setting-select\">\n                                ${THEMES.map(t => `<option value=\"${t.id}\" ${t.id === config.theme ? 'selected' : ''}>${t.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-font-family\" class=\"acu-setting-select\">\n                                ${FONTS.map(f => `<option value=\"${f.id}\" ${f.id === config.fontFamily ? 'selected' : ''}>${f.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-main\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.fontSize}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-opt\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.optionFontSize || 12}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row acu-setting-row-toggle\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <label class=\"acu-toggle\">\n                                <input type=\"checkbox\" id=\"cfg-new\" ${config.highlightNew ? 'checked' : ''}>\n                                <span class=\"acu-toggle-slider\"></span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('layout') ? '' : 'collapsed'}\" data-group=\"layout\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('layout')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-th-large\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-width\" data-min=\"200\" data-max=\"500\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.cardWidth}px</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-layout\" class=\"acu-setting-select\">\n                                    <option value=\"horizontal\" ${config.layout !== 'vertical' ? 'selected' : ''}></option>\n                                    <option value=\"vertical\" ${config.layout === 'vertical' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                    <span class=\"acu-setting-hint\"></span>\n                                </div>\n                                <select id=\"cfg-grid-cols\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"2\" ${config.gridColumns == 2 ? 'selected' : ''}>2</option>\n                                    <option value=\"3\" ${config.gridColumns == 3 ? 'selected' : ''}>3</option>\n                                    <option value=\"4\" ${config.gridColumns == 4 ? 'selected' : ''}>4</option>\n                                    <option value=\"auto\" ${config.gridColumns === 'auto' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-per-page\" data-min=\"10\" data-max=\"200\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.itemsPerPage}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('position') ? '' : 'collapsed'}\" data-group=\"position\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('position')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-arrows-alt\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-position\" class=\"acu-setting-select\">\n                                    <option value=\"fixed\" ${config.positionMode !== 'embedded' ? 'selected' : ''}></option>\n                                    <option value=\"embedded\" ${config.positionMode === 'embedded' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-action-pos\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bottom\" ${config.actionsPosition !== 'top' ? 'selected' : ''}></option>\n                                    <option value=\"top\" ${config.actionsPosition === 'top' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-style\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bar\" ${config.collapseStyle === 'bar' ? 'selected' : ''}></option>\n                                    <option value=\"pill\" ${config.collapseStyle === 'pill' ? 'selected' : ''}></option>\n                                    <option value=\"mini\" ${config.collapseStyle === 'mini' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\" id=\"cfg-col-align-row\" style=\"${config.collapseStyle === 'bar' ? 'display:none;' : ''}\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-align\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"right\" ${config.collapseAlign === 'right' ? 'selected' : ''}></option>\n                                    <option value=\"left\" ${config.collapseAlign === 'left' ? 'selected' : ''}></option>\n                                    <option value=\"center\" ${config.collapseAlign === 'center' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('options') ? '' : 'collapsed'}\" data-group=\"options\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('options')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-gamepad\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row acu-setting-row-toggle\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-show-opt\" ${config.showOptionPanel !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                            <div class=\"acu-setting-row acu-setting-row-toggle\" id=\"row-auto-send\" style=\"${config.showOptionPanel !== false ? '' : 'display:none;'}\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-auto-send\" ${config.clickOptionToAutoSend !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('tables') ? '' : 'collapsed'}\" data-group=\"tables\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('tables')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-table\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-table-manager-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <div class=\"acu-table-manager-list\" id=\"table-manager-list\">\n                                ${tableManagerHtml}\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('validation') ? '' : 'collapsed'}\" data-group=\"validation\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('validation')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-clipboard-check\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${PresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === PresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}${p.id === 'default' ? ` v${PRESET_FORMAT_VERSION}` : p.builtin ? ' ()' : ''}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-reset\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> <i class=\"fa-solid fa-shield-halved\"></i> \n                            </div>\n                            <div class=\"acu-validation-rules-list\" id=\"validation-rules-list\">\n                                ${ValidationRuleManager.getAllRules()\n                                  .map(rule => {\n                                    const typeInfo = RULE_TYPE_INFO[rule.ruleType] || {\n                                      name: rule.ruleType,\n                                      icon: 'fa-question',\n                                    };\n                                    const isTableRule = typeInfo.scope === 'table';\n                                    const hasIntercept = rule.intercept;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n                                            <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n                                        </div>\n                                        <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n                                        <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <button class=\"acu-add-rule-btn\" id=\"btn-add-validation-rule\">\n                                <i class=\"fa-solid fa-plus\"></i> \n                            </button>\n                        </div>\n                    </div>\n\n                    <!--  - Phase 4.1 -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('regex') ? '' : 'collapsed'}\" data-group=\"regex\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('regex')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-wand-magic-sparkles\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"regex-preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${RegexPresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === RegexPresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}${p.id === 'regex_default' ? ` v${PRESET_FORMAT_VERSION}` : ''}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-reset\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <!--  -->\n                            <div class=\"acu-validation-rules-list\" id=\"regex-rules-list\">\n                                ${RegexTransformationManager.getAllRules()\n                                  .map(rule => {\n                                    const scopeIcon =\n                                      rule.scope.type === 'global'\n                                        ? 'fa-globe'\n                                        : rule.scope.type === 'table'\n                                          ? 'fa-table'\n                                          : 'fa-columns';\n                                    const scopeText =\n                                      rule.scope.type === 'global'\n                                        ? ''\n                                        : rule.scope.type === 'table'\n                                          ? rule.scope.tableNames?.join(',')\n                                          : `${rule.scope.tableNames?.join(',')}.${rule.scope.columnNames?.join(',')}`;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\": ${escapeHtml(rule.scope.type)}\">\n                                            <i class=\"fa-solid ${scopeIcon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\" style=\"font-size:10px;\">${escapeHtml(scopeText)} | ${escapeHtml(rule.operation)}</div>\n                                        </div>\n                                        <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <div style=\"display:flex;gap:8px;margin-top:8px;\">\n                                <button class=\"acu-add-rule-btn\" id=\"btn-add-regex-rule\" style=\"flex:1;\">\n                                    <i class=\"fa-solid fa-plus\"></i> \n                                </button>\n                                <button class=\"acu-add-rule-btn\" id=\"btn-import-tavern-regex\" style=\"flex:1;\">\n                                    <i class=\"fa-solid fa-file-import\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('advanced') ? '' : 'collapsed'}\" data-group=\"advanced\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('advanced')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-sliders-h\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-fire\"></i> </span>\n                                </div>\n                                <select id=\"cfg-crazy-mode\" class=\"acu-setting-select\" style=\"width: 90px; min-width: 90px; text-align: center; text-align-last: center;\">\n                                    <option value=\"0\"> </option>\n                                    <option value=\"25\"> </option>\n                                    <option value=\"50\"> </option>\n                                    <option value=\"75\"> </option>\n                                    <option value=\"100\"> </option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-dice-d20\"></i> </span>\n                                </div>\n                                <button id=\"cfg-attr-preset-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-wand-magic-sparkles\"></i> </span>\n                                </div>\n                                <button id=\"cfg-action-preset-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-filter\"></i> </span>\n                                </div>\n                                <button id=\"cfg-blacklist-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-bug\"></i> Debug</span>\n                                </div>\n                                <button id=\"btn-open-debug-console\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-terminal\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row acu-setting-row-toggle\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-bell-slash\"></i> -</span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-db-toast-mute\" ${config.muteDatabaseToasts ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                </div><!--  .acu-settings-body -->\n            </div>\n        </div>\n    `);\n    $('body').append(dialog);\n\n    // ===  ===\n    dialog.find('.acu-settings-group-title').on('click', function () {\n      const $group = $(this).closest('.acu-settings-group');\n      const $body = $group.find('.acu-settings-group-body');\n\n      // \n      if ($body.hasClass('acu-animating')) return;\n\n      const groupId = $group.data('group');\n      const $chevron = $(this).find('.acu-group-chevron');\n      let expanded = Store.get('acu_settings_expanded', ['appearance']);\n\n      if ($group.hasClass('collapsed')) {\n        // \n        $group.removeClass('collapsed');\n        $chevron.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n        if (!expanded.includes(groupId)) expanded.push(groupId);\n\n        $body.addClass('acu-animating').show();\n        const targetHeight = $body.prop('scrollHeight');\n        $body.css('height', 0).animate({ height: targetHeight }, 180, function () {\n          $(this).css('height', '').removeClass('acu-animating');\n        });\n      } else {\n        // \n        $group.addClass('collapsed');\n        $chevron.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n        expanded = expanded.filter(id => id !== groupId);\n\n        const currentHeight = $body.outerHeight();\n        $body\n          .addClass('acu-animating')\n          .css('height', currentHeight)\n          .animate({ height: 0 }, 180, function () {\n            $(this).hide().css('height', '').removeClass('acu-animating');\n          });\n      }\n\n      Store.set('acu_settings_expanded', expanded);\n    });\n\n    // ===  ===\n    // \n    dialog.find('#cfg-theme').on('change', function () {\n      const newTheme = $(this).val();\n      saveConfig({ theme: newTheme });\n      dialog\n        .find('.acu-edit-dialog')\n        .removeClass(THEMES.map(t => `acu-theme-${t.id}`).join(' '))\n        .addClass(`acu-theme-${newTheme}`);\n    });\n\n    // \n    dialog.find('#cfg-font-family').on('change', function () {\n      saveConfig({ fontFamily: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-attr-preset-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showAttributePresetManager();\n    });\n\n    // \n    dialog.find('#cfg-action-preset-manage').on('click', function (e) {\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showActionPresetManager();\n    });\n\n    // \n    const initCrazyModeUI = () => {\n      const crazyConfig = getCrazyModeConfig();\n      // enabledcrazyLevel\n      const selectValue = crazyConfig.enabled ? crazyConfig.crazyLevel : 0;\n      dialog.find('#cfg-crazy-mode').val(selectValue);\n\n      // \n      dialog.find('#cfg-crazy-mode').on('change', function () {\n        const value = parseInt($(this).val() as string, 10);\n        if (value === 0) {\n          saveCrazyModeConfig({ enabled: false, crazyLevel: 50 });\n        } else {\n          saveCrazyModeConfig({ enabled: true, crazyLevel: value });\n        }\n      });\n    };\n    initCrazyModeUI();\n\n    dialog.find('#cfg-db-toast-mute').on('change', function () {\n      saveConfig({ muteDatabaseToasts: $(this).is(':checked') });\n    });\n\n    // \n    dialog.find('#cfg-blacklist-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      showBlacklistManagerModal();\n    });\n\n    // \n    dialog.find('#cfg-layout').on('change', function () {\n      saveConfig({ layout: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-grid-cols').on('change', function () {\n      saveConfig({ gridColumns: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-position').on('change', function () {\n      saveConfig({ positionMode: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-action-pos').on('change', function () {\n      saveConfig({ actionsPosition: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-style').on('change', function () {\n      const newStyle = $(this).val();\n      saveConfig({ collapseStyle: newStyle });\n\n      // \n      const $alignRow = dialog.find('#cfg-col-align-row');\n      if (newStyle === 'bar') {\n        $alignRow.hide();\n      } else {\n        $alignRow.show();\n      }\n\n      renderInterface();\n    });\n    dialog.find('#cfg-col-align').on('change', function () {\n      saveConfig({ collapseAlign: $(this).val() });\n      renderInterface();\n    });\n\n    // \n    dialog.find('#cfg-show-opt').on('change', function () {\n      const checked = $(this).is(':checked');\n      saveConfig({ showOptionPanel: checked });\n      if (checked) dialog.find('#row-auto-send').slideDown(200);\n      else dialog.find('#row-auto-send').slideUp(200);\n      renderInterface();\n    });\n    dialog.find('#cfg-auto-send').on('change', function () {\n      saveConfig({ clickOptionToAutoSend: $(this).is(':checked') });\n    });\n    dialog.find('#cfg-new').on('change', function () {\n      saveConfig({ highlightNew: $(this).is(':checked') });\n      renderInterface();\n    });\n\n    // === / ===\n    dialog.find('.acu-table-item-check').on('click', function (e) {\n      e.stopPropagation();\n      const $item = $(this).closest('.acu-table-manager-item');\n      const tableName = $item.data('table-name');\n      let hiddenList = getHiddenTables();\n      const $icon = $(this).find('i');\n\n      if (hiddenList.includes(tableName)) {\n        // \n        hiddenList = hiddenList.filter(n => n !== tableName);\n        $item.removeClass('hidden-table');\n        $icon.removeClass('fa-eye-slash').addClass('fa-eye');\n      } else {\n        // \n        hiddenList.push(tableName);\n        $item.addClass('hidden-table');\n        $icon.removeClass('fa-eye').addClass('fa-eye-slash');\n      }\n\n      saveHiddenTables(hiddenList);\n      renderInterface();\n    });\n\n    // ===  ===\n    const $list = dialog.find('#table-manager-list');\n    let dragState = {\n      isDragging: false,\n      element: null,\n      timer: null,\n      startY: 0,\n    };\n\n    const clearDragState = () => {\n      if (dragState.timer) {\n        clearTimeout(dragState.timer);\n        dragState.timer = null;\n      }\n      if (dragState.element) {\n        $(dragState.element).removeClass('acu-dragging');\n      }\n      $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n      dragState.isDragging = false;\n      dragState.element = null;\n    };\n\n    const startDrag = $item => {\n      dragState.isDragging = true;\n      dragState.element = $item[0];\n      $item.addClass('acu-dragging');\n    };\n\n    const finishDrag = () => {\n      if (!dragState.isDragging || !dragState.element) {\n        clearDragState();\n        return;\n      }\n\n      const $dragged = $(dragState.element);\n      const $target = $list.find('.acu-drag-above, .acu-drag-below').first();\n\n      if ($target.length && $target[0] !== dragState.element) {\n        if ($target.hasClass('acu-drag-above')) {\n          $dragged.insertBefore($target);\n        } else {\n          $dragged.insertAfter($target);\n        }\n\n        // \n        const newOrder = [];\n        $list.find('.acu-table-manager-item').each(function () {\n          newOrder.push($(this).data('table-name'));\n        });\n        saveTableOrder(newOrder);\n      }\n\n      clearDragState();\n    };\n\n    // \n    $list[0].addEventListener(\n      'pointerdown',\n      function (e) {\n        const handle = e.target.closest('.acu-table-item-handle');\n        if (!handle) return;\n\n        e.preventDefault();\n        const $item = $(handle).closest('.acu-table-manager-item');\n        dragState.startY = e.clientY;\n        startDrag($item);\n        handle.setPointerCapture(e.pointerId);\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerdown', function (e) {\n      const item = e.target.closest('.acu-table-manager-item');\n      if (!item) return;\n      // \n      if (e.target.closest('.acu-table-item-check, .acu-table-item-handle')) return;\n\n      dragState.startY = e.clientY;\n      const $item = $(item);\n\n      dragState.timer = setTimeout(() => {\n        startDrag($item);\n      }, 350);\n    });\n\n    // \n    $list[0].addEventListener(\n      'pointermove',\n      function (e) {\n        // \n        if (dragState.timer && Math.abs(e.clientY - dragState.startY) > 8) {\n          clearTimeout(dragState.timer);\n          dragState.timer = null;\n        }\n\n        if (!dragState.isDragging || !dragState.element) return;\n        e.preventDefault();\n\n        // \n        const items = $list.find('.acu-table-manager-item').not('.acu-dragging');\n        let targetItem = null;\n        let insertBefore = true;\n\n        items.each(function () {\n          const rect = this.getBoundingClientRect();\n          const midY = rect.top + rect.height / 2;\n\n          if (e.clientY < midY && !targetItem) {\n            targetItem = this;\n            insertBefore = true;\n          } else if (e.clientY >= rect.top && e.clientY <= rect.bottom) {\n            targetItem = this;\n            insertBefore = e.clientY < midY;\n          }\n        });\n\n        // \n        $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n        if (targetItem && targetItem !== dragState.element) {\n          $(targetItem).addClass(insertBefore ? 'acu-drag-above' : 'acu-drag-below');\n        }\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerup', finishDrag);\n    $list[0].addEventListener('pointercancel', clearDragState);\n\n    // \n    $list[0].addEventListener(\n      'touchmove',\n      function (e) {\n        if (dragState.isDragging) {\n          e.preventDefault();\n        }\n      },\n      { passive: false },\n    );\n\n    // === Stepper  ===\n    dialog.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        const unit = id === 'cfg-per-page' ? '' : 'px';\n        $value.text(newVal + unit);\n\n        // \n        if (id === 'cfg-width') {\n          $('.acu-wrapper').css('--acu-card-width', newVal + 'px');\n          saveConfig({ cardWidth: newVal });\n        } else if (id === 'cfg-font-main') {\n          $('.acu-wrapper').css('--acu-font-size', newVal + 'px');\n          saveConfig({ fontSize: newVal });\n        } else if (id === 'cfg-font-opt') {\n          $('.acu-wrapper, .acu-embedded-options-container').css('--acu-opt-font-size', newVal + 'px');\n          saveConfig({ optionFontSize: newVal });\n        } else if (id === 'cfg-per-page') {\n          saveConfig({ itemsPerPage: newVal });\n        }\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    // === /===\n    dialog.on('click', '.acu-rule-toggle', function (e) {\n      e.stopPropagation();\n      const $toggle = $(this);\n      const $item = $toggle.closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const $icon = $toggle.find('i');\n      const isCurrentlyActive = $toggle.hasClass('active');\n\n      // \n      ValidationRuleManager.toggleRuleEnabled(ruleId, !isCurrentlyActive);\n\n      //  UI\n      if (isCurrentlyActive) {\n        $toggle.removeClass('active');\n        $icon.removeClass('fa-toggle-on').addClass('fa-toggle-off');\n        $item.addClass('disabled');\n      } else {\n        $toggle.addClass('active');\n        $icon.removeClass('fa-toggle-off').addClass('fa-toggle-on');\n        $item.removeClass('disabled');\n      }\n    });\n\n    // ===  ===\n    dialog.on('click', '#validation-rules-list .acu-rule-edit', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const rule = ValidationRuleManager.getRule(ruleId);\n      if (!rule) return;\n\n      // \n      showAddValidationRuleModal(dialog, ruleId);\n    });\n\n    // === ===\n    dialog.on('click', '#validation-rules-list .acu-rule-delete', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const $item = $(this).closest('.acu-validation-rule-item');\n\n      if (confirm('')) {\n        if (ValidationRuleManager.removeCustomRule(ruleId)) {\n          $item.fadeOut(200, function () {\n            $(this).remove();\n          });\n        }\n      }\n    });\n\n    // === ===\n    dialog.on('click', '.acu-rule-intercept', function (e) {\n      e.stopPropagation();\n      const $btn = $(this);\n      const ruleId = $btn.data('rule-id');\n      const isCurrentlyActive = $btn.hasClass('active');\n\n      if (ValidationRuleManager.toggleRuleIntercept(ruleId, !isCurrentlyActive)) {\n        if (isCurrentlyActive) {\n          $btn.removeClass('active').attr('title', '');\n        } else {\n          $btn.addClass('active').attr('title', '');\n        }\n      }\n    });\n\n    // ===  ===\n    const refreshPresetUI = () => {\n      ValidationRuleManager.clearCache();\n      const rules = ValidationRuleManager.getAllRules();\n      let html = '';\n      rules.forEach(rule => {\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType] || { name: rule.ruleType, icon: 'fa-question' };\n        const isTableRule = typeInfo.scope === 'table';\n        const hasIntercept = rule.intercept;\n        html += `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo.icon}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n            </div>\n            <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n            <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n              <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>`;\n      });\n      dialog.find('#validation-rules-list').html(html);\n    };\n\n    // \n    dialog.find('#preset-select').on('change', function () {\n      if (PresetManager.setActivePreset($(this).val())) {\n        refreshPresetUI();\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-dup').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const newPreset = PresetManager.duplicatePreset(preset.id);\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-new').on('click', function () {\n      const name = prompt(':', '');\n      if (!name?.trim()) return;\n      const newPreset = PresetManager.createPreset(name.trim());\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-del').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      if (preset.id === 'default') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!confirm(`\"${preset.name}\"`)) return;\n      if (PresetManager.deletePreset(preset.id)) {\n        dialog.find(`#preset-select option[value=\"${preset.id}\"]`).remove();\n        dialog.find('#preset-select').val('default').trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-export').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const json = PresetManager.exportPreset(preset.id);\n      if (json) {\n        // \n        try {\n          const filename = `acu_validation_preset_${preset.name || preset.id}_${Date.now()}.json`;\n          const blob = new Blob([json], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = filename;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        } catch (e) {\n          //  Blob /\n          navigator.clipboard\n            .writeText(json)\n            .then(() => {})\n            .catch(() => {\n              prompt(':', json);\n            });\n        }\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-import').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const json = await file.text();\n          if (!json?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(json.trim());\n          } catch {\n            if (window.toastr) window.toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.preset?.name || '';\n          const existingPresets = PresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = json.trim();\n            if (newName && parsedData?.preset) {\n              parsedData.preset.name = newName;\n              // IDID\n              parsedData.preset.id = `preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset && existingPreset.id !== 'default') {\n                PresetManager.deletePreset(existingPreset.id);\n                dialog.find(`#preset-select option[value=\"${existingPreset.id}\"]`).remove();\n              }\n            }\n\n            const result = PresetManager.importPreset(finalJson, false);\n            if (result && result.preset) {\n              const newPreset = result.preset;\n              dialog\n                .find('#preset-select')\n                .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n              dialog.find('#preset-select').val(newPreset.id).trigger('change');\n\n              // \n              if (result.needsMerge) {\n                if (\n                  confirm(\n                    '\\n\\n',\n                  )\n                ) {\n                  if (PresetManager.mergePresetWithDefaults(newPreset.id)) {\n                    refreshPresetUI();\n                  } else {\n                    if (window.toastr) window.toastr.error('');\n                  }\n                }\n              }\n            } else {\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          console.error('[DICE]PresetManager :', err);\n          if (window.toastr) window.toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // \n    dialog.find('#btn-preset-reset').on('click', function () {\n      if (!confirm('\\n')) return;\n      if (PresetManager.resetDefaultPreset()) {\n        // \n        if (PresetManager.getActivePreset()?.id === 'default') {\n          refreshPresetUI();\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // === :/ ===\n    dialog.on('click', '#regex-rules-list .acu-rule-toggle', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const currentState = RegexTransformationManager.getAllRules().find(r => r.id === ruleId)?.enabled;\n      const newState = !currentState;\n      const rule = RegexTransformationManager.getRule(ruleId);\n\n      RegexTransformationManager.toggleRuleEnabled(ruleId, newState);\n\n      if (newState) {\n      } else {\n        toastr.info('');\n      }\n\n      refreshRegexRulesList(); // [] ,\n    });\n\n    // ===  ===\n    dialog.on('click', '#regex-rules-list .acu-rule-edit', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const rule = RegexTransformationManager.getRule(ruleId);\n      if (!rule) return;\n\n      // \n      showAddRegexRuleModal(ruleId);\n    });\n\n    // === : ===\n    dialog.on('click', '#regex-rules-list .acu-rule-delete', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const rule = RegexTransformationManager.getRule(ruleId);\n      if (!rule) return;\n\n      if (confirm(`\"${rule.name}\"`)) {\n        RegexTransformationManager.removeRule(ruleId);\n        refreshRegexRulesList(); // [] ,\n      }\n    });\n\n    // === : ===\n    dialog.find('#regex-preset-select').on('change', function () {\n      const presetId = $(this).val();\n      RegexPresetManager.setActivePreset(String(presetId));\n\n      refreshRegexRulesList(); // [] ,\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-dup').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      const name = prompt(':', `${currentPreset.name} ()`);\n      if (!name) return;\n\n      const newPreset = RegexPresetManager.createPreset(name, currentPreset.id);\n      if (newPreset) {\n        // [] \n        const $presetSelect = dialog.find('#regex-preset-select');\n        $presetSelect.append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        $presetSelect.val(newPreset.id);\n\n        refreshRegexRulesList(); // \n      } else {\n        toastr.error('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-new').on('click', function () {\n      const name = prompt(':');\n      if (!name) return;\n\n      const newPreset = RegexPresetManager.createPreset(name, null);\n      if (newPreset) {\n        RegexPresetManager.setActivePreset(newPreset.id);\n\n        // [] \n        const $presetSelect = dialog.find('#regex-preset-select');\n        $presetSelect.append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        $presetSelect.val(newPreset.id);\n\n        refreshRegexRulesList(); // \n      } else {\n        toastr.error('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-del').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      if (confirm(`\"${currentPreset.name}\"`)) {\n        const success = RegexPresetManager.deletePreset(currentPreset.id);\n        if (success) {\n          // [] \n          const $presetSelect = dialog.find('#regex-preset-select');\n          $presetSelect.find(`option[value=\"${currentPreset.id}\"]`).remove();\n\n          // \n          const defaultPresetId = RegexPresetManager.getActivePreset()?.id;\n          if (defaultPresetId) {\n            $presetSelect.val(defaultPresetId);\n          }\n\n          refreshRegexRulesList(); // \n        } else {\n          toastr.error('');\n        }\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-export').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      const json = RegexPresetManager.exportPreset(currentPreset.id);\n      if (json) {\n        const blob = new Blob([json], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `regex-preset-${currentPreset.name}-${Date.now()}.json`;\n        a.click();\n        URL.revokeObjectURL(url);\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-import').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const text = await file.text();\n          if (!text?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(text.trim());\n          } catch {\n            toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.name || '';\n          const existingPresets = RegexPresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = text.trim();\n            if (newName) {\n              parsedData.name = newName;\n              // IDID\n              parsedData.id = `regex_preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset) {\n                // \n                if (existingPresets.length > 1) {\n                  RegexPresetManager.deletePreset(existingPreset.id);\n                  dialog.find(`#regex-preset-select option[value=\"${existingPreset.id}\"]`).remove();\n                }\n              }\n            }\n\n            const preset = RegexPresetManager.importPreset(finalJson);\n            if (preset) {\n              // [] \n              const $presetSelect = dialog.find('#regex-preset-select');\n              $presetSelect.append(`<option value=\"${escapeHtml(preset.id)}\">${escapeHtml(preset.name)}</option>`);\n              $presetSelect.val(preset.id);\n\n              // [] \n              RegexPresetManager.setActivePreset(preset.id);\n              Store.set(STORAGE_KEY_REGEX_RULES, preset.rules || []);\n              RegexTransformationManager.clearCache();\n\n              refreshRegexRulesList(); // \n            } else {\n              toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-reset').on('click', function () {\n      if (!confirm('\\n\\n')) return;\n\n      // \n      const presets = RegexPresetManager.getAllPresets();\n      let defaultPreset = presets.find(p => p.id === 'regex_default');\n\n      if (defaultPreset) {\n        // \n        defaultPreset.rules = JSON.parse(JSON.stringify(BUILTIN_REGEX_RULES.map(r => ({ ...r, builtin: true }))));\n        defaultPreset.version = PRESET_FORMAT_VERSION;\n        defaultPreset.updatedAt = Date.now();\n      } else {\n        // \n        defaultPreset = {\n          id: 'regex_default',\n          name: '',\n          description: '',\n          version: PRESET_FORMAT_VERSION,\n          rules: JSON.parse(JSON.stringify(BUILTIN_REGEX_RULES.map(r => ({ ...r, builtin: true })))),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n        presets.unshift(defaultPreset);\n      }\n      RegexPresetManager._save(presets);\n\n      // \n      Store.set(STORAGE_KEY_REGEX_ACTIVE_PRESET, 'regex_default');\n\n      // \n      Store.set(\n        STORAGE_KEY_REGEX_RULES,\n        JSON.parse(JSON.stringify(BUILTIN_REGEX_RULES.map(r => ({ ...r, builtin: true })))),\n      );\n      RegexTransformationManager.clearCache();\n\n      // UI - \n      const $presetSelect = dialog.find('#regex-preset-select');\n      $presetSelect.empty();\n      RegexPresetManager.getAllPresets().forEach(p => {\n        const versionSuffix = p.id === 'regex_default' ? ` v${PRESET_FORMAT_VERSION}` : '';\n        $presetSelect.append(`<option value=\"${escapeHtml(p.id)}\">${escapeHtml(p.name)}${versionSuffix}</option>`);\n      });\n      $presetSelect.val('regex_default');\n      refreshRegexRulesList();\n\n      toastr.success(` ${BUILTIN_REGEX_RULES.length} `);\n    });\n\n    // === : ===\n    dialog.find('#btn-add-regex-rule').on('click', function () {\n      showAddRegexRuleModal();\n    });\n\n    // === : ===\n    dialog.find('#btn-import-tavern-regex').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const text = await file.text();\n          if (!text?.trim()) return;\n\n          let parsed;\n          try {\n            parsed = JSON.parse(text.trim());\n          } catch {\n            toastr.error('JSON');\n            return;\n          }\n\n          // \n          const tavernRegexList: TavernRegex[] = Array.isArray(parsed) ? parsed : [parsed];\n\n          //  scriptName  findRegex\n          if (!tavernRegexList.every(r => r.scriptName && r.findRegex)) {\n            toastr.error(' scriptName  findRegex ');\n            return;\n          }\n\n          const existingRules = RegexTransformationManager.getAllRules();\n          const existingNames = existingRules.map(r => r.name);\n\n          let importedCount = 0;\n          let skippedCount = 0;\n\n          // \n          const processNext = (index: number): void => {\n            if (index >= tavernRegexList.length) {\n              // \n              refreshRegexRulesList();\n              if (skippedCount > 0) {\n                toastr.info(`: ${importedCount} , ${skippedCount} `);\n              } else if (importedCount > 0) {\n                toastr.success(` ${importedCount} `);\n              }\n              return;\n            }\n\n            const tavernRegex = tavernRegexList[index];\n            const convertedRule = convertTavernRegexToRule(tavernRegex);\n            const hasConflict = existingNames.includes(convertedRule.name);\n\n            if (hasConflict) {\n              // \n              showPresetConflictDialog({\n                presetName: convertedRule.name,\n                presetType: '',\n                existingNames,\n                onOverwrite: () => {\n                  // \n                  const oldRule = RegexTransformationManager.getAllRules().find(r => r.name === convertedRule.name);\n                  if (oldRule) RegexTransformationManager.removeRule(oldRule.id);\n                  RegexTransformationManager.addCustomRule(convertedRule);\n                  existingNames.push(convertedRule.name);\n                  importedCount++;\n                  processNext(index + 1);\n                },\n                onRename: newName => {\n                  convertedRule.name = newName;\n                  convertedRule.id = `tavern_import_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n                  RegexTransformationManager.addCustomRule(convertedRule);\n                  existingNames.push(newName);\n                  importedCount++;\n                  processNext(index + 1);\n                },\n                onCancel: () => {\n                  skippedCount++;\n                  processNext(index + 1);\n                },\n              });\n            } else {\n              // \n              RegexTransformationManager.addCustomRule(convertedRule);\n              existingNames.push(convertedRule.name);\n              importedCount++;\n              processNext(index + 1);\n            }\n          };\n\n          // \n          processNext(0);\n        } catch (err) {\n          toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // === : ===\n    dialog.find('#btn-add-validation-rule').on('click', function () {\n      showAddValidationRuleModal(dialog);\n    });\n\n    // === Debug ===\n    dialog.find('#btn-open-debug-console').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showDebugConsoleModal();\n    });\n\n    // ===  ===\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n      renderInterface();\n    };\n    dialog.on('click', '#dlg-close-x, .acu-settings-header .acu-close-btn', closeDialog);\n\n    // \n    dialog.on('click', '#acu-help-btn', function (e) {\n      e.stopPropagation();\n      window.open('https://jerryzmtz.github.io/DiceSystemManual//', '_blank');\n    });\n\n    // \n    dialog.on('click', '#acu-manual-update-btn', function (e) {\n      e.stopPropagation();\n      showManualUpdateDialog();\n    });\n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n  };\n\n  // [] \n  let renderInterfaceTimer = null;\n  let renderInterfacePending = false;\n\n  const renderInterface = () => {\n    // \n    if (isSettingsOpen) {\n      if (!renderInterfacePending) {\n        console.info('[DICE]');\n        renderInterfacePending = true;\n      }\n      return;\n    }\n\n    // [] \n    saveCurrentTabState();\n\n    // \n    if (renderInterfaceTimer) {\n      clearTimeout(renderInterfaceTimer);\n    }\n\n    // 50ms\n    renderInterfaceTimer = setTimeout(() => {\n      renderInterfaceTimer = null;\n      renderInterfacePending = false;\n      _renderInterfaceImpl();\n    }, 50);\n  };\n\n  // \n  const _renderInterfaceImpl = () => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n\n    // [] Observer  ()\n    if (!observer && $('#chat').length) {\n      const $chat = $('#chat');\n      let mutationLock = false;\n      const handleMutation = () => {\n        if (mutationLock) return;\n        mutationLock = true;\n        requestAnimationFrame(() => {\n          const config = getConfig();\n          if (config.positionMode === 'embedded') {\n            mutationLock = false;\n            return;\n          }\n          const children = $chat.children();\n          const lastChild = children.last()[0];\n          const wrapper = $('.acu-wrapper')[0];\n          if (wrapper && lastChild && lastChild !== wrapper) {\n            if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n              $chat.append(wrapper);\n            }\n          }\n\n          // [] \n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            // 1\n            const children = $chat.children();\n            const lastChild = children.last();\n            if (lastChild.hasClass('mes') || lastChild.hasClass('message-body')) {\n              lastChild.addClass('acu-dice-result-revealing');\n            }\n\n            // 2RAF\n            requestAnimationFrame(() => {\n              hideDiceResultsInUserMessages();\n\n              // 3\n              requestAnimationFrame(() => {\n                lastChild.removeClass('acu-dice-result-revealing').addClass('acu-dice-result-revealed');\n                // \n                setTimeout(() => {\n                  lastChild.removeClass('acu-dice-result-revealed');\n                }, 200);\n              });\n            });\n          }\n\n          mutationLock = false;\n        });\n      };\n      observer = new MutationObserver(handleMutation);\n      observer.observe($chat[0], { childList: true });\n    }\n    let rawData;\n    let isDataFromDatabase = false; // \n    if (hasUnsavedChanges && cachedRawData) {\n      rawData = cachedRawData;\n    } else {\n      rawData = getTableData();\n      isDataFromDatabase = true; // \n\n      // [] auto\n      // \n      // \n      if (rawData && !isAutoTransforming && isDataFromDatabase) {\n        try {\n          const enabledRules = RegexTransformationManager.getEnabledRules();\n\n          if (enabledRules.length > 0) {\n            console.info(`[DICE] ${enabledRules.length} ...`);\n\n            isAutoTransforming = true; // \n            const transformResult = RegexTransformationEngine.applyToTable(rawData, enabledRules);\n            if (transformResult.totalApplied > 0) {\n              console.info(`[DICE] ${transformResult.totalApplied} `);\n\n              // \n              //  saveDataOnly \n              // saveDataOnly  UpdateController.handleUpdate() isAutoTransforming \n              // \n              saveDataOnly(rawData, transformResult.modifiedSheetKeys).catch(err => {\n                console.warn('[DICE]:', err);\n              });\n            }\n            if (transformResult.errors.length > 0) {\n              console.warn(`[DICE] ${transformResult.errors.length} :`, transformResult.errors);\n            } else if (transformResult.totalApplied === 0) {\n              console.info('[DICE]');\n            }\n            isAutoTransforming = false; // \n          } else {\n            isAutoTransforming = false; // \n          }\n        } catch (transformError) {\n          isAutoTransforming = false; // \n          const errorMsg = transformError instanceof Error ? transformError.message : String(transformError);\n          console.error('[DICE]:', transformError);\n        }\n      }\n\n      if (rawData) {\n        cachedRawData =\n          typeof structuredClone === 'function' ? structuredClone(rawData) : JSON.parse(JSON.stringify(rawData));\n\n        const existingSnapshot = loadSnapshot();\n        const currentCtx = getCurrentContextFingerprint();\n\n        // \n        const hasValidSnapshotData =\n          existingSnapshot && Object.keys(existingSnapshot).some(k => k.startsWith('sheet_'));\n\n        if (!existingSnapshot || !hasValidSnapshotData) {\n          // 1    \n          saveSnapshot({ ...cachedRawData, _contextId: currentCtx });\n        } else if (!existingSnapshot._contextId) {\n          // 2 ID \n          saveSnapshot({ ...existingSnapshot, _contextId: currentCtx });\n        } else if (existingSnapshot._contextId !== currentCtx) {\n          // 3  \n          cachedRawData._contextId = currentCtx;\n          saveSnapshot(cachedRawData);\n        }\n        // 4  \n      }\n    }\n\n    const $searchInput = $('.acu-search-input');\n    if ($('.acu-wrapper').length && $searchInput.is(':focus')) {\n      if (rawData) {\n        if (!isSaving) currentDiffMap = generateDiffMap(rawData);\n        const tables = processJsonData(rawData);\n        const activeTab = getActiveTabState();\n        const currentTabName = activeTab && tables[activeTab] ? activeTab : null;\n\n        if (currentTabName && tables[currentTabName]) {\n          const newHtml = renderTableContent(tables[currentTabName], currentTabName);\n          const $virtualDom = $('<div>').html(newHtml);\n          $('.acu-card-grid').replaceWith($virtualDom.find('.acu-card-grid'));\n          $('.acu-panel-title').html($virtualDom.find('.acu-panel-title').html());\n          // [] \n          bindEvents(tables);\n          bindOptionEvents(); // <--- \n          return;\n        }\n      }\n    }\n\n    let lastScrollX = 0;\n    let lastScrollY = 0;\n\n    const $oldContent = $('.acu-panel-content');\n    if ($oldContent.length) {\n      lastScrollX = $oldContent.scrollLeft();\n      lastScrollY = $oldContent.scrollTop();\n    }\n\n    $('.acu-wrapper').remove();\n    const tables = processJsonData(rawData || {});\n\n    if (isSaving) {\n      currentDiffMap = new Set();\n    } else {\n      currentDiffMap = generateDiffMap(rawData);\n    }\n\n    const savedOrder = getSavedTableOrder();\n    let orderedNames = Object.keys(tables);\n    if (savedOrder)\n      orderedNames = savedOrder.filter(n => tables[n]).concat(orderedNames.filter(n => !savedOrder.includes(n)));\n\n    const hiddenList = getHiddenTables();\n    orderedNames = orderedNames.filter(n => !hiddenList.includes(n));\n\n    const activeTab = getActiveTabState();\n    let currentTabName = activeTab && tables[activeTab] && !hiddenList.includes(activeTab) ? activeTab : null;\n\n    const config = getConfig();\n    const isCollapsed = getCollapsedState();\n\n    const layoutClass = config.layout === 'vertical' ? 'acu-layout-vertical' : '';\n    // []  (/)\n    const positionClass = `acu-mode-${config.positionMode || 'fixed'}`;\n\n    // []  () \n    let finalGridCols = config.gridColumns;\n    if (finalGridCols === 'auto') {\n      const n = orderedNames.length;\n\n      if (n <= 4) {\n        finalGridCols = n < 2 ? 2 : n;\n      } else {\n        const empty3 = Math.ceil(n / 3) * 3 - n;\n        const empty4 = Math.ceil(n / 4) * 4 - n;\n        finalGridCols = empty4 <= empty3 ? 4 : 3;\n      }\n    }\n\n    // --- []  +  ---\n    let optionHtml = '';\n    let currentOptionHash = null; // \n\n    if (config.showOptionPanel !== false) {\n      const optionTables = [];\n      Object.keys(tables).forEach(k => {\n        if (k.includes('')) optionTables.push(tables[k]);\n      });\n\n      // []  - \n      if (optionTables.length > 0) {\n        const isOptionsCollapsed = getOptionsCollapsedState();\n        const collapseIcon = isOptionsCollapsed ? 'fa-chevron-right' : 'fa-chevron-down';\n        const collapseText = isOptionsCollapsed ? '' : '';\n        const collapsedClass = isOptionsCollapsed ? 'collapsed' : '';\n\n        let optionCount = 0;\n        let hasBtns = false;\n        // []\n        let optionValues = []; // \n\n        // \n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  optionCount++;\n                }\n              });\n            });\n          }\n        });\n\n        // \n        let buttonsHtml = `\n                    <div class=\"acu-opt-header\" data-action=\"toggle-options\">\n                        <span>\n                            <i class=\"fa-solid ${collapseIcon}\" style=\"margin-right:6px;font-size:10px;\"></i>\n                             (${optionCount})\n                        </span>\n                    </div>`;\n\n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  const cellStr = String(cell).trim();\n                  buttonsHtml += `<button class=\"acu-opt-btn\" data-val=\"${encodeURIComponent(cellStr)}\">${escapeHtml(cellStr)}</button>`;\n                  optionValues.push(cellStr);\n                  hasBtns = true;\n                }\n              });\n            });\n          }\n        });\n\n        if (hasBtns) {\n          optionHtml = `<div class=\"acu-option-panel acu-theme-${config.theme} ${collapsedClass}\">${buttonsHtml}</div>`;\n          //  ()\n          // [] \n          currentOptionHash =\n            optionValues.join('|||') +\n            (isOptionsCollapsed ? '_collapsed' : '_expanded') +\n            `_theme_${config.theme}` +\n            `_optSize_${config.optionFontSize || 12}`;\n        }\n      }\n    }\n\n    // [] \n    const optionChanged = currentOptionHash !== lastOptionHash;\n    // [] \n    //  optionPanelVisible  false \n    if (currentOptionHash !== null) {\n      optionPanelVisible = true;\n    }\n    lastOptionHash = currentOptionHash; // \n\n    // []  wrapper \n    let html = `<div class=\"acu-wrapper ${positionClass} acu-theme-${config.theme} ${layoutClass}\" style=\"--acu-card-width:${config.cardWidth}px; --acu-font-size:${config.fontSize}px; --acu-opt-font-size:${config.optionFontSize || 12}px; --acu-grid-cols:${finalGridCols}\">`;\n\n    // []  DOM  column-reverse\n    // []  optionPanelVisible \n    if (config.positionMode === 'embedded' && optionHtml && optionPanelVisible) {\n      html += optionHtml;\n    }\n\n    if (isCollapsed) {\n      const colStyleClass = `acu-col-${config.collapseStyle || 'bar'}`;\n      const alignClass = `acu-align-${config.collapseAlign || 'right'}`;\n\n      html += `\n                <div class=\"acu-expand-trigger ${colStyleClass} ${alignClass}\" id=\"acu-btn-expand\">\n                    <i class=\"fa-solid fa-table\"></i> <span> (${Object.keys(tables).length})</span>\n                </div>\n            `;\n    } else {\n      // [] \n      const savedHeight = currentTabName ? getTableHeights()[currentTabName] : null;\n      // [] \n      const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n      const isChangesPanelActive = Store.get('acu_changes_panel_active', false);\n      const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n      const mvuSavedHeight = isMvuActive ? getTableHeights()[MvuModule.MODULE_ID] : null;\n      const finalSavedHeight = mvuSavedHeight || savedHeight;\n      const shouldShowPanel = isDashboardActive || isChangesPanelActive || isMvuActive || currentTabName;\n\n      html += `\n                <div class=\"acu-data-display ${shouldShowPanel ? 'visible' : ''} ${finalSavedHeight ? 'acu-manual-mode' : ''}\" id=\"acu-data-area\" style=\"${finalSavedHeight ? 'height:' + finalSavedHeight + 'px;' : ''}\">\n                    ${\n                      isChangesPanelActive\n                        ? renderChangesPanel(rawData)\n                        : isDashboardActive\n                          ? renderDashboard(tables)\n                          : isMvuActive\n                            ? '<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>'\n                            : currentTabName\n                              ? renderTableContent(tables[currentTabName], currentTabName)\n                              : ''\n                    }\n                </div>\n                `;\n\n      // [] \n      // PC(>768px) CSS display:flex !important grid \n      const gridFixStyle = `grid-template-columns: repeat(${finalGridCols}, 1fr);`;\n\n      html += `\n                <div class=\"acu-nav-container ${config.actionsPosition === 'top' ? 'acu-pos-top' : ''}\" id=\"acu-nav-bar\" style=\"${gridFixStyle}\">\n                    <div class=\"acu-order-controls\" id=\"acu-order-hint\"><i class=\"fa-solid fa-arrows-alt\"></i> </div>\n            `;\n\n      // ===  +  ===\n      const isChangesActive = Store.get('acu_changes_panel_active', false);\n      const isFavoritesActive = Store.get('acu_favorites_panel_active', false);\n      const isSimpleModeNav = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n      let changesCount = 0;\n      let validationErrorCount = 0;\n      if (rawData) {\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          for (const sheetId in rawData) {\n            if (!sheetId.startsWith('sheet_')) continue;\n            const newSheet = rawData[sheetId];\n            const oldSheet = snapshot[sheetId];\n            if (!newSheet?.content) continue;\n            const newRows = newSheet.content.slice(1);\n            const oldRows = oldSheet?.content?.slice(1) || [];\n\n            // [] detectChanges\n            const oldRowsByTitle = new Map<string, Array<{ index: number; row: (typeof oldRows)[0] }>>();\n            oldRows.forEach((row, rIdx) => {\n              const title = String(row[1] ?? '').trim();\n              if (!oldRowsByTitle.has(title)) {\n                oldRowsByTitle.set(title, []);\n              }\n              oldRowsByTitle.get(title)!.push({ index: rIdx, row });\n            });\n\n            newRows.forEach((row, rowIdx) => {\n              const title = String(row[1] ?? '').trim();\n              let oldRow: (typeof oldRows)[0] | undefined;\n\n              if (title && oldRowsByTitle.has(title)) {\n                const queue = oldRowsByTitle.get(title)!;\n                if (queue.length > 0) {\n                  const matched = queue.shift()!;\n                  oldRow = matched.row;\n                }\n              } else if (!title) {\n                oldRow = oldRows[rowIdx];\n              }\n\n              if (!oldRow) {\n                changesCount++; // \n              } else {\n                // \n                let hasChange = false;\n                row.forEach((cell, colIdx) => {\n                  if (colIdx === 0) return;\n                  if (String(cell ?? '') !== String(oldRow![colIdx] ?? '')) hasChange = true;\n                });\n                if (hasChange) changesCount++;\n              }\n            });\n\n            // \n            const newTitleCounts = new Map<string, number>();\n            const oldTitleCounts = new Map<string, number>();\n            newRows.forEach(row => {\n              const title = String(row[1] ?? '').trim();\n              if (title) newTitleCounts.set(title, (newTitleCounts.get(title) || 0) + 1);\n            });\n            oldRows.forEach(row => {\n              const title = String(row[1] ?? '').trim();\n              if (title) oldTitleCounts.set(title, (oldTitleCounts.get(title) || 0) + 1);\n            });\n            oldTitleCounts.forEach((oldCount, title) => {\n              const newCount = newTitleCounts.get(title) || 0;\n              if (oldCount > newCount) changesCount += oldCount - newCount;\n            });\n            // \n            const emptyOldCount = oldRows.filter(r => !String(r[1] ?? '').trim()).length;\n            const emptyNewCount = newRows.filter(r => !String(r[1] ?? '').trim()).length;\n            if (emptyOldCount > emptyNewCount) changesCount += emptyOldCount - emptyNewCount;\n          }\n          for (const sheetId in snapshot) {\n            if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n          }\n        }\n        // \n        validationErrorCount = ValidationEngine.getErrorCount(rawData);\n      }\n      // \n      const isValidationMode = isSimpleModeNav;\n      const displayCount = isValidationMode ? validationErrorCount : changesCount;\n      // \n      const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n      // ===  ===\n      const navHiddenList = getHiddenTables();\n      const navSavedOrder = getSavedTableOrder() || [];\n\n      //  + \n      const SPECIAL_NAV_ITEMS = [\n        { key: '__dice__', icon: 'fa-dice-d20', label: '', id: 'acu-btn-dice-nav', extraClass: 'acu-dice-nav-btn' },\n        {\n          key: '__changes__',\n          icon: 'fa-code-compare',\n          label: `${displayCount > 0 ? '(' + displayCount + ')' : ''}`,\n          id: 'acu-btn-changes',\n          extraClass: `acu-changes-btn${showWarningIcon ? ' has-validation-errors' : ''}`,\n          isActive: isChangesActive,\n          warningIcon: showWarningIcon,\n        },\n        {\n          key: '__mvu__',\n          icon: 'fa-code-branch',\n          label: '',\n          id: 'acu-btn-mvu',\n          extraClass: 'acu-mvu-btn',\n          isActive: getActiveTabState() === MvuModule.MODULE_ID,\n        },\n        {\n          key: '__favorites__',\n          icon: 'fa-star',\n          label: '',\n          id: 'acu-btn-favorites',\n          extraClass: 'acu-favorites-btn',\n          isActive: isFavoritesActive,\n        },\n      ];\n\n      // \n      let allNavItems = [];\n\n      // \n      SPECIAL_NAV_ITEMS.forEach(item => {\n        // \n        if (navHiddenList.includes(item.key)) return;\n\n        // MVU\n        if (item.key === '__mvu__') {\n          allNavItems.push({ ...item, isSpecial: true });\n          return;\n        }\n\n        // checkAvailable\n        if (item.checkAvailable && !item.checkAvailable()) return;\n        allNavItems.push({ ...item, isSpecial: true });\n      });\n\n      // \n      orderedNames.forEach(name => {\n        allNavItems.push({\n          key: name,\n          icon: getIconForTableName(name),\n          label: name,\n          isSpecial: false,\n          isActive: !isDashboardActive && !isChangesActive && currentTabName === name,\n        });\n      });\n\n      // \n      if (navSavedOrder.length > 0) {\n        const orderMap = new Map(navSavedOrder.map((k, i) => [k, i]));\n        allNavItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      // [] /\n      // order  1  Grid \n      html += `<button class=\"acu-nav-btn acu-dashboard-btn ${isDashboardActive ? 'active' : ''}\" id=\"acu-btn-dashboard\" style=\"order: 1;\">\n                <i class=\"fa-solid fa-chart-line\"></i><span></span>\n            </button>`;\n\n      // order  2 \n      allNavItems.forEach((item, idx) => {\n        const activeClass = item.isActive ? 'active' : '';\n        const extraClass = item.extraClass || '';\n        const orderVal = idx + 2; //  2  1\n\n        if (item.isSpecial) {\n          // \n          const warningIconHtml = item.warningIcon\n            ? '<i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>'\n            : '';\n          html += `<button class=\"acu-nav-btn ${extraClass} ${activeClass}\" id=\"${item.id}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>${warningIconHtml}\n                    </button>`;\n        } else {\n          // \n          html += `<button class=\"acu-nav-btn ${activeClass}\" data-table=\"${escapeHtml(item.key)}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>\n                    </button>`;\n        }\n      });\n\n      // order \n      html += `<div class=\"acu-actions-group\" id=\"acu-active-actions\" style=\"order: 9999;\">`;\n      ACTION_BUTTONS.forEach(btn => {\n        html += `<button class=\"acu-action-btn\" id=\"${btn.id}\" title=\"${btn.title}\"><i class=\"fa-solid ${btn.icon}\"></i></button>`;\n      });\n      html += `</div>`;\n\n      html += `</div>`; //  acu-nav-container\n    }\n\n    html += `</div>`; //  acu-wrapper\n\n    const $existing = $('.acu-wrapper');\n    if ($existing.length) {\n      $existing.replaceWith(html);\n    } else {\n      insertHtmlToPage(html);\n    }\n\n    // --- []  ---\n    if (config.positionMode !== 'embedded' && optionHtml && optionPanelVisible) {\n      if (optionChanged) {\n        //  AI \n        injectIndependentOptions(optionHtml);\n      } else {\n        // \n        const $existing = $('.acu-embedded-options-container');\n        if ($existing.length === 0) {\n          // \n          injectIndependentOptions(optionHtml);\n        } else {\n          // []  AI \n          const $lastAiMes = $('#chat .mes')\n            .filter(function () {\n              const $this = $(this);\n              if ($this.attr('is_user') === 'true' || $this.attr('is_system') === 'true' || $this.hasClass('sys_mes'))\n                return false;\n              if ($this.find('.name_text').text().trim() === 'System' || $this.attr('data-is-system') === 'true')\n                return false;\n              if ($this.find('.mes_text').length === 0) return false;\n              if ($this.css('display') === 'none') return false;\n              return true;\n            })\n            .last();\n\n          const isOnLatestMessage =\n            $lastAiMes.length > 0 && $lastAiMes.find('.acu-embedded-options-container').length > 0;\n\n          if (!isOnLatestMessage) {\n            // \n            injectIndependentOptions(optionHtml);\n          } else {\n            // [] fadeOut\n            const containerVisible = $existing.is(':visible');\n            const containerDisplay = $existing.css('display');\n            const containerHtmlLength = $existing.html()?.length || 0;\n            if (!containerVisible || containerDisplay === 'none' || containerHtmlLength === 0) {\n              injectIndependentOptions(optionHtml);\n            }\n          }\n        }\n      }\n    } else if (config.positionMode !== 'embedded') {\n      // \n      $('.acu-embedded-options-container').remove();\n    } else {\n      // [] \n      $('.acu-embedded-options-container').remove();\n    }\n\n    bindEvents(tables);\n    bindOptionEvents();\n    updateSaveButtonState();\n    // [] \n    if (Store.get('acu_changes_panel_active', false)) {\n      bindChangesEvents();\n    }\n    // [] \n    if (canWriteMvuPanel()) {\n      const $panel = $('#acu-data-area');\n      if ($panel.length) {\n        // \n        // \n        // \n        $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n        MvuModule.bindEvents($panel);\n\n        // \n        MvuModule.getDataWithRetry(5, 800)\n          .then(mvuData => {\n            // \n            if (mvuData && canWriteMvuPanel()) {\n              $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n              MvuModule.bindEvents($panel);\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error getting data:', err);\n            if (canWriteMvuPanel()) {\n              // \n              $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n              MvuModule.bindEvents($panel);\n            }\n          });\n      }\n    }\n\n    setTimeout(() => {\n      const $newContent = $('.acu-panel-content');\n      const activeTab = getActiveTabState();\n      const savedState = tableScrollStates[activeTab];\n\n      if ($newContent.length) {\n        // 1. \n        //  savedState () lastScrollY ()\n        if (savedState) {\n          $newContent.scrollTop(savedState.top);\n          $newContent.scrollLeft(savedState.left);\n        } else {\n          if (lastScrollY > 0) $newContent.scrollTop(lastScrollY);\n          if (lastScrollX > 0) $newContent.scrollLeft(lastScrollX);\n        }\n\n        // 2.  ()\n        if (savedState && savedState.inner) {\n          Object.keys(savedState.inner).forEach(key => {\n            const scrollTop = savedState.inner[key];\n            // \n            const $targetTitle = $newContent.find(`.acu-editable-title[data-row=\"${key}\"]`);\n            if ($targetTitle.length) {\n              const $card = $targetTitle.closest('.acu-data-card');\n              //  ( overflow on card)\n              $card.scrollTop(scrollTop);\n              //  body  ( overflow on body)\n              $card.find('.acu-card-body').scrollTop(scrollTop);\n            }\n          });\n        }\n      }\n    }, 0);\n\n    console.info('[DICE]');\n  };\n\n  // [] \n  const injectIndependentOptions = htmlContent => {\n    const { $ } = getCore();\n    $('.acu-embedded-options-container').remove();\n\n    //  AI \n    const getTargetContainer = () => {\n      const $allMes = $('#chat .mes');\n      const $aiMes = $allMes.filter(function () {\n        const $this = $(this);\n        if ($this.attr('is_user') === 'true' || $this.attr('is_system') === 'true' || $this.hasClass('sys_mes'))\n          return false;\n        //  data-is-system \n        if ($this.find('.name_text').text().trim() === 'System' || $this.attr('data-is-system') === 'true')\n          return false;\n        // [] \n        if ($this.find('.mes_text').length === 0) return false;\n        if ($this.css('display') === 'none') return false;\n        return true;\n      });\n      if ($aiMes.length === 0) return null;\n\n      const $targetMes = $aiMes.last();\n      const $targetText = $targetMes.find('.mes_text');\n      const $targetBlock = $targetMes.find('.mes_block');\n      if ($targetText.length) return $targetText;\n      if ($targetBlock.length) return $targetBlock;\n      return $targetMes;\n    };\n\n    const $target = getTargetContainer();\n    if ($target && $target.length) {\n      const optConfig = getConfig();\n      const $container = $(\n        `<div class=\"acu-embedded-options-container acu-theme-${optConfig.theme}\" style=\"--acu-opt-font-size:${optConfig.optionFontSize || 12}px;\"></div>`,\n      );\n      $container.html(htmlContent);\n      // []  mes_text \n      //  SillyTavern  mes_text \n      $target.after($container);\n    }\n  };\n\n  // []  ( + )\n  const bindOptionEvents = () => {\n    const { $ } = getCore();\n    //  Body \n    $('body')\n      .off('click.acu_opt')\n      .on('click.acu_opt', '.acu-opt-btn', async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const config = getConfig();\n        const val = decodeURIComponent($(this).data('val'));\n\n        // 1:  -> \n        if (!config.clickOptionToAutoSend) {\n          smartInsertToTextarea(val, 'action');\n          $('#send_textarea').focus();\n          return;\n        }\n\n        // 2: \n        // A: TavernHelper ( refresh: 'affected' )\n        if (window.TavernHelper) {\n          try {\n            // 1.  createChatMessages \n            if (window.TavernHelper.createChatMessages) {\n              await window.TavernHelper.createChatMessages(\n                [\n                  {\n                    role: 'user',\n                    message: val,\n                  },\n                ],\n                {\n                  //  TavernHelper \n                  refresh: 'affected',\n                },\n              );\n\n              // 2. \n              if (window.TavernHelper.triggerSlash) {\n                await window.TavernHelper.triggerSlash('/trigger');\n              }\n              return;\n            }\n          } catch (err) {\n            console.warn('[DICE]ACU TavernHelper ', err);\n          }\n        }\n\n        // B: SillyTavern  (Slash Command)\n        const ST = window.SillyTavern || window.parent?.SillyTavern;\n        if (ST && ST.executeSlashCommandsWithOptions) {\n          try {\n            //  raw=true  ( slash_command.txt)\n            const safeVal = val.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n            const cmd = `/send raw=true \"${safeVal}\"`;\n\n            const sendResult = await ST.executeSlashCommandsWithOptions(cmd);\n\n            if (!sendResult.isError && !sendResult.isAborted) {\n              await ST.executeSlashCommandsWithOptions('/trigger');\n              return;\n            }\n            console.warn('[DICE]ACU ST send :', sendResult);\n          } catch (err) {\n            console.warn('[DICE]ACU ST', err);\n          }\n        }\n\n        // C:  +  ()\n        const ta = $('#send_textarea');\n        if (ta.length) {\n          ta.val(val);\n          ta.trigger('input').trigger('change');\n          //  React \n          await new Promise(r => setTimeout(r, 50));\n          const sendBtn = $('#send_but').filter(':visible');\n          if (sendBtn.length) {\n            sendBtn[0].click();\n          } else {\n            // \n            const enterEvent = $.Event('keydown', { keyCode: 13, which: 13, bubbles: true });\n            ta.trigger(enterEvent);\n          }\n        }\n      });\n  };\n\n  const insertHtmlToPage = html => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // ---  ---\n\n    // 1.  (Embedded) v19 \n    if (config.positionMode === 'embedded') {\n      $('.acu-wrapper').remove(); // \n\n      const getTargetContainer = () => {\n        const $allMes = $('#chat .mes');\n        const $aiMes = $allMes.filter(function () {\n          const $this = $(this);\n          if ($this.attr('is_user') === 'true') return false;\n          if ($this.attr('is_system') === 'true') return false;\n          if ($this.hasClass('sys_mes')) return false;\n          const name = $this.find('.name_text').text().trim();\n          if (name === 'System') return false;\n          if ($this.css('display') === 'none') return false;\n          const $textDiv = $this.find('.mes_text');\n          if ($textDiv.length === 0) return false;\n          const textContent = $textDiv.text().trim();\n          const hasImage = $textDiv.find('img').length > 0;\n          if (textContent.length === 0 && !hasImage) return false;\n          return true;\n        });\n        //  AI  chat\n        if ($aiMes.length === 0) return $('#chat');\n\n        // \n\n        let targetIndex = $aiMes.length - 1;\n        const $targetMes = $aiMes.eq(targetIndex);\n        const $targetBlock = $targetMes.find('.mes_block');\n        return $targetBlock.length ? $targetBlock : $targetMes;\n      };\n\n      const $target = getTargetContainer();\n      if ($target.length) {\n        if ($target.hasClass('mes_block') || $target.hasClass('mes')) {\n          if ($target.find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          } else {\n            $target.find('.acu-wrapper').replaceWith(html);\n          }\n        } else {\n          // Fallback\n          if ($('#chat').find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          }\n        }\n      } else {\n        $('body').append(html);\n      }\n      return;\n    }\n\n    // 2.  (Fixed) B \n    // \n    const $chat = $('#chat');\n    const $oldWrapper = $('.acu-wrapper');\n\n    if ($oldWrapper.length) {\n      $oldWrapper.replaceWith(html);\n    } else {\n      if ($chat.length) {\n        $chat.append(html);\n      } else {\n        $('body').append(html);\n      }\n    }\n  };\n  // [] \n  const renderChangesPanel = rawData => {\n    const snapshot = loadSnapshot();\n    const config = getConfig();\n\n    // \n    const validationErrors = rawData ? ValidationEngine.validateAllData(rawData) : [];\n\n    if (!snapshot || !rawData) {\n      // \n      if (validationErrors.length === 0) {\n        return `\n                <div class=\"acu-panel-header\">\n                    <div class=\"acu-panel-title\">\n                        <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-compare\"></i> <span class=\"acu-title-text\"></span></div>\n                        <div class=\"acu-title-sub\"></div>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-panel-content\" style=\"display:flex;align-items:center;justify-content:center;\">\n                    <div class=\"acu-empty-hint\"></div>\n                </div>`;\n      }\n    }\n\n    // \n    const changes = [];\n\n    for (const sheetId in rawData) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      const newSheet = rawData[sheetId];\n      const oldSheet = snapshot[sheetId];\n      if (!newSheet?.name || !newSheet?.content) continue;\n\n      const tableName = newSheet.name;\n      const headers = newSheet.content[0] || [];\n      const newRows = newSheet.content.slice(1);\n      const oldRows = oldSheet?.content?.slice(1) || [];\n\n      // [] \n      // \n      const oldRowsByTitle = new Map<string, Array<{ index: number; row: (typeof oldRows)[0] }>>();\n      oldRows.forEach((row, rIdx) => {\n        const title = String(row[1] ?? '').trim();\n        if (!oldRowsByTitle.has(title)) {\n          oldRowsByTitle.set(title, []);\n        }\n        oldRowsByTitle.get(title)!.push({ index: rIdx, row });\n      });\n\n      newRows.forEach((row, rowIdx) => {\n        const title = String(row[1] ?? '').trim();\n\n        // \n        let oldRow: (typeof oldRows)[0] | undefined;\n        let oldRowIndex: number | undefined;\n\n        if (title && oldRowsByTitle.has(title)) {\n          const queue = oldRowsByTitle.get(title)!;\n          if (queue.length > 0) {\n            const matched = queue.shift()!; // \n            oldRow = matched.row;\n            oldRowIndex = matched.index;\n          }\n        } else if (!title) {\n          // \n          oldRow = oldRows[rowIdx];\n          oldRowIndex = rowIdx;\n        }\n\n        if (!oldRow) {\n          // \n          changes.push({\n            type: 'row_added',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: rowIdx,\n            headers,\n            row,\n            title: row[1] || ` ${rowIdx + 1}`,\n          });\n        } else {\n          // \n          const rowChanges: Array<{\n            colIndex: number;\n            header: string;\n            oldValue: string;\n            newValue: string;\n          }> = [];\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return; // \n            const oldVal = String(oldRow![colIdx] ?? '');\n            const newVal = String(cell ?? '');\n            if (oldVal !== newVal) {\n              rowChanges.push({\n                colIndex: colIdx,\n                header: headers[colIdx] || `${colIdx}`,\n                oldValue: oldVal,\n                newValue: newVal,\n              });\n            }\n          });\n\n          if (rowChanges.length === 1) {\n            // \n            const c = rowChanges[0];\n            changes.push({\n              type: 'cell_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              colIndex: c.colIndex,\n              header: c.header,\n              oldValue: c.oldValue,\n              newValue: c.newValue,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          } else if (rowChanges.length > 1) {\n            // \n            changes.push({\n              type: 'row_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              headers,\n              row,\n              oldRow,\n              changedFields: rowChanges,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          }\n        }\n      });\n\n      // [] \n      // \n      const newTitleCounts = new Map();\n      newRows.forEach((row, rIdx) => {\n        const title = String(row[1] ?? '').trim();\n        if (title) {\n          newTitleCounts.set(title, (newTitleCounts.get(title) || 0) + 1);\n        }\n      });\n\n      // \n      const oldTitleCounts = new Map();\n      oldRows.forEach((row, rIdx) => {\n        const title = String(row[1] ?? '').trim();\n        if (title) {\n          oldTitleCounts.set(title, (oldTitleCounts.get(title) || 0) + 1);\n        }\n      });\n\n      // \n      const processedTitles = new Set();\n      oldRows.forEach((oldRow, rIdx) => {\n        const title = String(oldRow[1] ?? '').trim();\n\n        if (!title) {\n          // \n          if (rIdx >= newRows.length) {\n            changes.push({\n              type: 'row_deleted',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rIdx,\n              headers,\n              row: oldRow,\n              title: ` ${rIdx + 1}`,\n            });\n          }\n        } else if (!processedTitles.has(title)) {\n          processedTitles.add(title);\n          const oldCount = oldTitleCounts.get(title) || 0;\n          const newCount = newTitleCounts.get(title) || 0;\n          const deletedCount = oldCount - newCount;\n\n          if (deletedCount > 0) {\n            // deletedCount\n            const matchingOldRows = oldRows\n              .map((r, i) => ({ row: r, index: i }))\n              .filter(item => String(item.row[1] ?? '').trim() === title);\n\n            const deletedRows = matchingOldRows.slice(-deletedCount);\n            deletedRows.forEach(item => {\n              changes.push({\n                type: 'row_deleted',\n                tableName,\n                tableKey: sheetId,\n                rowIndex: item.index,\n                headers,\n                row: item.row,\n                title: title,\n              });\n            });\n          }\n        }\n      });\n    }\n\n    // \n    for (const sheetId in snapshot) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      if (!rawData[sheetId]) {\n        const oldSheet = snapshot[sheetId];\n        changes.push({\n          type: 'table_deleted',\n          tableName: oldSheet?.name || sheetId,\n          tableKey: sheetId,\n        });\n      }\n    }\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n\n    // \n    const panelTitle = isValidationMode ? '' : '';\n    const panelIcon = isValidationMode ? 'fa-shield-halved' : 'fa-code-compare';\n    const toggleTitle = isValidationMode ? '' : '';\n\n    //  HTML\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n                    <div class=\"acu-title-main\"><i class=\"fa-solid ${panelIcon}\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                </div>\n                <div class=\"acu-header-actions\">\n                    ${!isValidationMode ? '<button class=\"acu-changes-batch-btn acu-batch-accept\" title=\"\"><i class=\"fa-solid fa-check-double\"></i></button>' : ''}\n                    <button class=\"acu-changes-batch-btn acu-batch-reject\" title=\"${isValidationMode ? '' : ''}\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                    <button class=\"acu-changes-batch-btn acu-simple-mode-toggle ${isValidationMode ? 'active' : ''}\" title=\"${toggleTitle}\">\n                        <i class=\"fa-solid ${isValidationMode ? 'fa-filter-circle-xmark' : 'fa-filter'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                    </div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>`;\n\n    html += `<div class=\"acu-panel-content acu-changes-content ${config.layout === 'horizontal' ? 'acu-changes-horizontal' : ''}\">`;\n\n    // ===  ===\n    if (isValidationMode) {\n      if (validationErrors.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedErrors = ValidationEngine.groupErrorsByTable(validationErrors);\n        const collapsedGroups = Store.get('acu_validation_collapsed_groups', []);\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        for (const tableName in groupedErrors) {\n          const tableErrors = groupedErrors[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header acu-validation-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\" style=\"background:var(--acu-error-text);\">${tableErrors.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableErrors.forEach(error => {\n            const ruleData = error.rule\n              ? escapeHtml(\n                  JSON.stringify({\n                    ruleId: error.ruleId,\n                    ruleType: error.ruleType,\n                    tableName: error.tableName,\n                    rowIndex: error.rowIndex,\n                    columnName: error.columnName || '',\n                    currentValue: error.currentValue || '',\n                    rowTitle: error.rowTitle || '', //  rowTitle  ruleData\n                    rule: error.rule,\n                  }),\n                )\n              : '';\n\n            html += `<div class=\"acu-change-item acu-validation-error-item\"\n                         data-table=\"${escapeHtml(error.tableName)}\"\n                         data-row=\"${error.rowIndex}\"\n                         data-column=\"${escapeHtml(error.columnName || '')}\"\n                         data-rule-id=\"${escapeHtml(error.ruleId || '')}\"\n                         data-rule-type=\"${escapeHtml(error.ruleType || '')}\"\n                         data-rule-data=\"${ruleData}\">\n                        <span class=\"acu-change-badge\" style=\"background:var(--acu-hl-manual-bg);color:var(--acu-hl-manual);\">!</span>\n                        ${error.rowTitle && error.rowIndex >= 0 ? `<div class=\"acu-validation-row-title\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:2px;\">${escapeHtml(error.rowTitle)}</div>` : ''}\n                        <span class=\"acu-change-title\">${escapeHtml(error.columnName || '')}${error.currentValue ? `: ${escapeHtml(error.currentValue.length > 15 ? error.currentValue.substring(0, 15) + '...' : error.currentValue)}` : ''}</span>\n                        <span class=\"acu-validation-error-msg\">${escapeHtml(error.errorMessage.length > 25 ? error.errorMessage.substring(0, 25) + '...' : error.errorMessage)}</span>\n                        <div class=\"acu-change-actions\">\n                            <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                        </div>\n                    </div>`;\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    } else {\n      // ===  ===\n      if (changes.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedChanges = {};\n        changes.forEach(c => {\n          const key = c.tableName;\n          if (!groupedChanges[key]) groupedChanges[key] = [];\n          groupedChanges[key].push(c);\n        });\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        const collapsedGroups = Store.get('acu_changes_collapsed_groups', []);\n\n        for (const tableName in groupedChanges) {\n          const tableChanges = groupedChanges[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\">${tableChanges.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableChanges.forEach(change => {\n            if (change.type === 'row_added') {\n              html += `<div class=\"acu-change-item acu-change-added\"\n                            data-change-type=\"row_added\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-added\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"row_deleted\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'cell_modified') {\n              const oldShort = change.oldValue.length > 15 ? change.oldValue.substring(0, 15) + '...' : change.oldValue;\n              const newShort = change.newValue.length > 15 ? change.newValue.substring(0, 15) + '...' : change.newValue;\n\n              const isOptionTable = change.tableName && change.tableName.includes('');\n              let fieldDisplay;\n              if (isOptionTable) {\n                fieldDisplay = `${escapeHtml(change.tableName)}.${escapeHtml(change.header)}`;\n              } else {\n                fieldDisplay = `${escapeHtml(change.rowTitle)}.${escapeHtml(change.header)}`;\n              }\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"cell_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\"\n                            data-col-index=\"${change.colIndex}\"\n                            data-old-value=\"${encodeURIComponent(change.oldValue)}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-field\">${fieldDisplay}</span>\n                            <span class=\"acu-change-diff\">\n                                <span class=\"acu-diff-old\">${escapeHtml(oldShort || '()')}</span>\n                                <span class=\"acu-diff-arrow\"></span>\n                                <span class=\"acu-diff-new\">${escapeHtml(newShort || '()')}</span>\n                            </span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_modified') {\n              // \n              const fieldCount = change.changedFields.length;\n              const fieldNames = change.changedFields\n                .slice(0, 2)\n                .map(f => f.header)\n                .join('');\n              const moreText = fieldCount > 2 ? ` ${fieldCount}` : '';\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"row_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.rowTitle)}</span>\n                            <span class=\"acu-change-field-count\">${escapeHtml(fieldNames)}${moreText}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'table_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"table_deleted\"\n                            data-table-key=\"${change.tableKey}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\"></span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            }\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    }\n\n    html += `</div>`;\n    return html;\n  };\n  // [] \n  const bindChangesEvents = () => {\n    const { $ } = getCore();\n\n    // \n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-close-btn')\n      .off('click')\n      .on('click', function () {\n        Store.set('acu_changes_panel_active', false);\n        $('#acu-data-area').removeClass('visible');\n        $('.acu-nav-btn').removeClass('active');\n      });\n\n    // === ===\n    const TOUCH_MOVE_THRESHOLD = 10; // 10px\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const tableName = $item.data('table');\n        const rowIndex = parseInt($item.data('row'), 10);\n        const columnName = $item.data('column');\n\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        try {\n          const rawData = cachedRawData || getTableData();\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === tableName && snapshot[sheetId]) {\n              const headers = rawData[sheetId].content?.[0] || [];\n              const colIdx = headers.indexOf(columnName);\n              if (colIdx >= 0 && snapshot[sheetId].content?.[rowIndex + 1]) {\n                const snapshotValue = snapshot[sheetId].content[rowIndex + 1][colIdx];\n                rawData[sheetId].content[rowIndex + 1][colIdx] = snapshotValue;\n                await saveDataToDatabase(rawData, false, false);\n                renderInterface();\n                return;\n              }\n              break;\n            }\n          }\n          if (window.toastr) window.toastr.warning('');\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const ruleData = $item.data('rule-data');\n        if (!ruleData) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        try {\n          const parsed = typeof ruleData === 'string' ? JSON.parse(ruleData) : ruleData;\n          const error = {\n            ruleId: parsed.ruleId,\n            ruleType: parsed.ruleType,\n            rule: parsed.rule,\n            tableName: $item.data('table') || parsed.tableName || '',\n            rowIndex: parseInt($item.data('row'), 10) || parsed.rowIndex || 0,\n            columnName: $item.data('column') || parsed.columnName || '',\n            currentValue: parsed.currentValue || '',\n            rowTitle: parsed.rowTitle || '', //  rowTitle \n            ruleName: parsed.ruleName || parsed.rule?.name || '',\n            errorMessage: parsed.errorMessage || parsed.rule?.errorMessage || '',\n          };\n          showSmartFixModal(error);\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    let validationItemTouchStartPos: { x: number; y: number } | null = null;\n\n    $('.acu-validation-error-item')\n      .off('click touchstart touchend touchmove')\n      .on('touchstart', function (e) {\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        validationItemTouchStartPos = { x: touch.clientX, y: touch.clientY };\n      })\n      .on('touchmove', function (e) {\n        if (!validationItemTouchStartPos) return;\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        const deltaX = Math.abs(touch.clientX - validationItemTouchStartPos.x);\n        const deltaY = Math.abs(touch.clientY - validationItemTouchStartPos.y);\n        // \n        if (deltaX > TOUCH_MOVE_THRESHOLD || deltaY > TOUCH_MOVE_THRESHOLD) {\n          validationItemTouchStartPos = null;\n        }\n      })\n      .on('touchend', function (e) {\n        // \n        if (!validationItemTouchStartPos) return;\n        validationItemTouchStartPos = null;\n\n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      })\n      .on('click', function (e) {\n        //  click \n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        //  touchend \n        if ('ontouchstart' in window) return;\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      });\n\n    // /\n    $('.acu-changes-group-header')\n      .off('click')\n      .on('click', function (e) {\n        if ($(e.target).closest('.acu-change-item').length) return;\n\n        const tableName = $(this).data('table');\n        const $group = $(this).closest('.acu-changes-group');\n        const $body = $group.find('.acu-changes-group-body');\n        const $icon = $(this).find('.acu-collapse-icon');\n\n        // \n        const isValidationMode = $(this).hasClass('acu-validation-group-header');\n        const storageKey = isValidationMode ? 'acu_validation_collapsed_groups' : 'acu_changes_collapsed_groups';\n        let collapsedGroups = Store.get(storageKey, []);\n\n        if ($group.hasClass('collapsed')) {\n          $group.removeClass('collapsed');\n          $body.slideDown(200);\n          $icon.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n          collapsedGroups = collapsedGroups.filter(n => n !== tableName);\n        } else {\n          $group.addClass('collapsed');\n          $body.slideUp(200);\n          $icon.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n          if (!collapsedGroups.includes(tableName)) {\n            collapsedGroups.push(tableName);\n          }\n        }\n\n        Store.set(storageKey, collapsedGroups);\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-accept')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n\n        const snapshot = loadSnapshot();\n        const rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = rawData[tableKey].content[rowIndex + 1][colIndex];\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            if (!snapshot[tableKey]) {\n              snapshot[tableKey] = JSON.parse(JSON.stringify(rawData[tableKey]));\n            } else {\n              snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n            }\n          }\n        } else if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          delete snapshot[tableKey];\n        }\n\n        saveSnapshot(snapshot);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n        const oldValue = decodeURIComponent($item.data('old-value') || '');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content[rowIndex + 1][colIndex] = oldValue;\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content) {\n            rawData[tableKey].content[rowIndex + 1] = [...snapshot[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData, [tableKey]);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === /===\n    $('.acu-action-restore')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            const restoredRow = [...snapshot[tableKey].content[rowIndex + 1]];\n            if (!rawData[tableKey]) {\n              rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n              rawData[tableKey].content = [snapshot[tableKey].content[0]];\n            }\n            // \n            rawData[tableKey].content.splice(rowIndex + 1, 0, restoredRow);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          if (snapshot[tableKey]) {\n            rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData, [tableKey]);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item:not(.acu-validation-error-item) .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const changeType = $item.data('change-type');\n\n        if (!tableKey || rowIndex === undefined) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const sheet = rawData[tableKey];\n        const headers = sheet.content ? sheet.content[0] : [];\n        const row = sheet.content ? sheet.content[rowIndex + 1] : null;\n\n        if (!row) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        if (changeType === 'row_modified') {\n          // \n          showRowCompareEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        } else if (changeType === 'cell_modified') {\n          const colIndex = $item.data('col-index');\n          const headerName = headers[colIndex] || `${colIndex}`;\n          const cellValue = row[colIndex] || '';\n          showChangeSingleFieldModal(cellValue, headerName, sheet.name, rowIndex, colIndex, tableKey);\n        } else {\n          showChangeEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        }\n      });\n\n    // ===  ===\n    $('.acu-batch-accept')\n      .off('click')\n      .on('click', async function () {\n        const rawData = cachedRawData || getTableData();\n        if (!rawData) return;\n\n        // \n        saveSnapshot(JSON.parse(JSON.stringify(rawData)));\n        currentDiffMap = new Set();\n\n        // \n        refreshChangesPanel();\n      });\n\n    // ===  ===\n    $('.acu-batch-reject')\n      .off('click')\n      .on('click', async function () {\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const restoredData = JSON.parse(JSON.stringify(snapshot));\n        cachedRawData = restoredData;\n        await saveDataToDatabase(restoredData, false, false);\n      });\n\n    // ===  ===\n    $('.acu-simple-mode-toggle')\n      .off('click')\n      .on('click', function () {\n        const currentMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        const newMode = !currentMode;\n        Store.set(STORAGE_KEY_VALIDATION_MODE, newMode);\n\n        // \n        const rawData = cachedRawData || getTableData();\n        $('#acu-data-area').html(renderChangesPanel(rawData));\n        bindChangesEvents();\n\n        // \n        updateChangesCount(rawData);\n      });\n\n    // ===  ===\n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          // \n          const finalHeight = $panel.height();\n          const heights = getTableHeights();\n          heights[tableName] = finalHeight;\n          saveTableHeights(heights);\n        };\n      })\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const $panel = $('#acu-data-area');\n        $panel.css('height', ''); // \n        // \n        const heights = getTableHeights();\n        delete heights[tableName];\n        saveTableHeights(heights);\n      });\n\n    // ===  ===\n    const $horizontalScroller = $('.acu-changes-content.acu-changes-horizontal');\n    if ($horizontalScroller.length) {\n      $horizontalScroller[0].addEventListener(\n        'touchstart',\n        function (e) {\n          this._touchStartX = e.touches[0].clientX;\n          this._touchStartY = e.touches[0].clientY;\n          this._scrollDirection = null; // \n        },\n        { passive: true },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchmove',\n        function (e) {\n          if (!this._touchStartX) return;\n\n          const deltaX = Math.abs(e.touches[0].clientX - this._touchStartX);\n          const deltaY = Math.abs(e.touches[0].clientY - this._touchStartY);\n\n          // \n          if (!this._scrollDirection && (deltaX > 5 || deltaY > 5)) {\n            this._scrollDirection = deltaX > deltaY ? 'horizontal' : 'vertical';\n          }\n\n          // \n          // \n          if (this._scrollDirection === 'horizontal' && deltaX > 10) {\n            e.stopPropagation();\n          }\n        },\n        { passive: false },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchend',\n        function () {\n          this._touchStartX = null;\n          this._touchStartY = null;\n          this._scrollDirection = null;\n        },\n        { passive: true },\n      );\n    }\n  };\n\n  // [] \n  const refreshChangesPanel = () => {\n    const { $ } = getCore();\n    const rawData = cachedRawData || getTableData();\n    currentDiffMap = generateDiffMap(rawData);\n\n    const $panel = $('#acu-data-area');\n    if ($panel.length && Store.get('acu_changes_panel_active', false)) {\n      $panel.html(renderChangesPanel(rawData));\n      bindChangesEvents();\n\n      // \n      updateChangesCount(rawData);\n    }\n  };\n\n  // []  + \n  const updateChangesCount = rawData => {\n    const { $ } = getCore();\n    const snapshot = loadSnapshot();\n    let changesCount = 0;\n\n    if (snapshot && rawData) {\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const newSheet = rawData[sheetId];\n        const oldSheet = snapshot[sheetId];\n        if (!newSheet?.content) continue;\n        const newRows = newSheet.content.slice(1);\n        const oldRows = oldSheet?.content?.slice(1) || [];\n\n        // [] detectChanges\n        const oldRowsByTitle = new Map<string, Array<{ index: number; row: (typeof oldRows)[0] }>>();\n        oldRows.forEach((row, rIdx) => {\n          const title = String(row[1] ?? '').trim();\n          if (!oldRowsByTitle.has(title)) {\n            oldRowsByTitle.set(title, []);\n          }\n          oldRowsByTitle.get(title)!.push({ index: rIdx, row });\n        });\n\n        newRows.forEach((row, rowIdx) => {\n          const title = String(row[1] ?? '').trim();\n          let oldRow: (typeof oldRows)[0] | undefined;\n\n          if (title && oldRowsByTitle.has(title)) {\n            const queue = oldRowsByTitle.get(title)!;\n            if (queue.length > 0) {\n              const matched = queue.shift()!;\n              oldRow = matched.row;\n            }\n          } else if (!title) {\n            oldRow = oldRows[rowIdx];\n          }\n\n          if (!oldRow) {\n            changesCount++; // \n          } else {\n            // \n            let hasChange = false;\n            row.forEach((cell, colIdx) => {\n              if (colIdx === 0) return;\n              if (String(cell ?? '') !== String(oldRow![colIdx] ?? '')) hasChange = true;\n            });\n            if (hasChange) changesCount++;\n          }\n        });\n\n        // \n        const newTitleCounts = new Map<string, number>();\n        const oldTitleCounts = new Map<string, number>();\n        newRows.forEach(row => {\n          const title = String(row[1] ?? '').trim();\n          if (title) newTitleCounts.set(title, (newTitleCounts.get(title) || 0) + 1);\n        });\n        oldRows.forEach(row => {\n          const title = String(row[1] ?? '').trim();\n          if (title) oldTitleCounts.set(title, (oldTitleCounts.get(title) || 0) + 1);\n        });\n        oldTitleCounts.forEach((oldCount, title) => {\n          const newCount = newTitleCounts.get(title) || 0;\n          if (oldCount > newCount) changesCount += oldCount - newCount;\n        });\n        // \n        const emptyOldCount = oldRows.filter(r => !String(r[1] ?? '').trim()).length;\n        const emptyNewCount = newRows.filter(r => !String(r[1] ?? '').trim()).length;\n        if (emptyOldCount > emptyNewCount) changesCount += emptyOldCount - emptyNewCount;\n      }\n      for (const sheetId in snapshot) {\n        if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n      }\n    }\n\n    // \n    const validationErrorCount = rawData ? ValidationEngine.getErrorCount(rawData) : 0;\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n    const displayCount = isValidationMode ? validationErrorCount : changesCount;\n    // \n    const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n    const $btn = $('#acu-btn-changes');\n    const $span = $btn.find('span');\n    $span.html(displayCount > 0 ? `(${displayCount})` : '');\n\n    // \n    if (showWarningIcon) {\n      if (!$btn.find('.acu-nav-warning-icon').length) {\n        $span.append(' <i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>');\n      }\n      $btn.addClass('has-validation-errors');\n    } else {\n      $btn.find('.acu-nav-warning-icon').remove();\n      $btn.removeClass('has-validation-errors');\n    }\n  };\n  // [] \n  const showChangeEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const inputsHtml = row\n      .map((cell, idx) => {\n        if (idx === 0) return '';\n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        return `\n                <div class=\"acu-card-edit-field\">\n                    <label class=\"acu-card-edit-label\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-card-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\">${escapeHtml(val)}</textarea>\n                </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content acu-settings-content-scroll\">\n                        ${inputsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-change-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-change-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // [] \n    const adjustHeight = el => {\n      //  auto  0px scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n    };\n    dialog.find('#dlg-change-cancel').click(closeDialog);\n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n\n    dialog.find('#dlg-change-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n\n        if (hasChanges) {\n          // 1. \n          try {\n            const api = getCore().getDB();\n            if (!api || !api.importTableAsJson) {\n              throw new Error(' API ');\n            }\n            const anchorIndex = findLatestDbMessageIndex();\n\n            const dataToSave = { mate: rawData.mate || { type: 'chatSheets', version: 1 } };\n            Object.keys(rawData).forEach(k => {\n              if (k.startsWith('sheet_')) dataToSave[k] = rawData[k];\n            });\n\n            // \n            let jsonString;\n            try {\n              jsonString = JSON.stringify(dataToSave);\n              //  10MB \n              const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n              if (sizeInMB > 10) {\n                throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n              }\n            } catch (stringifyError) {\n              console.error('[DICE]ACU JSON :', stringifyError);\n              throw new Error(`: ${stringifyError.message || stringifyError}`);\n            }\n\n            //  importTableAsJson saveChat()\n            const result = await api.importTableAsJson(jsonString);\n            //  false \n            if (result === false) {\n              throw new Error(' false');\n            }\n            await relocateDbPayloadToAnchor(anchorIndex);\n\n            cachedRawData = rawData;\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            let errorMessage = e.message || '';\n            //  \"Settings could not be saved\" \n            const errorMsg = String(e);\n            if (\n              errorMsg.includes('Settings could not be saved') ||\n              errorMsg.includes('server connection') ||\n              errorMsg.includes('data loss')\n            ) {\n              errorMessage = '';\n            }\n            if (window.toastr) {\n              window.toastr.error(errorMessage, '', { timeOut: 7000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n            // \n            return;\n          }\n\n          // 2. \n          const snapshot = loadSnapshot();\n          if (snapshot && snapshot[tableKey] && snapshot[tableKey].content) {\n            snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n            saveSnapshot(snapshot);\n          }\n\n          // 3.  diffMap \n          currentDiffMap = generateDiffMap(rawData);\n\n          // 4. \n          const $panel = $('#acu-data-area');\n          $panel.html(renderChangesPanel(rawData));\n          bindChangesEvents();\n        }\n      }\n      closeDialog();\n    });\n  };\n  // [] \n  const showChangeSingleFieldModal = (value, headerName, tableName, rowIndex, colIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldValue = snapshot?.[tableKey]?.content?.[rowIndex + 1]?.[colIndex] ?? '';\n    const hasOldValue = oldValue !== '' && String(oldValue) !== String(value);\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:450px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(headerName)}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${\n                          hasOldValue\n                            ? `\n                        <div class=\"acu-diff-section acu-diff-old-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                            </div>\n                            <div class=\"acu-diff-readonly\">${escapeHtml(oldValue)}</div>\n                        </div>\n                        <div class=\"acu-diff-arrow-down\">\n                            <i class=\"fa-solid fa-arrow-down\"></i>\n                        </div>\n                        `\n                            : ''\n                        }\n                        <div class=\"acu-diff-section acu-diff-new-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-pen\"></i> ${hasOldValue ? '' : ''}\n                            </div>\n                            <textarea class=\"acu-change-single-input acu-edit-textarea\" spellcheck=\"false\"\n                                style=\"width:100%;min-height:60px;max-height:300px;padding:12px;resize:none;\">${escapeHtml(value)}</textarea>\n                        </div>\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-single-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        ${hasOldValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"dlg-single-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-single-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const $textarea = dialog.find('.acu-change-single-input');\n    const adjustHeight = () => {\n      $textarea[0].style.height = 'auto';\n      const h = Math.max(60, Math.min($textarea[0].scrollHeight + 2, 300));\n      $textarea[0].style.height = h + 'px';\n    };\n    setTimeout(adjustHeight, 0);\n    $textarea.on('input', adjustHeight);\n    $textarea.focus();\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-single-cancel').click(closeDialog);\n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n\n    // [] \n    dialog.find('#dlg-single-revert').click(function () {\n      $textarea.val(oldValue).trigger('input');\n    });\n\n    dialog.find('#dlg-single-save').click(async () => {\n      const newVal = $textarea.val();\n      let rawData = cachedRawData || getTableData();\n\n      if (rawData && rawData[tableKey] && rawData[tableKey].content) {\n        const currentRow = rawData[tableKey].content[rowIndex + 1];\n        if (currentRow && String(currentRow[colIndex]) !== String(newVal)) {\n          currentRow[colIndex] = newVal;\n\n          // \n          await saveDataOnly(rawData, [tableKey]);\n\n          // \n          const snapshot = loadSnapshot();\n          if (\n            snapshot &&\n            snapshot[tableKey] &&\n            snapshot[tableKey].content &&\n            snapshot[tableKey].content[rowIndex + 1]\n          ) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = newVal;\n            saveSnapshot(snapshot);\n          }\n\n          // \n          currentDiffMap = generateDiffMap(rawData);\n          refreshChangesPanel();\n        }\n      }\n      closeDialog();\n    });\n  };\n\n  // [] \n  const showRowCompareEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldRow = snapshot?.[tableKey]?.content?.[rowIndex + 1] || [];\n\n    // \n    let fieldsHtml = '';\n    for (let idx = 1; idx < headers.length; idx++) {\n      const headerName = headers[idx] || ` ${idx}`;\n      const oldVal = oldRow[idx] ?? '';\n      const newVal = row[idx] ?? '';\n      const isChanged = String(oldVal) !== String(newVal);\n\n      fieldsHtml += `\n                <div class=\"acu-row-edit-field ${isChanged ? 'acu-field-changed' : ''}\">\n                    <div class=\"acu-row-edit-label\">${escapeHtml(headerName)} ${isChanged ? '<span class=\"acu-changed-badge\"></span>' : ''}</div>\n                    ${isChanged ? `<div class=\"acu-row-edit-old\">${escapeHtml(oldVal) || '<span class=\"acu-empty-val\">()</span>'}</div>` : ''}\n                    <textarea class=\"acu-row-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\">${escapeHtml(newVal)}</textarea>\n                </div>\n            `;\n    }\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:550px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(row[1] || ' ' + (rowIndex + 1))}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px; max-height:60vh;\">\n                        ${fieldsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-row-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = Math.min(el.scrollHeight + 2, 200) + 'px';\n    };\n    dialog.find('textarea').each(function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-row-cancel').click(closeDialog);\n    setupOverlayClose(dialog, 'acu-edit-overlay', closeDialog);\n\n    // \n    dialog.find('#dlg-row-revert').click(function () {\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        $(this)\n          .val(oldRow[colIdx] ?? '')\n          .trigger('input');\n      });\n    });\n\n    // \n    dialog.find('#dlg-row-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (!rawData?.[tableKey]?.content?.[rowIndex + 1]) {\n        closeDialog();\n        return;\n      }\n\n      const currentRow = rawData[tableKey].content[rowIndex + 1];\n      let hasChanges = false;\n\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        const newVal = $(this).val();\n        if (String(currentRow[colIdx]) !== String(newVal)) {\n          hasChanges = true;\n          currentRow[colIdx] = newVal;\n        }\n      });\n\n      if (hasChanges) {\n        await saveDataOnly(rawData, [tableKey]);\n\n        // \n        const snapshot = loadSnapshot();\n        if (snapshot?.[tableKey]?.content) {\n          snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n          saveSnapshot(snapshot);\n        }\n\n        currentDiffMap = generateDiffMap(rawData);\n        refreshChangesPanel();\n      }\n      closeDialog();\n    });\n  };\n  const renderDashboard = allTables => {\n    console.info('[DICE]...');\n    const config = getConfig();\n\n    // [] \n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const questResult = DashboardDataParser.findTable(allTables, 'quest');\n    const bagResult = DashboardDataParser.findTable(allTables, 'bag');\n    const skillResult = DashboardDataParser.findTable(allTables, 'skill');\n    const equipResult = DashboardDataParser.findTable(allTables, 'equip');\n\n    // []  - \n    let player = { name: '', status: '', position: '', attrs: '', money: '0' };\n    const playerParsed = DashboardDataParser.parseRows(playerResult, 'player');\n\n    if (playerParsed.length > 0) {\n      const p = playerParsed[0];\n      player.name = p.name || '';\n      player.status = p.status || '';\n      player.position = p.position || '';\n      player.money = p.money || '';\n      player.resources = '';\n\n      // [] \n      if (playerResult?.data?.headers && playerResult?.data?.rows?.[0]) {\n        const headers = playerResult.data.headers;\n        const row = playerResult.data.rows[0];\n        let allAttrsStr = '';\n        headers.forEach((h, idx) => {\n          if (h && h.includes('')) {\n            const val = row[idx];\n            if (val) allAttrsStr += (allAttrsStr ? '; ' : '') + val;\n          }\n        });\n        player.attrs = allAttrsStr;\n\n        // \n        headers.forEach((h, idx) => {\n          if (h && (h.includes('') || h.includes(''))) {\n            const val = row[idx];\n            if (val) player.resources = val;\n          }\n        });\n      }\n    }\n\n    // [] HTML\n    const playerRows = playerResult?.data?.rows || [];\n    const playerHeaders = playerResult?.data?.headers || [];\n\n    // []  - \n    let globalDetailLocation = ''; // \n    let globalLocation = ''; // \n\n    if (globalResult?.data?.rows?.length > 0) {\n      const headers = globalResult.data.headers || [];\n      const row = globalResult.data.rows[0];\n\n      // \n      const detailIdx = DashboardDataParser.findColumnIndex(headers, 'detailLocation', globalResult.config);\n      if (detailIdx >= 0 && row[detailIdx]) {\n        globalDetailLocation = row[detailIdx];\n      }\n\n      // \n      const locIdx = DashboardDataParser.findColumnIndex(headers, 'currentLocation', globalResult.config);\n      globalLocation = locIdx >= 0 && row[locIdx] ? row[locIdx] : row[2] || '';\n    }\n\n    // currentPlaceName \n    let currentPlaceName =\n      globalDetailLocation ||\n      globalLocation ||\n      (player.position.includes('-') ? player.position.split('-')[0].trim() : player.position);\n\n    // [] NPC - \n    const npcTableName = npcResult?.name || '';\n    const npcTableKey = npcResult?.key || '';\n\n    const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n\n    // NPC\n    let inSceneNPCs = [];\n    let offSceneNPCs = [];\n    npcParsed.forEach(npc => {\n      const inSceneVal = String(npc.inScene || '').toLowerCase();\n      const npcData = {\n        name: npc.name || '',\n        status: npc.status || '',\n        position: npc.position || '',\n        index: npc._rowIndex,\n      };\n      if (inSceneVal === 'true' || inSceneVal === '') {\n        inSceneNPCs.push(npcData);\n      } else {\n        offSceneNPCs.push(npcData);\n      }\n    });\n    // \n    let allNPCs = [...inSceneNPCs, ...offSceneNPCs];\n\n    // []  - ///\n    const questTableName = questResult?.name || '';\n    const questParsed = DashboardDataParser.parseRows(questResult, 'quest');\n\n    // \n    const questStatusOrder = (status: string) => {\n      const s = String(status || '').toLowerCase();\n      // //\n      if (s.includes('') || s.includes('')) return 0;\n      return 1; // \n    };\n    const questTypeOrder = (type: string) => {\n      const t = String(type || '').toLowerCase();\n      if (t.includes('')) return 0;\n      if (t.includes('')) return 1;\n      if (t.includes('')) return 2;\n      return 3;\n    };\n    const questPriorityOrder = (priority: string) => {\n      const p = String(priority || '').toLowerCase();\n      if (p.includes('')) return 0;\n      if (p.includes('')) return 1;\n      if (p.includes('')) return 2;\n      return 3;\n    };\n    const parseProgress = (progress: string) => {\n      const match = String(progress || '').match(/(\\d+)\\s*%/);\n      return match ? parseInt(match[1], 10) : 0;\n    };\n\n    let activeTasks = questParsed\n      .map(q => ({\n        name: q.name || '',\n        type: q.type || '',\n        status: q.status || '',\n        priority: q.priority || '',\n        progress: q.progress || '',\n        _rowIndex: q._rowIndex,\n      }))\n      .sort((a, b) => {\n        // 1.  > \n        const aStatusOrder = questStatusOrder(a.status);\n        const bStatusOrder = questStatusOrder(b.status);\n        const statusDiff = aStatusOrder - bStatusOrder;\n        if (statusDiff !== 0) return statusDiff;\n\n        // \n        if (aStatusOrder === 1) {\n          return (b._rowIndex ?? 0) - (a._rowIndex ?? 0);\n        }\n\n        // \n        // 2.  >  > \n        const typeDiff = questTypeOrder(a.type) - questTypeOrder(b.type);\n        if (typeDiff !== 0) return typeDiff;\n        // 3.  >  > \n        const priorityDiff = questPriorityOrder(a.priority) - questPriorityOrder(b.priority);\n        if (priorityDiff !== 0) return priorityDiff;\n        // 4.   \n        return parseProgress(a.progress) - parseProgress(b.progress);\n      });\n    // []  - \n    const bagTableName = bagResult?.name || '';\n\n    const bagParsed = DashboardDataParser.parseRows(bagResult, 'bag');\n    let bagItems = bagParsed.map(item => ({\n      name: item.name || '',\n      count: item.count || '1',\n      type: item.type || '',\n    }));\n\n    // []  - \n    const skillTableName = skillResult?.name || '';\n\n    const skillParsed = DashboardDataParser.parseRows(skillResult, 'skill');\n    let skills = skillParsed.map(s => ({\n      name: s.name || '',\n      level: s.level || '',\n      type: s.type || '',\n    }));\n\n    // []  -  + \n    const equipTableName = equipResult?.name || '';\n\n    const equipParsed = DashboardDataParser.parseRows(equipResult, 'equip');\n    const equippedParsed = DashboardDataParser.applyFilter(equipParsed, 'equipped', 'equip');\n\n    let equippedItems = equippedParsed.map(e => ({\n      name: e.name || '',\n      type: e.type || '',\n      part: e.part || '',\n    }));\n    // []  - \n    const locationTableName = locationResult?.name || '';\n    const locationTableKey = locationResult?.key || '';\n\n    const locationParsed = DashboardDataParser.parseRows(locationResult, 'location');\n\n    // HTML\n    let html = `\n        <div class=\"acu-panel-header\">\n            <div class=\"acu-panel-title\">\n                <div class=\"acu-title-main\"><i class=\"fa-solid fa-chart-line\"></i> <span class=\"acu-title-text\"></span></div>\n                <div class=\"acu-title-sub\"></div>\n            </div>\n            <div class=\"acu-header-actions\">\n                <div class=\"acu-height-control\">\n                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                </div>\n                <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n        </div>\n        <div class=\"acu-panel-content acu-dashboard-content\">\n            <div class=\"acu-dash-body ${config.layout === 'horizontal' ? 'acu-dash-horizontal' : ''}\">\n            <!--  +  -->\n                <div class=\"acu-dash-player\">\n                    <h3 class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                        data-table-key=\"${playerResult?.key || ''}\"\n                        data-row-index=\"0\"\n                        data-preview-type=\"player\"\n                        style=\"cursor:pointer;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-user-circle\"></i> ${escapeHtml(replaceUserPlaceholders(player.name))}</span>\n                        <span style=\"font-size:11px;font-weight:normal;color:var(--acu-text-main);background:var(--acu-badge-bg);padding:2px 8px;border-radius:10px;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;\" title=\"${escapeHtml(player.status)}\">${escapeHtml(player.status.length > 6 ? player.status.substring(0, 6) + '..' : player.status)}</span>\n                    </h3>\n                    <div class=\"acu-player-status\" style=\"min-height:110px;max-height:110px;overflow-y:auto;margin-bottom:10px;\">\n                        ${(() => {\n                          // \n                          const resourcesStr = player.resources || player.money || '';\n                          const parsedResources = parseAttributeString(resourcesStr);\n\n                          // \n                          let allAttrs = [];\n                          if (playerRows.length > 0 && playerHeaders.length > 0) {\n                            const row = playerRows[0];\n                            playerHeaders.forEach((h, idx) => {\n                              if (h && h.includes('')) {\n                                const parsed = parseAttributeString(row[idx] || '');\n                                parsed.forEach(attr => {\n                                  if (!allAttrs.some(a => a.name === attr.name)) {\n                                    allAttrs.push(attr);\n                                  }\n                                });\n                              }\n                            });\n                          }\n\n                          // \n                          if (parsedResources.length === 0 && allAttrs.length === 0) {\n                            return '<div class=\"acu-empty-hint\"></div>';\n                          }\n\n                          let html = '';\n                          if (parsedResources.length > 0) {\n                            html += `<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:52px;overflow-y:auto;margin-bottom:6px;padding-bottom:6px;border-bottom:1px dashed var(--acu-border);\">\n                                    ${parsedResources\n                                      .map(\n                                        res => `\n                                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;\">\n                                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(res.name)}\">${escapeHtml(res.name.substring(0, 3))}</span>\n                                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                                <span style=\"color:var(--acu-accent);font-size:11px;font-weight:bold;\">${res.value}</span>\n                                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${res.value}\" data-name=\"${escapeHtml(res.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${res.name}(${res.value})\"></i>\n                                            </div>\n                                        </div>\n                                    `,\n                                      )\n                                      .join('')}\n                                </div>`;\n                          }\n\n                          if (allAttrs.length > 0) {\n                            // 598px\n                            html += `<div style=\"display:grid;grid-template-columns:repeat(3,1fr);gap:2px 6px;max-height:98px;overflow-y:auto;overflow-x:hidden;\">\n                                    ${allAttrs\n                                      .map(\n                                        attr => `\n                                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;\">\n                                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(attr.name)}\">${escapeHtml(attr.name.substring(0, 2))}</span>\n                                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                                <span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${attr.value}</span>\n                                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${attr.value}\" data-name=\"${escapeHtml(attr.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${attr.name}(${attr.value})\"></i>\n                                            </div>\n                                        </div>\n                                    `,\n                                      )\n                                      .join('')}\n                                </div>`;\n                          }\n\n                          return html;\n                        })()}\n                    </div>\n\n                    <h4 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(skillTableName)}\" style=\"font-size:14px;color:var(--acu-accent);margin:10px 0 6px 0;\"><i class=\"fa-solid fa-bolt\"></i>  (${skillParsed.length})</h4>\n                    <div style=\"display:grid;grid-template-columns:repeat(2,1fr);gap:2px 6px;max-height:78px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      skills.length > 0\n                        ? skills\n                            .map((skill, idx) => {\n                              const skillValue = extractNumericValue(skill.level);\n                              const hasNumeric = skillValue > 0;\n                              const skillRowIndex = skillParsed.findIndex(s => s.name === skill.name);\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${skillResult?.key || ''}\"\n                            data-row-index=\"${skillRowIndex >= 0 ? skillRowIndex : idx}\"\n                            data-preview-type=\"skill\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;cursor:pointer;\">\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(skill.name)}\">${escapeHtml(skill.name.length > 5 ? skill.name.substring(0, 5) + '..' : skill.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                ${\n                                  hasNumeric\n                                    ? `<span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${skillValue}</span>\n                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${skillValue}\" data-name=\"${escapeHtml(skill.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${skill.name}(${skillValue})\"></i>`\n                                    : `<span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(skill.level || '-')}</span>`\n                                }\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  + NPC -->\n                <div class=\"acu-dash-locations\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(locationTableName)}\" style=\"display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-map\"></i>  (${locationParsed.length})</span>\n                        <i class=\"fa-solid fa-map acu-dash-map-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;align-content:start;max-height:110px;overflow-y:auto;overflow-x:hidden;margin-bottom:10px;\">\n                    ${\n                      locationParsed.length > 0\n                        ? locationParsed\n                            .map((loc, idx) => {\n                              const areaName = loc.name || '';\n                              const isCurrent =\n                                currentPlaceName &&\n                                (areaName.includes(currentPlaceName) || currentPlaceName.includes(areaName));\n                              const emoji = getElementEmoji(areaName, null);\n                              let iconHtml = '';\n                              if (emoji) {\n                                if (emoji.startsWith('fa:')) {\n                                  iconHtml = `<i class=\"fa-solid fa-${emoji.slice(3)}\" style=\"font-size:10px;opacity:0.7;\"></i>`;\n                                } else if (emoji.startsWith('ti:')) {\n                                  iconHtml = `<i class=\"ti ti-${emoji.slice(3)}\" style=\"font-size:10px;opacity:0.7;\"></i>`;\n                                } else {\n                                  iconHtml = `<span style=\"font-size:10px;\">${emoji}</span>`;\n                                }\n                              } else {\n                                iconHtml = isCurrent\n                                  ? '<i class=\"fa-solid fa-location-dot\"></i>'\n                                  : '<i class=\"fa-solid fa-map-pin\" style=\"font-size:9px;opacity:0.4;\"></i>';\n                              }\n                              return `<div class=\"acu-location-item acu-dash-clickable acu-dash-preview-trigger ${isCurrent ? 'acu-current-location' : ''}\"\n                            data-table-key=\"${escapeHtml(locationTableKey)}\"\n                            data-row-index=\"${loc._rowIndex}\"\n                            data-preview-type=\"location\">\n                            <span style=\"display:flex;align-items:center;gap:4px;\">\n                                ${iconHtml}\n                                <span title=\"${escapeHtml(areaName)}\">${escapeHtml(areaName)}</span>\n                            </span>\n                            ${!isCurrent ? `<i class=\"fa-solid fa-walking acu-dash-goto-btn\" data-location=\"${escapeHtml(areaName)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;flex-shrink:0;\" title=\"${areaName}\"></i>` : '<i class=\"fa-solid fa-street-view\" style=\"flex-shrink:0;\" title=\"\"></i>'}\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(npcTableName)}\" style=\"margin-top:10px;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-users\"></i>  (${allNPCs.length})</span>\n                        <span style=\"display:flex;gap:8px;\">\n                            <i class=\"fa-solid fa-project-diagram acu-dash-relation-graph-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                            <i class=\"fa-solid fa-user-circle acu-dash-avatar-manager-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                        </span>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;align-content:start;max-height:150px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      allNPCs.length > 0\n                        ? allNPCs\n                            .map((npc, npcIdx) => {\n                              const isInScene = inSceneNPCs.some(n => n.name === npc.name);\n                              const isLastNpc = npcIdx === allNPCs.length - 1;\n                              const npcAvatar = AvatarManager.get(npc.name);\n                              const avatarOffsetX = AvatarManager.getOffsetX(npc.name);\n                              const avatarOffsetY = AvatarManager.getOffsetY(npc.name);\n                              const avatarScale = AvatarManager.getScale(npc.name);\n                              const avatarStyle = npcAvatar\n                                ? `background-image:url('${npcAvatar}');background-size:${avatarScale}%;background-position:${avatarOffsetX}% ${avatarOffsetY}%;`\n                                : '';\n                              const offSceneFilter = isInScene\n                                ? ''\n                                : 'filter:grayscale(80%) brightness(0.7);opacity:0.5;';\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${escapeHtml(npcTableKey)}\"\n                            data-row-index=\"${npc.index}\"\n                            data-preview-type=\"npc\"\n                            style=\"padding:6px 4px;${!isLastNpc ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <span class=\"acu-task-name\" style=\"font-size:12px;display:flex;align-items:center;gap:6px;\">\n                                    <span class=\"acu-dash-npc-avatar\" style=\"width:22px;height:22px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border:1.5px solid ${isInScene ? 'var(--acu-accent)' : 'var(--acu-border)'};${avatarStyle}${offSceneFilter}\" title=\"${isInScene ? '' : ''}\">\n                                        ${!npcAvatar ? `<span style=\"font-size:10px;font-weight:bold;color:var(--acu-text-sub);${offSceneFilter}\">${escapeHtml(npc.name.charAt(0))}</span>` : ''}\n                                    </span>\n                                    <span title=\"${escapeHtml(npc.name)}\" style=\"${isInScene ? '' : 'opacity:0.6;'}\">${escapeHtml(npc.name.length > 4 ? npc.name.substring(0, 4) + '..' : npc.name)}</span>\n                                </span>\n                                <div style=\"display:flex;align-items:center;\">\n                                    <i class=\"fa-solid fa-people-arrows acu-dash-contest-btn\" data-npc=\"${escapeHtml(npc.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:8px;\" title=\"${npc.name}\"></i>\n                                </div>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  +  +  -->\n                <div class=\"acu-dash-intel\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(bagTableName)}\"><i class=\"fa-solid fa-bag-shopping\"></i>  (${bagParsed.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:90px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      bagItems.length > 0\n                        ? bagItems\n                            .map((item, idx) => {\n                              const isLastBag = idx === bagItems.length - 1;\n                              const emoji = getElementEmoji(item.name, null);\n                              let iconHtml = '';\n                              if (emoji) {\n                                if (emoji.startsWith('fa:')) {\n                                  iconHtml = `<i class=\"fa-solid fa-${emoji.slice(3)}\" style=\"font-size:10px;opacity:0.7;\"></i>`;\n                                } else if (emoji.startsWith('ti:')) {\n                                  iconHtml = `<i class=\"ti ti-${emoji.slice(3)}\" style=\"font-size:10px;opacity:0.7;\"></i>`;\n                                } else {\n                                  iconHtml = `<span style=\"font-size:10px;\">${emoji}</span>`;\n                                }\n                              } else {\n                                iconHtml = '<i class=\"fa-solid fa-cube\" style=\"font-size:9px;opacity:0.4;\"></i>';\n                              }\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${bagResult?.key || ''}\"\n                            data-row-index=\"${idx}\"\n                            data-preview-type=\"bag\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLastBag ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);flex:1;white-space:nowrap;display:flex;align-items:center;gap:4px;\" title=\"${escapeHtml(item.name)}\">\n                                ${iconHtml}\n                                ${escapeHtml(item.name.length > 4 ? item.name.substring(0, 4) + '..' : item.name)}\n                            </span>\n                            <div style=\"display:flex;align-items:center;gap:6px;\">\n                                <i class=\"fa-solid fa-hand-pointer acu-dash-use-item-btn\" data-item=\"${escapeHtml(item.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:8px;\" title=\"${item.name}\"></i>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(equipTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-shield-halved\"></i>  (${equippedItems.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      equippedItems.length > 0\n                        ? equippedItems\n                            .map((item, idx) => {\n                              const isLast = idx === equippedItems.length - 1;\n                              const emoji = getElementEmoji(item.name, null);\n                              let iconHtml = '';\n                              if (emoji) {\n                                if (emoji.startsWith('fa:')) {\n                                  iconHtml = `<i class=\"fa-solid fa-${emoji.slice(3)}\" style=\"font-size:10px;opacity:0.7;\"></i>`;\n                                } else if (emoji.startsWith('ti:')) {\n                                  iconHtml = `<i class=\"ti ti-${emoji.slice(3)}\" style=\"font-size:10px;opacity:0.7;\"></i>`;\n                                } else {\n                                  iconHtml = `<span style=\"font-size:10px;\">${emoji}</span>`;\n                                }\n                              } else {\n                                iconHtml = '<i class=\"fa-solid fa-shirt\" style=\"font-size:9px;opacity:0.4;\"></i>';\n                              }\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${equipResult?.key || ''}\"\n                            data-row-index=\"${equipParsed.findIndex(r => r.name === item.name)}\"\n                            data-preview-type=\"equipment\"\n                            style=\"display:flex;align-items:center;gap:4px;padding:4px;font-size:11px;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;${!isLast ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            ${iconHtml}\n                            <span style=\"color:var(--acu-text-main);overflow:hidden;text-overflow:ellipsis;\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name)}</span>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(questTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-clipboard-list\"></i>  (${activeTasks.length})</h3>\n                    <div style=\"max-height:50px;overflow-y:auto;\">\n                    ${\n                      activeTasks.length > 0\n                        ? activeTasks\n                            .map((t, idx) => {\n                              const isMain = String(t.type || '').includes('');\n                              // \n                              let progressPercent = null;\n                              const progressMatch = String(t.progress || '').match(/(\\d+)\\s*%/);\n                              if (progressMatch) {\n                                progressPercent = Math.min(100, Math.max(0, parseInt(progressMatch[1], 10)));\n                              }\n                              const progressBar =\n                                progressPercent !== null\n                                  ? `<div style=\"width:40px;height:4px;background:var(--acu-border);border-radius:2px;overflow:hidden;\"><div style=\"width:${progressPercent}%;height:100%;background:var(--acu-accent);\"></div></div>`\n                                  : '';\n                              return `<div class=\"acu-task-item acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${questResult?.key || ''}\"\n                            data-row-index=\"${t._rowIndex !== undefined ? t._rowIndex : questParsed.findIndex(q => q.name === t.name)}\"\n                            data-preview-type=\"quest\"\n                            style=\"padding:4px 8px;margin-bottom:3px;cursor:pointer;\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <div class=\"acu-task-name\" style=\"font-size:11px;${isMain ? 'font-weight:600;' : ''}\">${escapeHtml(t.name)}</div>\n                                ${progressBar}\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n            </div>\n    `;\n\n    // \n    const loadedModules = [\n      globalResult ? '' : null,\n      playerResult ? '' : null,\n      locationResult ? '' : null,\n      npcResult ? 'NPC' : null,\n      questResult ? '' : null,\n      bagResult ? '' : null,\n      skillResult ? '' : null,\n      equipResult ? '' : null,\n    ].filter(Boolean);\n\n    console.info(`[DICE]${loadedModules.length}: ${loadedModules.join(', ')}`);\n    return html;\n  };\n\n  // ========== []  ==========\n  const renderFavoritesPanel = async (): Promise<string> => {\n    const allFavorites = await FavoritesManager.getAll();\n    const allTags = await FavoritesManager.getAllTags();\n\n    // \n    const groupedByTag: Record<string, FavoriteItem[]> = {};\n    const untagged: FavoriteItem[] = [];\n\n    for (const fav of allFavorites) {\n      if (fav.tags && fav.tags.length > 0) {\n        for (const tag of fav.tags) {\n          if (!groupedByTag[tag]) groupedByTag[tag] = [];\n          groupedByTag[tag].push(fav);\n        }\n      } else {\n        untagged.push(fav);\n      }\n    }\n\n    // HTML ( acu-data-card)\n    const renderFavoriteCard = (fav: FavoriteItem) => {\n      // \n      const rowsHtml = fav.header\n        .map((h, i) => {\n          // /\n          const cleanHeader = h.replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n          return `\n        <div class=\"acu-card-row\">\n          <div class=\"acu-card-label\">${escapeHtml(cleanHeader)}</div>\n          <div class=\"acu-card-value\">${escapeHtml(String(fav.rowData[i] || ''))}</div>\n        </div>\n      `;\n        })\n        .join('');\n      const tagsHtml = fav.tags.map(tag => `<span class=\"acu-fav-tag\">${escapeHtml(tag)}</span>`).join('');\n      const sourceLabel = fav.sourceInfo ? escapeHtml(fav.sourceInfo.tableName) : '';\n\n      //  acu-data-card \n      return `\n        <div class=\"acu-data-card acu-fav-card\" data-id=\"${escapeHtml(fav.id)}\">\n          <div class=\"acu-card-header\">\n            <span class=\"acu-card-index\">${sourceLabel}</span>\n            <span class=\"acu-editable-title\">${escapeHtml(String(fav.rowData[0] || ''))}</span>\n          </div>\n          <div class=\"acu-card-body view-list\">${rowsHtml}</div>\n          ${tagsHtml ? `<div class=\"acu-fav-card-tags\">${tagsHtml}</div>` : ''}\n        </div>\n      `;\n    };\n\n    // \n    const config = getConfig();\n\n    // \n    let contentHtml = '';\n\n    //  acu-card-grid \n    for (const tag of Object.keys(groupedByTag).sort()) {\n      contentHtml += `\n        <div class=\"acu-fav-group\">\n          <div class=\"acu-fav-group-title\"><i class=\"fa-solid fa-tag\"></i> ${escapeHtml(tag)}</div>\n          <div class=\"acu-card-grid\">${groupedByTag[tag].map(renderFavoriteCard).join('')}</div>\n        </div>\n      `;\n    }\n\n    // \n    if (untagged.length > 0) {\n      contentHtml += `\n        <div class=\"acu-fav-group\">\n          <div class=\"acu-fav-group-title\"><i class=\"fa-solid fa-inbox\"></i> </div>\n          <div class=\"acu-card-grid\">${untagged.map(renderFavoriteCard).join('')}</div>\n        </div>\n      `;\n    }\n\n    if (allFavorites.length === 0) {\n      contentHtml += `\n        <div class=\"acu-fav-empty\">\n          <i class=\"fa-solid fa-star\"></i>\n          <p></p>\n          <p>  \"\"</p>\n        </div>\n      `;\n    }\n\n    return `\n      <div class=\"acu-fav-wrapper acu-theme-${config.theme}\" style=\"--acu-card-width:${config.cardWidth}px; --acu-font-size:${config.fontSize}px;\">\n      <div class=\"acu-panel-header\">\n        <div class=\"acu-panel-title\">\n          <div class=\"acu-title-main\"><i class=\"fa-solid fa-star\"></i> <span class=\"acu-title-text\"></span></div>\n          <div class=\"acu-title-sub\">(${allFavorites.length})</div>\n        </div>\n        <div class=\"acu-header-actions\">\n          <button class=\"acu-view-btn\" id=\"acu-fav-import\" title=\"\"><i class=\"fa-solid fa-file-import\"></i></button>\n          <button class=\"acu-view-btn\" id=\"acu-fav-export\" title=\"\"><i class=\"fa-solid fa-file-export\"></i></button>\n          <div class=\"acu-search-wrapper\"><i class=\"fa-solid fa-search acu-search-icon\"></i><input type=\"text\" class=\"acu-search-input\" id=\"acu-fav-search\" placeholder=\"...\" /></div>\n          <div class=\"acu-height-control\"><i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\"></i></div>\n          <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n        </div>\n      </div>\n      <div class=\"acu-fav-panel-content\">\n        <div class=\"acu-fav-tag-filter-collapsible collapsed\">\n          <div class=\"acu-fav-tag-filter-header\">\n            <span></span>\n            <i class=\"fa-solid fa-chevron-down acu-fav-tag-toggle-icon\"></i>\n          </div>\n          <div class=\"acu-fav-tag-filter-body\">\n            ${untagged.length > 0 ? '<button class=\"acu-fav-tag-btn active\" data-tag=\"__untagged__\"></button>' : ''}\n            ${allTags.map(tag => `<button class=\"acu-fav-tag-btn active\" data-tag=\"${escapeHtml(tag)}\">${escapeHtml(tag)}</button>`).join('')}\n          </div>\n        </div>\n        ${contentHtml}\n      </div>\n      </div>\n    `;\n  };\n\n  // ========== []  ==========\n  const bindFavoritesEvents = ($panel: JQuery) => {\n    const { $ } = getCore();\n    const rawData = cachedRawData || getTableData();\n    const currentTables = rawData || {};\n\n    // \n    $panel.off('.favEvents');\n\n    // === []  ST  swipe regenerate ===\n    (function () {\n      const panelEl = $panel[0];\n      if (!panelEl) return;\n\n      // \n      if ((panelEl as any)._favSwipeFixApplied) return;\n      (panelEl as any)._favSwipeFixApplied = true;\n\n      let touchStartX = 0;\n      let touchStartY = 0;\n      let isHorizontalSwipe = false;\n\n      const onTouchStart = (e: TouchEvent) => {\n        if (e.touches.length === 1) {\n          touchStartX = e.touches[0].clientX;\n          touchStartY = e.touches[0].clientY;\n          isHorizontalSwipe = false;\n        }\n      };\n\n      const onTouchMove = (e: TouchEvent) => {\n        if (e.touches.length !== 1) return;\n\n        const touch = e.touches[0];\n        const deltaX = Math.abs(touch.clientX - touchStartX);\n        const deltaY = Math.abs(touch.clientY - touchStartY);\n\n        // deltaY\n        const isHorizontal = deltaY < 5 ? deltaX > 5 && deltaX > deltaY * 2 : deltaX > deltaY * 1.5 && deltaX > 10;\n\n        if (isHorizontal) {\n          isHorizontalSwipe = true;\n          e.stopImmediatePropagation();\n          e.stopPropagation();\n        }\n      };\n\n      const onTouchEnd = (e: TouchEvent) => {\n        if (isHorizontalSwipe) {\n          e.stopImmediatePropagation();\n          e.stopPropagation();\n          isHorizontalSwipe = false;\n        }\n        touchStartX = 0;\n        touchStartY = 0;\n      };\n\n      //  ST \n      panelEl.addEventListener('touchstart', onTouchStart, true);\n      panelEl.addEventListener('touchmove', onTouchMove, true);\n      panelEl.addEventListener('touchend', onTouchEnd, true);\n\n      // \n      $(window).on('pagehide.favSwipeFix', () => {\n        panelEl.removeEventListener('touchstart', onTouchStart, true);\n        panelEl.removeEventListener('touchmove', onTouchMove, true);\n        panelEl.removeEventListener('touchend', onTouchEnd, true);\n      });\n    })();\n\n    // \n    $panel.on('click.favEvents', '.acu-close-btn', function (e) {\n      e.stopPropagation();\n      Store.set('acu_favorites_panel_active', false);\n      // [] \n      $panel.html('');\n      $('#acu-btn-favorites').removeClass('active');\n    });\n\n    // []  - \n    $panel.on('pointerdown.favEvents', '.acu-height-drag-handle', function (e) {\n      if (e.button !== 0) return;\n      e.preventDefault();\n      e.stopPropagation();\n      const handle = this;\n      handle.setPointerCapture(e.pointerId);\n      $(handle).addClass('active');\n      const $dataArea = $('#acu-data-area');\n      const startHeight = $dataArea.height() || 400;\n      const startY = e.clientY;\n      const tableName = $(handle).data('table');\n\n      handle.onpointermove = function (moveE: PointerEvent) {\n        const dy = moveE.clientY - startY;\n        let newHeight = startHeight - dy;\n        if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n        if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n        $dataArea.css('height', newHeight + 'px');\n      };\n      handle.onpointerup = function (upE: PointerEvent) {\n        $(handle).removeClass('active');\n        handle.releasePointerCapture(upE.pointerId);\n        handle.onpointermove = null;\n        handle.onpointerup = null;\n        if (tableName) {\n          const heights = getTableHeights();\n          heights[tableName] = parseInt($dataArea.css('height'));\n          saveTableHeights(heights);\n          $dataArea.addClass('acu-manual-mode');\n        }\n      };\n    });\n\n    // []  - \n    $panel.on('dblclick.favEvents', '.acu-height-drag-handle', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const tableName = $(this).data('table');\n      if (tableName) {\n        const heights = getTableHeights();\n        delete heights[tableName];\n        saveTableHeights(heights);\n        $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n      }\n    });\n\n    // /\n    $panel.on('click.favEvents', '.acu-fav-tag-filter-header', function () {\n      const $collapsible = $(this).closest('.acu-fav-tag-filter-collapsible');\n      $collapsible.toggleClass('collapsed');\n    });\n\n    // toggle\n    $panel.on('click.favEvents', '.acu-fav-tag-btn', function () {\n      const $btn = $(this);\n      const tag = $btn.data('tag') as string;\n      const isActive = $btn.hasClass('active');\n\n      // \n      $btn.toggleClass('active');\n\n      // \n      if (tag === '__untagged__') {\n        // \"\"\n        $panel.find('.acu-fav-group').each(function () {\n          const groupTitle = $(this).find('.acu-fav-group-title').text();\n          if (groupTitle.includes('')) {\n            $(this).toggle(!isActive);\n          }\n        });\n      } else {\n        // \n        $panel.find('.acu-fav-group').each(function () {\n          const groupTitle = $(this).find('.acu-fav-group-title').text();\n          if (groupTitle.includes(tag) && !groupTitle.includes('')) {\n            $(this).toggle(!isActive);\n          }\n        });\n      }\n    });\n\n    // \n    $panel.find('#acu-fav-search').on(\n      'input.favEvents',\n      _.debounce(function () {\n        const searchTerm = ($(this).val() as string).toLowerCase().trim();\n        $panel.find('.acu-fav-card').each(function () {\n          const cardText = $(this).text().toLowerCase();\n          $(this).toggle(cardText.includes(searchTerm));\n        });\n      }, 300),\n    );\n\n    // \n    const showFavCardMenu = (e: JQuery.ClickEvent, cardId: string) => {\n      $('.acu-cell-menu, .acu-menu-backdrop').remove();\n\n      const backdrop = $('<div class=\"acu-menu-backdrop\"></div>');\n      $('body').append(backdrop);\n\n      const config = getConfig();\n      const menu = $(`\n        <div class=\"acu-cell-menu acu-theme-${config.theme}\" data-fav-id=\"${escapeHtml(cardId)}\">\n          <div class=\"acu-cell-menu-item\" data-action=\"edit\"><i class=\"fa-solid fa-pen\"></i> </div>\n          <div class=\"acu-cell-menu-item\" data-action=\"copy\"><i class=\"fa-solid fa-copy\"></i> </div>\n          <div class=\"acu-cell-menu-item\" data-action=\"send\"><i class=\"fa-solid fa-paper-plane\"></i> </div>\n          <div class=\"acu-cell-menu-item\" data-action=\"delete\"><i class=\"fa-solid fa-trash\"></i> </div>\n          <div class=\"acu-cell-menu-item\" data-action=\"close\"><i class=\"fa-solid fa-times\"></i> </div>\n        </div>\n      `);\n      $('body').append(menu);\n\n      // \n      const winWidth = $(window).width() || 800;\n      const winHeight = $(window).height() || 600;\n      const mWidth = menu.outerWidth() || 150;\n      const mHeight = menu.outerHeight() || 150;\n      let posX = e.clientX || winWidth / 2;\n      let posY = e.clientY || winHeight / 2;\n      if (posX + mWidth > winWidth) posX = winWidth - mWidth - 10;\n      if (posY + mHeight > winHeight) posY = winHeight - mHeight - 10;\n      menu.css({ left: posX, top: posY });\n\n      // backdrop\n      backdrop.on('click', () => {\n        $('.acu-cell-menu, .acu-menu-backdrop').remove();\n      });\n\n      // \n      menu.on('click', '.acu-cell-menu-item', async function () {\n        const action = $(this).data('action');\n        const id = menu.data('fav-id');\n        $('.acu-cell-menu, .acu-menu-backdrop').remove();\n\n        if (action === 'close') return;\n\n        const fav = await FavoritesManager.getById(id);\n        if (!fav) return;\n\n        if (action === 'edit') {\n          showFavoriteEditModal(fav, async updated => {\n            await FavoritesManager.updateFavorite(id, updated);\n            $panel.html(await renderFavoritesPanel());\n            bindFavoritesEvents($panel);\n          });\n        } else if (action === 'copy') {\n          const copied = await FavoritesManager.duplicateFavorite(id);\n          if (copied) {\n            $panel.html(await renderFavoritesPanel());\n            bindFavoritesEvents($panel);\n          }\n        } else if (action === 'send') {\n          const compatible = FavoritesManager.findCompatibleTables(fav, currentTables);\n          if (compatible.length === 0) {\n            toastr.warning('');\n            return;\n          }\n          showSendToTableModal(fav, compatible, currentTables, async () => {\n            $panel.html(await renderFavoritesPanel());\n            bindFavoritesEvents($panel);\n          });\n        } else if (action === 'delete') {\n          await FavoritesManager.deleteFavorite(id);\n          $panel.html(await renderFavoritesPanel());\n          bindFavoritesEvents($panel);\n        }\n      });\n    };\n\n    // \n    $panel.on('click.favEvents', '.acu-fav-card', function (e) {\n      e.stopPropagation();\n      const $card = $(this);\n      const cardId = $card.data('id');\n\n      // Toggle\n      const existingMenu = $('.acu-cell-menu');\n      if (existingMenu.length && existingMenu.data('fav-id') === cardId) {\n        $('.acu-cell-menu, .acu-menu-backdrop').remove();\n        return;\n      }\n\n      showFavCardMenu(e, cardId);\n    });\n\n    // \n    $panel.on('click.favEvents', '#acu-fav-import', async function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (file) {\n          const text = await file.text();\n          const result = await FavoritesManager.importFavorites(text);\n          // [] importFavorites  { added, updated } \n          if (result && (result.added > 0 || result.updated > 0)) {\n            if (window.toastr) window.toastr.success(`: ${result.added}, ${result.updated}`);\n            $panel.html(await renderFavoritesPanel());\n            bindFavoritesEvents($panel);\n          } else {\n            if (window.toastr) window.toastr.warning('');\n          }\n        }\n      };\n      input.click();\n    });\n\n    // \n    $panel.on('click.favEvents', '#acu-fav-export', async function () {\n      const json = await FavoritesManager.exportFavorites();\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `favorites_${new Date().toISOString().slice(0, 10)}.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n      if (window.toastr) window.toastr.success('');\n    });\n\n    console.log('[DICE] bindFavoritesEvents initialized');\n  };\n\n  const renderTableContent = (tableData, tableName) => {\n    if (!tableData || !tableData.rows.length)\n      return `\n            <div class=\"acu-panel-header\"><div class=\"acu-panel-title\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${tableName}</div><button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button></div>\n            <div class=\"acu-panel-content\"><div style=\"text-align:center;color:var(--acu-text-sub);padding:20px;\"></div></div>`;\n\n    const config = getConfig();\n    const headers = (tableData.headers || []).slice(1);\n\n    // [] -API\n    const dbLockApi = getDbLockAPI();\n    const sheetKey = dbLockApi ? getSheetKeyByTableName(tableName) : null;\n    const lockState = dbLockApi && sheetKey ? dbLockApi.getTableLockState(sheetKey) : null;\n\n    //  ( list)\n    const currentStyle = (getTableStyles() || {})[tableName] || 'list';\n    const isGridMode = currentStyle === 'grid';\n\n    let titleColIndex = 1;\n    if (tableData.headers.length === 1) {\n      titleColIndex = 0;\n    } else if (tableName.includes('') || tableName.includes('')) {\n      const idx = tableData.headers.findIndex(\n        h => h && (h.includes('') || h.includes('') || h.includes('')),\n      );\n      if (idx > 0) titleColIndex = idx;\n    }\n\n    // ---  ---\n    let processedRows = tableData.rows.map((row, index) => {\n      const rowKey = getRowKey(tableName, row, tableData.headers);\n      const isBookmarked = rowKey && BookmarkManager.isBookmarked(tableName, rowKey);\n      return { data: row, originalIndex: index, rowKey, isBookmarked };\n    });\n    const searchTerm = (tableSearchStates[tableName] || '').toLowerCase().trim();\n\n    // \n    const isReversed = isTableReversed(tableName);\n\n    if (searchTerm) {\n      processedRows = processedRows.filter(item =>\n        item.data.some(cell => String(cell).toLowerCase().includes(searchTerm)),\n      );\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        const titleA = String(a.data[titleColIndex] || '').toLowerCase();\n        const titleB = String(b.data[titleColIndex] || '').toLowerCase();\n        const aHitTitle = titleA.includes(searchTerm);\n        const bHitTitle = titleB.includes(searchTerm);\n        if (titleA === searchTerm && titleB !== searchTerm) return -1;\n        if (titleA !== searchTerm && titleB === searchTerm) return 1;\n        if (aHitTitle && !bHitTitle) return -1;\n        if (!aHitTitle && bHitTitle) return 1;\n        return a.originalIndex - b.originalIndex;\n      });\n    } else {\n      // \n      // bookmark\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        if (isReversed) {\n          return b.originalIndex - a.originalIndex;\n        } else {\n          return a.originalIndex - b.originalIndex;\n        }\n      });\n    }\n\n    const itemsPerPage = config.itemsPerPage || 50;\n    const totalItems = processedRows.length;\n    const totalPages = Math.ceil(totalItems / itemsPerPage) || 1;\n    let currentPage = tablePageStates[tableName] || 1;\n    if (currentPage > totalPages) currentPage = totalPages;\n    if (currentPage < 1) currentPage = 1;\n    tablePageStates[tableName] = currentPage;\n\n    const startIdx = (currentPage - 1) * itemsPerPage;\n    const endIdx = startIdx + itemsPerPage;\n    const rowsToRender = processedRows.slice(startIdx, endIdx);\n    // []    \n    // \n    const showReverseBtn = shouldShowReverseButton(tableName);\n    const reverseBtnHtml = showReverseBtn\n      ? `\n            <button class=\"acu-view-btn acu-reverse-btn\" data-table=\"${escapeHtml(tableName)}\" title=\"${isReversed ? '' : ''}\">\n                <i class=\"fa-solid ${isReversed ? 'fa-sort-amount-up' : 'fa-sort-amount-down'}\"></i>\n            </button>\n        `\n      : '';\n\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n    <div class=\"acu-title-main\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> <span class=\"acu-title-text\">${escapeHtml(tableName)}</span></div>\n    <div class=\"acu-title-sub\">(${startIdx + 1}-${Math.min(endIdx, totalItems)} / ${totalItems})${isReversed ? ' <span style=\"color:var(--acu-accent);\"></span>' : ''}</div>\n</div>\n                <div class=\"acu-header-actions\">\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn\" id=\"acu-btn-relation-graph\" data-table=\"${escapeHtml(tableName)}\" title=\"\"><i class=\"fa-solid fa-project-diagram\"></i></button>` : ''}\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn acu-table-map-btn\" title=\"\"><i class=\"fa-solid fa-map\"></i></button>` : ''}\n                    ${reverseBtnHtml}\n                    <button class=\"acu-view-btn\" id=\"acu-btn-switch-style\" data-table=\"${escapeHtml(tableName)}\" title=\"  (: ${isGridMode ? '' : ''})\">\n                        <i class=\"fa-solid ${isGridMode ? 'fa-th-large' : 'fa-list'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${escapeHtml(tableName)}\" title=\"  | \"></i>\n                    </div>\n\n                    <div class=\"acu-search-wrapper\"><i class=\"fa-solid fa-search acu-search-icon\"></i><input type=\"text\" class=\"acu-search-input\" placeholder=\"...\" value=\"${(tableSearchStates[tableName] || '').replace(/\"/g, '&quot;')}\" /></div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>\n            <div class=\"acu-panel-content\"><div class=\"acu-card-grid\">`;\n\n    html += rowsToRender\n      .map(item => {\n        const realRowIdx = item.originalIndex;\n        const row = item.data;\n        const cardTitle = row[titleColIndex] || '';\n        const showDefaultIndex = titleColIndex === 1;\n        const titleCellId = `${tableData.key}-${realRowIdx}-${titleColIndex}`;\n        const isTitleModified = window.acuModifiedSet && window.acuModifiedSet.has(titleCellId);\n        const isRowNew = currentDiffMap.has(`${tableName}-row-${realRowIdx}`);\n        let rowClass = '';\n        if (config.highlightNew) {\n          if (isTitleModified) rowClass = 'acu-highlight-manual';\n          else if (isRowNew) rowClass = 'acu-highlight-diff';\n        }\n\n        // [] \n        const cardLockRowKey = getRowKey(tableName, row, tableData.headers);\n        const cardRowIndex =\n          sheetKey && cardLockRowKey ? findRowIndexByPrimaryKey(sheetKey, tableName, cardLockRowKey) : null;\n        const isCardRowLocked = lockState && cardRowIndex !== null ? lockState.rows.includes(cardRowIndex) : false;\n\n        // [] \n        // titleColIndex - colIndex  -1\n        const isTitleCellLocked =\n          lockState && cardRowIndex !== null ? lockState.cells.includes(`${cardRowIndex}:${titleColIndex - 1}`) : false;\n\n        // \n        const validColIndices = row.map((_, i) => i).filter(i => i > 0 && i !== titleColIndex);\n        const isOddValidCount = validColIndices.length % 2 === 1;\n\n        const cardBody = row\n          .map((cell, cIdx) => {\n            if (cIdx <= 0 || cIdx === titleColIndex) return '';\n            // [] \"\"\n            const currentHeader = headers[cIdx - 1] || '';\n            if (currentHeader.includes('')) return '';\n            const isLastValidCol = cIdx === validColIndices[validColIndices.length - 1];\n            const spanFullRow = isLastValidCol && isOddValidCount;\n            // /\n            const rawHeaderName = headers[cIdx - 1] || '' + cIdx;\n\n            // [] cardRowIndex\n            // [] cIdx - colIndex  -1\n            const isThisCellLocked =\n              lockState && cardRowIndex !== null ? lockState.cells.includes(`${cardRowIndex}:${cIdx - 1}`) : false;\n            // [] \n            const isThisFieldLocked = isCardRowLocked || isThisCellLocked;\n\n            const headerName = rawHeaderName.replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n            const safeStr = str =>\n              String(str)\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#039;');\n            const rawStrOriginal = String(cell).trim();\n            const rawStr = replaceUserPlaceholders(rawStrOriginal);\n            const invalidPlaceholders = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n            if (invalidPlaceholders.includes(rawStr.toLowerCase())) {\n              return ''; // \n            }\n\n            let contentHtml = '';\n            let hideLabel = false; // \n            const splitRegex = /[;]/;\n\n            // [] \n            const isIdentityField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return lowerHeader.includes('');\n            };\n\n            const isAttributeField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return (\n                lowerHeader.includes('') || lowerHeader.includes('') || lowerHeader.includes('')\n              );\n            };\n\n            //  ( \":92\"  \":92, :88\")\n            // [] \n            const parsedAttrs = isIdentityField(rawHeaderName) ? [] : parseAttributeString(rawStr);\n            // [] \n            if (isIdentityField(rawHeaderName)) {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            } else if (isRelationshipCell(rawStr, headerName)) {\n              // [] \n              const relations = parseRelationshipString(rawStr);\n              // [] \n              const validRelations = relations.filter(rel => {\n                if (!rel.relation) return true; // \n                return !invalidPlaceholders.includes(rel.relation.toLowerCase());\n              });\n\n              if (validRelations.length > 1) {\n                hideLabel = true;\n                let relHtml = '';\n                for (let i = 0; i < validRelations.length; i++) {\n                  const rel = validRelations[i];\n                  const borderStyle =\n                    i < validRelations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                  relHtml += '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;' + borderStyle + '\">';\n                  relHtml +=\n                    '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\" data-locked=\"' +\n                    isThisFieldLocked +\n                    '\">' +\n                    safeStr(rel.name) +\n                    '</span>';\n                  if (rel.relation) {\n                    relHtml +=\n                      '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                      safeStr(rel.relation) +\n                      '</span>';\n                  }\n                  relHtml += '</div>';\n                }\n                contentHtml = '<div class=\"acu-relation-container\">' + relHtml + '</div>';\n              } else if (validRelations.length === 1) {\n                hideLabel = true;\n                const rel = validRelations[0];\n                contentHtml = '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;\">';\n                contentHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\" data-locked=\"' +\n                  isThisFieldLocked +\n                  '\">' +\n                  safeStr(rel.name) +\n                  '</span>';\n                if (rel.relation) {\n                  contentHtml +=\n                    '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                    safeStr(rel.relation) +\n                    '</span>';\n                }\n                contentHtml += '</div>';\n              }\n            } else if (parsedAttrs.length > 1) {\n              // 2\n              hideLabel = true;\n              let attrsHtml = '';\n              for (let i = 0; i < parsedAttrs.length; i++) {\n                const attr = parsedAttrs[i];\n                const showDice = !BlacklistManager.isBlacklisted(attr.name);\n                attrsHtml +=\n                  '<div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 0;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.9em;white-space:nowrap;\" data-locked=\"' +\n                  isThisFieldLocked +\n                  '\" title=\"' +\n                  safeStr(attr.name) +\n                  '\">' +\n                  safeStr(attr.name.length > 3 ? attr.name.substring(0, 5) : attr.name) +\n                  '</span>';\n                attrsHtml += '<div style=\"display:flex;align-items:center;gap:4px;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-main);font-weight:bold;font-size:0.95em;\">' +\n                  attr.value +\n                  '</span>';\n                if (showDice) {\n                  attrsHtml +=\n                    '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                    safeStr(attr.name) +\n                    '\" data-attr-value=\"' +\n                    attr.value +\n                    '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:10px;\" title=\"\"></i>';\n                }\n                attrsHtml += '</div></div>';\n              }\n              contentHtml = '<div class=\"acu-multi-attr-container\">' + attrsHtml + '</div>';\n            } else if (parsedAttrs.length === 1) {\n              //  ( \":92\") - \n              hideLabel = true;\n              const attr = parsedAttrs[0];\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml +=\n                '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\" data-locked=\"' +\n                isThisFieldLocked +\n                '\">' +\n                safeStr(attr.name) +\n                '</span>';\n              contentHtml += '<div style=\"display:flex;align-items:center;gap:6px;\">';\n              contentHtml += '<span style=\"color:var(--acu-text-main);font-weight:bold;\">' + attr.value + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(attr.name) +\n                  '\" data-attr-value=\"' +\n                  attr.value +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div></div>';\n            } else if (rawStr.length > 0 && splitRegex.test(rawStr) && !rawStr.includes('http')) {\n              // [] \n              const invalidTagValues = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n              const parts = rawStr\n                .split(splitRegex)\n                .map(s => s.trim())\n                .filter(s => s && !invalidTagValues.includes(s.toLowerCase()));\n              const allShort = parts.length > 1 && parts.every(p => p.length <= 6);\n              if (allShort) {\n                const tagsHtml = parts\n                  .map(part => {\n                    const subStyle = getBadgeStyle(part) || 'acu-badge-neutral';\n                    return '<span class=\"acu-badge ' + subStyle + '\">' + safeStr(part) + '</span>';\n                  })\n                  .join('');\n                contentHtml = '<div class=\"acu-tag-container\">' + tagsHtml + '</div>';\n              } else if (parts.length > 0) {\n                // \n                contentHtml = safeStr(parts.join('; '));\n              } else {\n                // \n                contentHtml = '';\n              }\n            } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n              // \n              const numVal = extractNumericValue(rawStr);\n              const showDice = !BlacklistManager.isBlacklisted(headerName);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml += '<span>' + safeStr(rawStr) + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(headerName) +\n                  '\" data-attr-value=\"' +\n                  numVal +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div>';\n            } else {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            }\n\n            const isDiffChanged = currentDiffMap.has(tableName + '-' + realRowIdx + '-' + cIdx);\n            const cellId = tableData.key + '-' + realRowIdx + '-' + cIdx;\n            const isUserModified = window.acuModifiedSet && window.acuModifiedSet.has(cellId);\n            let cellHighlight = '';\n            if (config.highlightNew) {\n              if (isUserModified) cellHighlight = 'acu-highlight-manual';\n              else if (isDiffChanged) cellHighlight = 'acu-highlight-diff';\n            }\n\n            //  class\n            //  ()\n\n            const rowClass =\n              'acu-card-row acu-cell' +\n              (spanFullRow ? ' acu-grid-span-full' : '') +\n              (hideLabel ? ' acu-hide-label' : '');\n\n            return (\n              '<div class=\"' +\n              rowClass +\n              '\" data-key=\"' +\n              escapeHtml(tableData.key) +\n              '\" data-tname=\"' +\n              escapeHtml(tableName) +\n              '\" data-row=\"' +\n              realRowIdx +\n              '\" data-col=\"' +\n              cIdx +\n              '\" data-val=\"' +\n              encodeURIComponent(cell ?? '') +\n              '\"><div class=\"acu-card-label\"><span data-locked=\"' +\n              isThisFieldLocked +\n              '\">' +\n              headerName +\n              '</span></div><div class=\"acu-card-value ' +\n              cellHighlight +\n              '\">' +\n              contentHtml +\n              '</div></div>'\n            );\n          })\n          .join('');\n\n        // []  acu-card-body  view-grid  view-list \n        // []  tableData.headers  slice  headers getInteractOptionsForRow \n        const tableActions = getInteractOptionsForRow(tableName, tableData.headers, row);\n        let actionsHtml = '';\n\n        if (tableActions.length > 0) {\n          const cardTitle = row[titleColIndex] || '';\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // [] \n        const isTitleLocked = isCardRowLocked || isTitleCellLocked;\n\n        // [] \n        // const cardLockedClass = isCardRowLocked ? ' acu-card-locked' : '';\n\n        // bookmark\n        const cardBookmarkRowKey = getRowKey(tableName, row, tableData.headers);\n        const isBookmarked = cardBookmarkRowKey && BookmarkManager.isBookmarked(tableName, cardBookmarkRowKey);\n        const bookmarkIcon = cardBookmarkRowKey\n          ? `<i class=\"${isBookmarked ? 'fa-solid' : 'fa-regular'} fa-bookmark acu-bookmark-icon ${isBookmarked ? 'bookmarked' : ''}\" data-table=\"${escapeHtml(tableName)}\" data-row-key=\"${escapeHtml(cardBookmarkRowKey)}\" title=\"${isBookmarked ? '' : ''}\"></i>`\n          : '';\n\n        // [] \n        // const rowLockBadge = isCardRowLocked ? '...' : '';\n\n        return `<div class=\"acu-data-card\"><div class=\"acu-card-header\"><span class=\"acu-card-index\">${showDefaultIndex ? '#' + (realRowIdx + 1) : ''}</span><span class=\"acu-cell acu-editable-title ${rowClass}\" data-key=\"${escapeHtml(tableData.key)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(cardTitle ?? '')}\" data-locked=\"${isTitleLocked}\" title=\"\">${escapeHtml(cardTitle)}</span>${bookmarkIcon}</div><div class=\"acu-card-body ${isGridMode ? 'view-grid' : 'view-list'}\">${cardBody}</div>${actionsHtml}</div>`;\n      })\n      .join('');\n    html += `</div></div>`;\n\n    if (totalPages > 1) {\n      html += `<div class=\"acu-panel-footer\"><button class=\"acu-page-btn ${currentPage === 1 ? 'disabled' : ''}\" data-page=\"${currentPage - 1}\" ${currentPage === 1 ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-left\"></i></button>`;\n      const range = [];\n      if (totalPages <= 7) {\n        for (let i = 1; i <= totalPages; i++) range.push(i);\n      } else {\n        if (currentPage <= 4) range.push(1, 2, 3, 4, 5, '...', totalPages);\n        else if (currentPage >= totalPages - 3)\n          range.push(1, '...', totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1, totalPages);\n        else range.push(1, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages);\n      }\n      range.forEach(p => {\n        if (p === '...') html += `<span class=\"acu-page-info\">...</span>`;\n        else html += `<button class=\"acu-page-btn ${p === currentPage ? 'active' : ''}\" data-page=\"${p}\">${p}</button>`;\n      });\n      html += `<button class=\"acu-page-btn ${currentPage === totalPages ? 'disabled' : ''}\" data-page=\"${currentPage + 1}\" ${currentPage === totalPages ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-right\"></i></button></div>`;\n    }\n    return html;\n  };\n\n  // []  ( + )\n  const saveCurrentTabState = () => {\n    const { $ } = getCore();\n    const activeTab = getActiveTabState();\n    const $content = $('.acu-panel-content');\n\n    if (activeTab && $content.length) {\n      const innerScrolls = {};\n      // \n      $content.find('.acu-data-card, .acu-card-body, .acu-edit-textarea').each(function () {\n        if (this.scrollTop > 0) {\n          //  (Row Index)\n          const $card = $(this).closest('.acu-data-card');\n          const rIdx = $card.find('.acu-editable-title').data('row');\n          // \n          const isEdit = $(this).hasClass('acu-edit-textarea');\n\n          if (rIdx !== undefined) {\n            const key = isEdit ? `edit-${rIdx}` : rIdx;\n            innerScrolls[key] = this.scrollTop;\n          }\n        }\n      });\n\n      // \n      tableScrollStates[activeTab] = {\n        left: $content.scrollLeft(),\n        top: $content.scrollTop(),\n        inner: innerScrolls,\n        timestamp: Date.now(), // \n      };\n    }\n  };\n\n  const closePanel = () => {\n    const { $ } = getCore();\n    saveCurrentTabState(); // <--- \n\n    $('#acu-data-area').removeClass('visible');\n    $('.acu-nav-btn').removeClass('active');\n    saveActiveTabState(null);\n    // [] \n    // $('.acu-embedded-options-container').remove();\n  };\n\n  /**\n   *  - \n   * CSS opacity + visibility \n   * @param {Function} updateContentFn -  $panel \n   */\n  const switchPanel = updateContentFn => {\n    const { $ } = getCore();\n    const $panel = $('#acu-data-area');\n    const isVisible = $panel.hasClass('visible');\n\n    if (!isVisible) {\n      // \n      updateContentFn($panel);\n      $panel.addClass('visible');\n    } else {\n      // CSS transition \n      updateContentFn($panel);\n    }\n  };\n\n  const bindEvents = tables => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    // [] -\n    $wrapper.on('click', '.acu-dash-relation-graph-btn', function (e) {\n      e.stopPropagation();\n      const allTables = processJsonData(cachedRawData || getTableData());\n      const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n      if (npcResult && npcResult.data) {\n        showRelationshipGraph(npcResult.data);\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-map-btn', function (e) {\n      e.stopPropagation();\n      showMapVisualization();\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-avatar-manager-btn', function (e) {\n      e.stopPropagation();\n\n      try {\n        // \n        let allTables;\n        try {\n          const rawData = cachedRawData || getTableData();\n          allTables = processJsonData(rawData);\n        } catch (dataError) {\n          console.error(':', dataError);\n          throw new Error('');\n        }\n\n        if (!allTables || allTables.length === 0) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n        const playerResult = DashboardDataParser.findTable(allTables, 'player');\n\n        const nodeArr = [];\n\n        // \n        if (playerResult?.data?.rows?.[0]) {\n          const playerName = playerResult.data.rows[0][1];\n          if (playerName && typeof playerName === 'string' && playerName.trim()) {\n            nodeArr.push({ name: playerName.trim(), isPlayer: true });\n          }\n        }\n\n        // NPC\n        if (npcResult?.data?.rows && Array.isArray(npcResult.data.rows)) {\n          npcResult.data.rows.forEach((row, idx) => {\n            if (Array.isArray(row) && row[1]) {\n              const npcName = row[1];\n              if (typeof npcName === 'string' && npcName.trim()) {\n                nodeArr.push({ name: npcName.trim(), isPlayer: false, rowIndex: idx });\n              }\n            }\n          });\n        }\n\n        // \n        if (nodeArr.length === 0) {\n          if (window.toastr) {\n            window.toastr.warning('NPC');\n          }\n          return;\n        }\n\n        // \n        try {\n          showAvatarManager(nodeArr, () => renderInterface());\n        } catch (managerError) {\n          console.error('showAvatarManager :', managerError);\n          throw new Error('');\n        }\n      } catch (error) {\n        // \n        console.error(':', error);\n\n        // \n        const errorMsg = error instanceof Error ? error.message : '';\n        if (window.toastr) {\n          window.toastr.error(`: ${errorMsg}`);\n        }\n      }\n    });\n    // \n    $wrapper.off('click.acu_dash_table_link').on('click.acu_dash_table_link', '.acu-dash-table-link', function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      const tableName = $(this).data('table');\n      if (tableName) {\n        // \n        Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        Store.set('acu_changes_panel_active', false); // \n        // [] \n        $('.acu-nav-btn').removeClass('active');\n        $(`.acu-nav-btn[data-table=\"${tableName}\"]`).addClass('active');\n        saveActiveTabState(tableName);\n        setTimeout(() => renderInterface(), 0);\n      }\n    });\n\n    // []  SillyTavern\"\"\n    $('.acu-panel-content')\n      .off('touchstart.acu_swipe touchmove.acu_swipe')\n      .on('touchstart.acu_swipe', function (e) {\n        this._touchStartX = e.originalEvent.touches[0].clientX;\n        this._touchStartY = e.originalEvent.touches[0].clientY;\n      })\n      .on('touchmove.acu_swipe', function (e) {\n        if (!this._touchStartX) return;\n        const deltaX = Math.abs(e.originalEvent.touches[0].clientX - this._touchStartX);\n        const deltaY = Math.abs(e.originalEvent.touches[0].clientY - this._touchStartY);\n        // 45\n        if (deltaX > deltaY && deltaX > 10) {\n          e.stopPropagation();\n        }\n      });\n\n    $('body')\n      .off('click.acu_nav_toggle')\n      .on('click.acu_nav_toggle', '.acu-nav-toggle-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        const currentState = getCollapsedState();\n        saveCollapsedState(!currentState);\n        renderInterface();\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_opt_toggle')\n      .on('click.acu_opt_toggle', '.acu-opt-header[data-action=\"toggle-options\"]', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const currentState = getOptionsCollapsedState();\n        saveOptionsCollapsedState(!currentState);\n        renderInterface();\n      });\n\n    const $panel = $('.acu-panel-content');\n    if ($panel.length) {\n      // [] \n      let scrollTimer = null;\n      $panel.off('scroll.acu_save').on('scroll.acu_save', function () {\n        const $this = $(this);\n        if (scrollTimer) clearTimeout(scrollTimer);\n        scrollTimer = setTimeout(() => {\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            if (!tableScrollStates[activeTab]) tableScrollStates[activeTab] = { top: 0, left: 0, inner: {} };\n            tableScrollStates[activeTab].top = $this.scrollTop();\n            tableScrollStates[activeTab].left = $this.scrollLeft();\n            // \n          }\n        }, 200);\n      });\n    }\n\n    $('body')\n      .off('click.acu_delegate')\n      .on('click.acu_delegate', '.acu-wrapper', function (e) {\n        if (isEditingOrder) return;\n        const $target = $(e.target);\n\n        // []  - \n        const $settingsBtn = $target.closest('#acu-btn-settings');\n        if ($settingsBtn.length) {\n          e.stopPropagation();\n          e.preventDefault();\n          showSettingsModal();\n          return;\n        }\n\n        const $navBtn = $target.closest('.acu-nav-btn');\n        if ($navBtn.length) {\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-dashboard') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isDashboardActive && isPanelVisible) {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, true);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                const rawData = cachedRawData || getTableData();\n                const tables = processJsonData(rawData || {});\n                $panel.html(renderDashboard(tables));\n                bindEvents(tables);\n              });\n            }\n            return false;\n          }\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-changes') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isChangesActive = Store.get('acu_changes_panel_active', false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isChangesActive && isPanelVisible) {\n              // \n              Store.set('acu_changes_panel_active', false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              clearAllPanelStates(); // [] \n              Store.set('acu_changes_panel_active', true);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                const rawData = cachedRawData || getTableData();\n                $panel.html(renderChangesPanel(rawData));\n                bindChangesEvents();\n              });\n            }\n            return false;\n          }\n          // []  - \n          if ($navBtn.attr('id') === 'acu-btn-favorites') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isFavoritesActive = Store.get('acu_favorites_panel_active', false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isFavoritesActive && isPanelVisible) {\n              // \n              Store.set('acu_favorites_panel_active', false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              clearAllPanelStates(); // [] \n              Store.set('acu_favorites_panel_active', true);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel(async $panel => {\n                $panel.html(await renderFavoritesPanel());\n                bindFavoritesEvents($panel);\n              });\n            }\n            return false;\n          }\n          // [] MVU\n          if ($navBtn.attr('id') === 'acu-btn-mvu') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isMvuActive && isPanelVisible) {\n              // \n              saveActiveTabState(null);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              clearAllPanelStates(); // [] \n              saveActiveTabState(MvuModule.MODULE_ID);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                try {\n                  const panelHtml = MvuModule.renderPanel();\n                  // \n                  const mvuSavedHeight = getTableHeights()[MvuModule.MODULE_ID];\n                  if (mvuSavedHeight) {\n                    $panel.css('height', mvuSavedHeight + 'px').addClass('acu-manual-mode');\n                  } else {\n                    $panel.css('height', '').removeClass('acu-manual-mode');\n                  }\n                  $panel.html('<div class=\"acu-mvu-panel\">' + panelHtml + '</div>');\n                  MvuModule.bindEvents($panel);\n                } catch (error) {\n                  console.error('[MVU] Error rendering panel:', error);\n                }\n\n                // \n                MvuModule.getDataWithRetry(5, 800)\n                  .then(mvuData => {\n                    // \n                    if (mvuData && canWriteMvuPanel()) {\n                      $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                      MvuModule.bindEvents($panel);\n                    }\n                  })\n                  .catch(err => {\n                    console.error('[DICE]MvuModule Error getting data:', err);\n                    if (canWriteMvuPanel()) {\n                      // \n                      $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                      MvuModule.bindEvents($panel);\n                    }\n                  });\n              });\n            }\n            return false;\n          }\n          e.stopPropagation();\n          const tableName = $navBtn.data('table');\n          const currentActiveTab = getActiveTabState();\n          if (currentActiveTab === tableName && $('#acu-data-area').hasClass('visible')) {\n            closePanel();\n            return;\n          }\n          // [] \n          clearAllPanelStates();\n          $('.acu-nav-btn').removeClass('active');\n          $navBtn.addClass('active');\n          if ($('.acu-panel-content').length && currentActiveTab) {\n            saveCurrentTabState();\n          }\n          saveActiveTabState(tableName);\n          setTimeout(() => renderInterface(), 0);\n          return;\n        }\n        const $cell = $target.closest('.acu-cell');\n        if ($cell.length) {\n          e.stopPropagation();\n          showCellMenu(e, $cell[0]);\n          return;\n        }\n        const $pageBtn = $target.closest('.acu-page-btn');\n        if ($pageBtn.length) {\n          e.stopPropagation();\n          if ($pageBtn.hasClass('disabled') || $pageBtn.hasClass('active')) return;\n          const newPage = parseInt($pageBtn.data('page'));\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tablePageStates[activeTab] = newPage;\n            renderInterface();\n            requestAnimationFrame(() => {\n              $('.acu-panel-content').scrollTop(0);\n            });\n          }\n          return;\n        }\n        return;\n      });\n\n    $('#acu-btn-expand')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(false);\n        renderInterface();\n      });\n    // [] \n    $('#acu-btn-collapse')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(true);\n        renderInterface();\n      });\n\n    // \n    $('#acu-btn-open-visualizer')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n\n        // -\n        const topWin = window.parent || window;\n        if (topWin.AutoCardUpdaterAPI && typeof topWin.AutoCardUpdaterAPI.openVisualizer === 'function') {\n          topWin.AutoCardUpdaterAPI.openVisualizer();\n        } else {\n          // \n          if (typeof (topWin as any).openNewVisualizer_ACU === 'function') {\n            (topWin as any).openNewVisualizer_ACU();\n          } else {\n            if (window.toastr) {\n              window.toastr.warning('-');\n            }\n          }\n        }\n      });\n\n    // [] \n    $('#acu-btn-force-update')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          if (window.toastr) {\n            window.toastr.warning('  manualUpdate ', '', {\n              timeOut: 5000,\n            });\n          }\n        }\n      });\n    $('body')\n      .off('click.acu_settings')\n      .on('click.acu_settings', '#acu-btn-settings', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        showSettingsModal();\n      });\n    // [] \n    $('#acu-btn-dice-nav')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        showDicePanel({\n          targetValue: null,\n          targetName: '',\n          //  diceType\n        });\n      });\n\n    // -\n    $('#acu-btn-open-editor')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.openSettings === 'function') {\n          api.openSettings(); // /\n        } else if (window.toastr) {\n          window.toastr.warning('()');\n        }\n      });\n\n    // \n    $('#acu-btn-refill')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            console.log('[DICE]ACU ');\n            //  manualUpdate \n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          console.warn('[DICE]ACU manualUpdate API ');\n          if (window.toastr) {\n            window.toastr.warning(' manualUpdate ', '', { timeOut: 3000 });\n          }\n        }\n      });\n    $('#acu-btn-save-global')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        let dataToSave = null;\n        if (hasUnsavedChanges && cachedRawData) {\n          dataToSave = cachedRawData;\n        } else {\n          dataToSave = getTableData();\n        }\n\n        if (dataToSave) {\n          // 1.  false  true\n          await saveDataToDatabase(dataToSave, true, true);\n\n          // 2. \n          // \n          $('.acu-highlight-manual').removeClass('acu-highlight-manual');\n\n          // 3. \n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          hasUnsavedChanges = false;\n\n          // 4. \n          const $btn = $(this);\n          const $icon = $btn.find('i');\n          $icon.removeClass('acu-icon-breathe fa-spinner fa-spin').addClass('fa-save');\n          $btn.attr('title', '').css('color', '');\n          $btn.prop('disabled', false);\n\n          // 5. \n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    const $searchInput = $('.acu-search-input');\n    if ($searchInput.length) {\n      let searchTimeout;\n      let isComposing = false;\n      $searchInput\n        .off('compositionstart compositionend input')\n        .on('compositionstart', () => {\n          isComposing = true;\n        })\n        .on('compositionend', function () {\n          isComposing = false;\n          const val = $(this).val();\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tableSearchStates[activeTab] = val;\n            tablePageStates[activeTab] = 1;\n            renderInterface();\n            setTimeout(() => {\n              $('.acu-search-input').focus();\n            }, 0);\n          }\n        })\n        .on('input', function () {\n          if (isComposing) return;\n          const val = $(this).val();\n          const selectionStart = this.selectionStart;\n          const selectionEnd = this.selectionEnd;\n          clearTimeout(searchTimeout);\n          searchTimeout = setTimeout(() => {\n            const activeTab = getActiveTabState();\n            if (activeTab) {\n              tableSearchStates[activeTab] = val;\n              tablePageStates[activeTab] = 1;\n              const isFocus = document.activeElement && document.activeElement.classList.contains('acu-search-input');\n              renderInterface();\n              if (isFocus) {\n                const $newInput = $('.acu-search-input');\n                $newInput.focus();\n                if ($newInput.length && $newInput[0].setSelectionRange) {\n                  try {\n                    $newInput[0].setSelectionRange(selectionStart, selectionEnd);\n                  } catch (e) {}\n                }\n              }\n            }\n          }, 300);\n        });\n    }\n    // \n    $('#acu-btn-relation-graph')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const rawData = cachedRawData || getTableData();\n        if (rawData) {\n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (sheet?.name === tableName) {\n              const tableData = {\n                headers: sheet.content?.[0] || [],\n                rows: sheet.content?.slice(1) || [],\n                key: key,\n              };\n              showRelationshipGraph(tableData);\n              return;\n            }\n          }\n        }\n        if (window.toastr) window.toastr.warning('');\n      });\n    // \n    $('.acu-table-map-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        showMapVisualization();\n      });\n    // --- []  ---\n\n    // 1. \n    $('#acu-btn-switch-style')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const styles = getTableStyles();\n        const current = styles[tableName] || 'list';\n        styles[tableName] = current === 'grid' ? 'list' : 'grid'; // \n        saveTableStyles(styles);\n        renderInterface(); // \n      });\n\n    // 2. \n    $('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          if (tableName) {\n            const heights = getTableHeights();\n            heights[tableName] = parseInt($panel.css('height'));\n            saveTableHeights(heights);\n            $panel.addClass('acu-manual-mode');\n          }\n        };\n      });\n\n    // 3.  - \n    $('.acu-height-drag-handle')\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    // [] \n    $wrapper.on('click', '.acu-reverse-btn', function (e) {\n      e.stopPropagation();\n      const tName = $(this).data('table');\n      if (!tName) return;\n\n      toggleTableReverse(tName);\n\n      // \n      renderInterface();\n    });\n    // [] \n    $('.acu-panel-header')\n      .off('dblclick.acu')\n      .on('dblclick.acu', function (e) {\n        if ($(e.target).closest('.acu-search-input, .acu-close-btn, .acu-view-btn').length) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = getActiveTabState();\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    $wrapper\n      .find('.acu-close-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $input = $('.acu-search-input');\n\n        // \n        if ($input.length && $input.val()) {\n          $input.val('').trigger('input').focus();\n          return;\n        }\n\n        // \n        const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        if (isDashboardActive) {\n          // \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n        if (isMvuActive) {\n          // \n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        closePanel();\n      });\n    // [] bookmark\n    $('body')\n      .off('click.acu_bookmark')\n      .on('click.acu_bookmark', '.acu-bookmark-icon', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $icon = $(this);\n        const tableName = $icon.data('table');\n        const rowKey = $icon.data('row-key');\n\n        if (!tableName || !rowKey) return;\n\n        // bookmark\n        BookmarkManager.toggleBookmark(tableName, rowKey);\n\n        // \n        if (typeof renderInterface === 'function') {\n          renderInterface();\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_action')\n      .on('click.acu_action', '.acu-action-item', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $btn = $(this);\n        const rowIdx = parseInt($btn.data('row'), 10);\n        const actionIdx = parseInt($btn.data('action-idx'), 10);\n\n        // \n        const $card = $btn.closest('.acu-data-card');\n        const $title = $card.find('.acu-editable-title');\n        const tableKey = $title.data('key');\n        const tableName = $title.data('tname') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const headers = rawData[tableKey].content[0] || [];\n        const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n\n        // []  + AI\n        const actions = getInteractOptionsForRow(tableName, headers, rowData);\n\n        const action = actions[actionIdx];\n\n        // [] \n        if (action && action.type === 'skill_check') {\n          const skillName = rowData[1] || '';\n\n          // \n          let checkValue = null;\n          const attrValIdx = headers.findIndex(h => h && h.includes(''));\n          const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n          // \n          if (attrValIdx > 0 && rowData[attrValIdx]) {\n            const val = extractNumericValue(rowData[attrValIdx]);\n            if (val > 0) checkValue = val;\n          }\n          // \n          if (checkValue === null && profIdx > 0 && rowData[profIdx]) {\n            const val = extractNumericValue(rowData[profIdx]);\n            if (val > 0) checkValue = val;\n          }\n\n          // \n          const promptText = processTemplate(action.template, rowData, headers);\n          smartInsertToTextarea(promptText, 'action');\n\n          // \n          if (checkValue !== null && checkValue > 0) {\n            showDicePanel({\n              targetValue: checkValue,\n              targetName: skillName,\n              initiatorName: '<user>',\n            });\n          } else {\n            $('#send_textarea').focus();\n          }\n          return;\n        }\n\n        if (action && action.template) {\n          // \n          const rawData = cachedRawData || getTableData();\n          if (rawData && rawData[tableKey]) {\n            const headers = rawData[tableKey].content[0] || [];\n            const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n            const npcName = rowData[1] || '';\n\n            // \"\"\n            if (action.label === '') {\n              const config = getConfig();\n              $('.acu-msg-overlay').remove();\n\n              const overlay = $(`\n                        <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:31200;display:flex;justify-content:center;align-items:center;\">\n                            <div style=\"background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                                <div style=\"font-size:14px;font-weight:bold;color:var(--acu-accent);margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                                    <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                                </div>\n                                <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:var(--acu-input-bg) !important;border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main) !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                                <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                                    <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:var(--acu-input-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);cursor:pointer;\"></button>\n                                    <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:var(--acu-btn-active-bg);border:none;border-radius:6px;color:var(--acu-btn-active-text);cursor:pointer;font-weight:bold;\"></button>\n                                </div>\n                            </div>\n                        </div>\n                    `);\n\n              $('body').append(overlay);\n              // []  JS  overlay \n              const overlayEl = overlay[0];\n              overlayEl.style.setProperty('position', 'fixed', 'important');\n              overlayEl.style.setProperty('top', '0', 'important');\n              overlayEl.style.setProperty('left', '0', 'important');\n              overlayEl.style.setProperty('right', '0', 'important');\n              overlayEl.style.setProperty('bottom', '0', 'important');\n              overlayEl.style.setProperty('width', '100vw', 'important');\n              overlayEl.style.setProperty('height', '100vh', 'important');\n              overlayEl.style.setProperty('display', 'flex', 'important');\n              overlayEl.style.setProperty('justify-content', 'center', 'important');\n              overlayEl.style.setProperty('align-items', 'center', 'important');\n              overlayEl.style.setProperty('z-index', '31100', 'important');\n              setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n              const sendMessage = () => {\n                const msg = overlay.find('#acu-msg-input').val().trim();\n                if (msg) {\n                  const promptText = `<user>${npcName}\"${msg}\"`;\n                  smartInsertToTextarea(promptText, 'action');\n                  $('#send_textarea').focus();\n                }\n                overlay.remove();\n              };\n\n              overlay.find('#acu-msg-send').click(sendMessage);\n              overlay.find('#acu-msg-input').on('keydown', function (ev) {\n                if (ev.key === 'Enter') {\n                  ev.preventDefault();\n                  sendMessage();\n                }\n              });\n              overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n              setupOverlayClose(overlay, 'acu-msg-overlay', () => overlay.remove());\n              return;\n            }\n\n            //  processTemplate \n            const promptText = processTemplate(action.template, rowData, headers);\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_global_dice')\n      .on('click.acu_global_dice', '#acu-btn-dice', function (e) {\n        e.stopPropagation();\n        showDicePanel({\n          targetValue: 50,\n          targetName: '',\n          diceType: '1d100',\n        });\n      });\n    // ========== [] ==========\n    // /\n    $('body')\n      .off('click.acu_location_toggle')\n      .on('click.acu_location_toggle', '.acu-location-header', function (e) {\n        e.stopPropagation();\n        const $group = $(this).closest('.acu-location-group');\n        $group.toggleClass('expanded');\n      });\n\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_jump')\n      .on('click.acu_dash_jump', '.acu-dash-jump-link, .acu-dash-loc-item', function (e) {\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const searchTerm = $(this).data('search') || '';\n\n        if (tableName) {\n          // 1. \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n\n          // 2. \n          saveActiveTabState(tableName);\n\n          // 3. \n          if (searchTerm) {\n            tableSearchStates[tableName] = searchTerm;\n            tablePageStates[tableName] = 1;\n          }\n\n          // 4. \n          renderInterface();\n\n          // 5. \n          if (searchTerm) {\n            setTimeout(() => {\n              const $input = $('.acu-search-input');\n              if ($input.length) $input.focus();\n            }, 100);\n          }\n        }\n      });\n    // ========== [] ==========\n    // [] \n    $('body')\n      .off('click.acu_inline_dice')\n      .on('click.acu_inline_dice', '.acu-inline-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        //  .attr()  jQuery \n        const attrName = $(this).attr('data-attr-name') || '';\n        const attrValue = parseInt($(this).attr('data-attr-value'), 10) || 50;\n\n        // NPC\n        const $card = $(this).closest('.acu-data-card');\n        const cardTitle = $card.find('.acu-editable-title').text().trim();\n\n        // <user>\n        const tableName = $card.find('.acu-editable-title').data('tname') || '';\n        const isPlayerTable = tableName.includes('');\n        const initiatorName = isPlayerTable ? '<user>' : cardTitle;\n\n        showDicePanel({\n          attrValue: attrValue,\n          targetValue: null, // showDicePanel\n          targetName: attrName,\n          initiatorName: initiatorName,\n          //  diceType\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_dice')\n      .on('click.acu_dash_dice', '.acu-dash-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const targetValue = parseInt($(this).data('target'), 10) || 50;\n        const targetName = $(this).data('name') || '';\n        const npcName = $(this).data('npc') || '';\n\n        // NPC\n        if (npcName) {\n          // \n          const playerAttrValue = getAttributeValue('<user>', targetName) || 50;\n          showContestPanel({\n            initiatorName: '<user>',\n            initiatorValue: playerAttrValue,\n            opponentName: npcName,\n            opponentValue: targetValue,\n          });\n        } else {\n          showDicePanel({\n            targetValue: targetValue,\n            targetName: targetName,\n            initiatorName: '<user>',\n          });\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_goto')\n      .on('click.acu_dash_goto', '.acu-dash-goto-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const locationName = $(this).data('location') || '';\n        const promptText = `<user>${locationName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_use_item')\n      .on('click.acu_dash_use_item', '.acu-dash-use-item-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const itemName = $(this).data('item') || '';\n        const promptText = `<user>${itemName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\" - \n    $('body')\n      .off('click.acu_dash_use_skill')\n      .on('click.acu_dash_use_skill', '.acu-dash-use-skill-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const skillName = $(this).data('skill') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        let checkValue = null;\n\n        if (rawData) {\n          // \n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n            if (sheet.name.includes('') || sheet.name.includes('')) {\n              const headers = sheet.content[0] || [];\n              // \n              const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n              const attrValIdx = headers.findIndex(h => h && h.includes(''));\n              const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n              for (let i = 1; i < sheet.content.length; i++) {\n                const row = sheet.content[i];\n                if (row && row[nameIdx === -1 ? 1 : nameIdx] === skillName) {\n                  // \n                  if (attrValIdx > 0 && row[attrValIdx]) {\n                    const val = extractNumericValue(row[attrValIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  // \n                  if (profIdx > 0 && row[profIdx]) {\n                    const val = extractNumericValue(row[profIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n              if (checkValue !== null) break;\n            }\n          }\n        }\n\n        // \n        const promptText = `<user>${skillName}`;\n        smartInsertToTextarea(promptText, 'action');\n\n        // \n        if (checkValue !== null && checkValue > 0) {\n          showDicePanel({\n            targetValue: checkValue,\n            targetName: skillName,\n            initiatorName: '<user>',\n          });\n        } else {\n          // \n          $('#send_textarea').focus();\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_track_task')\n      .on('click.acu_dash_track_task', '.acu-dash-track-task-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const taskName = $(this).data('task') || '';\n        const promptText = `<user>${taskName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_msg')\n      .on('click.acu_dash_msg', '.acu-dash-msg-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n        const config = getConfig();\n\n        // \n        $('.acu-msg-overlay').remove();\n\n        const overlay = $(`\n            <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:31200;display:flex;justify-content:center;align-items:center;\">\n                <div class=\"acu-msg-dialog\" style=\"background:var(--acu-bg-panel);border:1px solid var(--acu-border);border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                    <div style=\"font-size:14px;font-weight:bold;color:var(--acu-accent);margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                        <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                    </div>\n                    <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:var(--acu-input-bg) !important;border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main) !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                    <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                        <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:var(--acu-input-bg);border:1px solid var(--acu-border);border-radius:6px;color:var(--acu-text-main);cursor:pointer;\"></button>\n                        <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:var(--acu-btn-active-bg);border:none;border-radius:6px;color:var(--acu-btn-active-text);cursor:pointer;font-weight:bold;\"></button>\n                    </div>\n                </div>\n            </div>\n        `);\n\n        $('body').append(overlay);\n        const overlayEl = overlay[0];\n        overlayEl.style.setProperty('position', 'fixed', 'important');\n        overlayEl.style.setProperty('top', '0', 'important');\n        overlayEl.style.setProperty('left', '0', 'important');\n        overlayEl.style.setProperty('right', '0', 'important');\n        overlayEl.style.setProperty('bottom', '0', 'important');\n        overlayEl.style.setProperty('width', '100vw', 'important');\n        overlayEl.style.setProperty('height', '100vh', 'important');\n        overlayEl.style.setProperty('display', 'flex', 'important');\n        overlayEl.style.setProperty('justify-content', 'center', 'important');\n        overlayEl.style.setProperty('align-items', 'center', 'important');\n        overlayEl.style.setProperty('z-index', '31100', 'important');\n        setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n        const sendMessage = () => {\n          const msg = overlay.find('#acu-msg-input').val().trim();\n          if (msg) {\n            const promptText = `<user>${npcName}\"${msg}\"`;\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n          overlay.remove();\n        };\n\n        // \n        overlay.find('#acu-msg-send').click(sendMessage);\n\n        // \n        overlay.find('#acu-msg-input').on('keydown', function (ev) {\n          if (ev.key === 'Enter') {\n            ev.preventDefault();\n            sendMessage();\n          }\n        });\n\n        // \n        overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n        setupOverlayClose(overlay, 'acu-msg-overlay', () => overlay.remove());\n      });\n    // [] NPC\n    $('body')\n      .off('click.acu_dash_contest')\n      .on('click.acu_dash_contest', '.acu-dash-contest-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n\n        const rawData = cachedRawData || getTableData();\n\n        var playerAttrValue = 50;\n        var npcAttrValue = 50;\n        var foundPlayer = false;\n        var foundNPC = false;\n\n        if (rawData) {\n          for (var key in rawData) {\n            var sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n\n            // \n            if (sheet.name === '') {\n              if (sheet.content[1]) {\n                var attrStr = sheet.content[1][7] || '';\n                var parts = attrStr.split(/[,;\\s]+/);\n                for (var i = 0; i < parts.length; i++) {\n                  var match = parts[i].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                  if (match) {\n                    playerAttrValue = parseInt(match[2], 10);\n                    foundPlayer = true;\n                    break;\n                  }\n                }\n              }\n            }\n\n            // \n            if (sheet.name === '' && npcName) {\n              for (var j = 1; j < sheet.content.length; j++) {\n                var row = sheet.content[j];\n                if (row && row[1] === npcName) {\n                  var npcAttrStr = row[9] || '';\n                  var npcParts = npcAttrStr.split(/[,;\\s]+/);\n                  for (var k = 0; k < npcParts.length; k++) {\n                    var npcMatch = npcParts[k].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                    if (npcMatch) {\n                      npcAttrValue = parseInt(npcMatch[2], 10);\n                      foundNPC = true;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n            }\n          }\n        }\n\n        showContestPanel({\n          initiatorName: '<user>',\n          initiatorValue: playerAttrValue,\n          opponentName: npcName,\n          opponentValue: npcAttrValue,\n          diceType: '1d100',\n        });\n      });\n\n    // [] \n    //  $('body')  $(document) iframe \n    $('body')\n      .off('click.acu_preview_cell_menu')\n      .on('click.acu_preview_cell_menu', '.acu-preview-overlay .acu-cell', function (e) {\n        console.log('[DICE] preview cell click triggered', this, $(this).data());\n        // \n        if ($(e.target).closest('.acu-preview-close').length) return;\n\n        const $this = $(this);\n        const existingMenu = $('.acu-cell-menu');\n\n        // [] Toggle \n        if (existingMenu.length) {\n          const menuCellId = existingMenu.data('cell-id');\n          const thisCellId = `${$this.data('key')}-${$this.data('row')}-${$this.data('col')}`;\n          if (menuCellId === thisCellId) {\n            $('.acu-cell-menu, .acu-menu-backdrop').remove();\n            return;\n          }\n        }\n\n        e.stopPropagation();\n        e.preventDefault();\n        showCellMenu(e, this);\n\n        // ID toggle \n        const cellId = `${$this.data('key')}-${$this.data('row')}-${$this.data('col')}`;\n        $('.acu-cell-menu').data('cell-id', cellId);\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_dash_preview')\n      .on('click.acu_dash_preview', '.acu-dash-preview-trigger', function (e) {\n        e.stopPropagation();\n\n        const tableKey = $(this).data('table-key');\n        const rowIndex = parseInt($(this).data('row-index'), 10);\n\n        if (!tableKey || isNaN(rowIndex)) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const table = rawData[tableKey];\n        const tableName = table.name || '';\n        const headers = table.content[0] || [];\n        const rowData = table.content[rowIndex + 1];\n\n        if (!rowData) return;\n\n        const config = getConfig();\n        const title = rowData[1] || '';\n\n        //  renderTableContent \n        const titleColIndex = 1;\n        const realRowIdx = rowIndex;\n\n        // [] -API\n        const dbLockApi = getDbLockAPI();\n        const sheetKey = dbLockApi ? getSheetKeyByTableName(tableName) : null;\n        const lockState = dbLockApi && sheetKey ? dbLockApi.getTableLockState(sheetKey) : null;\n\n        // [] \n        const lockRowKey = getRowKey(tableName, rowData, headers);\n        const dbRowIndex = sheetKey && lockRowKey ? findRowIndexByPrimaryKey(sheetKey, tableName, lockRowKey) : null;\n        const isCardRowLocked =\n          lockState && dbRowIndex !== null ? (lockState.rows?.includes(dbRowIndex) ?? false) : false;\n\n        // [] \n        const isTitleLocked =\n          isCardRowLocked ||\n          (lockState && dbRowIndex !== null\n            ? (lockState.cells?.includes(`${dbRowIndex}:${titleColIndex - 1}`) ?? false)\n            : false);\n\n        // \n        let cardBody = '';\n        rowData.forEach((cell, cIdx) => {\n          if (cIdx <= 0 || cIdx === titleColIndex) return;\n          const currentHeader = headers[cIdx] || '';\n          if (currentHeader.includes('')) return; // \n\n          // /\n          const headerName = (headers[cIdx] || '' + cIdx).replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n          const rawStr = String(cell || '').trim();\n          if (!rawStr) return;\n\n          // [] \n          // [] cIdx - colIndex  -1\n          const isThisCellLocked =\n            lockState && dbRowIndex !== null\n              ? (lockState.cells?.includes(`${dbRowIndex}:${cIdx - 1}`) ?? false)\n              : false;\n          const isThisFieldLocked = isCardRowLocked || isThisCellLocked;\n\n          let contentHtml = '';\n          let hideLabel = false;\n\n          const parsedAttrs = parseAttributeString(rawStr);\n          // [] \n          if (isRelationshipCell(rawStr, headerName)) {\n            const relations = parseRelationshipString(rawStr);\n            if (relations.length > 1) {\n              hideLabel = true;\n              let relHtml = '';\n              relations.forEach((rel, i) => {\n                const borderStyle = i < relations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                relHtml += `<div style=\"display:flex;justify-content:flex-start;align-items:center;gap:8px;padding:3px 0;${borderStyle}\">\n                              <span style=\"color:var(--acu-text-sub);font-size:0.95em;\" data-locked=\"${isThisFieldLocked}\">${escapeHtml(rel.name)}</span>\n                              ${rel.relation ? `<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>` : ''}\n                          </div>`;\n              });\n              contentHtml = `<div class=\"acu-relation-container\">${relHtml}</div>`;\n            } else if (relations.length === 1 && relations[0].relation) {\n              hideLabel = true; // [] \n              const rel = relations[0];\n              contentHtml = `<div style=\"display:flex;justify-content:flex-start;align-items:center;gap:8px;\">\n                          <span style=\"color:var(--acu-text-sub);\" data-locked=\"${isThisFieldLocked}\">${escapeHtml(rel.name)}</span>\n                          <span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>\n                      </div>`;\n            }\n          } else if (parsedAttrs.length > 1) {\n            hideLabel = true;\n            let attrsHtml = '';\n            parsedAttrs.forEach((attr, i) => {\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              const borderStyle = i < parsedAttrs.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n              attrsHtml += `<div style=\"display:flex;justify-content:space-between;align-items:center;padding:3px 0;${borderStyle}\">\n                          <span style=\"color:var(--acu-text-sub);font-size:0.95em;\" data-locked=\"${isThisFieldLocked}\">${escapeHtml(attr.name)}</span>\n                          <div style=\"display:flex;align-items:center;gap:6px;\">\n                              <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                              ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                          </div></div>`;\n            });\n            contentHtml = `<div class=\"acu-multi-attr-container\">${attrsHtml}</div>`;\n          } else if (parsedAttrs.length === 1) {\n            hideLabel = true;\n            const attr = parsedAttrs[0];\n            const showDice = !BlacklistManager.isBlacklisted(attr.name);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                      <span style=\"color:var(--acu-text-sub);font-size:0.95em;\" data-locked=\"${isThisFieldLocked}\">${escapeHtml(attr.name)}</span>\n                      <div style=\"display:flex;align-items:center;gap:6px;\">\n                          <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                          ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                      </div></div>`;\n          } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n            const numVal = extractNumericValue(rawStr);\n            const showDice = !BlacklistManager.isBlacklisted(headerName);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                      <span>${escapeHtml(rawStr)}</span>\n                      ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(headerName)}\" data-attr-value=\"${numVal}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;margin-left:6px;\" title=\"\"></i>` : ''}\n                  </div>`;\n          } else {\n            const badgeStyle = getBadgeStyle(rawStr);\n            contentHtml = badgeStyle\n              ? `<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(rawStr)}</span>`\n              : escapeHtml(rawStr);\n          }\n\n          const rowClass = 'acu-card-row acu-cell' + (hideLabel ? ' acu-hide-label' : '');\n          cardBody += `<div class=\"${rowClass}\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${cIdx}\" data-val=\"${encodeURIComponent(cell ?? '')}\">\n                <div class=\"acu-card-label\"><span data-locked=\"${isThisFieldLocked}\">${escapeHtml(headerName)}</span></div>\n                <div class=\"acu-card-value\">${contentHtml}</div>\n            </div>`;\n        });\n\n        // []  + AI\n        // [] \n        const tableActions = getInteractOptionsForRow(tableName, headers, rowData);\n        let actionsHtml = '';\n        if (tableActions.length > 0) {\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardHtml = `\n            <div class=\"acu-preview-overlay acu-theme-${config.theme}\" style=\"--acu-card-width:${config.cardWidth}px;--acu-font-size:${config.fontSize}px;\">\n                <div class=\"acu-data-card\" style=\"width:90vw;max-width:420px;max-height:85vh;overflow-y:auto;\">\n                    <div class=\"acu-card-header\">\n                        <span class=\"acu-card-index\">#${realRowIdx + 1}</span>\n                        <span class=\"acu-cell acu-editable-title\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(title)}\" data-locked=\"${isTitleLocked}\">${escapeHtml(title)}</span>\n                        <button class=\"acu-preview-close\" style=\"margin-left:auto;background:none;border:none;color:var(--acu-text-sub);cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-card-body view-list\">${cardBody}</div>\n                    ${actionsHtml}\n                </div>\n            </div>\n        `;\n\n        $('.acu-preview-overlay').remove();\n        $('body').append(cardHtml);\n\n        // \n        const overlayEl = $('.acu-preview-overlay')[0];\n        if (overlayEl) {\n          overlayEl.style.setProperty('position', 'fixed', 'important');\n          overlayEl.style.setProperty('top', '0', 'important');\n          overlayEl.style.setProperty('left', '0', 'important');\n          overlayEl.style.setProperty('right', '0', 'important');\n          overlayEl.style.setProperty('bottom', '0', 'important');\n          overlayEl.style.setProperty('width', '100vw', 'important');\n          overlayEl.style.setProperty('height', '100vh', 'important');\n          overlayEl.style.setProperty('display', 'flex', 'important');\n          overlayEl.style.setProperty('justify-content', 'center', 'important');\n          overlayEl.style.setProperty('align-items', 'center', 'important');\n        }\n\n        // \n        const $previewOverlay = $('.acu-preview-overlay');\n        setupOverlayClose($previewOverlay, 'acu-preview-overlay', () => $previewOverlay.remove());\n        $previewOverlay.on('click', function (ev) {\n          if ($(ev.target).closest('.acu-preview-close').length) {\n            $(this).remove();\n          }\n        });\n      });\n\n    // === []  ST  swipe regenerate ===\n    (function () {\n      const $doc = $(document);\n      let touchStartX = 0;\n      let touchStartY = 0;\n\n      //  data-area\n      $doc.on('touchstart.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length === 1) {\n          touchStartX = e.originalEvent.touches[0].clientX;\n          touchStartY = e.originalEvent.touches[0].clientY;\n        }\n      });\n\n      $doc.on('touchmove.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length !== 1) return;\n\n        const touch = e.originalEvent.touches[0];\n        const deltaX = Math.abs(touch.clientX - touchStartX);\n        const deltaY = Math.abs(touch.clientY - touchStartY);\n\n        // X > Y * 1.5\n        if (deltaX > deltaY * 1.5 && deltaX > 10) {\n          e.stopPropagation();\n          console.log('[DICE]ACU  ST swipe');\n        }\n      });\n    })();\n  };\n\n  let selectedSwapSource = null;\n  const toggleOrderEditMode = () => {\n    const { $ } = getCore();\n    isEditingOrder = !isEditingOrder;\n\n    const $container = $('#acu-nav-bar');\n    const $hint = $('#acu-order-hint');\n    const $pool = $('#acu-action-pool');\n\n    // \n    if (!$container.length) {\n      console.error('[DICE]ACU ');\n      isEditingOrder = false;\n      return;\n    }\n\n    selectedSwapSource = null;\n    $('.acu-swap-selected').removeClass('acu-swap-selected');\n\n    if (isEditingOrder) {\n      // \n      $container.addClass('editing-order');\n      if ($pool.length) $pool.addClass('visible');\n\n      if ($hint.length) {\n        $hint\n          .html(\n            `\n                    <div style=\"display:flex; justify-content:space-between; align-items:center; width:100%; flex-wrap:wrap; gap:8px;\">\n                        <div style=\"display:flex; align-items:center; gap:10px; flex:1; min-width:200px;\">\n                            <span><i class=\"fa-solid fa-layer-group\"></i> </span>\n                            <span style=\"font-size:11px; opacity:0.9; font-weight:normal;\"></span>\n                        </div>\n                        <button id=\"acu-btn-finish-sort\" class=\"acu-btn-finish-sort\">>\n                            <i class=\"fa-solid fa-check\"></i> \n                        </button>\n                    </div>\n                `,\n          )\n          .addClass('visible')\n          .css('display', 'flex');\n\n        $('#acu-btn-finish-sort').hover(\n          function () {\n            $(this).addClass('hover');\n          },\n          function () {\n            $(this).removeClass('hover');\n          },\n        );\n\n        $('#acu-btn-finish-sort')\n          .off('click')\n          .on('click', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            toggleOrderEditMode();\n          });\n      }\n\n      // \n      $('#acu-data-area').removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn').not('#acu-btn-dashboard, #acu-btn-dice-nav').attr('draggable', 'true');\n      $container.find('.acu-action-btn').attr('draggable', 'true');\n\n      // \n      initSortable();\n    } else {\n      // \n      $container.removeClass('editing-order');\n      if ($hint.length) $hint.removeClass('visible').hide();\n      if ($pool.length) $pool.removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn, .acu-action-btn').attr('draggable', 'false');\n      $('.acu-nav-btn, .acu-action-btn').off('.sort');\n      $('#acu-action-pool, #acu-active-actions').off('.sort');\n\n      // \n      const newTableOrder = [];\n      $container.find('.acu-nav-btn[data-table]').each(function () {\n        const tableName = $(this).data('table');\n        if (tableName) {\n          newTableOrder.push(tableName);\n        }\n      });\n      if (newTableOrder.length > 0) {\n        saveTableOrder(newTableOrder);\n      }\n\n      // \n      const newActionOrder = [];\n      $('#acu-active-actions .acu-action-btn').each(function () {\n        const btnId = $(this).attr('id');\n        if (btnId) {\n          newActionOrder.push(btnId);\n        }\n      });\n\n      // \n      if (!newActionOrder.includes('acu-btn-settings')) {\n        newActionOrder.push('acu-btn-settings');\n      }\n\n      Store.set(STORAGE_KEY_ACTION_ORDER, newActionOrder);\n\n      // \n      renderInterface();\n    }\n  };\n\n  const initSortable = () => {\n    const { $ } = getCore();\n    let $dragSrcEl = null;\n\n    // \n    $('.acu-nav-btn, .acu-action-btn, #acu-action-pool, #acu-active-actions').off('.sort');\n\n    // --- 1.  () ---\n    const $items = $('.acu-nav-btn, .acu-action-btn');\n\n    $items.on('dragstart.sort', function (e) {\n      $dragSrcEl = $(this);\n      $(this).css('opacity', '0.4');\n      e.originalEvent.dataTransfer.effectAllowed = 'move';\n    });\n\n    $items.on('dragend.sort', function (e) {\n      $(this).css('opacity', '1');\n      $('.acu-drag-over').removeClass('acu-drag-over');\n      $('.acu-actions-group, .acu-unused-pool').removeClass('dragging-over');\n    });\n\n    $items.on('dragover.sort', function (e) {\n      e.preventDefault();\n      return false;\n    });\n    $items.on('dragenter.sort', function () {\n      if ($dragSrcEl && this !== $dragSrcEl[0]) $(this).addClass('acu-drag-over');\n    });\n    $items.on('dragleave.sort', function () {\n      $(this).removeClass('acu-drag-over');\n    });\n\n    $items.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('acu-drag-over');\n      if (!$dragSrcEl || $dragSrcEl[0] === this) return false;\n\n      const isSrcAction = $dragSrcEl.hasClass('acu-action-btn');\n      const isTgtAction = $(this).hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) return false;\n\n      if (isSrcAction) {\n        const targetPoolId = $(this).parent().attr('id');\n        const srcPoolId = $dragSrcEl.parent().attr('id');\n\n        if (srcPoolId === 'acu-action-pool' && targetPoolId === 'acu-active-actions') {\n          if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n            if (window.toastr) window.toastr.warning('6');\n            return false;\n          }\n        }\n\n        if (srcPoolId !== targetPoolId) {\n          $(this).before($dragSrcEl);\n          return false;\n        }\n      }\n\n      const $temp = $('<span>').hide();\n      $dragSrcEl.before($temp);\n      $(this).before($dragSrcEl);\n      $temp.replaceWith($(this));\n      return false;\n    });\n\n    // --- 2.  (/) ---\n    const $containers = $('#acu-action-pool, #acu-active-actions');\n\n    $containers.on('dragover.sort', function (e) {\n      e.preventDefault();\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        $(this).addClass('dragging-over');\n      }\n    });\n\n    $containers.on('dragleave.sort', function (e) {\n      $(this).removeClass('dragging-over');\n    });\n\n    $containers.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('dragging-over');\n\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        const currentParentId = $dragSrcEl.parent().attr('id');\n        const targetId = $(this).attr('id');\n        const btnId = $dragSrcEl.attr('id');\n\n        if (currentParentId !== targetId) {\n          if (targetId === 'acu-action-pool') {\n            if (btnId === 'acu-btn-settings') {\n              if (window.toastr) window.toastr.warning('');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          } else if (targetId === 'acu-active-actions') {\n            if ($(this).children().length >= 6) {\n              if (window.toastr) window.toastr.warning('6');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          }\n        }\n      }\n      return false;\n    });\n\n    // --- 3.  -  ---\n    $containers.on('click.sort', function (e) {\n      e.stopPropagation();\n\n      // \n      if ($(e.target).closest('.acu-action-btn, .acu-nav-btn').length > 0) return;\n\n      // \n      if (!selectedSwapSource) return;\n\n      const $src = $(selectedSwapSource);\n\n      // \n      if (!$src.hasClass('acu-action-btn')) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const targetId = $(this).attr('id');\n      const btnId = $src.attr('id');\n\n      // \n      if (srcPoolId === targetId) {\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      //   \n      if (targetId === 'acu-action-pool') {\n        if (btnId === 'acu-btn-settings') {\n          if (window.toastr) window.toastr.warning('');\n          $src.removeClass('acu-swap-selected');\n          selectedSwapSource = null;\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n      //   \n      else if (targetId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n    });\n\n    // --- 4.  (Click-to-Swap) -  ---\n    $items.on('click.sort', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (selectedSwapSource && selectedSwapSource === this) {\n        $(this).removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      if (!selectedSwapSource) {\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const $src = $(selectedSwapSource);\n      const $tgt = $(this);\n\n      const isSrcAction = $src.hasClass('acu-action-btn');\n      const isTgtAction = $tgt.hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const tgtPoolId = $tgt.parent().attr('id');\n\n      if (isSrcAction && srcPoolId === 'acu-action-pool' && tgtPoolId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n      }\n\n      if (srcPoolId !== tgtPoolId) {\n        $tgt.before($src);\n      } else {\n        const $temp = $('<span>').hide();\n        $src.before($temp);\n        $tgt.before($src);\n        $temp.replaceWith($tgt);\n      }\n\n      $src.removeClass('acu-swap-selected');\n      selectedSwapSource = null;\n    });\n  };\n\n  const showCellMenu = (e, cell) => {\n    const { $ } = getCore();\n    $('.acu-cell-menu, .acu-menu-backdrop').remove();\n    const backdrop = $('<div class=\"acu-menu-backdrop\"></div>');\n    $('body').append(backdrop);\n\n    const $cell = $(cell); //  data-locked\n    const rowIdx = parseInt($cell.data('row'), 10);\n    const colIdx = parseInt($cell.data('col'), 10);\n    if (isNaN(rowIdx) || isNaN(colIdx)) {\n      console.warn('[DICE]ACU /');\n      backdrop.remove();\n      return;\n    }\n    const tableKey = $cell.data('key');\n    // v19.x  tname\n    const tableName = $cell.data('tname') || $cell.closest('.acu-data-card').find('.acu-editable-title').text();\n    const content = decodeURIComponent($cell.data('val'));\n    const config = getConfig();\n\n    // \n    const $card = $cell.closest('.acu-data-card');\n\n    //  ID\n    const cellId = `${tableKey}-${rowIdx}-${colIdx}`;\n    if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n\n    // \n    const isModified = window.acuModifiedSet.has(cellId);\n\n    // \n    const headers = cachedRawData?.[tableKey]?.content?.[0] || [];\n    const rowData = cachedRawData?.[tableKey]?.content?.[rowIdx + 1] || [];\n    const lockRowKey = getRowKey(tableName, rowData, headers);\n    const currentHeader = headers[colIdx] || '';\n\n    let isFieldLocked = false;\n    let hasAnyLockInRow = false;\n    let rowIndex = -1;\n    let sheetKey = '';\n\n    const api = getDbLockAPI();\n    if (api && lockRowKey) {\n      sheetKey = getSheetKeyByTableName(tableName);\n      if (sheetKey) {\n        rowIndex = findRowIndexByPrimaryKey(sheetKey, tableName, lockRowKey);\n        if (rowIndex !== null && rowIndex !== -1) {\n          const lockState = api.getTableLockState(sheetKey);\n          if (lockState) {\n            // \n            hasAnyLockInRow = lockState.rows?.includes(rowIndex) ?? false;\n            // \n            // [] colIdx - colIndex  -1\n            const cellKey = `${rowIndex}:${colIdx - 1}`;\n            isFieldLocked = lockState.cells?.includes(cellKey) ?? false;\n          }\n        } else {\n          console.warn('[DICE]  rowIndex');\n          isFieldLocked = false;\n          hasAnyLockInRow = false;\n        }\n      } else {\n        console.warn('[DICE]  sheetKey');\n        isFieldLocked = false;\n        hasAnyLockInRow = false;\n      }\n    } else {\n      if (!api) console.warn('[DICE] - API ');\n      isFieldLocked = false;\n      hasAnyLockInRow = false;\n    }\n\n    // \n    let lockMenuHtml = '';\n    if (lockRowKey) {\n      lockMenuHtml = '<div style=\"border-top:1px dashed var(--acu-border); margin:4px 0;\"></div>';\n\n      // \"\"\"\"\n      if (isFieldLocked) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-field\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-field\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n\n      // \"\"\"\"\n      if (hasAnyLockInRow) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-row\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-row\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n    }\n\n    const menu = $(`\n            <div class=\"acu-cell-menu acu-theme-${config.theme}\">\n                <div class=\"acu-cell-menu-item\" id=\"act-edit\"><i class=\"fa-solid fa-pen\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-edit-card\"><i class=\"fa-solid fa-edit\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-insert\"><i class=\"fa-solid fa-plus\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-copy\"><i class=\"fa-solid fa-copy\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-favorite\"><i class=\"fa-solid fa-star\"></i> </div>\n                ${lockMenuHtml}\n                ${isModified ? '<div class=\"acu-cell-menu-item\" id=\"act-undo\"><i class=\"fa-solid fa-undo\"></i> </div>' : ''}\n                <div class=\"acu-cell-menu-item\" id=\"act-delete\"><i class=\"fa-solid fa-trash\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-close\"><i class=\"fa-solid fa-times\"></i> </div>\n            </div>\n        `);\n    $('body').append(menu);\n\n    // \n    const winWidth = $(window).width();\n    const winHeight = $(window).height();\n    const mWidth = menu.outerWidth() || 150;\n    const mHeight = menu.outerHeight() || 150;\n    let clientX = e.clientX;\n    let clientY = e.clientY;\n    if (!clientX && e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length) {\n      clientX = e.originalEvent.touches[0].clientX;\n      clientY = e.originalEvent.touches[0].clientY;\n    } else if (!clientX && e.changedTouches && e.changedTouches.length) {\n      clientX = e.changedTouches[0].clientX;\n      clientY = e.changedTouches[0].clientY;\n    }\n\n    // \n    if (clientX === undefined) clientX = winWidth / 2;\n    if (clientY === undefined) clientY = winHeight / 2;\n\n    let left = clientX + 5;\n    let top = clientY + 5;\n    if (left + mWidth > winWidth) left = clientX - mWidth - 5;\n    if (top + mHeight > winHeight) top = clientY - mHeight - 5;\n\n    // \n    if (left < 5) left = 5;\n    if (top < 5) top = 5;\n\n    menu.css({ top: top + 'px', left: left + 'px' });\n\n    const closeAll = () => {\n      menu.remove();\n      backdrop.remove();\n    };\n    backdrop.on('click', closeAll);\n    menu.find('#act-close').click(closeAll);\n    // \n    // [] colIdx - colIndex  -1\n    const dbColIndex = colIdx - 1;\n    menu.find('#act-lock-field').click(e => {\n      e.stopPropagation();\n      if (lockRowKey && currentHeader) {\n        if (api && sheetKey && rowIndex !== null && rowIndex !== -1 && dbColIndex >= 0) {\n          api.lockTableCell(sheetKey, rowIndex, dbColIndex, true);\n          // []  data-locked \n          // []  $cell  data-locked \n          if ($cell.is('[data-locked]')) {\n            $cell.attr('data-locked', 'true');\n          }\n          $cell.find('[data-locked]').attr('data-locked', 'true');\n        } else {\n          console.warn('[DICE] -API');\n        }\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-field').click(e => {\n      e.stopPropagation();\n      if (lockRowKey && currentHeader) {\n        if (api && sheetKey && rowIndex !== null && rowIndex !== -1 && dbColIndex >= 0) {\n          api.lockTableCell(sheetKey, rowIndex, dbColIndex, false);\n          // []  data-locked \n          // []  $cell  data-locked \n          if ($cell.is('[data-locked]')) {\n            $cell.attr('data-locked', 'false');\n          }\n          $cell.find('[data-locked]').attr('data-locked', 'false');\n        } else {\n          console.warn('[DICE] -API');\n        }\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-lock-row').click(e => {\n      e.stopPropagation();\n      if (lockRowKey) {\n        if (api && sheetKey && rowIndex !== null && rowIndex !== -1) {\n          api.lockTableRow(sheetKey, rowIndex, true);\n          // []  data-locked \n          $card.find('[data-locked]').attr('data-locked', 'true');\n        } else {\n          console.warn('[DICE] -API');\n        }\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-row').click(e => {\n      e.stopPropagation();\n      if (lockRowKey) {\n        if (api && sheetKey && rowIndex !== null && rowIndex !== -1) {\n          // [] \n          const currentLockState = api.getTableLockState(sheetKey);\n          if (currentLockState && currentLockState.cells) {\n            // \n            const rowPrefix = `${rowIndex}:`;\n            currentLockState.cells.forEach((cellKey: string) => {\n              if (cellKey.startsWith(rowPrefix)) {\n                const cellColIndex = parseInt(cellKey.split(':')[1], 10);\n                if (!isNaN(cellColIndex)) {\n                  api.lockTableCell(sheetKey, rowIndex, cellColIndex, false);\n                }\n              }\n            });\n          }\n          // \n          api.lockTableRow(sheetKey, rowIndex, false);\n          // []  data-locked \n          $card.find('[data-locked]').attr('data-locked', 'false');\n        } else {\n          console.warn('[DICE] -API');\n        }\n      }\n      closeAll();\n    });\n\n    //  (v7.9 )\n    menu.find('#act-copy').click(async e => {\n      e.stopPropagation();\n\n      //  v7.7  (/PWA )\n      // : slash_command.txt /clipboard-set\n      if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n        try {\n          // \n          const safeContent = content\n            .replace(/\\\\/g, '\\\\\\\\')\n            .replace(/\"/g, '\\\\\"')\n            .replace(/\\n/g, '\\\\n')\n            .replace(/\\{/g, '\\\\{')\n            .replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          closeAll();\n          return; // \n        } catch (err) {\n          console.warn('[DICE]ACU ', err);\n        }\n      }\n\n      //  (v7.8 )\n      const doCopy = text => {\n        // A:  API ( HTTPS  localhost )\n        if (navigator.clipboard && window.isSecureContext) {\n          navigator.clipboard\n            .writeText(text)\n            .then(() => {})\n            .catch(() => {\n              fallbackCopy(text);\n            });\n        } else {\n          // B:  execCommand ( HTTP)\n          fallbackCopy(text);\n        }\n      };\n\n      const fallbackCopy = text => {\n        try {\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n\n          // \n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n\n          document.body.appendChild(textArea);\n\n          textArea.select();\n          textArea.setSelectionRange(0, 99999); //  iOS Safari\n\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n\n          if (successful) {\n          } else {\n            throw new Error('execCommand failed');\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          prompt(':', text);\n        }\n      };\n\n      doCopy(content);\n      closeAll();\n    });\n\n    // \n    menu.find('#act-favorite').click(async () => {\n      try {\n        // \n        const tableData = cachedRawData?.[tableKey];\n        if (!tableData || !tableData.content) {\n          toastr.error('');\n          closeAll();\n          return;\n        }\n\n        // null\n        const fullHeader = tableData.content[0] || [];\n        const header: string[] = fullHeader.slice(1).map((h: any) => String(h || ''));\n\n        // null\n        const fullRowData = tableData.content[rowIdx + 1] || [];\n        const rowDataValues: (string | number)[] = fullRowData.slice(1);\n\n        if (header.length === 0 || rowDataValues.length === 0) {\n          toastr.error('');\n          closeAll();\n          return;\n        }\n\n        // \n        const tagInput = prompt('', '');\n        const tags: string[] = tagInput\n          ? tagInput\n              .split(',')\n              .map(t => t.trim())\n              .filter(t => t.length > 0)\n          : [];\n\n        // \n        const result = await FavoritesManager.addFavorite(tableKey, tableName, header, rowDataValues, tags);\n\n        if (result) {\n          toastr.success('');\n        } else {\n          toastr.error('');\n        }\n      } catch (e) {\n        console.error('[DICE]:', e);\n        toastr.error(': ' + (e instanceof Error ? e.message : String(e)));\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-undo').click(() => {\n      const snapshot = loadSnapshot();\n      let originalValue = null;\n      if (snapshot && snapshot[tableKey]?.content[rowIdx + 1]) {\n        originalValue = snapshot[tableKey].content[rowIdx + 1][colIdx];\n      }\n\n      if (originalValue !== null) {\n        if (!cachedRawData) cachedRawData = getTableData();\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = originalValue;\n        }\n\n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(originalValue));\n        $cell.data('val', encodeURIComponent(originalValue));\n\n        // [1]  Label\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length > 0) {\n          $displayTarget = $cell.find('.acu-card-value');\n        } else if ($cell.hasClass('acu-grid-item')) {\n          $displayTarget = $cell.find('.acu-grid-value');\n        } else if ($cell.hasClass('acu-full-item')) {\n          $displayTarget = $cell.find('.acu-full-value');\n        }\n\n        const badgeStyle = getBadgeStyle(originalValue);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${originalValue}</span>`);\n        } else {\n          $displayTarget.text(originalValue);\n        }\n\n        // [] \n        $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n        if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n        window.acuModifiedSet.delete(cellId);\n\n        if (window.acuModifiedSet.size === 0) {\n          hasUnsavedChanges = false;\n          updateSaveButtonState();\n        }\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n      closeAll();\n    });\n\n    // []  ()\n    menu.find('#act-delete').click(async () => {\n      // [] DOM\n      const $panelContent = $('.acu-panel-content');\n      const savedScrollTop = $panelContent.length ? $panelContent.scrollTop() : 0;\n      const savedScrollLeft = $panelContent.length ? $panelContent.scrollLeft() : 0;\n\n      // \n      closeAll();\n\n      // [Bug 1 ] preview cardoverlay\n      const $mapOverlay = $('.acu-map-overlay');\n      const isFromMap = $mapOverlay.length > 0;\n\n      // preview card overlay\n      $('.acu-preview-overlay').remove();\n\n      // ---  DOM ---\n      if (isFromMap) {\n        // chip data-table-key  data-row-index \n        $mapOverlay.find(`.acu-map-element-chip[data-table-key=\"${tableKey}\"][data-row-index=\"${rowIdx}\"]`).remove();\n        $mapOverlay.find(`.acu-map-thumbnail[data-table-key=\"${tableKey}\"][data-row-index=\"${rowIdx}\"]`).remove();\n      }\n\n      // \n      const $card = $(cell).closest('.acu-data-card');\n      if ($card.length && !isFromMap) {\n        $card.css('transition', 'all 0.2s ease').css('opacity', '0').css('transform', 'scale(0.9)');\n        setTimeout(() => $card.slideUp(200, () => $card.remove()), 200);\n      }\n\n      // ---  ---\n      if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n      if (cachedRawData && cachedRawData[tableKey]?.content) {\n        cachedRawData[tableKey].content.splice(rowIdx + 1, 1);\n\n        try {\n          // \n          await saveDataOnly(cachedRawData, [tableKey]);\n\n          // [Bug 3 ] diffMap\n          currentDiffMap = generateDiffMap(cachedRawData);\n\n          // \n          renderInterface();\n\n          // [] overlayviewModel\n          if (isFromMap) {\n            const refreshMapData = $mapOverlay.data('refreshMapData');\n            if (typeof refreshMapData === 'function') {\n              await refreshMapData();\n            }\n          }\n\n          // [] renderInterface\n          setTimeout(() => {\n            const $newContent = $('.acu-panel-content');\n            if ($newContent.length && (savedScrollTop > 0 || savedScrollLeft > 0)) {\n              $newContent.scrollTop(savedScrollTop);\n              $newContent.scrollLeft(savedScrollLeft);\n            }\n          }, 60);\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n          toastr.error(': ' + (e instanceof Error ? e.message : String(e)));\n          renderInterface();\n\n          // [] \n          setTimeout(() => {\n            const $newContent = $('.acu-panel-content');\n            if ($newContent.length && (savedScrollTop > 0 || savedScrollLeft > 0)) {\n              $newContent.scrollTop(savedScrollTop);\n              $newContent.scrollLeft(savedScrollLeft);\n            }\n          }, 60);\n        }\n      }\n    });\n\n    // []  ()\n    menu.find('#act-insert').click(async () => {\n      closeAll();\n      // 1.  ()\n      if (!cachedRawData) cachedRawData = getTableData();\n      if (!cachedRawData) cachedRawData = loadSnapshot();\n\n      if (cachedRawData && cachedRawData[tableKey]?.content) {\n        const sheet = cachedRawData[tableKey];\n        // 2.  ()\n        const colCount = sheet.content[0] ? sheet.content[0].length : 2;\n        const newRow = new Array(colCount).fill('');\n        //  ()\n        if (colCount > 0) newRow[0] = String(sheet.content.length);\n\n        // 3.  (rowIdx+2  content )\n        sheet.content.splice(rowIdx + 2, 0, newRow);\n\n        // 4. \n        // \n        await saveDataToDatabase(cachedRawData, false, true);\n\n        // \n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $panel = $('.acu-panel-content');\n          // \n          if ($panel.length && $panel[0].scrollHeight > $panel.height()) {\n            $panel.scrollTop($panel.scrollTop() + 10);\n          }\n        }, 100);\n      }\n    });\n\n    // [] \n    menu.find('#act-edit-card').click(() => {\n      closeAll();\n      const rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const headers = rawData[tableKey].content[0];\n        const row = rawData[tableKey].content[rowIdx + 1];\n        if (row) {\n          showCardEditModal(row, headers, tableName, rowIdx, tableKey);\n        }\n      }\n    });\n\n    menu.find('#act-edit').click(() => {\n      closeAll();\n      showEditDialog(content, async newVal => {\n        // 1. \n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = newVal;\n        } else {\n          alert('');\n          return;\n        }\n\n        // 2.  UI \n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(newVal)).data('val', encodeURIComponent(newVal));\n\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length) $displayTarget = $cell.find('.acu-card-value');\n        else if ($cell.hasClass('acu-grid-item')) $displayTarget = $cell.find('.acu-grid-value');\n        else if ($cell.hasClass('acu-editable-title')) $displayTarget = $cell;\n\n        // 3.  UI / ()\n        const badgeStyle = getBadgeStyle(newVal);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(newVal)}</span>`);\n        } else {\n          $displayTarget.text(newVal);\n        }\n\n        // 4.  + AI\n        //  ()\n        $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n        if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n        //  saveRowInstantly  + \n        try {\n          const currentRow = cachedRawData[tableKey].content[rowIdx + 1];\n          await saveRowInstantly(tableKey, rowIdx, [...currentRow]);\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n          toastr.error(': ' + (e instanceof Error ? e.message : String(e)));\n        }\n      });\n    });\n  };\n\n  const showEditDialog = (content, onSave) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <!-- 2. []  acu-theme-${config.theme} -->\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"></div>\n                    <textarea class=\"acu-edit-textarea\" spellcheck=\"false\">${escapeHtml(content)}</textarea>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = el.scrollHeight + 2 + 'px';\n    };\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    dialog.find('#dlg-cancel').click(() => dialog.remove());\n    // \n    setupOverlayClose(dialog, 'acu-edit-overlay', () => dialog.remove());\n\n    dialog.find('#dlg-save').click(() => {\n      onSave(dialog.find('textarea').val());\n      dialog.remove();\n    });\n  };\n\n  // ==========================================\n  // []  (Observer )\n  // ==========================================\n  // \n  const detectVisualizerConflict = () => {\n    const { $ } = getCore();\n    if (!$) return false;\n\n    // 1:  DOM \n    //  .acu-wrapper\n    const $wrapper = $('.acu-wrapper');\n    if ($wrapper.length > 0) {\n      //  wrapper \n      //  v12.60  'acu_visualizer_ui_v20_pagination'  SCRIPT_ID\n      // \n      const hasVisualizerNav = $wrapper.find('.acu-nav-container').length > 0;\n      const hasVisualizerDataDisplay = $wrapper.find('.acu-data-display').length > 0;\n\n      //  wrapper \n      //  wrapper  data  id\n      const wrapperId = $wrapper.attr('id') || '';\n      const wrapperClass = $wrapper.attr('class') || '';\n\n      // \n      if (hasVisualizerNav && hasVisualizerDataDisplay) {\n        // \n        const hasDiceFeatures = $wrapper.find('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceFeatures) {\n          return true; // \n        }\n      }\n    }\n\n    // 2: \n    try {\n      const scripts = document.querySelectorAll('script');\n      for (const script of scripts) {\n        const content = script.textContent || script.innerHTML || '';\n        //  v12.60 \n        if (content.includes('acu_visualizer_ui_v20_pagination') && content.includes('acu_ui_config_v18')) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // \n    }\n\n    // 3:  localStorage\n    //  localStorage \n    try {\n      const visualizerConfig = localStorage.getItem('acu_ui_config_v18');\n      const diceConfig = localStorage.getItem('acu_ui_config_v19');\n\n      //  DOM \n      if (visualizerConfig && !diceConfig) {\n        //  DOM\n        const hasDiceInDOM = $('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceInDOM) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // localStorage \n    }\n\n    return false;\n  };\n\n  // \n  const showConflictDialog = () => {\n    const { $ } = getCore();\n    if (!$) return;\n\n    // \n    $('.dice-conflict-dialog-overlay').remove();\n\n    const dialogHtml = `\n      <div class=\"dice-conflict-dialog-overlay\" style=\"\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0, 0, 0, 0.75);\n        backdrop-filter: blur(4px);\n        z-index: 31200;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 20px;\n        box-sizing: border-box;\n      \">\n        <div class=\"dice-conflict-dialog\" style=\"\n          background: #fff;\n          border-radius: 16px;\n          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n          max-width: 500px;\n          width: 100%;\n          padding: 30px;\n          box-sizing: border-box;\n          animation: diceDialogPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n        \">\n          <div style=\"\n            text-align: center;\n            margin-bottom: 20px;\n          \">\n            <div style=\"\n              font-size: 48px;\n              color: #e74c3c;\n              margin-bottom: 15px;\n            \"></div>\n            <h2 style=\"\n              font-size: 24px;\n              font-weight: bold;\n              color: #333;\n              margin: 0 0 10px 0;\n            \"></h2>\n            <p style=\"\n              font-size: 16px;\n              color: #666;\n              line-height: 1.6;\n              margin: 0;\n            \">\"\"</p>\n          </div>\n          <div style=\"\n            background: #fff3cd;\n            border: 1px solid #ffc107;\n            border-radius: 8px;\n            padding: 15px;\n            margin-bottom: 20px;\n          \">\n            <p style=\"\n              font-size: 14px;\n              color: #856404;\n              line-height: 1.6;\n              margin: 0;\n            \">\n              <strong></strong><br>\n              <strong></strong>\n            </p>\n          </div>\n          <div style=\"\n            display: flex;\n            gap: 10px;\n            justify-content: center;\n            flex-wrap: wrap;\n          \">\n            <button id=\"dice-conflict-close\" style=\"\n              background: #6c757d;\n              color: #fff;\n              border: none;\n              border-radius: 8px;\n              padding: 12px 24px;\n              font-size: 16px;\n              font-weight: bold;\n              cursor: pointer;\n              transition: all 0.2s;\n              min-width: 120px;\n            \"></button>\n          </div>\n        </div>\n      </div>\n      <style>\n        @keyframes diceDialogPop {\n          from {\n            opacity: 0;\n            transform: translateY(20px) scale(0.95);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0) scale(1);\n          }\n        }\n        .dice-conflict-dialog button:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        }\n        .dice-conflict-dialog button:active {\n          transform: translateY(0);\n        }\n        @media (max-width: 768px) {\n          .dice-conflict-dialog {\n            padding: 20px !important;\n            margin: 10px !important;\n            max-width: calc(100% - 20px) !important;\n          }\n          .dice-conflict-dialog h2 {\n            font-size: 20px !important;\n          }\n          .dice-conflict-dialog p {\n            font-size: 14px !important;\n          }\n        }\n      </style>\n    `;\n\n    $('body').append(dialogHtml);\n\n    // \n    $('#dice-conflict-close').on('click', function () {\n      $('.dice-conflict-dialog-overlay').fadeOut(200, function () {\n        $(this).remove();\n      });\n    });\n\n    // \n    const $conflictOverlay = $('.dice-conflict-dialog-overlay');\n    setupOverlayClose($conflictOverlay, 'dice-conflict-dialog-overlay', () => {\n      $conflictOverlay.fadeOut(200, function () {\n        $(this).remove();\n      });\n    });\n\n    //  toastr \n    if (window.toastr) {\n      window.toastr.error('', '', {\n        timeOut: 0,\n        extendedTimeOut: 0,\n        closeButton: true,\n        preventDuplicates: true,\n      });\n    }\n  };\n\n  const init = () => {\n    if (isInitialized) return;\n\n    // LockManager (-API)\n    (() => {\n      const prefix = 'acu_locked_fields_v2_';\n      const keysToRemove: string[] = [];\n\n      for (let i = 0; i < localStorage.length; i++) {\n        const key = localStorage.key(i);\n        if (key && key.startsWith(prefix)) {\n          keysToRemove.push(key);\n        }\n      }\n\n      keysToRemove.forEach(key => localStorage.removeItem(key));\n\n      if (keysToRemove.length > 0) {\n        console.info(`[DICE]  ${keysToRemove.length} `);\n      }\n    })();\n\n    console.log('[DICE]...');\n\n    //  ConsoleCaptureManager  localStorage\n    try {\n      ConsoleCaptureManager.restore();\n      console.info('[DICE]ConsoleCaptureManager ');\n    } catch (e) {\n      console.error('[DICE] ConsoleCaptureManager :', e);\n    }\n\n    // \n    try {\n      ErrorHandler.checkAndRestore();\n      console.info('[DICE]');\n    } catch (e) {\n      console.error('[DICE]:', e);\n    }\n\n    // \n    if (detectVisualizerConflict()) {\n      showConflictDialog();\n      console.error('[DICE] ');\n      return; // \n    }\n\n    console.info('[DICE] MVU ...');\n    MvuModule.injectStyles();\n\n    //  Observer\n    if (observer) {\n      observer.disconnect();\n      observer = null;\n      console.info('[DICE] MutationObserver');\n    }\n    addStyles();\n    const initCfg = getConfig();\n    const initFontVal = FONTS.find(f => f.id === initCfg.fontFamily)?.val || FONTS[0].val;\n    injectDatabaseStyles(initCfg.theme, initFontVal);\n    setDatabaseToastMute(initCfg.muteDatabaseToasts === true);\n    // 2.  SillyTavern \n    if (window.SillyTavern && window.SillyTavern.eventSource) {\n      console.info('[DICE] SillyTavern ...');\n      const events = window.SillyTavern.eventTypes;\n      const source = window.SillyTavern.eventSource;\n      const triggers = [events.CHAT_CHANGED, events.MESSAGE_SWIPED, events.MESSAGE_DELETED, events.MESSAGE_UPDATED];\n\n      // \n      if (!_boundRenderHandler) {\n        _boundRenderHandler = () => {\n          if (!isEditingOrder) {\n            console.info('[DICE]');\n            setTimeout(renderInterface, 500);\n          } else {\n            console.info('[DICE]');\n          }\n        };\n      }\n\n      // \n      if (!window._acuBoundChatChangeHandler) {\n        window._acuBoundChatChangeHandler = () => {\n          console.info('[DICE]');\n          cachedRawData = null;\n          tablePageStates = {};\n          tableSearchStates = {};\n          tableScrollStates = {};\n          hasUnsavedChanges = false;\n          currentDiffMap.clear();\n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          // /\n          try {\n            if (typeof MvuModule?.clearCache === 'function') {\n              MvuModule.clearCache();\n            }\n          } catch (e) {\n            console.warn('[DICE]:', e);\n          }\n          setTimeout(renderInterface, 500);\n        };\n      }\n      const _boundChatChangeHandler = window._acuBoundChatChangeHandler;\n\n      triggers.forEach(evt => {\n        if (evt) {\n          source.removeListener(evt, _boundRenderHandler);\n          source.removeListener(evt, _boundChatChangeHandler); // \n          if (evt === events.CHAT_CHANGED) {\n            source.on(evt, _boundChatChangeHandler);\n          } else {\n            source.on(evt, _boundRenderHandler);\n          }\n        }\n      });\n      console.info(`[DICE] ${triggers.length} `);\n    } else {\n      console.warn('[DICE]SillyTavern ');\n    }\n\n    // 3.  API \n    const loop = () => {\n      const api = getCore().getDB();\n      if (api?.exportTableAsJson) {\n        isInitialized = true;\n        console.log('[DICE]');\n        console.info('[DICE] API ');\n\n        // --- [Fix]  API  #chat  () ---\n        const $chat = $('#chat');\n        if ($chat.length && !observer) {\n          console.info('[DICE] MutationObserver');\n          let mutationLock = false;\n          const handleMutation = () => {\n            if (mutationLock) return;\n            mutationLock = true;\n            requestAnimationFrame(() => {\n              const config = getConfig();\n              if (config.positionMode === 'embedded') {\n                mutationLock = false;\n                return;\n              }\n\n              const children = $chat.children();\n              const lastChild = children.last()[0];\n              const wrapper = $('.acu-wrapper')[0];\n\n              if (wrapper && lastChild && lastChild !== wrapper) {\n                if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n                  $chat.append(wrapper);\n                }\n              }\n\n              // [] \n              const diceCfg = getDiceConfig();\n              if (diceCfg && diceCfg.hideDiceResultInChat) {\n                // 1\n                const children = $chat.children();\n                const lastChild = children.last();\n                if (lastChild.hasClass('mes') || lastChild.hasClass('message-body')) {\n                  lastChild.addClass('acu-dice-result-revealing');\n                }\n\n                // 2RAF\n                requestAnimationFrame(() => {\n                  hideDiceResultsInUserMessages();\n\n                  // 3\n                  requestAnimationFrame(() => {\n                    lastChild.removeClass('acu-dice-result-revealing').addClass('acu-dice-result-revealed');\n                    // \n                    setTimeout(() => {\n                      lastChild.removeClass('acu-dice-result-revealed');\n                    }, 200);\n                  });\n                });\n              }\n\n              mutationLock = false;\n            });\n          };\n          observer = new MutationObserver(handleMutation);\n          observer.observe($chat[0], { childList: true });\n        } else if (!$chat.length) {\n          console.warn('[DICE] (#chat)  MutationObserver ');\n        }\n        // --------------------------------------------------\n\n        console.info('[DICE]...');\n        renderInterface(); // \n        // [] \n        setTimeout(() => {\n          hideDiceResultsInUserMessages();\n        }, 500);\n        // \n        if (api.registerTableUpdateCallback) {\n          api.registerTableUpdateCallback(UpdateController.handleUpdate);\n          console.info('[DICE]');\n\n          // \n          if (api.registerTableFillStartCallback) {\n            api.registerTableFillStartCallback(() => {\n              const current = api.exportTableAsJson();\n              if (current) saveSnapshot(current);\n            });\n            console.info('[DICE]');\n          }\n        } else {\n          console.warn('[DICE] API ');\n        }\n      } else {\n        //  ( 60)\n        if (!isInitialized) {\n          window._acuInitRetries = (window._acuInitRetries || 0) + 1;\n          if (window._acuInitRetries < 60) {\n            if (window._acuInitRetries % 10 === 0) {\n              console.info(`[DICE] API ... (${window._acuInitRetries}/60)`);\n            }\n            setTimeout(loop, 1000);\n          } else {\n            console.error('[DICE] API');\n          }\n        }\n      }\n    };\n    loop();\n\n    // []  - \n    const setupOptionHideListener = () => {\n      const { $ } = getCore();\n      const hideOptionPanel = () => {\n        optionPanelVisible = false;\n        $('.acu-option-panel, .acu-embedded-options-container').fadeOut(200, function () {\n          $(this).remove();\n        });\n      };\n\n      const pendingCrazyAppend = new Map<number, { result: string; createdAt: number }>();\n      const CRAZY_APPEND_TTL_MS = 12000;\n      let lastCrazyPreSendAt = 0;\n\n      const normalizeMessageId = (messageId: number | string) => {\n        const id = typeof messageId === 'string' ? Number(messageId) : messageId;\n        return Number.isFinite(id) ? id : null;\n      };\n\n      const hasDiceResultInText = (text: string) => {\n        if (!text) return false;\n        const contestRegex =\n          /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n        const normalRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n        return contestRegex.test(text) || normalRegex.test(text);\n      };\n\n      const insertDiceIntoUserInputBlock = (text: string, diceResult: string) => {\n        if (!text || !diceResult) return '';\n        const blockRegex = /(<>)([\\s\\S]*?)(<\\/>)/;\n        const blockMatch = text.match(blockRegex);\n        if (!blockMatch) return '';\n        const inner = blockMatch[2];\n        if (inner.includes(diceResult)) return '';\n        const prefix = inner.startsWith('\\n') ? '\\n' : '';\n        const suffix = inner.endsWith('\\n') ? '\\n' : '';\n        const trimmedInner = inner.trim();\n        const newInner = trimmedInner ? `${trimmedInner} ${diceResult}` : diceResult;\n        const textWithoutDice = text.includes(diceResult) ? text.replace(diceResult, '').trim() : text;\n        return textWithoutDice.replace(blockRegex, `${blockMatch[1]}${prefix}${newInner}${suffix}${blockMatch[3]}`);\n      };\n\n      const applyCrazyModeToPrompt = (type: string, params: unknown, dryRun: boolean) => {\n        if (dryRun) return;\n        const safeParams = params && typeof params === 'object' ? (params as Record<string, unknown>) : {};\n        const quietPrompt = typeof safeParams.quiet_prompt === 'string' ? safeParams.quiet_prompt : '';\n        const automaticTrigger = safeParams.automatic_trigger === true;\n        const alreadyApplied = safeParams._acu_crazy_applied === true;\n        if (alreadyApplied || automaticTrigger) return;\n        if (type === 'quiet' || quietPrompt.trim().length > 0) return;\n\n        const now = Date.now();\n        if (now - lastCrazyPreSendAt < 300) return;\n\n        const originalPrompt = typeof safeParams.prompt === 'string' ? safeParams.prompt : '';\n        if (!originalPrompt || !originalPrompt.trim()) return;\n        if (hasDiceResultInText(originalPrompt)) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        let finalPrompt = '';\n        if (originalPrompt.includes('<>')) {\n          const inserted = insertDiceIntoUserInputBlock(originalPrompt, crazyRollResult);\n          finalPrompt =\n            inserted && inserted !== originalPrompt ? inserted : `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n        } else {\n          finalPrompt = `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n        }\n\n        safeParams.prompt = finalPrompt;\n        safeParams._acu_crazy_applied = true;\n        lastCrazyPreSendAt = now;\n      };\n\n      const triggerCrazyModeBeforeSend = () => {\n        const now = Date.now();\n        if (now - lastCrazyPreSendAt < 300) return;\n\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        const content = ($ta.val() || '').toString().trim();\n        if (!content) return;\n        if (hasDiceResultInText(content)) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        smartInsertToTextarea(crazyRollResult, 'dice');\n        const updatedValue = ($ta.val() || '').toString();\n        if (updatedValue) {\n          const textarea = $ta[0] as HTMLTextAreaElement;\n          textarea.value = updatedValue;\n          textarea.dispatchEvent(new Event('input', { bubbles: true }));\n          textarea.dispatchEvent(new Event('change', { bubbles: true }));\n        }\n        lastCrazyPreSendAt = now;\n      };\n\n      const queueCrazyAppend = (messageId: number | string) => {\n        const id = normalizeMessageId(messageId);\n        if (id === null) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        pendingCrazyAppend.set(id, { result: crazyRollResult, createdAt: Date.now() });\n        void applyCrazyAppend(id);\n      };\n\n      const applyCrazyAppend = async (messageId: number | string) => {\n        const id = normalizeMessageId(messageId);\n        if (id === null) return;\n\n        const pending = pendingCrazyAppend.get(id);\n        if (!pending) return;\n\n        if (Date.now() - pending.createdAt > CRAZY_APPEND_TTL_MS) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        const stChat = ST?.chat || window.parent?.SillyTavern?.chat;\n        const stMsg = stChat && typeof id === 'number' ? stChat[id] : null;\n        const msg = getChatMessages(id)[0];\n        if (!msg || msg.role !== 'user') {\n          if (!stMsg || !stMsg.is_user) {\n            pendingCrazyAppend.delete(id);\n            return;\n          }\n        }\n\n        const originalText = String(stMsg?.mes ?? msg?.message ?? '');\n        if (hasDiceResultInText(originalText)) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        const extra = msg?.extra || stMsg?.extra || {};\n        if ((extra as { acuCrazyModeApplied?: boolean }).acuCrazyModeApplied) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        let newMessage = '';\n        if (originalText.includes('<>')) {\n          const inserted = insertDiceIntoUserInputBlock(originalText, pending.result);\n          newMessage = inserted && inserted !== originalText ? inserted : `${originalText} ${pending.result}`.trim();\n        } else {\n          newMessage = originalText ? `${originalText} ${pending.result}` : pending.result;\n        }\n        pendingCrazyAppend.delete(id);\n\n        if (stMsg && stMsg.is_user) {\n          stMsg.mes = newMessage;\n        }\n\n        try {\n          await setChatMessages(\n            [{ message_id: id, message: newMessage, extra: { ...extra, acuCrazyModeApplied: true } }],\n            { refresh: 'affected' },\n          );\n        } catch (e) {\n          console.warn('[DICE]: ', e);\n        }\n\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        if ($ta.length) {\n          const currentVal = ($ta.val() || '').toString();\n          if (currentVal === newMessage) {\n            $ta.val('').trigger('input').trigger('change');\n          }\n        }\n      };\n\n      // [] \n      const setupSendButtonListener = () => {\n        // []  value \n        interceptTextareaValue();\n\n        // [] \n        const sendButton = document.getElementById('send_but');\n        if (sendButton) {\n          const onSendCapture = () => {\n            // \n            triggerCrazyModeBeforeSend();\n            // \n            restoreDiceResultBeforeSend();\n          };\n          sendButton.addEventListener('click', onSendCapture, true);\n          sendButton.addEventListener('pointerup', onSendCapture, true);\n          sendButton.addEventListener('touchend', onSendCapture, true);\n        }\n\n        // jQuery\n        $(document)\n          .off('click.acu_restore_dice', '#send_but')\n          .on('click.acu_restore_dice', '#send_but', function (e) {\n            // \n            triggerCrazyModeBeforeSend();\n            // \n            restoreDiceResultBeforeSend();\n          });\n\n        // \n        const textarea = document.getElementById('send_textarea');\n        if (textarea) {\n          textarea.addEventListener(\n            'keydown',\n            function (e) {\n              //  ShiftShift+Enter \n              if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n                // \n                triggerCrazyModeBeforeSend();\n                // \n                restoreDiceResultBeforeSend();\n              }\n            },\n            true, // \n          );\n          textarea.addEventListener(\n            'keyup',\n            function (e) {\n              if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n                triggerCrazyModeBeforeSend();\n                restoreDiceResultBeforeSend();\n              }\n            },\n            true,\n          );\n        }\n\n        $('#send_textarea')\n          .off('keydown.acu_restore_dice')\n          .on('keydown.acu_restore_dice', function (e) {\n            //  ShiftShift+Enter \n            if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n              // \n              triggerCrazyModeBeforeSend();\n              // \n              restoreDiceResultBeforeSend();\n            }\n          })\n          .off('keyup.acu_restore_dice')\n          .on('keyup.acu_restore_dice', function (e) {\n            if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n              triggerCrazyModeBeforeSend();\n              restoreDiceResultBeforeSend();\n            }\n          });\n\n        // [] /\n        const observer = new MutationObserver(() => {\n          const $ta = $('#send_textarea');\n          if ($ta.length && !$ta[0]._acuValueIntercepted) {\n            interceptTextareaValue();\n          }\n        });\n        observer.observe(document.body, { childList: true, subtree: true });\n      };\n\n      const installCrazyGenerateHook = () => {\n        const rootWindow = window as Window & {\n          __acuCrazyGenerateHookInstalled?: boolean;\n          __acuCrazyGenerateOriginal?: (...args: unknown[]) => unknown;\n        };\n        if (rootWindow.__acuCrazyGenerateHookInstalled) return;\n        if (!rootWindow.TavernHelper || typeof rootWindow.TavernHelper.generate !== 'function') return;\n\n        rootWindow.__acuCrazyGenerateOriginal = rootWindow.TavernHelper.generate;\n        rootWindow.TavernHelper.generate = async function (...args: unknown[]) {\n          const options =\n            args.length > 0 && args[0] && typeof args[0] === 'object' ? (args[0] as Record<string, unknown>) : null;\n\n          if (options) {\n            const quietPrompt = typeof options.quiet_prompt === 'string' ? options.quiet_prompt : '';\n            const automaticTrigger = options.automatic_trigger === true;\n            const alreadyApplied = options._acu_crazy_applied === true;\n            if (!alreadyApplied && !automaticTrigger && quietPrompt.trim().length === 0) {\n              let originalPrompt = '';\n              const injects = options.injects;\n              if (Array.isArray(injects) && injects.length > 0) {\n                const first = injects[0];\n                if (first && typeof first === 'object') {\n                  const content = (first as Record<string, unknown>).content;\n                  if (typeof content === 'string') originalPrompt = content;\n                }\n              }\n              if (!originalPrompt && typeof options.prompt === 'string') {\n                originalPrompt = options.prompt;\n              }\n              if (!originalPrompt && typeof options.user_input === 'string') {\n                originalPrompt = options.user_input;\n              }\n\n              if (originalPrompt && !hasDiceResultInText(originalPrompt) && shouldTriggerCrazyMode()) {\n                const crazyRollResult = generateCrazyRoll();\n                if (crazyRollResult) {\n                  const mergedPrompt = `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n                  if (Array.isArray(injects) && injects.length > 0) {\n                    const first = injects[0];\n                    if (first && typeof first === 'object') {\n                      (first as Record<string, unknown>).content = mergedPrompt;\n                    }\n                  } else if (typeof options.prompt === 'string') {\n                    options.prompt = mergedPrompt;\n                  } else {\n                    options.user_input = mergedPrompt;\n                  }\n                  options._acu_crazy_applied = true;\n                  lastCrazyPreSendAt = Date.now();\n                  console.info('[DICE]: ');\n                }\n              }\n            }\n          }\n\n          return (rootWindow.__acuCrazyGenerateOriginal as (...args: unknown[]) => unknown).apply(this, args);\n        };\n        rootWindow.__acuCrazyGenerateHookInstalled = true;\n      };\n\n      // []  ( ST  -> )\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      // \n      const evtName =\n        ST?.eventTypes?.MESSAGE_SENT || (window.tavern_events ? window.tavern_events.MESSAGE_SENT : 'message_sent');\n\n      // 1.  ST.eventSource ()\n      if (ST?.eventSource) {\n        ST.eventSource.on(evtName, hideOptionPanel);\n        // [] \n        ST.eventSource.on(evtName, messageId => {\n          // \n          queueCrazyAppend(messageId);\n\n          // DOM\n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            setTimeout(() => {\n              hideDiceResultsInUserMessages();\n            }, 300);\n          }\n        });\n\n        // []  GENERATION_AFTER_COMMANDS \n        const afterCommandsEvtName =\n          ST?.eventTypes?.GENERATION_AFTER_COMMANDS ||\n          (window.tavern_events ? window.tavern_events.GENERATION_AFTER_COMMANDS : 'GENERATION_AFTER_COMMANDS');\n        if (afterCommandsEvtName) {\n          ST.eventSource.on(afterCommandsEvtName, (type, params, dryRun) => {\n            applyCrazyModeToPrompt(type, params, dryRun);\n          });\n        }\n\n        installCrazyGenerateHook();\n        setupSendButtonListener();\n        return;\n      }\n\n      // 2.  eventOn (TavernHelper )\n      if (typeof window.eventOn === 'function') {\n        window.eventOn(evtName, hideOptionPanel);\n        // [] \n        window.eventOn(evtName, messageId => {\n          // \n          queueCrazyAppend(messageId);\n\n          // DOM\n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            setTimeout(() => {\n              hideDiceResultsInUserMessages();\n            }, 300);\n          }\n        });\n\n        // []  GENERATION_AFTER_COMMANDS \n        const afterCommandsEvtName = window.tavern_events\n          ? window.tavern_events.GENERATION_AFTER_COMMANDS\n          : 'GENERATION_AFTER_COMMANDS';\n        window.eventOn(afterCommandsEvtName, (type, params, dryRun) => {\n          applyCrazyModeToPrompt(type, params, dryRun);\n        });\n\n        installCrazyGenerateHook();\n        setupSendButtonListener();\n        return;\n      }\n    };\n\n    // \n    setTimeout(setupOptionHideListener, 2000);\n\n    // [] \n    setTimeout(() => {\n      interceptTextareaValue();\n    }, 500);\n\n    // [] ERA\n    const eventOn = window.eventOn || window.parent?.eventOn;\n    if (typeof eventOn === 'function') {\n      eventOn('era:writeDone', detail => {\n        //  ERA \n        if (typeof MvuModule === 'object' && typeof MvuModule.clearCache === 'function') {\n          MvuModule.clearCache();\n        }\n\n        // ERA\n        const mode = MvuModule.detectMode();\n        if (mode === 'era' && getActiveTabState() === MvuModule.MODULE_ID) {\n          console.log('[DICE]ERA');\n          renderInterface();\n        }\n      });\n    } else {\n      console.warn('[DICE] ERA eventOn ');\n    }\n\n    // [] \n    $(window)\n      .off('beforeunload.acu pagehide.acu')\n      .on('beforeunload.acu pagehide.acu', () => {\n        try {\n          localStorage.setItem(STORAGE_KEY_SCROLL, JSON.stringify(tableScrollStates));\n          if (observer) {\n            observer.disconnect();\n            observer = null;\n          }\n        } catch (e) {}\n      });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  // window.testPairedTableFix()\n  window.testPairedTableFix = function () {\n    // \n    const prefix = 'AM';\n    const startFrom = 1;\n    const columnName = '';\n\n    // 1AM0001, AM0002, (), AM0030, ()\n    // AM0001, AM0002, AM0030\n    const table1Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        ['AM0001', '1', '1'],\n        ['AM0002', '2', '2'],\n        [null, '3-', '3-'], // \n        ['AM0030', '4', '4'],\n        [null, '5-', '5-'], // \n      ],\n    };\n\n    // 2(), AM0002, AM0030, AM0040, AM0050\n    // AM0002, AM0030, AM0040, AM0050\n    const table2Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        [null, 'A-', 'A-'], // \n        ['AM0002', 'B', 'B'],\n        ['AM0030', 'C', 'C'],\n        ['AM0040', 'D', 'D'],\n        ['AM0050', 'E', 'E'],\n      ],\n    };\n\n    // \n    const extract1 = extractCodesFromTable(table1Sheet, columnName, prefix);\n    const extract2 = extractCodesFromTable(table2Sheet, columnName, prefix);\n\n    // \n    const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n    // \n    const rawData = {};\n    const result = alignAndFixPairedTables(\n      table1Sheet,\n      'sheet1',\n      table2Sheet,\n      'sheet2',\n      columnName,\n      mapping,\n      prefix,\n      startFrom,\n      rawData,\n    );\n\n    // \n    const getValidCodes = sheet =>\n      sheet.content\n        .slice(1)\n        .map(r => r[0])\n        .filter(c => c && String(c).match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\d+$`)));\n\n    const codes1 = getValidCodes(table1Sheet);\n    const codes2 = getValidCodes(table2Sheet);\n\n    // \n    const emptyRows1 = table1Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\d+$`)));\n    const emptyRows2 = table2Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\d+$`)));\n\n    // \n    const validateSequence = (codes, prefix, startFrom) => {\n      const numbers = codes\n        .map(c => {\n          if (!c) return null;\n          const match = c.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          return match ? parseInt(match[1], 10) : null;\n        })\n        .filter(n => n !== null);\n\n      for (let i = 0; i < numbers.length; i++) {\n        if (numbers[i] !== startFrom + i) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    const isValid1 = validateSequence(codes1, prefix, startFrom);\n    const isValid2 = validateSequence(codes2, prefix, startFrom);\n\n    // \n    const set1 = new Set(codes1);\n    const set2 = new Set(codes2);\n    const setsEqual = set1.size === set2.size && [...set1].every(c => set2.has(c));\n\n    // \n    const emptyRowsPreserved1 = emptyRows1.some(r => r[1] && r[1].includes(''));\n    const emptyRowsPreserved2 = emptyRows2.some(r => r[1] && r[1].includes(''));\n\n    return {\n      table1Sheet,\n      table2Sheet,\n      result,\n      codes1,\n      codes2,\n      emptyRows1,\n      emptyRows2,\n      isValid1,\n      isValid2,\n      setsEqual,\n      emptyRowsPreserved1,\n      emptyRowsPreserved2,\n      //  +  + \n      isValid: isValid1 && isValid2 && setsEqual && emptyRowsPreserved1 && emptyRowsPreserved2,\n    };\n  };\n\n  // \n  window.diagnoseDiceVariables = async function () {\n    if (typeof MvuModule !== 'undefined' && typeof MvuModule.diagnoseVariableFramework === 'function') {\n      return await MvuModule.diagnoseVariableFramework();\n    } else {\n      console.error('[DICE]MvuModule ');\n      return null;\n    }\n  };\n\n  const { $ } = getCore();\n  if ($) $(document).ready(init);\n  else window.addEventListener('load', init);\n})();\n"],"names":["EMOJI_MAP","LOCATION_EMOJI_MAP","ELEMENT_EMOJI_MAP","RELATION_ICON_MAP","icon","keywords","DATABASE_THEME_MAP","retro","bgNav","bgPanel","border","textMain","textSub","btnBg","btnHover","btnActiveBg","btnActiveText","accent","inputBg","dark","modern","forest","ocean","cyber","nightowl","sakura","minepink","purple","wechat","educational","vaporwave","classicpackaging","galgame","terminal","dreamcore","aurora","chouten","injectDatabaseStyles","themeId","fontFamily","getJQuery","w","jQuery","targets","window","parent","top","filter","v","idx","arr","indexOf","length","t","isDarkTheme","Set","has","stepperSpinFilter","stepperSpinOpacity","stepperColorScheme","css","$","remove","append","e","DB_TOAST_MUTE_STYLE_ID","setDatabaseToastMute","enabled","docs","tryAddDoc","doc","document","includes","push","collectDatabaseToastDocuments","existing","getElementById","style","createElement","id","textContent","head","documentElement","appendChild","querySelectorAll","forEach","node","SCRIPT_ID","PRIMARY_KEYS","getRowKey","tableName","row","headers","pkField","fieldIndex","getDbLockAPI","topWindow","AutoCardUpdaterAPI","getSheetKeyByTableName","api","exportTableAsJson","data","key","startsWith","name","console","warn","findRowIndexByPrimaryKey","sheetKey","primaryKeyValue","sheet","content","Array","isArray","pkIndex","actualValue","eqIdx","substring","i","String","BookmarkManager","STORAGE_KEY_PREFIX","MAX_CONTEXTS","_cache","_currentContextId","_getStorageKey","ctxId","this","getCurrentContextFingerprint","_cleanupOldContexts","prefix","allKeys","localStorage","keyWithTime","map","JSON","parse","getItem","time","_lastAccess","sort","a","b","toDelete","slice","item","removeItem","log","_load","stored","_save","dataToSave","Date","now","setItem","stringify","isBookmarked","rowKey","toggleBookmark","Object","keys","getBookmarks","clearCurrentContext","escapeHtml","s","replace","setupOverlayClose","$overlay","overlayClass","onClose","navigator","maxTouchPoints","on","target","hasClass","mouseDownOnOverlay","showPresetConflictDialog","options","getCore","config","getConfig","suggestedName","baseName","existingNames","counter","newName","generateUniqueName","presetName","$dialog","theme","presetType","cssText","closeDialog","find","click","onCancel","mode","val","onOverwrite","onRename","smartInsertToTextarea","newContent","contentType","$ta","currentVal","trim","normalDiceRegex","contestDiceRegex","actionRegex","placeholderRegex","diceCfg","getDiceConfig","contentToInsert","shouldSaveOriginal","hideDiceResultFromUser","trigger","textarea","_acuOriginalDiceText","_acuHasDiceData","workingText","existingAction","existingDice","existingDiceOriginal","test","originalText","contestMatches","match","normalMatches","actionMatches","userInput","parts","finalVal","join","restoreDiceResultBeforeSend","undefined","restoredVal","removeData","interceptTextareaValue","_acuValueIntercepted","originalDescriptor","getOwnPropertyDescriptor","HTMLTextAreaElement","prototype","originalValue","value","defineProperty","get","call","_value","set","configurable","STORAGE_KEY_TABLE_ORDER","STORAGE_KEY_ACTIVE_TAB","STORAGE_KEY_UI_CONFIG","STORAGE_KEY_LAST_SNAPSHOT","STORAGE_KEY_IS_COLLAPSED","STORAGE_KEY_OPTIONS_COLLAPSED","STORAGE_KEY_DASHBOARD_ACTIVE","STORAGE_KEY_TABLE_HEIGHTS","STORAGE_KEY_TABLE_STYLES","STORAGE_KEY_HIDDEN_TABLES","STORAGE_KEY_REVERSE_TABLES","MIN_PANEL_HEIGHT","MAX_PANEL_HEIGHT","STORAGE_KEY_DICE_CONFIG","STORAGE_KEY_ATTRIBUTE_PRESETS","STORAGE_KEY_ACTIVE_ATTR_PRESET","STORAGE_KEY_ACTION_PRESETS","STORAGE_KEY_ACTIVE_ACTION_PRESET","STORAGE_KEY_CRAZY_MODE","DEFAULT_CRAZY_MODE_CONFIG","crazyLevel","playerWeight","inSceneNpcWeight","offSceneNpcWeight","PRESET_FORMAT_VERSION","compareVersion","v1","v2","normalizeVersion","nv1","nv2","parts1","split","Number","parts2","Math","max","p1","p2","STORAGE_KEY_AVATAR_MAP","STORAGE_KEY_MAP_FOCUS","ConsoleCaptureManager","logs","maxLogs","filters","info","error","originalMethods","isIntercepted","restore","enable","intercept","disable","emergencyBtn","display","type","self","args","apply","capture","timestamp","timeStr","toLocaleTimeString","hour12","arg","stack","Error","logEntry","random","rawArgs","shift","clear","getFilteredLogs","setFilters","ErrorHandler","errorCount","errorThreshold","lastErrorTime","errorWindow","fatalErrorDetected","isFatalError","source","lineno","colno","thirdPartyPatterns","errorInfo","errorSource","pattern","corePatterns","isCoreError","handleError","triggerFatalError","showEmergencyButton","btn","innerHTML","onmouseenter","background","transform","onmouseleave","onclick","showDebugConsoleModal","alert","body","checkAndRestore","onerror","message","addEventListener","event","reason","STORAGE_KEY_REGEX_RULES","STORAGE_KEY_REGEX_PRESETS","STORAGE_KEY_REGEX_ACTIVE_PRESET","STORAGE_KEY_REGEX_ENABLED","BUILTIN_REGEX_RULES","description","operation","flags","global","caseInsensitive","multiline","replacement","scope","priority","executeMode","security","maxMatchTime","maxMatches","maxInputLength","tableNames","STORAGE_KEY_VALIDATION_ENABLED","STORAGE_KEY_VALIDATION_MODE","RULE_TYPE_INFO","tableReadonly","desc","rowLimit","sequence","required","format","enum","numeric","relation","keyValue","BUILTIN_VALIDATION_RULES","builtin","targetTable","targetColumn","ruleType","startFrom","errorMessage","values","min","refTable","refColumn","valueType","valueMin","valueMax","STORAGE_KEY_BLACKLIST","STORAGE_KEY_BLACKLIST_VERSION","DEFAULT_BLACKLIST","BlacklistManager","getBlacklist","Store","storedVersion","defaultItems","mergedItems","setBlacklist","list","resetToDefault","isBlacklisted","blacklist","lastPart","some","STORAGE_KEY_PRESETS","STORAGE_KEY_ACTIVE_PRESET","PresetManager","getAllPresets","_initDefaultPreset","needsSave","preset","version","_compareVersion","customRules","rules","r","existingBuiltinMap","Map","_mergeBuiltinRules","ValidationRuleManager","clearCache","getActivePreset","presets","activeId","p","setActivePreset","createPreset","newPreset","createdAt","toISOString","duplicatePreset","deletePreset","filtered","updatePresetRules","exportPreset","mergePresetWithDefaults","presetId","builtinRuleIds","builtinRuleMap","mergedRules","processedCustomIds","newRule","existingRule","add","rule","importPreset","json","autoMerge","importedVersion","needsMerge","defaultPreset","oldCustom","resetDefaultPreset","_enabledCache","getAllRules","enabledStates","getEnabledStates","allRules","toggleRuleEnabled","ruleId","states","toggleRuleIntercept","getEnabledRules","addCustomRule","removeCustomRule","index","findIndex","splice","updateCustomRule","updates","getRule","getRulesByTable","RegexTransformationManager","_generateId","toString","substr","_saveEnabledStates","getApplicableRules","columnName","columnNames","testCases","updatedAt","_syncRulesToActivePreset","activePreset","RegexPresetManager","removeRule","updateRule","storedRules","storedRuleIds","missingBuiltinRules","sourcePresetId","sourcePreset","exportData","jsonString","RegexTransformationEngine","_regexCache","_buildFlags","result","unicode","sticky","_getRegex","hasLookbehind","hasLookahead","flagsStr","cacheKey","regex","lastIndex","RegExp","_scoreRegexComplexity","score","captureGroups","_getTimeoutForRule","complexity","baseTimeout","_safeReplace","oldValue","success","newValue","matched","timeout","startTime","elapsed","applyToValue","strValue","extracted","_extractFlags","patternWithoutFlags","patternStr","inlineFlagMatch","flagStr","applyToTable","tableData","totalApplied","errors","modifiedSheetKeys","isSimpleFormat","sheetMap","simpleTable","contentRowIndex","dataObj","size","tableInfo","entries","tableModified","rows","rowIndex","colIndex","debug","tableError","errorMsg","applyToCell","applicableRules","currentValue","wasMatched","applyToRow","cell","previewBatchTransform","results","affectedCells","totalAffected","columnIndex","clearRegexCache","ValidationEngine","findColumnIndex","exactIndex","header","validateFormat","validateEnum","allowedValues","validateNumeric","strVal","numVal","endsWith","parseFloat","isNaN","validateRelation","rawData","refSheet","sheetId","columns","col","refColIndex","validateRequired","validateKeyValue","ruleConfig","processedValue","pairs","pair","colonIndex","validateTableReadonly","oldContent","validateRowLimit","rowCount","validateSequence","numbers","allRowValues","rawValue","escapedPrefix","num","parseInt","n","expectedNum","checkTableRules","snapshot","newData","violations","typeInfo","oldSheet","newSheet","padStart","rowIdx","validateValue","validateRow","rowTitle","ruleName","severity","validateAllData","allErrors","tableRules","fieldRules","rowErrors","validateTable","targetSheet","groupErrorsByTable","grouped","getErrorCount","LocalAvatarDB","DB_NAME","STORE_NAME","DB_VERSION","_db","_urlCache","init","Promise","resolve","reject","request","indexedDB","open","onsuccess","onupgradeneeded","db","objectStoreNames","contains","createObjectStore","keyPath","save","blob","store","transaction","objectStore","URL","revokeObjectURL","delete","put","url","createObjectURL","getKey","getAllNames","getAllKeys","getStats","getAll","items","totalSize","reduce","sum","count","totalSizeMB","toFixed","clearAll","FavoritesDB","update","updated","getAllTags","tagSet","tags","tag","from","getByTag","FavoritesManager","addFavorite","tableUid","rowData","chatId","SillyTavern","getCurrentChatId","crypto","randomUUID","sourceInfo","updateFavorite","duplicateFavorite","original","copy","deleteFavorite","addTag","removeTag","async","findCompatibleTables","favorite","currentTables","uid","table","tableHeader","h","isStrict","every","matchedCols","unmatchedCols","matchRatio","mapRowToTable","targetHeader","newRow","srcIndex","exportFavorites","exportedAt","importFavorites","jsonStr","added","newItem","getPlayerName","cachedRawData","getTableData","getPersonaName","getContext","ctx","name1","$persona","first","text","getDisplayPlayerName","replaceUserPlaceholders","displayName","AvatarManager","load","raw","offsetX","offsetY","scale","aliases","getAsync","playerName","isPlayer","localUrl","userLocalUrl","primaryName","getPrimaryName","aliasLocalUrl","hasLocalAvatar","getOffsetX","_resolveByAlias","getOffsetY","getScale","setPosition","setScale","setAliases","exportTime","avatars","importData","jsonData","overwriteConflicts","current","stats","skipped","imported","analyzeImport","valid","total","newItems","conflicts","getEmojiCandidates","lowerName","toLowerCase","candidates","emoji","getElementEmoji","lowerType","MvuModule","MODULE_ID","cachedEraData","cachedEraDataChatId","getCurrentChatIdSafe","ST","clearMvuCacheIfChatChanged","isLwbChatContext","lwbGuard","globalThis","LWB_Guard","chatMetadata","eventEmit","eventOn","variablesUnknown","variables","ERAMetaData","stat_data","Mvu","getMvuData","mvuData","message_id","k","hasEraDataInCurrentChat","detectMode","_source","eraFrameworkExists","parseJsonSafe","trimmed","getLwbData","parsed","display_data","delta_data","getEraData","timeoutId","setTimeout","eventOff","onResult","detail","clearTimeout","statData","statWithoutMeta","schema","isAvailable","getData","lwbData","allVars","getMvuDataWithRetry","maxRetries","retryDelay","race","waitGlobalInitialized","_","attempt","isVWD","isSimpleArray","countChildren","extractNumericDisplayValue","str","rangeMatch","slashNumericMatch","commaDescMatch","numericDescMatch","extractFirstNumericValue","displayValue","renderRow","path","deltaData","changeIndicator","part","oldVal","newVal","getChangeIndicator","changedClass","valueClass","diceIconHtml","isNumericCell","numericValue","attrName","pathParts","renderCard","depth","defaultExpanded","isHorizontal","childCount","collapsedClass","bodyHtml","hasNestedCards","nestedCardCount","childKey","childValue","childPath","itemPath","countText","bodyClass","nestedCardsNeedWidth","getDataWithRetry","detection","eraData","detectModeWithData","diagnoseVariableFramework","era","available","dataAvailable","mvu","apiExists","getDataExists","cache","hasCache","cacheKeys","recommendation","injectStyles","targetDoc","styleEl","renderNavButton","isActive","renderPanel","varMode","isEraMode","isNumericMode","layoutMode","panelTitle","numericHtml","visibleLevels","saved","numericItems","collectNumericItems","obj","levelNames","itemValue","numValue","newLevelNames","topKeys","filteredNumericItems","nonArrayLevels","level","levelKey","allLevelNames","levelNamesArray","levelTogglesHtml","levelButtonsHtml","levelName","isVisible","itemsHtml","pathLevels","hierarchyLevels","allLevelsVisible","pathDisplay","finalAttrName","displayStyle","levelsJson","renderNumericMode","cardsHtml","bindEvents","$container","$panel","off","stopPropagation","$card","closest","$body","is","hide","removeClass","addClass","slideDown","slideUp","refresh","newMode","saveActiveTabState","currentTab","getActiveTabState","renderInterface","toastr","toggleClass","$button","color","borderColor","opacity","attr","each","$item","levels","newPathDisplay","$value","showEditDialog","setValue","preventDefault","$icon","attrValue","showDicePanel","targetValue","targetName","initiatorName","fromMvu","parsedInfo","initiator","filteredParts","parseMvuPathForDice","mvuPath","mvuParsedInfo","$doc","touchStartX","touchStartY","isHorizontalSwipe","originalEvent","touches","clientX","clientY","touch","deltaX","abs","deltaY","stopImmediatePropagation","$input","focus","button","handle","setPointerCapture","pointerId","startHeight","height","startY","onpointermove","moveE","dy","newHeight","onpointerup","upE","releasePointerCapture","getTableHeights","saveTableHeights","heights","onSave","html","select","ctrlKey","parsePath","rootName","subPath","setLwbValue","saveMetadata","parsedValue","onWriteDone","setEraValue","setMvuVariable","is_recursive","replaceMvuData","isModuleTab","$refreshBtn","then","canWriteMvuPanel","actualData","warning","catch","err","DEFAULT_DICE_CONFIG","critSuccessMax","hardSuccessDiv","difficultSuccessDiv","critFailMin","lastDiceType","dndCritSuccess","dndCritFail","contestTieRule","hideDiceResultInChat","autoMergeProtagonist","saveDiceConfig","cfg","oldCfg","newCfg","changedKeys","hideDiceResultsInUserMessages","hideInput","hideChat","textareaVal","modifiedText","contestRegex","normalRegex","lastMessageId","getLastMessageId","userMessages","getChatMessages","role","hiddenCount","msg","$msgElement","retrieveDisplayedMessage","$mesText","currentDomText","currentHtml","modifiedHtml","contestPattern","normalPattern","restoredCount","BUILTIN_ATTRIBUTE_PRESETS","baseAttributes","formula","range","modifier","specialAttributes","AttributePresetManager","presetVersion","finalId","updateTemplateForActivePreset","updatePreset","exported","autoUpdate","needsUpdate","DEFAULT_SPECIAL_ATTR_TEMPLATE","example1","example2","example","DEFAULT_VIRTUAL_PRESET","attrs","generateRPGAttributes","baseRangeMin","baseRangeMax","specialRangeMin","specialRangeMax","baseRanges","specialRanges","baseEntries","base","specialEntries","special","baseExampleStr","specialExampleStr","dbApi","getDB","getTableTemplate","template","protagonistBaseExampleRegex","protagonistBaseRangeRegex","protagonistSpecialExampleRegex","protagonistSpecialSingleExampleRegex","protagonistSpecialRangeRegex","npcBaseRangeRegex","npcBaseExampleRegex","npcSpecialExampleRegex","npcSpecialRangeRegex","attributeScaleRegex","newAttributeScale","threshold1","floor","threshold2","threshold3","threshold4","threshold5","formatRange","start","end","generateAttributeScale","modified","protagonistSheet","sheet_protagonist","sourceData","note","originalNote","attrs2","specialExample2Str","defaultRange","defaultEx1","defaultEx2","npcSheet","sheet_important_npc","defaultEx","importTemplateFromData","BUILTIN_ACTION_PRESETS","table_keywords","actions","label","ActionPresetManager","getPresetById","getActivePresetId","setActivePresetId","getCrazyModeConfig","saveCrazyModeConfig","shouldTriggerCrazyMode","selectCrazyParticipant","allTables","processJsonData","playerResult","DashboardDataParser","findTable","npcResult","playerAttrs","getFullAttributesForCharacter","inScene","weight","parseRows","npc","inSceneVal","isInScene","npcAttrs","totalWeight","weightedRandomSelect","selectCrazyAttribute","participant","randomAttr","allPresetAttrs","randomPresetAttr","defaultValue","skillPool","getRandomSkillPool","crazyRollD100","judgeCrazyRollResult","roll","generateCrazyRoll","contestChance","selectCrazyRollType","participant1","participant2","candidate","attr1","attr2","roll1","roll2","result1","result2","margin1","margin2","winner","rollDiceExpression","expr","NaN","countStr","sidesStr","keepDrop","sides","rolls","rollDice","kd","evaluateFormula","context","varNames","Function","round","generateAttributeValue","DASHBOARD_TABLE_CONFIG","tableKeywords","detailLocation","fallbackIndex","currentLocation","player","status","position","isMultiple","money","resources","location","quest","progress","active","column","excludeColumn","excludes","bag","skill","equip","isEquipped","equipped","moduleKey","keyword","columnKey","moduleConfig","colConfig","kw","getValue","getColumnMap","colKey","tableResult","colMap","_rowIndex","_raw","colIdx","applyFilter","parsedRows","filterKey","matchInclude","inc","excludeValue","matchExclude","exc","DEFAULT_GM_CONFIG","diceSystem","showDiceIcon","autoSendPrompt","action_groups","auto_send","getResultBadgeClass","resultType","classMap","critSuccess","extremeSuccess","failure","critFailure","ACTION_ICON_MAP","getActionsForTable","baseConfig","action_rules_disabled","customActionGroups","action","custom_action_groups","getGMConfig","group","builtinRules","getInteractOptionsForRow","defaultActions","interactColIdx","invalidValues","cellValue","interactOptions","existingLabels","newActions","opt","extractNumericValue","matches","parseAttributeString","rawStr","jsonObj","parseRelationshipString","colonMatch","parenMatch","isRelationshipCell","headerName","lowerHeader","processTemplate","cardData","ACTION_BUTTONS","title","isInitialized","isSaving","saveQueue","isEditingOrder","isSettingsOpen","currentDiffMap","observer","_boundRenderHandler","hasUnsavedChanges","pendingDeletions","getPendingDeletions","isAutoTransforming","tablePageStates","tableSearchStates","lastOptionHash","optionPanelVisible","STORAGE_KEY_SCROLL","tableScrollStates","UpdateController","_lastValidationCount","_isRollingBack","handleUpdate","loadSnapshot","fillTable","timeOut","positionClass","fillError","newCount","updateValidationIndicator","$indicator","show","DEFAULT_CONFIG","layout","collapseStyle","collapseAlign","cardWidth","fontSize","highlightNew","itemsPerPage","actionsPosition","gridColumns","positionMode","showOptionPanel","clickOptionToAutoSend","optionFontSize","muteDatabaseToasts","FONTS","THEMES","_coreCache","core","clipboard","updateSaveButtonState","$btn","deletions","hasDeletions","getIconForTableName","getBadgeStyle","def","retryErr","_acuQuotaAlerted","clearAllPanelStates","getSavedTableOrder","saveTableOrder","getCollapsedState","saveCollapsedState","getOptionsCollapsedState","currentCtx","_contextId","saveSnapshot","getTableStyles","getHiddenTables","getReverseTables","toggleTableReverse","getAttributesForCharacter","characterName","isUser","sheetName","nameColIdx","getAttributeValue","found","STANDARD_ATTRS","getStandardAttrs","allAttrs","allPresets","RANDOM_SKILL_POOL","isDNDOrPreset","isDND","generate3d6","generateValue","adjust","baseResult","specialResult","clearPresetAttributesForCharacter","charName","targetRowIndex","targetColIndex","existingStr","existingAttrs","standardAttrs","presetAttrNames","newAttrString","saveDataOnly","attrString","writeAttributesToCharacter","newAttrs","existingMap","standardCount","isComplete","customAttrs","resultParts","writtenAttrs","wasComplete","initCustomDropdown","inputId","wrap","$dropdown","after","renderItems","lowerFilter","hideDropdown","addClearButton","inputSelector","$clearBtn","showDiceSettingsPanel","ruleTitle","resetText","defaults","critFail","hardDiv","extremeDiv","currentCritSuccess","currentCritFail","currentHardDiv","currentExtremeDiv","tieRule","cocExtraHtml","panelHtml","left","right","bottom","width","padding","closePanel","$stepper","step","updateValue","getCurrentValue","getStepperValue","critSuccessVal","critFailVal","hardDivVal","extremeDivVal","resetStepper","savedDiceType","rawDataForList","diceCharacterList","diceAttrList","diceType","successCriteria","initialAttrValue","initialTargetValue","overlay","defaultCriteria","panel","buildAttrButtons","$parentSection","prop","originalHtml","originalHandler","generated","baseAttrs","specialAttrs","confirm","shortName","buildCharButtons","randomSkill","newAttrList","convertTargetForDice","currentTarget","fromDice","toDice","getMaxRoll","dice","fromMax","toMax","ratio","updateRuleMode","$targetInput","$difficultyWrapper","$row3","currentDiceType","newDice","suggestedCriteria","currentTargetVal","convertedVal","newMax","customDice","lastDiceRollAt","performDiceRoll","mod","modStr","isFinite","remaining","dicePattern","exec","diceResult","numberPattern","numMatch","parseModifier","criteria","difficulty","targetInputVal","attrInputVal","isAutoTarget","getDefaultTarget","formulaStr","maxRoll","parsedTarget","finalValue","requiredTarget","difficultyLabel","difficultyDiv","isCritSuccess","isCritFailure","isSuccess","outcomeText","outcomeClass","extremeTarget","hardTarget","criteriaSymbol","displayOutcomeText","badgeClass","$rollBtn","judgeExpr","checkResult","checkResultWithTimestamp","checkHistory","MAX_HISTORY","emitEvent","attrValueInput","currentDice","initiatorNameVal","showContestPanel","initiatorValue","currentCriteria","opponentName","passedInitiatorName","passedInitiatorValue","passedOpponentValue","opponentValue","opponentAttrs","characterList","contestAttrList","attrStr","targetType","buildCharBtns","containerId","rebuildAttrBtns","aname","refreshedAttrs","initAttrs","oppAttrs","fullAttrs","getSuccessLevel","lastContestRollAt","performContestRoll","$row","initValue","initName","initAttrName","getHalfMax","m","initValueInput","initTarget","initTargetInput","oppValue","oppName","oppAttrName","oppValueInput","oppTarget","oppTargetInput","winnerResultType","initResult","oppResult","initSuccess","oppSuccess","displayInitValue","displayOppValue","displayInitSuccessName","displayOppSuccessName","displayWinner","getResultTypeFromSuccess","initResultType","oppResultType","initBadgeClass","oppBadgeClass","winnerColorClass","$resultDisplay","$resultInit","$resultOpp","contestResultText","contestResultWithTimestamp","attribute","successLevel","contestHistory","currentInitName","parseInSceneStatus","buildMapViewModel","globalResult","locationResult","elementResult","globalHeaders","globalRow","globalConfig","detailIdx","regionIdx","currentRegion","locations","locationHeaders","locationRows","locationNameIdx","locationRegionIdx","locationTypeIdx","locationDescIdx","locationImportanceIdx","locationExploreIdx","allLocationNames","emojiMap","names","candidatesMap","sortedNames","localeCompare","usedEmojis","resolveBatchLocationEmojis","region","locationType","importance","exploreStatus","tableKey","elements","elementHeaders","elementRows","elementNameIdx","elementTypeIdx","elementLocationIdx","elementDescIdx","elementStatusIdx","elementInteractIdx","locationName","rawInteractions","interactions","Boolean","typeValue","element","addElement","characters","addCharacter","character","avatarUrl","full","avatarOffsetX","avatarOffsetY","avatarScale","playerLocation","playerConfig","playerHeaders","playerRow","playerNameIdx","playerPosIdx","playerNameRaw","playerPosRaw","npcConfig","npcHeaders","npcRows","npcNameIdx","npcPosIdx","npcInSceneIdx","npcName","inSceneValue","inSceneHeader","firstLocation","next","allRegions","l","otherIndex","focusLocation","fallbackRegion","regionLocations","regionName","scoreA","getHotLocationsInRegion","isMapOpening","showMapVisualization","viewModel","tabSelectionCache","selectedRegion","targetLocation","overlayEl","setProperty","$focusArea","$thumbnails","renderIconContent","renderElementChip","refreshPanel","model","leftChars","ceil","rightChars","leftElems","rightElems","renderAvatarHtml","char","avatarStyle","charAt","leftAvatarsHtml","rightAvatarsHtml","leftElemsHtml","rightElemsHtml","emojiHtml","renderFocusArea","thumbnails","totalCount","badgeHtml","renderThumbnailLocation","regions","newViewModel","newFocus","newRegion","regionLocs","loc","firstLoc","cachedLocation","hotLocations","fallbackFocus","targetRegion","showRelationshipGraph","npcTable","nameIdx","relationIdx","npcTableKey","nodes","edges","resolveName","personaName","explicitUserVariants","isExplicitUserVariant","isPersonaName","isPlayerName","resolveUserPlaceholder","resolvedPlayerName","playerTableKey","x","y","inSceneColIdx","rawNpcName","relationStr","rel","resolvedRelName","relRowIndex","relIsInScene","ri","cleanedLabels","rawRel","commonRelations","specialSuffixMatch","lastChars","cleanRelation","existingEdge","combined","labelsFromSource","labelsFromTarget","nodeArr","connectionCount","edge","isMobileView","innerWidth","baseRadius","maxRadius","playerBaseRadius","radiusPerConnection","nodeSizeMultiplier","filterInScene","filterDirectOnly","getNodeRadius","nodeName","sqrt","radius","getLayoutCacheKey","loadLayoutCache","cached","layoutData","allNodesFound","vx","vy","runForceDirectedLayout","angle","PI","dist","cos","sin","nodeMap","iter","u","j","dx","distSq","force","fx","fy","maxSpeed","vMag","saveLayoutCache","panX","panY","$svg","$transform","$edgesGroup","$nodesGroup","$zoomDisplay","$nodeSizeDisplay","$wrapper","updateTransform","updateNodeSizeDisplay","zoomTo","newScale","centerX","centerY","oldScale","scaleChange","render","filteredNodes","directNodes","passInScene","passDirectOnly","getFilteredNodes","filteredNodeNames","filteredEdges","edgesHtml","edgeIdx","len","nx","ny","px","py","hasFromSource","hasFromTarget","sourceRadius","targetRadius","x1","y1","x2","y2","srcLabels","tgtLabels","srcSet","tgtSet","commonLabels","srcUnique","tgtUnique","markerStart","markerEnd","midX","midY","lineLen","renderRelationIconInline","iconStr","addRelationIconInline","lbl","offsetDir","offsetDist","lx","ly","safeOffset","renderRelationIcon","addRelationIcon","truncateLabel","maxLen","truncated","createLabelHtml","labelsToShow","labelBaseX","labelBaseY","perpOffset","nodesHtml","nodeAvatar","indicatorRadius","indicatorOffset","inSceneIndicator","nodeDisplayName","scaleVal","foSize","shadowWidth","foOffset","highlightNode","connectedNodes","otherNode","connectedEdgeIndices","clearHighlight","matchMedia","currentHighlightedNode","$node","startX","hasMoved","longPressTriggered","longPressTimer","vibrate","rowName","tempNode","isPanning","panStartX","panStartY","panStartPanX","panStartPanY","lastPinchDist","activePointerId","wrapperEl","svgEl","onpointerdown","cursor","rect","getBoundingClientRect","onpointercancel","onwheel","delta","hypot","passive","newDist","$nodeSizeSlider","$sliderSizeDisplay","$sliderContainer","$nodeSizeDisplayTrigger","sliderVisible","sliderHideTimer","hideSlider","resetSliderHideTimer","triggerRect","wrapperRect","showSlider","$filterInSceneBtn","$filterDirectOnlyBtn","updateFilterToggleStyles","$nodeSizeStepper","updateNodeSizeValue","newPercent","getCurrentPercent","clearLayoutCache","showAvatarManager","closeGraph","showAvatarCropModal","imageSource","modalHtml","$modal","$image","containerEl","imageEl","updateImageStyle","backgroundSize","backgroundPosition","isDragging","startOffsetX","startOffsetY","sensitivity","pinchStartScale","pinchRatio","file","files","saveLocalAvatar","newUrl","onUpdate","currentView","sortBy","sortOrder","searchQuery","expandedItems","isInitialLoad","resolveUserPlaceholderForAvatar","buildList","listHtml","allAvatarData","workingNodes","seenNames","merged","userNode","otherNodes","query","nameMatch","aliasMatch","alias","nodeSourceMap","hasLocal","hasUrl","getSourcePriority","cmp","timeA","timeB","userNodeForDisplay","currentUrl","displayUrl","sourceLabel","hasAvatar","isExpanded","applyAvatarPreviewStyles","$root","$preview","managerHtml","$manager","bindAvatarEvents","refreshItem","refreshList","findCharacterInTable","avatarData","allNames","nameColumns","findRelationshipReferences","references","tKey","tData","nameColIndex","relationColIndex","rowCharacterName","relationValue","splitResult","refName","relationWord","relationText","matchedRelation","showDeleteConfirmModal","onConfirm","tableRow","relationships","avX","avY","avScale","aliasRows","lowerAliases","closeModal","handleKeydown","executeCharacterDelete","deleteLocalAvatar","newView","debouncedSearch","debounce","toggle","newDir","exists","tagHtml","before","prev","pop","cleanPart","pastedData","clipboardData","pendingAlias","Blob","href","download","removeChild","reader","FileReader","onload","evt","analysis","showImportConfirmDialog","readAsText","closeManager","showManualUpdateDialog","cacheNames","caches","urlPatterns","cacheName","requests","clearDiceSystemCache","reload","onComplete","hasConflicts","conflictListHtml","overwrite","showCardEditModal","displayRow","inputsHtml","dialog","adjustHeight","el","contentHeight","scrollHeight","overflowY","requestAnimationFrame","currentRow","hasChanges","saveRowInstantly","_configCache","saveConfig","fontVal","applyConfigStyles","generateDiffMap","currentData","lastData","diffSet","rIdx","newRows","oldRows","oldRowMap","matchedOldIndices","matchedOldRow","oldRow","cIdx","oldCell","f","$styleTag","fontImport","cssVars","cls","$optContainer","addStyles","_acuStylesInjected","styles","sheetCount","getDbChatMessages","st","rawChat","chat","parseIsolatedData","hasSheetKeys","hasDbPayload","TavernDB_ACU_IndependentData","TavernDB_ACU_Data","TavernDB_ACU_SummaryData","isolated","TavernDB_ACU_IsolatedData","tagData","independentData","findLatestDbMessageIndex","includeUser","is_user","relocateDbPayloadToAnchor","anchorIndex","latestIndex","moved","sourceIsolated","targetIsolated","isolationKey","TavernDB_ACU_Identity","identity","hasOwnProperty","resolveIsolationKey","nextSource","TavernDB_ACU_ModifiedKeys","TavernDB_ACU_UpdateGroupKeys","triggerSlash","saveDataToDatabase","skipRender","commitDeletes","$saveBtn","mate","sizeInMB","stringifyError","importTableAsJson","apiError","acuModifiedSet","saveOperation","newRowData","tables","rawContent","exportConfig","updateConfig","refreshRegexRulesList","$rulesList","scopeIcon","scopeText","showAddValidationRuleModal","parentDialog","editRuleId","currentThemeClass","isEditMode","updateSelectColor","$select","$colSelect","$pairedTableSelect","currentPairedValue","empty","refTableName","$refColSelect","isTableRule","valuesStr","refColumns","selectedColumns","pairedTable","finalRuleId","ruleData","$existingItem","isEnabled","ruleHtml","showSmartFixModal","snapshotValue","hasSnapshotValue","showTableRuleFixModal","inputHtml","smartSuggestHtml","examples","currentRowIndex","maxCount","getColumnExamples","tableContent","suggestedValue","existingValues","prefixMatch","digits","codeIndex","existingNumbers","codeValue","maxNum","nextNum","numOnlyMatch","suggestFormatValue","currentNum","isOutOfRange","nearestValid","getNearestValidNumber","getRelationOptions","hasMultipleColumns","currentInvalidValue","valueExists","isValueInRelationTable","optionsHtml","reverseWriteHtml","issues","fixedPairs","fixedVal","hasIssue","originalVal","fixedValue","hasIssues","issuesHtml","issue","optionValue","refSheetId","targetColIdx","fill","extractCodesFromTable","codes","allCodes","codeToRows","isValid","buildCodeMapping","codes1","codes2","allUniqueCodes","codeNumbers","code","mapping","oldCode","newCode","alignAndFixPairedTables","table1Sheet","table1SheetId","table2Sheet","table2SheetId","fixedCount1","fixedCount2","headers1","rows1","colIndex1","headers2","rows2","colIndex2","reverseMapping","sortedNewCodes","analyzeTable","codeRows","emptyRows","prevOldCode","nextOldCode","emptyRow","prevCode","nextCode","codeRow","analysis1","analysis2","buildNewRows","allOldCodes","codeRowMap","cr","isCodeRow","isInserted","codeRowIndex","nextNewCode","currentNewCode","currentOldCode","newRows1","newRows2","countCodeChanges","oldAnalysis","oldCodes","newCodes","contentHtml","actionBtns","changeCount","changeDetails","c","d","minRows","maxRows","currentRowCount","excessRows","isTooMany","isTooFew","fixSuggestions","originalRowIndex","numCountMap","duplicates","gaps","outOfOrder","actualNum","rowNum","occurrences","issueSet","g","o","fix","pairedTableAttr","pairedTableName","targetSheetId","pairedSheet","pairedSheetId","pairedHeaders","extract1","extract2","fixedCount","startRow","showBlacklistManagerModal","updateTextarea","uniqueItems","syncFromTextarea","input","existingSet","addedItems","which","showAttributePresetManager","allPresetsHtml","isBuiltin","showSettingsModal","$toggle","$thisToggle","showAttributePresetEditor","filename","defaultPresetData","copyData","parsedData","importingName","existingPresets","hasConflict","doImport","finalJson","existingPreset","isEdit","defaultData","$jsonTextarea","updateJSON","showActionPresetManager","presetsHtml","keywordsSummary","flatMap","actionsSummary","showActionPresetEditor","accept","onchange","not","savedFilters","renderLogs","filteredLogs","$logContainer","typeColors","typeIcons","logItem","updateCounts","checked","$status","newState","line","toUpperCase","TavernHelper","safeContent","isSecureContext","writeText","textArea","setAttribute","setSelectionRange","successful","execCommand","refreshInterval","setInterval","clearInterval","showAddRegexRuleModal","editRule","scopeType","$textarea","extractedFlags","$flagGlobal","$flagIgnoreCase","$flagMultiline","uiFlags","finalPattern","finalFlags","rootWindow","resolveRootWindow","readyCallbacks","isAcuDiceReady","runReadyCallback","callback","defineAcuDiceOnWindow","AcuDiceAPI","writable","dispatchReadyEvent","dispatchEvent","CustomEvent","eventHandlers","handlers","handler","breakdown","check","rollResult","finalRoll","criticalSuccess","criticalFailure","hardSuccess","margin","onReady","getLatestCheck","getLatestContest","getHistory","limit","concat","_type","listCharacters","getCharacterAttributes","checkByCharacter","contest","leftTarget","rightTarget","leftResult","rightResult","sidesMatch","leftSuccessLevel","rightSuccessLevel","notifyReady","showFavoriteEditModal","fav","overlayHtml","newRowHtml","newHeader","newTags","showSendToTableModal","compatible","onSuccess","tableListHtml","modeLabel","unmatchedInfo","unmatchedCount","expandedGroups","isGroupExpanded","groupId","SPECIAL_BUTTONS_CONFIG","tableManagerHtml","savedOrder","hiddenList","allItems","isSpecial","orderMap","isHidden","specialClass","chevron","hasIntercept","$group","$chevron","expanded","targetHeight","animate","currentHeight","outerHeight","newTheme","crazyConfig","selectValue","initCrazyModeUI","newStyle","$alignRow","$list","dragState","timer","clearDragState","startDrag","targetItem","insertBefore","$dragged","$target","insertAfter","newOrder","unit","isCurrentlyActive","fadeOut","refreshPresetUI","prompt","currentState","currentPreset","$presetSelect","defaultPresetId","unshift","versionSuffix","tavernRegexList","scriptName","findRegex","importedCount","skippedCount","processNext","convertedRule","tavernRegex","parseTavernFindRegex","extraInfo","placement","markdownOnly","promptOnly","minDepth","maxDepth","replaceString","disabled","runOnEdit","convertTavernRegexToRule","oldRule","renderInterfaceTimer","renderInterfacePending","saveCurrentTabState","_renderInterfaceImpl","$chat","mutationLock","MutationObserver","lastChild","children","last","wrapper","observe","childList","isDataFromDatabase","enabledRules","transformResult","transformError","structuredClone","existingSnapshot","hasValidSnapshotData","$searchInput","activeTab","currentTabName","newHtml","renderTableContent","$virtualDom","replaceWith","bindOptionEvents","lastScrollX","lastScrollY","$oldContent","scrollLeft","scrollTop","orderedNames","isCollapsed","layoutClass","finalGridCols","empty3","optionHtml","currentOptionHash","optionTables","isOptionsCollapsed","collapseIcon","optionCount","hasBtns","optionValues","buttonsHtml","cellStr","encodeURIComponent","optionChanged","colStyleClass","alignClass","savedHeight","isDashboardActive","isChangesPanelActive","isMvuActive","finalSavedHeight","renderChangesPanel","renderDashboard","gridFixStyle","isChangesActive","isFavoritesActive","isSimpleModeNav","changesCount","validationErrorCount","oldRowsByTitle","queue","hasChange","newTitleCounts","oldTitleCounts","oldCount","emptyOldCount","emptyNewCount","displayCount","showWarningIcon","navHiddenList","navSavedOrder","SPECIAL_NAV_ITEMS","extraClass","warningIcon","allNavItems","checkAvailable","activeClass","orderVal","warningIconHtml","$existing","insertHtmlToPage","injectIndependentOptions","$lastAiMes","$this","containerVisible","containerDisplay","containerHtmlLength","bindChangesEvents","$newContent","savedState","inner","$targetTitle","htmlContent","$aiMes","$targetMes","$targetText","$targetBlock","getTargetContainer","optConfig","decodeURIComponent","createChatMessages","executeSlashCommandsWithOptions","cmd","sendResult","isError","isAborted","ta","sendBtn","enterEvent","Event","keyCode","bubbles","$textDiv","hasImage","targetIndex","eq","$oldWrapper","validationErrors","changes","oldRowIndex","rowChanges","changedFields","processedTitles","deletedCount","isValidationMode","groupedErrors","collapsedGroups","tableErrors","groupedChanges","tableChanges","change","oldShort","newShort","fieldDisplay","fieldCount","fieldNames","moreText","validationItemTouchStartPos","$targetCard","scrollIntoView","behavior","block","storageKey","changeType","refreshChangesPanel","restoredRow","showRowCompareEditModal","showChangeSingleFieldModal","showChangeEditModal","restoredData","updateChangesCount","finalHeight","$horizontalScroller","_touchStartX","_touchStartY","_scrollDirection","$span","hasOldValue","fieldsHtml","isChanged","questResult","bagResult","skillResult","equipResult","playerParsed","allAttrsStr","playerRows","globalDetailLocation","globalLocation","locIdx","currentPlaceName","npcTableName","npcParsed","inSceneNPCs","offSceneNPCs","npcData","allNPCs","questTableName","questParsed","questStatusOrder","questTypeOrder","questPriorityOrder","parseProgress","activeTasks","q","aStatusOrder","statusDiff","typeDiff","priorityDiff","bagTableName","bagParsed","bagItems","skillTableName","skillParsed","skills","equipTableName","equipParsed","equippedItems","locationTableName","locationTableKey","locationParsed","resourcesStr","parsedResources","res","skillValue","hasNumeric","skillRowIndex","areaName","isCurrent","iconHtml","npcIdx","isLastNpc","npcAvatar","offSceneFilter","isLastBag","isLast","isMain","progressPercent","progressMatch","progressBar","loadedModules","renderFavoritesPanel","allFavorites","allTags","groupedByTag","untagged","renderFavoriteCard","rowsHtml","cleanHeader","tagsHtml","bindFavoritesEvents","panelEl","_favSwipeFixApplied","onTouchStart","onTouchMove","onTouchEnd","removeEventListener","$dataArea","groupTitle","searchTerm","cardText","showFavCardMenu","cardId","backdrop","menu","winWidth","winHeight","mWidth","outerWidth","mHeight","posX","posY","getById","existingMenu","dbLockApi","lockState","getTableLockState","isGridMode","titleColIndex","processedRows","originalIndex","isReversed","isTableReversed","titleA","titleB","aHitTitle","bHitTitle","totalItems","totalPages","currentPage","startIdx","endIdx","rowsToRender","showReverseBtn","shouldShowReverseButton","reverseBtnHtml","realRowIdx","cardTitle","showDefaultIndex","titleCellId","isTitleModified","isRowNew","rowClass","cardLockRowKey","cardRowIndex","isCardRowLocked","isTitleCellLocked","cells","validColIndices","isOddValidCount","cardBody","spanFullRow","rawHeaderName","isThisCellLocked","isThisFieldLocked","safeStr","rawStrOriginal","invalidPlaceholders","hideLabel","splitRegex","isIdentityField","parsedAttrs","badgeStyle","displayCell","validRelations","relHtml","attrsHtml","showDice","invalidTagValues","isDiffChanged","cellId","isUserModified","cellHighlight","tableActions","actionsHtml","act","actIdx","isTitleLocked","cardBookmarkRowKey","bookmarkIcon","$content","innerScrolls","switchPanel","updateContentFn","dataError","managerError","scrollTimer","$navBtn","isPanelVisible","mvuSavedHeight","currentActiveTab","$cell","showCellMenu","$pageBtn","newPage","topWin","openVisualizer","openNewVisualizer_ACU","manualUpdate","openSettings","searchTimeout","isComposing","selectionStart","selectionEnd","isFocus","activeElement","classList","$newInput","tName","actionIdx","$title","skillName","checkValue","attrValIdx","profIdx","promptText","sendMessage","ev","isPlayerTable","playerAttrValue","itemName","taskName","npcAttrValue","npcParts","npcMatch","lockRowKey","dbRowIndex","relations","borderStyle","cardHtml","$previewOverlay","isModified","currentHeader","isFieldLocked","hasAnyLockInRow","cellKey","lockMenuHtml","changedTouches","closeAll","dbColIndex","lockTableCell","lockTableRow","currentLockState","rowPrefix","cellColIndex","fallbackCopy","rowDataValues","tagInput","$displayTarget","$panelContent","savedScrollTop","savedScrollLeft","$mapOverlay","isFromMap","refreshMapData","colCount","showConflictDialog","$conflictOverlay","extendedTimeOut","closeButton","preventDuplicates","keysToRemove","hasVisualizerNav","hasVisualizerDataDisplay","scripts","script","visualizerConfig","diceConfig","detectVisualizerConflict","disconnect","initCfg","initFontVal","eventSource","events","eventTypes","triggers","CHAT_CHANGED","MESSAGE_SWIPED","MESSAGE_DELETED","MESSAGE_UPDATED","_acuBoundChatChangeHandler","_boundChatChangeHandler","removeListener","loop","registerTableUpdateCallback","registerTableFillStartCallback","_acuInitRetries","hideOptionPanel","pendingCrazyAppend","lastCrazyPreSendAt","normalizeMessageId","messageId","hasDiceResultInText","insertDiceIntoUserInputBlock","blockRegex","blockMatch","suffix","trimmedInner","newInner","applyCrazyModeToPrompt","params","dryRun","safeParams","quietPrompt","quiet_prompt","automaticTrigger","automatic_trigger","_acu_crazy_applied","originalPrompt","crazyRollResult","finalPrompt","inserted","triggerCrazyModeBeforeSend","updatedValue","queueCrazyAppend","applyCrazyAppend","pending","stChat","stMsg","mes","extra","acuCrazyModeApplied","newMessage","setChatMessages","setupSendButtonListener","sendButton","onSendCapture","subtree","installCrazyGenerateHook","__acuCrazyGenerateHookInstalled","generate","__acuCrazyGenerateOriginal","injects","user_input","mergedPrompt","evtName","MESSAGE_SENT","tavern_events","afterCommandsEvtName","GENERATION_AFTER_COMMANDS","testPairedTableFix","getValidCodes","emptyRows1","emptyRows2","isValid1","isValid2","set1","set2","setsEqual","emptyRowsPreserved1","emptyRowsPreserved2","diagnoseDiceVariables","ready"],"ignoreList":[],"sourceRoot":""}