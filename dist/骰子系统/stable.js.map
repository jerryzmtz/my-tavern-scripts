{"version":3,"file":"stable.js","mappings":"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A,KACA,KACA,OACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KAEA,OACA,OACA,OACA,MACA,SACA,OACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,MACA,KACA,MAGA,MACA,KACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,MACA,MACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,KACA,SACA,KACA,KAGA,KACA,MACA,QACA,MACA,KACA,KACA,KACA,MACA,MACA,MACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,MACA,KACA,QACA,KACA,KACA,KACA,MACA,KACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,MACA,QACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OASIC,GAAwB,CAACC,OAAgB5gC,KAE7C,GAA6B,kBAAlB4gC,EAA6B,CACtC,MAAMC,EAAQD,EACR5P,EAAWH,GAAS3qB,KAAK6qB,MAAM7qB,KAAKsC,SAAWqoB,GAAS,EACxDiQ,EAAc,IAAM9P,EAAS,GAAKA,EAAS,GAAKA,EAAS,GAEzD+P,EAAgB,KACpB,GAAIF,EAAO,CACT,MAAMG,EAAOF,IACPG,EAASjQ,EAAS,GAAK,EAC7B,OAAO9qB,KAAKC,IAAI,EAAGD,KAAK8G,IAAI,GAAIg0B,EAAOC,GACzC,CAAO,CACL,MAAMD,EAAuB,EAAhB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vC,SAAUgxC,GAAe,EAAIA,OAAc9wC,GAE/C,CAGA,MAsLMgxC,EAtLgBC,KACpB,IAAKA,EAAQ,MAAO,GACpB,MAAMjuC,EAAQhC,OAAOiwC,GAClBlrC,MAAM,sCACN5J,IAAI4E,GAAKA,EAAEW,QACXmH,OAAO9H,GAAKA,GAAKA,EAAEjF,OAAS,IAGzBo1C,EAAkB,CACtB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,KACA,MACA,KACA,KACA,MAGF,OAAOluC,EACJ7G,IAAI2T,IAIH,MAAMqhC,GAFNrhC,EAAIA,EAAE7O,QAAQ,kBAAmB,IAAIS,QAERkB,MAAM,kBAyCnC,IAHAkN,GAFAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GAHAA,GADAA,GADAA,GAHAA,GADAA,GADAA,GAPEA,EADEqhC,EACEA,EAAmB,GAGnBrhC,EAAE7O,QAAQ,kDAAmD,KAI7DA,QAAQ,0BAA2B,KACnCA,QAAQ,wBAAyB,MACjCA,QAAQ,oBAAqB,KAG7BA,QAAQ,MAAO,KACfA,QAAQ,MAAO,KACfA,QAAQ,MAAO,KAGfA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QA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","sources":["src://tavern_helper_template/src//index.ts"],"sourcesContent":["// @ts-nocheck\n(function () {\n  'use strict';\n\n  const SCRIPT_ID = 'acu_visualizer_ui_v19_6_ai_overlay';\n  // ========================================\n  // LockManager - \n  // ========================================\n  const LockManager = {\n    STORAGE_KEY_PREFIX: 'acu_locked_fields_v2_',\n    MAX_CONTEXTS: 20, // \n\n    PRIMARY_KEYS: {\n      : null,\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n    },\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    //  N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) return;\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(`[DICE]LockManager  ${toDelete.length} `);\n        }\n      } catch (e) {\n        console.warn('[DICE]LockManager ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[DICE]LockManager ', e);\n      }\n    },\n\n    getRowKey(tableName, row, headers) {\n      const pkField = this.PRIMARY_KEYS[tableName];\n      if (pkField === null) return '_row_0';\n\n      let fieldIndex = 1;\n      if (pkField) {\n        const idx = headers.indexOf(pkField);\n        if (idx !== -1) fieldIndex = idx;\n      }\n\n      if (!row[fieldIndex]) return null;\n      return `${pkField || headers[fieldIndex]}=${row[fieldIndex]}`;\n    },\n\n    lockField(tableName, rowKey, fieldName, value) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n      if (!data[tableName][rowKey]) {\n        data[tableName][rowKey] = { _fullRow: false, _fields: {}, _snapshot: null };\n      }\n      data[tableName][rowKey]._fields[fieldName] = value;\n      this._save();\n    },\n\n    lockRow(tableName, rowKey, rowData, headers) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      const snapshot = {};\n      headers.forEach((h, i) => {\n        if (h && rowData[i] != null && rowData[i] !== '') {\n          snapshot[h] = rowData[i];\n        }\n      });\n\n      data[tableName][rowKey] = { _fullRow: true, _fields: {}, _snapshot: snapshot };\n      this._save();\n    },\n\n    unlockField(tableName, rowKey, fieldName) {\n      const data = this._load();\n      const lock = data[tableName]?.[rowKey];\n      if (!lock) return;\n\n      delete lock._fields[fieldName];\n      if (!lock._fullRow && Object.keys(lock._fields).length === 0) {\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n      }\n      this._save();\n    },\n\n    unlockRow(tableName, rowKey) {\n      const data = this._load();\n      if (data[tableName]) {\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n        this._save();\n      }\n    },\n\n    isFieldLocked(tableName, rowKey, fieldName) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return false;\n      if (lock._fullRow) return lock._snapshot?.hasOwnProperty(fieldName);\n      return lock._fields?.hasOwnProperty(fieldName);\n    },\n\n    isRowLocked(tableName, rowKey) {\n      return this._load()[tableName]?.[rowKey]?._fullRow === true;\n    },\n\n    applyLocks(tableName, tableContent) {\n      const tableLocks = this._load()[tableName];\n      if (!tableLocks || !tableContent || tableContent.length < 2) {\n        return { modified: false, restored: [] };\n      }\n\n      const headers = tableContent[0];\n      const restored = [];\n      let modified = false;\n\n      // \n      const rowIndex = {};\n      for (let i = 1; i < tableContent.length; i++) {\n        const key = this.getRowKey(tableName, tableContent[i], headers);\n        if (key) rowIndex[key] = i;\n      }\n\n      for (const [rowKey, lock] of Object.entries(tableLocks)) {\n        const idx = rowIndex[rowKey];\n\n        if (idx === undefined) {\n          // \n          const newRow = this._rebuildRow(headers, lock);\n          if (newRow) {\n            tableContent.push(newRow);\n            restored.push(rowKey);\n            modified = true;\n          }\n          continue;\n        }\n\n        const row = tableContent[idx];\n        const fields = lock._fullRow ? lock._snapshot : lock._fields;\n\n        if (fields) {\n          for (const [field, value] of Object.entries(fields)) {\n            const colIdx = headers.indexOf(field);\n            if (colIdx !== -1 && row[colIdx] !== value) {\n              row[colIdx] = value;\n              modified = true;\n            }\n          }\n        }\n      }\n\n      return { modified, restored };\n    },\n\n    _rebuildRow(headers, lock) {\n      const fields = lock._fullRow ? lock._snapshot : lock._fields;\n      if (!fields || Object.keys(fields).length === 0) return null;\n\n      const row = new Array(headers.length).fill(null);\n      for (const [field, value] of Object.entries(fields)) {\n        const idx = headers.indexOf(field);\n        if (idx !== -1) row[idx] = value;\n      }\n      return row;\n    },\n\n    getLockedFields(tableName, rowKey) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return [];\n      if (lock._fullRow) return Object.keys(lock._snapshot || {});\n      return Object.keys(lock._fields || {});\n    },\n\n    // \n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  // ========================================\n  // BookmarkManager - \n  // ========================================\n  const BookmarkManager = {\n    STORAGE_KEY_PREFIX: 'acu_bookmarks_v1_',\n    MAX_CONTEXTS: 20, // bookmark\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    // bookmark N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) {\n          // \n          return;\n        }\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(\n            `[DICE]BookmarkManager  ${toDelete.length} bookmark ${this.MAX_CONTEXTS}  ${allKeys.length} `,\n          );\n        }\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    isBookmarked(tableName, rowKey) {\n      const data = this._load();\n      return !!(data[tableName] && data[tableName][rowKey]);\n    },\n\n    toggleBookmark(tableName, rowKey) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      if (data[tableName][rowKey]) {\n        // bookmark\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n      } else {\n        // bookmark\n        data[tableName][rowKey] = true;\n      }\n      this._save();\n    },\n\n    getBookmarks(tableName) {\n      const data = this._load();\n      if (!data[tableName]) return [];\n      return Object.keys(data[tableName]);\n    },\n\n    // bookmark\n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  const escapeHtml = s =>\n    String(s ?? '')\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n  // [] \n  const smartInsertToTextarea = (newContent, contentType) => {\n    // contentType: 'action' ()  'dice' ()\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = ($ta.val() || '').trim();\n\n    // \n    // : \"XX\"\n    const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n    // \n    // : \"... vs ...... (...)  ......... (...)  .........\"\n    const contestDiceRegex =\n      /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n    // <user>\n    const actionRegex = /<user>(?:(?!<user>).)*?[]/g;\n\n    // \n    const placeholderRegex = /\\[\\]/g;\n\n    // [] \n    const diceCfg = getDiceConfig();\n    let contentToInsert = newContent;\n    let shouldSaveOriginal = false;\n    if (contentType === 'dice' && diceCfg.hideDiceResultFromUser) {\n      contentToInsert = '[]';\n      shouldSaveOriginal = true;\n    }\n\n    // \n    if (!currentVal) {\n      $ta.val(contentToInsert).trigger('input').trigger('change');\n      // []  data \n      if (contentType === 'dice') {\n        $ta.data('acu-original-dice-text', newContent);\n      }\n      return;\n    }\n\n    // \n    let workingText = currentVal;\n    let existingAction = '';\n    let existingDice = '';\n    let existingDiceOriginal = '';\n\n    // [] 0. \n    if (placeholderRegex.test(workingText)) {\n      // \n      const originalText = $ta.data('acu-original-dice-text') || '';\n      if (originalText) {\n        // \n        workingText = workingText.replace(placeholderRegex, originalText);\n        existingDice = originalText;\n        existingDiceOriginal = originalText;\n      } else {\n        // \n        workingText = workingText.replace(placeholderRegex, '').trim();\n      }\n    }\n\n    // 1. \n    const contestMatches = workingText.match(contestDiceRegex);\n    if (contestMatches && contestMatches.length > 0) {\n      existingDice = contestMatches[contestMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(contestDiceRegex, '\\u0000').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted contest roll:', existingDice);\n    }\n\n    // 2. \n    const normalMatches = workingText.match(normalDiceRegex);\n    if (normalMatches && normalMatches.length > 0) {\n      // \n      existingDice = normalMatches[normalMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(normalDiceRegex, '\\u0000').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted normal roll:', existingDice);\n    }\n\n    // 3. \n    const actionMatches = workingText.match(actionRegex);\n    if (actionMatches && actionMatches.length > 0) {\n      existingAction = actionMatches[actionMatches.length - 1];\n      workingText = workingText.replace(actionRegex, '\\u0001').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted action:', existingAction);\n    }\n\n    // 4. \n    let userInput = workingText\n      .replace(/[\\u0000\\u0001]/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .trim();\n\n    // 5. \n    if (contentType === 'dice') {\n      // [] \n      existingDice = contentToInsert;\n      existingDiceOriginal = newContent;\n      //  data \n      $ta.data('acu-original-dice-text', newContent);\n    } else if (contentType === 'action') {\n      existingAction = newContent;\n    }\n\n    // 6.  +  + \n    const parts = [];\n    if (userInput) parts.push(userInput);\n    if (existingAction) parts.push(existingAction);\n    if (existingDice) parts.push(existingDice);\n\n    const finalVal = parts.join(' ');\n    $ta.val(finalVal).trigger('input').trigger('change');\n  };\n\n  // [] \n  const restoreDiceResultBeforeSend = () => {\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = $ta.val() || '';\n    const originalText = $ta.data('acu-original-dice-text');\n\n    // \n    if (currentVal.includes('[]') && originalText) {\n      const restoredVal = currentVal.replace(/\\[\\]/g, originalText);\n      $ta.val(restoredVal);\n      // \n      $ta.removeData('acu-original-dice-text');\n    }\n  };\n\n  // []  value \n  const interceptTextareaValue = () => {\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const textarea = $ta[0] as HTMLTextAreaElement;\n    if (!textarea || (textarea as any)._acuValueIntercepted) return;\n\n    // \n    (textarea as any)._acuValueIntercepted = true;\n\n    //  value \n    const originalDescriptor = Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype, 'value');\n    const originalValue = textarea.value;\n\n    //  value  getter\n    Object.defineProperty(textarea, 'value', {\n      get: function (this: HTMLTextAreaElement) {\n        // \n        let val: string;\n        if (originalDescriptor && originalDescriptor.get) {\n          val = originalDescriptor.get.call(this);\n        } else {\n          val = (this as any)._value || originalValue || '';\n        }\n\n        // \n        const originalText = $(this).data('acu-original-dice-text');\n        if (val && typeof val === 'string' && val.includes('[]') && originalText) {\n          return val.replace(/\\[\\]/g, originalText);\n        }\n        return val;\n      },\n      set: function (this: HTMLTextAreaElement, val: string) {\n        if (originalDescriptor && originalDescriptor.set) {\n          originalDescriptor.set.call(this, val);\n        } else {\n          (this as any)._value = val;\n        }\n      },\n      configurable: true,\n    });\n  };\n  const STORAGE_KEY_TABLE_ORDER = 'acu_table_order';\n  const STORAGE_KEY_ACTION_ORDER = 'acu_action_order';\n  const STORAGE_KEY_PENDING_DELETIONS = 'acu_pending_deletions';\n  const STORAGE_KEY_ACTIVE_TAB = 'acu_active_tab';\n  const STORAGE_KEY_UI_CONFIG = 'acu_ui_config_v19';\n  const STORAGE_KEY_LAST_SNAPSHOT = 'acu_data_snapshot_v19';\n  const STORAGE_KEY_IS_COLLAPSED = 'acu_ui_collapsed_state';\n  const STORAGE_KEY_DASHBOARD_ACTIVE = 'acu_dashboard_active';\n  // [] \n  const STORAGE_KEY_TABLE_HEIGHTS = 'acu_table_heights_v19';\n  const STORAGE_KEY_TABLE_STYLES = 'acu_table_styles_v19';\n  const STORAGE_KEY_HIDDEN_TABLES = 'acu_hidden_tables_v19';\n  const STORAGE_KEY_GM_CONFIG = 'acu_gm_engine_config_v1';\n  const STORAGE_KEY_REVERSE_TABLES = 'acu_reverse_tables_v1';\n  const MAX_ACTION_BUTTONS = 6; // \n  const MIN_PANEL_HEIGHT = 200; // \n  const MAX_PANEL_HEIGHT = 1200; // \n\n  const STORAGE_KEY_DICE_CONFIG = 'acu_dice_config_v1';\n  const STORAGE_KEY_ATTRIBUTE_PRESETS = 'acu_attribute_presets_v1';\n  const STORAGE_KEY_ACTIVE_ATTR_PRESET = 'acu_active_attr_preset_v1';\n  const PRESET_FORMAT_VERSION = '1.4.0'; // \n  const SCRIPT_VERSION = 'v3.1'; // \n\n  //  \"x.y.z\"\n  const compareVersion = (v1, v2) => {\n    // \n    const normalizeVersion = v => {\n      if (typeof v === 'number') return `${v}.0.0`;\n      if (typeof v !== 'string') return '0.0.0';\n      return v;\n    };\n    const nv1 = normalizeVersion(v1);\n    const nv2 = normalizeVersion(v2);\n    const parts1 = nv1.split('.').map(Number);\n    const parts2 = nv2.split('.').map(Number);\n    for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {\n      const p1 = parts1[i] || 0;\n      const p2 = parts2[i] || 0;\n      if (p1 < p2) return -1;\n      if (p1 > p2) return 1;\n    }\n    return 0;\n  };\n\n  const STORAGE_KEY_AVATAR_MAP = 'acu_avatar_map_v1';\n\n  // ========================================\n  // ConsoleCaptureManager - Console\n  // ========================================\n  const ConsoleCaptureManager = {\n    logs: [],\n    maxLogs: 1000,\n    filters: { log: true, info: true, warn: true, error: true },\n    originalMethods: {},\n    isIntercepted: false,\n    enabled: false, // \n\n    restore() {\n      //  localStorage \n      const saved = localStorage.getItem('acu_console_capture_enabled');\n      if (saved === 'true') {\n        this.enable();\n      }\n    },\n\n    enable() {\n      if (this.enabled) return;\n      this.enabled = true;\n      localStorage.setItem('acu_console_capture_enabled', 'true');\n      this.intercept();\n    },\n\n    disable() {\n      if (!this.enabled) return;\n      this.enabled = false;\n      localStorage.setItem('acu_console_capture_enabled', 'false');\n      // \n      localStorage.removeItem('acu_script_error_detected');\n      // \n      const emergencyBtn = document.getElementById('acu-emergency-debug-btn');\n      if (emergencyBtn) {\n        emergencyBtn.style.display = 'none';\n      }\n    },\n\n    intercept() {\n      if (this.isIntercepted) return;\n      this.isIntercepted = true;\n\n      ['log', 'info', 'warn', 'error'].forEach(type => {\n        this.originalMethods[type] = console[type];\n        const self = this;\n        console[type] = function (...args) {\n          // \n          self.originalMethods[type].apply(console, args);\n          // \n          if (self.enabled) {\n            self.capture(type, args);\n          }\n        };\n      });\n    },\n\n    capture(type, args) {\n      if (!this.enabled) return; // \n      try {\n        const timestamp = new Date();\n        const timeStr = timestamp.toLocaleTimeString('zh-CN', { hour12: false });\n\n        // \n        const content = args\n          .map(arg => {\n            if (typeof arg === 'object') {\n              try {\n                return JSON.stringify(arg, null, 2);\n              } catch {\n                return String(arg);\n              }\n            }\n            return String(arg);\n          })\n          .join(' ');\n\n        // error\n        let stack = null;\n        if (type === 'error' && args[0] instanceof Error) {\n          stack = args[0].stack || null;\n        }\n\n        const logEntry = {\n          id: Date.now() + Math.random(),\n          timestamp,\n          timeStr,\n          type,\n          content,\n          stack,\n          rawArgs: args,\n        };\n\n        this.logs.push(logEntry);\n\n        // \n        if (this.logs.length > this.maxLogs) {\n          this.logs.shift();\n        }\n      } catch (e) {\n        // console\n      }\n    },\n\n    clear() {\n      this.logs = [];\n    },\n\n    getFilteredLogs() {\n      return this.logs.filter(log => this.filters[log.type]);\n    },\n\n    setFilters(filters) {\n      this.filters = { ...this.filters, ...filters };\n    },\n  };\n\n  // \n  // ConsoleCaptureManager.intercept();\n\n  // ========================================\n  // \n  // ========================================\n  const ErrorHandler = {\n    errorCount: 0,\n    errorThreshold: 3, // 3\n    lastErrorTime: 0,\n    errorWindow: 5000, // 5\n    fatalErrorDetected: false,\n\n    // \n    isFatalError(error, source, lineno, colno, stack) {\n      // \n      const thirdPartyPatterns = [/jquery/i, /lodash/i, /vue/i, /react/i, /pixi/i, /gsap/i, /toastr/i, /node_modules/i];\n\n      const errorInfo = stack || error?.stack || '';\n      const errorSource = source || '';\n\n      // \n      for (const pattern of thirdPartyPatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          return false;\n        }\n      }\n\n      // \n      const corePatterns = [\n        /acu_visualizer/i,\n        //i,\n        /LockManager/i,\n        /Store/i,\n        /ConsoleCaptureManager/i,\n        /renderInterface/i,\n        /init\\s*\\(/i,\n      ];\n\n      let isCoreError = false;\n      for (const pattern of corePatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          isCoreError = true;\n          break;\n        }\n      }\n\n      // \n      return isCoreError;\n    },\n\n    // \n    handleError(error, source, lineno, colno, stack) {\n      try {\n        // \n        if (!this.isFatalError(error, source, lineno, colno, stack)) {\n          return; // \n        }\n\n        const now = Date.now();\n\n        // \n        if (now - this.lastErrorTime > this.errorWindow) {\n          this.errorCount = 0;\n        }\n\n        this.errorCount++;\n        this.lastErrorTime = now;\n\n        // \n        if (this.errorCount >= this.errorThreshold && !this.fatalErrorDetected) {\n          this.fatalErrorDetected = true;\n          this.triggerFatalError();\n        }\n      } catch (e) {\n        // \n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    triggerFatalError() {\n      try {\n        //  console \n        if (!ConsoleCaptureManager.enabled) {\n          ConsoleCaptureManager.enable();\n        }\n\n        // \n        localStorage.setItem('acu_script_error_detected', 'true');\n\n        // \n        this.showEmergencyButton();\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    showEmergencyButton() {\n      try {\n        // \n        let btn = document.getElementById('acu-emergency-debug-btn');\n        if (btn) {\n          btn.style.display = 'block';\n          return;\n        }\n\n        // \n        btn = document.createElement('button');\n        btn.id = 'acu-emergency-debug-btn';\n        btn.innerHTML = '<i class=\"fa-solid fa-bug\"></i> ';\n        btn.style.cssText = `\n          position: fixed;\n          bottom: 20px;\n          right: 20px;\n          z-index: 99999;\n          padding: 10px 16px;\n          background: #e74c3c;\n          color: #fff;\n          border: none;\n          border-radius: 6px;\n          font-size: 14px;\n          font-weight: bold;\n          cursor: pointer;\n          box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);\n          display: flex;\n          align-items: center;\n          gap: 6px;\n          transition: all 0.2s;\n        `;\n\n        btn.onmouseenter = function () {\n          this.style.background = '#c0392b';\n          this.style.transform = 'scale(1.05)';\n        };\n        btn.onmouseleave = function () {\n          this.style.background = '#e74c3c';\n          this.style.transform = 'scale(1)';\n        };\n\n        btn.onclick = function () {\n          try {\n            //  showDebugConsoleModal\n            if (typeof window.showDebugConsoleModal === 'function') {\n              window.showDebugConsoleModal();\n            } else {\n              // \n              alert('F12');\n            }\n          } catch (e) {\n            console.error('[DICE]:', e);\n            alert('F12');\n          }\n        };\n\n        document.body.appendChild(btn);\n      } catch (e) {\n        console.error('[DICE]:', e);\n      }\n    },\n\n    // \n    checkAndRestore() {\n      try {\n        const errorDetected = localStorage.getItem('acu_script_error_detected') === 'true';\n        if (errorDetected) {\n          //  console \n          if (!ConsoleCaptureManager.enabled) {\n            ConsoleCaptureManager.enable();\n          }\n          // \n          this.showEmergencyButton();\n        }\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n  };\n\n  // \n  window.onerror = function (message, source, lineno, colno, error) {\n    ErrorHandler.handleError(error || message, source, lineno, colno, error?.stack);\n    return false; // \n  };\n\n  //  Promise \n  window.addEventListener('unhandledrejection', function (event) {\n    ErrorHandler.handleError(event.reason, null, null, null, event.reason?.stack);\n  });\n\n  // \n  //  init \n\n  // ========================================\n  // ValidationRuleManager - \n  // ========================================\n  const STORAGE_KEY_VALIDATION_RULES = 'acu_validation_rules_v1';\n  const STORAGE_KEY_VALIDATION_ENABLED = 'acu_validation_enabled_v1';\n  const STORAGE_KEY_VALIDATION_MODE = 'acu_validation_mode'; // \n\n  //  UI \n  const RULE_TYPE_INFO = {\n    // \n    tableReadonly: { name: '', scope: 'table', icon: 'fa-lock', desc: '' },\n    rowLimit: { name: '', scope: 'table', icon: 'fa-arrows-up-down', desc: '' },\n    sequence: { name: '', scope: 'table', icon: 'fa-sort-numeric-up', desc: '' },\n    // \n    required: { name: '', scope: 'field', icon: 'fa-asterisk', desc: '' },\n    format: { name: '', scope: 'field', icon: 'fa-font', desc: '' },\n    enum: { name: '', scope: 'field', icon: 'fa-list', desc: '' },\n    numeric: { name: '', scope: 'field', icon: 'fa-hashtag', desc: '' },\n    relation: { name: '', scope: 'field', icon: 'fa-link', desc: '' },\n    keyValue: { name: '', scope: 'field', icon: 'fa-key', desc: '' },\n  };\n\n  // \n  const BUILTIN_VALIDATION_RULES = [\n    // \n    {\n      id: 'summary_code_sequence',\n      name: '',\n      description: 'AM001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM001',\n    },\n    // \n    {\n      id: 'outline_code_sequence',\n      name: '',\n      description: 'AM001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM001',\n    },\n    // \n    {\n      id: 'summary_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'outline_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_priority_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'item_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_proficiency_range',\n      name: '',\n      description: ' 0-100 ',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'numeric',\n      config: { min: 0, max: 100 },\n      errorMessage: ' 0-100 ',\n    },\n    // \n    {\n      id: 'npc_presence_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_explore_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'intel_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'player_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // NPC\n    {\n      id: 'npc_location_relation',\n      name: 'NPC',\n      description: 'NPC',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'element_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'global_detail_location_relation',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    //  - \n    {\n      id: 'player_base_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_special_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_relationships_keyvalue',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    //  - \n    {\n      id: 'npc_base_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_special_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_relationships_keyvalue',\n      name: 'NPC',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    //  - \n    {\n      id: 'quest_progress_format',\n      name: '',\n      description: '+%50%',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'format',\n      config: { pattern: '^\\\\d+%$' },\n      errorMessage: '+%50%100%',\n    },\n  ];\n\n  // ========================================\n  // BlacklistManager - MVU\n  // ========================================\n  const STORAGE_KEY_BLACKLIST = 'acu_filter_blacklist_v1';\n  const STORAGE_KEY_BLACKLIST_VERSION = 'acu_filter_blacklist_version';\n  const DEFAULT_BLACKLIST = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    'ID',\n    '',\n    '',\n    'measurements',\n    'ages',\n    '',\n    'order',\n    '',\n    'time',\n    'cost',\n  ];\n\n  const BlacklistManager = {\n    // \n    getBlacklist() {\n      const stored = Store.get(STORAGE_KEY_BLACKLIST, null);\n      const storedVersion = Store.get(STORAGE_KEY_BLACKLIST_VERSION, null);\n\n      // \n      if (!stored || !Array.isArray(stored)) {\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return [...DEFAULT_BLACKLIST];\n      }\n\n      // \n      if (!storedVersion || compareVersion(storedVersion, PRESET_FORMAT_VERSION) < 0) {\n        console.log(`[DICE]BlacklistManager  (${storedVersion || ''})`);\n\n        // \n        const userItems = new Set(stored);\n        const defaultItems = new Set(DEFAULT_BLACKLIST);\n        const mergedItems = [...DEFAULT_BLACKLIST]; // \n\n        // \n        stored.forEach(item => {\n          if (!defaultItems.has(item)) {\n            mergedItems.push(item);\n          }\n        });\n\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, mergedItems);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return mergedItems;\n      }\n\n      return stored;\n    },\n\n    // \n    setBlacklist(list) {\n      if (!Array.isArray(list)) {\n        console.warn('[DICE]BlacklistManager ');\n        return false;\n      }\n      Store.set(STORAGE_KEY_BLACKLIST, list);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // \n    resetToDefault() {\n      Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // key\n    //  \" >  >  > \" \"\"\n    isBlacklisted(key) {\n      if (!key || typeof key !== 'string') return false;\n      const blacklist = this.getBlacklist();\n      if (blacklist.length === 0) return false;\n\n      // key \">\"  \" > \"\n      const parts = key\n        .split(/>| > /)\n        .map(s => s.trim())\n        .filter(s => s);\n      const lastPart = parts.length > 0 ? parts[parts.length - 1] : key;\n\n      // key\n      return blacklist.some(item => lastPart.includes(item));\n    },\n  };\n\n  // ========================================\n  // PresetManager - \n  // ========================================\n  const STORAGE_KEY_PRESETS = 'acu_validation_presets_v1';\n  const STORAGE_KEY_ACTIVE_PRESET = 'acu_active_preset_id';\n\n  const PresetManager = {\n    _cache: null,\n\n    // \n    getAllPresets() {\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n      if (!stored) {\n        this._initDefaultPreset();\n        return this._cache;\n      }\n      // \n      let needsSave = false;\n      stored.forEach(preset => {\n        if (!preset.version || this._compareVersion(preset.version, PRESET_FORMAT_VERSION) < 0) {\n          console.log(\n            `[DICE]PresetManager  \"${preset.name}\"  (${preset.version || ''})`,\n          );\n          // \n          const customRules = preset.rules.filter(r => !r.builtin);\n          const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n          const mergedRules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r, builtin: true }))];\n          customRules.forEach(rule => {\n            const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n            if (!builtinRuleIds.has(key)) {\n              mergedRules.push({ ...rule, builtin: false });\n            }\n          });\n          preset.rules = mergedRules;\n          preset.version = PRESET_FORMAT_VERSION;\n          needsSave = true;\n        }\n      });\n      if (needsSave) {\n        this._save(stored);\n        ValidationRuleManager.clearCache();\n        // \n        this._cache = null;\n      }\n      // \n      if (!needsSave && this._cache) {\n        return this._cache;\n      }\n      this._cache = stored;\n      return stored;\n    },\n\n    // \n    getActivePreset() {\n      const presets = this.getAllPresets();\n      const activeId = Store.get(STORAGE_KEY_ACTIVE_PRESET, 'default');\n      return presets.find(p => p.id === activeId) || presets[0];\n    },\n\n    // \n    setActivePreset(id) {\n      if (!this.getAllPresets().find(p => p.id === id)) return false;\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, id);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    createPreset(name) {\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: name || '',\n        builtin: false,\n        rules: [],\n        version: PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    duplicatePreset(id) {\n      const source = this.getAllPresets().find(p => p.id === id);\n      if (!source) return null;\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: source.name + ' ()',\n        builtin: false,\n        rules: JSON.parse(JSON.stringify(source.rules)),\n        version: source.version || PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      console.log('[DICE]PresetManager :', source.name, '->', newPreset.name);\n      return newPreset;\n    },\n\n    //  id='default' \n    deletePreset(id) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset || preset.id === 'default') return false; // \n      const filtered = presets.filter(p => p.id !== id);\n      this._save(filtered);\n      if (Store.get(STORAGE_KEY_ACTIVE_PRESET) === id) {\n        Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n        ValidationRuleManager.clearCache();\n      }\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    updatePresetRules(id, rules) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return false;\n      preset.rules = rules;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      return true;\n    },\n\n    // \n    exportPreset(id) {\n      const preset = this.getAllPresets().find(p => p.id === id);\n      if (!preset) return null;\n      const json = JSON.stringify(\n        {\n          format: 'acu_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          preset: { name: preset.name, rules: preset.rules },\n        },\n        null,\n        2,\n      );\n      return json;\n    },\n\n    // \n    _compareVersion(v1, v2) {\n      return compareVersion(v1, v2);\n    },\n\n    // \n    mergePresetWithDefaults(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) return false;\n\n      // \n      const customRules = preset.rules.filter(r => !r.builtin);\n      const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n\n      // \n      const builtinRuleMap = new Map();\n      BUILTIN_VALIDATION_RULES.forEach(r => {\n        const key = r.id || r.targetTable + '_' + r.ruleType;\n        builtinRuleMap.set(key, r);\n      });\n\n      // \n      const mergedRules = [];\n      const processedCustomIds = new Set();\n\n      // 1. \n      BUILTIN_VALIDATION_RULES.forEach(newRule => {\n        const key = newRule.id || newRule.targetTable + '_' + newRule.ruleType;\n        const existingRule = preset.rules.find(r => (r.id || r.targetTable + '_' + r.ruleType) === key && r.builtin);\n        if (existingRule) {\n          // \n          const isModified = JSON.stringify(existingRule) !== JSON.stringify(newRule);\n          if (isModified) {\n            // \n            mergedRules.push({ ...existingRule, builtin: true });\n          } else {\n            // \n            mergedRules.push({ ...newRule, builtin: true });\n          }\n        } else {\n          // \n          mergedRules.push({ ...newRule, builtin: true });\n        }\n        processedCustomIds.add(key);\n      });\n\n      // 2. \n      customRules.forEach(rule => {\n        const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n        if (!builtinRuleIds.has(key)) {\n          mergedRules.push({ ...rule, builtin: false });\n        }\n      });\n\n      preset.rules = mergedRules;\n      preset.version = PRESET_FORMAT_VERSION;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', preset.name);\n      return true;\n    },\n\n    // \n    importPreset(json, autoMerge = false) {\n      try {\n        const data = JSON.parse(json);\n        if (data.format !== 'acu_preset_v1' || !data.preset) return null;\n\n        const importedVersion = data.version || '0.0.0';\n        const needsMerge = this._compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n        const presets = this.getAllPresets();\n        const newPreset = {\n          id: 'imported_' + Date.now(),\n          name: data.preset.name || '',\n          builtin: false,\n          rules: data.preset.rules || [],\n          version: importedVersion,\n          createdAt: new Date().toISOString(),\n        };\n\n        // \n        if (needsMerge && autoMerge) {\n          presets.push(newPreset);\n          this._save(presets);\n          this.mergePresetWithDefaults(newPreset.id);\n          console.log('[DICE]PresetManager :', newPreset.name);\n        } else {\n          presets.push(newPreset);\n          this._save(presets);\n          console.log('[DICE]PresetManager :', newPreset.name);\n          if (needsMerge) {\n            console.warn('[DICE]PresetManager  mergePresetWithDefaults ');\n          }\n        }\n\n        return { preset: newPreset, needsMerge: needsMerge && !autoMerge };\n      } catch (e) {\n        console.error('[DICE]PresetManager :', e);\n        return null;\n      }\n    },\n\n    // \n    _getBuiltinRulesVersion() {\n      try {\n        const rulesStr = JSON.stringify(BUILTIN_VALIDATION_RULES);\n        // \n        let hash = 0;\n        for (let i = 0; i < rulesStr.length; i++) {\n          const char = rulesStr.charCodeAt(i);\n          hash = (hash << 5) - hash + char;\n          hash = hash & hash; // Convert to 32bit integer\n        }\n        return hash.toString(36);\n      } catch (e) {\n        console.error('[DICE]PresetManager :', e);\n        return '0';\n      }\n    },\n\n    // \n    _initDefaultPreset() {\n      const currentVersion = this._getBuiltinRulesVersion();\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n\n      // \n      if (stored && Array.isArray(stored)) {\n        const defaultPreset = stored.find(p => p.id === 'default');\n        if (defaultPreset && defaultPreset._builtinVersion !== currentVersion) {\n          console.log('[DICE]PresetManager ');\n          // \n          const customRules = defaultPreset.rules.filter(r => !r.builtin);\n          defaultPreset.rules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r })), ...customRules];\n          defaultPreset._builtinVersion = currentVersion;\n          this._cache = stored;\n          this._save(stored);\n          Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n          return;\n        }\n      }\n\n      const defaultPreset = {\n        id: 'default',\n        name: '',\n        builtin: true,\n        rules: BUILTIN_VALIDATION_RULES.map(r => ({ ...r })),\n        version: PRESET_FORMAT_VERSION,\n        _builtinVersion: currentVersion,\n        createdAt: new Date().toISOString(),\n      };\n      // \n      const oldCustom = Store.get(STORAGE_KEY_VALIDATION_RULES, []);\n      if (oldCustom.length > 0) {\n        defaultPreset.rules.push(...oldCustom.map(r => ({ ...r, builtin: false })));\n        console.log('[DICE]PresetManager :', oldCustom.length, '');\n      }\n      this._cache = [defaultPreset];\n      this._save(this._cache);\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n    },\n\n    // \n    resetDefaultPreset() {\n      const presets = this.getAllPresets();\n      const defaultPreset = presets.find(p => p.id === 'default');\n      if (defaultPreset) {\n        // \n        const customRules = defaultPreset.rules.filter(r => !r.builtin);\n        defaultPreset.rules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r })), ...customRules];\n        defaultPreset._builtinVersion = this._getBuiltinRulesVersion();\n        this._save(presets);\n        ValidationRuleManager.clearCache();\n        return true;\n      }\n      return false;\n    },\n\n    _save(presets) {\n      Store.set(STORAGE_KEY_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  //  PresetManager \n  const ValidationRuleManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const preset = PresetManager.getActivePreset();\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = (preset?.rules || []).map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_VALIDATION_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n      this._cache = null; // \n    },\n\n    // \n    toggleRuleIntercept(ruleId, intercept) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const rule = preset.rules.find(r => r.id === ruleId);\n      if (!rule) return false;\n\n      rule.intercept = intercept;\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled);\n    },\n\n    // \n    addCustomRule(rule) {\n      if (!rule.id || !rule.name || !rule.targetTable) {\n        console.error('[DICE]ValidationRuleManager ');\n        return false;\n      }\n\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      //  ID \n      if (preset.rules.some(r => r.id === rule.id)) {\n        console.error('[DICE]ValidationRuleManager  ID :', rule.id);\n        return false;\n      }\n\n      const newRule = { ...rule, builtin: false, enabled: true };\n      preset.rules.push(newRule);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      console.log('[DICE]ValidationRuleManager :', newRule.name);\n      return true;\n    },\n\n    // \n    removeCustomRule(ruleId) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules.splice(index, 1);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n\n      // \n      const states = this.getEnabledStates();\n      delete states[ruleId];\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n\n      console.log('[DICE]ValidationRuleManager :', ruleId);\n      return true;\n    },\n\n    // \n    updateCustomRule(ruleId, updates) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules[index] = { ...preset.rules[index], ...updates, id: ruleId };\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n\n    // \n    getRulesByTable(tableName) {\n      return this.getEnabledRules().filter(rule => rule.targetTable === tableName);\n    },\n  };\n\n  // ========================================\n  // ValidationEngine - \n  // ========================================\n  const ValidationEngine = {\n    // \n    validateFormat(value, pattern) {\n      if (value === null || value === undefined || value === '') return true; // \n      try {\n        const regex = new RegExp(pattern);\n        return regex.test(String(value));\n      } catch (e) {\n        console.error('[DICE]ValidationEngine :', pattern, e);\n        return true; // \n      }\n    },\n\n    // \n    validateEnum(value, allowedValues) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!Array.isArray(allowedValues) || allowedValues.length === 0) return true;\n      return allowedValues.includes(String(value));\n    },\n\n    // \n    validateNumeric(value, min, max) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      //  \"50/100\"  \":80\" \n      const strVal = String(value);\n      let numVal;\n\n      //  \"50%\"\n      if (strVal.endsWith('%')) {\n        numVal = parseFloat(strVal);\n      }\n      //  \"50/100\"\n      else if (strVal.includes('/')) {\n        const parts = strVal.split('/');\n        numVal = parseFloat(parts[0]);\n      }\n      //  \":\" \n      else if (strVal.includes(':')) {\n        const parts = strVal.split(':');\n        numVal = parseFloat(parts[parts.length - 1]);\n      }\n      // \n      else {\n        numVal = parseFloat(strVal);\n      }\n\n      if (isNaN(numVal)) return false; // \n\n      if (min !== undefined && min !== null && numVal < min) return false;\n      if (max !== undefined && max !== null && numVal > max) return false;\n      return true;\n    },\n\n    //  OR \n    validateRelation(value, rawData, refTable, refColumn) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!rawData || !refTable || !refColumn) return true;\n\n      // \n      let refSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === refTable) {\n          refSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!refSheet || !refSheet.content || refSheet.content.length < 2) {\n        return true; // \n      }\n\n      const headers = refSheet.content[0];\n      const strVal = String(value);\n\n      //  refColumn \n      const columns = Array.isArray(refColumn) ? refColumn : [refColumn];\n\n      for (const col of columns) {\n        const refColIndex = headers.indexOf(col);\n        if (refColIndex === -1) continue; // \n\n        // \n        for (let i = 1; i < refSheet.content.length; i++) {\n          if (String(refSheet.content[i][refColIndex] || '') === strVal) {\n            return true; // \n          }\n        }\n      }\n\n      return columns.length === 0; //  true false\n    },\n\n    // \n    validateRequired(value) {\n      return value !== null && value !== undefined && String(value).trim() !== '';\n    },\n\n    // \n    validateKeyValue(value, ruleConfig) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      const valueType = ruleConfig?.valueType || 'text';\n      const valueMin = ruleConfig?.valueMin;\n      const valueMax = ruleConfig?.valueMax;\n\n      // \n      let processedValue = String(value);\n\n      // \n      processedValue = processedValue\n        .replace(//g, ':') //   \n        .replace(//g, ';') //   \n        .replace(//g, ';'); //   \n\n      // \n      processedValue = processedValue.replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n\n      if (pairs.length === 0) return false; // \n\n      // \n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          return false; // /\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) return false; // \n\n        // \n        if (valueType === 'numeric') {\n          // \n          if (!/^-?\\d+(\\.\\d+)?$/.test(val.trim())) return false; // \n\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) return false; // \n\n          if (valueMin !== undefined && valueMin !== null && numVal < valueMin) return false;\n          if (valueMax !== undefined && valueMax !== null && numVal > valueMax) return false;\n        }\n        // \n      }\n\n      return true;\n    },\n\n    // \n    validateTableReadonly(oldContent, newContent) {\n      if (!oldContent || !newContent) return true;\n      return JSON.stringify(oldContent) === JSON.stringify(newContent);\n    },\n\n    // \n    validateRowLimit(rowCount, min, max) {\n      if (min !== undefined && min !== null && rowCount < min) return false;\n      if (max !== undefined && max !== null && rowCount > max) return false;\n      return true;\n    },\n\n    // \n    validateSequence(sheet, columnName, config) {\n      if (!sheet || !sheet.content || sheet.content.length < 2) return true; // \n      if (!columnName || !config) return true;\n\n      const headers = sheet.content[0] || [];\n      const rows = sheet.content.slice(1) || [];\n      const colIndex = headers.indexOf(columnName);\n      if (colIndex < 0) return true; // \n\n      const prefix = config.prefix || '';\n      const startFrom = config.startFrom !== undefined ? config.startFrom : 1;\n\n      // \n      const numbers = [];\n      const allRowValues = []; // \n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        allRowValues.push({ rowIndex: i, rawValue: value, type: typeof value });\n        if (value === null || value === undefined || value === '') continue;\n\n        const strValue = String(value).trim();\n        if (!strValue) continue;\n\n        // +\n        if (prefix) {\n          const regex = new RegExp(`^${prefix}(\\\\d+)$`);\n          const match = strValue.match(regex);\n          if (match) {\n            const num = parseInt(match[1], 10);\n            if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n          }\n        } else {\n          // \n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n        }\n      }\n\n      if (numbers.length === 0) return true; // \n\n      // \n      numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n      // \n      const numSet = new Set(numbers.map(n => n.num));\n      if (numSet.size !== numbers.length) {\n        return false; // \n      }\n\n      // startFrom\n      // startFromstartFrom+1\n      for (let i = 0; i < numbers.length; i++) {\n        const expectedNum = startFrom + i;\n        const actualNum = numbers[i].num;\n        if (actualNum !== expectedNum) {\n          return false; // startFrom\n        }\n      }\n\n      return true;\n    },\n\n    //  intercept \n    checkTableRules(snapshot, newData, rules) {\n      const violations = [];\n      if (!snapshot || !newData || !rules) return violations;\n\n      for (const rule of rules) {\n        // \n        if (!rule.enabled || !rule.intercept) continue;\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n        if (!typeInfo) continue;\n\n        // \n        let oldSheet = null,\n          newSheet = null;\n        for (const sheetId in snapshot) {\n          if (snapshot[sheetId]?.name === rule.targetTable) {\n            oldSheet = snapshot[sheetId];\n            break;\n          }\n        }\n        for (const sheetId in newData) {\n          if (newData[sheetId]?.name === rule.targetTable) {\n            newSheet = newData[sheetId];\n            break;\n          }\n        }\n\n        if (!newSheet) continue;\n\n        // \n        if (typeInfo.scope === 'table') {\n          if (rule.ruleType === 'tableReadonly') {\n            if (!this.validateTableReadonly(oldSheet?.content, newSheet?.content)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message: rule.errorMessage || ` \"${rule.targetTable}\" `,\n              });\n            }\n          } else if (rule.ruleType === 'rowLimit') {\n            const rowCount = (newSheet.content?.length || 1) - 1; // \n            if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetTable}\"  ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n              });\n            }\n          } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n            // \n            if (!this.validateSequence(newSheet, rule.targetColumn, rule.config || {})) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(3, '0')}`,\n              });\n            }\n          }\n        }\n        // \n        else if (typeInfo.scope === 'field' && rule.targetColumn) {\n          const headers = newSheet.content?.[0] || [];\n          const colIndex = headers.indexOf(rule.targetColumn);\n          if (colIndex === -1) continue;\n\n          // \n          for (let rowIdx = 1; rowIdx < (newSheet.content?.length || 0); rowIdx++) {\n            const row = newSheet.content[rowIdx];\n            const value = row?.[colIndex];\n            const isValid = this.validateValue(value, rule, newData);\n\n            if (!isValid) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                rowIndex: rowIdx,\n                columnName: rule.targetColumn,\n                currentValue: String(value ?? ''),\n                message: rule.errorMessage || ` \"${rule.targetColumn}\" `,\n              });\n              // \n              break;\n            }\n          }\n        }\n      }\n      return violations;\n    },\n\n    // \n    validateValue(value, rule, rawData) {\n      switch (rule.ruleType) {\n        case 'format':\n          return this.validateFormat(value, rule.config?.pattern);\n        case 'enum':\n          return this.validateEnum(value, rule.config?.values);\n        case 'numeric':\n          return this.validateNumeric(value, rule.config?.min, rule.config?.max);\n        case 'relation':\n          return this.validateRelation(value, rawData, rule.config?.refTable, rule.config?.refColumn);\n        case 'required':\n          return this.validateRequired(value);\n        case 'keyValue':\n          return this.validateKeyValue(value, rule.config);\n        default:\n          return true;\n      }\n    },\n\n    // \n    validateRow(row, headers, tableName, rowIndex, rules, rawData) {\n      const errors = [];\n      // \n      const rowTitle = row[1] || row[0] || ` ${rowIndex + 1}`;\n\n      for (const rule of rules) {\n        if (rule.targetTable !== tableName) continue;\n        if (!rule.enabled) continue;\n\n        // \n        const colIndex = headers.indexOf(rule.targetColumn);\n        if (colIndex === -1) continue;\n\n        const value = row[colIndex];\n        const isValid = this.validateValue(value, rule, rawData);\n\n        if (!isValid) {\n          errors.push({\n            ruleId: rule.id,\n            ruleName: rule.name,\n            ruleType: rule.ruleType,\n            rule: rule, // \n            tableName: tableName,\n            rowIndex: rowIndex,\n            columnName: rule.targetColumn,\n            currentValue: String(value ?? ''),\n            rowTitle: rowTitle, // \n            errorMessage: rule.errorMessage,\n            severity: 'error',\n          });\n        }\n      }\n\n      return errors;\n    },\n\n    // \n    validateAllData(rawData) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getEnabledRules();\n      if (rules.length === 0) return [];\n\n      const allErrors = [];\n\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const sheet = rawData[sheetId];\n        if (!sheet?.name || !sheet?.content || sheet.content.length < 2) continue;\n\n        const tableName = sheet.name;\n        const headers = sheet.content[0];\n        const tableRules = rules.filter(r => r.targetTable === tableName);\n\n        if (tableRules.length === 0) continue;\n\n        // \n        for (const rule of tableRules) {\n          const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n          if (typeInfo?.scope === 'table') {\n            if (rule.ruleType === 'rowLimit') {\n              const rowCount = sheet.content.length - 1;\n              if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n                allErrors.push({\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: '',\n                  currentValue: `${rowCount} `,\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n                  severity: 'warning',\n                });\n              }\n            } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n              // \n              const isValid = this.validateSequence(sheet, rule.targetColumn, rule.config || {});\n              if (!isValid) {\n                const error = {\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: rule.targetColumn,\n                  currentValue: '',\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(3, '0')}`,\n                  severity: 'error',\n                };\n                allErrors.push(error);\n              }\n            }\n            // tableReadonly \n          }\n        }\n\n        // \n        const fieldRules = tableRules.filter(r => RULE_TYPE_INFO[r.ruleType]?.scope !== 'table');\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          const rowErrors = this.validateRow(row, headers, tableName, i - 1, fieldRules, rawData);\n          allErrors.push(...rowErrors);\n        }\n      }\n\n      return allErrors;\n    },\n\n    // \n    validateTable(rawData, tableName) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getRulesByTable(tableName);\n      if (rules.length === 0) return [];\n\n      // \n      let targetSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n        return [];\n      }\n\n      const headers = targetSheet.content[0];\n      const allErrors = [];\n\n      for (let i = 1; i < targetSheet.content.length; i++) {\n        const row = targetSheet.content[i];\n        const rowErrors = this.validateRow(row, headers, tableName, i - 1, rules, rawData);\n        allErrors.push(...rowErrors);\n      }\n\n      return allErrors;\n    },\n\n    // \n    groupErrorsByTable(errors) {\n      const grouped = {};\n      for (const error of errors) {\n        if (!grouped[error.tableName]) {\n          grouped[error.tableName] = [];\n        }\n        grouped[error.tableName].push(error);\n      }\n      return grouped;\n    },\n\n    // \n    getErrorCount(rawData) {\n      return this.validateAllData(rawData).length;\n    },\n  };\n\n  // ========================================\n  // LocalAvatarDB -  IndexedDB \n  // ========================================\n  const LocalAvatarDB = {\n    DB_NAME: 'acu_local_avatars',\n    STORE_NAME: 'avatars',\n    DB_VERSION: 1,\n    _db: null,\n    _urlCache: new Map(), //  ObjectURL \n\n    // \n    async init() {\n      if (this._db) return this._db;\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n        request.onerror = () => {\n          console.error('[DICE]LocalAvatarDB :', request.error);\n          reject(request.error);\n        };\n\n        request.onsuccess = () => {\n          this._db = request.result;\n          resolve(this._db);\n        };\n\n        request.onupgradeneeded = event => {\n          const db = event.target.result;\n          if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n            // \n            db.createObjectStore(this.STORE_NAME, { keyPath: 'name' });\n          }\n        };\n      });\n    },\n\n    //  name \n    async save(name, blob) {\n      if (!name || !blob) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          //  ObjectURL \n          if (this._urlCache.has(name)) {\n            URL.revokeObjectURL(this._urlCache.get(name));\n            this._urlCache.delete(name);\n          }\n\n          const data = {\n            name: name,\n            blob: blob,\n            size: blob.size,\n            type: blob.type,\n            updatedAt: Date.now(),\n          };\n\n          const request = store.put(data);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]LocalAvatarDB :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB save error:', e);\n        return false;\n      }\n    },\n\n    //  URL ObjectURL\n    async get(name) {\n      if (!name) return null;\n\n      // \n      if (this._urlCache.has(name)) {\n        return this._urlCache.get(name);\n      }\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.get(name);\n\n          request.onsuccess = () => {\n            const data = request.result;\n            if (data && data.blob) {\n              const url = URL.createObjectURL(data.blob);\n              this._urlCache.set(name, url);\n              resolve(url);\n            } else {\n              resolve(null);\n            }\n          };\n\n          request.onerror = () => resolve(null);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB get error:', e);\n        return null;\n      }\n    },\n\n    // \n    async has(name) {\n      if (!name) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getKey(name);\n\n          request.onsuccess = () => resolve(request.result !== undefined);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        return false;\n      }\n    },\n\n    // \n    async delete(name) {\n      if (!name) return false;\n\n      try {\n        //  ObjectURL \n        if (this._urlCache.has(name)) {\n          URL.revokeObjectURL(this._urlCache.get(name));\n          this._urlCache.delete(name);\n        }\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.delete(name);\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB delete error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAllNames() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAllKeys();\n\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => resolve([]);\n        });\n      } catch (e) {\n        return [];\n      }\n    },\n\n    // \n    async getStats() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAll();\n\n          request.onsuccess = () => {\n            const items = request.result || [];\n            const totalSize = items.reduce((sum, item) => sum + (item.size || 0), 0);\n            resolve({\n              count: items.length,\n              totalSize: totalSize,\n              totalSizeMB: (totalSize / 1024 / 1024).toFixed(2),\n            });\n          };\n\n          request.onerror = () => resolve({ count: 0, totalSize: 0, totalSizeMB: '0' });\n        });\n      } catch (e) {\n        return { count: 0, totalSize: 0, totalSizeMB: '0' };\n      }\n    },\n\n    // \n    async clearAll() {\n      try {\n        //  ObjectURL \n        this._urlCache.forEach(url => URL.revokeObjectURL(url));\n        this._urlCache.clear();\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.clear();\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB clearAll error:', e);\n        return false;\n      }\n    },\n  };\n\n  // []  SillyTavern  URL\n  const getUserAvatarUrl = () => {\n    try {\n      // 1:  DOM \n      const w = window.parent || window;\n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        // SillyTavern  #user_avatar_block img  .avatar[title=\"You\"] img\n        const $avatar = $('#user_avatar_block img').first();\n        if ($avatar.length && $avatar.attr('src')) {\n          return $avatar.attr('src');\n        }\n        // \n        const $userMes = $('.mes[is_user=\"true\"]').last().find('.avatar img');\n        if ($userMes.length && $userMes.attr('src')) {\n          return $userMes.attr('src');\n        }\n      }\n      // 2:  SillyTavern API \n      const ST = w.SillyTavern || window.SillyTavern;\n      if (ST && ST.getContext) {\n        const ctx = ST.getContext();\n        if (ctx && ctx.userAvatar) {\n          return ctx.userAvatar;\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getUserAvatarUrl error:', e);\n    }\n    return null;\n  };\n\n  // [] \n  const getPlayerName = () => {\n    const rawData = cachedRawData || (typeof getTableData === 'function' ? getTableData() : null);\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]?.[1]) {\n          return sheet.content[1][1];\n        }\n      }\n    }\n    return null;\n  };\n\n  // []  SillyTavern Persona \n  const getPersonaName = () => {\n    try {\n      // 1: SillyTavern  API\n      const w = window.parent || window;\n      if (w.SillyTavern?.getContext) {\n        const ctx = w.SillyTavern.getContext();\n        if (ctx?.name1) return ctx.name1;\n      }\n      // 2: \n      if (typeof name1 !== 'undefined' && name1) return name1;\n      if (w.name1) return w.name1;\n      // 3:  DOM \n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        const $persona = $('#user_avatar_block .avatar-name, #persona_name_input').first();\n        if ($persona.length) {\n          const name = $persona.val?.() || $persona.text?.();\n          if (name && name.trim()) return name.trim();\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getPersonaName error:', e);\n    }\n    return null;\n  };\n\n  // []  Persona\n  const getDisplayPlayerName = () => {\n    return getPersonaName() || getPlayerName() || '';\n  };\n\n  // []  Persona \n  const replaceUserPlaceholders = text => {\n    if (!text || typeof text !== 'string') return text;\n    const displayName = getDisplayPlayerName();\n    //  <user>{{user}}\n    let result = text.replace(/<user>/gi, displayName);\n    result = result.replace(/\\{\\{user\\}\\}/gi, displayName);\n    return result;\n  };\n  // \n  const AvatarManager = {\n    _cache: null,\n\n    load() {\n      if (!this._cache) {\n        const raw = Store.get(STORAGE_KEY_AVATAR_MAP, {});\n        this._cache = {};\n        for (const name in raw) {\n          if (typeof raw[name] === 'string') {\n            this._cache[name] = { url: raw[name], offsetX: 50, offsetY: 50, scale: 150, aliases: [] };\n          } else {\n            this._cache[name] = {\n              url: raw[name].url || '',\n              offsetX: raw[name].offsetX ?? 50,\n              offsetY: raw[name].offsetY ?? 50,\n              scale: raw[name].scale ?? 150,\n              aliases: raw[name].aliases || [],\n            };\n          }\n        }\n      }\n      return this._cache;\n    },\n\n    save() {\n      Store.set(STORAGE_KEY_AVATAR_MAP, this._cache || {});\n      this._cache = null;\n    },\n\n    //  URL  ST \n    get(name) {\n      const data = this.load()[name];\n      if (data && data.url) return data.url;\n\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          if (this._cache[key].url) return this._cache[key].url;\n        }\n      }\n\n      return null;\n    },\n\n    //  > URL > ST\n    async getAsync(name) {\n      if (!name) return null;\n\n      // \n      const playerName = getPlayerName();\n      const isPlayer = name === '<user>' || name === '' || (playerName && name === playerName);\n\n      // 1.  IndexedDB\n      const localUrl = await LocalAvatarDB.get(name);\n      if (localUrl) return localUrl;\n\n      // 2.  <user> \n      if (isPlayer && name !== '<user>') {\n        const userLocalUrl = await LocalAvatarDB.get('<user>');\n        if (userLocalUrl) return userLocalUrl;\n      }\n\n      // 3. \n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        const aliasLocalUrl = await LocalAvatarDB.get(primaryName);\n        if (aliasLocalUrl) return aliasLocalUrl;\n      }\n\n      // 4. URL / ST\n      return this.get(name);\n    },\n\n    // \n    async hasLocalAvatar(name) {\n      if (!name) return false;\n      const has = await LocalAvatarDB.has(name);\n      if (has) return true;\n\n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        return await LocalAvatarDB.has(primaryName);\n      }\n      return false;\n    },\n\n    // \n    async saveLocalAvatar(name, blob) {\n      return await LocalAvatarDB.save(name, blob);\n    },\n\n    // \n    async deleteLocalAvatar(name) {\n      return await LocalAvatarDB.delete(name);\n    },\n\n    getOffsetX(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetX ?? 50) : 50;\n    },\n\n    getOffsetY(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetY ?? 50) : 50;\n    },\n\n    getScale(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.scale ?? 150) : 150;\n    },\n\n    // \n    _resolveByAlias(name) {\n      const data = this.load()[name];\n      if (data) return data;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return this._cache[key];\n        }\n      }\n      return null;\n    },\n\n    // \n    getPrimaryName(name) {\n      if (this.load()[name]) return name;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return key;\n        }\n      }\n      return name;\n    },\n\n    set(name, url, offsetX = 50, offsetY = 50, scale = 150, aliases = []) {\n      this.load()[name] = { url, offsetX, offsetY, scale, aliases };\n      this.save();\n    },\n\n    setPosition(name, offsetX, offsetY) {\n      const data = this.load()[name];\n      if (data) {\n        data.offsetX = offsetX;\n        data.offsetY = offsetY;\n        this.save();\n      }\n    },\n\n    setScale(name, scale) {\n      const data = this.load()[name];\n      if (data) {\n        data.scale = scale;\n        this.save();\n      }\n    },\n\n    setAliases(name, aliases) {\n      const data = this.load()[name];\n      if (data) {\n        data.aliases = aliases;\n        this.save();\n      }\n    },\n\n    remove(name) {\n      delete this.load()[name];\n      this.save();\n    },\n\n    getAll() {\n      return this.load();\n    },\n\n    // JSON\n    exportData() {\n      return {\n        version: 1,\n        exportTime: new Date().toISOString(),\n        avatars: this.load(),\n      };\n    },\n\n    // \n    importData(jsonData, overwriteConflicts = true) {\n      if (!jsonData || !jsonData.avatars) {\n        throw new Error('');\n      }\n\n      const current = this.load();\n      const stats = { added: 0, updated: 0, skipped: 0 };\n\n      for (const name in jsonData.avatars) {\n        const imported = jsonData.avatars[name];\n        if (!imported.url) continue;\n\n        if (current[name]) {\n          // \n          if (overwriteConflicts) {\n            current[name] = {\n              url: imported.url,\n              offsetX: imported.offsetX ?? 50,\n              offsetY: imported.offsetY ?? 50,\n              scale: imported.scale ?? 150,\n              aliases: imported.aliases || [],\n            };\n            stats.updated++;\n          } else {\n            stats.skipped++;\n          }\n        } else {\n          // \n          current[name] = {\n            url: imported.url,\n            offsetX: imported.offsetX ?? 50,\n            offsetY: imported.offsetY ?? 50,\n            scale: imported.scale ?? 150,\n            aliases: imported.aliases || [],\n          };\n          stats.added++;\n        }\n      }\n\n      this.save();\n      return stats;\n    },\n\n    // \n    analyzeImport(jsonData) {\n      if (!jsonData || !jsonData.avatars) {\n        return { valid: false, error: '' };\n      }\n\n      const current = this.load();\n      const result = { valid: true, total: 0, newItems: [], conflicts: [] };\n\n      for (const name in jsonData.avatars) {\n        if (!jsonData.avatars[name].url) continue;\n        result.total++;\n        if (current[name]) {\n          result.conflicts.push(name);\n        } else {\n          result.newItems.push(name);\n        }\n      }\n\n      return result;\n    },\n  };\n\n  // ========================================\n  // MVU  v2.0\n  //  -  UI\n  // ========================================\n  const MvuModule = (function () {\n    'use strict';\n\n    // [] MVU  - \n    function parseMvuPathForDice(path, value) {\n      try {\n        if (!path || typeof path !== 'string') {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        //  . \n        const parts = path.split('.').filter(p => p && p.trim());\n\n        if (parts.length === 0) {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        // \n        const blacklist = [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          'stat_data',\n          'delta_data',\n        ];\n\n        // \n        const filteredParts = parts.filter(p => !blacklist.includes(p));\n\n        // \n        let initiator = null;\n        if (filteredParts.length >= 2) {\n          // \n          initiator = filteredParts[filteredParts.length - 2];\n        } else if (filteredParts.length === 1) {\n          // \n          initiator = filteredParts[0];\n        }\n\n        // \n        let attrName = null;\n        if (filteredParts.length > 0) {\n          attrName = filteredParts[filteredParts.length - 1];\n        } else if (parts.length > 0) {\n          // \n          attrName = parts[parts.length - 1];\n        }\n\n        // \n        const candidates = filteredParts.length > 0 ? filteredParts : parts.slice(-1);\n\n        return {\n          initiator: initiator || null,\n          attrName: attrName || null,\n          candidates: candidates,\n        };\n      } catch (e) {\n        console.warn('[DICE]parseMvuPathForDice ', e);\n        return { initiator: null, attrName: null, candidates: [] };\n      }\n    }\n\n    // =====  =====\n    const MODULE_ID = '__mvu__';\n    let cachedEraData = null; //  ERA \n\n    // =====  =====\n    function detectMode() {\n      // \n      if (cachedEraData && cachedEraData._source) {\n        return cachedEraData._source;\n      }\n\n      //  ERA ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n\n      if (typeof eventEmit === 'function' && typeof eventOn === 'function') {\n        console.log('[DICE]MvuModule  ERA ');\n        return 'era';\n      }\n\n      //  MVU\n      if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n        console.log('[DICE]MvuModule  MVU ');\n        return 'mvu';\n      }\n\n      //  MVU\n      console.log('[DICE]MvuModule  MVU ');\n      return 'mvu';\n    }\n\n    // ===== =====\n    async function detectModeWithData() {\n      // 1.  ERA ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n\n      if (typeof eventEmit === 'function' && typeof eventOn === 'function') {\n        try {\n          //  ERA \n          const eraData = await Promise.race([\n            getEraData(),\n            new Promise((_, reject) => setTimeout(() => reject(new Error('ERA timeout')), 2000)),\n          ]);\n\n          if (eraData && eraData.stat_data) {\n            console.log('[DICE] ERA ');\n            return { mode: 'era', data: eraData };\n          }\n        } catch (e) {\n          console.warn('[DICE]ERA :', e.message);\n        }\n      }\n\n      // 2.  MVU\n      try {\n        await waitGlobalInitialized('Mvu');\n\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (mvuData && mvuData.stat_data) {\n            console.log('[DICE] MVU ');\n            return {\n              mode: 'mvu',\n              data: {\n                stat_data: mvuData.stat_data || null,\n                display_data: mvuData.display_data || {},\n                delta_data: mvuData.delta_data || {},\n                schema: mvuData.schema || null,\n                _source: 'mvu', // \n              },\n            };\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MVU :', e);\n      }\n\n      // 3.  MVU \n      console.warn('[DICE] MVU ');\n      return { mode: 'mvu', data: null };\n    }\n\n    // ===== ERA  =====\n    // ERA\n    async function getEraData() {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(null);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onResult = detail => {\n          clearTimeout(timeoutId);\n          //  eventOff \n          if (typeof eventOff === 'function') {\n            try {\n              eventOff('era:queryResult', onResult);\n            } catch (e) {\n              console.warn('[DICE]MvuModule :', e);\n            }\n          }\n\n          console.log('[DICE]MvuModule ERA:', JSON.stringify(detail, null, 2));\n          console.log('[DICE]MvuModule detail.result:', JSON.stringify(detail.result, null, 2));\n\n          if (detail.result && detail.result.error) {\n            console.error('[DICE]MvuModule ERA:', detail.result.error);\n            resolve(null);\n            return;\n          }\n\n          const statData = detail.result?.statWithoutMeta || null;\n          console.log('[DICE]MvuModule  stat_data:', JSON.stringify(statData, null, 2));\n\n          const result = {\n            stat_data: statData,\n            delta_data: {},\n            schema: null,\n            _source: 'era', // \n          };\n\n          // \n          cachedEraData = result;\n\n          resolve(result);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA...');\n          console.log('[DICE]MvuModule ERA API :', {\n            eventEmit: typeof eventEmit === 'function',\n            eventOn: typeof eventOn === 'function',\n            eventOff: typeof eventOff === 'function',\n          });\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n\n          eventOn('era:queryResult', onResult);\n          eventEmit('era:getCurrentVars');\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(null);\n        }\n      });\n    }\n\n    // ERA \n    async function setEraValue(path, newValue) {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(false);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onWriteDone = detail => {\n          clearTimeout(timeoutId);\n          if (typeof eventOff === 'function') {\n            eventOff('era:writeDone', onWriteDone);\n          }\n          console.log('[DICE]MvuModule ERA');\n          resolve(true);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA:', path, newValue);\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n\n          eventOn('era:writeDone', onWriteDone);\n          eventEmit('era:updateByPath', {\n            path: path,\n            value: newValue,\n          });\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(false);\n        }\n      });\n    }\n\n    // =====  =====\n    const STYLES = `\n            /* MVU  */\n            .acu-mvu-panel {\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n                min-height: 300px; /*  */\n                overflow: hidden; /*  */\n            }\n            .acu-mvu-panel .acu-panel-header {\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                padding: 10px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                flex-shrink: 0;\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title i {\n                color: var(--acu-accent);\n            }\n            .acu-mvu-panel .acu-header-actions {\n                display: flex;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                padding: 5px 10px;\n                font-size: 13px;\n                border-radius: 4px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn:hover {\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent);\n            }\n            .acu-mvu-panel .mvu-header-btn.active {\n                background: var(--acu-accent);\n                color: #fff;\n                border-color: var(--acu-accent);\n            }\n            /* []  */\n            .mvu-numeric-mode {\n                padding: 0;\n            }\n            .mvu-numeric-level-controls {\n                position: sticky;\n                top: 0;\n                z-index: 10;\n            }\n            /* []  */\n            .mvu-level-controls-collapsible {\n                margin-bottom: 8px;\n            }\n            .mvu-level-controls-header {\n                transition: background 0.2s;\n            }\n            .mvu-level-controls-header:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-level-controls-body {\n                overflow-y: auto;\n                overflow-x: hidden;\n                transition: max-height 0.3s ease-out, padding-top 0.3s ease-out, padding-bottom 0.3s ease-out, border-bottom 0.3s ease-out;\n                max-height: 300px; /*  */\n                scrollbar-width: thin;\n            }\n            /*  */\n            @media (max-width: 768px) {\n                .mvu-level-controls-body {\n                    max-height: 200px;\n                }\n            }\n            .mvu-level-controls-body::-webkit-scrollbar {\n                width: 6px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-track {\n                background: transparent;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb {\n                background: var(--acu-border);\n                border-radius: 3px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb:hover {\n                background: var(--acu-text-sub);\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-body {\n                max-height: 0 !important;\n                padding-top: 0 !important;\n                padding-bottom: 0 !important;\n                border-bottom: none !important;\n                margin: 0 !important;\n            }\n            .mvu-level-controls-toggle-icon {\n                transition: transform 0.3s ease-out;\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-toggle-icon {\n                transform: rotate(-90deg);\n            }\n            .mvu-numeric-items {\n                max-height: calc(100vh - 200px);\n                overflow-y: auto;\n            }\n            .mvu-numeric-item {\n                transition: background 0.2s;\n            }\n            .mvu-numeric-item:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-dice-icon {\n                transition: opacity 0.2s, transform 0.2s;\n            }\n            .mvu-dice-icon:hover {\n                opacity: 1 !important;\n                transform: scale(1.1);\n            }\n            .mvu-level-toggle:hover {\n                opacity: 1 !important;\n            }\n            .mvu-level-toggle[data-visible=\"true\"]:hover {\n                background: var(--acu-accent) !important;\n                color: #fff !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .mvu-level-toggle[data-visible=\"false\"]:hover,\n            .mvu-level-toggle[data-visible=\"\"]:hover {\n                background: var(--acu-table-hover) !important;\n                color: var(--acu-text-sub) !important;\n                border-color: var(--acu-border) !important;\n            }\n\n            /* MVU  -  */\n            .mvu-content {\n                display: flex;\n                flex-direction: column;\n                overflow-x: hidden;\n                overflow-y: auto; /*  */\n                flex: 1 1 auto;\n                min-height: 0; /*  flex  */\n                max-height: 100%; /*  */\n                padding: 12px;\n                scrollbar-width: thin;\n            }\n            .mvu-content::-webkit-scrollbar {\n                display: none;\n            }\n            .mvu-content .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 100%;\n                max-width: 100%;\n                width: 100%;\n            }\n            /* MVU */\n            .acu-mvu-panel {\n                overflow-y: auto !important;\n                overflow-x: hidden !important;\n                flex: 1 1 0; /*  flex-basis: 0  */\n                min-height: 300px; /*  */\n            }\n\n            /* MVU  */\n            .mvu-card {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 10px;\n                overflow: hidden;\n            }\n            .mvu-card:last-child {\n                margin-bottom: 0;\n            }\n            .mvu-card-header {\n                background: var(--acu-table-head);\n                padding: 8px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                cursor: pointer;\n                user-select: none;\n                transition: background 0.2s;\n            }\n            .mvu-card-header:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-card-title {\n                font-weight: 600;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            .mvu-card-count {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                font-weight: normal;\n            }\n            .mvu-card-toggle {\n                color: var(--acu-text-sub);\n                font-size: 10px;\n                transition: transform 0.2s;\n            }\n            .mvu-card.collapsed .mvu-card-toggle {\n                transform: rotate(-90deg);\n            }\n            .mvu-card-body {\n                padding: 8px 12px;\n                display: block;\n                overflow: hidden; /*  slideUp/slideDown  */\n            }\n            .mvu-card.collapsed .mvu-card-body {\n                display: none;\n            }\n\n            /*  */\n            .mvu-card .mvu-card {\n                background: var(--acu-table-head);\n                margin: 6px 0;\n            }\n            .mvu-card .mvu-card .mvu-card-header {\n                background: rgba(128,128,128,0.1);\n                padding: 6px 10px;\n            }\n            .mvu-card .mvu-card .mvu-card-body {\n                padding: 6px 10px;\n            }\n\n            /*  -  */\n            .mvu-card-body.horizontal-nested {\n                display: flex;\n                flex-direction: row;\n                flex-wrap: nowrap;\n                gap: 12px;\n                overflow-x: auto;\n                overflow-y: visible;\n                -webkit-overflow-scrolling: touch;\n                padding-bottom: 8px;\n                align-items: flex-start;\n            }\n            /*  has-nested-cards  wrap  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested {\n                flex-wrap: wrap;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-row {\n                display: flex;\n                flex: 0 0 100%;\n                width: 100%;\n                max-width: 100%; /*  */\n                box-sizing: border-box;\n            }\n            /*  has-nested-cards  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                flex: 0 0 auto; /*  */\n                min-width: 100%; /*  */\n                width: auto; /*  */\n                max-width: 450px; /*  */\n                box-sizing: border-box;\n            }\n            @media (min-width: 769px) {\n                .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                    max-width: 550px; /*  */\n                }\n            }\n            /*  -  */\n            .mvu-card-body.horizontal-nested > .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 200px;\n                max-width: 350px;\n                width: auto;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                min-width: 400px; /*  */\n                max-width: none; /*  */\n            }\n            @media (min-width: 769px) {\n                .mvu-card-body.horizontal-nested > .mvu-card {\n                    min-width: 240px;\n                    max-width: 400px;\n                }\n                .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                    min-width: 500px; /*  */\n                    max-width: none; /*  */\n                }\n            }\n\n            /*  */\n            .mvu-row {\n                display: flex;\n                align-items: flex-start;\n                padding: 5px 0;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n            .mvu-row:last-child {\n                border-bottom: none;\n            }\n            .mvu-key {\n                color: var(--acu-text-sub);\n                min-width: 80px;\n                max-width: 120px;\n                flex-shrink: 0;\n                font-size: 12px;\n                padding-right: 8px;\n                word-break: break-all;\n            }\n            .mvu-value-wrap {\n                flex: 1;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                min-width: 0;\n            }\n            .mvu-value {\n                color: var(--acu-text-main);\n                font-size: var(--acu-font-size, 13px);\n                cursor: pointer;\n                padding: 1px 6px;\n                border-radius: 4px;\n                transition: background 0.2s;\n                word-break: break-word;\n                flex: 0 1 auto;\n            }\n            .mvu-value:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-value.mvu-array-value {\n                font-size: calc(var(--acu-font-size, 13px) * 0.92);\n                color: var(--acu-text-sub);\n            }\n            .mvu-change-indicator {\n                color: var(--acu-success-text);\n                font-weight: bold;\n                font-size: 12px;\n                flex-shrink: 0;\n            }\n            .mvu-row.mvu-changed {\n                background: var(--acu-success-bg);\n                margin: 0 -12px;\n                padding: 5px 12px;\n                border-radius: 4px;\n            }\n            .mvu-card .mvu-card .mvu-row.mvu-changed {\n                margin: 0 -10px;\n                padding: 5px 10px;\n            }\n\n            /*  */\n            .mvu-empty {\n                text-align: center;\n                padding: 40px 20px;\n                color: var(--acu-text-sub);\n                flex: 1;\n                min-width: 100%;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n            }\n            .mvu-empty i {\n                font-size: 32px;\n                margin-bottom: 12px;\n                display: block;\n                opacity: 0.5;\n            }\n            .mvu-empty p {\n                margin: 0 0 6px 0;\n            }\n            .mvu-empty .mvu-empty-hint {\n                font-size: 12px;\n                opacity: 0.7;\n            }\n\n            /*  */\n            .mvu-edit-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0,0,0,0.6);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 99999;\n                animation: mvuFadeIn 0.15s ease-out;\n            }\n            .mvu-edit-dialog {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                padding: 16px;\n                width: 90%;\n                max-width: 400px;\n                animation: mvuSlideIn 0.2s ease-out;\n            }\n            .mvu-edit-title {\n                font-weight: 600;\n                color: var(--acu-text-main);\n                margin-bottom: 12px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .mvu-edit-path {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                background: var(--acu-table-head);\n                padding: 6px 10px;\n                border-radius: 4px;\n                margin-bottom: 12px;\n                word-break: break-all;\n                font-family: monospace;\n            }\n            .mvu-edit-textarea {\n                width: 100%;\n                min-height: 80px;\n                padding: 10px;\n                border: 1px solid var(--acu-border);\n                border-radius: 4px;\n                background: var(--acu-input-bg, var(--acu-bg-panel));\n                color: var(--acu-text-main);\n                font-size: 13px;\n                resize: vertical;\n                box-sizing: border-box;\n            }\n            .mvu-edit-textarea:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n            }\n            .mvu-edit-hint {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                margin-top: 8px;\n                opacity: 0.7;\n            }\n            .mvu-edit-btns {\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n                margin-top: 16px;\n            }\n            .mvu-edit-btn {\n                padding: 8px 16px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 13px;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                transition: all 0.2s;\n            }\n            .mvu-edit-btn.mvu-btn-cancel {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n            }\n            .mvu-edit-btn.mvu-btn-cancel:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-edit-btn.mvu-btn-save {\n                background: var(--acu-accent);\n                border: 1px solid var(--acu-accent);\n                color: #fff;\n            }\n            .mvu-edit-btn.mvu-btn-save:hover {\n                opacity: 0.9;\n            }\n\n            @keyframes mvuFadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes mvuSlideIn {\n                from { transform: translateY(-20px); opacity: 0; }\n                to { transform: translateY(0); opacity: 1; }\n            }\n\n            /*  */\n            .acu-nav-btn.acu-mvu-btn.active {\n                background: var(--acu-btn-active-bg);\n                color: var(--acu-btn-active-text);\n            }\n        `;\n\n    // =====  =====\n    function escapeHtml(s) {\n      return String(s ?? '')\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#039;');\n    }\n\n    function isAvailable() {\n      const mode = detectMode();\n\n      if (mode === 'era') {\n        // ERA  eventEmit  eventOn  iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const emitAvailable = typeof eventEmit === 'function';\n        const onAvailable = typeof eventOn === 'function';\n        return emitAvailable && onAvailable;\n      } else {\n        // MVU  MVU \n        const mvuAvailable = typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function';\n        return mvuAvailable;\n      }\n    }\n\n    function getData() {\n      console.warn('[DICE]: getData()  MVU  getDataWithRetry()');\n\n      //  ERA  MVU\n      if (cachedEraData) {\n        return cachedEraData;\n      }\n\n      //  MVU\n      try {\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (allVars && allVars.stat_data) {\n            const data = {\n              stat_data: allVars.stat_data || null,\n              display_data: allVars.display_data || {},\n              delta_data: allVars.delta_data || {},\n              schema: allVars.schema || null,\n              _source: 'mvu', // \n            };\n\n            cachedEraData = data; // \n            return data;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE] MVU :', e);\n      }\n\n      return null;\n    }\n\n    // ===== MVU  =====\n    async function getMvuDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        await waitGlobalInitialized('Mvu');\n\n        for (let attempt = 1; attempt <= maxRetries; attempt++) {\n          try {\n            if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n              throw new Error('MVU API ');\n            }\n\n            const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n            if (allVars && allVars.stat_data) {\n              const data = {\n                stat_data: allVars.stat_data || null,\n                display_data: allVars.display_data || {},\n                delta_data: allVars.delta_data || {},\n                schema: allVars.schema || null,\n                _source: 'mvu', // \n              };\n\n              //  MVU \n              cachedEraData = data;\n              console.log('[DICE]MVU ');\n              return data;\n            }\n          } catch (e) {\n            console.warn(`[DICE]MVU  ( ${attempt}/${maxRetries}):`, e);\n          }\n\n          if (attempt < maxRetries) {\n            await new Promise(resolve => setTimeout(resolve, retryDelay));\n          }\n        }\n\n        return null;\n      } catch (e) {\n        console.error('[DICE]MVU :', e);\n        return null;\n      }\n    }\n\n    // \n    async function getDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // \n        const detection = await detectModeWithData();\n\n        // \n        if (detection.data) {\n          cachedEraData = detection.data; // \n          return detection.data;\n        }\n\n        // \n        const mode = detection.mode;\n\n        if (mode === 'era') {\n          // ERA \n          for (let attempt = 1; attempt <= maxRetries; attempt++) {\n            try {\n              const data = await getEraData();\n              if (data && data.stat_data) {\n                cachedEraData = data;\n                return data;\n              }\n            } catch (e) {\n              console.warn(`[DICE]ERA  ( ${attempt}/${maxRetries}):`, e);\n            }\n\n            if (attempt < maxRetries) {\n              await new Promise(resolve => setTimeout(resolve, retryDelay));\n            }\n          }\n\n          // ERA  MVU\n          console.warn('[DICE]ERA  MVU');\n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        } else {\n          // MVU \n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        }\n      } catch (e) {\n        console.error('[DICE]:', e);\n        return null;\n      }\n    }\n\n    //  ValueWithDescription  [, \"\"]\n    function isVWD(value) {\n      return (\n        Array.isArray(value) &&\n        value.length === 2 &&\n        typeof value[1] === 'string' &&\n        (typeof value[0] === 'number' || typeof value[0] === 'string' || typeof value[0] === 'boolean')\n      );\n    }\n\n    // \n    function isSimpleArray(value) {\n      if (!Array.isArray(value)) return false;\n      return value.every(\n        item => typeof item === 'string' || typeof item === 'number' || typeof item === 'boolean' || item === null,\n      );\n    }\n\n    // \n    function getChangeIndicator(path, deltaData) {\n      if (!deltaData || !path) return '';\n\n      const parts = path.split('.');\n      let current = deltaData;\n      for (const part of parts) {\n        if (current === null || current === undefined) return '';\n        current = current[part];\n      }\n\n      if (!current) return '';\n\n      if (typeof current === 'string' && current.includes('->')) {\n        const match = current.match(/^(-?[\\d.]+)->(-?[\\d.]+)/);\n        if (match) {\n          const oldVal = parseFloat(match[1]);\n          const newVal = parseFloat(match[2]);\n          if (!isNaN(oldVal) && !isNaN(newVal)) {\n            return newVal > oldVal ? '' : newVal < oldVal ? '' : '';\n          }\n        }\n        return '';\n      }\n      return '';\n    }\n\n    // /\n    function countChildren(value) {\n      if (Array.isArray(value)) {\n        if (isVWD(value)) return 0;\n        return value.length;\n      }\n      if (value && typeof value === 'object') {\n        return Object.keys(value).filter(k => !k.startsWith('$')).length;\n      }\n      return 0;\n    }\n\n    // =====  =====\n\n    // \n    // +++\n    function extractNumericDisplayValue(value, isArray = false) {\n      //  null/undefined\n      if (value === null || value === undefined) {\n        return '';\n      }\n\n      // \n      if (isArray || Array.isArray(value)) {\n        if (isVWD(value)) {\n          return String(value[0]);\n        } else if (isSimpleArray(value)) {\n          return value.map(v => String(v ?? '')).join(', ');\n        } else {\n          // \n          return String(value);\n        }\n      }\n\n      // \n      const str = String(value).trim();\n\n      // 1.  \"85\", \"-20\", \"100%\"\n      if (/^-?\\d+(\\.\\d+)?%?$/.test(str)) {\n        return str;\n      }\n\n      // 2. ++ \",[] \" \n      // \"0,[-20, 120] User...\"\n      const rangeMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)(,\\s*\\[[^\\]]+\\])?\\s+/);\n      if (rangeMatch) {\n        // \n        if (rangeMatch[2]) {\n          return rangeMatch[1] + rangeMatch[2].trim();\n        }\n        // \n        return rangeMatch[1];\n      }\n\n      // 2.5. /, \"/,\" \n      // \"100/100,/'/'\"\n      const slashNumericMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?\\/-?\\d+(?:\\.\\d+)?%?),/);\n      if (slashNumericMatch) {\n        return slashNumericMatch[1];\n      }\n\n      // 3. , \",\" \n      // \"150000,...\"\n      const commaDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?),/);\n      if (commaDescMatch) {\n        return commaDescMatch[1];\n      }\n\n      // 4. + \" \" \n      // \"85 \"\n      const numericDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)\\s+[^\\d]/);\n      if (numericDescMatch) {\n        return numericDescMatch[1];\n      }\n\n      // 5. \n      return str;\n    }\n\n    // \n    // \"85\" -> 85, \"85,[0,100]\" -> 85, \"0,[-20, 120]\" -> 0\n    function extractFirstNumericValue(displayValue) {\n      if (!displayValue) return 0;\n      const str = String(displayValue).trim();\n\n      // \n      const match = str.match(/^(-?\\d+(?:\\.\\d+)?)/);\n      if (match) {\n        const num = parseFloat(match[1]);\n        return isNaN(num) ? 0 : num;\n      }\n\n      return 0;\n    }\n\n    // \n    function renderRow(key, value, path, deltaData) {\n      const changeIndicator = getChangeIndicator(path, deltaData);\n      const changedClass = changeIndicator ? 'mvu-changed' : '';\n\n      let displayValue;\n      let valueClass = 'mvu-value';\n\n      if (isVWD(value)) {\n        displayValue = String(value[0]);\n      } else if (isSimpleArray(value)) {\n        displayValue = value.map(v => String(v ?? '')).join(', ');\n        valueClass += ' mvu-array-value';\n      } else {\n        // \n        displayValue = extractNumericDisplayValue(value ?? '', false);\n      }\n\n      // [] \n      let diceIconHtml = '';\n      try {\n        //  extractNumericDisplayValue \n        //  \"85,[0,100]\"  85  100\n        if (typeof isNumericCell === 'function' && isNumericCell(displayValue)) {\n          // \n          const numericValue = extractFirstNumericValue(displayValue);\n          if (numericValue > 0) {\n            //  key key \n            let attrName = key;\n            if (key.includes('.')) {\n              const parts = key.split('.');\n              attrName = parts[parts.length - 1];\n            }\n            // \n            if (path && path.includes('.')) {\n              const pathParts = path.split('.');\n              const lastPart = pathParts[pathParts.length - 1];\n              // \n              if (lastPart && !/^\\d+$/.test(lastPart) && lastPart !== key) {\n                attrName = lastPart;\n              }\n            }\n            diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon\" data-path=\"${escapeHtml(path)}\" data-attr-name=\"${escapeHtml(attrName)}\" data-attr-value=\"${numericValue}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.6;font-size:calc(var(--acu-font-size, 13px) * 0.85);flex-shrink:0;\" title=\"\"></i>`;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule renderRow: ', e);\n      }\n\n      return `\n                <div class=\"mvu-row ${changedClass}\">\n                    <div class=\"mvu-key\">${escapeHtml(key)}</div>\n                    <div class=\"mvu-value-wrap\">\n                        <span class=\"${valueClass}\" data-path=\"${escapeHtml(path)}\">${escapeHtml(displayValue)}</span>\n                        ${diceIconHtml}\n                        ${changeIndicator ? `<span class=\"mvu-change-indicator\">${changeIndicator}</span>` : ''}\n                    </div>\n                </div>\n            `;\n    }\n\n    // \n    function renderCard(key, value, path, deltaData, depth, defaultExpanded, isHorizontal) {\n      const childCount = countChildren(value);\n      const collapsedClass = defaultExpanded ? '' : 'collapsed';\n\n      let bodyHtml = '';\n      let hasNestedCards = false; // \n      let nestedCardCount = 0; // \n      let rowCount = 0; // \n\n      if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n        // \n        value.forEach((item, index) => {\n          const itemPath = `${path}[${index}]`;\n\n          if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(`[${index}]`, item, itemPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            rowCount++;\n            bodyHtml += renderRow(`[${index}]`, item, itemPath, deltaData);\n          }\n        });\n      } else if (value && typeof value === 'object' && !isVWD(value)) {\n        // \n        const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n\n        for (const [childKey, childValue] of entries) {\n          const childPath = path ? `${path}.${childKey}` : childKey;\n\n          if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n            // /  \n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(childKey, childValue, childPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            //   \n            rowCount++;\n            bodyHtml += renderRow(childKey, childValue, childPath, deltaData);\n          }\n        }\n      }\n\n      const countText = Array.isArray(value) ? `[${childCount}]` : `(${childCount})`;\n\n      //  card-body  horizontal-nested \n      const bodyClass = isHorizontal && hasNestedCards ? 'mvu-card-body horizontal-nested' : 'mvu-card-body';\n\n      // \n      let nestedCardsNeedWidth = false;\n      if (isHorizontal && hasNestedCards && depth === 0) {\n        // \n        if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n          // \n          value.forEach(item => {\n            if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n              const itemChildCount = countChildren(item);\n              if (itemChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          });\n        } else if (value && typeof value === 'object' && !isVWD(value)) {\n          // \n          const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n          for (const [childKey, childValue] of entries) {\n            if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n              const childChildCount = countChildren(childValue);\n              if (childChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          }\n        }\n      }\n\n      //  has-nested-cards \n      // \n      // depth === 0\n      //   -  >= 2  <= 1 has-nested-cards\n      //   -  has-nested-cards\n      // depth > 0rowCount === 0 >= 2  has-nested-cards\n      const shouldAddHasNestedClass =\n        isHorizontal &&\n        hasNestedCards &&\n        ((depth === 0 && ((nestedCardCount >= 2 && rowCount <= 1) || nestedCardsNeedWidth)) || //  >= 2  <= 1\n          (depth > 0 && rowCount === 0 && nestedCardCount >= 2)); //  >= 2\n      const hasNestedClass = shouldAddHasNestedClass ? ' has-nested-cards' : '';\n\n      return `\n                <div class=\"mvu-card${hasNestedClass} ${collapsedClass}\" data-path=\"${escapeHtml(path)}\" data-depth=\"${depth}\">\n                    <div class=\"mvu-card-header\">\n                        <div class=\"mvu-card-title\">\n                            <span>${escapeHtml(key)}</span>\n                            <span class=\"mvu-card-count\">${countText}</span>\n                        </div>\n                        <span class=\"mvu-card-toggle\"></span>\n                    </div>\n                    <div class=\"${bodyClass}\">\n                        ${bodyHtml}\n                    </div>\n                </div>\n            `;\n    }\n\n    // [] \n    function renderNumericMode(mvuData) {\n      if (!mvuData || !mvuData.stat_data) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-inbox\"></i><p></p></div>';\n      }\n\n      // [] \n      let visibleLevels = {};\n      try {\n        const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n        if (saved) {\n          visibleLevels = JSON.parse(saved);\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule ', e);\n      }\n\n      // \n      const numericItems = [];\n\n      // \n      function collectNumericItems(obj, path, levelNames) {\n        if (!obj || typeof obj !== 'object') return;\n\n        if (Array.isArray(obj)) {\n          if (isVWD(obj) || isSimpleArray(obj)) {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const itemValue = String(item ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: itemPath,\n                    key: `[${index}]`,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: [...levelNames],\n                  });\n                }\n              }\n            });\n          } else {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const newLevelNames = [...levelNames, `[${index}]`];\n              collectNumericItems(item, itemPath, newLevelNames);\n            });\n          }\n        } else {\n          // \n          const entries = Object.entries(obj).filter(([k]) => !k.startsWith('$'));\n          for (const [key, value] of entries) {\n            const childPath = path ? `${path}.${key}` : key;\n            const newLevelNames = [...levelNames, key];\n\n            if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n              // \n              collectNumericItems(value, childPath, newLevelNames);\n            } else {\n              // \n              const itemValue = String(value ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: childPath,\n                    key: key,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: newLevelNames,\n                  });\n                }\n              }\n            }\n          }\n        }\n      }\n\n      // \n      const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n      for (const key of topKeys) {\n        const value = mvuData.stat_data[key];\n        collectNumericItems(value, key, [key]);\n      }\n\n      // [] \n      const filteredNumericItems = numericItems.filter(item => {\n        // key\n        // levelNames\n        let lastLevelKey = item.key;\n        const nonArrayLevels = item.levelNames.filter(level => level && !level.startsWith('['));\n        if (nonArrayLevels.length > 0) {\n          lastLevelKey = nonArrayLevels[nonArrayLevels.length - 1];\n        } else if (item.path && item.path.includes('.')) {\n          // levelNamespath\n          const parts = item.path.split('.');\n          lastLevelKey = parts[parts.length - 1];\n        }\n        //  BlacklistManager \n        return !BlacklistManager.isBlacklisted(lastLevelKey);\n      });\n\n      if (filteredNumericItems.length === 0) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-filter\"></i><p></p></div>';\n      }\n\n      // \n      //  2\n      const allLevelNames = new Set();\n      filteredNumericItems.forEach(item => {\n        // \n        const hierarchyLevels =\n          item.levelNames.length > 1\n            ? item.levelNames.slice(0, -1) // \n            : [];\n\n        hierarchyLevels.forEach(level => {\n          if (level && !level.startsWith('[')) {\n            // \n            allLevelNames.add(level);\n          }\n        });\n      });\n\n      const levelNamesArray = Array.from(allLevelNames).sort();\n\n      //  toggle \n      let levelTogglesHtml = '';\n      if (levelNamesArray.length > 0) {\n        const theme = getThemeColors();\n        const buttonTextColor = theme.buttonTextOnAccent || theme.textMain || '#6B4A5A';\n\n        // \n        let levelButtonsHtml = '';\n        levelNamesArray.forEach(levelName => {\n          const isVisible = visibleLevels[levelName] !== false; // \n          const activeStyle = isVisible\n            ? `background:var(--acu-accent);color:${buttonTextColor};border-color:var(--acu-accent);opacity:1;`\n            : 'background:transparent;color:var(--acu-text-sub);border-color:var(--acu-border);opacity:0.5;';\n          levelButtonsHtml += `<button class=\"mvu-level-toggle\" data-level=\"${escapeHtml(levelName)}\" data-visible=\"${isVisible}\" style=\"display:flex;align-items:center;gap:4px;font-size:calc(var(--acu-font-size, 13px) * 0.85);cursor:pointer;padding:2px 6px;border-radius:4px;border:1px solid;${activeStyle}transition:all 0.2s;\" title=\"${isVisible ? '' : ''}: ${escapeHtml(levelName)}\"><span>${escapeHtml(levelName)}</span></button>`;\n        });\n\n        // \n        levelTogglesHtml = `\n          <div class=\"mvu-level-controls-collapsible collapsed\">\n            <div class=\"mvu-level-controls-header\" style=\"padding:6px 8px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);cursor:pointer;display:flex;align-items:center;justify-content:space-between;user-select:none;\">\n              <span style=\"font-size:calc(var(--acu-font-size, 13px) * 0.85);color:var(--acu-text-sub);\"></span>\n              <i class=\"fa-solid fa-chevron-down mvu-level-controls-toggle-icon\" style=\"font-size:10px;color:var(--acu-text-sub);transition:transform 0.2s;\"></i>\n            </div>\n            <div class=\"mvu-level-controls-body\" style=\"padding:8px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);display:flex;flex-wrap:wrap;gap:6px;align-items:center;\">\n              ${levelButtonsHtml}\n            </div>\n          </div>\n        `;\n      }\n\n      // \n      let itemsHtml = '';\n      filteredNumericItems.forEach(item => {\n        //  data-levels \n        const nonArrayLevels = item.levelNames.filter(level => !level.startsWith('['));\n\n        // \n        const visibleLevels = item.levelNames.filter(level => {\n          if (level.startsWith('[')) return false; // \n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        //  1\n        //  visibleLevels \n        const pathLevels = visibleLevels.length > 1 ? visibleLevels.slice(0, -1) : [];\n\n        // \n        //  nonArrayLevels  N-1 \n        const hierarchyLevels = nonArrayLevels.length > 1 ? nonArrayLevels.slice(0, -1) : [];\n\n        const allLevelsVisible = hierarchyLevels.every(level => {\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        // \n        const pathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n        const attrName = item.key;\n\n        // \n        let finalAttrName = attrName;\n        if (item.path && item.path.includes('.')) {\n          const parts = item.path.split('.');\n          finalAttrName = parts[parts.length - 1];\n        }\n\n        // \n        const diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon\" data-path=\"${escapeHtml(item.path)}\" data-attr-name=\"${escapeHtml(finalAttrName)}\" data-attr-value=\"${item.numericValue}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.6;font-size:calc(var(--acu-font-size, 13px) * 0.85);flex-shrink:0;\" title=\"\"></i>`;\n\n        // \n        let displayValue = extractNumericDisplayValue(item.value, false);\n        //  \",[0, 100]\"\n        displayValue = displayValue.replace(/,\\s*\\[[^\\]]+\\]/g, '');\n\n        //  data-levels \n        // data-levels \n        const displayStyle = allLevelsVisible ? '' : 'display:none;';\n        const levelsJson = JSON.stringify(hierarchyLevels);\n\n        itemsHtml += `\n          <div class=\"mvu-numeric-item\" data-levels='${escapeHtml(levelsJson)}' style=\"${displayStyle}display:flex;align-items:center;padding:6px 8px;margin-bottom:4px;background:var(--acu-table-hover);border-radius:4px;border-left:3px solid var(--acu-accent);\">\n            <div style=\"flex:1;min-width:0;\">\n              <div class=\"mvu-path-display\" style=\"font-size:calc(var(--acu-font-size, 13px) * 0.77);color:var(--acu-text-sub);margin-bottom:2px;\">${escapeHtml(pathDisplay)}</div>\n              <div style=\"display:flex;align-items:center;gap:6px;\">\n                <span style=\"font-size:calc(var(--acu-font-size, 13px) * 0.92);color:var(--acu-text-main);font-weight:bold;\">${escapeHtml(finalAttrName)}</span>\n                <span class=\"mvu-value\" data-path=\"${escapeHtml(item.path)}\" style=\"font-size:var(--acu-font-size, 13px);color:var(--acu-accent);font-weight:bold;cursor:pointer;\" title=\"\">${escapeHtml(displayValue)}</span>\n                ${diceIconHtml}\n              </div>\n            </div>\n          </div>\n        `;\n      });\n\n      return levelTogglesHtml + '<div class=\"mvu-numeric-items\" style=\"padding:0 8px;\">' + itemsHtml + '</div>';\n    }\n\n    // =====  API =====\n    return {\n      MODULE_ID: MODULE_ID,\n\n      isAvailable: isAvailable,\n      getData: getData,\n      getDataWithRetry: getDataWithRetry,\n\n      // \n      diagnoseVariableFramework: async function () {\n        const result = {\n          timestamp: new Date().toISOString(),\n          era: {\n            available: false,\n            eventEmit: typeof (window.eventEmit || window.parent?.eventEmit) === 'function',\n            eventOn: typeof (window.eventOn || window.parent?.eventOn) === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          mvu: {\n            available: false,\n            apiExists: typeof window.Mvu !== 'undefined',\n            getDataExists: typeof window.Mvu?.getMvuData === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          cache: {\n            hasCache: !!cachedEraData,\n            cacheKeys: cachedEraData ? Object.keys(cachedEraData) : [],\n          },\n          recommendation: '',\n        };\n\n        //  ERA\n        if (result.era.eventEmit && result.era.eventOn) {\n          try {\n            const eraData = await Promise.race([\n              getEraData(),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 2000)),\n            ]);\n            result.era.available = true;\n            result.era.dataAvailable = !!(eraData && eraData.stat_data);\n          } catch (e) {\n            result.era.error = e.message;\n          }\n        }\n\n        //  MVU\n        if (result.mvu.apiExists && result.mvu.getDataExists) {\n          try {\n            await waitGlobalInitialized('Mvu');\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            result.mvu.available = true;\n            result.mvu.dataAvailable = !!(mvuData && mvuData.stat_data);\n          } catch (e) {\n            result.mvu.error = e.message;\n          }\n        }\n\n        // \n        if (result.era.dataAvailable) {\n          result.recommendation = 'ERA ';\n        } else if (result.mvu.dataAvailable) {\n          result.recommendation = 'MVU ';\n        } else if (result.era.available || result.mvu.available) {\n          result.recommendation = '';\n        } else {\n          result.recommendation = ' MVU  ERA ';\n        }\n\n        return result;\n      },\n\n      injectStyles: function () {\n        //  document iframe \n        const targetDoc = window.parent?.document || document;\n        if (targetDoc.getElementById('mvu-module-styles')) return;\n        const styleEl = targetDoc.createElement('style');\n        styleEl.id = 'mvu-module-styles';\n        styleEl.textContent = STYLES;\n        targetDoc.head.appendChild(styleEl);\n      },\n\n      renderNavButton: function (isActive) {\n        //  isAvailable()\n        const activeClass = isActive ? 'active' : '';\n        return `<button class=\"acu-nav-btn acu-mvu-btn $${activeClass}\" id=\"acu-btn-mvu\" data-table=\"$${MODULE_ID}\" style=\"order:-1;\">\n                    <i class=\"fa-solid fa-code-branch\"></i><span></span>\n                </button>`;\n      },\n\n      renderPanel: function () {\n        // \n        // \n\n        const mvuData = getData();\n\n        // MVU  ERA\n        const varMode = detectMode();\n        const isEraMode = varMode === 'era';\n\n        // [] \n        let isNumericMode = false;\n        try {\n          const saved = localStorage.getItem('acu_mvu_numeric_mode');\n          isNumericMode = saved === 'true';\n        } catch (e) {\n          console.warn('[DICE]MvuModule ', e);\n        }\n\n        // MVU\n        const layoutMode = 'vertical-layout';\n\n        // \n        const panelTitle = isEraMode ? 'ERA ' : 'MVU ';\n\n        // MVU  null\n        if (!mvuData) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-exclamation-circle\"></i>\n                                <p> ${isEraMode ? 'ERA' : 'MVU'} </p>\n                                <p class=\"mvu-empty-hint\"> ${isEraMode ? 'ERA ' : 'MVU '}</p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        //  stat_data  null\n        if (\n          !mvuData.stat_data ||\n          (typeof mvuData.stat_data === 'object' && Object.keys(mvuData.stat_data).length === 0)\n        ) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-inbox\"></i>\n                                <p></p>\n                                <p class=\"mvu-empty-hint\"> AI </p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        // [] \n        if (isNumericMode) {\n          const numericHtml = renderNumericMode(mvuData);\n          return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span> <span style=\"font-size:calc(var(--acu-font-size,13px) * 0.85);color:var(--acu-text-sub);margin-left:6px;\">()</span></div>\n                            <div class=\"acu-title-sub\">()</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode active\" title=\"\">\n                                <i class=\"fa-solid fa-list\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode} mvu-numeric-mode\">\n                        ${numericHtml}\n                    </div>\n                `;\n        }\n\n        // \n        const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n\n        let cardsHtml = '';\n        for (const key of topKeys) {\n          const value = mvuData.stat_data[key];\n          const childCount = countChildren(value);\n\n          if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n            // /  \n            // MVU isHorizontal  false\n            cardsHtml += renderCard(key, value, key, mvuData.delta_data, 0, true, false);\n          } else {\n            //   \n            cardsHtml += `\n                            <div class=\"mvu-card\" data-path=\"${escapeHtml(key)}\" data-depth=\"0\">\n                                <div class=\"mvu-card-body\">\n                                    ${renderRow(key, value, key, mvuData.delta_data)}\n                                </div>\n                            </div>\n                        `;\n          }\n        }\n\n        return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                            <div class=\"acu-title-sub\">(${topKeys.length})</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode\" title=\"\">\n                                <i class=\"fa-solid fa-filter\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode}\">\n                        ${cardsHtml}\n                    </div>\n                `;\n      },\n\n      bindEvents: function ($container) {\n        //  jQuery\n        const $ = window.parent?.jQuery || window.jQuery;\n        if (!$ || !$container || !$container.length) {\n          console.warn('[DICE]MvuModule bindEvents: jQuery or container not available');\n          return;\n        }\n\n        //  jQuery \n        const $panel = $('#acu-data-area');\n        if (!$panel.length) {\n          console.warn('[DICE]MvuModule bindEvents: #acu-data-area not found');\n          return;\n        }\n\n        // \n        $panel.off('.mvu');\n\n        // /\n        $panel.on('click.mvu', '.mvu-card-header', function (e) {\n          e.stopPropagation();\n          const $card = $(this).closest('.mvu-card');\n          const $body = $card.find('> .mvu-card-body').first();\n\n          // \n          if ($body.is(':animated') || $body.hasClass('animating')) return;\n\n          if ($card.hasClass('collapsed')) {\n            //  hide()  collapsed \n            $body.hide();\n            $card.removeClass('collapsed');\n            $body.addClass('animating').slideDown(180, function () {\n              $(this).removeClass('animating');\n            });\n          } else {\n            // \n            $body.addClass('animating').slideUp(180, function () {\n              $card.addClass('collapsed');\n              $(this).removeClass('animating');\n            });\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-btn-refresh', function (e) {\n          e.stopPropagation();\n          MvuModule.refresh($panel);\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-btn-numeric-mode', function (e) {\n          e.stopPropagation();\n          try {\n            const isCurrentlyNumeric = $(this).hasClass('active');\n            const newMode = !isCurrentlyNumeric;\n            localStorage.setItem('acu_mvu_numeric_mode', String(newMode));\n            // \n            if (typeof saveActiveTabState === 'function') {\n              const currentTab = getActiveTabState();\n              saveActiveTabState(currentTab);\n            }\n            if (typeof renderInterface === 'function') {\n              renderInterface();\n            }\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n            if (window.toastr) window.toastr.error('');\n          }\n        });\n\n        // [] /\n        $panel.on('click.mvu', '.mvu-level-controls-header', function (e) {\n          e.stopPropagation();\n          const $header = $(this);\n          const $collapsible = $header.closest('.mvu-level-controls-collapsible');\n\n          //  collapsed CSS \n          $collapsible.toggleClass('collapsed');\n        });\n\n        // []  toggle\n        $panel.on('click.mvu', '.mvu-level-toggle', function (e) {\n          e.stopPropagation();\n          const $button = $(this);\n          const levelName = $button.data('level');\n          const currentVisible = $button.data('visible') === 'true' || $button.data('visible') === true;\n          const isVisible = !currentVisible;\n\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            const visibleLevels = saved ? JSON.parse(saved) : {};\n            visibleLevels[levelName] = isVisible;\n            localStorage.setItem('acu_mvu_numeric_mode_visible_levels', JSON.stringify(visibleLevels));\n\n            // \n            const theme = getThemeColors();\n            const buttonTextColor = theme.buttonTextOnAccent || theme.textMain || '#6B4A5A';\n            $button.data('visible', isVisible);\n            if (isVisible) {\n              $button.css({\n                background: 'var(--acu-accent)',\n                color: buttonTextColor,\n                borderColor: 'var(--acu-accent)',\n                opacity: '1',\n              });\n              $button.attr('title', `: ${levelName}`);\n            } else {\n              $button.css({\n                background: 'transparent',\n                color: 'var(--acu-text-sub)',\n                borderColor: 'var(--acu-border)',\n                opacity: '0.5',\n              });\n              $button.attr('title', `: ${levelName}`);\n            }\n\n            //  3\n            $('.mvu-numeric-item').each(function () {\n              const $item = $(this);\n              try {\n                const levels = JSON.parse($item.attr('data-levels') || '[]');\n                if (levels.includes(levelName)) {\n                  // \n                  const visibleLevels = levels.filter(level => {\n                    const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n                    const prefs = saved ? JSON.parse(saved) : {};\n                    return prefs[level] !== false;\n                  });\n\n                  //  levels \n                  const pathLevels = visibleLevels;\n\n                  const newPathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n\n                  // \n                  $item.find('.mvu-path-display').text(newPathDisplay);\n                }\n              } catch (e) {\n                console.warn('[DICE]MvuModule ', e);\n              }\n            });\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-value', function (e) {\n          e.stopPropagation();\n          const $value = $(this);\n          const path = $value.data('path');\n          if (!path) {\n            console.warn('[DICE]MvuModule No path on value element');\n            return;\n          }\n          const currentValue = $value\n            .text()\n            .replace(/\\s*\\$\\s*$/, '')\n            .trim(); //  $\n\n          MvuModule.showEditDialog(path, currentValue, async function (newValue) {\n            if (newValue !== null && newValue !== currentValue) {\n              const success = await MvuModule.setValue(path, newValue);\n              const toastr = window.parent?.toastr || window.toastr;\n              if (success) {\n                $value.text(newValue);\n                $value.css('background', 'var(--acu-success-bg)');\n                setTimeout(() => $value.css('background', ''), 1500);\n              } else {\n                if (toastr) toastr.error('');\n              }\n            }\n          });\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-dice-icon', function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n          const $icon = $(this);\n          const path = $icon.data('path');\n          const attrName = $icon.data('attr-name') || '';\n          const attrValue = parseInt($icon.data('attr-value'), 10) || 50;\n\n          // \n          if (!path) {\n            console.warn('[DICE]MvuModule ');\n            return;\n          }\n\n          //  MVU \n          if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n            console.warn('[DICE]MvuModule MVU ');\n            // \n            if (typeof showDicePanel === 'function') {\n              showDicePanel({\n                targetValue: attrValue,\n                targetName: attrName,\n                initiatorName: '<user>',\n                fromMvu: false,\n              });\n            }\n            return;\n          }\n\n          // \n          let parsedInfo = null;\n          try {\n            parsedInfo = parseMvuPathForDice(path, attrValue);\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n\n          // \n          if (typeof showDicePanel === 'function') {\n            showDicePanel({\n              targetValue: attrValue,\n              targetName: attrName,\n              initiatorName: parsedInfo?.initiator || '<user>',\n              fromMvu: true,\n              mvuPath: path,\n              mvuParsedInfo: parsedInfo,\n            });\n          }\n        });\n\n        //  ST  swipe regenerate\n        (function () {\n          //  documentiframe \n          const targetDoc = window.parent?.document || document;\n          const $doc = $(targetDoc);\n\n          // \n          $doc.off('touchstart.mvuSwipeFix touchmove.mvuSwipeFix touchend.mvuSwipeFix', '#acu-data-area');\n\n          let touchStartX = 0;\n          let touchStartY = 0;\n          let isHorizontalSwipe = false;\n\n          //  #acu-data-area  MVU \n          $doc.on('touchstart.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) return;\n\n            if (e.originalEvent.touches.length === 1) {\n              touchStartX = e.originalEvent.touches[0].clientX;\n              touchStartY = e.originalEvent.touches[0].clientY;\n              isHorizontalSwipe = false;\n            }\n          });\n\n          $doc.on('touchmove.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              return;\n            }\n\n            if (e.originalEvent.touches.length !== 1) return;\n\n            const touch = e.originalEvent.touches[0];\n            const deltaX = Math.abs(touch.clientX - touchStartX);\n            const deltaY = Math.abs(touch.clientY - touchStartY);\n\n            // X > Y * 1.5\n            // deltaYdeltaX\n            const isHorizontal =\n              deltaY < 5\n                ? deltaX > 5 && deltaX > deltaY * 2 // deltaYdeltaX > 5deltaY\n                : deltaX > deltaY * 1.5 && deltaX > 10; // \n\n            if (isHorizontal) {\n              isHorizontalSwipe = true;\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n            }\n          });\n\n          $doc.on('touchend.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              isHorizontalSwipe = false;\n              touchStartX = 0;\n              touchStartY = 0;\n              return;\n            }\n\n            // \n            if (isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              isHorizontalSwipe = false;\n            }\n            touchStartX = 0;\n            touchStartY = 0;\n          });\n\n          // \n          const captureHandlerTouchStart = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1) {\n              touchStartX = e.touches[0].clientX;\n              touchStartY = e.touches[0].clientY;\n            }\n          };\n          const captureHandlerTouchMove = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1 && touchStartX && touchStartY) {\n              const touch = e.touches[0];\n              const deltaX = Math.abs(touch.clientX - touchStartX);\n              const deltaY = Math.abs(touch.clientY - touchStartY);\n              // \n              const isHorizontal =\n                deltaY < 5 ? deltaX > 5 && deltaX > deltaY * 2 : deltaX > deltaY * 1.5 && deltaX > 10;\n              if (isHorizontal) {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                e.preventDefault();\n              }\n            }\n          };\n          const captureHandlerTouchEnd = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              e.preventDefault();\n            }\n          };\n          // \n          targetDoc.addEventListener('touchstart', captureHandlerTouchStart, true);\n          targetDoc.addEventListener('touchmove', captureHandlerTouchMove, true);\n          targetDoc.addEventListener('touchend', captureHandlerTouchEnd, true);\n        })();\n\n        // \n        $panel.on('click.mvu', '.acu-close-btn', function (e) {\n          e.stopPropagation();\n          const $input = $panel.find('.acu-search-input');\n\n          // \n          if ($input.length && $input.val()) {\n            $input.val('').trigger('input').focus();\n            return;\n          }\n\n          // \n          if (typeof saveActiveTabState === 'function') {\n            saveActiveTabState(null);\n          }\n          if (typeof renderInterface === 'function') {\n            renderInterface();\n          }\n        });\n\n        // \n        $panel.on('pointerdown.mvu', '.acu-height-drag-handle', function (e) {\n          if (e.button !== 0) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const handle = this;\n          handle.setPointerCapture(e.pointerId);\n          $(handle).addClass('active');\n          const startHeight = $panel.height();\n          const startY = e.clientY;\n          const tableName = $(handle).data('table');\n\n          //  MIN_PANEL_HEIGHT  MAX_PANEL_HEIGHT\n          const MIN_PANEL_HEIGHT = typeof window.MIN_PANEL_HEIGHT !== 'undefined' ? window.MIN_PANEL_HEIGHT : 200;\n          const MAX_PANEL_HEIGHT = typeof window.MAX_PANEL_HEIGHT !== 'undefined' ? window.MAX_PANEL_HEIGHT : 800;\n\n          handle.onpointermove = function (moveE) {\n            const dy = moveE.clientY - startY;\n            let newHeight = startHeight - dy; // \n            if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n            if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n            $panel.css('height', newHeight + 'px');\n          };\n          handle.onpointerup = function (upE) {\n            $(handle).removeClass('active');\n            handle.releasePointerCapture(upE.pointerId);\n            handle.onpointermove = null;\n            handle.onpointerup = null;\n            if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n              const heights = getTableHeights();\n              heights[tableName] = parseInt($panel.css('height'));\n              saveTableHeights(heights);\n              $panel.addClass('acu-manual-mode');\n            }\n          };\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-height-drag-handle', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = $(this).data('table');\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-panel-header', function (e) {\n          if ($(e.target).closest('.acu-search-input, .acu-close-btn, .mvu-header-btn').length) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = MvuModule.MODULE_ID;\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n      },\n\n      showEditDialog: function (path, currentValue, onSave) {\n        //  jQuery  document\n        const $ = window.parent?.jQuery || window.jQuery;\n        const targetDoc = window.parent?.document || document;\n        if (!$) return;\n\n        // \n        $(targetDoc).find('.mvu-edit-overlay').remove();\n\n        const currentTheme = (typeof getConfig === 'function' ? getConfig().theme : null) || 'retro';\n\n        const html = `\n                    <div class=\"mvu-edit-overlay acu-edit-overlay acu-theme-${currentTheme}\">\n                        <div class=\"mvu-edit-dialog acu-edit-dialog\">\n                            <div class=\"acu-edit-title\">\n                                <i class=\"fa-solid fa-edit\" style=\"opacity:0.7;\"></i>\n                                <span></span>\n                            </div>\n                            <div class=\"mvu-edit-path\">${escapeHtml(path)}</div>\n                            <textarea class=\"mvu-edit-textarea acu-edit-textarea\">${escapeHtml(currentValue)}</textarea>\n                            <div class=\"mvu-edit-hint\">Ctrl+Enter  | Esc </div>\n                            <div class=\"acu-dialog-btns\">\n                                <button class=\"acu-dialog-btn mvu-btn-cancel\">\n                                    <i class=\"fa-solid fa-times\"></i> \n                                </button>\n                                <button class=\"acu-dialog-btn acu-btn-confirm mvu-btn-save\">\n                                    <i class=\"fa-solid fa-check\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `;\n\n        $(targetDoc.body).append(html);\n        const $overlay = $(targetDoc).find('.mvu-edit-overlay');\n        const $input = $overlay.find('.mvu-edit-textarea');\n\n        setTimeout(() => $input.focus().select(), 50);\n\n        // \n        $overlay.on('click', '.mvu-btn-cancel', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          $overlay.remove();\n          onSave(null);\n        });\n\n        // \n        $overlay.on('click', '.mvu-btn-save', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const newValue = $input.val();\n          $overlay.remove();\n          onSave(newValue);\n        });\n\n        // \n        $overlay.on('click', function (e) {\n          if ($(e.target).hasClass('mvu-edit-overlay')) {\n            $overlay.remove();\n            onSave(null);\n          }\n        });\n\n        // \n        $input.on('keydown', function (e) {\n          if (e.key === 'Escape') {\n            e.preventDefault();\n            $overlay.remove();\n            onSave(null);\n          } else if (e.key === 'Enter' && e.ctrlKey) {\n            e.preventDefault();\n            const newValue = $input.val();\n            $overlay.remove();\n            onSave(newValue);\n          }\n        });\n      },\n\n      setValue: async function (path, newValue) {\n        if (!isAvailable()) return false;\n\n        const mode = detectMode();\n\n        try {\n          let parsedValue = newValue;\n          if (newValue === 'true') parsedValue = true;\n          else if (newValue === 'false') parsedValue = false;\n          else if (!isNaN(Number(newValue)) && String(newValue).trim() !== '') {\n            parsedValue = Number(newValue);\n          }\n\n          if (mode === 'era') {\n            return await setEraValue(path, parsedValue);\n          } else {\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            if (!mvuData) {\n              console.error('[DICE]MvuModule  MVU ');\n              return false;\n            }\n\n            const success = await window.Mvu.setMvuVariable(mvuData, path, parsedValue, {\n              reason: '',\n              is_recursive: false,\n            });\n\n            if (success) {\n              await window.Mvu.replaceMvuData(mvuData, { type: 'message', message_id: 'latest' });\n            } else {\n              console.warn('[DICE]MvuModule setMvuVariable  false');\n            }\n\n            return success;\n          }\n        } catch (e) {\n          console.error('[DICE]MvuModule setValue error:', e);\n          return false;\n        }\n      },\n\n      isModuleTab: function (tableName) {\n        return tableName === MODULE_ID;\n      },\n\n      //  ERA  ERA \n      clearCache: function () {\n        cachedEraData = null;\n        console.log('[DICE]MvuModule  ERA ');\n      },\n\n      // \n      detectMode: function () {\n        return detectMode();\n      },\n\n      refresh: function ($container) {\n        // \n        this.clearCache();\n\n        if (!$container || !$container.length) {\n          const $panel = $('#acu-data-area');\n          if (!$panel.length) return;\n          $container = $panel;\n        }\n        // \n        const $refreshBtn = $container.find('.mvu-btn-refresh');\n        if ($refreshBtn.length) {\n          $refreshBtn.find('i').addClass('fa-spin');\n        }\n\n        // \n        //  10  1  10 \n        this.getDataWithRetry(10, 1000)\n          .then(mvuData => {\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            //  toastr \n            const toastr = window.parent?.toastr || window.toastr;\n            if (toastr && !mvuData) {\n              toastr.warning(' MVU ');\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error refreshing data:', err);\n\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            //  toastr \n            const toastr = window.parent?.toastr || window.toastr;\n            if (toastr) toastr.error('');\n          });\n      },\n    };\n  })();\n  // MVU \n  // COC\n  const DEFAULT_DICE_CONFIG = {\n    critSuccessMax: 5,\n    hardSuccessDiv: 5,\n    difficultSuccessDiv: 2,\n    critFailMin: 96,\n    ruleType: 'high_good',\n    lastDiceType: '1d100',\n    // DND \n    dndCritSuccess: 20,\n    dndCritFail: 1,\n    // : initiator_lose | tie | initiator_win\n    contestTieRule: 'initiator_lose',\n    // user\n    hideDiceResultFromUser: false,\n  };\n\n  const getDiceConfig = () => Store.get(STORAGE_KEY_DICE_CONFIG, DEFAULT_DICE_CONFIG);\n  const saveDiceConfig = cfg => {\n    const oldCfg = getDiceConfig();\n    const newCfg = { ...oldCfg, ...cfg };\n    Store.set(STORAGE_KEY_DICE_CONFIG, newCfg);\n    // \n    const changedKeys = Object.keys(cfg).filter(k => oldCfg[k] !== newCfg[k]);\n    if (changedKeys.length > 0) {\n      console.info(`[DICE]: ${changedKeys.join(', ')}`);\n    }\n  };\n\n  // [] \n  const hideDiceResultsInUserMessages = () => {\n    try {\n      const diceCfg = getDiceConfig();\n      const shouldHide = diceCfg.hideDiceResultFromUser;\n\n      // [] \n      if (!shouldHide) {\n        // \n        try {\n          const $ta = $('#send_textarea');\n          if ($ta.length) {\n            const textareaVal = $ta.val() || '';\n            const originalText = $ta.data('acu-original-dice-text');\n            // \n            if (!textareaVal.includes('[]') && !originalText) {\n              return;\n            }\n          } else {\n            // \n            return;\n          }\n        } catch (e) {\n          // \n          return;\n        }\n      }\n\n      console.info(`[DICE]: ${shouldHide ? '' : ''}`);\n\n      // : \"XX\"\n      const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n      // : \"... vs ...... (...)  ......... (...)  .........\"\n      const contestDiceRegex =\n        /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n      // [] \n      try {\n        const $ta = $('#send_textarea');\n        if ($ta.length) {\n          let textareaVal = $ta.val() || '';\n          let modifiedText = textareaVal;\n\n          if (shouldHide) {\n            // \n            const contestRegex =\n              /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n            const normalRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n            if (contestRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(contestRegex, '[]');\n            }\n            if (normalRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(normalRegex, '[]');\n            }\n          } else {\n            // \n            const originalText = $ta.data('acu-original-dice-text');\n            if (originalText && textareaVal.includes('[]')) {\n              // \n              modifiedText = textareaVal.replace(/\\[\\]/g, originalText);\n              $ta.removeData('acu-original-dice-text');\n            }\n          }\n\n          if (modifiedText !== textareaVal) {\n            $ta.val(modifiedText).trigger('input').trigger('change');\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]ACU :', e);\n      }\n\n      // \n      if (!shouldHide) {\n        // \n        // \n        let lastMessageId;\n        try {\n          lastMessageId = getLastMessageId();\n        } catch (e) {\n          //  lastMessageId \n          return;\n        }\n\n        // \n        if (lastMessageId < 0) {\n          return;\n        }\n\n        try {\n          const userMessages = getChatMessages(`0-${lastMessageId}`, { role: 'user' });\n          // \n          if (!userMessages || userMessages.length === 0) {\n            return;\n          }\n\n          let restoredCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const $msgElement = retrieveDisplayedMessage(msg.message_id);\n              if (!$msgElement || !$msgElement.length) return;\n\n              const $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) return;\n\n              // \n              const currentText = $mesText.text();\n              if (currentText.includes('[]')) {\n                // \n                const originalText = msg.message || '';\n                if (originalText) {\n                  $mesText.text(originalText);\n                  restoredCount++;\n                }\n              }\n            } catch (e) {\n              // \n            }\n          });\n          if (restoredCount > 0) {\n            console.info(`[DICE] ${restoredCount} `);\n          }\n        } catch (e) {\n          // \n          // \n        }\n        return;\n      }\n\n      // \n      try {\n        const lastMessageId = getLastMessageId();\n        if (lastMessageId < 0) return;\n\n        const userMessages = getChatMessages(`0-${lastMessageId}`, { role: 'user' });\n\n        userMessages.forEach(msg => {\n          try {\n            const $msgElement = retrieveDisplayedMessage(msg.message_id);\n            if (!$msgElement || !$msgElement.length) return;\n\n            const $mesText = $msgElement.find('.mes_text');\n            if (!$mesText || !$mesText.length) return;\n\n            // \n            let textContent = $mesText.text();\n            // \n            if (textContent.includes('[]')) {\n              return;\n            }\n\n            let modifiedText = textContent;\n\n            // \n            //  lastIndex \n            const contestRegex =\n              /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n            if (contestRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(contestRegex, '[]');\n            }\n\n            // \n            const normalRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n            if (normalRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(normalRegex, '[]');\n            }\n\n            // HTML\n            if (modifiedText !== textContent) {\n              //  text() HTML\n              $mesText.text(modifiedText);\n            }\n          } catch (e) {\n            console.warn(`[DICE]ACU  ${msg.message_id} :`, e);\n          }\n        });\n      } catch (e) {\n        // [] \n        if (shouldHide) {\n          console.warn('[DICE]ACU :', e);\n        }\n      }\n    } catch (e) {\n      // [] \n      // \n      const diceCfg = getDiceConfig();\n      if (diceCfg && diceCfg.hideDiceResultFromUser) {\n        console.warn('[DICE]ACU :', e);\n      }\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const BUILTIN_ATTRIBUTE_PRESETS = [\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'coc7',\n      name: 'COC',\n      builtin: true,\n      description: '7816',\n      baseAttributes: [\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n      ],\n      specialAttributes: [\n        //  15-1109560\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        //  9-8547\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        //  8-6536\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        //  3-4122\n        { name: '', formula: '1+2d20', range: [3, 41] },\n        // \n        { name: '', formula: '/2', range: [1, 99] },\n        // COC \n        { name: 'SAN', formula: '', range: [1, 99] },\n        { name: '', formula: '1d5', range: [1, 5] },\n      ],\n    },\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'dnd5e',\n      name: 'DND',\n      builtin: true,\n      description: '568',\n      baseAttributes: [\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n      ],\n      specialAttributes: [\n        //  10-2015\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        //  7-1712\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        //  4-149\n        { name: '', formula: '2+2d6', range: [4, 14] },\n        { name: '', formula: '2+2d6', range: [4, 14] },\n      ],\n    },\n  ];\n\n  // \n  const AttributePresetManager = (() => {\n    let _cache = null;\n\n    return {\n      //  + \n      getAllPresets() {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        // \n        let needsSave = false;\n        stored.forEach(preset => {\n          const presetVersion = preset.version || '0.0.0';\n          if (compareVersion(presetVersion, PRESET_FORMAT_VERSION) < 0) {\n            console.log(\n              `[DICE]AttributePresetManager  \"${preset.name}\"  (${presetVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n            preset.version = PRESET_FORMAT_VERSION;\n            needsSave = true;\n          }\n        });\n        if (needsSave) {\n          Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n          // \n          _cache = null;\n        }\n        // \n        if (!needsSave && _cache) {\n          return _cache;\n        }\n        _cache = [...BUILTIN_ATTRIBUTE_PRESETS, ...stored];\n        return _cache;\n      },\n\n      // null = \n      getActivePreset() {\n        const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        if (!activeId) return null;\n        return this.getAllPresets().find(p => p.id === activeId) || null;\n      },\n\n      // \n      setActivePreset(id) {\n        try {\n          // idnull\n          const finalId = id === '' || id === undefined ? null : id;\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, finalId);\n          // \n          _cache = null;\n          console.log('[DICE]AttributePresetManager :', finalId);\n          return true;\n        } catch (err) {\n          console.error('[DICE]AttributePresetManager :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const newPreset = {\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          builtin: false,\n          version: preset.version || PRESET_FORMAT_VERSION,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates };\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        }\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getAllPresets().find(p => p.id === id);\n        if (!preset) return null;\n        const exported = {\n          format: 'acu_attr_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n        };\n        delete exported.builtin; // \n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr, autoUpdate = false) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.format !== 'acu_attr_preset_v1') {\n            throw new Error('');\n          }\n\n          // \n          if (!data.name || !data.baseAttributes || !Array.isArray(data.baseAttributes)) {\n            throw new Error('');\n          }\n\n          const importedVersion = data.version || '0.0.0';\n          const needsUpdate = compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            builtin: false,\n            version: autoUpdate && needsUpdate ? PRESET_FORMAT_VERSION : importedVersion,\n            createdAt: new Date().toISOString(),\n          };\n\n          const result = this.createPreset(imported);\n          if (result && needsUpdate && !autoUpdate) {\n            console.warn(\n              `[DICE]AttributePresetManager  \"${result.name}\"  (${importedVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n          }\n          return result;\n        } catch (e) {\n          console.error('[DICE]AttributePresetManager :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  /**\n   * \n   * : 3d6, 4d6kh3, 4d6dl1, 4d6dh1\n   * @returns  NaN\n   */\n  const rollDiceExpression = expr => {\n    const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n\n    const match = expr.match(/^(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?$/i);\n    if (!match) return NaN;\n\n    const [, countStr, sidesStr, keepDrop] = match;\n    const count = parseInt(countStr, 10);\n    const sides = parseInt(sidesStr, 10);\n\n    let rolls = Array.from({ length: count }, () => rollDice(sides));\n\n    //  keep/drop\n    if (keepDrop) {\n      const kd = keepDrop.toLowerCase();\n      const n = parseInt(kd.slice(2), 10);\n      rolls.sort((a, b) => b - a); // \n\n      if (kd.startsWith('kh'))\n        rolls = rolls.slice(0, n); // n\n      else if (kd.startsWith('kl'))\n        rolls = rolls.slice(-n); // n\n      else if (kd.startsWith('dh'))\n        rolls = rolls.slice(n); // n\n      else if (kd.startsWith('dl')) rolls = rolls.slice(0, -n); // n\n    }\n\n    return rolls.reduce((a, b) => a + b, 0);\n  };\n\n  /**\n   * \n   * @param formula  \"/2+1d10\"  \"3d6*5\"\n   * @param context  { : 50, : 40 }\n   * @returns \n   */\n  const evaluateFormula = (formula, context = {}) => {\n    if (!formula) return 0;\n\n    let expr = String(formula).trim();\n\n    // 1. \n    const varNames = Object.keys(context).sort((a, b) => b.length - a.length);\n    for (const name of varNames) {\n      const value = context[name];\n      if (typeof value === 'number' && !isNaN(value)) {\n        // \n        expr = expr.split(name).join(`(${value})`);\n      }\n    }\n\n    // 2. \n    expr = expr.replace(/\\d+d\\d+(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi, match => {\n      const result = rollDiceExpression(match);\n      return isNaN(result) ? '0' : String(result);\n    });\n\n    // 3. \n    if (!/^[\\d\\s+\\-*/().]+$/.test(expr)) {\n      console.warn('[DICE]evaluateFormula :', formula, '', expr);\n      return 0;\n    }\n\n    // 4. \n    try {\n      // eslint-disable-next-line no-new-func\n      const result = new Function(`return (${expr})`)();\n      return Math.round(result); // \n    } catch (e) {\n      console.error('[DICE]evaluateFormula :', formula, '', expr, e);\n      return 0;\n    }\n  };\n\n  /**\n   * \n   * @param formula \n   * @param range  [min, max]\n   * @param context \n   * @returns \n   */\n  const generateAttributeValue = (formula, range, context) => {\n    let value = evaluateFormula(formula, context);\n\n    if (range && Array.isArray(range) && range.length === 2) {\n      value = Math.max(range[0], Math.min(range[1], value));\n    }\n\n    return value;\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const DASHBOARD_TABLE_CONFIG = {\n    global: {\n      tableKeywords: ['', '', ''],\n      columns: {\n        detailLocation: { keywords: ['', '', '', ''], fallbackIndex: null },\n        currentLocation: { keywords: ['', '', '', ''], fallbackIndex: 2 },\n      },\n    },\n    player: {\n      // : user, <user>\n      tableKeywords: ['', '', '', '', 'player', '', 'user', '<user>'],\n      columns: {\n        name: { keywords: ['', '', '', 'name'], fallbackIndex: 1 },\n        status: { keywords: ['', '', '', ''], fallbackIndex: null },\n        position: { keywords: ['', '', ''], fallbackIndex: null },\n        attrs: { keywords: ['', ''], fallbackIndex: null, isMultiple: true },\n        // : , , , \n        money: {\n          keywords: ['', '', '', '', '', '', '', '', ''],\n          fallbackIndex: null,\n        },\n        resources: { keywords: ['', '', 'resources'], fallbackIndex: null },\n      },\n    },\n    location: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: {\n          keywords: ['', '', '', '', '', '', '', ''],\n          fallbackIndex: 1,\n        },\n        description: { keywords: ['', '', '', '', ''], fallbackIndex: null },\n      },\n    },\n    npc: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        'NPC',\n        '',\n        '',\n        '',\n        '',\n        'character',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', ''], fallbackIndex: 1 },\n        status: { keywords: ['', ''], fallbackIndex: null },\n        position: { keywords: ['', ''], fallbackIndex: null },\n        inScene: { keywords: ['', '', '', ''], fallbackIndex: null },\n      },\n    },\n    quest: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        progress: { keywords: ['', '', '/'], fallbackIndex: 5 },\n        status: { keywords: [''], fallbackIndex: 6 },\n      },\n      filters: {\n        active: { column: 'status', includes: ['', '', ''], excludeColumn: 'type', excludes: [''] },\n      },\n    },\n    bag: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        count: { keywords: ['', '', ''], fallbackIndex: 3 },\n      },\n    },\n    skill: {\n      // : , , , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        level: { keywords: ['', '', '', 'lv'], fallbackIndex: 3 },\n      },\n    },\n    equip: {\n      // : , , , , , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        part: { keywords: ['', '', ''], fallbackIndex: 3 },\n        isEquipped: { keywords: ['', '', '', ''], fallbackIndex: 4 },\n      },\n      filters: {\n        equipped: { column: 'isEquipped', includes: ['', '', 'true', '', 'yes', 'equipped'] },\n      },\n    },\n  };\n\n  // \n  const DashboardDataParser = {\n    // \n    findTable(allTables, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return null;\n      }\n\n      for (const keyword of config.tableKeywords) {\n        for (const tableName in allTables) {\n          if (tableName.includes(keyword)) {\n            console.info(`[DICE]: \"${moduleKey}\"\"${tableName}\" (: \"${keyword}\")`);\n            return {\n              data: allTables[tableName],\n              name: tableName,\n              key: allTables[tableName].key,\n              config: config,\n            };\n          }\n        }\n      }\n      console.info(\n        `[DICE]: \"${moduleKey}\" (: ${config.tableKeywords.join(', ')})`,\n      );\n      return null;\n    },\n\n    // \n    findColumnIndex(headers, columnKey, moduleConfig) {\n      const colConfig = moduleConfig.columns[columnKey];\n      if (!colConfig) return -1;\n\n      // \n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (colConfig.keywords.some(kw => h.includes(kw.toLowerCase()))) {\n          return i;\n        }\n      }\n\n      // \n      return colConfig.fallbackIndex ?? -1;\n    },\n\n    // \n    getValue(row, headers, columnKey, moduleConfig) {\n      const idx = this.findColumnIndex(headers, columnKey, moduleConfig);\n      if (idx < 0 || idx >= row.length) return null;\n      return row[idx];\n    },\n\n    // \n    getColumnMap(headers, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) return {};\n\n      const map = {};\n      for (const colKey in config.columns) {\n        map[colKey] = this.findColumnIndex(headers, colKey, config);\n      }\n      return map;\n    },\n\n    // \n    parseRows(tableResult, moduleKey) {\n      if (!tableResult || !tableResult.data) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return [];\n      }\n\n      const { data, config } = tableResult;\n      const headers = data.headers || [];\n      const rows = data.rows || [];\n      const colMap = this.getColumnMap(headers, moduleKey);\n\n      const parsed = rows.map((row, idx) => {\n        const obj = { _rowIndex: idx, _raw: row };\n        for (const colKey in colMap) {\n          const colIdx = colMap[colKey];\n          obj[colKey] = colIdx >= 0 && colIdx < row.length ? row[colIdx] : null;\n        }\n        return obj;\n      });\n\n      console.info(`[DICE]: \"${moduleKey}\"${parsed.length}`);\n      return parsed;\n    },\n\n    // \n    applyFilter(parsedRows, filterKey, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config || !config.filters || !config.filters[filterKey]) return parsedRows;\n\n      const filter = config.filters[filterKey];\n\n      // parsedRows\n      const hasFilterColumn = parsedRows.some(row => row[filter.column] !== null && row[filter.column] !== undefined);\n      if (!hasFilterColumn) {\n        // \n        return parsedRows;\n      }\n\n      return parsedRows.filter(row => {\n        const value = String(row[filter.column] || '').toLowerCase();\n        const matchInclude = filter.includes.some(inc => value.includes(inc.toLowerCase()));\n\n        if (filter.excludeColumn && filter.excludes) {\n          const excludeValue = String(row[filter.excludeColumn] || '').toLowerCase();\n          const matchExclude = filter.excludes.some(exc => excludeValue.includes(exc.toLowerCase()));\n          return matchInclude && !matchExclude;\n        }\n\n        return matchInclude;\n      });\n    },\n  };\n\n  const DEFAULT_GM_CONFIG = {\n    enabled: true,\n    diceSystem: '1d100',\n    showDiceIcon: true,\n    autoSendPrompt: true,\n    action_groups: [\n      {\n        table_keywords: ['', '', 'Location', 'Map', '', ''],\n        actions: [\n          { label: '', icon: 'fa-walking', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-search', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-clock', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', 'NPC', '', '', ''],\n        actions: [\n          { label: '', icon: 'fa-comments', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-hand-fist', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          { label: '', icon: 'fa-hand-pointer', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-trash', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-shield-halved',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-coins', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-wand-magic-sparkles',\n            type: 'skill_check',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-dumbbell', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-crosshairs',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          {\n            label: '',\n            icon: 'fa-list-check',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-ear-listen',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-user-plus', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          {\n            label: '',\n            icon: 'fa-handshake',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n        ],\n      },\n    ],\n  };\n  // [] \n  const THEME_COLORS = {\n    retro: {\n      bgPanel: '#e6e2d3',\n      border: '#dcd0c0',\n      textMain: '#5e4b35',\n      textSub: '#8a7a6a',\n      btnBg: '#dcd0c0',\n      btnHover: '#cbbba8',\n      accent: '#7a695f',\n      tableHead: '#efebe4',\n      successText: '#27ae60',\n      successBg: 'rgba(39, 174, 96, 0.15)',\n      inputBg: '#f5f2eb',\n      inputText: '#5e4b35',\n      placeholderText: '#a09080',\n      btnActiveBg: '#8d7b6f',\n      btnActiveText: '#fdfaf5',\n      // \n      failureText: '#e74c3c',\n      failureBg: 'rgba(231, 76, 60, 0.15)',\n      warningText: '#f39c12',\n      warningBg: 'rgba(243, 156, 18, 0.15)',\n      critSuccessText: '#9b59b6',\n      critSuccessBg: 'rgba(155, 89, 182, 0.15)',\n      critFailureText: '#c0392b',\n      critFailureBg: 'rgba(192, 57, 43, 0.15)',\n      extremeSuccessText: '#2980b9',\n      extremeSuccessBg: 'rgba(41, 128, 185, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#e74c3c',\n      errorBg: 'rgba(231, 76, 60, 0.15)',\n      errorBorder: 'rgba(231, 76, 60, 0.5)',\n      warningIcon: '#e67e22',\n      buttonTextOnAccent: '#fff',\n    },\n    dark: {\n      bgPanel: 'rgba(30, 30, 30, 0.98)',\n      border: '#444',\n      textMain: '#eee',\n      textSub: '#999',\n      btnBg: 'rgba(60, 60, 60, 0.9)',\n      btnHover: '#505050',\n      accent: '#9b8cd9',\n      tableHead: 'rgba(45, 45, 45, 0.95)',\n      successText: '#4cd964',\n      successBg: 'rgba(76, 217, 100, 0.2)',\n      inputBg: 'rgba(50, 50, 50, 0.95)',\n      inputText: '#eee',\n      placeholderText: '#777',\n      btnActiveBg: '#6a5acd',\n      btnActiveText: '#fff',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#ba68c8',\n      critSuccessBg: 'rgba(186, 104, 200, 0.2)',\n      critFailureText: '#d32f2f',\n      critFailureBg: 'rgba(211, 47, 47, 0.2)',\n      extremeSuccessText: '#42a5f5',\n      extremeSuccessBg: 'rgba(66, 165, 245, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.75)',\n      overlayBgLight: 'rgba(0,0,0,0.65)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255,255,255,0.05)',\n      veryLightBg: 'rgba(255,255,255,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(255,255,255,0.1)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#fff',\n    },\n    modern: {\n      bgPanel: '#f8f9fa',\n      border: '#e0e0e0',\n      textMain: '#333',\n      textSub: '#666',\n      btnBg: '#e9ecef',\n      btnHover: '#dee2e6',\n      accent: '#007bff',\n      tableHead: '#f1f3f5',\n      successText: '#28a745',\n      successBg: 'rgba(40, 167, 69, 0.15)',\n      inputBg: '#fff',\n      inputText: '#333',\n      placeholderText: '#999',\n      btnActiveBg: '#007bff',\n      btnActiveText: '#fff',\n      // \n      failureText: '#dc3545',\n      failureBg: 'rgba(220, 53, 69, 0.15)',\n      warningText: '#ffc107',\n      warningBg: 'rgba(255, 193, 7, 0.15)',\n      critSuccessText: '#6f42c1',\n      critSuccessBg: 'rgba(111, 66, 193, 0.15)',\n      critFailureText: '#c82333',\n      critFailureBg: 'rgba(200, 35, 51, 0.15)',\n      extremeSuccessText: '#17a2b8',\n      extremeSuccessBg: 'rgba(23, 162, 184, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#dc3545',\n      errorBg: 'rgba(220, 53, 69, 0.15)',\n      errorBorder: 'rgba(220, 53, 69, 0.5)',\n      warningIcon: '#fd7e14',\n      buttonTextOnAccent: '#fff',\n    },\n    forest: {\n      bgPanel: '#e8f5e9',\n      border: '#a5d6a7',\n      textMain: '#2e7d32',\n      textSub: '#66bb6a',\n      btnBg: '#c8e6c9',\n      btnHover: '#a5d6a7',\n      accent: '#43a047',\n      tableHead: '#dcedc8',\n      successText: '#2e7d32',\n      successBg: 'rgba(46, 125, 50, 0.2)',\n      inputBg: '#f1f8e9',\n      inputText: '#2e7d32',\n      placeholderText: '#81c784',\n      btnActiveBg: '#43a047',\n      btnActiveText: '#fff',\n      // \n      failureText: '#c62828',\n      failureBg: 'rgba(198, 40, 40, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#0277bd',\n      extremeSuccessBg: 'rgba(2, 119, 189, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#c62828',\n      errorBg: 'rgba(198, 40, 40, 0.15)',\n      errorBorder: 'rgba(198, 40, 40, 0.5)',\n      warningIcon: '#e67e22',\n      buttonTextOnAccent: '#fff',\n    },\n    ocean: {\n      bgPanel: '#e3f2fd',\n      border: '#90caf9',\n      textMain: '#1565c0',\n      textSub: '#42a5f5',\n      btnBg: '#bbdefb',\n      btnHover: '#90caf9',\n      accent: '#1976d2',\n      tableHead: '#bbdefb',\n      successText: '#0288d1',\n      successBg: 'rgba(2, 136, 209, 0.15)',\n      inputBg: '#e1f5fe',\n      inputText: '#1565c0',\n      placeholderText: '#64b5f6',\n      btnActiveBg: '#1976d2',\n      btnActiveText: '#fff',\n      // \n      failureText: '#d32f2f',\n      failureBg: 'rgba(211, 47, 47, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#0277bd',\n      extremeSuccessBg: 'rgba(2, 119, 189, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#d32f2f',\n      errorBg: 'rgba(211, 47, 47, 0.15)',\n      errorBorder: 'rgba(211, 47, 47, 0.5)',\n      warningIcon: '#f57c00',\n      buttonTextOnAccent: '#fff',\n    },\n    cyber: {\n      bgPanel: '#0a0a0a',\n      border: '#00ffcc33',\n      textMain: '#00ffcc',\n      textSub: '#00cc99',\n      btnBg: 'rgba(0, 255, 204, 0.1)',\n      btnHover: 'rgba(0, 255, 204, 0.2)',\n      accent: '#00ffcc',\n      tableHead: 'rgba(0, 255, 204, 0.05)',\n      successText: '#0f0',\n      successBg: 'rgba(0, 255, 0, 0.15)',\n      inputBg: 'rgba(0, 0, 0, 0.6)',\n      inputText: '#00ffcc',\n      placeholderText: '#006655',\n      btnActiveBg: '#ff00ff',\n      btnActiveText: '#fff',\n      // \n      failureText: '#ff0066',\n      failureBg: 'rgba(255, 0, 102, 0.2)',\n      warningText: '#ffaa00',\n      warningBg: 'rgba(255, 170, 0, 0.2)',\n      critSuccessText: '#ff00ff',\n      critSuccessBg: 'rgba(255, 0, 255, 0.2)',\n      critFailureText: '#ff0000',\n      critFailureBg: 'rgba(255, 0, 0, 0.2)',\n      extremeSuccessText: '#00ffff',\n      extremeSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,255,204,0.3)',\n      lightBg: 'rgba(0,255,204,0.05)',\n      veryLightBg: 'rgba(0,255,204,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(0,255,204,0.1)',\n      // \n      buttonBg: 'rgba(0, 200, 150, 0.6)',\n      buttonBgActive: 'rgba(0, 180, 130, 0.7)',\n      presetButtonBg: 'rgba(0, 200, 150, 0.3)',\n      presetButtonBgActive: 'rgba(0, 200, 150, 0.6)',\n      // /\n      errorText: '#ff0066',\n      errorBg: 'rgba(255, 0, 102, 0.2)',\n      errorBorder: 'rgba(255, 0, 102, 0.5)',\n      warningIcon: '#ffaa00',\n      buttonTextOnAccent: '#000',\n    },\n    nightowl: {\n      bgPanel: '#011627',\n      border: '#132e45',\n      textMain: '#e0e6f2',\n      textSub: '#a6b8cc',\n      btnBg: '#1f3a52',\n      btnHover: '#2a4a68',\n      accent: '#7fdbca',\n      tableHead: '#0a2133',\n      successText: '#addb67',\n      successBg: 'rgba(173, 219, 103, 0.15)',\n      inputBg: '#00101c',\n      inputText: '#e0e6f2',\n      placeholderText: '#6a8090',\n      btnActiveBg: '#7fdbca',\n      btnActiveText: '#011627',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#c792ea',\n      critSuccessBg: 'rgba(199, 146, 234, 0.2)',\n      critFailureText: '#ef5350',\n      critFailureBg: 'rgba(239, 83, 80, 0.2)',\n      extremeSuccessText: '#82aaff',\n      extremeSuccessBg: 'rgba(130, 170, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.75)',\n      overlayBgLight: 'rgba(0,0,0,0.65)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255,255,255,0.05)',\n      veryLightBg: 'rgba(255,255,255,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(255,255,255,0.1)',\n      // \n      buttonBg: 'rgba(127, 219, 202, 0.4)',\n      buttonBgActive: 'rgba(127, 219, 202, 0.5)',\n      presetButtonBg: 'rgba(127, 219, 202, 0.2)',\n      presetButtonBgActive: 'rgba(127, 219, 202, 0.4)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#000',\n    },\n    sakura: {\n      bgPanel: '#F9F0EF',\n      border: '#EBDCD9',\n      textMain: '#6B5552',\n      textSub: '#C08D8D',\n      btnBg: '#EBDCD9',\n      btnHover: '#D8C7C4',\n      accent: '#C08D8D',\n      tableHead: '#F9F0EF',\n      successText: '#6B5552',\n      successBg: 'rgba(192, 141, 141, 0.12)',\n      inputBg: '#F9F0EF',\n      inputText: '#6B5552',\n      placeholderText: '#C08D8D',\n      btnActiveBg: '#C08D8D',\n      btnActiveText: '#F9F0EF',\n      // \n      failureText: '#9B7A7A',\n      failureBg: 'rgba(155, 122, 122, 0.12)',\n      warningText: '#A68A7A',\n      warningBg: 'rgba(166, 138, 122, 0.12)',\n      critSuccessText: '#8B7A7A',\n      critSuccessBg: 'rgba(139, 122, 122, 0.12)',\n      critFailureText: '#8B6F6F',\n      critFailureBg: 'rgba(139, 111, 111, 0.12)',\n      extremeSuccessText: '#9B8A8A',\n      extremeSuccessBg: 'rgba(155, 138, 138, 0.12)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(107, 85, 82, 0.3)',\n      lightBg: 'rgba(192, 141, 141, 0.08)',\n      veryLightBg: 'rgba(192, 141, 141, 0.02)',\n      buttonText: '#F9F0EF',\n      grayBg: 'rgba(192, 141, 141, 0.08)',\n      // \n      buttonBg: 'rgba(192, 141, 141, 0.4)',\n      buttonBgActive: 'rgba(192, 141, 141, 0.5)',\n      presetButtonBg: 'rgba(192, 141, 141, 0.2)',\n      presetButtonBgActive: 'rgba(192, 141, 141, 0.4)',\n      // /\n      errorText: '#9B7A7A',\n      errorBg: 'rgba(155, 122, 122, 0.12)',\n      errorBorder: 'rgba(155, 122, 122, 0.4)',\n      warningIcon: '#A68A7A',\n      buttonTextOnAccent: '#fff',\n    },\n    minepink: {\n      bgPanel: '#1a1a1a',\n      border: '#333333',\n      textMain: '#ffb3d9',\n      textSub: '#ff80c1',\n      btnBg: '#2a2a2a',\n      btnHover: '#3a3a3a',\n      accent: '#ff80c1',\n      tableHead: '#252525',\n      successText: '#ff80c1',\n      successBg: 'rgba(255, 128, 193, 0.2)',\n      inputBg: '#222222',\n      inputText: '#ffb3d9',\n      placeholderText: '#666666',\n      btnActiveBg: '#ff80c1',\n      btnActiveText: '#1a1a1a',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#ff80c1',\n      critSuccessBg: 'rgba(255, 128, 193, 0.2)',\n      critFailureText: '#ff4444',\n      critFailureBg: 'rgba(255, 68, 68, 0.2)',\n      extremeSuccessText: '#ffb3d9',\n      extremeSuccessBg: 'rgba(255, 179, 217, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255, 128, 193, 0.1)',\n      veryLightBg: 'rgba(255, 128, 193, 0.02)',\n      buttonText: '#1a1a1a',\n      grayBg: 'rgba(255, 128, 193, 0.1)',\n      // \n      buttonBg: 'rgba(255, 128, 193, 0.7)',\n      buttonBgActive: 'rgba(255, 128, 193, 0.8)',\n      presetButtonBg: 'rgba(255, 128, 193, 0.2)',\n      presetButtonBgActive: 'rgba(255, 128, 193, 0.4)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#000',\n    },\n    purple: {\n      bgPanel: '#f3e5f5',\n      border: '#ce93d8',\n      textMain: '#6a1b9a',\n      textSub: '#9c27b0',\n      btnBg: '#e1bee7',\n      btnHover: '#ce93d8',\n      accent: '#9c27b0',\n      tableHead: '#f8e1f5',\n      successText: '#6a1b9a',\n      successBg: 'rgba(106, 27, 154, 0.15)',\n      inputBg: '#fce4ec',\n      inputText: '#6a1b9a',\n      placeholderText: '#ba68c8',\n      btnActiveBg: '#9c27b0',\n      btnActiveText: '#fff',\n      // \n      failureText: '#d32f2f',\n      failureBg: 'rgba(211, 47, 47, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#6a1b9a',\n      extremeSuccessBg: 'rgba(106, 27, 154, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(156, 39, 176, 0.1)',\n      veryLightBg: 'rgba(156, 39, 176, 0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(156, 39, 176, 0.1)',\n      // \n      buttonBg: 'rgba(156, 39, 176, 0.6)',\n      buttonBgActive: 'rgba(156, 39, 176, 0.7)',\n      presetButtonBg: 'rgba(156, 39, 176, 0.3)',\n      presetButtonBgActive: 'rgba(156, 39, 176, 0.6)',\n      // /\n      errorText: '#d32f2f',\n      errorBg: 'rgba(211, 47, 47, 0.15)',\n      errorBorder: 'rgba(211, 47, 47, 0.5)',\n      warningIcon: '#f57c00',\n      buttonTextOnAccent: '#fff',\n    },\n    wechat: {\n      bgPanel: '#F7F7F7',\n      border: '#E5E5E5',\n      textMain: '#333333',\n      textSub: '#666666',\n      btnBg: '#E5E5E5',\n      btnHover: '#D5D5D5',\n      accent: '#09B83E',\n      tableHead: '#F0F0F0',\n      successText: '#09B83E',\n      successBg: 'rgba(9, 184, 62, 0.12)',\n      inputBg: '#FFFFFF',\n      inputText: '#333333',\n      placeholderText: '#999999',\n      btnActiveBg: '#09B83E',\n      btnActiveText: '#FFFFFF',\n      // \n      failureText: '#E53E3E',\n      failureBg: 'rgba(229, 62, 62, 0.12)',\n      warningText: '#FF9500',\n      warningBg: 'rgba(255, 149, 0, 0.12)',\n      critSuccessText: '#07A832',\n      critSuccessBg: 'rgba(7, 168, 50, 0.15)',\n      critFailureText: '#C53030',\n      critFailureBg: 'rgba(197, 48, 48, 0.15)',\n      extremeSuccessText: '#09B83E',\n      extremeSuccessBg: 'rgba(9, 184, 62, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.2)',\n      lightBg: 'rgba(9, 184, 62, 0.08)',\n      veryLightBg: 'rgba(9, 184, 62, 0.02)',\n      buttonText: '#FFFFFF',\n      grayBg: 'rgba(9, 184, 62, 0.08)',\n      // \n      buttonBg: 'rgba(9, 184, 62, 0.7)',\n      buttonBgActive: 'rgba(9, 184, 62, 0.85)',\n      presetButtonBg: 'rgba(9, 184, 62, 0.3)',\n      presetButtonBgActive: 'rgba(9, 184, 62, 0.6)',\n      // /\n      errorText: '#E53E3E',\n      errorBg: 'rgba(229, 62, 62, 0.12)',\n      errorBorder: 'rgba(229, 62, 62, 0.5)',\n      warningIcon: '#FF9500',\n      buttonTextOnAccent: '#fff',\n    },\n    educational: {\n      bgPanel: '#000000',\n      border: '#1B1B1B',\n      textMain: '#FFFFFF',\n      textSub: '#CCCCCC',\n      btnBg: '#1B1B1B',\n      btnHover: '#2B2B2B',\n      accent: '#FF9900',\n      tableHead: '#1B1B1B',\n      successText: '#FF9900',\n      successBg: 'rgba(255, 153, 0, 0.15)',\n      inputBg: '#1B1B1B',\n      inputText: '#FFFFFF',\n      placeholderText: '#666666',\n      btnActiveBg: '#FF9900',\n      btnActiveText: '#000000',\n      // \n      failureText: '#FF6B6B',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#FFAA00',\n      warningBg: 'rgba(255, 170, 0, 0.2)',\n      critSuccessText: '#FF9900',\n      critSuccessBg: 'rgba(255, 153, 0, 0.2)',\n      critFailureText: '#FF4444',\n      critFailureBg: 'rgba(255, 68, 68, 0.2)',\n      extremeSuccessText: '#FFB84D',\n      extremeSuccessBg: 'rgba(255, 184, 77, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255, 153, 0, 0.1)',\n      veryLightBg: 'rgba(255, 153, 0, 0.02)',\n      buttonText: '#FFFFFF',\n      grayBg: 'rgba(255, 255, 255, 0.1)',\n      // \n      buttonBg: 'rgba(255, 153, 0, 0.7)',\n      buttonBgActive: 'rgba(255, 153, 0, 0.85)',\n      presetButtonBg: 'rgba(255, 153, 0, 0.3)',\n      presetButtonBgActive: 'rgba(255, 153, 0, 0.6)',\n      // /\n      errorText: '#FF6B6B',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#FFAA00',\n      buttonTextOnAccent: '#000000',\n    },\n    galgame: {\n      bgPanel: '#FFF0F5',\n      border: '#F0D4E4',\n      textMain: '#6B4A5A',\n      textSub: '#B08A9A',\n      btnBg: '#FFE4E9',\n      btnHover: '#FFD4E4',\n      accent: '#E8B4D9',\n      tableHead: '#FFF5F9',\n      successText: '#D4A5C8',\n      successBg: 'rgba(212, 165, 200, 0.15)',\n      inputBg: '#FFF8FA',\n      inputText: '#6B4A5A',\n      placeholderText: '#C8A5B0',\n      btnActiveBg: '#E8B4D9',\n      btnActiveText: '#6B4A5A',\n      // \n      failureText: '#C88A9A',\n      failureBg: 'rgba(200, 138, 154, 0.15)',\n      warningText: '#D4A5A5',\n      warningBg: 'rgba(212, 165, 165, 0.15)',\n      critSuccessText: '#E8B4D9',\n      critSuccessBg: 'rgba(232, 180, 217, 0.2)',\n      critFailureText: '#C88A9A',\n      critFailureBg: 'rgba(200, 138, 154, 0.2)',\n      extremeSuccessText: '#D4A5C8',\n      extremeSuccessBg: 'rgba(212, 165, 200, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(232, 180, 217, 0.25)',\n      lightBg: 'rgba(232, 180, 217, 0.08)',\n      veryLightBg: 'rgba(232, 180, 217, 0.02)',\n      buttonText: '#6B4A5A',\n      grayBg: 'rgba(232, 180, 217, 0.1)',\n      // \n      buttonBg: 'rgba(232, 180, 217, 0.6)',\n      buttonBgActive: 'rgba(232, 180, 217, 0.75)',\n      presetButtonBg: 'rgba(232, 180, 217, 0.3)',\n      presetButtonBgActive: 'rgba(232, 180, 217, 0.6)',\n      // /\n      errorText: '#C88A9A',\n      errorBg: 'rgba(200, 138, 154, 0.15)',\n      errorBorder: 'rgba(200, 138, 154, 0.4)',\n      warningIcon: '#D4A5A5',\n      buttonTextOnAccent: '#6B4A5A',\n    },\n    vaporwave: {\n      bgPanel: '#191970',\n      border: 'rgba(0, 255, 255, 0.3)',\n      textMain: '#00FFFF',\n      textSub: '#FF00FF',\n      btnBg: 'rgba(25, 25, 112, 0.8)',\n      btnHover: 'rgba(0, 255, 255, 0.2)',\n      accent: '#00FFFF',\n      tableHead: 'rgba(25, 25, 112, 0.9)',\n      successText: '#00FFFF',\n      successBg: 'rgba(0, 255, 255, 0.15)',\n      inputBg: 'rgba(25, 25, 112, 0.6)',\n      inputText: '#00FFFF',\n      placeholderText: '#FF00FF',\n      btnActiveBg: '#FF00FF',\n      btnActiveText: '#F0F8FF',\n      // \n      failureText: '#FF00FF',\n      failureBg: 'rgba(255, 0, 255, 0.2)',\n      warningText: '#FF00FF',\n      warningBg: 'rgba(255, 0, 255, 0.15)',\n      critSuccessText: '#00FFFF',\n      critSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      critFailureText: '#FF00FF',\n      critFailureBg: 'rgba(255, 0, 255, 0.25)',\n      extremeSuccessText: '#00FFFF',\n      extremeSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(25, 25, 112, 0.85)',\n      overlayBgLight: 'rgba(25, 25, 112, 0.75)',\n      shadowBg: 'rgba(0, 255, 255, 0.3)',\n      lightBg: 'rgba(0, 255, 255, 0.05)',\n      veryLightBg: 'rgba(0, 255, 255, 0.02)',\n      buttonText: '#F0F8FF',\n      grayBg: 'rgba(0, 255, 255, 0.1)',\n      // \n      buttonBg: 'rgba(0, 255, 255, 0.6)',\n      buttonBgActive: 'rgba(255, 0, 255, 0.7)',\n      presetButtonBg: 'rgba(0, 255, 255, 0.3)',\n      presetButtonBgActive: 'rgba(0, 255, 255, 0.6)',\n      // /\n      errorText: '#FF00FF',\n      errorBg: 'rgba(255, 0, 255, 0.2)',\n      errorBorder: 'rgba(255, 0, 255, 0.5)',\n      warningIcon: '#FF00FF',\n      buttonTextOnAccent: '#191970',\n    },\n    classicpackaging: {\n      bgPanel: '#000000',\n      border: '#FFFF00',\n      textMain: '#FFFF00',\n      textSub: '#CCCC00',\n      btnBg: '#FF0000',\n      btnHover: '#CC0000',\n      accent: '#FF0000',\n      tableHead: '#1a1a1a',\n      successText: '#0000FF',\n      successBg: 'rgba(0, 0, 255, 0.2)',\n      inputBg: '#1a1a1a',\n      inputText: '#FFFF00',\n      placeholderText: '#666600',\n      btnActiveBg: '#0000FF',\n      btnActiveText: '#FFFF00',\n      // \n      failureText: '#FF0000',\n      failureBg: 'rgba(255, 0, 0, 0.2)',\n      warningText: '#FF0000',\n      warningBg: 'rgba(255, 0, 0, 0.15)',\n      critSuccessText: '#0000FF',\n      critSuccessBg: 'rgba(0, 0, 255, 0.2)',\n      critFailureText: '#FF0000',\n      critFailureBg: 'rgba(255, 0, 0, 0.25)',\n      extremeSuccessText: '#0000FF',\n      extremeSuccessBg: 'rgba(0, 0, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0, 0, 0, 0.9)',\n      overlayBgLight: 'rgba(0, 0, 0, 0.8)',\n      shadowBg: 'rgba(0, 0, 0, 0.6)',\n      lightBg: 'rgba(255, 255, 0, 0.1)',\n      veryLightBg: 'rgba(255, 255, 0, 0.02)',\n      buttonText: '#FFFF00',\n      grayBg: 'rgba(255, 255, 0, 0.1)',\n      // \n      buttonBg: '#FF0000',\n      buttonBgActive: '#CC0000',\n      presetButtonBg: 'rgba(255, 0, 0, 0.7)',\n      presetButtonBgActive: '#FF0000',\n      // /\n      errorText: '#FF0000',\n      errorBg: 'rgba(255, 0, 0, 0.2)',\n      errorBorder: 'rgba(255, 0, 0, 0.8)',\n      warningIcon: '#FF0000',\n      buttonTextOnAccent: '#FFFF00',\n    },\n  };\n  const getThemeColors = () => {\n    const theme = THEME_COLORS[getConfig().theme] || THEME_COLORS['retro'];\n    // \n    if (!theme.buttonBg) {\n      theme.buttonBg = theme.accent;\n      theme.buttonBgActive = theme.accent;\n      theme.presetButtonBg = theme.btnBg;\n      theme.presetButtonBgActive = theme.accent;\n    }\n    // \n    if (!theme.buttonTextOnAccent) {\n      // \n      // \n      const isLightTheme =\n        theme.bgPanel &&\n        (theme.bgPanel.startsWith('#F') ||\n          theme.bgPanel.startsWith('#f') ||\n          theme.bgPanel.startsWith('#e') ||\n          theme.bgPanel.startsWith('#E') ||\n          theme.bgPanel.includes('255') ||\n          theme.bgPanel.includes('fff'));\n      theme.buttonTextOnAccent = isLightTheme ? theme.textMain || '#333' : '#fff';\n    }\n    return theme;\n  };\n  const getGMConfig = () => Store.get(STORAGE_KEY_GM_CONFIG, DEFAULT_GM_CONFIG);\n\n  // \n  const getResultBadgeStyle = (resultType, t) => {\n    // resultType: 'critSuccess' | 'extremeSuccess' | 'success' | 'warning' | 'failure' | 'critFailure'\n    const styles = {\n      critSuccess: {\n        bg: t.critSuccessText,\n        text: '#fff',\n      },\n      extremeSuccess: {\n        bg: t.extremeSuccessText,\n        text: '#fff',\n      },\n      success: {\n        bg: t.successText,\n        text: '#fff',\n      },\n      warning: {\n        bg: t.warningText,\n        text: '#fff',\n      },\n      failure: {\n        bg: t.failureText,\n        text: '#fff',\n      },\n      critFailure: {\n        bg: t.critFailureText,\n        text: '#fff',\n      },\n    };\n    const style = styles[resultType] || styles.failure;\n    return {\n      'background-color': style.bg,\n      color: style.text,\n      padding: '3px 8px',\n      'border-radius': '6px',\n      'font-size': '11px',\n      'font-weight': 'bold',\n      'white-space': 'nowrap',\n      display: 'inline-flex',\n      'align-items': 'center',\n    };\n  };\n\n  const getActionsForTable = tableName => {\n    const config = getGMConfig();\n    if (!config.enabled || !config.action_groups) return [];\n    const lowerName = tableName.toLowerCase();\n    for (const group of config.action_groups) {\n      const matched = group.table_keywords.some(keyword => lowerName.includes(keyword.toLowerCase()));\n      if (matched) return group.actions || [];\n    }\n    return [];\n  };\n  const isNumericCell = value => {\n    if (value === null || value === undefined || value === '') return false;\n    const str = String(value).trim();\n    // : (50/100)/: \n    return (\n      /^-?\\d+(\\.\\d+)?%?$/.test(str) ||\n      /^\\d+\\/\\d+$/.test(str) ||\n      /^[\\u4e00-\\u9fa5a-zA-Z]+[:\\s]\\s*\\d+/i.test(str) ||\n      /\\d+/.test(str)\n    );\n  };\n\n  const extractNumericValue = value => {\n    if (!value) return 0;\n    const str = String(value).trim();\n    //  (50/100 -> )\n    if (/^\\d+\\/\\d+$/.test(str)) return parseInt(str.split('/')[0], 10);\n    // \n    if (str.endsWith('%')) return parseInt(str.replace('%', ''), 10);\n    //  \":\" \n    const matches = str.match(/\\d+/g);\n    if (matches && matches.length > 0) {\n      return parseInt(matches[matches.length - 1], 10);\n    }\n    return 0;\n  };\n\n  const parseAttributeString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    //  JSON  {\"\":, ...}\n    if (rawStr.startsWith('{') && rawStr.endsWith('}')) {\n      try {\n        const jsonObj = JSON.parse(rawStr);\n        for (const key in jsonObj) {\n          const val = jsonObj[key];\n          if (typeof val === 'number') {\n            results.push({ name: key, value: val });\n          } else if (typeof val === 'string' && /^\\d+$/.test(val)) {\n            results.push({ name: key, value: parseInt(val, 10) });\n          }\n        }\n        if (results.length > 0) return results;\n      } catch (e) {\n        // JSON \n      }\n    }\n\n    //  \":; :\" \n    const parts = rawStr.split(/[,;\\s]+/);\n    for (const part of parts) {\n      const match = part.match(/^\"?([\\u4e00-\\u9fa5a-zA-Z_]+)\"?[:\\s]\\s*\"?(-?\\d+)\"?/);\n      if (match) {\n        results.push({ name: match[1], value: parseInt(match[2], 10) });\n      }\n    }\n    return results;\n  };\n  // [] :\n  // 1: \"();()\"\n  // 2: \":;:\"\n  // 3: \":,;:\"\n  const parseRelationshipString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    // \n    const parts = rawStr.split(/[;]/);\n    for (const part of parts) {\n      const trimmed = part.trim();\n      if (!trimmed) continue;\n\n      // 2/3: \":\"  \"\"\n      const colonMatch = trimmed.match(/^?(.+?)[:\\](.+)$/);\n      if (colonMatch) {\n        const name = colonMatch[1].trim();\n        const relation = colonMatch[2].trim();\n        if (name && relation) {\n          results.push({ name: name, relation: relation });\n          continue;\n        }\n      }\n\n      // 1: \"()\"  \"\"\n      const parenMatch = trimmed.match(/^([^(]+)[(]([^)]+)[)]$/);\n      if (parenMatch) {\n        results.push({ name: parenMatch[1].trim(), relation: parenMatch[2].trim() });\n        continue;\n      }\n\n      // \n      if (trimmed.length > 0) {\n        results.push({ name: trimmed, relation: '' });\n      }\n    }\n    return results;\n  };\n\n  // [] \n  const isRelationshipCell = (value, headerName) => {\n    if (!value) return false;\n    const str = String(value).trim();\n    const lowerHeader = (headerName || '').toLowerCase();\n    // \"\"\n    if (lowerHeader.includes('') || lowerHeader.includes('')) {\n      return true;\n    }\n    //  \"();()\" \n    return /^[^(;]+[(][^)]+[)]([;][^(;]+[(][^)]+[)])*$/.test(str);\n  };\n\n  const processTemplate = (template, cardData, headers) => {\n    if (!template || !cardData) return template;\n    let result = template;\n    const name = cardData[1] || '';\n    result = result.replace(/\\{Name\\}/gi, name);\n    result = result.replace(/\\{RowIndex\\}/gi, cardData[0] || '0');\n    if (headers && headers.length > 0) {\n      headers.forEach((header, idx) => {\n        if (header && idx < cardData.length) {\n          const value = cardData[idx] || '';\n          const regex = new RegExp(`\\\\{${header}\\\\}`, 'gi');\n          result = result.replace(regex, value);\n        }\n      });\n    }\n    result = result.replace(/\\{[^}]+\\}/g, '');\n    return result;\n  };\n\n  // \n  const ACTION_BUTTONS = [\n    { id: 'acu-btn-save-global', icon: 'fa-save', title: '' },\n    { id: 'acu-btn-refresh', icon: 'fa-sync-alt', title: '' },\n    { id: 'acu-btn-collapse', icon: 'fa-chevron-down', title: '' },\n    // {id: 'acu-btn-open-editor', icon: 'fa-table-columns', title: ''},\n    { id: 'acu-btn-refill', icon: 'fa-bolt', title: '' },\n    { id: 'acu-btn-settings', icon: 'fa-cog', title: '' },\n  ];\n\n  let isInitialized = false;\n  let isSaving = false;\n  let isEditingOrder = false;\n  let isSettingsOpen = false;\n  let currentDiffMap = new Set();\n  let observer = null;\n  let _boundRenderHandler = null;\n\n  // ---  ---\n  let cachedRawData = null;\n  let hasUnsavedChanges = false;\n  let tablePageStates = {};\n  let tableSearchStates = {};\n  let lastOptionHash = null;\n  let optionPanelVisible = false; // [] \n  // [] \n  const STORAGE_KEY_SCROLL = 'acu_scroll_v19_fixed';\n  let tableScrollStates = {};\n  try {\n    const saved = localStorage.getItem(STORAGE_KEY_SCROLL);\n    if (saved) tableScrollStates = JSON.parse(saved);\n  } catch (e) {\n    console.warn('[DICE]ACU Error:', e);\n  }\n  // [] \n  const UpdateController = {\n    _lastValidationCount: 0,\n    _isRollingBack: false, // \n\n    handleUpdate: () => {\n      // \n      if (UpdateController._isRollingBack) return;\n\n      // ===  intercept  ===\n      try {\n        const snapshot = loadSnapshot();\n        const newData = getTableData();\n        if (snapshot && newData) {\n          const rules = ValidationRuleManager.getEnabledRules();\n          const violations = ValidationEngine.checkTableRules(snapshot, newData, rules);\n\n          if (violations.length > 0) {\n            console.warn('[DICE]ACU :', violations);\n            UpdateController._isRollingBack = true;\n\n            //  API \n            const api = getCore().getDB();\n            if (api?.fillTable) {\n              try {\n                api.fillTable(snapshot);\n                if (window.toastr) {\n                  window.toastr.error(violations[0].message, '', {\n                    timeOut: 5000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              } catch (fillError) {\n                console.error('[DICE]ACU fillTable :', fillError);\n                // \n                if (window.toastr) {\n                  window.toastr.error(`: ${violations[0].message}`, '', {\n                    timeOut: 7000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              }\n            }\n\n            setTimeout(() => {\n              UpdateController._isRollingBack = false;\n            }, 500);\n            return;\n          }\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n      }\n\n      //  renderInterface \n      // \n      renderInterface();\n\n      // \n      setTimeout(() => {\n        try {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            const errors = ValidationEngine.validateAllData(rawData);\n            const newCount = errors.length;\n\n            // \n            if (newCount > UpdateController._lastValidationCount && newCount > 0) {\n              // \n            }\n\n            UpdateController._lastValidationCount = newCount;\n\n            // \n            updateValidationIndicator(newCount);\n          }\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n        }\n      }, 100);\n    },\n  };\n\n  // \n  const updateValidationIndicator = count => {\n    const { $ } = getCore();\n    const $indicator = $('.acu-validation-indicator');\n\n    if (count > 0) {\n      if ($indicator.length) {\n        $indicator.find('.acu-validation-count').text(count);\n        $indicator.show();\n      }\n    } else {\n      $indicator.hide();\n    }\n  };\n\n  // --- []  ---\n  const getCurrentContextFingerprint = () => {\n    try {\n      // 1:  API\n      if (typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId) {\n        return SillyTavern.getCurrentChatId();\n      }\n      // 2: \n      if (typeof SillyTavern !== 'undefined' && SillyTavern.chatId) {\n        return SillyTavern.chatId;\n      }\n      // 3:  (iframe )\n      if (window.parent?.SillyTavern?.getCurrentChatId) {\n        return window.parent.SillyTavern.getCurrentChatId();\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getCurrentContextFingerprint error:', e);\n    }\n    return 'unknown_context';\n  };\n\n  //  ()\n\n  const DEFAULT_CONFIG = {\n    layout: 'horizontal',\n    collapseStyle: 'bar',\n    collapseAlign: 'right',\n    fontFamily: 'default',\n    theme: 'retro',\n    cardWidth: 260,\n    fontSize: 13,\n    highlightNew: true,\n    itemsPerPage: 50,\n    actionsPosition: 'bottom',\n    gridColumns: 'auto', // [] \n    positionMode: 'fixed', // fixed=, embedded=\n    showOptionPanel: true, // [] \n    clickOptionToAutoSend: true, // [] \n    optionFontSize: 12, // [] \n  };\n\n  const FONTS = [\n    { id: 'default', name: ' (Modern)', val: `'Segoe UI', 'Microsoft YaHei', sans-serif` },\n    { id: 'hanchan', name: '', val: `\"\", sans-serif` },\n    { id: 'maple', name: 'Maple Mono ()', val: `\"Maple Mono NF CN\", monospace` },\n    { id: 'huiwen', name: ' (Huiwen)', val: `\"Huiwen-mincho\", serif` },\n    { id: 'cooper', name: 'Cooper', val: `\"CooperZhengKai\", serif` },\n    { id: 'yffyt', name: 'YFFYT ()', val: `\"YFFYT\", sans-serif` },\n    { id: 'fusion', name: 'Fusion Pixel ()', val: `\"Fusion Pixel 12px M latin\", monospace` },\n    { id: 'wenkai', name: ' (WenKai)', val: `\"LXGW WenKai\", serif` },\n    { id: 'notosans', name: ' (Noto Sans)', val: `\"Noto Sans CJK\", sans-serif` },\n    { id: 'zhuque', name: ' (Zhuque)', val: `\"Zhuque Fangsong (technical preview)\", serif` },\n  ];\n\n  const THEMES = [\n    { id: 'retro', name: ' (Retro)', icon: 'fa-scroll' },\n    { id: 'dark', name: ' (Dark)', icon: 'fa-moon' },\n    { id: 'modern', name: ' (Modern)', icon: 'fa-sun' },\n    { id: 'forest', name: ' (Forest)', icon: 'fa-tree' },\n    { id: 'ocean', name: ' (Ocean)', icon: 'fa-water' },\n    { id: 'cyber', name: ' (Cyber)', icon: 'fa-bolt' },\n    { id: 'nightowl', name: ' (Night Owl)', icon: 'fa-feather' },\n    { id: 'sakura', name: ' (Warm Pink)', icon: 'fa-heart' },\n    { id: 'minepink', name: ' (Mine Pink)', icon: 'fa-skull' },\n    { id: 'galgame', name: ' (Galgame Pink)', icon: 'fa-heart' },\n    { id: 'purple', name: ' (Purple)', icon: 'fa-gem' },\n    { id: 'wechat', name: ' (Green Bubble)', icon: 'fa-weixin' },\n    { id: 'educational', name: ' (Educational)', icon: 'fa-book' },\n    { id: 'vaporwave', name: ' (Vaporwave)', icon: 'fa-palette' },\n    { id: 'classicpackaging', name: ' (Classic Packaging)', icon: 'fa-box' },\n  ];\n\n  // []  core  ( +  ST )\n  let _coreCache = null;\n  const getCore = () => {\n    const w = window.parent || window;\n    //  jQuery\n    const $ = window.jQuery || w.jQuery;\n\n    // ($)\n    if (_coreCache && _coreCache.$) return _coreCache;\n\n    const core = {\n      $: $,\n      getDB: () => w.AutoCardUpdaterAPI || window.AutoCardUpdaterAPI,\n      clipboard: w.navigator.clipboard,\n      //   ->  ->  ()\n      ST:\n        window.SillyTavern ||\n        w.SillyTavern ||\n        (() => {\n          try {\n            return window.top ? window.top.SillyTavern : null;\n          } catch (e) {\n            return null;\n          }\n        })(),\n    };\n\n    //  jQuery \n    if ($) _coreCache = core;\n    return core;\n  };\n\n  const updateSaveButtonState = () => {\n    const { $ } = getCore();\n    const $btn = $('#acu-btn-save-global');\n    const $icon = $btn.find('i');\n    const deletions = getPendingDeletions();\n    let hasDeletions = false;\n    if (deletions) {\n      for (const key in deletions) {\n        if (deletions[key] && deletions[key].length > 0) {\n          hasDeletions = true;\n          break;\n        }\n      }\n    }\n    if (hasUnsavedChanges || hasDeletions) {\n      $icon.addClass('acu-icon-breathe');\n      $btn.attr('title', '');\n    } else {\n      $icon.removeClass('acu-icon-breathe');\n      $btn.attr('title', '');\n      $btn.css('color', '');\n    }\n  };\n\n  const getIconForTableName = name => {\n    if (!name) return 'fa-table';\n    const n = name.toLowerCase();\n    if (n.includes('') || n.includes('')) return 'fa-user-circle';\n    if (n.includes('') || n.includes('')) return 'fa-globe-asia';\n    if (n.includes('') || n.includes('')) return 'fa-briefcase';\n    if (n.includes('') || n.includes('')) return 'fa-dragon';\n    if (n.includes('') || n.includes('')) return 'fa-user-friends';\n    if (n.includes('') || n.includes('')) return 'fa-scroll';\n    if (n.includes('') || n.includes('')) return 'fa-address-book';\n    if (n.includes('') || n.includes('')) return 'fa-book-reader';\n    if (n.includes('') || n.includes('')) return 'fa-map-location-dot';\n    if (n.includes('') || n.includes('') || n.includes('')) return 'fa-bullseye';\n    if (n.includes('') || n.includes('')) return 'fa-shield-halved';\n    if (n.includes('')) return 'fa-gem';\n    if (n.includes('') || n.includes('')) return 'fa-file-lines';\n    if (n.includes('')) return 'fa-list-check';\n    return 'fa-table';\n  };\n\n  const getBadgeStyle = text => {\n    if (!text) return '';\n    const str = String(text).trim();\n    if (/^[0-9]+%?$/.test(str) || /^Lv\\.\\d+$/.test(str)) return 'acu-badge-green';\n    if (str.length <= 6 && !str.includes('http')) return 'acu-badge-neutral';\n    if (['', '', '', '', '', ''].includes(str)) return 'acu-badge-neutral';\n    return '';\n  };\n\n  // []  ()\n  const Store = {\n    get: (key, def = null) => {\n      try {\n        return JSON.parse(localStorage.getItem(key)) ?? def;\n      } catch {\n        return def;\n      }\n    },\n    set: (key, val) => {\n      try {\n        localStorage.setItem(key, JSON.stringify(val));\n      } catch (e) {\n        // \n        if (e.name === 'QuotaExceededError' || e.message.includes('quota')) {\n          console.warn('[DICE]ACU ...');\n          try {\n            // 1.  ()\n            localStorage.removeItem(STORAGE_KEY_LAST_SNAPSHOT);\n\n            // 2. \n            localStorage.setItem(key, JSON.stringify(val));\n          } catch (retryErr) {\n            // \n            console.error('[DICE]ACU Store ', retryErr);\n            if (window.toastr && !window._acuQuotaAlerted) {\n              window.toastr.warning(' ');\n              window._acuQuotaAlerted = true;\n              setTimeout(() => (window._acuQuotaAlerted = false), 10000);\n            }\n          }\n        } else {\n          console.error('[DICE]ACU Store', e);\n        }\n      }\n    },\n  };\n\n  const getActiveTabState = () => Store.get(STORAGE_KEY_ACTIVE_TAB);\n  const saveActiveTabState = v => Store.set(STORAGE_KEY_ACTIVE_TAB, v);\n  const getPendingDeletions = () => Store.get(STORAGE_KEY_PENDING_DELETIONS, {});\n  const savePendingDeletions = v => Store.set(STORAGE_KEY_PENDING_DELETIONS, v);\n  const getSavedTableOrder = () => Store.get(STORAGE_KEY_TABLE_ORDER);\n  const saveTableOrder = v => Store.set(STORAGE_KEY_TABLE_ORDER, v);\n  const getCollapsedState = () => Store.get(STORAGE_KEY_IS_COLLAPSED, false);\n  const saveCollapsedState = v => Store.set(STORAGE_KEY_IS_COLLAPSED, v);\n  // []  (Chat ID)\n  const loadSnapshot = () => {\n    const data = Store.get(STORAGE_KEY_LAST_SNAPSHOT);\n    if (!data) return null;\n    // \n    const currentCtx = getCurrentContextFingerprint();\n    // \n    if (data._contextId && data._contextId !== currentCtx) {\n      return null;\n    }\n    return data;\n  };\n\n  // [] \n  const saveSnapshot = v => {\n    if (!v) return;\n    //  ChatID\n    if (typeof v === 'object') {\n      v._contextId = getCurrentContextFingerprint();\n    }\n    Store.set(STORAGE_KEY_LAST_SNAPSHOT, v);\n  };\n\n  // --- []  ---\n  const getTableHeights = () => Store.get(STORAGE_KEY_TABLE_HEIGHTS, {});\n  const saveTableHeights = v => Store.set(STORAGE_KEY_TABLE_HEIGHTS, v);\n  const getTableStyles = () => Store.get(STORAGE_KEY_TABLE_STYLES, {});\n  const saveTableStyles = v => Store.set(STORAGE_KEY_TABLE_STYLES, v);\n  const getHiddenTables = () => Store.get(STORAGE_KEY_HIDDEN_TABLES, []);\n  const saveHiddenTables = v => Store.set(STORAGE_KEY_HIDDEN_TABLES, v);\n  const getReverseTables = () => Store.get(STORAGE_KEY_REVERSE_TABLES, []);\n  const saveReverseTables = v => Store.set(STORAGE_KEY_REVERSE_TABLES, v);\n\n  // \n  const shouldShowReverseButton = tableName => {\n    if (!tableName) return false;\n    const keywords = ['', '', '', '', ''];\n    return keywords.some(kw => tableName.includes(kw));\n  };\n\n  // \n  const isTableReversed = tableName => {\n    return getReverseTables().includes(tableName);\n  };\n\n  // \n  const toggleTableReverse = tableName => {\n    const list = getReverseTables();\n    const idx = list.indexOf(tableName);\n    if (idx >= 0) {\n      list.splice(idx, 1);\n    } else {\n      list.push(tableName);\n    }\n    saveReverseTables(list);\n    console.log('[DICE]ACU toggleTableReverse:', tableName, 'reversed:', idx < 0);\n  };\n  // [] \n  const getAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          let attrs = [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.includes(attr.name)) attrs.push(attr.name);\n              });\n            }\n          });\n          if (attrs.length > 0) return attrs;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            let attrs = [];\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.includes(attr.name)) attrs.push(attr.name);\n                });\n              }\n            });\n            return attrs;\n          }\n        }\n      }\n    }\n\n    return [];\n  };\n  // [] \n  const getAttributeValue = (characterName, attrName) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData || !attrName) return null;\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          for (let idx = 0; idx < headers.length; idx++) {\n            const h = headers[idx];\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              const found = parsed.find(attr => attr.name === attrName);\n              if (found) return found.value;\n            }\n          }\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            for (let idx = 0; idx < headers.length; idx++) {\n              const h = headers[idx];\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                const found = parsed.find(attr => attr.name === attrName);\n                if (found) return found.value;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n  // [] 6\n  const STANDARD_ATTRS = ['', '', '', '', '', ''];\n\n  /**\n   * \n   */\n  const getStandardAttrs = () => {\n    const preset = AttributePresetManager.getActivePreset();\n    if (preset && preset.baseAttributes) {\n      return preset.baseAttributes.map(attr => attr.name);\n    }\n    return STANDARD_ATTRS;\n  };\n\n  /**\n   * \n   * \n   *  + \n   */\n  const getRandomSkillPool = () => {\n    try {\n      const preset = AttributePresetManager.getActivePreset();\n      if (preset) {\n        //  + \n        const allAttrs = new Set();\n\n        // \n        if (preset.baseAttributes && Array.isArray(preset.baseAttributes)) {\n          preset.baseAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        // \n        if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n          preset.specialAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        return Array.from(allAttrs);\n      }\n\n      // \n      const allPresets = AttributePresetManager.getAllPresets() || [];\n      const allAttrs = new Set(RANDOM_SKILL_POOL || []); // \n\n      // \n      if (Array.isArray(allPresets)) {\n        allPresets.forEach(p => {\n          if (!p) return;\n\n          // \n          if (p.baseAttributes && Array.isArray(p.baseAttributes)) {\n            p.baseAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n\n          // \n          if (p.specialAttributes && Array.isArray(p.specialAttributes)) {\n            p.specialAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n        });\n      }\n\n      return Array.from(allAttrs);\n    } catch (err) {\n      console.error('[DICE]ACU getRandomSkillPool :', err);\n      return RANDOM_SKILL_POOL || [];\n    }\n  };\n\n  // [] \n  const RANDOM_SKILL_POOL = [\n    // ---  (Physical & Movement) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Social & Psychological) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    // /\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Technical & Crafting) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Knowledge & Investigation) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Combat & Special) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  // []  COC/DND 6\n  /**\n   * \n   * @param isDNDOrPreset ()    null()\n   * @returns { base: {...}, special: {...} }  {...}\n   */\n  const generateRPGAttributes = (isDNDOrPreset = undefined) => {\n    // \n    if (typeof isDNDOrPreset === 'boolean') {\n      const isDND = isDNDOrPreset;\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n\n      const generateValue = () => {\n        if (isDND) {\n          const base = generate3d6();\n          const adjust = rollDice(4) - 2;\n          return Math.max(3, Math.min(18, base + adjust));\n        } else {\n          const base = generate3d6() * 5;\n          const adjust = rollDice(10) - 5;\n          return Math.max(5, Math.min(95, base + adjust));\n        }\n      };\n\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        result[attr] = generateValue();\n      });\n      return result; // \n    }\n\n    // \n    const preset = isDNDOrPreset || AttributePresetManager.getActivePreset();\n\n    // \n    if (!preset) {\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        const base = generate3d6() * 5;\n        const adjust = rollDice(10) - 5;\n        result[attr] = Math.max(5, Math.min(95, base + adjust));\n      });\n      return { base: result, special: {} };\n    }\n\n    // \n    const baseResult = {};\n    preset.baseAttributes.forEach(attr => {\n      const formula = attr.modifier ? `${attr.formula}+${attr.modifier}` : attr.formula;\n      baseResult[attr.name] = generateAttributeValue(formula, attr.range, {});\n    });\n\n    // \n    const specialResult = {};\n    if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n      preset.specialAttributes.forEach(attr => {\n        specialResult[attr.name] = generateAttributeValue(attr.formula, attr.range, baseResult);\n      });\n    }\n\n    return { base: baseResult, special: specialResult };\n  };\n\n  // [] \n  const clearPresetAttributesForCharacter = async charName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // NPC//\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    const customAttrs = existingAttrs.filter(attr => !presetAttrNames.has(attr.name));\n    const newAttrString = customAttrs.map(attr => `${attr.name}:${attr.value}`).join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData);\n\n    return {\n      success: true,\n      attrString: newAttrString,\n    };\n  };\n\n  // [] \n  const writeAttributesToCharacter = async (charName, newAttrs, isDND = false) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \"\"\n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // \n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('\"\"');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const existingMap = {};\n    existingAttrs.forEach(attr => {\n      existingMap[attr.name] = attr.value;\n    });\n\n    // +\n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    let standardCount = 0;\n    standardAttrs.forEach(attrName => {\n      if (existingMap[attrName] !== undefined) {\n        standardCount++;\n      }\n    });\n    const isComplete = standardCount === standardAttrs.length;\n\n    // \n    const customAttrs = [];\n    existingAttrs.forEach(attr => {\n      if (!presetAttrNames.has(attr.name)) {\n        customAttrs.push({ name: attr.name, value: attr.value });\n      }\n    });\n\n    // \n    const resultParts = [];\n\n    // 1. \n    standardAttrs.forEach(attrName => {\n      if (isComplete) {\n        //   \n        const newValue = newAttrs[attrName] !== undefined ? newAttrs[attrName] : existingMap[attrName];\n        if (newValue !== undefined) {\n          resultParts.push(`${attrName}:${newValue}`);\n        }\n      } else {\n        //   \n        if (existingMap[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        } else if (newAttrs[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        }\n      }\n    });\n\n    // 2. \n    Object.keys(newAttrs).forEach(attrName => {\n      if (!standardAttrs.includes(attrName)) {\n        // \n        if (isComplete || !existingMap[attrName]) {\n          // \n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        } else {\n          // \n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        }\n      }\n    });\n\n    // 3. \n    customAttrs.forEach(attr => {\n      resultParts.push(`${attr.name}:${attr.value}`);\n    });\n\n    const newAttrString = resultParts.join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData);\n\n    // UI\n    const writtenAttrs = [];\n    standardAttrs.forEach(attrName => {\n      writtenAttrs.push({ name: attrName, value: newAttrs[attrName] });\n    });\n\n    return {\n      success: true,\n      attrs: writtenAttrs,\n      attrString: newAttrString,\n      wasComplete: isComplete,\n    };\n  };\n  // [] \"\"\n  const getFullAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n    let attrs = [];\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.some(a => a.name === attr.name)) {\n                  attrs.push(attr);\n                }\n              });\n            }\n          });\n          if (attrs.length > 0) break;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.some(a => a.name === attr.name)) {\n                    attrs.push(attr);\n                  }\n                });\n              }\n            });\n            break;\n          }\n        }\n        if (attrs.length > 0) break;\n      }\n    }\n\n    return attrs;\n  };\n  // [] \n  const initCustomDropdown = ($input, options, themeColors) => {\n    const { $ } = getCore();\n    const t = themeColors || {};\n    const inputId = $input.attr('id') || 'dd_' + Math.random().toString(36).substr(2, 9);\n    $input.attr('id', inputId);\n\n    // \n    $input.parent().find('.acu-dropdown-list').remove();\n\n    //  wrapper\n    if (!$input.parent().hasClass('acu-dropdown-wrapper')) {\n      $input.wrap('<div class=\"acu-dropdown-wrapper\"></div>');\n    }\n\n    // \n    const $dropdown = $(`<div class=\"acu-dropdown-list\" data-for=\"${inputId}\"></div>`);\n    $dropdown.css({\n      background: t.bgPanel || '#fff',\n      'border-color': t.border || '#ccc',\n    });\n    $input.after($dropdown);\n\n    const renderItems = (filter = '') => {\n      const lowerFilter = filter.toLowerCase();\n      const filtered = options.filter(opt => opt.toLowerCase().includes(lowerFilter));\n\n      if (filtered.length === 0) {\n        $dropdown.html(`<div class=\"acu-dropdown-empty\" style=\"color:${t.textSub || '#999'};\"></div>`);\n      } else {\n        $dropdown.html(\n          filtered\n            .map(\n              opt =>\n                `<div class=\"acu-dropdown-item\" data-value=\"${escapeHtml(opt)}\" style=\"color:${t.textMain || '#333'};\">${escapeHtml(opt)}</div>`,\n            )\n            .join(''),\n        );\n      }\n    };\n\n    const showDropdown = () => {\n      $('.acu-dropdown-list').removeClass('visible');\n      renderItems($input.val());\n      $dropdown.addClass('visible');\n    };\n\n    const hideDropdown = () => {\n      $dropdown.removeClass('visible');\n    };\n\n    // \n    $input.off('.acudd').on('focus.acudd click.acudd', function (e) {\n      e.stopPropagation();\n      showDropdown();\n    });\n\n    // \n    $input.on('input.acudd', function () {\n      renderItems($(this).val());\n    });\n\n    // hover \n    $dropdown\n      .on('mouseenter', '.acu-dropdown-item', function () {\n        $(this).css('background', t.tableHead || 'rgba(128,128,128,0.15)');\n      })\n      .on('mouseleave', '.acu-dropdown-item', function () {\n        $(this).css('background', 'transparent');\n      });\n\n    // \n    $dropdown.on('click', '.acu-dropdown-item', function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      const val = $(this).data('value');\n      $input.val(val).trigger('change');\n      hideDropdown();\n    });\n\n    // \n    $dropdown.on('click', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $input\n      .closest('.acu-dice-panel, .acu-contest-panel')\n      .off('click.acudd_' + inputId)\n      .on('click.acudd_' + inputId, function (e) {\n        if (!$(e.target).closest('.acu-dropdown-wrapper').length) {\n          hideDropdown();\n        }\n      });\n  };\n  // [] \n  const addClearButton = ($panel, inputSelector, themeColors) => {\n    const { $ } = getCore();\n    const t = themeColors || {};\n    $panel.find(inputSelector).each(function () {\n      const $input = $(this);\n      // \n      if ($input.parent().hasClass('acu-input-wrapper')) return;\n      // \n      $input.wrap('<div class=\"acu-input-wrapper\"></div>');\n      //  - \n      const $clearBtn = $(\n        `<button type=\"button\" class=\"acu-clear-btn\" title=\"\" style=\"color:${t.textSub || '#999'};\"><i class=\"fa-solid fa-times\"></i></button>`,\n      );\n      $input.after($clearBtn);\n      // \n      $clearBtn.on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        $input.val('').trigger('input').trigger('change').focus();\n      });\n      //  - \n      $clearBtn\n        .on('mouseenter', function () {\n          $(this).css({ color: t.accent || '#7a695f', opacity: '1' });\n        })\n        .on('mouseleave', function () {\n          $(this).css({ color: t.textSub || '#999', opacity: '0.5' });\n        });\n    });\n  };\n  // [] \n  const showDiceSettingsPanel = (isDND = false) => {\n    const { $ } = getCore();\n    $('.acu-dice-config-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    const ruleTitle = isDND ? 'DND ' : 'COC ';\n    const resetText = isDND ? ' DND ' : ' COC ';\n\n    // \n    const defaults = isDND\n      ? { critSuccess: 20, critFail: 1 }\n      : { critSuccess: 5, critFail: 96, hardDiv: 2, extremeDiv: 5 };\n\n    //  placeholder\n    const currentCritSuccess = isDND\n      ? diceCfg.dndCritSuccess !== undefined && diceCfg.dndCritSuccess !== defaults.critSuccess\n        ? diceCfg.dndCritSuccess\n        : ''\n      : diceCfg.critSuccessMax !== undefined && diceCfg.critSuccessMax !== defaults.critSuccess\n        ? diceCfg.critSuccessMax\n        : '';\n    const currentCritFail = isDND\n      ? diceCfg.dndCritFail !== undefined && diceCfg.dndCritFail !== defaults.critFail\n        ? diceCfg.dndCritFail\n        : ''\n      : diceCfg.critFailMin !== undefined && diceCfg.critFailMin !== defaults.critFail\n        ? diceCfg.critFailMin\n        : '';\n    const currentHardDiv =\n      !isDND && diceCfg.difficultSuccessDiv !== undefined && diceCfg.difficultSuccessDiv !== defaults.hardDiv\n        ? diceCfg.difficultSuccessDiv\n        : '';\n    const currentExtremeDiv =\n      !isDND && diceCfg.hardSuccessDiv !== undefined && diceCfg.hardSuccessDiv !== defaults.extremeDiv\n        ? diceCfg.hardSuccessDiv\n        : '';\n\n    const tieRule = diceCfg.contestTieRule || 'initiator_lose';\n    const hideDiceResultFromUser =\n      diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n\n    const cocExtraHtml = isDND\n      ? ''\n      : `\n            <div class=\"acu-dice-cfg-row\">\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-hard-div\" data-min=\"2\" data-max=\"5\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentHardDiv || defaults.hardDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-extreme-div\" data-min=\"3\" data-max=\"10\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentExtremeDiv || defaults.extremeDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const panelHtml = `\n            <div class=\"acu-dice-config-overlay\">\n                <div class=\"acu-dice-config-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-dice-cfg-header\">\n                        <span><i class=\"fa-solid fa-cog\"></i> ${ruleTitle}</span>\n                        <button class=\"acu-config-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-dice-cfg-body\">\n                        <div class=\"acu-dice-cfg-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-success\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritSuccess || defaults.critSuccess}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-fail\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritFail || defaults.critFail}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                        ${cocExtraHtml}\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <select id=\"cfg-tie-rule\">\n                                    <option value=\"initiator_lose\" ${tieRule === 'initiator_lose' ? 'selected' : ''}> ()</option>\n                                    <option value=\"tie\" ${tieRule === 'tie' ? 'selected' : ''}></option>\n                                    <option value=\"initiator_win\" ${tieRule === 'initiator_win' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label>user</label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result\" ${hideDiceResultFromUser ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-actions\">\n                            <button id=\"cfg-reset-dice\">${resetText}</button>\n                            <button id=\"cfg-save-dice\" class=\"primary\"></button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $panel = $(panelHtml);\n    $('body').append($panel);\n\n    $panel.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '2147483655',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    const closePanel = () => $panel.remove();\n    $panel.find('.acu-config-close').click(closePanel);\n    $panel.on('click', e => {\n      if ($(e.target).hasClass('acu-dice-config-overlay')) closePanel();\n    });\n\n    // === Stepper  ===\n    $panel.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        $value.text(newVal);\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    $panel.find('#cfg-save-dice').click(function () {\n      const newCfg = { contestTieRule: $('#cfg-tie-rule').val() };\n\n      // stepper\n      const getStepperValue = id => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          const text = $stepper.find('.acu-stepper-value').text().replace(/[^\\d]/g, '');\n          return text !== '' ? parseInt(text, 10) : null;\n        }\n        return null;\n      };\n\n      const critSuccessVal = getStepperValue('cfg-crit-success');\n      const critFailVal = getStepperValue('cfg-crit-fail');\n\n      if (isDND) {\n        newCfg.dndCritSuccess = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.dndCritFail = critFailVal !== null ? critFailVal : defaults.critFail;\n      } else {\n        newCfg.critSuccessMax = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.critFailMin = critFailVal !== null ? critFailVal : defaults.critFail;\n\n        const hardDivVal = getStepperValue('cfg-hard-div');\n        const extremeDivVal = getStepperValue('cfg-extreme-div');\n        newCfg.difficultSuccessDiv = hardDivVal !== null ? hardDivVal : defaults.hardDiv;\n        newCfg.hardSuccessDiv = extremeDivVal !== null ? extremeDivVal : defaults.extremeDiv;\n      }\n\n      // \"user\"\n      newCfg.hideDiceResultFromUser = $('#cfg-hide-dice-result').is(':checked');\n\n      saveDiceConfig(newCfg);\n      // \n      console.info('[DICE]/...');\n      hideDiceResultsInUserMessages();\n      closePanel();\n    });\n\n    $panel.find('#cfg-reset-dice').click(function () {\n      // stepper\n      const resetStepper = (id, defaultValue) => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          $stepper.find('.acu-stepper-value').text(defaultValue);\n        }\n      };\n\n      resetStepper('cfg-crit-success', defaults.critSuccess);\n      resetStepper('cfg-crit-fail', defaults.critFail);\n      if (!isDND) {\n        resetStepper('cfg-hard-div', defaults.hardDiv);\n        resetStepper('cfg-extreme-div', defaults.extremeDiv);\n      }\n    });\n  };\n  // [] \n  const showDicePanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n    // 1d100\n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    // 1d100\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n    // [] \n    const rawDataForList = cachedRawData || getTableData();\n    let diceCharacterList = ['<user>'];\n    let diceAttrList = [];\n\n    if (rawDataForList) {\n      for (const key in rawDataForList) {\n        const sheet = rawDataForList[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '') {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) diceCharacterList.push(row[1]);\n          }\n        }\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const row = sheet.content[1];\n          const headers = sheet.content[0] || [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!diceAttrList.includes(attr.name)) diceAttrList.push(attr.name);\n              });\n            }\n          });\n        }\n      }\n    }\n    const {\n      targetValue = null, // []  null\n      targetName = '',\n      diceType = savedDiceType, // \n      successCriteria = 'lte', // [] COC\n      onResult = null,\n      initiatorName = '', // [] \n      fromMvu = false, // [] MVU\n      mvuPath = null, // [] MVU\n      mvuParsedInfo = null, // [] \n    } = options;\n\n    const t = getThemeColors();\n    const isCyberTheme = getConfig().theme === 'cyber';\n    const inputTextColor = isCyberTheme ? '#ff00ff' : t.inputText;\n    const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n    // \n    const inputStyle = `width:100%;padding:5px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:4px;color:${inputTextColor} !important;font-size:12px;text-align:center;box-sizing:border-box;`;\n\n    const overlay = $(\n      `<div class=\"acu-dice-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:${t.overlayBgLight};z-index:2147483647;\"></div>`,\n    );\n\n    // []  COC  DND\n    const successCriteriaOptions = [\n      { id: 'lte', name: ' (COC)' },\n      { id: 'gte', name: ' (DND)' },\n    ];\n\n    // [] \n    let defaultCriteria = successCriteria;\n    if (diceType === '1d100') defaultCriteria = 'lte';\n    else if (diceType === '1d20') defaultCriteria = 'gte';\n\n    const panel = $(`\n            <div class=\"acu-dice-panel acu-theme-${config.theme}\" style=\"\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 340px;\n                max-width: 90vw;\n                background: ${t.bgPanel};\n                border: 1px solid ${t.border};\n                border-radius: 12px;\n                box-shadow: 0 20px 60px ${t.shadowBg};\n                z-index: 2147483648;\n                overflow: hidden;\n                font-family: 'Microsoft YaHei', sans-serif;\n            \">\n                <div style=\"padding: 12px 15px; background: ${t.tableHead}; border-bottom: 1px solid ${t.border}; display: flex; justify-content: space-between; align-items: center;\">\n                    <div style=\"font-size: 15px; font-weight: bold; color: ${t.accent}; display: flex; align-items: center; gap: 8px;\">\n                        <i class=\"fa-solid fa-dice-d20\"></i> \n                    </div>\n                    <div style=\"display: flex; align-items: center; gap: 8px;\">\n                        <button id=\"dice-switch-contest-top\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 14px; padding: 4px; transition: all 0.2s;\" title=\"\"><i class=\"fa-solid fa-people-arrows\"></i></button>\n                        <button class=\"acu-dice-config-btn\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 14px; padding: 4px; transition: all 0.2s;\" title=\"\">\n                            <i class=\"fa-solid fa-cog\"></i>\n                        </button>\n                        <button class=\"acu-dice-close\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 16px; padding: 4px;\">\n                            <i class=\"fa-solid fa-times\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div style=\"padding: 15px; max-height: 70vh; overflow-y: auto;\">\n                    <div style=\"display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; align-items: center;\" class=\"acu-dice-presets\">\n                        <button class=\"acu-dice-preset ${diceType === '1d20' ? 'active' : ''}\" data-dice=\"1d20\" data-criteria=\"gte\" style=\"padding: 4px 10px; background: ${diceType === '1d20' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${diceType === '1d20' ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\">1d20</button>\n                        <button class=\"acu-dice-preset ${diceType === '1d100' ? 'active' : ''}\" data-dice=\"1d100\" data-criteria=\"lte\" style=\"padding: 4px 10px; background: ${diceType === '1d100' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${diceType === '1d100' ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\">1d100</button>\n                        <button class=\"acu-dice-preset acu-dice-custom-btn\" data-dice=\"custom\" style=\"padding: 4px 10px; background: ${!['1d20', '1d100'].includes(diceType) ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${!['1d20', '1d100'].includes(diceType) ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\"></button>\n                        <input type=\"text\" id=\"dice-custom-input\" placeholder=\"2d6\" value=\"${!['1d20', '1d100'].includes(diceType) ? diceType : ''}\" style=\"width:60px;\">\n                    </div>\n\n                    <!--  -->\n                    <div style=\"margin-bottom: 10px;\">\n                        <div style=\"font-size: 11px; color: ${t.accent}; font-weight: bold; margin-bottom: 4px; display: flex; align-items: center; gap: 6px;\"><i class=\"fa-solid fa-user\"></i> </div>\n                        <div id=\"dice-char-buttons\" style=\"display: flex; flex-wrap: wrap; gap: 4px; max-height: 60px; overflow-y: auto;\"></div>\n                    </div>\n\n                    <!-- 1 +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-initiator-name\" value=\"${escapeHtml(initiatorName)}\" placeholder=\"<user>\" style=\"${inputStyle}\">\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; gap: 6px;\">\n                                \n                                <button type=\"button\" class=\"acu-random-skill-btn\" id=\"dice-random-skill\" title=\"\" style=\"width: 18px; height: 18px; padding: 0; background: transparent; border: 1px dashed ${t.accent}; border-radius: 4px; color: ${t.accent}; font-size: 9px; cursor: pointer; display: flex; align-items: center; justify-content: center;\">\n                                    <i class=\"fa-solid fa-dice\"></i>\n                                </button>\n                            </div>\n                            <input type=\"text\" id=\"dice-attr-name\" value=\"${escapeHtml(targetName || '')}\" placeholder=\"\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!-- 2 +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-attr-value\" value=\"\" placeholder=\"=50%\" style=\"${inputStyle}\">\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\" id=\"dice-target-label\"></div>\n                            <input type=\"text\" id=\"dice-target\" value=\"${targetValue !== null ? targetValue : ''}\" placeholder=\"=\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!-- 3 +  +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-bottom: 6px;\" id=\"dice-row-3\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; justify-content: center;\"></div>\n                            <select id=\"dice-success-criteria\" class=\"acu-dice-select\">\n                                ${successCriteriaOptions\n                                  .map(\n                                    opt =>\n                                      `<option value=\"${opt.id}\" ${opt.id === defaultCriteria ? 'selected' : ''}>${opt.name}</option>`,\n                                  )\n                                  .join('')}\n                            </select>\n                        </div>\n                        <div id=\"dice-difficulty-wrapper\">\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; justify-content: center;\"></div>\n                            <select id=\"dice-difficulty\" class=\"acu-dice-select\">\n                                <option value=\"normal\" selected></option>\n                                <option value=\"hard\"></option>\n                                <option value=\"extreme\"></option>\n                                <option value=\"critical\"></option>\n                            </select>\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-modifier\" value=\"0\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div style=\"margin-bottom: 10px;\">\n                        <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 4px;\"><i class=\"fa-solid fa-sliders\"></i> </div>\n                        <div id=\"dice-attr-buttons\" style=\"display: flex; flex-wrap: wrap; gap: 4px; max-height: 80px; overflow-y: auto;\"></div>\n                    </div>\n                    <!--  -->\n                    <input type=\"hidden\" id=\"dice-formula\" value=\"${diceType}\">\n\n                    <button id=\"dice-roll-btn\" style=\"width: 100%; padding: 12px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 8px; color: ${t.buttonText}; font-size: 15px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; position: relative;\">\n                        <i class=\"fa-solid fa-dice\"></i> \n                    </button>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay).append(panel);\n\n    // [] \n    const buildCharButtons = () => {\n      const $container = panel.find('#dice-char-buttons');\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.initiator) {\n        const initiator = mvuParsedInfo.initiator;\n        const shortName = initiator.length > 4 ? initiator.substring(0, 4) + '..' : initiator;\n        const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n        html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu\" data-char=\"${escapeHtml(initiator)}\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;white-space:nowrap;font-weight:bold;\" title=\": ${escapeHtml(initiator)}\">${escapeHtml(shortName)}</button>`;\n      }\n\n      // \n      diceCharacterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html += `<button class=\"acu-dice-char-btn\" data-char=\"${escapeHtml(name)}\" style=\"padding:3px 8px;background:${t.btnBg};border:1px solid ${t.border};border-radius:4px;color:${t.textMain};font-size:11px;cursor:pointer;white-space:nowrap;\" title=\"${escapeHtml(displayName)}\">${escapeHtml(shortName)}</button>`;\n      });\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.candidates && mvuParsedInfo.candidates.length > 0) {\n        mvuParsedInfo.candidates.forEach(candidate => {\n          // \n          if (mvuParsedInfo.initiator && candidate === mvuParsedInfo.initiator) return;\n          const shortName = candidate.length > 4 ? candidate.substring(0, 4) + '..' : candidate;\n          html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu-candidate\" data-char=\"${escapeHtml(candidate)}\" style=\"padding:3px 8px;background:${t.inputBg};border:1px dashed ${t.accent};border-radius:4px;color:${t.accent};font-size:11px;cursor:pointer;white-space:nowrap;\" title=\": ${escapeHtml(candidate)}\">${escapeHtml(shortName)}</button>`;\n        });\n      }\n\n      $container.html(html || `<div style=\"font-size:11px;color:${t.textSub};\"></div>`);\n      // \n      $container.find('.acu-dice-char-btn').click(function () {\n        const charName = $(this).data('char');\n        panel.find('#dice-initiator-name').val(charName).trigger('change');\n      });\n    };\n\n    // [] \n    const buildAttrButtons = charName => {\n      const $container = panel.find('#dice-attr-buttons');\n      const $parentSection = $container.parent(); // \n      const attrs = getFullAttributesForCharacter(charName);\n\n      // \"\"\n      if (attrs.length === 0) {\n        $parentSection.hide();\n        return;\n      }\n\n      // \n      $parentSection.show();\n\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.attrName) {\n        const attrName = mvuParsedInfo.attrName;\n        // \n        const attrValue = getAttributeValue(charName, attrName) || targetValue || '';\n        const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n        if (attrValue) {\n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"${attrValue}\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;font-weight:bold;\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}:${attrValue}</button>`;\n        } else {\n          // \n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;font-weight:bold;\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}</button>`;\n        }\n      }\n\n      // \n      attrs.forEach(attr => {\n        html += `<button class=\"acu-dice-attr-btn\" data-name=\"${escapeHtml(attr.name)}\" data-value=\"${attr.value}\" style=\"padding:3px 8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:4px;color:${t.inputText};font-size:11px;cursor:pointer;\">${escapeHtml(attr.name)}:${attr.value}</button>`;\n      });\n\n      // \n      html += `<button class=\"acu-dice-gen-attr-btn\" style=\"padding:3px 8px;background:transparent;border:1px dashed ${t.accent};border-radius:4px;color:${t.accent};font-size:11px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>`;\n\n      // \n      html += `<button class=\"acu-dice-clear-attr-btn\" style=\"padding:3px 8px;background:transparent;border:1px dashed ${t.errorText};border-radius:4px;color:${t.errorText};font-size:11px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;margin-left:4px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\"></i></button>`;\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-dice-attr-btn').click(function () {\n        const attrName = $(this).data('name');\n        const attrValue = $(this).data('value');\n        panel.find('#dice-attr-name').val(attrName);\n        panel.find('#dice-attr-value').val(attrValue);\n\n        // \n        const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n        const isDND = criteria === 'gte';\n        const numValue = parseInt(attrValue, 10) || 0;\n\n        if (isDND) {\n          // DND = 20 - \n          const targetValue = Math.max(1, 20 - numValue);\n          panel.find('#dice-target').val(targetValue);\n        } else {\n          // COC = \n          panel.find('#dice-target').val(attrValue);\n        }\n\n        // changeUI\n        panel.find('#dice-attr-value').trigger('change');\n      });\n\n      // \n      $container.find('.acu-dice-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n          console.log('[DICE]ACU  for:', charName);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-dice-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharButtons();\n    // <user>\n    buildAttrButtons('<user>');\n    // [] \n    panel.find('#dice-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#dice-attr-name').val(randomSkill).trigger('change');\n    });\n\n    // \n    initCustomDropdown(panel.find('#dice-initiator-name'), diceCharacterList, t);\n    initCustomDropdown(panel.find('#dice-attr-name'), diceAttrList, t);\n    // [] \n    addClearButton(panel, '#dice-initiator-name, #dice-attr-name, #dice-attr-value, #dice-target', t);\n\n    // [] \n    panel.find('#dice-initiator-name').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#dice-attr-name'), newAttrList.length > 0 ? newAttrList : diceAttrList, t);\n\n      // [] \n      buildAttrButtons(charName);\n    });\n\n    // [] \n    panel.find('#dice-attr-name').on('change.acuval', function () {\n      const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#dice-attr-value').val(attrValue);\n        panel.find('#dice-target').val(attrValue);\n      }\n    });\n\n    // [] \n    const convertTargetForDice = (currentTarget, fromDice, toDice) => {\n      if (!currentTarget || currentTarget === '') return '';\n      const val = parseInt(currentTarget, 10);\n      if (isNaN(val)) return currentTarget;\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n\n      const fromMax = getMaxRoll(fromDice);\n      const toMax = getMaxRoll(toDice);\n\n      // \n      const ratio = val / fromMax;\n      const newVal = Math.round(ratio * toMax);\n      return Math.max(1, Math.min(newVal, toMax));\n    };\n\n    // []  UICOC/DND \n    const updateRuleMode = () => {\n      const criteria = panel.find('#dice-success-criteria').val();\n      const isDND = criteria === 'gte';\n      const $targetInput = panel.find('#dice-target');\n      const $difficultyWrapper = panel.find('#dice-difficulty-wrapper');\n      const $row3 = panel.find('#dice-row-3');\n\n      if (isDND) {\n        // DND \n        $targetInput.attr('placeholder', '=20-');\n        panel.find('#dice-target-label').text('DC');\n        $difficultyWrapper.hide();\n        $row3.css('grid-template-columns', '1fr 1fr');\n      } else {\n        // COC \n        $targetInput.attr('placeholder', '=');\n        panel.find('#dice-target-label').text('');\n        $difficultyWrapper.show();\n        $row3.css('grid-template-columns', '1fr 1fr 1fr');\n      }\n    };\n\n    panel.find('#dice-success-criteria').on('change', updateRuleMode);\n\n    // \n    updateRuleMode();\n\n    // \n    let currentDiceType = diceType;\n\n    //  - [] \n    panel.find('.acu-dice-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-dice-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n      const suggestedCriteria = $(this).data('criteria') || 'lte';\n\n      // [] \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, newDice);\n        $targetInput.val(convertedVal);\n      }\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n      const newMax = getMaxRoll(newDice);\n      panel.find('#dice-target-auto').text(`(: 1~${newMax})`);\n\n      currentDiceType = newDice;\n      panel.find('#dice-formula').val(newDice);\n\n      // [] \n      panel.find('#dice-success-criteria').val(suggestedCriteria).trigger('change');\n    });\n    // \n    panel.find('.acu-dice-custom-btn').click(function () {\n      // \n      panel.find('.acu-dice-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      const customDice = panel.find('#dice-custom-input').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#dice-custom-input').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      // \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, customDice);\n        $targetInput.val(convertedVal);\n      }\n\n      panel.find('#dice-formula').val(customDice);\n      currentDiceType = customDice;\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n\n      panel.find('#dice-success-criteria').val('gte').trigger('change');\n    });\n\n    // \n    panel.find('#dice-custom-input').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-dice-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = formula => {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], formula };\n\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      const total = rolls.reduce((a, b) => a + b, 0) + modifier;\n\n      return { total, rolls, sides, count, modifier, formula };\n    };\n\n    // 1d6, 1d6+2\n    const parseModifier = function (modStr) {\n      if (!modStr || modStr.trim() === '') return 0;\n      const trimmed = modStr.trim();\n\n      // \n      const numValue = parseFloat(trimmed);\n      if (!isNaN(numValue) && isFinite(numValue) && trimmed.match(/^-?\\d+(\\.\\d+)?$/)) {\n        return numValue;\n      }\n\n      // \n      // 1d6, 2d10, 1d6+2, 1d6-2, 2d6+1d4\n      let result = 0;\n      let remaining = trimmed;\n\n      // 1d6, 2d10\n      const dicePattern = /(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi;\n      let match;\n      while ((match = dicePattern.exec(remaining)) !== null) {\n        const diceResult = rollDiceExpression(match[0]);\n        if (!isNaN(diceResult)) {\n          result += diceResult;\n        }\n        remaining = remaining.replace(match[0], '');\n      }\n\n      // \n      const numberPattern = /([+-]?\\d+(\\.\\d+)?)/g;\n      let numMatch;\n      while ((numMatch = numberPattern.exec(remaining)) !== null) {\n        const num = parseFloat(numMatch[0]);\n        if (!isNaN(num) && isFinite(num)) {\n          result += num;\n        }\n      }\n\n      return result;\n    };\n\n    // \n    const performDiceRoll = function () {\n      const formula = panel.find('#dice-formula').val().trim() || '1d100';\n      const modStr = panel.find('#dice-modifier').val().trim() || '0';\n      const mod = parseModifier(modStr);\n      const attrName = panel.find('#dice-attr-name').val().trim() || '';\n      const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n      const difficulty = panel.find('#dice-difficulty').val() || 'normal';\n\n      // \n      const isDND = criteria === 'gte';\n\n      // \n      const diceCfg = getDiceConfig();\n      const hardDiv = diceCfg.difficultSuccessDiv || 2;\n      const extremeDiv = diceCfg.hardSuccessDiv || 5;\n      // COC:   critSuccessMax,   critFailMin\n      // DND:   dndCritSuccess,   dndCritFail\n      const critSuccessMax = isDND ? diceCfg.dndCritFail || 1 : diceCfg.critSuccessMax || 5;\n      const critFailMin = isDND ? diceCfg.dndCritSuccess || 20 : diceCfg.critFailMin || 96;\n\n      // COC  DND \n      let targetInputVal = panel.find('#dice-target').val().trim();\n      let attrInputVal = panel.find('#dice-attr-value').val().trim();\n      let attrValue = attrInputVal !== '' ? parseInt(attrInputVal, 10) : 0;\n      let target;\n      let isAutoTarget = false;\n\n      // \n      const getDefaultTarget = formulaStr => {\n        const match = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (match) {\n          const maxRoll = parseInt(match[1], 10) * parseInt(match[2], 10);\n          return Math.round(maxRoll / 2);\n        }\n        return 50;\n      };\n\n      if (targetInputVal !== '') {\n        // /DC\n        target = parseInt(targetInputVal, 10) || getDefaultTarget(formula);\n      } else if (isDND) {\n        // DND  DC = 20 - DC=10\n        if (attrValue > 0) {\n          target = Math.max(1, 20 - attrValue);\n          isAutoTarget = true;\n        } else {\n          target = 10; // \n          isAutoTarget = true;\n        }\n      } else {\n        // COC  = \n        if (attrValue > 0) {\n          target = attrValue;\n          isAutoTarget = true;\n        } else {\n          target = getDefaultTarget(formula);\n          isAutoTarget = true;\n        }\n      }\n\n      const result = rollDice(formula);\n      const finalValue = result.total + mod;\n\n      // \n      let requiredTarget = target;\n      let difficultyLabel = '';\n      let difficultyDiv = 1;\n\n      // DND \n      if (!isDND) {\n        switch (difficulty) {\n          case 'hard':\n            requiredTarget = Math.floor(target / hardDiv);\n            difficultyLabel = '';\n            difficultyDiv = hardDiv;\n            break;\n          case 'extreme':\n            requiredTarget = Math.floor(target / extremeDiv);\n            difficultyLabel = '';\n            difficultyDiv = extremeDiv;\n            break;\n          case 'critical':\n            requiredTarget = critSuccessMax;\n            difficultyLabel = '';\n            break;\n          default:\n            difficultyLabel = '';\n            break;\n        }\n      }\n\n      // \n      let isCritSuccess = false;\n      let isCritFailure = false;\n      let isSuccess = false;\n      let outcomeText = '';\n      let outcomeClass = '';\n\n      // /\n      if (isDND) {\n        // DND:   20  1\n        isCritSuccess = finalValue >= critFailMin; //  critFailMin  DND \n        isCritFailure = finalValue <= critSuccessMax; //  critSuccessMax  DND \n      } else {\n        // COC:   5  96\n        isCritSuccess = finalValue <= critSuccessMax;\n        isCritFailure = finalValue >= critFailMin;\n      }\n\n      // /\n      if (isDND) {\n        isSuccess = finalValue >= requiredTarget;\n      } else {\n        isSuccess = finalValue <= requiredTarget;\n      }\n\n      // \n      if (isCritSuccess) {\n        outcomeText = '';\n        outcomeClass = 'success';\n        isSuccess = true;\n      } else if (isCritFailure) {\n        outcomeText = '';\n        outcomeClass = 'failure';\n        isSuccess = false;\n      } else if (isSuccess) {\n        if (isDND) {\n          outcomeText = '';\n        } else if (difficulty === 'hard') {\n          outcomeText = '';\n        } else if (difficulty === 'extreme') {\n          outcomeText = '';\n        } else {\n          // \n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            outcomeText = '';\n          } else if (finalValue <= hardTarget) {\n            outcomeText = '';\n          } else {\n            outcomeText = '';\n          }\n        }\n        outcomeClass = 'success';\n      } else {\n        outcomeText = '';\n        outcomeClass = 'failure';\n      }\n\n      const criteriaSymbol = isDND ? '' : '';\n      const hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const displayValue = hideDiceResultFromUser ? '' : finalValue;\n      const displayOutcomeText = hideDiceResultFromUser ? '' : outcomeText;\n\n      // \n      let resultType;\n      if (isCritSuccess) {\n        resultType = 'critSuccess';\n      } else if (isCritFailure) {\n        resultType = 'critFailure';\n      } else if (isSuccess) {\n        if (difficulty === 'extreme' || (difficulty === 'normal' && finalValue <= Math.floor(target / extremeDiv))) {\n          resultType = 'extremeSuccess';\n        } else if (difficulty === 'hard' || (difficulty === 'normal' && finalValue <= Math.floor(target / hardDiv))) {\n          resultType = 'success';\n        } else {\n          resultType = 'warning';\n        }\n      } else {\n        resultType = 'failure';\n      }\n\n      const badgeStyle = getResultBadgeStyle(resultType, t);\n      const badgeStyleStr = Object.entries(badgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n\n      // \n      const $rollBtn = panel.find('#dice-roll-btn');\n      $rollBtn.html(`\n        <div style=\"display:flex; align-items:center; justify-content:center; width:100%; gap:8px;\">\n          <span style=\"font-size:22px; font-weight:bold; color:${t.buttonText};\">${displayValue}</span>\n          <span style=\"font-size:11px; color:${t.buttonText}; opacity:0.9;\">${criteriaSymbol}${requiredTarget}${difficultyLabel ? '(' + difficultyLabel + ')' : ''}</span>\n          ${displayOutcomeText ? `<span style=\"${badgeStyleStr}\">${displayOutcomeText}</span>` : ''}\n          <button class=\"dice-retry-btn\" style=\"background:transparent; border:none; color:${t.buttonText}; cursor:pointer; padding:4px; display:flex; align-items:center; justify-content:center; opacity:0.8; transition:opacity 0.2s;\" title=\"\">\n            <i class=\"fa-solid fa-rotate-right\"></i>\n          </button>\n        </div>\n      `);\n\n      // \n      $rollBtn.off('click', '.dice-retry-btn').on('click', '.dice-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        // \n        performDiceRoll();\n      });\n\n      //  Prompt \n      const initiatorName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      let judgeExpr = '';\n\n      if (isCritSuccess) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        } else {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        }\n      } else if (isCritFailure) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        } else {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        }\n      } else if (isDND) {\n        // DND \n        if (isSuccess) {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}<${requiredTarget}`;\n        }\n      } else if (difficulty === 'critical') {\n        // COC \n        judgeExpr = `${critSuccessMax}${finalValue}>${critSuccessMax}`;\n      } else if (difficulty !== 'normal') {\n        // COC \n        if (isSuccess) {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}>${requiredTarget}`;\n        }\n      } else {\n        // COC \n        if (isSuccess) {\n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${extremeDiv}`;\n          } else if (finalValue <= hardTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${hardDiv}`;\n          } else {\n            judgeExpr = `${target}${finalValue}${target}`;\n          }\n        } else {\n          judgeExpr = `${target}${finalValue}>${target}`;\n        }\n      }\n\n      const diceResultText = `${initiatorName}${attrName}${finalValue}${judgeExpr}${outcomeText}`;\n      smartInsertToTextarea(diceResultText, 'dice');\n      if (onResult) {\n        onResult({\n          success: isSuccess,\n          total: finalValue,\n          target,\n          outcomeText,\n          attrName,\n          criteria,\n          isAutoTarget,\n          formula: formulaText,\n        });\n      }\n    };\n\n    // \n    panel.find('#dice-roll-btn').click(function () {\n      performDiceRoll();\n    });\n\n    // \n    panel.find('#dice-switch-contest-top').click(function () {\n      const targetInput = panel.find('#dice-target').val().trim();\n      const attrValueInput = panel.find('#dice-attr-value').val().trim();\n      const currentDice = panel.find('#dice-formula').val() || '1d100';\n      const initiatorNameVal = panel.find('#dice-initiator-name').val().trim();\n      closePanel();\n      showContestPanel({\n        //  placeholder \n        initiatorName: initiatorNameVal && initiatorNameVal !== '<user>' ? initiatorNameVal : '',\n        initiatorValue: attrValueInput !== '' ? parseInt(attrValueInput, 10) : undefined,\n        diceType: currentDice,\n      });\n    });\n    // \n    const closePanel = () => {\n      overlay.remove();\n      panel.remove();\n    };\n    overlay.click(closePanel);\n    panel.find('.acu-dice-close').click(closePanel);\n    //  - \n    panel.find('.acu-dice-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentCriteria = panel.find('#dice-success-criteria').val();\n      const isDND = currentCriteria === 'gte';\n      showDiceSettingsPanel(isDND);\n    });\n  };\n\n  // [] \n  const showContestPanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay, .acu-contest-panel, .acu-contest-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    // \n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n\n    // \n    const opponentName = options.opponentName || '';\n    const diceType = options.diceType || savedDiceType;\n    const passedInitiatorName = options.initiatorName || '';\n    const passedInitiatorValue = options.initiatorValue;\n    const passedOpponentValue = options.opponentValue;\n\n    const rawData = cachedRawData || getTableData();\n    let playerAttrs = [];\n    let opponentAttrs = [];\n\n    // [] <user> + \n    let characterList = ['<user>'];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) characterList.push(row[1]);\n          }\n          break;\n        }\n      }\n    }\n    // [] \n    let contestAttrList = [];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content && sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!contestAttrList.includes(attr.name)) contestAttrList.push(attr.name);\n              });\n            }\n          });\n          break;\n        }\n      }\n    }\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const attrStr = sheet.content[1][7] || '';\n          playerAttrs = parseAttributeString(attrStr);\n        }\n\n        if (sheet.name === '' && opponentName) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1] === opponentName) {\n              const attrStr = row[9] || '';\n              opponentAttrs = parseAttributeString(attrStr);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    const t = getThemeColors();\n    const isCyberTheme = getConfig().theme === 'cyber';\n    const inputTextColor = isCyberTheme ? '#ff00ff' : t.inputText;\n    // \n    const inputStyle = `width:100%;padding:5px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:4px;color:${inputTextColor} !important;font-size:12px;text-align:center;box-sizing:border-box;`;\n\n    const buildAttrButtons = (attrs, targetType) => {\n      // \n      if (attrs.length === 0) return '';\n      let html = '';\n      for (let i = 0; i < attrs.length; i++) {\n        const attr = attrs[i];\n        html +=\n          '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n          attr.value +\n          '\" data-aname=\"' +\n          escapeHtml(attr.name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" style=\"padding:3px 8px;background:' +\n          t.inputBg +\n          ';border:1px solid ' +\n          t.border +\n          ';border-radius:4px;color:' +\n          t.inputText +\n          ';font-size:11px;cursor:pointer;margin:2px;\">' +\n          escapeHtml(attr.name) +\n          ': ' +\n          attr.value +\n          '</button>';\n      }\n      return html;\n    };\n\n    const overlay = $(\n      '<div class=\"acu-contest-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:' +\n        t.overlayBg +\n        ';z-index:2147483647;\"></div>',\n    );\n    const panelHtml =\n      '<div class=\"acu-contest-panel acu-theme-' +\n      config.theme +\n      '\" style=\"position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:360px;max-width:92vw;background:' +\n      t.bgPanel +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:12px;box-shadow:0 20px 60px ' +\n      t.shadowBg +\n      ';z-index:2147483648;font-family:Microsoft YaHei,sans-serif;overflow:hidden;\">' +\n      '<div style=\"padding:12px 15px;background:' +\n      t.tableHead +\n      ';border-bottom:1px solid ' +\n      t.border +\n      ';display:flex;justify-content:space-between;align-items:center;\">' +\n      '<div style=\"font-size:15px;font-weight:bold;color:' +\n      t.accent +\n      ';display:flex;align-items:center;gap:8px;\"><i class=\"fa-solid fa-people-arrows\"></i> </div>' +\n      '<div style=\"display:flex;align-items:center;gap:8px;\">' +\n      '<button id=\"contest-switch-normal\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:14px;padding:4px;transition:all 0.2s;\" title=\"\"><i class=\"fa-solid fa-dice-d20\"></i></button>' +\n      '<button class=\"acu-contest-config-btn\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:14px;padding:4px;transition:all 0.2s;\" title=\"\"><i class=\"fa-solid fa-cog\"></i></button>' +\n      '<button class=\"acu-contest-close\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>' +\n      '</div>' +\n      '</div>' +\n      '<div style=\"padding:15px;max-height:70vh;overflow-y:auto;\">' +\n      '<div style=\"display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;align-items:center;\">' +\n      '<button class=\"acu-contest-preset' +\n      (diceType === '1d20' ? ' active' : '') +\n      '\" data-dice=\"1d20\" style=\"padding:4px 10px;background:' +\n      (diceType === '1d20' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (diceType === '1d20' ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\">1d20</button>' +\n      '<button class=\"acu-contest-preset' +\n      (diceType === '1d100' ? ' active' : '') +\n      '\" data-dice=\"1d100\" style=\"padding:4px 10px;background:' +\n      (diceType === '1d100' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (diceType === '1d100' ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\">1d100</button>' +\n      '<button class=\"acu-contest-preset acu-contest-custom-btn\" data-dice=\"custom\" style=\"padding:4px 10px;background:' +\n      (!['1d20', '1d100'].includes(diceType) ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (!['1d20', '1d100'].includes(diceType) ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\"></button>' +\n      '<input type=\"text\" id=\"contest-custom-dice\" placeholder=\"2d6\" value=\"' +\n      (!['1d20', '1d100'].includes(diceType) ? diceType : '') +\n      '\" style=\"width:60px;padding:4px 6px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      inputTextColor +\n      ' !important;font-size:11px;text-align:center;box-sizing:border-box;\" />' +\n      '</div>' +\n      '<input type=\"hidden\" id=\"contest-dice-type\" value=\"' +\n      diceType +\n      '\">' +\n      '<div style=\"font-size:11px;color:' +\n      t.accent +\n      ';font-weight:bold;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-init-char-buttons\" style=\"display:flex;flex-wrap:wrap;gap:3px;\"></div></div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-display\" value=\"\" placeholder=\"<user>\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;gap:6px;\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-init-random-skill\" title=\"\" style=\"width:18px;height:18px;padding:0;background:transparent;border:1px dashed ' +\n      t.accent +\n      ';border-radius:4px;color:' +\n      t.accent +\n      ';font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" id=\"contest-init-name\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-value\" value=\"' +\n      (passedInitiatorValue !== undefined ? passedInitiatorValue : '') +\n      '\" placeholder=\"=50%\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-target\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div id=\"init-attr-buttons\" style=\"display:flex;flex-wrap:wrap;gap:2px;margin-bottom:8px;max-height:50px;overflow-y:auto;\">' +\n      buildAttrButtons(playerAttrs, 'init') +\n      '</div>' +\n      '<div style=\"font-size:11px;color:' +\n      t.accent +\n      ';font-weight:bold;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-opp-char-buttons\" style=\"display:flex;flex-wrap:wrap;gap:3px;\"></div></div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opponent-display\" value=\"' +\n      escapeHtml(opponentName) +\n      '\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;gap:6px;\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-opp-random-skill\" title=\"\" style=\"width:18px;height:18px;padding:0;background:transparent;border:1px dashed ' +\n      t.accent +\n      ';border-radius:4px;color:' +\n      t.accent +\n      ';font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" id=\"contest-opp-name\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opp-value\" value=\"' +\n      (passedOpponentValue !== undefined ? passedOpponentValue : '') +\n      '\" placeholder=\"=50%\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opp-target\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div id=\"opp-attr-buttons\" style=\"display:flex;flex-wrap:wrap;gap:2px;margin-bottom:10px;max-height:50px;overflow-y:auto;\">' +\n      buildAttrButtons(opponentAttrs, 'opp') +\n      '</div>' +\n      '<div id=\"contest-result-display\" style=\"display:none;margin-bottom:10px;padding:8px;background:' +\n      t.inputBg +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:6px;\">' +\n      '<div style=\"display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;width:100%;\">' +\n      '<div id=\"contest-result-init\" style=\"display:flex;align-items:center;gap:4px;min-width:0;flex:1;\"></div>' +\n      '<span style=\"color:' +\n      t.textSub +\n      ';opacity:0.9;font-size:11px;font-weight:bold;white-space:nowrap;\">VS</span>' +\n      '<div id=\"contest-result-opp\" style=\"display:flex;align-items:center;gap:4px;min-width:0;flex:1;justify-content:flex-end;\"></div>' +\n      '</div>' +\n      '</div>' +\n      '<button id=\"contest-roll-btn\" style=\"width:100%;padding:12px;background:' +\n      (t.buttonBg || t.accent) +\n      ';border:none;border-radius:8px;color:' +\n      t.buttonText +\n      ';font-size:15px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;position:relative;\"><i class=\"fa-solid fa-dice\"></i> </button>' +\n      '</div>' +\n      '</div>';\n\n    const panel = $(panelHtml);\n    $('body').append(overlay).append(panel);\n\n    // [] \n    const $initAttrButtons = panel.find('#init-attr-buttons');\n    const $oppAttrButtons = panel.find('#opp-attr-buttons');\n    if ($initAttrButtons.html().trim() === '') {\n      $initAttrButtons.hide();\n    }\n    if ($oppAttrButtons.html().trim() === '') {\n      $oppAttrButtons.hide();\n    }\n\n    // []  - \n    const buildCharBtns = targetType => {\n      const containerId = targetType === 'init' ? '#contest-init-char-buttons' : '#contest-opp-char-buttons';\n      const $container = panel.find(containerId);\n      let html = '';\n      characterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html +=\n          '<button class=\"acu-contest-char-btn\" data-char=\"' +\n          escapeHtml(name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" style=\"padding:3px 8px;background:' +\n          t.btnBg +\n          ';border:1px solid ' +\n          t.border +\n          ';border-radius:4px;color:' +\n          t.textMain +\n          ';font-size:11px;cursor:pointer;white-space:nowrap;\" title=\"' +\n          escapeHtml(displayName) +\n          '\">' +\n          escapeHtml(shortName) +\n          '</button>';\n      });\n      $container.html(html);\n      $container.find('.acu-contest-char-btn').click(function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const charName = $(this).data('char');\n        const type = $(this).data('type');\n        if (type === 'init') {\n          panel.find('#contest-init-display').val(charName).trigger('change');\n        } else {\n          panel.find('#contest-opponent-display').val(charName).trigger('change');\n        }\n      });\n    };\n\n    // [] \n    const rebuildAttrBtns = (attrs, targetType) => {\n      const containerId = targetType === 'init' ? '#init-attr-buttons' : '#opp-attr-buttons';\n      const $container = panel.find(containerId);\n\n      // \n      if (attrs.length === 0) {\n        $container.hide().html('');\n        return;\n      }\n\n      // \n      $container.show();\n\n      let html = '';\n\n      // \n      if (attrs.length > 0) {\n        attrs.forEach(attr => {\n          html +=\n            '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n            attr.value +\n            '\" data-aname=\"' +\n            escapeHtml(attr.name) +\n            '\" data-type=\"' +\n            targetType +\n            '\" style=\"padding:2px 6px;background:' +\n            t.inputBg +\n            ';border:1px solid ' +\n            t.border +\n            ';border-radius:3px;color:' +\n            t.inputText +\n            ';font-size:10px;cursor:pointer;\">' +\n            escapeHtml(attr.name) +\n            ':' +\n            attr.value +\n            '</button>';\n        });\n      }\n\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.accent +\n        ';border-radius:3px;color:' +\n        t.accent +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.errorText +\n        ';border-radius:3px;color:' +\n        t.errorText +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin-left:4px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\" style=\"font-size:9px;\"></i></button>';\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-contest-attr-btn').click(function () {\n        const val = $(this).attr('data-val');\n        const aname = $(this).attr('data-aname');\n        const type = $(this).attr('data-type');\n        if (type === 'init') {\n          panel.find('#contest-init-value').val(val);\n          panel.find('#contest-init-name').val(aname);\n        } else {\n          panel.find('#contest-opp-value').val(val);\n          panel.find('#contest-opp-name').val(aname);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          // \n          let charName;\n          if (type === 'init') {\n            charName = panel.find('#contest-init-display').val().trim() || '<user>';\n          } else {\n            charName = panel.find('#contest-opponent-display').val().trim();\n          }\n\n          if (!charName) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        let charName;\n        if (type === 'init') {\n          charName = panel.find('#contest-init-display').val().trim() || '<user>';\n        } else {\n          charName = panel.find('#contest-opponent-display').val().trim();\n        }\n\n        if (!charName) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharBtns('init');\n    buildCharBtns('opp');\n    // [] \n    panel.find('#contest-init-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-init-name').val(randomSkill).trigger('change');\n    });\n\n    // [] \n    panel.find('#contest-opp-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-opp-name').val(randomSkill).trigger('change');\n    });\n    // \n    if (passedInitiatorName) {\n      const initAttrs = getFullAttributesForCharacter(passedInitiatorName);\n      rebuildAttrBtns(initAttrs, 'init');\n    }\n    if (opponentName) {\n      const oppAttrs = getFullAttributesForCharacter(opponentName);\n      rebuildAttrBtns(oppAttrs, 'opp');\n    }\n\n    // \n    initCustomDropdown(panel.find('#contest-init-display'), characterList, t);\n    initCustomDropdown(panel.find('#contest-opponent-display'), characterList, t);\n    initCustomDropdown(panel.find('#contest-init-name'), contestAttrList, t);\n    initCustomDropdown(panel.find('#contest-opp-name'), contestAttrList, t);\n    addClearButton(\n      panel,\n      '#contest-init-display, #contest-init-name, #contest-init-value, #contest-init-target, #contest-opponent-display, #contest-opp-name, #contest-opp-value, #contest-opp-target',\n      t,\n    );\n\n    // \n    panel.find('#contest-init-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-init-name'), newAttrList.length > 0 ? newAttrList : contestAttrList, t);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'init');\n    });\n\n    // \n    panel.find('#contest-opponent-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim();\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-opp-name'), newAttrList.length > 0 ? newAttrList : contestAttrList, t);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'opp');\n    });\n\n    // \n    panel.find('#contest-init-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-init-display').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-init-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('#contest-opp-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-opponent-display').val().trim();\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-opp-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('.acu-contest-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-contest-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n      panel.find('#contest-dice-type').val(newDice);\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n    });\n\n    // \n    panel.find('.acu-contest-custom-btn').click(function () {\n      // \n      panel.find('.acu-contest-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      var customDice = panel.find('#contest-custom-dice').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#contest-custom-dice').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      panel.find('#contest-dice-type').val(customDice);\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n    });\n\n    // \n    panel.find('#contest-custom-dice').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-contest-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = function (formula) {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], sides: 100 };\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      return {\n        total:\n          rolls.reduce(function (a, b) {\n            return a + b;\n          }, 0) + modifier,\n        rolls: rolls,\n        sides: sides,\n      };\n    };\n\n    const getSuccessLevel = function (roll, target, sides) {\n      const t = getThemeColors();\n      if (sides === 100) {\n        if (roll <= 5) return { level: 3, name: '', color: t.critSuccessText };\n        if (roll >= 96) return { level: -1, name: '', color: t.critFailureText };\n        if (roll <= Math.floor(target / 5)) return { level: 2, name: '', color: t.extremeSuccessText };\n        if (roll <= Math.floor(target / 2)) return { level: 1, name: '', color: t.successText };\n        if (roll <= target) return { level: 0, name: '', color: t.warningText };\n        return { level: -1, name: '', color: t.failureText };\n      } else {\n        if (roll === 20) return { level: 3, name: '', color: t.critSuccessText };\n        if (roll === 1) return { level: -1, name: '', color: t.critFailureText };\n        if (roll >= target) return { level: 0, name: '', color: t.successText };\n        return { level: -1, name: '', color: t.failureText };\n      }\n    };\n\n    // \n    const performContestRoll = function () {\n      var formula = panel.find('#contest-dice-type').val() || '1d100';\n\n      var initName = panel.find('#contest-init-display').val().trim() || '<user>';\n      var initAttrName = panel.find('#contest-init-name').val().trim() || '';\n      // \n      var getHalfMax = function (formulaStr) {\n        var m = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (m) return Math.round((parseInt(m[1], 10) * parseInt(m[2], 10)) / 2);\n        return 50;\n      };\n\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var initValue;\n      if (initValueInput === '') {\n        // \n        initValue = getHalfMax(formula);\n      } else {\n        initValue = parseInt(initValueInput, 10) || getHalfMax(formula);\n      }\n      var initTargetInput = panel.find('#contest-init-target').val().trim();\n      var initTarget;\n      if (initTargetInput !== '') {\n        initTarget = parseInt(initTargetInput, 10);\n      } else {\n        // \n        initTarget = initValue;\n      }\n\n      var oppName = panel.find('#contest-opponent-display').val().trim() || '';\n      var oppAttrName = panel.find('#contest-opp-name').val().trim() || initAttrName;\n      var oppValueInput = panel.find('#contest-opp-value').val().trim();\n      var oppValue;\n      if (oppValueInput === '') {\n        // \n        oppValue = getHalfMax(formula);\n      } else {\n        oppValue = parseInt(oppValueInput, 10) || getHalfMax(formula);\n      }\n      var oppTargetInput = panel.find('#contest-opp-target').val().trim();\n      var oppTarget;\n      if (oppTargetInput !== '') {\n        oppTarget = parseInt(oppTargetInput, 10);\n      } else {\n        // \n        oppTarget = oppValue;\n      }\n\n      var initResult = rollDice(formula);\n      var oppResult = rollDice(formula);\n      var initSuccess = getSuccessLevel(initResult.total, initTarget, initResult.sides);\n      var oppSuccess = getSuccessLevel(oppResult.total, oppTarget, oppResult.sides);\n\n      var winner, winnerColor, resultDesc;\n      var diceCfg = getDiceConfig();\n      var tieRule = diceCfg.contestTieRule || 'initiator_lose';\n      var hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      var displayInitValue = hideDiceResultFromUser ? '' : initResult.total;\n      var displayOppValue = hideDiceResultFromUser ? '' : oppResult.total;\n      var displayInitSuccessName = hideDiceResultFromUser ? '' : initSuccess.name;\n      var displayOppSuccessName = hideDiceResultFromUser ? '' : oppSuccess.name;\n\n      if (initSuccess.level > oppSuccess.level) {\n        winner = initName + ' ';\n        winnerColor = t.successText;\n        resultDesc = initSuccess.name + '  ' + oppSuccess.name;\n      } else if (initSuccess.level < oppSuccess.level) {\n        winner = oppName + ' ';\n        winnerColor = t.failureText;\n        resultDesc = oppSuccess.name + '  ' + initSuccess.name;\n      } else {\n        // \n        resultDesc = ' ' + initSuccess.name;\n        if (tieRule === 'initiator_win') {\n          winner = '' + initName + ' ';\n          winnerColor = t.successText;\n        } else if (tieRule === 'tie') {\n          winner = '';\n          winnerColor = t.warningText;\n        } else {\n          // : initiator_lose\n          winner = '' + initName + ' ';\n          winnerColor = t.failureText;\n        }\n      }\n\n      var displayWinner = hideDiceResultFromUser ? '' : winner;\n\n      // \n      const getResultTypeFromSuccess = success => {\n        if (success.level === 3) return 'critSuccess';\n        if (success.level === 2) return 'extremeSuccess';\n        if (success.level === 1) return 'success';\n        if (success.level === 0) return 'warning';\n        if (success.level === -1) {\n          // name\n          return success.name === '' ? 'critFailure' : 'failure';\n        }\n        return 'failure';\n      };\n      const initResultType = getResultTypeFromSuccess(initSuccess);\n      const oppResultType = getResultTypeFromSuccess(oppSuccess);\n\n      const initBadgeStyle = getResultBadgeStyle(initResultType, t);\n      const oppBadgeStyle = getResultBadgeStyle(oppResultType, t);\n      const winnerBadgeStyle = getResultBadgeStyle(\n        winnerColor === t.successText ? 'success' : winnerColor === t.warningText ? 'warning' : 'failure',\n        t,\n      );\n\n      const initBadgeStyleStr = Object.entries(initBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n      const oppBadgeStyleStr = Object.entries(oppBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n      const winnerBadgeStyleStr = Object.entries(winnerBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n\n      // \n      const $resultDisplay = panel.find('#contest-result-display');\n      const $resultInit = panel.find('#contest-result-init');\n      const $resultOpp = panel.find('#contest-result-opp');\n\n      // \n      $resultInit.html(\n        '<span style=\"font-size:11px;color:' +\n          t.textMain +\n          ';opacity:0.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;\">' +\n          escapeHtml(initName) +\n          '</span>' +\n          '<span style=\"font-size:16px;font-weight:bold;color:' +\n          t.textMain +\n          ';\">' +\n          displayInitValue +\n          '</span>' +\n          (displayInitSuccessName\n            ? '<span style=\"' + initBadgeStyleStr + '\">' + displayInitSuccessName + '</span>'\n            : ''),\n      );\n\n      // \n      $resultOpp.html(\n        (displayOppSuccessName ? '<span style=\"' + oppBadgeStyleStr + '\">' + displayOppSuccessName + '</span>' : '') +\n          '<span style=\"font-size:16px;font-weight:bold;color:' +\n          t.textMain +\n          ';\">' +\n          displayOppValue +\n          '</span>' +\n          '<span style=\"font-size:11px;color:' +\n          t.textMain +\n          ';opacity:0.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;\">' +\n          escapeHtml(oppName) +\n          '</span>',\n      );\n\n      $resultDisplay.show();\n\n      // \n      const $contestBtn = panel.find('#contest-roll-btn');\n      $contestBtn.html(\n        '<div style=\"display:flex; align-items:center; justify-content:center; width:100%; gap:8px;\">' +\n          (displayWinner ? '<span style=\"' + winnerBadgeStyleStr + '\">' + displayWinner + '</span>' : '') +\n          '<button class=\"contest-retry-btn\" style=\"background:transparent; border:none; color:' +\n          t.buttonText +\n          '; cursor:pointer; padding:4px; display:flex; align-items:center; justify-content:center; opacity:0.8; transition:opacity 0.2s;\" title=\"\">' +\n          '<i class=\"fa-solid fa-rotate-right\"></i>' +\n          '</button>' +\n          '</div>',\n      );\n\n      // \n      $contestBtn.off('click', '.contest-retry-btn').on('click', '.contest-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        // \n        performContestRoll();\n      });\n\n      const contestResultText =\n        `${initAttrName} vs ${oppAttrName}` +\n        `${initName} (${initTarget})  ${initResult.total}${initSuccess.name}` +\n        `${oppName} (${oppTarget})  ${oppResult.total}${oppSuccess.name}` +\n        `${winner}`;\n      smartInsertToTextarea(contestResultText, 'dice');\n    };\n\n    // \n    panel.find('#contest-roll-btn').click(function () {\n      performContestRoll();\n    });\n\n    // [] \n    panel.find('#contest-switch-normal').click(function () {\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var currentInitName = panel.find('#contest-init-name').val() || '';\n      var currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      var initiatorNameVal = panel.find('#contest-init-display').val().trim();\n      closePanel();\n      showDicePanel({\n        //  null  placeholder\n        targetValue: initValueInput !== '' ? parseInt(initValueInput, 10) : null,\n        targetName: currentInitName,\n        diceType: currentDice,\n        initiatorName: initiatorNameVal,\n      });\n    });\n    //  - \n    // 1d20 -> DND,  -> COC\n    panel.find('.acu-contest-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      const isDND = currentDice === '1d20';\n      showDiceSettingsPanel(isDND);\n    });\n    var closePanel = function () {\n      overlay.remove();\n      panel.remove();\n    };\n    overlay.click(closePanel);\n    panel.find('.acu-contest-close').click(closePanel);\n  };\n  // [] \n  const showPreviewCard = (tableName, headers, row, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    $('.acu-preview-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // 1\n    const title = row[1] || '';\n\n    // \n    let bodyHtml = '';\n    for (let i = 1; i < headers.length; i++) {\n      const headerName = headers[i];\n      const cellValue = row[i];\n      if (!headerName || cellValue === null || cellValue === undefined || cellValue === '') continue;\n\n      bodyHtml += `\n                <div class=\"acu-preview-row\">\n                    <div class=\"acu-preview-label\">${escapeHtml(headerName)}</div>\n                    <div class=\"acu-preview-value\">${escapeHtml(String(cellValue))}</div>\n                </div>\n            `;\n    }\n\n    // \n    const overlay = $(`\n            <div class=\"acu-preview-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-preview-card\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-preview-title\">\n                            <i class=\"fa-solid fa-id-card\"></i>\n                            <span>${escapeHtml(title)}</span>\n                        </div>\n                        <button class=\"acu-close-btn acu-preview-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-preview-body\">\n                        ${bodyHtml || '<div style=\"text-align:center;color:var(--acu-text-sub);padding:20px;\"></div>'}\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-preview-close').click(() => overlay.remove());\n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-preview-overlay')) overlay.remove();\n    });\n  };\n\n  // \n  const showRelationshipGraph = npcTable => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n    $('.acu-relation-graph-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    const headers = npcTable.headers || [];\n    const rows = npcTable.rows || [];\n\n    const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n    const relationIdx = headers.findIndex(h => h && h.includes(''));\n    const npcTableKey = npcTable.key || '';\n\n    console.info(`[DICE]: \"${npcTableKey || ''}\"${rows.length}`);\n\n    if (relationIdx < 0) {\n      console.warn('[DICE]: \"\"');\n      if (window.toastr) window.toastr.warning('\"\"');\n      return;\n    }\n\n    const nodes = new Map();\n    const edges = [];\n\n    // {{user}}\n    const resolveUserPlaceholder = name => {\n      if (!name) return name;\n      const playerName = getPlayerName();\n      const personaName = getPersonaName();\n\n      // \n      const explicitUserVariants = ['<user>', '{{user}}'];\n      const isExplicitUserVariant = explicitUserVariants.some(\n        v => name === v || name.toLowerCase() === v.toLowerCase(),\n      );\n\n      // persona\n      const isPersonaName = personaName && name === personaName;\n\n      // \"\"\n      const isPlayerName = (() => {\n        if (!playerName) return false;\n        // \n        if (name === playerName) return true;\n        // \n        const primaryName = AvatarManager.getPrimaryName(name);\n        return primaryName === playerName;\n      })();\n\n      // {{user}}\n      if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n        return '{{user}}';\n      }\n\n      // \n      return AvatarManager.getPrimaryName(name);\n    };\n\n    const resolveName = name => resolveUserPlaceholder(name);\n\n    const rawData = cachedRawData || getTableData();\n    let playerName = '';\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]) {\n          playerName = sheet.content[1][1] || '';\n          break;\n        }\n      }\n    }\n    const resolvedPlayerName = resolveName(playerName);\n    const playerTableKey = (() => {\n      for (const k in rawData) {\n        if (rawData[k]?.name?.includes('')) return k;\n      }\n      return '';\n    })();\n    nodes.set(resolvedPlayerName, {\n      name: resolvedPlayerName,\n      isPlayer: true,\n      x: 0,\n      y: 0,\n      tableKey: playerTableKey,\n      rowIndex: 0,\n    });\n\n    // \"\"\n    const inSceneColIdx = headers.findIndex(h => h && h.includes(''));\n\n    rows.forEach((row, idx) => {\n      const rawNpcName = row[nameIdx];\n      if (!rawNpcName) return;\n\n      const npcName = resolveName(rawNpcName);\n\n      // \n      let isInScene = false;\n      if (inSceneColIdx > 0) {\n        const inSceneVal = String(row[inSceneColIdx] || '')\n          .trim()\n          .toLowerCase();\n        const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n        if (header.includes('')) {\n          isInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n        } else {\n          isInScene =\n            inSceneVal.startsWith('') || inSceneVal === 'true' || inSceneVal === '' || inSceneVal === 'yes';\n        }\n      }\n\n      if (!nodes.has(npcName)) {\n        nodes.set(npcName, {\n          name: npcName,\n          isPlayer: false,\n          x: 0,\n          y: 0,\n          tableKey: npcTableKey,\n          rowIndex: idx,\n          isInScene: isInScene,\n        });\n      }\n\n      const relationStr = row[relationIdx] || '';\n      const relations = parseRelationshipString(relationStr);\n\n      relations.forEach(rel => {\n        if (!rel.name) return;\n        const resolvedRelName = resolveName(rel.name);\n\n        if (resolvedRelName === npcName) return;\n\n        if (!nodes.has(resolvedRelName)) {\n          // NPC\n          let relRowIndex = -1;\n          for (let ri = 0; ri < rows.length; ri++) {\n            if (resolveName(rows[ri][nameIdx]) === resolvedRelName) {\n              relRowIndex = ri;\n              break;\n            }\n          }\n          nodes.set(resolvedRelName, {\n            name: resolvedRelName,\n            isPlayer: resolvedRelName === resolvedPlayerName,\n            x: 0,\n            y: 0,\n            tableKey: relRowIndex >= 0 ? npcTableKey : '',\n            rowIndex: relRowIndex >= 0 ? relRowIndex : undefined,\n          });\n        }\n\n        // /\n        const cleanRelation = rawRel => {\n          if (!rawRel) return [];\n          const parts = String(rawRel)\n            .split(/[,;\\/\\|]+|\\s*[&]\\s*|\\s{2,}|\\n/)\n            .map(s => s.trim())\n            .filter(s => s && s.length < 30); // \n\n          // \n          const commonRelations = [\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n          ];\n\n          return parts\n            .map(p => {\n              // [] \n              p = p.replace(/[(][^)]*[)]/g, '').trim();\n              // === XX/  XX ===\n              const specialSuffixMatch = p.match(/^(.+)(|)$/);\n              if (specialSuffixMatch) {\n                p = specialSuffixMatch[1]; // \"\"  \"\"\n              } else {\n                // === XXYY  YY ===\n                p = p.replace(/^[\\u4e00-\\u9fa5]{2,4}(?=[\\u4e00-\\u9fa5]{1,4}$)/, '');\n              }\n\n              // ===  ===\n              p = p.replace(/^(?:|||?|?|)/, '');\n              p = p.replace(/^(?:?|?|?|)/, '');\n              p = p.replace(/^(?:|?|?)/, '');\n\n              // ===  ===\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n\n              // ===  ===\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^(?:||?)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n\n              p = p.trim();\n\n              // === []  ===\n              if (p.length > 8) {\n                // \n                for (const rel of commonRelations) {\n                  if (p.endsWith(rel)) {\n                    return rel;\n                  }\n                }\n                // 2-4\n                const lastChars = p.slice(-4);\n                for (const rel of commonRelations) {\n                  if (lastChars.includes(rel)) {\n                    return rel;\n                  }\n                }\n                // 3\n                return p.slice(-3);\n              }\n\n              return p;\n            })\n            .filter(s => s && s.length > 0 && s.length <= 8);\n        };\n\n        const cleanedLabels = cleanRelation(rel.relation);\n        if (cleanedLabels.length === 0) cleanedLabels.push('');\n\n        // \n        let existingEdge = edges.find(\n          e =>\n            (e.source === npcName && e.target === resolvedRelName) ||\n            (e.source === resolvedRelName && e.target === npcName),\n        );\n\n        if (!existingEdge) {\n          // \n          edges.push({\n            source: npcName,\n            target: resolvedRelName,\n            // \n            labelsFromSource: cleanedLabels.slice(0, 2), // sourcetarget 2\n            labelsFromTarget: [], // targetsource \n          });\n        } else {\n          // \n          if (existingEdge.source === npcName) {\n            // npcsource labelsFromSource\n            const combined = [...(existingEdge.labelsFromSource || []), ...cleanedLabels];\n            // 2\n            existingEdge.labelsFromSource = [...new Set(combined)].slice(0, 2);\n          } else {\n            // npctarget labelsFromTarget\n            const combined = [...(existingEdge.labelsFromTarget || []), ...cleanedLabels];\n            existingEdge.labelsFromTarget = [...new Set(combined)].slice(0, 2);\n          }\n        }\n      });\n    });\n\n    const nodeArr = Array.from(nodes.values());\n    console.info(`[DICE]${nodeArr.length}${edges.length}`);\n    const centerX = 400,\n      centerY = 300;\n\n    // [] \n    const connectionCount = new Map();\n    nodeArr.forEach(node => connectionCount.set(node.name, 0));\n    edges.forEach(edge => {\n      connectionCount.set(edge.source, (connectionCount.get(edge.source) || 0) + 1);\n      connectionCount.set(edge.target, (connectionCount.get(edge.target) || 0) + 1);\n    });\n\n    // [] \n    const isMobileView = window.innerWidth <= 768;\n    const baseRadius = isMobileView ? 22 : 28;\n    const maxRadius = isMobileView ? 38 : 50;\n    const playerBaseRadius = isMobileView ? 28 : 35;\n    const radiusPerConnection = isMobileView ? 2.5 : 3.5;\n\n    //  getNodeRadius \n    let nodeSizeMultiplier = 1.0; // 1.0\n    let filterInScene = false; // +\n    let filterDirectOnly = false; // \n\n    const getNodeRadius = (nodeName, isPlayer) => {\n      const base = isPlayer ? playerBaseRadius : baseRadius;\n      const count = connectionCount.get(nodeName) || 0;\n      const calculated = Math.min(maxRadius, base + Math.sqrt(count) * radiusPerConnection);\n      // \n      return calculated * nodeSizeMultiplier;\n    };\n\n    // \n    nodeArr.forEach(node => {\n      node.radius = getNodeRadius(node.name, node.isPlayer);\n    });\n\n    // \n    const getFilteredNodes = () => {\n      // \n      if (!filterInScene && !filterDirectOnly) return nodeArr;\n\n      // \n      let directNodes: Set<string> | null = null;\n      if (filterDirectOnly) {\n        directNodes = new Set([resolvedPlayerName]);\n        edges.forEach(edge => {\n          if (edge.source === resolvedPlayerName) directNodes!.add(edge.target);\n          if (edge.target === resolvedPlayerName) directNodes!.add(edge.source);\n        });\n      }\n\n      return nodeArr.filter(n => {\n        // \n        const passInScene = !filterInScene || n.isInScene || n.isPlayer;\n        // \n        const passDirectOnly = !filterDirectOnly || directNodes!.has(n.name);\n        // \n        return passInScene && passDirectOnly;\n      });\n    };\n\n    // [Modified] \n    // ---------------------------------------------------------\n    //  ()\n    const kRepulsion = 20000; //  () - \n    const kSpring = 0.02; //  () - \n    const kGravity = 0.01; //  - \n    const idealLen = 250; //  - \n    const iterations = 300; // \n    const timeStep = 0.5; // \n    const damping = 0.8; //  ()\n\n    // \n    const LAYOUT_CACHE_KEY = 'acu-relation-graph-layout-cache';\n\n    // \n    const getLayoutCacheKey = () => {\n      const nodeNames = nodeArr\n        .map(n => n.name)\n        .sort()\n        .join('|');\n      return `${LAYOUT_CACHE_KEY}-${nodeNames}`;\n    };\n\n    // \n    const saveLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const layoutData = {};\n        nodeArr.forEach(node => {\n          layoutData[node.name] = { x: node.x, y: node.y };\n        });\n        localStorage.setItem(cacheKey, JSON.stringify(layoutData));\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const loadLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const cached = localStorage.getItem(cacheKey);\n        if (!cached) return false;\n\n        const layoutData = JSON.parse(cached);\n        let allNodesFound = true;\n\n        // \n        for (const node of nodeArr) {\n          if (!layoutData[node.name]) {\n            allNodesFound = false;\n            break;\n          }\n        }\n\n        if (allNodesFound) {\n          // \n          nodeArr.forEach(node => {\n            const cached = layoutData[node.name];\n            if (cached) {\n              node.x = cached.x;\n              node.y = cached.y;\n              node.vx = 0;\n              node.vy = 0;\n            }\n          });\n          return true;\n        }\n        return false;\n      } catch (e) {\n        console.warn('[DICE] :', e);\n        return false;\n      }\n    };\n\n    // \n    const clearLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        localStorage.removeItem(cacheKey);\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const runForceDirectedLayout = () => {\n      // \n      nodeArr.forEach(node => {\n        if (node.isPlayer) {\n          node.x = centerX;\n          node.y = centerY;\n          node.vx = 0;\n          node.vy = 0;\n        } else {\n          //  100px \n          const angle = Math.random() * 2 * Math.PI;\n          const dist = 50 + Math.random() * 100;\n          node.x = centerX + Math.cos(angle) * dist;\n          node.y = centerY + Math.sin(angle) * dist;\n          node.vx = 0;\n          node.vy = 0;\n        }\n      });\n\n      //  O(1) \n      const nodeMap = new Map();\n      nodeArr.forEach(n => nodeMap.set(n.name, n));\n\n      //  ()\n      for (let iter = 0; iter < iterations; iter++) {\n        // 1.  ( vs )\n        for (let i = 0; i < nodeArr.length; i++) {\n          const u = nodeArr[i];\n          for (let j = i + 1; j < nodeArr.length; j++) {\n            const v = nodeArr[j];\n            const dx = v.x - u.x;\n            const dy = v.y - u.y;\n            let distSq = dx * dx + dy * dy;\n            if (distSq < 1) distSq = 1; // \n\n            const dist = Math.sqrt(distSq);\n            const force = kRepulsion / distSq;\n\n            const fx = (dx / dist) * force;\n            const fy = (dy / dist) * force;\n\n            if (!u.isPlayer) {\n              u.vx -= fx;\n              u.vy -= fy;\n            }\n            if (!v.isPlayer) {\n              v.vx += fx;\n              v.vy += fy;\n            }\n          }\n        }\n\n        // 2.  ()\n        edges.forEach(edge => {\n          const u = nodeMap.get(edge.source);\n          const v = nodeMap.get(edge.target);\n          if (!u || !v) return;\n\n          const dx = v.x - u.x;\n          const dy = v.y - u.y;\n          const dist = Math.sqrt(dx * dx + dy * dy) || 1;\n\n          // : F = k * ( - )\n          const force = (dist - idealLen) * kSpring;\n\n          const fx = (dx / dist) * force;\n          const fy = (dy / dist) * force;\n\n          if (!u.isPlayer) {\n            u.vx += fx;\n            u.vy += fy;\n          }\n          if (!v.isPlayer) {\n            v.vx -= fx;\n            v.vy -= fy;\n          }\n        });\n\n        // 3.  ()\n        nodeArr.forEach(node => {\n          if (node.isPlayer) return;\n          const dx = centerX - node.x;\n          const dy = centerY - node.y;\n          node.vx += dx * kGravity;\n          node.vy += dy * kGravity;\n        });\n\n        // 4. \n        // \n        const maxSpeed = 50 * (1 - iter / iterations); // \n\n        nodeArr.forEach(node => {\n          if (node.isPlayer) return; //  ()\n\n          // \n          node.vx *= damping;\n          node.vy *= damping;\n\n          // \n          const vMag = Math.sqrt(node.vx * node.vx + node.vy * node.vy);\n          if (vMag > maxSpeed) {\n            node.vx = (node.vx / vMag) * maxSpeed;\n            node.vy = (node.vy / vMag) * maxSpeed;\n          }\n\n          node.x += node.vx * timeStep;\n          node.y += node.vy * timeStep;\n        });\n      }\n\n      // \n      saveLayoutCache();\n    };\n\n    // \n    if (!loadLayoutCache()) {\n      // \n      runForceDirectedLayout();\n    }\n\n    // \n    let scale = 1;\n    let panX = 0;\n    let panY = 0;\n    const minScale = 0.3;\n    const maxScale = 4;\n\n    const overlay = $(`\n            <div class=\"acu-relation-graph-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-relation-graph-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-graph-title\">\n                            <i class=\"fa-solid fa-project-diagram\"></i>\n                            <button class=\"acu-graph-btn acu-filter-toggle\" id=\"filter-in-scene\" title=\"\" style=\"margin-left:8px;padding:4px 6px;font-size:12px;\"><i class=\"fa-solid fa-map-marker-alt\"></i></button>\n                            <button class=\"acu-graph-btn acu-filter-toggle\" id=\"filter-direct-only\" title=\"\" style=\"padding:4px 6px;font-size:12px;\"><i class=\"fa-solid fa-link\"></i></button>\n                        </div>\n                        <div class=\"acu-graph-actions\">\n                            <button class=\"acu-graph-btn\" id=\"graph-relayout\" title=\"\"><i class=\"fa-solid fa-sync\"></i></button>\n                            <button class=\"acu-graph-btn\" id=\"graph-manage-avatar\" title=\"\"><i class=\"fa-solid fa-user-circle\"></i></button>\n                            <button class=\"acu-graph-btn acu-graph-close\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-canvas-wrapper\">\n                        <svg class=\"acu-graph-svg\" viewBox=\"0 0 800 600\">\n                            <defs>\n                                <marker id=\"arrowhead-end\" markerWidth=\"6\" markerHeight=\"5\" refX=\"5\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 6 2.5, 0 5\" fill=\"${t.textSub}\" />\n                                </marker>\n                                <marker id=\"arrowhead-start\" markerWidth=\"6\" markerHeight=\"5\" refX=\"1\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"6 0, 0 2.5, 6 5\" fill=\"${t.textSub}\" />\n                                </marker>\n                                <marker id=\"arrowhead-end-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"6\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 7 3, 0 6\" fill=\"${t.accent}\" />\n                                </marker>\n                                <marker id=\"arrowhead-start-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"1\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"7 0, 0 3, 7 6\" fill=\"${t.accent}\" />\n                                </marker>\n                            </defs>\n                            <g class=\"acu-graph-transform\">\n                                <g class=\"acu-graph-edges\"></g>\n                                <g class=\"acu-graph-nodes\"></g>\n                            </g>\n                        </svg>\n                        <div class=\"acu-node-size-slider-container\" style=\"\n                            position: absolute;\n                            display: none;\n                            width: 200px;\n                            padding: 10px;\n                            background: ${t.bgPanel};\n                            border: 1px solid ${t.border};\n                            border-radius: 8px;\n                            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n                            z-index: 10;\n                        \">\n                            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:6px;\">\n                                <span style=\"font-size:11px;color:${t.textSub};white-space:nowrap;\"></span>\n                                <span id=\"slider-size-display\" style=\"font-size:11px;color:${t.accent};font-weight:bold;min-width:35px;text-align:right;\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                            </div>\n                            <input type=\"range\" id=\"node-size-slider\" min=\"0.5\" max=\"2.0\" step=\"0.1\" value=\"${nodeSizeMultiplier}\" style=\"\n                                width: 100%;\n                                height: 8px;\n                                border-radius: 4px;\n                                background: ${t.btnBg};\n                                outline: none;\n                                cursor: pointer;\n                                -webkit-appearance: none;\n                            \" />\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-legend\">\n                        <button class=\"acu-graph-btn\" id=\"graph-zoom-reset\" title=\"\" style=\"width:auto;height:auto;padding:4px 10px;font-size:11px;display:flex;align-items:center;gap:4px;\"><i class=\"fa-solid fa-compress-arrows-alt\"></i><span></span></button>\n                        <div class=\"acu-node-size-stepper-wrapper\" style=\"display:flex;align-items:center;justify-content:center;gap:6px;\">\n                            <span style=\"font-size:11px;color:var(--acu-text-sub);white-space:nowrap;\">:</span>\n                            <div class=\"acu-stepper\" data-id=\"graph-node-size\" data-min=\"50\" data-max=\"200\" data-step=\"10\" style=\"display:flex;align-items:center;\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\" id=\"node-size-display\" style=\"display:flex;align-items:center;justify-content:center;\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <span class=\"acu-zoom-display\" style=\"display:flex;align-items:center;gap:4px;color:var(--acu-text-sub);font-size:11px;\">\n                            <span>:</span>\n                            <span>${Math.round(scale * 100)}%</span>\n                        </span>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const $svg = overlay.find('.acu-graph-svg');\n    const $transform = overlay.find('.acu-graph-transform');\n    const $edgesGroup = overlay.find('.acu-graph-edges');\n    const $nodesGroup = overlay.find('.acu-graph-nodes');\n    const $zoomDisplay = overlay.find('.acu-zoom-display span:last-child');\n    const $nodeSizeDisplay = overlay.find('#node-size-display');\n    const $wrapper = overlay.find('.acu-graph-canvas-wrapper');\n\n    const updateTransform = () => {\n      $transform.attr('transform', `translate(${panX}, ${panY}) scale(${scale})`);\n      $zoomDisplay.text(`${Math.round(scale * 100)}%`);\n    };\n\n    const updateNodeSizeDisplay = () => {\n      if ($nodeSizeDisplay.length) {\n        $nodeSizeDisplay.text(`${Math.round(nodeSizeMultiplier * 100)}%`);\n      }\n    };\n\n    const zoomTo = (newScale, centerX = 400, centerY = 300) => {\n      const oldScale = scale;\n      scale = Math.max(minScale, Math.min(maxScale, newScale));\n      const scaleChange = scale / oldScale;\n      panX = centerX - (centerX - panX) * scaleChange;\n      panY = centerY - (centerY - panY) * scaleChange;\n      updateTransform();\n    };\n\n    const render = async () => {\n      // \n      const filteredNodes = getFilteredNodes();\n      const filteredNodeNames = new Set(filteredNodes.map(n => n.name));\n\n      // \n      const filteredEdges = edges.filter(\n        edge => filteredNodeNames.has(edge.source) && filteredNodeNames.has(edge.target),\n      );\n\n      let edgesHtml = '';\n      filteredEdges.forEach((edge, edgeIdx) => {\n        const source = nodes.get(edge.source);\n        const target = nodes.get(edge.target);\n        if (!source || !target) return;\n\n        // \n        const dx = target.x - source.x;\n        const dy = target.y - source.y;\n        const len = Math.sqrt(dx * dx + dy * dy) || 1;\n        const nx = dx / len; // \n        const ny = dy / len;\n\n        // \n        const px = -ny;\n        const py = nx;\n\n        // \n        const hasFromSource =\n          edge.labelsFromSource && edge.labelsFromSource.length > 0 && edge.labelsFromSource.some(l => l);\n        const hasFromTarget =\n          edge.labelsFromTarget && edge.labelsFromTarget.length > 0 && edge.labelsFromTarget.some(l => l);\n\n        // \n        const sourceRadius = source.radius || 28;\n        const targetRadius = target.radius || 28;\n        const arrowGap = 10; // \n        const x1 = source.x + nx * (sourceRadius + arrowGap);\n        const y1 = source.y + ny * (sourceRadius + arrowGap);\n        const x2 = target.x - nx * (targetRadius + arrowGap);\n        const y2 = target.y - ny * (targetRadius + arrowGap);\n\n        // \n        let srcLabels = (edge.labelsFromSource || []).filter(l => l);\n        let tgtLabels = (edge.labelsFromTarget || []).filter(l => l);\n\n        // \n        const srcSet = new Set(srcLabels);\n        const tgtSet = new Set(tgtLabels);\n        const commonLabels = [...srcSet].filter(l => tgtSet.has(l));\n\n        // \n        const srcUnique = srcLabels.filter(l => !commonLabels.includes(l));\n        const tgtUnique = tgtLabels.filter(l => !commonLabels.includes(l));\n\n        // \n        let markerStart = '';\n        let markerEnd = '';\n        if (hasFromSource) markerEnd = 'url(#arrowhead-end)';\n        if (hasFromTarget) markerStart = 'url(#arrowhead-start)';\n\n        edgesHtml += `<line class=\"acu-graph-edge\" x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                    ${markerEnd ? `marker-end=\"${markerEnd}\"` : ''}\n                    ${markerStart ? `marker-start=\"${markerStart}\"` : ''}\n                    data-edge-idx=\"${edgeIdx}\" />`;\n\n        // \n        const midX = (source.x + target.x) / 2;\n        const midY = (source.y + target.y) / 2;\n\n        // \n        const lineLen = Math.sqrt(dx * dx + dy * dy);\n\n        // \"\"\n        const isBidirectional = hasFromSource && hasFromTarget;\n        const isBidirectionalSame =\n          isBidirectional && commonLabels.length > 0 && srcUnique.length === 0 && tgtUnique.length === 0;\n\n        // \n        if (isBidirectionalSame) {\n          // \n          commonLabels.slice(0, 2).forEach((lbl, i) => {\n            if (!lbl) return;\n            const offsetDir = i === 0 ? 1 : -1;\n            const offsetDist = 6 + i * 10;\n            const lx = midX + px * offsetDir * offsetDist;\n            const ly = midY + py * offsetDir * offsetDist;\n            edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(lbl)}</text>`;\n          });\n        } else {\n          // \n          // source/target\n          // 25%\n          const safeOffset = Math.max(30, Math.min(lineLen * 0.25, 60));\n\n          // Emoji\n          const relationEmojiMap = [\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', ''] },\n          ];\n\n          // Emoji\n          const addRelationEmoji = lbl => {\n            if (!lbl) return '';\n            for (const group of relationEmojiMap) {\n              for (const kw of group.keywords) {\n                if (lbl.includes(kw)) {\n                  return lbl + group.emoji;\n                }\n              }\n            }\n            return lbl;\n          };\n\n          // emoji\n          const truncateLabel = (lbl, maxLen = 4) => {\n            if (!lbl) return '';\n            const truncated = lbl.length > maxLen ? lbl.substring(0, maxLen) + '..' : lbl;\n            return addRelationEmoji(truncated);\n          };\n\n          // 1. \n          if (commonLabels.length > 0) {\n            commonLabels.slice(0, 1).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const lx = midX + px * 8;\n              const ly = midY + py * 8 - 3;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n\n          // 2. Sourcesource\n          if (srcUnique.length > 0 || (hasFromSource && !hasFromTarget && commonLabels.length === 0)) {\n            const labelsToShow = srcUnique.length > 0 ? srcUnique : srcLabels;\n            // source\n            const labelBaseX = midX - nx * safeOffset;\n            const labelBaseY = midY - ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? 1 : -1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n\n          // 3. Targettarget\n          if (tgtUnique.length > 0 || (hasFromTarget && !hasFromSource && commonLabels.length === 0)) {\n            const labelsToShow = tgtUnique.length > 0 ? tgtUnique : tgtLabels;\n            // target\n            const labelBaseX = midX + nx * safeOffset;\n            const labelBaseY = midY + ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? -1 : 1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n        }\n      });\n      $edgesGroup.html(edgesHtml);\n\n      // [] \n      let nodesHtml = '';\n      for (const node of filteredNodes) {\n        //  > URL > ST\n        const nodeAvatar = await AvatarManager.getAsync(node.name);\n        const isPlayer = node.isPlayer;\n\n        // \n        const indicatorRadius = node.radius * 0.28;\n        const indicatorOffset = node.radius * 0.65;\n        const inSceneIndicator = node.isInScene\n          ? `<circle class=\"acu-node-inscene-indicator\" cx=\"${-indicatorOffset}\" cy=\"${-indicatorOffset}\" r=\"${indicatorRadius}\" style=\"fill:var(--acu-accent);stroke:var(--acu-bg-panel);stroke-width:2;\" />`\n          : '';\n\n        const nodeDisplayName = replaceUserPlaceholders(node.name);\n        nodesHtml += `\n                <g class=\"acu-graph-node acu-dash-preview-trigger\" data-name=\"${escapeHtml(node.name)}\" data-table-key=\"${node.tableKey || ''}\" data-row-index=\"${node.rowIndex !== undefined ? node.rowIndex : ''}\" transform=\"translate(${node.x}, ${node.y})\">\n                    <circle class=\"acu-node-bg\" r=\"${node.radius}\" />\n                    ${\n                      nodeAvatar\n                        ? (() => {\n                            const offsetX = AvatarManager.getOffsetX(node.name);\n                            const offsetY = AvatarManager.getOffsetY(node.name);\n                            const scaleVal = AvatarManager.getScale(node.name);\n                            const size = (node.radius - 2) * 2;\n                            return `<foreignObject x=\"${-size / 2}\" y=\"${-size / 2}\" width=\"${size}\" height=\"${size}\">\n                            <div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"\n                                width: ${size}px;\n                                height: ${size}px;\n                                border-radius: 50%;\n                                background-image: url('${nodeAvatar}');\n                                background-size: ${scaleVal}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                                background-repeat: no-repeat;\n                            \"></div>\n                        </foreignObject>`;\n                          })()\n                        : `<text class=\"acu-node-char\" dy=\"0.35em\">${escapeHtml(nodeDisplayName.charAt(0))}</text>`\n                    }\n                    ${inSceneIndicator}\n                    <text class=\"acu-node-label\" dy=\"${node.radius + 14}\">${escapeHtml(nodeDisplayName)}</text>\n                </g>\n            `;\n      }\n      $nodesGroup.html(nodesHtml);\n    };\n\n    // [] \n    const highlightNode = nodeName => {\n      $svg.addClass('highlighting');\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if ($(this).data('name') === nodeName) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedNodes = new Set([nodeName]);\n\n      // \n      edges.forEach(edge => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          const otherNode = edge.source === nodeName ? edge.target : edge.source;\n          connectedNodes.add(otherNode);\n        }\n      });\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if (connectedNodes.has($(this).data('name'))) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedEdgeIndices = new Set();\n      edges.forEach((edge, idx) => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          connectedEdgeIndices.add(idx);\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n          if ($(this).attr('marker-end')) {\n            $(this).attr('marker-end', 'url(#arrowhead-end-hl)');\n          }\n          if ($(this).attr('marker-start')) {\n            $(this).attr('marker-start', 'url(#arrowhead-start-hl)');\n          }\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge-label').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n        }\n      });\n    };\n\n    const clearHighlight = () => {\n      $svg.removeClass('highlighting');\n      $nodesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        if ($(this).attr('marker-end')) {\n          $(this).attr('marker-end', 'url(#arrowhead-end)');\n        }\n        if ($(this).attr('marker-start')) {\n          $(this).attr('marker-start', 'url(#arrowhead-start)');\n        }\n      });\n    };\n\n    // []  - PC +  + \n    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n\n    // \n    let currentHighlightedNode = null; // \n    let longPressTimer = null;\n\n    if (isTouchDevice) {\n      // ==========  ==========\n      let currentHighlightedNode = null;\n\n      $nodesGroup.on('pointerdown', '.acu-graph-node', function (e) {\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        const startX = e.clientX;\n        const startY = e.clientY;\n        const startTime = Date.now();\n        let hasMoved = false;\n        let longPressTriggered = false;\n\n        // \n        if (currentHighlightedNode) {\n          clearHighlight();\n          currentHighlightedNode = null;\n          // return\n          e.preventDefault();\n          e.stopPropagation();\n          return;\n        }\n\n        // \n        const longPressTimer = setTimeout(() => {\n          if (!hasMoved && nodeName) {\n            longPressTriggered = true;\n            currentHighlightedNode = nodeName;\n            highlightNode(nodeName);\n            if (navigator.vibrate) navigator.vibrate(30);\n          }\n        }, 300);\n\n        const onMove = moveE => {\n          const dx = Math.abs(moveE.clientX - startX);\n          const dy = Math.abs(moveE.clientY - startY);\n          if (dx > 8 || dy > 8) {\n            hasMoved = true;\n            clearTimeout(longPressTimer);\n          }\n        };\n\n        const onUp = () => {\n          $(document).off('pointermove.mobilenode pointerup.mobilenode pointercancel.mobilenode');\n          clearTimeout(longPressTimer);\n\n          const elapsed = Date.now() - startTime;\n\n          //   \n          if (longPressTriggered) {\n            return;\n          }\n\n          //   \n          if (hasMoved) {\n            return;\n          }\n\n          // <300ms  \n          if (elapsed < 300) {\n            const tableKey = $node.data('table-key');\n            const rowIndex = $node.data('row-index');\n\n            if (tableKey && rowIndex !== '' && rowIndex !== undefined) {\n              const rawData = cachedRawData || getTableData();\n              if (rawData && rawData[tableKey]) {\n                const sheet = rawData[tableKey];\n                const headers = sheet.content ? sheet.content[0] : [];\n                const row = sheet.content ? sheet.content[parseInt(rowIndex, 10) + 1] : null;\n                if (row) {\n                  showPreviewCard(sheet.name || '', headers, row, parseInt(rowIndex, 10), tableKey);\n                }\n              }\n            }\n          }\n        };\n\n        $(document).on('pointermove.mobilenode', onMove);\n        $(document).on('pointerup.mobilenode pointercancel.mobilenode', onUp);\n      });\n\n      // \n      $wrapper.on('pointerup.mobileclear', function (e) {\n        if (currentHighlightedNode && !$(e.target).closest('.acu-graph-node').length) {\n          clearHighlight();\n          currentHighlightedNode = null;\n        }\n      });\n    } else {\n      // ========== PC ==========\n\n      $nodesGroup.on('pointerenter.pchover', '.acu-graph-node', function () {\n        const nodeName = $(this).data('name');\n        if (nodeName) {\n          highlightNode(nodeName);\n        }\n      });\n\n      $nodesGroup.on('pointerleave.pchover', '.acu-graph-node', function () {\n        clearHighlight();\n      });\n\n      // PC\n      $nodesGroup.on('click.pcclick', '.acu-graph-node', function (e) {\n        e.stopPropagation();\n        const $node = $(this);\n        const tableKey = $node.data('table-key');\n        const rowIndex = $node.data('row-index');\n\n        if (tableKey && rowIndex !== '' && rowIndex !== undefined) {\n          const rawData = cachedRawData || getTableData();\n          if (rawData && rawData[tableKey]) {\n            const sheet = rawData[tableKey];\n            const headers = sheet.content ? sheet.content[0] : [];\n            const row = sheet.content ? sheet.content[parseInt(rowIndex, 10) + 1] : null;\n            if (row) {\n              showPreviewCard(sheet.name || '', headers, row, parseInt(rowIndex, 10), tableKey);\n            }\n          }\n        }\n      });\n    }\n\n    // \n    render().then(() => {\n      updateTransform();\n    });\n\n    //  -  Pointer Events API\n    let isPanning = false;\n    let panStartX = 0,\n      panStartY = 0;\n    let panStartPanX = 0,\n      panStartPanY = 0;\n    let lastPinchDist = 0;\n    let activePointerId = null;\n\n    const wrapperEl = $wrapper[0];\n    const svgEl = $svg[0];\n\n    // Pointer Down - \n    wrapperEl.onpointerdown = function (e) {\n      if (e.button !== 0) return;\n      // [] \n      if ($(e.target).closest('.acu-graph-node').length) return;\n      // [] \n      if ($(e.target).closest('.acu-node-size-slider-container').length) return;\n      e.preventDefault();\n      wrapperEl.setPointerCapture(e.pointerId);\n      activePointerId = e.pointerId;\n      isPanning = true;\n      panStartX = e.clientX;\n      panStartY = e.clientY;\n      panStartPanX = panX;\n      panStartPanY = panY;\n      svgEl.style.cursor = 'grabbing';\n    };\n\n    // Pointer Move - \n    wrapperEl.onpointermove = function (e) {\n      if (!isPanning || e.pointerId !== activePointerId) return;\n      const dx = e.clientX - panStartX;\n      const dy = e.clientY - panStartY;\n      const rect = svgEl.getBoundingClientRect();\n      panX = panStartPanX + (dx / rect.width) * 800;\n      panY = panStartPanY + (dy / rect.height) * 600;\n      updateTransform();\n    };\n\n    // Pointer Up - \n    wrapperEl.onpointerup = function (e) {\n      if (e.pointerId === activePointerId) {\n        wrapperEl.releasePointerCapture(e.pointerId);\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // Pointer Cancel - \n    wrapperEl.onpointercancel = function (e) {\n      if (e.pointerId === activePointerId) {\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // \n    wrapperEl.onwheel = function (e) {\n      e.preventDefault();\n      const delta = e.deltaY > 0 ? -0.15 : 0.15;\n      zoomTo(scale + delta);\n    };\n\n    // \n    wrapperEl.addEventListener(\n      'touchstart',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          isPanning = false;\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener(\n      'touchmove',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            zoomTo(scale * (newDist / lastPinchDist));\n          }\n          lastPinchDist = newDist;\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener('touchend', function (e) {\n      if (e.touches.length < 2) lastPinchDist = 0;\n    });\n\n    // \n    const cleanupEvents = () => {\n      wrapperEl.onpointerdown = null;\n      wrapperEl.onpointermove = null;\n      wrapperEl.onpointerup = null;\n      wrapperEl.onpointercancel = null;\n      wrapperEl.onwheel = null;\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n      $(document).off('click.slider-hide');\n    };\n\n    // \n    const $nodeSizeSlider = overlay.find('#node-size-slider');\n    const $sliderSizeDisplay = overlay.find('#slider-size-display');\n    const $sliderContainer = overlay.find('.acu-node-size-slider-container');\n    const $nodeSizeDisplayTrigger = overlay.find('#node-size-display-trigger');\n    const $legend = overlay.find('.acu-graph-legend');\n\n    let sliderVisible = false;\n    let sliderHideTimer: ReturnType<typeof setTimeout> | null = null;\n    const SLIDER_AUTO_HIDE_DELAY = 4000; // 4\n\n    // \n    const showSlider = () => {\n      if (sliderVisible) return;\n\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = true;\n\n      // \"\"wrappertriggerlegendlegendwrapper\n      // getBoundingClientRectviewport\n      const triggerRect = $nodeSizeDisplayTrigger[0].getBoundingClientRect();\n      const wrapperRect = $wrapper[0].getBoundingClientRect();\n\n      // wrappertrigger\n      const sliderHeight = 60; // \n      const top = wrapperRect.height - sliderHeight - 10; // wrapper\n      const left = triggerRect.left - wrapperRect.left;\n\n      $sliderContainer.css({\n        display: 'block',\n        top: `${top}px`,\n        left: `${left}px`,\n      });\n\n      // \n      resetSliderHideTimer();\n    };\n\n    // \n    const hideSlider = () => {\n      if (!sliderVisible) return;\n\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = false;\n      $sliderContainer.hide();\n    };\n\n    // \n    const resetSliderHideTimer = () => {\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n      }\n      sliderHideTimer = setTimeout(() => {\n        hideSlider();\n      }, SLIDER_AUTO_HIDE_DELAY);\n    };\n\n    // \"\"/\n    overlay.on('click', '#node-size-display-trigger, #node-size-display-trigger *', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        hideSlider();\n      } else {\n        showSlider();\n      }\n    });\n\n    // \n    $nodeSizeSlider.on('input mousedown touchstart', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        resetSliderHideTimer();\n      }\n    });\n\n    // \n    $sliderContainer.on('pointerdown mousedown touchstart', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $(document).on('click.slider-hide', function (e) {\n      if (\n        sliderVisible &&\n        !$sliderContainer.is(e.target) &&\n        $sliderContainer.has(e.target).length === 0 &&\n        !$nodeSizeDisplayTrigger.is(e.target) &&\n        $nodeSizeDisplayTrigger.has(e.target).length === 0\n      ) {\n        hideSlider();\n      }\n    });\n\n    $nodeSizeSlider.on('input', function () {\n      nodeSizeMultiplier = parseFloat($(this).val());\n      $sliderSizeDisplay.text(Math.round(nodeSizeMultiplier * 100) + '%');\n      updateNodeSizeDisplay();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n      render();\n\n      // \n      resetSliderHideTimer();\n    });\n\n    //  toggle \n    const $filterInSceneBtn = overlay.find('#filter-in-scene');\n    const $filterDirectOnlyBtn = overlay.find('#filter-direct-only');\n\n    const updateFilterToggleStyles = () => {\n      $filterInSceneBtn.css({\n        background: filterInScene ? t.accent : t.btnBg,\n        color: filterInScene ? t.btnActiveText : t.textMain,\n        borderColor: filterInScene ? t.accent : t.border,\n      });\n      $filterDirectOnlyBtn.css({\n        background: filterDirectOnly ? t.accent : t.btnBg,\n        color: filterDirectOnly ? t.btnActiveText : t.textMain,\n        borderColor: filterDirectOnly ? t.accent : t.border,\n      });\n    };\n\n    // \n    updateFilterToggleStyles();\n\n    $filterInSceneBtn.click(function (e) {\n      e.stopPropagation();\n      filterInScene = !filterInScene;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    $filterDirectOnlyBtn.click(function (e) {\n      e.stopPropagation();\n      filterDirectOnly = !filterDirectOnly;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    //  +  + \n    overlay.find('#graph-zoom-reset').click(() => {\n      // \n      scale = 1;\n      panX = 0;\n      panY = 0;\n      updateTransform();\n\n      // \n      nodeSizeMultiplier = 1.0;\n      $nodeSizeSlider.val(1.0);\n      $sliderSizeDisplay.text('100%');\n      updateNodeSizeDisplay();\n\n      // stepper\n      const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n      if ($nodeSizeStepper.length) {\n        $nodeSizeStepper.find('.acu-stepper-value').text('100%');\n      }\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      if (!loadLayoutCache()) {\n        // \n        runForceDirectedLayout();\n      }\n      render();\n    });\n\n    // Stepper  - \n    const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n    if ($nodeSizeStepper.length) {\n      const min = parseInt($nodeSizeStepper.data('min')); // 50\n      const max = parseInt($nodeSizeStepper.data('max')); // 200\n      const step = parseInt($nodeSizeStepper.data('step')); // 10\n      const $value = $nodeSizeStepper.find('.acu-stepper-value');\n\n      const updateNodeSizeValue = (newPercent: number) => {\n        newPercent = Math.max(min, Math.min(max, newPercent));\n        nodeSizeMultiplier = newPercent / 100; //  (0.5-2.0)\n        $value.text(`${newPercent}%`);\n        updateNodeSizeDisplay();\n\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      };\n\n      const getCurrentPercent = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || 100;\n      };\n\n      $nodeSizeStepper.find('.acu-stepper-dec').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() - step);\n      });\n\n      $nodeSizeStepper.find('.acu-stepper-inc').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() + step);\n      });\n    }\n\n    // \n    overlay.find('#graph-relayout').click(() => {\n      // \n      clearLayoutCache();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      runForceDirectedLayout();\n      render();\n    });\n\n    overlay.find('#graph-manage-avatar').click(() => {\n      // \n      showAvatarManager(nodeArr, () => {\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      });\n    });\n\n    const closeGraph = () => {\n      cleanupEvents();\n      overlay.remove();\n    };\n    overlay.find('.acu-graph-close').click(closeGraph);\n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-relation-graph-overlay')) closeGraph();\n    });\n  };\n  // ========================================\n  //  - PC/\n  // ========================================\n\n  const showAvatarCropModal = (imageSource, characterName, onSave) => {\n    const { $ } = getCore();\n    $('.acu-crop-modal-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // \n    let scale = 150;\n    let offsetX = 50;\n    let offsetY = 50;\n\n    // \n    const existing = AvatarManager.getAll()[characterName];\n    if (existing) {\n      scale = existing.scale ?? 150;\n      offsetX = existing.offsetX ?? 50;\n      offsetY = existing.offsetY ?? 50;\n    }\n\n    const modalHtml = `\n            <div class=\"acu-crop-modal-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-crop-modal\">\n                    <div class=\"acu-crop-header\">\n                        <span><i class=\"fa-solid fa-crop-simple\"></i>  - ${escapeHtml(characterName)}</span>\n                        <button class=\"acu-crop-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-crop-body\">\n                        <div class=\"acu-crop-container\">\n                            <div class=\"acu-crop-image\" style=\"\n                                background-image: url('${imageSource}');\n                                background-size: ${scale}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                            \"></div>\n                            <div class=\"acu-crop-mask\"></div>\n                        </div>\n                        <div class=\"acu-crop-hint\">  /</div>\n                    </div>\n                    <div class=\"acu-crop-footer\">\n                        <label class=\"acu-crop-btn acu-crop-reupload\" title=\"\">\n                            <i class=\"fa-solid fa-camera\"></i>\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-crop-file-input\" style=\"display:none;\" />\n                        </label>\n                        <button class=\"acu-crop-btn acu-crop-cancel\"></button>\n                        <button class=\"acu-crop-btn acu-crop-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      'z-index': '2147483658',\n    });\n\n    const $image = $modal.find('.acu-crop-image');\n    const $container = $modal.find('.acu-crop-container');\n    const containerEl = $container[0];\n    const imageEl = $image[0];\n\n    // \n    const updateImageStyle = () => {\n      imageEl.style.backgroundSize = `${scale}%`;\n      imageEl.style.backgroundPosition = `${offsetX}% ${offsetY}%`;\n    };\n\n    // ===  Pointer Events  ===\n    let isDragging = false;\n    let startX = 0,\n      startY = 0;\n    let startOffsetX = 0,\n      startOffsetY = 0;\n    let activePointerId = null;\n\n    imageEl.addEventListener('pointerdown', e => {\n      // \n      if (activePointerId !== null) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      isDragging = true;\n      activePointerId = e.pointerId;\n      startX = e.clientX;\n      startY = e.clientY;\n      startOffsetX = offsetX;\n      startOffsetY = offsetY;\n\n      imageEl.setPointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grabbing';\n    });\n\n    imageEl.addEventListener('pointermove', e => {\n      if (!isDragging || e.pointerId !== activePointerId) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      const deltaX = e.clientX - startX;\n      const deltaY = e.clientY - startY;\n\n      // \n      const sensitivity = 100 / scale;\n      offsetX = Math.max(0, Math.min(100, startOffsetX - deltaX * sensitivity));\n      offsetY = Math.max(0, Math.min(100, startOffsetY - deltaY * sensitivity));\n      updateImageStyle();\n    });\n\n    imageEl.addEventListener('pointerup', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.releasePointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grab';\n    });\n\n    imageEl.addEventListener('pointercancel', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.style.cursor = 'grab';\n    });\n\n    // ===  ===\n    // \n    containerEl.addEventListener(\n      'wheel',\n      e => {\n        e.preventDefault();\n        e.stopPropagation();\n        const delta = e.deltaY > 0 ? -10 : 10;\n        scale = Math.max(100, Math.min(300, scale + delta));\n        updateImageStyle();\n      },\n      { passive: false },\n    );\n\n    // \n    let lastPinchDist = 0;\n    let pinchStartScale = scale;\n\n    containerEl.addEventListener(\n      'touchstart',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          pinchStartScale = scale;\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener(\n      'touchmove',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            const pinchRatio = newDist / lastPinchDist;\n            scale = Math.max(100, Math.min(300, pinchStartScale * pinchRatio));\n            updateImageStyle();\n          }\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener('touchend', e => {\n      if (e.touches.length < 2) {\n        lastPinchDist = 0;\n        pinchStartScale = scale;\n      }\n    });\n\n    // ===  ===\n    // \n    $modal.find('.acu-crop-file-input').on('change', async function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      if (!file.type.startsWith('image/')) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        if (window.toastr) window.toastr.warning(' 5MB');\n        return;\n      }\n\n      try {\n        // \n        const success = await AvatarManager.saveLocalAvatar(characterName, file);\n        if (success) {\n          //  URL \n          const newUrl = await LocalAvatarDB.get(characterName);\n          imageSource = newUrl;\n\n          // \n          scale = 150;\n          offsetX = 50;\n          offsetY = 50;\n\n          // \n          $image.css('background-image', `url('${newUrl}')`);\n          updateImageStyle();\n        }\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n\n      $(this).val('');\n    });\n    $modal.find('.acu-crop-close, .acu-crop-cancel').on('click', () => {\n      $modal.remove();\n    });\n\n    $modal.find('.acu-crop-confirm').on('click', () => {\n      onSave({ scale, offsetX, offsetY });\n      $modal.remove();\n    });\n\n    // \n    $modal.on('click', e => {\n      if ($(e.target).hasClass('acu-crop-modal-overlay')) {\n        $modal.remove();\n      }\n    });\n  };\n  //  - \n  const showAvatarManager = (nodeArr, onUpdate) => {\n    const { $ } = getCore();\n    $('.acu-avatar-manager-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const avatars = AvatarManager.getAll();\n\n    // {{user}}\n    const resolveUserPlaceholderForAvatar = name => {\n      if (!name) return name;\n      const playerName = getPlayerName();\n      const personaName = getPersonaName();\n\n      // \n      const explicitUserVariants = ['<user>', '{{user}}'];\n      const isExplicitUserVariant = explicitUserVariants.some(\n        v => name === v || name.toLowerCase() === v.toLowerCase(),\n      );\n\n      // persona\n      const isPersonaName = personaName && name === personaName;\n\n      // \"\"\n      const isPlayerName = (() => {\n        if (!playerName) return false;\n        // \n        if (name === playerName) return true;\n        // \n        const primaryName = AvatarManager.getPrimaryName(name);\n        return primaryName === playerName;\n      })();\n\n      // {{user}}\n      if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n        return '{{user}}';\n      }\n\n      // \n      return AvatarManager.getPrimaryName(name);\n    };\n\n    // \n    const buildList = async () => {\n      let listHtml = '';\n\n      // {{user}}\n      const userNode = nodeArr.find(n => {\n        const resolved = resolveUserPlaceholderForAvatar(n.name);\n        return resolved === '{{user}}';\n      });\n      const otherNodes = nodeArr.filter(n => {\n        const resolved = resolveUserPlaceholderForAvatar(n.name);\n        return resolved !== '{{user}}';\n      });\n\n      // {{user}}\n      if (userNode) {\n        // {{user}}'{{user}}'\n        const userNodeForDisplay = {\n          ...userNode,\n          name: '{{user}}', // {{user}}\n        };\n\n        const data = avatars[userNodeForDisplay.name] || {};\n        let currentUrl = data.url || '';\n\n        // \n        const hasLocal = await AvatarManager.hasLocalAvatar(userNodeForDisplay.name);\n        let displayUrl = '';\n        let sourceLabel = '';\n\n        if (hasLocal) {\n          displayUrl = await LocalAvatarDB.get(userNodeForDisplay.name);\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n        } else if (currentUrl) {\n          displayUrl = currentUrl;\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n        }\n\n        const aliases = (data.aliases || []).join(', ');\n        const hasAvatar = !!displayUrl;\n\n        listHtml += `\n                    <div class=\"acu-avatar-item\" data-name=\"${escapeHtml(userNodeForDisplay.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <div class=\"acu-avatar-preview-wrap\">\n                            <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" style=\"${hasAvatar ? `background-image: url('${displayUrl}'); background-position: ${data.offsetX ?? 50}% ${data.offsetY ?? 50}%; background-size: ${data.scale ?? 150}%;` : ''}\">\n                                ${!hasAvatar ? `<span>${escapeHtml(userNodeForDisplay.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                            </div>\n                            ${sourceLabel}\n                        </div>\n                        <div class=\"acu-avatar-info\">\n                            <div class=\"acu-avatar-name-row\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(userNodeForDisplay.name)}</div>\n                                <div class=\"acu-avatar-actions\">\n                                    <button class=\"acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                    <button class=\"acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                </div>\n                            </div>\n                            <input type=\"text\" class=\"acu-avatar-url\" placeholder=\"URL...\" value=\"${escapeHtml(currentUrl)}\" />\n                            <input type=\"text\" class=\"acu-avatar-aliases\" placeholder=\"...\" value=\"${escapeHtml(aliases)}\" title=\": , \" />\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none;\" />\n                        </div>\n                    </div>\n                `;\n      }\n\n      // \n      for (const node of otherNodes) {\n        const data = avatars[node.name] || {};\n        let currentUrl = data.url || '';\n\n        // \n        const hasLocal = await AvatarManager.hasLocalAvatar(node.name);\n        let displayUrl = '';\n        let sourceLabel = '';\n\n        if (hasLocal) {\n          displayUrl = await LocalAvatarDB.get(node.name);\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n        } else if (currentUrl) {\n          displayUrl = currentUrl;\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n        }\n\n        const aliases = (data.aliases || []).join(', ');\n        const hasAvatar = !!displayUrl;\n\n        listHtml += `\n                    <div class=\"acu-avatar-item\" data-name=\"${escapeHtml(node.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <div class=\"acu-avatar-preview-wrap\">\n                            <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" style=\"${hasAvatar ? `background-image: url('${displayUrl}'); background-position: ${data.offsetX ?? 50}% ${data.offsetY ?? 50}%; background-size: ${data.scale ?? 150}%;` : ''}\">\n                                ${!hasAvatar ? `<span>${escapeHtml(node.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                            </div>\n                            ${sourceLabel}\n                        </div>\n                        <div class=\"acu-avatar-info\">\n                            <div class=\"acu-avatar-name-row\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(node.name)}</div>\n                                <div class=\"acu-avatar-actions\">\n                                    <button class=\"acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                    <button class=\"acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                </div>\n                            </div>\n                            <input type=\"text\" class=\"acu-avatar-url\" placeholder=\"URL...\" value=\"${escapeHtml(currentUrl)}\" />\n                            <input type=\"text\" class=\"acu-avatar-aliases\" placeholder=\"...\" value=\"${escapeHtml(aliases)}\" title=\": , \" />\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none;\" />\n                        </div>\n                    </div>\n                `;\n      }\n\n      return listHtml;\n    };\n\n    // \n    const managerHtml = `\n            <div class=\"acu-avatar-manager-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-avatar-manager\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-avatar-title\"><i class=\"fa-solid fa-user-circle\"></i> </div>\n                        <div style=\"display:flex;gap:4px;align-items:center;\">\n                            <button class=\"acu-avatar-import-btn\" title=\"\"><i class=\"fa-solid fa-file-import\"></i></button>\n                            <button class=\"acu-avatar-export-btn\" title=\"\"><i class=\"fa-solid fa-file-export\"></i></button>\n                            <button class=\"acu-avatar-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-avatar-list\" id=\"acu-avatar-list-container\">\n                        <div style=\"text-align:center;padding:20px;color:${t.textSub};\">\n                            <i class=\"fa-solid fa-spinner fa-spin\"></i> ...\n                        </div>\n                    </div>\n                </div>\n                <input type=\"file\" id=\"acu-avatar-file-input\" accept=\".json\" style=\"display:none;\" />\n            </div>\n        `;\n\n    const $manager = $(managerHtml);\n    $('body').append($manager);\n\n    // \n    buildList().then(listHtml => {\n      $manager.find('#acu-avatar-list-container').html(listHtml);\n      bindAvatarEvents();\n    });\n\n    // \n    const refreshItem = async name => {\n      const $item = $manager.find(`.acu-avatar-item[data-name=\"${name}\"]`);\n      if (!$item.length) return;\n\n      const data = AvatarManager.getAll()[name] || {};\n      const hasLocal = await AvatarManager.hasLocalAvatar(name);\n      let displayUrl = '';\n      let sourceLabel = '';\n\n      if (hasLocal) {\n        displayUrl = await LocalAvatarDB.get(name);\n        sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n      } else if (data.url) {\n        displayUrl = data.url;\n        sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n      }\n\n      const $preview = $item.find('.acu-avatar-preview');\n      $item.find('.acu-avatar-source').remove();\n\n      if (displayUrl) {\n        $preview\n          .addClass('has-image')\n          .css({\n            'background-image': `url('${displayUrl}')`,\n            'background-position': `${data.offsetX ?? 50}% ${data.offsetY ?? 50}%`,\n            'background-size': `${data.scale ?? 150}%`,\n          })\n          .find('span')\n          .remove();\n        $item.find('.acu-avatar-preview-wrap').append(sourceLabel);\n      } else {\n        $preview\n          .removeClass('has-image')\n          .css({ 'background-image': '', 'background-position': '', 'background-size': '' })\n          .html(`<span>${escapeHtml(name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>`);\n      }\n\n      $item.attr('data-has-local', hasLocal);\n      $item.attr('data-display-url', displayUrl);\n    };\n\n    const bindAvatarEvents = () => {\n      // \n      $manager.on('click', '.acu-avatar-preview', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-avatar-item');\n        const name = $item.data('name');\n        const displayUrl = $item.attr('data-display-url');\n\n        if (displayUrl) {\n          //   \n          showAvatarCropModal(displayUrl, name, async result => {\n            const data = AvatarManager.getAll()[name] || {};\n            AvatarManager.set(name, data.url || '', result.offsetX, result.offsetY, result.scale, data.aliases || []);\n            await refreshItem(name);\n            onUpdate && onUpdate();\n          });\n        } else {\n          //   \n          $item.find('.acu-avatar-file-input').click();\n        }\n      });\n\n      // \n      $manager.on('change', '.acu-avatar-file-input', async function (e) {\n        const file = e.target.files[0];\n        if (!file) return;\n\n        if (!file.type.startsWith('image/')) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        if (file.size > 5 * 1024 * 1024) {\n          if (window.toastr) window.toastr.warning(' 5MB');\n          return;\n        }\n\n        const $item = $(this).closest('.acu-avatar-item');\n        const name = $item.data('name');\n\n        try {\n          const success = await AvatarManager.saveLocalAvatar(name, file);\n          if (success) {\n            const newUrl = await LocalAvatarDB.get(name);\n            await refreshItem(name);\n\n            // \n            showAvatarCropModal(newUrl, name, async result => {\n              const data = AvatarManager.getAll()[name] || {};\n              AvatarManager.set(name, data.url || '', result.offsetX, result.offsetY, result.scale, data.aliases || []);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n\n        $(this).val('');\n      });\n\n      // URL  \n      $manager.on('click', '.acu-avatar-save-btn', async function () {\n        const $item = $(this).closest('.acu-avatar-item');\n        const name = $item.data('name');\n        const url = $item.find('.acu-avatar-url').val().trim();\n        const aliasesStr = $item.find('.acu-avatar-aliases').val().trim();\n        const aliases = aliasesStr\n          ? aliasesStr\n              .split(/[,]/)\n              .map(s => s.trim())\n              .filter(s => s && s !== name)\n          : [];\n\n        const data = AvatarManager.getAll()[name] || {};\n\n        // \n        AvatarManager.set(name, url, data.offsetX ?? 50, data.offsetY ?? 50, data.scale ?? 150, aliases);\n\n        // URL\n        const hasLocal = $item.attr('data-has-local') === 'true';\n        if (url && !hasLocal) {\n          await refreshItem(name);\n          showAvatarCropModal(url, name, async result => {\n            AvatarManager.set(name, url, result.offsetX, result.offsetY, result.scale, aliases);\n            await refreshItem(name);\n            onUpdate && onUpdate();\n          });\n        } else {\n          await refreshItem(name);\n          onUpdate && onUpdate();\n        }\n      });\n\n      // \n      $manager.on('click', '.acu-avatar-clear-btn', async function () {\n        const $item = $(this).closest('.acu-avatar-item');\n        const name = $item.data('name');\n\n        await AvatarManager.deleteLocalAvatar(name);\n        AvatarManager.remove(name);\n\n        $item.find('.acu-avatar-url').val('');\n        $item.find('.acu-avatar-aliases').val('');\n        await refreshItem(name);\n        onUpdate && onUpdate();\n      });\n\n      // \n      $manager.on('click', '.acu-avatar-export-btn', function () {\n        const exportData = AvatarManager.exportData();\n        const jsonStr = JSON.stringify(exportData, null, 2);\n        const blob = new Blob([jsonStr], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `avatar-config-${new Date().toISOString().slice(0, 10)}.json`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n      });\n\n      // \n      $manager.on('click', '.acu-avatar-import-btn', function () {\n        $manager.find('#acu-avatar-file-input').click();\n      });\n\n      $manager.on('change', '#acu-avatar-file-input', function (e) {\n        const file = e.target.files[0];\n        if (!file) return;\n\n        const reader = new FileReader();\n        reader.onload = function (evt) {\n          try {\n            const jsonData = JSON.parse(evt.target.result);\n            const analysis = AvatarManager.analyzeImport(jsonData);\n\n            if (!analysis.valid) {\n              if (window.toastr) window.toastr.error(analysis.error);\n              return;\n            }\n\n            showImportConfirmDialog(jsonData, analysis, () => {\n              $manager.remove();\n              showAvatarManager(nodeArr, onUpdate);\n              onUpdate && onUpdate();\n            });\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            if (window.toastr) window.toastr.error('');\n          }\n        };\n        reader.readAsText(file);\n        $(this).val('');\n      });\n    };\n\n    // \n    const closeManager = () => $manager.remove();\n    $manager.on('click', '.acu-avatar-close', closeManager);\n    $manager.on('click', function (e) {\n      if ($(e.target).hasClass('acu-avatar-manager-overlay')) closeManager();\n    });\n  };\n\n  // \n  const showImportConfirmDialog = (jsonData, analysis, onComplete) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const t = getThemeColors();\n    const config = getConfig();\n\n    const hasConflicts = analysis.conflicts.length > 0;\n    const conflictListHtml =\n      analysis.conflicts.length > 0\n        ? `<div style=\"max-height:80px;overflow-y:auto;background:rgba(0,0,0,0.1);border-radius:4px;padding:6px 8px;margin-top:6px;font-size:11px;color:${t.textSub};\">${analysis.conflicts.map(n => escapeHtml(n)).join(', ')}</div>`\n        : '';\n\n    const dialogHtml = `\n            <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-import-confirm-dialog\">\n                    <div class=\"acu-import-confirm-header\">\n                        <i class=\"fa-solid fa-file-import\"></i> \n                    </div>\n                    <div class=\"acu-import-confirm-body\">\n                        <div class=\"acu-import-stats\">\n                            <div class=\"acu-import-stat\">\n                                <span class=\"acu-stat-num\">${analysis.total}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-new\">\n                                <span class=\"acu-stat-num\">${analysis.newItems.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-conflict\">\n                                <span class=\"acu-stat-num\">${analysis.conflicts.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                        </div>\n\n                        ${\n                          hasConflicts\n                            ? `\n                            <div class=\"acu-import-conflict-section\">\n                                <div style=\"font-size:12px;font-weight:bold;color:${t.textMain};margin-bottom:4px;\">\n                                    <i class=\"fa-solid fa-exclamation-triangle\" style=\"color:${t.warningIcon};\"></i> \n                                </div>\n                                ${conflictListHtml}\n                                <div class=\"acu-import-conflict-options\">\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"overwrite\" checked />\n                                        <span></span>\n                                    </label>\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"skip\" />\n                                        <span></span>\n                                    </label>\n                                </div>\n                            </div>\n                        `\n                            : `\n                            <div style=\"text-align:center;padding:10px;color:${t.successText};\">\n                                <i class=\"fa-solid fa-check-circle\"></i> \n                            </div>\n                        `\n                        }\n                    </div>\n                    <div class=\"acu-import-confirm-footer\">\n                        <button class=\"acu-import-cancel-btn\"></button>\n                        <button class=\"acu-import-confirm-btn\"></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n            position: fixed !important;\n            top: 0 !important;\n            left: 0 !important;\n            right: 0 !important;\n            bottom: 0 !important;\n            width: 100vw !important;\n            height: 100vh !important;\n            background: rgba(0,0,0,0.6) !important;\n            z-index: 2147483655 !important;\n            display: flex;\n            justify-content: center !important;\n            align-items: center !important;\n            padding: 16px;\n            box-sizing: border-box !important;\n        `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(closeDialog);\n    $dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-import-confirm-overlay')) closeDialog();\n    });\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const overwrite = $dialog.find('input[name=\"conflict-mode\"]:checked').val() !== 'skip';\n      try {\n        const stats = AvatarManager.importData(jsonData, overwrite);\n        closeDialog();\n        onComplete && onComplete();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + err.message);\n      }\n    });\n  };\n  // []  ()\n  const showCardEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    let rawData = cachedRawData || getTableData() || loadSnapshot();\n\n    let displayRow = row;\n    // \n    if (rawData && rawData[tableKey] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n      displayRow = rawData[tableKey]?.content?.[rowIndex + 1];\n    }\n\n    const inputsHtml = displayRow\n      .map((cell, idx) => {\n        if (idx === 0) return ''; // \n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        //  textarea\n        return `\n                <div class=\"acu-card-edit-field\" style=\"margin-bottom: 10px;\">\n                    <label style=\"display:block;font-size:12px;color:var(--acu-accent);font-weight:bold;margin-bottom:4px;\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\"\n                    style=\"width:100%;min-height:40px;max-height:500px;padding:10px;resize:none;overflow-y:hidden;\">${escapeHtml(val)}</textarea>\n                </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${inputsHtml}\n                    </div>\n                     <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-card-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-card-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // --- []  ---\n    const adjustHeight = el => {\n      //  auto  0px shrinking  scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    // -----------------------------\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-card-cancel').click(closeDialog);\n\n    //  v8.4  saveDataToDatabase\n    dialog.find('#dlg-card-save').click(async () => {\n      let rawData = cachedRawData || getTableData() || loadSnapshot();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n        if (hasChanges) {\n          try {\n            await saveDataToDatabase(rawData, false, true); //  v8.4 \n            renderInterface();\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            // \n            return;\n          }\n        }\n      }\n      closeDialog();\n    });\n    dialog.on('click', function (e) {\n      // \n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        closeDialog();\n        return;\n      }\n      // \n      if ($(e.target).closest('#dlg-close-x, #dlg-close, .acu-close-btn').length) {\n        closeDialog();\n      }\n    });\n  };\n\n  // [] \n  let _configCache = null;\n  const getConfig = () => {\n    if (!_configCache) _configCache = { ...DEFAULT_CONFIG, ...Store.get(STORAGE_KEY_UI_CONFIG, {}) };\n    return _configCache;\n  };\n  const saveConfig = newCfg => {\n    _configCache = { ...getConfig(), ...newCfg };\n    Store.set(STORAGE_KEY_UI_CONFIG, _configCache);\n    applyConfigStyles(_configCache);\n  };\n\n  const generateDiffMap = currentData => {\n    const lastData = loadSnapshot();\n    const diffSet = new Set();\n    if (!lastData) return diffSet;\n\n    for (const sheetId in currentData) {\n      const newSheet = currentData[sheetId];\n      const oldSheet = lastData[sheetId];\n      if (!newSheet || !newSheet.name) continue;\n      const tableName = newSheet.name;\n      if (!oldSheet) {\n        if (newSheet.content) {\n          newSheet.content.forEach((row, rIdx) => {\n            if (rIdx > 0) diffSet.add(`${tableName}-row-${rIdx - 1}`);\n          });\n        }\n        continue;\n      }\n      const newRows = newSheet.content || [];\n      const oldRows = oldSheet.content || [];\n      newRows.forEach((row, rIdx) => {\n        if (rIdx === 0) return;\n        const oldRow = oldRows[rIdx];\n        if (!oldRow) {\n          diffSet.add(`${tableName}-row-${rIdx - 1}`);\n        } else {\n          row.forEach((cell, cIdx) => {\n            if (cIdx === 0) return;\n            const oldCell = oldRow[cIdx];\n            if (String(cell) !== String(oldCell)) diffSet.add(`${tableName}-${rIdx - 1}-${cIdx}`);\n          });\n        }\n      });\n    }\n    return diffSet;\n  };\n\n  const applyConfigStyles = config => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    const fontVal = FONTS.find(f => f.id === config.fontFamily)?.val || FONTS[0].val;\n\n    // []  ID  Style \n    const $styleTag = $('#acu-dynamic-font');\n    const currentFontId = $styleTag.data('font-id');\n\n    if (currentFontId !== config.fontFamily) {\n      $styleTag.remove();\n      const fontImport = `\n                @import url(\"https://fontsapi.zeoseven.com/3/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/442/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/256/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/482/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/446/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/570/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/292/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/69/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/7/main/result.css\");\n            `;\n      $('head').append(`\n                <style id=\"acu-dynamic-font\" data-font-id=\"${config.fontFamily}\">\n                    ${fontImport}\n                    .acu-wrapper, .acu-edit-dialog, .acu-cell-menu, .acu-nav-container, .acu-data-card, .acu-panel-title, .acu-settings-label, .acu-btn-block, .acu-nav-btn, .acu-edit-textarea {\n                        font-family: ${fontVal} !important;\n                    }\n                </style>\n            `);\n    }\n\n    // []  CSS \n    const cssVars = {\n      '--acu-card-width': `${config.cardWidth}px`,\n      '--acu-font-size': `${config.fontSize}px`,\n      '--acu-opt-font-size': `${config.optionFontSize || 12}px`,\n      '--acu-grid-cols': config.gridColumns,\n    };\n\n    if ($wrapper.length) {\n      $wrapper.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $wrapper.addClass(`acu-theme-${config.theme}`);\n      $wrapper.css(cssVars);\n    }\n\n    const $optContainer = $('.acu-embedded-options-container');\n    if ($optContainer.length) {\n      $optContainer.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $optContainer.addClass(`acu-theme-${config.theme}`);\n      $optContainer.css(cssVars);\n    }\n  };\n\n  const addStyles = () => {\n    if (window._acuStylesInjected && $(`#${SCRIPT_ID}-styles`).length) return;\n    window._acuStylesInjected = true;\n    const { $ } = getCore();\n    $('style').each(function () {\n      if (this.id && this.id.startsWith('acu_') && this.id.endsWith('-styles') && this.id !== `${SCRIPT_ID}-styles`)\n        $(this).remove();\n    });\n    $(`#${SCRIPT_ID}-styles`).remove();\n    const styles = `\n        <style id=\"${SCRIPT_ID}-styles\">\n    /* ==========  ========== */\n    .acu-wrapper,\n    .acu-wrapper *:not(i[class*=\"fa-\"]),\n    .acu-edit-overlay,\n    .acu-edit-overlay *:not(i[class*=\"fa-\"]),\n    .acu-cell-menu,\n    .acu-cell-menu *:not(i[class*=\"fa-\"]),\n    .acu-dice-panel,\n    .acu-dice-panel *:not(i[class*=\"fa-\"]),\n    .acu-contest-panel,\n    .acu-contest-panel *:not(i[class*=\"fa-\"]),\n    .acu-relation-graph-overlay,\n    .acu-relation-graph-overlay *:not(i[class*=\"fa-\"]),\n    .acu-avatar-manager-overlay,\n    .acu-avatar-manager-overlay *:not(i[class*=\"fa-\"]),\n    .acu-preview-overlay,\n    .acu-preview-overlay *:not(i[class*=\"fa-\"]),\n    .acu-import-confirm-overlay,\n    .acu-import-confirm-overlay *:not(i[class*=\"fa-\"]),\n    .acu-embedded-options-container,\n    .acu-embedded-options-container *:not(i[class*=\"fa-\"]) {\n        box-sizing: border-box;\n        -webkit-tap-highlight-color: transparent;\n        -webkit-font-smoothing: antialiased;\n    }\n    /* ==========  ========== */\n    .acu-wrapper,\n    .acu-edit-overlay,\n    .acu-dice-panel,\n    .acu-contest-panel,\n    .acu-relation-graph-overlay,\n    .acu-avatar-manager-overlay,\n    .acu-preview-overlay,\n    .acu-import-confirm-overlay,\n    .acu-embedded-options-container,\n    .acu-cell-menu {\n        font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;\n        font-size: 13px;\n        line-height: 1.5;\n        color: var(--acu-text-main);\n    }\n    /*  ( !important  SillyTavern ) */\n    .acu-dice-panel,\n    .acu-contest-panel,\n    .acu-dice-config-dialog {\n        background: var(--acu-bg-panel);\n        color: var(--acu-text-main);\n    }\n    .acu-dice-panel input[type=\"text\"],\n    .acu-dice-panel input[type=\"number\"],\n    .acu-dice-panel input:not([type]),\n    .acu-dice-panel select,\n    .acu-contest-panel input[type=\"text\"],\n    .acu-contest-panel input[type=\"number\"],\n    .acu-contest-panel input:not([type]),\n    .acu-contest-panel select,\n    .acu-dice-config-dialog input[type=\"text\"],\n    .acu-dice-config-dialog input[type=\"number\"],\n    .acu-dice-config-dialog input:not([type]),\n    .acu-dice-config-dialog select {\n        width: 100%;\n        padding: 6px;\n        background: var(--acu-input-bg) !important;\n        border: 1px solid var(--acu-border) !important;\n        border-radius: 4px;\n        color: var(--acu-text-main) !important;\n        font-size: 12px;\n    }\n    /* number */\n    .acu-dice-panel input[type=\"number\"]::-webkit-inner-spin-button,\n    .acu-dice-panel input[type=\"number\"]::-webkit-outer-spin-button,\n    .acu-contest-panel input[type=\"number\"]::-webkit-inner-spin-button,\n    .acu-contest-panel input[type=\"number\"]::-webkit-outer-spin-button,\n    .acu-dice-config-dialog input[type=\"number\"]::-webkit-inner-spin-button,\n    .acu-dice-config-dialog input[type=\"number\"]::-webkit-outer-spin-button {\n        -webkit-appearance: none;\n        margin: 0;\n    }\n    .acu-dice-panel input[type=\"number\"],\n    .acu-contest-panel input[type=\"number\"],\n    .acu-dice-config-dialog input[type=\"number\"] {\n        -moz-appearance: textfield;\n        text-align: center;\n        box-sizing: border-box;\n    }\n    .acu-dice-panel input::placeholder,\n    .acu-contest-panel input::placeholder,\n    .acu-dice-config-dialog input::placeholder {\n        color: var(--acu-text-sub) !important;\n        opacity: 0.7;\n    }\n    .acu-dice-panel input:focus,\n    .acu-dice-panel select:focus,\n    .acu-contest-panel input:focus,\n    .acu-contest-panel select:focus,\n    .acu-dice-config-dialog input:focus,\n    .acu-dice-config-dialog select:focus {\n        outline: none;\n        border-color: var(--acu-accent) !important;\n    }\n    .acu-dice-panel select option,\n    .acu-contest-panel select option,\n    .acu-dice-config-dialog select option {\n        background: var(--acu-bg-panel);\n        color: var(--acu-text-main);\n    }\n    /*  */\n    .acu-dice-select {\n        width: 100%;\n        padding: 6px 4px;\n        background: var(--acu-input-bg) !important;\n        border: 1px solid var(--acu-border) !important;\n        border-radius: 4px;\n        color: var(--acu-text-main) !important;\n        font-size: 11px;\n        box-sizing: border-box;\n        cursor: pointer;\n        -webkit-appearance: none;\n        text-align: center;\n        appearance: none;\n    }\n    .acu-dice-select:focus {\n        outline: none;\n        border-color: var(--acu-accent) !important;\n    }\n    .acu-dice-select option {\n        background: var(--acu-bg-panel) !important;\n        color: var(--acu-text-main) !important;\n    }\n    /*  */\n    .acu-wrapper .acu-search-input {\n        background-color: var(--acu-input-bg) !important;\n        color: var(--acu-text-main) !important;\n        border: 1px solid var(--acu-border);\n    }\n    .acu-wrapper .acu-search-input:focus {\n        outline: none;\n        border-color: var(--acu-accent);\n        box-shadow: none !important;\n    }\n    .acu-wrapper .acu-search-input::placeholder {\n        color: var(--acu-text-sub) !important;\n        opacity: 0.7;\n    }\n    /* ==========  ========== */\n    /*  */\n    .acu-wrapper button,\n    .acu-edit-overlay button,\n    .acu-dice-panel button,\n    .acu-contest-panel button,\n    .acu-relation-graph-overlay button,\n    .acu-avatar-manager-overlay button,\n    .acu-preview-overlay button,\n    .acu-embedded-options-container button {\n        font-family: inherit;\n        font-size: inherit;\n        line-height: 1.4;\n        cursor: pointer;\n        border: 1px solid var(--acu-border);\n        border-radius: 6px;\n        background: var(--acu-btn-bg);\n        color: var(--acu-text-main);\n        transition: all 0.2s ease;\n        outline: none;\n    }\n    .acu-wrapper button:hover,\n    .acu-edit-overlay button:hover,\n    .acu-dice-panel button:hover,\n    .acu-contest-panel button:hover,\n    .acu-relation-graph-overlay button:hover,\n    .acu-avatar-manager-overlay button:hover,\n    .acu-preview-overlay button:hover,\n    .acu-embedded-options-container button:hover {\n        background: var(--acu-btn-hover);\n    }\n    .acu-wrapper button:focus,\n    .acu-edit-overlay button:focus,\n    .acu-dice-panel button:focus,\n    .acu-contest-panel button:focus,\n    .acu-relation-graph-overlay button:focus,\n    .acu-avatar-manager-overlay button:focus,\n    .acu-preview-overlay button:focus,\n    .acu-embedded-options-container button:focus {\n        outline: none;\n        box-shadow: none;\n    }\n\n    /*  */\n    .acu-wrapper input,\n    .acu-wrapper textarea,\n    .acu-wrapper select,\n    .acu-edit-overlay input,\n    .acu-edit-overlay textarea,\n    .acu-edit-overlay select,\n    .acu-dice-panel input,\n    .acu-dice-panel select,\n    .acu-contest-panel input,\n    .acu-contest-panel select,\n    .acu-avatar-manager-overlay input {\n        font-family: inherit;\n        font-size: inherit;\n        line-height: 1.4;\n        border: 1px solid var(--acu-border);\n        border-radius: 4px;\n        background: var(--acu-btn-bg);\n        color: var(--acu-text-main);\n        outline: none;\n        transition: border-color 0.2s;\n    }\n    .acu-wrapper input:focus,\n    .acu-wrapper textarea:focus,\n    .acu-wrapper select:focus,\n    .acu-edit-overlay input:focus,\n    .acu-edit-overlay textarea:focus,\n    .acu-edit-overlay select:focus,\n    .acu-dice-panel input:focus,\n    .acu-dice-panel select:focus,\n    .acu-contest-panel input:focus,\n    .acu-contest-panel select:focus,\n    .acu-avatar-manager-overlay input:focus {\n        border-color: var(--acu-accent);\n        box-shadow: none;\n        outline: none;\n    }\n    .acu-wrapper input::placeholder,\n    .acu-wrapper textarea::placeholder,\n    .acu-dice-panel input::placeholder,\n    .acu-contest-panel input::placeholder,\n    .acu-avatar-manager-overlay input::placeholder {\n        color: var(--acu-text-sub);\n        opacity: 0.7;\n    }\n\n    /*  */\n    .acu-edit-overlay,\n    .acu-dice-overlay,\n    .acu-contest-overlay,\n    .acu-relation-graph-overlay,\n    .acu-avatar-manager-overlay,\n    .acu-preview-overlay,\n    .acu-import-confirm-overlay,\n    .acu-dice-config-overlay,\n    .acu-crop-modal-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0,0,0,0.6);\n        z-index: 2147483646;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 16px;\n        backdrop-filter: blur(2px);\n    }\n\n    /*  */\n    .acu-edit-dialog,\n    .acu-dice-panel,\n    .acu-contest-panel,\n    .acu-relation-graph-container,\n    .acu-avatar-manager,\n    .acu-preview-card,\n    .acu-import-confirm-dialog,\n    .acu-dice-config-dialog {\n        background: var(--acu-bg-panel);\n        border: 1px solid var(--acu-border);\n        border-radius: 12px;\n        box-shadow: 0 20px 60px rgba(0,0,0,0.4);\n        overflow: hidden;\n        display: flex;\n        flex-direction: column;\n    }\n\n    /*  -  .acu-panel-header */\n    .acu-panel-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 12px 15px;\n        background: var(--acu-table-head);\n        border-bottom: 1px solid var(--acu-border);\n        flex-shrink: 0;\n    }\n\n    /*  -  .acu-close-btn */\n    .acu-close-btn {\n        background: none;\n        border: none;\n        color: var(--acu-text-sub);\n        cursor: pointer;\n        font-size: 16px;\n        padding: 4px 8px;\n        border-radius: 4px;\n        transition: all 0.2s;\n    }\n    .acu-close-btn:hover {\n        background: var(--acu-error-bg, rgba(231, 76, 60, 0.15));\n        color: var(--acu-error-text, #e74c3c);\n    }\n\n    /*  */\n    [class^=\"acu-\"], [class^=\"acu-\"] * { scrollbar-width: none; -ms-overflow-style: none; }\n    [class^=\"acu-\"] *::-webkit-scrollbar { display: none !important; }\n\n    /* ==========  ========== */\n    .acu-theme-retro { --acu-bg-nav: #e6e2d3; --acu-bg-panel: #e6e2d3; --acu-border: #dcd0c0; --acu-text-main: #5e4b35; --acu-text-sub: #999; --acu-btn-bg: #dcd0c0; --acu-btn-hover: #cbbba8; --acu-btn-active-bg: #8d7b6f; --acu-btn-active-text: #fdfaf5; --acu-accent: #7a695f; --acu-table-head: #efebe4; --acu-table-hover: #f0ebe0; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #fffef9; --acu-badge-bg: #efebe4; --acu-menu-bg: #fff; --acu-menu-text: #333; --acu-success-text: #27ae60; --acu-success-bg: rgba(39, 174, 96, 0.15); --acu-scrollbar-track: #e6e2d3; --acu-scrollbar-thumb: #cbbba8; --acu-input-bg: #f5f2eb;--acu-hl-manual: #d35400; --acu-hl-manual-bg: rgba(211, 84, 0, 0.15); --acu-hl-diff: #2980b9; --acu-hl-diff-bg: rgba(41, 128, 185, 0.15); --acu-error-text: #e74c3c; --acu-error-bg: rgba(231, 76, 60, 0.15); --acu-error-border: rgba(231, 76, 60, 0.5); --acu-warning-icon: #e67e22; --acu-failure-text: #e74c3c; --acu-failure-bg: rgba(231, 76, 60, 0.15); --acu-warning-text: #f39c12; --acu-warning-bg: rgba(243, 156, 18, 0.15); --acu-crit-success-text: #9b59b6; --acu-crit-success-bg: rgba(155, 89, 182, 0.15); --acu-crit-failure-text: #c0392b; --acu-crit-failure-bg: rgba(192, 57, 43, 0.15); --acu-extreme-success-text: #2980b9; --acu-extreme-success-bg: rgba(41, 128, 185, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.4); --acu-light-bg: rgba(0,0,0,0.1); --acu-very-light-bg: rgba(0,0,0,0.02); --acu-button-text: #5e4b35; --acu-gray-bg: rgba(128,128,128,0.1); }\n    .acu-theme-dark { --acu-bg-nav: #2b2b2b; --acu-bg-panel: #252525; --acu-border: #444; --acu-text-main: #eee; --acu-text-sub: #aaa; --acu-btn-bg: #3a3a3a; --acu-btn-hover: #4a4a4a; --acu-btn-active-bg: #6a5acd; --acu-btn-active-text: #fff; --acu-accent: #9b8cd9; --acu-table-head: #333333; --acu-table-hover: #3a3a3a; --acu-shadow: rgba(0,0,0,0.6); --acu-card-bg: #2d3035; --acu-badge-bg: #3a3f4b; --acu-menu-bg: #333; --acu-menu-text: #eee; --acu-success-text: #4cd964; --acu-success-bg: rgba(76, 217, 100, 0.2); --acu-scrollbar-track: #2b2b2b; --acu-scrollbar-thumb: #555; --acu-hl-manual: #ff6b81; --acu-hl-manual-bg: rgba(255, 107, 129, 0.2); --acu-hl-diff: #00d2d3; --acu-hl-diff-bg: rgba(0, 210, 211, 0.2); --acu-error-text: #ff6b6b; --acu-error-bg: rgba(255, 107, 107, 0.2); --acu-error-border: rgba(255, 107, 107, 0.5); --acu-warning-icon: #ffa726; --acu-failure-text: #ff6b6b; --acu-failure-bg: rgba(255, 107, 107, 0.2); --acu-warning-text: #ffa726; --acu-warning-bg: rgba(255, 167, 38, 0.2); --acu-crit-success-text: #ba68c8; --acu-crit-success-bg: rgba(186, 104, 200, 0.2); --acu-crit-failure-text: #d32f2f; --acu-crit-failure-bg: rgba(211, 47, 47, 0.2); --acu-extreme-success-text: #42a5f5; --acu-extreme-success-bg: rgba(66, 165, 245, 0.2); --acu-overlay-bg: rgba(0,0,0,0.75); --acu-overlay-bg-light: rgba(0,0,0,0.65); --acu-shadow-bg: rgba(0,0,0,0.6); --acu-light-bg: rgba(255,255,255,0.05); --acu-very-light-bg: rgba(255,255,255,0.02); --acu-button-text: #fff; --acu-gray-bg: rgba(255,255,255,0.1); }\n    .acu-theme-modern { --acu-bg-nav: #ffffff; --acu-bg-panel: #f8f9fa; --acu-border: #e0e0e0; --acu-text-main: #333; --acu-text-sub: #666; --acu-btn-bg: #f1f3f5; --acu-btn-hover: #e9ecef; --acu-btn-active-bg: #007bff; --acu-btn-active-text: #fff; --acu-accent: #007bff; --acu-table-head: #f8f9fa; --acu-table-hover: #f1f3f5; --acu-shadow: rgba(0,0,0,0.1); --acu-card-bg: #ffffff; --acu-badge-bg: #f1f3f5; --acu-menu-bg: #fff; --acu-menu-text: #333; --acu-success-text: #28a745; --acu-success-bg: rgba(40, 167, 69, 0.15); --acu-scrollbar-track: #fff; --acu-scrollbar-thumb: #ccc; --acu-hl-manual: #fd7e14; --acu-hl-manual-bg: rgba(253, 126, 20, 0.15); --acu-hl-diff: #0d6efd; --acu-hl-diff-bg: rgba(13, 110, 253, 0.15); --acu-error-text: #dc3545; --acu-error-bg: rgba(220, 53, 69, 0.15); --acu-error-border: rgba(220, 53, 69, 0.5); --acu-warning-icon: #fd7e14; --acu-failure-text: #dc3545; --acu-failure-bg: rgba(220, 53, 69, 0.15); --acu-warning-text: #ffc107; --acu-warning-bg: rgba(255, 193, 7, 0.15); --acu-crit-success-text: #6f42c1; --acu-crit-success-bg: rgba(111, 66, 193, 0.15); --acu-crit-failure-text: #c82333; --acu-crit-failure-bg: rgba(200, 35, 51, 0.15); --acu-extreme-success-text: #17a2b8; --acu-extreme-success-bg: rgba(23, 162, 184, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.4); --acu-light-bg: rgba(0,0,0,0.1); --acu-very-light-bg: rgba(0,0,0,0.02); --acu-button-text: #333; --acu-gray-bg: rgba(128,128,128,0.1); }\n    .acu-theme-forest { --acu-bg-nav: #e8f5e9; --acu-bg-panel: #e8f5e9; --acu-border: #c8e6c9; --acu-text-main: #2e7d32; --acu-text-sub: #81c784; --acu-btn-bg: #c8e6c9; --acu-btn-hover: #a5d6a7; --acu-btn-active-bg: #43a047; --acu-btn-active-text: #fff; --acu-accent: #4caf50; --acu-table-head: #dcedc8; --acu-table-hover: #f1f8e9; --acu-shadow: rgba(0,0,0,0.1); --acu-card-bg: #ffffff; --acu-badge-bg: #dcedc8; --acu-menu-bg: #fff; --acu-menu-text: #2e7d32; --acu-success-text: #2e7d32; --acu-success-bg: rgba(46, 125, 50, 0.2); --acu-scrollbar-track: #e8f5e9; --acu-scrollbar-thumb: #a5d6a7; --acu-hl-manual: #e67e22; --acu-hl-manual-bg: rgba(230, 126, 34, 0.15); --acu-hl-diff: #1e8449; --acu-hl-diff-bg: rgba(30, 132, 73, 0.2); --acu-button-text: #2e7d32; }\n    .acu-theme-ocean { --acu-bg-nav: #e3f2fd; --acu-bg-panel: #e3f2fd; --acu-border: #90caf9; --acu-text-main: #1565c0; --acu-text-sub: #64b5f6; --acu-btn-bg: #bbdefb; --acu-btn-hover: #90caf9; --acu-btn-active-bg: #1976d2; --acu-btn-active-text: #fff; --acu-accent: #2196f3; --acu-table-head: #bbdefb; --acu-table-hover: #e1f5fe; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #ffffff; --acu-badge-bg: #e3f2fd; --acu-menu-bg: #fff; --acu-menu-text: #1565c0; --acu-success-text: #0288d1; --acu-success-bg: rgba(2, 136, 209, 0.15); --acu-scrollbar-track: #e3f2fd; --acu-scrollbar-thumb: #90caf9; --acu-hl-manual: #ff4757; --acu-hl-manual-bg: rgba(255, 71, 87, 0.15); --acu-hl-diff: #0277bd; --acu-hl-diff-bg: rgba(2, 119, 189, 0.2); --acu-error-text: #d32f2f; --acu-error-bg: rgba(211, 47, 47, 0.15); --acu-error-border: rgba(211, 47, 47, 0.5); --acu-warning-icon: #f57c00; --acu-failure-text: #d32f2f; --acu-failure-bg: rgba(211, 47, 47, 0.15); --acu-warning-text: #f57c00; --acu-warning-bg: rgba(245, 124, 0, 0.15); --acu-crit-success-text: #7b1fa2; --acu-crit-success-bg: rgba(123, 31, 162, 0.15); --acu-crit-failure-text: #b71c1c; --acu-crit-failure-bg: rgba(183, 28, 28, 0.15); --acu-extreme-success-text: #0277bd; --acu-extreme-success-bg: rgba(2, 119, 189, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.4); --acu-light-bg: rgba(0,0,0,0.1); --acu-very-light-bg: rgba(0,0,0,0.02); --acu-button-text: #1565c0; --acu-gray-bg: rgba(128,128,128,0.1); }\n    .acu-theme-cyber { --acu-bg-nav: #000000; --acu-bg-panel: #0a0a0a; --acu-border: #333; --acu-text-main: #00ffcc; --acu-text-sub: #ff00ff; --acu-btn-bg: #111; --acu-btn-hover: #222; --acu-btn-active-bg: #ff00ff; --acu-btn-active-text: #fff; --acu-accent: #00ffcc; --acu-table-head: #050505; --acu-table-hover: #111; --acu-shadow: 0 0 15px rgba(0,255,204,0.15); --acu-card-bg: #050505; --acu-badge-bg: #1a1a1a; --acu-menu-bg: #111; --acu-menu-text: #00ffcc; --acu-success-text: #0f0; --acu-success-bg: rgba(0, 255, 0, 0.15); --acu-scrollbar-track: #000; --acu-scrollbar-thumb: #333; --acu-hl-manual: #ff9f43; --acu-hl-manual-bg: rgba(255, 159, 67, 0.2); --acu-hl-diff: #0abde3; --acu-hl-diff-bg: rgba(10, 189, 227, 0.2); }\n    .acu-theme-cyber .acu-nav-btn { border-color: #222; }\n    .acu-theme-cyber .acu-data-card { border-color: #222; }\n    .acu-theme-cyber .acu-dice-panel input::placeholder,\n    .acu-theme-cyber .acu-contest-panel input::placeholder {\n        color: #ff00ff !important;\n        opacity: 0.7;\n    }\n    .acu-theme-cyber .acu-dice-panel input[type=\"text\"],\n    .acu-theme-cyber .acu-dice-panel input[type=\"number\"],\n    .acu-theme-cyber .acu-dice-panel input:not([type]),\n    .acu-theme-cyber .acu-contest-panel input[type=\"text\"],\n    .acu-theme-cyber .acu-contest-panel input[type=\"number\"],\n    .acu-theme-cyber .acu-contest-panel input:not([type]) {\n        color: #ff00ff !important;\n    }\n    .acu-theme-nightowl { --acu-bg-nav: #0a2133; --acu-bg-panel: #011627; --acu-border: #132e45; --acu-text-main: #e0e6f2; --acu-text-sub: #a6b8cc; --acu-btn-bg: #1f3a52; --acu-btn-hover: #2a4a68; --acu-btn-active-bg: #7fdbca; --acu-btn-active-text: #011627; --acu-accent: #7fdbca; --acu-table-head: #0a2133; --acu-table-hover: #01294a; --acu-shadow: rgba(0,0,0,0.5); --acu-card-bg: #0a2133; --acu-badge-bg: #1f3a52; --acu-menu-bg: #011627; --acu-menu-text: #e0e6f2; --acu-success-text: #addb67; --acu-success-bg: rgba(173, 219, 103, 0.15); --acu-scrollbar-track: #011627; --acu-scrollbar-thumb: #1f3a52; --acu-hl-manual: #ff8f66; --acu-hl-manual-bg: rgba(255, 143, 102, 0.2); --acu-hl-diff: #82aaff; --acu-hl-diff-bg: rgba(130, 170, 255, 0.2); }\n    .acu-theme-sakura { --acu-bg-nav: #F9F0EF; --acu-bg-panel: #F9F0EF; --acu-border: #EBDCD9; --acu-text-main: #6B5552; --acu-text-sub: #C08D8D; --acu-btn-bg: #EBDCD9; --acu-btn-hover: #D8C7C4; --acu-btn-active-bg: #C08D8D; --acu-btn-active-text: #F9F0EF; --acu-accent: #C08D8D; --acu-table-head: #F9F0EF; --acu-table-hover: #F5EAE8; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #ffffff; --acu-badge-bg: #F9F0EF; --acu-menu-bg: #fff; --acu-menu-text: #6B5552; --acu-success-text: #6B5552; --acu-success-bg: rgba(192, 141, 141, 0.12); --acu-scrollbar-track: #F9F0EF; --acu-scrollbar-thumb: #EBDCD9; --acu-hl-manual: #A68A7A; --acu-hl-manual-bg: rgba(166, 138, 122, 0.12); --acu-hl-diff: #9B7A7A; --acu-hl-diff-bg: rgba(155, 122, 122, 0.2); --acu-error-text: #9B7A7A; --acu-error-bg: rgba(155, 122, 122, 0.12); --acu-error-border: rgba(155, 122, 122, 0.4); --acu-warning-icon: #A68A7A; --acu-failure-text: #9B7A7A; --acu-failure-bg: rgba(155, 122, 122, 0.12); --acu-warning-text: #A68A7A; --acu-warning-bg: rgba(166, 138, 122, 0.12); --acu-crit-success-text: #8B7A7A; --acu-crit-success-bg: rgba(139, 122, 122, 0.12); --acu-crit-failure-text: #8B6F6F; --acu-crit-failure-bg: rgba(139, 111, 111, 0.12); --acu-extreme-success-text: #9B8A8A; --acu-extreme-success-bg: rgba(155, 138, 138, 0.12); --acu-overlay-bg: rgba(107, 85, 82, 0.6); --acu-overlay-bg-light: rgba(107, 85, 82, 0.5); --acu-shadow-bg: rgba(107, 85, 82, 0.3); --acu-light-bg: rgba(192, 141, 141, 0.08); --acu-very-light-bg: rgba(192, 141, 141, 0.02); --acu-button-text: #6B5552; --acu-gray-bg: rgba(192, 141, 141, 0.08); }\n    .acu-theme-minepink { --acu-bg-nav: #1a1a1a; --acu-bg-panel: #1a1a1a; --acu-border: #333333; --acu-text-main: #ffb3d9; --acu-text-sub: #ff80c1; --acu-btn-bg: #2a2a2a; --acu-btn-hover: #3a3a3a; --acu-btn-active-bg: #ff80c1; --acu-btn-active-text: #1a1a1a; --acu-accent: #ff80c1; --acu-table-head: #252525; --acu-table-hover: #2a2a2a; --acu-shadow: rgba(0,0,0,0.6); --acu-card-bg: #222222; --acu-badge-bg: #2a2a2a; --acu-menu-bg: #1a1a1a; --acu-menu-text: #ffb3d9; --acu-success-text: #ff80c1; --acu-success-bg: rgba(255, 128, 193, 0.2); --acu-scrollbar-track: #1a1a1a; --acu-scrollbar-thumb: #333333; --acu-hl-manual: #ffa726; --acu-hl-manual-bg: rgba(255, 167, 38, 0.2); --acu-hl-diff: #ff80c1; --acu-hl-diff-bg: rgba(255, 128, 193, 0.2); --acu-error-text: #ff6b6b; --acu-error-bg: rgba(255, 107, 107, 0.2); --acu-error-border: rgba(255, 107, 107, 0.5); --acu-warning-icon: #ffa726; --acu-failure-text: #ff6b6b; --acu-failure-bg: rgba(255, 107, 107, 0.2); --acu-warning-text: #ffa726; --acu-warning-bg: rgba(255, 167, 38, 0.2); --acu-crit-success-text: #ff80c1; --acu-crit-success-bg: rgba(255, 128, 193, 0.2); --acu-crit-failure-text: #ff4444; --acu-crit-failure-bg: rgba(255, 68, 68, 0.2); --acu-extreme-success-text: #ffb3d9; --acu-extreme-success-bg: rgba(255, 179, 217, 0.2); --acu-overlay-bg: rgba(0,0,0,0.8); --acu-overlay-bg-light: rgba(0,0,0,0.7); --acu-shadow-bg: rgba(0,0,0,0.6); --acu-light-bg: rgba(255, 128, 193, 0.1); --acu-very-light-bg: rgba(255, 128, 193, 0.02); --acu-button-text: #1a1a1a; --acu-gray-bg: rgba(255, 128, 193, 0.1); }\n    .acu-theme-purple { --acu-bg-nav: #f3e5f5; --acu-bg-panel: #f3e5f5; --acu-border: #ce93d8; --acu-text-main: #6a1b9a; --acu-text-sub: #9c27b0; --acu-btn-bg: #e1bee7; --acu-btn-hover: #ce93d8; --acu-btn-active-bg: #9c27b0; --acu-btn-active-text: #fff; --acu-accent: #9c27b0; --acu-table-head: #f8e1f5; --acu-table-hover: #fce4ec; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #ffffff; --acu-badge-bg: #f8e1f5; --acu-menu-bg: #fff; --acu-menu-text: #6a1b9a; --acu-success-text: #6a1b9a; --acu-success-bg: rgba(106, 27, 154, 0.15); --acu-scrollbar-track: #f3e5f5; --acu-scrollbar-thumb: #ce93d8; --acu-hl-manual: #f57c00; --acu-hl-manual-bg: rgba(245, 124, 0, 0.15); --acu-hl-diff: #6a1b9a; --acu-hl-diff-bg: rgba(106, 27, 154, 0.2); --acu-error-text: #d32f2f; --acu-error-bg: rgba(211, 47, 47, 0.15); --acu-error-border: rgba(211, 47, 47, 0.5); --acu-warning-icon: #f57c00; --acu-failure-text: #d32f2f; --acu-failure-bg: rgba(211, 47, 47, 0.15); --acu-warning-text: #f57c00; --acu-warning-bg: rgba(245, 124, 0, 0.15); --acu-crit-success-text: #7b1fa2; --acu-crit-success-bg: rgba(123, 31, 162, 0.15); --acu-crit-failure-text: #b71c1c; --acu-crit-failure-bg: rgba(183, 28, 28, 0.15); --acu-extreme-success-text: #6a1b9a; --acu-extreme-success-bg: rgba(106, 27, 154, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.4); --acu-light-bg: rgba(156, 39, 176, 0.1); --acu-very-light-bg: rgba(156, 39, 176, 0.02); --acu-button-text: #6a1b9a; --acu-gray-bg: rgba(156, 39, 176, 0.1); }\n    .acu-theme-wechat { --acu-bg-nav: #F7F7F7; --acu-bg-panel: #F7F7F7; --acu-border: #E5E5E5; --acu-text-main: #333333; --acu-text-sub: #666666; --acu-btn-bg: #E5E5E5; --acu-btn-hover: #D5D5D5; --acu-btn-active-bg: #09B83E; --acu-btn-active-text: #FFFFFF; --acu-accent: #09B83E; --acu-table-head: #F0F0F0; --acu-table-hover: #EBEBEB; --acu-shadow: rgba(0,0,0,0.1); --acu-card-bg: #ffffff; --acu-badge-bg: #F0F0F0; --acu-menu-bg: #fff; --acu-menu-text: #333333; --acu-success-text: #09B83E; --acu-success-bg: rgba(9, 184, 62, 0.12); --acu-scrollbar-track: #F7F7F7; --acu-scrollbar-thumb: #E5E5E5; --acu-hl-manual: #FF9500; --acu-hl-manual-bg: rgba(255, 149, 0, 0.12); --acu-hl-diff: #09B83E; --acu-hl-diff-bg: rgba(9, 184, 62, 0.2); --acu-error-text: #E53E3E; --acu-error-bg: rgba(229, 62, 62, 0.12); --acu-error-border: rgba(229, 62, 62, 0.5); --acu-warning-icon: #FF9500; --acu-failure-text: #E53E3E; --acu-failure-bg: rgba(229, 62, 62, 0.12); --acu-warning-text: #FF9500; --acu-warning-bg: rgba(255, 149, 0, 0.12); --acu-crit-success-text: #07A832; --acu-crit-success-bg: rgba(7, 168, 50, 0.15); --acu-crit-failure-text: #C53030; --acu-crit-failure-bg: rgba(197, 48, 48, 0.15); --acu-extreme-success-text: #09B83E; --acu-extreme-success-bg: rgba(9, 184, 62, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.2); --acu-light-bg: rgba(9, 184, 62, 0.08); --acu-very-light-bg: rgba(9, 184, 62, 0.02); --acu-button-text: #333333; --acu-gray-bg: rgba(9, 184, 62, 0.08); }\n    .acu-theme-educational { --acu-bg-nav: #000000; --acu-bg-panel: #000000; --acu-border: #1B1B1B; --acu-text-main: #FFFFFF; --acu-text-sub: #CCCCCC; --acu-btn-bg: #1B1B1B; --acu-btn-hover: #2B2B2B; --acu-btn-active-bg: #FF9900; --acu-btn-active-text: #000000; --acu-accent: #FF9900; --acu-table-head: #1B1B1B; --acu-table-hover: #2B2B2B; --acu-shadow: rgba(0,0,0,0.6); --acu-card-bg: #1B1B1B; --acu-badge-bg: #1B1B1B; --acu-menu-bg: #000000; --acu-menu-text: #FFFFFF; --acu-success-text: #FF9900; --acu-success-bg: rgba(255, 153, 0, 0.15); --acu-scrollbar-track: #000000; --acu-scrollbar-thumb: #1B1B1B; --acu-input-bg: #1B1B1B; --acu-hl-manual: #FF9900; --acu-hl-manual-bg: rgba(255, 153, 0, 0.15); --acu-hl-diff: #FFB84D; --acu-hl-diff-bg: rgba(255, 184, 77, 0.2); --acu-error-text: #FF6B6B; --acu-error-bg: rgba(255, 107, 107, 0.2); --acu-error-border: rgba(255, 107, 107, 0.5); --acu-warning-icon: #FFAA00; --acu-failure-text: #FF6B6B; --acu-failure-bg: rgba(255, 107, 107, 0.2); --acu-warning-text: #FFAA00; --acu-warning-bg: rgba(255, 170, 0, 0.2); --acu-crit-success-text: #FF9900; --acu-crit-success-bg: rgba(255, 153, 0, 0.2); --acu-crit-failure-text: #FF4444; --acu-crit-failure-bg: rgba(255, 68, 68, 0.2); --acu-extreme-success-text: #FFB84D; --acu-extreme-success-bg: rgba(255, 184, 77, 0.2); --acu-overlay-bg: rgba(0,0,0,0.8); --acu-overlay-bg-light: rgba(0,0,0,0.7); --acu-shadow-bg: rgba(0,0,0,0.6); --acu-light-bg: rgba(255, 153, 0, 0.1); --acu-very-light-bg: rgba(255, 153, 0, 0.02); --acu-button-text: #FFFFFF; --acu-gray-bg: rgba(255, 255, 255, 0.1); }\n    .acu-theme-vaporwave { --acu-bg-nav: #191970; --acu-bg-panel: #191970; --acu-border: rgba(0, 255, 255, 0.3); --acu-text-main: #00FFFF; --acu-text-sub: #FF00FF; --acu-btn-bg: rgba(25, 25, 112, 0.8); --acu-btn-hover: rgba(0, 255, 255, 0.2); --acu-btn-active-bg: #FF00FF; --acu-btn-active-text: #F0F8FF; --acu-accent: #00FFFF; --acu-table-head: rgba(25, 25, 112, 0.9); --acu-table-hover: rgba(0, 255, 255, 0.1); --acu-shadow: 0 0 15px rgba(0, 255, 255, 0.3); --acu-card-bg: rgba(25, 25, 112, 0.95); --acu-badge-bg: rgba(25, 25, 112, 0.8); --acu-menu-bg: #191970; --acu-menu-text: #00FFFF; --acu-success-text: #00FFFF; --acu-success-bg: rgba(0, 255, 255, 0.15); --acu-scrollbar-track: #191970; --acu-scrollbar-thumb: rgba(0, 255, 255, 0.3); --acu-input-bg: rgba(25, 25, 112, 0.6); --acu-hl-manual: #00FFFF; --acu-hl-manual-bg: rgba(0, 255, 255, 0.2); --acu-hl-diff: #FF00FF; --acu-hl-diff-bg: rgba(255, 0, 255, 0.2); --acu-error-text: #FF00FF; --acu-error-bg: rgba(255, 0, 255, 0.2); --acu-error-border: rgba(255, 0, 255, 0.5); --acu-warning-icon: #FF00FF; --acu-failure-text: #FF00FF; --acu-failure-bg: rgba(255, 0, 255, 0.2); --acu-warning-text: #FF00FF; --acu-warning-bg: rgba(255, 0, 255, 0.15); --acu-crit-success-text: #00FFFF; --acu-crit-success-bg: rgba(0, 255, 255, 0.2); --acu-crit-failure-text: #FF00FF; --acu-crit-failure-bg: rgba(255, 0, 255, 0.25); --acu-extreme-success-text: #00FFFF; --acu-extreme-success-bg: rgba(0, 255, 255, 0.2); --acu-overlay-bg: rgba(25, 25, 112, 0.85); --acu-overlay-bg-light: rgba(25, 25, 112, 0.75); --acu-shadow-bg: rgba(0, 255, 255, 0.3); --acu-light-bg: rgba(0, 255, 255, 0.05); --acu-very-light-bg: rgba(0, 255, 255, 0.02); --acu-button-text: #F0F8FF; --acu-gray-bg: rgba(0, 255, 255, 0.1); }\n    .acu-theme-vaporwave .acu-nav-btn { border-color: rgba(0, 255, 255, 0.3); }\n    .acu-theme-vaporwave .acu-data-card { border-color: rgba(0, 255, 255, 0.3); }\n    .acu-theme-vaporwave .acu-dice-panel input::placeholder,\n    .acu-theme-vaporwave .acu-contest-panel input::placeholder {\n        color: #FF00FF !important;\n        opacity: 0.7;\n    }\n    .acu-theme-vaporwave .acu-dice-panel input[type=\"text\"],\n    .acu-theme-vaporwave .acu-dice-panel input[type=\"number\"],\n    .acu-theme-vaporwave .acu-dice-panel input:not([type]),\n    .acu-theme-vaporwave .acu-contest-panel input[type=\"text\"],\n    .acu-theme-vaporwave .acu-contest-panel input[type=\"number\"],\n    .acu-theme-vaporwave .acu-contest-panel input:not([type]) {\n        color: #00FFFF !important;\n    }\n    .acu-theme-classicpackaging { --acu-bg-nav: #000000; --acu-bg-panel: #000000; --acu-border: #FFFF00; --acu-text-main: #FFFF00; --acu-text-sub: #CCCC00; --acu-btn-bg: #FF0000; --acu-btn-hover: #CC0000; --acu-btn-active-bg: #0000FF; --acu-btn-active-text: #FFFF00; --acu-accent: #FF0000; --acu-table-head: #1a1a1a; --acu-table-hover: #2a2a2a; --acu-shadow: rgba(255,255,0,0.3); --acu-card-bg: #1a1a1a; --acu-badge-bg: #FF0000; --acu-menu-bg: #000000; --acu-menu-text: #FFFF00; --acu-success-text: #0000FF; --acu-success-bg: rgba(0, 0, 255, 0.2); --acu-scrollbar-track: #000000; --acu-scrollbar-thumb: #FFFF00; --acu-input-bg: #1a1a1a; --acu-hl-manual: #FF0000; --acu-hl-manual-bg: rgba(255, 0, 0, 0.2); --acu-hl-diff: #0000FF; --acu-hl-diff-bg: rgba(0, 0, 255, 0.2); --acu-error-text: #FF0000; --acu-error-bg: rgba(255, 0, 0, 0.2); --acu-error-border: rgba(255, 0, 0, 0.8); --acu-warning-icon: #FF0000; --acu-failure-text: #FF0000; --acu-failure-bg: rgba(255, 0, 0, 0.2); --acu-warning-text: #FF0000; --acu-warning-bg: rgba(255, 0, 0, 0.15); --acu-crit-success-text: #0000FF; --acu-crit-success-bg: rgba(0, 0, 255, 0.2); --acu-crit-failure-text: #FF0000; --acu-crit-failure-bg: rgba(255, 0, 0, 0.25); --acu-extreme-success-text: #0000FF; --acu-extreme-success-bg: rgba(0, 0, 255, 0.2); --acu-overlay-bg: rgba(0,0,0,0.9); --acu-overlay-bg-light: rgba(0,0,0,0.8); --acu-shadow-bg: rgba(0,0,0,0.6); --acu-light-bg: rgba(255,255,0,0.1); --acu-very-light-bg: rgba(255,255,0,0.02); --acu-button-text: #FFFF00; --acu-gray-bg: rgba(255,255,0,0.1); }\n    .acu-theme-classicpackaging .acu-nav-btn { border-color: #FFFF00; border-width: 2px; font-weight: bold; }\n    .acu-theme-classicpackaging .acu-data-card { border-color: #FFFF00; border-width: 2px; }\n    .acu-theme-classicpackaging .acu-dice-panel input::placeholder,\n    .acu-theme-classicpackaging .acu-contest-panel input::placeholder {\n        color: #666600 !important;\n        opacity: 0.7;\n    }\n    .acu-theme-classicpackaging .acu-dice-panel input[type=\"text\"],\n    .acu-theme-classicpackaging .acu-dice-panel input[type=\"number\"],\n    .acu-theme-classicpackaging .acu-dice-panel input:not([type]),\n    .acu-theme-classicpackaging .acu-contest-panel input[type=\"text\"],\n    .acu-theme-classicpackaging .acu-contest-panel input[type=\"number\"],\n    .acu-theme-classicpackaging .acu-contest-panel input:not([type]) {\n        color: #FFFF00 !important;\n        font-weight: bold;\n    }\n    .acu-theme-galgame { --acu-bg-nav: #FFF0F5; --acu-bg-panel: #FFF0F5; --acu-border: #F0D4E4; --acu-text-main: #6B4A5A; --acu-text-sub: #B08A9A; --acu-btn-bg: #FFE4E9; --acu-btn-hover: #FFD4E4; --acu-btn-active-bg: #E8B4D9; --acu-btn-active-text: #6B4A5A; --acu-accent: #E8B4D9; --acu-table-head: #FFF5F9; --acu-table-hover: #FFF0F8; --acu-shadow: rgba(232, 180, 217, 0.25); --acu-card-bg: #ffffff; --acu-badge-bg: #FFF5F9; --acu-menu-bg: #fff; --acu-menu-text: #6B4A5A; --acu-success-text: #D4A5C8; --acu-success-bg: rgba(212, 165, 200, 0.15); --acu-scrollbar-track: #FFF0F5; --acu-scrollbar-thumb: #F0D4E4; --acu-input-bg: #FFF8FA; --acu-hl-manual: #D4A5A5; --acu-hl-manual-bg: rgba(212, 165, 165, 0.15); --acu-hl-diff: #E8B4D9; --acu-hl-diff-bg: rgba(232, 180, 217, 0.2); --acu-error-text: #C88A9A; --acu-error-bg: rgba(200, 138, 154, 0.15); --acu-error-border: rgba(200, 138, 154, 0.4); --acu-warning-icon: #D4A5A5; --acu-failure-text: #C88A9A; --acu-failure-bg: rgba(200, 138, 154, 0.15); --acu-warning-text: #D4A5A5; --acu-warning-bg: rgba(212, 165, 165, 0.15); --acu-crit-success-text: #E8B4D9; --acu-crit-success-bg: rgba(232, 180, 217, 0.2); --acu-crit-failure-text: #C88A9A; --acu-crit-failure-bg: rgba(200, 138, 154, 0.2); --acu-extreme-success-text: #D4A5C8; --acu-extreme-success-bg: rgba(212, 165, 200, 0.2); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(232, 180, 217, 0.25); --acu-light-bg: rgba(232, 180, 217, 0.08); --acu-very-light-bg: rgba(232, 180, 217, 0.02); --acu-button-text: #6B4A5A; --acu-button-text-on-accent: #6B4A5A; --acu-gray-bg: rgba(232, 180, 217, 0.1); }\n    .acu-theme-galgame .acu-nav-btn { border-radius: 8px; transition: all 0.3s ease; }\n    .acu-theme-galgame .acu-data-card { border-radius: 12px; box-shadow: 0 4px 12px rgba(232, 180, 217, 0.15); transition: all 0.3s ease; }\n    .acu-theme-galgame .acu-data-card:hover { box-shadow: 0 6px 20px rgba(232, 180, 217, 0.25); transform: translateY(-2px); }\n    .acu-theme-galgame .acu-nav-btn:hover { box-shadow: 0 2px 8px rgba(232, 180, 217, 0.2); }\n    /* Night Owl */\n    .acu-theme-nightowl .acu-table-manager-item,\n    .acu-theme-nightowl .acu-validation-rule-item {\n        border-color: var(--acu-border) !important;\n    }\n    .acu-theme-nightowl .acu-table-manager-item:hover,\n    .acu-theme-nightowl .acu-validation-rule-item:hover {\n        border-color: rgba(127, 219, 202, 0.4) !important;\n    }\n    /* Night Owl */\n    .acu-theme-nightowl .acu-preset-item {\n        border-color: var(--acu-border) !important;\n    }\n    .acu-theme-nightowl .acu-preset-item:hover {\n        border-color: rgba(127, 219, 202, 0.4) !important;\n    }\n    .acu-wrapper { position: relative; width: 100%; margin: 15px 0; z-index: 2147483640 !important; font-family: 'Microsoft YaHei', sans-serif; display: flex; flex-direction: column-reverse; }\n    .acu-wrapper.acu-mode-embedded { position: relative !important; width: 100% !important; margin-top: 8px !important; z-index: 2147483641 !important; clear: both; display: flex; flex-direction: column-reverse !important; padding: 0; }\n    .acu-wrapper.acu-mode-embedded .acu-nav-container { position: relative !important; z-index: 2147483642 !important; }\n    .acu-wrapper.acu-mode-embedded .acu-data-display { position: absolute !important; bottom: 100% !important; left: 0 !important; right: 0 !important; width: 100% !important; box-shadow: 0 -10px 30px rgba(0,0,0,0.25) !important; border: 1px solid var(--acu-border); margin-bottom: 5px; z-index: 2147483647 !important; max-height: 70vh !important; overflow-y: auto !important; }\n    .acu-nav-container { display: grid; grid-template-columns: repeat(var(--acu-grid-cols, 3), 1fr); gap: 4px; padding: 6px; background: var(--acu-bg-nav); border: 1px solid var(--acu-border); border-radius: 10px; align-items: center; box-shadow: 0 2px 6px var(--acu-shadow); position: relative; z-index: 2147483641 !important; }\n    .acu-nav-btn { touch-action: manipulation; -webkit-tap-highlight-color: transparent; width: 100%; display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 3px; padding: 4px 2px; border: 1px solid transparent; border-radius: 6px; background: var(--acu-btn-bg); color: var(--acu-text-main); font-weight: 600; font-size: 11px; cursor: pointer; transition: all 0.2s ease; user-select: none; overflow: hidden; height: 28px; }\n    .acu-nav-btn span { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; margin-top: 1px; }\n    .acu-nav-btn:hover { background: var(--acu-btn-hover); transform: translateY(-2px); }\n    .acu-nav-btn:focus, .acu-nav-btn:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--acu-accent) !important; }\n    /* []  */\n/* --- 1.  --- */\n.acu-height-control {\n    display: flex;\n    align-items: center;\n    margin-right: 8px;\n    cursor: ns-resize;\n    padding: 4px;\n    border-radius: 4px;\n    color: var(--acu-text-sub);\n    transition: all 0.2s;\n    /*  */\n    touch-action: none;\n}\n\n/*  */\n.acu-height-control:hover, .acu-height-control.active {\n    color: var(--acu-accent);\n    background: var(--acu-table-hover);\n}\n\n/* --- 2. []  --- */\n.acu-height-drag-handle {\n    cursor: ns-resize;\n    /*  */\n    touch-action: none;\n}\n\n            /*  */\n            .acu-view-btn { background: transparent !important; border: none; color: var(--acu-text-main) !important; cursor: pointer; padding: 4px; margin-right: 5px; font-size: 14px; opacity: 0.7; }\n            .acu-view-btn:hover { opacity: 1; color: var(--acu-accent) !important; background: var(--acu-table-hover) !important; border-radius: 4px; }\n            .acu-view-btn.acu-reverse-btn.active, .acu-reverse-btn[data-reversed=\"true\"] { color: var(--acu-accent) !important; opacity: 1; }\n            /* Grid  () */\n            .acu-card-body.view-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }\n            /*  Grid  Flex  */\n.acu-card-body.view-grid .acu-card-row { display: flex; height: auto !important; min-height: fit-content; border: 1px solid var(--acu-border); border-radius: 6px; padding: 4px 6px; flex-direction: column !important; align-items: flex-start !important; background: rgba(0,0,0,0.02); box-sizing: border-box; }\n            .acu-card-body.view-grid .acu-card-row.acu-grid-span-full { grid-column: 1 / -1; }\n            .acu-card-body.view-grid .acu-card-label { width: 100% !important; font-size: 0.85em; opacity: 0.8; margin-bottom: 2px; }\n            .acu-card-body.view-grid .acu-card-value { width: 100% !important; }\n\n            /* List  ( - ) */\n            .acu-nav-btn.active { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); box-shadow: inset 0 1px 3px rgba(0,0,0,0.2); outline: none; border-color: transparent; }\n            .acu-nav-btn.active:hover { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); transform: none; }\n            .acu-nav-btn.active:focus, .acu-nav-btn.active:focus-visible { outline: none; box-shadow: inset 0 1px 3px rgba(0,0,0,0.2) !important; }\n            .acu-nav-btn.has-validation-errors { border-color: rgba(231, 76, 60, 0.5); }\n            .acu-nav-btn .acu-nav-warning-icon { color: var(--acu-error-text, #e74c3c); font-size: 10px; margin-left: 2px; animation: pulse 1.5s infinite; }\n            @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }\n            .acu-action-btn { flex: 1; height: 36px; display: flex; align-items: center; justify-content: center; background: var(--acu-btn-bg); border-radius: 8px; color: var(--acu-text-sub); cursor: pointer; border: 1px solid transparent; transition: all 0.2s; margin: 0; }\n            .acu-action-btn:hover { background: var(--acu-btn-hover); color: var(--acu-text-main); transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }\n            .acu-action-btn:focus, .acu-action-btn:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--acu-accent) !important; }\n            #acu-btn-save-global { color: var(--acu-btn-active-bg); } #acu-btn-save-global:hover { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); }\n\n            .acu-data-display { position: absolute; bottom: calc(100% + 10px); left: 0; right: 0; max-height: 80vh; height: auto; background: var(--acu-bg-panel); border: 1px solid var(--acu-border); border-radius: 8px; box-shadow: 0 8px 30px var(--acu-shadow); display: none; flex-direction: column; z-index: 2147483642 !important; animation: popUp 0.2s cubic-bezier(0.18, 0.89, 0.32, 1.28); }\n            .acu-data-display.visible { display: flex; }\n            @keyframes popUp { from { opacity: 0; transform: translateY(10px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }\n            @keyframes highlightFlash { 0%, 100% { box-shadow: none; } 50% { box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.6); } }\n            .acu-highlight-flash { animation: highlightFlash 0.5s ease-in-out 3; }\n\n            .acu-panel-header { flex: 0 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: var(--acu-table-head); border-bottom: 1px dashed var(--acu-border); border-radius: 8px 8px 0 0; }\n            /*  flex: 1  min-width: 0 */\n/* ---  --- */\n.acu-panel-title {\n    display: flex;\n    flex-direction: column; /*  */\n    justify-content: center;\n    align-items: flex-start;\n    flex: 1; /*  */\n    min-width: 0; /*  */\n    margin-right: 8px;\n    overflow: hidden;\n}\n\n/*  () */\n.acu-title-main {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n    font-size: 13px; /*  */\n    font-weight: bold;\n    color: var(--acu-text-main);\n    line-height: 1.2;\n}\n\n/*  () */\n.acu-title-text {\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/*  () */\n.acu-title-sub {\n    font-size: 10px;\n    color: var(--acu-text-sub);\n    font-weight: normal;\n    opacity: 0.8;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    width: 100%;\n    line-height: 1.2;\n    margin-top: 1px;\n}\n            /*  flex-shrink: 0;  */\n/* flex-shrink: 0  */\n.acu-header-actions { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }\n            .acu-search-wrapper { position: relative; display: flex; align-items: center; }\n            .acu-wrapper input.acu-search-input { background: var(--acu-btn-bg) !important; border: 1px solid var(--acu-border) !important; color: var(--acu-text-main) !important; padding: 4px 8px 4px 24px; border-radius: 12px; font-size: 12px; width: 120px; transition: width 0.2s, border-color 0.2s; }\n            .acu-wrapper input.acu-search-input::placeholder { color: var(--acu-text-sub) !important; opacity: 0.7; }\n            .acu-wrapper input.acu-search-input:focus { width: 160px; outline: none !important; border-color: var(--acu-accent) !important; box-shadow: none !important; }\n            .acu-search-input::placeholder { color: var(--acu-text-sub) ; opacity: 0.7; }\n            .acu-search-icon { position: absolute; left: 8px; font-size: 10px; color: var(--acu-text-sub); pointer-events: none; }\n            /*  min-width  flex-shrink: 0 */\n            .acu-panel-content { flex: 1; overflow-x: auto; overflow-y: hidden; padding: 15px; background: transparent; scrollbar-width: thin; scrollbar-color: var(--acu-scrollbar-thumb) var(--acu-scrollbar-track); overscroll-behavior-x: contain; overscroll-behavior-y: auto; touch-action: pan-x pan-y; -webkit-overflow-scrolling: touch; }\n            /*  height: 100%;  */\n.acu-card-grid { display: flex; flex-wrap: nowrap; gap: 12px; align-items: flex-start; }\n            .acu-layout-vertical .acu-panel-content { overflow-x: hidden !important; overflow-y: auto !important; overscroll-behavior: auto; touch-action: manipulation; min-height: 0; }\n            /*  auto  */\n.acu-layout-vertical .acu-card-grid { flex-wrap: wrap !important; justify-content: center; padding-bottom: 20px; height: auto; }\n.acu-wrapper:not(.acu-layout-vertical) .acu-manual-mode .acu-card-grid { height: 100%; } .acu-manual-mode .acu-data-card { max-height: 100% !important; overscroll-behavior-y: auto; } .acu-data-card { flex: 0 0 var(--acu-card-width, 260px); width: var(--acu-card-width, 260px); background: var(--acu-card-bg); border: 1px solid var(--acu-border); border-radius: 8px; height: auto; max-height: 60vh; overflow-y: auto; overscroll-behavior-y: auto; touch-action: manipulation; transition: all 0.2s ease; display: flex; flex-direction: column; position: relative; }\n            .acu-data-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px var(--acu-shadow); border-color: var(--acu-accent); }\n            .acu-data-card.pending-deletion { opacity: 0.6; border: 1px dashed var(--acu-error-text, #e74c3c); }\n            .acu-data-card.pending-deletion::after { content: \"\"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); color: var(--acu-error-text, #e74c3c); font-size: 24px; font-weight: bold; border: 2px solid var(--acu-error-text, #e74c3c); padding: 5px 10px; border-radius: 8px; opacity: 0.8; pointer-events: none; }\n            @keyframes pulse-highlight { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }\n            .acu-highlight-manual { color: var(--acu-hl-manual) !important; background-color: var(--acu-hl-manual-bg) !important; border-radius: 4px; padding: 0 4px; font-weight: bold; animation: pulse-highlight 2s infinite; display: inline-block; }\n            .acu-highlight-diff { color: var(--acu-hl-diff) !important; background-color: var(--acu-hl-diff-bg) !important; border-radius: 4px; padding: 0 4px; font-weight: bold; animation: pulse-highlight 2s infinite; display: inline-block; }\n            .acu-editable-title.acu-highlight-manual, .acu-editable-title.acu-highlight-diff { width: auto; display: inline-block; }\n            .acu-card-header { flex: 0 0 auto; padding: 8px 10px; background: var(--acu-table-head); border-bottom: 1px dashed var(--acu-border); font-weight: bold; color: var(--acu-text-main); font-size: 14px; display: flex; flex-direction: row !important; align-items: center !important; justify-content: flex-start !important; gap: 8px; min-height: 40px; height: auto !important; position: relative; }\n            .acu-editable-title { flex: 1; width: auto !important; cursor: pointer; border-bottom: 1px dashed transparent; transition: all 0.2s; white-space: pre-wrap !important; overflow: visible !important; word-break: break-word !important; text-align: center; line-height: 1.3; margin: 0; }\n            .acu-editable-title:hover { border-bottom-color: var(--acu-accent); color: var(--acu-accent); }\n            .acu-card-index { position: static !important; transform: none !important; margin: 0; flex-shrink: 0; font-size: 11px; color: var(--acu-text-sub); font-weight: normal; background: var(--acu-badge-bg); padding: 2px 6px; border-radius: 4px; }\n            .acu-bookmark-icon { position: absolute; top: 8px; right: 8px; color: var(--acu-accent); cursor: pointer; font-size: 16px; opacity: 0.3; transition: opacity 0.2s, color 0.2s, transform 0.2s; z-index: 10; }\n            .acu-bookmark-icon:hover { opacity: 0.6; transform: scale(1.1); }\n            .acu-bookmark-icon.bookmarked { color: var(--acu-accent); opacity: 1; }\n            .acu-card-body { padding: 6px 12px; display: flex; flex-direction: column; gap: 0; font-size: var(--acu-font-size, 13px); flex: 1; }\n            .acu-card-row { display: block; padding: 6px 0; border-bottom: 1px dashed var(--acu-border); cursor: pointer; overflow: hidden; }\n            .acu-card-row:last-child { border-bottom: none; }\n            .acu-card-actions { display: flex; flex-wrap: wrap; gap: 6px; padding: 8px 10px; border-top: 1px dashed var(--acu-border); background: var(--acu-table-head); }\n            .acu-action-item { padding: 4px 10px; font-size: 11px; border: 1px solid var(--acu-border); border-radius: 4px; background: var(--acu-btn-bg); color: var(--acu-text-main); cursor: pointer; display: flex; align-items: center; gap: 4px; transition: all 0.15s; white-space: nowrap; }\n            .acu-action-item:hover { background: var(--acu-btn-hover); border-color: var(--acu-accent); color: var(--acu-accent); transform: translateY(-1px); }\n            .acu-action-item:active { transform: translateY(0); }\n            .acu-action-item.check-type { border-style: dashed; }\n            .acu-action-item i { font-size: 10px; opacity: 0.7; }\n            .acu-card-row:hover { background: var(--acu-table-hover); }\n            .acu-card-label { float: left !important; clear: left; width: auto !important; margin-right: 8px !important; color: var(--acu-text-sub); font-size: 0.9em; line-height: 1.5; padding-top: 0; }\n            .acu-hide-label .acu-card-label { display: none; }\n            .acu-hide-label .acu-card-value { width: 100% !important; }\n            .acu-inline-dice-btn:hover { opacity: 1 !important; transform: scale(1.2); }\n            .acu-card-value { display: block; width: auto !important; margin: 0; text-align: left !important; word-break: break-all !important; white-space: pre-wrap !important; line-height: 1.5 !important; color: var(--acu-text-main); font-size: 1em; }\n            .acu-tag-container { display: flex; flex-wrap: wrap; gap: 4px; align-items: center; margin-top: 2px; }\n            .acu-multi-attr-container { display: grid; grid-template-columns: 1fr 1fr; gap: 2px 8px; }\n            .acu-badge { display: inline-block; padding: 1px 8px; border-radius: 12px; font-size: 0.9em; font-weight: 500; line-height: 1.2; }\n            .acu-badge-green { background: var(--acu-success-bg); color: var(--acu-success-text); }\n            .acu-badge-neutral { background: var(--acu-badge-bg); color: var(--acu-text-main); border: 1px solid var(--acu-border); }\n            .acu-panel-footer { flex: 0 0 auto; padding: 8px; border-top: 1px dashed var(--acu-border); background: var(--acu-table-head); display: flex; justify-content: center; align-items: center; gap: 5px; flex-wrap: wrap; }\n            .acu-page-btn { padding: 4px 10px; min-width: 32px; height: 28px; border-radius: 4px; border: 1px solid var(--acu-border); background: var(--acu-btn-bg); color: var(--acu-text-main); cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }\n            .acu-page-btn:hover:not(.disabled):not(.active) { background: var(--acu-btn-hover); transform: translateY(-1px); }\n            .acu-page-btn.active { background: var(--acu-accent); color: var(--acu-button-text-on-accent, #fff); border-color: var(--acu-accent); font-weight: bold; }\n            .acu-page-btn.disabled { opacity: 0.5; cursor: not-allowed; }\n            .acu-page-info { font-size: 12px; color: var(--acu-text-sub); margin: 0 10px; }\n            /* --- []  --- */\n            /*  Flex Column  */\n            /* --- []  --- */\n            .acu-option-panel {\n                display: flex;\n                flex-direction: column;\n                gap: 2px;                 /*  */\n                padding: 4px;             /*  */\n                background: var(--acu-bg-nav);\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;       /*  */\n                margin-top: 0;\n                margin-bottom: 4px;\n                backdrop-filter: blur(5px);\n                width: 100%;\n                box-sizing: border-box;\n                z-index: 2147483641;\n                animation: acuFadeIn 0.3s ease;\n            }\n\n            .acu-embedded-options-container {\n                width: 100%;\n                max-width: 100%;\n                margin-top: 6px;\n                clear: both;\n                animation: acuFadeIn 0.3s ease;\n            }\n\n            .acu-opt-header {\n                text-align: center;\n                font-size: 10px;          /*  */\n                font-weight: bold;\n                color: var(--acu-text-sub);\n                padding-bottom: 2px;\n                border-bottom: 1px dashed var(--acu-border);\n                margin-bottom: 2px;\n            }\n\n            /* --- []  --- */\n            .acu-opt-btn {\n                background: var(--acu-btn-bg);\n                border: 1px solid transparent; /*  */\n                padding: 3px 6px;              /*  */\n                border-radius: 4px;\n                cursor: pointer;\n                color: var(--acu-text-main);\n                font-size: var(--acu-opt-font-size, 12px) !important; /* []  */\n                transition: all 0.15s;\n                font-weight: normal;           /*  */\n                text-align: left;              /*  */\n                white-space: pre-wrap;\n                word-break: break-word;\n                min-height: 22px;              /*  */\n                line-height: 1.3;\n                display: flex;\n                align-items: center;\n                justify-content: flex-start;\n                opacity: 0.9;\n            }\n\n            .acu-opt-btn:hover {\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent); /*  */\n                transform: translateX(3px);      /*  */\n                opacity: 1;\n            }\n            .acu-opt-btn:active { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); }\n            @keyframes acuFadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }\n\n            .acu-menu-backdrop { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: transparent; z-index: 2147483645 !important; }\n            /* 1.  */\n.acu-cell-menu {\n    position: fixed !important;\n    background: var(--acu-menu-bg) !important;\n    border: 1px solid var(--acu-border);\n    box-shadow: 0 6px 20px var(--acu-shadow) !important;\n    z-index: 2147483647 !important;\n    border-radius: 8px;\n    overflow: hidden;\n    min-width: 150px;\n    color: var(--acu-menu-text);\n}\n\n/* 2.  */\n.acu-cell-menu-item {\n    padding: 12px 16px;\n    cursor: pointer;\n    font-size: 14px;\n    display: flex;\n    gap: 12px;\n    align-items: center;\n    color: var(--acu-menu-text);\n    font-weight: 500;\n    background: transparent;\n    transition: background 0.2s;\n}\n\n/* 3.  */\n.acu-cell-menu-item:hover {\n    background: var(--acu-table-hover);\n}\n\n/* 4.  */\n            .acu-cell-menu-item#act-delete { color: var(--acu-error-text, #e74c3c); }\n            .acu-cell-menu-item#act-delete:hover { background: var(--acu-error-bg, rgba(231, 76, 60, 0.1)); } /*  */\n            .acu-cell-menu-item#act-close { border-top: 1px dashed var(--acu-border); color: var(--acu-text-sub); }\n            .acu-edit-overlay { position: fixed !important; top: 0; left: 0; right: 0; bottom: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.75) !important; z-index: 2147483646 !important; display: flex; justify-content: center !important; align-items: center !important; backdrop-filter: blur(2px); }\n            .acu-edit-dialog { background: var(--acu-bg-panel); width: 95%; max-width: 500px; max-height: 95vh; padding: 16px; border-radius: 12px; display: flex; flex-direction: column; gap: 10px; box-shadow: 0 15px 50px rgba(0,0,0,0.6); color: var(--acu-text-main); border: 1px solid var(--acu-border); overflow: hidden; flex-shrink: 0; }\n            @media (min-width: 768px) { .acu-edit-dialog { max-width: 900px; width: 90%; } .acu-edit-dialog.acu-settings-dialog { max-width: 400px; width: 400px; } }\n            .acu-edit-title { margin: 0; font-size: 16px; font-weight: bold; color: var(--acu-text-main); padding-bottom: 8px; border-bottom: 1px solid var(--acu-border); }\n            .acu-edit-textarea { width: 100%; height: auto; padding: 12px; border: 1px solid var(--acu-border) !important; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; border-radius: 6px; resize: vertical; box-sizing: border-box; font-size: 14px; line-height: 1.6; overflow-y: auto !important; }\n            .acu-edit-textarea:focus { outline: none; border-color: var(--acu-accent) !important; }\n            .acu-edit-textarea::placeholder { color: var(--acu-text-sub) !important; opacity: 0.7; }\n            @media (min-width: 768px) { .acu-edit-textarea { height: auto !important; font-size: 15px !important; } }\n            .acu-edit-textarea:focus { outline: 1px solid #aaa; }\n            .acu-dialog-btns { display: flex; justify-content: flex-end; gap: 20px; margin-top: 10px; }\n            .acu-dialog-btn { background: none; border: none; cursor: pointer; font-size: 14px; font-weight: bold; display: flex; align-items: center; gap: 6px; color: var(--acu-text-sub); transition: color 0.2s; }\n            .acu-dialog-btn:hover { color: var(--acu-text-main); } .acu-btn-confirm { color: var(--acu-success-text); } .acu-btn-confirm:hover { opacity: 0.8; }\n            /* --- [UI Optimization] PC-First Edit Mode Styles --- */\n            .acu-order-controls { grid-column: 1 / -1; order: -2; display: none; width: 100%; text-align: left; background: var(--acu-accent); color: var(--acu-button-text-on-accent, var(--acu-text-main)); padding: 6px 12px; margin: 0 0 8px 0; border-radius: 4px; font-weight: bold; font-size: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }\n            .acu-order-controls.visible { display: flex; align-items: center; justify-content: space-between; }\n\n            .acu-nav-container.editing-order { border: 2px solid var(--acu-accent); background: var(--acu-bg-panel); }\n            .acu-nav-container.editing-order .acu-nav-btn, .acu-nav-container.editing-order .acu-action-btn { opacity: 1 !important; cursor: grab !important; border: 1px solid var(--acu-border); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }\n            .acu-nav-container.editing-order .acu-nav-btn:hover, .acu-nav-container.editing-order .acu-action-btn:hover { border-color: var(--acu-accent); transform: translateY(-1px); }\n\n            .acu-swap-selected { background-color: var(--acu-accent) !important; color: var(--acu-button-text-on-accent, var(--acu-text-main)) !important; border-color: var(--acu-accent); box-shadow: 0 0 0 2px rgba(255,255,255,0.5), 0 4px 12px rgba(0,0,0,0.2); transform: scale(1.05); z-index: 10; }\n            .acu-drag-over { border: 2px dashed var(--acu-accent); opacity: 0.5; transform: scale(0.95); background: rgba(var(--acu-accent-rgb), 0.1); }\n\n            /* --- [PC Style] Unused Pool Optimization () --- */\n            .acu-unused-pool {\n                grid-column: 1 / -1;\n                display: none;\n                flex-wrap: wrap;\n                gap: 8px;\n                background: var(--acu-table-head); /*  */\n                border: 1px dashed var(--acu-border); /*  */\n                padding: 10px 15px;\n                margin: 0 0 10px 0;\n                border-radius: 8px;\n                justify-content: flex-start;\n                align-items: center;\n                min-height: 50px;\n                box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);\n            }\n            .acu-unused-pool.visible { display: flex; animation: acuFadeIn 0.2s ease-out; }\n\n            /* PC */\n            .acu-unused-pool::before {\n                content: \" ( )\";\n                display: flex;\n                align-items: center;\n                height: 32px;\n                font-size: 12px;\n                font-weight: bold;\n                color: var(--acu-text-sub);\n                margin-right: 15px;\n                padding-right: 15px;\n                border-right: 1px solid var(--acu-border);\n                white-space: nowrap;\n                opacity: 0.8;\n            }\n\n            .acu-actions-group { grid-column: 1 / -1; display: flex; justify-content: flex-end; gap: 4px; border-top: 1px dashed var(--acu-border); padding-top: 8px; margin-top: 4px; min-height: 36px; transition: all 0.2s; }\n\n            /* []  */\n            .acu-pos-top .acu-actions-group { order: -1; border-top: none; border-bottom: 1px dashed var(--acu-border); margin-top: 0; margin-bottom: 6px; padding-top: 0; padding-bottom: 8px; }\n\n            /* []  */\n            .acu-pos-top .acu-unused-pool { order: -1; margin-bottom: 10px; border-bottom: 1px dashed var(--acu-border); }\n            .acu-actions-group.dragging-over { background: rgba(127, 127, 127, 0.05); box-shadow: inset 0 0 10px rgba(0,0,0,0.05); }\n\n            /*  */\n                .acu-dash-body.acu-dash-horizontal {\n                    display: flex;\n                    flex-wrap: nowrap;\n                    gap: 15px;\n                    overflow-x: auto;\n                    overflow-y: hidden;\n                    padding-bottom: 10px;\n                }\n                .acu-dash-body.acu-dash-horizontal > div {\n                    flex: 0 0 280px;\n                    min-width: 280px;\n                    max-height: 60vh;\n                    overflow-y: auto;\n                }\n                @media (min-width: 769px) {\n                    .acu-dash-body.acu-dash-horizontal > div {\n                        flex: 0 0 320px;\n                        min-width: 320px;\n                    }\n                }\n            /* Mobile adjustments to keep it usable there */\n            @media (max-width: 768px) {\n                .acu-unused-pool { justify-content: center; background: rgba(0,0,0,0.05); border: 1px dashed var(--acu-border); border-bottom: none; margin: 0 0 8px 0; border-radius: 6px; }\n                .acu-unused-pool::before { display: block; width: 100%; text-align: center; margin-bottom: 4px; content: \" ()\"; }\n                .acu-order-controls { flex-direction: column; gap: 6px; text-align: center; }\n            }\n            .acu-actions-group.dragging-over { background: rgba(var(--acu-accent-rgb), 0.1); border-color: var(--acu-accent); }\n            .acu-settings-item { margin-bottom: 15px; }\n            .acu-settings-label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 13px; color: #ccc; }\n            .acu-settings-val { float: right; color: #4cd964; font-size: 12px; }\n            .acu-slider { width: 100%; height: 4px; background: #555; border-radius: 2px; outline: none; -webkit-appearance: none; }\n            .acu-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: #fff; border-radius: 50%; cursor: pointer; }\n            .acu-select { width: 100%; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid #555; color: #fff; border-radius: 4px; outline: none; }\n            .acu-edit-overlay input[type=\"checkbox\"].acu-checkbox { margin-right: 10px; accent-color: var(--acu-accent) !important; background: transparent !important; background-color: transparent !important; }\n            .acu-btn-block { width: 100%; padding: 10px; background: #444; color: #eee; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 10px; }\n            .acu-btn-block:hover { background: #555; color: #fff; }\n            .acu-expand-trigger { background: var(--acu-bg-nav); border: 1px solid var(--acu-border); box-shadow: 0 2px 6px var(--acu-shadow); cursor: pointer; color: var(--acu-text-main); font-size: 13px; font-weight: bold; display: flex; align-items: center; gap: 6px; transition: all 0.2s; z-index: 2147483645 !important; }\n            .acu-expand-trigger:hover { background: var(--acu-btn-hover); transform: translateY(-2px); }\n            .acu-col-bar { width: 100%; justify-content: center; padding: 8px 10px; border-radius: 6px; }\n            .acu-col-pill { width: auto !important; padding: 6px 16px; border-radius: 50px; }\n            .acu-col-mini { width: 40px !important; height: 40px !important; padding: 0; justify-content: center; border-radius: 50%; }\n            .acu-col-mini span { display: none; }\n            /* []  */\n            .acu-nav-toggle-btn:hover { opacity: 1 !important; transform: translateY(-50%) scale(1.2); color: var(--acu-accent); }\n            .acu-align-right { margin-left: auto; align-self: flex-end; }\n            .acu-align-left { margin-right: auto; margin-left: 0; align-self: flex-start; }\n            .acu-nav-container.acu-left-mode .acu-actions-group { order: -1; margin-left: 0; margin-right: 10px; }\n            #acu-btn-collapse { color: var(--acu-text-sub); }\n            #acu-btn-collapse:hover { color: var(--acu-text-main); background: rgba(0,0,0,0.05); }\n            @keyframes acu-breathe { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.6; transform: scale(0.85); color: #ff7e67; } 100% { opacity: 1; transform: scale(1); } } .acu-icon-breathe { animation: acu-breathe 3s infinite ease-in-out !important; display: inline-block; }\n\n            @media (min-width: 768px) {\n                .acu-wrapper.acu-mode-embedded .acu-nav-container { width: fit-content !important; min-width: 300px; max-width: 100%; margin: 0 auto; border-radius: 50px; box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important; border: 1px solid var(--acu-border); padding: 6px 20px; background: var(--acu-bg-nav) !important; }\n                .acu-wrapper.acu-mode-embedded .acu-data-display { bottom: calc(100% + 12px) !important; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2) !important; }\n                .acu-nav-container { display: flex; flex-wrap: wrap !important; gap: 6px !important; padding: 6px 10px; grid-template-columns: none !important; flex-direction: row !important; justify-content: flex-start !important; align-items: center !important; height: auto !important; }\n                .acu-nav-container .acu-nav-btn { width: fit-content !important; flex: 0 0 auto !important; height: 32px !important; padding: 0 12px; font-size: 13px !important; min-width: auto !important; }\n                .acu-nav-btn span { max-width: 200px; }\n                .acu-action-btn { flex: 0 0 32px !important; width: 32px !important; height: 32px !important; background: transparent !important; color: var(--acu-text-sub) !important; border-radius: 6px; border: 1px solid transparent; }\n                .acu-action-btn:hover { background: var(--acu-btn-hover) !important; color: var(--acu-text-main) !important; transform: scale(1.1); box-shadow: none; }\n                #acu-btn-save-global { color: var(--acu-accent) !important; }\n                #acu-btn-save-global:hover { background: var(--acu-accent) !important; color: #fff !important; }\n                .acu-order-controls { margin: 0 0 8px 0; padding: 4px; }\n                .acu-actions-group { width: auto !important; margin-left: auto !important; border-top: none !important; border-bottom: none !important; padding: 0; margin-top: 0 !important; margin-bottom: 0 !important; gap: 4px !important; background: transparent; justify-content: flex-end; order: 9999 !important; display: flex; }\n                .acu-pos-top .acu-actions-group { order: -1 !important; margin-left: 0 !important; margin-right: 10px !important; justify-content: flex-start !important; }\n            }\n            @media (max-width: 768px) {\n                .acu-panel-content { -webkit-overflow-scrolling: touch !important; overscroll-behavior-y: auto; }\n                .acu-data-card { box-shadow: none !important; border: 1px solid var(--acu-border); transform: translateZ(0); }\n                .acu-data-card:hover { transform: none !important; box-shadow: none !important; }\n                .acu-nav-btn:hover { transform: none !important; }\n            }\n            /* ===  === */\n            @media (max-width: 768px) {\n                .acu-dice-panel, .acu-contest-panel {\n                    position: fixed !important;\n                    top: 5% !important;\n                    left: 50% !important;\n                    transform: translateX(-50%) !important;\n                    width: 92vw !important;\n                    max-width: 400px !important;\n                    max-height: 88vh !important;\n                    overflow-y: auto !important;\n                }\n                .acu-dice-panel > div:last-child, .acu-contest-panel > div:last-child {\n                    max-height: none !important;\n                    overflow-y: visible !important;\n                }\n                .acu-dice-overlay, .acu-contest-overlay {\n                    align-items: flex-start !important;\n                    padding-top: 5vh !important;\n                }\n            }\n                /* ===  === */\n                .acu-dash-body {\n                    display: grid;\n                    grid-template-columns: 1fr 1.2fr 1fr;\n                    gap: 15px;\n                    margin: 15px 0;\n                }\n\n                .acu-dash-locations {\n                    background: var(--acu-card-bg);\n                    padding: 12px;\n                    border-radius: 8px;\n                    border: 1px solid var(--acu-border);\n                }\n\n                .acu-dash-locations h3 {\n                    margin: 0 0 10px 0;\n                    font-size: 14px;\n                    color: var(--acu-accent);\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                }\n\n                .acu-location-group {\n                    margin-bottom: 8px;\n                    border-radius: 6px;\n                    overflow: hidden;\n                    background: var(--acu-card-bg);\n                    border: 1px solid transparent;\n                    transition: all 0.2s;\n                }\n\n                .acu-location-group.expanded {\n                    border-color: var(--acu-accent);\n                }\n\n                .acu-location-header {\n                    padding: 8px 10px;\n                    cursor: pointer;\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                    background: var(--acu-table-head);\n                    transition: all 0.2s;\n                    user-select: none;\n                }\n\n                .acu-location-header:hover {\n                    background: var(--acu-table-hover);\n                }\n\n                .acu-expand-icon {\n                    font-size: 10px;\n                    transition: transform 0.2s;\n                    color: var(--acu-text-sub);\n                }\n\n                .acu-location-group.expanded .acu-expand-icon {\n                    transform: rotate(90deg);\n                    color: var(--acu-accent);\n                }\n\n                .acu-region-name {\n                    flex: 1;\n                    font-weight: bold;\n                    font-size: 13px;\n                    color: var(--acu-text-main);\n                }\n\n                .acu-location-count {\n                    font-size: 11px;\n                    color: var(--acu-text-sub);\n                }\n\n                .acu-location-list {\n                    max-height: 0;\n                    overflow: hidden;\n                    transition: max-height 0.3s ease;\n                }\n\n                .acu-location-group.expanded .acu-location-list {\n                    max-height: 500px;\n                }\n\n                .acu-location-item {\n                    padding: 6px 10px 6px 26px;\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                    font-size: 12px;\n                    border-bottom: 1px dashed rgba(0,0,0,0.05);\n                    transition: all 0.15s;\n                }\n\n                /*  */\n                .acu-dash-locations .acu-location-item {\n                    padding: 4px 8px !important;\n                    min-width: 0; /* flex */\n                    overflow: hidden; /*  */\n                }\n\n                .acu-dash-locations .acu-location-item > span:first-child {\n                    display: flex !important;\n                    align-items: center;\n                    gap: 6px;\n                    flex: 1;\n                    min-width: 0; /* flex */\n                    overflow: hidden;\n                }\n\n                .acu-dash-locations .acu-location-item > span:first-child i {\n                    flex-shrink: 0; /*  */\n                }\n\n                .acu-dash-locations .acu-location-item > span:first-child > span {\n                    white-space: nowrap;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                    flex: 1;\n                    min-width: 0; /* flex */\n                }\n\n                .acu-location-item:last-child {\n                    border-bottom: none;\n                }\n\n                .acu-location-item:hover {\n                    background: var(--acu-table-hover);\n                    transform: translateX(4px);\n                }\n\n                .acu-location-item.current {\n                    background: var(--acu-hl-diff-bg);\n                    font-weight: bold;\n                    color: var(--acu-hl-diff);\n                }\n\n                .acu-location-item i {\n                    font-size: 10px;\n                    opacity: 0.6;\n                }\n\n                .acu-current-badge {\n                    margin-left: auto;\n                    font-size: 10px;\n                    padding: 2px 6px;\n                    background: var(--acu-btn-active-bg);\n                    color: var(--acu-btn-active-text);\n                    border-radius: 3px;\n                    font-weight: bold;\n                }\n                /* ===  === */\n                .acu-dash-context {\n                    background: linear-gradient(135deg, var(--acu-table-head), var(--acu-bg-panel));\n                    padding: 15px;\n                    border-radius: 8px;\n                    margin-bottom: 15px;\n                    border: 1px solid var(--acu-border);\n                }\n\n                .acu-dash-location {\n                    font-size: 18px;\n                    font-weight: bold;\n                    color: var(--acu-accent);\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                }\n\n                .acu-dash-location-desc {\n                    font-size: 13px;\n                    color: var(--acu-text-sub);\n                    margin-top: 6px;\n                    line-height: 1.5;\n                }\n\n                .acu-dash-player, .acu-dash-intel {\n                    background: var(--acu-card-bg);\n                    padding: 12px;\n                    border-radius: 8px;\n                    border: 1px solid var(--acu-border);\n                }\n\n                .acu-dash-player h3, .acu-dash-intel h3 {\n                    margin: 0 0 10px 0;\n                    font-size: 14px;\n                    color: var(--acu-accent);\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                }\n\n                .acu-player-status {\n                    font-size: 13px;\n                    color: var(--acu-text-main);\n                }\n\n                .acu-task-item {\n                    padding: 8px;\n                    margin-bottom: 6px;\n                    background: rgba(0,0,0,0.03);\n                    border-radius: 6px;\n                    border-left: 3px solid var(--acu-border);\n                }\n\n                .acu-task-name {\n                    font-size: 13px;\n                    font-weight: 500;\n                    color: var(--acu-text-main);\n                }\n\n                .acu-empty-hint {\n                    font-size: 12px;\n                    color: var(--acu-text-sub);\n                    text-align: center;\n                    padding: 15px;\n                    opacity: 0.7;\n                }\n                /*  */\n                .acu-changes-content .acu-empty-hint {\n                    flex: 1;\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    justify-content: center;\n                    min-height: 200px;\n                }\n\n                .acu-dashboard-content {\n                    padding: 15px;\n                    overflow-y: auto !important;\n                    overflow-x: hidden !important;\n                    -webkit-overflow-scrolling: touch !important;\n                    touch-action: pan-y !important;\n                    overscroll-behavior-y: contain;\n                    max-height: calc(80vh - 60px);\n                }\n\n                /* ===  === */\n                h3.acu-dash-table-link,\n                h4.acu-dash-table-link {\n                    cursor: pointer;\n                    transition: all 0.15s;\n                    padding: 2px 4px;\n                    margin: -2px -4px;\n                    border-radius: 4px;\n                }\n                h3.acu-dash-table-link:hover,\n                h4.acu-dash-table-link:hover {\n                    color: var(--acu-accent);\n                    background: var(--acu-table-hover);\n                }\n\n                /*  - + */\n                .acu-dash-dice-btn,\n                .acu-dash-goto-btn,\n                .acu-dash-use-item-btn,\n                .acu-dash-use-skill-btn,\n                .acu-dash-track-task-btn,\n                .acu-dash-msg-btn,\n                .acu-dash-contest-btn,\n                .acu-dash-dice-free,\n                .acu-dash-relation-graph-btn,\n                .acu-dash-avatar-manager-btn {\n                    cursor: pointer;\n                    color: var(--acu-text-sub);\n                    opacity: 0.5;\n                    font-size: 14px !important;\n                    padding: 6px;\n                    margin: -4px;\n                    border-radius: 4px;\n                    transition: all 0.15s;\n                    display: inline-flex;\n                    align-items: center;\n                    justify-content: center;\n                    min-width: 28px;\n                    min-height: 28px;\n                }\n                .acu-dash-dice-btn:hover,\n                .acu-dash-goto-btn:hover,\n                .acu-dash-use-item-btn:hover,\n                .acu-dash-use-skill-btn:hover,\n                .acu-dash-track-task-btn:hover,\n                .acu-dash-msg-btn:hover,\n                .acu-dash-contest-btn:hover,\n                .acu-dash-dice-free:hover {\n                    opacity: 1;\n                    color: var(--acu-accent);\n                    background: var(--acu-table-hover);\n                    transform: scale(1.1);\n                }\n\n                /*  -  */\n                .acu-dash-clickable {\n                    cursor: pointer;\n                    transition: all 0.15s;\n                    border-radius: 4px;\n                }\n                .acu-dash-clickable:hover {\n                    background: var(--acu-table-hover);\n                }\n                .acu-dash-clickable:active {\n                    transform: scale(0.98);\n                }\n\n                @media (max-width: 768px) {\n                    .acu-dash-body {\n                        grid-template-columns: 1fr;\n                        max-height: none;\n                        overflow: visible;\n                    }\n\n                    .acu-dashboard-content {\n                        max-height: calc(75vh - 50px) !important;\n                        padding-bottom: 20px !important;\n                    }\n\n                    /*  */\n                    .acu-dash-dice-btn,\n                    .acu-dash-goto-btn,\n                    .acu-dash-use-item-btn,\n                    .acu-dash-use-skill-btn,\n                    .acu-dash-track-task-btn,\n                    .acu-dash-msg-btn,\n                    .acu-dash-contest-btn,\n                    .acu-dash-dice-free {\n                        font-size: 16px !important;\n                        padding: 8px;\n                        min-width: 36px;\n                        min-height: 36px;\n                    }\n                }\n            /* ===  === */\n            .acu-preview-overlay {\n                z-index: 2147483650;\n                backdrop-filter: blur(3px);\n                animation: acuFadeIn 0.2s ease;\n            }\n\n            .acu-preview-card {\n                background: var(--acu-card-bg);\n                width: 90%;\n                max-width: 400px;\n                max-height: 80vh;\n                overflow-y: auto;\n                animation: acuFadeIn 0.25s ease;\n            }\n                .acu-preview-overlay .acu-data-card {\n                    width: 90vw;\n                    max-width: 400px;\n                    flex: none;\n                }\n                @media (min-width: 768px) {\n                    .acu-preview-card,\n                    .acu-preview-overlay .acu-data-card {\n                        max-width: 550px;\n                    }\n                }\n            .acu-preview-title {\n                font-size: 16px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .acu-preview-close:hover {\n                background: var(--acu-error-bg, rgba(231, 76, 60, 0.1));\n                color: var(--acu-error-text, #e74c3c);\n            }\n\n            .acu-preview-body {\n                padding: 15px;\n            }\n\n            .acu-preview-row {\n                display: flex;\n                padding: 8px 0;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n\n            .acu-preview-row:last-child {\n                border-bottom: none;\n            }\n\n            .acu-preview-label {\n                flex: 0 0 80px;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n            }\n\n            .acu-preview-value {\n                flex: 1;\n                color: var(--acu-text-main);\n                font-size: 13px;\n                word-break: break-word;\n            }\n\n            .acu-dash-clickable {\n                cursor: pointer;\n                transition: all 0.15s;\n            }\n\n            .acu-dash-clickable:hover {\n                background: var(--acu-table-hover);\n            }\n            .acu-current-location span {\n                color: var(--acu-accent);\n                font-weight: 600;\n            }\n            .acu-current-location i {\n                color: var(--acu-accent);\n            }\n            /* ===  === */\n            .acu-dropdown-wrapper { position: relative; width: 100%; }\n            .acu-dropdown-list {\n                position: absolute;\n                top: 100%;\n                left: 0;\n                right: 0;\n                max-height: 150px;\n                overflow-y: auto;\n                border: 1px solid;\n                border-radius: 4px;\n                box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n                z-index: 2147483649;\n                display: none;\n            }\n            .acu-dropdown-list.visible { display: block; }\n            .acu-dropdown-item {\n                padding: 6px 10px;\n                font-size: 12px;\n                cursor: pointer;\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                background: transparent;\n                transition: background 0.1s;\n            }\n            .acu-dropdown-empty {\n                padding: 8px 10px;\n                font-size: 12px;\n                text-align: center;\n                opacity: 0.7;\n            }\n            /* ===  === */\n            .acu-input-wrapper { position: relative; display: flex; align-items: center; width: 100%; }\n            .acu-input-wrapper input { padding-right: 24px !important; }\n            .acu-clear-btn { position: absolute; right: 6px; top: 50%; transform: translateY(-50%); background: transparent !important; border: none !important; font-size: 12px; cursor: pointer; padding: 4px; line-height: 1; opacity: 0.5; transition: opacity 0.2s; z-index: 5; }\n            .acu-clear-btn:hover { background: transparent !important; border: none !important; opacity: 1 !important; }\n\n            /* ==========  ========== */\n            .acu-relation-graph-overlay {\n                background: rgba(0,0,0,0.8);\n                z-index: 2147483650;\n                backdrop-filter: blur(4px);\n            }\n            .acu-relation-graph-container {\n                width: 95%;\n                max-width: 900px;\n                height: 85vh;\n                max-height: 700px;\n            }\n            .acu-graph-title {\n                font-size: 16px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .acu-graph-actions {\n                display: flex;\n                gap: 8px;\n            }\n            .acu-graph-btn {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s;\n            }\n            .acu-graph-btn:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n            }\n            .acu-graph-canvas-wrapper {\n                flex: 1;\n                overflow: hidden;\n                position: relative;\n                min-height: 0;\n            }\n            .acu-graph-svg {\n                width: 100%;\n                height: 100%;\n                cursor: grab;\n            }\n            .acu-graph-svg:active { cursor: grabbing; }\n            .acu-graph-edge {\n                stroke: var(--acu-border);\n                stroke-width: 2;\n                opacity: 0.6;\n            }\n            .acu-graph-edge-label {\n                font-size: 11px;\n                fill: var(--acu-text-sub);\n                text-anchor: middle;\n                pointer-events: none;\n            }\n            .acu-graph-node { cursor: grab; }\n            .acu-graph-node:active { cursor: grabbing; }\n            .acu-node-bg {\n                fill: var(--acu-btn-bg);\n                stroke: var(--acu-border);\n                stroke-width: 2;\n                transition: all 0.2s;\n            }\n            .acu-node-bg.player {\n                fill: var(--acu-accent);\n                stroke: var(--acu-btn-active-text);\n            }\n            .acu-graph-node:hover .acu-node-bg {\n                stroke-width: 3;\n                filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));\n            }\n            .acu-graph-svg.highlighting .acu-graph-node {\n                opacity: 0.2;\n                transition: opacity 0.2s ease;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge {\n                opacity: 0.1;\n                transition: opacity 0.2s ease;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge-label {\n                opacity: 0.1;\n                transition: opacity 0.2s ease;\n            }\n            .acu-graph-svg.highlighting .acu-graph-node.highlighted {\n                opacity: 1;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge.highlighted {\n                opacity: 1;\n                stroke: var(--acu-accent);\n                stroke-width: 3;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge-label.highlighted {\n                opacity: 1;\n                fill: var(--acu-accent);\n                font-weight: bold;\n            }\n            .acu-node-char {\n                font-size: 16px;\n                font-weight: bold;\n                fill: var(--acu-text-main);\n                text-anchor: middle;\n                pointer-events: none;\n            }\n            .acu-node-bg.player + text.acu-node-char,\n            .acu-node-bg.player ~ text.acu-node-char {\n                fill: var(--acu-btn-active-text);\n            }\n            .acu-node-label {\n                font-size: 12px;\n                fill: var(--acu-text-main);\n                text-anchor: middle;\n                pointer-events: none;\n            }\n            .acu-node-inscene-indicator {\n                fill: var(--acu-accent);\n                stroke: var(--acu-bg-panel);\n                stroke-width: 2;\n                filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));\n            }\n            .acu-graph-legend {\n                display: flex;\n                gap: 16px;\n                justify-content: center;\n                padding: 10px;\n                border-top: 1px solid var(--acu-border);\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                flex-shrink: 0;\n            }\n            .acu-graph-legend span {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            .acu-zoom-display {\n                background: var(--acu-btn-bg);\n                padding: 2px 8px;\n                border-radius: 4px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                min-width: 45px;\n                text-align: center;\n            }\n            .acu-node-size-slider-container input[type=\"range\"] {\n                -webkit-appearance: none;\n                appearance: none;\n                height: 10px;\n                border-radius: 5px;\n                background: var(--acu-btn-bg);\n                outline: none;\n                cursor: pointer;\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-webkit-slider-thumb {\n                -webkit-appearance: none;\n                appearance: none;\n                width: 20px;\n                height: 20px;\n                border-radius: 50%;\n                background: var(--acu-accent);\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n                transition: all 0.2s;\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-webkit-slider-thumb:hover {\n                transform: scale(1.1);\n                box-shadow: 0 3px 6px rgba(0,0,0,0.4);\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-moz-range-thumb {\n                width: 20px;\n                height: 20px;\n                border-radius: 50%;\n                background: var(--acu-accent);\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n                transition: all 0.2s;\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-moz-range-thumb:hover {\n                transform: scale(1.1);\n                box-shadow: 0 3px 6px rgba(0,0,0,0.4);\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-moz-range-track {\n                height: 10px;\n                border-radius: 5px;\n                background: var(--acu-btn-bg);\n            }\n            @media (max-width: 768px) {\n                .acu-relation-graph-container {\n                    width: 100%;\n                    height: 80vh;\n                    max-height: none;\n                    border-radius: 12px;\n                }\n            }\n\n            /* ==========  ========== */\n            .acu-avatar-manager-overlay {\n                background: rgba(0,0,0,0.7);\n                z-index: 2147483655;\n            }\n            .acu-avatar-manager {\n                width: 90%;\n                max-width: 500px;\n                max-height: 80vh;\n            }\n            .acu-avatar-title {\n                font-size: 15px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            .acu-avatar-list {\n                flex: 1;\n                overflow-y: auto;\n                padding: 12px;\n                min-height: 0;\n            }\n            .acu-avatar-item {\n                display: flex;\n                align-items: flex-start;\n                gap: 12px;\n                padding: 10px;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n            .acu-avatar-item:last-child { border-bottom: none; }\n            .acu-avatar-preview {\n                width: 48px;\n                height: 48px;\n                border-radius: 50%;\n                background: var(--acu-btn-bg);\n                background-size: cover;\n                background-position: center;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                border: 2px solid var(--acu-border);\n                flex-shrink: 0;\n                position: relative;\n                cursor: pointer;\n            }\n            .acu-avatar-preview span {\n                font-size: 18px;\n                font-weight: bold;\n                color: var(--acu-text-sub);\n            }\n            .acu-avatar-camera-hint {\n                position: absolute;\n                bottom: 2px;\n                right: 2px;\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                opacity: 0.5;\n                pointer-events: none;\n            }\n            .acu-avatar-preview:hover .acu-avatar-camera-hint {\n                opacity: 0.8;\n                color: var(--acu-accent);\n            }\n            .acu-avatar-info {\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-avatar-name {\n                font-size: 13px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n                margin-bottom: 4px;\n            }\n            .acu-avatar-name-row {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                gap: 8px;\n                margin-bottom: 6px;\n            }\n            .acu-avatar-manager-overlay input.acu-avatar-url,\n            .acu-avatar-manager-overlay input.acu-avatar-aliases {\n                width: 100%;\n                padding: 6px 8px;\n                font-size: 12px;\n                border: 1px solid var(--acu-border);\n                border-radius: 4px;\n                background: var(--acu-btn-bg) !important;\n                color: var(--acu-text-main) !important;\n                box-sizing: border-box;\n                -webkit-appearance: none;\n                appearance: none;\n            }\n            .acu-avatar-manager-overlay input.acu-avatar-url:focus,\n            .acu-avatar-manager-overlay input.acu-avatar-aliases:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n                box-shadow: none !important;\n            }\n            /* URL +  */\n            .acu-avatar-input-row {\n                display: flex;\n                gap: 6px;\n                align-items: center;\n            }\n            .acu-avatar-input-row .acu-avatar-url {\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-avatar-upload-btn {\n                width: 32px;\n                height: 32px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                flex-shrink: 0;\n                transition: all 0.15s;\n            }\n            .acu-avatar-upload-btn:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent);\n            }\n            .acu-avatar-upload-btn:active {\n                transform: scale(0.95);\n            }\n            /*  */\n            .acu-avatar-source {\n                position: absolute;\n                bottom: -10px;\n                left: 50%;\n                transform: translateX(-50%);\n                font-size: 9px;\n                padding: 1px 6px;\n                border-radius: 8px;\n                font-weight: bold;\n                white-space: nowrap;\n            }\n            .acu-avatar-preview-wrap {\n                position: relative;\n                flex-shrink: 0;\n            }\n            .acu-source-local,\n            .acu-source-url,\n            .acu-source-auto {\n                background: var(--acu-badge-bg);\n                color: var(--acu-text-sub);\n            }\n            .acu-avatar-manager-overlay input.acu-avatar-aliases {\n                padding: 4px 8px;\n                font-size: 11px;\n                margin-top: 4px;\n            }\n            .acu-avatar-manager-overlay input::placeholder {\n                color: var(--acu-text-sub) !important;\n                opacity: 0.7;\n            }\n            .acu-avatar-actions {\n                display: flex;\n                flex-direction: row;\n                gap: 4px;\n                flex-shrink: 0;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-actions button {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg) !important;\n                color: var(--acu-text-sub) !important;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-actions button:hover {\n                background: var(--acu-btn-hover) !important;\n                color: var(--acu-accent) !important;\n            }\n            .acu-avatar-save-btn:hover { color: var(--acu-success-text, #27ae60) !important; }\n            .acu-avatar-clear-btn:hover { color: var(--acu-error-text, #e74c3c) !important; }\n            .acu-avatar-import-btn,\n            .acu-avatar-export-btn {\n                width: 28px;\n                height: 28px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 12px;\n                transition: all 0.2s;\n            }\n            .acu-avatar-import-btn:hover,\n            .acu-avatar-export-btn:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n            }\n            .acu-avatar-crop-row {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                margin-top: 6px;\n                font-size: 11px;\n                color: var(--acu-text-sub);\n            }\n            .acu-avatar-crop-row.hidden { display: none; }\n            .acu-avatar-manager-overlay .acu-avatar-scale {\n                flex: 1;\n                height: 6px !important;\n                -webkit-appearance: none !important;\n                appearance: none !important;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                outline: none;\n                border: none;\n                margin: 0 8px;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-webkit-slider-runnable-track {\n                height: 6px !important;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                border: none;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-webkit-slider-thumb {\n                -webkit-appearance: none !important;\n                appearance: none !important;\n                width: 16px !important;\n                height: 16px !important;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                cursor: pointer !important;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 1px 3px rgba(0,0,0,0.3) !important;\n                margin-top: -5px !important;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-moz-range-track {\n                height: 6px !important;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                border: none;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-moz-range-thumb {\n                width: 16px !important;\n                height: 16px !important;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                border: 2px solid var(--acu-bg-panel);\n                cursor: pointer !important;\n            }\n            @media (max-width: 768px) {\n                .acu-avatar-manager {\n                    width: 95%;\n                    max-height: 85vh;\n                }\n            }\n\n            /* ==========  ========== */\n            .acu-import-confirm-overlay {\n                z-index: 2147483660;\n            }\n            .acu-import-confirm-dialog {\n                width: 90%;\n                max-width: 320px;\n            }\n            .acu-import-confirm-body {\n                padding: 16px;\n            }\n            .acu-import-stats {\n                display: flex;\n                justify-content: space-around;\n                margin-bottom: 16px;\n            }\n            .acu-import-stat {\n                text-align: center;\n            }\n            .acu-stat-num {\n                display: block;\n                font-size: 24px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n            }\n            .acu-stat-label {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n            }\n            .acu-stat-new .acu-stat-num { color: var(--acu-success-text); }\n            .acu-stat-conflict .acu-stat-num { color: #e67e22; }\n            .acu-import-conflict-section {\n                margin-top: 12px;\n                padding-top: 12px;\n                border-top: 1px dashed var(--acu-border);\n            }\n            .acu-import-conflict-options {\n                margin-top: 10px;\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n            .acu-import-radio {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                cursor: pointer;\n                font-size: 13px;\n                color: var(--acu-text-main);\n            }\n            .acu-import-radio input {\n                accent-color: var(--acu-accent);\n            }\n            .acu-import-confirm-footer {\n                display: flex;\n                gap: 10px;\n                padding: 12px 16px;\n                border-top: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n            }\n            .acu-import-cancel-btn,\n            .acu-import-confirm-btn {\n                flex: 1;\n                padding: 10px;\n                border-radius: 6px;\n                font-size: 13px;\n                font-weight: bold;\n                cursor: pointer;\n                transition: all 0.2s;\n            }\n            .acu-import-cancel-btn {\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-main);\n            }\n            .acu-import-cancel-btn:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-import-confirm-btn {\n                background: var(--acu-accent);\n                border: none;\n                color: #fff;\n            }\n            .acu-import-confirm-btn:hover {\n                opacity: 0.9;\n            }\n            /* ========== / ========== */\n            .acu-avatar-import-btn,\n            .acu-avatar-export-btn {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n            }\n\n            /* ==========  ========== */\n            .acu-dice-config-dialog {\n                width: 320px;\n                max-width: 92vw;\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                box-shadow: 0 15px 40px rgba(0,0,0,0.4);\n                overflow: hidden;\n            }\n            .acu-dice-cfg-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 10px 14px;\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-accent);\n            }\n            .acu-dice-cfg-header .acu-config-close {\n                background: none;\n                border: none;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                font-size: 14px;\n                padding: 4px;\n            }\n            .acu-dice-cfg-header .acu-config-close:hover {\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-body {\n                padding: 12px;\n            }\n            .acu-dice-cfg-row {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                gap: 10px;\n                margin-bottom: 10px;\n            }\n            .acu-dice-cfg-row.acu-cfg-full-row {\n                grid-template-columns: 1fr;\n            }\n            .acu-dice-cfg-item {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n            }\n            .acu-dice-cfg-item label {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                font-weight: 500;\n            }\n            .acu-dice-cfg-item.acu-cfg-toggle-item {\n                flex-direction: row;\n                align-items: center;\n                justify-content: space-between;\n                padding: 8px 0;\n            }\n            .acu-dice-cfg-item.acu-cfg-toggle-item > label {\n                margin: 0;\n                font-size: 13px;\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-item input,\n            .acu-dice-cfg-item select {\n                width: 100%;\n                padding: 7px 8px;\n                background: var(--acu-input-bg) !important;\n                border: 1px solid var(--acu-border);\n                border-radius: 5px;\n                color: var(--acu-text-main) !important;\n                font-size: 13px;\n                text-align: center;\n                box-sizing: border-box;\n            }\n            .acu-dice-cfg-item input::placeholder {\n                color: var(--acu-text-sub);\n                opacity: 0.6;\n            }\n            .acu-dice-cfg-item select option {\n                background: var(--acu-bg-panel);\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-item select {\n                text-align: left;\n                cursor: pointer;\n            }\n            .acu-dice-cfg-item select option {\n                background: var(--acu-bg-panel);\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-item input:focus,\n            .acu-dice-cfg-item select:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n            }\n            .acu-cfg-hint {\n                font-size: 9px;\n                color: var(--acu-text-sub);\n                opacity: 0.7;\n                text-align: center;\n            }\n            .acu-dice-cfg-actions {\n                display: flex;\n                gap: 8px;\n                margin-top: 12px;\n                padding-top: 10px;\n                border-top: 1px dashed var(--acu-border);\n            }\n            .acu-dice-cfg-actions button {\n                flex: 1;\n                padding: 9px 12px;\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                border: 1px solid var(--acu-border);\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-actions button:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-dice-cfg-actions button.primary {\n                background: var(--acu-btn-bg);\n                border-color: var(--acu-btn-bg);\n                color: var(--acu-button-text);\n            }\n            .acu-dice-cfg-actions button.primary:hover {\n                background: var(--acu-btn-hover);\n                border-color: var(--acu-btn-hover);\n            }\n            /* ==========  ========== */\n            .acu-settings-dialog {\n                width: 380px;\n                max-width: 380px;\n                max-height: 85vh;\n                padding: 0;\n                gap: 0;\n            }\n            @media (max-width: 768px) {\n                .acu-settings-dialog {\n                    width: 92vw;\n                    max-width: 92vw;\n                    max-height: 85vh;\n                }\n                .acu-settings-body {\n                    max-height: calc(85vh - 110px);\n                    -webkit-overflow-scrolling: touch;\n                }\n                .acu-table-manager-list {\n                    max-height: 40vh;\n                    -webkit-overflow-scrolling: touch;\n                }\n            }\n            .acu-settings-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 14px 16px;\n                border-bottom: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n            }\n            .acu-settings-title {\n                font-size: 16px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .acu-settings-text {\n                position: relative;\n                display: inline-flex;\n                align-items: center;\n                padding-right: 32px;\n            }\n            .acu-version-badge {\n                position: absolute;\n                bottom: 0;\n                right: 0;\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                font-weight: normal;\n                line-height: 1;\n                white-space: nowrap;\n            }\n            .acu-help-btn {\n                background: none !important;\n                border: none !important;\n                box-shadow: none !important;\n                outline: none !important;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                font-size: 16px;\n                padding: 4px;\n                margin: 0;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: color 0.2s;\n            }\n            .acu-help-btn:hover {\n                color: var(--acu-text-main);\n            }\n            .acu-settings-body {\n                flex: 1;\n                min-height: 0;\n                overflow-y: auto;\n                overflow-x: hidden;\n                padding: 8px;\n                -webkit-overflow-scrolling: touch;\n            }\n            .acu-settings-group {\n                background: var(--acu-card-bg);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 8px;\n            }\n            .acu-settings-group-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 12px 14px;\n                font-size: 13px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n                background: var(--acu-table-head);\n                cursor: pointer;\n                user-select: none;\n                transition: background 0.15s;\n            }\n            .acu-settings-group-title:hover {\n                background: var(--acu-table-hover);\n            }\n            .acu-group-chevron {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                width: 12px;\n                transition: transform 0.2s;\n            }\n            .acu-settings-group-body {\n                padding: 4px 12px 8px;\n            }\n            .acu-settings-group.collapsed .acu-settings-group-body {\n                display: none;\n            }\n            .acu-settings-group-body.acu-animating {\n                display: block !important;\n                overflow: hidden;\n            }\n            .acu-settings-group:last-child {\n                margin-bottom: 0;\n            }\n            .acu-setting-row {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 10px 0;\n                border-bottom: 1px dashed var(--acu-border);\n                gap: 12px;\n                min-height: 44px;\n            }\n            .acu-setting-row:last-child {\n                border-bottom: none;\n            }\n            .acu-setting-row-slider {\n                flex-direction: column;\n                align-items: stretch;\n            }\n            .acu-setting-info {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-setting-label {\n                font-size: 13px;\n                color: var(--acu-text-main);\n            }\n            .acu-setting-hint {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                opacity: 0.7;\n            }\n            .acu-setting-value {\n                font-size: 12px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                margin-left: auto;\n            }\n            .acu-setting-select {\n                padding: 6px 10px;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px;\n                background: var(--acu-input-bg, var(--acu-btn-bg)) !important;\n                color: var(--acu-text-main) !important;\n                font-size: 12px;\n                min-width: 120px;\n                cursor: pointer;\n                -webkit-appearance: none;\n                appearance: none;\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23888' d='M6 8L2 4h8z'/%3E%3C/svg%3E\");\n                background-repeat: no-repeat;\n                background-position: right 8px center;\n                padding-right: 28px;\n            }\n            .acu-setting-select:focus {\n                outline: none;\n                border-color: var(--acu-accent) !important;\n            }\n            .acu-setting-select option {\n                background: var(--acu-bg-panel) !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-select-short {\n                min-width: 80px;\n            }\n            .acu-setting-slider {\n                width: 100%;\n                height: 6px;\n                margin-top: 8px;\n                -webkit-appearance: none;\n                appearance: none;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                outline: none;\n                border: none;\n            }\n            .acu-setting-slider::-webkit-slider-runnable-track {\n                height: 6px;\n                background: var(--acu-border);\n                border-radius: 3px;\n            }\n            .acu-setting-slider::-webkit-slider-thumb {\n                -webkit-appearance: none;\n                appearance: none;\n                width: 18px;\n                height: 18px;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 1px 4px rgba(0,0,0,0.2);\n                margin-top: -6px;\n            }\n            .acu-setting-slider::-moz-range-track {\n                height: 6px;\n                background: var(--acu-border);\n                border-radius: 3px;\n                border: none;\n            }\n            .acu-setting-slider::-moz-range-thumb {\n                width: 18px;\n                height: 18px;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 1px 4px rgba(0,0,0,0.2);\n            }\n            .acu-setting-slider:focus {\n                outline: none;\n            }\n            .acu-setting-mini-btn {\n                width: 28px;\n                height: 28px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 11px;\n                flex-shrink: 0;\n                transition: all 0.15s;\n            }\n            .acu-setting-mini-btn:hover, .acu-setting-mini-btn.active {\n                background: var(--acu-accent);\n                color: #fff;\n                border-color: var(--acu-accent);\n            }\n\n            /* ==========  ========== */\n            .acu-preset-item {\n                padding: 12px;\n                background: var(--acu-card-bg);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 10px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                gap: 12px;\n                transition: all 0.2s;\n            }\n            .acu-preset-item:hover {\n                background: var(--acu-table-hover);\n                border-color: var(--acu-accent);\n            }\n            .acu-preset-info {\n                flex: 1;\n            }\n            .acu-preset-name {\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n                margin-bottom: 4px;\n            }\n            .acu-preset-desc {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                margin-bottom: 4px;\n            }\n            .acu-preset-stats {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n            }\n            .acu-preset-actions {\n                display: flex;\n                gap: 8px;\n                flex-shrink: 0;\n                align-items: center;\n            }\n            .acu-preset-btn {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 13px;\n                transition: all 0.15s;\n            }\n            .acu-preset-btn:hover {\n                background: var(--acu-accent);\n                color: #fff;\n                border-color: var(--acu-accent);\n            }\n            .acu-preset-btn.acu-preset-delete:hover {\n                background: rgba(231, 76, 60, 0.2);\n                color: #e74c3c;\n                border-color: #e74c3c;\n            }\n            /*  */\n            .acu-preset-editor-input,\n            .acu-preset-editor-textarea {\n                background: var(--acu-input-bg) !important;\n                color: var(--acu-text-main) !important;\n                border: 1px solid var(--acu-border) !important;\n            }\n            .acu-preset-editor-input:focus,\n            .acu-preset-editor-textarea:focus {\n                outline: none !important;\n                border-color: var(--acu-accent) !important;\n                box-shadow: 0 0 0 2px rgba(var(--acu-accent-rgb, 100, 150, 200), 0.2) !important;\n            }\n            .acu-preset-editor-textarea {\n                font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;\n            }\n            /* Toggle  */\n            .acu-toggle {\n                position: relative;\n                width: 44px;\n                height: 24px;\n                flex-shrink: 0;\n            }\n            .acu-toggle input {\n                opacity: 0;\n                width: 0;\n                height: 0;\n            }\n            .acu-toggle-slider {\n                position: absolute;\n                cursor: pointer;\n                top: 0; left: 0; right: 0; bottom: 0;\n                background: var(--acu-border);\n                border-radius: 24px;\n                transition: all 0.2s;\n            }\n            .acu-toggle-slider:before {\n                position: absolute;\n                content: \"\";\n                height: 18px;\n                width: 18px;\n                left: 3px;\n                bottom: 3px;\n                background: var(--acu-bg-panel);\n                border-radius: 50%;\n                transition: all 0.2s;\n                box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n            }\n            .acu-toggle input:checked + .acu-toggle-slider {\n                background: var(--acu-accent);\n            }\n            .acu-toggle input:checked + .acu-toggle-slider:before {\n                transform: translateX(20px);\n            }\n            /* Debug -  */\n            .acu-debug-console-dialog .acu-debug-filter,\n            .acu-debug-console-dialog label input.acu-debug-filter {\n                cursor: pointer !important;\n                width: auto !important;\n                height: auto !important;\n                margin: 0 !important;\n                padding: 0 !important;\n                appearance: checkbox !important;\n                -webkit-appearance: checkbox !important;\n                -moz-appearance: checkbox !important;\n            }\n            .acu-debug-console-dialog label {\n                display: flex !important;\n                align-items: center !important;\n                gap: 4px !important;\n                cursor: pointer !important;\n                font-size: 12px !important;\n            }\n            .acu-setting-action-btn {\n                width: 100%;\n                padding: 10px 14px;\n                margin-bottom: 6px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                font-size: 13px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 8px;\n                transition: all 0.15s;\n            }\n            /* Stepper  */\n            .acu-stepper {\n                display: flex;\n                align-items: center;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                overflow: hidden;\n                background: transparent !important;\n                flex-shrink: 0;\n            }\n            .acu-stepper-btn {\n                width: 36px;\n                height: 34px;\n                border: none !important;\n                background: transparent !important;\n                background-color: transparent !important;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.15s;\n                -webkit-appearance: none !important;\n                appearance: none !important;\n            }\n            .acu-stepper-btn:hover {\n                background: var(--acu-table-hover) !important;\n                color: var(--acu-accent);\n            }\n            .acu-stepper-btn:active {\n                transform: scale(0.95);\n                background: var(--acu-accent) !important;\n                color: var(--acu-button-text);\n            }\n            .acu-stepper-value {\n                min-width: 60px;\n                height: 34px;\n                line-height: 34px;\n                text-align: center;\n                font-size: 13px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n                background: transparent !important;\n                border-left: 1px solid var(--acu-border);\n                border-right: 1px solid var(--acu-border);\n            }\n            /* ==========  ========== */\n            .acu-changes-content {\n                padding: 10px;\n                overflow-y: auto !important;\n                overflow-x: hidden !important;\n                -webkit-overflow-scrolling: touch !important;\n                touch-action: pan-y !important;\n                overscroll-behavior-y: contain;\n            }\n            /* ==========  ========== */\n            .acu-validation-error-msg {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                flex: 1;\n                min-width: 0;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n            }\n            /*  -  */\n            .acu-validation-mode-hint {\n                padding: 8px 12px;\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                background: var(--acu-table-head);\n                border-radius: 6px;\n                margin: 0 0 10px 0;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            /*  */\n            .acu-changes-content.acu-changes-horizontal {\n                display: flex !important;\n                flex-direction: row !important;\n                flex-wrap: nowrap !important;\n                align-items: flex-start !important;\n                gap: 12px;\n                overflow-x: auto !important;\n                overflow-y: visible !important;\n                touch-action: pan-x pan-y !important;\n                padding-bottom: 5px;\n                -webkit-overflow-scrolling: touch;\n                overscroll-behavior-x: contain;\n                overscroll-behavior-y: auto;\n            }\n            .acu-changes-content.acu-changes-horizontal .acu-changes-list {\n                display: flex !important;\n                flex-direction: row !important;\n                flex-wrap: nowrap !important;\n                gap: 12px;\n                align-items: flex-start;\n                min-width: max-content;\n            }\n            .acu-changes-content.acu-changes-horizontal .acu-changes-group {\n                flex: 0 0 280px;\n                min-width: 280px;\n                max-width: 280px;\n                max-height: none;\n                overflow-y: visible;\n                -webkit-overflow-scrolling: auto;\n                overscroll-behavior-y: auto;\n            }\n            @media (min-width: 769px) {\n                .acu-changes-content.acu-changes-horizontal .acu-changes-group {\n                    flex: 0 0 320px;\n                    min-width: 320px;\n                    max-width: 320px;\n                }\n            }\n            .acu-changes-list { display: flex; flex-direction: column; gap: 10px; }\n            .acu-changes-group { background: var(--acu-card-bg); border: 1px solid var(--acu-border); border-radius: 8px; overflow: hidden; }\n            .acu-changes-group-header { display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: var(--acu-table-head); font-weight: bold; font-size: 13px; color: var(--acu-text-main); }\n            .acu-changes-count { margin-left: auto; background: var(--acu-accent); color: #fff; font-size: 11px; padding: 2px 8px; border-radius: 10px; font-weight: normal; }\n            .acu-changes-group-body { padding: 6px; display: flex; flex-direction: column; gap: 4px; }\n            .acu-change-item { display: flex; align-items: center; gap: 6px; padding: 6px 8px; border-radius: 6px; font-size: 12px; background: rgba(0,0,0,0.02); flex-wrap: wrap; transition: all 0.15s; }\n            .acu-change-item:hover { background: var(--acu-table-hover); }\n            .acu-change-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: bold; flex-shrink: 0; }\n            .acu-badge-added { background: var(--acu-success-bg); color: var(--acu-success-text); }\n            .acu-badge-deleted { background: var(--acu-hl-manual-bg); color: var(--acu-hl-manual); }\n            .acu-badge-modified { background: var(--acu-hl-diff-bg); color: var(--acu-hl-diff); }\n            .acu-change-title { color: var(--acu-text-main); font-weight: 500; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            .acu-change-field { color: var(--acu-text-sub); font-size: 11px; flex-shrink: 0; max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            .acu-change-diff { display: flex; align-items: center; gap: 4px; flex: 1; min-width: 0; overflow: hidden; }\n            .acu-diff-old { color: var(--acu-hl-manual); text-decoration: line-through; opacity: 0.7; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; }\n            .acu-diff-arrow { color: var(--acu-text-sub); flex-shrink: 0; }\n            .acu-diff-new { color: var(--acu-success-text); font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; }\n            /*  */\n            .acu-change-actions { display: flex; gap: 4px; margin-left: auto; flex-shrink: 0; }\n            .acu-change-action-btn { width: 24px; height: 24px; border: 1px solid var(--acu-border); border-radius: 4px; background: var(--acu-btn-bg); color: var(--acu-text-sub); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 11px; transition: all 0.15s; padding: 0; }\n            .acu-change-action-btn:hover { background: var(--acu-btn-hover); color: var(--acu-text-main); transform: scale(1.1); }\n            .acu-action-accept:hover { background: var(--acu-success-bg); color: var(--acu-success-text); border-color: var(--acu-success-text); }\n            .acu-action-reject:hover, .acu-action-restore:hover { background: var(--acu-hl-manual-bg); color: var(--acu-hl-manual); border-color: var(--acu-hl-manual); }\n            .acu-action-edit:hover { background: var(--acu-hl-diff-bg); color: var(--acu-hl-diff); border-color: var(--acu-hl-diff); }\n            /*  -  */\n            .acu-changes-batch-btn { width: 32px; height: 32px; border: 1.5px solid rgba(255,255,255,0.4); border-radius: 6px; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.85); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 13px; transition: all 0.15s; }\n            .acu-changes-batch-btn:hover { background: rgba(255,255,255,0.2); color: #fff; border-color: rgba(255,255,255,0.6); }\n            .acu-batch-accept:hover { background: var(--acu-success-bg); color: var(--acu-success-text); border-color: var(--acu-success-text); }\n            .acu-batch-reject:hover { background: var(--acu-hl-manual-bg); color: var(--acu-hl-manual); border-color: var(--acu-hl-manual); }\n            .acu-simple-mode-toggle.active { background: var(--acu-accent); color: #fff; border-color: var(--acu-accent); }\n            .acu-simple-mode-toggle:hover { background: var(--acu-accent); color: #fff; border-color: var(--acu-accent); }\n            .acu-changes-group.collapsed .acu-collapse-icon { transform: rotate(0deg); }\n            .acu-changes-group:not(.collapsed) .acu-collapse-icon { transform: rotate(0deg); }\n            .acu-changes-group-header:hover { background: var(--acu-table-hover); }\n            /*  */\n            .acu-diff-section { margin-bottom: 12px; }\n            .acu-diff-label { font-size: 12px; font-weight: bold; color: var(--acu-text-sub); margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }\n            .acu-diff-readonly { padding: 10px 12px; background: var(--acu-table-head); border: 1px dashed var(--acu-border); border-radius: 6px; color: var(--acu-text-main); font-size: 13px; line-height: 1.5; white-space: pre-wrap; word-break: break-word; max-height: 150px; overflow-y: auto; opacity: 0.8; }\n            .acu-diff-arrow-down { text-align: center; color: var(--acu-text-sub); font-size: 14px; margin: 8px 0; opacity: 0.5; }\n            /*  */\n            .acu-diff-new-section { padding: 12px; background: var(--acu-input-bg); border: 2px solid var(--acu-accent); border-radius: 6px; box-shadow: 0 0 0 3px rgba(127, 127, 255, 0.1); }\n            .acu-diff-new-section .acu-diff-label { color: var(--acu-accent); font-weight: 600; }\n            .acu-diff-new-section textarea,\n            .acu-diff-new-section input { background: var(--acu-input-bg) !important; border-color: var(--acu-border) !important; }\n            .acu-diff-new-section textarea:focus,\n            .acu-diff-new-section input:focus { border-color: var(--acu-accent) !important; box-shadow: 0 0 0 2px rgba(127, 127, 255, 0.15); }\n            /*  */\n            .acu-edit-dialog .acu-dialog-btns {\n                display: flex;\n                gap: 10px;\n                padding: 12px 16px;\n                border-top: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n                margin: 0 -16px -16px -16px;\n                border-radius: 0 0 12px 12px;\n            }\n            .acu-edit-dialog .acu-dialog-btn {\n                flex: 1;\n                padding: 10px 12px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                font-size: 13px;\n                font-weight: 500;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n                white-space: nowrap;\n                transition: all 0.15s;\n            }\n            .acu-edit-dialog .acu-dialog-btn:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-edit-dialog .acu-btn-confirm {\n                background: var(--acu-accent);\n                border-color: var(--acu-accent);\n                color: #fff;\n            }\n            .acu-edit-dialog .acu-btn-confirm:hover {\n                opacity: 0.9;\n            }\n            @media (max-width: 768px) {\n                .acu-edit-dialog .acu-dialog-btns {\n                    flex-wrap: nowrap;\n                }\n                .acu-edit-dialog .acu-dialog-btn {\n                    padding: 10px 8px;\n                    font-size: 12px;\n                    min-width: 0;\n                }\n                .acu-edit-dialog .acu-dialog-btn i {\n                    font-size: 11px;\n                }\n            }\n            @media (max-width: 768px) {\n                .acu-change-item { padding: 8px 6px; }\n                .acu-change-diff { flex-basis: 100%; margin-top: 4px; order: 10; }\n                .acu-change-actions { order: 5; }\n                .acu-diff-old, .acu-diff-new { max-width: 100px; }\n                .acu-change-action-btn { width: 28px; height: 28px; }\n            }\n            .acu-change-field-count { font-size: 11px; color: var(--acu-text-sub); margin-left: 4px; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            /*  */\n            .acu-row-edit-field { margin-bottom: 12px; padding: 10px; background: var(--acu-table-head); border-radius: 6px; border: 1px solid transparent; }\n            .acu-row-edit-field.acu-field-changed { border-color: var(--acu-accent); background: var(--acu-bg-panel); }\n            .acu-row-edit-label { font-size: 12px; font-weight: bold; color: var(--acu-text-sub); margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }\n            .acu-changed-badge { font-size: 10px; padding: 1px 6px; background: var(--acu-accent); color: #fff; border-radius: 3px; font-weight: normal; }\n            .acu-row-edit-old { font-size: 12px; color: var(--acu-text-sub); padding: 6px 8px; background: var(--acu-table-head); border-radius: 4px; margin-bottom: 6px; text-decoration: line-through; opacity: 0.7; white-space: pre-wrap; word-break: break-word; }\n            .acu-row-edit-input { width: 100%; min-height: 36px; max-height: 200px; padding: 8px; resize: none; }\n            .acu-empty-val { opacity: 0.5; font-style: italic; }\n            /* ==========  ========== */\n            .acu-table-manager-list {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n                max-height: 300px;\n                overflow-y: auto;\n                padding: 4px;\n                -webkit-overflow-scrolling: touch;\n                overscroll-behavior-y: contain;\n                touch-action: pan-y;\n            }\n            .acu-table-manager-item {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 8px 10px;\n                background: transparent;\n                border: 1.5px solid var(--acu-accent);\n                border-radius: 6px;\n                cursor: default;\n                transition: all 0.15s;\n                user-select: none;\n                touch-action: pan-y;\n            }\n            .acu-table-manager-item:hover {\n                background: var(--acu-table-hover);\n            }\n            .acu-table-manager-item.hidden-table {\n                opacity: 0.5;\n                border-color: var(--acu-border);\n                border-style: dashed;\n            }\n            .acu-table-manager-item.hidden-table .acu-table-item-name {\n                text-decoration: line-through;\n            }\n            .acu-table-item-check {\n                width: 28px;\n                height: 28px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                cursor: pointer;\n                color: var(--acu-accent);\n                border-radius: 4px;\n                transition: all 0.15s;\n            }\n            .acu-table-item-check:hover {\n                background: var(--acu-table-hover);\n                transform: scale(1.1);\n            }\n            .acu-table-manager-item.hidden-table .acu-table-item-check {\n                color: var(--acu-text-sub);\n            }\n            .acu-table-item-icon {\n                width: 20px;\n                text-align: center;\n                color: var(--acu-accent);\n                font-size: 12px;\n            }\n            .acu-table-item-name {\n                flex: 1;\n                font-size: 13px;\n                color: var(--acu-text-main);\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            .acu-table-item-handle {\n                width: 28px;\n                height: 28px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: var(--acu-text-sub);\n                cursor: grab;\n                opacity: 0.4;\n                transition: all 0.15s;\n                border-radius: 4px;\n            }\n            .acu-table-item-handle:hover {\n                opacity: 1;\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n            }\n            .acu-table-manager-item.acu-dragging {\n                opacity: 0.9;\n                background: var(--acu-accent);\n                border-color: var(--acu-accent);\n                box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n                z-index: 100;\n            }\n            .acu-table-manager-item.acu-dragging .acu-table-item-name,\n            .acu-table-manager-item.acu-dragging .acu-table-item-check,\n            .acu-table-manager-item.acu-dragging .acu-table-item-icon,\n            .acu-table-manager-item.acu-dragging .acu-table-item-handle {\n                color: #fff;\n            }\n            .acu-table-manager-item.acu-drag-above {\n                border-top: 2px solid var(--acu-accent);\n                margin-top: -1px;\n            }\n            .acu-table-manager-item.acu-drag-below {\n                border-bottom: 2px solid var(--acu-accent);\n                margin-bottom: -1px;\n            }\n            @media (max-width: 768px) {\n                .acu-table-item-handle {\n                    opacity: 0.6;\n                }\n            }\n            /* // */\n            .acu-table-manager-item.acu-special-item {\n                background: linear-gradient(135deg, rgba(var(--acu-accent-rgb, 128, 128, 128), 0.08), transparent);\n                border-style: dashed;\n            }\n            .acu-table-manager-item.acu-special-item .acu-table-item-icon {\n                color: var(--acu-accent);\n            }\n            .acu-table-manager-item.acu-special-item .acu-table-item-name {\n                font-weight: 500;\n            }\n            /* ==========  ========== */\n            .acu-validation-rules-list {\n                display: flex;\n                flex-direction: column;\n                gap: 6px;\n                max-height: 280px;\n                overflow-y: auto;\n                padding: 2px;\n            }\n            .acu-validation-rule-item {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 8px 10px;\n                background: transparent;\n                border: 1.5px solid var(--acu-accent);\n                border-radius: 6px;\n                transition: all 0.2s ease;\n            }\n            .acu-validation-rule-item.disabled {\n                opacity: 0.5;\n            }\n            .acu-validation-rule-item:hover {\n                border-color: var(--acu-accent);\n            }\n            .acu-rule-toggle {\n                cursor: pointer;\n                font-size: 18px;\n                color: var(--acu-text-sub);\n                transition: color 0.2s;\n                flex-shrink: 0;\n            }\n            .acu-rule-toggle.active {\n                color: var(--acu-accent);\n            }\n            .acu-rule-toggle:hover {\n                opacity: 0.8;\n            }\n            .acu-rule-info {\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-rule-name {\n                font-size: 12px;\n                font-weight: 500;\n                color: var(--acu-text-main);\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            .acu-rule-target {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                margin-top: 2px;\n            }\n            .acu-rule-type-icon {\n                width: 20px;\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                flex-shrink: 0;\n                text-align: center;\n            }\n            .acu-rule-delete {\n                background: none;\n                border: none;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                padding: 4px;\n                opacity: 0.6;\n                transition: all 0.2s;\n                flex-shrink: 0;\n            }\n            .acu-rule-delete:hover {\n                color: #e74c3c;\n                opacity: 1;\n            }\n            .acu-rule-intercept {\n                cursor: pointer;\n                font-size: 14px;\n                color: var(--acu-text-sub);\n                padding: 4px 6px;\n                border-radius: 4px;\n                opacity: 0.5;\n                transition: all 0.2s;\n                flex-shrink: 0;\n            }\n            .acu-rule-intercept:hover {\n                opacity: 0.8;\n                background: var(--acu-hover-bg);\n            }\n            .acu-rule-intercept.active {\n                color: var(--acu-accent);\n                opacity: 1;\n            }\n            .acu-add-rule-btn {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n                width: 100%;\n                padding: 10px;\n                margin-top: 8px;\n                background: var(--acu-btn-bg);\n                border: 1px dashed var(--acu-border);\n                border-radius: 6px;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.2s;\n            }\n            .acu-add-rule-btn:hover {\n                border-color: var(--acu-accent);\n                color: var(--acu-accent);\n                background: rgba(var(--acu-accent-rgb, 128, 128, 128), 0.1);\n            }\n            /*  */\n            .acu-validation-modal-overlay {\n                z-index: 2147483659;\n            }\n            .acu-validation-modal {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                width: 90%;\n                max-width: 420px;\n                overflow: hidden;\n                box-shadow: 0 20px 60px rgba(0,0,0,0.5);\n            }\n            .acu-validation-modal-body {\n                padding: 16px;\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n                max-height: 60vh;\n                overflow-y: auto;\n            }\n            .acu-validation-modal-body .acu-setting-row {\n                flex-wrap: wrap;\n            }\n            .acu-validation-modal-body .acu-panel-input,\n            .acu-validation-modal input[type=\"text\"],\n            .acu-validation-modal input[type=\"number\"],\n            .acu-validation-modal select {\n                background: var(--acu-input-bg, var(--acu-btn-bg)) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px !important;\n                padding: 8px 10px !important;\n                color: var(--acu-text-main) !important;\n                font-size: 12px !important;\n                box-shadow: none !important;\n                -webkit-appearance: none !important;\n            }\n            .acu-validation-modal-body .acu-panel-input:focus,\n            .acu-validation-modal input[type=\"text\"]:focus,\n            .acu-validation-modal input[type=\"number\"]:focus,\n            .acu-validation-modal select:focus {\n                outline: none !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .acu-validation-modal-body .acu-panel-input::placeholder,\n            .acu-validation-modal input[type=\"text\"]::placeholder,\n            .acu-validation-modal input[type=\"number\"]::placeholder {\n                color: var(--acu-text-sub) !important;\n                opacity: 0.7 !important;\n            }\n            .acu-validation-modal select option {\n                background: var(--acu-bg-panel) !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-validation-modal select option[value=\"\"] {\n                color: var(--acu-text-sub) !important;\n                opacity: 0.7 !important;\n            }\n            .acu-rule-config-section {\n                padding: 8px 0;\n            }\n            .acu-validation-modal-footer {\n                display: flex;\n                justify-content: center;\n                gap: 12px;\n                padding: 16px;\n                border-top: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n            }\n            .acu-validation-modal-footer .acu-btn {\n                flex: 1;\n                padding: 10px 12px !important;\n                font-size: 13px !important;\n                font-weight: 500 !important;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n            }\n            /*  */\n            .acu-smart-fix-meta {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 4px 0 !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n                flex-wrap: wrap !important;\n            }\n            .acu-smart-fix-separator {\n                color: var(--acu-border) !important;\n                opacity: 0.5 !important;\n            }\n            .acu-smart-fix-diff {\n                display: flex !important;\n                align-items: center !important;\n                gap: 8px !important;\n                padding: 6px 0 !important;\n                margin: 4px 0 !important;\n                flex-wrap: wrap !important;\n            }\n            .acu-smart-fix-diff-old-text {\n                color: var(--acu-hl-manual) !important;\n                text-decoration: line-through !important;\n                opacity: 0.7 !important;\n                font-size: 13px !important;\n                white-space: nowrap !important;\n                overflow: hidden !important;\n                text-overflow: ellipsis !important;\n                max-width: 150px !important;\n            }\n            .acu-smart-fix-diff-arrow {\n                color: var(--acu-text-sub) !important;\n                flex-shrink: 0 !important;\n            }\n            .acu-smart-fix-empty {\n                opacity: 0.5 !important;\n                font-style: italic !important;\n            }\n            .acu-smart-fix-diff-input-wrapper {\n                flex: 1 !important;\n                min-width: 120px !important;\n            }\n            .acu-smart-fix-diff-input-wrapper input,\n            .acu-smart-fix-diff-input-wrapper select {\n                width: 100% !important;\n                background: var(--acu-input-bg, var(--acu-btn-bg)) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 4px !important;\n                padding: 4px 8px !important;\n                color: var(--acu-text-main) !important;\n                font-size: 13px !important;\n                font-weight: 500 !important;\n                box-shadow: none !important;\n                -webkit-appearance: none !important;\n                -moz-appearance: none !important;\n                appearance: none !important;\n                min-height: 26px !important;\n                line-height: 1.3 !important;\n            }\n            .acu-smart-fix-diff-input-wrapper input:focus,\n            .acu-smart-fix-diff-input-wrapper select:focus {\n                outline: none !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-diff-input-wrapper select {\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%23666' d='M5 7L1 3h8z'/%3E%3C/svg%3E\") !important;\n                background-repeat: no-repeat !important;\n                background-position: right 6px center !important;\n                padding-right: 24px !important;\n            }\n            .acu-smart-fix-diff-input-wrapper select option {\n                background: var(--acu-card-bg) !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-smart-fix-suggest {\n                padding: 10px !important;\n                background: var(--acu-card-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px !important;\n                margin-top: 8px !important;\n            }\n            .acu-smart-fix-suggest-label {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                margin-bottom: 6px !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 4px !important;\n            }\n            .acu-smart-fix-suggest-label i {\n                color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-suggest-value {\n                font-size: 13px !important;\n                color: var(--acu-success-text) !important;\n                font-weight: 500 !important;\n                padding: 6px 8px !important;\n                background: var(--acu-success-bg) !important;\n                border-radius: 4px !important;\n                cursor: pointer !important;\n                transition: all 0.2s !important;\n            }\n            .acu-smart-fix-suggest-value:hover {\n                background: var(--acu-success-text) !important;\n                color: white !important;\n            }\n            .acu-smart-fix-suggest-options {\n                display: flex !important;\n                flex-wrap: wrap !important;\n                gap: 6px !important;\n            }\n            .acu-smart-fix-suggest-options-scroll {\n                max-height: 120px !important;\n                overflow-y: auto !important;\n                padding-right: 4px !important;\n            }\n            .acu-smart-fix-option {\n                display: inline-block !important;\n                font-size: 12px !important;\n                padding: 4px 10px !important;\n                background: var(--acu-btn-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 4px !important;\n                color: var(--acu-text-main) !important;\n                cursor: pointer !important;\n                transition: all 0.2s !important;\n            }\n            .acu-smart-fix-option:hover {\n                background: var(--acu-btn-hover) !important;\n                border-color: var(--acu-accent) !important;\n                color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-option-current {\n                background: var(--acu-hl-manual-bg) !important;\n                border-color: var(--acu-hl-manual) !important;\n                color: var(--acu-hl-manual) !important;\n                text-decoration: line-through !important;\n                opacity: 0.7 !important;\n            }\n            .acu-smart-fix-error-hint {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 8px !important;\n                background: var(--acu-card-bg) !important;\n                border-radius: 4px !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n            }\n            .acu-smart-fix-error-hint i {\n                color: var(--acu-accent) !important;\n                flex-shrink: 0 !important;\n            }\n            @media (max-width: 600px) {\n                .acu-smart-fix-diff {\n                    flex-direction: column !important;\n                    align-items: stretch !important;\n                }\n                .acu-smart-fix-diff-arrow {\n                    transform: rotate(90deg) !important;\n                }\n            }\n            .acu-btn {\n                padding: 8px 16px;\n                border-radius: 6px;\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.2s;\n                border: 1px solid transparent;\n            }\n            .acu-btn-secondary {\n                background: var(--acu-btn-bg);\n                border-color: var(--acu-border);\n                color: var(--acu-text-main);\n            }\n            .acu-btn-secondary:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-btn-primary {\n                background: var(--acu-accent);\n                color: white;\n            }\n            .acu-btn-primary:hover {\n                opacity: 0.9;\n            }\n            /*  */\n            .acu-smart-fix-rule-info {\n                padding: 10px 12px !important;\n                background: var(--acu-table-head) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-left: 3px solid var(--acu-accent) !important;\n                border-radius: 4px !important;\n                margin-bottom: 12px !important;\n            }\n            .acu-smart-fix-rule-header {\n                display: flex !important;\n                align-items: center !important;\n                gap: 8px !important;\n                font-size: 13px !important;\n                font-weight: 600 !important;\n                color: var(--acu-text-main) !important;\n                margin-bottom: 4px !important;\n            }\n            .acu-smart-fix-rule-header i {\n                color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-rule-desc {\n                font-size: 12px !important;\n                color: var(--acu-text-sub) !important;\n                line-height: 1.4 !important;\n            }\n            .acu-smart-fix-suggest-section {\n                margin-top: 12px !important;\n            }\n            .acu-smart-fix-suggest code {\n                background: var(--acu-table-head) !important;\n                padding: 2px 6px !important;\n                border-radius: 3px !important;\n                font-size: 11px !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-smart-fix-quick-btn {\n                display: inline-flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n                padding: 6px 12px !important;\n                background: var(--acu-accent) !important;\n                color: var(--acu-btn-active-text) !important;\n                border: 1px solid var(--acu-accent) !important;\n                border-radius: 4px !important;\n                font-size: 12px !important;\n                font-weight: 500 !important;\n                cursor: pointer !important;\n                transition: all 0.2s !important;\n            }\n            .acu-smart-fix-quick-btn:hover {\n                background: var(--acu-btn-active-bg) !important;\n                color: var(--acu-btn-active-text) !important;\n                border-color: var(--acu-btn-active-bg) !important;\n            }\n            .acu-smart-fix-table-summary {\n                padding: 12px !important;\n                background: var(--acu-card-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px !important;\n            }\n            .acu-smart-fix-stat {\n                font-size: 13px !important;\n                color: var(--acu-text-main) !important;\n                margin-bottom: 8px !important;\n            }\n            .acu-smart-fix-stat strong {\n                color: var(--acu-hl-manual) !important;\n            }\n            .acu-smart-fix-change-list {\n                max-height: 150px !important;\n                overflow-y: auto !important;\n                margin-top: 8px !important;\n            }\n            .acu-smart-fix-change-item {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 4px 8px !important;\n                background: var(--acu-table-head) !important;\n                border-radius: 3px !important;\n                margin-bottom: 4px !important;\n            }\n            .acu-smart-fix-hint {\n                font-size: 12px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 8px !important;\n                background: var(--acu-table-head) !important;\n                border-radius: 4px !important;\n                margin-top: 8px !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n            }\n            .acu-smart-fix-hint i {\n                color: var(--acu-accent) !important;\n            }\n            /* ==========  ========== */\n            .acu-crop-modal-overlay {\n                z-index: 2147483658;\n            }\n            .acu-crop-modal {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                width: 90%;\n                max-width: 360px;\n                overflow: hidden;\n                box-shadow: 0 20px 60px rgba(0,0,0,0.5);\n            }\n            .acu-crop-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 12px 16px;\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-accent);\n            }\n            .acu-crop-close {\n                background: none;\n                border: none;\n                color: var(--acu-text-sub);\n                font-size: 16px;\n                cursor: pointer;\n                padding: 4px;\n            }\n            .acu-crop-close:hover {\n                color: var(--acu-text-main);\n            }\n            .acu-crop-body {\n                padding: 20px;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 12px;\n            }\n            .acu-crop-container {\n                position: relative;\n                width: 200px;\n                height: 200px;\n                border-radius: 50%;\n                overflow: hidden;\n                touch-action: none;\n                user-select: none;\n            }\n            .acu-crop-image {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background-repeat: no-repeat;\n                cursor: grab;\n            }\n            .acu-crop-mask {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                border: 3px solid var(--acu-accent);\n                border-radius: 50%;\n                pointer-events: none;\n                box-shadow: 0 0 0 1000px rgba(0,0,0,0.3);\n            }\n            .acu-crop-hint {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                opacity: 0.7;\n            }\n            .acu-crop-footer {\n                display: flex;\n                gap: 10px;\n                padding: 12px 16px;\n                background: var(--acu-table-head);\n                border-top: 1px solid var(--acu-border);\n            }\n            .acu-crop-btn {\n                flex: 1;\n                padding: 10px 16px;\n                border-radius: 6px;\n                font-size: 13px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.15s;\n            }\n            .acu-crop-cancel {\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-main);\n            }\n            .acu-crop-cancel:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-crop-confirm {\n                background: var(--acu-accent);\n                border: 1px solid var(--acu-accent);\n                color: #fff;\n            }\n            .acu-crop-confirm:hover {\n                opacity: 0.9;\n            }\n            .acu-crop-reupload {\n                flex: 0 0 auto;\n                padding: 10px 14px;\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-main);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n            .acu-crop-reupload:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n            }\n    </style>\n    `;\n    $('head').append(styles);\n  };\n\n  const getTableData = () => {\n    const api = getCore().getDB();\n    if (!api || !api.exportTableAsJson) {\n      console.warn('[DICE] API ');\n      return null;\n    }\n    try {\n      const data = api.exportTableAsJson();\n      if (data) {\n        const sheetCount = Object.keys(data).filter(k => k.startsWith('sheet_')).length;\n        console.info(`[DICE] ${sheetCount} `);\n      }\n      return data;\n    } catch (e) {\n      console.error('[DICE]:', e);\n      return null;\n    }\n  };\n\n  const saveDataToDatabase = async (tableData, skipRender = false, commitDeletes = false) => {\n    if (isSaving) {\n      console.warn('[DICE]');\n      return; // \n    }\n    console.info('[DICE]...');\n    isSaving = true;\n    const { $ } = getCore();\n    const $saveBtn = $('#acu-btn-save-global');\n\n    // UI \n    if (!skipRender && $saveBtn.length) {\n      $saveBtn.find('i').removeClass('fa-save').addClass('fa-spinner fa-spin');\n      $saveBtn.prop('disabled', true);\n    }\n\n    try {\n      // 1.  sheet_  ( = )\n      const dataToSave = {};\n      //  mate \n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // 2.  ()\n      if (commitDeletes) {\n        const deletions = getPendingDeletions();\n        Object.keys(deletions).forEach(key => {\n          if (dataToSave[key] && dataToSave[key].content) {\n            deletions[key]\n              .sort((a, b) => b - a)\n              .forEach(idx => {\n                if (dataToSave[key].content[idx + 1]) dataToSave[key].content.splice(idx + 1, 1);\n              });\n          }\n        });\n        savePendingDeletions({});\n      }\n\n      // 3. \n      let jsonString;\n      try {\n        jsonString = JSON.stringify(dataToSave);\n        //  10MB \n        const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n        if (sizeInMB > 10) {\n          throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n        }\n        console.info(`[DICE]: ${sizeInMB.toFixed(2)}MB`);\n      } catch (stringifyError) {\n        console.error('[DICE]ACU JSON :', stringifyError);\n        throw new Error(`: ${stringifyError.message || stringifyError}`);\n      }\n\n      // 4.  API  ()\n      const api = getCore().getDB();\n      if (!api || !api.importTableAsJson) {\n        throw new Error(' API ');\n      }\n\n      try {\n        //  importTableAsJson saveChat()\n        //  saveChat()  \"Settings could not be saved\" \n        const result = await api.importTableAsJson(jsonString);\n        //  false \n        if (result === false) {\n          throw new Error(' false');\n        }\n        console.info('[DICE]');\n      } catch (apiError) {\n        console.error('[DICE]ACU API :', apiError);\n        //  \"Settings could not be saved\" \n        const errorMsg = apiError.message || String(apiError);\n        if (\n          errorMsg.includes('Settings could not be saved') ||\n          errorMsg.includes('server connection') ||\n          errorMsg.includes('data loss')\n        ) {\n          throw new Error('');\n        }\n        throw new Error(`: ${errorMsg}`);\n      }\n\n      // 5. \n      cachedRawData = dataToSave;\n      saveSnapshot(dataToSave);\n      hasUnsavedChanges = false;\n      currentDiffMap = new Set();\n      if (window.acuModifiedSet) window.acuModifiedSet.clear();\n      console.info('[DICE]');\n\n      if (!skipRender) {\n        renderInterface();\n      }\n    } catch (e) {\n      const errorMessage = e.message || '';\n      console.error('[DICE]:', {\n        error: e,\n        message: errorMessage,\n        stack: e.stack,\n      });\n      if (window.toastr) {\n        window.toastr.error(errorMessage, '', { timeOut: 5000 });\n      } else {\n        alert(`: ${errorMessage}`);\n      }\n      // \n      throw e;\n    } finally {\n      isSaving = false;\n      console.info('[DICE]');\n      if (!skipRender && $saveBtn.length) {\n        $saveBtn.find('i').removeClass('fa-spinner fa-spin').addClass('fa-save');\n        $saveBtn.prop('disabled', false);\n      }\n    }\n  };\n\n  // [] \n  const saveDataOnly = async tableData => {\n    try {\n      const dataToSave = {};\n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // \n      let jsonString;\n      try {\n        jsonString = JSON.stringify(dataToSave);\n        //  10MB \n        const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n        if (sizeInMB > 10) {\n          throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n        }\n      } catch (stringifyError) {\n        console.error('[DICE]ACU JSON :', stringifyError);\n        throw new Error(`: ${stringifyError.message || stringifyError}`);\n      }\n\n      const api = getCore().getDB();\n      if (!api || !api.importTableAsJson) {\n        throw new Error(' API ');\n      }\n\n      try {\n        //  importTableAsJson saveChat()\n        const result = await api.importTableAsJson(jsonString);\n        //  false \n        if (result === false) {\n          throw new Error(' false');\n        }\n      } catch (apiError) {\n        console.error('[DICE]ACU API :', apiError);\n        //  \"Settings could not be saved\" \n        const errorMsg = apiError.message || String(apiError);\n        if (\n          errorMsg.includes('Settings could not be saved') ||\n          errorMsg.includes('server connection') ||\n          errorMsg.includes('data loss')\n        ) {\n          throw new Error('');\n        }\n        throw new Error(`: ${errorMsg}`);\n      }\n\n      cachedRawData = dataToSave;\n      //  saveSnapshot() hasUnsavedChanges\n    } catch (e) {\n      console.error('[DICE]ACU saveDataOnly error:', e);\n      // \n      throw e;\n    }\n  };\n  const processJsonData = json => {\n    const tables = {};\n    if (!json || typeof json !== 'object') return tables;\n    for (const sheetId in json) {\n      if (json[sheetId]?.name) {\n        const sheet = json[sheetId];\n        tables[sheet.name] = {\n          key: sheetId,\n          headers: sheet.content ? sheet.content[0] || [] : [],\n          rows: sheet.content ? sheet.content.slice(1) : [],\n          rawContent: sheet.content || [],\n          exportConfig: sheet.exportConfig || {},\n          updateConfig: sheet.updateConfig || {},\n          ...sheet,\n        };\n      }\n    }\n    return tables;\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function suggestFormatValue(pattern, rowIndex, existingValues = [], tableContent = null) {\n    if (!pattern || rowIndex === undefined || rowIndex < 0) return null;\n\n    try {\n      //  \"+\"  ^AM\\d{3}$\n      // pattern  JavaScript  '^AM\\\\d{3}$' '^AM\\d{3}$'\n      //  \\d{3} /\\\\d\\{3\\}/+d\n      // ^?[]+\\d\\{\\}$?\n      const prefixMatch = pattern.match(/^\\^?([A-Za-z]+)\\\\d\\{(\\d+)\\}\\$?$/);\n\n      if (prefixMatch) {\n        const prefix = prefixMatch[1]; // \"AM\"\n        const digits = parseInt(prefixMatch[2], 10); // 3\n\n        // \n        if (tableContent && (tableContent.name === '' || tableContent.name === '')) {\n          const headers = tableContent.content?.[0] || [];\n          const rows = tableContent.content?.slice(1) || [];\n          const codeIndex = headers.indexOf('');\n\n          if (codeIndex >= 0) {\n            // \n            const existingNumbers = [];\n            rows.forEach(row => {\n              const codeValue = row?.[codeIndex];\n              if (codeValue && typeof codeValue === 'string') {\n                const match = codeValue.match(new RegExp(`^${prefix}(\\\\d+)$`));\n                if (match) {\n                  const num = parseInt(match[1], 10);\n                  if (!isNaN(num)) existingNumbers.push(num);\n                }\n              }\n            });\n\n            // \n            const maxNum = existingNumbers.length > 0 ? Math.max(...existingNumbers) : 0;\n            const nextNum = String(maxNum + 1).padStart(digits, '0');\n            return prefix + nextNum;\n          }\n        }\n\n        // \n        const nextNum = String(rowIndex + 1).padStart(digits, '0');\n        return prefix + nextNum;\n      }\n\n      //  \\d{3} \n      const numOnlyMatch = pattern.match(/^\\^?\\\\d\\{(\\d+)\\}\\$?$/);\n      if (numOnlyMatch) {\n        const digits = parseInt(numOnlyMatch[1], 10);\n        return String(rowIndex + 1).padStart(digits, '0');\n      }\n    } catch (e) {\n      console.error('[DICE]ACU :', e);\n    }\n\n    return null; // \n  }\n\n  //  OR \n  function getRelationOptions(refTable, refColumns, rawData) {\n    const options = new Set();\n    if (!refTable || !refColumns || !rawData) return Array.from(options);\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        columns.forEach(col => {\n          const colIdx = headers.indexOf(col);\n          if (colIdx >= 0) {\n            rows.forEach(row => {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                options.add(String(value).trim());\n              }\n            });\n          }\n        });\n\n        break; // \n      }\n    }\n\n    return Array.from(options).sort();\n  }\n\n  // \n  function isValueInRelationTable(value, refTable, refColumns, rawData) {\n    if (!value || !refTable || !refColumns || !rawData) return false;\n    if (String(value).trim() === '') return false;\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n    const strVal = String(value).trim();\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        for (const col of columns) {\n          const colIdx = headers.indexOf(col);\n          if (colIdx === -1) continue;\n\n          // \n          for (let i = 0; i < rows.length; i++) {\n            const cellValue = rows[i]?.[colIdx];\n            if (cellValue !== null && cellValue !== undefined && String(cellValue).trim() === strVal) {\n              return true; // \n            }\n          }\n        }\n\n        break; // \n      }\n    }\n\n    return false; // \n  }\n\n  //  required \n  function getColumnExamples(tableName, columnName, currentRowIndex, rawData, maxCount = 5) {\n    const examples = new Set();\n    if (!tableName || !columnName || !rawData) return [];\n\n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === tableName) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n        const colIdx = headers.indexOf(columnName);\n\n        if (colIdx >= 0) {\n          rows.forEach((row, idx) => {\n            if (idx !== currentRowIndex) {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                examples.add(String(value).trim());\n              }\n            }\n          });\n        }\n        break;\n      }\n    }\n\n    return Array.from(examples).slice(0, maxCount);\n  }\n\n  // \n  function getNearestValidNumber(currentValue, min, max) {\n    const num = parseFloat(currentValue);\n    if (isNaN(num)) return min !== undefined ? min : 0;\n    if (min !== undefined && num < min) return min;\n    if (max !== undefined && num > max) return max;\n    return num;\n  }\n\n  // ========================================\n  // \n  // ========================================\n  const showAddValidationRuleModal = parentDialog => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const tables = processJsonData(rawData || {});\n    const tableNames = Object.keys(tables);\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-settings-header\">\n            <div class=\"acu-settings-title\"><i class=\"fa-solid fa-plus\"></i> </div>\n            <button class=\"acu-close-btn\" id=\"dlg-rule-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-table\" class=\"acu-setting-select\">\n                <option value=\"\">...</option>\n                ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"row-column\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-column\" class=\"acu-setting-select\" disabled>\n                <option value=\"\">...</option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-type\" class=\"acu-setting-select\">\n                <optgroup label=\"  \">\n                  <option value=\"tableReadonly\"></option>\n                  <option value=\"rowLimit\"></option>\n                  <option value=\"sequence\"></option>\n                </optgroup>\n                <optgroup label=\"  \">\n                  <option value=\"required\"></option>\n                  <option value=\"format\"></option>\n                  <option value=\"enum\"></option>\n                  <option value=\"numeric\"></option>\n                  <option value=\"relation\"></option>\n                  <option value=\"keyValue\"></option>\n                </optgroup>\n              </select>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-tableReadonly\">\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:8px;background:var(--acu-card-bg);border-radius:4px;\">\n                <i class=\"fa-solid fa-info-circle\"></i> \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-rowLimit\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-max\" class=\"acu-panel-input\" placeholder=\"\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-sequence\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-sequence-prefix\" class=\"acu-panel-input\" placeholder=\"AM\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-sequence-start\" class=\"acu-panel-input\" placeholder=\"1\" value=\"1\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-sequence-paired-table\" class=\"acu-setting-select\" style=\"flex:1;\">\n                  <option value=\"\"></option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:8px;background:var(--acu-card-bg);border-radius:4px;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\"></i> \"+\"AM001, AM002, AM003...<br>\n                <i class=\"fa-solid fa-link\" style=\"margin-top:4px;display:block;\"></i> \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-required\" style=\"display:none;\">\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:8px;background:var(--acu-card-bg);border-radius:4px;\">\n                <i class=\"fa-solid fa-info-circle\"></i> \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-format\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-pattern\" class=\"acu-panel-input\" placeholder=\"^AM\\\\d{3}$\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-enum\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-values\" class=\"acu-panel-input\" placeholder=\",,\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-numeric\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-relation\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-table\" class=\"acu-setting-select\">\n                  <option value=\"\">...</option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-column\" class=\"acu-setting-select\" multiple style=\"flex:1;min-height:80px;\">\n                  <option value=\"\">...</option>\n                </select>\n              </div>\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:8px;background:var(--acu-card-bg);border-radius:4px;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\"></i> OR  Ctrl/Cmd \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-keyValue\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-keyvalue-type\" class=\"acu-setting-select\">\n                  <option value=\"text\"></option>\n                  <option value=\"numeric\"></option>\n                </select>\n              </div>\n              <div class=\"acu-setting-row\" id=\"row-keyvalue-range\" style=\"display:none;\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:8px;background:var(--acu-card-bg);border-radius:4px;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\"></i> :;:\n              </div>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-error-msg\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n          </div>\n          <div class=\"acu-validation-modal-footer\">\n            <button class=\"acu-btn acu-btn-secondary\" id=\"dlg-rule-cancel\"></button>\n            <button class=\"acu-btn acu-btn-primary\" id=\"dlg-rule-save\"></button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // select\n    const updateSelectColor = $select => {\n      const val = $select.val();\n      if (!val || val === '') {\n        $select.css('color', 'var(--acu-text-sub)');\n        $select.css('opacity', '0.7');\n      } else {\n        $select.css('color', 'var(--acu-text-main)');\n        $select.css('opacity', '1');\n      }\n    };\n\n    // select\n    dialog.find('select').each(function () {\n      updateSelectColor($(this));\n      $(this).on('change', function () {\n        updateSelectColor($(this));\n      });\n    });\n\n    // \n    dialog.find('#rule-table').on('change', function () {\n      const tableName = $(this).val();\n      const $colSelect = dialog.find('#rule-column');\n      const $pairedTableSelect = dialog.find('#cfg-sequence-paired-table');\n      updateSelectColor($(this));\n\n      // \n      if ($pairedTableSelect.length > 0) {\n        const currentPairedValue = $pairedTableSelect.val();\n        $pairedTableSelect.empty();\n        $pairedTableSelect.append('<option value=\"\"></option>');\n        tableNames\n          .filter(name => name !== tableName)\n          .forEach(name => {\n            $pairedTableSelect.append(`<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`);\n          });\n        // \n        if (currentPairedValue && currentPairedValue !== tableName) {\n          $pairedTableSelect.val(currentPairedValue);\n        }\n        updateSelectColor($pairedTableSelect);\n      }\n\n      if (!tableName || !tables[tableName]) {\n        $colSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($colSelect);\n        return;\n      }\n\n      const headers = tables[tableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $colSelect.html('<option value=\"\">...</option>' + options).prop('disabled', false);\n      updateSelectColor($colSelect);\n    });\n\n    // \n    dialog.find('#cfg-ref-table').on('change', function () {\n      const refTableName = $(this).val();\n      const $refColSelect = dialog.find('#cfg-ref-column');\n      updateSelectColor($(this));\n\n      if (!refTableName || !tables[refTableName]) {\n        $refColSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($refColSelect);\n        return;\n      }\n\n      const headers = tables[refTableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $refColSelect.html(options).prop('disabled', false);\n      updateSelectColor($refColSelect);\n    });\n\n    // \n    dialog.find('#rule-type').on('change', function () {\n      const type = $(this).val();\n      const typeInfo = RULE_TYPE_INFO[type];\n      const isTableRule = typeInfo?.scope === 'table';\n      updateSelectColor($(this));\n\n      // \n      dialog.find('.acu-rule-config-section').hide();\n      dialog.find('#config-' + type).show();\n\n      // sequence\n      if (isTableRule && type !== 'sequence') {\n        dialog.find('#row-column').hide();\n        dialog.find('#rule-column').val('').prop('disabled', true);\n      } else {\n        dialog.find('#row-column').show();\n        // \n        if (dialog.find('#rule-table').val()) {\n          dialog.find('#rule-column').prop('disabled', false);\n        }\n      }\n    });\n\n    // /\n    dialog.find('#cfg-keyvalue-type').on('change', function () {\n      const valueType = $(this).val();\n      if (valueType === 'numeric') {\n        dialog.find('#row-keyvalue-range').show();\n      } else {\n        dialog.find('#row-keyvalue-range').hide();\n      }\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#dlg-rule-close, #dlg-rule-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#dlg-rule-save').on('click', function () {\n      const name = dialog.find('#rule-name').val()?.trim();\n      const targetTable = dialog.find('#rule-table').val();\n      const targetColumn = dialog.find('#rule-column').val();\n      const ruleType = dialog.find('#rule-type').val();\n      const errorMessage = dialog.find('#rule-error-msg').val()?.trim();\n      const typeInfo = RULE_TYPE_INFO[ruleType];\n      const isTableRule = typeInfo?.scope === 'table';\n\n      // \n      if (!name) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!targetTable) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      // sequence\n      if ((!isTableRule || ruleType === 'sequence') && !targetColumn) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      const ruleConfig = {};\n      if (ruleType === 'tableReadonly') {\n        // \n      } else if (ruleType === 'rowLimit') {\n        const min = dialog.find('#cfg-row-min').val();\n        const max = dialog.find('#cfg-row-max').val();\n        if (min !== '') ruleConfig.min = parseInt(min, 10);\n        if (max !== '') ruleConfig.max = parseInt(max, 10);\n      } else if (ruleType === 'required') {\n        // \n      } else if (ruleType === 'format') {\n        const pattern = dialog.find('#cfg-pattern').val()?.trim();\n        if (!pattern) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        // \n        try {\n          new RegExp(pattern);\n        } catch (e) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n        ruleConfig.pattern = pattern;\n      } else if (ruleType === 'enum') {\n        const valuesStr = dialog.find('#cfg-values').val()?.trim();\n        if (!valuesStr) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        ruleConfig.values = valuesStr\n          .split(',')\n          .map(v => v.trim())\n          .filter(v => v);\n      } else if (ruleType === 'numeric') {\n        const min = dialog.find('#cfg-min').val();\n        const max = dialog.find('#cfg-max').val();\n        if (min !== '') ruleConfig.min = parseFloat(min);\n        if (max !== '') ruleConfig.max = parseFloat(max);\n      } else if (ruleType === 'relation') {\n        const refTable = dialog.find('#cfg-ref-table').val();\n        const refColumns = dialog.find('#cfg-ref-column').val(); // \n\n        if (!refTable) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        const selectedColumns = Array.isArray(refColumns) ? refColumns : refColumns ? [refColumns] : [];\n        if (selectedColumns.length === 0 || (selectedColumns.length === 1 && !selectedColumns[0])) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        ruleConfig.refTable = refTable;\n        // \n        ruleConfig.refColumn = selectedColumns.length === 1 ? selectedColumns[0] : selectedColumns;\n      } else if (ruleType === 'keyValue') {\n        const valueType = dialog.find('#cfg-keyvalue-type').val();\n        ruleConfig.valueType = valueType || 'text';\n\n        if (valueType === 'numeric') {\n          const min = dialog.find('#cfg-keyvalue-min').val();\n          const max = dialog.find('#cfg-keyvalue-max').val();\n          if (min !== '') ruleConfig.valueMin = parseFloat(min);\n          if (max !== '') ruleConfig.valueMax = parseFloat(max);\n        }\n      } else if (ruleType === 'sequence') {\n        const prefix = dialog.find('#cfg-sequence-prefix').val()?.trim() || '';\n        const startFrom = dialog.find('#cfg-sequence-start').val();\n        const pairedTable = dialog.find('#cfg-sequence-paired-table').val()?.trim() || null;\n        ruleConfig.prefix = prefix;\n        ruleConfig.startFrom = startFrom !== '' ? parseInt(startFrom, 10) : 1;\n        if (isNaN(ruleConfig.startFrom)) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        if (pairedTable) {\n          ruleConfig.pairedTable = pairedTable;\n        }\n      }\n\n      //  ID\n      const ruleId = 'custom_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);\n\n      // \n      const newRule = {\n        id: ruleId,\n        name: name,\n        description: '',\n        targetTable: targetTable,\n        targetColumn: isTableRule && ruleType !== 'sequence' ? '' : targetColumn, //  targetColumnsequence\n        ruleType: ruleType,\n        config: ruleConfig,\n        errorMessage: errorMessage || typeInfo?.desc || '',\n        intercept: false, // \n      };\n\n      if (ValidationRuleManager.addCustomRule(newRule)) {\n        closeDialog();\n\n        // \n        const $rulesList = parentDialog.find('#validation-rules-list');\n        const ruleHtml = `\n          <div class=\"acu-validation-rule-item\" data-rule-id=\"${escapeHtml(ruleId)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo?.name || ruleType)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo?.icon || 'fa-question'}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(targetTable)}${isTableRule && ruleType !== 'sequence' ? ' ()' : '.' + escapeHtml(targetColumn)}</div>\n            </div>\n            <div class=\"acu-rule-intercept\" data-rule-id=\"${escapeHtml(ruleId)}\" title=\"\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <div class=\"acu-rule-toggle active\" title=\"/\">\n              <i class=\"fa-solid fa-toggle-on\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(ruleId)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n        `;\n        $rulesList.append(ruleHtml);\n        // \n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showSmartFixModal = error => {\n    if (!error || !error.rule) {\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const rule = error.rule;\n    const ruleType = error.ruleType || rule.ruleType;\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n    const isTableRule = typeInfo?.scope === 'table';\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const snapshot = loadSnapshot();\n\n    //  rowTitle\n    if (!error.rowTitle && error.rowIndex >= 0 && rawData && error.tableName) {\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          const row = rawData[sheetId].content?.[error.rowIndex + 1];\n          if (row) {\n            error.rowTitle = row[1] || row[0] || ` ${error.rowIndex + 1}`;\n          }\n          break;\n        }\n      }\n    }\n\n    // \n    let snapshotValue = '';\n    if (!isTableRule && snapshot && error.tableName && error.columnName !== undefined) {\n      for (const sheetId in snapshot) {\n        if (snapshot[sheetId]?.name === error.tableName) {\n          const headers = snapshot[sheetId].content?.[0] || [];\n          const colIdx = headers.indexOf(error.columnName);\n          const rowIdx = error.rowIndex + 1;\n          if (colIdx >= 0 && snapshot[sheetId].content?.[rowIdx]) {\n            snapshotValue = snapshot[sheetId].content[rowIdx][colIdx] ?? '';\n          }\n          break;\n        }\n      }\n    }\n\n    const hasSnapshotValue = snapshotValue !== '' && String(snapshotValue) !== String(error.currentValue || '');\n\n    // ========================================\n    // \n    // ========================================\n    if (isTableRule) {\n      showTableRuleFixModal(error, rule, ruleType, rawData, snapshot, currentThemeClass);\n      return;\n    }\n\n    // ========================================\n    // \n    // ========================================\n\n    // UI\n    let inputHtml = '';\n\n    if (ruleType === 'enum' && rule.config?.values) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'numeric') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'keyValue') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else {\n      // \n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    }\n\n    // \n    let smartSuggestHtml = '';\n\n    if (ruleType === 'required') {\n      // \n      const examples = getColumnExamples(error.tableName, error.columnName, error.rowIndex, rawData, 5);\n      if (examples.length > 0) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            <div class=\"acu-smart-fix-suggest-label\">\n              <i class=\"fa-solid fa-lightbulb\"></i> :\n            </div>\n            <div class=\"acu-smart-fix-suggest-options\">\n              ${examples\n                .map(\n                  val => `\n                <span class=\"acu-smart-fix-option\" data-value=\"${escapeHtml(val)}\" title=\"\">\n                  ${escapeHtml(val.length > 20 ? val.substring(0, 20) + '...' : val)}\n                </span>\n              `,\n                )\n                .join('')}\n            </div>\n          </div>\n        `;\n      }\n    } else if (ruleType === 'enum' && rule.config?.values) {\n      // \n      const validValues = rule.config.values;\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-list\"></i>  ():\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\">\n            ${validValues\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        </div>\n      `;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      // \n      // \n      let tableContent = null;\n      if (rawData && error.tableName) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            tableContent = rawData[sheetId];\n            break;\n          }\n        }\n      }\n      const suggestedValue = suggestFormatValue(rule.config.pattern, error.rowIndex, [], tableContent);\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-font\"></i> : <code>${escapeHtml(rule.config.pattern)}</code>\n          </div>\n          ${\n            suggestedValue\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:4px;display:block;\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </span>\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(suggestedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> ${escapeHtml(suggestedValue)}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'numeric') {\n      // \n      const min = rule.config?.min;\n      const max = rule.config?.max;\n      const currentNum = parseFloat(error.currentValue);\n      const isOutOfRange =\n        !isNaN(currentNum) && ((min !== undefined && currentNum < min) || (max !== undefined && currentNum > max));\n      const nearestValid = isOutOfRange ? getNearestValidNumber(error.currentValue, min, max) : null;\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-hashtag\"></i> : ${min !== undefined ? min : '-'} ~ ${max !== undefined ? max : '+'}\n          </div>\n          ${\n            isOutOfRange && nearestValid !== null\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${nearestValid}\">\n                <i class=\"fa-solid fa-arrow-right\"></i>  ${nearestValid}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      // \n      const options = getRelationOptions(rule.config.refTable, rule.config.refColumn, rawData);\n      const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n      const hasMultipleColumns = refColumns.length > 1;\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      const valueExists = isValueInRelationTable(\n        currentInvalidValue,\n        rule.config.refTable,\n        rule.config.refColumn,\n        rawData,\n      );\n\n      // HTML\n      let optionsHtml = '';\n      if (options.length > 0) {\n        optionsHtml = `\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-link\"></i>  \"${escapeHtml(rule.config.refTable)}\"  (${options.length}):\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\" id=\"smart-fix-options-container\">\n            ${options\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      // \n      let reverseWriteHtml = '';\n      if (currentInvalidValue && !valueExists) {\n        if (hasMultipleColumns) {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <select id=\"smart-fix-reverse-column\" class=\"acu-edit-select\" style=\"width:100%;margin-bottom:8px;\">\n                  ${refColumns.map(col => `<option value=\"${escapeHtml(col)}\">${escapeHtml(col)}</option>`).join('')}\n                </select>\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}\"\n                </button>\n              </div>\n            </div>\n          `;\n        } else {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" data-column=\"${escapeHtml(refColumns[0])}\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}.${escapeHtml(refColumns[0])}\"\n                </button>\n              </div>\n            </div>\n          `;\n        }\n      }\n\n      if (optionsHtml || reverseWriteHtml) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            ${optionsHtml}\n            ${reverseWriteHtml}\n          </div>\n        `;\n      }\n    } else if (ruleType === 'keyValue') {\n      // \n      const valueType = rule.config?.valueType || 'text';\n      const valueMin = rule.config?.valueMin;\n      const valueMax = rule.config?.valueMax;\n\n      // \n      let processedValue = String(error.currentValue || '');\n      processedValue = processedValue.replace(//g, ':').replace(//g, ';').replace(//g, ';').replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n      const issues = [];\n      const fixedPairs = [];\n\n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          issues.push({ pair, error: '/' });\n          continue;\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) {\n          issues.push({ pair, error: '' });\n          continue;\n        }\n\n        let fixedVal = val;\n        let hasIssue = false;\n\n        if (valueType === 'numeric') {\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) {\n            issues.push({ pair, error: `\"${val}\" ` });\n            hasIssue = true;\n          } else {\n            if (valueMin !== undefined && valueMin !== null && numVal < valueMin) {\n              fixedVal = String(valueMin);\n              issues.push({ pair, error: ` ${numVal}  ${valueMin}` });\n              hasIssue = true;\n            } else if (valueMax !== undefined && valueMax !== null && numVal > valueMax) {\n              fixedVal = String(valueMax);\n              issues.push({ pair, error: ` ${numVal}  ${valueMax}` });\n              hasIssue = true;\n            }\n          }\n        }\n\n        fixedPairs.push({ key, val: fixedVal, originalVal: val, hasIssue });\n      }\n\n      // \n      const fixedValue = fixedPairs.map(p => `${p.key}:${p.val}`).join(';');\n      const hasIssues = issues.length > 0 || fixedPairs.some(p => p.hasIssue);\n\n      let issuesHtml = '';\n      if (hasIssues) {\n        issuesHtml = `\n          <div class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:8px;\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i> :\n          </div>\n          <div style=\"margin-bottom:8px;\">\n            ${issues\n              .map(\n                issue => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(issue.pair)} - ${escapeHtml(issue.error)}\n              </div>\n            `,\n              )\n              .join('')}\n            ${fixedPairs\n              .filter(p => p.hasIssue)\n              .map(\n                p => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(p.key)}:${escapeHtml(p.originalVal)}  ${escapeHtml(p.val)}\n              </div>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-key\"></i> : :;:\n          </div>\n          ${\n            valueType === 'numeric'\n              ? `\n            <div class=\"acu-smart-fix-suggest-label\" style=\"margin-top:8px;\">\n              <i class=\"fa-solid fa-hashtag\"></i> : ${valueMin !== undefined ? valueMin : '-'} ~ ${valueMax !== undefined ? valueMax : '+'}\n            </div>\n          `\n              : ''\n          }\n          ${issuesHtml}\n          ${\n            hasIssues\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(fixedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> \n              </span>\n            </div>\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-card-bg);border-radius:4px;font-size:11px;color:var(--acu-text-sub);\">\n              <div style=\"margin-bottom:4px;\"><strong>:</strong></div>\n              <code style=\"color:var(--acu-success-text);\">${escapeHtml(fixedValue)}</code>\n            </div>\n          `\n              : `\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-success-bg);border-radius:4px;font-size:11px;color:var(--acu-success-text);\">\n              <i class=\"fa-solid fa-check-circle\"></i> \n            </div>\n          `\n          }\n        </div>\n      `;\n    }\n\n    // HTML\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} - ${escapeHtml(error.columnName || '')}</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            <!--  -->\n            <div class=\"acu-smart-fix-rule-info\">\n              <div class=\"acu-smart-fix-rule-header\">\n                <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                <span>${escapeHtml(error.ruleName || rule.name || '')}</span>\n              </div>\n              <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || typeInfo.desc || '')}</div>\n            </div>\n\n            <!--  -->\n            ${\n              hasSnapshotValue\n                ? `\n              <div class=\"acu-diff-section acu-diff-old-section\">\n                <div class=\"acu-diff-label\">\n                  <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                </div>\n                <div class=\"acu-diff-readonly\">${escapeHtml(snapshotValue)}</div>\n              </div>\n              <div class=\"acu-diff-arrow-down\"><i class=\"fa-solid fa-arrow-down\"></i></div>\n            `\n                : ''\n            }\n\n            <!--  -->\n            <div class=\"acu-diff-section acu-diff-new-section\">\n              ${\n                error.rowTitle && error.rowIndex >= 0\n                  ? `<div style=\"font-size:12px;color:var(--acu-text-sub);margin-bottom:8px;padding:4px 8px;background:var(--acu-bg-sub);border-radius:4px;\">\n                <i class=\"fa-solid fa-tag\" style=\"margin-right:4px;\"></i>${escapeHtml(error.rowTitle)}\n              </div>`\n                  : ''\n              }\n              <div class=\"acu-diff-label\">\n                <i class=\"fa-solid fa-pen\"></i> \n              </div>\n              ${inputHtml}\n            </div>\n\n            <!--  -->\n            ${\n              smartSuggestHtml\n                ? `\n              <div class=\"acu-smart-fix-suggest-section\">\n                ${smartSuggestHtml}\n              </div>\n            `\n                : ''\n            }\n          </div>\n          <div class=\"acu-dialog-btns\">\n            <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n            ${hasSnapshotValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n            <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    dialog.on('click', '.acu-smart-fix-option, .acu-smart-fix-quick-btn', function () {\n      // \n      if ($(this).attr('id') === 'smart-fix-reverse-write-btn') return;\n      if ($(this).hasClass('acu-smart-fix-option-current')) return;\n      const optionValue = $(this).data('value') || $(this).text().trim();\n      dialog.find('#smart-fix-value').val(optionValue).trigger('input');\n    });\n\n    // \n    dialog.on('click', '#smart-fix-reverse-write-btn', async function () {\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      if (!currentInvalidValue) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      let targetColumn;\n      if (ruleType === 'relation' && rule.config?.refColumn) {\n        const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n        if (refColumns.length > 1) {\n          // \n          targetColumn = dialog.find('#smart-fix-reverse-column').val();\n        } else {\n          // data\n          targetColumn = $(this).data('column') || refColumns[0];\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      if (!targetColumn || !rule.config?.refTable) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      try {\n        const rawData = cachedRawData || getTableData();\n        let refSheet = null;\n        let refSheetId = null;\n\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === rule.config.refTable) {\n            refSheet = rawData[sheetId];\n            refSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!refSheet || !refSheet.content) {\n          if (window.toastr) window.toastr.error(` \"${rule.config.refTable}\"`);\n          return;\n        }\n\n        const headers = refSheet.content[0] || [];\n        const targetColIdx = headers.indexOf(targetColumn);\n\n        if (targetColIdx === -1) {\n          if (window.toastr) window.toastr.error(` \"${targetColumn}\"`);\n          return;\n        }\n\n        // \n        const newRow = new Array(headers.length).fill('');\n        newRow[targetColIdx] = currentInvalidValue;\n\n        // \n        refSheet.content.push(newRow);\n\n        // \n        await saveDataToDatabase(rawData, false, false);\n\n        // \n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-revert', function () {\n      dialog.find('#smart-fix-value').val(snapshotValue);\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-close, #smart-fix-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#smart-fix-confirm').on('click', async function () {\n      const newValue = dialog.find('#smart-fix-value').val()?.trim() || '';\n\n      if (newValue === '' && ruleType === 'required') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      try {\n        const rawData = cachedRawData || getTableData();\n        let updated = false;\n\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            const sheet = rawData[sheetId];\n            const headers = sheet.content?.[0] || [];\n\n            if (error.rowIndex >= 0 && error.columnName) {\n              const colIdx = headers.indexOf(error.columnName);\n              const rowIdx = error.rowIndex + 1;\n\n              if (colIdx >= 0 && sheet.content && sheet.content[rowIdx]) {\n                sheet.content[rowIdx][colIdx] = newValue;\n                updated = true;\n                break;\n              }\n            }\n          }\n        }\n\n        if (updated) {\n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function extractCodesFromTable(sheet, columnName, prefix) {\n    if (!sheet || !sheet.content || sheet.content.length < 2) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const headers = sheet.content[0] || [];\n    const rows = sheet.content.slice(1) || [];\n    const colIndex = headers.indexOf(columnName);\n\n    if (colIndex < 0) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const codes = new Map(); // Map<, >\n    const allCodes = new Set(); // Set<>\n    const codeToRows = new Map(); // Map<, >\n\n    for (let i = 0; i < rows.length; i++) {\n      const value = rows[i]?.[colIndex];\n      if (value === null || value === undefined || value === '') continue;\n\n      const strValue = String(value).trim();\n      if (!strValue) continue;\n\n      // \n      let isValid = false;\n      if (prefix) {\n        const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          isValid = true;\n        }\n      } else {\n        const num = parseInt(strValue, 10);\n        if (!isNaN(num)) {\n          isValid = true;\n        }\n      }\n\n      if (isValid) {\n        allCodes.add(strValue);\n        if (!codeToRows.has(strValue)) {\n          codeToRows.set(strValue, []);\n        }\n        codeToRows.get(strValue).push(i);\n      }\n    }\n\n    return { codes, allCodes, codeToRows };\n  }\n\n  //   \n  function buildCodeMapping(codes1, codes2, prefix, startFrom) {\n    // \n    const allUniqueCodes = new Set([...codes1, ...codes2]);\n\n    // \n    const codeNumbers = [];\n    for (const code of allUniqueCodes) {\n      let num = null;\n      if (prefix) {\n        const match = code.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          num = parseInt(match[1], 10);\n        }\n      } else {\n        num = parseInt(code, 10);\n      }\n\n      if (!isNaN(num)) {\n        codeNumbers.push({ code, num });\n      }\n    }\n\n    // \n    codeNumbers.sort((a, b) => a.num - b.num);\n\n    //   \n    const mapping = new Map();\n    for (let i = 0; i < codeNumbers.length; i++) {\n      const oldCode = codeNumbers[i].code;\n      const newNum = startFrom + i;\n      const newCode = prefix + String(newNum).padStart(3, '0');\n      mapping.set(oldCode, newCode);\n    }\n\n    return mapping;\n  }\n\n  // \n  // \n  // 1. \n  // 2. \n  // 3. \n  function alignAndFixPairedTables(\n    table1Sheet,\n    table1SheetId,\n    table2Sheet,\n    table2SheetId,\n    columnName,\n    mapping,\n    prefix,\n    startFrom,\n    rawData,\n  ) {\n    if (!table1Sheet || !table2Sheet) return { fixedCount1: 0, fixedCount2: 0 };\n\n    const headers1 = table1Sheet.content[0] || [];\n    const rows1 = table1Sheet.content.slice(1) || [];\n    const colIndex1 = headers1.indexOf(columnName);\n\n    const headers2 = table2Sheet.content[0] || [];\n    const rows2 = table2Sheet.content.slice(1) || [];\n    const colIndex2 = headers2.indexOf(columnName);\n\n    if (colIndex1 < 0 || colIndex2 < 0) return { fixedCount1: 0, fixedCount2: 0 };\n\n    let fixedCount1 = 0;\n    let fixedCount2 = 0;\n\n    //  -> \n    const reverseMapping = new Map();\n    for (const [oldCode, newCode] of mapping.entries()) {\n      reverseMapping.set(newCode, oldCode);\n    }\n\n    // \n    const sortedNewCodes = Array.from(mapping.values()).sort((a, b) => {\n      const numA = parseInt(a.replace(prefix, ''), 10);\n      const numB = parseInt(b.replace(prefix, ''), 10);\n      return numA - numB;\n    });\n\n    // \n    const analyzeTable = (rows, colIndex) => {\n      const codeRows = []; // {rowIndex, oldCode, row}\n      const emptyRows = []; // {rowIndex, row, prevOldCode, nextOldCode}\n\n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        const strValue = value === null || value === undefined ? '' : String(value).trim();\n\n        // \n        let isValid = false;\n        if (strValue && prefix) {\n          const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          if (match) isValid = true;\n        } else if (strValue) {\n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) isValid = true;\n        }\n\n        if (isValid) {\n          codeRows.push({ rowIndex: i, oldCode: strValue, row: rows[i] });\n        } else {\n          emptyRows.push({ rowIndex: i, row: rows[i], prevOldCode: null, nextOldCode: null });\n        }\n      }\n\n      // \n      for (const emptyRow of emptyRows) {\n        let prevCode = null;\n        let nextCode = null;\n\n        for (const codeRow of codeRows) {\n          if (codeRow.rowIndex < emptyRow.rowIndex) {\n            prevCode = codeRow.oldCode;\n          }\n          if (codeRow.rowIndex > emptyRow.rowIndex && nextCode === null) {\n            nextCode = codeRow.oldCode;\n            break;\n          }\n        }\n\n        emptyRow.prevOldCode = prevCode;\n        emptyRow.nextOldCode = nextCode;\n      }\n\n      return { codeRows, emptyRows };\n    };\n\n    const analysis1 = analyzeTable(rows1, colIndex1);\n    const analysis2 = analyzeTable(rows2, colIndex2);\n\n    // \n    const buildNewRows = (analysis, headers, colIndex, allOldCodes) => {\n      const newRows = [];\n      const codeRowMap = new Map(); // oldCode -> row data\n\n      // \n      for (const cr of analysis.codeRows) {\n        codeRowMap.set(cr.oldCode, cr.row);\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n\n        if (codeRowMap.has(oldCode)) {\n          // \n          const oldRow = codeRowMap.get(oldCode);\n          const newRow = oldRow.map(cell => cell);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true });\n        } else {\n          // \n          const newRow = new Array(headers.length).fill(null);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true, isInserted: true });\n        }\n      }\n\n      // \n      //  prevOldCode  nextOldCode \n      const result = [];\n      let codeRowIndex = 0;\n\n      // \n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode === null && emptyRow.nextOldCode !== null) {\n          // \n          const nextNewCode = mapping.get(emptyRow.nextOldCode);\n          // \n          while (codeRowIndex < newRows.length && newRows[codeRowIndex].newCode !== nextNewCode) {\n            result.push(newRows[codeRowIndex].row);\n            codeRowIndex++;\n          }\n          result.push(emptyRow.row);\n        } else if (emptyRow.prevOldCode === null && emptyRow.nextOldCode === null) {\n          // \n          result.push(emptyRow.row);\n        }\n      }\n\n      // \n      for (; codeRowIndex < newRows.length; codeRowIndex++) {\n        result.push(newRows[codeRowIndex].row);\n        const currentNewCode = newRows[codeRowIndex].newCode;\n        const currentOldCode = reverseMapping.get(currentNewCode);\n\n        // \n        for (const emptyRow of analysis.emptyRows) {\n          if (emptyRow.prevOldCode === currentOldCode) {\n            result.push(emptyRow.row);\n          }\n        }\n      }\n\n      // prevOldCode nextOldCode  null\n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode !== null && emptyRow.nextOldCode === null) {\n          // \n        }\n      }\n\n      return result;\n    };\n\n    // \n    const newRows1 = buildNewRows(analysis1, headers1, colIndex1, new Set(analysis1.codeRows.map(r => r.oldCode)));\n    const newRows2 = buildNewRows(analysis2, headers2, colIndex2, new Set(analysis2.codeRows.map(r => r.oldCode)));\n\n    // \n    const countCodeChanges = (oldAnalysis, newRows, colIndex) => {\n      let count = 0;\n      // \n      const oldCodes = new Set(oldAnalysis.codeRows.map(r => r.oldCode));\n      const newCodes = new Set();\n\n      for (const row of newRows) {\n        const code = row[colIndex];\n        if (code) newCodes.add(code);\n      }\n\n      // \n      for (const [oldCode, newCode] of mapping.entries()) {\n        if (oldCodes.has(oldCode) && oldCode !== newCode) {\n          count++; // \n        }\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n        if (!oldCodes.has(oldCode)) {\n          count++; // \n        }\n      }\n\n      return count;\n    };\n\n    fixedCount1 = countCodeChanges(analysis1, newRows1, colIndex1);\n    fixedCount2 = countCodeChanges(analysis2, newRows2, colIndex2);\n\n    // \n    table1Sheet.content = [headers1, ...newRows1];\n    table2Sheet.content = [headers2, ...newRows2];\n\n    return { fixedCount1, fixedCount2 };\n  }\n\n  // \n  // ========================================\n  const showTableRuleFixModal = (error, rule, ruleType, rawData, snapshot, currentThemeClass) => {\n    const { $ } = getCore();\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n\n    let contentHtml = '';\n    let actionBtns = '';\n\n    if (ruleType === 'tableReadonly') {\n      // \n      let changeCount = 0;\n      let changeDetails = [];\n\n      if (snapshot && rawData) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            const newRows = rawData[sheetId].content?.slice(1) || [];\n            const oldRows = snapshot[sheetId].content?.slice(1) || [];\n\n            // \n            newRows.forEach((row, idx) => {\n              const oldRow = oldRows[idx];\n              if (!oldRow) {\n                changeDetails.push(`${idx + 1}: `);\n                changeCount++;\n              } else {\n                for (let c = 0; c < row.length; c++) {\n                  if (String(row[c] || '') !== String(oldRow[c] || '')) {\n                    changeDetails.push(`${idx + 1}: `);\n                    changeCount++;\n                    break;\n                  }\n                }\n              }\n            });\n\n            // \n            if (oldRows.length > newRows.length) {\n              for (let i = newRows.length; i < oldRows.length; i++) {\n                changeDetails.push(`${i + 1}: `);\n                changeCount++;\n              }\n            }\n            break;\n          }\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-lock\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\"></div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${changeCount}</strong> \n          </div>\n          ${\n            changeDetails.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\">\n              ${changeDetails\n                .slice(0, 10)\n                .map(d => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(d)}</div>`)\n                .join('')}\n              ${changeDetails.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${changeDetails.length - 10} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n      actionBtns = `\n        <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n        <button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-restore-table\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n      `;\n    } else if (ruleType === 'rowLimit') {\n      // \n      const minRows = rule.config?.min;\n      const maxRows = rule.config?.max;\n      let currentRowCount = 0;\n      let excessRows = [];\n\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          currentRowCount = (rawData[sheetId].content?.length || 1) - 1; // \n          break;\n        }\n      }\n\n      const isTooMany = maxRows !== undefined && currentRowCount > maxRows;\n      const isTooFew = minRows !== undefined && currentRowCount < minRows;\n\n      if (isTooMany) {\n        for (let i = maxRows + 1; i <= currentRowCount; i++) {\n          excessRows.push(i);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-arrows-up-down\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            : <strong>${currentRowCount}</strong> \n            ${minRows !== undefined || maxRows !== undefined ? ` | : ${minRows !== undefined ? minRows : 0} ~ ${maxRows !== undefined ? maxRows : ''} ` : ''}\n          </div>\n          ${\n            isTooMany && excessRows.length > 0\n              ? `\n            <div class=\"acu-smart-fix-excess-rows\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-trash\"></i>  ( ${excessRows[0]} ):\n              </div>\n              <div class=\"acu-smart-fix-change-list\">\n                ${excessRows\n                  .slice(0, 10)\n                  .map(r => `<div class=\"acu-smart-fix-change-item\"> ${r} </div>`)\n                  .join('')}\n                ${excessRows.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${excessRows.length} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n          ${\n            isTooFew\n              ? `\n            <div class=\"acu-smart-fix-hint\">\n              <i class=\"fa-solid fa-info-circle\"></i>  ${minRows - currentRowCount} \n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (isTooMany && excessRows.length > 0) {\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-delete-rows\" data-start=\"${maxRows}\" data-table=\"${escapeHtml(error.tableName)}\">\n            <i class=\"fa-solid fa-trash\"></i>  ${excessRows.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    } else if (ruleType === 'sequence' && rule.targetColumn) {\n      // \n      const prefix = rule.config?.prefix || '';\n      const startFrom = rule.config?.startFrom !== undefined ? rule.config?.startFrom : 1;\n      let targetSheet = null;\n      let issues = [];\n      let fixSuggestions = [];\n\n      // \n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (targetSheet && targetSheet.content && targetSheet.content.length > 1) {\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = headers.indexOf(rule.targetColumn);\n\n        if (colIndex >= 0) {\n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num, originalRowIndex: i + 2 }); // +2 +1\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          const numCountMap = new Map(); // \n          const duplicates = [];\n          const gaps = [];\n          const outOfOrder = [];\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const actualNum = numbers[i].num;\n            if (!numCountMap.has(actualNum)) {\n              numCountMap.set(actualNum, []);\n            }\n            numCountMap.get(actualNum).push(i);\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n\n            // \n            const occurrences = numCountMap.get(actualNum) || [];\n            if (occurrences.length > 1) {\n              // \n              if (occurrences[0] === i) {\n                duplicates.push({\n                  rowNum,\n                  value: numbers[i].value,\n                  num: actualNum,\n                  expectedNum,\n                  count: occurrences.length,\n                });\n              }\n            }\n\n            // \n            if (actualNum !== expectedNum) {\n              if (actualNum < expectedNum) {\n                // \n                outOfOrder.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              } else {\n                // \n                gaps.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              }\n            }\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n            const currentValue = numbers[i].value;\n            const fixedValue = prefix + String(expectedNum).padStart(3, '0');\n\n            if (actualNum !== expectedNum || duplicates.some(d => d.num === actualNum && d.rowNum === rowNum)) {\n              fixSuggestions.push({\n                rowNum,\n                currentValue,\n                fixedValue,\n                reason: actualNum < expectedNum ? '' : actualNum > expectedNum ? '' : '',\n              });\n            }\n          }\n\n          // \n          const issueSet = new Set();\n          duplicates.forEach(d => {\n            issueSet.add(`${d.rowNum}: \"${d.value}\"  (${d.count})`);\n          });\n          gaps.forEach(g => {\n            issueSet.add(\n              `${g.rowNum}: \"${g.value}\"  \"${prefix}${String(g.expectedNum).padStart(3, '0')}\" ()`,\n            );\n          });\n          outOfOrder.forEach(o => {\n            issueSet.add(\n              `${o.rowNum}: \"${o.value}\"  \"${prefix}${String(o.expectedNum).padStart(3, '0')}\" ()`,\n            );\n          });\n          issues = Array.from(issueSet);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-sort-numeric-up\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${issues.length}</strong> \n          </div>\n          ${\n            issues.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n              ${issues\n                .slice(0, 20)\n                .map(issue => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(issue)}</div>`)\n                .join('')}\n              ${issues.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${issues.length - 20} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n          ${\n            fixSuggestions.length > 0\n              ? `\n            <div class=\"acu-smart-fix-suggest\" style=\"margin-top:12px;\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </div>\n              <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n                ${fixSuggestions\n                  .slice(0, 20)\n                  .map(\n                    fix => `\n                  <div class=\"acu-smart-fix-change-item\">\n                    <span style=\"color:var(--acu-text-sub);\">${fix.rowNum}:</span>\n                    <span style=\"color:var(--acu-hl-manual);\">${escapeHtml(fix.currentValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);\">  </span>\n                    <span style=\"color:var(--acu-hl-auto);\">${escapeHtml(fix.fixedValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);font-size:11px;\"> (${escapeHtml(fix.reason)})</span>\n                  </div>\n                `,\n                  )\n                  .join('')}\n                ${fixSuggestions.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${fixSuggestions.length - 20} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (fixSuggestions.length > 0) {\n        // \n        const pairedTable =\n          rule.config?.pairedTable ||\n          (error.tableName === '' ? '' : error.tableName === '' ? '' : null);\n        const pairedTableAttr = pairedTable ? `data-paired-table=\"${escapeHtml(pairedTable)}\"` : '';\n\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-fix-sequence\" data-table=\"${escapeHtml(error.tableName)}\" data-column=\"${escapeHtml(rule.targetColumn)}\" data-prefix=\"${escapeHtml(prefix)}\" data-start=\"${startFrom}\" ${pairedTableAttr}>\n            <i class=\"fa-solid fa-magic\"></i>  ${fixSuggestions.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    }\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} ()</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            ${contentHtml}\n          </div>\n          <div class=\"acu-dialog-btns\">\n            ${actionBtns}\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.on('click', '#smart-fix-restore-table', async function () {\n      if (!snapshot) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      try {\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            rawData[sheetId] = JSON.parse(JSON.stringify(snapshot[sheetId]));\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-fix-sequence', async function () {\n      const $btn = $(this);\n      const tableName = $btn.data('table');\n      const columnName = $btn.data('column');\n      const prefix = $btn.data('prefix') || '';\n      const startFrom = parseInt($btn.data('start') || '1', 10);\n      const pairedTableName = $btn.data('paired-table') || null;\n\n      try {\n        $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n\n        // \n        let targetSheet = null;\n        let targetSheetId = null;\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            targetSheet = rawData[sheetId];\n            targetSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = headers.indexOf(columnName);\n\n        if (colIndex < 0) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        // \n        if (pairedTableName) {\n          // \n          let pairedSheet = null;\n          let pairedSheetId = null;\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === pairedTableName) {\n              pairedSheet = rawData[sheetId];\n              pairedSheetId = sheetId;\n              break;\n            }\n          }\n\n          if (!pairedSheet || !pairedSheet.content || pairedSheet.content.length < 1) {\n            if (window.toastr) window.toastr.warning(`: ${pairedTableName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          const pairedHeaders = pairedSheet.content[0] || [];\n          const pairedColIndex = pairedHeaders.indexOf(columnName);\n\n          if (pairedColIndex < 0) {\n            if (window.toastr) window.toastr.warning(`: ${columnName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          // \n          const extract1 = extractCodesFromTable(targetSheet, columnName, prefix);\n          const extract2 = extractCodesFromTable(pairedSheet, columnName, prefix);\n\n          // \n          const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n          // \n          const { fixedCount1, fixedCount2 } = alignAndFixPairedTables(\n            targetSheet,\n            targetSheetId,\n            pairedSheet,\n            pairedSheetId,\n            columnName,\n            mapping,\n            prefix,\n            startFrom,\n            rawData,\n          );\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          // \n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num });\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          let fixedCount = 0;\n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowIndex = numbers[i].rowIndex;\n\n            if (actualNum !== expectedNum) {\n              const fixedValue = prefix + String(expectedNum).padStart(3, '0');\n              rows[rowIndex][colIndex] = fixedValue;\n              fixedCount++;\n            }\n          }\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n        $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-delete-rows', async function () {\n      const startRow = parseInt($(this).data('start'), 10);\n      const tableName = $(this).data('table');\n\n      try {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            // (index 0) startRow (index 1  startRow)\n            rawData[sheetId].content = rawData[sheetId].content.slice(0, startRow + 1);\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const showBlacklistManagerModal = () => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const theme = getThemeColors();\n    const t = theme;\n\n    $('.acu-blacklist-manager-overlay').remove();\n\n    const blacklist = BlacklistManager.getBlacklist();\n\n    const modalHtml = `\n      <div class=\"acu-blacklist-manager-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width: 600px; width: 90%;\">\n          <div class=\"acu-edit-title\" style=\"position: relative;\">\n            <i class=\"fa-solid fa-filter\"></i> \n            <button class=\"acu-close-btn\" style=\"position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: ${t.textMain}; cursor: pointer; font-size: 18px; z-index: 10;\">\n              <i class=\"fa-solid fa-times\"></i>\n            </button>\n          </div>\n          <div class=\"acu-settings-content\" style=\"flex: 1; overflow-y: auto; padding: 20px;\">\n            <div style=\"margin-bottom: 15px;\">\n              <div style=\"margin-bottom: 8px; font-size: 12px; color: ${t.textSub};\">\n                \n              </div>\n              <textarea id=\"blacklist-textarea\" style=\"width: 100%; min-height: 120px; max-height: 300px; padding: 10px !important; border: 1px solid ${t.border} !important; border-radius: 4px !important; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-size: 13px !important; box-sizing: border-box !important; resize: vertical; font-family: monospace; line-height: 1.5;\" placeholder=\"\"></textarea>\n              <div style=\"display: flex; gap: 8px; margin-top: 8px; flex-wrap: nowrap;\">\n                <input type=\"text\" id=\"blacklist-input\" placeholder=\"...\" style=\"flex: 1; min-width: 0; padding: 8px !important; border: 1px solid ${t.border} !important; border-radius: 4px !important; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-size: 13px !important; box-sizing: border-box !important;\">\n                <button id=\"blacklist-add-btn\" style=\"padding: 8px 16px; background: ${t.accent}; color: ${t.buttonTextOnAccent || t.textMain || '#6B4A5A'}; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; white-space: nowrap; flex-shrink: 0;\">\n                  <i class=\"fa-solid fa-plus\"></i> \n                </button>\n              </div>\n            </div>\n            <div style=\"display: flex; gap: 8px; margin-top: 15px;\">\n              <button id=\"blacklist-reset-btn\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; color: ${t.textMain}; border: 1px solid ${t.border}; border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-undo\"></i> \n              </button>\n              <button id=\"blacklist-close-btn\" style=\"flex: 1; padding: 10px; background: ${t.accent}; color: ${t.buttonTextOnAccent || t.textMain || '#6B4A5A'}; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-check\"></i> \n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '2147483655',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    // textarea\n    const updateTextarea = () => {\n      const blacklist = BlacklistManager.getBlacklist();\n      const $textarea = $modal.find('#blacklist-textarea');\n      $textarea.val(blacklist.join(''));\n    };\n\n    // textareaBlacklistManager\n    const syncFromTextarea = () => {\n      const $textarea = $modal.find('#blacklist-textarea');\n      const text = $textarea.val().trim();\n      if (!text) {\n        BlacklistManager.setBlacklist([]);\n        return;\n      }\n      // \n      const items = text\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n      // \n      const uniqueItems = [...new Set(items)];\n      BlacklistManager.setBlacklist(uniqueItems);\n      // textarea\n      if (uniqueItems.length !== items.length) {\n        updateTextarea();\n      }\n    };\n\n    // textarea\n    updateTextarea();\n\n    // textarea\n    $modal.find('#blacklist-textarea').on('input', function () {\n      syncFromTextarea();\n    });\n\n    // \n    $modal.find('#blacklist-add-btn').click(function () {\n      const input = $modal.find('#blacklist-input');\n      const value = input.val().trim();\n      if (!value) return;\n\n      // \n      const newItems = value\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n\n      if (newItems.length === 0) return;\n\n      const blacklist = BlacklistManager.getBlacklist();\n      const existingSet = new Set(blacklist);\n      const addedItems = [];\n\n      newItems.forEach(item => {\n        if (!existingSet.has(item)) {\n          blacklist.push(item);\n          existingSet.add(item);\n          addedItems.push(item);\n        }\n      });\n\n      if (addedItems.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      BlacklistManager.setBlacklist(blacklist);\n      input.val('');\n      updateTextarea();\n      if (window.toastr) window.toastr.success(` ${addedItems.length} `);\n    });\n\n    $modal.find('#blacklist-input').on('keypress', function (e) {\n      if (e.which === 13) {\n        $modal.find('#blacklist-add-btn').click();\n      }\n    });\n\n    $modal.find('#blacklist-reset-btn').click(function () {\n      if (confirm('')) {\n        BlacklistManager.resetToDefault();\n        updateTextarea();\n        if (window.toastr) window.toastr.success('');\n      }\n    });\n\n    const closeModal = () => {\n      $modal.remove();\n      // \n      renderInterface();\n    };\n\n    $modal.find('#blacklist-close-btn, .acu-close-btn').click(closeModal);\n    $modal.on('click', function (e) {\n      if ($(e.target).hasClass('acu-blacklist-manager-overlay')) closeModal();\n    });\n  };\n\n  const showAttributePresetManager = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const presets = AttributePresetManager.getAllPresets();\n    const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n\n    // HTMLactiveIdnull\n    const isDefaultActive = activeId === null;\n    const defaultPresetHtml = `\n      <div class=\"acu-preset-item\" data-id=\"__default__\">\n        <div class=\"acu-preset-info\">\n          <div class=\"acu-preset-name\">\n            \n            <span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>\n          </div>\n          <div class=\"acu-preset-desc\">5-95</div>\n          <div class=\"acu-preset-stats\">\n            : 6 | : 0\n          </div>\n        </div>\n        <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n          <label class=\"acu-toggle\" style=\"margin: 0;\">\n            <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"__default__\" ${isDefaultActive ? 'checked' : ''}>\n            <span class=\"acu-toggle-slider\"></span>\n          </label>\n        </div>\n      </div>\n    `;\n\n    // HTML\n    const presetsHtml = presets\n      .map(preset => {\n        const isActive = preset.id === activeId;\n        const isBuiltin = preset.builtin;\n\n        return `\n        <div class=\"acu-preset-item\" data-id=\"${preset.id}\">\n          <div class=\"acu-preset-info\">\n            <div class=\"acu-preset-name\">\n              ${escapeHtml(preset.name)}\n              ${isBuiltin ? `<span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>` : ''}\n            </div>\n            ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n            <div class=\"acu-preset-stats\">\n              : ${preset.baseAttributes.length} | : ${preset.specialAttributes?.length || 0}\n            </div>\n          </div>\n          <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n            <label class=\"acu-toggle\" style=\"margin: 0;\">\n              <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"${preset.id}\" ${isActive ? 'checked' : ''}>\n              <span class=\"acu-toggle-slider\"></span>\n            </label>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>` : ''}\n            <button class=\"acu-preset-btn acu-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: #e74c3c;\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n          </div>\n        </div>\n      `;\n      })\n      .join('');\n\n    // \n    const allPresetsHtml = defaultPresetHtml + presetsHtml;\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 80vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-dice-d20\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div id=\"acu-presets-list\">\n              ${allPresetsHtml || `<div style=\"text-align: center; padding: 40px; color: ${t.textSub};\"></div>`}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"acu-preset-new\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-preset-import\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-preset-back\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n\n          <input type=\"file\" id=\"acu-preset-file-input\" accept=\".json\" style=\"display: none;\" />\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn, #acu-preset-back').on('click', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n\n    // Toggle\n    overlay.on('change', '.acu-preset-toggle', function () {\n      const $toggle = $(this);\n      const id = $toggle.data('id');\n      const isChecked = $toggle.is(':checked');\n\n      if (isChecked) {\n        // id\"__default__\"null\n        const finalId = id === '__default__' ? null : id;\n        AttributePresetManager.setActivePreset(finalId);\n\n        // toggle\n        overlay.find('.acu-preset-toggle').each(function () {\n          const $thisToggle = $(this);\n          const thisId = $thisToggle.data('id');\n          if (thisId !== id) {\n            $thisToggle.prop('checked', false);\n          }\n        });\n      } else {\n        // null\n        AttributePresetManager.setActivePreset(null);\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showAttributePresetEditor(id);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-export', function () {\n      const id = $(this).data('id');\n      const json = AttributePresetManager.exportPreset(id);\n      if (!json) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      const preset = presets.find(p => p.id === id);\n      const filename = `acu_preset_${preset?.name || id}_${Date.now()}.json`;\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        const success = AttributePresetManager.deletePreset(id);\n        if (success) {\n          overlay.remove();\n          showAttributePresetManager();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      }\n    });\n\n    // \n    overlay.find('#acu-preset-new').on('click', () => {\n      overlay.remove();\n      showAttributePresetEditor();\n    });\n\n    // \n    overlay.find('#acu-preset-import').on('click', () => {\n      overlay.find('#acu-preset-file-input').click();\n    });\n\n    overlay.find('#acu-preset-file-input').on('change', function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      const reader = new FileReader();\n      reader.onload = evt => {\n        try {\n          const imported = AttributePresetManager.importPreset(evt.target.result);\n          if (imported) {\n            overlay.remove();\n            showAttributePresetManager();\n          } else {\n            if (window.toastr) window.toastr.error('');\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      };\n      reader.readAsText(file);\n\n      // \n      $(this).val('');\n    });\n\n    // \n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        overlay.remove();\n        showSettingsModal();\n      }\n    });\n  };\n\n  // \n  const showAttributePresetEditor = (presetId = null) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? AttributePresetManager.getAllPresets().find(p => p.id === presetId) : null;\n\n    // \n    const defaultData = {\n      name: existingPreset?.name || '',\n      description: existingPreset?.description || '',\n      baseAttributes: existingPreset?.baseAttributes || [\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n      ],\n      specialAttributes: existingPreset?.specialAttributes || [],\n    };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 650px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-pen\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 8px;\">\n                JSON <span style=\"font-size: 10px; color: ${t.textSub};\">()</span>\n              </label>\n              <textarea id=\"preset-json\" class=\"acu-preset-editor-textarea\" style=\"width: 100%; height: 320px; padding: 10px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-family: 'Consolas', 'Monaco', monospace !important; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: ${t.textSub}; padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n               baseAttributes:  nameformularangemodifier()<br/>\n               specialAttributes:  nameformularange()<br/>\n               : 3d6, 4d6kh3, (/2), (+-*/)\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"preset-save\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"preset-cancel\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#preset-json');\n\n    // JSON\n    const updateJSON = () => {\n      const data = {\n        baseAttributes: defaultData.baseAttributes,\n        specialAttributes: defaultData.specialAttributes,\n      };\n      $jsonTextarea.val(JSON.stringify(data, null, 2));\n    };\n    updateJSON();\n\n    // \n    overlay.find('.acu-close-btn, #preset-cancel').on('click', () => {\n      overlay.remove();\n      showAttributePresetManager();\n    });\n\n    // \n    overlay.find('#preset-save').on('click', () => {\n      try {\n        const name = overlay.find('#preset-name').val().trim();\n        const description = overlay.find('#preset-desc').val().trim();\n        const jsonStr = $jsonTextarea.val().trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const jsonData = JSON.parse(jsonStr);\n\n        // \n        if (\n          !jsonData.baseAttributes ||\n          !Array.isArray(jsonData.baseAttributes) ||\n          jsonData.baseAttributes.length === 0\n        ) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n\n        // \n        const preset = {\n          format: 'acu_attr_preset_v1',\n          version: 1,\n          id: presetId || `custom_${Date.now()}`,\n          name,\n          description,\n          baseAttributes: jsonData.baseAttributes,\n          specialAttributes: jsonData.specialAttributes || [],\n        };\n\n        // \n        if (isEdit) {\n          AttributePresetManager.updatePreset(presetId, preset);\n        } else {\n          AttributePresetManager.createPreset(preset);\n        }\n\n        overlay.remove();\n        showAttributePresetManager();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + (err.message || 'JSON'));\n      }\n    });\n\n    // \n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        overlay.remove();\n        showAttributePresetManager();\n      }\n    });\n  };\n\n  // ========================================\n  // Debug\n  // ========================================\n  const showDebugConsoleModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-debug-console-dialog)').remove();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const t = getThemeColors();\n\n    // localStorage\n    const savedFilters = Store.get('acu_debug_filters', { log: true, info: true, warn: true, error: true });\n    ConsoleCaptureManager.setFilters(savedFilters);\n\n    const renderLogs = () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      const $logContainer = dialog.find('.acu-debug-log-container');\n      $logContainer.empty();\n\n      if (filteredLogs.length === 0) {\n        $logContainer.html(\n          '<div style=\"text-align:center;padding:40px;color:var(--acu-text-sub);\"><i class=\"fa-solid fa-inbox\"></i><br/></div>',\n        );\n        return;\n      }\n\n      filteredLogs.forEach(log => {\n        const typeColors = {\n          error: '#e74c3c',\n          warn: '#f39c12',\n          info: '#3498db',\n          log: '#95a5a6',\n        };\n        const typeIcons = {\n          error: 'fa-exclamation-circle',\n          warn: 'fa-exclamation-triangle',\n          info: 'fa-info-circle',\n          log: 'fa-circle',\n        };\n        const color = typeColors[log.type] || typeColors.log;\n        const icon = typeIcons[log.type] || typeIcons.log;\n\n        const logItem = $(`\n          <div class=\"acu-debug-log-item\" data-type=\"${log.type}\" style=\"padding:8px 12px;border-bottom:1px solid var(--acu-border);font-family:monospace;font-size:12px;line-height:1.5;\">\n            <div style=\"display:flex;align-items:flex-start;gap:8px;\">\n              <span style=\"color:${color};min-width:60px;font-size:11px;\">\n                <i class=\"fa-solid ${icon}\"></i> [${log.timeStr}]\n              </span>\n              <span style=\"color:${color};min-width:50px;font-size:11px;text-transform:uppercase;\">[${log.type}]</span>\n              <span style=\"flex:1;color:var(--acu-text-main);word-break:break-word;white-space:pre-wrap;\">${escapeHtml(log.content)}</span>\n            </div>\n            ${log.stack ? `<div style=\"margin-top:4px;margin-left:128px;color:var(--acu-text-sub);font-size:11px;white-space:pre-wrap;font-family:monospace;\">${escapeHtml(log.stack)}</div>` : ''}\n          </div>\n        `);\n        $logContainer.append(logItem);\n      });\n    };\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-debug-console-dialog ${currentThemeClass}\" style=\"max-width:90vw;max-height:90vh;width:800px;height:600px;display:flex;flex-direction:column;\">\n          <div class=\"acu-settings-header\" style=\"flex-shrink:0;\">\n            <div class=\"acu-settings-title\"><i class=\"fa-solid fa-bug\"></i> Debug</div>\n            <button class=\"acu-close-btn\" id=\"debug-console-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex:1;display:flex;flex-direction:column;overflow:hidden;\">\n            <!--  -->\n            <div style=\"padding:12px;border-bottom:1px solid var(--acu-border);flex-shrink:0;display:flex;flex-direction:column;gap:8px;\">\n              <!-- Console -->\n              <div style=\"display:flex;align-items:center;gap:8px;padding-bottom:8px;border-bottom:1px solid var(--acu-border);\">\n                <span style=\"font-size:12px;color:var(--acu-text-sub);flex:1;\">Console:</span>\n                <label class=\"acu-toggle\">\n                  <input type=\"checkbox\" id=\"debug-console-capture-toggle\" ${ConsoleCaptureManager.enabled ? 'checked' : ''}>\n                  <span class=\"acu-toggle-slider\"></span>\n                </label>\n                <span id=\"debug-console-capture-status\" style=\"font-size:11px;color:var(--acu-text-sub);\">${ConsoleCaptureManager.enabled ? '' : ''}</span>\n              </div>\n              <!--  -->\n              <div style=\"display:flex;flex-wrap:wrap;gap:8px;align-items:center;\">\n                <div style=\"display:flex;gap:8px;align-items:center;flex:1;\">\n                  <span style=\"font-size:12px;color:var(--acu-text-sub);\">:</span>\n                  <button class=\"acu-btn ${savedFilters.log ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"log\" style=\"padding:4px 10px;font-size:12px;${savedFilters.log ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Log</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.info ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"info\" style=\"padding:4px 10px;font-size:12px;${savedFilters.info ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Info</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.warn ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"warn\" style=\"padding:4px 10px;font-size:12px;${savedFilters.warn ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Warn</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.error ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"error\" style=\"padding:4px 10px;font-size:12px;${savedFilters.error ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Error</span>\n                  </button>\n                </div>\n                <div style=\"display:flex;gap:6px;\">\n                  <button class=\"acu-btn acu-btn-secondary\" id=\"debug-console-clear\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-trash\"></i> \n                  </button>\n                  <button class=\"acu-btn acu-btn-secondary\" id=\"debug-console-copy\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-copy\"></i> \n                  </button>\n                  <button class=\"acu-btn acu-btn-primary\" id=\"debug-console-export\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-download\"></i> \n                  </button>\n                </div>\n              </div>\n            </div>\n\n            <!--  -->\n            <div class=\"acu-debug-log-scroll\" style=\"flex:1;overflow-y:auto;overflow-x:hidden;background:var(--acu-card-bg);\">\n              <div class=\"acu-debug-log-container\"></div>\n            </div>\n\n            <!--  -->\n            <div style=\"padding:8px 12px;border-top:1px solid var(--acu-border);flex-shrink:0;font-size:11px;color:var(--acu-text-sub);display:flex;justify-content:space-between;\">\n              <span>: <span id=\"debug-total-count\">0</span> | : <span id=\"debug-filtered-count\">0</span></span>\n            </div>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const updateCounts = () => {\n      const total = ConsoleCaptureManager.logs.length;\n      const filtered = ConsoleCaptureManager.getFilteredLogs().length;\n      dialog.find('#debug-total-count').text(total);\n      dialog.find('#debug-filtered-count').text(filtered);\n    };\n\n    // \n    renderLogs();\n    updateCounts();\n\n    // Console\n    dialog.find('#debug-console-capture-toggle').on('change', function () {\n      const checked = $(this).is(':checked');\n      const $status = dialog.find('#debug-console-capture-status');\n      if (checked) {\n        ConsoleCaptureManager.enable();\n        $status.text('');\n        // \n        console.log('[DICE]Debug');\n      } else {\n        ConsoleCaptureManager.disable();\n        $status.text('');\n      }\n    });\n\n    // \n    dialog.find('[data-filter-type]').on('click', function () {\n      const type = $(this).data('filter-type');\n      const isActive = $(this).hasClass('acu-btn-primary');\n      const newState = !isActive;\n\n      // \n      if (newState) {\n        $(this).removeClass('acu-btn-secondary').addClass('acu-btn-primary');\n        $(this).css('opacity', '1');\n      } else {\n        $(this).removeClass('acu-btn-primary').addClass('acu-btn-secondary');\n        $(this).css('opacity', '0.5');\n      }\n\n      // \n      ConsoleCaptureManager.setFilters({ [type]: newState });\n      Store.set('acu_debug_filters', ConsoleCaptureManager.filters);\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-clear').on('click', () => {\n      ConsoleCaptureManager.clear();\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-copy').on('click', async () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n');\n\n      try {\n        // \n        if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n          const safeContent = text.replace(/\\\"/g, '\\\\\"').replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          return;\n        }\n        // API\n        if (navigator.clipboard && window.isSecureContext) {\n          await navigator.clipboard.writeText(text);\n        } else {\n          // execCommand\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n          document.body.appendChild(textArea);\n          textArea.select();\n          textArea.setSelectionRange(0, 99999);\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n          if (!successful) {\n            throw new Error('execCommand failed');\n          }\n        }\n      } catch (err) {\n        console.error('[DICE]DebugConsole :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // \n    dialog.find('#debug-console-export').on('click', () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n\\n');\n\n      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `debug-console-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    dialog.find('#debug-console-close, .acu-edit-overlay').on('click', function (e) {\n      if (e.target === this || $(e.target).closest('.acu-close-btn').length) {\n        dialog.remove();\n      }\n    });\n\n    // \n    // [] \n    const refreshInterval = setInterval(() => {\n      if (dialog.length && dialog.is(':visible')) {\n        renderLogs();\n        updateCounts();\n      }\n    }, 500);\n\n    // \n    dialog.on('remove', () => {\n      clearInterval(refreshInterval);\n    });\n  };\n\n  // \n  window.showDebugConsoleModal = showDebugConsoleModal;\n\n  const showSettingsModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-settings-dialog)').remove();\n    isSettingsOpen = true;\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const t = getThemeColors();\n\n    // \n    const expandedGroups = Store.get('acu_settings_expanded', ['appearance']);\n\n    const isGroupExpanded = groupId => expandedGroups.includes(groupId);\n    // HTMLMVU\n    const SPECIAL_BUTTONS_CONFIG = [\n      { key: '__dice__', name: '', icon: 'fa-dice-d20' },\n      { key: '__changes__', name: '', icon: 'fa-code-compare' },\n      { key: '__mvu__', name: 'MVU', icon: 'fa-code-branch' },\n    ];\n\n    const tableManagerHtml = (() => {\n      const rawData = cachedRawData || getTableData();\n      const tables = processJsonData(rawData || {});\n      const savedOrder = getSavedTableOrder() || [];\n      const hiddenList = getHiddenTables();\n\n      //  + \n      let allItems = [];\n\n      // \n      SPECIAL_BUTTONS_CONFIG.forEach(btn => {\n        // MVU \n        allItems.push({ key: btn.key, name: btn.name, icon: btn.icon, isSpecial: true });\n      });\n\n      // \n      Object.keys(tables).forEach(name => {\n        allItems.push({ key: name, name: name, icon: getIconForTableName(name), isSpecial: false });\n      });\n\n      // \n      if (savedOrder.length > 0) {\n        const orderMap = new Map(savedOrder.map((k, i) => [k, i]));\n        allItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      return allItems\n        .map(item => {\n          const isHidden = hiddenList.includes(item.key);\n          const specialClass = item.isSpecial ? ' acu-special-item' : '';\n          const displayName = item.name;\n          return (\n            '<div class=\"acu-table-manager-item' +\n            specialClass +\n            (isHidden ? ' hidden-table' : '') +\n            '\" data-table-name=\"' +\n            escapeHtml(item.key) +\n            '\" draggable=\"false\">' +\n            '<div class=\"acu-table-item-check\" title=\"/\">' +\n            '<i class=\"fa-solid ' +\n            (isHidden ? 'fa-eye-slash' : 'fa-eye') +\n            '\"></i>' +\n            '</div>' +\n            '<div class=\"acu-table-item-icon\"><i class=\"fa-solid ' +\n            item.icon +\n            '\"></i></div>' +\n            '<div class=\"acu-table-item-name\">' +\n            escapeHtml(displayName) +\n            '</div>' +\n            '<div class=\"acu-table-item-handle\" title=\"\">' +\n            '<i class=\"fa-solid fa-grip-vertical\"></i>' +\n            '</div>' +\n            '</div>'\n          );\n        })\n        .join('');\n    })();\n    const chevron = groupId => (isGroupExpanded(groupId) ? 'fa-chevron-down' : 'fa-chevron-right');\n\n    const dialog = $(`\n        <div class=\"acu-edit-overlay\">\n            <div class=\"acu-edit-dialog acu-settings-dialog ${currentThemeClass}\">\n                <div class=\"acu-settings-header\">\n                    <div class=\"acu-settings-title\">\n                        <span class=\"acu-settings-text\">\n                            <i class=\"fa-solid fa-cog\"></i> \n                            <span class=\"acu-version-badge\">${SCRIPT_VERSION}</span>\n                        </span>\n                        <button class=\"acu-help-btn\" id=\"acu-help-btn\" title=\"\"><i class=\"fa-solid fa-question-circle\"></i></button>\n                    </div>\n                    <button class=\"acu-close-btn\" id=\"dlg-close-x\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n\n                <div class=\"acu-settings-body\">\n                <!--  -->\n                <div class=\"acu-settings-group ${isGroupExpanded('appearance') ? '' : 'collapsed'}\" data-group=\"appearance\">                    <div class=\"acu-settings-group-title\">\n                        <i class=\"fa-solid ${chevron('appearance')} acu-group-chevron\"></i>\n                        <i class=\"fa-solid fa-palette\"></i> \n                    </div>\n                    <div class=\"acu-settings-group-body\">\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-theme\" class=\"acu-setting-select\">\n                                ${THEMES.map(t => `<option value=\"${t.id}\" ${t.id === config.theme ? 'selected' : ''}>${t.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-font-family\" class=\"acu-setting-select\">\n                                ${FONTS.map(f => `<option value=\"${f.id}\" ${f.id === config.fontFamily ? 'selected' : ''}>${f.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-main\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.fontSize}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-opt\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.optionFontSize || 12}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row acu-setting-row-toggle\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <label class=\"acu-toggle\">\n                                <input type=\"checkbox\" id=\"cfg-new\" ${config.highlightNew ? 'checked' : ''}>\n                                <span class=\"acu-toggle-slider\"></span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('layout') ? '' : 'collapsed'}\" data-group=\"layout\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('layout')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-th-large\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-width\" data-min=\"200\" data-max=\"500\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.cardWidth}px</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-layout\" class=\"acu-setting-select\">\n                                    <option value=\"horizontal\" ${config.layout !== 'vertical' ? 'selected' : ''}></option>\n                                    <option value=\"vertical\" ${config.layout === 'vertical' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                    <span class=\"acu-setting-hint\"></span>\n                                </div>\n                                <select id=\"cfg-grid-cols\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"2\" ${config.gridColumns == 2 ? 'selected' : ''}>2</option>\n                                    <option value=\"3\" ${config.gridColumns == 3 ? 'selected' : ''}>3</option>\n                                    <option value=\"4\" ${config.gridColumns == 4 ? 'selected' : ''}>4</option>\n                                    <option value=\"auto\" ${config.gridColumns === 'auto' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-per-page\" data-min=\"10\" data-max=\"200\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.itemsPerPage}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('position') ? '' : 'collapsed'}\" data-group=\"position\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('position')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-arrows-alt\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-position\" class=\"acu-setting-select\">\n                                    <option value=\"fixed\" ${config.positionMode !== 'embedded' ? 'selected' : ''}></option>\n                                    <option value=\"embedded\" ${config.positionMode === 'embedded' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-action-pos\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bottom\" ${config.actionsPosition !== 'top' ? 'selected' : ''}></option>\n                                    <option value=\"top\" ${config.actionsPosition === 'top' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-style\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bar\" ${config.collapseStyle === 'bar' ? 'selected' : ''}></option>\n                                    <option value=\"pill\" ${config.collapseStyle === 'pill' ? 'selected' : ''}></option>\n                                    <option value=\"mini\" ${config.collapseStyle === 'mini' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-align\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"right\" ${config.collapseAlign !== 'left' ? 'selected' : ''}></option>\n                                    <option value=\"left\" ${config.collapseAlign === 'left' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('options') ? '' : 'collapsed'}\" data-group=\"options\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('options')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-gamepad\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row acu-setting-row-toggle\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-show-opt\" ${config.showOptionPanel !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                            <div class=\"acu-setting-row acu-setting-row-toggle\" id=\"row-auto-send\" style=\"${config.showOptionPanel !== false ? '' : 'display:none;'}\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-auto-send\" ${config.clickOptionToAutoSend !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('tables') ? '' : 'collapsed'}\" data-group=\"tables\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('tables')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-table\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-table-manager-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <div class=\"acu-table-manager-list\" id=\"table-manager-list\">\n                                ${tableManagerHtml}\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('validation') ? '' : 'collapsed'}\" data-group=\"validation\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('validation')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-clipboard-check\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${PresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === PresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}${p.builtin ? ' ()' : ''}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-reset\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> <i class=\"fa-solid fa-shield-halved\"></i> \n                            </div>\n                            <div class=\"acu-validation-rules-list\" id=\"validation-rules-list\">\n                                ${ValidationRuleManager.getAllRules()\n                                  .map(rule => {\n                                    const typeInfo = RULE_TYPE_INFO[rule.ruleType] || {\n                                      name: rule.ruleType,\n                                      icon: 'fa-question',\n                                    };\n                                    const isTableRule = typeInfo.scope === 'table';\n                                    const hasIntercept = rule.intercept;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n                                            <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n                                        </div>\n                                        <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <button class=\"acu-add-rule-btn\" id=\"btn-add-validation-rule\">\n                                <i class=\"fa-solid fa-plus\"></i> \n                            </button>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('advanced') ? '' : 'collapsed'}\" data-group=\"advanced\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('advanced')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-sliders-h\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-dice-d20\"></i> </span>\n                                </div>\n                                <button id=\"cfg-attr-preset-manage\" class=\"acu-setting-btn\" style=\"padding: 6px 12px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${t.textMain}; cursor: pointer; font-size: 12px;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-filter\"></i> </span>\n                                </div>\n                                <button id=\"cfg-blacklist-manage\" class=\"acu-setting-btn\" style=\"padding: 6px 12px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${t.textMain}; cursor: pointer; font-size: 12px;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-bug\"></i> Debug</span>\n                                </div>\n                                <button id=\"btn-open-debug-console\" class=\"acu-setting-btn\" style=\"padding: 6px 12px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${t.textMain}; cursor: pointer; font-size: 12px;\">\n                                    <i class=\"fa-solid fa-terminal\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                </div><!--  .acu-settings-body -->\n            </div>\n        </div>\n    `);\n    $('body').append(dialog);\n\n    // ===  ===\n    dialog.find('.acu-settings-group-title').on('click', function () {\n      const $group = $(this).closest('.acu-settings-group');\n      const $body = $group.find('.acu-settings-group-body');\n\n      // \n      if ($body.hasClass('acu-animating')) return;\n\n      const groupId = $group.data('group');\n      const $chevron = $(this).find('.acu-group-chevron');\n      let expanded = Store.get('acu_settings_expanded', ['appearance']);\n\n      if ($group.hasClass('collapsed')) {\n        // \n        $group.removeClass('collapsed');\n        $chevron.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n        if (!expanded.includes(groupId)) expanded.push(groupId);\n\n        $body.addClass('acu-animating').show();\n        const targetHeight = $body.prop('scrollHeight');\n        $body.css('height', 0).animate({ height: targetHeight }, 180, function () {\n          $(this).css('height', '').removeClass('acu-animating');\n        });\n      } else {\n        // \n        $group.addClass('collapsed');\n        $chevron.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n        expanded = expanded.filter(id => id !== groupId);\n\n        const currentHeight = $body.outerHeight();\n        $body\n          .addClass('acu-animating')\n          .css('height', currentHeight)\n          .animate({ height: 0 }, 180, function () {\n            $(this).hide().css('height', '').removeClass('acu-animating');\n          });\n      }\n\n      Store.set('acu_settings_expanded', expanded);\n    });\n\n    // ===  ===\n    // \n    dialog.find('#cfg-theme').on('change', function () {\n      const newTheme = $(this).val();\n      saveConfig({ theme: newTheme });\n      dialog\n        .find('.acu-edit-dialog')\n        .removeClass(THEMES.map(t => `acu-theme-${t.id}`).join(' '))\n        .addClass(`acu-theme-${newTheme}`);\n\n      // \n      const t = getThemeColors();\n      dialog.find('#cfg-attr-preset-manage').css({\n        background: t.btnBg,\n        borderColor: t.border,\n        color: t.textMain,\n      });\n    });\n\n    // \n    dialog.find('#cfg-font-family').on('change', function () {\n      saveConfig({ fontFamily: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-attr-preset-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showAttributePresetManager();\n    });\n\n    // \n    dialog.find('#cfg-blacklist-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      showBlacklistManagerModal();\n    });\n\n    // \n    dialog.find('#cfg-layout').on('change', function () {\n      saveConfig({ layout: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-grid-cols').on('change', function () {\n      saveConfig({ gridColumns: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-position').on('change', function () {\n      saveConfig({ positionMode: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-action-pos').on('change', function () {\n      saveConfig({ actionsPosition: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-style').on('change', function () {\n      saveConfig({ collapseStyle: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-align').on('change', function () {\n      saveConfig({ collapseAlign: $(this).val() });\n      renderInterface();\n    });\n\n    // \n    dialog.find('#cfg-show-opt').on('change', function () {\n      const checked = $(this).is(':checked');\n      saveConfig({ showOptionPanel: checked });\n      if (checked) dialog.find('#row-auto-send').slideDown(200);\n      else dialog.find('#row-auto-send').slideUp(200);\n      renderInterface();\n    });\n    dialog.find('#cfg-auto-send').on('change', function () {\n      saveConfig({ clickOptionToAutoSend: $(this).is(':checked') });\n    });\n    dialog.find('#cfg-new').on('change', function () {\n      saveConfig({ highlightNew: $(this).is(':checked') });\n      renderInterface();\n    });\n\n    // === / ===\n    dialog.find('.acu-table-item-check').on('click', function (e) {\n      e.stopPropagation();\n      const $item = $(this).closest('.acu-table-manager-item');\n      const tableName = $item.data('table-name');\n      let hiddenList = getHiddenTables();\n      const $icon = $(this).find('i');\n\n      if (hiddenList.includes(tableName)) {\n        // \n        hiddenList = hiddenList.filter(n => n !== tableName);\n        $item.removeClass('hidden-table');\n        $icon.removeClass('fa-eye-slash').addClass('fa-eye');\n      } else {\n        // \n        hiddenList.push(tableName);\n        $item.addClass('hidden-table');\n        $icon.removeClass('fa-eye').addClass('fa-eye-slash');\n      }\n\n      saveHiddenTables(hiddenList);\n      renderInterface();\n    });\n\n    // ===  ===\n    const $list = dialog.find('#table-manager-list');\n    let dragState = {\n      isDragging: false,\n      element: null,\n      timer: null,\n      startY: 0,\n    };\n\n    const clearDragState = () => {\n      if (dragState.timer) {\n        clearTimeout(dragState.timer);\n        dragState.timer = null;\n      }\n      if (dragState.element) {\n        $(dragState.element).removeClass('acu-dragging');\n      }\n      $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n      dragState.isDragging = false;\n      dragState.element = null;\n    };\n\n    const startDrag = $item => {\n      dragState.isDragging = true;\n      dragState.element = $item[0];\n      $item.addClass('acu-dragging');\n    };\n\n    const finishDrag = () => {\n      if (!dragState.isDragging || !dragState.element) {\n        clearDragState();\n        return;\n      }\n\n      const $dragged = $(dragState.element);\n      const $target = $list.find('.acu-drag-above, .acu-drag-below').first();\n\n      if ($target.length && $target[0] !== dragState.element) {\n        if ($target.hasClass('acu-drag-above')) {\n          $dragged.insertBefore($target);\n        } else {\n          $dragged.insertAfter($target);\n        }\n\n        // \n        const newOrder = [];\n        $list.find('.acu-table-manager-item').each(function () {\n          newOrder.push($(this).data('table-name'));\n        });\n        saveTableOrder(newOrder);\n      }\n\n      clearDragState();\n    };\n\n    // \n    $list[0].addEventListener(\n      'pointerdown',\n      function (e) {\n        const handle = e.target.closest('.acu-table-item-handle');\n        if (!handle) return;\n\n        e.preventDefault();\n        const $item = $(handle).closest('.acu-table-manager-item');\n        dragState.startY = e.clientY;\n        startDrag($item);\n        handle.setPointerCapture(e.pointerId);\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerdown', function (e) {\n      const item = e.target.closest('.acu-table-manager-item');\n      if (!item) return;\n      // \n      if (e.target.closest('.acu-table-item-check, .acu-table-item-handle')) return;\n\n      dragState.startY = e.clientY;\n      const $item = $(item);\n\n      dragState.timer = setTimeout(() => {\n        startDrag($item);\n      }, 350);\n    });\n\n    // \n    $list[0].addEventListener(\n      'pointermove',\n      function (e) {\n        // \n        if (dragState.timer && Math.abs(e.clientY - dragState.startY) > 8) {\n          clearTimeout(dragState.timer);\n          dragState.timer = null;\n        }\n\n        if (!dragState.isDragging || !dragState.element) return;\n        e.preventDefault();\n\n        // \n        const items = $list.find('.acu-table-manager-item').not('.acu-dragging');\n        let targetItem = null;\n        let insertBefore = true;\n\n        items.each(function () {\n          const rect = this.getBoundingClientRect();\n          const midY = rect.top + rect.height / 2;\n\n          if (e.clientY < midY && !targetItem) {\n            targetItem = this;\n            insertBefore = true;\n          } else if (e.clientY >= rect.top && e.clientY <= rect.bottom) {\n            targetItem = this;\n            insertBefore = e.clientY < midY;\n          }\n        });\n\n        // \n        $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n        if (targetItem && targetItem !== dragState.element) {\n          $(targetItem).addClass(insertBefore ? 'acu-drag-above' : 'acu-drag-below');\n        }\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerup', finishDrag);\n    $list[0].addEventListener('pointercancel', clearDragState);\n\n    // \n    $list[0].addEventListener(\n      'touchmove',\n      function (e) {\n        if (dragState.isDragging) {\n          e.preventDefault();\n        }\n      },\n      { passive: false },\n    );\n\n    // === Stepper  ===\n    dialog.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        const unit = id === 'cfg-per-page' ? '' : 'px';\n        $value.text(newVal + unit);\n\n        // \n        if (id === 'cfg-width') {\n          $('.acu-wrapper').css('--acu-card-width', newVal + 'px');\n          saveConfig({ cardWidth: newVal });\n        } else if (id === 'cfg-font-main') {\n          $('.acu-wrapper').css('--acu-font-size', newVal + 'px');\n          saveConfig({ fontSize: newVal });\n        } else if (id === 'cfg-font-opt') {\n          $('.acu-wrapper, .acu-embedded-options-container').css('--acu-opt-font-size', newVal + 'px');\n          saveConfig({ optionFontSize: newVal });\n        } else if (id === 'cfg-per-page') {\n          saveConfig({ itemsPerPage: newVal });\n        }\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    // === /===\n    dialog.on('click', '.acu-rule-toggle', function (e) {\n      e.stopPropagation();\n      const $toggle = $(this);\n      const $item = $toggle.closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const $icon = $toggle.find('i');\n      const isCurrentlyActive = $toggle.hasClass('active');\n\n      // \n      ValidationRuleManager.toggleRuleEnabled(ruleId, !isCurrentlyActive);\n\n      //  UI\n      if (isCurrentlyActive) {\n        $toggle.removeClass('active');\n        $icon.removeClass('fa-toggle-on').addClass('fa-toggle-off');\n        $item.addClass('disabled');\n      } else {\n        $toggle.addClass('active');\n        $icon.removeClass('fa-toggle-off').addClass('fa-toggle-on');\n        $item.removeClass('disabled');\n      }\n    });\n\n    // === ===\n    dialog.on('click', '.acu-rule-delete', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const $item = $(this).closest('.acu-validation-rule-item');\n\n      if (confirm('')) {\n        if (ValidationRuleManager.removeCustomRule(ruleId)) {\n          $item.fadeOut(200, function () {\n            $(this).remove();\n          });\n        }\n      }\n    });\n\n    // === ===\n    dialog.on('click', '.acu-rule-intercept', function (e) {\n      e.stopPropagation();\n      const $btn = $(this);\n      const ruleId = $btn.data('rule-id');\n      const isCurrentlyActive = $btn.hasClass('active');\n\n      if (ValidationRuleManager.toggleRuleIntercept(ruleId, !isCurrentlyActive)) {\n        if (isCurrentlyActive) {\n          $btn.removeClass('active').attr('title', '');\n        } else {\n          $btn.addClass('active').attr('title', '');\n        }\n      }\n    });\n\n    // ===  ===\n    const refreshPresetUI = () => {\n      ValidationRuleManager.clearCache();\n      const rules = ValidationRuleManager.getAllRules();\n      let html = '';\n      rules.forEach(rule => {\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType] || { name: rule.ruleType, icon: 'fa-question' };\n        const isTableRule = typeInfo.scope === 'table';\n        const hasIntercept = rule.intercept;\n        html += `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo.icon}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n            </div>\n            <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n              <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>`;\n      });\n      dialog.find('#validation-rules-list').html(html);\n    };\n\n    // \n    dialog.find('#preset-select').on('change', function () {\n      if (PresetManager.setActivePreset($(this).val())) {\n        refreshPresetUI();\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-dup').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const newPreset = PresetManager.duplicatePreset(preset.id);\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-new').on('click', function () {\n      const name = prompt(':', '');\n      if (!name?.trim()) return;\n      const newPreset = PresetManager.createPreset(name.trim());\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-del').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      if (preset.id === 'default') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!confirm(`\"${preset.name}\"`)) return;\n      if (PresetManager.deletePreset(preset.id)) {\n        dialog.find(`#preset-select option[value=\"${preset.id}\"]`).remove();\n        dialog.find('#preset-select').val('default').trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-export').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const json = PresetManager.exportPreset(preset.id);\n      if (json) {\n        // \n        try {\n          const filename = `acu_validation_preset_${preset.name || preset.id}_${Date.now()}.json`;\n          const blob = new Blob([json], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = filename;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        } catch (e) {\n          //  Blob /\n          navigator.clipboard\n            .writeText(json)\n            .then(() => {})\n            .catch(() => {\n              prompt(':', json);\n            });\n        }\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-import').on('click', function () {\n      const json = prompt(' JSON:');\n      if (!json?.trim()) return;\n      const result = PresetManager.importPreset(json.trim(), false);\n      if (result && result.preset) {\n        const newPreset = result.preset;\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n        // \n        if (result.needsMerge) {\n          if (\n            confirm(\n              '\\n\\n',\n            )\n          ) {\n            if (PresetManager.mergePresetWithDefaults(newPreset.id)) {\n              if (window.toastr) window.toastr.success('');\n              refreshPresetUI();\n            } else {\n              if (window.toastr) window.toastr.error('');\n            }\n          }\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-reset').on('click', function () {\n      if (!confirm('\\n')) return;\n      if (PresetManager.resetDefaultPreset()) {\n        // \n        if (PresetManager.getActivePreset()?.id === 'default') {\n          refreshPresetUI();\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-add-validation-rule').on('click', function () {\n      showAddValidationRuleModal(dialog);\n    });\n\n    // === Debug ===\n    dialog.find('#btn-open-debug-console').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showDebugConsoleModal();\n    });\n\n    // ===  ===\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n      renderInterface();\n    };\n    dialog.on('click', '#dlg-close-x, .acu-settings-header .acu-close-btn', closeDialog);\n\n    // \n    dialog.on('click', '#acu-help-btn', function (e) {\n      e.stopPropagation();\n      window.open('https://jerryzmtz.github.io/DiceSystemManual//', '_blank');\n    });\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n  };\n\n  // [] \n  let renderInterfaceTimer = null;\n  let renderInterfacePending = false;\n\n  const renderInterface = () => {\n    // \n    if (isSettingsOpen) {\n      if (!renderInterfacePending) {\n        console.info('[DICE]');\n        renderInterfacePending = true;\n      }\n      return;\n    }\n\n    // \n    if (renderInterfaceTimer) {\n      clearTimeout(renderInterfaceTimer);\n    }\n\n    // 50ms\n    renderInterfaceTimer = setTimeout(() => {\n      renderInterfaceTimer = null;\n      renderInterfacePending = false;\n      _renderInterfaceImpl();\n    }, 50);\n  };\n\n  // \n  const _renderInterfaceImpl = () => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n\n    // [] Observer  ()\n    if (!observer && $('#chat').length) {\n      const $chat = $('#chat');\n      let mutationLock = false;\n      const handleMutation = () => {\n        if (mutationLock) return;\n        mutationLock = true;\n        requestAnimationFrame(() => {\n          const config = getConfig();\n          if (config.positionMode === 'embedded') {\n            mutationLock = false;\n            return;\n          }\n          const children = $chat.children();\n          const lastChild = children.last()[0];\n          const wrapper = $('.acu-wrapper')[0];\n          if (wrapper && lastChild && lastChild !== wrapper) {\n            if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n              $chat.append(wrapper);\n            }\n          }\n          mutationLock = false;\n        });\n      };\n      observer = new MutationObserver(handleMutation);\n      observer.observe($chat[0], { childList: true });\n    }\n    let rawData;\n    if (hasUnsavedChanges && cachedRawData) {\n      rawData = cachedRawData;\n    } else {\n      rawData = getTableData();\n\n      // [] \n      if (rawData) {\n        let anyLockApplied = false;\n        for (const sheetId in rawData) {\n          if (!sheetId.startsWith('sheet_')) continue;\n          const sheet = rawData[sheetId];\n          if (!sheet || !sheet.name || !sheet.content) continue;\n\n          const result = LockManager.applyLocks(sheet.name, sheet.content);\n          if (result.modified) {\n            anyLockApplied = true;\n          }\n          if (result.restored.length > 0) {\n          }\n        }\n        if (anyLockApplied) {\n        }\n      }\n      if (rawData) {\n        cachedRawData =\n          typeof structuredClone === 'function' ? structuredClone(rawData) : JSON.parse(JSON.stringify(rawData));\n\n        const existingSnapshot = loadSnapshot();\n        const currentCtx = getCurrentContextFingerprint();\n\n        // \n        const hasValidSnapshotData =\n          existingSnapshot && Object.keys(existingSnapshot).some(k => k.startsWith('sheet_'));\n\n        if (!existingSnapshot || !hasValidSnapshotData) {\n          // 1    \n          saveSnapshot({ ...cachedRawData, _contextId: currentCtx });\n        } else if (!existingSnapshot._contextId) {\n          // 2 ID \n          saveSnapshot({ ...existingSnapshot, _contextId: currentCtx });\n        } else if (existingSnapshot._contextId !== currentCtx) {\n          // 3  \n          cachedRawData._contextId = currentCtx;\n          saveSnapshot(cachedRawData);\n        }\n        // 4  \n      }\n    }\n\n    const $searchInput = $('.acu-search-input');\n    if ($('.acu-wrapper').length && $searchInput.is(':focus')) {\n      if (rawData) {\n        if (!isSaving) currentDiffMap = generateDiffMap(rawData);\n        const tables = processJsonData(rawData);\n        const activeTab = getActiveTabState();\n        const currentTabName = activeTab && tables[activeTab] ? activeTab : null;\n\n        if (currentTabName && tables[currentTabName]) {\n          const newHtml = renderTableContent(tables[currentTabName], currentTabName);\n          const $virtualDom = $('<div>').html(newHtml);\n          $('.acu-card-grid').replaceWith($virtualDom.find('.acu-card-grid'));\n          $('.acu-panel-title').html($virtualDom.find('.acu-panel-title').html());\n          // [] \n          bindEvents(tables);\n          bindOptionEvents(); // <--- \n          return;\n        }\n      }\n    }\n\n    let lastScrollX = 0;\n    let lastScrollY = 0;\n\n    const $oldContent = $('.acu-panel-content');\n    if ($oldContent.length) {\n      lastScrollX = $oldContent.scrollLeft();\n      lastScrollY = $oldContent.scrollTop();\n    }\n\n    $('.acu-wrapper').remove();\n    const tables = processJsonData(rawData || {});\n\n    if (isSaving) {\n      currentDiffMap = new Set();\n    } else {\n      currentDiffMap = generateDiffMap(rawData);\n    }\n\n    const savedOrder = getSavedTableOrder();\n    let orderedNames = Object.keys(tables);\n    if (savedOrder)\n      orderedNames = savedOrder.filter(n => tables[n]).concat(orderedNames.filter(n => !savedOrder.includes(n)));\n\n    const hiddenList = getHiddenTables();\n    orderedNames = orderedNames.filter(n => !hiddenList.includes(n));\n\n    const activeTab = getActiveTabState();\n    let currentTabName = activeTab && tables[activeTab] && !hiddenList.includes(activeTab) ? activeTab : null;\n\n    const config = getConfig();\n    const isCollapsed = getCollapsedState();\n\n    const layoutClass = config.layout === 'vertical' ? 'acu-layout-vertical' : '';\n    // []  (/)\n    const positionClass = `acu-mode-${config.positionMode || 'fixed'}`;\n\n    // []  () \n    let finalGridCols = config.gridColumns;\n    if (finalGridCols === 'auto') {\n      const n = orderedNames.length;\n\n      if (n <= 4) {\n        finalGridCols = n < 2 ? 2 : n;\n      } else {\n        const empty3 = Math.ceil(n / 3) * 3 - n;\n        const empty4 = Math.ceil(n / 4) * 4 - n;\n        finalGridCols = empty4 <= empty3 ? 4 : 3;\n      }\n    }\n\n    // --- []  +  ---\n    let optionHtml = '';\n    let currentOptionHash = null; // \n\n    if (config.showOptionPanel !== false) {\n      const optionTables = [];\n      Object.keys(tables).forEach(k => {\n        if (k.includes('')) optionTables.push(tables[k]);\n      });\n\n      // [] \n      if (optionTables.length > 0) {\n        const isCollapsed = getCollapsedState();\n        const eyeIcon = isCollapsed ? 'fa-eye-slash' : 'fa-eye';\n        const eyeTitle = isCollapsed ? '' : '';\n        // \n        let buttonsHtml = `\n                    <div class=\"acu-opt-header\" style=\"position:relative;\">\n                        \n                        <i class=\"fa-solid ${eyeIcon} acu-nav-toggle-btn\"\n                           style=\"position:absolute; right:6px; top:50%; transform:translateY(-50%); cursor:pointer; opacity:0.6;\"\n                           title=\"${eyeTitle}\"></i>\n                    </div>`;\n        let hasBtns = false;\n        // []\n        let optionValues = []; // \n\n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  const cellStr = String(cell).trim();\n                  buttonsHtml += `<button class=\"acu-opt-btn\" data-val=\"${encodeURIComponent(cellStr)}\">${escapeHtml(cellStr)}</button>`;\n                  optionValues.push(cellStr);\n                  hasBtns = true;\n                }\n              });\n            });\n          }\n        });\n\n        if (hasBtns) {\n          optionHtml = `<div class=\"acu-option-panel\">${buttonsHtml}</div>`;\n          //  ()\n          // [] \n          currentOptionHash = optionValues.join('|||') + (isCollapsed ? '_collapsed' : '_expanded');\n        }\n      }\n    }\n\n    // [] \n    const optionChanged = currentOptionHash !== lastOptionHash;\n    if (optionChanged && currentOptionHash !== null) {\n      // \n      optionPanelVisible = true;\n    }\n    lastOptionHash = currentOptionHash; // \n\n    let html = `<div class=\"acu-wrapper ${positionClass} acu-theme-${config.theme} ${layoutClass}\" style=\"--acu-card-width:${config.cardWidth}px; --acu-font-size:${config.fontSize}px; --acu-opt-font-size:${config.optionFontSize || 12}px; --acu-grid-cols:${finalGridCols}\">`;\n\n    // []  DOM  column-reverse\n    // []  optionPanelVisible \n    if (config.positionMode === 'embedded' && optionHtml && optionPanelVisible) {\n      html += optionHtml;\n    }\n\n    if (isCollapsed) {\n      const colStyleClass = `acu-col-${config.collapseStyle || 'bar'}`;\n      const alignClass = `acu-align-${config.collapseAlign || 'right'}`;\n      html += `\n                <div class=\"acu-expand-trigger ${colStyleClass} ${alignClass}\" id=\"acu-btn-expand\">\n                    <i class=\"fa-solid fa-table\"></i> <span> (${Object.keys(tables).length})</span>\n                </div>\n            `;\n    } else {\n      // [] \n      const savedHeight = currentTabName ? getTableHeights()[currentTabName] : null;\n      // [] \n      const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n      const isChangesPanelActive = Store.get('acu_changes_panel_active', false);\n      const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n      const mvuSavedHeight = isMvuActive ? getTableHeights()[MvuModule.MODULE_ID] : null;\n      const finalSavedHeight = mvuSavedHeight || savedHeight;\n      const shouldShowPanel = isDashboardActive || isChangesPanelActive || isMvuActive || currentTabName;\n\n      html += `\n                <div class=\"acu-data-display ${shouldShowPanel ? 'visible' : ''} ${finalSavedHeight ? 'acu-manual-mode' : ''}\" id=\"acu-data-area\" style=\"${finalSavedHeight ? 'height:' + finalSavedHeight + 'px;' : ''}\">\n                    ${\n                      isChangesPanelActive\n                        ? renderChangesPanel(rawData)\n                        : isDashboardActive\n                          ? renderDashboard(tables)\n                          : isMvuActive\n                            ? '<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>'\n                            : currentTabName\n                              ? renderTableContent(tables[currentTabName], currentTabName)\n                              : ''\n                    }\n                </div>\n                `;\n\n      // [] \n      // PC(>768px) CSS display:flex !important grid \n      const gridFixStyle = `grid-template-columns: repeat(${finalGridCols}, 1fr);`;\n\n      html += `\n                <div class=\"acu-nav-container ${config.actionsPosition === 'top' ? 'acu-pos-top' : ''}\" id=\"acu-nav-bar\" style=\"${gridFixStyle}\">\n                    <div class=\"acu-order-controls\" id=\"acu-order-hint\"><i class=\"fa-solid fa-arrows-alt\"></i> </div>\n            `;\n\n      // ===  +  ===\n      const isChangesActive = Store.get('acu_changes_panel_active', false);\n      const isSimpleModeNav = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n      let changesCount = 0;\n      let validationErrorCount = 0;\n      if (rawData) {\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          for (const sheetId in rawData) {\n            if (!sheetId.startsWith('sheet_')) continue;\n            const newSheet = rawData[sheetId];\n            const oldSheet = snapshot[sheetId];\n            if (!newSheet?.content) continue;\n            const newRows = newSheet.content.slice(1);\n            const oldRows = oldSheet?.content?.slice(1) || [];\n            newRows.forEach((row, rowIdx) => {\n              const oldRow = oldRows[rowIdx];\n              if (!oldRow) {\n                changesCount++;\n                return;\n              }\n              row.forEach((cell, colIdx) => {\n                if (colIdx === 0) return;\n                if (String(cell ?? '') !== String(oldRow[colIdx] ?? '')) changesCount++;\n              });\n            });\n            if (oldRows.length > newRows.length) changesCount += oldRows.length - newRows.length;\n          }\n          for (const sheetId in snapshot) {\n            if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n          }\n        }\n        // \n        validationErrorCount = ValidationEngine.getErrorCount(rawData);\n      }\n      // \n      const isValidationMode = isSimpleModeNav;\n      const displayCount = isValidationMode ? validationErrorCount : changesCount;\n      // \n      const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n      // ===  ===\n      const navHiddenList = getHiddenTables();\n      const navSavedOrder = getSavedTableOrder() || [];\n\n      //  + \n      const SPECIAL_NAV_ITEMS = [\n        { key: '__dice__', icon: 'fa-dice-d20', label: '', id: 'acu-btn-dice-nav', extraClass: 'acu-dice-nav-btn' },\n        {\n          key: '__changes__',\n          icon: 'fa-code-compare',\n          label: `${displayCount > 0 ? '(' + displayCount + ')' : ''}`,\n          id: 'acu-btn-changes',\n          extraClass: `acu-changes-btn${showWarningIcon ? ' has-validation-errors' : ''}`,\n          isActive: isChangesActive,\n          warningIcon: showWarningIcon,\n        },\n        {\n          key: '__mvu__',\n          icon: 'fa-code-branch',\n          label: '',\n          id: 'acu-btn-mvu',\n          extraClass: 'acu-mvu-btn',\n          isActive: getActiveTabState() === MvuModule.MODULE_ID,\n        },\n      ];\n\n      // \n      let allNavItems = [];\n\n      // \n      SPECIAL_NAV_ITEMS.forEach(item => {\n        // \n        if (navHiddenList.includes(item.key)) return;\n\n        // MVU\n        if (item.key === '__mvu__') {\n          allNavItems.push({ ...item, isSpecial: true });\n          return;\n        }\n\n        // checkAvailable\n        if (item.checkAvailable && !item.checkAvailable()) return;\n        allNavItems.push({ ...item, isSpecial: true });\n      });\n\n      // \n      orderedNames.forEach(name => {\n        allNavItems.push({\n          key: name,\n          icon: getIconForTableName(name),\n          label: name,\n          isSpecial: false,\n          isActive: !isDashboardActive && !isChangesActive && currentTabName === name,\n        });\n      });\n\n      // \n      if (navSavedOrder.length > 0) {\n        const orderMap = new Map(navSavedOrder.map((k, i) => [k, i]));\n        allNavItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      // [] /\n      // order  1  Grid \n      html += `<button class=\"acu-nav-btn acu-dashboard-btn ${isDashboardActive ? 'active' : ''}\" id=\"acu-btn-dashboard\" style=\"order: 1;\">\n                <i class=\"fa-solid fa-chart-line\"></i><span></span>\n            </button>`;\n\n      // order  2 \n      allNavItems.forEach((item, idx) => {\n        const activeClass = item.isActive ? 'active' : '';\n        const extraClass = item.extraClass || '';\n        const orderVal = idx + 2; //  2  1\n\n        if (item.isSpecial) {\n          // \n          const warningIconHtml = item.warningIcon\n            ? '<i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>'\n            : '';\n          html += `<button class=\"acu-nav-btn ${extraClass} ${activeClass}\" id=\"${item.id}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>${warningIconHtml}\n                    </button>`;\n        } else {\n          // \n          html += `<button class=\"acu-nav-btn ${activeClass}\" data-table=\"${escapeHtml(item.key)}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>\n                    </button>`;\n        }\n      });\n      // order \n      html += `<div class=\"acu-actions-group\" id=\"acu-active-actions\" style=\"order: 9999;\">`;\n      ACTION_BUTTONS.forEach(btn => {\n        html += `<button class=\"acu-action-btn\" id=\"${btn.id}\" title=\"${btn.title}\"><i class=\"fa-solid ${btn.icon}\"></i></button>`;\n      });\n      html += `</div>`;\n\n      html += `</div>`; //  acu-nav-container\n    }\n\n    html += `</div>`; //  acu-wrapper\n\n    const $existing = $('.acu-wrapper');\n    if ($existing.length) {\n      $existing.replaceWith(html);\n    } else {\n      insertHtmlToPage(html);\n    }\n\n    // --- []  ---\n    if (config.positionMode !== 'embedded' && optionHtml && optionPanelVisible) {\n      if (optionChanged) {\n        //  AI \n        injectIndependentOptions(optionHtml);\n      } else {\n        // \n        const $existing = $('.acu-embedded-options-container');\n        if ($existing.length === 0) {\n          // \n          injectIndependentOptions(optionHtml);\n        }\n        // \n      }\n    } else if (config.positionMode !== 'embedded') {\n      // \n      $('.acu-embedded-options-container').remove();\n    } else {\n      // [] \n      $('.acu-embedded-options-container').remove();\n    }\n\n    bindEvents(tables);\n    bindOptionEvents();\n    updateSaveButtonState();\n    // [] \n    if (Store.get('acu_changes_panel_active', false)) {\n      bindChangesEvents();\n    }\n    // [] \n    if (getActiveTabState() === MvuModule.MODULE_ID) {\n      const $panel = $('#acu-data-area');\n      if ($panel.length) {\n        // \n        // \n        // \n        $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n        MvuModule.bindEvents($panel);\n\n        // \n        MvuModule.getDataWithRetry(5, 800)\n          .then(mvuData => {\n            // \n            if (mvuData) {\n              $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n              MvuModule.bindEvents($panel);\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error getting data:', err);\n            // \n            $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n            MvuModule.bindEvents($panel);\n          });\n      }\n    }\n\n    setTimeout(() => {\n      const $newContent = $('.acu-panel-content');\n      const activeTab = getActiveTabState();\n      const savedState = tableScrollStates[activeTab];\n\n      if ($newContent.length) {\n        // 1. \n        //  savedState () lastScrollY ()\n        if (savedState) {\n          $newContent.scrollTop(savedState.top);\n          $newContent.scrollLeft(savedState.left);\n        } else {\n          if (lastScrollY > 0) $newContent.scrollTop(lastScrollY);\n          if (lastScrollX > 0) $newContent.scrollLeft(lastScrollX);\n        }\n\n        // 2.  ()\n        if (savedState && savedState.inner) {\n          Object.keys(savedState.inner).forEach(key => {\n            const scrollTop = savedState.inner[key];\n            // \n            const $targetTitle = $newContent.find(`.acu-editable-title[data-row=\"${key}\"]`);\n            if ($targetTitle.length) {\n              const $card = $targetTitle.closest('.acu-data-card');\n              //  ( overflow on card)\n              $card.scrollTop(scrollTop);\n              //  body  ( overflow on body)\n              $card.find('.acu-card-body').scrollTop(scrollTop);\n            }\n          });\n        }\n      }\n    }, 0);\n    console.info('[DICE]');\n  };\n\n  // [] \n  const injectIndependentOptions = htmlContent => {\n    const { $ } = getCore();\n    $('.acu-embedded-options-container').remove();\n\n    //  AI \n    const getTargetContainer = () => {\n      const $allMes = $('#chat .mes');\n      const $aiMes = $allMes.filter(function () {\n        const $this = $(this);\n        if ($this.attr('is_user') === 'true' || $this.attr('is_system') === 'true' || $this.hasClass('sys_mes'))\n          return false;\n        //  data-is-system \n        if ($this.find('.name_text').text().trim() === 'System' || $this.attr('data-is-system') === 'true')\n          return false;\n        // [] \n        if ($this.find('.mes_text').length === 0) return false;\n        if ($this.css('display') === 'none') return false;\n        return true;\n      });\n      if ($aiMes.length === 0) return null;\n\n      const $targetMes = $aiMes.last();\n      const $targetBlock = $targetMes.find('.mes_block');\n      return $targetBlock.length ? $targetBlock : $targetMes;\n    };\n\n    const $target = getTargetContainer();\n    if ($target && $target.length) {\n      const optConfig = getConfig();\n      const $container = $(\n        `<div class=\"acu-embedded-options-container acu-theme-${optConfig.theme}\" style=\"--acu-opt-font-size:${optConfig.optionFontSize || 12}px;\"></div>`,\n      );\n      $container.html(htmlContent);\n      $target.append($container);\n    }\n  };\n\n  // []  ( + )\n  const bindOptionEvents = () => {\n    const { $ } = getCore();\n    //  Body \n    $('body')\n      .off('click.acu_opt')\n      .on('click.acu_opt', '.acu-opt-btn', async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const config = getConfig();\n        const val = decodeURIComponent($(this).data('val'));\n\n        // 1:  -> \n        if (!config.clickOptionToAutoSend) {\n          smartInsertToTextarea(val, 'action');\n          $('#send_textarea').focus();\n          return;\n        }\n\n        // 2: \n        // A: TavernHelper ( refresh: 'affected' )\n        if (window.TavernHelper) {\n          try {\n            // 1.  createChatMessages \n            if (window.TavernHelper.createChatMessages) {\n              await window.TavernHelper.createChatMessages(\n                [\n                  {\n                    role: 'user',\n                    message: val,\n                  },\n                ],\n                {\n                  //  TavernHelper \n                  refresh: 'affected',\n                },\n              );\n\n              // 2. \n              if (window.TavernHelper.triggerSlash) {\n                await window.TavernHelper.triggerSlash('/trigger');\n              }\n              return;\n            }\n          } catch (err) {\n            console.warn('[DICE]ACU TavernHelper ', err);\n          }\n        }\n\n        // B: SillyTavern  (Slash Command)\n        const ST = window.SillyTavern || window.parent?.SillyTavern;\n        if (ST && ST.executeSlashCommandsWithOptions) {\n          try {\n            //  raw=true  ( slash_command.txt)\n            const safeVal = val.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n            const cmd = `/send raw=true \"${safeVal}\"`;\n\n            const sendResult = await ST.executeSlashCommandsWithOptions(cmd);\n\n            if (!sendResult.isError && !sendResult.isAborted) {\n              await ST.executeSlashCommandsWithOptions('/trigger');\n              return;\n            }\n            console.warn('[DICE]ACU ST send :', sendResult);\n          } catch (err) {\n            console.warn('[DICE]ACU ST', err);\n          }\n        }\n\n        // C:  +  ()\n        const ta = $('#send_textarea');\n        if (ta.length) {\n          ta.val(val);\n          ta.trigger('input').trigger('change');\n          //  React \n          await new Promise(r => setTimeout(r, 50));\n          const sendBtn = $('#send_but').filter(':visible');\n          if (sendBtn.length) {\n            sendBtn[0].click();\n          } else {\n            // \n            const enterEvent = $.Event('keydown', { keyCode: 13, which: 13, bubbles: true });\n            ta.trigger(enterEvent);\n          }\n        }\n      });\n  };\n\n  const insertHtmlToPage = html => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // ---  ---\n\n    // 1.  (Embedded) v19 \n    if (config.positionMode === 'embedded') {\n      $('.acu-wrapper').remove(); // \n\n      const getTargetContainer = () => {\n        const $allMes = $('#chat .mes');\n        const $aiMes = $allMes.filter(function () {\n          const $this = $(this);\n          if ($this.attr('is_user') === 'true') return false;\n          if ($this.attr('is_system') === 'true') return false;\n          if ($this.hasClass('sys_mes')) return false;\n          const name = $this.find('.name_text').text().trim();\n          if (name === 'System') return false;\n          if ($this.css('display') === 'none') return false;\n          const $textDiv = $this.find('.mes_text');\n          if ($textDiv.length === 0) return false;\n          const textContent = $textDiv.text().trim();\n          const hasImage = $textDiv.find('img').length > 0;\n          if (textContent.length === 0 && !hasImage) return false;\n          return true;\n        });\n        //  AI  chat\n        if ($aiMes.length === 0) return $('#chat');\n\n        // \n\n        let targetIndex = $aiMes.length - 1;\n        const $targetMes = $aiMes.eq(targetIndex);\n        const $targetBlock = $targetMes.find('.mes_block');\n        return $targetBlock.length ? $targetBlock : $targetMes;\n      };\n\n      const $target = getTargetContainer();\n      if ($target.length) {\n        if ($target.hasClass('mes_block') || $target.hasClass('mes')) {\n          if ($target.find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          } else {\n            $target.find('.acu-wrapper').replaceWith(html);\n          }\n        } else {\n          // Fallback\n          if ($('#chat').find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          }\n        }\n      } else {\n        $('body').append(html);\n      }\n      return;\n    }\n\n    // 2.  (Fixed) B \n    // \n    const $chat = $('#chat');\n    const $oldWrapper = $('.acu-wrapper');\n\n    if ($oldWrapper.length) {\n      $oldWrapper.replaceWith(html);\n    } else {\n      if ($chat.length) {\n        $chat.append(html);\n      } else {\n        $('body').append(html);\n      }\n    }\n  };\n  // [] \n  const renderChangesPanel = rawData => {\n    const snapshot = loadSnapshot();\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // \n    const validationErrors = rawData ? ValidationEngine.validateAllData(rawData) : [];\n\n    if (!snapshot || !rawData) {\n      // \n      if (validationErrors.length === 0) {\n        return `\n                <div class=\"acu-panel-header\">\n                    <div class=\"acu-panel-title\">\n                        <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-compare\"></i> <span class=\"acu-title-text\"></span></div>\n                        <div class=\"acu-title-sub\"></div>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-panel-content\" style=\"display:flex;align-items:center;justify-content:center;\">\n                    <div class=\"acu-empty-hint\"></div>\n                </div>`;\n      }\n    }\n\n    // \n    const changes = [];\n\n    for (const sheetId in rawData) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      const newSheet = rawData[sheetId];\n      const oldSheet = snapshot[sheetId];\n      if (!newSheet?.name || !newSheet?.content) continue;\n\n      const tableName = newSheet.name;\n      const headers = newSheet.content[0] || [];\n      const newRows = newSheet.content.slice(1);\n      const oldRows = oldSheet?.content?.slice(1) || [];\n\n      // \n      newRows.forEach((row, rowIdx) => {\n        const oldRow = oldRows[rowIdx];\n\n        if (!oldRow) {\n          // \n          changes.push({\n            type: 'row_added',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: rowIdx,\n            headers,\n            row,\n            title: row[1] || ` ${rowIdx + 1}`,\n          });\n        } else {\n          // \n          const rowChanges = [];\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return; // \n            const oldVal = String(oldRow[colIdx] ?? '');\n            const newVal = String(cell ?? '');\n            if (oldVal !== newVal) {\n              rowChanges.push({\n                colIndex: colIdx,\n                header: headers[colIdx] || `${colIdx}`,\n                oldValue: oldVal,\n                newValue: newVal,\n              });\n            }\n          });\n\n          if (rowChanges.length === 1) {\n            // \n            const c = rowChanges[0];\n            changes.push({\n              type: 'cell_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              colIndex: c.colIndex,\n              header: c.header,\n              oldValue: c.oldValue,\n              newValue: c.newValue,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          } else if (rowChanges.length > 1) {\n            // \n            changes.push({\n              type: 'row_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              headers,\n              row,\n              oldRow,\n              changedFields: rowChanges,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          }\n        }\n      });\n\n      // \n      if (oldRows.length > newRows.length) {\n        for (let i = newRows.length; i < oldRows.length; i++) {\n          const oldRow = oldRows[i];\n          changes.push({\n            type: 'row_deleted',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: i,\n            headers,\n            row: oldRow,\n            title: oldRow[1] || ` ${i + 1}`,\n          });\n        }\n      }\n    }\n\n    // \n    for (const sheetId in snapshot) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      if (!rawData[sheetId]) {\n        const oldSheet = snapshot[sheetId];\n        changes.push({\n          type: 'table_deleted',\n          tableName: oldSheet?.name || sheetId,\n          tableKey: sheetId,\n        });\n      }\n    }\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n\n    // \n    const panelTitle = isValidationMode ? '' : '';\n    const panelIcon = isValidationMode ? 'fa-shield-halved' : 'fa-code-compare';\n    const toggleTitle = isValidationMode ? '' : '';\n\n    //  HTML\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n                    <div class=\"acu-title-main\"><i class=\"fa-solid ${panelIcon}\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                </div>\n                <div class=\"acu-header-actions\">\n                    ${!isValidationMode ? '<button class=\"acu-changes-batch-btn acu-batch-accept\" title=\"\"><i class=\"fa-solid fa-check-double\"></i></button>' : ''}\n                    <button class=\"acu-changes-batch-btn acu-batch-reject\" title=\"${isValidationMode ? '' : ''}\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                    <button class=\"acu-changes-batch-btn acu-simple-mode-toggle ${isValidationMode ? 'active' : ''}\" title=\"${toggleTitle}\">\n                        <i class=\"fa-solid ${isValidationMode ? 'fa-filter-circle-xmark' : 'fa-filter'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                    </div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>`;\n\n    // ===  ===\n    if (isValidationMode) {\n      html += `<div class=\"acu-validation-mode-hint\">\n        <i class=\"fa-solid fa-info-circle\"></i>\n      </div>`;\n    }\n\n    html += `<div class=\"acu-panel-content acu-changes-content ${config.layout === 'horizontal' ? 'acu-changes-horizontal' : ''}\">`;\n\n    // ===  ===\n    if (isValidationMode) {\n      if (validationErrors.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedErrors = ValidationEngine.groupErrorsByTable(validationErrors);\n        const collapsedGroups = Store.get('acu_validation_collapsed_groups', []);\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        for (const tableName in groupedErrors) {\n          const tableErrors = groupedErrors[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header acu-validation-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\" style=\"background:${t.errorText};\">${tableErrors.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableErrors.forEach(error => {\n            const ruleData = error.rule\n              ? escapeHtml(\n                  JSON.stringify({\n                    ruleId: error.ruleId,\n                    ruleType: error.ruleType,\n                    tableName: error.tableName,\n                    rowIndex: error.rowIndex,\n                    columnName: error.columnName || '',\n                    currentValue: error.currentValue || '',\n                    rowTitle: error.rowTitle || '', //  rowTitle  ruleData\n                    rule: error.rule,\n                  }),\n                )\n              : '';\n\n            html += `<div class=\"acu-change-item acu-validation-error-item\"\n                         data-table=\"${escapeHtml(error.tableName)}\"\n                         data-row=\"${error.rowIndex}\"\n                         data-column=\"${escapeHtml(error.columnName || '')}\"\n                         data-rule-id=\"${escapeHtml(error.ruleId || '')}\"\n                         data-rule-type=\"${escapeHtml(error.ruleType || '')}\"\n                         data-rule-data=\"${ruleData}\">\n                        <span class=\"acu-change-badge\" style=\"background:var(--acu-hl-manual-bg);color:var(--acu-hl-manual);\">!</span>\n                        ${error.rowTitle && error.rowIndex >= 0 ? `<div class=\"acu-validation-row-title\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:2px;\">${escapeHtml(error.rowTitle)}</div>` : ''}\n                        <span class=\"acu-change-title\">${escapeHtml(error.columnName || '')}${error.currentValue ? `: ${escapeHtml(error.currentValue.length > 15 ? error.currentValue.substring(0, 15) + '...' : error.currentValue)}` : ''}</span>\n                        <span class=\"acu-validation-error-msg\">${escapeHtml(error.errorMessage.length > 25 ? error.errorMessage.substring(0, 25) + '...' : error.errorMessage)}</span>\n                        <div class=\"acu-change-actions\">\n                            <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                        </div>\n                    </div>`;\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    } else {\n      // ===  ===\n      if (changes.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedChanges = {};\n        changes.forEach(c => {\n          const key = c.tableName;\n          if (!groupedChanges[key]) groupedChanges[key] = [];\n          groupedChanges[key].push(c);\n        });\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        const collapsedGroups = Store.get('acu_changes_collapsed_groups', []);\n\n        for (const tableName in groupedChanges) {\n          const tableChanges = groupedChanges[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\">${tableChanges.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableChanges.forEach(change => {\n            if (change.type === 'row_added') {\n              html += `<div class=\"acu-change-item acu-change-added\"\n                            data-change-type=\"row_added\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-added\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"row_deleted\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'cell_modified') {\n              const oldShort = change.oldValue.length > 15 ? change.oldValue.substring(0, 15) + '...' : change.oldValue;\n              const newShort = change.newValue.length > 15 ? change.newValue.substring(0, 15) + '...' : change.newValue;\n\n              const isOptionTable = change.tableName && change.tableName.includes('');\n              let fieldDisplay;\n              if (isOptionTable) {\n                fieldDisplay = `${escapeHtml(change.tableName)}.${escapeHtml(change.header)}`;\n              } else {\n                fieldDisplay = `${escapeHtml(change.rowTitle)}.${escapeHtml(change.header)}`;\n              }\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"cell_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\"\n                            data-col-index=\"${change.colIndex}\"\n                            data-old-value=\"${encodeURIComponent(change.oldValue)}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-field\">${fieldDisplay}</span>\n                            <span class=\"acu-change-diff\">\n                                <span class=\"acu-diff-old\">${escapeHtml(oldShort || '()')}</span>\n                                <span class=\"acu-diff-arrow\"></span>\n                                <span class=\"acu-diff-new\">${escapeHtml(newShort || '()')}</span>\n                            </span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_modified') {\n              // \n              const fieldCount = change.changedFields.length;\n              const fieldNames = change.changedFields\n                .slice(0, 2)\n                .map(f => f.header)\n                .join('');\n              const moreText = fieldCount > 2 ? ` ${fieldCount}` : '';\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"row_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.rowTitle)}</span>\n                            <span class=\"acu-change-field-count\">${escapeHtml(fieldNames)}${moreText}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'table_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"table_deleted\"\n                            data-table-key=\"${change.tableKey}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\"></span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            }\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    }\n\n    html += `</div>`;\n    return html;\n  };\n  // [] \n  const bindChangesEvents = () => {\n    const { $ } = getCore();\n\n    // \n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-close-btn')\n      .off('click')\n      .on('click', function () {\n        Store.set('acu_changes_panel_active', false);\n        $('#acu-data-area').removeClass('visible');\n        $('.acu-nav-btn').removeClass('active');\n      });\n\n    // === ===\n    const TOUCH_MOVE_THRESHOLD = 10; // 10px\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const tableName = $item.data('table');\n        const rowIndex = parseInt($item.data('row'), 10);\n        const columnName = $item.data('column');\n\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        try {\n          const rawData = cachedRawData || getTableData();\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === tableName && snapshot[sheetId]) {\n              const headers = rawData[sheetId].content?.[0] || [];\n              const colIdx = headers.indexOf(columnName);\n              if (colIdx >= 0 && snapshot[sheetId].content?.[rowIndex + 1]) {\n                const snapshotValue = snapshot[sheetId].content[rowIndex + 1][colIdx];\n                rawData[sheetId].content[rowIndex + 1][colIdx] = snapshotValue;\n                await saveDataToDatabase(rawData, false, false);\n                renderInterface();\n                return;\n              }\n              break;\n            }\n          }\n          if (window.toastr) window.toastr.warning('');\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const ruleData = $item.data('rule-data');\n        if (!ruleData) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        try {\n          const parsed = typeof ruleData === 'string' ? JSON.parse(ruleData) : ruleData;\n          const error = {\n            ruleId: parsed.ruleId,\n            ruleType: parsed.ruleType,\n            rule: parsed.rule,\n            tableName: $item.data('table') || parsed.tableName || '',\n            rowIndex: parseInt($item.data('row'), 10) || parsed.rowIndex || 0,\n            columnName: $item.data('column') || parsed.columnName || '',\n            currentValue: parsed.currentValue || '',\n            rowTitle: parsed.rowTitle || '', //  rowTitle \n            ruleName: parsed.ruleName || parsed.rule?.name || '',\n            errorMessage: parsed.errorMessage || parsed.rule?.errorMessage || '',\n          };\n          showSmartFixModal(error);\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    let validationItemTouchStartPos: { x: number; y: number } | null = null;\n\n    $('.acu-validation-error-item')\n      .off('click touchstart touchend touchmove')\n      .on('touchstart', function (e) {\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        validationItemTouchStartPos = { x: touch.clientX, y: touch.clientY };\n      })\n      .on('touchmove', function (e) {\n        if (!validationItemTouchStartPos) return;\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        const deltaX = Math.abs(touch.clientX - validationItemTouchStartPos.x);\n        const deltaY = Math.abs(touch.clientY - validationItemTouchStartPos.y);\n        // \n        if (deltaX > TOUCH_MOVE_THRESHOLD || deltaY > TOUCH_MOVE_THRESHOLD) {\n          validationItemTouchStartPos = null;\n        }\n      })\n      .on('touchend', function (e) {\n        // \n        if (!validationItemTouchStartPos) return;\n        validationItemTouchStartPos = null;\n\n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      })\n      .on('click', function (e) {\n        //  click \n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        //  touchend \n        if ('ontouchstart' in window) return;\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      });\n\n    // /\n    $('.acu-changes-group-header')\n      .off('click')\n      .on('click', function (e) {\n        if ($(e.target).closest('.acu-change-item').length) return;\n\n        const tableName = $(this).data('table');\n        const $group = $(this).closest('.acu-changes-group');\n        const $body = $group.find('.acu-changes-group-body');\n        const $icon = $(this).find('.acu-collapse-icon');\n\n        // \n        const isValidationMode = $(this).hasClass('acu-validation-group-header');\n        const storageKey = isValidationMode ? 'acu_validation_collapsed_groups' : 'acu_changes_collapsed_groups';\n        let collapsedGroups = Store.get(storageKey, []);\n\n        if ($group.hasClass('collapsed')) {\n          $group.removeClass('collapsed');\n          $body.slideDown(200);\n          $icon.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n          collapsedGroups = collapsedGroups.filter(n => n !== tableName);\n        } else {\n          $group.addClass('collapsed');\n          $body.slideUp(200);\n          $icon.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n          if (!collapsedGroups.includes(tableName)) {\n            collapsedGroups.push(tableName);\n          }\n        }\n\n        Store.set(storageKey, collapsedGroups);\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-accept')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n\n        const snapshot = loadSnapshot();\n        const rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = rawData[tableKey].content[rowIndex + 1][colIndex];\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            if (!snapshot[tableKey]) {\n              snapshot[tableKey] = JSON.parse(JSON.stringify(rawData[tableKey]));\n            } else {\n              snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n            }\n          }\n        } else if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          delete snapshot[tableKey];\n        }\n\n        saveSnapshot(snapshot);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n        const oldValue = decodeURIComponent($item.data('old-value') || '');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content[rowIndex + 1][colIndex] = oldValue;\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content) {\n            rawData[tableKey].content[rowIndex + 1] = [...snapshot[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === /===\n    $('.acu-action-restore')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            const restoredRow = [...snapshot[tableKey].content[rowIndex + 1]];\n            if (!rawData[tableKey]) {\n              rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n              rawData[tableKey].content = [snapshot[tableKey].content[0]];\n            }\n            // \n            rawData[tableKey].content.splice(rowIndex + 1, 0, restoredRow);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          if (snapshot[tableKey]) {\n            rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item:not(.acu-validation-error-item) .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const changeType = $item.data('change-type');\n\n        if (!tableKey || rowIndex === undefined) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const sheet = rawData[tableKey];\n        const headers = sheet.content ? sheet.content[0] : [];\n        const row = sheet.content ? sheet.content[rowIndex + 1] : null;\n\n        if (!row) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        if (changeType === 'row_modified') {\n          // \n          showRowCompareEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        } else if (changeType === 'cell_modified') {\n          const colIndex = $item.data('col-index');\n          const headerName = headers[colIndex] || `${colIndex}`;\n          const cellValue = row[colIndex] || '';\n          showChangeSingleFieldModal(cellValue, headerName, sheet.name, rowIndex, colIndex, tableKey);\n        } else {\n          showChangeEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        }\n      });\n\n    // ===  ===\n    $('.acu-batch-accept')\n      .off('click')\n      .on('click', async function () {\n        const rawData = cachedRawData || getTableData();\n        if (!rawData) return;\n\n        // \n        saveSnapshot(JSON.parse(JSON.stringify(rawData)));\n        currentDiffMap = new Set();\n\n        // \n        refreshChangesPanel();\n      });\n\n    // ===  ===\n    $('.acu-batch-reject')\n      .off('click')\n      .on('click', async function () {\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const restoredData = JSON.parse(JSON.stringify(snapshot));\n        cachedRawData = restoredData;\n        await saveDataToDatabase(restoredData, false, false);\n      });\n\n    // ===  ===\n    $('.acu-simple-mode-toggle')\n      .off('click')\n      .on('click', function () {\n        const currentMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        const newMode = !currentMode;\n        Store.set(STORAGE_KEY_VALIDATION_MODE, newMode);\n\n        // \n        const rawData = cachedRawData || getTableData();\n        $('#acu-data-area').html(renderChangesPanel(rawData));\n        bindChangesEvents();\n\n        // \n        updateChangesCount(rawData);\n      });\n\n    // ===  ===\n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          // \n          const finalHeight = $panel.height();\n          const heights = getTableHeights();\n          heights[tableName] = finalHeight;\n          saveTableHeights(heights);\n        };\n      })\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const $panel = $('#acu-data-area');\n        $panel.css('height', ''); // \n        // \n        const heights = getTableHeights();\n        delete heights[tableName];\n        saveTableHeights(heights);\n      });\n\n    // ===  ===\n    const $horizontalScroller = $('.acu-changes-content.acu-changes-horizontal');\n    if ($horizontalScroller.length) {\n      $horizontalScroller[0].addEventListener(\n        'touchstart',\n        function (e) {\n          this._touchStartX = e.touches[0].clientX;\n          this._touchStartY = e.touches[0].clientY;\n          this._scrollDirection = null; // \n        },\n        { passive: true },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchmove',\n        function (e) {\n          if (!this._touchStartX) return;\n\n          const deltaX = Math.abs(e.touches[0].clientX - this._touchStartX);\n          const deltaY = Math.abs(e.touches[0].clientY - this._touchStartY);\n\n          // \n          if (!this._scrollDirection && (deltaX > 5 || deltaY > 5)) {\n            this._scrollDirection = deltaX > deltaY ? 'horizontal' : 'vertical';\n          }\n\n          // \n          // \n          if (this._scrollDirection === 'horizontal' && deltaX > 10) {\n            e.stopPropagation();\n          }\n        },\n        { passive: false },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchend',\n        function () {\n          this._touchStartX = null;\n          this._touchStartY = null;\n          this._scrollDirection = null;\n        },\n        { passive: true },\n      );\n    }\n  };\n\n  // [] \n  const refreshChangesPanel = () => {\n    const { $ } = getCore();\n    const rawData = cachedRawData || getTableData();\n    currentDiffMap = generateDiffMap(rawData);\n\n    const $panel = $('#acu-data-area');\n    if ($panel.length && Store.get('acu_changes_panel_active', false)) {\n      $panel.html(renderChangesPanel(rawData));\n      bindChangesEvents();\n\n      // \n      updateChangesCount(rawData);\n    }\n  };\n\n  // []  + \n  const updateChangesCount = rawData => {\n    const { $ } = getCore();\n    const snapshot = loadSnapshot();\n    let changesCount = 0;\n\n    if (snapshot && rawData) {\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const newSheet = rawData[sheetId];\n        const oldSheet = snapshot[sheetId];\n        if (!newSheet?.content) continue;\n        const newRows = newSheet.content.slice(1);\n        const oldRows = oldSheet?.content?.slice(1) || [];\n        newRows.forEach((row, rowIdx) => {\n          const oldRow = oldRows[rowIdx];\n          if (!oldRow) {\n            changesCount++;\n            return;\n          }\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return;\n            if (String(cell ?? '') !== String(oldRow[colIdx] ?? '')) changesCount++;\n          });\n        });\n        if (oldRows.length > newRows.length) changesCount += oldRows.length - newRows.length;\n      }\n      for (const sheetId in snapshot) {\n        if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n      }\n    }\n\n    // \n    const validationErrorCount = rawData ? ValidationEngine.getErrorCount(rawData) : 0;\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n    const displayCount = isValidationMode ? validationErrorCount : changesCount;\n    // \n    const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n    const $btn = $('#acu-btn-changes');\n    const $span = $btn.find('span');\n    $span.html(displayCount > 0 ? `(${displayCount})` : '');\n\n    // \n    if (showWarningIcon) {\n      if (!$btn.find('.acu-nav-warning-icon').length) {\n        $span.append(' <i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>');\n      }\n      $btn.addClass('has-validation-errors');\n    } else {\n      $btn.find('.acu-nav-warning-icon').remove();\n      $btn.removeClass('has-validation-errors');\n    }\n  };\n  // [] \n  const showChangeEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const inputsHtml = row\n      .map((cell, idx) => {\n        if (idx === 0) return '';\n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        return `\n                <div class=\"acu-card-edit-field\" style=\"margin-bottom: 10px;\">\n                    <label style=\"display:block;font-size:12px;color:var(--acu-accent);font-weight:bold;margin-bottom:4px;\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\"\n                                                        style=\"width:100%;min-height:40px;max-height:500px;padding:10px;resize:none;overflow-y:hidden;\">${escapeHtml(val)}</textarea>                            </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${inputsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-change-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-change-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // [] \n    const adjustHeight = el => {\n      //  auto  0px scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n    };\n    dialog.find('#dlg-change-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    dialog.find('#dlg-change-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n\n        if (hasChanges) {\n          // 1. \n          try {\n            const api = getCore().getDB();\n            if (!api || !api.importTableAsJson) {\n              throw new Error(' API ');\n            }\n\n            const dataToSave = { mate: rawData.mate || { type: 'chatSheets', version: 1 } };\n            Object.keys(rawData).forEach(k => {\n              if (k.startsWith('sheet_')) dataToSave[k] = rawData[k];\n            });\n\n            // \n            let jsonString;\n            try {\n              jsonString = JSON.stringify(dataToSave);\n              //  10MB \n              const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n              if (sizeInMB > 10) {\n                throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n              }\n            } catch (stringifyError) {\n              console.error('[DICE]ACU JSON :', stringifyError);\n              throw new Error(`: ${stringifyError.message || stringifyError}`);\n            }\n\n            //  importTableAsJson saveChat()\n            const result = await api.importTableAsJson(jsonString);\n            //  false \n            if (result === false) {\n              throw new Error(' false');\n            }\n            cachedRawData = rawData;\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            let errorMessage = e.message || '';\n            //  \"Settings could not be saved\" \n            const errorMsg = String(e);\n            if (\n              errorMsg.includes('Settings could not be saved') ||\n              errorMsg.includes('server connection') ||\n              errorMsg.includes('data loss')\n            ) {\n              errorMessage = '';\n            }\n            if (window.toastr) {\n              window.toastr.error(errorMessage, '', { timeOut: 7000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n            // \n            return;\n          }\n\n          // 2. \n          const snapshot = loadSnapshot();\n          if (snapshot && snapshot[tableKey] && snapshot[tableKey].content) {\n            snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n            saveSnapshot(snapshot);\n          }\n\n          // 3.  diffMap \n          currentDiffMap = generateDiffMap(rawData);\n\n          // 4. \n          const $panel = $('#acu-data-area');\n          $panel.html(renderChangesPanel(rawData));\n          bindChangesEvents();\n        }\n      }\n      closeDialog();\n    });\n  };\n  // [] \n  const showChangeSingleFieldModal = (value, headerName, tableName, rowIndex, colIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldValue = snapshot?.[tableKey]?.content?.[rowIndex + 1]?.[colIndex] ?? '';\n    const hasOldValue = oldValue !== '' && String(oldValue) !== String(value);\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:450px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(headerName)}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${\n                          hasOldValue\n                            ? `\n                        <div class=\"acu-diff-section acu-diff-old-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                            </div>\n                            <div class=\"acu-diff-readonly\">${escapeHtml(oldValue)}</div>\n                        </div>\n                        <div class=\"acu-diff-arrow-down\">\n                            <i class=\"fa-solid fa-arrow-down\"></i>\n                        </div>\n                        `\n                            : ''\n                        }\n                        <div class=\"acu-diff-section acu-diff-new-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-pen\"></i> ${hasOldValue ? '' : ''}\n                            </div>\n                            <textarea class=\"acu-change-single-input acu-edit-textarea\" spellcheck=\"false\"\n                                style=\"width:100%;min-height:60px;max-height:300px;padding:12px;resize:none;\">${escapeHtml(value)}</textarea>\n                        </div>\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-single-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        ${hasOldValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"dlg-single-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-single-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const $textarea = dialog.find('.acu-change-single-input');\n    const adjustHeight = () => {\n      $textarea[0].style.height = 'auto';\n      const h = Math.max(60, Math.min($textarea[0].scrollHeight + 2, 300));\n      $textarea[0].style.height = h + 'px';\n    };\n    setTimeout(adjustHeight, 0);\n    $textarea.on('input', adjustHeight);\n    $textarea.focus();\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-single-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    // [] \n    dialog.find('#dlg-single-revert').click(function () {\n      $textarea.val(oldValue).trigger('input');\n    });\n\n    dialog.find('#dlg-single-save').click(async () => {\n      const newVal = $textarea.val();\n      let rawData = cachedRawData || getTableData();\n\n      if (rawData && rawData[tableKey] && rawData[tableKey].content) {\n        const currentRow = rawData[tableKey].content[rowIndex + 1];\n        if (currentRow && String(currentRow[colIndex]) !== String(newVal)) {\n          currentRow[colIndex] = newVal;\n\n          // \n          await saveDataOnly(rawData);\n\n          // \n          const snapshot = loadSnapshot();\n          if (\n            snapshot &&\n            snapshot[tableKey] &&\n            snapshot[tableKey].content &&\n            snapshot[tableKey].content[rowIndex + 1]\n          ) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = newVal;\n            saveSnapshot(snapshot);\n          }\n\n          // \n          currentDiffMap = generateDiffMap(rawData);\n          refreshChangesPanel();\n        }\n      }\n      closeDialog();\n    });\n  };\n\n  // [] \n  const showRowCompareEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldRow = snapshot?.[tableKey]?.content?.[rowIndex + 1] || [];\n\n    // \n    let fieldsHtml = '';\n    for (let idx = 1; idx < headers.length; idx++) {\n      const headerName = headers[idx] || ` ${idx}`;\n      const oldVal = oldRow[idx] ?? '';\n      const newVal = row[idx] ?? '';\n      const isChanged = String(oldVal) !== String(newVal);\n\n      fieldsHtml += `\n                <div class=\"acu-row-edit-field ${isChanged ? 'acu-field-changed' : ''}\">\n                    <div class=\"acu-row-edit-label\">${escapeHtml(headerName)} ${isChanged ? '<span class=\"acu-changed-badge\"></span>' : ''}</div>\n                    ${isChanged ? `<div class=\"acu-row-edit-old\">${escapeHtml(oldVal) || '<span class=\"acu-empty-val\">()</span>'}</div>` : ''}\n                    <textarea class=\"acu-row-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\">${escapeHtml(newVal)}</textarea>\n                </div>\n            `;\n    }\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:550px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(row[1] || ' ' + (rowIndex + 1))}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px; max-height:60vh;\">\n                        ${fieldsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-row-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = Math.min(el.scrollHeight + 2, 200) + 'px';\n    };\n    dialog.find('textarea').each(function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-row-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#dlg-row-revert').click(function () {\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        $(this)\n          .val(oldRow[colIdx] ?? '')\n          .trigger('input');\n      });\n    });\n\n    // \n    dialog.find('#dlg-row-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (!rawData?.[tableKey]?.content?.[rowIndex + 1]) {\n        closeDialog();\n        return;\n      }\n\n      const currentRow = rawData[tableKey].content[rowIndex + 1];\n      let hasChanges = false;\n\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        const newVal = $(this).val();\n        if (String(currentRow[colIdx]) !== String(newVal)) {\n          hasChanges = true;\n          currentRow[colIdx] = newVal;\n        }\n      });\n\n      if (hasChanges) {\n        await saveDataOnly(rawData);\n\n        // \n        const snapshot = loadSnapshot();\n        if (snapshot?.[tableKey]?.content) {\n          snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n          saveSnapshot(snapshot);\n        }\n\n        currentDiffMap = generateDiffMap(rawData);\n        refreshChangesPanel();\n      }\n      closeDialog();\n    });\n  };\n  const renderDashboard = allTables => {\n    console.info('[DICE]...');\n    const config = getConfig();\n\n    // [] \n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const questResult = DashboardDataParser.findTable(allTables, 'quest');\n    const bagResult = DashboardDataParser.findTable(allTables, 'bag');\n    const skillResult = DashboardDataParser.findTable(allTables, 'skill');\n    const equipResult = DashboardDataParser.findTable(allTables, 'equip');\n\n    // []  - \n    let player = { name: '', status: '', position: '', attrs: '', money: '0' };\n    const playerParsed = DashboardDataParser.parseRows(playerResult, 'player');\n\n    if (playerParsed.length > 0) {\n      const p = playerParsed[0];\n      player.name = p.name || '';\n      player.status = p.status || '';\n      player.position = p.position || '';\n      player.money = p.money || '';\n      player.resources = '';\n\n      // [] \n      if (playerResult?.data?.headers && playerResult?.data?.rows?.[0]) {\n        const headers = playerResult.data.headers;\n        const row = playerResult.data.rows[0];\n        let allAttrsStr = '';\n        headers.forEach((h, idx) => {\n          if (h && h.includes('')) {\n            const val = row[idx];\n            if (val) allAttrsStr += (allAttrsStr ? '; ' : '') + val;\n          }\n        });\n        player.attrs = allAttrsStr;\n\n        // \n        headers.forEach((h, idx) => {\n          if (h && (h.includes('') || h.includes(''))) {\n            const val = row[idx];\n            if (val) player.resources = val;\n          }\n        });\n      }\n    }\n\n    // [] HTML\n    const playerRows = playerResult?.data?.rows || [];\n    const playerHeaders = playerResult?.data?.headers || [];\n\n    // []  - \n    let globalDetailLocation = ''; // \n    let globalLocation = ''; // \n\n    if (globalResult?.data?.rows?.length > 0) {\n      const headers = globalResult.data.headers || [];\n      const row = globalResult.data.rows[0];\n\n      // \n      const detailIdx = DashboardDataParser.findColumnIndex(headers, 'detailLocation', globalResult.config);\n      if (detailIdx >= 0 && row[detailIdx]) {\n        globalDetailLocation = row[detailIdx];\n      }\n\n      // \n      const locIdx = DashboardDataParser.findColumnIndex(headers, 'currentLocation', globalResult.config);\n      globalLocation = locIdx >= 0 && row[locIdx] ? row[locIdx] : row[2] || '';\n    }\n\n    // currentPlaceName \n    let currentPlaceName =\n      globalDetailLocation ||\n      globalLocation ||\n      (player.position.includes('-') ? player.position.split('-')[0].trim() : player.position);\n\n    // [] NPC - \n    const npcTableName = npcResult?.name || '';\n    const npcTableKey = npcResult?.key || '';\n\n    const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n\n    // NPC\n    let inSceneNPCs = [];\n    let offSceneNPCs = [];\n    npcParsed.forEach(npc => {\n      const inSceneVal = String(npc.inScene || '').toLowerCase();\n      const npcData = {\n        name: npc.name || '',\n        status: npc.status || '',\n        position: npc.position || '',\n        index: npc._rowIndex,\n      };\n      if (inSceneVal === 'true' || inSceneVal === '') {\n        inSceneNPCs.push(npcData);\n      } else {\n        offSceneNPCs.push(npcData);\n      }\n    });\n    // \n    let allNPCs = [...inSceneNPCs, ...offSceneNPCs];\n\n    // []  -  + \n    const questTableName = questResult?.name || '';\n    const questParsed = DashboardDataParser.parseRows(questResult, 'quest');\n    const activeQuestParsed = DashboardDataParser.applyFilter(questParsed, 'active', 'quest');\n\n    //  >  >  > \n    const questTypeOrder = type => {\n      const t = String(type || '').toLowerCase();\n      if (t.includes('')) return 0;\n      if (t.includes('')) return 1;\n      if (t.includes('')) return 2;\n      return 3;\n    };\n    let activeTasks = activeQuestParsed\n      .map(q => ({\n        name: q.name || '',\n        type: q.type || '',\n        progress: q.progress || '',\n        _rowIndex: q._rowIndex,\n      }))\n      .sort((a, b) => questTypeOrder(a.type) - questTypeOrder(b.type))\n      .slice(0, 5);\n    // []  - \n    const bagTableName = bagResult?.name || '';\n\n    const bagParsed = DashboardDataParser.parseRows(bagResult, 'bag');\n    let bagItems = bagParsed.slice(0, 6).map(item => ({\n      name: item.name || '',\n      count: item.count || '1',\n      type: item.type || '',\n    }));\n\n    // []  - \n    const skillTableName = skillResult?.name || '';\n\n    const skillParsed = DashboardDataParser.parseRows(skillResult, 'skill');\n    let skills = skillParsed.slice(0, 6).map(s => ({\n      name: s.name || '',\n      level: s.level || '',\n      type: s.type || '',\n    }));\n\n    // []  -  + \n    const equipTableName = equipResult?.name || '';\n\n    const equipParsed = DashboardDataParser.parseRows(equipResult, 'equip');\n    const equippedParsed = DashboardDataParser.applyFilter(equipParsed, 'equipped', 'equip');\n\n    let equippedItems = equippedParsed.slice(0, 4).map(e => ({\n      name: e.name || '',\n      type: e.type || '',\n      part: e.part || '',\n    }));\n    // []  - \n    const locationTableName = locationResult?.name || '';\n    const locationTableKey = locationResult?.key || '';\n\n    const locationParsed = DashboardDataParser.parseRows(locationResult, 'location');\n\n    // HTML\n    let html = `\n        <div class=\"acu-panel-header\">\n            <div class=\"acu-panel-title\">\n                <div class=\"acu-title-main\"><i class=\"fa-solid fa-chart-line\"></i> <span class=\"acu-title-text\"></span></div>\n                <div class=\"acu-title-sub\"></div>\n            </div>\n            <div class=\"acu-header-actions\">\n                <div class=\"acu-height-control\">\n                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                </div>\n                <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n        </div>\n        <div class=\"acu-panel-content acu-dashboard-content\">\n            <div class=\"acu-dash-body ${config.layout === 'horizontal' ? 'acu-dash-horizontal' : ''}\">\n            <!--  +  -->\n                <div class=\"acu-dash-player\">\n                    <h3 class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                        data-table-key=\"${playerResult?.key || ''}\"\n                        data-row-index=\"0\"\n                        data-preview-type=\"player\"\n                        style=\"cursor:pointer;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-user-circle\"></i> ${escapeHtml(replaceUserPlaceholders(player.name))}</span>\n                        <span style=\"font-size:11px;font-weight:normal;color:var(--acu-text-main);background:var(--acu-badge-bg);padding:2px 8px;border-radius:10px;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;\" title=\"${escapeHtml(player.status)}\">${escapeHtml(player.status.length > 6 ? player.status.substring(0, 6) + '..' : player.status)}</span>\n                    </h3>\n                    <div class=\"acu-player-status\" style=\"margin-bottom:8px;\">\n                        ${(() => {\n                          // \n                          const resourcesStr = player.resources || player.money || '';\n                          const parsedResources = parseAttributeString(resourcesStr);\n                          if (parsedResources.length > 0) {\n                            return `<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:52px;overflow-y:auto;margin-bottom:6px;padding-bottom:6px;border-bottom:1px dashed var(--acu-border);\">\n                                    ${parsedResources\n                                      .slice(0, 4)\n                                      .map(\n                                        res => `\n                                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;\">\n                                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(res.name)}\">${escapeHtml(res.name.substring(0, 3))}</span>\n                                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                                <span style=\"color:var(--acu-accent);font-size:11px;font-weight:bold;\">${res.value}</span>\n                                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${res.value}\" data-name=\"${escapeHtml(res.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${res.name}(${res.value})\"></i>\n                                            </div>\n                                        </div>\n                                    `,\n                                      )\n                                      .join('')}\n                                </div>`;\n                          }\n                          return '';\n                        })()}\n        ${(() => {\n          // \n          let allAttrs = [];\n          if (playerRows.length > 0 && playerHeaders.length > 0) {\n            const row = playerRows[0];\n            playerHeaders.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!allAttrs.some(a => a.name === attr.name)) {\n                    allAttrs.push(attr);\n                  }\n                });\n              }\n            });\n          }\n\n          if (allAttrs.length > 0) {\n            // 378px\n            return `<div style=\"display:grid;grid-template-columns:repeat(3,1fr);gap:2px 6px;max-height:78px;overflow-y:auto;overflow-x:hidden;\">\n                    ${allAttrs\n                      .map(\n                        attr => `\n                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;\">\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(attr.name)}\">${escapeHtml(attr.name.substring(0, 2))}</span>\n                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                <span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${attr.value}</span>\n                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${attr.value}\" data-name=\"${escapeHtml(attr.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${attr.name}(${attr.value})\"></i>\n                            </div>\n                        </div>\n                    `,\n                      )\n                      .join('')}\n                </div>`;\n          }\n          return '';\n        })()}\n                    </div>\n\n                    <h4 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(skillTableName)}\" style=\"font-size:12px;color:var(--acu-accent);margin:10px 0 6px 0;\"><i class=\"fa-solid fa-bolt\"></i>  (${skillParsed.length})</h4>\n                    <div style=\"display:grid;grid-template-columns:repeat(2,1fr);gap:2px 6px;max-height:78px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      skills.length > 0\n                        ? skills\n                            .map((skill, idx) => {\n                              const skillValue = extractNumericValue(skill.level);\n                              const hasNumeric = skillValue > 0;\n                              const skillRowIndex = skillParsed.findIndex(s => s.name === skill.name);\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${skillResult?.key || ''}\"\n                            data-row-index=\"${skillRowIndex >= 0 ? skillRowIndex : idx}\"\n                            data-preview-type=\"skill\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;cursor:pointer;\">\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(skill.name)}\">${escapeHtml(skill.name.length > 5 ? skill.name.substring(0, 5) + '..' : skill.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                ${\n                                  hasNumeric\n                                    ? `<span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${skillValue}</span>\n                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${skillValue}\" data-name=\"${escapeHtml(skill.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${skill.name}(${skillValue})\"></i>`\n                                    : `<span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(skill.level || '-')}</span>`\n                                }\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div style=\"grid-column:1/-1;text-align:center;color:var(--acu-text-sub);padding:8px;font-size:11px;\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  + NPC -->\n                <div class=\"acu-dash-locations\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(locationTableName)}\"><i class=\"fa-solid fa-map\"></i>  (${locationParsed.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:100px;overflow-y:auto;overflow-x:hidden;margin-bottom:10px;\">\n                    ${\n                      locationParsed.length > 0\n                        ? locationParsed\n                            .map((loc, idx) => {\n                              const areaName = loc.name || '';\n                              const isCurrent =\n                                currentPlaceName &&\n                                (areaName.includes(currentPlaceName) || currentPlaceName.includes(areaName));\n                              return `<div class=\"acu-location-item acu-dash-clickable acu-dash-preview-trigger ${isCurrent ? 'acu-current-location' : ''}\"\n                            data-table-key=\"${escapeHtml(locationTableKey)}\"\n                            data-row-index=\"${loc._rowIndex}\"\n                            data-preview-type=\"location\">\n                            <span>\n                                ${isCurrent ? '<i class=\"fa-solid fa-location-dot\"></i>' : '<i class=\"fa-solid fa-map-pin\" style=\"font-size:9px;opacity:0.4;\"></i>'}\n                                <span title=\"${escapeHtml(areaName)}\">${escapeHtml(areaName)}</span>\n                            </span>\n                            ${!isCurrent ? `<i class=\"fa-solid fa-walking acu-dash-goto-btn\" data-location=\"${escapeHtml(areaName)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;flex-shrink:0;\" title=\"${areaName}\"></i>` : '<i class=\"fa-solid fa-street-view\" style=\"flex-shrink:0;\" title=\"\"></i>'}\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(npcTableName)}\" style=\"margin-top:10px;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-users\"></i>  (${allNPCs.length})</span>\n                        <span style=\"display:flex;gap:8px;\">\n                            <i class=\"fa-solid fa-project-diagram acu-dash-relation-graph-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                            <i class=\"fa-solid fa-user-circle acu-dash-avatar-manager-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                        </span>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:150px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      allNPCs.length > 0\n                        ? allNPCs\n                            .slice(0, 12)\n                            .map((npc, npcIdx) => {\n                              const isInScene = inSceneNPCs.some(n => n.name === npc.name);\n                              const isLastNpc = npcIdx === Math.min(allNPCs.length, 12) - 1;\n                              const npcAvatar = AvatarManager.get(npc.name);\n                              const avatarOffsetX = AvatarManager.getOffsetX(npc.name);\n                              const avatarOffsetY = AvatarManager.getOffsetY(npc.name);\n                              const avatarScale = AvatarManager.getScale(npc.name);\n                              const avatarStyle = npcAvatar\n                                ? `background-image:url('${npcAvatar}');background-size:${avatarScale}%;background-position:${avatarOffsetX}% ${avatarOffsetY}%;`\n                                : '';\n                              const offSceneFilter = isInScene\n                                ? ''\n                                : 'filter:grayscale(80%) brightness(0.7);opacity:0.5;';\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${escapeHtml(npcTableKey)}\"\n                            data-row-index=\"${npc.index}\"\n                            data-preview-type=\"npc\"\n                            style=\"padding:6px 4px;${!isLastNpc ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <span class=\"acu-task-name\" style=\"font-size:12px;display:flex;align-items:center;gap:6px;\">\n                                    <span class=\"acu-dash-npc-avatar\" style=\"width:22px;height:22px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border:1.5px solid ${isInScene ? 'var(--acu-accent)' : 'var(--acu-border)'};${avatarStyle}${offSceneFilter}\" title=\"${isInScene ? '' : ''}\">\n                                        ${!npcAvatar ? `<span style=\"font-size:10px;font-weight:bold;color:var(--acu-text-sub);${offSceneFilter}\">${escapeHtml(npc.name.charAt(0))}</span>` : ''}\n                                    </span>\n                                    <span title=\"${escapeHtml(npc.name)}\" style=\"${isInScene ? '' : 'opacity:0.6;'}\">${escapeHtml(npc.name.length > 4 ? npc.name.substring(0, 4) + '..' : npc.name)}</span>\n                                </span>\n                                <div style=\"display:flex;align-items:center;\">\n                                    <i class=\"fa-solid fa-people-arrows acu-dash-contest-btn\" data-npc=\"${escapeHtml(npc.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:11px;\" title=\"${npc.name}\"></i>\n                                </div>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  +  +  -->\n                <div class=\"acu-dash-intel\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(bagTableName)}\"><i class=\"fa-solid fa-bag-shopping\"></i>  (${bagParsed.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      bagItems.length > 0\n                        ? bagItems\n                            .map((item, idx) => {\n                              const isLastBag = idx === bagItems.length - 1;\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${bagResult?.key || ''}\"\n                            data-row-index=\"${idx}\"\n                            data-preview-type=\"bag\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLastBag ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);flex:1;white-space:nowrap;\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name.length > 4 ? item.name.substring(0, 4) + '..' : item.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:6px;\">\n                                <i class=\"fa-solid fa-hand-pointer acu-dash-use-item-btn\" data-item=\"${escapeHtml(item.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${item.name}\"></i>\n                                <span style=\"color:var(--acu-accent);font-weight:bold;\">${escapeHtml(item.count)}</span>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(equipTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-shield-halved\"></i>  (${equippedItems.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      equippedItems.length > 0\n                        ? equippedItems\n                            .map((item, idx) => {\n                              const isLast = idx === equippedItems.length - 1;\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${equipResult?.key || ''}\"\n                            data-row-index=\"${equipParsed.findIndex(r => r.name === item.name)}\"\n                            data-preview-type=\"equipment\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLast ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name.length > 5 ? item.name.substring(0, 5) + '..' : item.name)}</span>\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(item.part || item.type)}</span>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(questTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-clipboard-list\"></i>  (${activeTasks.length})</h3>\n                    ${\n                      activeTasks.length > 0\n                        ? activeTasks\n                            .map((t, idx) => {\n                              const isMain = String(t.type || '').includes('');\n                              // \n                              let progressPercent = null;\n                              const progressMatch = String(t.progress || '').match(/(\\d+)\\s*%/);\n                              if (progressMatch) {\n                                progressPercent = Math.min(100, Math.max(0, parseInt(progressMatch[1], 10)));\n                              }\n                              const progressBar =\n                                progressPercent !== null\n                                  ? `<div style=\"width:40px;height:4px;background:var(--acu-border);border-radius:2px;overflow:hidden;\"><div style=\"width:${progressPercent}%;height:100%;background:var(--acu-accent);\"></div></div>`\n                                  : '';\n                              return `<div class=\"acu-task-item acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${questResult?.key || ''}\"\n                            data-row-index=\"${t._rowIndex !== undefined ? t._rowIndex : questParsed.findIndex(q => q.name === t.name)}\"\n                            data-preview-type=\"quest\"\n                            style=\"padding:4px 8px;margin-bottom:3px;cursor:pointer;\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <div class=\"acu-task-name\" style=\"font-size:11px;${isMain ? 'font-weight:600;' : ''}\">${escapeHtml(t.name)}</div>\n                                ${progressBar}\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                </div>\n            </div>\n    `;\n\n    // \n    const loadedModules = [\n      globalResult ? '' : null,\n      playerResult ? '' : null,\n      locationResult ? '' : null,\n      npcResult ? 'NPC' : null,\n      questResult ? '' : null,\n      bagResult ? '' : null,\n      skillResult ? '' : null,\n      equipResult ? '' : null,\n    ].filter(Boolean);\n\n    console.info(`[DICE]${loadedModules.length}: ${loadedModules.join(', ')}`);\n    return html;\n  };\n\n  const renderTableContent = (tableData, tableName) => {\n    if (!tableData || !tableData.rows.length)\n      return `\n            <div class=\"acu-panel-header\"><div class=\"acu-panel-title\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${tableName}</div><button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button></div>\n            <div class=\"acu-panel-content\"><div style=\"text-align:center;color:var(--acu-text-sub);padding:20px;\"></div></div>`;\n\n    const config = getConfig();\n    const pendingDeletions = getPendingDeletions()[tableData.key] || [];\n    const headers = (tableData.headers || []).slice(1);\n\n    //  ( list)\n    const currentStyle = (getTableStyles() || {})[tableName] || 'list';\n    const isGridMode = currentStyle === 'grid';\n\n    let titleColIndex = 1;\n    if (tableData.headers.length === 1) {\n      titleColIndex = 0;\n    } else if (tableName.includes('') || tableName.includes('')) {\n      const idx = tableData.headers.findIndex(\n        h => h && (h.includes('') || h.includes('') || h.includes('')),\n      );\n      if (idx > 0) titleColIndex = idx;\n    }\n\n    // ---  ---\n    let processedRows = tableData.rows.map((row, index) => {\n      const rowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n      const isBookmarked = rowKey && BookmarkManager.isBookmarked(tableName, rowKey);\n      return { data: row, originalIndex: index, rowKey, isBookmarked };\n    });\n    const searchTerm = (tableSearchStates[tableName] || '').toLowerCase().trim();\n\n    // \n    const isReversed = isTableReversed(tableName);\n\n    if (searchTerm) {\n      processedRows = processedRows.filter(item =>\n        item.data.some(cell => String(cell).toLowerCase().includes(searchTerm)),\n      );\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        const titleA = String(a.data[titleColIndex] || '').toLowerCase();\n        const titleB = String(b.data[titleColIndex] || '').toLowerCase();\n        const aHitTitle = titleA.includes(searchTerm);\n        const bHitTitle = titleB.includes(searchTerm);\n        if (titleA === searchTerm && titleB !== searchTerm) return -1;\n        if (titleA !== searchTerm && titleB === searchTerm) return 1;\n        if (aHitTitle && !bHitTitle) return -1;\n        if (!aHitTitle && bHitTitle) return 1;\n        return a.originalIndex - b.originalIndex;\n      });\n    } else {\n      // \n      // bookmark\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        if (isReversed) {\n          return b.originalIndex - a.originalIndex;\n        } else {\n          return a.originalIndex - b.originalIndex;\n        }\n      });\n    }\n\n    const itemsPerPage = config.itemsPerPage || 50;\n    const totalItems = processedRows.length;\n    const totalPages = Math.ceil(totalItems / itemsPerPage) || 1;\n    let currentPage = tablePageStates[tableName] || 1;\n    if (currentPage > totalPages) currentPage = totalPages;\n    if (currentPage < 1) currentPage = 1;\n    tablePageStates[tableName] = currentPage;\n\n    const startIdx = (currentPage - 1) * itemsPerPage;\n    const endIdx = startIdx + itemsPerPage;\n    const rowsToRender = processedRows.slice(startIdx, endIdx);\n    // []    \n    // \n    const showReverseBtn = shouldShowReverseButton(tableName);\n    const reverseBtnHtml = showReverseBtn\n      ? `\n            <button class=\"acu-view-btn acu-reverse-btn\" data-table=\"${escapeHtml(tableName)}\" title=\"${isReversed ? '' : ''}\">\n                <i class=\"fa-solid ${isReversed ? 'fa-sort-amount-up' : 'fa-sort-amount-down'}\"></i>\n            </button>\n        `\n      : '';\n\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n    <div class=\"acu-title-main\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> <span class=\"acu-title-text\">${escapeHtml(tableName)}</span></div>\n    <div class=\"acu-title-sub\">(${startIdx + 1}-${Math.min(endIdx, totalItems)} / ${totalItems})${isReversed ? ' <span style=\"color:var(--acu-accent);\"></span>' : ''}</div>\n</div>\n                <div class=\"acu-header-actions\">\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn\" id=\"acu-btn-relation-graph\" data-table=\"${escapeHtml(tableName)}\" title=\"\"><i class=\"fa-solid fa-project-diagram\"></i></button>` : ''}\n                    ${reverseBtnHtml}\n                    <button class=\"acu-view-btn\" id=\"acu-btn-switch-style\" data-table=\"${escapeHtml(tableName)}\" title=\"  (: ${isGridMode ? '' : ''})\">\n                        <i class=\"fa-solid ${isGridMode ? 'fa-th-large' : 'fa-list'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${escapeHtml(tableName)}\" title=\"  | \"></i>\n                    </div>\n\n                    <div class=\"acu-search-wrapper\"><i class=\"fa-solid fa-search acu-search-icon\"></i><input type=\"text\" class=\"acu-search-input\" placeholder=\"...\" value=\"${(tableSearchStates[tableName] || '').replace(/\"/g, '&quot;')}\" /></div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>\n            <div class=\"acu-panel-content\"><div class=\"acu-card-grid\">`;\n\n    html += rowsToRender\n      .map(item => {\n        const realRowIdx = item.originalIndex;\n        const row = item.data;\n        const isPending = pendingDeletions.includes(realRowIdx);\n        const cardTitle = row[titleColIndex] || '';\n        const showDefaultIndex = titleColIndex === 1;\n        const titleCellId = `${tableData.key}-${realRowIdx}-${titleColIndex}`;\n        const isTitleModified = window.acuModifiedSet && window.acuModifiedSet.has(titleCellId);\n        const isRowNew = currentDiffMap.has(`${tableName}-row-${realRowIdx}`);\n        let rowClass = '';\n        if (config.highlightNew) {\n          if (isTitleModified) rowClass = 'acu-highlight-manual';\n          else if (isRowNew) rowClass = 'acu-highlight-diff';\n        }\n\n        // \n        const validColIndices = row.map((_, i) => i).filter(i => i > 0 && i !== titleColIndex);\n        const isOddValidCount = validColIndices.length % 2 === 1;\n\n        const cardBody = row\n          .map((cell, cIdx) => {\n            if (cIdx <= 0 || cIdx === titleColIndex) return '';\n            // [] \"\"\n            const currentHeader = headers[cIdx - 1] || '';\n            if (currentHeader.includes('')) return '';\n            const isLastValidCol = cIdx === validColIndices[validColIndices.length - 1];\n            const spanFullRow = isLastValidCol && isOddValidCount;\n            // /\n            const rawHeaderName = headers[cIdx - 1] || '' + cIdx;\n            const headerName = rawHeaderName.replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n            const safeStr = str =>\n              String(str)\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#039;');\n            const rawStrOriginal = String(cell).trim();\n            const rawStr = replaceUserPlaceholders(rawStrOriginal);\n            const invalidPlaceholders = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n            if (invalidPlaceholders.includes(rawStr.toLowerCase())) {\n              return ''; // \n            }\n\n            let contentHtml = '';\n            let hideLabel = false; // \n            const splitRegex = /[;]/;\n\n            // [] \n            const isIdentityField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return lowerHeader.includes('');\n            };\n\n            const isAttributeField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return (\n                lowerHeader.includes('') || lowerHeader.includes('') || lowerHeader.includes('')\n              );\n            };\n\n            //  ( \":92\"  \":92, :88\")\n            // [] \n            const parsedAttrs = isIdentityField(rawHeaderName) ? [] : parseAttributeString(rawStr);\n            // [] \n            if (isIdentityField(rawHeaderName)) {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            } else if (isRelationshipCell(rawStr, headerName)) {\n              // [] \n              const relations = parseRelationshipString(rawStr);\n              // [] \n              const validRelations = relations.filter(rel => {\n                if (!rel.relation) return true; // \n                return !invalidPlaceholders.includes(rel.relation.toLowerCase());\n              });\n\n              if (validRelations.length > 1) {\n                hideLabel = true;\n                let relHtml = '';\n                for (let i = 0; i < validRelations.length; i++) {\n                  const rel = validRelations[i];\n                  const borderStyle =\n                    i < validRelations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                  relHtml += '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;' + borderStyle + '\">';\n                  relHtml +=\n                    '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' + safeStr(rel.name) + '</span>';\n                  if (rel.relation) {\n                    relHtml +=\n                      '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                      safeStr(rel.relation) +\n                      '</span>';\n                  }\n                  relHtml += '</div>';\n                }\n                contentHtml = '<div class=\"acu-relation-container\">' + relHtml + '</div>';\n              } else if (validRelations.length === 1) {\n                hideLabel = true;\n                const rel = validRelations[0];\n                contentHtml = '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;\">';\n                contentHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' + safeStr(rel.name) + '</span>';\n                if (rel.relation) {\n                  contentHtml +=\n                    '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                    safeStr(rel.relation) +\n                    '</span>';\n                }\n                contentHtml += '</div>';\n              }\n            } else if (parsedAttrs.length > 1) {\n              // 2\n              hideLabel = true;\n              let attrsHtml = '';\n              for (let i = 0; i < parsedAttrs.length; i++) {\n                const attr = parsedAttrs[i];\n                const showDice = !BlacklistManager.isBlacklisted(attr.name);\n                attrsHtml +=\n                  '<div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 0;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.9em;white-space:nowrap;\" title=\"' +\n                  safeStr(attr.name) +\n                  '\">' +\n                  safeStr(attr.name.length > 3 ? attr.name.substring(0, 5) : attr.name) +\n                  '</span>';\n                attrsHtml += '<div style=\"display:flex;align-items:center;gap:4px;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-main);font-weight:bold;font-size:0.95em;\">' +\n                  attr.value +\n                  '</span>';\n                if (showDice) {\n                  attrsHtml +=\n                    '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                    safeStr(attr.name) +\n                    '\" data-attr-value=\"' +\n                    attr.value +\n                    '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:10px;\" title=\"\"></i>';\n                }\n                attrsHtml += '</div></div>';\n              }\n              contentHtml = '<div class=\"acu-multi-attr-container\">' + attrsHtml + '</div>';\n            } else if (parsedAttrs.length === 1) {\n              //  ( \":92\") - \n              hideLabel = true;\n              const attr = parsedAttrs[0];\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml +=\n                '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' + safeStr(attr.name) + '</span>';\n              contentHtml += '<div style=\"display:flex;align-items:center;gap:6px;\">';\n              contentHtml += '<span style=\"color:var(--acu-text-main);font-weight:bold;\">' + attr.value + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(attr.name) +\n                  '\" data-attr-value=\"' +\n                  attr.value +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div></div>';\n            } else if (rawStr.length > 0 && splitRegex.test(rawStr) && !rawStr.includes('http')) {\n              // [] \n              const invalidTagValues = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n              const parts = rawStr\n                .split(splitRegex)\n                .map(s => s.trim())\n                .filter(s => s && !invalidTagValues.includes(s.toLowerCase()));\n              const allShort = parts.length > 1 && parts.every(p => p.length <= 6);\n              if (allShort) {\n                const tagsHtml = parts\n                  .map(part => {\n                    const subStyle = getBadgeStyle(part) || 'acu-badge-neutral';\n                    return '<span class=\"acu-badge ' + subStyle + '\">' + safeStr(part) + '</span>';\n                  })\n                  .join('');\n                contentHtml = '<div class=\"acu-tag-container\">' + tagsHtml + '</div>';\n              } else if (parts.length > 0) {\n                // \n                contentHtml = safeStr(parts.join('; '));\n              } else {\n                // \n                contentHtml = '';\n              }\n            } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n              // \n              const numVal = extractNumericValue(rawStr);\n              const showDice = !BlacklistManager.isBlacklisted(headerName);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml += '<span>' + safeStr(rawStr) + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(headerName) +\n                  '\" data-attr-value=\"' +\n                  numVal +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div>';\n            } else {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            }\n\n            const isDiffChanged = currentDiffMap.has(tableName + '-' + realRowIdx + '-' + cIdx);\n            const cellId = tableData.key + '-' + realRowIdx + '-' + cIdx;\n            const isUserModified = window.acuModifiedSet && window.acuModifiedSet.has(cellId);\n            let cellHighlight = '';\n            if (config.highlightNew) {\n              if (isUserModified) cellHighlight = 'acu-highlight-manual';\n              else if (isDiffChanged) cellHighlight = 'acu-highlight-diff';\n            }\n\n            //  class\n            // \n            const lockRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n            const isThisFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, headers[cIdx - 1]);\n            const lockIcon = isThisFieldLocked\n              ? '<i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:10px;margin-left:4px;opacity:0.7;\" title=\"\"></i>'\n              : '';\n\n            const rowClass =\n              'acu-card-row acu-cell' +\n              (spanFullRow ? ' acu-grid-span-full' : '') +\n              (hideLabel ? ' acu-hide-label' : '');\n\n            return (\n              '<div class=\"' +\n              rowClass +\n              '\" data-key=\"' +\n              escapeHtml(tableData.key) +\n              '\" data-tname=\"' +\n              escapeHtml(tableName) +\n              '\" data-row=\"' +\n              realRowIdx +\n              '\" data-col=\"' +\n              cIdx +\n              '\" data-val=\"' +\n              encodeURIComponent(cell ?? '') +\n              '\"><div class=\"acu-card-label\">' +\n              headerName +\n              lockIcon +\n              '</div><div class=\"acu-card-value ' +\n              cellHighlight +\n              '\">' +\n              contentHtml +\n              '</div></div>'\n            );\n          })\n          .join('');\n\n        // []  acu-card-body  view-grid  view-list \n        // [] HTML\n        let tableActions = getActionsForTable(tableName);\n        let actionsHtml = '';\n\n        // [] \"\"\n        const interactColIdx = headers.findIndex(h => h && h.includes(''));\n        if (interactColIdx >= 0 && row[interactColIdx + 1]) {\n          // -nullnoneN/A \n          const invalidValues = ['-', 'null', 'none', '', '', 'n/a', 'undefined', '/'];\n          const interactOptions = String(row[interactColIdx + 1])\n            .split(/[,;]/)\n            .map(s => s.trim())\n            .filter(s => s && !invalidValues.includes(s.toLowerCase()));\n          if (interactOptions.length > 0) {\n            // \n            const existingLabels = tableActions.map(a => a.label.toLowerCase());\n            // \n            const iconMap = {\n              : 'fa-hand-fist',\n              : 'fa-hand-fist',\n              : 'fa-comments',\n              : 'fa-comments',\n              : 'fa-eye',\n              : 'fa-eye',\n              : 'fa-hand-pointer',\n              : 'fa-gift',\n              : 'fa-gift',\n              : 'fa-trash',\n              : 'fa-shield-halved',\n              : 'fa-calendar-check',\n              : 'fa-hand',\n              : 'fa-heart',\n              : 'fa-music',\n            };\n            // \n            const newActions = interactOptions\n              .filter(opt => !existingLabels.includes(opt.toLowerCase()))\n              .map(opt => ({\n                label: opt,\n                icon: iconMap[opt] || 'fa-hand-pointer',\n                type: 'prompt',\n                template: `<user>${opt}{Name}`,\n                auto_send: true,\n              }));\n            //  + \n            tableActions = [...tableActions, ...newActions];\n          }\n        }\n\n        if (tableActions.length > 0) {\n          const cardTitle = row[titleColIndex] || '';\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardLockRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n        const isCardRowLocked = cardLockRowKey && LockManager.isRowLocked(tableName, cardLockRowKey);\n        const cardLockIcon = isCardRowLocked\n          ? ' <i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:11px;opacity:0.8;\" title=\"\"></i>'\n          : '';\n\n        // bookmark\n        const cardBookmarkRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n        const isBookmarked = cardBookmarkRowKey && BookmarkManager.isBookmarked(tableName, cardBookmarkRowKey);\n        const bookmarkIcon = cardBookmarkRowKey\n          ? `<i class=\"${isBookmarked ? 'fa-solid' : 'fa-regular'} fa-bookmark acu-bookmark-icon ${isBookmarked ? 'bookmarked' : ''}\" data-table=\"${escapeHtml(tableName)}\" data-row-key=\"${escapeHtml(cardBookmarkRowKey)}\" title=\"${isBookmarked ? '' : ''}\"></i>`\n          : '';\n\n        return `<div class=\"acu-data-card ${isPending ? 'pending-deletion' : ''}\"><div class=\"acu-card-header\"><span class=\"acu-card-index\">${showDefaultIndex ? '#' + (realRowIdx + 1) : ''}</span><span class=\"acu-cell acu-editable-title ${rowClass}\" data-key=\"${escapeHtml(tableData.key)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(cardTitle ?? '')}\" title=\"\">${escapeHtml(cardTitle)}${cardLockIcon}</span>${bookmarkIcon}</div><div class=\"acu-card-body ${isGridMode ? 'view-grid' : 'view-list'}\">${cardBody}</div>${actionsHtml}</div>`;\n      })\n      .join('');\n    html += `</div></div>`;\n\n    if (totalPages > 1) {\n      html += `<div class=\"acu-panel-footer\"><button class=\"acu-page-btn ${currentPage === 1 ? 'disabled' : ''}\" data-page=\"${currentPage - 1}\" ${currentPage === 1 ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-left\"></i></button>`;\n      const range = [];\n      if (totalPages <= 7) {\n        for (let i = 1; i <= totalPages; i++) range.push(i);\n      } else {\n        if (currentPage <= 4) range.push(1, 2, 3, 4, 5, '...', totalPages);\n        else if (currentPage >= totalPages - 3)\n          range.push(1, '...', totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1, totalPages);\n        else range.push(1, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages);\n      }\n      range.forEach(p => {\n        if (p === '...') html += `<span class=\"acu-page-info\">...</span>`;\n        else html += `<button class=\"acu-page-btn ${p === currentPage ? 'active' : ''}\" data-page=\"${p}\">${p}</button>`;\n      });\n      html += `<button class=\"acu-page-btn ${currentPage === totalPages ? 'disabled' : ''}\" data-page=\"${currentPage + 1}\" ${currentPage === totalPages ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-right\"></i></button></div>`;\n    }\n    return html;\n  };\n\n  // []  ( + )\n  const saveCurrentTabState = () => {\n    const { $ } = getCore();\n    const activeTab = getActiveTabState();\n    const $content = $('.acu-panel-content');\n\n    if (activeTab && $content.length) {\n      const innerScrolls = {};\n      // \n      $content.find('.acu-data-card, .acu-card-body, .acu-edit-textarea').each(function () {\n        if (this.scrollTop > 0) {\n          //  (Row Index)\n          const $card = $(this).closest('.acu-data-card');\n          const rIdx = $card.find('.acu-editable-title').data('row');\n          // \n          const isEdit = $(this).hasClass('acu-edit-textarea');\n\n          if (rIdx !== undefined) {\n            const key = isEdit ? `edit-${rIdx}` : rIdx;\n            innerScrolls[key] = this.scrollTop;\n          }\n        }\n      });\n\n      // \n      tableScrollStates[activeTab] = {\n        left: $content.scrollLeft(),\n        top: $content.scrollTop(),\n        inner: innerScrolls,\n        timestamp: Date.now(), // \n      };\n    }\n  };\n\n  const closePanel = () => {\n    const { $ } = getCore();\n    saveCurrentTabState(); // <--- \n\n    $('#acu-data-area').removeClass('visible');\n    $('.acu-nav-btn').removeClass('active');\n    saveActiveTabState(null);\n    // [] \n    // $('.acu-embedded-options-container').remove();\n  };\n\n  const bindEvents = tables => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    // [] -\n    $wrapper.on('click', '.acu-dash-relation-graph-btn', function (e) {\n      e.stopPropagation();\n      const allTables = processJsonData(cachedRawData || getTableData());\n      const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n      if (npcResult && npcResult.data) {\n        showRelationshipGraph(npcResult.data);\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-avatar-manager-btn', function (e) {\n      e.stopPropagation();\n      const allTables = processJsonData(cachedRawData || getTableData());\n      const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n      const playerResult = DashboardDataParser.findTable(allTables, 'player');\n      const nodeArr = [];\n      // \n      if (playerResult?.data?.rows?.[0]) {\n        nodeArr.push({ name: playerResult.data.rows[0][1] || '', isPlayer: true });\n      }\n      // NPC\n      if (npcResult?.data?.rows) {\n        npcResult.data.rows.forEach((row, idx) => {\n          if (row[1]) nodeArr.push({ name: row[1], isPlayer: false, rowIndex: idx });\n        });\n      }\n      if (nodeArr.length > 0) {\n        showAvatarManager(nodeArr, () => renderInterface());\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n    });\n    // \n    $wrapper.on('click', '.acu-dash-table-link', function (e) {\n      e.stopPropagation();\n      const tableName = $(this).data('table');\n      if (tableName) {\n        Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        saveActiveTabState(tableName);\n        renderInterface();\n      }\n    });\n\n    // []  SillyTavern\"\"\n    $('.acu-panel-content')\n      .off('touchstart.acu_swipe touchmove.acu_swipe')\n      .on('touchstart.acu_swipe', function (e) {\n        this._touchStartX = e.originalEvent.touches[0].clientX;\n        this._touchStartY = e.originalEvent.touches[0].clientY;\n      })\n      .on('touchmove.acu_swipe', function (e) {\n        if (!this._touchStartX) return;\n        const deltaX = Math.abs(e.originalEvent.touches[0].clientX - this._touchStartX);\n        const deltaY = Math.abs(e.originalEvent.touches[0].clientY - this._touchStartY);\n        // 45\n        if (deltaX > deltaY && deltaX > 10) {\n          e.stopPropagation();\n        }\n      });\n\n    $('body')\n      .off('click.acu_nav_toggle')\n      .on('click.acu_nav_toggle', '.acu-nav-toggle-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        const currentState = getCollapsedState();\n        saveCollapsedState(!currentState);\n        renderInterface();\n      });\n\n    const $panel = $('.acu-panel-content');\n    if ($panel.length) {\n      // [] \n      let scrollTimer = null;\n      $panel.off('scroll.acu_save').on('scroll.acu_save', function () {\n        const $this = $(this);\n        if (scrollTimer) clearTimeout(scrollTimer);\n        scrollTimer = setTimeout(() => {\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            if (!tableScrollStates[activeTab]) tableScrollStates[activeTab] = { top: 0, left: 0, inner: {} };\n            tableScrollStates[activeTab].top = $this.scrollTop();\n            tableScrollStates[activeTab].left = $this.scrollLeft();\n            // \n          }\n        }, 200);\n      });\n    }\n\n    $('body')\n      .off('click.acu_delegate')\n      .on('click.acu_delegate', '.acu-wrapper', function (e) {\n        if (isEditingOrder) return;\n        const $target = $(e.target);\n\n        // []  - \n        const $settingsBtn = $target.closest('#acu-btn-settings');\n        if ($settingsBtn.length) {\n          e.stopPropagation();\n          e.preventDefault();\n          showSettingsModal();\n          return;\n        }\n\n        const $navBtn = $target.closest('.acu-nav-btn');\n        if ($navBtn.length) {\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-dashboard') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isDashboardActive && isPanelVisible) {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, true);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n              // \n              const rawData = cachedRawData || getTableData();\n              const tables = processJsonData(rawData || {});\n              $('#acu-data-area').html(renderDashboard(tables)).addClass('visible');\n              // \n              bindEvents(tables);\n            }\n            return false;\n          }\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-changes') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isChangesActive = Store.get('acu_changes_panel_active', false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isChangesActive && isPanelVisible) {\n              // \n              Store.set('acu_changes_panel_active', false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set('acu_changes_panel_active', true);\n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n              // \n              const rawData = cachedRawData || getTableData();\n              $('#acu-data-area').html(renderChangesPanel(rawData)).addClass('visible');\n              // \n              bindChangesEvents();\n            }\n            return false;\n          }\n          // [] MVU\n          if ($navBtn.attr('id') === 'acu-btn-mvu') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isMvuActive && isPanelVisible) {\n              // \n              saveActiveTabState(null);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              //  isAvailable\n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              Store.set('acu_changes_panel_active', false);\n              saveActiveTabState(MvuModule.MODULE_ID);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              // \n              const $panel = $('#acu-data-area');\n              try {\n                const panelHtml = MvuModule.renderPanel();\n                // \n                const mvuSavedHeight = getTableHeights()[MvuModule.MODULE_ID];\n                if (mvuSavedHeight) {\n                  $panel.css('height', mvuSavedHeight + 'px').addClass('acu-manual-mode');\n                } else {\n                  $panel.css('height', '').removeClass('acu-manual-mode');\n                }\n                $panel.html('<div class=\"acu-mvu-panel\">' + panelHtml + '</div>').addClass('visible');\n                MvuModule.bindEvents($panel);\n              } catch (error) {\n                console.error('[MVU] Error rendering panel:', error);\n              }\n\n              // \n              // \n              MvuModule.getDataWithRetry(5, 800)\n                .then(mvuData => {\n                  // \n                  if (mvuData) {\n                    $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                    MvuModule.bindEvents($panel);\n                  }\n                })\n                .catch(err => {\n                  console.error('[DICE]MvuModule Error getting data:', err);\n                  // \n                  $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                  MvuModule.bindEvents($panel);\n                });\n            }\n            return false;\n          }\n          e.stopPropagation();\n          // [] \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          Store.set('acu_changes_panel_active', false);\n          const tableName = $navBtn.data('table');\n          const currentActiveTab = getActiveTabState();\n          if (currentActiveTab === tableName && $('#acu-data-area').hasClass('visible')) {\n            closePanel();\n            return;\n          }\n          $('.acu-nav-btn').removeClass('active');\n          $navBtn.addClass('active');\n          if ($('.acu-panel-content').length && currentActiveTab) {\n            saveCurrentTabState();\n          }\n          saveActiveTabState(tableName);\n          setTimeout(() => renderInterface(), 0);\n          return;\n        }\n        const $cell = $target.closest('.acu-cell');\n        if ($cell.length) {\n          e.stopPropagation();\n          showCellMenu(e, $cell[0]);\n          return;\n        }\n        const $pageBtn = $target.closest('.acu-page-btn');\n        if ($pageBtn.length) {\n          e.stopPropagation();\n          if ($pageBtn.hasClass('disabled') || $pageBtn.hasClass('active')) return;\n          const newPage = parseInt($pageBtn.data('page'));\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tablePageStates[activeTab] = newPage;\n            renderInterface();\n            requestAnimationFrame(() => {\n              $('.acu-panel-content').scrollTop(0);\n            });\n          }\n          return;\n        }\n        return;\n      });\n\n    $('#acu-btn-expand')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(false);\n        renderInterface();\n      });\n    // [] \n    $('#acu-btn-collapse')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(true);\n        renderInterface();\n      });\n\n    // []  =  (Instant Revert)\n    $('#acu-btn-refresh')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n\n        // [] \n        if (isEditingOrder) return;\n\n        // 1. \n        if (isSaving) {\n          if (window.toastr) window.toastr.warning(' ...');\n          return;\n        }\n\n        const $btn = $(e.currentTarget);\n        const $icon = $btn.find('i');\n        // $icon.addClass('fa-spin'); // \n\n        // 2.  ()\n        // (1) \n        savePendingDeletions({});\n\n        // (2)  -> \n        cachedRawData = null;\n\n        // (3) \n        hasUnsavedChanges = false;\n        currentDiffMap.clear();\n        if (window.acuModifiedSet) window.acuModifiedSet.clear();\n\n        // (4)  ()\n        const $saveBtn = $('#acu-btn-save-global');\n        $saveBtn.find('i').removeClass('acu-icon-breathe');\n        $saveBtn.attr('title', '').css('color', '');\n\n        // 3.  300ms \n        // await new Promise(r => setTimeout(r, 300)); // <--- \n\n        // Last SnapshotAPI\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          cachedRawData = snapshot; // \n        }\n\n        // 4. \n        // \n        $('.acu-edit-overlay, .acu-cell-menu, .acu-menu-backdrop').remove();\n\n        // \n        renderInterface();\n\n        // $icon.removeClass('fa-spin');\n      });\n\n    // [] \n    $('#acu-btn-force-update')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          if (window.toastr) {\n            window.toastr.warning('  manualUpdate ', '', {\n              timeOut: 5000,\n            });\n          }\n        }\n      });\n    $('body')\n      .off('click.acu_settings')\n      .on('click.acu_settings', '#acu-btn-settings', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        showSettingsModal();\n      });\n    // [] \n    $('#acu-btn-dice-nav')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        showDicePanel({\n          targetValue: null,\n          targetName: '',\n          //  diceType\n        });\n      });\n\n    /* // \n    $('#acu-btn-open-editor').off('click').on('click', (e) => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.openVisualizer === 'function') {\n            api.openVisualizer();\n        } else if (window.toastr) {\n            window.toastr.warning('()');\n        }\n    });\n    */\n\n    // \n    $('#acu-btn-refill')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            console.log('[DICE]ACU ');\n            //  manualUpdate \n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          console.warn('[DICE]ACU manualUpdate API ');\n          if (window.toastr) {\n            window.toastr.warning(' manualUpdate ', '', { timeOut: 3000 });\n          }\n        }\n      });\n    $('#acu-btn-save-global')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        let dataToSave = null;\n        if (hasUnsavedChanges && cachedRawData) {\n          dataToSave = cachedRawData;\n        } else {\n          dataToSave = getTableData();\n        }\n\n        if (dataToSave) {\n          // 1.  false  true\n          await saveDataToDatabase(dataToSave, true, true);\n\n          // 2. \n          // \n          $('.acu-highlight-manual').removeClass('acu-highlight-manual');\n\n          // 3. \n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          hasUnsavedChanges = false;\n\n          // 4. \n          const $btn = $(this);\n          const $icon = $btn.find('i');\n          $icon.removeClass('acu-icon-breathe fa-spinner fa-spin').addClass('fa-save');\n          $btn.attr('title', '').css('color', '');\n          $btn.prop('disabled', false);\n\n          // 5. \n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    const $searchInput = $('.acu-search-input');\n    if ($searchInput.length) {\n      let searchTimeout;\n      let isComposing = false;\n      $searchInput\n        .off('compositionstart compositionend input')\n        .on('compositionstart', () => {\n          isComposing = true;\n        })\n        .on('compositionend', function () {\n          isComposing = false;\n          const val = $(this).val();\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tableSearchStates[activeTab] = val;\n            tablePageStates[activeTab] = 1;\n            renderInterface();\n            setTimeout(() => {\n              $('.acu-search-input').focus();\n            }, 0);\n          }\n        })\n        .on('input', function () {\n          if (isComposing) return;\n          const val = $(this).val();\n          const selectionStart = this.selectionStart;\n          const selectionEnd = this.selectionEnd;\n          clearTimeout(searchTimeout);\n          searchTimeout = setTimeout(() => {\n            const activeTab = getActiveTabState();\n            if (activeTab) {\n              tableSearchStates[activeTab] = val;\n              tablePageStates[activeTab] = 1;\n              const isFocus = document.activeElement && document.activeElement.classList.contains('acu-search-input');\n              renderInterface();\n              if (isFocus) {\n                const $newInput = $('.acu-search-input');\n                $newInput.focus();\n                if ($newInput.length && $newInput[0].setSelectionRange) {\n                  try {\n                    $newInput[0].setSelectionRange(selectionStart, selectionEnd);\n                  } catch (e) {}\n                }\n              }\n            }\n          }, 300);\n        });\n    }\n    // \n    $('#acu-btn-relation-graph')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const rawData = cachedRawData || getTableData();\n        if (rawData) {\n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (sheet?.name === tableName) {\n              const tableData = {\n                headers: sheet.content?.[0] || [],\n                rows: sheet.content?.slice(1) || [],\n                key: key,\n              };\n              showRelationshipGraph(tableData);\n              return;\n            }\n          }\n        }\n        if (window.toastr) window.toastr.warning('');\n      });\n    // --- []  ---\n\n    // 1. \n    $('#acu-btn-switch-style')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const styles = getTableStyles();\n        const current = styles[tableName] || 'list';\n        styles[tableName] = current === 'grid' ? 'list' : 'grid'; // \n        saveTableStyles(styles);\n        renderInterface(); // \n      });\n\n    // 2. \n    $('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          if (tableName) {\n            const heights = getTableHeights();\n            heights[tableName] = parseInt($panel.css('height'));\n            saveTableHeights(heights);\n            $panel.addClass('acu-manual-mode');\n          }\n        };\n      });\n\n    // 3.  - \n    $('.acu-height-drag-handle')\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    // [] \n    $wrapper.on('click', '.acu-reverse-btn', function (e) {\n      e.stopPropagation();\n      const tName = $(this).data('table');\n      if (!tName) return;\n\n      toggleTableReverse(tName);\n\n      // \n      renderInterface();\n    });\n    // [] \n    $('.acu-panel-header')\n      .off('dblclick.acu')\n      .on('dblclick.acu', function (e) {\n        if ($(e.target).closest('.acu-search-input, .acu-close-btn, .acu-view-btn').length) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = getActiveTabState();\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    $('.acu-close-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $input = $('.acu-search-input');\n\n        // \n        if ($input.length && $input.val()) {\n          $input.val('').trigger('input').focus();\n          return;\n        }\n\n        // \n        const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        if (isDashboardActive) {\n          // \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n        if (isMvuActive) {\n          // \n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        closePanel();\n      });\n    // [] bookmark\n    $('body')\n      .off('click.acu_bookmark')\n      .on('click.acu_bookmark', '.acu-bookmark-icon', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $icon = $(this);\n        const tableName = $icon.data('table');\n        const rowKey = $icon.data('row-key');\n\n        if (!tableName || !rowKey) return;\n\n        // bookmark\n        BookmarkManager.toggleBookmark(tableName, rowKey);\n\n        // \n        if (typeof renderInterface === 'function') {\n          renderInterface();\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_action')\n      .on('click.acu_action', '.acu-action-item', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $btn = $(this);\n        const rowIdx = parseInt($btn.data('row'), 10);\n        const actionIdx = parseInt($btn.data('action-idx'), 10);\n\n        // \n        const $card = $btn.closest('.acu-data-card');\n        const $title = $card.find('.acu-editable-title');\n        const tableKey = $title.data('key');\n        const tableName = $title.data('tname') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const headers = rawData[tableKey].content[0] || [];\n        const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n\n        // \n        const invalidValues = ['-', 'null', 'none', '', '', 'n/a', 'undefined', '/'];\n\n        // \n        let actions = getActionsForTable(tableName);\n\n        // \"\"\n        const interactColIdx = headers.findIndex(h => h && String(h).includes(''));\n        if (interactColIdx >= 0 && rowData[interactColIdx]) {\n          const cellValue = String(rowData[interactColIdx]).trim();\n          if (cellValue && !invalidValues.includes(cellValue.toLowerCase())) {\n            const interactOptions = cellValue\n              .split(/[,;]/)\n              .map(s => s.trim())\n              .filter(s => s && !invalidValues.includes(s.toLowerCase()));\n            if (interactOptions.length > 0) {\n              // \n              const existingLabels = actions.map(a => a.label.toLowerCase());\n              // \n              const newActions = interactOptions\n                .filter(opt => !existingLabels.includes(opt.toLowerCase()))\n                .map(opt => ({\n                  label: opt,\n                  icon: 'fa-hand-pointer',\n                  type: 'prompt',\n                  template: `<user>{Name}${opt}`,\n                  auto_send: true,\n                }));\n              //  + \n              actions = [...actions, ...newActions];\n            }\n          }\n        }\n\n        const action = actions[actionIdx];\n\n        // [] \n        if (action && action.type === 'skill_check') {\n          const skillName = rowData[1] || '';\n\n          // \n          let checkValue = null;\n          const attrValIdx = headers.findIndex(h => h && h.includes(''));\n          const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n          // \n          if (attrValIdx > 0 && rowData[attrValIdx]) {\n            const val = extractNumericValue(rowData[attrValIdx]);\n            if (val > 0) checkValue = val;\n          }\n          // \n          if (checkValue === null && profIdx > 0 && rowData[profIdx]) {\n            const val = extractNumericValue(rowData[profIdx]);\n            if (val > 0) checkValue = val;\n          }\n\n          // \n          const promptText = processTemplate(action.template, rowData, headers);\n          smartInsertToTextarea(promptText, 'action');\n\n          // \n          if (checkValue !== null && checkValue > 0) {\n            showDicePanel({\n              targetValue: checkValue,\n              targetName: skillName,\n              initiatorName: '<user>',\n            });\n          } else {\n            $('#send_textarea').focus();\n          }\n          return;\n        }\n\n        if (action && action.template) {\n          // \n          const rawData = cachedRawData || getTableData();\n          if (rawData && rawData[tableKey]) {\n            const headers = rawData[tableKey].content[0] || [];\n            const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n            const npcName = rowData[1] || '';\n\n            // \"\"\n            if (action.label === '') {\n              const config = getConfig();\n              $('.acu-msg-overlay').remove();\n\n              const t = getThemeColors();\n\n              const overlay = $(`\n                        <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2147483647;display:flex;justify-content:center;align-items:center;\">\n                            <div style=\"background:${t.bgPanel};border:1px solid ${t.border};border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                                <div style=\"font-size:14px;font-weight:bold;color:${t.accent};margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                                    <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                                </div>\n                                <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:6px;color:${t.textMain} !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                                <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                                    <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:6px;color:${t.textMain};cursor:pointer;\"></button>\n                                    <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:${t.btnActiveBg};border:none;border-radius:6px;color:${t.btnActiveText};cursor:pointer;font-weight:bold;\"></button>\n                                </div>\n                            </div>\n                        </div>\n                    `);\n\n              $('body').append(overlay);\n              // []  JS  overlay \n              const overlayEl = overlay[0];\n              overlayEl.style.setProperty('position', 'fixed', 'important');\n              overlayEl.style.setProperty('top', '0', 'important');\n              overlayEl.style.setProperty('left', '0', 'important');\n              overlayEl.style.setProperty('right', '0', 'important');\n              overlayEl.style.setProperty('bottom', '0', 'important');\n              overlayEl.style.setProperty('width', '100vw', 'important');\n              overlayEl.style.setProperty('height', '100vh', 'important');\n              overlayEl.style.setProperty('display', 'flex', 'important');\n              overlayEl.style.setProperty('justify-content', 'center', 'important');\n              overlayEl.style.setProperty('align-items', 'center', 'important');\n              overlayEl.style.setProperty('z-index', '2147483650', 'important');\n              setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n              const sendMessage = () => {\n                const msg = overlay.find('#acu-msg-input').val().trim();\n                if (msg) {\n                  const promptText = `<user>${npcName}\"${msg}\"`;\n                  smartInsertToTextarea(promptText, 'action');\n                  $('#send_textarea').focus();\n                }\n                overlay.remove();\n              };\n\n              overlay.find('#acu-msg-send').click(sendMessage);\n              overlay.find('#acu-msg-input').on('keydown', function (ev) {\n                if (ev.key === 'Enter') {\n                  ev.preventDefault();\n                  sendMessage();\n                }\n              });\n              overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n              overlay.on('click', function (ev) {\n                if ($(ev.target).hasClass('acu-msg-overlay')) overlay.remove();\n              });\n              return;\n            }\n\n            //  processTemplate \n            const promptText = processTemplate(action.template, rowData, headers);\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_global_dice')\n      .on('click.acu_global_dice', '#acu-btn-dice', function (e) {\n        e.stopPropagation();\n        showDicePanel({\n          targetValue: 50,\n          targetName: '',\n          diceType: '1d100',\n        });\n      });\n    // ========== [] ==========\n    // /\n    $('body')\n      .off('click.acu_location_toggle')\n      .on('click.acu_location_toggle', '.acu-location-header', function (e) {\n        e.stopPropagation();\n        const $group = $(this).closest('.acu-location-group');\n        $group.toggleClass('expanded');\n      });\n\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_jump')\n      .on('click.acu_dash_jump', '.acu-dash-jump-link, .acu-dash-loc-item', function (e) {\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const searchTerm = $(this).data('search') || '';\n\n        if (tableName) {\n          // 1. \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n\n          // 2. \n          saveActiveTabState(tableName);\n\n          // 3. \n          if (searchTerm) {\n            tableSearchStates[tableName] = searchTerm;\n            tablePageStates[tableName] = 1;\n          }\n\n          // 4. \n          renderInterface();\n\n          // 5. \n          if (searchTerm) {\n            setTimeout(() => {\n              const $input = $('.acu-search-input');\n              if ($input.length) $input.focus();\n            }, 100);\n          }\n        }\n      });\n    // ========== [] ==========\n    // [] \n    $('body')\n      .off('click.acu_inline_dice')\n      .on('click.acu_inline_dice', '.acu-inline-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        //  .attr()  jQuery \n        const attrName = $(this).attr('data-attr-name') || '';\n        const attrValue = parseInt($(this).attr('data-attr-value'), 10) || 50;\n\n        // NPC\n        const $card = $(this).closest('.acu-data-card');\n        const cardTitle = $card.find('.acu-editable-title').text().trim();\n\n        // <user>\n        const tableName = $card.find('.acu-editable-title').data('tname') || '';\n        const isPlayerTable = tableName.includes('');\n        const initiatorName = isPlayerTable ? '<user>' : cardTitle;\n\n        showDicePanel({\n          targetValue: attrValue,\n          targetName: attrName,\n          initiatorName: initiatorName,\n          //  diceType\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_dice')\n      .on('click.acu_dash_dice', '.acu-dash-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const targetValue = parseInt($(this).data('target'), 10) || 50;\n        const targetName = $(this).data('name') || '';\n        const npcName = $(this).data('npc') || '';\n\n        // NPC\n        if (npcName) {\n          // \n          const playerAttrValue = getAttributeValue('<user>', targetName) || 50;\n          showContestPanel({\n            initiatorName: '<user>',\n            initiatorValue: playerAttrValue,\n            opponentName: npcName,\n            opponentValue: targetValue,\n          });\n        } else {\n          showDicePanel({\n            targetValue: targetValue,\n            targetName: targetName,\n            initiatorName: '<user>',\n          });\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_goto')\n      .on('click.acu_dash_goto', '.acu-dash-goto-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const locationName = $(this).data('location') || '';\n        const promptText = `<user>${locationName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_use_item')\n      .on('click.acu_dash_use_item', '.acu-dash-use-item-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const itemName = $(this).data('item') || '';\n        const promptText = `<user>${itemName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\" - \n    $('body')\n      .off('click.acu_dash_use_skill')\n      .on('click.acu_dash_use_skill', '.acu-dash-use-skill-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const skillName = $(this).data('skill') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        let checkValue = null;\n\n        if (rawData) {\n          // \n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n            if (sheet.name.includes('') || sheet.name.includes('')) {\n              const headers = sheet.content[0] || [];\n              // \n              const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n              const attrValIdx = headers.findIndex(h => h && h.includes(''));\n              const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n              for (let i = 1; i < sheet.content.length; i++) {\n                const row = sheet.content[i];\n                if (row && row[nameIdx === -1 ? 1 : nameIdx] === skillName) {\n                  // \n                  if (attrValIdx > 0 && row[attrValIdx]) {\n                    const val = extractNumericValue(row[attrValIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  // \n                  if (profIdx > 0 && row[profIdx]) {\n                    const val = extractNumericValue(row[profIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n              if (checkValue !== null) break;\n            }\n          }\n        }\n\n        // \n        const promptText = `<user>${skillName}`;\n        smartInsertToTextarea(promptText, 'action');\n\n        // \n        if (checkValue !== null && checkValue > 0) {\n          showDicePanel({\n            targetValue: checkValue,\n            targetName: skillName,\n            initiatorName: '<user>',\n          });\n        } else {\n          // \n          $('#send_textarea').focus();\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_track_task')\n      .on('click.acu_dash_track_task', '.acu-dash-track-task-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const taskName = $(this).data('task') || '';\n        const promptText = `<user>${taskName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_msg')\n      .on('click.acu_dash_msg', '.acu-dash-msg-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n        const config = getConfig();\n\n        // \n        $('.acu-msg-overlay').remove();\n\n        // \n        const t = getThemeColors();\n\n        const overlay = $(`\n            <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2147483647;display:flex;justify-content:center;align-items:center;\">\n                <div class=\"acu-msg-dialog\" style=\"background:${t.bgPanel};border:1px solid ${t.border};border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                    <div style=\"font-size:14px;font-weight:bold;color:${t.accent};margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                        <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                    </div>\n                    <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:6px;color:${t.textMain} !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                    <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                        <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:6px;color:${t.textMain};cursor:pointer;\"></button>\n                        <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:${t.btnActiveBg};border:none;border-radius:6px;color:${t.btnActiveText};cursor:pointer;font-weight:bold;\"></button>\n                    </div>\n                </div>\n            </div>\n        `);\n\n        $('body').append(overlay);\n        const overlayEl = overlay[0];\n        overlayEl.style.setProperty('position', 'fixed', 'important');\n        overlayEl.style.setProperty('top', '0', 'important');\n        overlayEl.style.setProperty('left', '0', 'important');\n        overlayEl.style.setProperty('right', '0', 'important');\n        overlayEl.style.setProperty('bottom', '0', 'important');\n        overlayEl.style.setProperty('width', '100vw', 'important');\n        overlayEl.style.setProperty('height', '100vh', 'important');\n        overlayEl.style.setProperty('display', 'flex', 'important');\n        overlayEl.style.setProperty('justify-content', 'center', 'important');\n        overlayEl.style.setProperty('align-items', 'center', 'important');\n        overlayEl.style.setProperty('z-index', '2147483650', 'important');\n        setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n        const sendMessage = () => {\n          const msg = overlay.find('#acu-msg-input').val().trim();\n          if (msg) {\n            const promptText = `<user>${npcName}\"${msg}\"`;\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n          overlay.remove();\n        };\n\n        // \n        overlay.find('#acu-msg-send').click(sendMessage);\n\n        // \n        overlay.find('#acu-msg-input').on('keydown', function (ev) {\n          if (ev.key === 'Enter') {\n            ev.preventDefault();\n            sendMessage();\n          }\n        });\n\n        // \n        overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n        overlay.on('click', function (ev) {\n          if ($(ev.target).hasClass('acu-msg-overlay')) overlay.remove();\n        });\n      });\n    // [] NPC\n    $('body')\n      .off('click.acu_dash_contest')\n      .on('click.acu_dash_contest', '.acu-dash-contest-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n\n        const rawData = cachedRawData || getTableData();\n\n        var playerAttrValue = 50;\n        var npcAttrValue = 50;\n        var foundPlayer = false;\n        var foundNPC = false;\n\n        if (rawData) {\n          for (var key in rawData) {\n            var sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n\n            // \n            if (sheet.name === '') {\n              if (sheet.content[1]) {\n                var attrStr = sheet.content[1][7] || '';\n                var parts = attrStr.split(/[,;\\s]+/);\n                for (var i = 0; i < parts.length; i++) {\n                  var match = parts[i].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                  if (match) {\n                    playerAttrValue = parseInt(match[2], 10);\n                    foundPlayer = true;\n                    break;\n                  }\n                }\n              }\n            }\n\n            // \n            if (sheet.name === '' && npcName) {\n              for (var j = 1; j < sheet.content.length; j++) {\n                var row = sheet.content[j];\n                if (row && row[1] === npcName) {\n                  var npcAttrStr = row[9] || '';\n                  var npcParts = npcAttrStr.split(/[,;\\s]+/);\n                  for (var k = 0; k < npcParts.length; k++) {\n                    var npcMatch = npcParts[k].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                    if (npcMatch) {\n                      npcAttrValue = parseInt(npcMatch[2], 10);\n                      foundNPC = true;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n            }\n          }\n        }\n\n        showContestPanel({\n          initiatorName: '<user>',\n          initiatorValue: playerAttrValue,\n          opponentName: npcName,\n          opponentValue: npcAttrValue,\n          diceType: '1d100',\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_preview')\n      .on('click.acu_dash_preview', '.acu-dash-preview-trigger', function (e) {\n        e.stopPropagation();\n\n        const tableKey = $(this).data('table-key');\n        const rowIndex = parseInt($(this).data('row-index'), 10);\n\n        if (!tableKey || isNaN(rowIndex)) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const table = rawData[tableKey];\n        const tableName = table.name || '';\n        const headers = table.content[0] || [];\n        const rowData = table.content[rowIndex + 1];\n\n        if (!rowData) return;\n\n        const config = getConfig();\n        const title = rowData[1] || '';\n\n        //  renderTableContent \n        const titleColIndex = 1;\n        const realRowIdx = rowIndex;\n\n        // \n        let cardBody = '';\n        rowData.forEach((cell, cIdx) => {\n          if (cIdx <= 0 || cIdx === titleColIndex) return;\n          const currentHeader = headers[cIdx] || '';\n          if (currentHeader.includes('')) return; // \n\n          const headerName = headers[cIdx] || '' + cIdx;\n          const rawStr = String(cell || '').trim();\n          if (!rawStr) return;\n\n          let contentHtml = '';\n          let hideLabel = false;\n\n          const parsedAttrs = parseAttributeString(rawStr);\n          // [] \n          if (isRelationshipCell(rawStr, headerName)) {\n            const relations = parseRelationshipString(rawStr);\n            if (relations.length > 1) {\n              hideLabel = true;\n              let relHtml = '';\n              relations.forEach((rel, i) => {\n                const borderStyle = i < relations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                relHtml += `<div style=\"display:flex;justify-content:space-between;align-items:center;padding:3px 0;${borderStyle}\">\n                            <span style=\"color:var(--acu-text-main);font-size:0.95em;\">${escapeHtml(rel.name)}</span>\n                            ${rel.relation ? `<span style=\"color:var(--acu-text-sub);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>` : ''}\n                        </div>`;\n              });\n              contentHtml = `<div class=\"acu-relation-container\">${relHtml}</div>`;\n            } else if (relations.length === 1 && relations[0].relation) {\n              const rel = relations[0];\n              contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                        <span style=\"color:var(--acu-text-main);\">${escapeHtml(rel.name)}</span>\n                        <span style=\"color:var(--acu-text-sub);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>\n                    </div>`;\n            }\n          } else if (parsedAttrs.length > 1) {\n            hideLabel = true;\n            let attrsHtml = '';\n            parsedAttrs.forEach((attr, i) => {\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              const borderStyle = i < parsedAttrs.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n              attrsHtml += `<div style=\"display:flex;justify-content:space-between;align-items:center;padding:3px 0;${borderStyle}\">\n                        <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(attr.name)}</span>\n                        <div style=\"display:flex;align-items:center;gap:6px;\">\n                            <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                            ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                        </div></div>`;\n            });\n            contentHtml = `<div class=\"acu-multi-attr-container\">${attrsHtml}</div>`;\n          } else if (parsedAttrs.length === 1) {\n            hideLabel = true;\n            const attr = parsedAttrs[0];\n            const showDice = !BlacklistManager.isBlacklisted(attr.name);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                    <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(attr.name)}</span>\n                    <div style=\"display:flex;align-items:center;gap:6px;\">\n                        <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                        ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                    </div></div>`;\n          } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n            const numVal = extractNumericValue(rawStr);\n            const showDice = !BlacklistManager.isBlacklisted(headerName);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                    <span>${escapeHtml(rawStr)}</span>\n                    ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(headerName)}\" data-attr-value=\"${numVal}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;margin-left:6px;\" title=\"\"></i>` : ''}\n                </div>`;\n          } else {\n            const badgeStyle = getBadgeStyle(rawStr);\n            contentHtml = badgeStyle\n              ? `<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(rawStr)}</span>`\n              : escapeHtml(rawStr);\n          }\n\n          const rowClass = 'acu-card-row acu-cell' + (hideLabel ? ' acu-hide-label' : '');\n          cardBody += `<div class=\"${rowClass}\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${cIdx}\" data-val=\"${encodeURIComponent(cell ?? '')}\">\n                <div class=\"acu-card-label\">${escapeHtml(headerName)}</div>\n                <div class=\"acu-card-value\">${contentHtml}</div>\n            </div>`;\n        });\n\n        // \n        let actionsHtml = '';\n        let tableActions = getActionsForTable(tableName);\n        const interactColIdx = headers.findIndex(h => h && String(h).includes(''));\n        if (interactColIdx > 0 && rowData[interactColIdx]) {\n          const interactOptions = String(rowData[interactColIdx])\n            .split(/[,;]/)\n            .map(s => s.trim())\n            .filter(s => s);\n          if (interactOptions.length > 0) {\n            tableActions = interactOptions.map(opt => ({\n              label: opt,\n              icon: 'fa-hand-pointer',\n              type: 'prompt',\n              template: `<user>{Name}${opt}`,\n              auto_send: true,\n            }));\n          }\n        }\n        if (tableActions.length > 0) {\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardHtml = `\n            <div class=\"acu-preview-overlay acu-theme-${config.theme}\" style=\"--acu-card-width:${config.cardWidth}px;--acu-font-size:${config.fontSize}px;\">\n                <div class=\"acu-data-card\" style=\"width:90vw;max-width:420px;max-height:85vh;overflow-y:auto;\">\n                    <div class=\"acu-card-header\">\n                        <span class=\"acu-card-index\">#${realRowIdx + 1}</span>\n                        <span class=\"acu-cell acu-editable-title\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(title)}\">${escapeHtml(title)}</span>\n                        <button class=\"acu-preview-close\" style=\"margin-left:auto;background:none;border:none;color:var(--acu-text-sub);cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-card-body view-list\">${cardBody}</div>\n                    ${actionsHtml}\n                </div>\n            </div>\n        `;\n\n        $('.acu-preview-overlay').remove();\n        $('body').append(cardHtml);\n\n        // \n        const overlayEl = $('.acu-preview-overlay')[0];\n        if (overlayEl) {\n          overlayEl.style.setProperty('position', 'fixed', 'important');\n          overlayEl.style.setProperty('top', '0', 'important');\n          overlayEl.style.setProperty('left', '0', 'important');\n          overlayEl.style.setProperty('right', '0', 'important');\n          overlayEl.style.setProperty('bottom', '0', 'important');\n          overlayEl.style.setProperty('width', '100vw', 'important');\n          overlayEl.style.setProperty('height', '100vh', 'important');\n          overlayEl.style.setProperty('display', 'flex', 'important');\n          overlayEl.style.setProperty('justify-content', 'center', 'important');\n          overlayEl.style.setProperty('align-items', 'center', 'important');\n          overlayEl.style.setProperty('z-index', '2147483650', 'important');\n        }\n\n        // \n        $('.acu-preview-overlay').on('click', function (ev) {\n          if ($(ev.target).hasClass('acu-preview-overlay') || $(ev.target).closest('.acu-preview-close').length) {\n            $(this).remove();\n          }\n        });\n      });\n\n    // === []  ST  swipe regenerate ===\n    (function () {\n      const $doc = $(document);\n      let touchStartX = 0;\n      let touchStartY = 0;\n\n      //  data-area\n      $doc.on('touchstart.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length === 1) {\n          touchStartX = e.originalEvent.touches[0].clientX;\n          touchStartY = e.originalEvent.touches[0].clientY;\n        }\n      });\n\n      $doc.on('touchmove.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length !== 1) return;\n\n        const touch = e.originalEvent.touches[0];\n        const deltaX = Math.abs(touch.clientX - touchStartX);\n        const deltaY = Math.abs(touch.clientY - touchStartY);\n\n        // X > Y * 1.5\n        if (deltaX > deltaY * 1.5 && deltaX > 10) {\n          e.stopPropagation();\n          console.log('[DICE]ACU  ST swipe');\n        }\n      });\n    })();\n  };\n\n  let selectedSwapSource = null;\n  const toggleOrderEditMode = () => {\n    const { $ } = getCore();\n    isEditingOrder = !isEditingOrder;\n\n    const $container = $('#acu-nav-bar');\n    const $hint = $('#acu-order-hint');\n    const $pool = $('#acu-action-pool');\n\n    // \n    if (!$container.length) {\n      console.error('[DICE]ACU ');\n      isEditingOrder = false;\n      return;\n    }\n\n    selectedSwapSource = null;\n    $('.acu-swap-selected').removeClass('acu-swap-selected');\n\n    if (isEditingOrder) {\n      // \n      $container.addClass('editing-order');\n      if ($pool.length) $pool.addClass('visible');\n\n      if ($hint.length) {\n        $hint\n          .html(\n            `\n                    <div style=\"display:flex; justify-content:space-between; align-items:center; width:100%; flex-wrap:wrap; gap:8px;\">\n                        <div style=\"display:flex; align-items:center; gap:10px; flex:1; min-width:200px;\">\n                            <span><i class=\"fa-solid fa-layer-group\"></i> </span>\n                            <span style=\"font-size:11px; opacity:0.9; font-weight:normal;\"></span>\n                        </div>\n                        <button id=\"acu-btn-finish-sort\" style=\"background:rgba(255,255,255,0.2); color:#fff; border:1px solid rgba(255,255,255,0.4); padding:4px 14px; border-radius:4px; cursor:pointer; font-size:12px; transition:all 0.2s; white-space:nowrap;\">\n                            <i class=\"fa-solid fa-check\"></i> \n                        </button>\n                    </div>\n                `,\n          )\n          .addClass('visible')\n          .css('display', 'flex');\n\n        $('#acu-btn-finish-sort').hover(\n          function () {\n            $(this).css({ background: '#fff', color: 'var(--acu-accent)' });\n          },\n          function () {\n            $(this).css({ background: 'rgba(255,255,255,0.2)', color: '#fff' });\n          },\n        );\n\n        $('#acu-btn-finish-sort')\n          .off('click')\n          .on('click', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            toggleOrderEditMode();\n          });\n      }\n\n      // \n      $('#acu-data-area').removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn').not('#acu-btn-dashboard, #acu-btn-dice-nav').attr('draggable', 'true');\n      $container.find('.acu-action-btn').attr('draggable', 'true');\n\n      // \n      initSortable();\n    } else {\n      // \n      $container.removeClass('editing-order');\n      if ($hint.length) $hint.removeClass('visible').hide();\n      if ($pool.length) $pool.removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn, .acu-action-btn').attr('draggable', 'false');\n      $('.acu-nav-btn, .acu-action-btn').off('.sort');\n      $('#acu-action-pool, #acu-active-actions').off('.sort');\n\n      // \n      const newTableOrder = [];\n      $container.find('.acu-nav-btn[data-table]').each(function () {\n        const tableName = $(this).data('table');\n        if (tableName) {\n          newTableOrder.push(tableName);\n        }\n      });\n      if (newTableOrder.length > 0) {\n        saveTableOrder(newTableOrder);\n      }\n\n      // \n      const newActionOrder = [];\n      $('#acu-active-actions .acu-action-btn').each(function () {\n        const btnId = $(this).attr('id');\n        if (btnId) {\n          newActionOrder.push(btnId);\n        }\n      });\n\n      // \n      if (!newActionOrder.includes('acu-btn-settings')) {\n        newActionOrder.push('acu-btn-settings');\n      }\n\n      Store.set(STORAGE_KEY_ACTION_ORDER, newActionOrder);\n\n      // \n      renderInterface();\n    }\n  };\n\n  const initSortable = () => {\n    const { $ } = getCore();\n    let $dragSrcEl = null;\n\n    // \n    $('.acu-nav-btn, .acu-action-btn, #acu-action-pool, #acu-active-actions').off('.sort');\n\n    // --- 1.  () ---\n    const $items = $('.acu-nav-btn, .acu-action-btn');\n\n    $items.on('dragstart.sort', function (e) {\n      $dragSrcEl = $(this);\n      $(this).css('opacity', '0.4');\n      e.originalEvent.dataTransfer.effectAllowed = 'move';\n    });\n\n    $items.on('dragend.sort', function (e) {\n      $(this).css('opacity', '1');\n      $('.acu-drag-over').removeClass('acu-drag-over');\n      $('.acu-actions-group, .acu-unused-pool').removeClass('dragging-over');\n    });\n\n    $items.on('dragover.sort', function (e) {\n      e.preventDefault();\n      return false;\n    });\n    $items.on('dragenter.sort', function () {\n      if ($dragSrcEl && this !== $dragSrcEl[0]) $(this).addClass('acu-drag-over');\n    });\n    $items.on('dragleave.sort', function () {\n      $(this).removeClass('acu-drag-over');\n    });\n\n    $items.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('acu-drag-over');\n      if (!$dragSrcEl || $dragSrcEl[0] === this) return false;\n\n      const isSrcAction = $dragSrcEl.hasClass('acu-action-btn');\n      const isTgtAction = $(this).hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) return false;\n\n      if (isSrcAction) {\n        const targetPoolId = $(this).parent().attr('id');\n        const srcPoolId = $dragSrcEl.parent().attr('id');\n\n        if (srcPoolId === 'acu-action-pool' && targetPoolId === 'acu-active-actions') {\n          if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n            if (window.toastr) window.toastr.warning('6');\n            return false;\n          }\n        }\n\n        if (srcPoolId !== targetPoolId) {\n          $(this).before($dragSrcEl);\n          return false;\n        }\n      }\n\n      const $temp = $('<span>').hide();\n      $dragSrcEl.before($temp);\n      $(this).before($dragSrcEl);\n      $temp.replaceWith($(this));\n      return false;\n    });\n\n    // --- 2.  (/) ---\n    const $containers = $('#acu-action-pool, #acu-active-actions');\n\n    $containers.on('dragover.sort', function (e) {\n      e.preventDefault();\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        $(this).addClass('dragging-over');\n      }\n    });\n\n    $containers.on('dragleave.sort', function (e) {\n      $(this).removeClass('dragging-over');\n    });\n\n    $containers.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('dragging-over');\n\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        const currentParentId = $dragSrcEl.parent().attr('id');\n        const targetId = $(this).attr('id');\n        const btnId = $dragSrcEl.attr('id');\n\n        if (currentParentId !== targetId) {\n          if (targetId === 'acu-action-pool') {\n            if (btnId === 'acu-btn-settings') {\n              if (window.toastr) window.toastr.warning('');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          } else if (targetId === 'acu-active-actions') {\n            if ($(this).children().length >= 6) {\n              if (window.toastr) window.toastr.warning('6');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          }\n        }\n      }\n      return false;\n    });\n\n    // --- 3.  -  ---\n    $containers.on('click.sort', function (e) {\n      e.stopPropagation();\n\n      // \n      if ($(e.target).closest('.acu-action-btn, .acu-nav-btn').length > 0) return;\n\n      // \n      if (!selectedSwapSource) return;\n\n      const $src = $(selectedSwapSource);\n\n      // \n      if (!$src.hasClass('acu-action-btn')) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const targetId = $(this).attr('id');\n      const btnId = $src.attr('id');\n\n      // \n      if (srcPoolId === targetId) {\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      //   \n      if (targetId === 'acu-action-pool') {\n        if (btnId === 'acu-btn-settings') {\n          if (window.toastr) window.toastr.warning('');\n          $src.removeClass('acu-swap-selected');\n          selectedSwapSource = null;\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n      //   \n      else if (targetId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n    });\n\n    // --- 4.  (Click-to-Swap) -  ---\n    $items.on('click.sort', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (selectedSwapSource && selectedSwapSource === this) {\n        $(this).removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      if (!selectedSwapSource) {\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const $src = $(selectedSwapSource);\n      const $tgt = $(this);\n\n      const isSrcAction = $src.hasClass('acu-action-btn');\n      const isTgtAction = $tgt.hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const tgtPoolId = $tgt.parent().attr('id');\n\n      if (isSrcAction && srcPoolId === 'acu-action-pool' && tgtPoolId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n      }\n\n      if (srcPoolId !== tgtPoolId) {\n        $tgt.before($src);\n      } else {\n        const $temp = $('<span>').hide();\n        $src.before($temp);\n        $tgt.before($src);\n        $temp.replaceWith($tgt);\n      }\n\n      $src.removeClass('acu-swap-selected');\n      selectedSwapSource = null;\n    });\n  };\n\n  const showCellMenu = (e, cell) => {\n    const { $ } = getCore();\n    $('.acu-cell-menu, .acu-menu-backdrop').remove();\n    const backdrop = $('<div class=\"acu-menu-backdrop\"></div>');\n    $('body').append(backdrop);\n\n    const rowIdx = parseInt($(cell).data('row'), 10);\n    const colIdx = parseInt($(cell).data('col'), 10);\n    if (isNaN(rowIdx) || isNaN(colIdx)) {\n      console.warn('[DICE]ACU /');\n      backdrop.remove();\n      return;\n    }\n    const tableKey = $(cell).data('key');\n    // v19.x  tname\n    const tableName = $(cell).data('tname') || $(cell).closest('.acu-data-card').find('.acu-editable-title').text();\n    const content = decodeURIComponent($(cell).data('val'));\n    const config = getConfig();\n\n    //  ID\n    const cellId = `${tableKey}-${rowIdx}-${colIdx}`;\n    if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n\n    // \n    const isModified = window.acuModifiedSet.has(cellId);\n\n    // \n    const pendingDeletionsMap = getPendingDeletions();\n    const tableDeletions = pendingDeletionsMap[tableKey] || [];\n    const isPending = tableDeletions.includes(rowIdx);\n\n    // \n    const headers = cachedRawData?.[tableKey]?.content?.[0] || [];\n    const rowData = cachedRawData?.[tableKey]?.content?.[rowIdx + 1] || [];\n    const lockRowKey = LockManager.getRowKey(tableName, rowData, headers);\n    const currentHeader = headers[colIdx] || '';\n\n    const isFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, currentHeader);\n    const isRowLocked = lockRowKey && LockManager.isRowLocked(tableName, lockRowKey);\n\n    // \n    let lockMenuHtml = '';\n    if (lockRowKey) {\n      lockMenuHtml = '<div style=\"border-top:1px dashed var(--acu-border); margin:4px 0;\"></div>';\n      if (isFieldLocked) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-field\" style=\"color:#27ae60;\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-field\" style=\"color:#f39c12;\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n      if (isRowLocked) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-row\" style=\"color:#27ae60;\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-row\" style=\"color:#f39c12;\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n    }\n\n    const menu = $(`\n            <div class=\"acu-cell-menu acu-theme-${config.theme}\">\n                <div class=\"acu-cell-menu-item\" id=\"act-edit\"><i class=\"fa-solid fa-pen\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-edit-card\" style=\"color:#9b59b6\"><i class=\"fa-solid fa-edit\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-insert\" style=\"color:#2980b9\"><i class=\"fa-solid fa-plus\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-copy\"><i class=\"fa-solid fa-copy\"></i> </div>\n                ${isNumericCell(content) ? '<div class=\"acu-cell-menu-item\" id=\"act-dice\" style=\"color:#9b59b6; border-top:1px dashed var(--acu-border);\"><i class=\"fa-solid fa-dice-d20\"></i>  (' + extractNumericValue(content) + ')</div>' : ''}\n                ${lockMenuHtml}\n                ${isModified ? '<div class=\"acu-cell-menu-item\" id=\"act-undo\" style=\"color:#e67e22; border-top:1px solid #eee;\"><i class=\"fa-solid fa-undo\"></i> </div>' : ''}\n                ${isPending ? '<div class=\"acu-cell-menu-item\" id=\"act-restore\" style=\"color:#27ae60\"><i class=\"fa-solid fa-undo\"></i> </div>' : '<div class=\"acu-cell-menu-item\" id=\"act-delete\" style=\"color:#e74c3c\"><i class=\"fa-solid fa-trash\"></i> </div>'}\n                <div class=\"acu-cell-menu-item\" id=\"act-close\"><i class=\"fa-solid fa-times\"></i> </div>\n            </div>\n        `);\n    $('body').append(menu);\n\n    // \n    const winWidth = $(window).width();\n    const winHeight = $(window).height();\n    const mWidth = menu.outerWidth() || 150;\n    const mHeight = menu.outerHeight() || 150;\n    let clientX = e.clientX;\n    let clientY = e.clientY;\n    if (!clientX && e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length) {\n      clientX = e.originalEvent.touches[0].clientX;\n      clientY = e.originalEvent.touches[0].clientY;\n    } else if (!clientX && e.changedTouches && e.changedTouches.length) {\n      clientX = e.changedTouches[0].clientX;\n      clientY = e.changedTouches[0].clientY;\n    }\n\n    // \n    if (clientX === undefined) clientX = winWidth / 2;\n    if (clientY === undefined) clientY = winHeight / 2;\n\n    let left = clientX + 5;\n    let top = clientY + 5;\n    if (left + mWidth > winWidth) left = clientX - mWidth - 5;\n    if (top + mHeight > winHeight) top = clientY - mHeight - 5;\n\n    // \n    if (left < 5) left = 5;\n    if (top < 5) top = 5;\n\n    menu.css({ top: top + 'px', left: left + 'px' });\n\n    const closeAll = () => {\n      menu.remove();\n      backdrop.remove();\n    };\n    backdrop.on('click', closeAll);\n    menu.find('#act-close').click(closeAll);\n    // \n    menu.find('#act-lock-field').click(() => {\n      if (lockRowKey && currentHeader) {\n        LockManager.lockField(tableName, lockRowKey, currentHeader, content);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-field').click(() => {\n      if (lockRowKey && currentHeader) {\n        LockManager.unlockField(tableName, lockRowKey, currentHeader);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-lock-row').click(() => {\n      if (lockRowKey) {\n        LockManager.lockRow(tableName, lockRowKey, rowData, headers);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-row').click(() => {\n      if (lockRowKey) {\n        LockManager.unlockRow(tableName, lockRowKey);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    //  (v7.9 )\n    menu.find('#act-copy').click(async e => {\n      e.stopPropagation();\n\n      //  v7.7  (/PWA )\n      // : slash_command.txt /clipboard-set\n      if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n        try {\n          // \n          const safeContent = content\n            .replace(/\\\\/g, '\\\\\\\\')\n            .replace(/\"/g, '\\\\\"')\n            .replace(/\\n/g, '\\\\n')\n            .replace(/\\{/g, '\\\\{')\n            .replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          closeAll();\n          return; // \n        } catch (err) {\n          console.warn('[DICE]ACU ', err);\n        }\n      }\n\n      //  (v7.8 )\n      const doCopy = text => {\n        // A:  API ( HTTPS  localhost )\n        if (navigator.clipboard && window.isSecureContext) {\n          navigator.clipboard\n            .writeText(text)\n            .then(() => {})\n            .catch(() => {\n              fallbackCopy(text);\n            });\n        } else {\n          // B:  execCommand ( HTTP)\n          fallbackCopy(text);\n        }\n      };\n\n      const fallbackCopy = text => {\n        try {\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n\n          // \n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n\n          document.body.appendChild(textArea);\n\n          textArea.select();\n          textArea.setSelectionRange(0, 99999); //  iOS Safari\n\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n\n          if (successful) {\n          } else {\n            throw new Error('execCommand failed');\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          prompt(':', text);\n        }\n      };\n\n      doCopy(content);\n      closeAll();\n    });\n\n    // \n    menu.find('#act-undo').click(() => {\n      const snapshot = loadSnapshot();\n      let originalValue = null;\n      if (snapshot && snapshot[tableKey]?.content[rowIdx + 1]) {\n        originalValue = snapshot[tableKey].content[rowIdx + 1][colIdx];\n      }\n\n      if (originalValue !== null) {\n        if (!cachedRawData) cachedRawData = getTableData();\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = originalValue;\n        }\n\n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(originalValue));\n        $cell.data('val', encodeURIComponent(originalValue));\n\n        // [1]  Label\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length > 0) {\n          $displayTarget = $cell.find('.acu-card-value');\n        } else if ($cell.hasClass('acu-grid-item')) {\n          $displayTarget = $cell.find('.acu-grid-value');\n        } else if ($cell.hasClass('acu-full-item')) {\n          $displayTarget = $cell.find('.acu-full-value');\n        }\n\n        const badgeStyle = getBadgeStyle(originalValue);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${originalValue}</span>`);\n        } else {\n          $displayTarget.text(originalValue);\n        }\n\n        // [] \n        $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n        if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n        window.acuModifiedSet.delete(cellId);\n\n        if (window.acuModifiedSet.size === 0) {\n          hasUnsavedChanges = false;\n          updateSaveButtonState();\n        }\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n      closeAll();\n    });\n\n    // []  ( & )\n    menu.find('#act-delete').click(async () => {\n      closeAll();\n\n      let actOrd = Store.get(STORAGE_KEY_ACTION_ORDER);\n      if (!actOrd || !Array.isArray(actOrd))\n        actOrd = ['acu-btn-save-global', 'acu-btn-collapse', 'acu-btn-refresh', 'acu-btn-settings'];\n      const isInstantMode = !actOrd.includes('acu-btn-save-global');\n\n      if (isInstantMode) {\n        // ---  DOM ---\n        const $card = $(cell).closest('.acu-data-card');\n        $card.css('transition', 'all 0.2s ease').css('opacity', '0').css('transform', 'scale(0.9)');\n        setTimeout(() => $card.slideUp(200, () => $card.remove()), 200);\n\n        // ---  ---\n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n        if (cachedRawData && cachedRawData[tableKey]?.content) {\n          cachedRawData[tableKey].content.splice(rowIdx + 1, 1);\n\n          //  skipRender=true ()\n          saveSnapshot(cachedRawData);\n          await saveDataToDatabase(cachedRawData, true, true);\n        }\n      } else {\n        // ---  () ---\n        const dels = getPendingDeletions();\n        if (!dels[tableKey]) dels[tableKey] = [];\n        if (!dels[tableKey].includes(rowIdx)) {\n          dels[tableKey].push(rowIdx);\n          savePendingDeletions(dels);\n        }\n\n        // \n        $(cell).closest('.acu-data-card').addClass('pending-deletion');\n\n        // \n        updateSaveButtonState();\n      }\n    });\n\n    // \n    menu.find('#act-restore').click(() => {\n      const dels = getPendingDeletions();\n      if (dels[tableKey]) {\n        dels[tableKey] = dels[tableKey].filter(i => i !== rowIdx);\n        if (dels[tableKey].length === 0) delete dels[tableKey];\n        savePendingDeletions(dels);\n      }\n\n      $(cell).closest('.acu-data-card').removeClass('pending-deletion');\n      updateSaveButtonState();\n      closeAll();\n    });\n\n    // []  ()\n    menu.find('#act-insert').click(async () => {\n      closeAll();\n      // 1.  ()\n      if (!cachedRawData) cachedRawData = getTableData();\n      if (!cachedRawData) cachedRawData = loadSnapshot();\n\n      if (cachedRawData && cachedRawData[tableKey]?.content) {\n        const sheet = cachedRawData[tableKey];\n        // 2.  ()\n        const colCount = sheet.content[0] ? sheet.content[0].length : 2;\n        const newRow = new Array(colCount).fill('');\n        //  ()\n        if (colCount > 0) newRow[0] = String(sheet.content.length);\n\n        // 3.  (rowIdx+2  content )\n        sheet.content.splice(rowIdx + 2, 0, newRow);\n\n        // 4. \n        // \n        await saveDataToDatabase(cachedRawData, false, true);\n\n        // \n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $panel = $('.acu-panel-content');\n          // \n          if ($panel.length && $panel[0].scrollHeight > $panel.height()) {\n            $panel.scrollTop($panel.scrollTop() + 10);\n          }\n        }, 100);\n      }\n    });\n\n    // [] \n    menu.find('#act-edit-card').click(() => {\n      closeAll();\n      const rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const headers = rawData[tableKey].content[0];\n        const row = rawData[tableKey].content[rowIdx + 1];\n        if (row) {\n          showCardEditModal(row, headers, tableName, rowIdx, tableKey);\n        }\n      }\n    });\n\n    // [] \n    menu.find('#act-dice').click(() => {\n      closeAll();\n      const targetValue = extractNumericValue(content);\n      const headerName = $(cell).find('.acu-card-label').text() || '';\n      showDicePanel({\n        targetValue: targetValue,\n        targetName: headerName,\n        diceType: '1d100',\n      });\n    });\n    menu.find('#act-edit').click(() => {\n      closeAll();\n      showEditDialog(content, async newVal => {\n        // 1. \n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = newVal;\n        } else {\n          alert('');\n          return;\n        }\n\n        // 2.  UI \n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(newVal)).data('val', encodeURIComponent(newVal));\n\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length) $displayTarget = $cell.find('.acu-card-value');\n        else if ($cell.hasClass('acu-grid-item')) $displayTarget = $cell.find('.acu-grid-value');\n        else if ($cell.hasClass('acu-editable-title')) $displayTarget = $cell;\n\n        // 3.  UI / ()\n        const badgeStyle = getBadgeStyle(newVal);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(newVal)}</span>`);\n        } else {\n          $displayTarget.text(newVal);\n        }\n\n        // 4.  vs \n        let actOrd = Store.get(STORAGE_KEY_ACTION_ORDER);\n        if (!actOrd || !Array.isArray(actOrd))\n          actOrd = ['acu-btn-save-global', 'acu-btn-collapse', 'acu-btn-refresh', 'acu-btn-settings'];\n        const isInstantMode = !actOrd.includes('acu-btn-save-global');\n\n        if (isInstantMode) {\n          // --- A.  ---\n          //  ()\n          $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n          if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n          //  ()\n          saveSnapshot(cachedRawData);\n          await saveDataToDatabase(cachedRawData, true, true);\n        } else {\n          // --- B.  () ---\n          // \n          $displayTarget.removeClass('acu-highlight-diff').addClass('acu-highlight-manual');\n          if ($cell.hasClass('acu-editable-title'))\n            $cell.removeClass('acu-highlight-diff').addClass('acu-highlight-manual');\n\n          // \n          if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n          window.acuModifiedSet.add(cellId);\n          hasUnsavedChanges = true;\n          updateSaveButtonState();\n        }\n      });\n    });\n  };\n\n  const showEditDialog = (content, onSave) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <!-- 2. []  acu-theme-${config.theme} -->\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"></div>\n                    <textarea class=\"acu-edit-textarea\" spellcheck=\"false\">${escapeHtml(content)}</textarea>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = el.scrollHeight + 2 + 'px';\n    };\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    dialog.find('#dlg-cancel').click(() => dialog.remove());\n    // \n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) dialog.remove();\n    });\n\n    dialog.find('#dlg-save').click(() => {\n      onSave(dialog.find('textarea').val());\n      dialog.remove();\n    });\n  };\n\n  // ==========================================\n  // []  (Observer )\n  // ==========================================\n  // \n  const detectVisualizerConflict = () => {\n    const { $ } = getCore();\n    if (!$) return false;\n\n    // 1:  DOM \n    //  .acu-wrapper\n    const $wrapper = $('.acu-wrapper');\n    if ($wrapper.length > 0) {\n      //  wrapper \n      //  v12.60  'acu_visualizer_ui_v20_pagination'  SCRIPT_ID\n      // \n      const hasVisualizerNav = $wrapper.find('.acu-nav-container').length > 0;\n      const hasVisualizerDataDisplay = $wrapper.find('.acu-data-display').length > 0;\n\n      //  wrapper \n      //  wrapper  data  id\n      const wrapperId = $wrapper.attr('id') || '';\n      const wrapperClass = $wrapper.attr('class') || '';\n\n      // \n      if (hasVisualizerNav && hasVisualizerDataDisplay) {\n        // \n        const hasDiceFeatures = $wrapper.find('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceFeatures) {\n          return true; // \n        }\n      }\n    }\n\n    // 2: \n    try {\n      const scripts = document.querySelectorAll('script');\n      for (const script of scripts) {\n        const content = script.textContent || script.innerHTML || '';\n        //  v12.60 \n        if (content.includes('acu_visualizer_ui_v20_pagination') && content.includes('acu_ui_config_v18')) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // \n    }\n\n    // 3:  localStorage\n    //  localStorage \n    try {\n      const visualizerConfig = localStorage.getItem('acu_ui_config_v18');\n      const diceConfig = localStorage.getItem('acu_ui_config_v19');\n\n      //  DOM \n      if (visualizerConfig && !diceConfig) {\n        //  DOM\n        const hasDiceInDOM = $('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceInDOM) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // localStorage \n    }\n\n    return false;\n  };\n\n  // \n  const showConflictDialog = () => {\n    const { $ } = getCore();\n    if (!$) return;\n\n    // \n    $('.dice-conflict-dialog-overlay').remove();\n\n    const dialogHtml = `\n      <div class=\"dice-conflict-dialog-overlay\" style=\"\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0, 0, 0, 0.75);\n        backdrop-filter: blur(4px);\n        z-index: 2147483647;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 20px;\n        box-sizing: border-box;\n      \">\n        <div class=\"dice-conflict-dialog\" style=\"\n          background: #fff;\n          border-radius: 16px;\n          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n          max-width: 500px;\n          width: 100%;\n          padding: 30px;\n          box-sizing: border-box;\n          animation: diceDialogPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n        \">\n          <div style=\"\n            text-align: center;\n            margin-bottom: 20px;\n          \">\n            <div style=\"\n              font-size: 48px;\n              color: #e74c3c;\n              margin-bottom: 15px;\n            \"></div>\n            <h2 style=\"\n              font-size: 24px;\n              font-weight: bold;\n              color: #333;\n              margin: 0 0 10px 0;\n            \"></h2>\n            <p style=\"\n              font-size: 16px;\n              color: #666;\n              line-height: 1.6;\n              margin: 0;\n            \">\"\"</p>\n          </div>\n          <div style=\"\n            background: #fff3cd;\n            border: 1px solid #ffc107;\n            border-radius: 8px;\n            padding: 15px;\n            margin-bottom: 20px;\n          \">\n            <p style=\"\n              font-size: 14px;\n              color: #856404;\n              line-height: 1.6;\n              margin: 0;\n            \">\n              <strong></strong><br>\n              <strong></strong>\n            </p>\n          </div>\n          <div style=\"\n            display: flex;\n            gap: 10px;\n            justify-content: center;\n            flex-wrap: wrap;\n          \">\n            <button id=\"dice-conflict-close\" style=\"\n              background: #6c757d;\n              color: #fff;\n              border: none;\n              border-radius: 8px;\n              padding: 12px 24px;\n              font-size: 16px;\n              font-weight: bold;\n              cursor: pointer;\n              transition: all 0.2s;\n              min-width: 120px;\n            \"></button>\n          </div>\n        </div>\n      </div>\n      <style>\n        @keyframes diceDialogPop {\n          from {\n            opacity: 0;\n            transform: translateY(20px) scale(0.95);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0) scale(1);\n          }\n        }\n        .dice-conflict-dialog button:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        }\n        .dice-conflict-dialog button:active {\n          transform: translateY(0);\n        }\n        @media (max-width: 768px) {\n          .dice-conflict-dialog {\n            padding: 20px !important;\n            margin: 10px !important;\n            max-width: calc(100% - 20px) !important;\n          }\n          .dice-conflict-dialog h2 {\n            font-size: 20px !important;\n          }\n          .dice-conflict-dialog p {\n            font-size: 14px !important;\n          }\n        }\n      </style>\n    `;\n\n    $('body').append(dialogHtml);\n\n    // \n    $('#dice-conflict-close').on('click', function () {\n      $('.dice-conflict-dialog-overlay').fadeOut(200, function () {\n        $(this).remove();\n      });\n    });\n\n    // \n    $('.dice-conflict-dialog-overlay').on('click', function (e) {\n      if ($(e.target).hasClass('dice-conflict-dialog-overlay')) {\n        $(this).fadeOut(200, function () {\n          $(this).remove();\n        });\n      }\n    });\n\n    //  toastr \n    if (window.toastr) {\n      window.toastr.error('', '', {\n        timeOut: 0,\n        extendedTimeOut: 0,\n        closeButton: true,\n        preventDuplicates: true,\n      });\n    }\n  };\n\n  const init = () => {\n    if (isInitialized) return;\n\n    console.log('[DICE]...');\n\n    //  ConsoleCaptureManager  localStorage\n    try {\n      ConsoleCaptureManager.restore();\n      console.info('[DICE]ConsoleCaptureManager ');\n    } catch (e) {\n      console.error('[DICE] ConsoleCaptureManager :', e);\n    }\n\n    // \n    try {\n      ErrorHandler.checkAndRestore();\n      console.info('[DICE]');\n    } catch (e) {\n      console.error('[DICE]:', e);\n    }\n\n    // \n    if (detectVisualizerConflict()) {\n      showConflictDialog();\n      console.error('[DICE] ');\n      return; // \n    }\n\n    console.info('[DICE] MVU ...');\n    MvuModule.injectStyles();\n\n    //  Observer\n    if (observer) {\n      observer.disconnect();\n      observer = null;\n      console.info('[DICE] MutationObserver');\n    }\n    addStyles();\n    // 2.  SillyTavern \n    if (window.SillyTavern && window.SillyTavern.eventSource) {\n      console.info('[DICE] SillyTavern ...');\n      const events = window.SillyTavern.eventTypes;\n      const source = window.SillyTavern.eventSource;\n      const triggers = [events.CHAT_CHANGED, events.MESSAGE_SWIPED, events.MESSAGE_DELETED, events.MESSAGE_UPDATED];\n\n      // \n      if (!_boundRenderHandler) {\n        _boundRenderHandler = () => {\n          if (!isEditingOrder) {\n            console.info('[DICE]');\n            setTimeout(renderInterface, 500);\n          } else {\n            console.info('[DICE]');\n          }\n        };\n      }\n\n      // \n      if (!window._acuBoundChatChangeHandler) {\n        window._acuBoundChatChangeHandler = () => {\n          console.info('[DICE]');\n          cachedRawData = null;\n          tablePageStates = {};\n          tableSearchStates = {};\n          tableScrollStates = {};\n          hasUnsavedChanges = false;\n          currentDiffMap.clear();\n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          setTimeout(renderInterface, 500);\n        };\n      }\n      const _boundChatChangeHandler = window._acuBoundChatChangeHandler;\n\n      triggers.forEach(evt => {\n        if (evt) {\n          source.removeListener(evt, _boundRenderHandler);\n          source.removeListener(evt, _boundChatChangeHandler); // \n          if (evt === events.CHAT_CHANGED) {\n            source.on(evt, _boundChatChangeHandler);\n          } else {\n            source.on(evt, _boundRenderHandler);\n          }\n        }\n      });\n      console.info(`[DICE] ${triggers.length} `);\n    } else {\n      console.warn('[DICE]SillyTavern ');\n    }\n\n    // 3.  API \n    const loop = () => {\n      const api = getCore().getDB();\n      if (api?.exportTableAsJson) {\n        isInitialized = true;\n        console.log('[DICE]');\n        console.info('[DICE] API ');\n\n        // --- [Fix]  API  #chat  () ---\n        const $chat = $('#chat');\n        if ($chat.length && !observer) {\n          console.info('[DICE] MutationObserver');\n          let mutationLock = false;\n          const handleMutation = () => {\n            if (mutationLock) return;\n            mutationLock = true;\n            requestAnimationFrame(() => {\n              const config = getConfig();\n              if (config.positionMode === 'embedded') {\n                mutationLock = false;\n                return;\n              }\n\n              const children = $chat.children();\n              const lastChild = children.last()[0];\n              const wrapper = $('.acu-wrapper')[0];\n\n              if (wrapper && lastChild && lastChild !== wrapper) {\n                if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n                  $chat.append(wrapper);\n                }\n              }\n              mutationLock = false;\n            });\n          };\n          observer = new MutationObserver(handleMutation);\n          observer.observe($chat[0], { childList: true });\n        } else if (!$chat.length) {\n          console.warn('[DICE] (#chat)  MutationObserver ');\n        }\n        // --------------------------------------------------\n\n        console.info('[DICE]...');\n        renderInterface(); // \n        // [] \n        setTimeout(() => {\n          hideDiceResultsInUserMessages();\n        }, 500);\n        // \n        if (api.registerTableUpdateCallback) {\n          api.registerTableUpdateCallback(UpdateController.handleUpdate);\n          console.info('[DICE]');\n\n          // \n          if (api.registerTableFillStartCallback) {\n            api.registerTableFillStartCallback(() => {\n              const current = api.exportTableAsJson();\n              if (current) saveSnapshot(current);\n            });\n            console.info('[DICE]');\n          }\n        } else {\n          console.warn('[DICE] API ');\n        }\n      } else {\n        //  ( 60)\n        if (!isInitialized) {\n          window._acuInitRetries = (window._acuInitRetries || 0) + 1;\n          if (window._acuInitRetries < 60) {\n            if (window._acuInitRetries % 10 === 0) {\n              console.info(`[DICE] API ... (${window._acuInitRetries}/60)`);\n            }\n            setTimeout(loop, 1000);\n          } else {\n            console.error('[DICE] API');\n          }\n        }\n      }\n    };\n    loop();\n\n    // []  - \n    const setupOptionHideListener = () => {\n      const { $ } = getCore();\n      const hideOptionPanel = () => {\n        optionPanelVisible = false;\n        $('.acu-option-panel, .acu-embedded-options-container').fadeOut(200, function () {\n          $(this).remove();\n        });\n      };\n\n      // [] \n      const setupSendButtonListener = () => {\n        // []  value \n        interceptTextareaValue();\n\n        // [] \n        const sendButton = document.getElementById('send_but');\n        if (sendButton) {\n          sendButton.addEventListener(\n            'click',\n            function (e) {\n              // \n              restoreDiceResultBeforeSend();\n            },\n            true, // \n          );\n        }\n\n        // jQuery\n        $(document)\n          .off('click.acu_restore_dice', '#send_but')\n          .on('click.acu_restore_dice', '#send_but', function (e) {\n            // \n            restoreDiceResultBeforeSend();\n          });\n\n        // \n        const textarea = document.getElementById('send_textarea');\n        if (textarea) {\n          textarea.addEventListener(\n            'keydown',\n            function (e) {\n              //  ShiftShift+Enter \n              if (e.key === 'Enter' && !e.shiftKey) {\n                // \n                restoreDiceResultBeforeSend();\n              }\n            },\n            true, // \n          );\n        }\n\n        $('#send_textarea')\n          .off('keydown.acu_restore_dice')\n          .on('keydown.acu_restore_dice', function (e) {\n            //  ShiftShift+Enter \n            if (e.key === 'Enter' && !e.shiftKey) {\n              // \n              restoreDiceResultBeforeSend();\n            }\n          });\n\n        // [] /\n        const observer = new MutationObserver(() => {\n          const $ta = $('#send_textarea');\n          if ($ta.length && !$ta[0]._acuValueIntercepted) {\n            interceptTextareaValue();\n          }\n        });\n        observer.observe(document.body, { childList: true, subtree: true });\n      };\n\n      // []  ( ST  -> )\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      // \n      const evtName =\n        ST?.eventTypes?.MESSAGE_SENT || (window.tavern_events ? window.tavern_events.MESSAGE_SENT : 'message_sent');\n\n      // 1.  ST.eventSource ()\n      if (ST?.eventSource) {\n        ST.eventSource.on(evtName, hideOptionPanel);\n        // [] \n        ST.eventSource.on(evtName, () => {\n          // DOM\n          setTimeout(() => {\n            hideDiceResultsInUserMessages();\n          }, 100);\n        });\n        setupSendButtonListener();\n        return;\n      }\n\n      // 2.  eventOn (TavernHelper )\n      if (typeof window.eventOn === 'function') {\n        window.eventOn(evtName, hideOptionPanel);\n        // [] \n        window.eventOn(evtName, () => {\n          // DOM\n          setTimeout(() => {\n            hideDiceResultsInUserMessages();\n          }, 100);\n        });\n        setupSendButtonListener();\n        return;\n      }\n    };\n\n    // \n    setTimeout(setupOptionHideListener, 2000);\n\n    // [] \n    setTimeout(() => {\n      interceptTextareaValue();\n    }, 500);\n\n    // [] ERA\n    const eventOn = window.eventOn || window.parent?.eventOn;\n    if (typeof eventOn === 'function') {\n      eventOn('era:writeDone', detail => {\n        //  ERA \n        if (typeof MvuModule === 'object' && typeof MvuModule.clearCache === 'function') {\n          MvuModule.clearCache();\n        }\n\n        // ERA\n        const mode = MvuModule.detectMode();\n        if (mode === 'era' && getActiveTabState() === MvuModule.MODULE_ID) {\n          console.log('[DICE]ERA');\n          renderInterface();\n        }\n      });\n    } else {\n      console.warn('[DICE] ERA eventOn ');\n    }\n\n    // [] \n    $(window)\n      .off('beforeunload.acu pagehide.acu')\n      .on('beforeunload.acu pagehide.acu', () => {\n        try {\n          localStorage.setItem(STORAGE_KEY_SCROLL, JSON.stringify(tableScrollStates));\n          if (observer) {\n            observer.disconnect();\n            observer = null;\n          }\n        } catch (e) {}\n      });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  // window.testPairedTableFix()\n  window.testPairedTableFix = function () {\n    // \n    const prefix = 'AM';\n    const startFrom = 1;\n    const columnName = '';\n\n    // 1AM001, AM002, (), AM030, ()\n    // AM001, AM002, AM030\n    const table1Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        ['AM001', '1', '1'],\n        ['AM002', '2', '2'],\n        [null, '3-', '3-'], // \n        ['AM030', '4', '4'],\n        [null, '5-', '5-'], // \n      ],\n    };\n\n    // 2(), AM002, AM030, AM040, AM050\n    // AM002, AM030, AM040, AM050\n    const table2Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        [null, 'A-', 'A-'], // \n        ['AM002', 'B', 'B'],\n        ['AM030', 'C', 'C'],\n        ['AM040', 'D', 'D'],\n        ['AM050', 'E', 'E'],\n      ],\n    };\n\n    // \n    const extract1 = extractCodesFromTable(table1Sheet, columnName, prefix);\n    const extract2 = extractCodesFromTable(table2Sheet, columnName, prefix);\n\n    // \n    const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n    // \n    const rawData = {};\n    const result = alignAndFixPairedTables(\n      table1Sheet,\n      'sheet1',\n      table2Sheet,\n      'sheet2',\n      columnName,\n      mapping,\n      prefix,\n      startFrom,\n      rawData,\n    );\n\n    // \n    const getValidCodes = sheet =>\n      sheet.content\n        .slice(1)\n        .map(r => r[0])\n        .filter(c => c && String(c).match(new RegExp(`^${prefix}\\\\d+$`)));\n\n    const codes1 = getValidCodes(table1Sheet);\n    const codes2 = getValidCodes(table2Sheet);\n\n    // \n    const emptyRows1 = table1Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix}\\\\d+$`)));\n    const emptyRows2 = table2Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix}\\\\d+$`)));\n\n    // \n    const validateSequence = (codes, prefix, startFrom) => {\n      const numbers = codes\n        .map(c => {\n          if (!c) return null;\n          const match = c.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          return match ? parseInt(match[1], 10) : null;\n        })\n        .filter(n => n !== null);\n\n      for (let i = 0; i < numbers.length; i++) {\n        if (numbers[i] !== startFrom + i) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    const isValid1 = validateSequence(codes1, prefix, startFrom);\n    const isValid2 = validateSequence(codes2, prefix, startFrom);\n\n    // \n    const set1 = new Set(codes1);\n    const set2 = new Set(codes2);\n    const setsEqual = set1.size === set2.size && [...set1].every(c => set2.has(c));\n\n    // \n    const emptyRowsPreserved1 = emptyRows1.some(r => r[1] && r[1].includes(''));\n    const emptyRowsPreserved2 = emptyRows2.some(r => r[1] && r[1].includes(''));\n\n    return {\n      table1Sheet,\n      table2Sheet,\n      result,\n      codes1,\n      codes2,\n      emptyRows1,\n      emptyRows2,\n      isValid1,\n      isValid2,\n      setsEqual,\n      emptyRowsPreserved1,\n      emptyRowsPreserved2,\n      //  +  + \n      isValid: isValid1 && isValid2 && setsEqual && emptyRowsPreserved1 && emptyRowsPreserved2,\n    };\n  };\n\n  // \n  window.diagnoseDiceVariables = async function () {\n    if (typeof MvuModule !== 'undefined' && typeof MvuModule.diagnoseVariableFramework === 'function') {\n      return await MvuModule.diagnoseVariableFramework();\n    } else {\n      console.error('[DICE]MvuModule ');\n      return null;\n    }\n  };\n\n  const { $ } = getCore();\n  if ($) $(document).ready(init);\n  else window.addEventListener('load', init);\n})();\n"],"names":["SCRIPT_ID","LockManager","STORAGE_KEY_PREFIX","MAX_CONTEXTS","PRIMARY_KEYS","_cache","_currentContextId","_getStorageKey","ctxId","this","getCurrentContextFingerprint","_cleanupOldContexts","prefix","allKeys","i","localStorage","length","key","startsWith","push","keyWithTime","map","data","JSON","parse","getItem","time","_lastAccess","sort","a","b","toDelete","slice","forEach","item","removeItem","console","log","e","warn","_load","stored","_save","dataToSave","Date","now","setItem","stringify","getRowKey","tableName","row","headers","pkField","fieldIndex","idx","indexOf","lockField","rowKey","fieldName","value","_fullRow","_fields","_snapshot","lockRow","rowData","snapshot","h","unlockField","lock","Object","keys","unlockRow","isFieldLocked","hasOwnProperty","isRowLocked","applyLocks","tableContent","tableLocks","modified","restored","rowIndex","entries","undefined","newRow","_rebuildRow","fields","field","colIdx","Array","fill","getLockedFields","clearCurrentContext","BookmarkManager","isBookmarked","toggleBookmark","getBookmarks","escapeHtml","s","String","replace","smartInsertToTextarea","newContent","contentType","getCore","$ta","$","currentVal","val","trim","normalDiceRegex","contestDiceRegex","actionRegex","placeholderRegex","diceCfg","getDiceConfig","contentToInsert","shouldSaveOriginal","hideDiceResultFromUser","trigger","workingText","existingAction","existingDice","existingDiceOriginal","test","originalText","contestMatches","match","normalMatches","actionMatches","userInput","parts","finalVal","join","restoreDiceResultBeforeSend","includes","restoredVal","removeData","interceptTextareaValue","textarea","_acuValueIntercepted","originalDescriptor","getOwnPropertyDescriptor","HTMLTextAreaElement","prototype","originalValue","defineProperty","get","call","_value","set","configurable","STORAGE_KEY_TABLE_ORDER","STORAGE_KEY_ACTION_ORDER","STORAGE_KEY_PENDING_DELETIONS","STORAGE_KEY_ACTIVE_TAB","STORAGE_KEY_UI_CONFIG","STORAGE_KEY_LAST_SNAPSHOT","STORAGE_KEY_IS_COLLAPSED","STORAGE_KEY_DASHBOARD_ACTIVE","STORAGE_KEY_TABLE_HEIGHTS","STORAGE_KEY_TABLE_STYLES","STORAGE_KEY_HIDDEN_TABLES","STORAGE_KEY_REVERSE_TABLES","MIN_PANEL_HEIGHT","MAX_PANEL_HEIGHT","STORAGE_KEY_DICE_CONFIG","STORAGE_KEY_ATTRIBUTE_PRESETS","STORAGE_KEY_ACTIVE_ATTR_PRESET","PRESET_FORMAT_VERSION","compareVersion","v1","v2","normalizeVersion","v","nv1","nv2","parts1","split","Number","parts2","Math","max","p1","p2","STORAGE_KEY_AVATAR_MAP","ConsoleCaptureManager","logs","maxLogs","filters","info","error","originalMethods","isIntercepted","enabled","restore","enable","intercept","disable","emergencyBtn","document","getElementById","style","display","type","self","args","apply","capture","timestamp","timeStr","toLocaleTimeString","hour12","content","arg","stack","Error","logEntry","id","random","rawArgs","shift","clear","getFilteredLogs","filter","setFilters","ErrorHandler","errorCount","errorThreshold","lastErrorTime","errorWindow","fatalErrorDetected","isFatalError","source","lineno","colno","thirdPartyPatterns","errorInfo","errorSource","pattern","corePatterns","isCoreError","handleError","triggerFatalError","showEmergencyButton","btn","createElement","innerHTML","cssText","onmouseenter","background","transform","onmouseleave","onclick","window","showDebugConsoleModal","alert","body","appendChild","checkAndRestore","onerror","message","addEventListener","event","reason","STORAGE_KEY_VALIDATION_ENABLED","STORAGE_KEY_VALIDATION_MODE","RULE_TYPE_INFO","tableReadonly","name","scope","icon","desc","rowLimit","sequence","required","format","enum","numeric","relation","keyValue","BUILTIN_VALIDATION_RULES","description","builtin","targetTable","targetColumn","ruleType","config","startFrom","errorMessage","values","min","refTable","refColumn","valueType","valueMin","valueMax","STORAGE_KEY_BLACKLIST","STORAGE_KEY_BLACKLIST_VERSION","DEFAULT_BLACKLIST","BlacklistManager","getBlacklist","Store","storedVersion","isArray","Set","defaultItems","mergedItems","has","setBlacklist","list","resetToDefault","isBlacklisted","blacklist","lastPart","some","STORAGE_KEY_PRESETS","STORAGE_KEY_ACTIVE_PRESET","PresetManager","getAllPresets","_initDefaultPreset","needsSave","preset","version","_compareVersion","customRules","rules","r","builtinRuleIds","mergedRules","rule","ValidationRuleManager","clearCache","getActivePreset","presets","activeId","find","p","setActivePreset","createPreset","newPreset","createdAt","toISOString","duplicatePreset","deletePreset","filtered","updatePresetRules","exportPreset","mergePresetWithDefaults","presetId","builtinRuleMap","Map","processedCustomIds","newRule","existingRule","add","importPreset","json","autoMerge","importedVersion","needsMerge","_getBuiltinRulesVersion","rulesStr","hash","charCodeAt","toString","currentVersion","defaultPreset","_builtinVersion","oldCustom","resetDefaultPreset","_enabledCache","getAllRules","enabledStates","getEnabledStates","allRules","toggleRuleEnabled","ruleId","states","toggleRuleIntercept","getEnabledRules","addCustomRule","removeCustomRule","index","findIndex","splice","updateCustomRule","updates","getRulesByTable","ValidationEngine","validateFormat","RegExp","validateEnum","allowedValues","validateNumeric","strVal","numVal","endsWith","parseFloat","isNaN","validateRelation","rawData","refSheet","sheetId","columns","col","refColIndex","validateRequired","validateKeyValue","ruleConfig","processedValue","pairs","pair","colonIndex","substring","validateTableReadonly","oldContent","validateRowLimit","rowCount","validateSequence","sheet","columnName","rows","colIndex","numbers","allRowValues","rawValue","strValue","regex","num","parseInt","n","size","expectedNum","checkTableRules","newData","violations","typeInfo","oldSheet","newSheet","padStart","rowIdx","validateValue","currentValue","validateRow","errors","rowTitle","ruleName","severity","validateAllData","allErrors","tableRules","fieldRules","rowErrors","validateTable","targetSheet","groupErrorsByTable","grouped","getErrorCount","LocalAvatarDB","DB_NAME","STORE_NAME","DB_VERSION","_db","_urlCache","init","Promise","resolve","reject","request","indexedDB","open","onsuccess","result","onupgradeneeded","db","target","objectStoreNames","contains","createObjectStore","keyPath","save","blob","store","transaction","objectStore","URL","revokeObjectURL","delete","updatedAt","put","url","createObjectURL","getKey","getAllNames","getAllKeys","getStats","getAll","items","totalSize","reduce","sum","count","totalSizeMB","toFixed","clearAll","getPlayerName","cachedRawData","getTableData","getPersonaName","w","parent","SillyTavern","getContext","ctx","name1","jQuery","$persona","first","text","getDisplayPlayerName","replaceUserPlaceholders","displayName","AvatarManager","load","raw","offsetX","offsetY","scale","aliases","getAsync","playerName","isPlayer","localUrl","userLocalUrl","primaryName","getPrimaryName","aliasLocalUrl","hasLocalAvatar","async","getOffsetX","_resolveByAlias","getOffsetY","getScale","setPosition","setScale","setAliases","remove","exportData","exportTime","avatars","importData","jsonData","overwriteConflicts","current","stats","added","updated","skipped","imported","analyzeImport","valid","total","newItems","conflicts","MvuModule","MODULE_ID","cachedEraData","detectMode","_source","eventEmit","eventOn","Mvu","getMvuData","getEraData","timeoutId","setTimeout","eventOff","onResult","detail","clearTimeout","statData","statWithoutMeta","stat_data","delta_data","schema","isAvailable","getData","allVars","message_id","display_data","getMvuDataWithRetry","maxRetries","retryDelay","waitGlobalInitialized","attempt","isVWD","isSimpleArray","every","countChildren","k","extractNumericDisplayValue","str","rangeMatch","slashNumericMatch","commaDescMatch","numericDescMatch","extractFirstNumericValue","displayValue","renderRow","path","deltaData","changeIndicator","part","oldVal","newVal","getChangeIndicator","changedClass","valueClass","diceIconHtml","isNumericCell","numericValue","attrName","pathParts","renderCard","depth","defaultExpanded","isHorizontal","childCount","collapsedClass","bodyHtml","hasNestedCards","nestedCardCount","childKey","childValue","childPath","itemPath","countText","bodyClass","nestedCardsNeedWidth","getDataWithRetry","detection","eraData","race","_","mode","mvuData","detectModeWithData","diagnoseVariableFramework","era","available","dataAvailable","mvu","apiExists","getDataExists","cache","hasCache","cacheKeys","recommendation","injectStyles","targetDoc","styleEl","textContent","head","renderNavButton","isActive","renderPanel","isEraMode","isNumericMode","layoutMode","panelTitle","numericHtml","visibleLevels","saved","numericItems","collectNumericItems","obj","levelNames","itemValue","numValue","newLevelNames","topKeys","filteredNumericItems","lastLevelKey","nonArrayLevels","level","allLevelNames","levelNamesArray","from","levelTogglesHtml","theme","getThemeColors","buttonTextColor","buttonTextOnAccent","textMain","levelButtonsHtml","levelName","isVisible","activeStyle","itemsHtml","pathLevels","hierarchyLevels","allLevelsVisible","pathDisplay","finalAttrName","displayStyle","levelsJson","renderNumericMode","cardsHtml","bindEvents","$container","$panel","off","on","stopPropagation","$card","closest","$body","is","hasClass","hide","removeClass","addClass","slideDown","slideUp","refresh","newMode","saveActiveTabState","currentTab","getActiveTabState","renderInterface","toastr","toggleClass","$button","css","color","borderColor","opacity","attr","each","$item","levels","newPathDisplay","$value","showEditDialog","newValue","success","setValue","preventDefault","$icon","attrValue","showDicePanel","targetValue","targetName","initiatorName","fromMvu","parsedInfo","initiator","candidates","filteredParts","parseMvuPathForDice","mvuPath","mvuParsedInfo","$doc","touchStartX","touchStartY","isHorizontalSwipe","originalEvent","touches","clientX","clientY","touch","deltaX","abs","deltaY","stopImmediatePropagation","$input","focus","button","handle","setPointerCapture","pointerId","startHeight","height","startY","onpointermove","moveE","dy","newHeight","onpointerup","upE","releasePointerCapture","getTableHeights","saveTableHeights","heights","onSave","html","getConfig","append","$overlay","select","ctrlKey","parsedValue","onWriteDone","setEraValue","setMvuVariable","is_recursive","replaceMvuData","isModuleTab","$refreshBtn","then","warning","catch","err","DEFAULT_DICE_CONFIG","critSuccessMax","hardSuccessDiv","difficultSuccessDiv","critFailMin","lastDiceType","dndCritSuccess","dndCritFail","contestTieRule","saveDiceConfig","cfg","oldCfg","newCfg","changedKeys","hideDiceResultsInUserMessages","shouldHide","textareaVal","modifiedText","contestRegex","normalRegex","lastMessageId","getLastMessageId","userMessages","getChatMessages","role","restoredCount","msg","$msgElement","retrieveDisplayedMessage","$mesText","BUILTIN_ATTRIBUTE_PRESETS","baseAttributes","formula","range","modifier","specialAttributes","AttributePresetManager","presetVersion","finalId","updatePreset","exported","jsonStr","autoUpdate","needsUpdate","rollDiceExpression","expr","NaN","countStr","sidesStr","keepDrop","sides","rolls","floor","rollDice","kd","toLowerCase","generateAttributeValue","context","varNames","Function","round","evaluateFormula","DASHBOARD_TABLE_CONFIG","global","tableKeywords","detailLocation","keywords","fallbackIndex","currentLocation","player","status","position","attrs","isMultiple","money","resources","location","npc","inScene","quest","progress","active","column","excludeColumn","excludes","bag","skill","equip","isEquipped","equipped","DashboardDataParser","findTable","allTables","moduleKey","keyword","findColumnIndex","columnKey","moduleConfig","colConfig","kw","getValue","getColumnMap","colKey","parseRows","tableResult","colMap","parsed","_rowIndex","_raw","applyFilter","parsedRows","filterKey","matchInclude","inc","excludeValue","matchExclude","exc","DEFAULT_GM_CONFIG","diceSystem","showDiceIcon","autoSendPrompt","action_groups","table_keywords","actions","label","template","auto_send","THEME_COLORS","retro","bgPanel","border","textSub","btnBg","btnHover","accent","tableHead","successText","successBg","inputBg","inputText","placeholderText","btnActiveBg","btnActiveText","failureText","failureBg","warningText","warningBg","critSuccessText","critSuccessBg","critFailureText","critFailureBg","extremeSuccessText","extremeSuccessBg","overlayBg","overlayBgLight","shadowBg","lightBg","veryLightBg","buttonText","grayBg","errorText","errorBg","errorBorder","warningIcon","dark","modern","forest","ocean","cyber","buttonBg","buttonBgActive","presetButtonBg","presetButtonBgActive","nightowl","sakura","minepink","purple","wechat","educational","galgame","vaporwave","classicpackaging","isLightTheme","getResultBadgeStyle","resultType","t","styles","critSuccess","bg","extremeSuccess","failure","critFailure","padding","getActionsForTable","lowerName","group","extractNumericValue","matches","parseAttributeString","results","rawStr","jsonObj","parseRelationshipString","trimmed","colonMatch","parenMatch","isRelationshipCell","headerName","lowerHeader","processTemplate","cardData","header","ACTION_BUTTONS","title","isInitialized","isSaving","isEditingOrder","isSettingsOpen","currentDiffMap","observer","_boundRenderHandler","hasUnsavedChanges","tablePageStates","tableSearchStates","lastOptionHash","optionPanelVisible","STORAGE_KEY_SCROLL","tableScrollStates","UpdateController","_lastValidationCount","_isRollingBack","handleUpdate","loadSnapshot","api","getDB","fillTable","timeOut","positionClass","fillError","newCount","updateValidationIndicator","$indicator","show","getCurrentChatId","chatId","DEFAULT_CONFIG","layout","collapseStyle","collapseAlign","fontFamily","cardWidth","fontSize","highlightNew","itemsPerPage","actionsPosition","gridColumns","positionMode","showOptionPanel","clickOptionToAutoSend","optionFontSize","FONTS","THEMES","_coreCache","core","AutoCardUpdaterAPI","clipboard","navigator","ST","top","updateSaveButtonState","$btn","deletions","getPendingDeletions","hasDeletions","getIconForTableName","getBadgeStyle","def","retryErr","_acuQuotaAlerted","savePendingDeletions","getSavedTableOrder","saveTableOrder","getCollapsedState","saveCollapsedState","currentCtx","_contextId","saveSnapshot","getTableStyles","getHiddenTables","getReverseTables","toggleTableReverse","getAttributesForCharacter","characterName","isUser","sheetName","nameColIdx","getAttributeValue","found","STANDARD_ATTRS","getStandardAttrs","getRandomSkillPool","allAttrs","allPresets","RANDOM_SKILL_POOL","generateRPGAttributes","isDNDOrPreset","isDND","generate3d6","generateValue","base","adjust","special","baseResult","specialResult","clearPresetAttributesForCharacter","charName","targetRowIndex","targetColIndex","sheetKey","existingStr","existingAttrs","standardAttrs","presetAttrNames","newAttrString","saveDataOnly","attrString","writeAttributesToCharacter","newAttrs","existingMap","standardCount","isComplete","customAttrs","resultParts","writtenAttrs","wasComplete","getFullAttributesForCharacter","initCustomDropdown","options","themeColors","inputId","substr","wrap","$dropdown","after","renderItems","lowerFilter","opt","hideDropdown","addClearButton","inputSelector","$clearBtn","showDiceSettingsPanel","ruleTitle","resetText","defaults","critFail","hardDiv","extremeDiv","currentCritSuccess","currentCritFail","currentHardDiv","currentExtremeDiv","tieRule","cocExtraHtml","panelHtml","left","right","bottom","width","closePanel","click","$stepper","step","updateValue","getCurrentValue","getStepperValue","critSuccessVal","critFailVal","hardDivVal","extremeDivVal","resetStepper","defaultValue","savedDiceType","rawDataForList","diceCharacterList","diceAttrList","diceType","successCriteria","inputTextColor","inputStyle","overlay","defaultCriteria","panel","buildAttrButtons","$parentSection","prop","originalHtml","originalHandler","generated","baseAttrs","specialAttrs","confirm","shortName","candidate","buildCharButtons","skillPool","randomSkill","newAttrList","convertTargetForDice","currentTarget","fromDice","toDice","getMaxRoll","dice","fromMax","toMax","ratio","updateRuleMode","$targetInput","$difficultyWrapper","$row3","currentDiceType","newDice","suggestedCriteria","currentTargetVal","convertedVal","newMax","customDice","performDiceRoll","mod","modStr","isFinite","remaining","dicePattern","exec","diceResult","numberPattern","numMatch","parseModifier","criteria","difficulty","targetInputVal","attrInputVal","isAutoTarget","getDefaultTarget","formulaStr","maxRoll","finalValue","requiredTarget","difficultyLabel","difficultyDiv","isCritSuccess","isCritFailure","isSuccess","outcomeText","outcomeClass","extremeTarget","hardTarget","criteriaSymbol","displayOutcomeText","badgeStyle","badgeStyleStr","$rollBtn","judgeExpr","formulaText","attrValueInput","currentDice","initiatorNameVal","showContestPanel","initiatorValue","currentCriteria","opponentName","passedInitiatorName","passedInitiatorValue","passedOpponentValue","opponentValue","playerAttrs","opponentAttrs","characterList","contestAttrList","attrStr","targetType","$initAttrButtons","$oppAttrButtons","buildCharBtns","containerId","rebuildAttrBtns","aname","refreshedAttrs","initAttrs","oppAttrs","fullAttrs","getSuccessLevel","roll","performContestRoll","initValue","initName","initAttrName","getHalfMax","m","initValueInput","initTarget","initTargetInput","oppValue","oppName","oppAttrName","oppValueInput","oppTarget","oppTargetInput","winner","winnerColor","initResult","oppResult","initSuccess","oppSuccess","displayInitValue","displayOppValue","displayInitSuccessName","displayOppSuccessName","displayWinner","getResultTypeFromSuccess","initResultType","oppResultType","initBadgeStyle","oppBadgeStyle","winnerBadgeStyle","initBadgeStyleStr","oppBadgeStyleStr","winnerBadgeStyleStr","$resultDisplay","$resultInit","$resultOpp","$contestBtn","contestResultText","currentInitName","showPreviewCard","tableKey","cellValue","showRelationshipGraph","npcTable","nameIdx","relationIdx","npcTableKey","nodes","edges","resolveName","personaName","isExplicitUserVariant","isPersonaName","isPlayerName","resolveUserPlaceholder","resolvedPlayerName","playerTableKey","x","y","inSceneColIdx","rawNpcName","npcName","isInScene","inSceneVal","relationStr","rel","resolvedRelName","relRowIndex","ri","cleanedLabels","rawRel","commonRelations","specialSuffixMatch","lastChars","cleanRelation","existingEdge","combined","labelsFromSource","labelsFromTarget","nodeArr","connectionCount","node","edge","isMobileView","innerWidth","baseRadius","maxRadius","playerBaseRadius","radiusPerConnection","nodeSizeMultiplier","filterInScene","filterDirectOnly","getNodeRadius","nodeName","sqrt","radius","getLayoutCacheKey","loadLayoutCache","cacheKey","cached","layoutData","allNodesFound","vx","vy","runForceDirectedLayout","angle","PI","dist","cos","sin","nodeMap","iter","u","j","dx","distSq","force","fx","fy","maxSpeed","vMag","saveLayoutCache","panX","panY","$svg","$transform","$edgesGroup","$nodesGroup","$zoomDisplay","$nodeSizeDisplay","$wrapper","updateTransform","updateNodeSizeDisplay","zoomTo","newScale","centerX","centerY","oldScale","scaleChange","render","filteredNodes","directNodes","passInScene","passDirectOnly","getFilteredNodes","filteredNodeNames","filteredEdges","edgesHtml","edgeIdx","len","nx","ny","px","py","hasFromSource","l","hasFromTarget","sourceRadius","targetRadius","x1","y1","x2","y2","srcLabels","tgtLabels","srcSet","tgtSet","commonLabels","srcUnique","tgtUnique","markerStart","markerEnd","midX","midY","lineLen","lbl","offsetDir","offsetDist","safeOffset","relationEmojiMap","emoji","addRelationEmoji","truncateLabel","maxLen","truncated","labelsToShow","labelBaseX","labelBaseY","perpOffset","nodesHtml","nodeAvatar","indicatorRadius","indicatorOffset","inSceneIndicator","nodeDisplayName","scaleVal","charAt","highlightNode","connectedNodes","otherNode","connectedEdgeIndices","clearHighlight","maxTouchPoints","currentHighlightedNode","$node","startX","startTime","hasMoved","longPressTriggered","longPressTimer","vibrate","elapsed","isPanning","panStartX","panStartY","panStartPanX","panStartPanY","lastPinchDist","activePointerId","wrapperEl","svgEl","onpointerdown","cursor","rect","getBoundingClientRect","onpointercancel","onwheel","delta","hypot","passive","newDist","$nodeSizeSlider","$sliderSizeDisplay","$sliderContainer","$nodeSizeDisplayTrigger","sliderVisible","sliderHideTimer","hideSlider","resetSliderHideTimer","triggerRect","wrapperRect","showSlider","$filterInSceneBtn","$filterDirectOnlyBtn","updateFilterToggleStyles","$nodeSizeStepper","updateNodeSizeValue","newPercent","getCurrentPercent","clearLayoutCache","showAvatarManager","closeGraph","showAvatarCropModal","imageSource","existing","modalHtml","$modal","$image","containerEl","imageEl","updateImageStyle","backgroundSize","backgroundPosition","isDragging","startOffsetX","startOffsetY","sensitivity","pinchStartScale","pinchRatio","file","files","saveLocalAvatar","newUrl","onUpdate","resolveUserPlaceholderForAvatar","managerHtml","$manager","listHtml","userNode","otherNodes","userNodeForDisplay","currentUrl","hasLocal","displayUrl","sourceLabel","hasAvatar","buildList","bindAvatarEvents","refreshItem","$preview","aliasesStr","deleteLocalAvatar","Blob","href","download","removeChild","reader","FileReader","onload","evt","analysis","showImportConfirmDialog","readAsText","closeManager","onComplete","hasConflicts","conflictListHtml","dialogHtml","$dialog","closeDialog","overwrite","showCardEditModal","displayRow","inputsHtml","cell","dialog","adjustHeight","el","contentHeight","scrollHeight","overflowY","requestAnimationFrame","currentRow","hasChanges","saveDataToDatabase","_configCache","saveConfig","applyConfigStyles","generateDiffMap","currentData","lastData","diffSet","rIdx","newRows","oldRows","oldRow","cIdx","oldCell","fontVal","f","$styleTag","fontImport","cssVars","cls","$optContainer","addStyles","_acuStylesInjected","exportTableAsJson","sheetCount","tableData","skipRender","commitDeletes","$saveBtn","mate","jsonString","sizeInMB","stringifyError","importTableAsJson","apiError","errorMsg","acuModifiedSet","processJsonData","tables","rawContent","exportConfig","updateConfig","showAddValidationRuleModal","parentDialog","currentThemeClass","tableNames","updateSelectColor","$select","$colSelect","$pairedTableSelect","currentPairedValue","empty","refTableName","$refColSelect","isTableRule","valuesStr","refColumns","selectedColumns","pairedTable","$rulesList","ruleHtml","showSmartFixModal","snapshotValue","hasSnapshotValue","showTableRuleFixModal","inputHtml","smartSuggestHtml","examples","currentRowIndex","maxCount","getColumnExamples","suggestedValue","existingValues","prefixMatch","digits","codeIndex","existingNumbers","codeValue","maxNum","nextNum","numOnlyMatch","suggestFormatValue","currentNum","isOutOfRange","nearestValid","getNearestValidNumber","getRelationOptions","hasMultipleColumns","currentInvalidValue","valueExists","isValueInRelationTable","optionsHtml","reverseWriteHtml","issues","fixedPairs","fixedVal","hasIssue","originalVal","fixedValue","hasIssues","issuesHtml","issue","optionValue","refSheetId","targetColIdx","extractCodesFromTable","codes","allCodes","codeToRows","isValid","buildCodeMapping","codes1","codes2","allUniqueCodes","codeNumbers","code","mapping","oldCode","newCode","alignAndFixPairedTables","table1Sheet","table1SheetId","table2Sheet","table2SheetId","fixedCount1","fixedCount2","headers1","rows1","colIndex1","headers2","rows2","colIndex2","reverseMapping","sortedNewCodes","analyzeTable","codeRows","emptyRows","prevOldCode","nextOldCode","emptyRow","prevCode","nextCode","codeRow","analysis1","analysis2","buildNewRows","allOldCodes","codeRowMap","cr","isCodeRow","isInserted","codeRowIndex","nextNewCode","currentNewCode","currentOldCode","newRows1","newRows2","countCodeChanges","oldAnalysis","oldCodes","newCodes","contentHtml","actionBtns","changeCount","changeDetails","c","d","minRows","maxRows","currentRowCount","excessRows","isTooMany","isTooFew","fixSuggestions","originalRowIndex","numCountMap","duplicates","gaps","outOfOrder","actualNum","rowNum","occurrences","issueSet","g","o","fix","pairedTableAttr","pairedTableName","targetSheetId","pairedSheet","pairedSheetId","pairedHeaders","extract1","extract2","fixedCount","startRow","showBlacklistManagerModal","updateTextarea","uniqueItems","syncFromTextarea","input","existingSet","addedItems","which","closeModal","showAttributePresetManager","isDefaultActive","allPresetsHtml","isBuiltin","showSettingsModal","$toggle","$thisToggle","showAttributePresetEditor","filename","isEdit","existingPreset","defaultData","$jsonTextarea","updateJSON","not","savedFilters","renderLogs","filteredLogs","$logContainer","typeColors","typeIcons","logItem","updateCounts","checked","$status","newState","line","toUpperCase","TavernHelper","triggerSlash","safeContent","isSecureContext","writeText","textArea","setAttribute","setSelectionRange","successful","execCommand","refreshInterval","setInterval","clearInterval","expandedGroups","isGroupExpanded","groupId","SPECIAL_BUTTONS_CONFIG","tableManagerHtml","savedOrder","hiddenList","allItems","isSpecial","orderMap","isHidden","specialClass","chevron","hasIntercept","$group","$chevron","expanded","targetHeight","animate","currentHeight","outerHeight","newTheme","$list","dragState","element","timer","clearDragState","startDrag","targetItem","insertBefore","$dragged","$target","insertAfter","newOrder","unit","isCurrentlyActive","fadeOut","refreshPresetUI","prompt","renderInterfaceTimer","renderInterfacePending","_renderInterfaceImpl","$chat","mutationLock","MutationObserver","lastChild","children","last","wrapper","observe","childList","anyLockApplied","structuredClone","existingSnapshot","hasValidSnapshotData","$searchInput","activeTab","currentTabName","newHtml","renderTableContent","$virtualDom","replaceWith","bindOptionEvents","lastScrollX","lastScrollY","$oldContent","scrollLeft","scrollTop","orderedNames","concat","isCollapsed","layoutClass","finalGridCols","empty3","ceil","optionHtml","currentOptionHash","optionTables","buttonsHtml","hasBtns","optionValues","table","cellStr","encodeURIComponent","optionChanged","colStyleClass","alignClass","savedHeight","isDashboardActive","isChangesPanelActive","isMvuActive","finalSavedHeight","renderChangesPanel","renderDashboard","gridFixStyle","isChangesActive","isSimpleModeNav","changesCount","validationErrorCount","displayCount","showWarningIcon","navHiddenList","navSavedOrder","SPECIAL_NAV_ITEMS","extraClass","allNavItems","checkAvailable","activeClass","orderVal","warningIconHtml","$existing","insertHtmlToPage","injectIndependentOptions","bindChangesEvents","$newContent","savedState","inner","$targetTitle","htmlContent","$aiMes","$this","$targetMes","$targetBlock","getTargetContainer","optConfig","decodeURIComponent","createChatMessages","executeSlashCommandsWithOptions","cmd","sendResult","isError","isAborted","ta","sendBtn","enterEvent","Event","keyCode","bubbles","$textDiv","hasImage","targetIndex","eq","$oldWrapper","validationErrors","changes","rowChanges","oldValue","changedFields","isValidationMode","groupedErrors","collapsedGroups","tableErrors","ruleData","groupedChanges","tableChanges","change","oldShort","newShort","fieldDisplay","fieldCount","fieldNames","moreText","validationItemTouchStartPos","$targetCard","scrollIntoView","behavior","block","storageKey","changeType","refreshChangesPanel","restoredRow","showRowCompareEditModal","showChangeSingleFieldModal","showChangeEditModal","restoredData","updateChangesCount","finalHeight","$horizontalScroller","_touchStartX","_touchStartY","_scrollDirection","$span","hasOldValue","$textarea","fieldsHtml","isChanged","globalResult","playerResult","locationResult","npcResult","questResult","bagResult","skillResult","equipResult","playerParsed","allAttrsStr","playerRows","playerHeaders","globalDetailLocation","globalLocation","detailIdx","locIdx","currentPlaceName","npcTableName","npcParsed","inSceneNPCs","offSceneNPCs","npcData","allNPCs","questTableName","questParsed","activeQuestParsed","questTypeOrder","activeTasks","q","bagTableName","bagParsed","bagItems","skillTableName","skillParsed","skills","equipTableName","equipParsed","equippedItems","locationTableName","locationTableKey","locationParsed","resourcesStr","parsedResources","res","skillValue","hasNumeric","skillRowIndex","loc","areaName","isCurrent","npcIdx","isLastNpc","npcAvatar","avatarOffsetX","avatarOffsetY","avatarScale","avatarStyle","offSceneFilter","isLastBag","isLast","isMain","progressPercent","progressMatch","progressBar","loadedModules","Boolean","pendingDeletions","isGridMode","titleColIndex","processedRows","originalIndex","searchTerm","isReversed","isTableReversed","titleA","titleB","aHitTitle","bHitTitle","totalItems","totalPages","currentPage","startIdx","endIdx","rowsToRender","showReverseBtn","shouldShowReverseButton","reverseBtnHtml","realRowIdx","isPending","cardTitle","showDefaultIndex","titleCellId","isTitleModified","isRowNew","rowClass","validColIndices","isOddValidCount","cardBody","spanFullRow","rawHeaderName","safeStr","rawStrOriginal","invalidPlaceholders","hideLabel","splitRegex","isIdentityField","parsedAttrs","displayCell","validRelations","relHtml","attrsHtml","showDice","invalidTagValues","isDiffChanged","cellId","isUserModified","cellHighlight","lockRowKey","lockIcon","tableActions","actionsHtml","interactColIdx","invalidValues","interactOptions","existingLabels","iconMap","newActions","act","actIdx","cardLockRowKey","cardLockIcon","cardBookmarkRowKey","bookmarkIcon","saveCurrentTabState","$content","innerScrolls","currentState","scrollTimer","$navBtn","isPanelVisible","mvuSavedHeight","currentActiveTab","$cell","showCellMenu","$pageBtn","newPage","manualUpdate","searchTimeout","isComposing","selectionStart","selectionEnd","isFocus","activeElement","classList","$newInput","tName","actionIdx","$title","action","skillName","checkValue","attrValIdx","profIdx","promptText","overlayEl","setProperty","sendMessage","ev","isPlayerTable","playerAttrValue","locationName","itemName","taskName","npcAttrValue","npcParts","npcMatch","relations","borderStyle","cardHtml","backdrop","isModified","currentHeader","lockMenuHtml","menu","winWidth","winHeight","mWidth","outerWidth","mHeight","changedTouches","closeAll","fallbackCopy","$displayTarget","actOrd","dels","colCount","showConflictDialog","extendedTimeOut","closeButton","preventDuplicates","hasVisualizerNav","hasVisualizerDataDisplay","scripts","querySelectorAll","script","visualizerConfig","diceConfig","detectVisualizerConflict","disconnect","eventSource","events","eventTypes","triggers","CHAT_CHANGED","MESSAGE_SWIPED","MESSAGE_DELETED","MESSAGE_UPDATED","_acuBoundChatChangeHandler","_boundChatChangeHandler","removeListener","loop","registerTableUpdateCallback","registerTableFillStartCallback","_acuInitRetries","hideOptionPanel","setupSendButtonListener","sendButton","shiftKey","subtree","evtName","MESSAGE_SENT","tavern_events","testPairedTableFix","getValidCodes","emptyRows1","emptyRows2","isValid1","isValid2","set1","set2","setsEqual","emptyRowsPreserved1","emptyRowsPreserved2","diagnoseDiceVariables","ready"],"ignoreList":[],"sourceRoot":""}