{"version":3,"file":"stable.js","mappings":"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EAAOA,GAAQA,EAAKniB,KAC5Dsb,GACFshB,EAASx3B,IAAIkW,KAKZrpB,MAAMotB,KAAKud,EACpB,CAGA,MAAMC,EAAatT,GAAuBtmB,iBAAmB,GACvD25B,EAAW,IAAIz6B,IAAI26B,IAAqB,IA6B9C,OA1BI7qC,MAAMiQ,QAAQ26B,IAChBA,EAAWnuC,QAAQwV,IACZA,IAGDA,EAAEglB,gBAAkBj3B,MAAMiQ,QAAQgC,EAAEglB,iBACtChlB,EAAEglB,eAAex6B,QAAQyzB,IACvB,MAAM7G,EAA2B,iBAAT6G,EAAoBA,EAAOA,GAAQA,EAAKniB,KAC5Dsb,GACFshB,EAASx3B,IAAIkW,KAMfpX,EAAEolB,mBAAqBr3B,MAAMiQ,QAAQgC,EAAEolB,oBACzCplB,EAAEolB,kBAAkB56B,QAAQyzB,IAC1B,MAAM7G,EAA2B,iBAAT6G,EAAoBA,EAAOA,GAAQA,EAAKniB,KAC5Dsb,GACFshB,EAASx3B,IAAIkW,QAOhBrpB,MAAMotB,KAAKud,EACpB,CAAE,MAAOlW,GAEP,OADA73B,QAAQoM,MAAM,mCAAoCyrB,GAC3CoW,IAAqB,EAC9B,GAIIA,GAAoB,CAExB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KAEA,OACA,OACA,OACA,MACA,SACA,OACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,MACA,KACA,MAGA,MACA,KACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,MACA,MACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,KACA,SACA,KACA,KAGA,KACA,MACA,QACA,MACA,KACA,KACA,KACA,MACA,MACA,MACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,MACA,KACA,QACA,KACA,KACA,KACA,MACA,KACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,MACA,QACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OASIC,GAAwB,CAACC,OAAgBrrC,KAE7C,GAA6B,kBAAlBqrC,EAA6B,CACtC,MAAMC,EAAQD,EACRtP,EAAWF,GAASlzB,KAAKmxB,MAAMnxB,KAAKqC,SAAW6wB,GAAS,EACxD0P,EAAc,IAAMxP,EAAS,GAAKA,EAAS,GAAKA,EAAS,GAEzDyP,EAAgB,KACpB,GAAIF,EAAO,CACT,MAAMG,EAAOF,IACPG,EAAS3P,EAAS,GAAK,EAC7B,OAAOpzB,KAAKC,IAAI,EAAGD,KAAK+G,IAAI,GAAI+7B,EAAOC,GACzC,CAAO,CACL,MAAMD,EAAuB,EAAhBF,IACPG,EAAS3P,EAAS,IAAM,EAC9B,OAAOpzB,KAAKC,IAAI,EAAGD,KAAK+G,IAAI,GAAI+7B,EAAOC,GACzC,GAGIl0B,EAAS,CAAC,EAIhB,OAHAuzB,GAAehuC,QAAQyzB,IACrBhZ,EAAOgZ,GAAQgb,MAEVh0B,CACT,CAGA,MAAM/F,EAAS45B,GAAiBzT,GAAuBxlB,kBAGvD,IAAKX,EAAQ,CACX,MAAMsqB,EAAWF,GAASlzB,KAAKmxB,MAAMnxB,KAAKqC,SAAW6wB,GAAS,EACxD0P,EAAc,IAAMxP,E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GAAKA,GAAKA,EAAElF,OAAS,IAGzBymD,EAAkB,CACtB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,KACA,MACA,KACA,KACA,MAGF,OAAOp9C,EACJhJ,IAAIoW,IAIH,MAAMiwC,GAFNjwC,EAAIA,EAAErR,QAAQ,kBAAmB,IAAIwC,QAERqB,MAAM,kBAyCnC,IAHAwN,GAFAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GAHAA,GADAA,GADAA,GAHAA,GADAA,GADAA,GAPEA,EADEiwC,EACEA,EAAmB,GAGnBjwC,EAAErR,QAAQ,kDAAmD,KAI7DA,QAAQ,0BAA2B,KACnCA,QAAQ,wBAAyB,MACjCA,QAAQ,oBAAqB,KAG7BA,QAAQ,MAAO,KACfA,QAAQ,MAAO,KACfA,QAAQ,MAAO,KAGfA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,qBAAsB,OAC9BA,QAAQ,cAAe,OACvBA,QAAQ,qBAAsB,OAC9BA,QAAQ,eAAgB,OACxBA,QAAQ,eAAgB,OACxBA,QAAQ,iBAAkB,QAC1BA,QAAQ,iBAAkB,QAC1BA,QA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","sources":["src://tavern_helper_template/src//emoji-maps.ts","src://tavern_helper_template/src//index.ts"],"sourcesContent":["/**\n *  Emoji \n * emoji\n *\n * \n * 1. \"\"\"\"\n * 2. \"\"\"|\"\n * 3. emoji\"\"\"|\"\n * 4. \"\"\"\"\n * 5. //\n */\nexport const EMOJI_MAP: [RegExp, string][] = [\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/RiNG|LiveHouse/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/T/, ''],\n  [//, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [//, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [//, ''],\n  [//, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // //\n  // ============================================\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n\n  // \n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/SCP||/, ''],\n\n  // \n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // \n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // \n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/BOSS||/, ''],\n  [/|||/, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // ============================================\n  // \n  // ============================================\n  // \n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||||||/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n\n  // \n  [/||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n\n  // \n  [/|||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n\n  // \n  [//, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/||/, ''],\n\n  // \n  [/||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n\n  // \n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/||/, ''],\n  [//, ''],\n\n  // \n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n  [/|||/, ''],\n\n  // \n  [/|/, ''],\n  [/||/, ''],\n  [/||/, ''],\n\n  // \n  [/||/, ''],\n  [/|||/, ''],\n  [/||/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [//, ''],\n  [/|||/, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [//, ''],\n  [/||/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [//, ''],\n  [//, ''],\n  [/|/, ''],\n  [/|/, ''],\n\n  // \n  [/||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|/, ''],\n\n  // \n  [/||/, ''],\n  [/|/, ''],\n  [/|||/, ''],\n  [/|||||/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [/|/, ''],\n  [//, ''],\n  [/|||||/, ''],\n];\n\n// \nexport const LOCATION_EMOJI_MAP = EMOJI_MAP;\nexport const ELEMENT_EMOJI_MAP = EMOJI_MAP;\n","// @ts-nocheck\nimport { ELEMENT_EMOJI_MAP, LOCATION_EMOJI_MAP } from './emoji-maps';\n\n(function () {\n  'use strict';\n\n  const SCRIPT_ID = 'acu_visualizer_ui_v19_6_ai_overlay';\n  // ========================================\n  // LockManager - \n  // ========================================\n  const LockManager = {\n    STORAGE_KEY_PREFIX: 'acu_locked_fields_v2_',\n    MAX_CONTEXTS: 20, // \n\n    PRIMARY_KEYS: {\n      : null,\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n    },\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    //  N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) return;\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(`[DICE]LockManager  ${toDelete.length} `);\n        }\n      } catch (e) {\n        console.warn('[DICE]LockManager ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[DICE]LockManager ', e);\n      }\n    },\n\n    getRowKey(tableName, row, headers) {\n      const pkField = this.PRIMARY_KEYS[tableName];\n      if (pkField === null) return '_row_0';\n\n      let fieldIndex = 1;\n      if (pkField) {\n        const idx = headers.indexOf(pkField);\n        if (idx !== -1) fieldIndex = idx;\n      }\n\n      if (!row[fieldIndex]) return null;\n      return `${pkField || headers[fieldIndex]}=${row[fieldIndex]}`;\n    },\n\n    lockField(tableName, rowKey, fieldName, value) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n      if (!data[tableName][rowKey]) {\n        data[tableName][rowKey] = { _fullRow: false, _fields: {}, _snapshot: null };\n      }\n      data[tableName][rowKey]._fields[fieldName] = value;\n      this._save();\n    },\n\n    lockRow(tableName, rowKey, rowData, headers) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      const snapshot = {};\n      headers.forEach((h, i) => {\n        if (h && rowData[i] != null && rowData[i] !== '') {\n          snapshot[h] = rowData[i];\n        }\n      });\n\n      data[tableName][rowKey] = { _fullRow: true, _fields: {}, _snapshot: snapshot };\n      this._save();\n    },\n\n    unlockField(tableName, rowKey, fieldName) {\n      const data = this._load();\n      const lock = data[tableName]?.[rowKey];\n      if (!lock) return;\n\n      //  _snapshot \n      if (lock._fullRow && lock._snapshot) {\n        delete lock._snapshot[fieldName];\n        //  _snapshot \n        if (Object.keys(lock._snapshot).length === 0) {\n          delete data[tableName][rowKey];\n          if (Object.keys(data[tableName]).length === 0) {\n            delete data[tableName];\n          }\n        }\n      } else {\n        //  _fields \n        delete lock._fields[fieldName];\n        if (Object.keys(lock._fields).length === 0) {\n          delete data[tableName][rowKey];\n          if (Object.keys(data[tableName]).length === 0) {\n            delete data[tableName];\n          }\n        }\n      }\n      this._save();\n    },\n\n    unlockRow(tableName, rowKey) {\n      const data = this._load();\n      if (data[tableName]) {\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n        this._save();\n      }\n    },\n\n    isFieldLocked(tableName, rowKey, fieldName) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return false;\n      if (lock._fullRow) return lock._snapshot?.hasOwnProperty(fieldName);\n      return lock._fields?.hasOwnProperty(fieldName);\n    },\n\n    isRowLocked(tableName, rowKey) {\n      return this._load()[tableName]?.[rowKey]?._fullRow === true;\n    },\n\n    applyLocks(tableName, tableContent) {\n      const tableLocks = this._load()[tableName];\n      if (!tableLocks || !tableContent || tableContent.length < 2) {\n        return { modified: false, restored: [] };\n      }\n\n      const headers = tableContent[0];\n      const restored = [];\n      let modified = false;\n\n      // \n      const rowIndex = {};\n      for (let i = 1; i < tableContent.length; i++) {\n        const key = this.getRowKey(tableName, tableContent[i], headers);\n        if (key) rowIndex[key] = i;\n      }\n\n      for (const [rowKey, lock] of Object.entries(tableLocks)) {\n        const idx = rowIndex[rowKey];\n\n        if (idx === undefined) {\n          // \n          const newRow = this._rebuildRow(headers, lock);\n          if (newRow) {\n            tableContent.push(newRow);\n            restored.push(rowKey);\n            modified = true;\n          }\n          continue;\n        }\n\n        const row = tableContent[idx];\n        const fields = lock._fullRow ? lock._snapshot : lock._fields;\n\n        if (fields) {\n          for (const [field, value] of Object.entries(fields)) {\n            const colIdx = headers.indexOf(field);\n            if (colIdx !== -1 && row[colIdx] !== value) {\n              row[colIdx] = value;\n              modified = true;\n            }\n          }\n        }\n      }\n\n      return { modified, restored };\n    },\n\n    _rebuildRow(headers, lock) {\n      const fields = lock._fullRow ? lock._snapshot : lock._fields;\n      if (!fields || Object.keys(fields).length === 0) return null;\n\n      const row = new Array(headers.length).fill(null);\n      for (const [field, value] of Object.entries(fields)) {\n        const idx = headers.indexOf(field);\n        if (idx !== -1) row[idx] = value;\n      }\n      return row;\n    },\n\n    // \n    hasAnyLock(tableName, rowKey) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return false;\n      if (lock._fullRow) return true;\n      return Object.keys(lock._fields || {}).length > 0;\n    },\n\n    getLockedFields(tableName, rowKey) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return [];\n      if (lock._fullRow) return Object.keys(lock._snapshot || {});\n      return Object.keys(lock._fields || {});\n    },\n\n    // \n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  // ========================================\n  // BookmarkManager - \n  // ========================================\n  const BookmarkManager = {\n    STORAGE_KEY_PREFIX: 'acu_bookmarks_v1_',\n    MAX_CONTEXTS: 20, // bookmark\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    // bookmark N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) {\n          // \n          return;\n        }\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(\n            `[DICE]BookmarkManager  ${toDelete.length} bookmark ${this.MAX_CONTEXTS}  ${allKeys.length} `,\n          );\n        }\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[DICE]BookmarkManager ', e);\n      }\n    },\n\n    isBookmarked(tableName, rowKey) {\n      const data = this._load();\n      return !!(data[tableName] && data[tableName][rowKey]);\n    },\n\n    toggleBookmark(tableName, rowKey) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      if (data[tableName][rowKey]) {\n        // bookmark\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n      } else {\n        // bookmark\n        data[tableName][rowKey] = true;\n      }\n      this._save();\n    },\n\n    getBookmarks(tableName) {\n      const data = this._load();\n      if (!data[tableName]) return [];\n      return Object.keys(data[tableName]);\n    },\n\n    // bookmark\n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  const escapeHtml = s =>\n    String(s ?? '')\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n\n  // [] \n  const generateUniqueName = (baseName: string, existingNames: string[]): string => {\n    if (!existingNames.includes(baseName)) return baseName;\n    let counter = 2;\n    let newName = `${baseName} (${counter})`;\n    while (existingNames.includes(newName)) {\n      counter++;\n      newName = `${baseName} (${counter})`;\n    }\n    return newName;\n  };\n\n  // [] \n  const showPresetConflictDialog = (options: {\n    presetName: string;\n    presetType: string;\n    onOverwrite: () => void;\n    onRename: (newName: string) => void;\n    onCancel: () => void;\n    existingNames: string[];\n  }) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const t = getThemeColors();\n    const config = getConfig();\n    const suggestedName = generateUniqueName(options.presetName, options.existingNames);\n\n    const dialogHtml = `\n      <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n        <div class=\"acu-import-confirm-dialog\">\n          <div class=\"acu-import-confirm-header\">\n            <i class=\"fa-solid fa-file-import\"></i> ${options.presetType}\n          </div>\n          <div class=\"acu-import-confirm-body\">\n            <div class=\"acu-import-warning-container\">\n              <i class=\"fa-solid fa-exclamation-triangle acu-import-warning-icon\"></i>\n              <div class=\"acu-import-warning-title\"></div>\n              <div class=\"acu-import-warning-message\">${escapeHtml(options.presetName)}</div>\n            </div>\n            <div class=\"acu-import-conflict-options\">\n              <label class=\"acu-import-radio\">\n                <input type=\"radio\" name=\"preset-conflict-mode\" value=\"overwrite\" checked />\n                <span></span>\n              </label>\n              <label class=\"acu-import-radio\">\n                <input type=\"radio\" name=\"preset-conflict-mode\" value=\"rename\" />\n                <span>${escapeHtml(suggestedName)}</span>\n              </label>\n            </div>\n          </div>\n          <div class=\"acu-import-confirm-footer\">\n            <button class=\"acu-import-cancel-btn\"></button>\n            <button class=\"acu-import-confirm-btn\"></button>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n      position: fixed !important;\n      top: 0 !important;\n      left: 0 !important;\n      right: 0 !important;\n      bottom: 0 !important;\n      width: 100vw !important;\n      height: 100vh !important;\n      background: rgba(0,0,0,0.6) !important;\n      z-index: 2147483655 !important;\n      display: flex;\n      justify-content: center !important;\n      align-items: center !important;\n      padding: 16px;\n      box-sizing: border-box !important;\n    `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(() => {\n      closeDialog();\n      options.onCancel();\n    });\n\n    $dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-import-confirm-overlay')) {\n        closeDialog();\n        options.onCancel();\n      }\n    });\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const mode = $dialog.find('input[name=\"preset-conflict-mode\"]:checked').val();\n      closeDialog();\n      if (mode === 'overwrite') {\n        options.onOverwrite();\n      } else {\n        options.onRename(suggestedName);\n      }\n    });\n  };\n  // [] \n  const smartInsertToTextarea = (newContent, contentType) => {\n    // contentType: 'action' ()  'dice' ()\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = ($ta.val() || '').trim();\n\n    // \n    // : \"XX\"\n    const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n    // \n    // : \"  vs    (...)  ......  (...)  .........\"\n    const contestDiceRegex =\n      /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n    // <user>\n    const actionRegex = /<user>(?:(?!<user>).)*?[]/g;\n\n    // \n    const placeholderRegex = /\\[\\]/g;\n\n    // [] \n    const diceCfg = getDiceConfig();\n    let contentToInsert = newContent;\n    let shouldSaveOriginal = false;\n    if (contentType === 'dice' && diceCfg.hideDiceResultFromUser) {\n      contentToInsert = '[]';\n      shouldSaveOriginal = true;\n    }\n\n    // \n    if (!currentVal) {\n      $ta.val(contentToInsert).trigger('input').trigger('change');\n      // []  data \n      if (contentType === 'dice') {\n        $ta.data('acu-original-dice-text', newContent);\n        // []  DOM  getter  jQuery\n        const textarea = $ta[0] as any;\n        textarea._acuOriginalDiceText = newContent;\n        textarea._acuHasDiceData = true;\n      }\n      return;\n    }\n\n    // \n    let workingText = currentVal;\n    let existingAction = '';\n    let existingDice = '';\n    let existingDiceOriginal = '';\n\n    // [] 0. \n    if (placeholderRegex.test(workingText)) {\n      // \n      const originalText = $ta.data('acu-original-dice-text') || '';\n      if (originalText) {\n        // \n        workingText = workingText.replace(placeholderRegex, originalText);\n        existingDice = originalText;\n        existingDiceOriginal = originalText;\n      } else {\n        // \n        workingText = workingText.replace(placeholderRegex, '').trim();\n      }\n    }\n\n    // 1. \n    const contestMatches = workingText.match(contestDiceRegex);\n    if (contestMatches && contestMatches.length > 0) {\n      existingDice = contestMatches[contestMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(contestDiceRegex, '\\u0000').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted contest roll:', existingDice);\n    }\n\n    // 2. \n    const normalMatches = workingText.match(normalDiceRegex);\n    if (normalMatches && normalMatches.length > 0) {\n      // \n      existingDice = normalMatches[normalMatches.length - 1];\n      existingDiceOriginal = existingDice;\n      workingText = workingText.replace(normalDiceRegex, '\\u0000').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted normal roll:', existingDice);\n    }\n\n    // 3. \n    const actionMatches = workingText.match(actionRegex);\n    if (actionMatches && actionMatches.length > 0) {\n      existingAction = actionMatches[actionMatches.length - 1];\n      workingText = workingText.replace(actionRegex, '\\u0001').trim();\n      console.log('[DICE]ACU SmartInsert Found and extracted action:', existingAction);\n    }\n\n    // 4. \n    let userInput = workingText\n      .replace(/[\\u0000\\u0001]/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .trim();\n\n    // 5. \n    if (contentType === 'dice') {\n      // [] \n      existingDice = contentToInsert;\n      existingDiceOriginal = newContent;\n      //  data \n      $ta.data('acu-original-dice-text', newContent);\n      // []  DOM  getter  jQuery\n      const textarea = $ta[0] as any;\n      textarea._acuOriginalDiceText = newContent;\n      textarea._acuHasDiceData = true;\n    } else if (contentType === 'action') {\n      existingAction = newContent;\n    }\n\n    // 6.  +  + \n    const parts = [];\n    if (userInput) parts.push(userInput);\n    if (existingAction) parts.push(existingAction);\n    if (existingDice) parts.push(existingDice);\n\n    const finalVal = parts.join(' ');\n    $ta.val(finalVal).trigger('input').trigger('change');\n  };\n\n  // [] \n  const restoreDiceResultBeforeSend = () => {\n    const { $ } = getCore();\n    const diceCfg = getDiceConfig();\n    const hideInput = diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n    if (hideInput) return;\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = $ta.val() || '';\n    const originalText = $ta.data('acu-original-dice-text');\n\n    // \n    if (currentVal.includes('[]') && originalText) {\n      const restoredVal = currentVal.replace(/\\[\\]/g, originalText);\n      $ta.val(restoredVal);\n      // \n      $ta.removeData('acu-original-dice-text');\n      // []  DOM \n      const textarea = $ta[0] as any;\n      textarea._acuOriginalDiceText = null;\n      textarea._acuHasDiceData = false;\n    }\n  };\n\n  // []  value \n  const interceptTextareaValue = () => {\n    const { $ } = getCore();\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const textarea = $ta[0] as HTMLTextAreaElement;\n    if (!textarea || (textarea as any)._acuValueIntercepted) return;\n\n    // \n    (textarea as any)._acuValueIntercepted = true;\n\n    //  value \n    const originalDescriptor = Object.getOwnPropertyDescriptor(HTMLTextAreaElement.prototype, 'value');\n    const originalValue = textarea.value;\n\n    //  value  getter\n    Object.defineProperty(textarea, 'value', {\n      get: function (this: HTMLTextAreaElement) {\n        // \n        let val: string;\n        if (originalDescriptor && originalDescriptor.get) {\n          val = originalDescriptor.get.call(this);\n        } else {\n          val = (this as any)._value || originalValue || '';\n        }\n\n        // [] \n        //  DOM  jQuery data getter  jQuery\n        //  ) \n        if (!(this as any)._acuHasDiceData) {\n          return val;\n        }\n\n        // \n        const originalText = (this as any)._acuOriginalDiceText;\n        if (val && typeof val === 'string' && val.includes('[]') && originalText) {\n          return val.replace(/\\[\\]/g, originalText);\n        }\n        return val;\n      },\n      set: function (this: HTMLTextAreaElement, val: string) {\n        if (originalDescriptor && originalDescriptor.set) {\n          originalDescriptor.set.call(this, val);\n        } else {\n          (this as any)._value = val;\n        }\n      },\n      configurable: true,\n    });\n  };\n  const STORAGE_KEY_TABLE_ORDER = 'acu_table_order';\n  const STORAGE_KEY_ACTION_ORDER = 'acu_action_order';\n  const STORAGE_KEY_PENDING_DELETIONS = 'acu_pending_deletions';\n  const STORAGE_KEY_ACTIVE_TAB = 'acu_active_tab';\n  const STORAGE_KEY_UI_CONFIG = 'acu_ui_config_v19';\n  const STORAGE_KEY_LAST_SNAPSHOT = 'acu_data_snapshot_v19';\n  const STORAGE_KEY_IS_COLLAPSED = 'acu_ui_collapsed_state';\n  const STORAGE_KEY_OPTIONS_COLLAPSED = 'acu_options_collapsed'; // [] \n  const STORAGE_KEY_DASHBOARD_ACTIVE = 'acu_dashboard_active';\n  // [] \n  const STORAGE_KEY_TABLE_HEIGHTS = 'acu_table_heights_v19';\n  const STORAGE_KEY_TABLE_STYLES = 'acu_table_styles_v19';\n  const STORAGE_KEY_HIDDEN_TABLES = 'acu_hidden_tables_v19';\n  const STORAGE_KEY_GM_CONFIG = 'acu_gm_engine_config_v1';\n  const STORAGE_KEY_REVERSE_TABLES = 'acu_reverse_tables_v1';\n  const MAX_ACTION_BUTTONS = 6; // \n  const MIN_PANEL_HEIGHT = 200; // \n  const MAX_PANEL_HEIGHT = 1200; // \n\n  const STORAGE_KEY_DICE_CONFIG = 'acu_dice_config_v1';\n  const STORAGE_KEY_ATTRIBUTE_PRESETS = 'acu_attribute_presets_v1';\n  const STORAGE_KEY_ACTIVE_ATTR_PRESET = 'acu_active_attr_preset_v1';\n  const STORAGE_KEY_CRAZY_MODE = 'acu_dice_crazy_mode';\n  const DEFAULT_CRAZY_MODE_CONFIG = {\n    enabled: false,\n    crazyLevel: 50,\n    playerWeight: 80,\n    inSceneNpcWeight: 15,\n    offSceneNpcWeight: 5,\n  };\n  const PRESET_FORMAT_VERSION = '1.4.0'; // \n  const SCRIPT_VERSION = 'v3.31'; // \n\n  //  \"x.y.z\"\n  const compareVersion = (v1, v2) => {\n    // \n    const normalizeVersion = v => {\n      if (typeof v === 'number') return `${v}.0.0`;\n      if (typeof v !== 'string') return '0.0.0';\n      return v;\n    };\n    const nv1 = normalizeVersion(v1);\n    const nv2 = normalizeVersion(v2);\n    const parts1 = nv1.split('.').map(Number);\n    const parts2 = nv2.split('.').map(Number);\n    for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {\n      const p1 = parts1[i] || 0;\n      const p2 = parts2[i] || 0;\n      if (p1 < p2) return -1;\n      if (p1 > p2) return 1;\n    }\n    return 0;\n  };\n\n  const STORAGE_KEY_AVATAR_MAP = 'acu_avatar_map_v1';\n  const STORAGE_KEY_MAP_FOCUS = 'acu_map_focus_v1';\n\n  // ========================================\n  // ConsoleCaptureManager - Console\n  // ========================================\n  const ConsoleCaptureManager = {\n    logs: [],\n    maxLogs: 1000,\n    filters: { log: true, info: true, warn: true, error: true },\n    originalMethods: {},\n    isIntercepted: false,\n    enabled: false, // \n\n    restore() {\n      //  localStorage \n      const saved = localStorage.getItem('acu_console_capture_enabled');\n      if (saved === 'true') {\n        this.enable();\n      }\n    },\n\n    enable() {\n      if (this.enabled) return;\n      this.enabled = true;\n      localStorage.setItem('acu_console_capture_enabled', 'true');\n      this.intercept();\n    },\n\n    disable() {\n      if (!this.enabled) return;\n      this.enabled = false;\n      localStorage.setItem('acu_console_capture_enabled', 'false');\n      // \n      localStorage.removeItem('acu_script_error_detected');\n      // \n      const emergencyBtn = document.getElementById('acu-emergency-debug-btn');\n      if (emergencyBtn) {\n        emergencyBtn.style.display = 'none';\n      }\n    },\n\n    intercept() {\n      if (this.isIntercepted) return;\n      this.isIntercepted = true;\n\n      ['log', 'info', 'warn', 'error'].forEach(type => {\n        this.originalMethods[type] = console[type];\n        const self = this;\n        console[type] = function (...args) {\n          // \n          self.originalMethods[type].apply(console, args);\n          // \n          if (self.enabled) {\n            self.capture(type, args);\n          }\n        };\n      });\n    },\n\n    capture(type, args) {\n      if (!this.enabled) return; // \n      try {\n        const timestamp = new Date();\n        const timeStr = timestamp.toLocaleTimeString('zh-CN', { hour12: false });\n\n        // \n        const content = args\n          .map(arg => {\n            if (typeof arg === 'object') {\n              try {\n                return JSON.stringify(arg, null, 2);\n              } catch {\n                return String(arg);\n              }\n            }\n            return String(arg);\n          })\n          .join(' ');\n\n        // error\n        let stack = null;\n        if (type === 'error' && args[0] instanceof Error) {\n          stack = args[0].stack || null;\n        }\n\n        const logEntry = {\n          id: Date.now() + Math.random(),\n          timestamp,\n          timeStr,\n          type,\n          content,\n          stack,\n          rawArgs: args,\n        };\n\n        this.logs.push(logEntry);\n\n        // \n        if (this.logs.length > this.maxLogs) {\n          this.logs.shift();\n        }\n      } catch (e) {\n        // console\n      }\n    },\n\n    clear() {\n      this.logs = [];\n    },\n\n    getFilteredLogs() {\n      return this.logs.filter(log => this.filters[log.type]);\n    },\n\n    setFilters(filters) {\n      this.filters = { ...this.filters, ...filters };\n    },\n  };\n\n  // \n  // ConsoleCaptureManager.intercept();\n\n  // ========================================\n  // \n  // ========================================\n  const ErrorHandler = {\n    errorCount: 0,\n    errorThreshold: 3, // 3\n    lastErrorTime: 0,\n    errorWindow: 5000, // 5\n    fatalErrorDetected: false,\n\n    // \n    isFatalError(error, source, lineno, colno, stack) {\n      // \n      const thirdPartyPatterns = [/jquery/i, /lodash/i, /vue/i, /react/i, /pixi/i, /gsap/i, /toastr/i, /node_modules/i];\n\n      const errorInfo = stack || error?.stack || '';\n      const errorSource = source || '';\n\n      // \n      for (const pattern of thirdPartyPatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          return false;\n        }\n      }\n\n      // \n      const corePatterns = [\n        /acu_visualizer/i,\n        //i,\n        /LockManager/i,\n        /Store/i,\n        /ConsoleCaptureManager/i,\n        /renderInterface/i,\n        /init\\s*\\(/i,\n      ];\n\n      let isCoreError = false;\n      for (const pattern of corePatterns) {\n        if (pattern.test(errorInfo) || pattern.test(errorSource)) {\n          isCoreError = true;\n          break;\n        }\n      }\n\n      // \n      return isCoreError;\n    },\n\n    // \n    handleError(error, source, lineno, colno, stack) {\n      try {\n        // \n        if (!this.isFatalError(error, source, lineno, colno, stack)) {\n          return; // \n        }\n\n        const now = Date.now();\n\n        // \n        if (now - this.lastErrorTime > this.errorWindow) {\n          this.errorCount = 0;\n        }\n\n        this.errorCount++;\n        this.lastErrorTime = now;\n\n        // \n        if (this.errorCount >= this.errorThreshold && !this.fatalErrorDetected) {\n          this.fatalErrorDetected = true;\n          this.triggerFatalError();\n        }\n      } catch (e) {\n        // \n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    triggerFatalError() {\n      try {\n        //  console \n        if (!ConsoleCaptureManager.enabled) {\n          ConsoleCaptureManager.enable();\n        }\n\n        // \n        localStorage.setItem('acu_script_error_detected', 'true');\n\n        // \n        this.showEmergencyButton();\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n\n    // \n    showEmergencyButton() {\n      try {\n        // \n        let btn = document.getElementById('acu-emergency-debug-btn');\n        if (btn) {\n          btn.style.display = 'block';\n          return;\n        }\n\n        // \n        btn = document.createElement('button');\n        btn.id = 'acu-emergency-debug-btn';\n        btn.innerHTML = '<i class=\"fa-solid fa-bug\"></i> ';\n        btn.style.cssText = `\n          position: fixed;\n          bottom: 20px;\n          right: 20px;\n          z-index: 99999;\n          padding: 10px 16px;\n          background: #e74c3c;\n          color: #fff;\n          border: none;\n          border-radius: 6px;\n          font-size: 14px;\n          font-weight: bold;\n          cursor: pointer;\n          box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);\n          display: flex;\n          align-items: center;\n          gap: 6px;\n          transition: all 0.2s;\n        `;\n\n        btn.onmouseenter = function () {\n          this.style.background = '#c0392b';\n          this.style.transform = 'scale(1.05)';\n        };\n        btn.onmouseleave = function () {\n          this.style.background = '#e74c3c';\n          this.style.transform = 'scale(1)';\n        };\n\n        btn.onclick = function () {\n          try {\n            //  showDebugConsoleModal\n            if (typeof window.showDebugConsoleModal === 'function') {\n              window.showDebugConsoleModal();\n            } else {\n              // \n              alert('F12');\n            }\n          } catch (e) {\n            console.error('[DICE]:', e);\n            alert('F12');\n          }\n        };\n\n        document.body.appendChild(btn);\n      } catch (e) {\n        console.error('[DICE]:', e);\n      }\n    },\n\n    // \n    checkAndRestore() {\n      try {\n        const errorDetected = localStorage.getItem('acu_script_error_detected') === 'true';\n        if (errorDetected) {\n          //  console \n          if (!ConsoleCaptureManager.enabled) {\n            ConsoleCaptureManager.enable();\n          }\n          // \n          this.showEmergencyButton();\n        }\n      } catch (e) {\n        console.error('[DICE]ErrorHandler :', e);\n      }\n    },\n  };\n\n  // \n  window.onerror = function (message, source, lineno, colno, error) {\n    ErrorHandler.handleError(error || message, source, lineno, colno, error?.stack);\n    return false; // \n  };\n\n  //  Promise \n  window.addEventListener('unhandledrejection', function (event) {\n    ErrorHandler.handleError(event.reason, null, null, null, event.reason?.stack);\n  });\n\n  // \n  //  init \n\n  // ========================================\n  //  -  (Phase 1.1)\n  // ========================================\n\n  /**\n   * \n   * - replace: \n   * - extract: ()\n   * - delete: \n   * - validate: (ValidationEngine,)\n   */\n  type RegexOperation = 'replace' | 'extract' | 'delete' | 'validate';\n\n  /**\n   * \n   * - global: \n   * - table: \n   * - column: \n   */\n  type RegexScopeType = 'global' | 'table' | 'column';\n\n  /**\n   * \n   * - auto: \n   * - manual: \n   * - preview: ,\n   */\n  type RegexExecutionMode = 'auto' | 'manual' | 'preview';\n\n  /**\n   * \n   */\n  interface RegexFlags {\n    caseInsensitive?: boolean; // i - \n    global?: boolean; // g - \n    multiline?: boolean; // m - \n    unicode?: boolean; // u - Unicode\n    sticky?: boolean; // y - \n  }\n\n  /**\n   * \n   */\n  interface RegexScopeConfig {\n    type: RegexScopeType;\n    tableNames?: string[]; // tablecolumn\n    columnNames?: string[]; // column\n  }\n\n  /**\n   * \n   */\n  interface RegexSecurityConfig {\n    maxMatchTime: number; // (),100\n    maxMatches: number; // ,1000\n    maxInputLength: number; // ,10000\n  }\n\n  /**\n   * \n   */\n  interface RegexTestCase {\n    input: string;\n    expected: string;\n    description?: string;\n  }\n\n  /**\n   * \n   */\n  interface RegexTransformationRule {\n    id: string; // \n    name: string; // \n    description?: string; // \n    operation: RegexOperation; // \n    pattern: string; // \n    flags?: RegexFlags; // \n    replacement?: string; // (replace)\n    scope: RegexScopeConfig; // \n    enabled: boolean; // \n    priority: number; // (1-100),\n    executeMode: RegexExecutionMode; // \n    testCases?: RegexTestCase[]; // \n    security?: RegexSecurityConfig; // \n    createdAt?: number; // \n    updatedAt?: number; // \n  }\n\n  /**\n   * \n   */\n  interface RegexTransformResult {\n    success: boolean;\n    oldValue: string;\n    newValue: string;\n    matched: boolean;\n    error?: string;\n  }\n\n  /**\n   * \n   */\n  interface RegexBatchTransformResult {\n    tableName: string;\n    columnIndex: number;\n    rowIndex: number;\n    result: RegexTransformResult;\n  }\n\n  /**\n   * \n   */\n  interface RegexPreviewResult {\n    rule: RegexTransformationRule;\n    affectedCells: Array<{\n      tableName: string;\n      rowIndex: number;\n      columnIndex: number;\n      columnName: string;\n      oldValue: string;\n      newValue: string;\n    }>;\n    totalAffected: number;\n  }\n\n  /**\n   * \n   */\n  interface RegexPreset {\n    id: string;\n    name: string;\n    description?: string;\n    version: string;\n    rules: RegexTransformationRule[];\n    createdAt?: number;\n    updatedAt?: number;\n  }\n\n  // \n  const STORAGE_KEY_REGEX_RULES = 'acu_regex_rules_v1';\n  const STORAGE_KEY_REGEX_PRESETS = 'acu_regex_presets_v1';\n  const STORAGE_KEY_REGEX_ACTIVE_PRESET = 'acu_regex_active_preset_v1';\n  const STORAGE_KEY_REGEX_ENABLED = 'acu_regex_enabled_v1';\n\n  // ========================================\n  //  (Phase 2.2)\n  // ========================================\n  const BUILTIN_REGEX_RULES: RegexTransformationRule[] = [\n    // 1: ()\n    {\n      id: 'builtin_trim_spaces',\n      name: '',\n      description: ',',\n      operation: 'replace',\n      pattern: '^\\\\s+|\\\\s+$|\\\\s+',\n      flags: { global: true },\n      replacement: ' ',\n      scope: { type: 'global' },\n      enabled: false,\n      priority: 10,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // 2: ()\n    {\n      id: 'builtin_normalize_quotes',\n      name: '',\n      description: '',\n      operation: 'replace',\n      pattern: '[\"]|[\\']',\n      flags: { global: true },\n      replacement: '\"',\n      scope: { type: 'global' },\n      enabled: false,\n      priority: 10,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n    // 3: ()\n    {\n      id: 'builtin_item_quality_format',\n      name: '',\n      description: '',\n      operation: 'replace',\n      pattern: '\\\\b(|||||)\\\\b',\n      flags: { global: true },\n      replacement: '$1',\n      scope: { type: 'column', tableNames: ['', ''], columnNames: [''] },\n      enabled: false,\n      priority: 50,\n      executeMode: 'auto',\n      security: { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n    },\n  ];\n\n  // ========================================\n  // ValidationRuleManager - \n  // ========================================\n  const STORAGE_KEY_VALIDATION_RULES = 'acu_validation_rules_v1';\n  const STORAGE_KEY_VALIDATION_ENABLED = 'acu_validation_enabled_v1';\n  const STORAGE_KEY_VALIDATION_MODE = 'acu_validation_mode'; // \n\n  //  UI \n  const RULE_TYPE_INFO = {\n    // \n    tableReadonly: { name: '', scope: 'table', icon: 'fa-lock', desc: '' },\n    rowLimit: { name: '', scope: 'table', icon: 'fa-arrows-up-down', desc: '' },\n    sequence: { name: '', scope: 'table', icon: 'fa-sort-numeric-up', desc: '' },\n    // \n    required: { name: '', scope: 'field', icon: 'fa-asterisk', desc: '' },\n    format: { name: '', scope: 'field', icon: 'fa-font', desc: '' },\n    enum: { name: '', scope: 'field', icon: 'fa-list', desc: '' },\n    numeric: { name: '', scope: 'field', icon: 'fa-hashtag', desc: '' },\n    relation: { name: '', scope: 'field', icon: 'fa-link', desc: '' },\n    keyValue: { name: '', scope: 'field', icon: 'fa-key', desc: '' },\n  };\n\n  // \n  const BUILTIN_VALIDATION_RULES = [\n    // \n    {\n      id: 'summary_code_sequence',\n      name: '',\n      description: 'AM0001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM0001',\n    },\n    // \n    {\n      id: 'outline_code_sequence',\n      name: '',\n      description: 'AM0001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'sequence',\n      config: { prefix: 'AM', startFrom: 1 },\n      errorMessage: 'AM0001',\n    },\n    // \n    {\n      id: 'summary_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'outline_code_required',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'required',\n      config: {},\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_priority_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'item_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_proficiency_range',\n      name: '',\n      description: ' 0-100 ',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'numeric',\n      config: { min: 0, max: 100 },\n      errorMessage: ' 0-100 ',\n    },\n    // \n    {\n      id: 'npc_presence_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_explore_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'intel_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'player_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // NPC\n    {\n      id: 'npc_location_relation',\n      name: 'NPC',\n      description: 'NPC',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'element_location_relation',\n      name: '',\n      description: '',\n      enabled: false,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'global_detail_location_relation',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    //  - \n    {\n      id: 'player_base_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_special_attributes_keyvalue',\n      name: '',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'player_relationships_keyvalue',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    //  - \n    {\n      id: 'npc_base_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_special_attributes_keyvalue',\n      name: 'NPC',\n      description: '[0,100]',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'numeric', valueMin: 0, valueMax: 100 },\n      errorMessage: '\":;:\"[0,100]',\n    },\n    //  - \n    {\n      id: 'npc_relationships_keyvalue',\n      name: 'NPC',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'keyValue',\n      config: { valueType: 'text' },\n      errorMessage: '\":;:\"',\n    },\n    //  - \n    {\n      id: 'quest_progress_format',\n      name: '',\n      description: '+%50%',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'format',\n      config: { pattern: '^\\\\d+%$' },\n      errorMessage: '+%50%100%',\n    },\n  ];\n\n  // ========================================\n  // BlacklistManager - MVU\n  // ========================================\n  const STORAGE_KEY_BLACKLIST = 'acu_filter_blacklist_v1';\n  const STORAGE_KEY_BLACKLIST_VERSION = 'acu_filter_blacklist_version';\n  const DEFAULT_BLACKLIST = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    'ID',\n    '',\n    '',\n    'measurements',\n    'ages',\n    '',\n    'order',\n    '',\n    'time',\n    'cost',\n  ];\n\n  const BlacklistManager = {\n    // \n    getBlacklist() {\n      const stored = Store.get(STORAGE_KEY_BLACKLIST, null);\n      const storedVersion = Store.get(STORAGE_KEY_BLACKLIST_VERSION, null);\n\n      // \n      if (!stored || !Array.isArray(stored)) {\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return [...DEFAULT_BLACKLIST];\n      }\n\n      // \n      if (!storedVersion || compareVersion(storedVersion, PRESET_FORMAT_VERSION) < 0) {\n        console.log(`[DICE]BlacklistManager  (${storedVersion || ''})`);\n\n        // \n        const userItems = new Set(stored);\n        const defaultItems = new Set(DEFAULT_BLACKLIST);\n        const mergedItems = [...DEFAULT_BLACKLIST]; // \n\n        // \n        stored.forEach(item => {\n          if (!defaultItems.has(item)) {\n            mergedItems.push(item);\n          }\n        });\n\n        // \n        Store.set(STORAGE_KEY_BLACKLIST, mergedItems);\n        Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n        return mergedItems;\n      }\n\n      return stored;\n    },\n\n    // \n    setBlacklist(list) {\n      if (!Array.isArray(list)) {\n        console.warn('[DICE]BlacklistManager ');\n        return false;\n      }\n      Store.set(STORAGE_KEY_BLACKLIST, list);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // \n    resetToDefault() {\n      Store.set(STORAGE_KEY_BLACKLIST, [...DEFAULT_BLACKLIST]);\n      Store.set(STORAGE_KEY_BLACKLIST_VERSION, PRESET_FORMAT_VERSION);\n      return true;\n    },\n\n    // key\n    //  \" >  >  > \" \"\"\n    isBlacklisted(key) {\n      if (!key || typeof key !== 'string') return false;\n      const blacklist = this.getBlacklist();\n      if (blacklist.length === 0) return false;\n\n      // key \">\"  \" > \"\n      const parts = key\n        .split(/>| > /)\n        .map(s => s.trim())\n        .filter(s => s);\n      const lastPart = parts.length > 0 ? parts[parts.length - 1] : key;\n\n      // key\n      return blacklist.some(item => lastPart.includes(item));\n    },\n  };\n\n  // ========================================\n  // PresetManager - \n  // ========================================\n  const STORAGE_KEY_PRESETS = 'acu_validation_presets_v1';\n  const STORAGE_KEY_ACTIVE_PRESET = 'acu_active_preset_id';\n\n  const PresetManager = {\n    _cache: null,\n\n    // \n    getAllPresets() {\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n      if (!stored) {\n        this._initDefaultPreset();\n        return this._cache;\n      }\n      // \n      let needsSave = false;\n      stored.forEach(preset => {\n        if (!preset.version || this._compareVersion(preset.version, PRESET_FORMAT_VERSION) < 0) {\n          console.log(\n            `[DICE]PresetManager  \"${preset.name}\"  (${preset.version || ''})`,\n          );\n          // \n          const customRules = preset.rules.filter(r => !r.builtin);\n          const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n          const mergedRules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r, builtin: true }))];\n          customRules.forEach(rule => {\n            const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n            if (!builtinRuleIds.has(key)) {\n              mergedRules.push({ ...rule, builtin: false });\n            }\n          });\n          preset.rules = mergedRules;\n          preset.version = PRESET_FORMAT_VERSION;\n          needsSave = true;\n        }\n      });\n      if (needsSave) {\n        this._save(stored);\n        ValidationRuleManager.clearCache();\n        // \n        this._cache = null;\n      }\n      // \n      if (!needsSave && this._cache) {\n        return this._cache;\n      }\n      this._cache = stored;\n      return stored;\n    },\n\n    // \n    getActivePreset() {\n      const presets = this.getAllPresets();\n      const activeId = Store.get(STORAGE_KEY_ACTIVE_PRESET, 'default');\n      return presets.find(p => p.id === activeId) || presets[0];\n    },\n\n    // \n    setActivePreset(id) {\n      if (!this.getAllPresets().find(p => p.id === id)) return false;\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, id);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    createPreset(name) {\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: name || '',\n        builtin: false,\n        rules: [],\n        version: PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    duplicatePreset(id) {\n      const source = this.getAllPresets().find(p => p.id === id);\n      if (!source) return null;\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: source.name + ' ()',\n        builtin: false,\n        rules: JSON.parse(JSON.stringify(source.rules)),\n        version: source.version || PRESET_FORMAT_VERSION,\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      console.log('[DICE]PresetManager :', source.name, '->', newPreset.name);\n      return newPreset;\n    },\n\n    //  id='default' \n    deletePreset(id) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset || preset.id === 'default') return false; // \n      const filtered = presets.filter(p => p.id !== id);\n      this._save(filtered);\n      if (Store.get(STORAGE_KEY_ACTIVE_PRESET) === id) {\n        Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n        ValidationRuleManager.clearCache();\n      }\n      console.log('[DICE]PresetManager :', id);\n      return true;\n    },\n\n    // \n    updatePresetRules(id, rules) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return false;\n      preset.rules = rules;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      return true;\n    },\n\n    // \n    exportPreset(id) {\n      const preset = this.getAllPresets().find(p => p.id === id);\n      if (!preset) return null;\n      const json = JSON.stringify(\n        {\n          format: 'acu_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          preset: { name: preset.name, rules: preset.rules },\n        },\n        null,\n        2,\n      );\n      return json;\n    },\n\n    // \n    _compareVersion(v1, v2) {\n      return compareVersion(v1, v2);\n    },\n\n    // \n    mergePresetWithDefaults(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) return false;\n\n      // \n      const customRules = preset.rules.filter(r => !r.builtin);\n      const builtinRuleIds = new Set(BUILTIN_VALIDATION_RULES.map(r => r.id || r.targetTable + '_' + r.ruleType));\n\n      // \n      const builtinRuleMap = new Map();\n      BUILTIN_VALIDATION_RULES.forEach(r => {\n        const key = r.id || r.targetTable + '_' + r.ruleType;\n        builtinRuleMap.set(key, r);\n      });\n\n      // \n      const mergedRules = [];\n      const processedCustomIds = new Set();\n\n      // 1. \n      BUILTIN_VALIDATION_RULES.forEach(newRule => {\n        const key = newRule.id || newRule.targetTable + '_' + newRule.ruleType;\n        const existingRule = preset.rules.find(r => (r.id || r.targetTable + '_' + r.ruleType) === key && r.builtin);\n        if (existingRule) {\n          // \n          const isModified = JSON.stringify(existingRule) !== JSON.stringify(newRule);\n          if (isModified) {\n            // \n            mergedRules.push({ ...existingRule, builtin: true });\n          } else {\n            // \n            mergedRules.push({ ...newRule, builtin: true });\n          }\n        } else {\n          // \n          mergedRules.push({ ...newRule, builtin: true });\n        }\n        processedCustomIds.add(key);\n      });\n\n      // 2. \n      customRules.forEach(rule => {\n        const key = rule.id || rule.targetTable + '_' + rule.ruleType;\n        if (!builtinRuleIds.has(key)) {\n          mergedRules.push({ ...rule, builtin: false });\n        }\n      });\n\n      preset.rules = mergedRules;\n      preset.version = PRESET_FORMAT_VERSION;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      console.log('[DICE]PresetManager :', preset.name);\n      return true;\n    },\n\n    // \n    importPreset(json, autoMerge = false) {\n      try {\n        const data = JSON.parse(json);\n        if (data.format !== 'acu_preset_v1' || !data.preset) return null;\n\n        const importedVersion = data.version || '0.0.0';\n        const needsMerge = this._compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n        const presets = this.getAllPresets();\n        const newPreset = {\n          id: 'imported_' + Date.now(),\n          name: data.preset.name || '',\n          builtin: false,\n          rules: data.preset.rules || [],\n          version: importedVersion,\n          createdAt: new Date().toISOString(),\n        };\n\n        // \n        if (needsMerge && autoMerge) {\n          presets.push(newPreset);\n          this._save(presets);\n          this.mergePresetWithDefaults(newPreset.id);\n          console.log('[DICE]PresetManager :', newPreset.name);\n        } else {\n          presets.push(newPreset);\n          this._save(presets);\n          console.log('[DICE]PresetManager :', newPreset.name);\n          if (needsMerge) {\n            console.warn('[DICE]PresetManager  mergePresetWithDefaults ');\n          }\n        }\n\n        return { preset: newPreset, needsMerge: needsMerge && !autoMerge };\n      } catch (e) {\n        console.error('[DICE]PresetManager :', e);\n        return null;\n      }\n    },\n\n    // \n    _getBuiltinRulesVersion() {\n      try {\n        const rulesStr = JSON.stringify(BUILTIN_VALIDATION_RULES);\n        // \n        let hash = 0;\n        for (let i = 0; i < rulesStr.length; i++) {\n          const char = rulesStr.charCodeAt(i);\n          hash = (hash << 5) - hash + char;\n          hash = hash & hash; // Convert to 32bit integer\n        }\n        return hash.toString(36);\n      } catch (e) {\n        console.error('[DICE]PresetManager :', e);\n        return '0';\n      }\n    },\n\n    // \n    _initDefaultPreset() {\n      const currentVersion = this._getBuiltinRulesVersion();\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n\n      // \n      if (stored && Array.isArray(stored)) {\n        const defaultPreset = stored.find(p => p.id === 'default');\n        if (defaultPreset && defaultPreset._builtinVersion !== currentVersion) {\n          console.log('[DICE]PresetManager ');\n          // \n          const customRules = defaultPreset.rules.filter(r => !r.builtin);\n          defaultPreset.rules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r })), ...customRules];\n          defaultPreset._builtinVersion = currentVersion;\n          this._cache = stored;\n          this._save(stored);\n          Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n          return;\n        }\n      }\n\n      const defaultPreset = {\n        id: 'default',\n        name: '',\n        builtin: true,\n        rules: BUILTIN_VALIDATION_RULES.map(r => ({ ...r })),\n        version: PRESET_FORMAT_VERSION,\n        _builtinVersion: currentVersion,\n        createdAt: new Date().toISOString(),\n      };\n      // \n      const oldCustom = Store.get(STORAGE_KEY_VALIDATION_RULES, []);\n      if (oldCustom.length > 0) {\n        defaultPreset.rules.push(...oldCustom.map(r => ({ ...r, builtin: false })));\n        console.log('[DICE]PresetManager :', oldCustom.length, '');\n      }\n      this._cache = [defaultPreset];\n      this._save(this._cache);\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n    },\n\n    // \n    resetDefaultPreset() {\n      const presets = this.getAllPresets();\n      const defaultPreset = presets.find(p => p.id === 'default');\n      if (defaultPreset) {\n        // \n        const customRules = defaultPreset.rules.filter(r => !r.builtin);\n        defaultPreset.rules = [...BUILTIN_VALIDATION_RULES.map(r => ({ ...r })), ...customRules];\n        defaultPreset._builtinVersion = this._getBuiltinRulesVersion();\n        this._save(presets);\n        ValidationRuleManager.clearCache();\n        return true;\n      }\n      return false;\n    },\n\n    _save(presets) {\n      Store.set(STORAGE_KEY_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  //  PresetManager \n  const ValidationRuleManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const preset = PresetManager.getActivePreset();\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = (preset?.rules || []).map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_VALIDATION_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n      this._cache = null; // \n    },\n\n    // \n    toggleRuleIntercept(ruleId, intercept) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const rule = preset.rules.find(r => r.id === ruleId);\n      if (!rule) return false;\n\n      rule.intercept = intercept;\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled);\n    },\n\n    // \n    addCustomRule(rule) {\n      if (!rule.id || !rule.name || !rule.targetTable) {\n        console.error('[DICE]ValidationRuleManager ');\n        return false;\n      }\n\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      //  ID \n      if (preset.rules.some(r => r.id === rule.id)) {\n        console.error('[DICE]ValidationRuleManager  ID :', rule.id);\n        return false;\n      }\n\n      const newRule = { ...rule, builtin: false, enabled: true };\n      preset.rules.push(newRule);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      console.log('[DICE]ValidationRuleManager :', newRule.name);\n      return true;\n    },\n\n    // \n    removeCustomRule(ruleId) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules.splice(index, 1);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n\n      // \n      const states = this.getEnabledStates();\n      delete states[ruleId];\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n\n      console.log('[DICE]ValidationRuleManager :', ruleId);\n      return true;\n    },\n\n    // \n    updateCustomRule(ruleId, updates) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules[index] = { ...preset.rules[index], ...updates, id: ruleId };\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    getRule(ruleId) {\n      return this.getAllRules().find(r => r.id === ruleId);\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n\n    // \n    getRulesByTable(tableName) {\n      return this.getEnabledRules().filter(rule => rule.targetTable === tableName);\n    },\n  };\n\n  // ========================================\n  // RegexTransformationManager -  (Phase 1.2)\n  // ========================================\n  const RegexTransformationManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // ID\n    _generateId() {\n      return `regex_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    },\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = rules.map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_REGEX_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    _saveEnabledStates(states) {\n      Store.set(STORAGE_KEY_REGEX_ENABLED, states);\n      this._enabledCache = states;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled !== false);\n    },\n\n    // \n    getApplicableRules(tableName, columnName) {\n      const allRules = this.getEnabledRules();\n\n      return allRules\n        .filter(rule => {\n          // \n          switch (rule.scope.type) {\n            case 'global':\n              return true;\n            case 'table':\n              return rule.scope.tableNames && rule.scope.tableNames.includes(tableName);\n            case 'column':\n              return (\n                rule.scope.tableNames &&\n                rule.scope.tableNames.includes(tableName) &&\n                rule.scope.columnNames &&\n                rule.scope.columnNames.includes(columnName)\n              );\n            default:\n              return false;\n          }\n        })\n        .sort((a, b) => b.priority - a.priority); // \n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      this._saveEnabledStates(states);\n      this.clearCache();\n    },\n\n    // \n    addCustomRule(rule) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n\n      // \n      if (!rule.name || !rule.pattern || !rule.scope) {\n        console.error('[DICE]RegexTransformationManager: ');\n        return false;\n      }\n\n      const newRule: RegexTransformationRule = {\n        id: this._generateId(),\n        name: rule.name,\n        description: rule.description,\n        operation: rule.operation || 'replace',\n        pattern: rule.pattern,\n        flags: rule.flags || {},\n        replacement: rule.replacement,\n        scope: rule.scope,\n        enabled: rule.enabled !== undefined ? rule.enabled : true,\n        priority: rule.priority || 50,\n        executeMode: rule.executeMode || 'auto',\n        testCases: rule.testCases || [],\n        security: rule.security || { maxMatchTime: 100, maxMatches: 1000, maxInputLength: 10000 },\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      rules.push(newRule);\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n      return newRule;\n    },\n\n    // \n    removeRule(ruleId) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const index = rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      rules.splice(index, 1);\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n      return true;\n    },\n\n    // \n    updateRule(ruleId, updates) {\n      const rules = Store.get(STORAGE_KEY_REGEX_RULES, []);\n      const index = rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      rules[index] = {\n        ...rules[index],\n        ...updates,\n        id: ruleId,\n        updatedAt: Date.now(),\n      };\n      Store.set(STORAGE_KEY_REGEX_RULES, rules);\n      this.clearCache();\n      return true;\n    },\n\n    // \n    getRule(ruleId) {\n      return this.getAllRules().find(r => r.id === ruleId);\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n  };\n\n  // ========================================\n  // RegexPresetManager -  (Phase 1.3)\n  // ========================================\n  const RegexPresetManager = {\n    _cache: null,\n\n    // \n    getAllPresets() {\n      if (this._cache) return this._cache;\n\n      const presets = Store.get(STORAGE_KEY_REGEX_PRESETS, []);\n\n      // \n      if (presets.length === 0) {\n        const defaultPreset: RegexPreset = {\n          id: 'regex_default',\n          name: '',\n          description: '',\n          version: '1.0.0',\n          rules: [],\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n        presets.push(defaultPreset);\n        Store.set(STORAGE_KEY_REGEX_PRESETS, presets);\n      }\n\n      this._cache = presets;\n      return presets;\n    },\n\n    // \n    getActivePreset() {\n      const activeId = Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET, 'regex_default');\n      const presets = this.getAllPresets();\n      return presets.find(p => p.id === activeId) || presets[0];\n    },\n\n    // \n    setActivePreset(presetId) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === presetId);\n      if (!preset) {\n        console.error('[DICE]RegexPresetManager: ', presetId);\n        return false;\n      }\n\n      Store.set(STORAGE_KEY_REGEX_ACTIVE_PRESET, presetId);\n\n      // RegexTransformationManager\n      RegexTransformationManager.clearCache();\n\n      return true;\n    },\n\n    // \n    createPreset(name, sourcePresetId) {\n      const presets = this.getAllPresets();\n\n      // \n      if (presets.some(p => p.name === name)) {\n        console.error('[DICE]RegexPresetManager: ', name);\n        return false;\n      }\n\n      const sourcePreset = sourcePresetId ? presets.find(p => p.id === sourcePresetId) : this.getActivePreset();\n\n      const newPreset: RegexPreset = {\n        id: `regex_preset_${Date.now()}`,\n        name: name,\n        description: sourcePreset?.description,\n        version: '1.0.0',\n        rules: sourcePreset ? JSON.parse(JSON.stringify(sourcePreset.rules)) : [],\n        createdAt: Date.now(),\n        updatedAt: Date.now(),\n      };\n\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    updatePresetRules(presetId, rules) {\n      const presets = this.getAllPresets();\n      const index = presets.findIndex(p => p.id === presetId);\n      if (index === -1) return false;\n\n      presets[index].rules = JSON.parse(JSON.stringify(rules));\n      presets[index].updatedAt = Date.now();\n\n      this._save(presets);\n\n      // ,\n      if (presetId === Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET)) {\n        RegexTransformationManager.clearCache();\n      }\n\n      return true;\n    },\n\n    // \n    deletePreset(presetId) {\n      const presets = this.getAllPresets();\n\n      // \n      if (presets.length <= 1) {\n        console.error('[DICE]RegexPresetManager: ');\n        return false;\n      }\n\n      const index = presets.findIndex(p => p.id === presetId);\n      if (index === -1) return false;\n\n      presets.splice(index, 1);\n      this._save(presets);\n\n      // ,\n      if (presetId === Store.get(STORAGE_KEY_REGEX_ACTIVE_PRESET)) {\n        this.setActivePreset(presets[0].id);\n      }\n\n      return true;\n    },\n\n    // JSON\n    exportPreset(presetId) {\n      const preset = this.getAllPresets().find(p => p.id === presetId);\n      if (!preset) return null;\n\n      return JSON.stringify(preset, null, 2);\n    },\n\n    // JSON\n    importPreset(jsonString) {\n      try {\n        const data = JSON.parse(jsonString);\n\n        // \n        if (!data.name || !Array.isArray(data.rules)) {\n          console.error('[DICE]RegexPresetManager: ');\n          return false;\n        }\n\n        const presets = this.getAllPresets();\n\n        // ID\n        const newPreset: RegexPreset = {\n          id: `regex_preset_${Date.now()}`,\n          name: data.name,\n          description: data.description,\n          version: data.version || '1.0.0',\n          rules: data.rules.map((rule: RegexTransformationRule) => ({\n            ...rule,\n            id: RegexTransformationManager._generateId(),\n          })),\n          createdAt: Date.now(),\n          updatedAt: Date.now(),\n        };\n\n        presets.push(newPreset);\n        this._save(presets);\n        return newPreset;\n      } catch (e) {\n        console.error('[DICE]RegexPresetManager: ', e);\n        return false;\n      }\n    },\n\n    // \n    _save(presets) {\n      Store.set(STORAGE_KEY_REGEX_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  // ========================================\n  // RegexTransformationEngine -  (Phase 2.1)\n  // ========================================\n  const RegexTransformationEngine = {\n    // \n    _regexCache: new Map<string, RegExp>(),\n\n    // \n    _buildFlags(flags: RegexFlags): string {\n      const result: string[] = [];\n      if (flags.caseInsensitive) result.push('i');\n      if (flags.global) result.push('g');\n      if (flags.multiline) result.push('m');\n      if (flags.unicode) result.push('u');\n      if (flags.sticky) result.push('y');\n      return result.join('');\n    },\n\n    // ()\n    _getRegex(pattern: string, flags: RegexFlags): RegExp | null {\n      //  unicode \n      const hasLookbehind = pattern.includes('(?<') || pattern.includes('(?<=');\n      const hasLookahead = pattern.includes('(?=') || pattern.includes('(?!');\n      const needsUnicode = hasLookbehind || hasLookahead;\n\n      //  unicode \n      if (needsUnicode && !flags.unicode) {\n        flags = { ...flags, unicode: true };\n      }\n\n      const flagsStr = this._buildFlags(flags);\n      const cacheKey = `${pattern}/${flagsStr}`;\n\n      if (this._regexCache.has(cacheKey)) {\n        const regex = this._regexCache.get(cacheKey)!;\n        regex.lastIndex = 0;\n        return regex;\n      }\n\n      try {\n        const regex = new RegExp(pattern, flagsStr);\n        this._regexCache.set(cacheKey, regex);\n        return regex;\n      } catch (e) {\n        console.error('[DICE]RegexTransformationEngine: ', pattern, e);\n        return null;\n      }\n    },\n\n    // ReDoS: \n    _scoreRegexComplexity(pattern: string): number {\n      let score = 0;\n\n      //  +50\n      if (/(\\*|\\+|\\{)\\1{2,}/.test(pattern)) score += 50;\n\n      //  +30\n      if (/(\\.\\*|\\.\\+)[^\\[]*\\1/.test(pattern)) score += 30;\n\n      //  +10\n      const captureGroups = (pattern.match(/\\(/g) || []).length;\n      score += Math.min(captureGroups * 5, 20);\n\n      return score;\n    },\n\n    // ReDoS: \n    _getTimeoutForRule(rule: RegexTransformationRule): number {\n      const complexity = this._scoreRegexComplexity(rule.pattern);\n      const baseTimeout = rule.security?.maxMatchTime || 100;\n      // ,\n      return Math.max(baseTimeout - complexity * 2, 50);\n    },\n\n    // \n    _safeReplace(value: string, rule: RegexTransformationRule, regex: RegExp): RegexTransformResult {\n      const oldValue = value;\n\n      // \n      const maxInputLength = rule.security?.maxInputLength || 10000;\n      if (value.length > maxInputLength) {\n        return {\n          success: false,\n          oldValue,\n          newValue: oldValue,\n          matched: false,\n          error: `(${maxInputLength})`,\n        };\n      }\n\n      try {\n        const timeout = this._getTimeoutForRule(rule);\n        const startTime = Date.now();\n\n        // \n        let newValue: string;\n        switch (rule.operation) {\n          case 'replace':\n            newValue = value.replace(regex, rule.replacement || '');\n            break;\n          case 'delete':\n            newValue = value.replace(regex, '');\n            break;\n          case 'validate':\n            const isValid = regex.test(value);\n            newValue = value;\n            break;\n          default:\n            newValue = value;\n        }\n\n        // \n        const elapsed = Date.now() - startTime;\n        if (elapsed > timeout) {\n          console.warn('[DICE]RegexTransformationEngine: ', rule.pattern, elapsed);\n          return {\n            success: false,\n            oldValue,\n            newValue: oldValue,\n            matched: false,\n            error: `(${elapsed}ms > ${timeout}ms)`,\n          };\n        }\n\n        // \n        const matched = oldValue !== newValue || regex.test(oldValue);\n\n        return {\n          success: true,\n          oldValue,\n          newValue,\n          matched,\n        };\n      } catch (e) {\n        console.error('[DICE]RegexTransformationEngine: ', rule.pattern, e);\n        return {\n          success: false,\n          oldValue,\n          newValue: oldValue,\n          matched: false,\n          error: String(e),\n        };\n      }\n    },\n\n    // \n    applyToValue(value: string, rule: RegexTransformationRule): RegexTransformResult {\n      if (value === null || value === undefined) {\n        return {\n          success: true,\n          oldValue: '',\n          newValue: '',\n          matched: false,\n        };\n      }\n\n      const strValue = String(value);\n\n      //  pattern  flags /pattern/flags\n      let pattern = rule.pattern;\n      let flags = rule.flags || {};\n\n      //  /pattern/flags \n      const extracted = this._extractFlags(pattern);\n      if (extracted.patternWithoutFlags !== pattern) {\n        //  pattern  flags\n        pattern = extracted.patternWithoutFlags;\n        flags = { ...flags, ...extracted.flags };\n      }\n\n      // \n      //  flags  global true\n      if (flags.global === undefined) {\n        flags.global = true;\n      }\n\n      const regex = this._getRegex(pattern, flags);\n\n      if (!regex) {\n        return {\n          success: false,\n          oldValue: strValue,\n          newValue: strValue,\n          matched: false,\n          error: '',\n        };\n      }\n\n      return this._safeReplace(strValue, rule, regex);\n    },\n\n    // flags (: /test/g  'g')\n    _extractFlags(patternStr: string): { flags: RegexFlags; patternWithoutFlags: string } {\n      const flags: RegexFlags = {\n        global: false,\n        caseInsensitive: false,\n        multiline: false,\n        unicode: false,\n        sticky: false,\n      };\n\n      //  /pattern/flags \n      const inlineFlagMatch = patternStr.match(/^\\/(.+)\\/([gimuy]*)$/);\n      if (inlineFlagMatch) {\n        const [, patternWithoutFlags, flagStr] = inlineFlagMatch;\n        if (flagStr.includes('g')) flags.global = true;\n        if (flagStr.includes('i')) flags.caseInsensitive = true;\n        if (flagStr.includes('m')) flags.multiline = true;\n        if (flagStr.includes('u')) flags.unicode = true;\n        if (flagStr.includes('y')) flags.sticky = true;\n        return { flags, patternWithoutFlags };\n      }\n\n      // flags\n      return { flags, patternWithoutFlags: patternStr };\n    },\n\n    // \n    applyToTable(\n      tableData:\n        | { name: string; headers: string[]; rows: string[][] }\n        | { [key: string]: { name?: string; content?: string[][] } },\n      rules: RegexTransformationRule[],\n    ): { totalApplied: number; errors: string[] } {\n      let totalApplied = 0;\n      const errors: string[] = [];\n\n      try {\n        // \n        let isSimpleFormat = false;\n        let sheetMap: Map<\n          string,\n          { sheet: any; sheetKey: string; name: string; headers: string[]; contentRowIndex: number }\n        > = new Map();\n\n        if ('name' in tableData && 'headers' in tableData && 'rows' in tableData) {\n          // : { name, headers, rows }\n          isSimpleFormat = true;\n          const simpleTable = tableData as { name: string; headers: string[]; rows: string[][] };\n          sheetMap.set(simpleTable.name, {\n            sheet: simpleTable,\n            sheetKey: simpleTable.name,\n            name: simpleTable.name,\n            headers: simpleTable.headers,\n            contentRowIndex: -1, //  contentRowIndex\n          });\n        } else {\n          // : { sheet_xxx: { name, content: [headers, ...rows] } }\n          const dataObj = tableData as { [key: string]: { name?: string; content?: string[][] } };\n\n          Object.keys(dataObj).forEach(sheetKey => {\n            if (!sheetKey.startsWith('sheet_')) return;\n\n            const sheet = dataObj[sheetKey];\n            if (!sheet || !sheet.content || !Array.isArray(sheet.content) || sheet.content.length < 1) {\n              console.warn(`[DICE]applyToTable:  ${sheetKey}`);\n              return;\n            }\n\n            const tableName = sheet.name || sheetKey;\n            sheetMap.set(tableName, {\n              sheet,\n              sheetKey,\n              name: tableName,\n              headers: sheet.content[0] || [],\n              contentRowIndex: 0, //  content[0]\n            });\n          });\n        }\n\n        if (sheetMap.size === 0) {\n          console.warn('[DICE]applyToTable: ');\n          return { totalApplied: 0, errors: [''] };\n        }\n\n        // \n        for (const [tableName, tableInfo] of sheetMap.entries()) {\n          const { sheet, headers, contentRowIndex } = tableInfo;\n\n          for (const rule of rules) {\n            if (!rule.enabled) continue;\n\n            // \n            const scope = rule.scope;\n            const shouldProcessTable = scope.type === 'global' || scope.tableNames?.includes(tableName);\n\n            if (!shouldProcessTable) continue;\n\n            try {\n              // \n              if (isSimpleFormat) {\n                //  rows\n                const rows = (sheet as { rows: string[][] }).rows;\n                for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {\n                  const row = rows[rowIndex];\n\n                  // \n                  for (let colIndex = 0; colIndex < row.length; colIndex++) {\n                    const columnName = headers[colIndex];\n\n                    // \n                    if (scope.type === 'column') {\n                      if (!scope.columnNames?.includes(columnName)) continue;\n                    }\n\n                    // \n                    const result = this.applyToValue(row[colIndex], rule);\n                    if (result.success) {\n                      if (result.matched) {\n                        row[colIndex] = result.newValue;\n                        totalApplied++;\n                      }\n                    } else {\n                      errors.push(`${rule.name} [${tableName}]: ${result.error}`);\n                    }\n                  }\n                }\n              } else {\n                //  content  content[1] \n                const content = sheet.content;\n                for (let contentRowIndex = 1; contentRowIndex < content.length; contentRowIndex++) {\n                  const row = content[contentRowIndex];\n                  if (!Array.isArray(row)) continue;\n\n                  // \n                  for (let colIndex = 0; colIndex < row.length; colIndex++) {\n                    const columnName = headers[colIndex];\n\n                    // \n                    if (scope.type === 'column') {\n                      if (!scope.columnNames?.includes(columnName)) continue;\n                    }\n\n                    // \n                    const oldValue = row[colIndex];\n                    const result = this.applyToValue(oldValue, rule);\n\n                    if (result.success) {\n                      if (result.matched) {\n                        row[colIndex] = result.newValue;\n                        totalApplied++;\n                        console.debug(\n                          `[DICE]: ${tableName}[${contentRowIndex}].${columnName}`,\n                          `\"${result.oldValue}\" -> \"${result.newValue}\"`,\n                        );\n                      }\n                    } else {\n                      errors.push(`${rule.name} [${tableName}]: ${result.error}`);\n                    }\n                  }\n                }\n              }\n            } catch (tableError) {\n              const errorMsg = tableError instanceof Error ? tableError.message : String(tableError);\n              console.error(`[DICE]applyToTable:  ${tableName} :`, tableError);\n              errors.push(`${rule.name} [${tableName}]:  - ${errorMsg}`);\n            }\n          }\n        }\n\n        if (totalApplied > 0) {\n          console.info(`[DICE]applyToTable:  ${totalApplied} `);\n        }\n        if (errors.length > 0) {\n          console.warn(`[DICE]applyToTable:  ${errors.length} `);\n        }\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : String(e);\n        console.error('[DICE]applyToTable: :', e);\n        errors.push(`: ${errorMsg}`);\n      }\n\n      return { totalApplied, errors };\n    },\n\n    // \n    applyToCell(\n      value: string,\n      tableName: string,\n      columnName: string,\n      executeMode?: RegexExecutionMode,\n    ): RegexTransformResult {\n      // \n      const rules = RegexTransformationManager.getApplicableRules(tableName, columnName);\n\n      // ,\n      if (rules.length === 0) {\n        return {\n          success: true,\n          oldValue: value || '',\n          newValue: value || '',\n          matched: false,\n        };\n      }\n\n      // \n      let applicableRules = rules;\n      if (executeMode) {\n        applicableRules = rules.filter(r => r.executeMode === executeMode || r.executeMode === 'auto');\n      }\n\n      if (applicableRules.length === 0) {\n        return {\n          success: true,\n          oldValue: value || '',\n          newValue: value || '',\n          matched: false,\n        };\n      }\n\n      // \n      let currentValue = value || '';\n      let wasMatched = false;\n\n      for (const rule of applicableRules) {\n        const result = this.applyToValue(currentValue, rule);\n        if (!result.success) {\n          return result;\n        }\n        if (result.matched) {\n          wasMatched = true;\n        }\n        currentValue = result.newValue;\n      }\n\n      return {\n        success: true,\n        oldValue: value || '',\n        newValue: currentValue,\n        matched: wasMatched,\n      };\n    },\n\n    // \n    applyToRow(row: string[], headers: string[], tableName: string, executeMode?: RegexExecutionMode): string[] {\n      return row.map((cell, index) => {\n        const columnName = headers[index];\n        const result = this.applyToCell(cell, tableName, columnName, executeMode);\n        return result.newValue;\n      });\n    },\n\n    // \n    previewBatchTransform(\n      tableData: { name: string; headers: string[]; rows: string[][] },\n      executeMode?: RegexExecutionMode,\n    ): RegexPreviewResult[] {\n      const tableName = tableData.name;\n      const rules = RegexTransformationManager.getApplicableRules(tableName, null).filter(\n        r => r.scope.type === 'global' || r.scope.tableNames?.includes(tableName),\n      );\n\n      const results: RegexPreviewResult[] = [];\n\n      for (const rule of rules) {\n        const affectedCells: RegexPreviewResult['affectedCells'] = [];\n        let totalAffected = 0;\n\n        for (let rowIndex = 0; rowIndex < tableData.rows.length; rowIndex++) {\n          const row = tableData.rows[rowIndex];\n          for (let colIndex = 0; colIndex < row.length; colIndex++) {\n            const columnName = tableData.headers[colIndex];\n            const value = row[colIndex];\n\n            // \n            if (rule.scope.type === 'column') {\n              if (!rule.scope.columnNames?.includes(columnName) || !rule.scope.tableNames?.includes(tableName)) {\n                continue;\n              }\n            } else if (rule.scope.type === 'table') {\n              if (!rule.scope.tableNames?.includes(tableName)) {\n                continue;\n              }\n            }\n\n            const result = this.applyToValue(value, rule);\n            if (result.matched && result.oldValue !== result.newValue) {\n              affectedCells.push({\n                tableName,\n                rowIndex,\n                columnIndex: colIndex,\n                columnName,\n                oldValue: result.oldValue,\n                newValue: result.newValue,\n              });\n              totalAffected++;\n            }\n          }\n        }\n\n        if (totalAffected > 0) {\n          results.push({\n            rule,\n            affectedCells,\n            totalAffected,\n          });\n        }\n      }\n\n      return results;\n    },\n\n    // \n    clearRegexCache() {\n      this._regexCache.clear();\n    },\n  };\n\n  // ========================================\n  // ValidationEngine - \n  // ========================================\n  const ValidationEngine = {\n    // \n    validateFormat(value, pattern) {\n      if (value === null || value === undefined || value === '') return true; // \n      try {\n        const regex = new RegExp(pattern);\n        return regex.test(String(value));\n      } catch (e) {\n        console.error('[DICE]ValidationEngine :', pattern, e);\n        return true; // \n      }\n    },\n\n    // \n    validateEnum(value, allowedValues) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!Array.isArray(allowedValues) || allowedValues.length === 0) return true;\n      return allowedValues.includes(String(value));\n    },\n\n    // \n    validateNumeric(value, min, max) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      //  \"50/100\"  \":80\" \n      const strVal = String(value);\n      let numVal;\n\n      //  \"50%\"\n      if (strVal.endsWith('%')) {\n        numVal = parseFloat(strVal);\n      }\n      //  \"50/100\"\n      else if (strVal.includes('/')) {\n        const parts = strVal.split('/');\n        numVal = parseFloat(parts[0]);\n      }\n      //  \":\" \n      else if (strVal.includes(':')) {\n        const parts = strVal.split(':');\n        numVal = parseFloat(parts[parts.length - 1]);\n      }\n      // \n      else {\n        numVal = parseFloat(strVal);\n      }\n\n      if (isNaN(numVal)) return false; // \n\n      if (min !== undefined && min !== null && numVal < min) return false;\n      if (max !== undefined && max !== null && numVal > max) return false;\n      return true;\n    },\n\n    //  OR \n    validateRelation(value, rawData, refTable, refColumn) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!rawData || !refTable || !refColumn) return true;\n\n      // \n      let refSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === refTable) {\n          refSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!refSheet || !refSheet.content || refSheet.content.length < 2) {\n        return true; // \n      }\n\n      const headers = refSheet.content[0];\n      const strVal = String(value);\n\n      //  refColumn \n      const columns = Array.isArray(refColumn) ? refColumn : [refColumn];\n\n      for (const col of columns) {\n        const refColIndex = headers.indexOf(col);\n        if (refColIndex === -1) continue; // \n\n        // \n        for (let i = 1; i < refSheet.content.length; i++) {\n          if (String(refSheet.content[i][refColIndex] || '') === strVal) {\n            return true; // \n          }\n        }\n      }\n\n      return columns.length === 0; //  true false\n    },\n\n    // \n    validateRequired(value) {\n      return value !== null && value !== undefined && String(value).trim() !== '';\n    },\n\n    // \n    validateKeyValue(value, ruleConfig) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      const valueType = ruleConfig?.valueType || 'text';\n      const valueMin = ruleConfig?.valueMin;\n      const valueMax = ruleConfig?.valueMax;\n\n      // \n      let processedValue = String(value);\n\n      // \n      processedValue = processedValue\n        .replace(//g, ':') //   \n        .replace(//g, ';') //   \n        .replace(//g, ';'); //   \n\n      // \n      processedValue = processedValue.replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n\n      if (pairs.length === 0) return false; // \n\n      // \n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          return false; // /\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) return false; // \n\n        // \n        if (valueType === 'numeric') {\n          // \n          if (!/^-?\\d+(\\.\\d+)?$/.test(val.trim())) return false; // \n\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) return false; // \n\n          if (valueMin !== undefined && valueMin !== null && numVal < valueMin) return false;\n          if (valueMax !== undefined && valueMax !== null && numVal > valueMax) return false;\n        }\n        // \n      }\n\n      return true;\n    },\n\n    // \n    validateTableReadonly(oldContent, newContent) {\n      if (!oldContent || !newContent) return true;\n      return JSON.stringify(oldContent) === JSON.stringify(newContent);\n    },\n\n    // \n    validateRowLimit(rowCount, min, max) {\n      if (min !== undefined && min !== null && rowCount < min) return false;\n      if (max !== undefined && max !== null && rowCount > max) return false;\n      return true;\n    },\n\n    // \n    validateSequence(sheet, columnName, config) {\n      if (!sheet || !sheet.content || sheet.content.length < 2) return true; // \n      if (!columnName || !config) return true;\n\n      const headers = sheet.content[0] || [];\n      const rows = sheet.content.slice(1) || [];\n      const colIndex = headers.indexOf(columnName);\n      if (colIndex < 0) return true; // \n\n      const prefix = config.prefix || '';\n      const startFrom = config.startFrom !== undefined ? config.startFrom : 1;\n\n      // \n      const numbers = [];\n      const allRowValues = []; // \n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        allRowValues.push({ rowIndex: i, rawValue: value, type: typeof value });\n        if (value === null || value === undefined || value === '') continue;\n\n        const strValue = String(value).trim();\n        if (!strValue) continue;\n\n        // +\n        if (prefix) {\n          const regex = new RegExp(`^${prefix}(\\\\d+)$`);\n          const match = strValue.match(regex);\n          if (match) {\n            const num = parseInt(match[1], 10);\n            if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n          }\n        } else {\n          // \n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) numbers.push({ rowIndex: i, value: strValue, num });\n        }\n      }\n\n      if (numbers.length === 0) return true; // \n\n      // \n      numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n      // \n      const numSet = new Set(numbers.map(n => n.num));\n      if (numSet.size !== numbers.length) {\n        return false; // \n      }\n\n      // startFrom\n      // startFromstartFrom+1\n      for (let i = 0; i < numbers.length; i++) {\n        const expectedNum = startFrom + i;\n        const actualNum = numbers[i].num;\n        if (actualNum !== expectedNum) {\n          return false; // startFrom\n        }\n      }\n\n      return true;\n    },\n\n    //  intercept \n    checkTableRules(snapshot, newData, rules) {\n      const violations = [];\n      if (!snapshot || !newData || !rules) return violations;\n\n      for (const rule of rules) {\n        // \n        if (!rule.enabled || !rule.intercept) continue;\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n        if (!typeInfo) continue;\n\n        // \n        let oldSheet = null,\n          newSheet = null;\n        for (const sheetId in snapshot) {\n          if (snapshot[sheetId]?.name === rule.targetTable) {\n            oldSheet = snapshot[sheetId];\n            break;\n          }\n        }\n        for (const sheetId in newData) {\n          if (newData[sheetId]?.name === rule.targetTable) {\n            newSheet = newData[sheetId];\n            break;\n          }\n        }\n\n        if (!newSheet) continue;\n\n        // \n        if (typeInfo.scope === 'table') {\n          if (rule.ruleType === 'tableReadonly') {\n            if (!this.validateTableReadonly(oldSheet?.content, newSheet?.content)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message: rule.errorMessage || ` \"${rule.targetTable}\" `,\n              });\n            }\n          } else if (rule.ruleType === 'rowLimit') {\n            const rowCount = (newSheet.content?.length || 1) - 1; // \n            if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetTable}\"  ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n              });\n            }\n          } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n            // \n            if (!this.validateSequence(newSheet, rule.targetColumn, rule.config || {})) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(4, '0')}`,\n              });\n            }\n          }\n        }\n        // \n        else if (typeInfo.scope === 'field' && rule.targetColumn) {\n          const headers = newSheet.content?.[0] || [];\n          const colIndex = headers.indexOf(rule.targetColumn);\n          if (colIndex === -1) continue;\n\n          // \n          for (let rowIdx = 1; rowIdx < (newSheet.content?.length || 0); rowIdx++) {\n            const row = newSheet.content[rowIdx];\n            const value = row?.[colIndex];\n            const isValid = this.validateValue(value, rule, newData);\n\n            if (!isValid) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                rowIndex: rowIdx,\n                columnName: rule.targetColumn,\n                currentValue: String(value ?? ''),\n                message: rule.errorMessage || ` \"${rule.targetColumn}\" `,\n              });\n              // \n              break;\n            }\n          }\n        }\n      }\n      return violations;\n    },\n\n    // \n    validateValue(value, rule, rawData) {\n      switch (rule.ruleType) {\n        case 'format':\n          return this.validateFormat(value, rule.config?.pattern);\n        case 'enum':\n          return this.validateEnum(value, rule.config?.values);\n        case 'numeric':\n          return this.validateNumeric(value, rule.config?.min, rule.config?.max);\n        case 'relation':\n          return this.validateRelation(value, rawData, rule.config?.refTable, rule.config?.refColumn);\n        case 'required':\n          return this.validateRequired(value);\n        case 'keyValue':\n          return this.validateKeyValue(value, rule.config);\n        default:\n          return true;\n      }\n    },\n\n    // \n    validateRow(row, headers, tableName, rowIndex, rules, rawData) {\n      const errors = [];\n      // \n      const rowTitle = row[1] || row[0] || ` ${rowIndex + 1}`;\n\n      for (const rule of rules) {\n        if (rule.targetTable !== tableName) continue;\n        if (!rule.enabled) continue;\n\n        // \n        const colIndex = headers.indexOf(rule.targetColumn);\n        if (colIndex === -1) continue;\n\n        const value = row[colIndex];\n        const isValid = this.validateValue(value, rule, rawData);\n\n        if (!isValid) {\n          errors.push({\n            ruleId: rule.id,\n            ruleName: rule.name,\n            ruleType: rule.ruleType,\n            rule: rule, // \n            tableName: tableName,\n            rowIndex: rowIndex,\n            columnName: rule.targetColumn,\n            currentValue: String(value ?? ''),\n            rowTitle: rowTitle, // \n            errorMessage: rule.errorMessage,\n            severity: 'error',\n          });\n        }\n      }\n\n      return errors;\n    },\n\n    // \n    validateAllData(rawData) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getEnabledRules();\n      if (rules.length === 0) return [];\n\n      const allErrors = [];\n\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const sheet = rawData[sheetId];\n        if (!sheet?.name || !sheet?.content || sheet.content.length < 2) continue;\n\n        const tableName = sheet.name;\n        const headers = sheet.content[0];\n        const tableRules = rules.filter(r => r.targetTable === tableName);\n\n        if (tableRules.length === 0) continue;\n\n        // \n        for (const rule of tableRules) {\n          const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n          if (typeInfo?.scope === 'table') {\n            if (rule.ruleType === 'rowLimit') {\n              const rowCount = sheet.content.length - 1;\n              if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n                allErrors.push({\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: '',\n                  currentValue: `${rowCount} `,\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n                  severity: 'warning',\n                });\n              }\n            } else if (rule.ruleType === 'sequence' && rule.targetColumn) {\n              // \n              const isValid = this.validateSequence(sheet, rule.targetColumn, rule.config || {});\n              if (!isValid) {\n                const error = {\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: rule.targetColumn,\n                  currentValue: '',\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` \"${rule.targetColumn}\" ${rule.config?.prefix || ''}${String(rule.config?.startFrom || 1).padStart(4, '0')}`,\n                  severity: 'error',\n                };\n                allErrors.push(error);\n              }\n            }\n            // tableReadonly \n          }\n        }\n\n        // \n        const fieldRules = tableRules.filter(r => RULE_TYPE_INFO[r.ruleType]?.scope !== 'table');\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          const rowErrors = this.validateRow(row, headers, tableName, i - 1, fieldRules, rawData);\n          allErrors.push(...rowErrors);\n        }\n      }\n\n      return allErrors;\n    },\n\n    // \n    validateTable(rawData, tableName) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getRulesByTable(tableName);\n      if (rules.length === 0) return [];\n\n      // \n      let targetSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n        return [];\n      }\n\n      const headers = targetSheet.content[0];\n      const allErrors = [];\n\n      for (let i = 1; i < targetSheet.content.length; i++) {\n        const row = targetSheet.content[i];\n        const rowErrors = this.validateRow(row, headers, tableName, i - 1, rules, rawData);\n        allErrors.push(...rowErrors);\n      }\n\n      return allErrors;\n    },\n\n    // \n    groupErrorsByTable(errors) {\n      const grouped = {};\n      for (const error of errors) {\n        if (!grouped[error.tableName]) {\n          grouped[error.tableName] = [];\n        }\n        grouped[error.tableName].push(error);\n      }\n      return grouped;\n    },\n\n    // \n    getErrorCount(rawData) {\n      return this.validateAllData(rawData).length;\n    },\n  };\n\n  // ========================================\n  // LocalAvatarDB -  IndexedDB \n  // ========================================\n  const LocalAvatarDB = {\n    DB_NAME: 'acu_local_avatars',\n    STORE_NAME: 'avatars',\n    DB_VERSION: 1,\n    _db: null,\n    _urlCache: new Map(), //  ObjectURL \n\n    // \n    async init() {\n      if (this._db) return this._db;\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n        request.onerror = () => {\n          console.error('[DICE]LocalAvatarDB :', request.error);\n          reject(request.error);\n        };\n\n        request.onsuccess = () => {\n          this._db = request.result;\n          resolve(this._db);\n        };\n\n        request.onupgradeneeded = event => {\n          const db = event.target.result;\n          if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n            // \n            db.createObjectStore(this.STORE_NAME, { keyPath: 'name' });\n          }\n        };\n      });\n    },\n\n    //  name \n    async save(name, blob) {\n      if (!name || !blob) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          //  ObjectURL \n          if (this._urlCache.has(name)) {\n            URL.revokeObjectURL(this._urlCache.get(name));\n            this._urlCache.delete(name);\n          }\n\n          const data = {\n            name: name,\n            blob: blob,\n            size: blob.size,\n            type: blob.type,\n            updatedAt: Date.now(),\n          };\n\n          const request = store.put(data);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[DICE]LocalAvatarDB :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB save error:', e);\n        return false;\n      }\n    },\n\n    //  URL ObjectURL\n    async get(name) {\n      if (!name) return null;\n\n      // \n      if (this._urlCache.has(name)) {\n        return this._urlCache.get(name);\n      }\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.get(name);\n\n          request.onsuccess = () => {\n            const data = request.result;\n            if (data && data.blob) {\n              const url = URL.createObjectURL(data.blob);\n              this._urlCache.set(name, url);\n              resolve(url);\n            } else {\n              resolve(null);\n            }\n          };\n\n          request.onerror = () => resolve(null);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB get error:', e);\n        return null;\n      }\n    },\n\n    // \n    async has(name) {\n      if (!name) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getKey(name);\n\n          request.onsuccess = () => resolve(request.result !== undefined);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        return false;\n      }\n    },\n\n    // \n    async delete(name) {\n      if (!name) return false;\n\n      try {\n        //  ObjectURL \n        if (this._urlCache.has(name)) {\n          URL.revokeObjectURL(this._urlCache.get(name));\n          this._urlCache.delete(name);\n        }\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.delete(name);\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB delete error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAllNames() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAllKeys();\n\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => resolve([]);\n        });\n      } catch (e) {\n        return [];\n      }\n    },\n\n    // \n    async getStats() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAll();\n\n          request.onsuccess = () => {\n            const items = request.result || [];\n            const totalSize = items.reduce((sum, item) => sum + (item.size || 0), 0);\n            resolve({\n              count: items.length,\n              totalSize: totalSize,\n              totalSizeMB: (totalSize / 1024 / 1024).toFixed(2),\n            });\n          };\n\n          request.onerror = () => resolve({ count: 0, totalSize: 0, totalSizeMB: '0' });\n        });\n      } catch (e) {\n        return { count: 0, totalSize: 0, totalSizeMB: '0' };\n      }\n    },\n\n    // \n    async clearAll() {\n      try {\n        //  ObjectURL \n        this._urlCache.forEach(url => URL.revokeObjectURL(url));\n        this._urlCache.clear();\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.clear();\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[DICE]LocalAvatarDB clearAll error:', e);\n        return false;\n      }\n    },\n  };\n\n  // []  SillyTavern  URL\n  const getUserAvatarUrl = () => {\n    try {\n      // 1:  DOM \n      const w = window.parent || window;\n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        // SillyTavern  #user_avatar_block img  .avatar[title=\"You\"] img\n        const $avatar = $('#user_avatar_block img').first();\n        if ($avatar.length && $avatar.attr('src')) {\n          return $avatar.attr('src');\n        }\n        // \n        const $userMes = $('.mes[is_user=\"true\"]').last().find('.avatar img');\n        if ($userMes.length && $userMes.attr('src')) {\n          return $userMes.attr('src');\n        }\n      }\n      // 2:  SillyTavern API \n      const ST = w.SillyTavern || window.SillyTavern;\n      if (ST && ST.getContext) {\n        const ctx = ST.getContext();\n        if (ctx && ctx.userAvatar) {\n          return ctx.userAvatar;\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getUserAvatarUrl error:', e);\n    }\n    return null;\n  };\n\n  // [] \n  const getPlayerName = () => {\n    const rawData = cachedRawData || (typeof getTableData === 'function' ? getTableData() : null);\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]?.[1]) {\n          return sheet.content[1][1];\n        }\n      }\n    }\n    return null;\n  };\n\n  // []  SillyTavern Persona \n  const getPersonaName = () => {\n    try {\n      // 1: SillyTavern  API\n      const w = window.parent || window;\n      if (w.SillyTavern?.getContext) {\n        const ctx = w.SillyTavern.getContext();\n        if (ctx?.name1) return ctx.name1;\n      }\n      // 2: \n      if (typeof name1 !== 'undefined' && name1) return name1;\n      if (w.name1) return w.name1;\n      // 3:  DOM \n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        const $persona = $('#user_avatar_block .avatar-name, #persona_name_input').first();\n        if ($persona.length) {\n          const name = $persona.val?.() || $persona.text?.();\n          if (name && name.trim()) return name.trim();\n        }\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getPersonaName error:', e);\n    }\n    return null;\n  };\n\n  // []  Persona\n  const getDisplayPlayerName = () => {\n    return getPersonaName() || getPlayerName() || '';\n  };\n\n  // []  Persona \n  const replaceUserPlaceholders = text => {\n    if (!text || typeof text !== 'string') return text;\n    const displayName = getDisplayPlayerName();\n    //  <user>{{user}}\n    let result = text.replace(/<user>/gi, displayName);\n    result = result.replace(/\\{\\{user\\}\\}/gi, displayName);\n    return result;\n  };\n  // \n  const AvatarManager = {\n    _cache: null,\n\n    load() {\n      if (!this._cache) {\n        const raw = Store.get(STORAGE_KEY_AVATAR_MAP, {});\n        this._cache = {};\n        for (const name in raw) {\n          if (typeof raw[name] === 'string') {\n            this._cache[name] = { url: raw[name], offsetX: 50, offsetY: 50, scale: 150, aliases: [] };\n          } else {\n            this._cache[name] = {\n              url: raw[name].url || '',\n              offsetX: raw[name].offsetX ?? 50,\n              offsetY: raw[name].offsetY ?? 50,\n              scale: raw[name].scale ?? 150,\n              aliases: raw[name].aliases || [],\n            };\n          }\n        }\n      }\n      return this._cache;\n    },\n\n    save() {\n      Store.set(STORAGE_KEY_AVATAR_MAP, this._cache || {});\n      this._cache = null;\n    },\n\n    //  URL  ST \n    get(name) {\n      const data = this.load()[name];\n      if (data && data.url) return data.url;\n\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          if (this._cache[key].url) return this._cache[key].url;\n        }\n      }\n\n      return null;\n    },\n\n    //  > URL > ST\n    async getAsync(name) {\n      if (!name) return null;\n\n      // \n      const playerName = getPlayerName();\n      const isPlayer = name === '<user>' || name === '' || (playerName && name === playerName);\n\n      // 1.  IndexedDB\n      const localUrl = await LocalAvatarDB.get(name);\n      if (localUrl) return localUrl;\n\n      // 2.  <user> \n      if (isPlayer && name !== '<user>') {\n        const userLocalUrl = await LocalAvatarDB.get('<user>');\n        if (userLocalUrl) return userLocalUrl;\n      }\n\n      // 3. \n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        const aliasLocalUrl = await LocalAvatarDB.get(primaryName);\n        if (aliasLocalUrl) return aliasLocalUrl;\n      }\n\n      // 4. URL / ST\n      return this.get(name);\n    },\n\n    // \n    async hasLocalAvatar(name) {\n      if (!name) return false;\n      const has = await LocalAvatarDB.has(name);\n      if (has) return true;\n\n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        return await LocalAvatarDB.has(primaryName);\n      }\n      return false;\n    },\n\n    // \n    async saveLocalAvatar(name, blob) {\n      return await LocalAvatarDB.save(name, blob);\n    },\n\n    // \n    async deleteLocalAvatar(name) {\n      return await LocalAvatarDB.delete(name);\n    },\n\n    getOffsetX(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetX ?? 50) : 50;\n    },\n\n    getOffsetY(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetY ?? 50) : 50;\n    },\n\n    getScale(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.scale ?? 150) : 150;\n    },\n\n    // \n    _resolveByAlias(name) {\n      const data = this.load()[name];\n      if (data) return data;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return this._cache[key];\n        }\n      }\n      return null;\n    },\n\n    // \n    getPrimaryName(name) {\n      if (this.load()[name]) return name;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return key;\n        }\n      }\n      return name;\n    },\n\n    set(name, url, offsetX = 50, offsetY = 50, scale = 150, aliases = []) {\n      this.load()[name] = { url, offsetX, offsetY, scale, aliases };\n      this.save();\n    },\n\n    setPosition(name, offsetX, offsetY) {\n      const data = this.load()[name];\n      if (data) {\n        data.offsetX = offsetX;\n        data.offsetY = offsetY;\n        this.save();\n      }\n    },\n\n    setScale(name, scale) {\n      const data = this.load()[name];\n      if (data) {\n        data.scale = scale;\n        this.save();\n      }\n    },\n\n    setAliases(name, aliases) {\n      const data = this.load()[name];\n      if (data) {\n        data.aliases = aliases;\n        this.save();\n      }\n    },\n\n    remove(name) {\n      delete this.load()[name];\n      this.save();\n    },\n\n    getAll() {\n      return this.load();\n    },\n\n    // JSON\n    exportData() {\n      return {\n        version: 1,\n        exportTime: new Date().toISOString(),\n        avatars: this.load(),\n      };\n    },\n\n    // \n    importData(jsonData, overwriteConflicts = true) {\n      if (!jsonData || !jsonData.avatars) {\n        throw new Error('');\n      }\n\n      const current = this.load();\n      const stats = { added: 0, updated: 0, skipped: 0 };\n\n      for (const name in jsonData.avatars) {\n        const imported = jsonData.avatars[name];\n        if (!imported.url) continue;\n\n        if (current[name]) {\n          // \n          if (overwriteConflicts) {\n            current[name] = {\n              url: imported.url,\n              offsetX: imported.offsetX ?? 50,\n              offsetY: imported.offsetY ?? 50,\n              scale: imported.scale ?? 150,\n              aliases: imported.aliases || [],\n            };\n            stats.updated++;\n          } else {\n            stats.skipped++;\n          }\n        } else {\n          // \n          current[name] = {\n            url: imported.url,\n            offsetX: imported.offsetX ?? 50,\n            offsetY: imported.offsetY ?? 50,\n            scale: imported.scale ?? 150,\n            aliases: imported.aliases || [],\n          };\n          stats.added++;\n        }\n      }\n\n      this.save();\n      return stats;\n    },\n\n    // \n    analyzeImport(jsonData) {\n      if (!jsonData || !jsonData.avatars) {\n        return { valid: false, error: '' };\n      }\n\n      const current = this.load();\n      const result = { valid: true, total: 0, newItems: [], conflicts: [] };\n\n      for (const name in jsonData.avatars) {\n        if (!jsonData.avatars[name].url) continue;\n        result.total++;\n        if (current[name]) {\n          result.conflicts.push(name);\n        } else {\n          result.newItems.push(name);\n        }\n      }\n\n      return result;\n    },\n  };\n\n  const getLocationEmoji = name => {\n    if (!name) return null;\n    for (const [pattern, emoji] of LOCATION_EMOJI_MAP) {\n      if (pattern.test(name)) return emoji;\n    }\n    return null;\n  };\n\n  // emoji\n  const getEmojiCandidates = (name: string): string[] => {\n    if (!name) return [];\n    const candidates: string[] = [];\n    for (const [pattern, emoji] of LOCATION_EMOJI_MAP) {\n      if (pattern.test(name)) {\n        candidates.push(emoji);\n      }\n    }\n    return candidates;\n  };\n\n  // emoji\n  const resolveBatchLocationEmojis = (names: string[]): Map<string, string | null> => {\n    // 1. \n    const candidatesMap = new Map<string, string[]>();\n    for (const name of names) {\n      candidatesMap.set(name, getEmojiCandidates(name));\n    }\n\n    // 2. \n    const sortedNames = [...names].sort((a, b) => {\n      if (a.length !== b.length) return a.length - b.length;\n      return a.localeCompare(b);\n    });\n\n    // 3. \n    const usedEmojis = new Set<string>();\n    const result = new Map<string, string | null>();\n\n    for (const name of sortedNames) {\n      const candidates = candidatesMap.get(name) || [];\n      const available = candidates.find(e => !usedEmojis.has(e));\n      if (available) {\n        result.set(name, available);\n        usedEmojis.add(available);\n      } else {\n        // \n        result.set(name, candidates.length > 0 ? candidates[0] : null);\n      }\n    }\n\n    return result;\n  };\n\n  const getElementEmoji = (name, type) => {\n    if (!name && !type) return null;\n    for (const [pattern, emoji] of ELEMENT_EMOJI_MAP) {\n      if (name && pattern.test(name)) return emoji;\n    }\n    for (const [pattern, emoji] of ELEMENT_EMOJI_MAP) {\n      if (type && pattern.test(type)) return emoji;\n    }\n    return null;\n  };\n\n  // ========================================\n  // MVU  v2.0\n  //  -  UI\n  // ========================================\n  const MvuModule = (function () {\n    'use strict';\n\n    // [] MVU  - \n    function parseMvuPathForDice(path, value) {\n      try {\n        if (!path || typeof path !== 'string') {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        //  . \n        const parts = path.split('.').filter(p => p && p.trim());\n\n        if (parts.length === 0) {\n          return { initiator: null, attrName: null, candidates: [] };\n        }\n\n        // \n        const blacklist = [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          'stat_data',\n          'delta_data',\n        ];\n\n        // \n        const filteredParts = parts.filter(p => !blacklist.includes(p));\n\n        // \n        let initiator = null;\n        if (filteredParts.length >= 2) {\n          // \n          initiator = filteredParts[filteredParts.length - 2];\n        } else if (filteredParts.length === 1) {\n          // \n          initiator = filteredParts[0];\n        }\n\n        // \n        let attrName = null;\n        if (filteredParts.length > 0) {\n          attrName = filteredParts[filteredParts.length - 1];\n        } else if (parts.length > 0) {\n          // \n          attrName = parts[parts.length - 1];\n        }\n\n        // \n        const candidates = filteredParts.length > 0 ? filteredParts : parts.slice(-1);\n\n        return {\n          initiator: initiator || null,\n          attrName: attrName || null,\n          candidates: candidates,\n        };\n      } catch (e) {\n        console.warn('[DICE]parseMvuPathForDice ', e);\n        return { initiator: null, attrName: null, candidates: [] };\n      }\n    }\n\n    // =====  =====\n    const MODULE_ID = '__mvu__';\n    let cachedEraData = null; //  ERA \n\n    // =====  =====\n    function detectMode() {\n      // \n      if (cachedEraData && cachedEraData._source) {\n        return cachedEraData._source;\n      }\n\n      //  ERA ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n\n      if (typeof eventEmit === 'function' && typeof eventOn === 'function') {\n        console.log('[DICE]MvuModule  ERA ');\n        return 'era';\n      }\n\n      //  MVU\n      if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n        console.log('[DICE]MvuModule  MVU ');\n        return 'mvu';\n      }\n\n      //  MVU\n      console.log('[DICE]MvuModule  MVU ');\n      return 'mvu';\n    }\n\n    // ===== =====\n    async function detectModeWithData() {\n      // 1.  ERA ERA \n      const eventEmit = window.eventEmit || window.parent?.eventEmit;\n      const eventOn = window.eventOn || window.parent?.eventOn;\n\n      if (typeof eventEmit === 'function' && typeof eventOn === 'function') {\n        try {\n          //  ERA \n          const eraData = await Promise.race([\n            getEraData(),\n            new Promise((_, reject) => setTimeout(() => reject(new Error('ERA timeout')), 2000)),\n          ]);\n\n          if (eraData && eraData.stat_data) {\n            console.log('[DICE] ERA ');\n            return { mode: 'era', data: eraData };\n          }\n        } catch (e) {\n          console.warn('[DICE]ERA :', e.message);\n        }\n      }\n\n      // 2.  MVU\n      try {\n        await waitGlobalInitialized('Mvu');\n\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (mvuData && mvuData.stat_data) {\n            console.log('[DICE] MVU ');\n            return {\n              mode: 'mvu',\n              data: {\n                stat_data: mvuData.stat_data || null,\n                display_data: mvuData.display_data || {},\n                delta_data: mvuData.delta_data || {},\n                schema: mvuData.schema || null,\n                _source: 'mvu', // \n              },\n            };\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MVU :', e);\n      }\n\n      // 3.  MVU \n      console.warn('[DICE] MVU ');\n      return { mode: 'mvu', data: null };\n    }\n\n    // ===== ERA  =====\n    // ERA\n    async function getEraData() {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(null);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onResult = detail => {\n          clearTimeout(timeoutId);\n          //  eventOff \n          if (typeof eventOff === 'function') {\n            try {\n              eventOff('era:queryResult', onResult);\n            } catch (e) {\n              console.warn('[DICE]MvuModule :', e);\n            }\n          }\n\n          console.log('[DICE]MvuModule ERA:', JSON.stringify(detail, null, 2));\n          console.log('[DICE]MvuModule detail.result:', JSON.stringify(detail.result, null, 2));\n\n          if (detail.result && detail.result.error) {\n            console.error('[DICE]MvuModule ERA:', detail.result.error);\n            resolve(null);\n            return;\n          }\n\n          const statData = detail.result?.statWithoutMeta || null;\n          console.log('[DICE]MvuModule  stat_data:', JSON.stringify(statData, null, 2));\n\n          const result = {\n            stat_data: statData,\n            delta_data: {},\n            schema: null,\n            _source: 'era', // \n          };\n\n          // \n          cachedEraData = result;\n\n          resolve(result);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA...');\n          console.log('[DICE]MvuModule ERA API :', {\n            eventEmit: typeof eventEmit === 'function',\n            eventOn: typeof eventOn === 'function',\n            eventOff: typeof eventOff === 'function',\n          });\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(null);\n            return;\n          }\n\n          eventOn('era:queryResult', onResult);\n          eventEmit('era:getCurrentVars');\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(null);\n        }\n      });\n    }\n\n    // ERA \n    async function setEraValue(path, newValue) {\n      return new Promise(resolve => {\n        const timeoutId = setTimeout(() => {\n          console.warn('[DICE]MvuModule ERA');\n          resolve(false);\n        }, 5000);\n\n        //  eventEmit  eventOn iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const eventOff = window.eventOff || window.parent?.eventOff;\n\n        const onWriteDone = detail => {\n          clearTimeout(timeoutId);\n          if (typeof eventOff === 'function') {\n            eventOff('era:writeDone', onWriteDone);\n          }\n          console.log('[DICE]MvuModule ERA');\n          resolve(true);\n        };\n\n        try {\n          console.log('[DICE]MvuModule ERA:', path, newValue);\n\n          if (typeof eventOn !== 'function') {\n            console.error('[DICE]MvuModule eventOn ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n          if (typeof eventEmit !== 'function') {\n            console.error('[DICE]MvuModule eventEmit ');\n            clearTimeout(timeoutId);\n            resolve(false);\n            return;\n          }\n\n          eventOn('era:writeDone', onWriteDone);\n          eventEmit('era:updateByPath', {\n            path: path,\n            value: newValue,\n          });\n        } catch (e) {\n          clearTimeout(timeoutId);\n          console.error('[DICE]MvuModule ERA API:', e);\n          resolve(false);\n        }\n      });\n    }\n\n    // =====  =====\n    const STYLES = `\n            /* MVU  */\n            .acu-mvu-panel {\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n                min-height: 300px; /*  */\n                overflow: hidden; /*  */\n            }\n            .acu-mvu-panel .acu-panel-header {\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                padding: 10px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                flex-shrink: 0;\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title i {\n                color: var(--acu-accent);\n            }\n            .acu-mvu-panel .acu-header-actions {\n                display: flex;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                padding: 5px 10px;\n                font-size: 13px;\n                border-radius: 4px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn:hover {\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent);\n            }\n            .acu-mvu-panel .mvu-header-btn.active {\n                background: var(--acu-accent);\n                color: #fff;\n                border-color: var(--acu-accent);\n            }\n            /* []  */\n            .mvu-numeric-mode {\n                padding: 0;\n            }\n            .mvu-numeric-level-controls {\n                position: sticky;\n                top: 0;\n                z-index: 10;\n            }\n            /* []  */\n            .mvu-level-controls-collapsible {\n                margin-bottom: 8px;\n            }\n            .mvu-level-controls-header {\n                transition: background 0.2s;\n            }\n            .mvu-level-controls-header:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-level-controls-body {\n                overflow-y: auto;\n                overflow-x: hidden;\n                transition: max-height 0.3s ease-out, padding-top 0.3s ease-out, padding-bottom 0.3s ease-out, border-bottom 0.3s ease-out;\n                max-height: 300px; /*  */\n                scrollbar-width: thin;\n            }\n            /*  */\n            @media (max-width: 768px) {\n                .mvu-level-controls-body {\n                    max-height: 200px;\n                }\n            }\n            .mvu-level-controls-body::-webkit-scrollbar {\n                width: 6px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-track {\n                background: transparent;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb {\n                background: var(--acu-border);\n                border-radius: 3px;\n            }\n            .mvu-level-controls-body::-webkit-scrollbar-thumb:hover {\n                background: var(--acu-text-sub);\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-body {\n                max-height: 0 !important;\n                padding-top: 0 !important;\n                padding-bottom: 0 !important;\n                border-bottom: none !important;\n                margin: 0 !important;\n            }\n            .mvu-level-controls-toggle-icon {\n                transition: transform 0.3s ease-out;\n            }\n            .mvu-level-controls-collapsible.collapsed .mvu-level-controls-toggle-icon {\n                transform: rotate(-90deg);\n            }\n            .mvu-numeric-items {\n                max-height: calc(100vh - 200px);\n                overflow-y: auto;\n            }\n            .mvu-numeric-item {\n                transition: background 0.2s;\n            }\n            .mvu-numeric-item:hover {\n                background: var(--acu-table-hover) !important;\n            }\n            .mvu-dice-icon {\n                transition: opacity 0.2s, transform 0.2s;\n            }\n            .mvu-dice-icon:hover {\n                opacity: 1 !important;\n                transform: scale(1.1);\n            }\n            .mvu-level-toggle:hover {\n                opacity: 1 !important;\n            }\n            .mvu-level-toggle[data-visible=\"true\"]:hover {\n                background: var(--acu-accent) !important;\n                color: #fff !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .mvu-level-toggle[data-visible=\"false\"]:hover,\n            .mvu-level-toggle[data-visible=\"\"]:hover {\n                background: var(--acu-table-hover) !important;\n                color: var(--acu-text-sub) !important;\n                border-color: var(--acu-border) !important;\n            }\n\n            /* MVU  -  */\n            .mvu-content {\n                display: flex;\n                flex-direction: column;\n                overflow-x: hidden;\n                overflow-y: auto; /*  */\n                flex: 1 1 auto;\n                min-height: 0; /*  flex  */\n                max-height: 100%; /*  */\n                padding: 12px;\n                scrollbar-width: thin;\n            }\n            .mvu-content::-webkit-scrollbar {\n                display: none;\n            }\n            .mvu-content .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 100%;\n                max-width: 100%;\n                width: 100%;\n            }\n            /* MVU */\n            .acu-mvu-panel {\n                overflow-y: auto !important;\n                overflow-x: hidden !important;\n                flex: 1 1 0; /*  flex-basis: 0  */\n                min-height: 300px; /*  */\n            }\n\n            /* MVU  */\n            .mvu-card {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 10px;\n                overflow: hidden;\n            }\n            .mvu-card:last-child {\n                margin-bottom: 0;\n            }\n            .mvu-card-header {\n                background: var(--acu-table-head);\n                padding: 8px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                cursor: pointer;\n                user-select: none;\n                transition: background 0.2s;\n            }\n            .mvu-card-header:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-card-title {\n                font-weight: 600;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            .mvu-card-count {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                font-weight: normal;\n            }\n            .mvu-card-toggle {\n                color: var(--acu-text-sub);\n                font-size: 10px;\n                transition: transform 0.2s;\n            }\n            .mvu-card.collapsed .mvu-card-toggle {\n                transform: rotate(-90deg);\n            }\n            .mvu-card-body {\n                padding: 8px 12px;\n                display: block;\n                overflow: hidden; /*  slideUp/slideDown  */\n            }\n            .mvu-card.collapsed .mvu-card-body {\n                display: none;\n            }\n\n            /*  */\n            .mvu-card .mvu-card {\n                background: var(--acu-table-head);\n                margin: 6px 0;\n            }\n            .mvu-card .mvu-card .mvu-card-header {\n                background: rgba(128,128,128,0.1);\n                padding: 6px 10px;\n            }\n            .mvu-card .mvu-card .mvu-card-body {\n                padding: 6px 10px;\n            }\n\n            /*  -  */\n            .mvu-card-body.horizontal-nested {\n                display: flex;\n                flex-direction: row;\n                flex-wrap: nowrap;\n                gap: 12px;\n                overflow-x: auto;\n                overflow-y: visible;\n                -webkit-overflow-scrolling: touch;\n                padding-bottom: 8px;\n                align-items: flex-start;\n            }\n            /*  has-nested-cards  wrap  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested {\n                flex-wrap: wrap;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-row {\n                display: flex;\n                flex: 0 0 100%;\n                width: 100%;\n                max-width: 100%; /*  */\n                box-sizing: border-box;\n            }\n            /*  has-nested-cards  */\n            .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                flex: 0 0 auto; /*  */\n                min-width: 100%; /*  */\n                width: auto; /*  */\n                max-width: 450px; /*  */\n                box-sizing: border-box;\n            }\n            @media (min-width: 769px) {\n                .mvu-card.has-nested-cards .mvu-card-body.horizontal-nested > .mvu-row {\n                    max-width: 550px; /*  */\n                }\n            }\n            /*  -  */\n            .mvu-card-body.horizontal-nested > .mvu-card {\n                flex: 0 0 auto; /*  */\n                min-width: 200px;\n                max-width: 350px;\n                width: auto;\n            }\n            /*  */\n            .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                min-width: 400px; /*  */\n                max-width: none; /*  */\n            }\n            @media (min-width: 769px) {\n                .mvu-card-body.horizontal-nested > .mvu-card {\n                    min-width: 240px;\n                    max-width: 400px;\n                }\n                .mvu-card-body.horizontal-nested > .mvu-card.has-nested-cards {\n                    min-width: 500px; /*  */\n                    max-width: none; /*  */\n                }\n            }\n\n            /*  */\n            .mvu-row {\n                display: flex;\n                align-items: flex-start;\n                padding: 5px 0;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n            .mvu-row:last-child {\n                border-bottom: none;\n            }\n            .mvu-key {\n                color: var(--acu-text-sub);\n                min-width: 80px;\n                max-width: 120px;\n                flex-shrink: 0;\n                font-size: 12px;\n                padding-right: 8px;\n                word-break: break-all;\n            }\n            .mvu-value-wrap {\n                flex: 1;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                min-width: 0;\n            }\n            .mvu-value {\n                color: var(--acu-text-main);\n                font-size: var(--acu-font-size, 13px);\n                cursor: pointer;\n                padding: 1px 6px;\n                border-radius: 4px;\n                transition: background 0.2s;\n                word-break: break-word;\n                flex: 0 1 auto;\n            }\n            .mvu-value:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-value.mvu-array-value {\n                font-size: calc(var(--acu-font-size, 13px) * 0.92);\n                color: var(--acu-text-sub);\n            }\n            .mvu-change-indicator {\n                color: var(--acu-success-text);\n                font-weight: bold;\n                font-size: 12px;\n                flex-shrink: 0;\n            }\n            .mvu-row.mvu-changed {\n                background: var(--acu-success-bg);\n                margin: 0 -12px;\n                padding: 5px 12px;\n                border-radius: 4px;\n            }\n            .mvu-card .mvu-card .mvu-row.mvu-changed {\n                margin: 0 -10px;\n                padding: 5px 10px;\n            }\n\n            /*  */\n            .mvu-empty {\n                text-align: center;\n                padding: 40px 20px;\n                color: var(--acu-text-sub);\n                flex: 1;\n                min-width: 100%;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n            }\n            .mvu-empty i {\n                font-size: 32px;\n                margin-bottom: 12px;\n                display: block;\n                opacity: 0.5;\n            }\n            .mvu-empty p {\n                margin: 0 0 6px 0;\n            }\n            .mvu-empty .mvu-empty-hint {\n                font-size: 12px;\n                opacity: 0.7;\n            }\n\n            /*  */\n            .mvu-edit-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0,0,0,0.6);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 99999;\n                animation: mvuFadeIn 0.15s ease-out;\n            }\n            .mvu-edit-dialog {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                padding: 16px;\n                width: 90%;\n                max-width: 400px;\n                animation: mvuSlideIn 0.2s ease-out;\n            }\n            .mvu-edit-title {\n                font-weight: 600;\n                color: var(--acu-text-main);\n                margin-bottom: 12px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .mvu-edit-path {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                background: var(--acu-table-head);\n                padding: 6px 10px;\n                border-radius: 4px;\n                margin-bottom: 12px;\n                word-break: break-all;\n                font-family: monospace;\n            }\n            .mvu-edit-textarea {\n                width: 100%;\n                min-height: 80px;\n                padding: 10px;\n                border: 1px solid var(--acu-border);\n                border-radius: 4px;\n                background: var(--acu-input-bg, var(--acu-bg-panel));\n                color: var(--acu-text-main);\n                font-size: 13px;\n                resize: vertical;\n                box-sizing: border-box;\n            }\n            .mvu-edit-textarea:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n            }\n            .mvu-edit-hint {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                margin-top: 8px;\n                opacity: 0.7;\n            }\n            .mvu-edit-btns {\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n                margin-top: 16px;\n            }\n            .mvu-edit-btn {\n                padding: 8px 16px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 13px;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                transition: all 0.2s;\n            }\n            .mvu-edit-btn.mvu-btn-cancel {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n            }\n            .mvu-edit-btn.mvu-btn-cancel:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-edit-btn.mvu-btn-save {\n                background: var(--acu-accent);\n                border: 1px solid var(--acu-accent);\n                color: #fff;\n            }\n            .mvu-edit-btn.mvu-btn-save:hover {\n                opacity: 0.9;\n            }\n\n            @keyframes mvuFadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes mvuSlideIn {\n                from { transform: translateY(-20px); opacity: 0; }\n                to { transform: translateY(0); opacity: 1; }\n            }\n\n            /*  */\n            .acu-nav-btn.acu-mvu-btn.active {\n                background: var(--acu-btn-active-bg);\n                color: var(--acu-btn-active-text);\n            }\n        `;\n\n    // =====  =====\n    function escapeHtml(s) {\n      return String(s ?? '')\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#039;');\n    }\n\n    function isAvailable() {\n      const mode = detectMode();\n\n      if (mode === 'era') {\n        // ERA  eventEmit  eventOn  iframe \n        const eventEmit = window.eventEmit || window.parent?.eventEmit;\n        const eventOn = window.eventOn || window.parent?.eventOn;\n        const emitAvailable = typeof eventEmit === 'function';\n        const onAvailable = typeof eventOn === 'function';\n        return emitAvailable && onAvailable;\n      } else {\n        // MVU  MVU \n        const mvuAvailable = typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function';\n        return mvuAvailable;\n      }\n    }\n\n    function getData() {\n      console.warn('[DICE]: getData()  MVU  getDataWithRetry()');\n\n      //  ERA  MVU\n      if (cachedEraData) {\n        return cachedEraData;\n      }\n\n      //  MVU\n      try {\n        if (typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function') {\n          const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n          if (allVars && allVars.stat_data) {\n            const data = {\n              stat_data: allVars.stat_data || null,\n              display_data: allVars.display_data || {},\n              delta_data: allVars.delta_data || {},\n              schema: allVars.schema || null,\n              _source: 'mvu', // \n            };\n\n            cachedEraData = data; // \n            return data;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE] MVU :', e);\n      }\n\n      return null;\n    }\n\n    // ===== MVU  =====\n    async function getMvuDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // []  MVU API \n        if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n          //  MVU \n          try {\n            await Promise.race([\n              waitGlobalInitialized('Mvu'),\n              new Promise((_, reject) => setTimeout(() => reject(new Error(' MVU ')), 3000)),\n            ]);\n          } catch (e) {\n            console.warn('[DICE] MVU :', e.message);\n            //  MVU \n          }\n        }\n\n        for (let attempt = 1; attempt <= maxRetries; attempt++) {\n          try {\n            if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n              throw new Error('MVU API ');\n            }\n\n            const allVars = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n\n            if (allVars && allVars.stat_data) {\n              const data = {\n                stat_data: allVars.stat_data || null,\n                display_data: allVars.display_data || {},\n                delta_data: allVars.delta_data || {},\n                schema: allVars.schema || null,\n                _source: 'mvu', // \n              };\n\n              //  MVU \n              cachedEraData = data;\n              console.log('[DICE]MVU ');\n              return data;\n            }\n          } catch (e) {\n            console.warn(`[DICE]MVU  ( ${attempt}/${maxRetries}):`, e);\n          }\n\n          if (attempt < maxRetries) {\n            await new Promise(resolve => setTimeout(resolve, retryDelay));\n          }\n        }\n\n        return null;\n      } catch (e) {\n        console.error('[DICE]MVU :', e);\n        return null;\n      }\n    }\n\n    // \n    async function getDataWithRetry(maxRetries = 3, retryDelay = 500) {\n      try {\n        // \n        const detection = await detectModeWithData();\n\n        // \n        if (detection.data) {\n          cachedEraData = detection.data; // \n          return detection.data;\n        }\n\n        // \n        const mode = detection.mode;\n\n        if (mode === 'era') {\n          // ERA \n          for (let attempt = 1; attempt <= maxRetries; attempt++) {\n            try {\n              const data = await getEraData();\n              if (data && data.stat_data) {\n                cachedEraData = data;\n                return data;\n              }\n            } catch (e) {\n              console.warn(`[DICE]ERA  ( ${attempt}/${maxRetries}):`, e);\n            }\n\n            if (attempt < maxRetries) {\n              await new Promise(resolve => setTimeout(resolve, retryDelay));\n            }\n          }\n\n          // ERA  MVU\n          console.warn('[DICE]ERA  MVU');\n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        } else {\n          // MVU \n          return await getMvuDataWithRetry(maxRetries, retryDelay);\n        }\n      } catch (e) {\n        console.error('[DICE]:', e);\n        return null;\n      }\n    }\n\n    //  ValueWithDescription  [, \"\"]\n    function isVWD(value) {\n      return (\n        Array.isArray(value) &&\n        value.length === 2 &&\n        typeof value[1] === 'string' &&\n        (typeof value[0] === 'number' || typeof value[0] === 'string' || typeof value[0] === 'boolean')\n      );\n    }\n\n    // \n    function isSimpleArray(value) {\n      if (!Array.isArray(value)) return false;\n      return value.every(\n        item => typeof item === 'string' || typeof item === 'number' || typeof item === 'boolean' || item === null,\n      );\n    }\n\n    // \n    function getChangeIndicator(path, deltaData) {\n      if (!deltaData || !path) return '';\n\n      const parts = path.split('.');\n      let current = deltaData;\n      for (const part of parts) {\n        if (current === null || current === undefined) return '';\n        current = current[part];\n      }\n\n      if (!current) return '';\n\n      if (typeof current === 'string' && current.includes('->')) {\n        const match = current.match(/^(-?[\\d.]+)->(-?[\\d.]+)/);\n        if (match) {\n          const oldVal = parseFloat(match[1]);\n          const newVal = parseFloat(match[2]);\n          if (!isNaN(oldVal) && !isNaN(newVal)) {\n            return newVal > oldVal ? '' : newVal < oldVal ? '' : '';\n          }\n        }\n        return '';\n      }\n      return '';\n    }\n\n    // /\n    function countChildren(value) {\n      if (Array.isArray(value)) {\n        if (isVWD(value)) return 0;\n        return value.length;\n      }\n      if (value && typeof value === 'object') {\n        return Object.keys(value).filter(k => !k.startsWith('$')).length;\n      }\n      return 0;\n    }\n\n    // =====  =====\n\n    // \n    // +++\n    function extractNumericDisplayValue(value, isArray = false) {\n      //  null/undefined\n      if (value === null || value === undefined) {\n        return '';\n      }\n\n      // \n      if (isArray || Array.isArray(value)) {\n        if (isVWD(value)) {\n          return String(value[0]);\n        } else if (isSimpleArray(value)) {\n          return value.map(v => String(v ?? '')).join(', ');\n        } else {\n          // \n          return String(value);\n        }\n      }\n\n      // \n      const str = String(value).trim();\n\n      // 1.  \"85\", \"-20\", \"100%\"\n      if (/^-?\\d+(\\.\\d+)?%?$/.test(str)) {\n        return str;\n      }\n\n      // 2. ++ \",[] \" \n      // \"0,[-20, 120] User...\"\n      const rangeMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)(,\\s*\\[[^\\]]+\\])?\\s+/);\n      if (rangeMatch) {\n        // \n        if (rangeMatch[2]) {\n          return rangeMatch[1] + rangeMatch[2].trim();\n        }\n        // \n        return rangeMatch[1];\n      }\n\n      // 2.5. /, \"/,\" \n      // \"100/100,/'/'\"\n      const slashNumericMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?\\/-?\\d+(?:\\.\\d+)?%?),/);\n      if (slashNumericMatch) {\n        return slashNumericMatch[1];\n      }\n\n      // 3. , \",\" \n      // \"150000,...\"\n      const commaDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?),/);\n      if (commaDescMatch) {\n        return commaDescMatch[1];\n      }\n\n      // 4. + \" \" \n      // \"85 \"\n      const numericDescMatch = str.match(/^(-?\\d+(?:\\.\\d+)?%?)\\s+[^\\d]/);\n      if (numericDescMatch) {\n        return numericDescMatch[1];\n      }\n\n      // 5. \n      return str;\n    }\n\n    // \n    // \"85\" -> 85, \"85,[0,100]\" -> 85, \"0,[-20, 120]\" -> 0\n    function extractFirstNumericValue(displayValue) {\n      if (!displayValue) return 0;\n      const str = String(displayValue).trim();\n\n      // \n      const match = str.match(/^(-?\\d+(?:\\.\\d+)?)/);\n      if (match) {\n        const num = parseFloat(match[1]);\n        return isNaN(num) ? 0 : num;\n      }\n\n      return 0;\n    }\n\n    // \n    function renderRow(key, value, path, deltaData) {\n      const changeIndicator = getChangeIndicator(path, deltaData);\n      const changedClass = changeIndicator ? 'mvu-changed' : '';\n\n      let displayValue;\n      let valueClass = 'mvu-value';\n\n      if (isVWD(value)) {\n        displayValue = String(value[0]);\n      } else if (isSimpleArray(value)) {\n        displayValue = value.map(v => String(v ?? '')).join(', ');\n        valueClass += ' mvu-array-value';\n      } else {\n        // \n        displayValue = extractNumericDisplayValue(value ?? '', false);\n      }\n\n      // [] \n      let diceIconHtml = '';\n      try {\n        //  extractNumericDisplayValue \n        //  \"85,[0,100]\"  85  100\n        if (typeof isNumericCell === 'function' && isNumericCell(displayValue)) {\n          // \n          const numericValue = extractFirstNumericValue(displayValue);\n          if (numericValue > 0) {\n            //  key key \n            let attrName = key;\n            if (key.includes('.')) {\n              const parts = key.split('.');\n              attrName = parts[parts.length - 1];\n            }\n            // \n            if (path && path.includes('.')) {\n              const pathParts = path.split('.');\n              const lastPart = pathParts[pathParts.length - 1];\n              // \n              if (lastPart && !/^\\d+$/.test(lastPart) && lastPart !== key) {\n                attrName = lastPart;\n              }\n            }\n            diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon\" data-path=\"${escapeHtml(path)}\" data-attr-name=\"${escapeHtml(attrName)}\" data-attr-value=\"${numericValue}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.6;font-size:calc(var(--acu-font-size, 13px) * 0.85);flex-shrink:0;\" title=\"\"></i>`;\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule renderRow: ', e);\n      }\n\n      return `\n                <div class=\"mvu-row ${changedClass}\">\n                    <div class=\"mvu-key\">${escapeHtml(key)}</div>\n                    <div class=\"mvu-value-wrap\">\n                        <span class=\"${valueClass}\" data-path=\"${escapeHtml(path)}\">${escapeHtml(displayValue)}</span>\n                        ${diceIconHtml}\n                        ${changeIndicator ? `<span class=\"mvu-change-indicator\">${changeIndicator}</span>` : ''}\n                    </div>\n                </div>\n            `;\n    }\n\n    // \n    function renderCard(key, value, path, deltaData, depth, defaultExpanded, isHorizontal) {\n      const childCount = countChildren(value);\n      const collapsedClass = defaultExpanded ? '' : 'collapsed';\n\n      let bodyHtml = '';\n      let hasNestedCards = false; // \n      let nestedCardCount = 0; // \n      let rowCount = 0; // \n\n      if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n        // \n        value.forEach((item, index) => {\n          const itemPath = `${path}[${index}]`;\n\n          if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(`[${index}]`, item, itemPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            rowCount++;\n            bodyHtml += renderRow(`[${index}]`, item, itemPath, deltaData);\n          }\n        });\n      } else if (value && typeof value === 'object' && !isVWD(value)) {\n        // \n        const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n\n        for (const [childKey, childValue] of entries) {\n          const childPath = path ? `${path}.${childKey}` : childKey;\n\n          if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n            // /  \n            hasNestedCards = true;\n            nestedCardCount++;\n            bodyHtml += renderCard(childKey, childValue, childPath, deltaData, depth + 1, false, isHorizontal);\n          } else {\n            //   \n            rowCount++;\n            bodyHtml += renderRow(childKey, childValue, childPath, deltaData);\n          }\n        }\n      }\n\n      const countText = Array.isArray(value) ? `[${childCount}]` : `(${childCount})`;\n\n      //  card-body  horizontal-nested \n      const bodyClass = isHorizontal && hasNestedCards ? 'mvu-card-body horizontal-nested' : 'mvu-card-body';\n\n      // \n      let nestedCardsNeedWidth = false;\n      if (isHorizontal && hasNestedCards && depth === 0) {\n        // \n        if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n          // \n          value.forEach(item => {\n            if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n              const itemChildCount = countChildren(item);\n              if (itemChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          });\n        } else if (value && typeof value === 'object' && !isVWD(value)) {\n          // \n          const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n          for (const [childKey, childValue] of entries) {\n            if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n              const childChildCount = countChildren(childValue);\n              if (childChildCount >= 2) nestedCardsNeedWidth = true;\n            }\n          }\n        }\n      }\n\n      //  has-nested-cards \n      // \n      // depth === 0\n      //   -  >= 2  <= 1 has-nested-cards\n      //   -  has-nested-cards\n      // depth > 0rowCount === 0 >= 2  has-nested-cards\n      const shouldAddHasNestedClass =\n        isHorizontal &&\n        hasNestedCards &&\n        ((depth === 0 && ((nestedCardCount >= 2 && rowCount <= 1) || nestedCardsNeedWidth)) || //  >= 2  <= 1\n          (depth > 0 && rowCount === 0 && nestedCardCount >= 2)); //  >= 2\n      const hasNestedClass = shouldAddHasNestedClass ? ' has-nested-cards' : '';\n\n      return `\n                <div class=\"mvu-card${hasNestedClass} ${collapsedClass}\" data-path=\"${escapeHtml(path)}\" data-depth=\"${depth}\">\n                    <div class=\"mvu-card-header\">\n                        <div class=\"mvu-card-title\">\n                            <span>${escapeHtml(key)}</span>\n                            <span class=\"mvu-card-count\">${countText}</span>\n                        </div>\n                        <span class=\"mvu-card-toggle\"></span>\n                    </div>\n                    <div class=\"${bodyClass}\">\n                        ${bodyHtml}\n                    </div>\n                </div>\n            `;\n    }\n\n    // [] \n    function renderNumericMode(mvuData) {\n      if (!mvuData || !mvuData.stat_data) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-inbox\"></i><p></p></div>';\n      }\n\n      // [] \n      let visibleLevels = {};\n      try {\n        const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n        if (saved) {\n          visibleLevels = JSON.parse(saved);\n        }\n      } catch (e) {\n        console.warn('[DICE]MvuModule ', e);\n      }\n\n      // \n      const numericItems = [];\n\n      // \n      function collectNumericItems(obj, path, levelNames) {\n        if (!obj || typeof obj !== 'object') return;\n\n        if (Array.isArray(obj)) {\n          if (isVWD(obj) || isSimpleArray(obj)) {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const itemValue = String(item ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: itemPath,\n                    key: `[${index}]`,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: [...levelNames],\n                  });\n                }\n              }\n            });\n          } else {\n            // \n            obj.forEach((item, index) => {\n              const itemPath = path ? `${path}[${index}]` : `[${index}]`;\n              const newLevelNames = [...levelNames, `[${index}]`];\n              collectNumericItems(item, itemPath, newLevelNames);\n            });\n          }\n        } else {\n          // \n          const entries = Object.entries(obj).filter(([k]) => !k.startsWith('$'));\n          for (const [key, value] of entries) {\n            const childPath = path ? `${path}.${key}` : key;\n            const newLevelNames = [...levelNames, key];\n\n            if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n              // \n              collectNumericItems(value, childPath, newLevelNames);\n            } else {\n              // \n              const itemValue = String(value ?? '').trim();\n              if (typeof isNumericCell === 'function' && isNumericCell(itemValue)) {\n                // \n                const displayValue = extractNumericDisplayValue(itemValue, false);\n                const numValue = extractFirstNumericValue(displayValue);\n                if (numValue > 0) {\n                  numericItems.push({\n                    path: childPath,\n                    key: key,\n                    value: itemValue,\n                    numericValue: numValue,\n                    levelNames: newLevelNames,\n                  });\n                }\n              }\n            }\n          }\n        }\n      }\n\n      // \n      const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n      for (const key of topKeys) {\n        const value = mvuData.stat_data[key];\n        collectNumericItems(value, key, [key]);\n      }\n\n      // [] \n      const filteredNumericItems = numericItems.filter(item => {\n        // key\n        // levelNames\n        let lastLevelKey = item.key;\n        const nonArrayLevels = item.levelNames.filter(level => level && !level.startsWith('['));\n        if (nonArrayLevels.length > 0) {\n          lastLevelKey = nonArrayLevels[nonArrayLevels.length - 1];\n        } else if (item.path && item.path.includes('.')) {\n          // levelNamespath\n          const parts = item.path.split('.');\n          lastLevelKey = parts[parts.length - 1];\n        }\n        //  BlacklistManager \n        return !BlacklistManager.isBlacklisted(lastLevelKey);\n      });\n\n      if (filteredNumericItems.length === 0) {\n        return '<div class=\"mvu-empty\"><i class=\"fa-solid fa-filter\"></i><p></p></div>';\n      }\n\n      // \n      //  2\n      const allLevelNames = new Set();\n      filteredNumericItems.forEach(item => {\n        // \n        const hierarchyLevels =\n          item.levelNames.length > 1\n            ? item.levelNames.slice(0, -1) // \n            : [];\n\n        hierarchyLevels.forEach(level => {\n          if (level && !level.startsWith('[')) {\n            // \n            allLevelNames.add(level);\n          }\n        });\n      });\n\n      const levelNamesArray = Array.from(allLevelNames).sort();\n\n      //  toggle \n      let levelTogglesHtml = '';\n      if (levelNamesArray.length > 0) {\n        const theme = getThemeColors();\n        const buttonTextColor = theme.buttonTextOnAccent || theme.textMain || '#6B4A5A';\n\n        // \n        let levelButtonsHtml = '';\n        levelNamesArray.forEach(levelName => {\n          const isVisible = visibleLevels[levelName] !== false; // \n          const activeStyle = isVisible\n            ? `background:var(--acu-accent);color:${buttonTextColor};border-color:var(--acu-accent);opacity:1;`\n            : 'background:transparent;color:var(--acu-text-sub);border-color:var(--acu-border);opacity:0.5;';\n          levelButtonsHtml += `<button class=\"mvu-level-toggle\" data-level=\"${escapeHtml(levelName)}\" data-visible=\"${isVisible}\" style=\"display:flex;align-items:center;gap:4px;font-size:calc(var(--acu-font-size, 13px) * 0.85);cursor:pointer;padding:2px 6px;border-radius:4px;border:1px solid;${activeStyle}transition:all 0.2s;\" title=\"${isVisible ? '' : ''}: ${escapeHtml(levelName)}\"><span>${escapeHtml(levelName)}</span></button>`;\n        });\n\n        // \n        levelTogglesHtml = `\n          <div class=\"mvu-level-controls-collapsible collapsed\">\n            <div class=\"mvu-level-controls-header\" style=\"padding:6px 8px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);cursor:pointer;display:flex;align-items:center;justify-content:space-between;user-select:none;\">\n              <span style=\"font-size:calc(var(--acu-font-size, 13px) * 0.85);color:var(--acu-text-sub);\"></span>\n              <i class=\"fa-solid fa-chevron-down mvu-level-controls-toggle-icon\" style=\"font-size:10px;color:var(--acu-text-sub);transition:transform 0.2s;\"></i>\n            </div>\n            <div class=\"mvu-level-controls-body\" style=\"padding:8px;background:var(--acu-table-head);border-bottom:1px solid var(--acu-border);display:flex;flex-wrap:wrap;gap:6px;align-items:center;\">\n              ${levelButtonsHtml}\n            </div>\n          </div>\n        `;\n      }\n\n      // \n      let itemsHtml = '';\n      filteredNumericItems.forEach(item => {\n        //  data-levels \n        const nonArrayLevels = item.levelNames.filter(level => !level.startsWith('['));\n\n        // \n        const visibleLevels = item.levelNames.filter(level => {\n          if (level.startsWith('[')) return false; // \n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        //  1\n        //  visibleLevels \n        const pathLevels = visibleLevels.length > 1 ? visibleLevels.slice(0, -1) : [];\n\n        // \n        //  nonArrayLevels  N-1 \n        const hierarchyLevels = nonArrayLevels.length > 1 ? nonArrayLevels.slice(0, -1) : [];\n\n        const allLevelsVisible = hierarchyLevels.every(level => {\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            if (saved) {\n              const prefs = JSON.parse(saved);\n              return prefs[level] !== false; // \n            }\n          } catch (e) {\n            // \n          }\n          return true;\n        });\n\n        // \n        const pathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n        const attrName = item.key;\n\n        // \n        let finalAttrName = attrName;\n        if (item.path && item.path.includes('.')) {\n          const parts = item.path.split('.');\n          finalAttrName = parts[parts.length - 1];\n        }\n\n        // \n        const diceIconHtml = `<i class=\"fa-solid fa-dice-d20 mvu-dice-icon\" data-path=\"${escapeHtml(item.path)}\" data-attr-name=\"${escapeHtml(finalAttrName)}\" data-attr-value=\"${item.numericValue}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.6;font-size:calc(var(--acu-font-size, 13px) * 0.85);flex-shrink:0;\" title=\"\"></i>`;\n\n        // \n        let displayValue = extractNumericDisplayValue(item.value, false);\n        //  \",[0, 100]\"\n        displayValue = displayValue.replace(/,\\s*\\[[^\\]]+\\]/g, '');\n\n        //  data-levels \n        // data-levels \n        const displayStyle = allLevelsVisible ? '' : 'display:none;';\n        const levelsJson = JSON.stringify(hierarchyLevels);\n\n        itemsHtml += `\n          <div class=\"mvu-numeric-item\" data-levels='${escapeHtml(levelsJson)}' style=\"${displayStyle}display:flex;align-items:center;padding:6px 8px;margin-bottom:4px;background:var(--acu-table-hover);border-radius:4px;border-left:3px solid var(--acu-accent);\">\n            <div style=\"flex:1;min-width:0;\">\n              <div class=\"mvu-path-display\" style=\"font-size:calc(var(--acu-font-size, 13px) * 0.77);color:var(--acu-text-sub);margin-bottom:2px;\">${escapeHtml(pathDisplay)}</div>\n              <div style=\"display:flex;align-items:center;gap:6px;\">\n                <span style=\"font-size:calc(var(--acu-font-size, 13px) * 0.92);color:var(--acu-text-main);font-weight:bold;\">${escapeHtml(finalAttrName)}</span>\n                <span class=\"mvu-value\" data-path=\"${escapeHtml(item.path)}\" style=\"font-size:var(--acu-font-size, 13px);color:var(--acu-accent);font-weight:bold;cursor:pointer;\" title=\"\">${escapeHtml(displayValue)}</span>\n                ${diceIconHtml}\n              </div>\n            </div>\n          </div>\n        `;\n      });\n\n      return levelTogglesHtml + '<div class=\"mvu-numeric-items\" style=\"padding:0 8px;\">' + itemsHtml + '</div>';\n    }\n\n    // =====  API =====\n    return {\n      MODULE_ID: MODULE_ID,\n\n      isAvailable: isAvailable,\n      getData: getData,\n      getDataWithRetry: getDataWithRetry,\n\n      // \n      diagnoseVariableFramework: async function () {\n        const result = {\n          timestamp: new Date().toISOString(),\n          era: {\n            available: false,\n            eventEmit: typeof (window.eventEmit || window.parent?.eventEmit) === 'function',\n            eventOn: typeof (window.eventOn || window.parent?.eventOn) === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          mvu: {\n            available: false,\n            apiExists: typeof window.Mvu !== 'undefined',\n            getDataExists: typeof window.Mvu?.getMvuData === 'function',\n            dataAvailable: false,\n            error: null,\n          },\n          cache: {\n            hasCache: !!cachedEraData,\n            cacheKeys: cachedEraData ? Object.keys(cachedEraData) : [],\n          },\n          recommendation: '',\n        };\n\n        //  ERA\n        if (result.era.eventEmit && result.era.eventOn) {\n          try {\n            const eraData = await Promise.race([\n              getEraData(),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 2000)),\n            ]);\n            result.era.available = true;\n            result.era.dataAvailable = !!(eraData && eraData.stat_data);\n          } catch (e) {\n            result.era.error = e.message;\n          }\n        }\n\n        //  MVU\n        if (result.mvu.apiExists && result.mvu.getDataExists) {\n          try {\n            // [] \n            await Promise.race([\n              waitGlobalInitialized('Mvu'),\n              new Promise((_, reject) => setTimeout(() => reject(new Error('')), 2000)),\n            ]);\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            result.mvu.available = true;\n            result.mvu.dataAvailable = !!(mvuData && mvuData.stat_data);\n          } catch (e) {\n            result.mvu.error = e.message;\n          }\n        }\n\n        // \n        if (result.era.dataAvailable) {\n          result.recommendation = 'ERA ';\n        } else if (result.mvu.dataAvailable) {\n          result.recommendation = 'MVU ';\n        } else if (result.era.available || result.mvu.available) {\n          result.recommendation = '';\n        } else {\n          result.recommendation = ' MVU  ERA ';\n        }\n\n        return result;\n      },\n\n      injectStyles: function () {\n        //  document iframe \n        const targetDoc = window.parent?.document || document;\n        if (targetDoc.getElementById('mvu-module-styles')) return;\n        const styleEl = targetDoc.createElement('style');\n        styleEl.id = 'mvu-module-styles';\n        styleEl.textContent = STYLES;\n        targetDoc.head.appendChild(styleEl);\n      },\n\n      renderNavButton: function (isActive) {\n        //  isAvailable()\n        const activeClass = isActive ? 'active' : '';\n        return `<button class=\"acu-nav-btn acu-mvu-btn $${activeClass}\" id=\"acu-btn-mvu\" data-table=\"$${MODULE_ID}\" style=\"order:-1;\">\n                    <i class=\"fa-solid fa-code-branch\"></i><span></span>\n                </button>`;\n      },\n\n      renderPanel: function () {\n        // \n        // \n\n        const mvuData = getData();\n\n        // MVU  ERA\n        const varMode = detectMode();\n        const isEraMode = varMode === 'era';\n\n        // [] \n        let isNumericMode = false;\n        try {\n          const saved = localStorage.getItem('acu_mvu_numeric_mode');\n          isNumericMode = saved === 'true';\n        } catch (e) {\n          console.warn('[DICE]MvuModule ', e);\n        }\n\n        // MVU\n        const layoutMode = 'vertical-layout';\n\n        // \n        const panelTitle = isEraMode ? 'ERA ' : 'MVU ';\n\n        // MVU  null\n        if (!mvuData) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-exclamation-circle\"></i>\n                                <p> ${isEraMode ? 'ERA' : 'MVU'} </p>\n                                <p class=\"mvu-empty-hint\"> ${isEraMode ? 'ERA ' : 'MVU '}</p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        //  stat_data  null\n        if (\n          !mvuData.stat_data ||\n          (typeof mvuData.stat_data === 'object' && Object.keys(mvuData.stat_data).length === 0)\n        ) {\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                                <div class=\"acu-title-sub\">(0)</div>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <div class=\"acu-height-control\">\n                                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                                </div>\n                                <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                    <i class=\"fa-solid fa-sync-alt\"></i>\n                                </button>\n                                <button class=\"acu-close-btn\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content ${layoutMode}\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-inbox\"></i>\n                                <p></p>\n                                <p class=\"mvu-empty-hint\"> AI </p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        // [] \n        if (isNumericMode) {\n          const numericHtml = renderNumericMode(mvuData);\n          return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span> <span style=\"font-size:calc(var(--acu-font-size,13px) * 0.85);color:var(--acu-text-sub);margin-left:6px;\">()</span></div>\n                            <div class=\"acu-title-sub\">()</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode active\" title=\"\">\n                                <i class=\"fa-solid fa-list\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode} mvu-numeric-mode\">\n                        ${numericHtml}\n                    </div>\n                `;\n        }\n\n        // \n        const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n\n        let cardsHtml = '';\n        for (const key of topKeys) {\n          const value = mvuData.stat_data[key];\n          const childCount = countChildren(value);\n\n          if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n            // /  \n            // MVU isHorizontal  false\n            cardsHtml += renderCard(key, value, key, mvuData.delta_data, 0, true, false);\n          } else {\n            //   \n            cardsHtml += `\n                            <div class=\"mvu-card\" data-path=\"${escapeHtml(key)}\" data-depth=\"0\">\n                                <div class=\"mvu-card-body\">\n                                    ${renderRow(key, value, key, mvuData.delta_data)}\n                                </div>\n                            </div>\n                        `;\n          }\n        }\n\n        return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-branch\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                            <div class=\"acu-title-sub\">(${topKeys.length})</div>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <div class=\"acu-height-control\">\n                                <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${MvuModule.MODULE_ID}\" title=\"  | \"></i>\n                            </div>\n                            <button class=\"mvu-header-btn mvu-btn-numeric-mode\" title=\"\">\n                                <i class=\"fa-solid fa-filter\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"acu-close-btn\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content ${layoutMode}\">\n                        ${cardsHtml}\n                    </div>\n                `;\n      },\n\n      bindEvents: function ($container) {\n        //  jQuery\n        const $ = window.parent?.jQuery || window.jQuery;\n        if (!$ || !$container || !$container.length) {\n          console.warn('[DICE]MvuModule bindEvents: jQuery or container not available');\n          return;\n        }\n\n        //  jQuery \n        const $panel = $('#acu-data-area');\n        if (!$panel.length) {\n          console.warn('[DICE]MvuModule bindEvents: #acu-data-area not found');\n          return;\n        }\n\n        // \n        $panel.off('.mvu');\n\n        // /\n        $panel.on('click.mvu', '.mvu-card-header', function (e) {\n          e.stopPropagation();\n          const $card = $(this).closest('.mvu-card');\n          const $body = $card.find('> .mvu-card-body').first();\n\n          // \n          if ($body.is(':animated') || $body.hasClass('animating')) return;\n\n          if ($card.hasClass('collapsed')) {\n            //  hide()  collapsed \n            $body.hide();\n            $card.removeClass('collapsed');\n            $body.addClass('animating').slideDown(180, function () {\n              $(this).removeClass('animating');\n            });\n          } else {\n            // \n            $body.addClass('animating').slideUp(180, function () {\n              $card.addClass('collapsed');\n              $(this).removeClass('animating');\n            });\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-btn-refresh', function (e) {\n          e.stopPropagation();\n          MvuModule.refresh($panel);\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-btn-numeric-mode', function (e) {\n          e.stopPropagation();\n          try {\n            const isCurrentlyNumeric = $(this).hasClass('active');\n            const newMode = !isCurrentlyNumeric;\n            localStorage.setItem('acu_mvu_numeric_mode', String(newMode));\n            // \n            if (typeof saveActiveTabState === 'function') {\n              const currentTab = getActiveTabState();\n              saveActiveTabState(currentTab);\n            }\n            if (typeof renderInterface === 'function') {\n              renderInterface();\n            }\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n            if (window.toastr) window.toastr.error('');\n          }\n        });\n\n        // [] /\n        $panel.on('click.mvu', '.mvu-level-controls-header', function (e) {\n          e.stopPropagation();\n          const $header = $(this);\n          const $collapsible = $header.closest('.mvu-level-controls-collapsible');\n\n          //  collapsed CSS \n          $collapsible.toggleClass('collapsed');\n        });\n\n        // []  toggle\n        $panel.on('click.mvu', '.mvu-level-toggle', function (e) {\n          e.stopPropagation();\n          const $button = $(this);\n          const levelName = $button.data('level');\n          const currentVisible = $button.data('visible') === 'true' || $button.data('visible') === true;\n          const isVisible = !currentVisible;\n\n          try {\n            const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n            const visibleLevels = saved ? JSON.parse(saved) : {};\n            visibleLevels[levelName] = isVisible;\n            localStorage.setItem('acu_mvu_numeric_mode_visible_levels', JSON.stringify(visibleLevels));\n\n            // \n            const theme = getThemeColors();\n            const buttonTextColor = theme.buttonTextOnAccent || theme.textMain || '#6B4A5A';\n            $button.data('visible', isVisible);\n            if (isVisible) {\n              $button.css({\n                background: 'var(--acu-accent)',\n                color: buttonTextColor,\n                borderColor: 'var(--acu-accent)',\n                opacity: '1',\n              });\n              $button.attr('title', `: ${levelName}`);\n            } else {\n              $button.css({\n                background: 'transparent',\n                color: 'var(--acu-text-sub)',\n                borderColor: 'var(--acu-border)',\n                opacity: '0.5',\n              });\n              $button.attr('title', `: ${levelName}`);\n            }\n\n            //  3\n            $('.mvu-numeric-item').each(function () {\n              const $item = $(this);\n              try {\n                const levels = JSON.parse($item.attr('data-levels') || '[]');\n                if (levels.includes(levelName)) {\n                  // \n                  const visibleLevels = levels.filter(level => {\n                    const saved = localStorage.getItem('acu_mvu_numeric_mode_visible_levels');\n                    const prefs = saved ? JSON.parse(saved) : {};\n                    return prefs[level] !== false;\n                  });\n\n                  //  levels \n                  const pathLevels = visibleLevels;\n\n                  const newPathDisplay = pathLevels.length > 0 ? pathLevels.join(' > ') : '';\n\n                  // \n                  $item.find('.mvu-path-display').text(newPathDisplay);\n                }\n              } catch (e) {\n                console.warn('[DICE]MvuModule ', e);\n              }\n            });\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-value', function (e) {\n          e.stopPropagation();\n          const $value = $(this);\n          const path = $value.data('path');\n          if (!path) {\n            console.warn('[DICE]MvuModule No path on value element');\n            return;\n          }\n          const currentValue = $value\n            .text()\n            .replace(/\\s*\\$\\s*$/, '')\n            .trim(); //  $\n\n          MvuModule.showEditDialog(path, currentValue, async function (newValue) {\n            if (newValue !== null && newValue !== currentValue) {\n              const success = await MvuModule.setValue(path, newValue);\n              const toastr = window.parent?.toastr || window.toastr;\n              if (success) {\n                $value.text(newValue);\n                $value.css('background', 'var(--acu-success-bg)');\n                setTimeout(() => $value.css('background', ''), 1500);\n              } else {\n                if (toastr) toastr.error('');\n              }\n            }\n          });\n        });\n\n        // [] \n        $panel.on('click.mvu', '.mvu-dice-icon', function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n          const $icon = $(this);\n          const path = $icon.data('path');\n          const attrName = $icon.data('attr-name') || '';\n          const attrValue = parseInt($icon.data('attr-value'), 10) || 50;\n\n          // \n          if (!path) {\n            console.warn('[DICE]MvuModule ');\n            return;\n          }\n\n          //  MVU \n          if (typeof window.Mvu === 'undefined' || typeof window.Mvu.getMvuData !== 'function') {\n            console.warn('[DICE]MvuModule MVU ');\n            // \n            if (typeof showDicePanel === 'function') {\n              showDicePanel({\n                attrValue: attrValue,\n                targetValue: null, // showDicePanel\n                targetName: attrName,\n                initiatorName: '<user>',\n                fromMvu: false,\n              });\n            }\n            return;\n          }\n\n          // \n          let parsedInfo = null;\n          try {\n            parsedInfo = parseMvuPathForDice(path, attrValue);\n          } catch (e) {\n            console.warn('[DICE]MvuModule ', e);\n          }\n\n          // \n          if (typeof showDicePanel === 'function') {\n            showDicePanel({\n              attrValue: attrValue,\n              targetValue: null, // showDicePanel\n              targetName: attrName,\n              initiatorName: parsedInfo?.initiator || '<user>',\n              fromMvu: true,\n              mvuPath: path,\n              mvuParsedInfo: parsedInfo,\n            });\n          }\n        });\n\n        //  ST  swipe regenerate\n        (function () {\n          //  documentiframe \n          const targetDoc = window.parent?.document || document;\n          const $doc = $(targetDoc);\n\n          // \n          $doc.off('touchstart.mvuSwipeFix touchmove.mvuSwipeFix touchend.mvuSwipeFix', '#acu-data-area');\n\n          let touchStartX = 0;\n          let touchStartY = 0;\n          let isHorizontalSwipe = false;\n\n          //  #acu-data-area  MVU \n          $doc.on('touchstart.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) return;\n\n            if (e.originalEvent.touches.length === 1) {\n              touchStartX = e.originalEvent.touches[0].clientX;\n              touchStartY = e.originalEvent.touches[0].clientY;\n              isHorizontalSwipe = false;\n            }\n          });\n\n          $doc.on('touchmove.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              return;\n            }\n\n            if (e.originalEvent.touches.length !== 1) return;\n\n            const touch = e.originalEvent.touches[0];\n            const deltaX = Math.abs(touch.clientX - touchStartX);\n            const deltaY = Math.abs(touch.clientY - touchStartY);\n\n            // X > Y * 1.5\n            // deltaYdeltaX\n            const isHorizontal =\n              deltaY < 5\n                ? deltaX > 5 && deltaX > deltaY * 2 // deltaYdeltaX > 5deltaY\n                : deltaX > deltaY * 1.5 && deltaX > 10; // \n\n            if (isHorizontal) {\n              isHorizontalSwipe = true;\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n            }\n          });\n\n          $doc.on('touchend.mvuSwipeFix', '#acu-data-area', function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n\n            //  MVU \n            if (!isInMvuPanel) {\n              isHorizontalSwipe = false;\n              touchStartX = 0;\n              touchStartY = 0;\n              return;\n            }\n\n            // \n            if (isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              isHorizontalSwipe = false;\n            }\n            touchStartX = 0;\n            touchStartY = 0;\n          });\n\n          // \n          const captureHandlerTouchStart = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1) {\n              touchStartX = e.touches[0].clientX;\n              touchStartY = e.touches[0].clientY;\n            }\n          };\n          const captureHandlerTouchMove = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && e.touches && e.touches.length === 1 && touchStartX && touchStartY) {\n              const touch = e.touches[0];\n              const deltaX = Math.abs(touch.clientX - touchStartX);\n              const deltaY = Math.abs(touch.clientY - touchStartY);\n              // \n              const isHorizontal =\n                deltaY < 5 ? deltaX > 5 && deltaX > deltaY * 2 : deltaX > deltaY * 1.5 && deltaX > 10;\n              if (isHorizontal) {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                e.preventDefault();\n              }\n            }\n          };\n          const captureHandlerTouchEnd = function (e) {\n            const $target = $(e.target);\n            const isInMvuPanel = $target.closest('.acu-mvu-panel').length > 0;\n            if (isInMvuPanel && isHorizontalSwipe) {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              e.preventDefault();\n            }\n          };\n          // \n          targetDoc.addEventListener('touchstart', captureHandlerTouchStart, true);\n          targetDoc.addEventListener('touchmove', captureHandlerTouchMove, true);\n          targetDoc.addEventListener('touchend', captureHandlerTouchEnd, true);\n        })();\n\n        // \n        $panel.on('click.mvu', '.acu-close-btn', function (e) {\n          e.stopPropagation();\n          const $input = $panel.find('.acu-search-input');\n\n          // \n          if ($input.length && $input.val()) {\n            $input.val('').trigger('input').focus();\n            return;\n          }\n\n          // \n          if (typeof saveActiveTabState === 'function') {\n            saveActiveTabState(null);\n          }\n          if (typeof renderInterface === 'function') {\n            renderInterface();\n          }\n        });\n\n        // \n        $panel.on('pointerdown.mvu', '.acu-height-drag-handle', function (e) {\n          if (e.button !== 0) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const handle = this;\n          handle.setPointerCapture(e.pointerId);\n          $(handle).addClass('active');\n          const startHeight = $panel.height();\n          const startY = e.clientY;\n          const tableName = $(handle).data('table');\n\n          //  MIN_PANEL_HEIGHT  MAX_PANEL_HEIGHT\n          const MIN_PANEL_HEIGHT = typeof window.MIN_PANEL_HEIGHT !== 'undefined' ? window.MIN_PANEL_HEIGHT : 200;\n          const MAX_PANEL_HEIGHT = typeof window.MAX_PANEL_HEIGHT !== 'undefined' ? window.MAX_PANEL_HEIGHT : 800;\n\n          handle.onpointermove = function (moveE) {\n            const dy = moveE.clientY - startY;\n            let newHeight = startHeight - dy; // \n            if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n            if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n            $panel.css('height', newHeight + 'px');\n          };\n          handle.onpointerup = function (upE) {\n            $(handle).removeClass('active');\n            handle.releasePointerCapture(upE.pointerId);\n            handle.onpointermove = null;\n            handle.onpointerup = null;\n            if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n              const heights = getTableHeights();\n              heights[tableName] = parseInt($panel.css('height'));\n              saveTableHeights(heights);\n              $panel.addClass('acu-manual-mode');\n            }\n          };\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-height-drag-handle', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = $(this).data('table');\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n\n        // \n        $panel.on('dblclick.mvu', '.acu-panel-header', function (e) {\n          if ($(e.target).closest('.acu-search-input, .acu-close-btn, .mvu-header-btn').length) return;\n          e.preventDefault();\n          e.stopPropagation();\n          const tableName = MvuModule.MODULE_ID;\n          if (tableName && typeof getTableHeights === 'function' && typeof saveTableHeights === 'function') {\n            const heights = getTableHeights();\n            delete heights[tableName];\n            saveTableHeights(heights);\n            $panel.css('height', '').removeClass('acu-manual-mode');\n          }\n        });\n      },\n\n      showEditDialog: function (path, currentValue, onSave) {\n        //  jQuery  document\n        const $ = window.parent?.jQuery || window.jQuery;\n        const targetDoc = window.parent?.document || document;\n        if (!$) return;\n\n        // \n        $(targetDoc).find('.mvu-edit-overlay').remove();\n\n        const currentTheme = (typeof getConfig === 'function' ? getConfig().theme : null) || 'retro';\n\n        const html = `\n                    <div class=\"mvu-edit-overlay acu-edit-overlay acu-theme-${currentTheme}\">\n                        <div class=\"mvu-edit-dialog acu-edit-dialog\">\n                            <div class=\"acu-edit-title\">\n                                <i class=\"fa-solid fa-edit\" style=\"opacity:0.7;\"></i>\n                                <span></span>\n                            </div>\n                            <div class=\"mvu-edit-path\">${escapeHtml(path)}</div>\n                            <textarea class=\"mvu-edit-textarea acu-edit-textarea\">${escapeHtml(currentValue)}</textarea>\n                            <div class=\"mvu-edit-hint\">Ctrl+Enter  | Esc </div>\n                            <div class=\"acu-dialog-btns\">\n                                <button class=\"acu-dialog-btn mvu-btn-cancel\">\n                                    <i class=\"fa-solid fa-times\"></i> \n                                </button>\n                                <button class=\"acu-dialog-btn acu-btn-confirm mvu-btn-save\">\n                                    <i class=\"fa-solid fa-check\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `;\n\n        $(targetDoc.body).append(html);\n        const $overlay = $(targetDoc).find('.mvu-edit-overlay');\n        const $input = $overlay.find('.mvu-edit-textarea');\n\n        setTimeout(() => $input.focus().select(), 50);\n\n        // \n        $overlay.on('click', '.mvu-btn-cancel', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          $overlay.remove();\n          onSave(null);\n        });\n\n        // \n        $overlay.on('click', '.mvu-btn-save', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const newValue = $input.val();\n          $overlay.remove();\n          onSave(newValue);\n        });\n\n        // \n        $overlay.on('click', function (e) {\n          if ($(e.target).hasClass('mvu-edit-overlay')) {\n            $overlay.remove();\n            onSave(null);\n          }\n        });\n\n        // \n        $input.on('keydown', function (e) {\n          if (e.key === 'Escape') {\n            e.preventDefault();\n            $overlay.remove();\n            onSave(null);\n          } else if (e.key === 'Enter' && e.ctrlKey) {\n            e.preventDefault();\n            const newValue = $input.val();\n            $overlay.remove();\n            onSave(newValue);\n          }\n        });\n      },\n\n      setValue: async function (path, newValue) {\n        if (!isAvailable()) return false;\n\n        const mode = detectMode();\n\n        try {\n          let parsedValue = newValue;\n          if (newValue === 'true') parsedValue = true;\n          else if (newValue === 'false') parsedValue = false;\n          else if (!isNaN(Number(newValue)) && String(newValue).trim() !== '') {\n            parsedValue = Number(newValue);\n          }\n\n          if (mode === 'era') {\n            return await setEraValue(path, parsedValue);\n          } else {\n            const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n            if (!mvuData) {\n              console.error('[DICE]MvuModule  MVU ');\n              return false;\n            }\n\n            const success = await window.Mvu.setMvuVariable(mvuData, path, parsedValue, {\n              reason: '',\n              is_recursive: false,\n            });\n\n            if (success) {\n              await window.Mvu.replaceMvuData(mvuData, { type: 'message', message_id: 'latest' });\n            } else {\n              console.warn('[DICE]MvuModule setMvuVariable  false');\n            }\n\n            return success;\n          }\n        } catch (e) {\n          console.error('[DICE]MvuModule setValue error:', e);\n          return false;\n        }\n      },\n\n      isModuleTab: function (tableName) {\n        return tableName === MODULE_ID;\n      },\n\n      //  ERA  ERA \n      clearCache: function () {\n        cachedEraData = null;\n        console.log('[DICE]MvuModule  ERA ');\n      },\n\n      // \n      detectMode: function () {\n        return detectMode();\n      },\n\n      refresh: function ($container) {\n        // \n        this.clearCache();\n\n        if (!$container || !$container.length) {\n          const $panel = $('#acu-data-area');\n          if (!$panel.length) return;\n          $container = $panel;\n        }\n        // \n        const $refreshBtn = $container.find('.mvu-btn-refresh');\n        if ($refreshBtn.length) {\n          $refreshBtn.find('i').addClass('fa-spin');\n        }\n\n        // \n        //  10  1  10 \n        this.getDataWithRetry(10, 1000)\n          .then(mvuData => {\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            // []  toastr  renderPanel \n            //  getDataWithRetry \n            const toastr = window.parent?.toastr || window.toastr;\n            const actualData = this.getData();\n            if (toastr && !actualData) {\n              toastr.warning(' MVU ');\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error refreshing data:', err);\n\n            // \n            if ($refreshBtn.length) {\n              $refreshBtn.find('i').removeClass('fa-spin');\n            }\n\n            //  renderPanel \n            $container.html('<div class=\"acu-mvu-panel\">' + this.renderPanel() + '</div>');\n            this.bindEvents($container);\n\n            // [] \n            const toastr = window.parent?.toastr || window.toastr;\n            const actualData = this.getData();\n            if (toastr && !actualData) {\n              toastr.error('');\n            }\n          });\n      },\n    };\n  })();\n  // MVU \n  // COC\n  const DEFAULT_DICE_CONFIG = {\n    critSuccessMax: 5,\n    hardSuccessDiv: 5,\n    difficultSuccessDiv: 2,\n    critFailMin: 96,\n    ruleType: 'high_good',\n    lastDiceType: '1d100',\n    // DND \n    dndCritSuccess: 20,\n    dndCritFail: 1,\n    // : initiator_lose | tie | initiator_win\n    contestTieRule: 'initiator_lose',\n    // \n    hideDiceResultFromUser: false,\n    // \n    hideDiceResultInChat: false,\n  };\n\n  const getDiceConfig = () => Store.get(STORAGE_KEY_DICE_CONFIG, DEFAULT_DICE_CONFIG);\n  const saveDiceConfig = cfg => {\n    const oldCfg = getDiceConfig();\n    const newCfg = { ...oldCfg, ...cfg };\n    Store.set(STORAGE_KEY_DICE_CONFIG, newCfg);\n    // \n    const changedKeys = Object.keys(cfg).filter(k => oldCfg[k] !== newCfg[k]);\n    if (changedKeys.length > 0) {\n      console.info(`[DICE]: ${changedKeys.join(', ')}`);\n    }\n  };\n\n  // [] \n  const hideDiceResultsInUserMessages = () => {\n    try {\n      const diceCfg = getDiceConfig();\n      const hideInput = diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const hideChat = diceCfg.hideDiceResultInChat !== undefined ? diceCfg.hideDiceResultInChat : false;\n\n      // : \"XX\"\n      const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n      // : \"  vs    (...)  ......  (...)  .........\"\n      const contestDiceRegex =\n        /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n      // ==========  hideInput  ==========\n      try {\n        const $ta = $('#send_textarea');\n        if ($ta.length) {\n          let textareaVal = $ta.val() || '';\n          let modifiedText = textareaVal;\n\n          if (hideInput) {\n            // \n            const contestRegex =\n              /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n            const normalRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n            if (contestRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(contestRegex, '[]');\n            }\n            if (normalRegex.test(modifiedText)) {\n              modifiedText = modifiedText.replace(normalRegex, '[]');\n            }\n          } else {\n            // \n            const originalText = $ta.data('acu-original-dice-text');\n            if (originalText && textareaVal.includes('[]')) {\n              // \n              modifiedText = textareaVal.replace(/\\[\\]/g, originalText);\n              $ta.removeData('acu-original-dice-text');\n            }\n          }\n\n          if (modifiedText !== textareaVal) {\n            $ta.val(modifiedText).trigger('input').trigger('change');\n          }\n        }\n      } catch (e) {\n        console.warn('[DICE]ACU :', e);\n      }\n\n      // ==========  hideChat  ==========\n      // \n      let lastMessageId;\n      try {\n        lastMessageId = getLastMessageId();\n      } catch (e) {\n        //  lastMessageId \n        return;\n      }\n\n      // \n      if (lastMessageId < 0) {\n        return;\n      }\n\n      try {\n        const userMessages = getChatMessages(`0-${lastMessageId}`, { role: 'user' });\n        // \n        if (!userMessages || userMessages.length === 0) {\n          return;\n        }\n\n        if (hideChat) {\n          // \n          let hiddenCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const $msgElement = retrieveDisplayedMessage(msg.message_id);\n              if (!$msgElement || !$msgElement.length) {\n                return;\n              }\n\n              // \n              let $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) {\n                // \n                $mesText = $msgElement.find('.message-text, .text, [class*=\"text\"], [class*=\"message\"]').first();\n                if (!$mesText || !$mesText.length) {\n                  // \n                  $mesText = $msgElement;\n                }\n              }\n\n              // DOM\n              const currentDomText = $mesText.text();\n              // \n              if (currentDomText.includes('[]')) {\n                return;\n              }\n\n              // AI\n              const originalText = msg.message || '';\n              if (!originalText) {\n                return;\n              }\n\n              // \n              let modifiedText = originalText;\n\n              // \n              //  lastIndex \n              const contestRegex =\n                /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n              const contestMatch = contestRegex.test(modifiedText);\n              if (contestMatch) {\n                modifiedText = modifiedText.replace(contestRegex, '[]');\n              }\n\n              // \n              const normalRegex =\n                /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n              const normalMatch = normalRegex.test(modifiedText);\n              if (normalMatch) {\n                modifiedText = modifiedText.replace(normalRegex, '[]');\n              }\n\n              // DOM\n              // HTMLHTML\n              if (modifiedText !== originalText && modifiedText !== currentDomText) {\n                // HTML\n                const currentHtml = $mesText.html();\n                // HTMLHTML\n                let modifiedHtml = currentHtml;\n\n                // \n                const contestPattern =\n                  /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n                if (contestPattern.test(currentHtml)) {\n                  modifiedHtml = modifiedHtml.replace(contestPattern, '[]');\n                }\n\n                // \n                const normalPattern =\n                  /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n                if (normalPattern.test(currentHtml)) {\n                  modifiedHtml = modifiedHtml.replace(normalPattern, '[]');\n                }\n\n                // HTML\n                if (modifiedHtml !== currentHtml) {\n                  $mesText.html(modifiedHtml);\n                  hiddenCount++;\n                }\n              }\n            } catch (e) {\n              console.warn(`[DICE]ACU  ${msg.message_id} :`, e);\n            }\n          });\n          if (hiddenCount > 0) {\n            console.info(`[DICE] ${hiddenCount} `);\n          }\n        } else {\n          // \n          let restoredCount = 0;\n          userMessages.forEach(msg => {\n            try {\n              const $msgElement = retrieveDisplayedMessage(msg.message_id);\n              if (!$msgElement || !$msgElement.length) return;\n\n              const $mesText = $msgElement.find('.mes_text');\n              if (!$mesText || !$mesText.length) return;\n\n              // \n              const currentText = $mesText.text();\n              if (currentText.includes('[]')) {\n                // \n                const originalText = msg.message || '';\n                if (originalText) {\n                  $mesText.text(originalText);\n                  restoredCount++;\n                }\n              }\n            } catch (e) {\n              // \n            }\n          });\n          if (restoredCount > 0) {\n            console.info(`[DICE] ${restoredCount} `);\n          }\n        }\n      } catch (e) {\n        // \n        // \n        if (hideChat) {\n          console.warn('[DICE]ACU :', e);\n        }\n      }\n    } catch (e) {\n      // [] \n      // \n      const diceCfg = getDiceConfig();\n      if (diceCfg && (diceCfg.hideDiceResultFromUser || diceCfg.hideDiceResultInChat)) {\n        console.warn('[DICE]ACU :', e);\n      }\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const BUILTIN_ATTRIBUTE_PRESETS = [\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'coc7',\n      name: 'COC',\n      builtin: true,\n      description: '7816',\n      baseAttributes: [\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n      ],\n      specialAttributes: [\n        //  15-1109560\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        //  9-8547\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        //  8-6536\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        //  3-4122\n        { name: '', formula: '1+2d20', range: [3, 41] },\n        // \n        { name: '', formula: '/2', range: [1, 99] },\n        // COC \n        { name: 'SAN', formula: '', range: [1, 99] },\n        { name: '', formula: '1d5', range: [1, 5] },\n      ],\n    },\n    {\n      format: 'acu_attr_preset_v1',\n      version: PRESET_FORMAT_VERSION,\n      id: 'dnd5e',\n      name: 'DND',\n      builtin: true,\n      description: '568',\n      baseAttributes: [\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n      ],\n      specialAttributes: [\n        //  10-2015\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        //  7-1712\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        //  4-149\n        { name: '', formula: '2+2d6', range: [4, 14] },\n        { name: '', formula: '2+2d6', range: [4, 14] },\n      ],\n    },\n  ];\n\n  // \n  const AttributePresetManager = (() => {\n    let _cache = null;\n\n    return {\n      //  + \n      getAllPresets() {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        // \n        let needsSave = false;\n        stored.forEach(preset => {\n          const presetVersion = preset.version || '0.0.0';\n          if (compareVersion(presetVersion, PRESET_FORMAT_VERSION) < 0) {\n            console.log(\n              `[DICE]AttributePresetManager  \"${preset.name}\"  (${presetVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n            preset.version = PRESET_FORMAT_VERSION;\n            needsSave = true;\n          }\n        });\n        if (needsSave) {\n          Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n          // \n          _cache = null;\n        }\n        // \n        if (!needsSave && _cache) {\n          return _cache;\n        }\n        _cache = [...BUILTIN_ATTRIBUTE_PRESETS, ...stored];\n        return _cache;\n      },\n\n      // null = \n      getActivePreset() {\n        const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        if (!activeId) return null;\n        return this.getAllPresets().find(p => p.id === activeId) || null;\n      },\n\n      // \n      setActivePreset(id) {\n        try {\n          // idnull\n          const finalId = id === '' || id === undefined ? null : id;\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, finalId);\n          // \n          _cache = null;\n          console.log('[DICE]AttributePresetManager :', finalId);\n          return true;\n        } catch (err) {\n          console.error('[DICE]AttributePresetManager :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const newPreset = {\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          builtin: false,\n          version: preset.version || PRESET_FORMAT_VERSION,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates };\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        }\n        console.log('[DICE]AttributePresetManager :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getAllPresets().find(p => p.id === id);\n        if (!preset) return null;\n        const exported = {\n          format: 'acu_attr_preset_v1',\n          version: PRESET_FORMAT_VERSION,\n          ...preset,\n        };\n        delete exported.builtin; // \n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr, autoUpdate = false) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.format !== 'acu_attr_preset_v1') {\n            throw new Error('');\n          }\n\n          // \n          if (!data.name || !data.baseAttributes || !Array.isArray(data.baseAttributes)) {\n            throw new Error('');\n          }\n\n          const importedVersion = data.version || '0.0.0';\n          const needsUpdate = compareVersion(importedVersion, PRESET_FORMAT_VERSION) < 0;\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            builtin: false,\n            version: autoUpdate && needsUpdate ? PRESET_FORMAT_VERSION : importedVersion,\n            createdAt: new Date().toISOString(),\n          };\n\n          const result = this.createPreset(imported);\n          if (result && needsUpdate && !autoUpdate) {\n            console.warn(\n              `[DICE]AttributePresetManager  \"${result.name}\"  (${importedVersion}) ${PRESET_FORMAT_VERSION}`,\n            );\n          }\n          return result;\n        } catch (e) {\n          console.error('[DICE]AttributePresetManager :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const getCrazyModeConfig = () => {\n    const stored = Store.get(STORAGE_KEY_CRAZY_MODE, null);\n    if (!stored) return { ...DEFAULT_CRAZY_MODE_CONFIG };\n    return { ...DEFAULT_CRAZY_MODE_CONFIG, ...stored };\n  };\n\n  // \n  const saveCrazyModeConfig = config => {\n    Store.set(STORAGE_KEY_CRAZY_MODE, config);\n  };\n\n  // \n  const shouldTriggerCrazyMode = () => {\n    const config = getCrazyModeConfig();\n    if (!config.enabled) return false;\n    // crazyLevel \n    const roll = Math.random() * 100;\n    return roll < config.crazyLevel;\n  };\n\n  // \n  const selectCrazyRollType = crazyLevel => {\n    // crazyLevel < 50: 100% \n    // crazyLevel 50-75: 70%  / 30% \n    // crazyLevel > 75: 50%  / 50% \n    if (crazyLevel < 50) return 'normal';\n    const contestChance = crazyLevel <= 75 ? 0.3 : 0.5;\n    return Math.random() < contestChance ? 'contest' : 'normal';\n  };\n\n  // \n  const weightedRandomSelect = items => {\n    if (!items || items.length === 0) return null;\n    const totalWeight = items.reduce((sum, item) => sum + (item.weight || 1), 0);\n    let random = Math.random() * totalWeight;\n    for (const item of items) {\n      random -= item.weight || 1;\n      if (random <= 0) return item;\n    }\n    return items[items.length - 1];\n  };\n\n  // \n  const selectCrazyParticipant = () => {\n    const config = getCrazyModeConfig();\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return null;\n\n    const allTables = processJsonData(rawData || {});\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n\n    // \n    const candidates = [];\n\n    // \n    if (playerResult?.data?.rows?.length > 0) {\n      const playerName = getDisplayPlayerName() || '';\n      const playerAttrs = getFullAttributesForCharacter('<user>');\n      candidates.push({\n        name: playerName,\n        attrs: playerAttrs,\n        isPlayer: true,\n        inScene: true,\n        weight: config.playerWeight,\n      });\n    }\n\n    // NPC\n    if (npcResult) {\n      const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n      npcParsed.forEach(npc => {\n        if (!npc.name) return;\n        const inSceneVal = String(npc.inScene || '').toLowerCase();\n        const isInScene = inSceneVal === 'true' || inSceneVal === '';\n        const npcAttrs = getFullAttributesForCharacter(npc.name);\n        candidates.push({\n          name: npc.name,\n          attrs: npcAttrs,\n          isPlayer: false,\n          inScene: isInScene,\n          weight: isInScene ? config.inSceneNpcWeight : config.offSceneNpcWeight,\n        });\n      });\n    }\n\n    if (candidates.length === 0) return null;\n    return weightedRandomSelect(candidates);\n  };\n\n  // \n  const selectCrazyAttribute = participant => {\n    if (!participant) return { name: '', value: 50 };\n\n    // 1. \n    if (participant.attrs && participant.attrs.length > 0) {\n      const randomAttr = participant.attrs[Math.floor(Math.random() * participant.attrs.length)];\n      return { name: randomAttr.name, value: randomAttr.value };\n    }\n\n    // 2. \n    const activePreset = AttributePresetManager.getActivePreset();\n    if (activePreset) {\n      const allPresetAttrs = [...(activePreset.baseAttributes || []), ...(activePreset.specialAttributes || [])];\n      if (allPresetAttrs.length > 0) {\n        const randomPresetAttr = allPresetAttrs[Math.floor(Math.random() * allPresetAttrs.length)];\n        //  range  50% \n        const range = randomPresetAttr.range || [0, 100];\n        const defaultValue = Math.floor((range[0] + range[1]) / 2);\n        return { name: randomPresetAttr.name, value: defaultValue };\n      }\n    }\n\n    // 3. \n    const skillPool = getRandomSkillPool();\n    if (skillPool && skillPool.length > 0) {\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      return { name: randomSkill, value: 50 };\n    }\n\n    return { name: '', value: 50 };\n  };\n\n  //  d100\n  const crazyRollD100 = () => Math.floor(Math.random() * 100) + 1;\n\n  // \n  const judgeCrazyRollResult = (roll, target) => {\n    if (roll <= 5) return '';\n    if (roll >= 96) return '';\n    if (roll <= target) return '';\n    return '';\n  };\n\n  // \n  const generateCrazyRoll = () => {\n    const config = getCrazyModeConfig();\n    const rollType = selectCrazyRollType(config.crazyLevel);\n\n    if (rollType === 'normal') {\n      // \n      const participant = selectCrazyParticipant();\n      if (!participant) return null;\n\n      const attr = selectCrazyAttribute(participant);\n      const roll = crazyRollD100();\n      const result = judgeCrazyRollResult(roll, attr.value);\n\n      // XXYY\n      return `${participant.name}${attr.name}${roll}${attr.value}${result}`;\n    } else {\n      // \n      const participant1 = selectCrazyParticipant();\n      if (!participant1) return null;\n\n      // \n      let participant2 = null;\n      for (let i = 0; i < 5; i++) {\n        const candidate = selectCrazyParticipant();\n        if (candidate && candidate.name !== participant1.name) {\n          participant2 = candidate;\n          break;\n        }\n      }\n\n      // \n      if (!participant2) {\n        const attr = selectCrazyAttribute(participant1);\n        const roll = crazyRollD100();\n        const result = judgeCrazyRollResult(roll, attr.value);\n        return `${participant1.name}${attr.name}${roll}${attr.value}${result}`;\n      }\n\n      const attr1 = selectCrazyAttribute(participant1);\n      const attr2 = selectCrazyAttribute(participant2);\n      const roll1 = crazyRollD100();\n      const roll2 = crazyRollD100();\n\n      // \n      const result1 = judgeCrazyRollResult(roll1, attr1.value);\n      const result2 = judgeCrazyRollResult(roll2, attr2.value);\n      const margin1 = attr1.value - roll1;\n      const margin2 = attr2.value - roll2;\n\n      let winner;\n      if (margin1 > margin2) {\n        winner = `${participant1.name}`;\n      } else if (margin2 > margin1) {\n        winner = `${participant2.name}`;\n      } else {\n        winner = '';\n      }\n\n      // \n      return (\n        `${participant1.name} ${attr1.name} vs ${participant2.name} ${attr2.name}` +\n        `${participant1.name} ${attr1.name} (${attr1.value})  ${roll1}${result1}` +\n        `${participant2.name} ${attr2.name} (${attr2.value})  ${roll2}${result2}` +\n        `${winner}`\n      );\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  /**\n   * \n   * : 3d6, 4d6kh3, 4d6dl1, 4d6dh1\n   * @returns  NaN\n   */\n  const rollDiceExpression = expr => {\n    const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n\n    const match = expr.match(/^(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?$/i);\n    if (!match) return NaN;\n\n    const [, countStr, sidesStr, keepDrop] = match;\n    const count = parseInt(countStr, 10);\n    const sides = parseInt(sidesStr, 10);\n\n    let rolls = Array.from({ length: count }, () => rollDice(sides));\n\n    //  keep/drop\n    if (keepDrop) {\n      const kd = keepDrop.toLowerCase();\n      const n = parseInt(kd.slice(2), 10);\n      rolls.sort((a, b) => b - a); // \n\n      if (kd.startsWith('kh'))\n        rolls = rolls.slice(0, n); // n\n      else if (kd.startsWith('kl'))\n        rolls = rolls.slice(-n); // n\n      else if (kd.startsWith('dh'))\n        rolls = rolls.slice(n); // n\n      else if (kd.startsWith('dl')) rolls = rolls.slice(0, -n); // n\n    }\n\n    return rolls.reduce((a, b) => a + b, 0);\n  };\n\n  /**\n   * \n   * @param formula  \"/2+1d10\"  \"3d6*5\"\n   * @param context  { : 50, : 40 }\n   * @returns \n   */\n  const evaluateFormula = (formula, context = {}) => {\n    if (!formula) return 0;\n\n    let expr = String(formula).trim();\n\n    // 1. \n    const varNames = Object.keys(context).sort((a, b) => b.length - a.length);\n    for (const name of varNames) {\n      const value = context[name];\n      if (typeof value === 'number' && !isNaN(value)) {\n        // \n        expr = expr.split(name).join(`(${value})`);\n      }\n    }\n\n    // 2. \n    expr = expr.replace(/\\d+d\\d+(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi, match => {\n      const result = rollDiceExpression(match);\n      return isNaN(result) ? '0' : String(result);\n    });\n\n    // 3. \n    if (!/^[\\d\\s+\\-*/().]+$/.test(expr)) {\n      console.warn('[DICE]evaluateFormula :', formula, '', expr);\n      return 0;\n    }\n\n    // 4. \n    try {\n      // eslint-disable-next-line no-new-func\n      const result = new Function(`return (${expr})`)();\n      return Math.round(result); // \n    } catch (e) {\n      console.error('[DICE]evaluateFormula :', formula, '', expr, e);\n      return 0;\n    }\n  };\n\n  /**\n   * \n   * @param formula \n   * @param range  [min, max]\n   * @param context \n   * @returns \n   */\n  const generateAttributeValue = (formula, range, context) => {\n    let value = evaluateFormula(formula, context);\n\n    if (range && Array.isArray(range) && range.length === 2) {\n      value = Math.max(range[0], Math.min(range[1], value));\n    }\n\n    return value;\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const DASHBOARD_TABLE_CONFIG = {\n    global: {\n      tableKeywords: ['', '', ''],\n      columns: {\n        detailLocation: { keywords: ['', '', '', ''], fallbackIndex: null },\n        currentLocation: { keywords: ['', '', '', ''], fallbackIndex: 2 },\n      },\n    },\n    player: {\n      // : user, <user>\n      tableKeywords: ['', '', '', '', 'player', '', 'user', '<user>'],\n      columns: {\n        name: { keywords: ['', '', '', 'name'], fallbackIndex: 1 },\n        status: { keywords: ['', '', '', ''], fallbackIndex: null },\n        position: { keywords: ['', '', ''], fallbackIndex: null },\n        attrs: { keywords: ['', ''], fallbackIndex: null, isMultiple: true },\n        // : , , , \n        money: {\n          keywords: ['', '', '', '', '', '', '', '', ''],\n          fallbackIndex: null,\n        },\n        resources: { keywords: ['', '', 'resources'], fallbackIndex: null },\n      },\n    },\n    location: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: {\n          keywords: ['', '', '', '', '', '', '', ''],\n          fallbackIndex: 1,\n        },\n        description: { keywords: ['', '', '', '', ''], fallbackIndex: null },\n      },\n    },\n    npc: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        'NPC',\n        '',\n        '',\n        '',\n        '',\n        'character',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', ''], fallbackIndex: 1 },\n        status: { keywords: ['', ''], fallbackIndex: null },\n        position: { keywords: ['', '', '', ''], fallbackIndex: null },\n        inScene: { keywords: ['', '', '', ''], fallbackIndex: null },\n      },\n    },\n    quest: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        progress: { keywords: ['', '', '/'], fallbackIndex: 5 },\n        status: { keywords: [''], fallbackIndex: 6 },\n      },\n      filters: {\n        active: { column: 'status', includes: ['', '', ''], excludeColumn: 'type', excludes: [''] },\n      },\n    },\n    bag: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        count: { keywords: ['', '', ''], fallbackIndex: 3 },\n      },\n    },\n    skill: {\n      // : , , , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        level: { keywords: ['', '', '', 'lv'], fallbackIndex: 3 },\n      },\n    },\n    equip: {\n      // : , , , , , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        part: { keywords: ['', '', ''], fallbackIndex: 3 },\n        isEquipped: { keywords: ['', '', '', ''], fallbackIndex: 4 },\n      },\n      filters: {\n        equipped: { column: 'isEquipped', includes: ['', '', 'true', '', 'yes', 'equipped'] },\n      },\n    },\n  };\n\n  // \n  const DashboardDataParser = {\n    // \n    findTable(allTables, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return null;\n      }\n\n      for (const keyword of config.tableKeywords) {\n        for (const tableName in allTables) {\n          if (tableName.includes(keyword)) {\n            console.info(`[DICE]: \"${moduleKey}\"\"${tableName}\" (: \"${keyword}\")`);\n            return {\n              data: allTables[tableName],\n              name: tableName,\n              key: allTables[tableName].key,\n              config: config,\n            };\n          }\n        }\n      }\n      console.info(\n        `[DICE]: \"${moduleKey}\" (: ${config.tableKeywords.join(', ')})`,\n      );\n      return null;\n    },\n\n    // \n    findColumnIndex(headers, columnKey, moduleConfig) {\n      const colConfig = moduleConfig.columns[columnKey];\n      if (!colConfig) return -1;\n\n      // \n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (colConfig.keywords.some(kw => h.includes(kw.toLowerCase()))) {\n          return i;\n        }\n      }\n\n      // \n      return colConfig.fallbackIndex ?? -1;\n    },\n\n    // \n    getValue(row, headers, columnKey, moduleConfig) {\n      const idx = this.findColumnIndex(headers, columnKey, moduleConfig);\n      if (idx < 0 || idx >= row.length) return null;\n      return row[idx];\n    },\n\n    // \n    getColumnMap(headers, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) return {};\n\n      const map = {};\n      for (const colKey in config.columns) {\n        map[colKey] = this.findColumnIndex(headers, colKey, config);\n      }\n      return map;\n    },\n\n    // \n    parseRows(tableResult, moduleKey) {\n      if (!tableResult || !tableResult.data) {\n        console.info(`[DICE]: \"${moduleKey}\"`);\n        return [];\n      }\n\n      const { data, config } = tableResult;\n      const headers = data.headers || [];\n      const rows = data.rows || [];\n      const colMap = this.getColumnMap(headers, moduleKey);\n\n      const parsed = rows.map((row, idx) => {\n        const obj = { _rowIndex: idx, _raw: row };\n        for (const colKey in colMap) {\n          const colIdx = colMap[colKey];\n          obj[colKey] = colIdx >= 0 && colIdx < row.length ? row[colIdx] : null;\n        }\n        return obj;\n      });\n\n      console.info(`[DICE]: \"${moduleKey}\"${parsed.length}`);\n      return parsed;\n    },\n\n    // \n    applyFilter(parsedRows, filterKey, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config || !config.filters || !config.filters[filterKey]) return parsedRows;\n\n      const filter = config.filters[filterKey];\n\n      // parsedRows\n      const hasFilterColumn = parsedRows.some(row => row[filter.column] !== null && row[filter.column] !== undefined);\n      if (!hasFilterColumn) {\n        // \n        return parsedRows;\n      }\n\n      return parsedRows.filter(row => {\n        const value = String(row[filter.column] || '').toLowerCase();\n        const matchInclude = filter.includes.some(inc => value.includes(inc.toLowerCase()));\n\n        if (filter.excludeColumn && filter.excludes) {\n          const excludeValue = String(row[filter.excludeColumn] || '').toLowerCase();\n          const matchExclude = filter.excludes.some(exc => excludeValue.includes(exc.toLowerCase()));\n          return matchInclude && !matchExclude;\n        }\n\n        return matchInclude;\n      });\n    },\n  };\n\n  const DEFAULT_GM_CONFIG = {\n    enabled: true,\n    diceSystem: '1d100',\n    showDiceIcon: true,\n    autoSendPrompt: true,\n    action_groups: [\n      {\n        table_keywords: ['', '', 'Location', 'Map', '', ''],\n        actions: [\n          { label: '', icon: 'fa-walking', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-search', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-clock', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', 'NPC', '', '', ''],\n        actions: [\n          { label: '', icon: 'fa-comments', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-hand-fist', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          { label: '', icon: 'fa-hand-pointer', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-trash', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-shield-halved',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-coins', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-wand-magic-sparkles',\n            type: 'skill_check',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-dumbbell', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-crosshairs',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          {\n            label: '',\n            icon: 'fa-list-check',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-ear-listen',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-user-plus', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          {\n            label: '',\n            icon: 'fa-handshake',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n        ],\n      },\n    ],\n  };\n  // [] \n  const THEME_COLORS = {\n    retro: {\n      bgPanel: '#e6e2d3',\n      border: '#dcd0c0',\n      textMain: '#5e4b35',\n      textSub: '#8a7a6a',\n      btnBg: '#dcd0c0',\n      btnHover: '#cbbba8',\n      accent: '#7a695f',\n      tableHead: '#efebe4',\n      successText: '#27ae60',\n      successBg: 'rgba(39, 174, 96, 0.15)',\n      inputBg: '#f5f2eb',\n      inputText: '#5e4b35',\n      placeholderText: '#a09080',\n      btnActiveBg: '#8d7b6f',\n      btnActiveText: '#fdfaf5',\n      // \n      failureText: '#e74c3c',\n      failureBg: 'rgba(231, 76, 60, 0.15)',\n      warningText: '#f39c12',\n      warningBg: 'rgba(243, 156, 18, 0.15)',\n      critSuccessText: '#9b59b6',\n      critSuccessBg: 'rgba(155, 89, 182, 0.15)',\n      critFailureText: '#c0392b',\n      critFailureBg: 'rgba(192, 57, 43, 0.15)',\n      extremeSuccessText: '#2980b9',\n      extremeSuccessBg: 'rgba(41, 128, 185, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#e74c3c',\n      errorBg: 'rgba(231, 76, 60, 0.15)',\n      errorBorder: 'rgba(231, 76, 60, 0.5)',\n      warningIcon: '#e67e22',\n      buttonTextOnAccent: '#fff',\n    },\n    dark: {\n      bgPanel: 'rgba(30, 30, 30, 0.98)',\n      border: '#444',\n      textMain: '#eee',\n      textSub: '#999',\n      btnBg: 'rgba(60, 60, 60, 0.9)',\n      btnHover: '#505050',\n      accent: '#9b8cd9',\n      tableHead: 'rgba(45, 45, 45, 0.95)',\n      successText: '#4cd964',\n      successBg: 'rgba(76, 217, 100, 0.2)',\n      inputBg: 'rgba(50, 50, 50, 0.95)',\n      inputText: '#eee',\n      placeholderText: '#777',\n      btnActiveBg: '#6a5acd',\n      btnActiveText: '#fff',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#ba68c8',\n      critSuccessBg: 'rgba(186, 104, 200, 0.2)',\n      critFailureText: '#d32f2f',\n      critFailureBg: 'rgba(211, 47, 47, 0.2)',\n      extremeSuccessText: '#42a5f5',\n      extremeSuccessBg: 'rgba(66, 165, 245, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.75)',\n      overlayBgLight: 'rgba(0,0,0,0.65)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255,255,255,0.05)',\n      veryLightBg: 'rgba(255,255,255,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(255,255,255,0.1)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#fff',\n    },\n    modern: {\n      bgPanel: '#f8f9fa',\n      border: '#e0e0e0',\n      textMain: '#333',\n      textSub: '#666',\n      btnBg: '#e9ecef',\n      btnHover: '#dee2e6',\n      accent: '#007bff',\n      tableHead: '#f1f3f5',\n      successText: '#28a745',\n      successBg: 'rgba(40, 167, 69, 0.15)',\n      inputBg: '#fff',\n      inputText: '#333',\n      placeholderText: '#999',\n      btnActiveBg: '#007bff',\n      btnActiveText: '#fff',\n      // \n      failureText: '#dc3545',\n      failureBg: 'rgba(220, 53, 69, 0.15)',\n      warningText: '#ffc107',\n      warningBg: 'rgba(255, 193, 7, 0.15)',\n      critSuccessText: '#6f42c1',\n      critSuccessBg: 'rgba(111, 66, 193, 0.15)',\n      critFailureText: '#c82333',\n      critFailureBg: 'rgba(200, 35, 51, 0.15)',\n      extremeSuccessText: '#17a2b8',\n      extremeSuccessBg: 'rgba(23, 162, 184, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#dc3545',\n      errorBg: 'rgba(220, 53, 69, 0.15)',\n      errorBorder: 'rgba(220, 53, 69, 0.5)',\n      warningIcon: '#fd7e14',\n      buttonTextOnAccent: '#fff',\n    },\n    forest: {\n      bgPanel: '#e8f5e9',\n      border: '#a5d6a7',\n      textMain: '#2e7d32',\n      textSub: '#66bb6a',\n      btnBg: '#c8e6c9',\n      btnHover: '#a5d6a7',\n      accent: '#43a047',\n      tableHead: '#dcedc8',\n      successText: '#2e7d32',\n      successBg: 'rgba(46, 125, 50, 0.2)',\n      inputBg: '#f1f8e9',\n      inputText: '#2e7d32',\n      placeholderText: '#81c784',\n      btnActiveBg: '#43a047',\n      btnActiveText: '#fff',\n      // \n      failureText: '#c62828',\n      failureBg: 'rgba(198, 40, 40, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#0277bd',\n      extremeSuccessBg: 'rgba(2, 119, 189, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#c62828',\n      errorBg: 'rgba(198, 40, 40, 0.15)',\n      errorBorder: 'rgba(198, 40, 40, 0.5)',\n      warningIcon: '#e67e22',\n      buttonTextOnAccent: '#fff',\n    },\n    ocean: {\n      bgPanel: '#e3f2fd',\n      border: '#90caf9',\n      textMain: '#1565c0',\n      textSub: '#42a5f5',\n      btnBg: '#bbdefb',\n      btnHover: '#90caf9',\n      accent: '#1976d2',\n      tableHead: '#bbdefb',\n      successText: '#0288d1',\n      successBg: 'rgba(2, 136, 209, 0.15)',\n      inputBg: '#e1f5fe',\n      inputText: '#1565c0',\n      placeholderText: '#64b5f6',\n      btnActiveBg: '#1976d2',\n      btnActiveText: '#fff',\n      // \n      failureText: '#d32f2f',\n      failureBg: 'rgba(211, 47, 47, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#0277bd',\n      extremeSuccessBg: 'rgba(2, 119, 189, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(0,0,0,0.1)',\n      veryLightBg: 'rgba(0,0,0,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(128,128,128,0.1)',\n      // /\n      errorText: '#d32f2f',\n      errorBg: 'rgba(211, 47, 47, 0.15)',\n      errorBorder: 'rgba(211, 47, 47, 0.5)',\n      warningIcon: '#f57c00',\n      buttonTextOnAccent: '#fff',\n    },\n    cyber: {\n      bgPanel: '#0a0a0a',\n      border: '#00ffcc33',\n      textMain: '#00ffcc',\n      textSub: '#00cc99',\n      btnBg: 'rgba(0, 255, 204, 0.1)',\n      btnHover: 'rgba(0, 255, 204, 0.2)',\n      accent: '#00ffcc',\n      tableHead: 'rgba(0, 255, 204, 0.05)',\n      successText: '#0f0',\n      successBg: 'rgba(0, 255, 0, 0.15)',\n      inputBg: 'rgba(0, 0, 0, 0.6)',\n      inputText: '#00ffcc',\n      placeholderText: '#006655',\n      btnActiveBg: '#ff00ff',\n      btnActiveText: '#fff',\n      // \n      failureText: '#ff0066',\n      failureBg: 'rgba(255, 0, 102, 0.2)',\n      warningText: '#ffaa00',\n      warningBg: 'rgba(255, 170, 0, 0.2)',\n      critSuccessText: '#ff00ff',\n      critSuccessBg: 'rgba(255, 0, 255, 0.2)',\n      critFailureText: '#ff0000',\n      critFailureBg: 'rgba(255, 0, 0, 0.2)',\n      extremeSuccessText: '#00ffff',\n      extremeSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,255,204,0.3)',\n      lightBg: 'rgba(0,255,204,0.05)',\n      veryLightBg: 'rgba(0,255,204,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(0,255,204,0.1)',\n      // \n      buttonBg: 'rgba(0, 200, 150, 0.6)',\n      buttonBgActive: 'rgba(0, 180, 130, 0.7)',\n      presetButtonBg: 'rgba(0, 200, 150, 0.3)',\n      presetButtonBgActive: 'rgba(0, 200, 150, 0.6)',\n      // /\n      errorText: '#ff0066',\n      errorBg: 'rgba(255, 0, 102, 0.2)',\n      errorBorder: 'rgba(255, 0, 102, 0.5)',\n      warningIcon: '#ffaa00',\n      buttonTextOnAccent: '#000',\n    },\n    nightowl: {\n      bgPanel: '#011627',\n      border: '#132e45',\n      textMain: '#e0e6f2',\n      textSub: '#a6b8cc',\n      btnBg: '#1f3a52',\n      btnHover: '#2a4a68',\n      accent: '#7fdbca',\n      tableHead: '#0a2133',\n      successText: '#addb67',\n      successBg: 'rgba(173, 219, 103, 0.15)',\n      inputBg: '#00101c',\n      inputText: '#e0e6f2',\n      placeholderText: '#6a8090',\n      btnActiveBg: '#7fdbca',\n      btnActiveText: '#011627',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#c792ea',\n      critSuccessBg: 'rgba(199, 146, 234, 0.2)',\n      critFailureText: '#ef5350',\n      critFailureBg: 'rgba(239, 83, 80, 0.2)',\n      extremeSuccessText: '#82aaff',\n      extremeSuccessBg: 'rgba(130, 170, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.75)',\n      overlayBgLight: 'rgba(0,0,0,0.65)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255,255,255,0.05)',\n      veryLightBg: 'rgba(255,255,255,0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(255,255,255,0.1)',\n      // \n      buttonBg: 'rgba(127, 219, 202, 0.4)',\n      buttonBgActive: 'rgba(127, 219, 202, 0.5)',\n      presetButtonBg: 'rgba(127, 219, 202, 0.2)',\n      presetButtonBgActive: 'rgba(127, 219, 202, 0.4)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#000',\n    },\n    sakura: {\n      bgPanel: '#F9F0EF',\n      border: '#EBDCD9',\n      textMain: '#6B5552',\n      textSub: '#C08D8D',\n      btnBg: '#EBDCD9',\n      btnHover: '#D8C7C4',\n      accent: '#C08D8D',\n      tableHead: '#F9F0EF',\n      successText: '#6B5552',\n      successBg: 'rgba(192, 141, 141, 0.12)',\n      inputBg: '#F9F0EF',\n      inputText: '#6B5552',\n      placeholderText: '#C08D8D',\n      btnActiveBg: '#C08D8D',\n      btnActiveText: '#F9F0EF',\n      // \n      failureText: '#9B7A7A',\n      failureBg: 'rgba(155, 122, 122, 0.12)',\n      warningText: '#A68A7A',\n      warningBg: 'rgba(166, 138, 122, 0.12)',\n      critSuccessText: '#8B7A7A',\n      critSuccessBg: 'rgba(139, 122, 122, 0.12)',\n      critFailureText: '#8B6F6F',\n      critFailureBg: 'rgba(139, 111, 111, 0.12)',\n      extremeSuccessText: '#9B8A8A',\n      extremeSuccessBg: 'rgba(155, 138, 138, 0.12)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(107, 85, 82, 0.3)',\n      lightBg: 'rgba(192, 141, 141, 0.08)',\n      veryLightBg: 'rgba(192, 141, 141, 0.02)',\n      buttonText: '#F9F0EF',\n      grayBg: 'rgba(192, 141, 141, 0.08)',\n      // \n      buttonBg: 'rgba(192, 141, 141, 0.4)',\n      buttonBgActive: 'rgba(192, 141, 141, 0.5)',\n      presetButtonBg: 'rgba(192, 141, 141, 0.2)',\n      presetButtonBgActive: 'rgba(192, 141, 141, 0.4)',\n      // /\n      errorText: '#9B7A7A',\n      errorBg: 'rgba(155, 122, 122, 0.12)',\n      errorBorder: 'rgba(155, 122, 122, 0.4)',\n      warningIcon: '#A68A7A',\n      buttonTextOnAccent: '#fff',\n    },\n    minepink: {\n      bgPanel: '#1a1a1a',\n      border: '#333333',\n      textMain: '#ffb3d9',\n      textSub: '#ff80c1',\n      btnBg: '#2a2a2a',\n      btnHover: '#3a3a3a',\n      accent: '#ff80c1',\n      tableHead: '#252525',\n      successText: '#ff80c1',\n      successBg: 'rgba(255, 128, 193, 0.2)',\n      inputBg: '#222222',\n      inputText: '#ffb3d9',\n      placeholderText: '#666666',\n      btnActiveBg: '#ff80c1',\n      btnActiveText: '#1a1a1a',\n      // \n      failureText: '#ff6b6b',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#ffa726',\n      warningBg: 'rgba(255, 167, 38, 0.2)',\n      critSuccessText: '#ff80c1',\n      critSuccessBg: 'rgba(255, 128, 193, 0.2)',\n      critFailureText: '#ff4444',\n      critFailureBg: 'rgba(255, 68, 68, 0.2)',\n      extremeSuccessText: '#ffb3d9',\n      extremeSuccessBg: 'rgba(255, 179, 217, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255, 128, 193, 0.1)',\n      veryLightBg: 'rgba(255, 128, 193, 0.02)',\n      buttonText: '#1a1a1a',\n      grayBg: 'rgba(255, 128, 193, 0.1)',\n      // \n      buttonBg: 'rgba(255, 128, 193, 0.7)',\n      buttonBgActive: 'rgba(255, 128, 193, 0.8)',\n      presetButtonBg: 'rgba(255, 128, 193, 0.2)',\n      presetButtonBgActive: 'rgba(255, 128, 193, 0.4)',\n      // /\n      errorText: '#ff6b6b',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#ffa726',\n      buttonTextOnAccent: '#000',\n    },\n    purple: {\n      bgPanel: '#f3e5f5',\n      border: '#ce93d8',\n      textMain: '#6a1b9a',\n      textSub: '#9c27b0',\n      btnBg: '#e1bee7',\n      btnHover: '#ce93d8',\n      accent: '#9c27b0',\n      tableHead: '#f8e1f5',\n      successText: '#6a1b9a',\n      successBg: 'rgba(106, 27, 154, 0.15)',\n      inputBg: '#fce4ec',\n      inputText: '#6a1b9a',\n      placeholderText: '#ba68c8',\n      btnActiveBg: '#9c27b0',\n      btnActiveText: '#fff',\n      // \n      failureText: '#d32f2f',\n      failureBg: 'rgba(211, 47, 47, 0.15)',\n      warningText: '#f57c00',\n      warningBg: 'rgba(245, 124, 0, 0.15)',\n      critSuccessText: '#7b1fa2',\n      critSuccessBg: 'rgba(123, 31, 162, 0.15)',\n      critFailureText: '#b71c1c',\n      critFailureBg: 'rgba(183, 28, 28, 0.15)',\n      extremeSuccessText: '#6a1b9a',\n      extremeSuccessBg: 'rgba(106, 27, 154, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.4)',\n      lightBg: 'rgba(156, 39, 176, 0.1)',\n      veryLightBg: 'rgba(156, 39, 176, 0.02)',\n      buttonText: '#fff',\n      grayBg: 'rgba(156, 39, 176, 0.1)',\n      // \n      buttonBg: 'rgba(156, 39, 176, 0.6)',\n      buttonBgActive: 'rgba(156, 39, 176, 0.7)',\n      presetButtonBg: 'rgba(156, 39, 176, 0.3)',\n      presetButtonBgActive: 'rgba(156, 39, 176, 0.6)',\n      // /\n      errorText: '#d32f2f',\n      errorBg: 'rgba(211, 47, 47, 0.15)',\n      errorBorder: 'rgba(211, 47, 47, 0.5)',\n      warningIcon: '#f57c00',\n      buttonTextOnAccent: '#fff',\n    },\n    wechat: {\n      bgPanel: '#F7F7F7',\n      border: '#E5E5E5',\n      textMain: '#333333',\n      textSub: '#666666',\n      btnBg: '#E5E5E5',\n      btnHover: '#D5D5D5',\n      accent: '#09B83E',\n      tableHead: '#F0F0F0',\n      successText: '#09B83E',\n      successBg: 'rgba(9, 184, 62, 0.12)',\n      inputBg: '#FFFFFF',\n      inputText: '#333333',\n      placeholderText: '#999999',\n      btnActiveBg: '#09B83E',\n      btnActiveText: '#FFFFFF',\n      // \n      failureText: '#E53E3E',\n      failureBg: 'rgba(229, 62, 62, 0.12)',\n      warningText: '#FF9500',\n      warningBg: 'rgba(255, 149, 0, 0.12)',\n      critSuccessText: '#07A832',\n      critSuccessBg: 'rgba(7, 168, 50, 0.15)',\n      critFailureText: '#C53030',\n      critFailureBg: 'rgba(197, 48, 48, 0.15)',\n      extremeSuccessText: '#09B83E',\n      extremeSuccessBg: 'rgba(9, 184, 62, 0.15)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(0,0,0,0.2)',\n      lightBg: 'rgba(9, 184, 62, 0.08)',\n      veryLightBg: 'rgba(9, 184, 62, 0.02)',\n      buttonText: '#FFFFFF',\n      grayBg: 'rgba(9, 184, 62, 0.08)',\n      // \n      buttonBg: 'rgba(9, 184, 62, 0.7)',\n      buttonBgActive: 'rgba(9, 184, 62, 0.85)',\n      presetButtonBg: 'rgba(9, 184, 62, 0.3)',\n      presetButtonBgActive: 'rgba(9, 184, 62, 0.6)',\n      // /\n      errorText: '#E53E3E',\n      errorBg: 'rgba(229, 62, 62, 0.12)',\n      errorBorder: 'rgba(229, 62, 62, 0.5)',\n      warningIcon: '#FF9500',\n      buttonTextOnAccent: '#fff',\n    },\n    educational: {\n      bgPanel: '#000000',\n      border: '#1B1B1B',\n      textMain: '#FFFFFF',\n      textSub: '#CCCCCC',\n      btnBg: '#1B1B1B',\n      btnHover: '#2B2B2B',\n      accent: '#FF9900',\n      tableHead: '#1B1B1B',\n      successText: '#FF9900',\n      successBg: 'rgba(255, 153, 0, 0.15)',\n      inputBg: '#1B1B1B',\n      inputText: '#FFFFFF',\n      placeholderText: '#666666',\n      btnActiveBg: '#FF9900',\n      btnActiveText: '#000000',\n      // \n      failureText: '#FF6B6B',\n      failureBg: 'rgba(255, 107, 107, 0.2)',\n      warningText: '#FFAA00',\n      warningBg: 'rgba(255, 170, 0, 0.2)',\n      critSuccessText: '#FF9900',\n      critSuccessBg: 'rgba(255, 153, 0, 0.2)',\n      critFailureText: '#FF4444',\n      critFailureBg: 'rgba(255, 68, 68, 0.2)',\n      extremeSuccessText: '#FFB84D',\n      extremeSuccessBg: 'rgba(255, 184, 77, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.8)',\n      overlayBgLight: 'rgba(0,0,0,0.7)',\n      shadowBg: 'rgba(0,0,0,0.6)',\n      lightBg: 'rgba(255, 153, 0, 0.1)',\n      veryLightBg: 'rgba(255, 153, 0, 0.02)',\n      buttonText: '#FFFFFF',\n      grayBg: 'rgba(255, 255, 255, 0.1)',\n      // \n      buttonBg: 'rgba(255, 153, 0, 0.7)',\n      buttonBgActive: 'rgba(255, 153, 0, 0.85)',\n      presetButtonBg: 'rgba(255, 153, 0, 0.3)',\n      presetButtonBgActive: 'rgba(255, 153, 0, 0.6)',\n      // /\n      errorText: '#FF6B6B',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#FFAA00',\n      buttonTextOnAccent: '#000000',\n    },\n    galgame: {\n      bgPanel: '#FFF0F5',\n      border: '#F0D4E4',\n      textMain: '#6B4A5A',\n      textSub: '#B08A9A',\n      btnBg: '#FFE4E9',\n      btnHover: '#FFD4E4',\n      accent: '#E8B4D9',\n      tableHead: '#FFF5F9',\n      successText: '#D4A5C8',\n      successBg: 'rgba(212, 165, 200, 0.15)',\n      inputBg: '#FFF8FA',\n      inputText: '#6B4A5A',\n      placeholderText: '#C8A5B0',\n      btnActiveBg: '#E8B4D9',\n      btnActiveText: '#6B4A5A',\n      // \n      failureText: '#C88A9A',\n      failureBg: 'rgba(200, 138, 154, 0.15)',\n      warningText: '#D4A5A5',\n      warningBg: 'rgba(212, 165, 165, 0.15)',\n      critSuccessText: '#E8B4D9',\n      critSuccessBg: 'rgba(232, 180, 217, 0.2)',\n      critFailureText: '#C88A9A',\n      critFailureBg: 'rgba(200, 138, 154, 0.2)',\n      extremeSuccessText: '#D4A5C8',\n      extremeSuccessBg: 'rgba(212, 165, 200, 0.2)',\n      // UI\n      overlayBg: 'rgba(0,0,0,0.6)',\n      overlayBgLight: 'rgba(0,0,0,0.5)',\n      shadowBg: 'rgba(232, 180, 217, 0.25)',\n      lightBg: 'rgba(232, 180, 217, 0.08)',\n      veryLightBg: 'rgba(232, 180, 217, 0.02)',\n      buttonText: '#6B4A5A',\n      grayBg: 'rgba(232, 180, 217, 0.1)',\n      // \n      buttonBg: 'rgba(232, 180, 217, 0.6)',\n      buttonBgActive: 'rgba(232, 180, 217, 0.75)',\n      presetButtonBg: 'rgba(232, 180, 217, 0.3)',\n      presetButtonBgActive: 'rgba(232, 180, 217, 0.6)',\n      // /\n      errorText: '#C88A9A',\n      errorBg: 'rgba(200, 138, 154, 0.15)',\n      errorBorder: 'rgba(200, 138, 154, 0.4)',\n      warningIcon: '#D4A5A5',\n      buttonTextOnAccent: '#6B4A5A',\n    },\n    vaporwave: {\n      bgPanel: '#191970',\n      border: 'rgba(0, 255, 255, 0.3)',\n      textMain: '#00FFFF',\n      textSub: '#FF00FF',\n      btnBg: 'rgba(25, 25, 112, 0.8)',\n      btnHover: 'rgba(0, 255, 255, 0.2)',\n      accent: '#00FFFF',\n      tableHead: 'rgba(25, 25, 112, 0.9)',\n      successText: '#00FFFF',\n      successBg: 'rgba(0, 255, 255, 0.15)',\n      inputBg: 'rgba(25, 25, 112, 0.6)',\n      inputText: '#00FFFF',\n      placeholderText: '#FF00FF',\n      btnActiveBg: '#FF00FF',\n      btnActiveText: '#F0F8FF',\n      // \n      failureText: '#FF00FF',\n      failureBg: 'rgba(255, 0, 255, 0.2)',\n      warningText: '#FF00FF',\n      warningBg: 'rgba(255, 0, 255, 0.15)',\n      critSuccessText: '#00FFFF',\n      critSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      critFailureText: '#FF00FF',\n      critFailureBg: 'rgba(255, 0, 255, 0.25)',\n      extremeSuccessText: '#00FFFF',\n      extremeSuccessBg: 'rgba(0, 255, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(25, 25, 112, 0.85)',\n      overlayBgLight: 'rgba(25, 25, 112, 0.75)',\n      shadowBg: 'rgba(0, 255, 255, 0.3)',\n      lightBg: 'rgba(0, 255, 255, 0.05)',\n      veryLightBg: 'rgba(0, 255, 255, 0.02)',\n      buttonText: '#F0F8FF',\n      grayBg: 'rgba(0, 255, 255, 0.1)',\n      // \n      buttonBg: 'rgba(0, 255, 255, 0.6)',\n      buttonBgActive: 'rgba(255, 0, 255, 0.7)',\n      presetButtonBg: 'rgba(0, 255, 255, 0.3)',\n      presetButtonBgActive: 'rgba(0, 255, 255, 0.6)',\n      // /\n      errorText: '#FF00FF',\n      errorBg: 'rgba(255, 0, 255, 0.2)',\n      errorBorder: 'rgba(255, 0, 255, 0.5)',\n      warningIcon: '#FF00FF',\n      buttonTextOnAccent: '#191970',\n    },\n    classicpackaging: {\n      bgPanel: '#000000',\n      border: '#FFFF00',\n      textMain: '#FFFF00',\n      textSub: '#CCCC00',\n      btnBg: '#FF0000',\n      btnHover: '#CC0000',\n      accent: '#FF0000',\n      tableHead: '#1a1a1a',\n      successText: '#0000FF',\n      successBg: 'rgba(0, 0, 255, 0.2)',\n      inputBg: '#1a1a1a',\n      inputText: '#FFFF00',\n      placeholderText: '#666600',\n      btnActiveBg: '#0000FF',\n      btnActiveText: '#FFFF00',\n      // \n      failureText: '#FF0000',\n      failureBg: 'rgba(255, 0, 0, 0.2)',\n      warningText: '#FF0000',\n      warningBg: 'rgba(255, 0, 0, 0.15)',\n      critSuccessText: '#0000FF',\n      critSuccessBg: 'rgba(0, 0, 255, 0.2)',\n      critFailureText: '#FF0000',\n      critFailureBg: 'rgba(255, 0, 0, 0.25)',\n      extremeSuccessText: '#0000FF',\n      extremeSuccessBg: 'rgba(0, 0, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(0, 0, 0, 0.9)',\n      overlayBgLight: 'rgba(0, 0, 0, 0.8)',\n      shadowBg: 'rgba(0, 0, 0, 0.6)',\n      lightBg: 'rgba(255, 255, 0, 0.1)',\n      veryLightBg: 'rgba(255, 255, 0, 0.02)',\n      buttonText: '#FFFF00',\n      grayBg: 'rgba(255, 255, 0, 0.1)',\n      // \n      buttonBg: '#FF0000',\n      buttonBgActive: '#CC0000',\n      presetButtonBg: 'rgba(255, 0, 0, 0.7)',\n      presetButtonBgActive: '#FF0000',\n      // /\n      errorText: '#FF0000',\n      errorBg: 'rgba(255, 0, 0, 0.2)',\n      errorBorder: 'rgba(255, 0, 0, 0.8)',\n      warningIcon: '#FF0000',\n      buttonTextOnAccent: '#FFFF00',\n    },\n    terminal: {\n      bgPanel: '#0c0c0c',\n      border: '#00ff00',\n      textMain: '#00ff00',\n      textSub: '#00cc00',\n      btnBg: '#1a1a1a',\n      btnHover: '#2a2a2a',\n      accent: '#00ff00',\n      tableHead: '#0a0a0a',\n      successText: '#00ff00',\n      successBg: 'rgba(0, 255, 0, 0.15)',\n      inputBg: '#0c0c0c',\n      inputText: '#00ff00',\n      placeholderText: '#008800',\n      btnActiveBg: '#00ff00',\n      btnActiveText: '#0c0c0c',\n      failureText: '#ff0000',\n      failureBg: 'rgba(255, 0, 0, 0.15)',\n      warningText: '#ffff00',\n      warningBg: 'rgba(255, 255, 0, 0.15)',\n      critSuccessText: '#00ffff',\n      critSuccessBg: 'rgba(0, 255, 255, 0.15)',\n      critFailureText: '#ff00ff',\n      critFailureBg: 'rgba(255, 0, 255, 0.15)',\n      extremeSuccessText: '#00ff00',\n      extremeSuccessBg: 'rgba(0, 255, 0, 0.2)',\n      overlayBg: 'rgba(0, 0, 0, 0.9)',\n      overlayBgLight: 'rgba(0, 0, 0, 0.8)',\n      shadowBg: 'rgba(0, 0, 0, 0.7)',\n      lightBg: 'rgba(0, 255, 0, 0.05)',\n      veryLightBg: 'rgba(0, 255, 0, 0.02)',\n      buttonText: '#0c0c0c',\n      grayBg: 'rgba(0, 255, 0, 0.05)',\n      errorText: '#ff0000',\n      errorBg: 'rgba(255, 0, 0, 0.15)',\n      errorBorder: 'rgba(255, 0, 0, 0.5)',\n      warningIcon: '#ffff00',\n      buttonTextOnAccent: '#0c0c0c',\n    },\n    dreamcore: {\n      // 90VHS\n      bgPanel: '#F4F1EA',\n      border: '#D6D2C4',\n      textMain: '#5C5869',\n      textSub: '#9490A0',\n      btnBg: '#E6E1D5',\n      btnHover: '#DBD8CC',\n      accent: '#8A9AC6',\n      tableHead: '#EBE7DE',\n      successText: '#4A7A68',\n      successBg: 'rgba(74, 122, 104, 0.18)',\n      inputBg: '#FFFFFF',\n      inputText: '#4A4652',\n      placeholderText: '#B0ACC0',\n      btnActiveBg: '#8A9AC6',\n      btnActiveText: '#FFFFFF',\n      // \n      failureText: '#8F5E5E',\n      failureBg: 'rgba(143, 94, 94, 0.18)',\n      warningText: '#8A7040',\n      warningBg: 'rgba(138, 112, 64, 0.18)',\n      critSuccessText: '#2D6E58',\n      critSuccessBg: 'rgba(45, 110, 88, 0.25)',\n      critFailureText: '#7A3E3E',\n      critFailureBg: 'rgba(122, 62, 62, 0.25)',\n      extremeSuccessText: '#5C5228',\n      extremeSuccessBg: 'rgba(92, 82, 40, 0.2)',\n      // UI\n      overlayBg: 'rgba(244, 241, 234, 0.85)',\n      overlayBgLight: 'rgba(255, 255, 255, 0.4)',\n      shadowBg: 'rgba(92, 88, 105, 0.15)',\n      lightBg: 'rgba(138, 154, 198, 0.08)',\n      veryLightBg: 'rgba(138, 154, 198, 0.03)',\n      buttonText: '#5C5869',\n      grayBg: 'rgba(92, 88, 105, 0.08)',\n      // \n      buttonBg: 'rgba(138, 154, 198, 0.4)',\n      buttonBgActive: 'rgba(138, 154, 198, 0.6)',\n      presetButtonBg: 'rgba(138, 154, 198, 0.2)',\n      presetButtonBgActive: 'rgba(138, 154, 198, 0.45)',\n      // /\n      errorText: '#B85C5C',\n      errorBg: 'rgba(184, 92, 92, 0.15)',\n      errorBorder: 'rgba(184, 92, 92, 0.4)',\n      warningIcon: '#E0C080',\n      buttonTextOnAccent: '#FFFFFF',\n    },\n    //  (Chouten) - \n    // VTuber +  + \n    chouten: {\n      bgPanel: '#1A0A2E', // \n      border: '#FF6B9D', // \n      textMain: '#FFE4F0', // \n      textSub: '#B388FF', // \n      btnBg: 'rgba(255, 107, 157, 0.25)', // \n      btnHover: 'rgba(255, 107, 157, 0.4)', // \n      accent: '#7FFFD4', // \n      tableHead: 'rgba(45, 27, 78, 0.95)', // \n      successText: '#7FFFD4', // \n      successBg: 'rgba(127, 255, 212, 0.2)',\n      inputBg: 'rgba(26, 10, 46, 0.9)', // \n      inputText: '#FFE4F0',\n      placeholderText: '#9370DB', // \n      btnActiveBg: '#FF6B9D', // \n      btnActiveText: '#1A0A2E', // \n      // \n      failureText: '#FF6B6B', // \n      failureBg: 'rgba(255, 107, 107, 0.25)',\n      warningText: '#FFD93D', // \n      warningBg: 'rgba(255, 217, 61, 0.2)',\n      critSuccessText: '#00FFAB', // \n      critSuccessBg: 'rgba(0, 255, 171, 0.25)',\n      critFailureText: '#FF4757', // \n      critFailureBg: 'rgba(255, 71, 87, 0.25)',\n      extremeSuccessText: '#00D9FF', // \n      extremeSuccessBg: 'rgba(0, 217, 255, 0.2)',\n      // UI\n      overlayBg: 'rgba(26, 10, 46, 0.92)',\n      overlayBgLight: 'rgba(45, 27, 78, 0.85)',\n      shadowBg: 'rgba(255, 107, 157, 0.3)', // \n      lightBg: 'rgba(255, 107, 157, 0.08)',\n      veryLightBg: 'rgba(179, 136, 255, 0.05)',\n      buttonText: '#1A0A2E',\n      grayBg: 'rgba(179, 136, 255, 0.15)',\n      // \n      buttonBg: 'rgba(255, 107, 157, 0.6)',\n      buttonBgActive: 'rgba(255, 107, 157, 0.8)',\n      presetButtonBg: 'rgba(127, 255, 212, 0.2)',\n      presetButtonBgActive: 'rgba(127, 255, 212, 0.45)',\n      // /\n      errorText: '#FF6B6B',\n      errorBg: 'rgba(255, 107, 107, 0.2)',\n      errorBorder: 'rgba(255, 107, 107, 0.5)',\n      warningIcon: '#FFD93D',\n      buttonTextOnAccent: '#1A0A2E',\n    },\n  };\n  const getThemeColors = () => {\n    const theme = THEME_COLORS[getConfig().theme] || THEME_COLORS['retro'];\n    // \n    if (!theme.buttonBg) {\n      theme.buttonBg = theme.accent;\n      theme.buttonBgActive = theme.accent;\n      theme.presetButtonBg = theme.btnBg;\n      theme.presetButtonBgActive = theme.accent;\n    }\n    // \n    if (!theme.buttonTextOnAccent) {\n      // \n      // \n      const isLightTheme =\n        theme.bgPanel &&\n        (theme.bgPanel.startsWith('#F') ||\n          theme.bgPanel.startsWith('#f') ||\n          theme.bgPanel.startsWith('#e') ||\n          theme.bgPanel.startsWith('#E') ||\n          theme.bgPanel.includes('255') ||\n          theme.bgPanel.includes('fff'));\n      theme.buttonTextOnAccent = isLightTheme ? theme.textMain || '#333' : '#fff';\n    }\n    return theme;\n  };\n  const getGMConfig = () => Store.get(STORAGE_KEY_GM_CONFIG, DEFAULT_GM_CONFIG);\n\n  // \n  const getResultBadgeStyle = (resultType, t) => {\n    // resultType: 'critSuccess' | 'extremeSuccess' | 'success' | 'warning' | 'failure' | 'critFailure'\n    const styles = {\n      critSuccess: {\n        bg: t.critSuccessText,\n        text: '#fff',\n      },\n      extremeSuccess: {\n        bg: t.extremeSuccessText,\n        text: '#fff',\n      },\n      success: {\n        bg: t.successText,\n        text: '#fff',\n      },\n      warning: {\n        bg: t.warningText,\n        text: '#fff',\n      },\n      failure: {\n        bg: t.failureText,\n        text: '#fff',\n      },\n      critFailure: {\n        bg: t.critFailureText,\n        text: '#fff',\n      },\n    };\n    const style = styles[resultType] || styles.failure;\n    return {\n      'background-color': style.bg,\n      color: style.text,\n      padding: '3px 8px',\n      'border-radius': '6px',\n      'font-size': '11px',\n      'font-weight': 'bold',\n      'white-space': 'nowrap',\n      display: 'inline-flex',\n      'align-items': 'center',\n    };\n  };\n\n  const getActionsForTable = tableName => {\n    const config = getGMConfig();\n    if (!config.enabled || !config.action_groups) return [];\n    const lowerName = tableName.toLowerCase();\n    for (const group of config.action_groups) {\n      const matched = group.table_keywords.some(keyword => lowerName.includes(keyword.toLowerCase()));\n      if (matched) return group.actions || [];\n    }\n    return [];\n  };\n  const isNumericCell = value => {\n    if (value === null || value === undefined || value === '') return false;\n    const str = String(value).trim();\n    // : (50/100)/: \n    return (\n      /^-?\\d+(\\.\\d+)?%?$/.test(str) ||\n      /^\\d+\\/\\d+$/.test(str) ||\n      /^[\\u4e00-\\u9fa5a-zA-Z]+[:\\s]\\s*\\d+/i.test(str) ||\n      /\\d+/.test(str)\n    );\n  };\n\n  const extractNumericValue = value => {\n    if (!value) return 0;\n    const str = String(value).trim();\n    //  (50/100 -> )\n    if (/^\\d+\\/\\d+$/.test(str)) return parseInt(str.split('/')[0], 10);\n    // \n    if (str.endsWith('%')) return parseInt(str.replace('%', ''), 10);\n    //  \":\" \n    const matches = str.match(/\\d+/g);\n    if (matches && matches.length > 0) {\n      return parseInt(matches[matches.length - 1], 10);\n    }\n    return 0;\n  };\n\n  const parseAttributeString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    //  JSON  {\"\":, ...}\n    if (rawStr.startsWith('{') && rawStr.endsWith('}')) {\n      try {\n        const jsonObj = JSON.parse(rawStr);\n        for (const key in jsonObj) {\n          const val = jsonObj[key];\n          if (typeof val === 'number') {\n            results.push({ name: key, value: val });\n          } else if (typeof val === 'string' && /^\\d+$/.test(val)) {\n            results.push({ name: key, value: parseInt(val, 10) });\n          }\n        }\n        if (results.length > 0) return results;\n      } catch (e) {\n        // JSON \n      }\n    }\n\n    //  \":; :\" \n    const parts = rawStr.split(/[,;\\s]+/);\n    for (const part of parts) {\n      const match = part.match(/^\"?([\\u4e00-\\u9fa5a-zA-Z_]+)\"?[:\\s]\\s*\"?(-?\\d+)\"?/);\n      if (match) {\n        results.push({ name: match[1], value: parseInt(match[2], 10) });\n      }\n    }\n    return results;\n  };\n  // [] :\n  // 1: \"();()\"\n  // 2: \":;:\"\n  // 3: \":,;:\"\n  const parseRelationshipString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    // \n    const parts = rawStr.split(/[;]/);\n    for (const part of parts) {\n      const trimmed = part.trim();\n      if (!trimmed) continue;\n\n      // 2/3: \":\"  \"\"\n      const colonMatch = trimmed.match(/^?(.+?)[:\\](.+)$/);\n      if (colonMatch) {\n        const name = colonMatch[1].trim();\n        const relation = colonMatch[2].trim();\n        if (name && relation) {\n          results.push({ name: name, relation: relation });\n          continue;\n        }\n      }\n\n      // 1: \"()\"  \"\"\n      const parenMatch = trimmed.match(/^([^(]+)[(]([^)]+)[)]$/);\n      if (parenMatch) {\n        results.push({ name: parenMatch[1].trim(), relation: parenMatch[2].trim() });\n        continue;\n      }\n\n      // \n      if (trimmed.length > 0) {\n        results.push({ name: trimmed, relation: '' });\n      }\n    }\n    return results;\n  };\n\n  // [] \n  const isRelationshipCell = (value, headerName) => {\n    if (!value) return false;\n    const str = String(value).trim();\n    const lowerHeader = (headerName || '').toLowerCase();\n    // \"\"\n    if (lowerHeader.includes('') || lowerHeader.includes('')) {\n      return true;\n    }\n    //  \"();()\" \n    return /^[^(;]+[(][^)]+[)]([;][^(;]+[(][^)]+[)])*$/.test(str);\n  };\n\n  const processTemplate = (template, cardData, headers) => {\n    if (!template || !cardData) return template;\n    let result = template;\n    const name = cardData[1] || '';\n    result = result.replace(/\\{Name\\}/gi, name);\n    result = result.replace(/\\{RowIndex\\}/gi, cardData[0] || '0');\n    if (headers && headers.length > 0) {\n      headers.forEach((header, idx) => {\n        if (header && idx < cardData.length) {\n          const value = cardData[idx] || '';\n          const regex = new RegExp(`\\\\{${header}\\\\}`, 'gi');\n          result = result.replace(regex, value);\n        }\n      });\n    }\n    result = result.replace(/\\{[^}]+\\}/g, '');\n    return result;\n  };\n\n  // \n  const ACTION_BUTTONS = [\n    { id: 'acu-btn-save-global', icon: 'fa-save', title: '' },\n    { id: 'acu-btn-refresh', icon: 'fa-sync-alt', title: '' },\n    { id: 'acu-btn-collapse', icon: 'fa-chevron-down', title: '' },\n    // {id: 'acu-btn-open-editor', icon: 'fa-table-columns', title: ''},\n    { id: 'acu-btn-refill', icon: 'fa-bolt', title: '' },\n    { id: 'acu-btn-settings', icon: 'fa-cog', title: '' },\n  ];\n\n  let isInitialized = false;\n  let isSaving = false;\n  let isEditingOrder = false;\n  let isSettingsOpen = false;\n  let currentDiffMap = new Set();\n  let observer = null;\n  let _boundRenderHandler = null;\n\n  // ---  ---\n  let cachedRawData = null;\n  let hasUnsavedChanges = false;\n  let isAutoTransforming = false; // \n  let tablePageStates = {};\n  let tableSearchStates = {};\n  let lastOptionHash = null;\n  let optionPanelVisible = false; // [] \n  // [] \n  const STORAGE_KEY_SCROLL = 'acu_scroll_v19_fixed';\n  let tableScrollStates = {};\n  try {\n    const saved = localStorage.getItem(STORAGE_KEY_SCROLL);\n    if (saved) tableScrollStates = JSON.parse(saved);\n  } catch (e) {\n    console.warn('[DICE]ACU Error:', e);\n  }\n  // [] \n  const UpdateController = {\n    _lastValidationCount: 0,\n    _isRollingBack: false, // \n\n    handleUpdate: () => {\n      // \n      if (UpdateController._isRollingBack) return;\n\n      // ===  intercept  ===\n      try {\n        const snapshot = loadSnapshot();\n        const newData = getTableData();\n        if (snapshot && newData) {\n          const rules = ValidationRuleManager.getEnabledRules();\n          const violations = ValidationEngine.checkTableRules(snapshot, newData, rules);\n\n          if (violations.length > 0) {\n            console.warn('[DICE]ACU :', violations);\n            UpdateController._isRollingBack = true;\n\n            //  API \n            const api = getCore().getDB();\n            if (api?.fillTable) {\n              try {\n                api.fillTable(snapshot);\n                if (window.toastr) {\n                  window.toastr.error(violations[0].message, '', {\n                    timeOut: 5000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              } catch (fillError) {\n                console.error('[DICE]ACU fillTable :', fillError);\n                // \n                if (window.toastr) {\n                  window.toastr.error(`: ${violations[0].message}`, '', {\n                    timeOut: 7000,\n                    positionClass: 'toast-bottom-right',\n                  });\n                }\n              }\n            }\n\n            setTimeout(() => {\n              UpdateController._isRollingBack = false;\n            }, 500);\n            return;\n          }\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n      }\n\n      //  renderInterface \n      // \n      renderInterface();\n\n      // \n      setTimeout(() => {\n        try {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            const errors = ValidationEngine.validateAllData(rawData);\n            const newCount = errors.length;\n\n            // \n            if (newCount > UpdateController._lastValidationCount && newCount > 0) {\n              // \n            }\n\n            UpdateController._lastValidationCount = newCount;\n\n            // \n            updateValidationIndicator(newCount);\n          }\n        } catch (e) {\n          console.error('[DICE]ACU :', e);\n        }\n      }, 100);\n    },\n  };\n\n  // \n  const updateValidationIndicator = count => {\n    const { $ } = getCore();\n    const $indicator = $('.acu-validation-indicator');\n\n    if (count > 0) {\n      if ($indicator.length) {\n        $indicator.find('.acu-validation-count').text(count);\n        $indicator.show();\n      }\n    } else {\n      $indicator.hide();\n    }\n  };\n\n  // --- []  ---\n  const getCurrentContextFingerprint = () => {\n    try {\n      // 1:  API\n      if (typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId) {\n        return SillyTavern.getCurrentChatId();\n      }\n      // 2: \n      if (typeof SillyTavern !== 'undefined' && SillyTavern.chatId) {\n        return SillyTavern.chatId;\n      }\n      // 3:  (iframe )\n      if (window.parent?.SillyTavern?.getCurrentChatId) {\n        return window.parent.SillyTavern.getCurrentChatId();\n      }\n    } catch (e) {\n      console.warn('[DICE]ACU getCurrentContextFingerprint error:', e);\n    }\n    return 'unknown_context';\n  };\n\n  //  ()\n\n  const DEFAULT_CONFIG = {\n    layout: 'horizontal',\n    collapseStyle: 'bar',\n    collapseAlign: 'right',\n    fontFamily: 'default',\n    theme: 'retro',\n    cardWidth: 260,\n    fontSize: 13,\n    highlightNew: true,\n    itemsPerPage: 50,\n    actionsPosition: 'bottom',\n    gridColumns: 'auto', // [] \n    positionMode: 'fixed', // fixed=, embedded=\n    showOptionPanel: true, // [] \n    clickOptionToAutoSend: true, // [] \n    optionFontSize: 12, // [] \n  };\n\n  const FONTS = [\n    { id: 'default', name: ' (Modern)', val: `'Segoe UI', 'Microsoft YaHei', sans-serif` },\n    { id: 'hanchan', name: '', val: `\"\", sans-serif` },\n    { id: 'maple', name: 'Maple Mono ()', val: `\"Maple Mono NF CN\", monospace` },\n    { id: 'huiwen', name: ' (Huiwen)', val: `\"Huiwen-mincho\", serif` },\n    { id: 'cooper', name: 'Cooper', val: `\"CooperZhengKai\", serif` },\n    { id: 'yffyt', name: 'YFFYT ()', val: `\"YFFYT\", sans-serif` },\n    { id: 'fusion', name: 'Fusion Pixel ()', val: `\"Fusion Pixel 12px M latin\", monospace` },\n    { id: 'wenkai', name: ' (WenKai)', val: `\"LXGW WenKai\", serif` },\n    { id: 'notosans', name: ' (Noto Sans)', val: `\"Noto Sans CJK\", sans-serif` },\n    { id: 'zhuque', name: ' (Zhuque)', val: `\"Zhuque Fangsong (technical preview)\", serif` },\n  ];\n\n  const THEMES = [\n    { id: 'retro', name: ' (Retro)', icon: 'fa-scroll' },\n    { id: 'dark', name: ' (Dark)', icon: 'fa-moon' },\n    { id: 'modern', name: ' (Modern)', icon: 'fa-sun' },\n    { id: 'forest', name: ' (Forest)', icon: 'fa-tree' },\n    { id: 'ocean', name: ' (Ocean)', icon: 'fa-water' },\n    { id: 'cyber', name: ' (Cyber)', icon: 'fa-bolt' },\n    { id: 'nightowl', name: ' (Night Owl)', icon: 'fa-feather' },\n    { id: 'sakura', name: ' (Warm Pink)', icon: 'fa-heart' },\n    { id: 'minepink', name: ' (Mine Pink)', icon: 'fa-skull' },\n    { id: 'galgame', name: ' (Galgame Pink)', icon: 'fa-heart' },\n    { id: 'purple', name: ' (Purple)', icon: 'fa-gem' },\n    { id: 'wechat', name: ' (Green Bubble)', icon: 'fa-weixin' },\n    { id: 'educational', name: ' (Educational)', icon: 'fa-book' },\n    { id: 'vaporwave', name: ' (Vaporwave)', icon: 'fa-palette' },\n    { id: 'classicpackaging', name: ' (Classic Packaging)', icon: 'fa-box' },\n    { id: 'terminal', name: ' (Terminal)', icon: 'fa-terminal' },\n    { id: 'dreamcore', name: ' (Dreamcore)', icon: 'fa-cloud-moon' },\n    { id: 'chouten', name: ' (Cyber Kawaii)', icon: 'fa-star' },\n  ];\n\n  // []  core  ( +  ST )\n  let _coreCache = null;\n  const getCore = () => {\n    const w = window.parent || window;\n    //  jQuery\n    const $ = window.jQuery || w.jQuery;\n\n    // ($)\n    if (_coreCache && _coreCache.$) return _coreCache;\n\n    const core = {\n      $: $,\n      getDB: () => w.AutoCardUpdaterAPI || window.AutoCardUpdaterAPI,\n      clipboard: w.navigator.clipboard,\n      //   ->  ->  ()\n      ST:\n        window.SillyTavern ||\n        w.SillyTavern ||\n        (() => {\n          try {\n            return window.top ? window.top.SillyTavern : null;\n          } catch (e) {\n            return null;\n          }\n        })(),\n    };\n\n    //  jQuery \n    if ($) _coreCache = core;\n    return core;\n  };\n\n  const updateSaveButtonState = () => {\n    const { $ } = getCore();\n    const $btn = $('#acu-btn-save-global');\n    const $icon = $btn.find('i');\n    const deletions = getPendingDeletions();\n    let hasDeletions = false;\n    if (deletions) {\n      for (const key in deletions) {\n        if (deletions[key] && deletions[key].length > 0) {\n          hasDeletions = true;\n          break;\n        }\n      }\n    }\n    if (hasUnsavedChanges || hasDeletions) {\n      $icon.addClass('acu-icon-breathe');\n      $btn.attr('title', '');\n    } else {\n      $icon.removeClass('acu-icon-breathe');\n      $btn.attr('title', '');\n      $btn.css('color', '');\n    }\n  };\n\n  const getIconForTableName = name => {\n    if (!name) return 'fa-table';\n    const n = name.toLowerCase();\n    if (n.includes('') || n.includes('')) return 'fa-user-circle';\n    if (n.includes('') || n.includes('')) return 'fa-globe-asia';\n    if (n.includes('') || n.includes('')) return 'fa-briefcase';\n    if (n.includes('') || n.includes('')) return 'fa-dragon';\n    if (n.includes('') || n.includes('')) return 'fa-user-friends';\n    if (n.includes('') || n.includes('')) return 'fa-scroll';\n    if (n.includes('') || n.includes('')) return 'fa-address-book';\n    if (n.includes('') || n.includes('')) return 'fa-book-reader';\n    if (n.includes('') || n.includes('')) return 'fa-map-location-dot';\n    if (n.includes('') || n.includes('') || n.includes('')) return 'fa-bullseye';\n    if (n.includes('') || n.includes('')) return 'fa-shield-halved';\n    if (n.includes('')) return 'fa-gem';\n    if (n.includes('') || n.includes('')) return 'fa-file-lines';\n    if (n.includes('')) return 'fa-list-check';\n    return 'fa-table';\n  };\n\n  const getBadgeStyle = text => {\n    if (!text) return '';\n    const str = String(text).trim();\n    if (/^[0-9]+%?$/.test(str) || /^Lv\\.\\d+$/.test(str)) return 'acu-badge-green';\n    if (str.length <= 6 && !str.includes('http')) return 'acu-badge-neutral';\n    if (['', '', '', '', '', ''].includes(str)) return 'acu-badge-neutral';\n    return '';\n  };\n\n  // []  ()\n  const Store = {\n    get: (key, def = null) => {\n      try {\n        return JSON.parse(localStorage.getItem(key)) ?? def;\n      } catch {\n        return def;\n      }\n    },\n    set: (key, val) => {\n      try {\n        localStorage.setItem(key, JSON.stringify(val));\n      } catch (e) {\n        // \n        if (e.name === 'QuotaExceededError' || e.message.includes('quota')) {\n          console.warn('[DICE]ACU ...');\n          try {\n            // 1.  ()\n            localStorage.removeItem(STORAGE_KEY_LAST_SNAPSHOT);\n\n            // 2. \n            localStorage.setItem(key, JSON.stringify(val));\n          } catch (retryErr) {\n            // \n            console.error('[DICE]ACU Store ', retryErr);\n            if (window.toastr && !window._acuQuotaAlerted) {\n              window.toastr.warning(' ');\n              window._acuQuotaAlerted = true;\n              setTimeout(() => (window._acuQuotaAlerted = false), 10000);\n            }\n          }\n        } else {\n          console.error('[DICE]ACU Store', e);\n        }\n      }\n    },\n  };\n\n  const getActiveTabState = () => Store.get(STORAGE_KEY_ACTIVE_TAB);\n  const saveActiveTabState = v => Store.set(STORAGE_KEY_ACTIVE_TAB, v);\n  const getPendingDeletions = () => Store.get(STORAGE_KEY_PENDING_DELETIONS, {});\n  const savePendingDeletions = v => Store.set(STORAGE_KEY_PENDING_DELETIONS, v);\n  const getSavedTableOrder = () => Store.get(STORAGE_KEY_TABLE_ORDER);\n  const saveTableOrder = v => Store.set(STORAGE_KEY_TABLE_ORDER, v);\n  const getCollapsedState = () => Store.get(STORAGE_KEY_IS_COLLAPSED, false);\n  const saveCollapsedState = v => Store.set(STORAGE_KEY_IS_COLLAPSED, v);\n  // [] \n  const getOptionsCollapsedState = () => Store.get(STORAGE_KEY_OPTIONS_COLLAPSED, false);\n  const saveOptionsCollapsedState = v => Store.set(STORAGE_KEY_OPTIONS_COLLAPSED, v);\n  // []  (Chat ID)\n  const loadSnapshot = () => {\n    const data = Store.get(STORAGE_KEY_LAST_SNAPSHOT);\n    if (!data) return null;\n    // \n    const currentCtx = getCurrentContextFingerprint();\n    // \n    if (data._contextId && data._contextId !== currentCtx) {\n      return null;\n    }\n    return data;\n  };\n\n  // [] \n  const saveSnapshot = v => {\n    if (!v) return;\n    //  ChatID\n    if (typeof v === 'object') {\n      v._contextId = getCurrentContextFingerprint();\n    }\n    Store.set(STORAGE_KEY_LAST_SNAPSHOT, v);\n  };\n\n  // --- []  ---\n  const getTableHeights = () => Store.get(STORAGE_KEY_TABLE_HEIGHTS, {});\n  const saveTableHeights = v => Store.set(STORAGE_KEY_TABLE_HEIGHTS, v);\n  const getTableStyles = () => Store.get(STORAGE_KEY_TABLE_STYLES, {});\n  const saveTableStyles = v => Store.set(STORAGE_KEY_TABLE_STYLES, v);\n  const getHiddenTables = () => Store.get(STORAGE_KEY_HIDDEN_TABLES, []);\n  const saveHiddenTables = v => Store.set(STORAGE_KEY_HIDDEN_TABLES, v);\n  const getReverseTables = () => Store.get(STORAGE_KEY_REVERSE_TABLES, []);\n  const saveReverseTables = v => Store.set(STORAGE_KEY_REVERSE_TABLES, v);\n\n  // \n  const shouldShowReverseButton = tableName => {\n    if (!tableName) return false;\n    const keywords = ['', '', '', '', ''];\n    return keywords.some(kw => tableName.includes(kw));\n  };\n\n  // \n  const isTableReversed = tableName => {\n    return getReverseTables().includes(tableName);\n  };\n\n  // \n  const toggleTableReverse = tableName => {\n    const list = getReverseTables();\n    const idx = list.indexOf(tableName);\n    if (idx >= 0) {\n      list.splice(idx, 1);\n    } else {\n      list.push(tableName);\n    }\n    saveReverseTables(list);\n    console.log('[DICE]ACU toggleTableReverse:', tableName, 'reversed:', idx < 0);\n  };\n  // [] \n  const getAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          let attrs = [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.includes(attr.name)) attrs.push(attr.name);\n              });\n            }\n          });\n          if (attrs.length > 0) return attrs;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            let attrs = [];\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.includes(attr.name)) attrs.push(attr.name);\n                });\n              }\n            });\n            return attrs;\n          }\n        }\n      }\n    }\n\n    return [];\n  };\n  // [] \n  const getAttributeValue = (characterName, attrName) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData || !attrName) return null;\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          for (let idx = 0; idx < headers.length; idx++) {\n            const h = headers[idx];\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              const found = parsed.find(attr => attr.name === attrName);\n              if (found) return found.value;\n            }\n          }\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            for (let idx = 0; idx < headers.length; idx++) {\n              const h = headers[idx];\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                const found = parsed.find(attr => attr.name === attrName);\n                if (found) return found.value;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n  // [] 6\n  const STANDARD_ATTRS = ['', '', '', '', '', ''];\n\n  /**\n   * \n   */\n  const getStandardAttrs = () => {\n    const preset = AttributePresetManager.getActivePreset();\n    if (preset && preset.baseAttributes) {\n      return preset.baseAttributes.map(attr => attr.name);\n    }\n    return STANDARD_ATTRS;\n  };\n\n  /**\n   * \n   * \n   *  + \n   */\n  const getRandomSkillPool = () => {\n    try {\n      const preset = AttributePresetManager.getActivePreset();\n      if (preset) {\n        //  + \n        const allAttrs = new Set();\n\n        // \n        if (preset.baseAttributes && Array.isArray(preset.baseAttributes)) {\n          preset.baseAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        // \n        if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n          preset.specialAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        return Array.from(allAttrs);\n      }\n\n      // \n      const allPresets = AttributePresetManager.getAllPresets() || [];\n      const allAttrs = new Set(RANDOM_SKILL_POOL || []); // \n\n      // \n      if (Array.isArray(allPresets)) {\n        allPresets.forEach(p => {\n          if (!p) return;\n\n          // \n          if (p.baseAttributes && Array.isArray(p.baseAttributes)) {\n            p.baseAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n\n          // \n          if (p.specialAttributes && Array.isArray(p.specialAttributes)) {\n            p.specialAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n        });\n      }\n\n      return Array.from(allAttrs);\n    } catch (err) {\n      console.error('[DICE]ACU getRandomSkillPool :', err);\n      return RANDOM_SKILL_POOL || [];\n    }\n  };\n\n  // [] \n  const RANDOM_SKILL_POOL = [\n    // ---  (Physical & Movement) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Social & Psychological) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    // /\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Technical & Crafting) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Knowledge & Investigation) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Combat & Special) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  // []  COC/DND 6\n  /**\n   * \n   * @param isDNDOrPreset ()    null()\n   * @returns { base: {...}, special: {...} }  {...}\n   */\n  const generateRPGAttributes = (isDNDOrPreset = undefined) => {\n    // \n    if (typeof isDNDOrPreset === 'boolean') {\n      const isDND = isDNDOrPreset;\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n\n      const generateValue = () => {\n        if (isDND) {\n          const base = generate3d6();\n          const adjust = rollDice(4) - 2;\n          return Math.max(3, Math.min(18, base + adjust));\n        } else {\n          const base = generate3d6() * 5;\n          const adjust = rollDice(10) - 5;\n          return Math.max(5, Math.min(95, base + adjust));\n        }\n      };\n\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        result[attr] = generateValue();\n      });\n      return result; // \n    }\n\n    // \n    const preset = isDNDOrPreset || AttributePresetManager.getActivePreset();\n\n    // \n    if (!preset) {\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        const base = generate3d6() * 5;\n        const adjust = rollDice(10) - 5;\n        result[attr] = Math.max(5, Math.min(95, base + adjust));\n      });\n      return { base: result, special: {} };\n    }\n\n    // \n    const baseResult = {};\n    preset.baseAttributes.forEach(attr => {\n      const formula = attr.modifier ? `${attr.formula}+${attr.modifier}` : attr.formula;\n      baseResult[attr.name] = generateAttributeValue(formula, attr.range, {});\n    });\n\n    // \n    const specialResult = {};\n    if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n      preset.specialAttributes.forEach(attr => {\n        specialResult[attr.name] = generateAttributeValue(attr.formula, attr.range, baseResult);\n      });\n    }\n\n    return { base: baseResult, special: specialResult };\n  };\n\n  // [] \n  const clearPresetAttributesForCharacter = async charName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // NPC//\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[DICE]ACU clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    const customAttrs = existingAttrs.filter(attr => !presetAttrNames.has(attr.name));\n    const newAttrString = customAttrs.map(attr => `${attr.name}:${attr.value}`).join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData);\n\n    return {\n      success: true,\n      attrString: newAttrString,\n    };\n  };\n\n  // [] \n  const writeAttributesToCharacter = async (charName, newAttrs, isDND = false) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \"\"\n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // \n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[DICE]ACU writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('\"\"');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const existingMap = {};\n    existingAttrs.forEach(attr => {\n      existingMap[attr.name] = attr.value;\n    });\n\n    // +\n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    let standardCount = 0;\n    standardAttrs.forEach(attrName => {\n      if (existingMap[attrName] !== undefined) {\n        standardCount++;\n      }\n    });\n    const isComplete = standardCount === standardAttrs.length;\n\n    // \n    const customAttrs = [];\n    existingAttrs.forEach(attr => {\n      if (!presetAttrNames.has(attr.name)) {\n        customAttrs.push({ name: attr.name, value: attr.value });\n      }\n    });\n\n    // \n    const resultParts = [];\n\n    // 1. \n    standardAttrs.forEach(attrName => {\n      if (isComplete) {\n        //   \n        const newValue = newAttrs[attrName] !== undefined ? newAttrs[attrName] : existingMap[attrName];\n        if (newValue !== undefined) {\n          resultParts.push(`${attrName}:${newValue}`);\n        }\n      } else {\n        //   \n        if (existingMap[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        } else if (newAttrs[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        }\n      }\n    });\n\n    // 2. \n    Object.keys(newAttrs).forEach(attrName => {\n      if (!standardAttrs.includes(attrName)) {\n        // \n        if (isComplete || !existingMap[attrName]) {\n          // \n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        } else {\n          // \n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        }\n      }\n    });\n\n    // 3. \n    customAttrs.forEach(attr => {\n      resultParts.push(`${attr.name}:${attr.value}`);\n    });\n\n    const newAttrString = resultParts.join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData);\n\n    // UI\n    const writtenAttrs = [];\n    standardAttrs.forEach(attrName => {\n      writtenAttrs.push({ name: attrName, value: newAttrs[attrName] });\n    });\n\n    return {\n      success: true,\n      attrs: writtenAttrs,\n      attrString: newAttrString,\n      wasComplete: isComplete,\n    };\n  };\n  // [] \"\"\n  const getFullAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n    let attrs = [];\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.some(a => a.name === attr.name)) {\n                  attrs.push(attr);\n                }\n              });\n            }\n          });\n          if (attrs.length > 0) break;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.some(a => a.name === attr.name)) {\n                    attrs.push(attr);\n                  }\n                });\n              }\n            });\n            break;\n          }\n        }\n        if (attrs.length > 0) break;\n      }\n    }\n\n    return attrs;\n  };\n  // [] \n  const initCustomDropdown = ($input, options, themeColors) => {\n    const { $ } = getCore();\n    const t = themeColors || {};\n    const inputId = $input.attr('id') || 'dd_' + Math.random().toString(36).substr(2, 9);\n    $input.attr('id', inputId);\n\n    // \n    $input.parent().find('.acu-dropdown-list').remove();\n\n    //  wrapper\n    if (!$input.parent().hasClass('acu-dropdown-wrapper')) {\n      $input.wrap('<div class=\"acu-dropdown-wrapper\"></div>');\n    }\n\n    // \n    const $dropdown = $(`<div class=\"acu-dropdown-list\" data-for=\"${inputId}\"></div>`);\n    $dropdown.css({\n      background: t.bgPanel || '#fff',\n      'border-color': t.border || '#ccc',\n    });\n    $input.after($dropdown);\n\n    const renderItems = (filter = '') => {\n      const lowerFilter = filter.toLowerCase();\n      const filtered = options.filter(opt => opt.toLowerCase().includes(lowerFilter));\n\n      if (filtered.length === 0) {\n        $dropdown.html(`<div class=\"acu-dropdown-empty\" style=\"color:${t.textSub || '#999'};\"></div>`);\n      } else {\n        $dropdown.html(\n          filtered\n            .map(\n              opt =>\n                `<div class=\"acu-dropdown-item\" data-value=\"${escapeHtml(opt)}\" style=\"color:${t.textMain || '#333'};\">${escapeHtml(opt)}</div>`,\n            )\n            .join(''),\n        );\n      }\n    };\n\n    const showDropdown = () => {\n      $('.acu-dropdown-list').removeClass('visible');\n      renderItems($input.val());\n      $dropdown.addClass('visible');\n    };\n\n    const hideDropdown = () => {\n      $dropdown.removeClass('visible');\n    };\n\n    // \n    $input.off('.acudd').on('focus.acudd click.acudd', function (e) {\n      e.stopPropagation();\n      showDropdown();\n    });\n\n    // \n    $input.on('input.acudd', function () {\n      renderItems($(this).val());\n    });\n\n    // hover \n    $dropdown\n      .on('mouseenter', '.acu-dropdown-item', function () {\n        $(this).css('background', t.tableHead || 'rgba(128,128,128,0.15)');\n      })\n      .on('mouseleave', '.acu-dropdown-item', function () {\n        $(this).css('background', 'transparent');\n      });\n\n    // \n    $dropdown.on('click', '.acu-dropdown-item', function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      const val = $(this).data('value');\n      $input.val(val).trigger('change');\n      hideDropdown();\n    });\n\n    // \n    $dropdown.on('click', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $input\n      .closest('.acu-dice-panel, .acu-contest-panel')\n      .off('click.acudd_' + inputId)\n      .on('click.acudd_' + inputId, function (e) {\n        if (!$(e.target).closest('.acu-dropdown-wrapper').length) {\n          hideDropdown();\n        }\n      });\n  };\n  // [] \n  const addClearButton = ($panel, inputSelector, themeColors) => {\n    const { $ } = getCore();\n    const t = themeColors || {};\n    $panel.find(inputSelector).each(function () {\n      const $input = $(this);\n      // \n      if ($input.parent().hasClass('acu-input-wrapper')) return;\n      // \n      $input.wrap('<div class=\"acu-input-wrapper\"></div>');\n      //  - \n      const $clearBtn = $(\n        `<button type=\"button\" class=\"acu-clear-btn\" title=\"\" style=\"color:${t.textSub || '#999'};\"><i class=\"fa-solid fa-times\"></i></button>`,\n      );\n      $input.after($clearBtn);\n      // \n      $clearBtn.on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        $input.val('').trigger('input').trigger('change').focus();\n      });\n      //  - \n      $clearBtn\n        .on('mouseenter', function () {\n          $(this).css({ color: t.accent || '#7a695f', opacity: '1' });\n        })\n        .on('mouseleave', function () {\n          $(this).css({ color: t.textSub || '#999', opacity: '0.5' });\n        });\n    });\n  };\n  // [] \n  const showDiceSettingsPanel = (isDND = false) => {\n    const { $ } = getCore();\n    $('.acu-dice-config-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    const ruleTitle = isDND ? 'DND ' : 'COC ';\n    const resetText = isDND ? ' DND ' : ' COC ';\n\n    // \n    const defaults = isDND\n      ? { critSuccess: 20, critFail: 1 }\n      : { critSuccess: 5, critFail: 96, hardDiv: 2, extremeDiv: 5 };\n\n    //  placeholder\n    const currentCritSuccess = isDND\n      ? diceCfg.dndCritSuccess !== undefined && diceCfg.dndCritSuccess !== defaults.critSuccess\n        ? diceCfg.dndCritSuccess\n        : ''\n      : diceCfg.critSuccessMax !== undefined && diceCfg.critSuccessMax !== defaults.critSuccess\n        ? diceCfg.critSuccessMax\n        : '';\n    const currentCritFail = isDND\n      ? diceCfg.dndCritFail !== undefined && diceCfg.dndCritFail !== defaults.critFail\n        ? diceCfg.dndCritFail\n        : ''\n      : diceCfg.critFailMin !== undefined && diceCfg.critFailMin !== defaults.critFail\n        ? diceCfg.critFailMin\n        : '';\n    const currentHardDiv =\n      !isDND && diceCfg.difficultSuccessDiv !== undefined && diceCfg.difficultSuccessDiv !== defaults.hardDiv\n        ? diceCfg.difficultSuccessDiv\n        : '';\n    const currentExtremeDiv =\n      !isDND && diceCfg.hardSuccessDiv !== undefined && diceCfg.hardSuccessDiv !== defaults.extremeDiv\n        ? diceCfg.hardSuccessDiv\n        : '';\n\n    const tieRule = diceCfg.contestTieRule || 'initiator_lose';\n    const hideDiceResultFromUser =\n      diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n    const hideDiceResultInChat = diceCfg.hideDiceResultInChat !== undefined ? diceCfg.hideDiceResultInChat : false;\n\n    const cocExtraHtml = isDND\n      ? ''\n      : `\n            <div class=\"acu-dice-cfg-row\">\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-hard-div\" data-min=\"2\" data-max=\"5\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentHardDiv || defaults.hardDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <div class=\"acu-stepper\" data-id=\"cfg-extreme-div\" data-min=\"3\" data-max=\"10\" data-step=\"1\">\n                        <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                        <span class=\"acu-stepper-value\">${currentExtremeDiv || defaults.extremeDiv}</span>\n                        <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const panelHtml = `\n            <div class=\"acu-dice-config-overlay\">\n                <div class=\"acu-dice-config-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-dice-cfg-header\">\n                        <span><i class=\"fa-solid fa-cog\"></i> ${ruleTitle}</span>\n                        <button class=\"acu-config-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-dice-cfg-body\">\n                        <div class=\"acu-dice-cfg-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-success\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritSuccess || defaults.critSuccess}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <div class=\"acu-stepper\" data-id=\"cfg-crit-fail\" data-min=\"1\" data-max=\"100\" data-step=\"1\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${currentCritFail || defaults.critFail}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                        ${cocExtraHtml}\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <select id=\"cfg-tie-rule\">\n                                    <option value=\"initiator_lose\" ${tieRule === 'initiator_lose' ? 'selected' : ''}> ()</option>\n                                    <option value=\"tie\" ${tieRule === 'tie' ? 'selected' : ''}></option>\n                                    <option value=\"initiator_win\" ${tieRule === 'initiator_win' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label></label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result\" ${hideDiceResultFromUser ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item acu-cfg-toggle-item\">\n                                <label></label>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-hide-dice-result-chat\" ${hideDiceResultInChat ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-actions\">\n                            <button id=\"cfg-reset-dice\">${resetText}</button>\n                            <button id=\"cfg-save-dice\"></button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $panel = $(panelHtml);\n    $('body').append($panel);\n\n    $panel.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '2147483655',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    // \n    const theme = getThemeColors();\n    $panel.find('#cfg-reset-dice, #cfg-save-dice').css({\n      background: theme.btnBg,\n      color: theme.textMain,\n      borderColor: theme.border,\n    });\n    $panel.find('#cfg-reset-dice, #cfg-save-dice').hover(\n      function () {\n        $(this).css({\n          background: theme.btnHover,\n          borderColor: theme.btnHover,\n        });\n      },\n      function () {\n        $(this).css({\n          background: theme.btnBg,\n          borderColor: theme.border,\n        });\n      },\n    );\n\n    const closePanel = () => $panel.remove();\n    $panel.find('.acu-config-close').click(closePanel);\n    $panel.on('click', e => {\n      if ($(e.target).hasClass('acu-dice-config-overlay')) closePanel();\n    });\n\n    // === Stepper  ===\n    $panel.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        $value.text(newVal);\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    $panel.find('#cfg-save-dice').click(function () {\n      const newCfg = { contestTieRule: $('#cfg-tie-rule').val() };\n\n      // stepper\n      const getStepperValue = id => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          const text = $stepper.find('.acu-stepper-value').text().replace(/[^\\d]/g, '');\n          return text !== '' ? parseInt(text, 10) : null;\n        }\n        return null;\n      };\n\n      const critSuccessVal = getStepperValue('cfg-crit-success');\n      const critFailVal = getStepperValue('cfg-crit-fail');\n\n      if (isDND) {\n        newCfg.dndCritSuccess = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.dndCritFail = critFailVal !== null ? critFailVal : defaults.critFail;\n      } else {\n        newCfg.critSuccessMax = critSuccessVal !== null ? critSuccessVal : defaults.critSuccess;\n        newCfg.critFailMin = critFailVal !== null ? critFailVal : defaults.critFail;\n\n        const hardDivVal = getStepperValue('cfg-hard-div');\n        const extremeDivVal = getStepperValue('cfg-extreme-div');\n        newCfg.difficultSuccessDiv = hardDivVal !== null ? hardDivVal : defaults.hardDiv;\n        newCfg.hardSuccessDiv = extremeDivVal !== null ? extremeDivVal : defaults.extremeDiv;\n      }\n\n      // \"\"\n      newCfg.hideDiceResultFromUser = $('#cfg-hide-dice-result').is(':checked');\n      // \"\"\n      newCfg.hideDiceResultInChat = $('#cfg-hide-dice-result-chat').is(':checked');\n\n      saveDiceConfig(newCfg);\n      // \n      console.info('[DICE]/...');\n      hideDiceResultsInUserMessages();\n      closePanel();\n    });\n\n    $panel.find('#cfg-reset-dice').click(function () {\n      // stepper\n      const resetStepper = (id, defaultValue) => {\n        const $stepper = $panel.find(`.acu-stepper[data-id=\"${id}\"]`);\n        if ($stepper.length) {\n          $stepper.find('.acu-stepper-value').text(defaultValue);\n        }\n      };\n\n      resetStepper('cfg-crit-success', defaults.critSuccess);\n      resetStepper('cfg-crit-fail', defaults.critFail);\n      if (!isDND) {\n        resetStepper('cfg-hard-div', defaults.hardDiv);\n        resetStepper('cfg-extreme-div', defaults.extremeDiv);\n      }\n    });\n  };\n  // [] \n  const showDicePanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n    // 1d100\n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    // 1d100\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n    // [] \n    const rawDataForList = cachedRawData || getTableData();\n    let diceCharacterList = ['<user>'];\n    let diceAttrList = [];\n\n    if (rawDataForList) {\n      for (const key in rawDataForList) {\n        const sheet = rawDataForList[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '') {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) diceCharacterList.push(row[1]);\n          }\n        }\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const row = sheet.content[1];\n          const headers = sheet.content[0] || [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!diceAttrList.includes(attr.name)) diceAttrList.push(attr.name);\n              });\n            }\n          });\n        }\n      }\n    }\n    const {\n      targetValue = null, // []  null\n      targetName = '',\n      attrValue = null, // [] \n      diceType = savedDiceType, // \n      successCriteria = 'lte', // [] COC\n      onResult = null,\n      initiatorName = '', // [] \n      fromMvu = false, // [] MVU\n      mvuPath = null, // [] MVU\n      mvuParsedInfo = null, // [] \n    } = options;\n\n    // [] /DC\n    const isDND = diceType === '1d20' || successCriteria === 'gte';\n    let initialAttrValue = attrValue;\n    let initialTargetValue = targetValue;\n\n    // attrValuetargetValue\n    if (attrValue !== null && targetValue === null) {\n      if (isDND) {\n        initialTargetValue = Math.max(0, 20 - attrValue);\n      } else {\n        initialTargetValue = attrValue;\n      }\n    }\n\n    const t = getThemeColors();\n    const isCyberTheme = getConfig().theme === 'cyber';\n    const inputTextColor = isCyberTheme ? '#ff00ff' : t.inputText;\n    const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n    // \n    const inputStyle = `width:100%;padding:5px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:4px;color:${inputTextColor} !important;font-size:12px;text-align:center;box-sizing:border-box;`;\n\n    const overlay = $(\n      `<div class=\"acu-dice-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:${t.overlayBgLight};z-index:2147483647;\"></div>`,\n    );\n\n    // []  COC  DND\n    const successCriteriaOptions = [\n      { id: 'lte', name: ' (COC)' },\n      { id: 'gte', name: ' (DND)' },\n    ];\n\n    // [] \n    let defaultCriteria = successCriteria;\n    if (diceType === '1d100') defaultCriteria = 'lte';\n    else if (diceType === '1d20') defaultCriteria = 'gte';\n\n    const panel = $(`\n            <div class=\"acu-dice-panel acu-theme-${config.theme}\" style=\"\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 340px;\n                max-width: 90vw;\n                background: ${t.bgPanel};\n                border: 1px solid ${t.border};\n                border-radius: 12px;\n                box-shadow: 0 20px 60px ${t.shadowBg};\n                z-index: 2147483648;\n                overflow: hidden;\n            \">\n                <div style=\"padding: 12px 15px; background: ${t.tableHead}; border-bottom: 1px solid ${t.border}; display: flex; justify-content: space-between; align-items: center;\">\n                    <div style=\"font-size: 15px; font-weight: bold; color: ${t.accent}; display: flex; align-items: center; gap: 8px;\">\n                        <i class=\"fa-solid fa-dice-d20\"></i> \n                    </div>\n                    <div style=\"display: flex; align-items: center; gap: 8px;\">\n                        <button id=\"dice-switch-contest-top\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 14px; padding: 4px; transition: all 0.2s;\" title=\"\"><i class=\"fa-solid fa-people-arrows\"></i></button>\n                        <button class=\"acu-dice-config-btn\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 14px; padding: 4px; transition: all 0.2s;\" title=\"\">\n                            <i class=\"fa-solid fa-cog\"></i>\n                        </button>\n                        <button class=\"acu-dice-close\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 16px; padding: 4px;\">\n                            <i class=\"fa-solid fa-times\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div style=\"padding: 15px; max-height: 70vh; overflow-y: auto;\">\n                    <div style=\"display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; align-items: center;\" class=\"acu-dice-presets\">\n                        <button class=\"acu-dice-preset ${diceType === '1d20' ? 'active' : ''}\" data-dice=\"1d20\" data-criteria=\"gte\" style=\"padding: 4px 10px; background: ${diceType === '1d20' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${diceType === '1d20' ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\">1d20</button>\n                        <button class=\"acu-dice-preset ${diceType === '1d100' ? 'active' : ''}\" data-dice=\"1d100\" data-criteria=\"lte\" style=\"padding: 4px 10px; background: ${diceType === '1d100' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${diceType === '1d100' ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\">1d100</button>\n                        <button class=\"acu-dice-preset acu-dice-custom-btn\" data-dice=\"custom\" style=\"padding: 4px 10px; background: ${!['1d20', '1d100'].includes(diceType) ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${!['1d20', '1d100'].includes(diceType) ? buttonTextOnAccent : t.textMain}; font-size: 11px; cursor: pointer;\"></button>\n                        <input type=\"text\" id=\"dice-custom-input\" placeholder=\"2d6\" value=\"${!['1d20', '1d100'].includes(diceType) ? diceType : ''}\" style=\"width:60px;\">\n                    </div>\n\n                    <!--  -->\n                    <div style=\"margin-bottom: 10px;\">\n                        <div style=\"font-size: 11px; color: ${t.accent}; font-weight: bold; margin-bottom: 4px; display: flex; align-items: center; gap: 6px;\"><i class=\"fa-solid fa-user\"></i> </div>\n                        <div id=\"dice-char-buttons\" style=\"display: flex; flex-wrap: wrap; gap: 4px; max-height: 60px; overflow-y: auto;\"></div>\n                    </div>\n\n                    <!-- 1 +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-initiator-name\" value=\"${escapeHtml(initiatorName)}\" placeholder=\"<user>\" style=\"${inputStyle}\">\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; gap: 6px;\">\n                                \n                                <button type=\"button\" class=\"acu-random-skill-btn\" id=\"dice-random-skill\" title=\"\" style=\"width: 18px; height: 18px; padding: 0; background: transparent; border: 1px dashed ${t.accent}; border-radius: 4px; color: ${t.accent}; font-size: 9px; cursor: pointer; display: flex; align-items: center; justify-content: center;\">\n                                    <i class=\"fa-solid fa-dice\"></i>\n                                </button>\n                            </div>\n                            <input type=\"text\" id=\"dice-attr-name\" value=\"${escapeHtml(targetName || '')}\" placeholder=\"\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!-- 2 +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-attr-value\" value=\"${initialAttrValue !== null ? initialAttrValue : ''}\" placeholder=\"=50%\" style=\"${inputStyle}\">\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\" id=\"dice-target-label\"></div>\n                            <input type=\"text\" id=\"dice-target\" value=\"${initialTargetValue !== null ? initialTargetValue : ''}\" placeholder=\"=\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!-- 3 +  +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-bottom: 6px;\" id=\"dice-row-3\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; justify-content: center;\"></div>\n                            <select id=\"dice-success-criteria\" class=\"acu-dice-select\">\n                                ${successCriteriaOptions\n                                  .map(\n                                    opt =>\n                                      `<option value=\"${opt.id}\" ${opt.id === defaultCriteria ? 'selected' : ''}>${opt.name}</option>`,\n                                  )\n                                  .join('')}\n                            </select>\n                        </div>\n                        <div id=\"dice-difficulty-wrapper\">\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center; justify-content: center;\"></div>\n                            <select id=\"dice-difficulty\" class=\"acu-dice-select\">\n                                <option value=\"normal\" selected></option>\n                                <option value=\"hard\"></option>\n                                <option value=\"extreme\"></option>\n                                <option value=\"critical\"></option>\n                            </select>\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; min-height: 18px; display: flex; align-items: center;\"></div>\n                            <input type=\"text\" id=\"dice-modifier\" value=\"0\" style=\"${inputStyle}\">\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div style=\"margin-bottom: 10px;\">\n                        <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 4px;\"><i class=\"fa-solid fa-sliders\"></i> </div>\n                        <div id=\"dice-attr-buttons\" style=\"display: flex; flex-wrap: wrap; gap: 4px; max-height: 80px; overflow-y: auto;\"></div>\n                    </div>\n                    <!--  -->\n                    <input type=\"hidden\" id=\"dice-formula\" value=\"${diceType}\">\n\n                    <button id=\"dice-roll-btn\" style=\"width: 100%; padding: 12px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 8px; color: ${t.buttonText}; font-size: 15px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; position: relative;\">\n                        <i class=\"fa-solid fa-dice\"></i> \n                    </button>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay).append(panel);\n\n    // [] \n    const buildCharButtons = () => {\n      const $container = panel.find('#dice-char-buttons');\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.initiator) {\n        const initiator = mvuParsedInfo.initiator;\n        const shortName = initiator.length > 4 ? initiator.substring(0, 4) + '..' : initiator;\n        const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n        html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu\" data-char=\"${escapeHtml(initiator)}\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;white-space:nowrap;font-weight:bold;\" title=\": ${escapeHtml(initiator)}\">${escapeHtml(shortName)}</button>`;\n      }\n\n      // \n      diceCharacterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html += `<button class=\"acu-dice-char-btn\" data-char=\"${escapeHtml(name)}\" style=\"padding:3px 8px;background:${t.btnBg};border:1px solid ${t.border};border-radius:4px;color:${t.textMain};font-size:11px;cursor:pointer;white-space:nowrap;\" title=\"${escapeHtml(displayName)}\">${escapeHtml(shortName)}</button>`;\n      });\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.candidates && mvuParsedInfo.candidates.length > 0) {\n        mvuParsedInfo.candidates.forEach(candidate => {\n          // \n          if (mvuParsedInfo.initiator && candidate === mvuParsedInfo.initiator) return;\n          const shortName = candidate.length > 4 ? candidate.substring(0, 4) + '..' : candidate;\n          html += `<button class=\"acu-dice-char-btn acu-dice-char-btn-mvu-candidate\" data-char=\"${escapeHtml(candidate)}\" style=\"padding:3px 8px;background:${t.inputBg};border:1px dashed ${t.accent};border-radius:4px;color:${t.accent};font-size:11px;cursor:pointer;white-space:nowrap;\" title=\": ${escapeHtml(candidate)}\">${escapeHtml(shortName)}</button>`;\n        });\n      }\n\n      $container.html(html || `<div style=\"font-size:11px;color:${t.textSub};\"></div>`);\n      // \n      $container.find('.acu-dice-char-btn').click(function () {\n        const charName = $(this).data('char');\n        panel.find('#dice-initiator-name').val(charName).trigger('change');\n      });\n    };\n\n    // [] \n    const buildAttrButtons = charName => {\n      const $container = panel.find('#dice-attr-buttons');\n      const $parentSection = $container.parent(); // \n      const attrs = getFullAttributesForCharacter(charName);\n\n      // \n      $parentSection.show();\n\n      let html = '';\n\n      // [] MVU\n      if (fromMvu && mvuParsedInfo && mvuParsedInfo.attrName) {\n        const attrName = mvuParsedInfo.attrName;\n        // \n        const attrValue = getAttributeValue(charName, attrName) || targetValue || '';\n        const buttonTextOnAccent = t.buttonTextOnAccent || t.textMain || '#6B4A5A';\n        if (attrValue) {\n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"${attrValue}\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;font-weight:bold;\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}:${attrValue}</button>`;\n        } else {\n          // \n          html += `<button class=\"acu-dice-attr-btn acu-dice-attr-btn-mvu\" data-name=\"${escapeHtml(attrName)}\" data-value=\"\" style=\"padding:3px 8px;background:${t.accent};border:1px solid ${t.accent};border-radius:4px;color:${buttonTextOnAccent};font-size:11px;cursor:pointer;font-weight:bold;\" title=\": ${escapeHtml(attrName)}\">${escapeHtml(attrName)}</button>`;\n        }\n      }\n\n      // \n      attrs.forEach(attr => {\n        html += `<button class=\"acu-dice-attr-btn\" data-name=\"${escapeHtml(attr.name)}\" data-value=\"${attr.value}\" style=\"padding:3px 8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:4px;color:${t.inputText};font-size:11px;cursor:pointer;\">${escapeHtml(attr.name)}:${attr.value}</button>`;\n      });\n\n      // \n      html += `<button class=\"acu-dice-gen-attr-btn\" style=\"padding:3px 8px;background:transparent;border:1px dashed ${t.accent};border-radius:4px;color:${t.accent};font-size:11px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>`;\n\n      // \n      html += `<button class=\"acu-dice-clear-attr-btn\" style=\"padding:3px 8px;background:transparent;border:1px dashed ${t.errorText};border-radius:4px;color:${t.errorText};font-size:11px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;margin-left:4px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\"></i></button>`;\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-dice-attr-btn').click(function () {\n        const attrName = $(this).data('name');\n        const attrValue = $(this).data('value');\n        panel.find('#dice-attr-name').val(attrName);\n        panel.find('#dice-attr-value').val(attrValue);\n\n        // \n        const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n        const isDND = criteria === 'gte';\n        const numValue = parseInt(attrValue, 10) || 0;\n\n        if (isDND) {\n          // DNDDC = 20 - \n          panel.find('#dice-target').val(20 - numValue);\n        } else {\n          // COC = \n          panel.find('#dice-target').val(attrValue);\n        }\n\n        // changeUI\n        panel.find('#dice-attr-value').trigger('change');\n      });\n\n      // \n      $container.find('.acu-dice-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n          console.log('[DICE]ACU  for:', charName);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-dice-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharButtons();\n    // <user>\n    buildAttrButtons('<user>');\n    // [] \n    panel.find('#dice-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#dice-attr-name').val(randomSkill).trigger('change');\n    });\n\n    // \n    initCustomDropdown(panel.find('#dice-initiator-name'), diceCharacterList, t);\n    initCustomDropdown(panel.find('#dice-attr-name'), diceAttrList, t);\n    // [] \n    addClearButton(panel, '#dice-initiator-name, #dice-attr-name, #dice-attr-value, #dice-target', t);\n\n    // [] \n    panel.find('#dice-initiator-name').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#dice-attr-name'), newAttrList.length > 0 ? newAttrList : diceAttrList, t);\n\n      // [] \n      buildAttrButtons(charName);\n    });\n\n    // [] \n    panel.find('#dice-attr-name').on('change.acuval', function () {\n      const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#dice-attr-value').val(attrValue);\n        // /DC\n        const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n        const isDND = criteria === 'gte';\n        panel.find('#dice-target').val(isDND ? 20 - attrValue : attrValue);\n      }\n    });\n\n    // [] \n    const convertTargetForDice = (currentTarget, fromDice, toDice) => {\n      if (!currentTarget || currentTarget === '') return '';\n      const val = parseInt(currentTarget, 10);\n      if (isNaN(val)) return currentTarget;\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n\n      const fromMax = getMaxRoll(fromDice);\n      const toMax = getMaxRoll(toDice);\n\n      // \n      const ratio = val / fromMax;\n      const newVal = Math.round(ratio * toMax);\n      return Math.max(1, Math.min(newVal, toMax));\n    };\n\n    // []  UICOC/DND \n    const updateRuleMode = () => {\n      const criteria = panel.find('#dice-success-criteria').val();\n      const isDND = criteria === 'gte';\n      const $targetInput = panel.find('#dice-target');\n      const $difficultyWrapper = panel.find('#dice-difficulty-wrapper');\n      const $row3 = panel.find('#dice-row-3');\n\n      if (isDND) {\n        // DND \n        $targetInput.attr('placeholder', '=20-');\n        panel.find('#dice-target-label').text('DC');\n        $difficultyWrapper.hide();\n        $row3.css('grid-template-columns', '1fr 1fr');\n      } else {\n        // COC \n        $targetInput.attr('placeholder', '=');\n        panel.find('#dice-target-label').text('');\n        $difficultyWrapper.show();\n        $row3.css('grid-template-columns', '1fr 1fr 1fr');\n      }\n    };\n\n    panel.find('#dice-success-criteria').on('change', updateRuleMode);\n\n    // \n    updateRuleMode();\n\n    // \n    let currentDiceType = diceType;\n\n    //  - [] \n    panel.find('.acu-dice-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-dice-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n      const suggestedCriteria = $(this).data('criteria') || 'lte';\n\n      // [] \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, newDice);\n        $targetInput.val(convertedVal);\n      }\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n      const newMax = getMaxRoll(newDice);\n      panel.find('#dice-target-auto').text(`(: 1~${newMax})`);\n\n      currentDiceType = newDice;\n      panel.find('#dice-formula').val(newDice);\n\n      // [] \n      panel.find('#dice-success-criteria').val(suggestedCriteria).trigger('change');\n    });\n    // \n    panel.find('.acu-dice-custom-btn').click(function () {\n      // \n      panel.find('.acu-dice-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      const customDice = panel.find('#dice-custom-input').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#dice-custom-input').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      // \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, customDice);\n        $targetInput.val(convertedVal);\n      }\n\n      panel.find('#dice-formula').val(customDice);\n      currentDiceType = customDice;\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n\n      panel.find('#dice-success-criteria').val('gte').trigger('change');\n    });\n\n    // \n    panel.find('#dice-custom-input').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-dice-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = formula => {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], formula };\n\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      const total = rolls.reduce((a, b) => a + b, 0) + modifier;\n\n      return { total, rolls, sides, count, modifier, formula };\n    };\n\n    // 1d6, 1d6+2\n    const parseModifier = function (modStr) {\n      if (!modStr || modStr.trim() === '') return 0;\n      const trimmed = modStr.trim();\n\n      // \n      const numValue = parseFloat(trimmed);\n      if (!isNaN(numValue) && isFinite(numValue) && trimmed.match(/^-?\\d+(\\.\\d+)?$/)) {\n        return numValue;\n      }\n\n      // \n      // 1d6, 2d10, 1d6+2, 1d6-2, 2d6+1d4\n      let result = 0;\n      let remaining = trimmed;\n\n      // 1d6, 2d10\n      const dicePattern = /(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi;\n      let match;\n      while ((match = dicePattern.exec(remaining)) !== null) {\n        const diceResult = rollDiceExpression(match[0]);\n        if (!isNaN(diceResult)) {\n          result += diceResult;\n        }\n        remaining = remaining.replace(match[0], '');\n      }\n\n      // \n      const numberPattern = /([+-]?\\d+(\\.\\d+)?)/g;\n      let numMatch;\n      while ((numMatch = numberPattern.exec(remaining)) !== null) {\n        const num = parseFloat(numMatch[0]);\n        if (!isNaN(num) && isFinite(num)) {\n          result += num;\n        }\n      }\n\n      return result;\n    };\n\n    // \n    const performDiceRoll = function () {\n      const formula = panel.find('#dice-formula').val().trim() || '1d100';\n      const modStr = panel.find('#dice-modifier').val().trim() || '0';\n      const mod = parseModifier(modStr);\n      const attrName = panel.find('#dice-attr-name').val().trim() || '';\n      const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n      const difficulty = panel.find('#dice-difficulty').val() || 'normal';\n\n      // \n      const isDND = criteria === 'gte';\n\n      // \n      const diceCfg = getDiceConfig();\n      const hardDiv = diceCfg.difficultSuccessDiv || 2;\n      const extremeDiv = diceCfg.hardSuccessDiv || 5;\n      // COC:   critSuccessMax,   critFailMin\n      // DND:   dndCritSuccess,   dndCritFail\n      const critSuccessMax = isDND ? diceCfg.dndCritFail || 1 : diceCfg.critSuccessMax || 5;\n      const critFailMin = isDND ? diceCfg.dndCritSuccess || 20 : diceCfg.critFailMin || 96;\n\n      // COC  DND \n      let targetInputVal = panel.find('#dice-target').val().trim();\n      let attrInputVal = panel.find('#dice-attr-value').val().trim();\n      let attrValue = attrInputVal !== '' ? parseInt(attrInputVal, 10) : 0;\n      let target;\n      let isAutoTarget = false;\n\n      // \n      const getDefaultTarget = formulaStr => {\n        const match = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (match) {\n          const maxRoll = parseInt(match[1], 10) * parseInt(match[2], 10);\n          return Math.round(maxRoll / 2);\n        }\n        return 50;\n      };\n\n      if (targetInputVal !== '') {\n        // /DC\n        target = parseInt(targetInputVal, 10) || getDefaultTarget(formula);\n      } else if (isDND) {\n        // DND  DC = 20 - DC=10\n        if (attrValue > 0) {\n          target = 20 - attrValue;\n          isAutoTarget = true;\n        } else {\n          target = 10; // \n          isAutoTarget = true;\n        }\n      } else {\n        // COC  = \n        if (attrValue > 0) {\n          target = attrValue;\n          isAutoTarget = true;\n        } else {\n          target = getDefaultTarget(formula);\n          isAutoTarget = true;\n        }\n      }\n\n      const result = rollDice(formula);\n      const finalValue = result.total + mod;\n\n      // \n      let requiredTarget = target;\n      let difficultyLabel = '';\n      let difficultyDiv = 1;\n\n      // DND \n      if (!isDND) {\n        switch (difficulty) {\n          case 'hard':\n            requiredTarget = Math.floor(target / hardDiv);\n            difficultyLabel = '';\n            difficultyDiv = hardDiv;\n            break;\n          case 'extreme':\n            requiredTarget = Math.floor(target / extremeDiv);\n            difficultyLabel = '';\n            difficultyDiv = extremeDiv;\n            break;\n          case 'critical':\n            requiredTarget = critSuccessMax;\n            difficultyLabel = '';\n            break;\n          default:\n            difficultyLabel = '';\n            break;\n        }\n      }\n\n      // \n      let isCritSuccess = false;\n      let isCritFailure = false;\n      let isSuccess = false;\n      let outcomeText = '';\n      let outcomeClass = '';\n\n      // /\n      if (isDND) {\n        // DND:   20  1\n        isCritSuccess = finalValue >= critFailMin; //  critFailMin  DND \n        isCritFailure = finalValue <= critSuccessMax; //  critSuccessMax  DND \n      } else {\n        // COC:   5  96\n        isCritSuccess = finalValue <= critSuccessMax;\n        isCritFailure = finalValue >= critFailMin;\n      }\n\n      // /\n      if (isDND) {\n        isSuccess = finalValue >= requiredTarget;\n      } else {\n        isSuccess = finalValue <= requiredTarget;\n      }\n\n      // \n      if (isCritSuccess) {\n        outcomeText = '';\n        outcomeClass = 'success';\n        isSuccess = true;\n      } else if (isCritFailure) {\n        outcomeText = '';\n        outcomeClass = 'failure';\n        isSuccess = false;\n      } else if (isSuccess) {\n        if (isDND) {\n          outcomeText = '';\n        } else if (difficulty === 'hard') {\n          outcomeText = '';\n        } else if (difficulty === 'extreme') {\n          outcomeText = '';\n        } else {\n          // \n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            outcomeText = '';\n          } else if (finalValue <= hardTarget) {\n            outcomeText = '';\n          } else {\n            outcomeText = '';\n          }\n        }\n        outcomeClass = 'success';\n      } else {\n        outcomeText = '';\n        outcomeClass = 'failure';\n      }\n\n      const criteriaSymbol = isDND ? '' : '';\n      const hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      const displayValue = hideDiceResultFromUser ? '' : finalValue;\n      const displayOutcomeText = hideDiceResultFromUser ? '' : outcomeText;\n\n      // \n      let resultType;\n      if (isCritSuccess) {\n        resultType = 'critSuccess';\n      } else if (isCritFailure) {\n        resultType = 'critFailure';\n      } else if (isSuccess) {\n        if (difficulty === 'extreme' || (difficulty === 'normal' && finalValue <= Math.floor(target / extremeDiv))) {\n          resultType = 'extremeSuccess';\n        } else if (difficulty === 'hard' || (difficulty === 'normal' && finalValue <= Math.floor(target / hardDiv))) {\n          resultType = 'success';\n        } else {\n          resultType = 'warning';\n        }\n      } else {\n        resultType = 'failure';\n      }\n\n      const badgeStyle = getResultBadgeStyle(resultType, t);\n      const badgeStyleStr = Object.entries(badgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n\n      // \n      const $rollBtn = panel.find('#dice-roll-btn');\n      $rollBtn.html(`\n        <div style=\"display:flex; align-items:center; justify-content:center; width:100%; gap:8px;\">\n          <span style=\"font-size:22px; font-weight:bold; color:${t.buttonText};\">${displayValue}</span>\n          <span style=\"font-size:11px; color:${t.buttonText}; opacity:0.9;\">${criteriaSymbol}${requiredTarget}${difficultyLabel ? '(' + difficultyLabel + ')' : ''}</span>\n          ${displayOutcomeText ? `<span style=\"${badgeStyleStr}\">${displayOutcomeText}</span>` : ''}\n          <button class=\"dice-retry-btn\" style=\"background:transparent; border:none; color:${t.buttonText}; cursor:pointer; padding:4px; display:flex; align-items:center; justify-content:center; opacity:0.8; transition:opacity 0.2s;\" title=\"\">\n            <i class=\"fa-solid fa-rotate-right\"></i>\n          </button>\n        </div>\n      `);\n\n      // \n      $rollBtn.off('click', '.dice-retry-btn').on('click', '.dice-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        // \n        performDiceRoll();\n      });\n\n      //  Prompt \n      const initiatorName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      let judgeExpr = '';\n\n      if (isCritSuccess) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        } else {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        }\n      } else if (isCritFailure) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        } else {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        }\n      } else if (isDND) {\n        // DND \n        if (isSuccess) {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}<${requiredTarget}`;\n        }\n      } else if (difficulty === 'critical') {\n        // COC \n        judgeExpr = `${critSuccessMax}${finalValue}>${critSuccessMax}`;\n      } else if (difficulty !== 'normal') {\n        // COC \n        if (isSuccess) {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}>${requiredTarget}`;\n        }\n      } else {\n        // COC \n        if (isSuccess) {\n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${extremeDiv}`;\n          } else if (finalValue <= hardTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${hardDiv}`;\n          } else {\n            judgeExpr = `${target}${finalValue}${target}`;\n          }\n        } else {\n          judgeExpr = `${target}${finalValue}>${target}`;\n        }\n      }\n\n      const diceResultText = `${initiatorName}${attrName}${finalValue}${judgeExpr}${outcomeText}`;\n      smartInsertToTextarea(diceResultText, 'dice');\n      if (onResult) {\n        onResult({\n          success: isSuccess,\n          total: finalValue,\n          target,\n          outcomeText,\n          attrName,\n          criteria,\n          isAutoTarget,\n          formula: formulaText,\n        });\n      }\n    };\n\n    // \n    panel.find('#dice-roll-btn').click(function () {\n      performDiceRoll();\n    });\n\n    // \n    panel.find('#dice-switch-contest-top').click(function () {\n      const targetInput = panel.find('#dice-target').val().trim();\n      const attrValueInput = panel.find('#dice-attr-value').val().trim();\n      const currentDice = panel.find('#dice-formula').val() || '1d100';\n      const initiatorNameVal = panel.find('#dice-initiator-name').val().trim();\n      closePanel();\n      showContestPanel({\n        //  placeholder \n        initiatorName: initiatorNameVal && initiatorNameVal !== '<user>' ? initiatorNameVal : '',\n        initiatorValue: attrValueInput !== '' ? parseInt(attrValueInput, 10) : undefined,\n        diceType: currentDice,\n      });\n    });\n    // \n    const closePanel = () => {\n      overlay.remove();\n      panel.remove();\n    };\n    overlay.click(closePanel);\n    panel.find('.acu-dice-close').click(closePanel);\n    //  - \n    panel.find('.acu-dice-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentCriteria = panel.find('#dice-success-criteria').val();\n      const isDND = currentCriteria === 'gte';\n      showDiceSettingsPanel(isDND);\n    });\n  };\n\n  // [] \n  const showContestPanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay, .acu-contest-panel, .acu-contest-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    // \n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n\n    // \n    const opponentName = options.opponentName || '';\n    const diceType = options.diceType || savedDiceType;\n    const passedInitiatorName = options.initiatorName || '';\n    const passedInitiatorValue = options.initiatorValue;\n    const passedOpponentValue = options.opponentValue;\n\n    const rawData = cachedRawData || getTableData();\n    let playerAttrs = [];\n    let opponentAttrs = [];\n\n    // [] <user> + \n    let characterList = ['<user>'];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) characterList.push(row[1]);\n          }\n          break;\n        }\n      }\n    }\n    // [] \n    let contestAttrList = [];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content && sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!contestAttrList.includes(attr.name)) contestAttrList.push(attr.name);\n              });\n            }\n          });\n          break;\n        }\n      }\n    }\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const attrStr = sheet.content[1][7] || '';\n          playerAttrs = parseAttributeString(attrStr);\n        }\n\n        if (sheet.name === '' && opponentName) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1] === opponentName) {\n              const attrStr = row[9] || '';\n              opponentAttrs = parseAttributeString(attrStr);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    const t = getThemeColors();\n    const isCyberTheme = getConfig().theme === 'cyber';\n    const inputTextColor = isCyberTheme ? '#ff00ff' : t.inputText;\n    // \n    const inputStyle = `width:100%;padding:5px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:4px;color:${inputTextColor} !important;font-size:12px;text-align:center;box-sizing:border-box;`;\n\n    const buildAttrButtons = (attrs, targetType) => {\n      let html = '';\n      // \n      for (let i = 0; i < attrs.length; i++) {\n        const attr = attrs[i];\n        html +=\n          '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n          attr.value +\n          '\" data-aname=\"' +\n          escapeHtml(attr.name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" style=\"padding:3px 8px;background:' +\n          t.inputBg +\n          ';border:1px solid ' +\n          t.border +\n          ';border-radius:4px;color:' +\n          t.inputText +\n          ';font-size:11px;cursor:pointer;margin:2px;\">' +\n          escapeHtml(attr.name) +\n          ': ' +\n          attr.value +\n          '</button>';\n      }\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.accent +\n        ';border-radius:3px;color:' +\n        t.accent +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin:2px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.errorText +\n        ';border-radius:3px;color:' +\n        t.errorText +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin:2px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\" style=\"font-size:9px;\"></i></button>';\n      return html;\n    };\n\n    const overlay = $(\n      '<div class=\"acu-contest-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:' +\n        t.overlayBg +\n        ';z-index:2147483647;\"></div>',\n    );\n    const panelHtml =\n      '<div class=\"acu-contest-panel acu-theme-' +\n      config.theme +\n      '\" style=\"position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:360px;max-width:92vw;background:' +\n      t.bgPanel +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:12px;box-shadow:0 20px 60px ' +\n      t.shadowBg +\n      ';z-index:2147483648;overflow:hidden;\">' +\n      '<div style=\"padding:12px 15px;background:' +\n      t.tableHead +\n      ';border-bottom:1px solid ' +\n      t.border +\n      ';display:flex;justify-content:space-between;align-items:center;\">' +\n      '<div style=\"font-size:15px;font-weight:bold;color:' +\n      t.accent +\n      ';display:flex;align-items:center;gap:8px;\"><i class=\"fa-solid fa-people-arrows\"></i> </div>' +\n      '<div style=\"display:flex;align-items:center;gap:8px;\">' +\n      '<button id=\"contest-switch-normal\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:14px;padding:4px;transition:all 0.2s;\" title=\"\"><i class=\"fa-solid fa-dice-d20\"></i></button>' +\n      '<button class=\"acu-contest-config-btn\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:14px;padding:4px;transition:all 0.2s;\" title=\"\"><i class=\"fa-solid fa-cog\"></i></button>' +\n      '<button class=\"acu-contest-close\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>' +\n      '</div>' +\n      '</div>' +\n      '<div style=\"padding:15px;max-height:70vh;overflow-y:auto;\">' +\n      '<div style=\"display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;align-items:center;\">' +\n      '<button class=\"acu-contest-preset' +\n      (diceType === '1d20' ? ' active' : '') +\n      '\" data-dice=\"1d20\" style=\"padding:4px 10px;background:' +\n      (diceType === '1d20' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (diceType === '1d20' ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\">1d20</button>' +\n      '<button class=\"acu-contest-preset' +\n      (diceType === '1d100' ? ' active' : '') +\n      '\" data-dice=\"1d100\" style=\"padding:4px 10px;background:' +\n      (diceType === '1d100' ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (diceType === '1d100' ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\">1d100</button>' +\n      '<button class=\"acu-contest-preset acu-contest-custom-btn\" data-dice=\"custom\" style=\"padding:4px 10px;background:' +\n      (!['1d20', '1d100'].includes(diceType) ? t.presetButtonBgActive || t.accent : t.presetButtonBg || t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (!['1d20', '1d100'].includes(diceType) ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\"></button>' +\n      '<input type=\"text\" id=\"contest-custom-dice\" placeholder=\"2d6\" value=\"' +\n      (!['1d20', '1d100'].includes(diceType) ? diceType : '') +\n      '\" style=\"width:60px;padding:4px 6px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      inputTextColor +\n      ' !important;font-size:11px;text-align:center;box-sizing:border-box;\" />' +\n      '</div>' +\n      '<input type=\"hidden\" id=\"contest-dice-type\" value=\"' +\n      diceType +\n      '\">' +\n      '<div style=\"font-size:11px;color:' +\n      t.accent +\n      ';font-weight:bold;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-init-char-buttons\" style=\"display:flex;flex-wrap:wrap;gap:3px;\"></div></div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-display\" value=\"\" placeholder=\"<user>\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;gap:6px;\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-init-random-skill\" title=\"\" style=\"width:18px;height:18px;padding:0;background:transparent;border:1px dashed ' +\n      t.accent +\n      ';border-radius:4px;color:' +\n      t.accent +\n      ';font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" id=\"contest-init-name\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-value\" value=\"' +\n      (passedInitiatorValue !== undefined ? passedInitiatorValue : '') +\n      '\" placeholder=\"=50%\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-init-target\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div id=\"init-attr-buttons\" style=\"display:flex;flex-wrap:wrap;gap:2px;margin-bottom:8px;max-height:50px;overflow-y:auto;\">' +\n      buildAttrButtons(playerAttrs, 'init') +\n      '</div>' +\n      '<div style=\"font-size:11px;color:' +\n      t.accent +\n      ';font-weight:bold;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-opp-char-buttons\" style=\"display:flex;flex-wrap:wrap;gap:3px;\"></div></div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opponent-display\" value=\"' +\n      escapeHtml(opponentName) +\n      '\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;gap:6px;\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-opp-random-skill\" title=\"\" style=\"width:18px;height:18px;padding:0;background:transparent;border:1px dashed ' +\n      t.accent +\n      ';border-radius:4px;color:' +\n      t.accent +\n      ';font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" id=\"contest-opp-name\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opp-value\" value=\"' +\n      (passedOpponentValue !== undefined ? passedOpponentValue : '') +\n      '\" placeholder=\"=50%\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;min-height:18px;display:flex;align-items:center;\"></div><input type=\"text\" id=\"contest-opp-target\" value=\"\" placeholder=\"\" style=\"' +\n      inputStyle +\n      '\"></div>' +\n      '</div>' +\n      '<div id=\"opp-attr-buttons\" style=\"display:flex;flex-wrap:wrap;gap:2px;margin-bottom:10px;max-height:50px;overflow-y:auto;\">' +\n      buildAttrButtons(opponentAttrs, 'opp') +\n      '</div>' +\n      '<div id=\"contest-result-display\" style=\"display:none;margin-bottom:10px;padding:8px;background:' +\n      t.inputBg +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:6px;\">' +\n      '<div style=\"display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap;width:100%;\">' +\n      '<div id=\"contest-result-init\" style=\"display:flex;align-items:center;gap:4px;min-width:0;flex:1;\"></div>' +\n      '<span style=\"color:' +\n      t.textSub +\n      ';opacity:0.9;font-size:11px;font-weight:bold;white-space:nowrap;\">VS</span>' +\n      '<div id=\"contest-result-opp\" style=\"display:flex;align-items:center;gap:4px;min-width:0;flex:1;justify-content:flex-end;\"></div>' +\n      '</div>' +\n      '</div>' +\n      '<button id=\"contest-roll-btn\" style=\"width:100%;padding:12px;background:' +\n      (t.buttonBg || t.accent) +\n      ';border:none;border-radius:8px;color:' +\n      t.buttonText +\n      ';font-size:15px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;position:relative;\"><i class=\"fa-solid fa-dice\"></i> </button>' +\n      '</div>' +\n      '</div>';\n\n    const panel = $(panelHtml);\n    $('body').append(overlay).append(panel);\n\n    // []  - \n    const buildCharBtns = targetType => {\n      const containerId = targetType === 'init' ? '#contest-init-char-buttons' : '#contest-opp-char-buttons';\n      const $container = panel.find(containerId);\n      let html = '';\n      characterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html +=\n          '<button class=\"acu-contest-char-btn\" data-char=\"' +\n          escapeHtml(name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" style=\"padding:3px 8px;background:' +\n          t.btnBg +\n          ';border:1px solid ' +\n          t.border +\n          ';border-radius:4px;color:' +\n          t.textMain +\n          ';font-size:11px;cursor:pointer;white-space:nowrap;\" title=\"' +\n          escapeHtml(displayName) +\n          '\">' +\n          escapeHtml(shortName) +\n          '</button>';\n      });\n      $container.html(html);\n      $container.find('.acu-contest-char-btn').click(function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const charName = $(this).data('char');\n        const type = $(this).data('type');\n        if (type === 'init') {\n          panel.find('#contest-init-display').val(charName).trigger('change');\n        } else {\n          panel.find('#contest-opponent-display').val(charName).trigger('change');\n        }\n      });\n    };\n\n    // [] \n    const rebuildAttrBtns = (attrs, targetType) => {\n      const containerId = targetType === 'init' ? '#init-attr-buttons' : '#opp-attr-buttons';\n      const $container = panel.find(containerId);\n\n      // \n      $container.show();\n\n      let html = '';\n\n      // \n      if (attrs.length > 0) {\n        attrs.forEach(attr => {\n          html +=\n            '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n            attr.value +\n            '\" data-aname=\"' +\n            escapeHtml(attr.name) +\n            '\" data-type=\"' +\n            targetType +\n            '\" style=\"padding:2px 6px;background:' +\n            t.inputBg +\n            ';border:1px solid ' +\n            t.border +\n            ';border-radius:3px;color:' +\n            t.inputText +\n            ';font-size:10px;cursor:pointer;\">' +\n            escapeHtml(attr.name) +\n            ':' +\n            attr.value +\n            '</button>';\n        });\n      }\n\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.accent +\n        ';border-radius:3px;color:' +\n        t.accent +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>';\n\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.errorText +\n        ';border-radius:3px;color:' +\n        t.errorText +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin-left:4px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\" style=\"font-size:9px;\"></i></button>';\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-contest-attr-btn').click(function () {\n        const val = $(this).attr('data-val');\n        const aname = $(this).attr('data-aname');\n        const type = $(this).attr('data-type');\n        if (type === 'init') {\n          panel.find('#contest-init-value').val(val);\n          panel.find('#contest-init-name').val(aname);\n        } else {\n          panel.find('#contest-opp-value').val(val);\n          panel.find('#contest-opp-name').val(aname);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          // \n          let charName;\n          if (type === 'init') {\n            charName = panel.find('#contest-init-display').val().trim() || '<user>';\n          } else {\n            charName = panel.find('#contest-opponent-display').val().trim();\n          }\n\n          if (!charName) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        let charName;\n        if (type === 'init') {\n          charName = panel.find('#contest-init-display').val().trim() || '<user>';\n        } else {\n          charName = panel.find('#contest-opponent-display').val().trim();\n        }\n\n        if (!charName) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[DICE]ACU ');\n        };\n\n        try {\n          console.log('[DICE]ACU  for:', charName, 'type:', type);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharBtns('init');\n    buildCharBtns('opp');\n    // [] \n    panel.find('#contest-init-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-init-name').val(randomSkill).trigger('change');\n    });\n\n    // [] \n    panel.find('#contest-opp-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-opp-name').val(randomSkill).trigger('change');\n    });\n    //  rebuildAttrBtns /\n    const initAttrs = getFullAttributesForCharacter(passedInitiatorName || '<user>');\n    rebuildAttrBtns(initAttrs, 'init');\n    const oppAttrs = getFullAttributesForCharacter(opponentName || '');\n    rebuildAttrBtns(oppAttrs, 'opp');\n\n    // \n    initCustomDropdown(panel.find('#contest-init-display'), characterList, t);\n    initCustomDropdown(panel.find('#contest-opponent-display'), characterList, t);\n    initCustomDropdown(panel.find('#contest-init-name'), contestAttrList, t);\n    initCustomDropdown(panel.find('#contest-opp-name'), contestAttrList, t);\n    addClearButton(\n      panel,\n      '#contest-init-display, #contest-init-name, #contest-init-value, #contest-init-target, #contest-opponent-display, #contest-opp-name, #contest-opp-value, #contest-opp-target',\n      t,\n    );\n\n    // \n    panel.find('#contest-init-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-init-name'), newAttrList.length > 0 ? newAttrList : contestAttrList, t);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'init');\n    });\n\n    // \n    panel.find('#contest-opponent-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim();\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-opp-name'), newAttrList.length > 0 ? newAttrList : contestAttrList, t);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'opp');\n    });\n\n    // \n    panel.find('#contest-init-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-init-display').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-init-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('#contest-opp-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-opponent-display').val().trim();\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-opp-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('.acu-contest-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-contest-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n      panel.find('#contest-dice-type').val(newDice);\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n    });\n\n    // \n    panel.find('.acu-contest-custom-btn').click(function () {\n      // \n      panel.find('.acu-contest-preset').css({ background: t.presetButtonBg || t.btnBg, color: t.textMain });\n      $(this).css({ background: t.presetButtonBgActive || t.accent, color: t.buttonText });\n\n      var customDice = panel.find('#contest-custom-dice').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#contest-custom-dice').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      panel.find('#contest-dice-type').val(customDice);\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n    });\n\n    // \n    panel.find('#contest-custom-dice').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-contest-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = function (formula) {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], sides: 100 };\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      return {\n        total:\n          rolls.reduce(function (a, b) {\n            return a + b;\n          }, 0) + modifier,\n        rolls: rolls,\n        sides: sides,\n      };\n    };\n\n    const getSuccessLevel = function (roll, target, sides) {\n      const t = getThemeColors();\n      if (sides === 100) {\n        if (roll <= 5) return { level: 3, name: '', color: t.critSuccessText };\n        if (roll >= 96) return { level: -1, name: '', color: t.critFailureText };\n        if (roll <= Math.floor(target / 5)) return { level: 2, name: '', color: t.extremeSuccessText };\n        if (roll <= Math.floor(target / 2)) return { level: 1, name: '', color: t.successText };\n        if (roll <= target) return { level: 0, name: '', color: t.warningText };\n        return { level: -1, name: '', color: t.failureText };\n      } else {\n        if (roll === 20) return { level: 3, name: '', color: t.critSuccessText };\n        if (roll === 1) return { level: -1, name: '', color: t.critFailureText };\n        if (roll >= target) return { level: 0, name: '', color: t.successText };\n        return { level: -1, name: '', color: t.failureText };\n      }\n    };\n\n    // \n    const performContestRoll = function () {\n      var formula = panel.find('#contest-dice-type').val() || '1d100';\n\n      var initName = panel.find('#contest-init-display').val().trim() || '<user>';\n      var initAttrName = panel.find('#contest-init-name').val().trim() || '';\n      // \n      var getHalfMax = function (formulaStr) {\n        var m = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (m) return Math.round((parseInt(m[1], 10) * parseInt(m[2], 10)) / 2);\n        return 50;\n      };\n\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var initValue;\n      if (initValueInput === '') {\n        // \n        initValue = getHalfMax(formula);\n      } else {\n        initValue = parseInt(initValueInput, 10) || getHalfMax(formula);\n      }\n      var initTargetInput = panel.find('#contest-init-target').val().trim();\n      var initTarget;\n      if (initTargetInput !== '') {\n        initTarget = parseInt(initTargetInput, 10);\n      } else {\n        // \n        initTarget = initValue;\n      }\n\n      var oppName = panel.find('#contest-opponent-display').val().trim() || '';\n      var oppAttrName = panel.find('#contest-opp-name').val().trim() || initAttrName;\n      var oppValueInput = panel.find('#contest-opp-value').val().trim();\n      var oppValue;\n      if (oppValueInput === '') {\n        // \n        oppValue = getHalfMax(formula);\n      } else {\n        oppValue = parseInt(oppValueInput, 10) || getHalfMax(formula);\n      }\n      var oppTargetInput = panel.find('#contest-opp-target').val().trim();\n      var oppTarget;\n      if (oppTargetInput !== '') {\n        oppTarget = parseInt(oppTargetInput, 10);\n      } else {\n        // \n        oppTarget = oppValue;\n      }\n\n      var initResult = rollDice(formula);\n      var oppResult = rollDice(formula);\n      var initSuccess = getSuccessLevel(initResult.total, initTarget, initResult.sides);\n      var oppSuccess = getSuccessLevel(oppResult.total, oppTarget, oppResult.sides);\n\n      var winner, winnerColor, resultDesc;\n      var diceCfg = getDiceConfig();\n      var tieRule = diceCfg.contestTieRule || 'initiator_lose';\n      var hideDiceResultFromUser =\n        diceCfg.hideDiceResultFromUser !== undefined ? diceCfg.hideDiceResultFromUser : false;\n      var displayInitValue = hideDiceResultFromUser ? '' : initResult.total;\n      var displayOppValue = hideDiceResultFromUser ? '' : oppResult.total;\n      var displayInitSuccessName = hideDiceResultFromUser ? '' : initSuccess.name;\n      var displayOppSuccessName = hideDiceResultFromUser ? '' : oppSuccess.name;\n\n      if (initSuccess.level > oppSuccess.level) {\n        winner = initName + ' ';\n        winnerColor = t.successText;\n        resultDesc = initSuccess.name + '  ' + oppSuccess.name;\n      } else if (initSuccess.level < oppSuccess.level) {\n        winner = oppName + ' ';\n        winnerColor = t.failureText;\n        resultDesc = oppSuccess.name + '  ' + initSuccess.name;\n      } else {\n        // \n        resultDesc = ' ' + initSuccess.name;\n        if (tieRule === 'initiator_win') {\n          winner = '' + initName + ' ';\n          winnerColor = t.successText;\n        } else if (tieRule === 'tie') {\n          winner = '';\n          winnerColor = t.warningText;\n        } else {\n          // : initiator_lose\n          winner = '' + initName + ' ';\n          winnerColor = t.failureText;\n        }\n      }\n\n      var displayWinner = hideDiceResultFromUser ? '' : winner;\n\n      // \n      const getResultTypeFromSuccess = success => {\n        if (success.level === 3) return 'critSuccess';\n        if (success.level === 2) return 'extremeSuccess';\n        if (success.level === 1) return 'success';\n        if (success.level === 0) return 'warning';\n        if (success.level === -1) {\n          // name\n          return success.name === '' ? 'critFailure' : 'failure';\n        }\n        return 'failure';\n      };\n      const initResultType = getResultTypeFromSuccess(initSuccess);\n      const oppResultType = getResultTypeFromSuccess(oppSuccess);\n\n      const initBadgeStyle = getResultBadgeStyle(initResultType, t);\n      const oppBadgeStyle = getResultBadgeStyle(oppResultType, t);\n      const winnerBadgeStyle = getResultBadgeStyle(\n        winnerColor === t.successText ? 'success' : winnerColor === t.warningText ? 'warning' : 'failure',\n        t,\n      );\n\n      const initBadgeStyleStr = Object.entries(initBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n      const oppBadgeStyleStr = Object.entries(oppBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n      const winnerBadgeStyleStr = Object.entries(winnerBadgeStyle)\n        .map(([k, v]) => `${k}:${v}`)\n        .join(';');\n\n      // \n      const $resultDisplay = panel.find('#contest-result-display');\n      const $resultInit = panel.find('#contest-result-init');\n      const $resultOpp = panel.find('#contest-result-opp');\n\n      // \n      $resultInit.html(\n        '<span style=\"font-size:11px;color:' +\n          t.textMain +\n          ';opacity:0.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;\">' +\n          escapeHtml(initName) +\n          '</span>' +\n          '<span style=\"font-size:16px;font-weight:bold;color:' +\n          t.textMain +\n          ';\">' +\n          displayInitValue +\n          '</span>' +\n          (displayInitSuccessName\n            ? '<span style=\"' + initBadgeStyleStr + '\">' + displayInitSuccessName + '</span>'\n            : ''),\n      );\n\n      // \n      $resultOpp.html(\n        (displayOppSuccessName ? '<span style=\"' + oppBadgeStyleStr + '\">' + displayOppSuccessName + '</span>' : '') +\n          '<span style=\"font-size:16px;font-weight:bold;color:' +\n          t.textMain +\n          ';\">' +\n          displayOppValue +\n          '</span>' +\n          '<span style=\"font-size:11px;color:' +\n          t.textMain +\n          ';opacity:0.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;\">' +\n          escapeHtml(oppName) +\n          '</span>',\n      );\n\n      $resultDisplay.show();\n\n      // \n      const $contestBtn = panel.find('#contest-roll-btn');\n      $contestBtn.html(\n        '<div style=\"display:flex; align-items:center; justify-content:center; width:100%; gap:8px;\">' +\n          (displayWinner ? '<span style=\"' + winnerBadgeStyleStr + '\">' + displayWinner + '</span>' : '') +\n          '<button class=\"contest-retry-btn\" style=\"background:transparent; border:none; color:' +\n          t.buttonText +\n          '; cursor:pointer; padding:4px; display:flex; align-items:center; justify-content:center; opacity:0.8; transition:opacity 0.2s;\" title=\"\">' +\n          '<i class=\"fa-solid fa-rotate-right\"></i>' +\n          '</button>' +\n          '</div>',\n      );\n\n      // \n      $contestBtn.off('click', '.contest-retry-btn').on('click', '.contest-retry-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        // \n        performContestRoll();\n      });\n\n      const contestResultText =\n        `${initName} ${initAttrName} vs ${oppName} ${oppAttrName}` +\n        `${initName} ${initAttrName} (${initTarget})  ${initResult.total}${initSuccess.name}` +\n        `${oppName} ${oppAttrName} (${oppTarget})  ${oppResult.total}${oppSuccess.name}` +\n        `${winner}`;\n      smartInsertToTextarea(contestResultText, 'dice');\n    };\n\n    // \n    panel.find('#contest-roll-btn').click(function () {\n      performContestRoll();\n    });\n\n    // [] \n    panel.find('#contest-switch-normal').click(function () {\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var currentInitName = panel.find('#contest-init-name').val() || '';\n      var currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      var initiatorNameVal = panel.find('#contest-init-display').val().trim();\n      closePanel();\n      showDicePanel({\n        //  null  placeholder\n        targetValue: initValueInput !== '' ? parseInt(initValueInput, 10) : null,\n        targetName: currentInitName,\n        diceType: currentDice,\n        initiatorName: initiatorNameVal,\n      });\n    });\n    //  - \n    // 1d20 -> DND,  -> COC\n    panel.find('.acu-contest-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      const isDND = currentDice === '1d20';\n      showDiceSettingsPanel(isDND);\n    });\n    var closePanel = function () {\n      overlay.remove();\n      panel.remove();\n    };\n    overlay.click(closePanel);\n    panel.find('.acu-contest-close').click(closePanel);\n  };\n\n  const parseInSceneStatus = (value, headerName) => {\n    const val = String(value || '')\n      .trim()\n      .toLowerCase();\n    const header = String(headerName || '').toLowerCase();\n    if (!val) return false;\n\n    if (header.includes('')) {\n      return val === '' || val === 'false' || val === 'no';\n    }\n\n    return val.startsWith('') || val === 'true' || val === '' || val === 'yes';\n  };\n\n  const buildMapViewModel = async () => {\n    const rawData = cachedRawData || getTableData();\n    const allTables = processJsonData(rawData || {});\n    if (!rawData || Object.keys(allTables).length === 0) return null;\n\n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const elementResult = (() => {\n      const keywords = ['', '', '', '', ''];\n      for (const tableName in allTables) {\n        if (keywords.some(keyword => tableName.includes(keyword))) {\n          return {\n            data: allTables[tableName],\n            name: tableName,\n            key: allTables[tableName].key,\n          };\n        }\n      }\n      return null;\n    })();\n\n    const globalHeaders = globalResult?.data?.headers || [];\n    const globalRows = globalResult?.data?.rows || [];\n    const globalRow = globalRows[0] || [];\n    const globalConfig = DASHBOARD_TABLE_CONFIG.global;\n    const detailIdx = DashboardDataParser.findColumnIndex(globalHeaders, 'detailLocation', globalConfig);\n    const regionIdx = DashboardDataParser.findColumnIndex(globalHeaders, 'currentLocation', globalConfig);\n    const detailLocation = detailIdx >= 0 ? String(globalRow[detailIdx] || '').trim() : '';\n    const currentRegion = regionIdx >= 0 ? String(globalRow[regionIdx] || '').trim() : '';\n\n    if (!locationResult?.data) return null;\n\n    const findColumnIndex = (headers, keywords, fallbackIndex = null) => {\n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (keywords.some(keyword => h.includes(keyword.toLowerCase()))) return i;\n      }\n      return fallbackIndex ?? -1;\n    };\n\n    const locations = new Map();\n    const locationHeaders = locationResult.data.headers || [];\n    const locationRows = locationResult.data.rows || [];\n    const locationNameIdx = findColumnIndex(locationHeaders, ['', '', '', '', ''], 1);\n    const locationRegionIdx = findColumnIndex(locationHeaders, ['', '', '', ''], null);\n    const locationTypeIdx = findColumnIndex(locationHeaders, ['', '', ''], null);\n    const locationDescIdx = findColumnIndex(locationHeaders, ['', '', '', '', ''], null);\n    const locationImportanceIdx = findColumnIndex(locationHeaders, ['', ''], null);\n    const locationExploreIdx = findColumnIndex(locationHeaders, ['', '', ''], null);\n\n    // emoji\n    const allLocationNames: string[] = [];\n    locationRows.forEach(row => {\n      const name = String(row[locationNameIdx] || '')\n        .trim()\n        .replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n      if (name) allLocationNames.push(name);\n    });\n    const emojiMap = resolveBatchLocationEmojis(allLocationNames);\n\n    locationRows.forEach((row, idx) => {\n      const name = String(row[locationNameIdx] || '')\n        .trim()\n        .replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n      if (!name) return;\n      const region = locationRegionIdx >= 0 ? String(row[locationRegionIdx] || '').trim() : '';\n\n      const location = {\n        name,\n        region,\n        locationType: locationTypeIdx >= 0 ? row[locationTypeIdx] || '' : '',\n        description: locationDescIdx >= 0 ? row[locationDescIdx] || '' : '',\n        importance: locationImportanceIdx >= 0 ? row[locationImportanceIdx] || '' : '',\n        exploreStatus: locationExploreIdx >= 0 ? row[locationExploreIdx] || '' : '',\n        emoji: emojiMap.get(name) ?? null,\n        tableKey: locationResult.key || '',\n        rowIndex: idx,\n      };\n      locations.set(name, location);\n    });\n\n    const elements = new Map();\n    const addElement = (locationName, element) => {\n      if (!elements.has(locationName)) {\n        elements.set(locationName, []);\n      }\n      elements.get(locationName).push(element);\n    };\n\n    if (elementResult?.data) {\n      const elementHeaders = elementResult.data.headers || [];\n      const elementRows = elementResult.data.rows || [];\n      const elementNameIdx = findColumnIndex(elementHeaders, ['', '', ''], 1);\n      const elementTypeIdx = findColumnIndex(elementHeaders, ['', '', ''], 2);\n      const elementLocationIdx = findColumnIndex(elementHeaders, ['', '', ''], 3);\n      const elementDescIdx = findColumnIndex(elementHeaders, ['', '', ''], null);\n      const elementStatusIdx = findColumnIndex(elementHeaders, ['', ''], null);\n      const elementInteractIdx = findColumnIndex(elementHeaders, ['', '', '', ''], null);\n\n      elementRows.forEach((row, idx) => {\n        const name = String(row[elementNameIdx] || '').trim();\n        if (!name) return;\n        const locationName = String(row[elementLocationIdx] || '').trim();\n        if (!locationName) return;\n        if (currentRegion && locations.size > 0 && !locations.has(locationName)) return;\n\n        const rawInteractions = elementInteractIdx >= 0 ? row[elementInteractIdx] : '';\n        const interactions = String(rawInteractions || '')\n          .split(/[,;]/)\n          .map(item => item.trim())\n          .filter(Boolean);\n        const typeValue = elementTypeIdx >= 0 ? row[elementTypeIdx] || '' : '';\n        const element = {\n          name,\n          type: typeValue,\n          location: locationName,\n          description: elementDescIdx >= 0 ? row[elementDescIdx] || '' : '',\n          status: elementStatusIdx >= 0 ? row[elementStatusIdx] || '' : '',\n          interactions,\n          emoji: getElementEmoji(name, typeValue),\n          tableKey: elementResult.key || '',\n          rowIndex: idx,\n        };\n        addElement(locationName, element);\n      });\n    }\n\n    const characters = new Map();\n    const addCharacter = async character => {\n      const avatarUrl = await AvatarManager.getAsync(character.name);\n      const full = {\n        ...character,\n        avatarUrl,\n        avatarOffsetX: AvatarManager.getOffsetX(character.name),\n        avatarOffsetY: AvatarManager.getOffsetY(character.name),\n        avatarScale: AvatarManager.getScale(character.name),\n      };\n      if (!characters.has(full.location)) {\n        characters.set(full.location, []);\n      }\n      characters.get(full.location).push(full);\n    };\n\n    let playerLocation = '';\n\n    if (playerResult?.data) {\n      const playerConfig = DASHBOARD_TABLE_CONFIG.player;\n      const playerHeaders = playerResult.data.headers || [];\n      const playerRows = playerResult.data.rows || [];\n      const playerRow = playerRows[0] || [];\n      const playerNameIdx = DashboardDataParser.findColumnIndex(playerHeaders, 'name', playerConfig);\n      const playerPosIdx = DashboardDataParser.findColumnIndex(playerHeaders, 'position', playerConfig);\n      const playerNameRaw = playerNameIdx >= 0 ? playerRow[playerNameIdx] : getPlayerName();\n      const playerPosRaw = playerPosIdx >= 0 ? playerRow[playerPosIdx] : '';\n      const playerName = String(playerNameRaw || '').trim();\n      playerLocation = String(playerPosRaw || '').trim();\n\n      if (!playerLocation && detailLocation) {\n        playerLocation = detailLocation;\n      }\n\n      if (playerName && playerLocation) {\n        await addCharacter({\n          name: playerName,\n          location: playerLocation,\n          isPlayer: true,\n          isInScene: true,\n          tableKey: playerResult.key || '',\n          rowIndex: 0,\n        });\n      }\n    }\n\n    if (npcResult?.data) {\n      const npcConfig = DASHBOARD_TABLE_CONFIG.npc;\n      const npcHeaders = npcResult.data.headers || [];\n      const npcRows = npcResult.data.rows || [];\n      const npcNameIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'name', npcConfig);\n      const npcPosIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'position', npcConfig);\n      const npcInSceneIdx = DashboardDataParser.findColumnIndex(npcHeaders, 'inScene', npcConfig);\n\n      for (let idx = 0; idx < npcRows.length; idx++) {\n        const row = npcRows[idx];\n        const npcName = String(row[npcNameIdx] || '').trim();\n        if (!npcName) continue;\n        const locationName = String(row[npcPosIdx] || '').trim();\n        if (!locationName) continue;\n        if (currentRegion && locations.size > 0 && !locations.has(locationName)) continue;\n        const inSceneValue = npcInSceneIdx >= 0 ? row[npcInSceneIdx] : '';\n        const inSceneHeader = npcHeaders[npcInSceneIdx] || '';\n        const isInScene = parseInSceneStatus(inSceneValue, inSceneHeader);\n\n        await addCharacter({\n          name: npcName,\n          location: locationName,\n          isPlayer: false,\n          isInScene,\n          tableKey: npcResult.key || '',\n          rowIndex: idx,\n        });\n      }\n    }\n\n    const locationIterator = locations.values();\n    const firstLocation = locationIterator.next().value;\n\n    const allRegions = [...new Set(Array.from(locations.values()).map(l => l.region || ''))].sort();\n    // \"\"\n    const otherIndex = allRegions.indexOf('');\n    if (otherIndex > -1) {\n      allRegions.splice(otherIndex, 1);\n      allRegions.push('');\n    }\n\n    const getHotLocationsInRegion = region => {\n      const regionName = region || '';\n      return Array.from(locations.values())\n        .filter(l => (l.region || '') === regionName)\n        .sort((a, b) => {\n          const scoreA = (characters.get(a.name)?.length || 0) + (elements.get(a.name)?.length || 0);\n          const scoreB = (characters.get(b.name)?.length || 0) + (elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n    };\n\n    const focusLocation = (() => {\n      if (detailLocation && locations.has(detailLocation)) return detailLocation;\n      if (playerLocation && locations.has(playerLocation)) return playerLocation;\n      const fallbackRegion = allRegions[0];\n      if (fallbackRegion) {\n        const regionLocations = getHotLocationsInRegion(fallbackRegion);\n        if (regionLocations.length > 0) return regionLocations[0].name;\n      }\n      return firstLocation ? firstLocation.name : '';\n    })();\n\n    return {\n      currentRegion: currentRegion || locations.get(playerLocation)?.region || '',\n      detailLocation,\n      focusLocation,\n      playerLocation,\n      locations,\n      elements,\n      characters,\n      allRegions,\n    };\n  };\n\n  // \n  let isMapOpening = false;\n\n  const showMapVisualization = async () => {\n    const { $ } = getCore();\n\n    // \n    if (isMapOpening) return;\n    isMapOpening = true;\n\n    // overlay\n    $('.acu-map-overlay').remove();\n\n    let viewModel = await buildMapViewModel();\n    if (!viewModel) {\n      isMapOpening = false;\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const config = getConfig();\n\n    // \n    const tabSelectionCache = new Map<string, string>();\n\n    // \n    const getHotLocationsInRegion = (region: string) => {\n      const regionName = region || '';\n      return Array.from(viewModel.locations.values())\n        .filter(l => (l.region || '') === regionName)\n        .sort((a, b) => {\n          const scoreA =\n            (viewModel.characters.get(a.name)?.length || 0) + (viewModel.elements.get(a.name)?.length || 0);\n          const scoreB =\n            (viewModel.characters.get(b.name)?.length || 0) + (viewModel.elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n    };\n\n    // \"\"\n    const detailLocation = viewModel.detailLocation || '';\n    const playerLocation = viewModel.playerLocation || '';\n    let focusLocation = '';\n    let selectedRegion = viewModel.currentRegion;\n\n    // :  >  > viewModel.focusLocation\n    if (detailLocation && viewModel.locations.has(detailLocation)) {\n      focusLocation = detailLocation;\n      const targetLocation = viewModel.locations.get(detailLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n      focusLocation = playerLocation;\n      const targetLocation = viewModel.locations.get(playerLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    } else if (viewModel.focusLocation && viewModel.locations.has(viewModel.focusLocation)) {\n      focusLocation = viewModel.focusLocation;\n      const targetLocation = viewModel.locations.get(focusLocation);\n      selectedRegion = targetLocation?.region || viewModel.currentRegion || '';\n    }\n\n    if (focusLocation) {\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      // \n      tabSelectionCache.set(selectedRegion, focusLocation);\n    }\n\n    const overlay = $(`\n            <div class=\"acu-map-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-map-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-map-title\">\n                            <i class=\"fa-solid fa-map-location-dot\"></i>\n                            <span class=\"acu-map-region-name\">${escapeHtml(viewModel.currentRegion || '')}</span>\n                        </div>\n                        <div class=\"acu-map-region-tabs\"></div>\n                        <div class=\"acu-map-actions\">\n                            <button class=\"acu-map-back-btn\" title=\"\"><i class=\"fa-solid fa-location-crosshairs\"></i></button>\n                            <button class=\"acu-close-btn acu-map-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-map-body\">\n                        <div class=\"acu-map-focus-area\"></div>\n                        <div class=\"acu-map-thumbnails\"></div>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const overlayEl = overlay[0];\n    overlayEl.style.setProperty('position', 'fixed', 'important');\n    overlayEl.style.setProperty('top', '0', 'important');\n    overlayEl.style.setProperty('left', '0', 'important');\n    overlayEl.style.setProperty('right', '0', 'important');\n    overlayEl.style.setProperty('bottom', '0', 'important');\n    overlayEl.style.setProperty('width', '100vw', 'important');\n    overlayEl.style.setProperty('height', '100vh', 'important');\n    overlayEl.style.setProperty('display', 'flex', 'important');\n    overlayEl.style.setProperty('justify-content', 'center', 'important');\n    overlayEl.style.setProperty('align-items', 'center', 'important');\n    overlayEl.style.setProperty('z-index', '2147483650', 'important');\n\n    // selectedRegion \n    const $focusArea = overlay.find('.acu-map-focus-area');\n    const $thumbnails = overlay.find('.acu-map-thumbnails');\n\n    const renderElementChip = element => {\n      const name = element.name || element.type || '';\n      const emoji = element.emoji ? `<span class=\"acu-map-chip-emoji\">${element.emoji}</span>` : '';\n      return `\n                 <div class=\"acu-map-element-chip acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n                   element.tableKey || '',\n                 )}\" data-row-index=\"${element.rowIndex}\">\n                     ${emoji}\n                     <span class=\"acu-map-chip-name\" title=\"${escapeHtml(name)}\">${escapeHtml(name)}</span>\n                 </div>\n             `;\n    };\n\n    const renderFocusArea = (model, locationName) => {\n      const location = model.locations.get(locationName);\n      if (!location) {\n        return '<div class=\"acu-map-loading\" style=\"grid-column: 1 / -1;\"><div class=\"acu-map-spinner\"></div></div>';\n      }\n\n      const characters = model.characters.get(locationName) || [];\n      const elements = model.elements.get(locationName) || [];\n\n      // \n      const leftChars = characters.slice(0, Math.ceil(characters.length / 2));\n      const rightChars = characters.slice(Math.ceil(characters.length / 2));\n      const leftElems = elements.slice(0, Math.ceil(elements.length / 2));\n      const rightElems = elements.slice(Math.ceil(elements.length / 2));\n\n      const renderAvatarHtml = char => {\n        const displayName = replaceUserPlaceholders(char.name);\n        const avatarStyle = char.avatarUrl\n          ? `background-image:url('${char.avatarUrl}');background-size:${char.avatarScale}%;background-position:${char.avatarOffsetX}% ${char.avatarOffsetY}%;`\n          : '';\n        return `\n            <div class=\"acu-map-avatar acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n              char.tableKey || '',\n            )}\" data-row-index=\"${char.rowIndex}\">\n                <div class=\"acu-map-avatar-circle\" style=\"${avatarStyle}\">\n                    ${char.avatarUrl ? '' : `<span>${escapeHtml(displayName.charAt(0))}</span>`}\n                </div>\n                <div class=\"acu-map-avatar-name\" title=\"${escapeHtml(displayName)}\">${escapeHtml(\n                  displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName,\n                )}</div>\n            </div>\n        `;\n      };\n\n      const leftAvatarsHtml = leftChars.length ? leftChars.map(renderAvatarHtml).join('') : '';\n      const rightAvatarsHtml = rightChars.length ? rightChars.map(renderAvatarHtml).join('') : '';\n      const leftElemsHtml = leftElems.length ? leftElems.map(e => renderElementChip(e)).join('') : '';\n      const rightElemsHtml = rightElems.length ? rightElems.map(e => renderElementChip(e)).join('') : '';\n\n      const emojiHtml = location.emoji\n        ? `<div class=\"acu-map-location-emoji\">${location.emoji}</div>`\n        : `<div class=\"acu-map-location-text\">${escapeHtml(location.name.charAt(0) || '')}</div>`;\n\n      return `\n        <div class=\"acu-map-wing left\">\n            <div class=\"acu-map-avatar-group acu-group-left\">${leftAvatarsHtml || ''}</div>\n            <div class=\"acu-map-element-group acu-group-left\">${leftElemsHtml || ''}</div>\n        </div>\n        <div class=\"acu-map-stage-center acu-dash-preview-trigger\" data-table-key=\"${escapeHtml(\n          location.tableKey,\n        )}\" data-row-index=\"${location.rowIndex}\">\n            ${emojiHtml}\n            <div class=\"acu-map-location-name\" title=\"${escapeHtml(location.name)}\">${escapeHtml(location.name)}</div>\n        </div>\n        <div class=\"acu-map-wing right\">\n            <div class=\"acu-map-avatar-group acu-group-right\">${rightAvatarsHtml || ''}</div>\n            <div class=\"acu-map-element-group acu-group-right\">${rightElemsHtml || ''}</div>\n        </div>\n        <div class=\"acu-map-mobile-stack\">\n            <div class=\"acu-map-mobile-avatars\">${leftAvatarsHtml || ''}${rightAvatarsHtml || ''}</div>\n            <div class=\"acu-map-mobile-elements\">${leftElemsHtml || ''}${rightElemsHtml || ''}</div>\n        </div>\n    `;\n    };\n\n    const renderThumbnailLocation = (model, location, isActive) => {\n      const charCount = (model.characters.get(location.name) || []).length;\n      const elementCount = (model.elements.get(location.name) || []).length;\n      const totalCount = charCount + elementCount;\n      const emoji = location.emoji\n        ? `<div class=\"acu-map-thumbnail-emoji\">${location.emoji}</div>`\n        : `<div class=\"acu-map-thumbnail-placeholder\">${escapeHtml(location.name.charAt(0) || '')}</div>`;\n      const badgeHtml = totalCount > 0 ? `<div class=\"acu-map-thumbnail-badge\">${totalCount}</div>` : '';\n      return `\n        <div class=\"acu-map-thumbnail ${isActive ? 'active' : ''}\" data-location=\"${escapeHtml(location.name)}\">\n            ${badgeHtml}\n            ${emoji}\n            <div class=\"acu-map-thumbnail-name\" title=\"${escapeHtml(location.name)}\">${escapeHtml(\n              location.name.length > 6 ? location.name.substring(0, 6) + '..' : location.name,\n            )}</div>\n        </div>\n    `;\n    };\n\n    const renderRegionTabs = (regions, currentRegion) => {\n      if (regions.length <= 1) return '';\n      return regions\n        .map(\n          r =>\n            `<button class=\"acu-map-region-tab ${r === currentRegion ? 'active' : ''}\" data-region=\"${escapeHtml(\n              r,\n            )}\">${escapeHtml(r)}</button>`,\n        )\n        .join('');\n    };\n\n    const refreshPanel = () => {\n      $focusArea.html(renderFocusArea(viewModel, focusLocation));\n\n      const regionLocations = Array.from(viewModel.locations.values())\n        .filter(l => (l.region || '') === selectedRegion)\n        .sort((a, b) => {\n          // :  + \n          const scoreA =\n            (viewModel.characters.get(a.name)?.length || 0) + (viewModel.elements.get(a.name)?.length || 0);\n          const scoreB =\n            (viewModel.characters.get(b.name)?.length || 0) + (viewModel.elements.get(b.name)?.length || 0);\n          return scoreB - scoreA;\n        });\n\n      const thumbnails = regionLocations\n        .map(location => renderThumbnailLocation(viewModel, location, location.name === focusLocation))\n        .join('');\n      $thumbnails.html(thumbnails || '<div class=\"acu-map-empty\"></div>');\n\n      overlay.find('.acu-map-region-name').text(selectedRegion || '');\n      overlay.find('.acu-map-region-tabs').html(renderRegionTabs(viewModel.allRegions, selectedRegion));\n    };\n\n    const setFocusLocation = name => {\n      if (!name) return;\n      focusLocation = name;\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      // \n      tabSelectionCache.set(selectedRegion, focusLocation);\n      refreshPanel();\n    };\n\n    refreshPanel();\n\n    overlay.on('click', '.acu-map-close', () => {\n      overlay.remove();\n    });\n    overlay.on('click', '.acu-map-region-tab', function () {\n      const newRegion = $(this).data('region');\n      if (newRegion === selectedRegion) return;\n      selectedRegion = newRegion;\n\n      //  focusLocation \n      const regionLocations = Array.from(viewModel.locations.values()).filter(\n        l => (l.region || '') === selectedRegion,\n      );\n      const currentInNewRegion = regionLocations.find(l => l.name === focusLocation);\n\n      if (!currentInNewRegion && regionLocations.length > 0) {\n        // :  > \n        const cachedLocation = tabSelectionCache.get(selectedRegion);\n        const cachedInRegion = cachedLocation && regionLocations.find(l => l.name === cachedLocation);\n\n        if (cachedInRegion) {\n          // \n          focusLocation = cachedLocation;\n        } else {\n          // \n          const hotLocations = getHotLocationsInRegion(selectedRegion);\n          focusLocation = hotLocations.length > 0 ? hotLocations[0].name : regionLocations[0].name;\n        }\n        Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      }\n\n      refreshPanel();\n    });\n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-map-overlay')) {\n        overlay.remove();\n      }\n    });\n\n    overlay.on('click', '.acu-map-thumbnail', function () {\n      const locationName = $(this).data('location');\n      if (locationName) setFocusLocation(locationName);\n    });\n\n    overlay.on('click', '.acu-map-back-btn', () => {\n      const fallbackFocus = viewModel.focusLocation;\n      const detailLocation = viewModel.detailLocation || '';\n      const playerLocation = viewModel.playerLocation || '';\n\n      let target = '';\n      if (detailLocation && viewModel.locations.has(detailLocation)) {\n        target = detailLocation;\n      } else if (playerLocation && viewModel.locations.has(playerLocation)) {\n        target = playerLocation;\n      } else if (fallbackFocus && viewModel.locations.has(fallbackFocus)) {\n        target = fallbackFocus;\n      }\n\n      if (!target) return;\n\n      // \n      const targetLocation = viewModel.locations.get(target);\n      const targetRegion = targetLocation?.region || viewModel.currentRegion || '';\n      if (targetRegion !== selectedRegion) {\n        selectedRegion = targetRegion;\n      }\n\n      focusLocation = target;\n      Store.set(STORAGE_KEY_MAP_FOCUS, focusLocation);\n      refreshPanel();\n    });\n\n    // \n    isMapOpening = false;\n\n    // \n    // \n  };\n\n  // \n  const showRelationshipGraph = npcTable => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n    $('.acu-relation-graph-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    const headers = npcTable.headers || [];\n    const rows = npcTable.rows || [];\n\n    const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n    const relationIdx = headers.findIndex(h => h && h.includes(''));\n    const npcTableKey = npcTable.key || '';\n\n    console.info(`[DICE]: \"${npcTableKey || ''}\"${rows.length}`);\n\n    if (relationIdx < 0) {\n      console.warn('[DICE]: \"\"');\n      if (window.toastr) window.toastr.warning('\"\"');\n      return;\n    }\n\n    const nodes = new Map();\n    const edges = [];\n\n    // {{user}}\n    const resolveUserPlaceholder = name => {\n      if (!name) return name;\n      const playerName = getPlayerName();\n      const personaName = getPersonaName();\n\n      // \n      const explicitUserVariants = ['<user>', '{{user}}'];\n      const isExplicitUserVariant = explicitUserVariants.some(\n        v => name === v || name.toLowerCase() === v.toLowerCase(),\n      );\n\n      // persona\n      const isPersonaName = personaName && name === personaName;\n\n      // \"\"\n      const isPlayerName = (() => {\n        if (!playerName) return false;\n        // \n        if (name === playerName) return true;\n        // \n        const primaryName = AvatarManager.getPrimaryName(name);\n        return primaryName === playerName;\n      })();\n\n      // {{user}}\n      if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n        return '{{user}}';\n      }\n\n      // \n      return AvatarManager.getPrimaryName(name);\n    };\n\n    const resolveName = name => resolveUserPlaceholder(name);\n\n    const rawData = cachedRawData || getTableData();\n    let playerName = '';\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]) {\n          playerName = sheet.content[1][1] || '';\n          break;\n        }\n      }\n    }\n    const resolvedPlayerName = resolveName(playerName);\n    const playerTableKey = (() => {\n      for (const k in rawData) {\n        if (rawData[k]?.name?.includes('')) return k;\n      }\n      return '';\n    })();\n    nodes.set(resolvedPlayerName, {\n      name: resolvedPlayerName,\n      isPlayer: true,\n      x: 0,\n      y: 0,\n      tableKey: playerTableKey,\n      rowIndex: 0,\n    });\n\n    // \"\"\n    const inSceneColIdx = headers.findIndex(h => h && h.includes(''));\n\n    rows.forEach((row, idx) => {\n      const rawNpcName = row[nameIdx];\n      if (!rawNpcName) return;\n\n      const npcName = resolveName(rawNpcName);\n\n      // \n      let isInScene = false;\n      if (inSceneColIdx > 0) {\n        const inSceneVal = String(row[inSceneColIdx] || '')\n          .trim()\n          .toLowerCase();\n        const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n        if (header.includes('')) {\n          isInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n        } else {\n          isInScene =\n            inSceneVal.startsWith('') || inSceneVal === 'true' || inSceneVal === '' || inSceneVal === 'yes';\n        }\n      }\n\n      if (!nodes.has(npcName)) {\n        nodes.set(npcName, {\n          name: npcName,\n          isPlayer: false,\n          x: 0,\n          y: 0,\n          tableKey: npcTableKey,\n          rowIndex: idx,\n          isInScene: isInScene,\n        });\n      }\n\n      const relationStr = row[relationIdx] || '';\n      const relations = parseRelationshipString(relationStr);\n\n      relations.forEach(rel => {\n        if (!rel.name) return;\n        const resolvedRelName = resolveName(rel.name);\n\n        if (resolvedRelName === npcName) return;\n\n        if (!nodes.has(resolvedRelName)) {\n          // NPC\n          let relRowIndex = -1;\n          let relIsInScene = false;\n          for (let ri = 0; ri < rows.length; ri++) {\n            if (resolveName(rows[ri][nameIdx]) === resolvedRelName) {\n              relRowIndex = ri;\n              // \n              if (inSceneColIdx > 0) {\n                const inSceneVal = String(rows[ri][inSceneColIdx] || '')\n                  .trim()\n                  .toLowerCase();\n                const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n                if (header.includes('')) {\n                  relIsInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n                } else {\n                  relIsInScene =\n                    inSceneVal.startsWith('') ||\n                    inSceneVal === 'true' ||\n                    inSceneVal === '' ||\n                    inSceneVal === 'yes';\n                }\n              }\n              break;\n            }\n          }\n          nodes.set(resolvedRelName, {\n            name: resolvedRelName,\n            isPlayer: resolvedRelName === resolvedPlayerName,\n            x: 0,\n            y: 0,\n            tableKey: relRowIndex >= 0 ? npcTableKey : '',\n            rowIndex: relRowIndex >= 0 ? relRowIndex : undefined,\n            isInScene: relIsInScene,\n          });\n        }\n\n        // /\n        const cleanRelation = rawRel => {\n          if (!rawRel) return [];\n          const parts = String(rawRel)\n            .split(/[,;\\/\\|]+|\\s*[&]\\s*|\\s{2,}|\\n/)\n            .map(s => s.trim())\n            .filter(s => s && s.length < 30); // \n\n          // \n          const commonRelations = [\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n          ];\n\n          return parts\n            .map(p => {\n              // [] \n              p = p.replace(/[(][^)]*[)]/g, '').trim();\n              // === XX/  XX ===\n              const specialSuffixMatch = p.match(/^(.+)(|)$/);\n              if (specialSuffixMatch) {\n                p = specialSuffixMatch[1]; // \"\"  \"\"\n              } else {\n                // === XXYY  YY ===\n                p = p.replace(/^[\\u4e00-\\u9fa5]{2,4}(?=[\\u4e00-\\u9fa5]{1,4}$)/, '');\n              }\n\n              // ===  ===\n              p = p.replace(/^(?:|||?|?|)/, '');\n              p = p.replace(/^(?:?|?|?|)/, '');\n              p = p.replace(/^(?:|?|?)/, '');\n\n              // ===  ===\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n\n              // ===  ===\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^(?:||?)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n\n              p = p.trim();\n\n              // === []  ===\n              if (p.length > 8) {\n                // \n                for (const rel of commonRelations) {\n                  if (p.endsWith(rel)) {\n                    return rel;\n                  }\n                }\n                // 2-4\n                const lastChars = p.slice(-4);\n                for (const rel of commonRelations) {\n                  if (lastChars.includes(rel)) {\n                    return rel;\n                  }\n                }\n                // 3\n                return p.slice(-3);\n              }\n\n              return p;\n            })\n            .filter(s => s && s.length > 0 && s.length <= 8);\n        };\n\n        const cleanedLabels = cleanRelation(rel.relation);\n        if (cleanedLabels.length === 0) cleanedLabels.push('');\n\n        // \n        let existingEdge = edges.find(\n          e =>\n            (e.source === npcName && e.target === resolvedRelName) ||\n            (e.source === resolvedRelName && e.target === npcName),\n        );\n\n        if (!existingEdge) {\n          // \n          edges.push({\n            source: npcName,\n            target: resolvedRelName,\n            // \n            labelsFromSource: cleanedLabels.slice(0, 2), // sourcetarget 2\n            labelsFromTarget: [], // targetsource \n          });\n        } else {\n          // \n          if (existingEdge.source === npcName) {\n            // npcsource labelsFromSource\n            const combined = [...(existingEdge.labelsFromSource || []), ...cleanedLabels];\n            // 2\n            existingEdge.labelsFromSource = [...new Set(combined)].slice(0, 2);\n          } else {\n            // npctarget labelsFromTarget\n            const combined = [...(existingEdge.labelsFromTarget || []), ...cleanedLabels];\n            existingEdge.labelsFromTarget = [...new Set(combined)].slice(0, 2);\n          }\n        }\n      });\n    });\n\n    const nodeArr = Array.from(nodes.values());\n    console.info(`[DICE]${nodeArr.length}${edges.length}`);\n    const centerX = 400,\n      centerY = 300;\n\n    // [] \n    const connectionCount = new Map();\n    nodeArr.forEach(node => connectionCount.set(node.name, 0));\n    edges.forEach(edge => {\n      connectionCount.set(edge.source, (connectionCount.get(edge.source) || 0) + 1);\n      connectionCount.set(edge.target, (connectionCount.get(edge.target) || 0) + 1);\n    });\n\n    // [] \n    const isMobileView = window.innerWidth <= 768;\n    const baseRadius = isMobileView ? 22 : 28;\n    const maxRadius = isMobileView ? 38 : 50;\n    const playerBaseRadius = isMobileView ? 28 : 35;\n    const radiusPerConnection = isMobileView ? 2.5 : 3.5;\n\n    //  getNodeRadius \n    let nodeSizeMultiplier = 1.0; // 1.0\n    let filterInScene = false; // +\n    let filterDirectOnly = false; // \n\n    const getNodeRadius = (nodeName, isPlayer) => {\n      const base = isPlayer ? playerBaseRadius : baseRadius;\n      const count = connectionCount.get(nodeName) || 0;\n      const calculated = Math.min(maxRadius, base + Math.sqrt(count) * radiusPerConnection);\n      // \n      return calculated * nodeSizeMultiplier;\n    };\n\n    // \n    nodeArr.forEach(node => {\n      node.radius = getNodeRadius(node.name, node.isPlayer);\n    });\n\n    // \n    const getFilteredNodes = () => {\n      // \n      if (!filterInScene && !filterDirectOnly) return nodeArr;\n\n      // \n      let directNodes: Set<string> | null = null;\n      if (filterDirectOnly) {\n        directNodes = new Set([resolvedPlayerName]);\n        edges.forEach(edge => {\n          if (edge.source === resolvedPlayerName) directNodes!.add(edge.target);\n          if (edge.target === resolvedPlayerName) directNodes!.add(edge.source);\n        });\n      }\n\n      return nodeArr.filter(n => {\n        // \n        const passInScene = !filterInScene || n.isInScene || n.isPlayer;\n        // \n        const passDirectOnly = !filterDirectOnly || directNodes!.has(n.name);\n        // \n        return passInScene && passDirectOnly;\n      });\n    };\n\n    // [Modified] \n    // ---------------------------------------------------------\n    //  ()\n    const kRepulsion = 20000; //  () - \n    const kSpring = 0.02; //  () - \n    const kGravity = 0.01; //  - \n    const idealLen = 250; //  - \n    const iterations = 300; // \n    const timeStep = 0.5; // \n    const damping = 0.8; //  ()\n\n    // \n    const LAYOUT_CACHE_KEY = 'acu-relation-graph-layout-cache';\n\n    // \n    const getLayoutCacheKey = () => {\n      const nodeNames = nodeArr\n        .map(n => n.name)\n        .sort()\n        .join('|');\n      return `${LAYOUT_CACHE_KEY}-${nodeNames}`;\n    };\n\n    // \n    const saveLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const layoutData = {};\n        nodeArr.forEach(node => {\n          layoutData[node.name] = { x: node.x, y: node.y };\n        });\n        localStorage.setItem(cacheKey, JSON.stringify(layoutData));\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const loadLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        const cached = localStorage.getItem(cacheKey);\n        if (!cached) return false;\n\n        const layoutData = JSON.parse(cached);\n        let allNodesFound = true;\n\n        // \n        for (const node of nodeArr) {\n          if (!layoutData[node.name]) {\n            allNodesFound = false;\n            break;\n          }\n        }\n\n        if (allNodesFound) {\n          // \n          nodeArr.forEach(node => {\n            const cached = layoutData[node.name];\n            if (cached) {\n              node.x = cached.x;\n              node.y = cached.y;\n              node.vx = 0;\n              node.vy = 0;\n            }\n          });\n          return true;\n        }\n        return false;\n      } catch (e) {\n        console.warn('[DICE] :', e);\n        return false;\n      }\n    };\n\n    // \n    const clearLayoutCache = () => {\n      try {\n        const cacheKey = getLayoutCacheKey();\n        localStorage.removeItem(cacheKey);\n      } catch (e) {\n        console.warn('[DICE] :', e);\n      }\n    };\n\n    // \n    const runForceDirectedLayout = () => {\n      // \n      nodeArr.forEach(node => {\n        if (node.isPlayer) {\n          node.x = centerX;\n          node.y = centerY;\n          node.vx = 0;\n          node.vy = 0;\n        } else {\n          //  100px \n          const angle = Math.random() * 2 * Math.PI;\n          const dist = 50 + Math.random() * 100;\n          node.x = centerX + Math.cos(angle) * dist;\n          node.y = centerY + Math.sin(angle) * dist;\n          node.vx = 0;\n          node.vy = 0;\n        }\n      });\n\n      //  O(1) \n      const nodeMap = new Map();\n      nodeArr.forEach(n => nodeMap.set(n.name, n));\n\n      //  ()\n      for (let iter = 0; iter < iterations; iter++) {\n        // 1.  ( vs )\n        for (let i = 0; i < nodeArr.length; i++) {\n          const u = nodeArr[i];\n          for (let j = i + 1; j < nodeArr.length; j++) {\n            const v = nodeArr[j];\n            const dx = v.x - u.x;\n            const dy = v.y - u.y;\n            let distSq = dx * dx + dy * dy;\n            if (distSq < 1) distSq = 1; // \n\n            const dist = Math.sqrt(distSq);\n            const force = kRepulsion / distSq;\n\n            const fx = (dx / dist) * force;\n            const fy = (dy / dist) * force;\n\n            if (!u.isPlayer) {\n              u.vx -= fx;\n              u.vy -= fy;\n            }\n            if (!v.isPlayer) {\n              v.vx += fx;\n              v.vy += fy;\n            }\n          }\n        }\n\n        // 2.  ()\n        edges.forEach(edge => {\n          const u = nodeMap.get(edge.source);\n          const v = nodeMap.get(edge.target);\n          if (!u || !v) return;\n\n          const dx = v.x - u.x;\n          const dy = v.y - u.y;\n          const dist = Math.sqrt(dx * dx + dy * dy) || 1;\n\n          // : F = k * ( - )\n          const force = (dist - idealLen) * kSpring;\n\n          const fx = (dx / dist) * force;\n          const fy = (dy / dist) * force;\n\n          if (!u.isPlayer) {\n            u.vx += fx;\n            u.vy += fy;\n          }\n          if (!v.isPlayer) {\n            v.vx -= fx;\n            v.vy -= fy;\n          }\n        });\n\n        // 3.  ()\n        nodeArr.forEach(node => {\n          if (node.isPlayer) return;\n          const dx = centerX - node.x;\n          const dy = centerY - node.y;\n          node.vx += dx * kGravity;\n          node.vy += dy * kGravity;\n        });\n\n        // 4. \n        // \n        const maxSpeed = 50 * (1 - iter / iterations); // \n\n        nodeArr.forEach(node => {\n          if (node.isPlayer) return; //  ()\n\n          // \n          node.vx *= damping;\n          node.vy *= damping;\n\n          // \n          const vMag = Math.sqrt(node.vx * node.vx + node.vy * node.vy);\n          if (vMag > maxSpeed) {\n            node.vx = (node.vx / vMag) * maxSpeed;\n            node.vy = (node.vy / vMag) * maxSpeed;\n          }\n\n          node.x += node.vx * timeStep;\n          node.y += node.vy * timeStep;\n        });\n      }\n\n      // \n      saveLayoutCache();\n    };\n\n    // \n    if (!loadLayoutCache()) {\n      // \n      runForceDirectedLayout();\n    }\n\n    // \n    let scale = 1;\n    let panX = 0;\n    let panY = 0;\n    const minScale = 0.3;\n    const maxScale = 4;\n\n    const overlay = $(`\n            <div class=\"acu-relation-graph-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-relation-graph-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-graph-title\">\n                            <i class=\"fa-solid fa-project-diagram\"></i>\n                            <button class=\"acu-graph-btn acu-filter-toggle\" id=\"filter-in-scene\" title=\"\" style=\"margin-left:8px;padding:4px 6px;font-size:12px;\"><i class=\"fa-solid fa-map-marker-alt\"></i></button>\n                            <button class=\"acu-graph-btn acu-filter-toggle\" id=\"filter-direct-only\" title=\"\" style=\"padding:4px 6px;font-size:12px;\"><i class=\"fa-solid fa-link\"></i></button>\n                        </div>\n                        <div class=\"acu-graph-actions\">\n                            <button class=\"acu-graph-btn\" id=\"graph-relayout\" title=\"\"><i class=\"fa-solid fa-sync\"></i></button>\n                            <button class=\"acu-graph-btn\" id=\"graph-manage-avatar\" title=\"\"><i class=\"fa-solid fa-user-circle\"></i></button>\n                            <button class=\"acu-graph-btn acu-graph-close\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-canvas-wrapper\">\n                        <svg class=\"acu-graph-svg\" viewBox=\"0 0 800 600\">\n                            <defs>\n                                <marker id=\"arrowhead-end\" markerWidth=\"6\" markerHeight=\"5\" refX=\"5\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 6 2.5, 0 5\" fill=\"${t.textSub}\" />\n                                </marker>\n                                <marker id=\"arrowhead-start\" markerWidth=\"6\" markerHeight=\"5\" refX=\"1\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"6 0, 0 2.5, 6 5\" fill=\"${t.textSub}\" />\n                                </marker>\n                                <marker id=\"arrowhead-end-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"6\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 7 3, 0 6\" fill=\"${t.accent}\" />\n                                </marker>\n                                <marker id=\"arrowhead-start-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"1\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"7 0, 0 3, 7 6\" fill=\"${t.accent}\" />\n                                </marker>\n                            </defs>\n                            <g class=\"acu-graph-transform\">\n                                <g class=\"acu-graph-edges\"></g>\n                                <g class=\"acu-graph-nodes\"></g>\n                            </g>\n                        </svg>\n                        <div class=\"acu-node-size-slider-container\" style=\"\n                            position: absolute;\n                            display: none;\n                            width: 200px;\n                            padding: 10px;\n                            background: ${t.bgPanel};\n                            border: 1px solid ${t.border};\n                            border-radius: 8px;\n                            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n                            z-index: 10;\n                        \">\n                            <div style=\"display:flex;align-items:center;gap:8px;margin-bottom:6px;\">\n                                <span style=\"font-size:11px;color:${t.textSub};white-space:nowrap;\"></span>\n                                <span id=\"slider-size-display\" style=\"font-size:11px;color:${t.accent};font-weight:bold;min-width:35px;text-align:right;\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                            </div>\n                            <input type=\"range\" id=\"node-size-slider\" min=\"0.5\" max=\"2.0\" step=\"0.1\" value=\"${nodeSizeMultiplier}\" style=\"\n                                width: 100%;\n                                height: 8px;\n                                border-radius: 4px;\n                                background: ${t.btnBg};\n                                outline: none;\n                                cursor: pointer;\n                                -webkit-appearance: none;\n                            \" />\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-legend\">\n                        <button class=\"acu-graph-btn\" id=\"graph-zoom-reset\" title=\"\" style=\"width:auto;height:auto;padding:4px 10px;font-size:11px;display:flex;align-items:center;gap:4px;\"><i class=\"fa-solid fa-compress-arrows-alt\"></i><span></span></button>\n                        <div class=\"acu-node-size-stepper-wrapper\" style=\"display:flex;align-items:center;justify-content:center;gap:6px;\">\n                            <span style=\"font-size:11px;color:var(--acu-text-sub);white-space:nowrap;\">:</span>\n                            <div class=\"acu-stepper\" data-id=\"graph-node-size\" data-min=\"50\" data-max=\"200\" data-step=\"10\" style=\"display:flex;align-items:center;\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\" id=\"node-size-display\" style=\"display:flex;align-items:center;justify-content:center;\">${Math.round(nodeSizeMultiplier * 100)}%</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <span class=\"acu-zoom-display\" style=\"display:flex;align-items:center;gap:4px;color:var(--acu-text-sub);font-size:11px;\">\n                            <span>:</span>\n                            <span>${Math.round(scale * 100)}%</span>\n                        </span>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const $svg = overlay.find('.acu-graph-svg');\n    const $transform = overlay.find('.acu-graph-transform');\n    const $edgesGroup = overlay.find('.acu-graph-edges');\n    const $nodesGroup = overlay.find('.acu-graph-nodes');\n    const $zoomDisplay = overlay.find('.acu-zoom-display span:last-child');\n    const $nodeSizeDisplay = overlay.find('#node-size-display');\n    const $wrapper = overlay.find('.acu-graph-canvas-wrapper');\n\n    const updateTransform = () => {\n      $transform.attr('transform', `translate(${panX}, ${panY}) scale(${scale})`);\n      $zoomDisplay.text(`${Math.round(scale * 100)}%`);\n    };\n\n    const updateNodeSizeDisplay = () => {\n      if ($nodeSizeDisplay.length) {\n        $nodeSizeDisplay.text(`${Math.round(nodeSizeMultiplier * 100)}%`);\n      }\n    };\n\n    const zoomTo = (newScale, centerX = 400, centerY = 300) => {\n      const oldScale = scale;\n      scale = Math.max(minScale, Math.min(maxScale, newScale));\n      const scaleChange = scale / oldScale;\n      panX = centerX - (centerX - panX) * scaleChange;\n      panY = centerY - (centerY - panY) * scaleChange;\n      updateTransform();\n    };\n\n    const render = async () => {\n      // \n      const filteredNodes = getFilteredNodes();\n      const filteredNodeNames = new Set(filteredNodes.map(n => n.name));\n\n      // \n      const filteredEdges = edges.filter(\n        edge => filteredNodeNames.has(edge.source) && filteredNodeNames.has(edge.target),\n      );\n\n      let edgesHtml = '';\n      filteredEdges.forEach((edge, edgeIdx) => {\n        const source = nodes.get(edge.source);\n        const target = nodes.get(edge.target);\n        if (!source || !target) return;\n\n        // \n        const dx = target.x - source.x;\n        const dy = target.y - source.y;\n        const len = Math.sqrt(dx * dx + dy * dy) || 1;\n        const nx = dx / len; // \n        const ny = dy / len;\n\n        // \n        const px = -ny;\n        const py = nx;\n\n        // \n        const hasFromSource =\n          edge.labelsFromSource && edge.labelsFromSource.length > 0 && edge.labelsFromSource.some(l => l);\n        const hasFromTarget =\n          edge.labelsFromTarget && edge.labelsFromTarget.length > 0 && edge.labelsFromTarget.some(l => l);\n\n        // \n        const sourceRadius = source.radius || 28;\n        const targetRadius = target.radius || 28;\n        const arrowGap = 10; // \n        const x1 = source.x + nx * (sourceRadius + arrowGap);\n        const y1 = source.y + ny * (sourceRadius + arrowGap);\n        const x2 = target.x - nx * (targetRadius + arrowGap);\n        const y2 = target.y - ny * (targetRadius + arrowGap);\n\n        // \n        let srcLabels = (edge.labelsFromSource || []).filter(l => l);\n        let tgtLabels = (edge.labelsFromTarget || []).filter(l => l);\n\n        // \n        const srcSet = new Set(srcLabels);\n        const tgtSet = new Set(tgtLabels);\n        const commonLabels = [...srcSet].filter(l => tgtSet.has(l));\n\n        // \n        const srcUnique = srcLabels.filter(l => !commonLabels.includes(l));\n        const tgtUnique = tgtLabels.filter(l => !commonLabels.includes(l));\n\n        // \n        let markerStart = '';\n        let markerEnd = '';\n        if (hasFromSource) markerEnd = 'url(#arrowhead-end)';\n        if (hasFromTarget) markerStart = 'url(#arrowhead-start)';\n\n        edgesHtml += `<line class=\"acu-graph-edge\" x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                    ${markerEnd ? `marker-end=\"${markerEnd}\"` : ''}\n                    ${markerStart ? `marker-start=\"${markerStart}\"` : ''}\n                    data-edge-idx=\"${edgeIdx}\" />`;\n\n        // \n        const midX = (source.x + target.x) / 2;\n        const midY = (source.y + target.y) / 2;\n\n        // \n        const lineLen = Math.sqrt(dx * dx + dy * dy);\n\n        // \"\"\n        const isBidirectional = hasFromSource && hasFromTarget;\n        const isBidirectionalSame =\n          isBidirectional && commonLabels.length > 0 && srcUnique.length === 0 && tgtUnique.length === 0;\n\n        // \n        if (isBidirectionalSame) {\n          // \n          commonLabels.slice(0, 2).forEach((lbl, i) => {\n            if (!lbl) return;\n            const offsetDir = i === 0 ? 1 : -1;\n            const offsetDist = 6 + i * 10;\n            const lx = midX + px * offsetDir * offsetDist;\n            const ly = midY + py * offsetDir * offsetDist;\n            edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(lbl)}</text>`;\n          });\n        } else {\n          // \n          // source/target\n          // 25%\n          const safeOffset = Math.max(30, Math.min(lineLen * 0.25, 60));\n\n          // Emoji\n          const relationEmojiMap = [\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', ''] },\n          ];\n\n          // Emoji\n          const addRelationEmoji = lbl => {\n            if (!lbl) return '';\n            for (const group of relationEmojiMap) {\n              for (const kw of group.keywords) {\n                if (lbl.includes(kw)) {\n                  return lbl + group.emoji;\n                }\n              }\n            }\n            return lbl;\n          };\n\n          // emoji\n          const truncateLabel = (lbl, maxLen = 4) => {\n            if (!lbl) return '';\n            const truncated = lbl.length > maxLen ? lbl.substring(0, maxLen) + '..' : lbl;\n            return addRelationEmoji(truncated);\n          };\n\n          // 1. \n          if (commonLabels.length > 0) {\n            commonLabels.slice(0, 1).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const lx = midX + px * 8;\n              const ly = midY + py * 8 - 3;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n\n          // 2. Sourcesource\n          if (srcUnique.length > 0 || (hasFromSource && !hasFromTarget && commonLabels.length === 0)) {\n            const labelsToShow = srcUnique.length > 0 ? srcUnique : srcLabels;\n            // source\n            const labelBaseX = midX - nx * safeOffset;\n            const labelBaseY = midY - ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? 1 : -1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n\n          // 3. Targettarget\n          if (tgtUnique.length > 0 || (hasFromTarget && !hasFromSource && commonLabels.length === 0)) {\n            const labelsToShow = tgtUnique.length > 0 ? tgtUnique : tgtLabels;\n            // target\n            const labelBaseX = midX + nx * safeOffset;\n            const labelBaseY = midY + ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? -1 : 1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n        }\n      });\n      $edgesGroup.html(edgesHtml);\n\n      // [] \n      let nodesHtml = '';\n      for (const node of filteredNodes) {\n        //  > URL > ST\n        const nodeAvatar = await AvatarManager.getAsync(node.name);\n        const isPlayer = node.isPlayer;\n\n        // \n        const indicatorRadius = node.radius * 0.28;\n        const indicatorOffset = node.radius * 0.65;\n        const inSceneIndicator = node.isInScene\n          ? `<circle class=\"acu-node-inscene-indicator\" cx=\"${-indicatorOffset}\" cy=\"${-indicatorOffset}\" r=\"${indicatorRadius}\" style=\"fill:var(--acu-accent);stroke:var(--acu-bg-panel);stroke-width:2;\" />`\n          : '';\n\n        const nodeDisplayName = replaceUserPlaceholders(node.name);\n        nodesHtml += `\n                <g class=\"acu-graph-node acu-dash-preview-trigger\" data-name=\"${escapeHtml(node.name)}\" data-table-key=\"${node.tableKey || ''}\" data-row-index=\"${node.rowIndex !== undefined ? node.rowIndex : ''}\" transform=\"translate(${node.x}, ${node.y})\">\n                    <circle class=\"acu-node-bg\" r=\"${node.radius}\" />\n                    ${\n                      nodeAvatar\n                        ? (() => {\n                            const offsetX = AvatarManager.getOffsetX(node.name);\n                            const offsetY = AvatarManager.getOffsetY(node.name);\n                            const scaleVal = AvatarManager.getScale(node.name);\n                            const size = (node.radius - 2) * 2;\n                            const shadowWidth = 4; // box-shadow\n                            const foSize = size + shadowWidth * 2;\n                            const foOffset = foSize / 2;\n                            return `<foreignObject x=\"${-foOffset}\" y=\"${-foOffset}\" width=\"${foSize}\" height=\"${foSize}\">\n                            <div class=\"acu-node-avatar\" xmlns=\"http://www.w3.org/1999/xhtml\" style=\"\n                                width: ${size}px;\n                                height: ${size}px;\n                                margin: ${shadowWidth}px;\n                                border-radius: 50%;\n                                background-image: url('${nodeAvatar}');\n                                background-size: ${scaleVal}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                                background-repeat: no-repeat;\n                            \"></div>\n                        </foreignObject>`;\n                          })()\n                        : `<text class=\"acu-node-char\" dy=\"0.35em\">${escapeHtml(nodeDisplayName.charAt(0))}</text>`\n                    }\n                    ${inSceneIndicator}\n                    <text class=\"acu-node-label\" dy=\"${node.radius + 14}\">${escapeHtml(nodeDisplayName)}</text>\n                </g>\n            `;\n      }\n      $nodesGroup.html(nodesHtml);\n    };\n\n    // [] \n    const highlightNode = nodeName => {\n      $svg.addClass('highlighting');\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if ($(this).data('name') === nodeName) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedNodes = new Set([nodeName]);\n\n      // \n      edges.forEach(edge => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          const otherNode = edge.source === nodeName ? edge.target : edge.source;\n          connectedNodes.add(otherNode);\n        }\n      });\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if (connectedNodes.has($(this).data('name'))) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedEdgeIndices = new Set();\n      edges.forEach((edge, idx) => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          connectedEdgeIndices.add(idx);\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n          if ($(this).attr('marker-end')) {\n            $(this).attr('marker-end', 'url(#arrowhead-end-hl)');\n          }\n          if ($(this).attr('marker-start')) {\n            $(this).attr('marker-start', 'url(#arrowhead-start-hl)');\n          }\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge-label').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n        }\n      });\n    };\n\n    const clearHighlight = () => {\n      $svg.removeClass('highlighting');\n      $nodesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        if ($(this).attr('marker-end')) {\n          $(this).attr('marker-end', 'url(#arrowhead-end)');\n        }\n        if ($(this).attr('marker-start')) {\n          $(this).attr('marker-start', 'url(#arrowhead-start)');\n        }\n      });\n    };\n\n    // []  - PC +  + \n    // pointerfine()coarse()\n    const hasFinePointer = window.matchMedia('(pointer: fine)').matches;\n    const isTouchDevice = !hasFinePointer;\n\n    // \n    let currentHighlightedNode = null; // \n    let longPressTimer = null;\n\n    if (isTouchDevice) {\n      // ==========  ==========\n      let currentHighlightedNode = null;\n\n      $nodesGroup.on('pointerdown', '.acu-graph-node', function (e) {\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        const startX = e.clientX;\n        const startY = e.clientY;\n        const startTime = Date.now();\n        let hasMoved = false;\n        let longPressTriggered = false;\n\n        // \n        if (currentHighlightedNode) {\n          clearHighlight();\n          currentHighlightedNode = null;\n          // return\n          e.preventDefault();\n          e.stopPropagation();\n          return;\n        }\n\n        // \n        const longPressTimer = setTimeout(() => {\n          if (!hasMoved && nodeName) {\n            longPressTriggered = true;\n            currentHighlightedNode = nodeName;\n            highlightNode(nodeName);\n            if (navigator.vibrate) navigator.vibrate(30);\n          }\n        }, 300);\n\n        const onMove = moveE => {\n          const dx = Math.abs(moveE.clientX - startX);\n          const dy = Math.abs(moveE.clientY - startY);\n          if (dx > 8 || dy > 8) {\n            hasMoved = true;\n            clearTimeout(longPressTimer);\n          }\n        };\n\n        const onUp = () => {\n          $(document).off('pointermove.mobilenode pointerup.mobilenode pointercancel.mobilenode');\n          clearTimeout(longPressTimer);\n\n          const elapsed = Date.now() - startTime;\n\n          //   \n          if (longPressTriggered) {\n            return;\n          }\n\n          //   \n          if (hasMoved) {\n            return;\n          }\n\n          // <300ms  \n          if (elapsed < 300) {\n            const nodeName = $node.data('name');\n            // \n            const primaryName = AvatarManager.getPrimaryName(nodeName);\n            const tableKey = $node.data('table-key');\n            let rowIndex = $node.data('row-index');\n\n            // tableKey\n            if (!tableKey || rowIndex === '' || rowIndex === undefined) {\n              // NPC\n              const rawData = cachedRawData || getTableData();\n              if (rawData) {\n                for (const key in rawData) {\n                  const table = rawData[key];\n                  if (!table?.content || !table.name?.includes('NPC')) continue;\n                  const headers = table.content[0] || [];\n                  const nameIdx = headers.findIndex(\n                    h => h && (h.includes('') || h.includes('') || h.includes('')),\n                  );\n                  if (nameIdx < 0) continue;\n                  for (let i = 1; i < table.content.length; i++) {\n                    const rowName = String(table.content[i][nameIdx] || '').trim();\n                    if (rowName === primaryName || AvatarManager.getPrimaryName(rowName) === primaryName) {\n                      // \n                      const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n                        .data('table-key', key)\n                        .data('row-index', i - 1);\n                      $('body').append(tempNode);\n                      tempNode.trigger('click.acu_dash_preview');\n                      tempNode.remove();\n                      return;\n                    }\n                  }\n                }\n              }\n              // \n              if (window.toastr) {\n                window.toastr.info(`${primaryName}`, '', { timeOut: 2000 });\n              }\n              return;\n            }\n\n            // tableKey\n            const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n              .data('table-key', tableKey)\n              .data('row-index', parseInt(rowIndex, 10));\n            $('body').append(tempNode);\n            tempNode.trigger('click.acu_dash_preview');\n            tempNode.remove();\n          }\n        };\n\n        $(document).on('pointermove.mobilenode', onMove);\n        $(document).on('pointerup.mobilenode pointercancel.mobilenode', onUp);\n      });\n\n      // \n      $wrapper.on('pointerup.mobileclear', function (e) {\n        if (currentHighlightedNode && !$(e.target).closest('.acu-graph-node').length) {\n          clearHighlight();\n          currentHighlightedNode = null;\n        }\n      });\n    } else {\n      // ========== PC ==========\n\n      $nodesGroup.on('pointerenter.pchover', '.acu-graph-node', function () {\n        const nodeName = $(this).data('name');\n        if (nodeName) {\n          highlightNode(nodeName);\n        }\n      });\n\n      $nodesGroup.on('pointerleave.pchover', '.acu-graph-node', function () {\n        clearHighlight();\n      });\n\n      // PC\n      $nodesGroup.on('click.pcclick', '.acu-graph-node', function (e) {\n        e.stopPropagation();\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        // \n        const primaryName = AvatarManager.getPrimaryName(nodeName);\n        const tableKey = $node.data('table-key');\n        let rowIndex = $node.data('row-index');\n\n        // tableKey\n        if (!tableKey || rowIndex === '' || rowIndex === undefined) {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            for (const key in rawData) {\n              const table = rawData[key];\n              if (!table?.content || !table.name?.includes('NPC')) continue;\n              const headers = table.content[0] || [];\n              const nameIdx = headers.findIndex(\n                h => h && (h.includes('') || h.includes('') || h.includes('')),\n              );\n              if (nameIdx < 0) continue;\n              for (let i = 1; i < table.content.length; i++) {\n                const rowName = String(table.content[i][nameIdx] || '').trim();\n                if (rowName === primaryName || AvatarManager.getPrimaryName(rowName) === primaryName) {\n                  const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n                    .data('table-key', key)\n                    .data('row-index', i - 1);\n                  $('body').append(tempNode);\n                  tempNode.trigger('click.acu_dash_preview');\n                  tempNode.remove();\n                  return;\n                }\n              }\n            }\n          }\n          if (window.toastr) {\n            window.toastr.info(`${primaryName}`, '', { timeOut: 2000 });\n          }\n          return;\n        }\n\n        // tableKey\n        const tempNode = $('<div class=\"acu-dash-preview-trigger\" style=\"display:none;\"></div>')\n          .data('table-key', tableKey)\n          .data('row-index', parseInt(rowIndex, 10));\n        $('body').append(tempNode);\n        tempNode.trigger('click.acu_dash_preview');\n        tempNode.remove();\n      });\n    }\n\n    // \n    render().then(() => {\n      updateTransform();\n    });\n\n    //  -  Pointer Events API\n    let isPanning = false;\n    let panStartX = 0,\n      panStartY = 0;\n    let panStartPanX = 0,\n      panStartPanY = 0;\n    let lastPinchDist = 0;\n    let activePointerId = null;\n\n    const wrapperEl = $wrapper[0];\n    const svgEl = $svg[0];\n\n    // Pointer Down - \n    wrapperEl.onpointerdown = function (e) {\n      if (e.button !== 0) return;\n      // [] \n      if ($(e.target).closest('.acu-graph-node').length) return;\n      // [] \n      if ($(e.target).closest('.acu-node-size-slider-container').length) return;\n      e.preventDefault();\n      wrapperEl.setPointerCapture(e.pointerId);\n      activePointerId = e.pointerId;\n      isPanning = true;\n      panStartX = e.clientX;\n      panStartY = e.clientY;\n      panStartPanX = panX;\n      panStartPanY = panY;\n      svgEl.style.cursor = 'grabbing';\n    };\n\n    // Pointer Move - \n    wrapperEl.onpointermove = function (e) {\n      if (!isPanning || e.pointerId !== activePointerId) return;\n      const dx = e.clientX - panStartX;\n      const dy = e.clientY - panStartY;\n      const rect = svgEl.getBoundingClientRect();\n      panX = panStartPanX + (dx / rect.width) * 800;\n      panY = panStartPanY + (dy / rect.height) * 600;\n      updateTransform();\n    };\n\n    // Pointer Up - \n    wrapperEl.onpointerup = function (e) {\n      if (e.pointerId === activePointerId) {\n        wrapperEl.releasePointerCapture(e.pointerId);\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // Pointer Cancel - \n    wrapperEl.onpointercancel = function (e) {\n      if (e.pointerId === activePointerId) {\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // \n    wrapperEl.onwheel = function (e) {\n      e.preventDefault();\n      const delta = e.deltaY > 0 ? -0.15 : 0.15;\n      zoomTo(scale + delta);\n    };\n\n    // \n    wrapperEl.addEventListener(\n      'touchstart',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          isPanning = false;\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener(\n      'touchmove',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            zoomTo(scale * (newDist / lastPinchDist));\n          }\n          lastPinchDist = newDist;\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener('touchend', function (e) {\n      if (e.touches.length < 2) lastPinchDist = 0;\n    });\n\n    // \n    const cleanupEvents = () => {\n      wrapperEl.onpointerdown = null;\n      wrapperEl.onpointermove = null;\n      wrapperEl.onpointerup = null;\n      wrapperEl.onpointercancel = null;\n      wrapperEl.onwheel = null;\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n      $(document).off('click.slider-hide');\n    };\n\n    // \n    const $nodeSizeSlider = overlay.find('#node-size-slider');\n    const $sliderSizeDisplay = overlay.find('#slider-size-display');\n    const $sliderContainer = overlay.find('.acu-node-size-slider-container');\n    const $nodeSizeDisplayTrigger = overlay.find('#node-size-display-trigger');\n    const $legend = overlay.find('.acu-graph-legend');\n\n    let sliderVisible = false;\n    let sliderHideTimer: ReturnType<typeof setTimeout> | null = null;\n    const SLIDER_AUTO_HIDE_DELAY = 4000; // 4\n\n    // \n    const showSlider = () => {\n      if (sliderVisible) return;\n\n      // \n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = true;\n\n      // \"\"wrappertriggerlegendlegendwrapper\n      // getBoundingClientRectviewport\n      const triggerRect = $nodeSizeDisplayTrigger[0].getBoundingClientRect();\n      const wrapperRect = $wrapper[0].getBoundingClientRect();\n\n      // wrappertrigger\n      const sliderHeight = 60; // \n      const top = wrapperRect.height - sliderHeight - 10; // wrapper\n      const left = triggerRect.left - wrapperRect.left;\n\n      $sliderContainer.css({\n        display: 'block',\n        top: `${top}px`,\n        left: `${left}px`,\n      });\n\n      // \n      resetSliderHideTimer();\n    };\n\n    // \n    const hideSlider = () => {\n      if (!sliderVisible) return;\n\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n        sliderHideTimer = null;\n      }\n\n      sliderVisible = false;\n      $sliderContainer.hide();\n    };\n\n    // \n    const resetSliderHideTimer = () => {\n      if (sliderHideTimer) {\n        clearTimeout(sliderHideTimer);\n      }\n      sliderHideTimer = setTimeout(() => {\n        hideSlider();\n      }, SLIDER_AUTO_HIDE_DELAY);\n    };\n\n    // \"\"/\n    overlay.on('click', '#node-size-display-trigger, #node-size-display-trigger *', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        hideSlider();\n      } else {\n        showSlider();\n      }\n    });\n\n    // \n    $nodeSizeSlider.on('input mousedown touchstart', function (e) {\n      e.stopPropagation();\n      if (sliderVisible) {\n        resetSliderHideTimer();\n      }\n    });\n\n    // \n    $sliderContainer.on('pointerdown mousedown touchstart', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $(document).on('click.slider-hide', function (e) {\n      if (\n        sliderVisible &&\n        !$sliderContainer.is(e.target) &&\n        $sliderContainer.has(e.target).length === 0 &&\n        !$nodeSizeDisplayTrigger.is(e.target) &&\n        $nodeSizeDisplayTrigger.has(e.target).length === 0\n      ) {\n        hideSlider();\n      }\n    });\n\n    $nodeSizeSlider.on('input', function () {\n      nodeSizeMultiplier = parseFloat($(this).val());\n      $sliderSizeDisplay.text(Math.round(nodeSizeMultiplier * 100) + '%');\n      updateNodeSizeDisplay();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n      render();\n\n      // \n      resetSliderHideTimer();\n    });\n\n    //  toggle \n    const $filterInSceneBtn = overlay.find('#filter-in-scene');\n    const $filterDirectOnlyBtn = overlay.find('#filter-direct-only');\n\n    const updateFilterToggleStyles = () => {\n      $filterInSceneBtn.css({\n        background: filterInScene ? t.accent : t.btnBg,\n        color: filterInScene ? t.btnActiveText : t.textMain,\n        borderColor: filterInScene ? t.accent : t.border,\n      });\n      $filterDirectOnlyBtn.css({\n        background: filterDirectOnly ? t.accent : t.btnBg,\n        color: filterDirectOnly ? t.btnActiveText : t.textMain,\n        borderColor: filterDirectOnly ? t.accent : t.border,\n      });\n    };\n\n    // \n    updateFilterToggleStyles();\n\n    $filterInSceneBtn.click(function (e) {\n      e.stopPropagation();\n      filterInScene = !filterInScene;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    $filterDirectOnlyBtn.click(function (e) {\n      e.stopPropagation();\n      filterDirectOnly = !filterDirectOnly;\n      updateFilterToggleStyles();\n      render();\n    });\n\n    //  +  + \n    overlay.find('#graph-zoom-reset').click(() => {\n      // \n      scale = 1;\n      panX = 0;\n      panY = 0;\n      updateTransform();\n\n      // \n      nodeSizeMultiplier = 1.0;\n      $nodeSizeSlider.val(1.0);\n      $sliderSizeDisplay.text('100%');\n      updateNodeSizeDisplay();\n\n      // stepper\n      const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n      if ($nodeSizeStepper.length) {\n        $nodeSizeStepper.find('.acu-stepper-value').text('100%');\n      }\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      if (!loadLayoutCache()) {\n        // \n        runForceDirectedLayout();\n      }\n      render();\n    });\n\n    // Stepper  - \n    const $nodeSizeStepper = overlay.find('.acu-stepper[data-id=\"graph-node-size\"]');\n    if ($nodeSizeStepper.length) {\n      const min = parseInt($nodeSizeStepper.data('min')); // 50\n      const max = parseInt($nodeSizeStepper.data('max')); // 200\n      const step = parseInt($nodeSizeStepper.data('step')); // 10\n      const $value = $nodeSizeStepper.find('.acu-stepper-value');\n\n      const updateNodeSizeValue = (newPercent: number) => {\n        newPercent = Math.max(min, Math.min(max, newPercent));\n        nodeSizeMultiplier = newPercent / 100; //  (0.5-2.0)\n        $value.text(`${newPercent}%`);\n        updateNodeSizeDisplay();\n\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      };\n\n      const getCurrentPercent = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || 100;\n      };\n\n      $nodeSizeStepper.find('.acu-stepper-dec').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() - step);\n      });\n\n      $nodeSizeStepper.find('.acu-stepper-inc').on('click', function () {\n        updateNodeSizeValue(getCurrentPercent() + step);\n      });\n    }\n\n    // \n    overlay.find('#graph-relayout').click(() => {\n      // \n      clearLayoutCache();\n\n      // \n      nodeArr.forEach(node => {\n        node.radius = getNodeRadius(node.name, node.isPlayer);\n      });\n\n      // \n      runForceDirectedLayout();\n      render();\n    });\n\n    overlay.find('#graph-manage-avatar').click(() => {\n      // \n      showAvatarManager(nodeArr, () => {\n        // \n        nodeArr.forEach(node => {\n          node.radius = getNodeRadius(node.name, node.isPlayer);\n        });\n        render();\n      });\n    });\n\n    const closeGraph = () => {\n      cleanupEvents();\n      overlay.remove();\n    };\n    overlay.find('.acu-graph-close').click(closeGraph);\n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-relation-graph-overlay')) closeGraph();\n    });\n  };\n  // ========================================\n  //  - PC/\n  // ========================================\n\n  const showAvatarCropModal = (imageSource, characterName, onSave) => {\n    const { $ } = getCore();\n    $('.acu-crop-modal-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // \n    let scale = 150;\n    let offsetX = 50;\n    let offsetY = 50;\n\n    // \n    const existing = AvatarManager.getAll()[characterName];\n    if (existing) {\n      scale = existing.scale ?? 150;\n      offsetX = existing.offsetX ?? 50;\n      offsetY = existing.offsetY ?? 50;\n    }\n\n    const modalHtml = `\n            <div class=\"acu-crop-modal-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-crop-modal\">\n                    <div class=\"acu-crop-header\">\n                        <span><i class=\"fa-solid fa-crop-simple\"></i>  - ${escapeHtml(characterName)}</span>\n                        <button class=\"acu-crop-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-crop-body\">\n                        <div class=\"acu-crop-container\">\n                            <div class=\"acu-crop-image\" style=\"\n                                background-image: url('${imageSource}');\n                                background-size: ${scale}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                            \"></div>\n                            <div class=\"acu-crop-mask\"></div>\n                        </div>\n                        <div class=\"acu-crop-hint\">  /</div>\n                    </div>\n                    <div class=\"acu-crop-footer\">\n                        <label class=\"acu-crop-btn acu-crop-reupload\" title=\"\">\n                            <i class=\"fa-solid fa-camera\"></i>\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-crop-file-input\" style=\"display:none;\" />\n                        </label>\n                        <button class=\"acu-crop-btn acu-crop-cancel\"></button>\n                        <button class=\"acu-crop-btn acu-crop-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      'z-index': '2147483658',\n    });\n\n    const $image = $modal.find('.acu-crop-image');\n    const $container = $modal.find('.acu-crop-container');\n    const containerEl = $container[0];\n    const imageEl = $image[0];\n\n    // \n    const updateImageStyle = () => {\n      imageEl.style.backgroundSize = `${scale}%`;\n      imageEl.style.backgroundPosition = `${offsetX}% ${offsetY}%`;\n    };\n\n    // ===  Pointer Events  ===\n    let isDragging = false;\n    let startX = 0,\n      startY = 0;\n    let startOffsetX = 0,\n      startOffsetY = 0;\n    let activePointerId = null;\n\n    imageEl.addEventListener('pointerdown', e => {\n      // \n      if (activePointerId !== null) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      isDragging = true;\n      activePointerId = e.pointerId;\n      startX = e.clientX;\n      startY = e.clientY;\n      startOffsetX = offsetX;\n      startOffsetY = offsetY;\n\n      imageEl.setPointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grabbing';\n    });\n\n    imageEl.addEventListener('pointermove', e => {\n      if (!isDragging || e.pointerId !== activePointerId) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      const deltaX = e.clientX - startX;\n      const deltaY = e.clientY - startY;\n\n      // \n      const sensitivity = 100 / scale;\n      offsetX = Math.max(0, Math.min(100, startOffsetX - deltaX * sensitivity));\n      offsetY = Math.max(0, Math.min(100, startOffsetY - deltaY * sensitivity));\n      updateImageStyle();\n    });\n\n    imageEl.addEventListener('pointerup', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.releasePointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grab';\n    });\n\n    imageEl.addEventListener('pointercancel', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.style.cursor = 'grab';\n    });\n\n    // ===  ===\n    // \n    containerEl.addEventListener(\n      'wheel',\n      e => {\n        e.preventDefault();\n        e.stopPropagation();\n        const delta = e.deltaY > 0 ? -10 : 10;\n        scale = Math.max(100, Math.min(300, scale + delta));\n        updateImageStyle();\n      },\n      { passive: false },\n    );\n\n    // \n    let lastPinchDist = 0;\n    let pinchStartScale = scale;\n\n    containerEl.addEventListener(\n      'touchstart',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          pinchStartScale = scale;\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener(\n      'touchmove',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            const pinchRatio = newDist / lastPinchDist;\n            scale = Math.max(100, Math.min(300, pinchStartScale * pinchRatio));\n            updateImageStyle();\n          }\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener('touchend', e => {\n      if (e.touches.length < 2) {\n        lastPinchDist = 0;\n        pinchStartScale = scale;\n      }\n    });\n\n    // ===  ===\n    // \n    $modal.find('.acu-crop-file-input').on('change', async function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      if (!file.type.startsWith('image/')) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        if (window.toastr) window.toastr.warning(' 5MB');\n        return;\n      }\n\n      try {\n        // \n        const success = await AvatarManager.saveLocalAvatar(characterName, file);\n        if (success) {\n          //  URL \n          const newUrl = await LocalAvatarDB.get(characterName);\n          imageSource = newUrl;\n\n          // \n          scale = 150;\n          offsetX = 50;\n          offsetY = 50;\n\n          // \n          $image.css('background-image', `url('${newUrl}')`);\n          updateImageStyle();\n        }\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n\n      $(this).val('');\n    });\n    $modal.find('.acu-crop-close, .acu-crop-cancel').on('click', () => {\n      $modal.remove();\n    });\n\n    $modal.find('.acu-crop-confirm').on('click', () => {\n      onSave({ scale, offsetX, offsetY });\n      $modal.remove();\n    });\n\n    // \n    $modal.on('click', e => {\n      if ($(e.target).hasClass('acu-crop-modal-overlay')) {\n        $modal.remove();\n      }\n    });\n  };\n  //  - \n  const showAvatarManager = (nodeArr, onUpdate) => {\n    try {\n      const { $ } = getCore();\n      $('.acu-avatar-manager-overlay').remove();\n\n      const config = getConfig();\n      const t = getThemeColors();\n      const avatars = AvatarManager.getAll();\n\n      // {{user}}\n      const resolveUserPlaceholderForAvatar = name => {\n        if (!name) return name;\n        const playerName = getPlayerName();\n        const personaName = getPersonaName();\n\n        // \n        const explicitUserVariants = ['<user>', '{{user}}'];\n        const isExplicitUserVariant = explicitUserVariants.some(\n          v => name === v || name.toLowerCase() === v.toLowerCase(),\n        );\n\n        // persona\n        const isPersonaName = personaName && name === personaName;\n\n        // \"\"\n        const isPlayerName = (() => {\n          if (!playerName) return false;\n          // \n          if (name === playerName) return true;\n          // \n          const primaryName = AvatarManager.getPrimaryName(name);\n          return primaryName === playerName;\n        })();\n\n        // {{user}}\n        if (isExplicitUserVariant || isPersonaName || isPlayerName) {\n          return '{{user}}';\n        }\n\n        // \n        return AvatarManager.getPrimaryName(name);\n      };\n\n      // \n      const buildList = async () => {\n        let listHtml = '';\n\n        // {{user}}\n        const userNode = nodeArr.find(n => {\n          const resolved = resolveUserPlaceholderForAvatar(n.name);\n          return resolved === '{{user}}';\n        });\n        const otherNodes = nodeArr.filter(n => {\n          const resolved = resolveUserPlaceholderForAvatar(n.name);\n          return resolved !== '{{user}}';\n        });\n\n        // {{user}}\n        if (userNode) {\n          // {{user}}'{{user}}'\n          const userNodeForDisplay = {\n            ...userNode,\n            name: '{{user}}', // {{user}}\n          };\n\n          const data = avatars[userNodeForDisplay.name] || {};\n          let currentUrl = data.url || '';\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(userNodeForDisplay.name);\n          let displayUrl = '';\n          let sourceLabel = '';\n\n          if (hasLocal) {\n            displayUrl = await LocalAvatarDB.get(userNodeForDisplay.name);\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n          } else if (currentUrl) {\n            displayUrl = currentUrl;\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n          }\n\n          const aliases = (data.aliases || []).join(', ');\n          const hasAvatar = !!displayUrl;\n\n          listHtml += `\n                    <div class=\"acu-avatar-item\" data-name=\"${escapeHtml(userNodeForDisplay.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <div class=\"acu-avatar-preview-wrap\">\n                            <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" style=\"${hasAvatar ? `background-image: url('${displayUrl}'); background-position: ${data.offsetX ?? 50}% ${data.offsetY ?? 50}%; background-size: ${data.scale ?? 150}%;` : ''}\">\n                                ${!hasAvatar ? `<span>${escapeHtml(userNodeForDisplay.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                            </div>\n                            ${sourceLabel}\n                        </div>\n                        <div class=\"acu-avatar-info\">\n                            <div class=\"acu-avatar-name-row\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(userNodeForDisplay.name)}</div>\n                                <div class=\"acu-avatar-actions\">\n                                    <button class=\"acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                    <button class=\"acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                </div>\n                            </div>\n                            <input type=\"text\" class=\"acu-avatar-url\" placeholder=\"URL...\" value=\"${escapeHtml(currentUrl)}\" />\n                            <input type=\"text\" class=\"acu-avatar-aliases\" placeholder=\"...\" value=\"${escapeHtml(aliases)}\" title=\": , \" />\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none;\" />\n                        </div>\n                    </div>\n                `;\n        }\n\n        // \n        for (const node of otherNodes) {\n          const data = avatars[node.name] || {};\n          let currentUrl = data.url || '';\n\n          // \n          const hasLocal = await AvatarManager.hasLocalAvatar(node.name);\n          let displayUrl = '';\n          let sourceLabel = '';\n\n          if (hasLocal) {\n            displayUrl = await LocalAvatarDB.get(node.name);\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n          } else if (currentUrl) {\n            displayUrl = currentUrl;\n            sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n          }\n\n          const aliases = (data.aliases || []).join(', ');\n          const hasAvatar = !!displayUrl;\n\n          listHtml += `\n                    <div class=\"acu-avatar-item\" data-name=\"${escapeHtml(node.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <div class=\"acu-avatar-preview-wrap\">\n                            <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" style=\"${hasAvatar ? `background-image: url('${displayUrl}'); background-position: ${data.offsetX ?? 50}% ${data.offsetY ?? 50}%; background-size: ${data.scale ?? 150}%;` : ''}\">\n                                ${!hasAvatar ? `<span>${escapeHtml(node.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                            </div>\n                            ${sourceLabel}\n                        </div>\n                        <div class=\"acu-avatar-info\">\n                            <div class=\"acu-avatar-name-row\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(node.name)}</div>\n                                <div class=\"acu-avatar-actions\">\n                                    <button class=\"acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                    <button class=\"acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                </div>\n                            </div>\n                            <input type=\"text\" class=\"acu-avatar-url\" placeholder=\"URL...\" value=\"${escapeHtml(currentUrl)}\" />\n                            <input type=\"text\" class=\"acu-avatar-aliases\" placeholder=\"...\" value=\"${escapeHtml(aliases)}\" title=\": , \" />\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none;\" />\n                        </div>\n                    </div>\n                `;\n        }\n\n        return listHtml;\n      };\n\n      // \n      const managerHtml = `\n            <div class=\"acu-avatar-manager-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-avatar-manager\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-avatar-title\"><i class=\"fa-solid fa-user-circle\"></i> </div>\n                        <div style=\"display:flex;gap:4px;align-items:center;\">\n                            <button class=\"acu-avatar-import-btn\" title=\"\"><i class=\"fa-solid fa-file-import\"></i></button>\n                            <button class=\"acu-avatar-export-btn\" title=\"\"><i class=\"fa-solid fa-file-export\"></i></button>\n                            <button class=\"acu-avatar-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-avatar-list\" id=\"acu-avatar-list-container\">\n                        <div style=\"text-align:center;padding:20px;color:${t.textSub};\">\n                            <i class=\"fa-solid fa-spinner fa-spin\"></i> ...\n                        </div>\n                    </div>\n                </div>\n                <input type=\"file\" id=\"acu-avatar-file-input\" accept=\".json\" style=\"display:none;\" />\n            </div>\n        `;\n\n      const $manager = $(managerHtml);\n      $('body').append($manager);\n\n      // \n      buildList().then(listHtml => {\n        $manager.find('#acu-avatar-list-container').html(listHtml);\n        bindAvatarEvents();\n      });\n\n      // \n      const refreshItem = async name => {\n        const $item = $manager.find(`.acu-avatar-item[data-name=\"${name}\"]`);\n        if (!$item.length) return;\n\n        const data = AvatarManager.getAll()[name] || {};\n        const hasLocal = await AvatarManager.hasLocalAvatar(name);\n        let displayUrl = '';\n        let sourceLabel = '';\n\n        if (hasLocal) {\n          displayUrl = await LocalAvatarDB.get(name);\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n        } else if (data.url) {\n          displayUrl = data.url;\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n        }\n\n        const $preview = $item.find('.acu-avatar-preview');\n        $item.find('.acu-avatar-source').remove();\n\n        if (displayUrl) {\n          $preview\n            .addClass('has-image')\n            .css({\n              'background-image': `url('${displayUrl}')`,\n              'background-position': `${data.offsetX ?? 50}% ${data.offsetY ?? 50}%`,\n              'background-size': `${data.scale ?? 150}%`,\n            })\n            .find('span')\n            .remove();\n          $item.find('.acu-avatar-preview-wrap').append(sourceLabel);\n        } else {\n          $preview\n            .removeClass('has-image')\n            .css({ 'background-image': '', 'background-position': '', 'background-size': '' })\n            .html(\n              `<span>${escapeHtml(name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>`,\n            );\n        }\n\n        $item.attr('data-has-local', hasLocal);\n        $item.attr('data-display-url', displayUrl);\n      };\n\n      const bindAvatarEvents = () => {\n        // \n        $manager.on('click', '.acu-avatar-preview', async function (e) {\n          e.stopPropagation();\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const displayUrl = $item.attr('data-display-url');\n\n          if (displayUrl) {\n            //   \n            showAvatarCropModal(displayUrl, name, async result => {\n              const data = AvatarManager.getAll()[name] || {};\n              AvatarManager.set(name, data.url || '', result.offsetX, result.offsetY, result.scale, data.aliases || []);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          } else {\n            //   \n            $item.find('.acu-avatar-file-input').click();\n          }\n        });\n\n        // \n        $manager.on('change', '.acu-avatar-file-input', async function (e) {\n          const file = e.target.files[0];\n          if (!file) return;\n\n          if (!file.type.startsWith('image/')) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          if (file.size > 5 * 1024 * 1024) {\n            if (window.toastr) window.toastr.warning(' 5MB');\n            return;\n          }\n\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n\n          try {\n            const success = await AvatarManager.saveLocalAvatar(name, file);\n            if (success) {\n              const newUrl = await LocalAvatarDB.get(name);\n              await refreshItem(name);\n\n              // \n              showAvatarCropModal(newUrl, name, async result => {\n                const data = AvatarManager.getAll()[name] || {};\n                AvatarManager.set(\n                  name,\n                  data.url || '',\n                  result.offsetX,\n                  result.offsetY,\n                  result.scale,\n                  data.aliases || [],\n                );\n                await refreshItem(name);\n                onUpdate && onUpdate();\n              });\n            }\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            if (window.toastr) window.toastr.error('');\n          }\n\n          $(this).val('');\n        });\n\n        // URL  \n        $manager.on('click', '.acu-avatar-save-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n          const url = $item.find('.acu-avatar-url').val().trim();\n          const aliasesStr = $item.find('.acu-avatar-aliases').val().trim();\n          const aliases = aliasesStr\n            ? aliasesStr\n                .split(/[,]/)\n                .map(s => s.trim())\n                .filter(s => s && s !== name)\n            : [];\n\n          const data = AvatarManager.getAll()[name] || {};\n\n          // \n          AvatarManager.set(name, url, data.offsetX ?? 50, data.offsetY ?? 50, data.scale ?? 150, aliases);\n\n          // URL\n          const hasLocal = $item.attr('data-has-local') === 'true';\n          if (url && !hasLocal) {\n            await refreshItem(name);\n            showAvatarCropModal(url, name, async result => {\n              AvatarManager.set(name, url, result.offsetX, result.offsetY, result.scale, aliases);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          } else {\n            await refreshItem(name);\n            onUpdate && onUpdate();\n          }\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-clear-btn', async function () {\n          const $item = $(this).closest('.acu-avatar-item');\n          const name = $item.data('name');\n\n          await AvatarManager.deleteLocalAvatar(name);\n          AvatarManager.remove(name);\n\n          $item.find('.acu-avatar-url').val('');\n          $item.find('.acu-avatar-aliases').val('');\n          await refreshItem(name);\n          onUpdate && onUpdate();\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-export-btn', function () {\n          const exportData = AvatarManager.exportData();\n          const jsonStr = JSON.stringify(exportData, null, 2);\n          const blob = new Blob([jsonStr], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `avatar-config-${new Date().toISOString().slice(0, 10)}.json`;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        });\n\n        // \n        $manager.on('click', '.acu-avatar-import-btn', function () {\n          $manager.find('#acu-avatar-file-input').click();\n        });\n\n        $manager.on('change', '#acu-avatar-file-input', function (e) {\n          const file = e.target.files[0];\n          if (!file) return;\n\n          const reader = new FileReader();\n          reader.onload = function (evt) {\n            try {\n              const jsonData = JSON.parse(evt.target.result);\n              const analysis = AvatarManager.analyzeImport(jsonData);\n\n              if (!analysis.valid) {\n                if (window.toastr) window.toastr.error(analysis.error);\n                return;\n              }\n\n              showImportConfirmDialog(jsonData, analysis, () => {\n                $manager.remove();\n                showAvatarManager(nodeArr, onUpdate);\n                onUpdate && onUpdate();\n              });\n            } catch (err) {\n              console.error('[DICE]ACU :', err);\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n          reader.readAsText(file);\n          $(this).val('');\n        });\n      };\n\n      // \n      const closeManager = () => $manager.remove();\n      $manager.on('click', '.acu-avatar-close', closeManager);\n      $manager.on('click', function (e) {\n        if ($(e.target).hasClass('acu-avatar-manager-overlay')) closeManager();\n      });\n    } catch (error) {\n      console.error(':', error);\n      if (window.toastr) {\n        const errorMsg = error instanceof Error ? error.message : '';\n        window.toastr.error(`: ${errorMsg}`);\n      }\n      // DOM\n      $('.acu-avatar-manager-overlay').remove();\n    }\n  };\n\n  // \n  const showImportConfirmDialog = (jsonData, analysis, onComplete) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const t = getThemeColors();\n    const config = getConfig();\n\n    const hasConflicts = analysis.conflicts.length > 0;\n    const conflictListHtml =\n      analysis.conflicts.length > 0\n        ? `<div style=\"max-height:80px;overflow-y:auto;background:rgba(0,0,0,0.1);border-radius:4px;padding:6px 8px;margin-top:6px;font-size:11px;color:${t.textSub};\">${analysis.conflicts.map(n => escapeHtml(n)).join(', ')}</div>`\n        : '';\n\n    const dialogHtml = `\n            <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-import-confirm-dialog\">\n                    <div class=\"acu-import-confirm-header\">\n                        <i class=\"fa-solid fa-file-import\"></i> \n                    </div>\n                    <div class=\"acu-import-confirm-body\">\n                        <div class=\"acu-import-stats\">\n                            <div class=\"acu-import-stat\">\n                                <span class=\"acu-stat-num\">${analysis.total}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-new\">\n                                <span class=\"acu-stat-num\">${analysis.newItems.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-conflict\">\n                                <span class=\"acu-stat-num\">${analysis.conflicts.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                        </div>\n\n                        ${\n                          hasConflicts\n                            ? `\n                            <div class=\"acu-import-conflict-section\">\n                                <div style=\"font-size:12px;font-weight:bold;color:${t.textMain};margin-bottom:4px;\">\n                                    <i class=\"fa-solid fa-exclamation-triangle\" style=\"color:${t.warningIcon};\"></i> \n                                </div>\n                                ${conflictListHtml}\n                                <div class=\"acu-import-conflict-options\">\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"overwrite\" checked />\n                                        <span></span>\n                                    </label>\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"skip\" />\n                                        <span></span>\n                                    </label>\n                                </div>\n                            </div>\n                        `\n                            : `\n                            <div style=\"text-align:center;padding:10px;color:${t.successText};\">\n                                <i class=\"fa-solid fa-check-circle\"></i> \n                            </div>\n                        `\n                        }\n                    </div>\n                    <div class=\"acu-import-confirm-footer\">\n                        <button class=\"acu-import-cancel-btn\"></button>\n                        <button class=\"acu-import-confirm-btn\"></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n            position: fixed !important;\n            top: 0 !important;\n            left: 0 !important;\n            right: 0 !important;\n            bottom: 0 !important;\n            width: 100vw !important;\n            height: 100vh !important;\n            background: rgba(0,0,0,0.6) !important;\n            z-index: 2147483655 !important;\n            display: flex;\n            justify-content: center !important;\n            align-items: center !important;\n            padding: 16px;\n            box-sizing: border-box !important;\n        `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(closeDialog);\n    $dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-import-confirm-overlay')) closeDialog();\n    });\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const overwrite = $dialog.find('input[name=\"conflict-mode\"]:checked').val() !== 'skip';\n      try {\n        const stats = AvatarManager.importData(jsonData, overwrite);\n        closeDialog();\n        onComplete && onComplete();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + err.message);\n      }\n    });\n  };\n  // []  ()\n  const showCardEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    let rawData = cachedRawData || getTableData() || loadSnapshot();\n\n    let displayRow = row;\n    // \n    if (rawData && rawData[tableKey] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n      displayRow = rawData[tableKey]?.content?.[rowIndex + 1];\n    }\n\n    const inputsHtml = displayRow\n      .map((cell, idx) => {\n        if (idx === 0) return ''; // \n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        //  textarea\n        return `\n                <div class=\"acu-card-edit-field\" style=\"margin-bottom: 10px;\">\n                    <label style=\"display:block;font-size:12px;color:var(--acu-accent);font-weight:bold;margin-bottom:4px;\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\"\n                    style=\"width:100%;min-height:40px;max-height:500px;padding:10px;resize:none;overflow-y:hidden;\">${escapeHtml(val)}</textarea>\n                </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${inputsHtml}\n                    </div>\n                     <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-card-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-card-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // --- []  ---\n    const adjustHeight = el => {\n      //  auto  0px shrinking  scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    // -----------------------------\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-card-cancel').click(closeDialog);\n\n    //  v8.4  saveDataToDatabase\n    dialog.find('#dlg-card-save').click(async () => {\n      let rawData = cachedRawData || getTableData() || loadSnapshot();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n        if (hasChanges) {\n          try {\n            await saveDataToDatabase(rawData, false, true); //  v8.4 \n            renderInterface();\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            // \n            return;\n          }\n        }\n      }\n      closeDialog();\n    });\n    dialog.on('click', function (e) {\n      // \n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        closeDialog();\n        return;\n      }\n      // \n      if ($(e.target).closest('#dlg-close-x, #dlg-close, .acu-close-btn').length) {\n        closeDialog();\n      }\n    });\n  };\n\n  // [] \n  let _configCache = null;\n  const getConfig = () => {\n    if (!_configCache) _configCache = { ...DEFAULT_CONFIG, ...Store.get(STORAGE_KEY_UI_CONFIG, {}) };\n    return _configCache;\n  };\n  const saveConfig = newCfg => {\n    _configCache = { ...getConfig(), ...newCfg };\n    Store.set(STORAGE_KEY_UI_CONFIG, _configCache);\n    applyConfigStyles(_configCache);\n  };\n\n  const generateDiffMap = currentData => {\n    const lastData = loadSnapshot();\n    const diffSet = new Set();\n    if (!lastData) return diffSet;\n\n    for (const sheetId in currentData) {\n      const newSheet = currentData[sheetId];\n      const oldSheet = lastData[sheetId];\n      if (!newSheet || !newSheet.name) continue;\n      const tableName = newSheet.name;\n      if (!oldSheet) {\n        if (newSheet.content) {\n          newSheet.content.forEach((row, rIdx) => {\n            if (rIdx > 0) diffSet.add(`${tableName}-row-${rIdx - 1}`);\n          });\n        }\n        continue;\n      }\n      const newRows = newSheet.content || [];\n      const oldRows = oldSheet.content || [];\n      newRows.forEach((row, rIdx) => {\n        if (rIdx === 0) return;\n        const oldRow = oldRows[rIdx];\n        if (!oldRow) {\n          diffSet.add(`${tableName}-row-${rIdx - 1}`);\n        } else {\n          row.forEach((cell, cIdx) => {\n            if (cIdx === 0) return;\n            const oldCell = oldRow[cIdx];\n            if (String(cell) !== String(oldCell)) diffSet.add(`${tableName}-${rIdx - 1}-${cIdx}`);\n          });\n        }\n      });\n    }\n    return diffSet;\n  };\n\n  const applyConfigStyles = config => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    const fontVal = FONTS.find(f => f.id === config.fontFamily)?.val || FONTS[0].val;\n\n    // []  ID  Style \n    const $styleTag = $('#acu-dynamic-font');\n    const currentFontId = $styleTag.data('font-id');\n\n    if (currentFontId !== config.fontFamily) {\n      $styleTag.remove();\n      const fontImport = `\n                @import url(\"https://fontsapi.zeoseven.com/3/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/442/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/256/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/482/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/446/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/570/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/292/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/69/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/7/main/result.css\");\n            `;\n      $('head').append(`\n                <style id=\"acu-dynamic-font\" data-font-id=\"${config.fontFamily}\">\n                    ${fontImport}\n                    .acu-wrapper, .acu-edit-dialog, .acu-cell-menu, .acu-nav-container, .acu-data-card, .acu-panel-title, .acu-settings-label, .acu-btn-block, .acu-nav-btn, .acu-edit-textarea,\n                    .acu-dice-panel, .acu-contest-panel, .acu-dice-config-dialog,\n                    .acu-relation-graph-container, .acu-avatar-manager, .acu-import-confirm-dialog {\n                        font-family: ${fontVal} !important;\n                    }\n                </style>\n            `);\n    }\n\n    // []  CSS \n    const cssVars = {\n      '--acu-card-width': `${config.cardWidth}px`,\n      '--acu-font-size': `${config.fontSize}px`,\n      '--acu-opt-font-size': `${config.optionFontSize || 12}px`,\n      '--acu-grid-cols': config.gridColumns,\n    };\n\n    if ($wrapper.length) {\n      $wrapper.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $wrapper.addClass(`acu-theme-${config.theme}`);\n      $wrapper.css(cssVars);\n    }\n\n    const $optContainer = $('.acu-embedded-options-container');\n    if ($optContainer.length) {\n      $optContainer.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $optContainer.addClass(`acu-theme-${config.theme}`);\n      $optContainer.css(cssVars);\n    }\n  };\n\n  const addStyles = () => {\n    if (window._acuStylesInjected && $(`#${SCRIPT_ID}-styles`).length) return;\n    window._acuStylesInjected = true;\n    const { $ } = getCore();\n    $('style').each(function () {\n      if (this.id && this.id.startsWith('acu_') && this.id.endsWith('-styles') && this.id !== `${SCRIPT_ID}-styles`)\n        $(this).remove();\n    });\n    $(`#${SCRIPT_ID}-styles`).remove();\n    const styles = `\n        <style id=\"${SCRIPT_ID}-styles\">\n    /* ==========  ========== */\n    .acu-wrapper,\n    .acu-wrapper *:not(i[class*=\"fa-\"]),\n    .acu-edit-overlay,\n    .acu-edit-overlay *:not(i[class*=\"fa-\"]),\n    .acu-cell-menu,\n    .acu-cell-menu *:not(i[class*=\"fa-\"]),\n    .acu-dice-panel,\n    .acu-dice-panel *:not(i[class*=\"fa-\"]),\n    .acu-contest-panel,\n    .acu-contest-panel *:not(i[class*=\"fa-\"]),\n    .acu-relation-graph-overlay,\n    .acu-relation-graph-overlay *:not(i[class*=\"fa-\"]),\n    .acu-avatar-manager-overlay,\n    .acu-avatar-manager-overlay *:not(i[class*=\"fa-\"]),\n    .acu-preview-overlay,\n    .acu-preview-overlay *:not(i[class*=\"fa-\"]),\n    .acu-import-confirm-overlay,\n    .acu-import-confirm-overlay *:not(i[class*=\"fa-\"]),\n    .acu-embedded-options-container,\n    .acu-embedded-options-container *:not(i[class*=\"fa-\"]) {\n        box-sizing: border-box;\n        -webkit-tap-highlight-color: transparent;\n        -webkit-font-smoothing: antialiased;\n    }\n    /* ==========  ========== */\n    .acu-wrapper,\n    .acu-edit-overlay,\n    .acu-dice-panel,\n    .acu-contest-panel,\n    .acu-relation-graph-overlay,\n    .acu-avatar-manager-overlay,\n    .acu-preview-overlay,\n    .acu-import-confirm-overlay,\n    .acu-embedded-options-container,\n    .acu-cell-menu {\n        font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;\n        font-size: 13px;\n        line-height: 1.5;\n        color: var(--acu-text-main);\n    }\n    /*  ( !important  SillyTavern ) */\n    .acu-dice-panel,\n    .acu-contest-panel,\n    .acu-dice-config-dialog {\n        background: var(--acu-bg-panel);\n        color: var(--acu-text-main);\n    }\n    .acu-dice-panel input[type=\"text\"],\n    .acu-dice-panel input[type=\"number\"],\n    .acu-dice-panel input:not([type]),\n    .acu-dice-panel select,\n    .acu-contest-panel input[type=\"text\"],\n    .acu-contest-panel input[type=\"number\"],\n    .acu-contest-panel input:not([type]),\n    .acu-contest-panel select,\n    .acu-dice-config-dialog input[type=\"text\"],\n    .acu-dice-config-dialog input[type=\"number\"],\n    .acu-dice-config-dialog input:not([type]),\n    .acu-dice-config-dialog select {\n        width: 100%;\n        padding: 6px;\n        background: var(--acu-input-bg) !important;\n        border: 1px solid var(--acu-border) !important;\n        border-radius: 4px;\n        color: var(--acu-text-main) !important;\n        font-size: 12px;\n    }\n    /* number */\n    .acu-dice-panel input[type=\"number\"]::-webkit-inner-spin-button,\n    .acu-dice-panel input[type=\"number\"]::-webkit-outer-spin-button,\n    .acu-contest-panel input[type=\"number\"]::-webkit-inner-spin-button,\n    .acu-contest-panel input[type=\"number\"]::-webkit-outer-spin-button,\n    .acu-dice-config-dialog input[type=\"number\"]::-webkit-inner-spin-button,\n    .acu-dice-config-dialog input[type=\"number\"]::-webkit-outer-spin-button {\n        -webkit-appearance: none;\n        margin: 0;\n    }\n    .acu-dice-panel input[type=\"number\"],\n    .acu-contest-panel input[type=\"number\"],\n    .acu-dice-config-dialog input[type=\"number\"] {\n        -moz-appearance: textfield;\n        text-align: center;\n        box-sizing: border-box;\n    }\n    .acu-dice-panel input::placeholder,\n    .acu-contest-panel input::placeholder,\n    .acu-dice-config-dialog input::placeholder {\n        color: var(--acu-text-sub) !important;\n        opacity: 0.7;\n    }\n    .acu-dice-panel input:focus,\n    .acu-dice-panel select:focus,\n    .acu-contest-panel input:focus,\n    .acu-contest-panel select:focus,\n    .acu-dice-config-dialog input:focus,\n    .acu-dice-config-dialog select:focus {\n        outline: none;\n        border-color: var(--acu-accent) !important;\n    }\n    .acu-dice-panel select option,\n    .acu-contest-panel select option,\n    .acu-dice-config-dialog select option {\n        background: var(--acu-bg-panel);\n        color: var(--acu-text-main);\n    }\n    /*  */\n    .acu-dice-select {\n        width: 100%;\n        padding: 6px 4px;\n        background: var(--acu-input-bg) !important;\n        border: 1px solid var(--acu-border) !important;\n        border-radius: 4px;\n        color: var(--acu-text-main) !important;\n        font-size: 11px;\n        box-sizing: border-box;\n        cursor: pointer;\n        -webkit-appearance: none;\n        text-align: center;\n        appearance: none;\n    }\n    .acu-dice-select:focus {\n        outline: none;\n        border-color: var(--acu-accent) !important;\n    }\n    .acu-dice-select option {\n        background: var(--acu-bg-panel) !important;\n        color: var(--acu-text-main) !important;\n    }\n    /*  */\n    .acu-wrapper .acu-search-input {\n        background-color: var(--acu-input-bg) !important;\n        color: var(--acu-text-main) !important;\n        border: 1px solid var(--acu-border);\n    }\n    .acu-wrapper .acu-search-input:focus {\n        outline: none;\n        border-color: var(--acu-accent);\n        box-shadow: none !important;\n    }\n    .acu-wrapper .acu-search-input::placeholder {\n        color: var(--acu-text-sub) !important;\n        opacity: 0.7;\n    }\n    /* ==========  ========== */\n    /*  */\n    .acu-wrapper button,\n    .acu-edit-overlay button,\n    .acu-dice-panel button,\n    .acu-contest-panel button,\n    .acu-relation-graph-overlay button,\n    .acu-avatar-manager-overlay button,\n    .acu-preview-overlay button,\n    .acu-embedded-options-container button {\n        font-family: inherit;\n        font-size: inherit;\n        line-height: 1.4;\n        cursor: pointer;\n        border: 1px solid var(--acu-border);\n        border-radius: 6px;\n        background: var(--acu-btn-bg);\n        color: var(--acu-text-main);\n        transition: all 0.2s ease;\n        outline: none;\n    }\n    .acu-wrapper button:hover,\n    .acu-edit-overlay button:hover,\n    .acu-dice-panel button:hover,\n    .acu-contest-panel button:hover,\n    .acu-relation-graph-overlay button:hover,\n    .acu-avatar-manager-overlay button:hover,\n    .acu-preview-overlay button:hover,\n    .acu-embedded-options-container button:hover {\n        background: var(--acu-btn-hover);\n    }\n    .acu-wrapper button:focus,\n    .acu-edit-overlay button:focus,\n    .acu-dice-panel button:focus,\n    .acu-contest-panel button:focus,\n    .acu-relation-graph-overlay button:focus,\n    .acu-avatar-manager-overlay button:focus,\n    .acu-preview-overlay button:focus,\n    .acu-embedded-options-container button:focus {\n        outline: none;\n        box-shadow: none;\n    }\n\n    /*  */\n    .acu-wrapper input,\n    .acu-wrapper textarea,\n    .acu-wrapper select,\n    .acu-edit-overlay input,\n    .acu-edit-overlay textarea,\n    .acu-edit-overlay select,\n    .acu-dice-panel input,\n    .acu-dice-panel select,\n    .acu-contest-panel input,\n    .acu-contest-panel select,\n    .acu-avatar-manager-overlay input {\n        font-family: inherit;\n        font-size: inherit;\n        line-height: 1.4;\n        border: 1px solid var(--acu-border);\n        border-radius: 4px;\n        background: var(--acu-btn-bg);\n        color: var(--acu-text-main);\n        outline: none;\n        transition: border-color 0.2s;\n    }\n    .acu-wrapper input:focus,\n    .acu-wrapper textarea:focus,\n    .acu-wrapper select:focus,\n    .acu-edit-overlay input:focus,\n    .acu-edit-overlay textarea:focus,\n    .acu-edit-overlay select:focus,\n    .acu-dice-panel input:focus,\n    .acu-dice-panel select:focus,\n    .acu-contest-panel input:focus,\n    .acu-contest-panel select:focus,\n    .acu-avatar-manager-overlay input:focus {\n        border-color: var(--acu-accent);\n        box-shadow: none;\n        outline: none;\n    }\n    .acu-wrapper input::placeholder,\n    .acu-wrapper textarea::placeholder,\n    .acu-dice-panel input::placeholder,\n    .acu-contest-panel input::placeholder,\n    .acu-avatar-manager-overlay input::placeholder {\n        color: var(--acu-text-sub);\n        opacity: 0.7;\n    }\n\n    /*  */\n    .acu-edit-overlay,\n    .acu-dice-overlay,\n    .acu-contest-overlay,\n    .acu-relation-graph-overlay,\n    .acu-avatar-manager-overlay,\n    .acu-preview-overlay,\n    .acu-import-confirm-overlay,\n    .acu-dice-config-overlay,\n    .acu-crop-modal-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0,0,0,0.6);\n        z-index: 2147483646;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 16px;\n        backdrop-filter: blur(2px);\n    }\n\n    /*  */\n    .acu-edit-dialog,\n    .acu-dice-panel,\n    .acu-contest-panel,\n    .acu-relation-graph-container,\n    .acu-avatar-manager,\n    .acu-import-confirm-dialog,\n    .acu-dice-config-dialog {\n        background: var(--acu-bg-panel);\n        border: 1px solid var(--acu-border);\n        border-radius: 12px;\n        box-shadow: 0 20px 60px rgba(0,0,0,0.4);\n        overflow: hidden;\n        display: flex;\n        flex-direction: column;\n    }\n\n    /*  -  .acu-panel-header */\n    .acu-panel-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 12px 15px;\n        background: var(--acu-table-head);\n        border-bottom: 1px solid var(--acu-border);\n        flex-shrink: 0;\n    }\n\n    /*  -  .acu-close-btn */\n    .acu-close-btn {\n        background: none;\n        border: none;\n        color: var(--acu-text-sub);\n        cursor: pointer;\n        font-size: 16px;\n        padding: 4px 8px;\n        border-radius: 4px;\n        transition: all 0.2s;\n    }\n    .acu-close-btn:hover {\n        background: var(--acu-error-bg, rgba(231, 76, 60, 0.15));\n        color: var(--acu-error-text, #e74c3c);\n    }\n\n    /*  */\n    [class^=\"acu-\"], [class^=\"acu-\"] * { scrollbar-width: none; -ms-overflow-style: none; }\n    [class^=\"acu-\"] *::-webkit-scrollbar { display: none !important; }\n\n    /* ==========  ========== */\n    .acu-theme-retro { --acu-bg-nav: #e6e2d3; --acu-bg-panel: #e6e2d3; --acu-border: #dcd0c0; --acu-text-main: #5e4b35; --acu-text-sub: #999; --acu-btn-bg: #dcd0c0; --acu-btn-hover: #cbbba8; --acu-btn-active-bg: #8d7b6f; --acu-btn-active-text: #fdfaf5; --acu-accent: #7a695f; --acu-table-head: #efebe4; --acu-table-hover: #f0ebe0; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #fffef9; --acu-badge-bg: #efebe4; --acu-menu-bg: #fff; --acu-menu-text: #333; --acu-success-text: #27ae60; --acu-success-bg: rgba(39, 174, 96, 0.15); --acu-scrollbar-track: #e6e2d3; --acu-scrollbar-thumb: #cbbba8; --acu-input-bg: #f5f2eb;--acu-hl-manual: #d35400; --acu-hl-manual-bg: rgba(211, 84, 0, 0.15); --acu-hl-diff: #2980b9; --acu-hl-diff-bg: rgba(41, 128, 185, 0.15); --acu-error-text: #e74c3c; --acu-error-bg: rgba(231, 76, 60, 0.15); --acu-error-border: rgba(231, 76, 60, 0.5); --acu-warning-icon: #e67e22; --acu-failure-text: #e74c3c; --acu-failure-bg: rgba(231, 76, 60, 0.15); --acu-warning-text: #f39c12; --acu-warning-bg: rgba(243, 156, 18, 0.15); --acu-crit-success-text: #9b59b6; --acu-crit-success-bg: rgba(155, 89, 182, 0.15); --acu-crit-failure-text: #c0392b; --acu-crit-failure-bg: rgba(192, 57, 43, 0.15); --acu-extreme-success-text: #2980b9; --acu-extreme-success-bg: rgba(41, 128, 185, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.4); --acu-light-bg: rgba(0,0,0,0.1); --acu-very-light-bg: rgba(0,0,0,0.02); --acu-button-text: #5e4b35; --acu-gray-bg: rgba(128,128,128,0.1); }\n    .acu-theme-dark { --acu-bg-nav: #2b2b2b; --acu-bg-panel: #252525; --acu-border: #444; --acu-text-main: #eee; --acu-text-sub: #aaa; --acu-btn-bg: #3a3a3a; --acu-btn-hover: #4a4a4a; --acu-btn-active-bg: #6a5acd; --acu-btn-active-text: #fff; --acu-accent: #9b8cd9; --acu-table-head: #333333; --acu-table-hover: #3a3a3a; --acu-shadow: rgba(0,0,0,0.6); --acu-card-bg: #2d3035; --acu-badge-bg: #3a3f4b; --acu-menu-bg: #333; --acu-menu-text: #eee; --acu-success-text: #4cd964; --acu-success-bg: rgba(76, 217, 100, 0.2); --acu-scrollbar-track: #2b2b2b; --acu-scrollbar-thumb: #555; --acu-hl-manual: #ff6b81; --acu-hl-manual-bg: rgba(255, 107, 129, 0.2); --acu-hl-diff: #00d2d3; --acu-hl-diff-bg: rgba(0, 210, 211, 0.2); --acu-error-text: #ff6b6b; --acu-error-bg: rgba(255, 107, 107, 0.2); --acu-error-border: rgba(255, 107, 107, 0.5); --acu-warning-icon: #ffa726; --acu-failure-text: #ff6b6b; --acu-failure-bg: rgba(255, 107, 107, 0.2); --acu-warning-text: #ffa726; --acu-warning-bg: rgba(255, 167, 38, 0.2); --acu-crit-success-text: #ba68c8; --acu-crit-success-bg: rgba(186, 104, 200, 0.2); --acu-crit-failure-text: #d32f2f; --acu-crit-failure-bg: rgba(211, 47, 47, 0.2); --acu-extreme-success-text: #42a5f5; --acu-extreme-success-bg: rgba(66, 165, 245, 0.2); --acu-overlay-bg: rgba(0,0,0,0.75); --acu-overlay-bg-light: rgba(0,0,0,0.65); --acu-shadow-bg: rgba(0,0,0,0.6); --acu-light-bg: rgba(255,255,255,0.05); --acu-very-light-bg: rgba(255,255,255,0.02); --acu-button-text: #fff; --acu-gray-bg: rgba(255,255,255,0.1); }\n    .acu-theme-modern { --acu-bg-nav: #ffffff; --acu-bg-panel: #f8f9fa; --acu-border: #e0e0e0; --acu-text-main: #333; --acu-text-sub: #666; --acu-btn-bg: #f1f3f5; --acu-btn-hover: #e9ecef; --acu-btn-active-bg: #007bff; --acu-btn-active-text: #fff; --acu-accent: #007bff; --acu-table-head: #f8f9fa; --acu-table-hover: #f1f3f5; --acu-shadow: rgba(0,0,0,0.1); --acu-card-bg: #ffffff; --acu-badge-bg: #f1f3f5; --acu-menu-bg: #fff; --acu-menu-text: #333; --acu-success-text: #28a745; --acu-success-bg: rgba(40, 167, 69, 0.15); --acu-scrollbar-track: #fff; --acu-scrollbar-thumb: #ccc; --acu-hl-manual: #fd7e14; --acu-hl-manual-bg: rgba(253, 126, 20, 0.15); --acu-hl-diff: #0d6efd; --acu-hl-diff-bg: rgba(13, 110, 253, 0.15); --acu-error-text: #dc3545; --acu-error-bg: rgba(220, 53, 69, 0.15); --acu-error-border: rgba(220, 53, 69, 0.5); --acu-warning-icon: #fd7e14; --acu-failure-text: #dc3545; --acu-failure-bg: rgba(220, 53, 69, 0.15); --acu-warning-text: #ffc107; --acu-warning-bg: rgba(255, 193, 7, 0.15); --acu-crit-success-text: #6f42c1; --acu-crit-success-bg: rgba(111, 66, 193, 0.15); --acu-crit-failure-text: #c82333; --acu-crit-failure-bg: rgba(200, 35, 51, 0.15); --acu-extreme-success-text: #17a2b8; --acu-extreme-success-bg: rgba(23, 162, 184, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.4); --acu-light-bg: rgba(0,0,0,0.1); --acu-very-light-bg: rgba(0,0,0,0.02); --acu-button-text: #333; --acu-gray-bg: rgba(128,128,128,0.1); }\n    .acu-theme-forest { --acu-bg-nav: #e8f5e9; --acu-bg-panel: #e8f5e9; --acu-border: #c8e6c9; --acu-text-main: #2e7d32; --acu-text-sub: #81c784; --acu-btn-bg: #c8e6c9; --acu-btn-hover: #a5d6a7; --acu-btn-active-bg: #43a047; --acu-btn-active-text: #fff; --acu-accent: #4caf50; --acu-table-head: #dcedc8; --acu-table-hover: #f1f8e9; --acu-shadow: rgba(0,0,0,0.1); --acu-card-bg: #ffffff; --acu-badge-bg: #dcedc8; --acu-menu-bg: #fff; --acu-menu-text: #2e7d32; --acu-success-text: #2e7d32; --acu-success-bg: rgba(46, 125, 50, 0.2); --acu-scrollbar-track: #e8f5e9; --acu-scrollbar-thumb: #a5d6a7; --acu-hl-manual: #e67e22; --acu-hl-manual-bg: rgba(230, 126, 34, 0.15); --acu-hl-diff: #1e8449; --acu-hl-diff-bg: rgba(30, 132, 73, 0.2); --acu-button-text: #2e7d32; }\n    .acu-theme-ocean { --acu-bg-nav: #e3f2fd; --acu-bg-panel: #e3f2fd; --acu-border: #90caf9; --acu-text-main: #1565c0; --acu-text-sub: #64b5f6; --acu-btn-bg: #bbdefb; --acu-btn-hover: #90caf9; --acu-btn-active-bg: #1976d2; --acu-btn-active-text: #fff; --acu-accent: #2196f3; --acu-table-head: #bbdefb; --acu-table-hover: #e1f5fe; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #ffffff; --acu-badge-bg: #e3f2fd; --acu-menu-bg: #fff; --acu-menu-text: #1565c0; --acu-success-text: #0288d1; --acu-success-bg: rgba(2, 136, 209, 0.15); --acu-scrollbar-track: #e3f2fd; --acu-scrollbar-thumb: #90caf9; --acu-hl-manual: #ff4757; --acu-hl-manual-bg: rgba(255, 71, 87, 0.15); --acu-hl-diff: #0277bd; --acu-hl-diff-bg: rgba(2, 119, 189, 0.2); --acu-error-text: #d32f2f; --acu-error-bg: rgba(211, 47, 47, 0.15); --acu-error-border: rgba(211, 47, 47, 0.5); --acu-warning-icon: #f57c00; --acu-failure-text: #d32f2f; --acu-failure-bg: rgba(211, 47, 47, 0.15); --acu-warning-text: #f57c00; --acu-warning-bg: rgba(245, 124, 0, 0.15); --acu-crit-success-text: #7b1fa2; --acu-crit-success-bg: rgba(123, 31, 162, 0.15); --acu-crit-failure-text: #b71c1c; --acu-crit-failure-bg: rgba(183, 28, 28, 0.15); --acu-extreme-success-text: #0277bd; --acu-extreme-success-bg: rgba(2, 119, 189, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.4); --acu-light-bg: rgba(0,0,0,0.1); --acu-very-light-bg: rgba(0,0,0,0.02); --acu-button-text: #1565c0; --acu-gray-bg: rgba(128,128,128,0.1); }\n    .acu-theme-cyber { --acu-bg-nav: #000000; --acu-bg-panel: #0a0a0a; --acu-border: #333; --acu-text-main: #00ffcc; --acu-text-sub: #ff00ff; --acu-btn-bg: #111; --acu-btn-hover: #222; --acu-btn-active-bg: #ff00ff; --acu-btn-active-text: #fff; --acu-accent: #00ffcc; --acu-table-head: #050505; --acu-table-hover: #111; --acu-shadow: 0 0 15px rgba(0,255,204,0.15); --acu-card-bg: #050505; --acu-badge-bg: #1a1a1a; --acu-menu-bg: #111; --acu-menu-text: #00ffcc; --acu-success-text: #0f0; --acu-success-bg: rgba(0, 255, 0, 0.15); --acu-scrollbar-track: #000; --acu-scrollbar-thumb: #333; --acu-hl-manual: #ff9f43; --acu-hl-manual-bg: rgba(255, 159, 67, 0.2); --acu-hl-diff: #0abde3; --acu-hl-diff-bg: rgba(10, 189, 227, 0.2); }\n    .acu-theme-cyber .acu-nav-btn { border-color: #222; }\n    .acu-theme-cyber .acu-data-card { border-color: #222; }\n    .acu-theme-cyber .acu-dice-panel input::placeholder,\n    .acu-theme-cyber .acu-contest-panel input::placeholder {\n        color: #ff00ff !important;\n        opacity: 0.7;\n    }\n    .acu-theme-cyber .acu-dice-panel input[type=\"text\"],\n    .acu-theme-cyber .acu-dice-panel input[type=\"number\"],\n    .acu-theme-cyber .acu-dice-panel input:not([type]),\n    .acu-theme-cyber .acu-contest-panel input[type=\"text\"],\n    .acu-theme-cyber .acu-contest-panel input[type=\"number\"],\n    .acu-theme-cyber .acu-contest-panel input:not([type]) {\n        color: #ff00ff !important;\n    }\n    .acu-theme-nightowl { --acu-bg-nav: #0a2133; --acu-bg-panel: #011627; --acu-border: #132e45; --acu-text-main: #e0e6f2; --acu-text-sub: #a6b8cc; --acu-btn-bg: #1f3a52; --acu-btn-hover: #2a4a68; --acu-btn-active-bg: #7fdbca; --acu-btn-active-text: #011627; --acu-accent: #7fdbca; --acu-table-head: #0a2133; --acu-table-hover: #01294a; --acu-shadow: rgba(0,0,0,0.5); --acu-card-bg: #0a2133; --acu-badge-bg: #1f3a52; --acu-menu-bg: #011627; --acu-menu-text: #e0e6f2; --acu-success-text: #addb67; --acu-success-bg: rgba(173, 219, 103, 0.15); --acu-scrollbar-track: #011627; --acu-scrollbar-thumb: #1f3a52; --acu-hl-manual: #ff8f66; --acu-hl-manual-bg: rgba(255, 143, 102, 0.2); --acu-hl-diff: #82aaff; --acu-hl-diff-bg: rgba(130, 170, 255, 0.2); }\n    .acu-theme-sakura { --acu-bg-nav: #F9F0EF; --acu-bg-panel: #F9F0EF; --acu-border: #EBDCD9; --acu-text-main: #6B5552; --acu-text-sub: #C08D8D; --acu-btn-bg: #EBDCD9; --acu-btn-hover: #D8C7C4; --acu-btn-active-bg: #C08D8D; --acu-btn-active-text: #F9F0EF; --acu-accent: #C08D8D; --acu-table-head: #F9F0EF; --acu-table-hover: #F5EAE8; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #ffffff; --acu-badge-bg: #F9F0EF; --acu-menu-bg: #fff; --acu-menu-text: #6B5552; --acu-success-text: #6B5552; --acu-success-bg: rgba(192, 141, 141, 0.12); --acu-scrollbar-track: #F9F0EF; --acu-scrollbar-thumb: #EBDCD9; --acu-hl-manual: #A68A7A; --acu-hl-manual-bg: rgba(166, 138, 122, 0.12); --acu-hl-diff: #9B7A7A; --acu-hl-diff-bg: rgba(155, 122, 122, 0.2); --acu-error-text: #9B7A7A; --acu-error-bg: rgba(155, 122, 122, 0.12); --acu-error-border: rgba(155, 122, 122, 0.4); --acu-warning-icon: #A68A7A; --acu-failure-text: #9B7A7A; --acu-failure-bg: rgba(155, 122, 122, 0.12); --acu-warning-text: #A68A7A; --acu-warning-bg: rgba(166, 138, 122, 0.12); --acu-crit-success-text: #8B7A7A; --acu-crit-success-bg: rgba(139, 122, 122, 0.12); --acu-crit-failure-text: #8B6F6F; --acu-crit-failure-bg: rgba(139, 111, 111, 0.12); --acu-extreme-success-text: #9B8A8A; --acu-extreme-success-bg: rgba(155, 138, 138, 0.12); --acu-overlay-bg: rgba(107, 85, 82, 0.6); --acu-overlay-bg-light: rgba(107, 85, 82, 0.5); --acu-shadow-bg: rgba(107, 85, 82, 0.3); --acu-light-bg: rgba(192, 141, 141, 0.08); --acu-very-light-bg: rgba(192, 141, 141, 0.02); --acu-button-text: #6B5552; --acu-gray-bg: rgba(192, 141, 141, 0.08); }\n    .acu-theme-minepink { --acu-bg-nav: #1a1a1a; --acu-bg-panel: #1a1a1a; --acu-border: #333333; --acu-text-main: #ffb3d9; --acu-text-sub: #ff80c1; --acu-btn-bg: #2a2a2a; --acu-btn-hover: #3a3a3a; --acu-btn-active-bg: #ff80c1; --acu-btn-active-text: #1a1a1a; --acu-accent: #ff80c1; --acu-table-head: #252525; --acu-table-hover: #2a2a2a; --acu-shadow: rgba(0,0,0,0.6); --acu-card-bg: #222222; --acu-badge-bg: #2a2a2a; --acu-menu-bg: #1a1a1a; --acu-menu-text: #ffb3d9; --acu-success-text: #ff80c1; --acu-success-bg: rgba(255, 128, 193, 0.2); --acu-scrollbar-track: #1a1a1a; --acu-scrollbar-thumb: #333333; --acu-hl-manual: #ffa726; --acu-hl-manual-bg: rgba(255, 167, 38, 0.2); --acu-hl-diff: #ff80c1; --acu-hl-diff-bg: rgba(255, 128, 193, 0.2); --acu-error-text: #ff6b6b; --acu-error-bg: rgba(255, 107, 107, 0.2); --acu-error-border: rgba(255, 107, 107, 0.5); --acu-warning-icon: #ffa726; --acu-failure-text: #ff6b6b; --acu-failure-bg: rgba(255, 107, 107, 0.2); --acu-warning-text: #ffa726; --acu-warning-bg: rgba(255, 167, 38, 0.2); --acu-crit-success-text: #ff80c1; --acu-crit-success-bg: rgba(255, 128, 193, 0.2); --acu-crit-failure-text: #ff4444; --acu-crit-failure-bg: rgba(255, 68, 68, 0.2); --acu-extreme-success-text: #ffb3d9; --acu-extreme-success-bg: rgba(255, 179, 217, 0.2); --acu-overlay-bg: rgba(0,0,0,0.8); --acu-overlay-bg-light: rgba(0,0,0,0.7); --acu-shadow-bg: rgba(0,0,0,0.6); --acu-light-bg: rgba(255, 128, 193, 0.1); --acu-very-light-bg: rgba(255, 128, 193, 0.02); --acu-button-text: #1a1a1a; --acu-gray-bg: rgba(255, 128, 193, 0.1); }\n    .acu-theme-purple { --acu-bg-nav: #f3e5f5; --acu-bg-panel: #f3e5f5; --acu-border: #ce93d8; --acu-text-main: #6a1b9a; --acu-text-sub: #9c27b0; --acu-btn-bg: #e1bee7; --acu-btn-hover: #ce93d8; --acu-btn-active-bg: #9c27b0; --acu-btn-active-text: #fff; --acu-accent: #9c27b0; --acu-table-head: #f8e1f5; --acu-table-hover: #fce4ec; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #ffffff; --acu-badge-bg: #f8e1f5; --acu-menu-bg: #fff; --acu-menu-text: #6a1b9a; --acu-success-text: #6a1b9a; --acu-success-bg: rgba(106, 27, 154, 0.15); --acu-scrollbar-track: #f3e5f5; --acu-scrollbar-thumb: #ce93d8; --acu-hl-manual: #f57c00; --acu-hl-manual-bg: rgba(245, 124, 0, 0.15); --acu-hl-diff: #6a1b9a; --acu-hl-diff-bg: rgba(106, 27, 154, 0.2); --acu-error-text: #d32f2f; --acu-error-bg: rgba(211, 47, 47, 0.15); --acu-error-border: rgba(211, 47, 47, 0.5); --acu-warning-icon: #f57c00; --acu-failure-text: #d32f2f; --acu-failure-bg: rgba(211, 47, 47, 0.15); --acu-warning-text: #f57c00; --acu-warning-bg: rgba(245, 124, 0, 0.15); --acu-crit-success-text: #7b1fa2; --acu-crit-success-bg: rgba(123, 31, 162, 0.15); --acu-crit-failure-text: #b71c1c; --acu-crit-failure-bg: rgba(183, 28, 28, 0.15); --acu-extreme-success-text: #6a1b9a; --acu-extreme-success-bg: rgba(106, 27, 154, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.4); --acu-light-bg: rgba(156, 39, 176, 0.1); --acu-very-light-bg: rgba(156, 39, 176, 0.02); --acu-button-text: #6a1b9a; --acu-gray-bg: rgba(156, 39, 176, 0.1); }\n    .acu-theme-wechat { --acu-bg-nav: #F7F7F7; --acu-bg-panel: #F7F7F7; --acu-border: #E5E5E5; --acu-text-main: #333333; --acu-text-sub: #666666; --acu-btn-bg: #E5E5E5; --acu-btn-hover: #D5D5D5; --acu-btn-active-bg: #09B83E; --acu-btn-active-text: #FFFFFF; --acu-accent: #09B83E; --acu-table-head: #F0F0F0; --acu-table-hover: #EBEBEB; --acu-shadow: rgba(0,0,0,0.1); --acu-card-bg: #ffffff; --acu-badge-bg: #F0F0F0; --acu-menu-bg: #fff; --acu-menu-text: #333333; --acu-success-text: #09B83E; --acu-success-bg: rgba(9, 184, 62, 0.12); --acu-scrollbar-track: #F7F7F7; --acu-scrollbar-thumb: #E5E5E5; --acu-hl-manual: #FF9500; --acu-hl-manual-bg: rgba(255, 149, 0, 0.12); --acu-hl-diff: #09B83E; --acu-hl-diff-bg: rgba(9, 184, 62, 0.2); --acu-error-text: #E53E3E; --acu-error-bg: rgba(229, 62, 62, 0.12); --acu-error-border: rgba(229, 62, 62, 0.5); --acu-warning-icon: #FF9500; --acu-failure-text: #E53E3E; --acu-failure-bg: rgba(229, 62, 62, 0.12); --acu-warning-text: #FF9500; --acu-warning-bg: rgba(255, 149, 0, 0.12); --acu-crit-success-text: #07A832; --acu-crit-success-bg: rgba(7, 168, 50, 0.15); --acu-crit-failure-text: #C53030; --acu-crit-failure-bg: rgba(197, 48, 48, 0.15); --acu-extreme-success-text: #09B83E; --acu-extreme-success-bg: rgba(9, 184, 62, 0.15); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(0,0,0,0.2); --acu-light-bg: rgba(9, 184, 62, 0.08); --acu-very-light-bg: rgba(9, 184, 62, 0.02); --acu-button-text: #333333; --acu-gray-bg: rgba(9, 184, 62, 0.08); }\n    .acu-theme-educational { --acu-bg-nav: #000000; --acu-bg-panel: #000000; --acu-border: #1B1B1B; --acu-text-main: #FFFFFF; --acu-text-sub: #CCCCCC; --acu-btn-bg: #1B1B1B; --acu-btn-hover: #2B2B2B; --acu-btn-active-bg: #FF9900; --acu-btn-active-text: #000000; --acu-accent: #FF9900; --acu-table-head: #1B1B1B; --acu-table-hover: #2B2B2B; --acu-shadow: rgba(0,0,0,0.6); --acu-card-bg: #1B1B1B; --acu-badge-bg: #1B1B1B; --acu-menu-bg: #000000; --acu-menu-text: #FFFFFF; --acu-success-text: #FF9900; --acu-success-bg: rgba(255, 153, 0, 0.15); --acu-scrollbar-track: #000000; --acu-scrollbar-thumb: #1B1B1B; --acu-input-bg: #1B1B1B; --acu-hl-manual: #FF9900; --acu-hl-manual-bg: rgba(255, 153, 0, 0.15); --acu-hl-diff: #FFB84D; --acu-hl-diff-bg: rgba(255, 184, 77, 0.2); --acu-error-text: #FF6B6B; --acu-error-bg: rgba(255, 107, 107, 0.2); --acu-error-border: rgba(255, 107, 107, 0.5); --acu-warning-icon: #FFAA00; --acu-failure-text: #FF6B6B; --acu-failure-bg: rgba(255, 107, 107, 0.2); --acu-warning-text: #FFAA00; --acu-warning-bg: rgba(255, 170, 0, 0.2); --acu-crit-success-text: #FF9900; --acu-crit-success-bg: rgba(255, 153, 0, 0.2); --acu-crit-failure-text: #FF4444; --acu-crit-failure-bg: rgba(255, 68, 68, 0.2); --acu-extreme-success-text: #FFB84D; --acu-extreme-success-bg: rgba(255, 184, 77, 0.2); --acu-overlay-bg: rgba(0,0,0,0.8); --acu-overlay-bg-light: rgba(0,0,0,0.7); --acu-shadow-bg: rgba(0,0,0,0.6); --acu-light-bg: rgba(255, 153, 0, 0.1); --acu-very-light-bg: rgba(255, 153, 0, 0.02); --acu-button-text: #FFFFFF; --acu-gray-bg: rgba(255, 255, 255, 0.1); }\n    .acu-theme-vaporwave { --acu-bg-nav: #191970; --acu-bg-panel: #191970; --acu-border: rgba(0, 255, 255, 0.3); --acu-text-main: #00FFFF; --acu-text-sub: #FF00FF; --acu-btn-bg: rgba(25, 25, 112, 0.8); --acu-btn-hover: rgba(0, 255, 255, 0.2); --acu-btn-active-bg: #FF00FF; --acu-btn-active-text: #F0F8FF; --acu-accent: #00FFFF; --acu-table-head: rgba(25, 25, 112, 0.9); --acu-table-hover: rgba(0, 255, 255, 0.1); --acu-shadow: 0 0 15px rgba(0, 255, 255, 0.3); --acu-card-bg: rgba(25, 25, 112, 0.95); --acu-badge-bg: rgba(25, 25, 112, 0.8); --acu-menu-bg: #191970; --acu-menu-text: #00FFFF; --acu-success-text: #00FFFF; --acu-success-bg: rgba(0, 255, 255, 0.15); --acu-scrollbar-track: #191970; --acu-scrollbar-thumb: rgba(0, 255, 255, 0.3); --acu-input-bg: rgba(25, 25, 112, 0.6); --acu-hl-manual: #00FFFF; --acu-hl-manual-bg: rgba(0, 255, 255, 0.2); --acu-hl-diff: #FF00FF; --acu-hl-diff-bg: rgba(255, 0, 255, 0.2); --acu-error-text: #FF00FF; --acu-error-bg: rgba(255, 0, 255, 0.2); --acu-error-border: rgba(255, 0, 255, 0.5); --acu-warning-icon: #FF00FF; --acu-failure-text: #FF00FF; --acu-failure-bg: rgba(255, 0, 255, 0.2); --acu-warning-text: #FF00FF; --acu-warning-bg: rgba(255, 0, 255, 0.15); --acu-crit-success-text: #00FFFF; --acu-crit-success-bg: rgba(0, 255, 255, 0.2); --acu-crit-failure-text: #FF00FF; --acu-crit-failure-bg: rgba(255, 0, 255, 0.25); --acu-extreme-success-text: #00FFFF; --acu-extreme-success-bg: rgba(0, 255, 255, 0.2); --acu-overlay-bg: rgba(25, 25, 112, 0.85); --acu-overlay-bg-light: rgba(25, 25, 112, 0.75); --acu-shadow-bg: rgba(0, 255, 255, 0.3); --acu-light-bg: rgba(0, 255, 255, 0.05); --acu-very-light-bg: rgba(0, 255, 255, 0.02); --acu-button-text: #F0F8FF; --acu-gray-bg: rgba(0, 255, 255, 0.1); }\n    .acu-theme-vaporwave .acu-nav-btn { border-color: rgba(0, 255, 255, 0.3); }\n    .acu-theme-vaporwave .acu-data-card { border-color: rgba(0, 255, 255, 0.3); }\n    .acu-theme-vaporwave .acu-dice-panel input::placeholder,\n    .acu-theme-vaporwave .acu-contest-panel input::placeholder {\n        color: #FF00FF !important;\n        opacity: 0.7;\n    }\n    .acu-theme-vaporwave .acu-dice-panel input[type=\"text\"],\n    .acu-theme-vaporwave .acu-dice-panel input[type=\"number\"],\n    .acu-theme-vaporwave .acu-dice-panel input:not([type]),\n    .acu-theme-vaporwave .acu-contest-panel input[type=\"text\"],\n    .acu-theme-vaporwave .acu-contest-panel input[type=\"number\"],\n    .acu-theme-vaporwave .acu-contest-panel input:not([type]) {\n        color: #00FFFF !important;\n    }\n    .acu-theme-classicpackaging { --acu-bg-nav: #000000; --acu-bg-panel: #000000; --acu-border: #FFFF00; --acu-text-main: #FFFF00; --acu-text-sub: #CCCC00; --acu-btn-bg: #FF0000; --acu-btn-hover: #CC0000; --acu-btn-active-bg: #0000FF; --acu-btn-active-text: #FFFF00; --acu-accent: #FF0000; --acu-table-head: #1a1a1a; --acu-table-hover: #2a2a2a; --acu-shadow: rgba(255,255,0,0.3); --acu-card-bg: #1a1a1a; --acu-badge-bg: #FF0000; --acu-menu-bg: #000000; --acu-menu-text: #FFFF00; --acu-success-text: #0000FF; --acu-success-bg: rgba(0, 0, 255, 0.2); --acu-scrollbar-track: #000000; --acu-scrollbar-thumb: #FFFF00; --acu-input-bg: #1a1a1a; --acu-hl-manual: #FF0000; --acu-hl-manual-bg: rgba(255, 0, 0, 0.2); --acu-hl-diff: #0000FF; --acu-hl-diff-bg: rgba(0, 0, 255, 0.2); --acu-error-text: #FF0000; --acu-error-bg: rgba(255, 0, 0, 0.2); --acu-error-border: rgba(255, 0, 0, 0.8); --acu-warning-icon: #FF0000; --acu-failure-text: #FF0000; --acu-failure-bg: rgba(255, 0, 0, 0.2); --acu-warning-text: #FF0000; --acu-warning-bg: rgba(255, 0, 0, 0.15); --acu-crit-success-text: #0000FF; --acu-crit-success-bg: rgba(0, 0, 255, 0.2); --acu-crit-failure-text: #FF0000; --acu-crit-failure-bg: rgba(255, 0, 0, 0.25); --acu-extreme-success-text: #0000FF; --acu-extreme-success-bg: rgba(0, 0, 255, 0.2); --acu-overlay-bg: rgba(0,0,0,0.9); --acu-overlay-bg-light: rgba(0,0,0,0.8); --acu-shadow-bg: rgba(0,0,0,0.6); --acu-light-bg: rgba(255,255,0,0.1); --acu-very-light-bg: rgba(255,255,0,0.02); --acu-button-text: #FFFF00; --acu-gray-bg: rgba(255,255,0,0.1); }\n    .acu-theme-classicpackaging .acu-nav-btn { border-color: #FFFF00; border-width: 2px; font-weight: bold; }\n    .acu-theme-classicpackaging .acu-data-card { border-color: #FFFF00; border-width: 2px; }\n    .acu-theme-classicpackaging .acu-dice-panel input::placeholder,\n    .acu-theme-classicpackaging .acu-contest-panel input::placeholder {\n        color: #666600 !important;\n        opacity: 0.7;\n    }\n    .acu-theme-classicpackaging .acu-dice-panel input[type=\"text\"],\n    .acu-theme-classicpackaging .acu-dice-panel input[type=\"number\"],\n    .acu-theme-classicpackaging .acu-dice-panel input:not([type]),\n    .acu-theme-classicpackaging .acu-contest-panel input[type=\"text\"],\n    .acu-theme-classicpackaging .acu-contest-panel input[type=\"number\"],\n    .acu-theme-classicpackaging .acu-contest-panel input:not([type]) {\n        color: #FFFF00 !important;\n        font-weight: bold;\n    }\n    .acu-theme-galgame { --acu-bg-nav: #FFF0F5; --acu-bg-panel: #FFF0F5; --acu-border: #F0D4E4; --acu-text-main: #6B4A5A; --acu-text-sub: #B08A9A; --acu-btn-bg: #FFE4E9; --acu-btn-hover: #FFD4E4; --acu-btn-active-bg: #E8B4D9; --acu-btn-active-text: #6B4A5A; --acu-accent: #E8B4D9; --acu-table-head: #FFF5F9; --acu-table-hover: #FFF0F8; --acu-shadow: rgba(232, 180, 217, 0.25); --acu-card-bg: #ffffff; --acu-badge-bg: #FFF5F9; --acu-menu-bg: #fff; --acu-menu-text: #6B4A5A; --acu-success-text: #D4A5C8; --acu-success-bg: rgba(212, 165, 200, 0.15); --acu-scrollbar-track: #FFF0F5; --acu-scrollbar-thumb: #F0D4E4; --acu-input-bg: #FFF8FA; --acu-hl-manual: #D4A5A5; --acu-hl-manual-bg: rgba(212, 165, 165, 0.15); --acu-hl-diff: #E8B4D9; --acu-hl-diff-bg: rgba(232, 180, 217, 0.2); --acu-error-text: #C88A9A; --acu-error-bg: rgba(200, 138, 154, 0.15); --acu-error-border: rgba(200, 138, 154, 0.4); --acu-warning-icon: #D4A5A5; --acu-failure-text: #C88A9A; --acu-failure-bg: rgba(200, 138, 154, 0.15); --acu-warning-text: #D4A5A5; --acu-warning-bg: rgba(212, 165, 165, 0.15); --acu-crit-success-text: #E8B4D9; --acu-crit-success-bg: rgba(232, 180, 217, 0.2); --acu-crit-failure-text: #C88A9A; --acu-crit-failure-bg: rgba(200, 138, 154, 0.2); --acu-extreme-success-text: #D4A5C8; --acu-extreme-success-bg: rgba(212, 165, 200, 0.2); --acu-overlay-bg: rgba(0,0,0,0.6); --acu-overlay-bg-light: rgba(0,0,0,0.5); --acu-shadow-bg: rgba(232, 180, 217, 0.25); --acu-light-bg: rgba(232, 180, 217, 0.08); --acu-very-light-bg: rgba(232, 180, 217, 0.02); --acu-button-text: #6B4A5A; --acu-button-text-on-accent: #6B4A5A; --acu-gray-bg: rgba(232, 180, 217, 0.1); }\n    .acu-theme-galgame .acu-nav-btn { border-radius: 8px; transition: all 0.3s ease; }\n    .acu-theme-galgame .acu-data-card { border-radius: 12px; box-shadow: 0 4px 12px rgba(232, 180, 217, 0.15); transition: all 0.3s ease; }\n    .acu-theme-galgame .acu-data-card:hover { box-shadow: 0 6px 20px rgba(232, 180, 217, 0.25); transform: translateY(-2px); }\n    .acu-theme-galgame .acu-nav-btn:hover { box-shadow: 0 2px 8px rgba(232, 180, 217, 0.2); }\n    .acu-theme-terminal { --acu-bg-nav: #0c0c0c; --acu-bg-panel: #0c0c0c; --acu-border: #00ff00; --acu-text-main: #00ff00; --acu-text-sub: #00cc00; --acu-btn-bg: #1a1a1a; --acu-btn-hover: #2a2a2a; --acu-btn-active-bg: #00ff00; --acu-btn-active-text: #0c0c0c; --acu-accent: #00ff00; --acu-table-head: #0a0a0a; --acu-table-hover: #1a1a1a; --acu-shadow: rgba(0,255,0,0.2); --acu-card-bg: #0c0c0c; --acu-badge-bg: #1a1a1a; --acu-menu-bg: #0c0c0c; --acu-menu-text: #00ff00; --acu-success-text: #00ff00; --acu-success-bg: rgba(0, 255, 0, 0.15); --acu-scrollbar-track: #0c0c0c; --acu-scrollbar-thumb: #00ff00; --acu-input-bg: #0c0c0c; --acu-hl-manual: #ffff00; --acu-hl-manual-bg: rgba(255, 255, 0, 0.15); --acu-hl-diff: #00ffff; --acu-hl-diff-bg: rgba(0, 255, 255, 0.15); --acu-error-text: #ff0000; --acu-error-bg: rgba(255, 0, 0, 0.15); --acu-error-border: rgba(255, 0, 0, 0.5); --acu-warning-icon: #ffff00; --acu-failure-text: #ff0000; --acu-failure-bg: rgba(255, 0, 0, 0.15); --acu-warning-text: #ffff00; --acu-warning-bg: rgba(255, 255, 0, 0.15); --acu-crit-success-text: #00ffff; --acu-crit-success-bg: rgba(0, 255, 255, 0.15); --acu-crit-failure-text: #ff00ff; --acu-crit-failure-bg: rgba(255, 0, 255, 0.15); --acu-extreme-success-text: #00ff00; --acu-extreme-success-bg: rgba(0, 255, 0, 0.2); --acu-overlay-bg: rgba(0,0,0,0.9); --acu-overlay-bg-light: rgba(0,0,0,0.8); --acu-shadow-bg: rgba(0,0,0,0.7); --acu-light-bg: rgba(0,255,0,0.05); --acu-very-light-bg: rgba(0,255,0,0.02); --acu-button-text: #0c0c0c; --acu-gray-bg: rgba(0,255,0,0.05); font-family: 'Courier New', 'Consolas', 'Monaco', monospace; }\n    .acu-theme-terminal .acu-nav-btn { border-color: #00ff00; text-shadow: 0 0 5px rgba(0,255,0,0.5); }\n    .acu-theme-terminal .acu-data-card { border-color: #00ff00; text-shadow: 0 0 2px rgba(0,255,0,0.3); }\n    .acu-theme-terminal .acu-dice-panel input::placeholder,\n    .acu-theme-terminal .acu-contest-panel input::placeholder {\n        color: #008800 !important;\n        opacity: 0.7;\n    }\n    .acu-theme-terminal .acu-dice-panel input[type=\"text\"],\n    .acu-theme-terminal .acu-dice-panel input[type=\"number\"],\n    .acu-theme-terminal .acu-dice-panel input:not([type]),\n    .acu-theme-terminal .acu-contest-panel input[type=\"text\"],\n    .acu-theme-terminal .acu-contest-panel input[type=\"number\"],\n    .acu-theme-terminal .acu-contest-panel input:not([type]) {\n        color: #00ff00 !important;\n    }\n    .acu-theme-dreamcore { --acu-bg-nav: #F4F1EA; --acu-bg-panel: #F4F1EA; --acu-border: #D6D2C4; --acu-text-main: #5C5869; --acu-text-sub: #9490A0; --acu-btn-bg: #E6E1D5; --acu-btn-hover: #DBD8CC; --acu-btn-active-bg: #8A9AC6; --acu-btn-active-text: #FFFFFF; --acu-accent: #8A9AC6; --acu-table-head: #EBE7DE; --acu-table-hover: #F8F6F0; --acu-shadow: rgba(92, 88, 105, 0.15); --acu-card-bg: #FFFFFF; --acu-badge-bg: #EBE7DE; --acu-menu-bg: #FCFAF5; --acu-menu-text: #5C5869; --acu-success-text: #4A7A68; --acu-success-bg: rgba(74, 122, 104, 0.18); --acu-scrollbar-track: #F4F1EA; --acu-scrollbar-thumb: #D6D2C4; --acu-input-bg: #FFFFFF; --acu-hl-manual: #8A7040; --acu-hl-manual-bg: rgba(138, 112, 64, 0.18); --acu-hl-diff: #8A9AC6; --acu-hl-diff-bg: rgba(138, 154, 198, 0.18); --acu-error-text: #B85C5C; --acu-error-bg: rgba(184, 92, 92, 0.15); --acu-error-border: rgba(184, 92, 92, 0.4); --acu-warning-icon: #E0C080; --acu-failure-text: #8F5E5E; --acu-failure-bg: rgba(143, 94, 94, 0.18); --acu-warning-text: #8A7040; --acu-warning-bg: rgba(138, 112, 64, 0.18); --acu-crit-success-text: #2D6E58; --acu-crit-success-bg: rgba(45, 110, 88, 0.25); --acu-crit-failure-text: #7A3E3E; --acu-crit-failure-bg: rgba(122, 62, 62, 0.25); --acu-extreme-success-text: #5C5228; --acu-extreme-success-bg: rgba(92, 82, 40, 0.2); --acu-overlay-bg: rgba(244, 241, 234, 0.85); --acu-overlay-bg-light: rgba(255, 255, 255, 0.4); --acu-shadow-bg: rgba(92, 88, 105, 0.15); --acu-light-bg: rgba(138, 154, 198, 0.08); --acu-very-light-bg: rgba(138, 154, 198, 0.03); --acu-button-text: #5C5869; --acu-gray-bg: rgba(92, 88, 105, 0.08); }\n    .acu-theme-dreamcore .acu-nav-btn { border-color: #D6D2C4; }\n    .acu-theme-dreamcore .acu-data-card { border-color: #D6D2C4; box-shadow: 0 2px 8px rgba(92, 88, 105, 0.1); }\n    .acu-theme-dreamcore .acu-dice-panel input::placeholder,\n    .acu-theme-dreamcore .acu-contest-panel input::placeholder {\n        color: #B0ACC0 !important;\n        opacity: 0.9;\n    }\n    .acu-theme-dreamcore .acu-dice-panel input[type=\"text\"],\n    .acu-theme-dreamcore .acu-dice-panel input[type=\"number\"],\n    .acu-theme-dreamcore .acu-dice-panel input:not([type]),\n    .acu-theme-dreamcore .acu-contest-panel input[type=\"text\"],\n    .acu-theme-dreamcore .acu-contest-panel input[type=\"number\"],\n    .acu-theme-dreamcore .acu-contest-panel input:not([type]) {\n        color: #4A4652 !important;\n    }\n    /*  (Chouten)  */\n    .acu-theme-chouten {\n        --acu-bg-nav: linear-gradient(135deg, rgba(26, 10, 46, 0.95) 0%, rgba(45, 27, 78, 0.95) 50%, rgba(26, 10, 46, 0.95) 100%);\n        --acu-bg-panel: rgba(26, 10, 46, 0.95);\n        --acu-border: #FF7EB6;\n        --acu-text-main: #FFFFFF;\n        --acu-text-sub: #D0BFFF;\n        --acu-btn-bg: rgba(255, 255, 255, 0.1);\n        --acu-btn-hover: rgba(255, 107, 157, 0.3);\n        --acu-btn-active-bg: linear-gradient(90deg, #FF6B9D, #B388FF);\n        --acu-btn-active-text: #FFFFFF;\n        --acu-accent: #7FFFD4;\n        --acu-table-head: rgba(255, 107, 157, 0.15);\n        --acu-table-hover: linear-gradient(90deg, rgba(255, 107, 157, 0.2), rgba(127, 255, 212, 0.2));\n        --acu-shadow: rgba(255, 107, 157, 0.5);\n        --acu-card-bg: rgba(20, 10, 35, 0.7);\n        --acu-badge-bg: rgba(127, 255, 212, 0.2);\n        --acu-menu-bg: #2D1B4E;\n        --acu-menu-text: #FFE4F0;\n        --acu-success-text: #7FFFD4;\n        --acu-success-bg: rgba(127, 255, 212, 0.15);\n        --acu-scrollbar-track: #1A0A2E;\n        --acu-scrollbar-thumb: #FF6B9D;\n        --acu-input-bg: rgba(0, 0, 0, 0.3);\n        --acu-hl-manual: #FFD93D;\n        --acu-hl-manual-bg: rgba(255, 217, 61, 0.2);\n        --acu-hl-diff: #7FFFD4;\n        --acu-hl-diff-bg: rgba(127, 255, 212, 0.2);\n        --acu-error-text: #FF6B6B;\n        --acu-error-bg: rgba(255, 107, 107, 0.2);\n        --acu-error-border: #FF6B6B;\n        --acu-warning-icon: #FFD93D;\n        --acu-failure-text: #FF6B6B;\n        --acu-failure-bg: rgba(255, 107, 107, 0.2);\n        --acu-warning-text: #FFD93D;\n        --acu-warning-bg: rgba(255, 217, 61, 0.2);\n        --acu-crit-success-text: #00FFAB;\n        --acu-crit-success-bg: rgba(0, 255, 171, 0.25);\n        --acu-crit-failure-text: #FF4757;\n        --acu-crit-failure-bg: rgba(255, 71, 87, 0.25);\n        --acu-extreme-success-text: #00D9FF;\n        --acu-extreme-success-bg: rgba(0, 217, 255, 0.2);\n        --acu-overlay-bg: rgba(26, 10, 46, 0.95);\n        --acu-overlay-bg-light: rgba(45, 27, 78, 0.85);\n        --acu-shadow-bg: rgba(255, 107, 157, 0.3);\n        --acu-light-bg: rgba(255, 107, 157, 0.1);\n        --acu-very-light-bg: rgba(179, 136, 255, 0.05);\n        --acu-button-text: #FFFFFF;\n        --acu-button-text-on-accent: #1A0A2E;\n        --acu-gray-bg: rgba(255, 255, 255, 0.05);\n    }\n\n    /*  -  */\n    .acu-theme-chouten .acu-nav-container {\n        background: linear-gradient(180deg, rgba(45, 27, 78, 0.95) 0%, rgba(26, 10, 46, 0.98) 100%) !important;\n        border: 1px solid rgba(255, 107, 157, 0.5) !important;\n        box-shadow: 0 0 20px rgba(179, 136, 255, 0.2), inset 0 0 30px rgba(255, 107, 157, 0.1) !important;\n        backdrop-filter: blur(10px);\n        overflow: visible !important;\n    }\n    /*  */\n    .acu-theme-chouten .acu-nav-container::before {\n        content: '';\n        position: absolute;\n        top: -2px; left: -2px; right: -2px; bottom: -2px;\n        background: linear-gradient(90deg, #FF6B9D, #B388FF, #7FFFD4, #FF6B9D);\n        background-size: 300% 100%;\n        z-index: -1;\n        border-radius: 12px;\n        animation: chouten-rainbow-border 4s linear infinite;\n        opacity: 0.8;\n    }\n    @keyframes chouten-rainbow-border {\n        0% { background-position: 0% 50%; }\n        50% { background-position: 100% 50%; }\n        100% { background-position: 0% 50%; }\n    }\n\n    /*  -  */\n    .acu-theme-chouten .acu-nav-btn {\n        border: 1px solid rgba(255, 255, 255, 0.2) !important;\n        background: rgba(255, 255, 255, 0.05) !important;\n        border-radius: 8px;\n        color: #FFE4F0;\n        transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n        position: relative;\n        overflow: hidden;\n    }\n    .acu-theme-chouten .acu-nav-btn:hover {\n        background: rgba(255, 107, 157, 0.2) !important;\n        border-color: #FF6B9D !important;\n        text-shadow: 0 0 8px #FF6B9D;\n        transform: translateY(-2px) scale(1.02);\n        box-shadow: 0 5px 15px rgba(255, 107, 157, 0.3);\n    }\n    .acu-theme-chouten .acu-nav-btn.active {\n        background: linear-gradient(135deg, #FF6B9D 0%, #B388FF 100%) !important;\n        border-color: #FFFFFF !important;\n        color: #FFFFFF !important;\n        box-shadow: 0 0 20px rgba(255, 107, 157, 0.6), inset 0 0 10px rgba(255, 255, 255, 0.3);\n        font-weight: bold;\n        text-shadow: 0 1px 2px rgba(0,0,0,0.3);\n    }\n    /*  () */\n    .acu-theme-chouten .acu-nav-btn.active::after {\n        content: '';\n        position: absolute;\n        top: 2px;\n        right: 4px;\n        font-size: 10px;\n        color: #7FFFD4;\n        animation: chouten-sparkle 1.5s infinite;\n    }\n\n    /*  -  */\n    .acu-theme-chouten .acu-data-card {\n        border: 1px solid rgba(179, 136, 255, 0.3) !important;\n        background: linear-gradient(160deg, rgba(30, 15, 50, 0.85) 0%, rgba(20, 8, 40, 0.9) 100%) !important;\n        backdrop-filter: blur(5px);\n        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(179, 136, 255, 0.05);\n        position: relative;\n    }\n    .acu-theme-chouten .acu-data-card::after {\n        content: '';\n        position: absolute;\n        top: 0; left: 0; right: 0; height: 1px;\n        background: linear-gradient(90deg, transparent, #7FFFD4, transparent);\n        opacity: 0.5;\n    }\n    .acu-theme-chouten .acu-data-card:hover {\n        border-color: #7FFFD4 !important;\n        box-shadow: 0 8px 30px rgba(127, 255, 212, 0.15), 0 0 15px rgba(127, 255, 212, 0.1);\n        transform: translateY(-2px);\n    }\n\n    /*  -  */\n    .acu-theme-chouten .acu-dice-panel input::placeholder,\n    .acu-theme-chouten .acu-contest-panel input::placeholder {\n        color: rgba(179, 136, 255, 0.6) !important;\n    }\n    .acu-theme-chouten .acu-dice-panel input,\n    .acu-theme-chouten .acu-contest-panel input {\n        background: rgba(0, 0, 0, 0.4) !important;\n        border: 1px solid rgba(255, 107, 157, 0.3) !important;\n        border-radius: 4px;\n        color: #7FFFD4 !important;\n        transition: all 0.3s ease;\n    }\n    .acu-theme-chouten .acu-dice-panel input:focus,\n    .acu-theme-chouten .acu-contest-panel input:focus {\n        border-color: #7FFFD4 !important;\n        box-shadow: 0 0 10px rgba(127, 255, 212, 0.4), inset 0 0 10px rgba(127, 255, 212, 0.1) !important;\n        background: rgba(0, 0, 0, 0.6) !important;\n    }\n\n    /*  */\n    .acu-theme-chouten ::-webkit-scrollbar-thumb {\n        background: linear-gradient(180deg, #FF6B9D, #B388FF) !important;\n        border: 1px solid rgba(255, 255, 255, 0.2);\n    }\n    .acu-theme-chouten ::-webkit-scrollbar-track {\n        background: rgba(0, 0, 0, 0.2) !important;\n    }\n\n    /*  -  */\n    .acu-theme-chouten .acu-card-row {\n        border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n    }\n    .acu-theme-chouten .acu-card-row:hover {\n        background: linear-gradient(90deg, rgba(255, 107, 157, 0.2), rgba(179, 136, 255, 0.1)) !important;\n        box-shadow: inset 2px 0 0 #FF6B9D;\n    }\n\n    /*  */\n    .acu-theme-chouten .acu-badge-green {\n        background: rgba(127, 255, 212, 0.15) !important;\n        color: #7FFFD4 !important;\n        border: 1px solid rgba(127, 255, 212, 0.4);\n        box-shadow: 0 0 10px rgba(127, 255, 212, 0.2);\n        animation: chouten-badge-pulse 2s infinite;\n    }\n    @keyframes chouten-badge-pulse {\n        0%, 100% { box-shadow: 0 0 5px rgba(127, 255, 212, 0.2); opacity: 0.9; }\n        50% { box-shadow: 0 0 15px rgba(127, 255, 212, 0.5); opacity: 1; }\n    }\n    @keyframes chouten-sparkle {\n        0%, 100% { opacity: 0.4; transform: scale(0.8); }\n        50% { opacity: 1; transform: scale(1.2); }\n    }\n    /* Night Owl */\n    .acu-theme-nightowl .acu-table-manager-item,\n    .acu-theme-nightowl .acu-validation-rule-item {\n        border-color: var(--acu-border) !important;\n    }\n    .acu-theme-nightowl .acu-table-manager-item:hover,\n    .acu-theme-nightowl .acu-validation-rule-item:hover {\n        border-color: rgba(127, 219, 202, 0.4) !important;\n    }\n    /* Night Owl */\n    .acu-theme-nightowl .acu-preset-item {\n        border-color: var(--acu-border) !important;\n    }\n    .acu-theme-nightowl .acu-preset-item:hover {\n        border-color: rgba(127, 219, 202, 0.4) !important;\n    }\n    .acu-wrapper { position: relative; width: 100%; margin: 15px 0; z-index: 2147483640 !important; font-family: 'Microsoft YaHei', sans-serif; display: flex; flex-direction: column-reverse; }\n    .acu-wrapper.acu-mode-embedded { position: relative !important; width: 100% !important; margin-top: 8px !important; z-index: 2147483641 !important; clear: both; display: flex; flex-direction: column-reverse !important; padding: 0; }\n    .acu-wrapper.acu-mode-embedded .acu-nav-container { position: relative !important; z-index: 2147483642 !important; }\n    .acu-wrapper.acu-mode-embedded .acu-data-display { position: absolute !important; bottom: 100% !important; left: 0 !important; right: 0 !important; width: 100% !important; box-shadow: 0 -10px 30px rgba(0,0,0,0.25) !important; border: 1px solid var(--acu-border); margin-bottom: 5px; z-index: 2147483647 !important; max-height: 70vh !important; overflow-y: auto !important; }\n    .acu-nav-container { display: grid; grid-template-columns: repeat(var(--acu-grid-cols, 3), 1fr); gap: 4px; padding: 6px; background: var(--acu-bg-nav); border: 1px solid var(--acu-border); border-radius: 10px; align-items: center; box-shadow: 0 2px 6px var(--acu-shadow); position: relative; z-index: 2147483641 !important; }\n    .acu-nav-btn { touch-action: manipulation; -webkit-tap-highlight-color: transparent; width: 100%; display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 3px; padding: 4px 2px; border: 1px solid transparent; border-radius: 6px; background: var(--acu-btn-bg); color: var(--acu-text-main); font-weight: 600; font-size: 11px; cursor: pointer; transition: all 0.2s ease; user-select: none; overflow: hidden; height: 28px; }\n    .acu-nav-btn span { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; margin-top: 1px; }\n    .acu-nav-btn:hover { background: var(--acu-btn-hover); transform: translateY(-2px); }\n    .acu-nav-btn:focus, .acu-nav-btn:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--acu-accent) !important; }\n    /* []  */\n/* --- 1.  --- */\n.acu-height-control {\n    display: flex;\n    align-items: center;\n    margin-right: 8px;\n    cursor: ns-resize;\n    padding: 4px;\n    border-radius: 4px;\n    color: var(--acu-text-sub);\n    transition: all 0.2s;\n    /*  */\n    touch-action: none;\n}\n\n/*  */\n.acu-height-control:hover, .acu-height-control.active {\n    color: var(--acu-accent);\n    background: var(--acu-table-hover);\n}\n\n/* --- 2. []  --- */\n.acu-height-drag-handle {\n    cursor: ns-resize;\n    /*  */\n    touch-action: none;\n}\n\n            /*  */\n            .acu-view-btn { background: transparent !important; border: none; color: var(--acu-text-main) !important; cursor: pointer; padding: 4px; margin-right: 5px; font-size: 14px; opacity: 0.7; }\n            .acu-view-btn:hover { opacity: 1; color: var(--acu-accent) !important; background: var(--acu-table-hover) !important; border-radius: 4px; }\n            .acu-view-btn.acu-reverse-btn.active, .acu-reverse-btn[data-reversed=\"true\"] { color: var(--acu-accent) !important; opacity: 1; }\n            /* Grid  () */\n            .acu-card-body.view-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }\n            /*  Grid  Flex  */\n.acu-card-body.view-grid .acu-card-row { display: flex; height: auto !important; min-height: fit-content; border: 1px solid var(--acu-border); border-radius: 6px; padding: 4px 6px; flex-direction: column !important; align-items: flex-start !important; background: rgba(0,0,0,0.02); box-sizing: border-box; }\n            .acu-card-body.view-grid .acu-card-row.acu-grid-span-full { grid-column: 1 / -1; }\n            .acu-card-body.view-grid .acu-card-label { width: 100% !important; font-size: 0.85em; opacity: 0.8; margin-bottom: 2px; }\n            .acu-card-body.view-grid .acu-card-value { width: 100% !important; }\n\n            /* List  ( - ) */\n            .acu-nav-btn.active { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); box-shadow: inset 0 1px 3px rgba(0,0,0,0.2); outline: none; border-color: transparent; }\n            .acu-nav-btn.active:hover { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); transform: none; }\n            .acu-nav-btn.active:focus, .acu-nav-btn.active:focus-visible { outline: none; box-shadow: inset 0 1px 3px rgba(0,0,0,0.2) !important; }\n            .acu-nav-btn.has-validation-errors { border-color: rgba(231, 76, 60, 0.5); }\n            .acu-nav-btn .acu-nav-warning-icon { color: var(--acu-error-text, #e74c3c); font-size: 10px; margin-left: 2px; animation: pulse 1.5s infinite; }\n            @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }\n            .acu-action-btn { flex: 1; height: 36px; display: flex; align-items: center; justify-content: center; background: var(--acu-btn-bg); border-radius: 8px; color: var(--acu-text-sub); cursor: pointer; border: 1px solid transparent; transition: all 0.2s; margin: 0; }\n            .acu-action-btn:hover { background: var(--acu-btn-hover); color: var(--acu-text-main); transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }\n            .acu-action-btn:focus, .acu-action-btn:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--acu-accent) !important; }\n            #acu-btn-save-global { color: var(--acu-btn-active-bg); } #acu-btn-save-global:hover { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); }\n\n            .acu-data-display { position: absolute; bottom: calc(100% + 10px); left: 0; right: 0; max-height: 80vh; height: auto; background: var(--acu-bg-panel); border: 1px solid var(--acu-border); border-radius: 8px; box-shadow: 0 8px 30px var(--acu-shadow); display: flex; flex-direction: column; z-index: 2147483642 !important; opacity: 0; visibility: hidden; transition: opacity 0.2s ease-out, visibility 0s linear 0.2s; pointer-events: none; }\n            .acu-data-display.visible { opacity: 1; visibility: visible; transition: opacity 0.2s ease-in, visibility 0s linear 0s; pointer-events: auto; }\n            @keyframes popUp { from { opacity: 0; transform: translateY(10px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }\n            @keyframes highlightFlash { 0%, 100% { box-shadow: none; } 50% { box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.6); } }\n            .acu-highlight-flash { animation: highlightFlash 0.5s ease-in-out 3; }\n\n            .acu-panel-header { flex: 0 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: var(--acu-table-head); border-bottom: 1px dashed var(--acu-border); border-radius: 8px 8px 0 0; }\n            /*  flex: 1  min-width: 0 */\n/* ---  --- */\n.acu-panel-title {\n    display: flex;\n    flex-direction: column; /*  */\n    justify-content: center;\n    align-items: flex-start;\n    flex: 1; /*  */\n    min-width: 0; /*  */\n    margin-right: 8px;\n    overflow: hidden;\n}\n\n/*  () */\n.acu-title-main {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n    font-size: 13px; /*  */\n    font-weight: bold;\n    color: var(--acu-text-main);\n    line-height: 1.2;\n}\n\n/*  () */\n.acu-title-text {\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/*  () */\n.acu-title-sub {\n    font-size: 10px;\n    color: var(--acu-text-sub);\n    font-weight: normal;\n    opacity: 0.8;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    width: 100%;\n    line-height: 1.2;\n    margin-top: 1px;\n}\n            /*  flex-shrink: 0;  */\n/* flex-shrink: 0  */\n.acu-header-actions { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }\n            .acu-search-wrapper { position: relative; display: flex; align-items: center; }\n            .acu-wrapper input.acu-search-input { background: var(--acu-btn-bg) !important; border: 1px solid var(--acu-border) !important; color: var(--acu-text-main) !important; padding: 4px 8px 4px 24px; border-radius: 12px; font-size: 12px; width: 120px; transition: width 0.2s, border-color 0.2s; }\n            .acu-wrapper input.acu-search-input::placeholder { color: var(--acu-text-sub) !important; opacity: 0.7; }\n            .acu-wrapper input.acu-search-input:focus { width: 160px; outline: none !important; border-color: var(--acu-accent) !important; box-shadow: none !important; }\n            .acu-search-input::placeholder { color: var(--acu-text-sub) ; opacity: 0.7; }\n            .acu-search-icon { position: absolute; left: 8px; font-size: 10px; color: var(--acu-text-sub); pointer-events: none; }\n            /*  min-width  flex-shrink: 0 */\n            .acu-panel-content { flex: 1; overflow-x: auto; overflow-y: hidden; padding: 15px; background: transparent; scrollbar-width: thin; scrollbar-color: var(--acu-scrollbar-thumb) var(--acu-scrollbar-track); overscroll-behavior-x: contain; overscroll-behavior-y: auto; touch-action: pan-x pan-y; -webkit-overflow-scrolling: touch; }\n            /*  height: 100%;  */\n.acu-card-grid { display: flex; flex-wrap: nowrap; gap: 12px; align-items: flex-start; }\n            .acu-layout-vertical .acu-panel-content { overflow-x: hidden !important; overflow-y: auto !important; overscroll-behavior: auto; touch-action: manipulation; min-height: 0; }\n            /*  auto  */\n.acu-layout-vertical .acu-card-grid { flex-wrap: wrap !important; justify-content: center; padding-bottom: 20px; height: auto; }\n.acu-wrapper:not(.acu-layout-vertical) .acu-manual-mode .acu-card-grid { height: 100%; } .acu-manual-mode .acu-data-card { max-height: 100% !important; overscroll-behavior-y: auto; } .acu-data-card { flex: 0 0 var(--acu-card-width, 260px); width: var(--acu-card-width, 260px); background: var(--acu-card-bg); border: 1px solid var(--acu-border); border-radius: 8px; height: auto; max-height: 60vh; overflow-y: auto; overscroll-behavior-y: auto; touch-action: manipulation; transition: all 0.2s ease; display: flex; flex-direction: column; position: relative; }\n            .acu-data-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px var(--acu-shadow); border-color: var(--acu-accent); }\n            .acu-data-card.pending-deletion { opacity: 0.6; border: 1px dashed var(--acu-error-text, #e74c3c); }\n            .acu-data-card.pending-deletion::after { content: \"\"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); color: var(--acu-error-text, #e74c3c); font-size: 24px; font-weight: bold; border: 2px solid var(--acu-error-text, #e74c3c); padding: 5px 10px; border-radius: 8px; opacity: 0.8; pointer-events: none; }\n            @keyframes pulse-highlight { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }\n            .acu-highlight-manual { color: var(--acu-hl-manual) !important; background-color: var(--acu-hl-manual-bg) !important; border-radius: 4px; padding: 0 4px; font-weight: bold; animation: pulse-highlight 2s infinite; display: inline-block; }\n            .acu-highlight-diff { color: var(--acu-hl-diff) !important; background-color: var(--acu-hl-diff-bg) !important; border-radius: 4px; padding: 0 4px; font-weight: bold; animation: pulse-highlight 2s infinite; display: inline-block; }\n            .acu-editable-title.acu-highlight-manual, .acu-editable-title.acu-highlight-diff { width: auto; display: inline-block; }\n            .acu-card-header { flex: 0 0 auto; padding: 8px 10px; background: var(--acu-table-head); border-bottom: 1px dashed var(--acu-border); font-weight: bold; color: var(--acu-text-main); font-size: 14px; display: flex; flex-direction: row !important; align-items: center !important; justify-content: flex-start !important; gap: 8px; min-height: 40px; height: auto !important; position: relative; }\n            .acu-editable-title { flex: 1; width: auto !important; cursor: pointer; border-bottom: 1px dashed transparent; transition: all 0.2s; white-space: pre-wrap !important; overflow: visible !important; word-break: break-word !important; text-align: center; line-height: 1.3; margin: 0; }\n            .acu-editable-title:hover { border-bottom-color: var(--acu-accent); color: var(--acu-accent); }\n            .acu-card-index { position: static !important; transform: none !important; margin: 0; flex-shrink: 0; font-size: 11px; color: var(--acu-text-sub); font-weight: normal; background: var(--acu-badge-bg); padding: 2px 6px; border-radius: 4px; }\n            .acu-bookmark-icon { position: absolute; top: 8px; right: 8px; color: var(--acu-accent); cursor: pointer; font-size: 16px; opacity: 0.3; transition: opacity 0.2s, color 0.2s, transform 0.2s; z-index: 10; }\n            .acu-bookmark-icon:hover { opacity: 0.6; transform: scale(1.1); }\n            .acu-bookmark-icon.bookmarked { color: var(--acu-accent); opacity: 1; }\n            .acu-card-body { padding: 6px 12px; display: flex; flex-direction: column; gap: 0; font-size: var(--acu-font-size, 13px); flex: 1; }\n            .acu-card-row { display: block; padding: 6px 0; border-bottom: 1px dashed var(--acu-border); cursor: pointer; overflow: hidden; }\n            .acu-card-row:last-child { border-bottom: none; }\n            .acu-card-actions { display: flex; flex-wrap: wrap; gap: 6px; padding: 8px 10px; border-top: 1px dashed var(--acu-border); background: var(--acu-table-head); }\n            .acu-action-item { padding: 4px 10px; font-size: 11px; border: 1px solid var(--acu-border); border-radius: 4px; background: var(--acu-btn-bg); color: var(--acu-text-main); cursor: pointer; display: flex; align-items: center; gap: 4px; transition: all 0.15s; white-space: nowrap; }\n            .acu-action-item:hover { background: var(--acu-btn-hover); border-color: var(--acu-accent); color: var(--acu-accent); transform: translateY(-1px); }\n            .acu-action-item:active { transform: translateY(0); }\n            .acu-action-item.check-type { border-style: dashed; }\n            .acu-action-item i { font-size: 10px; opacity: 0.7; }\n            .acu-card-row:hover { background: var(--acu-table-hover); }\n            .acu-card-label { float: left !important; clear: left; width: auto !important; margin-right: 8px !important; color: var(--acu-text-sub); font-size: 0.9em; line-height: 1.5; padding-top: 0; }\n            .acu-hide-label .acu-card-label { display: none; }\n            .acu-hide-label .acu-card-value { width: 100% !important; }\n            .acu-inline-dice-btn:hover { opacity: 1 !important; transform: scale(1.2); }\n            .acu-card-value { display: block; width: auto !important; margin: 0; text-align: left !important; word-break: break-all !important; white-space: pre-wrap !important; line-height: 1.5 !important; color: var(--acu-text-main); font-size: 1em; }\n            .acu-tag-container { display: flex; flex-wrap: wrap; gap: 4px; align-items: center; margin-top: 2px; }\n            .acu-multi-attr-container { display: grid; grid-template-columns: 1fr 1fr; gap: 2px 8px; }\n            .acu-badge { display: inline-block; padding: 1px 8px; border-radius: 12px; font-size: 0.9em; font-weight: 500; line-height: 1.2; }\n            .acu-badge-green { background: var(--acu-success-bg); color: var(--acu-success-text); }\n            .acu-badge-neutral { background: var(--acu-badge-bg); color: var(--acu-text-main); border: 1px solid var(--acu-border); }\n            .acu-panel-footer { flex: 0 0 auto; padding: 8px; border-top: 1px dashed var(--acu-border); background: var(--acu-table-head); display: flex; justify-content: center; align-items: center; gap: 5px; flex-wrap: wrap; }\n            .acu-page-btn { padding: 4px 10px; min-width: 32px; height: 28px; border-radius: 4px; border: 1px solid var(--acu-border); background: var(--acu-btn-bg); color: var(--acu-text-main); cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }\n            .acu-page-btn:hover:not(.disabled):not(.active) { background: var(--acu-btn-hover); transform: translateY(-1px); }\n            .acu-page-btn.active { background: var(--acu-accent); color: var(--acu-button-text-on-accent, #fff); border-color: var(--acu-accent); font-weight: bold; }\n            .acu-page-btn.disabled { opacity: 0.5; cursor: not-allowed; }\n            .acu-page-info { font-size: 12px; color: var(--acu-text-sub); margin: 0 10px; }\n            /* --- []  -  --- */\n            .acu-option-panel {\n                display: flex;\n                flex-direction: column;\n                gap: 0;\n                padding: 0;\n                background: transparent;\n                border: none;\n                border-radius: 0;\n                margin: 12px 0;\n                width: 100%;\n                box-sizing: border-box;\n                z-index: 2147483641;\n                animation: acuFadeIn 0.3s ease;\n            }\n\n            .acu-embedded-options-container {\n                width: 100%;\n                max-width: 100%;\n                margin: 12px 0;\n                padding: 0;\n                clear: both;\n                box-sizing: border-box;\n                animation: acuFadeIn 0.3s ease;\n            }\n\n            .acu-opt-header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                font-size: 11px;\n                font-weight: 600;\n                color: var(--acu-text-sub);\n                padding: 8px 0;\n                border-bottom: 1px solid var(--acu-border);\n                margin-bottom: 8px;\n                cursor: pointer;\n                user-select: none;\n                transition: color 0.2s;\n            }\n            .acu-opt-header:hover {\n                color: var(--acu-text-main);\n            }\n\n            /* --- []  --- */\n            .acu-opt-btn {\n                background: transparent;\n                border: none;\n                border-bottom: 1px dashed var(--acu-border);\n                padding: 12px 0;\n                border-radius: 0;\n                cursor: pointer;\n                color: var(--acu-text-main);\n                font-size: var(--acu-opt-font-size, 13px) !important;\n                transition: all 0.2s ease;\n                font-weight: normal;\n                text-align: left;\n                white-space: pre-wrap;\n                word-break: break-word;\n                min-height: 44px;\n                line-height: 1.6;\n                display: block;\n                position: relative;\n                opacity: 0.85;\n            }\n            .acu-opt-btn:last-child {\n                border-bottom: none;\n            }\n            .acu-opt-btn:hover {\n                opacity: 1;\n                background: var(--acu-table-hover);\n            }\n            .acu-opt-btn:active {\n                background: var(--acu-btn-hover);\n            }\n\n            /* --- []  --- */\n            .acu-option-panel.collapsed .acu-opt-btn {\n                display: none;\n            }\n            .acu-option-panel.collapsed .acu-opt-header {\n                border-bottom: none;\n                margin-bottom: 0;\n            }\n            @keyframes acuFadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }\n\n            /* []  */\n            .acu-dice-result-revealing {\n                opacity: 0 !important;\n                transform: translateY(3px) !important;\n                transition: opacity 0.18s ease-out, transform 0.18s ease-out !important;\n            }\n            .acu-dice-result-revealed {\n                opacity: 1 !important;\n                transform: translateY(0) !important;\n            }\n            /*  */\n            @media (max-width: 768px) {\n                .acu-dice-result-revealing {\n                    transition: opacity 0.15s ease-out, transform 0.15s ease-out !important;\n                }\n            }\n            /*  */\n            @media (prefers-reduced-motion: reduce) {\n                .acu-dice-result-revealing {\n                    transition: none !important;\n                    opacity: 1 !important;\n                    transform: none !important;\n                }\n            }\n\n            .acu-menu-backdrop { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: transparent; z-index: 2147483645 !important; }\n            /* 1.  */\n.acu-cell-menu {\n    position: fixed !important;\n    background: var(--acu-menu-bg) !important;\n    border: 1px solid var(--acu-border);\n    box-shadow: 0 6px 20px var(--acu-shadow) !important;\n    z-index: 2147483647 !important;\n    border-radius: 8px;\n    overflow: hidden;\n    min-width: 150px;\n    color: var(--acu-menu-text);\n}\n\n/* 2.  */\n.acu-cell-menu-item {\n    padding: 12px 16px;\n    cursor: pointer;\n    font-size: 14px;\n    display: flex;\n    gap: 12px;\n    align-items: center;\n    color: var(--acu-menu-text);\n    font-weight: 500;\n    background: transparent;\n    transition: background 0.2s;\n}\n\n/* 3.  */\n.acu-cell-menu-item:hover {\n    background: var(--acu-table-hover);\n}\n\n/* 4.  */\n            .acu-cell-menu-item#act-delete { color: var(--acu-error-text, #e74c3c); }\n            .acu-cell-menu-item#act-delete:hover { background: var(--acu-error-bg, rgba(231, 76, 60, 0.1)); } /*  */\n            .acu-cell-menu-item#act-close { border-top: 1px dashed var(--acu-border); color: var(--acu-text-sub); }\n            .acu-edit-overlay { position: fixed !important; top: 0; left: 0; right: 0; bottom: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.75) !important; z-index: 2147483646 !important; display: flex; justify-content: center !important; align-items: center !important; backdrop-filter: blur(2px); }\n            .acu-edit-dialog { background: var(--acu-bg-panel); width: 95%; max-width: 500px; max-height: 95vh; padding: 16px; border-radius: 12px; display: flex; flex-direction: column; gap: 10px; box-shadow: 0 15px 50px rgba(0,0,0,0.6); color: var(--acu-text-main); border: 1px solid var(--acu-border); overflow: hidden; flex-shrink: 0; }\n            @media (min-width: 768px) { .acu-edit-dialog { max-width: 900px; width: 90%; } .acu-edit-dialog.acu-settings-dialog { max-width: 400px; width: 400px; } }\n            .acu-edit-title { margin: 0; font-size: 16px; font-weight: bold; color: var(--acu-text-main); padding-bottom: 8px; border-bottom: 1px solid var(--acu-border); }\n            .acu-edit-content { background: var(--acu-bg-panel); }\n            .acu-edit-textarea { width: 100%; height: auto; padding: 12px; border: 1px solid var(--acu-border) !important; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; border-radius: 6px; resize: vertical; box-sizing: border-box; font-size: 14px; line-height: 1.6; overflow-y: auto !important; }\n            .acu-edit-textarea:focus { outline: none; border-color: var(--acu-accent) !important; }\n            .acu-edit-textarea::placeholder { color: var(--acu-text-sub) !important; opacity: 0.7; }\n            @media (min-width: 768px) { .acu-edit-textarea { height: auto !important; font-size: 15px !important; } }\n            .acu-edit-textarea:focus { outline: 1px solid #aaa; }\n            .acu-dialog-btns { display: flex; justify-content: flex-end; gap: 20px; margin-top: 10px; }\n            .acu-dialog-btn { background: none; border: none; cursor: pointer; font-size: 14px; font-weight: bold; display: flex; align-items: center; gap: 6px; color: var(--acu-text-sub); transition: color 0.2s; }\n            .acu-dialog-btn:hover { color: var(--acu-text-main); } .acu-btn-confirm { color: var(--acu-success-text); } .acu-btn-confirm:hover { opacity: 0.8; }\n            /* --- [UI Optimization] PC-First Edit Mode Styles --- */\n            .acu-order-controls { grid-column: 1 / -1; order: -2; display: none; width: 100%; text-align: left; background: var(--acu-accent); color: var(--acu-button-text-on-accent, var(--acu-text-main)); padding: 6px 12px; margin: 0 0 8px 0; border-radius: 4px; font-weight: bold; font-size: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }\n            .acu-order-controls.visible { display: flex; align-items: center; justify-content: space-between; }\n\n            .acu-nav-container.editing-order { border: 2px solid var(--acu-accent); background: var(--acu-bg-panel); }\n            .acu-nav-container.editing-order .acu-nav-btn, .acu-nav-container.editing-order .acu-action-btn { opacity: 1 !important; cursor: grab !important; border: 1px solid var(--acu-border); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }\n            .acu-nav-container.editing-order .acu-nav-btn:hover, .acu-nav-container.editing-order .acu-action-btn:hover { border-color: var(--acu-accent); transform: translateY(-1px); }\n\n            .acu-swap-selected { background-color: var(--acu-accent) !important; color: var(--acu-button-text-on-accent, var(--acu-text-main)) !important; border-color: var(--acu-accent); box-shadow: 0 0 0 2px rgba(255,255,255,0.5), 0 4px 12px rgba(0,0,0,0.2); transform: scale(1.05); z-index: 10; }\n            .acu-drag-over { border: 2px dashed var(--acu-accent); opacity: 0.5; transform: scale(0.95); background: rgba(var(--acu-accent-rgb), 0.1); }\n\n            /* --- [PC Style] Unused Pool Optimization () --- */\n            .acu-unused-pool {\n                grid-column: 1 / -1;\n                display: none;\n                flex-wrap: wrap;\n                gap: 8px;\n                background: var(--acu-table-head); /*  */\n                border: 1px dashed var(--acu-border); /*  */\n                padding: 10px 15px;\n                margin: 0 0 10px 0;\n                border-radius: 8px;\n                justify-content: flex-start;\n                align-items: center;\n                min-height: 50px;\n                box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);\n            }\n            .acu-unused-pool.visible { display: flex; animation: acuFadeIn 0.2s ease-out; }\n\n            /* PC */\n            .acu-unused-pool::before {\n                content: \" ( )\";\n                display: flex;\n                align-items: center;\n                height: 32px;\n                font-size: 12px;\n                font-weight: bold;\n                color: var(--acu-text-sub);\n                margin-right: 15px;\n                padding-right: 15px;\n                border-right: 1px solid var(--acu-border);\n                white-space: nowrap;\n                opacity: 0.8;\n            }\n\n            .acu-actions-group { grid-column: 1 / -1; display: flex; justify-content: flex-end; gap: 4px; border-top: 1px dashed var(--acu-border); padding-top: 8px; margin-top: 4px; min-height: 36px; transition: all 0.2s; }\n\n            /* []  */\n            .acu-pos-top .acu-actions-group { order: -1; border-top: none; border-bottom: 1px dashed var(--acu-border); margin-top: 0; margin-bottom: 6px; padding-top: 0; padding-bottom: 8px; }\n\n            /* []  */\n            .acu-pos-top .acu-unused-pool { order: -1; margin-bottom: 10px; border-bottom: 1px dashed var(--acu-border); }\n            .acu-actions-group.dragging-over { background: rgba(127, 127, 127, 0.05); box-shadow: inset 0 0 10px rgba(0,0,0,0.05); }\n\n            /*  */\n                .acu-dash-body.acu-dash-horizontal {\n                    display: flex;\n                    flex-wrap: nowrap;\n                    gap: 15px;\n                    overflow-x: auto;\n                    overflow-y: hidden;\n                    padding-bottom: 10px;\n                }\n                .acu-dash-body.acu-dash-horizontal > div {\n                    flex: 0 0 280px;\n                    min-width: 280px;\n                    max-height: 60vh;\n                    overflow-y: auto;\n                }\n                @media (min-width: 769px) {\n                    .acu-dash-body.acu-dash-horizontal > div {\n                        flex: 0 0 320px;\n                        min-width: 320px;\n                    }\n                }\n            /* Mobile adjustments to keep it usable there */\n            @media (max-width: 768px) {\n                .acu-unused-pool { justify-content: center; background: rgba(0,0,0,0.05); border: 1px dashed var(--acu-border); border-bottom: none; margin: 0 0 8px 0; border-radius: 6px; }\n                .acu-unused-pool::before { display: block; width: 100%; text-align: center; margin-bottom: 4px; content: \" ()\"; }\n                .acu-order-controls { flex-direction: column; gap: 6px; text-align: center; }\n            }\n            .acu-actions-group.dragging-over { background: rgba(var(--acu-accent-rgb), 0.1); border-color: var(--acu-accent); }\n            .acu-settings-item { margin-bottom: 15px; }\n            .acu-settings-label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 13px; color: #ccc; }\n            .acu-settings-val { float: right; color: #4cd964; font-size: 12px; }\n            .acu-slider { width: 100%; height: 4px; background: #555; border-radius: 2px; outline: none; -webkit-appearance: none; }\n            .acu-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: #fff; border-radius: 50%; cursor: pointer; }\n            .acu-select { width: 100%; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid #555; color: #fff; border-radius: 4px; outline: none; }\n            .acu-edit-overlay input[type=\"checkbox\"].acu-checkbox { margin-right: 10px; accent-color: var(--acu-accent) !important; background: transparent !important; background-color: transparent !important; }\n            .acu-btn-block { width: 100%; padding: 10px; background: #444; color: #eee; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 10px; }\n            .acu-btn-block:hover { background: #555; color: #fff; }\n            .acu-expand-trigger { background: var(--acu-bg-nav); border: 1px solid var(--acu-border); box-shadow: 0 2px 6px var(--acu-shadow); cursor: pointer; color: var(--acu-text-main); font-size: 13px; font-weight: bold; display: flex; align-items: center; gap: 6px; transition: all 0.2s; z-index: 2147483645 !important; }\n            .acu-expand-trigger:hover { background: var(--acu-btn-hover); transform: translateY(-2px); }\n            .acu-col-bar { width: 100%; justify-content: center; padding: 8px 10px; border-radius: 6px; }\n            .acu-col-pill { width: auto !important; padding: 6px 16px; border-radius: 50px; }\n            .acu-col-mini { width: 40px !important; height: 40px !important; padding: 0; justify-content: center; border-radius: 50%; }\n            .acu-col-mini span { display: none; }\n            /* []  */\n            .acu-nav-toggle-btn:hover { opacity: 1 !important; transform: translateY(-50%) scale(1.2); color: var(--acu-accent); }\n            .acu-align-right { margin-left: auto; align-self: flex-end; }\n            .acu-align-left { margin-right: auto; margin-left: 0; align-self: flex-start; }\n            .acu-nav-container.acu-left-mode .acu-actions-group { order: -1; margin-left: 0; margin-right: 10px; }\n            #acu-btn-collapse { color: var(--acu-text-sub); }\n            #acu-btn-collapse:hover { color: var(--acu-text-main); background: rgba(0,0,0,0.05); }\n            @keyframes acu-breathe { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.6; transform: scale(0.85); color: #ff7e67; } 100% { opacity: 1; transform: scale(1); } } .acu-icon-breathe { animation: acu-breathe 3s infinite ease-in-out !important; display: inline-block; }\n\n            @media (min-width: 768px) {\n                .acu-wrapper.acu-mode-embedded .acu-nav-container { width: fit-content !important; min-width: 300px; max-width: 100%; margin: 0 auto; border-radius: 50px; box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important; border: 1px solid var(--acu-border); padding: 6px 20px; background: var(--acu-bg-nav) !important; }\n                .acu-wrapper.acu-mode-embedded .acu-data-display { bottom: calc(100% + 12px) !important; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2) !important; }\n                .acu-nav-container { display: flex; flex-wrap: wrap !important; gap: 6px !important; padding: 6px 10px; grid-template-columns: none !important; flex-direction: row !important; justify-content: flex-start !important; align-items: center !important; height: auto !important; }\n                .acu-nav-container .acu-nav-btn { width: fit-content !important; flex: 0 0 auto !important; height: 32px !important; padding: 0 12px; font-size: 13px !important; min-width: auto !important; }\n                .acu-nav-btn span { max-width: 200px; }\n                .acu-action-btn { flex: 0 0 32px !important; width: 32px !important; height: 32px !important; background: transparent !important; color: var(--acu-text-sub) !important; border-radius: 6px; border: 1px solid transparent; }\n                .acu-action-btn:hover { background: var(--acu-btn-hover) !important; color: var(--acu-text-main) !important; transform: scale(1.1); box-shadow: none; }\n                #acu-btn-save-global { color: var(--acu-accent) !important; }\n                #acu-btn-save-global:hover { background: var(--acu-accent) !important; color: #fff !important; }\n                .acu-order-controls { margin: 0 0 8px 0; padding: 4px; }\n                .acu-actions-group { width: auto !important; margin-left: auto !important; border-top: none !important; border-bottom: none !important; padding: 0; margin-top: 0 !important; margin-bottom: 0 !important; gap: 4px !important; background: transparent; justify-content: flex-end; order: 9999 !important; display: flex; }\n                .acu-pos-top .acu-actions-group { order: -1 !important; margin-left: 0 !important; margin-right: 10px !important; justify-content: flex-start !important; }\n            }\n            @media (max-width: 768px) {\n                .acu-panel-content { -webkit-overflow-scrolling: touch !important; overscroll-behavior-y: auto; }\n                .acu-data-card { box-shadow: none !important; border: 1px solid var(--acu-border); transform: translateZ(0); }\n                .acu-data-card:hover { transform: none !important; box-shadow: none !important; }\n                .acu-nav-btn:hover { transform: none !important; }\n            }\n            /* ===  === */\n            @media (max-width: 768px) {\n                .acu-dice-panel, .acu-contest-panel {\n                    position: fixed !important;\n                    top: 5% !important;\n                    left: 50% !important;\n                    transform: translateX(-50%) !important;\n                    width: 92vw !important;\n                    max-width: 400px !important;\n                    max-height: 88vh !important;\n                    overflow-y: auto !important;\n                }\n                .acu-dice-panel > div:last-child, .acu-contest-panel > div:last-child {\n                    max-height: none !important;\n                    overflow-y: visible !important;\n                }\n                .acu-dice-overlay, .acu-contest-overlay {\n                    align-items: flex-start !important;\n                    padding-top: 5vh !important;\n                }\n            }\n                /* ===  === */\n                .acu-dash-body {\n                    display: grid;\n                    grid-template-columns: 1fr 1.2fr 1fr;\n                    gap: 15px;\n                    margin: 15px 0;\n                }\n\n                .acu-dash-locations {\n                    background: var(--acu-card-bg);\n                    padding: 12px;\n                    border-radius: 8px;\n                    border: 1px solid var(--acu-border);\n                }\n\n                .acu-dash-locations h3 {\n                    margin: 0 0 10px 0;\n                    font-size: 14px;\n                    color: var(--acu-accent);\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                }\n\n                .acu-location-group {\n                    margin-bottom: 8px;\n                    border-radius: 6px;\n                    overflow: hidden;\n                    background: var(--acu-card-bg);\n                    border: 1px solid transparent;\n                    transition: all 0.2s;\n                }\n\n                .acu-location-group.expanded {\n                    border-color: var(--acu-accent);\n                }\n\n                .acu-location-header {\n                    padding: 8px 10px;\n                    cursor: pointer;\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                    background: var(--acu-table-head);\n                    transition: all 0.2s;\n                    user-select: none;\n                }\n\n                .acu-location-header:hover {\n                    background: var(--acu-table-hover);\n                }\n\n                .acu-expand-icon {\n                    font-size: 10px;\n                    transition: transform 0.2s;\n                    color: var(--acu-text-sub);\n                }\n\n                .acu-location-group.expanded .acu-expand-icon {\n                    transform: rotate(90deg);\n                    color: var(--acu-accent);\n                }\n\n                .acu-region-name {\n                    flex: 1;\n                    font-weight: bold;\n                    font-size: 13px;\n                    color: var(--acu-text-main);\n                }\n\n                .acu-location-count {\n                    font-size: 11px;\n                    color: var(--acu-text-sub);\n                }\n\n                .acu-location-list {\n                    max-height: 0;\n                    overflow: hidden;\n                    transition: max-height 0.3s ease;\n                }\n\n                .acu-location-group.expanded .acu-location-list {\n                    max-height: 500px;\n                }\n\n                .acu-location-item {\n                    padding: 6px 10px 6px 26px;\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                    font-size: 12px;\n                    border-bottom: 1px dashed rgba(0,0,0,0.05);\n                    transition: all 0.15s;\n                }\n\n                /*  */\n                .acu-dash-locations .acu-location-item {\n                    padding: 4px 8px !important;\n                    min-width: 0; /* flex */\n                    overflow: hidden; /*  */\n                }\n\n                .acu-dash-locations .acu-location-item > span:first-child {\n                    display: flex !important;\n                    align-items: center;\n                    gap: 6px;\n                    flex: 1;\n                    min-width: 0; /* flex */\n                    overflow: hidden;\n                }\n\n                .acu-dash-locations .acu-location-item > span:first-child i {\n                    flex-shrink: 0; /*  */\n                }\n\n                .acu-dash-locations .acu-location-item > span:first-child > span {\n                    white-space: nowrap;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                    flex: 1;\n                    min-width: 0; /* flex */\n                }\n\n                .acu-location-item:last-child {\n                    border-bottom: none;\n                }\n\n                .acu-location-item:hover {\n                    background: var(--acu-table-hover);\n                    transform: translateX(4px);\n                }\n\n                .acu-location-item.current {\n                    background: var(--acu-hl-diff-bg);\n                    font-weight: bold;\n                    color: var(--acu-hl-diff);\n                }\n\n                .acu-location-item i {\n                    font-size: 10px;\n                    opacity: 0.6;\n                }\n\n                .acu-current-badge {\n                    margin-left: auto;\n                    font-size: 10px;\n                    padding: 2px 6px;\n                    background: var(--acu-btn-active-bg);\n                    color: var(--acu-btn-active-text);\n                    border-radius: 3px;\n                    font-weight: bold;\n                }\n                /* ===  === */\n                .acu-dash-context {\n                    background: linear-gradient(135deg, var(--acu-table-head), var(--acu-bg-panel));\n                    padding: 15px;\n                    border-radius: 8px;\n                    margin-bottom: 15px;\n                    border: 1px solid var(--acu-border);\n                }\n\n                .acu-dash-location {\n                    font-size: 18px;\n                    font-weight: bold;\n                    color: var(--acu-accent);\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                }\n\n                .acu-dash-location-desc {\n                    font-size: 13px;\n                    color: var(--acu-text-sub);\n                    margin-top: 6px;\n                    line-height: 1.5;\n                }\n\n                .acu-dash-player, .acu-dash-intel {\n                    background: var(--acu-card-bg);\n                    padding: 12px;\n                    border-radius: 8px;\n                    border: 1px solid var(--acu-border);\n                }\n\n                .acu-dash-player h3, .acu-dash-intel h3 {\n                    margin: 0 0 10px 0;\n                    font-size: 14px;\n                    color: var(--acu-accent);\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                }\n\n                .acu-player-status {\n                    font-size: 13px;\n                    color: var(--acu-text-main);\n                }\n\n                .acu-task-item {\n                    padding: 8px;\n                    margin-bottom: 6px;\n                    background: rgba(0,0,0,0.03);\n                    border-radius: 6px;\n                    border-left: 3px solid var(--acu-border);\n                }\n\n                .acu-task-name {\n                    font-size: 13px;\n                    font-weight: 500;\n                    color: var(--acu-text-main);\n                }\n\n                .acu-empty-hint {\n                    font-size: 12px;\n                    color: var(--acu-text-sub);\n                    text-align: center;\n                    padding: 15px;\n                    opacity: 0.7;\n                }\n                /*  */\n                .acu-changes-content .acu-empty-hint {\n                    flex: 1;\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    justify-content: center;\n                    min-height: 200px;\n                }\n\n                .acu-dashboard-content {\n                    padding: 15px;\n                    overflow-y: auto !important;\n                    overflow-x: hidden !important;\n                    -webkit-overflow-scrolling: touch !important;\n                    touch-action: pan-y !important;\n                    overscroll-behavior-y: contain;\n                    max-height: calc(80vh - 60px);\n                }\n\n                /* ===  === */\n                h3.acu-dash-table-link,\n                h4.acu-dash-table-link {\n                    cursor: pointer;\n                    transition: all 0.15s;\n                    padding: 2px 4px;\n                    margin: -2px -4px;\n                    border-radius: 4px;\n                }\n                h3.acu-dash-table-link:hover,\n                h4.acu-dash-table-link:hover {\n                    color: var(--acu-accent);\n                    background: var(--acu-table-hover);\n                }\n\n                /*  - + */\n                .acu-dash-dice-btn,\n                .acu-dash-goto-btn,\n                .acu-dash-use-item-btn,\n                .acu-dash-use-skill-btn,\n                .acu-dash-track-task-btn,\n                .acu-dash-msg-btn,\n                .acu-dash-contest-btn,\n                .acu-dash-dice-free,\n                .acu-dash-relation-graph-btn,\n                .acu-dash-avatar-manager-btn {\n                    cursor: pointer;\n                    color: var(--acu-text-sub);\n                    opacity: 0.5;\n                    font-size: 14px !important;\n                    padding: 6px;\n                    margin: -4px;\n                    border-radius: 4px;\n                    transition: all 0.15s;\n                    display: inline-flex;\n                    align-items: center;\n                    justify-content: center;\n                    min-width: 28px;\n                    min-height: 28px;\n                }\n                .acu-dash-dice-btn:hover,\n                .acu-dash-goto-btn:hover,\n                .acu-dash-use-item-btn:hover,\n                .acu-dash-use-skill-btn:hover,\n                .acu-dash-track-task-btn:hover,\n                .acu-dash-msg-btn:hover,\n                .acu-dash-contest-btn:hover,\n                .acu-dash-dice-free:hover {\n                    opacity: 1;\n                    color: var(--acu-accent);\n                    background: var(--acu-table-hover);\n                    transform: scale(1.1);\n                }\n\n                /*  -  */\n                .acu-dash-clickable {\n                    cursor: pointer;\n                    transition: all 0.15s;\n                    border-radius: 4px;\n                }\n                .acu-dash-clickable:hover {\n                    background: var(--acu-table-hover);\n                }\n                .acu-dash-clickable:active {\n                    transform: scale(0.98);\n                }\n\n                @media (max-width: 768px) {\n                    .acu-dash-body {\n                        grid-template-columns: 1fr;\n                        max-height: none;\n                        overflow: visible;\n                    }\n\n                    .acu-dashboard-content {\n                        max-height: calc(75vh - 50px) !important;\n                        padding-bottom: 20px !important;\n                    }\n\n                    /*  */\n                    .acu-dash-dice-btn,\n                    .acu-dash-goto-btn,\n                    .acu-dash-use-item-btn,\n                    .acu-dash-use-skill-btn,\n                    .acu-dash-track-task-btn,\n                    .acu-dash-msg-btn,\n                    .acu-dash-contest-btn,\n                    .acu-dash-dice-free {\n                        font-size: 16px !important;\n                        padding: 8px;\n                        min-width: 36px;\n                        min-height: 36px;\n                    }\n                }\n            /* ===  === */\n            .acu-preview-overlay {\n                z-index: 2147483650;\n                backdrop-filter: blur(3px);\n                animation: acuFadeIn 0.2s ease;\n            }\n\n                .acu-preview-overlay .acu-data-card {\n                    width: 90vw;\n                    max-width: 400px;\n                    flex: none;\n                }\n                @media (min-width: 768px) {\n                    .acu-preview-overlay .acu-data-card {\n                        max-width: 550px;\n                    }\n                }\n\n            .acu-preview-close:hover {\n                background: var(--acu-error-bg, rgba(231, 76, 60, 0.1));\n                color: var(--acu-error-text, #e74c3c);\n            }\n\n            .acu-dash-clickable {\n                cursor: pointer;\n                transition: all 0.15s;\n            }\n\n            .acu-dash-clickable:hover {\n                background: var(--acu-table-hover);\n            }\n            .acu-current-location span {\n                color: var(--acu-accent);\n                font-weight: 600;\n            }\n            .acu-current-location i {\n                color: var(--acu-accent);\n            }\n            /* ===  === */\n            .acu-dropdown-wrapper { position: relative; width: 100%; }\n            .acu-dropdown-list {\n                position: absolute;\n                top: 100%;\n                left: 0;\n                right: 0;\n                max-height: 150px;\n                overflow-y: auto;\n                border: 1px solid;\n                border-radius: 4px;\n                box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n                z-index: 2147483649;\n                display: none;\n            }\n            .acu-dropdown-list.visible { display: block; }\n            .acu-dropdown-item {\n                padding: 6px 10px;\n                font-size: 12px;\n                cursor: pointer;\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                background: transparent;\n                transition: background 0.1s;\n            }\n            .acu-dropdown-empty {\n                padding: 8px 10px;\n                font-size: 12px;\n                text-align: center;\n                opacity: 0.7;\n            }\n            /* ===  === */\n            .acu-input-wrapper { position: relative; display: flex; align-items: center; width: 100%; }\n            .acu-input-wrapper input { padding-right: 24px !important; }\n            .acu-clear-btn { position: absolute; right: 6px; top: 50%; transform: translateY(-50%); background: transparent !important; border: none !important; font-size: 12px; cursor: pointer; padding: 4px; line-height: 1; opacity: 0.5; transition: opacity 0.2s; z-index: 5; }\n            .acu-clear-btn:hover { background: transparent !important; border: none !important; opacity: 1 !important; }\n\n            /* ==========  ========== */\n            .acu-relation-graph-overlay {\n                background: rgba(0,0,0,0.8);\n                z-index: 2147483650;\n                backdrop-filter: blur(4px);\n            }\n            .acu-relation-graph-container {\n                width: 95%;\n                max-width: 900px;\n                height: 85vh;\n                max-height: 700px;\n            }\n            .acu-graph-title {\n                font-size: 16px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .acu-graph-actions {\n                display: flex;\n                gap: 8px;\n            }\n            .acu-graph-btn {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s;\n            }\n            .acu-graph-btn:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n            }\n            .acu-graph-canvas-wrapper {\n                flex: 1;\n                overflow: hidden;\n                position: relative;\n                min-height: 0;\n            }\n            .acu-graph-svg {\n                width: 100%;\n                height: 100%;\n                cursor: grab;\n            }\n            .acu-graph-svg:active { cursor: grabbing; }\n            .acu-graph-edge {\n                stroke: var(--acu-border);\n                stroke-width: 2;\n                opacity: 0.6;\n            }\n            .acu-graph-edge-label {\n                font-size: 11px;\n                fill: var(--acu-text-sub);\n                text-anchor: middle;\n                pointer-events: none;\n            }\n            .acu-graph-node { cursor: grab; }\n            .acu-graph-node:active { cursor: grabbing; }\n            .acu-node-bg {\n                fill: var(--acu-btn-bg);\n                stroke: var(--acu-border);\n                stroke-width: 2;\n                transition: all 0.2s;\n            }\n            .acu-node-bg.player {\n                fill: var(--acu-accent);\n                stroke: var(--acu-btn-active-text);\n            }\n            .acu-graph-node:hover .acu-node-bg {\n                stroke: var(--acu-accent);\n                stroke-width: 3;\n                filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));\n            }\n            .acu-graph-node:hover .acu-node-avatar {\n                box-shadow: 0 0 0 2px var(--acu-accent);\n            }\n            .acu-graph-svg.highlighting .acu-graph-node {\n                opacity: 0.2;\n                transition: opacity 0.2s ease;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge {\n                opacity: 0.1;\n                transition: opacity 0.2s ease;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge-label {\n                opacity: 0.1;\n                transition: opacity 0.2s ease;\n            }\n            .acu-graph-svg.highlighting .acu-graph-node.highlighted {\n                opacity: 1;\n            }\n            .acu-graph-svg.highlighting .acu-graph-node.highlighted .acu-node-bg {\n                stroke: var(--acu-accent);\n                stroke-width: 3;\n            }\n            .acu-graph-svg.highlighting .acu-graph-node.highlighted .acu-node-avatar {\n                box-shadow: 0 0 0 2px var(--acu-accent);\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge.highlighted {\n                opacity: 1;\n                stroke: var(--acu-accent);\n                stroke-width: 3;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge-label.highlighted {\n                opacity: 1;\n                fill: var(--acu-accent);\n                font-weight: bold;\n            }\n            .acu-node-char {\n                font-size: 16px;\n                font-weight: bold;\n                fill: var(--acu-text-main);\n                text-anchor: middle;\n                pointer-events: none;\n            }\n            .acu-node-bg.player + text.acu-node-char,\n            .acu-node-bg.player ~ text.acu-node-char {\n                fill: var(--acu-btn-active-text);\n            }\n            .acu-node-label {\n                font-size: 12px;\n                fill: var(--acu-text-main);\n                text-anchor: middle;\n                pointer-events: none;\n            }\n            .acu-node-inscene-indicator {\n                fill: var(--acu-accent);\n                stroke: var(--acu-bg-panel);\n                stroke-width: 2;\n                filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));\n            }\n            .acu-graph-legend {\n                display: flex;\n                gap: 16px;\n                justify-content: center;\n                padding: 10px;\n                border-top: 1px solid var(--acu-border);\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                flex-shrink: 0;\n            }\n            .acu-graph-legend span {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            .acu-zoom-display {\n                background: var(--acu-btn-bg);\n                padding: 2px 8px;\n                border-radius: 4px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                min-width: 45px;\n                text-align: center;\n            }\n            .acu-node-size-slider-container input[type=\"range\"] {\n                -webkit-appearance: none;\n                appearance: none;\n                height: 10px;\n                border-radius: 5px;\n                background: var(--acu-btn-bg);\n                outline: none;\n                cursor: pointer;\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-webkit-slider-thumb {\n                -webkit-appearance: none;\n                appearance: none;\n                width: 20px;\n                height: 20px;\n                border-radius: 50%;\n                background: var(--acu-accent);\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n                transition: all 0.2s;\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-webkit-slider-thumb:hover {\n                transform: scale(1.1);\n                box-shadow: 0 3px 6px rgba(0,0,0,0.4);\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-moz-range-thumb {\n                width: 20px;\n                height: 20px;\n                border-radius: 50%;\n                background: var(--acu-accent);\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n                transition: all 0.2s;\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-moz-range-thumb:hover {\n                transform: scale(1.1);\n                box-shadow: 0 3px 6px rgba(0,0,0,0.4);\n            }\n            .acu-node-size-slider-container input[type=\"range\"]::-moz-range-track {\n                height: 10px;\n                border-radius: 5px;\n                background: var(--acu-btn-bg);\n            }\n            @media (max-width: 768px) {\n                .acu-relation-graph-container {\n                    width: 100%;\n                    height: 80vh;\n                    max-height: none;\n                    border-radius: 12px;\n                }\n                .acu-graph-legend {\n                    gap: 8px;\n                    flex-wrap: nowrap;\n                    padding: 8px 6px;\n                }\n            }\n\n            /* ==========  ========== */\n            .acu-map-overlay {\n                background: rgba(0,0,0,0.8);\n                z-index: 2147483650;\n                backdrop-filter: blur(4px);\n            }\n            .acu-map-container {\n                width: 95%;\n                max-width: 500px;\n                max-height: 85vh;\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;\n                box-shadow: 0 10px 40px rgba(0,0,0,0.45);\n            }\n            .acu-map-title {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                white-space: nowrap;\n                flex-shrink: 0;\n            }\n            .acu-map-actions {\n                display: flex;\n                gap: 6px;\n                align-items: center;\n            }\n            .acu-map-actions button {\n                width: 28px;\n                height: 28px;\n                border-radius: 6px;\n                border: 1px solid var(--acu-border);\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.15s;\n            }\n            .acu-map-actions button:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent);\n            }\n            .acu-map-body {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n                padding: 12px;\n                overflow: hidden;\n            }\n            /*  - 3Grid */\n            .acu-map-focus-area {\n                display: grid;\n                grid-template-columns: 1fr auto 1fr;\n                gap: 12px;\n                align-items: center;\n                border: 1px dashed var(--acu-border);\n                border-radius: 12px;\n                padding: 16px;\n                background: var(--acu-btn-bg);\n            }\n\n            /*  */\n            .acu-map-wing {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n                min-width: 0;\n                align-self: flex-start; /*  */\n            }\n            .acu-map-wing.left { align-items: flex-end; text-align: right; }\n            .acu-map-wing.right { align-items: flex-start; text-align: left; }\n\n            .acu-map-mobile-stack {\n                display: none;\n            }\n\n            /*  */\n            .acu-map-avatar-group {\n                display: flex;\n                flex-wrap: wrap;\n                gap: 6px;\n                align-items: flex-start; /*  */\n                min-height: 70px; /*  */\n            }\n            .acu-map-wing.left .acu-map-avatar-group { justify-content: flex-end; }\n            .acu-map-wing.right .acu-map-avatar-group { justify-content: flex-start; }\n\n            /*  */\n            .acu-map-wing.left .acu-map-avatar:not(:last-child) { margin-right: -12px; }\n            .acu-map-wing.right .acu-map-avatar:not(:first-child) { margin-left: -12px; }\n            .acu-map-avatar:hover { transform: scale(1.1); z-index: 10; position: relative; }\n\n            .acu-map-avatar {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 4px;\n                min-width: 56px;\n                cursor: pointer;\n                transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);\n            }\n            .acu-map-avatar-circle {\n                width: 46px;\n                height: 46px;\n                border-radius: 50%;\n                border: 2px solid var(--acu-accent);\n                background: var(--acu-btn-bg);\n                background-size: cover;\n                background-position: center;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: var(--acu-text-sub);\n                font-weight: bold;\n                font-size: 16px;\n                box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n            }\n            .acu-map-avatar-name {\n                font-size: 11px;\n                color: var(--acu-text-main);\n                text-shadow: 0 1px 2px rgba(0,0,0,0.3);\n            }\n\n            /*  */\n            .acu-map-element-group {\n                display: flex;\n                flex-direction: column;\n                gap: 6px;\n                max-width: 140px;\n            }\n            .acu-map-element-chip {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                padding: 4px 8px;\n                border-radius: 6px;\n                border: 1px solid var(--acu-border);\n                background: var(--acu-bg-panel);\n                font-size: 11px;\n                color: var(--acu-text-main);\n                cursor: pointer;\n                transition: all 0.15s;\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            .acu-map-element-chip:hover {\n                border-color: var(--acu-accent);\n                color: var(--acu-accent);\n                transform: translateX(2px);\n            }\n\n            /*  */\n            .acu-map-stage-center {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                min-width: 100px;\n                z-index: 2;\n                cursor: pointer;\n            }\n\n            /* Emoji */\n            .acu-map-location-emoji {\n                background: transparent;\n                border: none;\n                width: auto;\n                height: auto;\n                font-size: 4rem;\n                line-height: 1;\n                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));\n                transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n            }\n            .acu-map-location-emoji:hover { transform: scale(1.1) rotate(5deg); }\n\n            /* emoji */\n            .acu-map-location-text {\n                width: 64px;\n                height: 64px;\n                border-radius: 12px;\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 28px;\n                font-weight: bold;\n                color: var(--acu-text-sub);\n            }\n\n            /*  */\n            .acu-map-location-name {\n                margin-top: 8px;\n                font-weight: 700;\n                font-size: 1.1em;\n                max-width: 140px;\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                color: var(--acu-text-main);\n            }\n\n            /*  */\n            .acu-map-thumbnails {\n                display: grid;\n                grid-template-columns: repeat(3, minmax(0, 1fr));\n                gap: 12px;\n                max-height: 50vh;\n                overflow-y: auto;\n                overflow-x: hidden;\n                padding: 12px;\n                box-sizing: border-box;\n            }\n            .acu-map-thumbnail {\n                position: relative;\n                border: 1px solid var(--acu-border);\n                border-radius: 10px;\n                padding: 8px;\n                background: var(--acu-btn-bg);\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 4px;\n                cursor: pointer;\n                transition: all 0.15s;\n            }\n            .acu-map-thumbnail.active {\n                border-color: var(--acu-accent);\n                box-shadow: 0 0 0 1px var(--acu-accent);\n            }\n            .acu-map-thumbnail:hover {\n                border-color: var(--acu-accent);\n                transform: translateY(-2px);\n            }\n            .acu-map-thumbnail-emoji {\n                width: 36px;\n                height: 36px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 24px;\n                filter: drop-shadow(0 1px 2px rgba(0,0,0,0.2));\n            }\n            .acu-map-thumbnail-placeholder {\n                width: 36px;\n                height: 36px;\n                border-radius: 8px;\n                background: var(--acu-bg-panel);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-text-sub);\n                border: 1px solid var(--acu-border);\n            }\n            .acu-map-thumbnail-name { font-size: 11px; color: var(--acu-text-main); }\n\n            /*  */\n            .acu-map-thumbnail-badge {\n                position: absolute;\n                top: -8px;\n                right: -8px;\n                min-width: 22px;\n                height: 22px;\n                padding: 0 6px;\n                border-radius: 99px;\n                background: var(--acu-accent);\n                color: #ffffff;\n                font-size: 0.75rem;\n                font-weight: 800;\n                font-variant-numeric: tabular-nums;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                box-shadow: 0 3px 6px rgba(0,0,0,0.25);\n                border: 3px solid var(--acu-btn-bg);\n                z-index: 10;\n                transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);\n            }\n\n            .acu-map-thumbnail:hover .acu-map-thumbnail-badge {\n                transform: scale(1.1);\n            }\n\n            /*  */\n            .acu-map-region-tabs {\n                display: flex;\n                flex-wrap: wrap;\n                gap: 4px;\n                margin-left: auto;\n                margin-right: 8px;\n            }\n            .acu-map-region-tab {\n                padding: 4px 10px;\n                border-radius: 6px;\n                border: 1px solid var(--acu-border);\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.15s;\n            }\n            .acu-map-region-tab.active,\n            .acu-map-region-tab:hover {\n                background: var(--acu-accent);\n                color: white;\n                border-color: var(--acu-accent);\n            }\n\n            .acu-map-empty {\n                text-align: center;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n                padding: 8px 0;\n            }\n            .acu-map-loading {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                padding: 40px;\n                width: 100%;\n            }\n            .acu-map-spinner {\n                width: 32px;\n                height: 32px;\n                border: 3px solid var(--acu-border);\n                border-top-color: var(--acu-accent);\n                border-radius: 50%;\n                animation: acu-map-spin 0.8s linear infinite;\n            }\n            @keyframes acu-map-spin { to { transform: rotate(360deg); } }\n            @media (max-width: 768px) {\n                .acu-map-container {\n                    width: 96%;\n                    max-height: 92vh;\n                }\n                .acu-map-focus-area {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 12px;\n                    padding: 16px 12px;\n                    background: var(--acu-btn-bg);\n                }\n                .acu-map-stage-center {\n                    width: 100%;\n                    margin-bottom: 4px;\n                    flex-direction: row;\n                    justify-content: center;\n                    gap: 12px;\n                }\n                .acu-map-location-emoji {\n                    font-size: 2.5rem;\n                    width: 48px;\n                    height: 48px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                }\n                .acu-map-location-text {\n                    width: 48px;\n                    height: 48px;\n                    font-size: 20px;\n                }\n                .acu-map-location-name {\n                    margin-top: 0;\n                    font-size: 1.25rem;\n                    max-width: none;\n                    text-align: left;\n                    align-self: center;\n                }\n                .acu-map-wing {\n                    display: none;\n                }\n                .acu-map-mobile-stack {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 10px;\n                    width: 100%;\n                }\n                .acu-map-mobile-avatars,\n                .acu-map-mobile-elements {\n                    display: flex;\n                    flex-wrap: wrap;\n                    justify-content: center;\n                    gap: 8px;\n                    max-height: 168px;\n                    overflow-y: auto;\n                    padding: 2px 4px;\n                }\n                .acu-map-mobile-avatars:empty,\n                .acu-map-mobile-elements:empty {\n                    display: none;\n                }\n                .acu-map-avatar {\n                    min-width: auto;\n                    width: 52px;\n                }\n                .acu-map-avatar-circle {\n                    width: 42px;\n                    height: 42px;\n                }\n                .acu-map-element-chip {\n                    font-size: 12px;\n                    padding: 6px 10px;\n                    background: var(--acu-bg-panel);\n                }\n                .acu-map-thumbnails {\n                    grid-template-columns: repeat(3, minmax(0, 1fr));\n                    gap: 10px;\n                }\n            }\n\n            /* ==========  ========== */\n            .acu-avatar-manager-overlay {\n                background: rgba(0,0,0,0.7);\n                z-index: 2147483655;\n            }\n            .acu-avatar-manager {\n                width: 90%;\n                max-width: 500px;\n                max-height: 80vh;\n            }\n            .acu-avatar-title {\n                font-size: 15px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            .acu-avatar-list {\n                flex: 1;\n                overflow-y: auto;\n                padding: 12px;\n                min-height: 0;\n            }\n            .acu-avatar-item {\n                display: flex;\n                align-items: flex-start;\n                gap: 12px;\n                padding: 10px;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n            .acu-avatar-item:last-child { border-bottom: none; }\n            .acu-avatar-preview {\n                width: 48px;\n                height: 48px;\n                border-radius: 50%;\n                background: var(--acu-btn-bg);\n                background-size: cover;\n                background-position: center;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                border: 2px solid var(--acu-border);\n                flex-shrink: 0;\n                position: relative;\n                cursor: pointer;\n            }\n            .acu-avatar-preview span {\n                font-size: 18px;\n                font-weight: bold;\n                color: var(--acu-text-sub);\n            }\n            .acu-avatar-camera-hint {\n                position: absolute;\n                bottom: 2px;\n                right: 2px;\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                opacity: 0.5;\n                pointer-events: none;\n            }\n            .acu-avatar-preview:hover .acu-avatar-camera-hint {\n                opacity: 0.8;\n                color: var(--acu-accent);\n            }\n            .acu-avatar-info {\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-avatar-name {\n                font-size: 13px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n                margin-bottom: 4px;\n            }\n            .acu-avatar-name-row {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                gap: 8px;\n                margin-bottom: 6px;\n            }\n            .acu-avatar-manager-overlay input.acu-avatar-url,\n            .acu-avatar-manager-overlay input.acu-avatar-aliases {\n                width: 100%;\n                padding: 6px 8px;\n                font-size: 12px;\n                border: 1px solid var(--acu-border);\n                border-radius: 4px;\n                background: var(--acu-btn-bg) !important;\n                color: var(--acu-text-main) !important;\n                box-sizing: border-box;\n                -webkit-appearance: none;\n                appearance: none;\n            }\n            .acu-avatar-manager-overlay input.acu-avatar-url:focus,\n            .acu-avatar-manager-overlay input.acu-avatar-aliases:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n                box-shadow: none !important;\n            }\n            /* URL +  */\n            .acu-avatar-input-row {\n                display: flex;\n                gap: 6px;\n                align-items: center;\n            }\n            .acu-avatar-input-row .acu-avatar-url {\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-avatar-upload-btn {\n                width: 32px;\n                height: 32px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                flex-shrink: 0;\n                transition: all 0.15s;\n            }\n            .acu-avatar-upload-btn:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent);\n            }\n            .acu-avatar-upload-btn:active {\n                transform: scale(0.95);\n            }\n            /*  */\n            .acu-avatar-source {\n                position: absolute;\n                bottom: -10px;\n                left: 50%;\n                transform: translateX(-50%);\n                font-size: 9px;\n                padding: 1px 6px;\n                border-radius: 8px;\n                font-weight: bold;\n                white-space: nowrap;\n            }\n            .acu-avatar-preview-wrap {\n                position: relative;\n                flex-shrink: 0;\n            }\n            .acu-source-local,\n            .acu-source-url,\n            .acu-source-auto {\n                background: var(--acu-badge-bg);\n                color: var(--acu-text-sub);\n            }\n            .acu-avatar-manager-overlay input.acu-avatar-aliases {\n                padding: 4px 8px;\n                font-size: 11px;\n                margin-top: 4px;\n            }\n            .acu-avatar-manager-overlay input::placeholder {\n                color: var(--acu-text-sub) !important;\n                opacity: 0.7;\n            }\n            .acu-avatar-actions {\n                display: flex;\n                flex-direction: row;\n                gap: 4px;\n                flex-shrink: 0;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-actions button {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg) !important;\n                color: var(--acu-text-sub) !important;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-actions button:hover {\n                background: var(--acu-btn-hover) !important;\n                color: var(--acu-accent) !important;\n            }\n            .acu-avatar-save-btn:hover { color: var(--acu-success-text, #27ae60) !important; }\n            .acu-avatar-clear-btn:hover { color: var(--acu-error-text, #e74c3c) !important; }\n            .acu-avatar-import-btn,\n            .acu-avatar-export-btn {\n                width: 28px;\n                height: 28px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 12px;\n                transition: all 0.2s;\n            }\n            .acu-avatar-import-btn:hover,\n            .acu-avatar-export-btn:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n            }\n            .acu-avatar-crop-row {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                margin-top: 6px;\n                font-size: 11px;\n                color: var(--acu-text-sub);\n            }\n            .acu-avatar-crop-row.hidden { display: none; }\n            .acu-avatar-manager-overlay .acu-avatar-scale {\n                flex: 1;\n                height: 6px !important;\n                -webkit-appearance: none !important;\n                appearance: none !important;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                outline: none;\n                border: none;\n                margin: 0 8px;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-webkit-slider-runnable-track {\n                height: 6px !important;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                border: none;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-webkit-slider-thumb {\n                -webkit-appearance: none !important;\n                appearance: none !important;\n                width: 16px !important;\n                height: 16px !important;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                cursor: pointer !important;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 1px 3px rgba(0,0,0,0.3) !important;\n                margin-top: -5px !important;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-moz-range-track {\n                height: 6px !important;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                border: none;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-moz-range-thumb {\n                width: 16px !important;\n                height: 16px !important;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                border: 2px solid var(--acu-bg-panel);\n                cursor: pointer !important;\n            }\n            @media (max-width: 768px) {\n                .acu-avatar-manager {\n                    width: 95%;\n                    max-height: 85vh;\n                }\n            }\n\n            /* ==========  ========== */\n            .acu-import-confirm-overlay {\n                z-index: 2147483660;\n            }\n            .acu-import-confirm-dialog {\n                width: 90%;\n                max-width: 360px;\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                box-shadow: 0 20px 60px rgba(0,0,0,0.5);\n                overflow: hidden;\n            }\n            .acu-import-confirm-header {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 14px 18px;\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-accent);\n            }\n            .acu-import-confirm-header i {\n                font-size: 16px;\n            }\n            .acu-import-confirm-body {\n                padding: 20px;\n            }\n            .acu-import-stats {\n                display: flex;\n                justify-content: space-around;\n                margin-bottom: 16px;\n            }\n            .acu-import-stat {\n                text-align: center;\n            }\n            .acu-stat-num {\n                display: block;\n                font-size: 24px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n            }\n            .acu-stat-label {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n            }\n            .acu-stat-new .acu-stat-num { color: var(--acu-success-text); }\n            .acu-stat-conflict .acu-stat-num { color: #e67e22; }\n            .acu-import-conflict-section {\n                margin-top: 12px;\n                padding-top: 12px;\n                border-top: 1px dashed var(--acu-border);\n            }\n            .acu-import-cancel-btn,\n            .acu-import-confirm-btn {\n                flex: 1;\n                padding: 10px;\n                border-radius: 6px;\n                font-size: 13px;\n                font-weight: bold;\n                cursor: pointer;\n                transition: all 0.2s;\n            }\n            .acu-import-cancel-btn {\n                background: var(--acu-btn-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-import-cancel-btn:hover {\n                background: var(--acu-btn-hover) !important;\n            }\n            .acu-import-confirm-btn {\n                background: var(--acu-accent) !important;\n                border: none !important;\n                color: #fff !important;\n            }\n            .acu-import-confirm-btn:hover {\n                opacity: 0.85 !important;\n                background: var(--acu-accent) !important;\n            }\n            /* ==========  ========== */\n            .acu-import-warning-container {\n                text-align: center;\n                padding: 16px 12px 20px;\n                color: var(--acu-text-main);\n            }\n            .acu-import-warning-icon {\n                display: block;\n                width: 48px;\n                height: 48px;\n                margin: 0 auto 12px;\n                line-height: 48px;\n                border-radius: 50%;\n                background: rgba(243, 156, 18, 0.15);\n                color: var(--acu-warning-icon, #f39c12);\n                font-size: 22px;\n            }\n            .acu-import-warning-title {\n                font-size: 15px;\n                font-weight: bold;\n                margin-bottom: 8px;\n                color: var(--acu-text-main);\n            }\n            .acu-import-warning-message {\n                font-size: 13px;\n                color: var(--acu-text-sub);\n                line-height: 1.5;\n            }\n            .acu-import-conflict-options {\n                margin-top: 16px;\n                padding-top: 16px;\n                border-top: 1px dashed var(--acu-border);\n                display: flex;\n                flex-direction: column;\n                gap: 10px;\n            }\n            .acu-import-radio {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 10px 12px;\n                border-radius: 8px;\n                cursor: pointer;\n                font-size: 13px;\n                color: var(--acu-text-main) !important;\n                background: var(--acu-btn-bg) !important;\n                border: 1px solid transparent !important;\n                transition: all 0.2s ease;\n            }\n            .acu-import-radio:hover {\n                border-color: var(--acu-border) !important;\n                background: var(--acu-btn-hover) !important;\n            }\n            .acu-import-radio input {\n                accent-color: var(--acu-accent);\n                width: 16px;\n                height: 16px;\n            }\n            .acu-import-confirm-footer {\n                display: flex;\n                gap: 12px;\n                padding: 16px 20px;\n                border-top: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n            }\n            /* ========== / ========== */\n            .acu-avatar-import-btn,\n            .acu-avatar-export-btn {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n            }\n\n            /* ==========  ========== */\n            .acu-dice-config-dialog {\n                width: 320px;\n                max-width: 92vw;\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                box-shadow: 0 15px 40px rgba(0,0,0,0.4);\n                overflow: hidden;\n            }\n            .acu-dice-cfg-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 10px 14px;\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-accent);\n            }\n            .acu-dice-cfg-header .acu-config-close {\n                background: none;\n                border: none;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                font-size: 14px;\n                padding: 4px;\n            }\n            .acu-dice-cfg-header .acu-config-close:hover {\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-body {\n                padding: 12px;\n            }\n            .acu-dice-cfg-row {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                gap: 10px;\n                margin-bottom: 10px;\n            }\n            .acu-dice-cfg-row.acu-cfg-full-row {\n                grid-template-columns: 1fr;\n            }\n            .acu-dice-cfg-item {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n            }\n            .acu-dice-cfg-item label {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                font-weight: 500;\n            }\n            .acu-dice-cfg-item.acu-cfg-toggle-item {\n                flex-direction: row;\n                align-items: center;\n                justify-content: space-between;\n                padding: 8px 0;\n            }\n            .acu-dice-cfg-item.acu-cfg-toggle-item > label {\n                margin: 0;\n                font-size: 13px;\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-item input,\n            .acu-dice-cfg-item select {\n                width: 100%;\n                padding: 7px 8px;\n                background: var(--acu-input-bg) !important;\n                border: 1px solid var(--acu-border);\n                border-radius: 5px;\n                color: var(--acu-text-main) !important;\n                font-size: 13px;\n                text-align: center;\n                box-sizing: border-box;\n            }\n            .acu-dice-cfg-item input::placeholder {\n                color: var(--acu-text-sub);\n                opacity: 0.6;\n            }\n            .acu-dice-cfg-item select option {\n                background: var(--acu-bg-panel);\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-item select {\n                text-align: left;\n                cursor: pointer;\n            }\n            .acu-dice-cfg-item select option {\n                background: var(--acu-bg-panel);\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-item input:focus,\n            .acu-dice-cfg-item select:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n            }\n            .acu-cfg-hint {\n                font-size: 9px;\n                color: var(--acu-text-sub);\n                opacity: 0.7;\n                text-align: center;\n            }\n            .acu-dice-cfg-actions {\n                display: flex;\n                gap: 8px;\n                margin-top: 12px;\n                padding: 10px 12px;\n                border-top: 1px dashed var(--acu-border);\n            }\n            .acu-dice-cfg-actions button {\n                flex: 1;\n                padding: 9px 12px;\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                border: 1px solid var(--acu-border);\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-actions button:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-dice-cfg-actions button.primary {\n                background: var(--acu-btn-bg);\n                border-color: var(--acu-btn-bg);\n                color: var(--acu-button-text);\n            }\n            .acu-dice-cfg-actions button.primary:hover {\n                background: var(--acu-btn-hover);\n                border-color: var(--acu-btn-hover);\n            }\n            /* ==========  ========== */\n            .acu-settings-dialog {\n                width: 380px;\n                max-width: 380px;\n                max-height: 85vh;\n                padding: 0;\n                gap: 0;\n            }\n            @media (max-width: 768px) {\n                .acu-settings-dialog {\n                    width: 92vw;\n                    max-width: 92vw;\n                    max-height: 85vh;\n                }\n                .acu-settings-body {\n                    max-height: calc(85vh - 110px);\n                    -webkit-overflow-scrolling: touch;\n                }\n                .acu-table-manager-list {\n                    max-height: 40vh;\n                    -webkit-overflow-scrolling: touch;\n                }\n            }\n            .acu-settings-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 14px 16px;\n                border-bottom: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n            }\n            .acu-settings-title-group {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n            }\n            .acu-settings-title {\n                font-size: 16px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .acu-header-actions {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .acu-version-badge {\n                display: inline-flex;\n                align-items: center;\n                line-height: 1.2;\n                white-space: nowrap;\n                letter-spacing: 0.5px;\n                background: var(--acu-badge-bg, rgba(0, 0, 0, 0.05));\n                color: var(--acu-text-sub);\n                border-radius: 4px;\n                padding: 2px 6px;\n                font-size: 10px;\n                font-weight: normal;\n                margin-left: 6px;\n                opacity: 0.8;\n            }\n            .acu-help-btn {\n                background: none !important;\n                border: none !important;\n                box-shadow: none !important;\n                outline: none !important;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                font-size: 16px;\n                padding: 6px;\n                margin: 0;\n                border-radius: 4px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s;\n            }\n            .acu-help-btn:hover {\n                color: var(--acu-text-main);\n                background: var(--acu-table-hover) !important;\n            }\n            .acu-settings-body {\n                flex: 1;\n                min-height: 0;\n                overflow-y: auto;\n                overflow-x: hidden;\n                padding: 8px;\n                -webkit-overflow-scrolling: touch;\n            }\n            .acu-settings-group {\n                background: var(--acu-card-bg);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 8px;\n            }\n            .acu-settings-group-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 12px 14px;\n                font-size: 13px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n                background: var(--acu-table-head);\n                cursor: pointer;\n                user-select: none;\n                transition: background 0.15s;\n            }\n            .acu-settings-group-title:hover {\n                background: var(--acu-table-hover);\n            }\n            .acu-group-chevron {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                width: 12px;\n                transition: transform 0.2s;\n            }\n            .acu-settings-group-body {\n                padding: 4px 12px 8px;\n            }\n            .acu-settings-group.collapsed .acu-settings-group-body {\n                display: none;\n            }\n            .acu-settings-group-body.acu-animating {\n                display: block !important;\n                overflow: hidden;\n            }\n            .acu-settings-group:last-child {\n                margin-bottom: 0;\n            }\n            .acu-setting-row {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 10px 0;\n                border-bottom: 1px dashed var(--acu-border);\n                gap: 12px;\n                min-height: 44px;\n            }\n            .acu-setting-row:last-child {\n                border-bottom: none;\n            }\n            .acu-setting-row-slider {\n                flex-direction: column;\n                align-items: stretch;\n            }\n            .acu-setting-info {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-setting-label {\n                font-size: 13px;\n                color: var(--acu-text-main);\n            }\n            .acu-setting-hint {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                opacity: 0.7;\n            }\n            .acu-setting-value {\n                font-size: 12px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                margin-left: auto;\n            }\n            .acu-setting-select {\n                padding: 6px 10px;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px;\n                background: var(--acu-input-bg, var(--acu-btn-bg)) !important;\n                color: var(--acu-text-main) !important;\n                font-size: 12px;\n                min-width: 120px;\n                cursor: pointer;\n                -webkit-appearance: none;\n                appearance: none;\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23888' d='M6 8L2 4h8z'/%3E%3C/svg%3E\");\n                background-repeat: no-repeat;\n                background-position: right 8px center;\n                padding-right: 28px;\n            }\n            .acu-setting-select:focus {\n                outline: none;\n                border-color: var(--acu-accent) !important;\n            }\n            .acu-setting-select option {\n                background: var(--acu-bg-panel) !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-select-short {\n                min-width: 80px;\n            }\n            .acu-setting-slider {\n                width: 100%;\n                height: 6px;\n                margin-top: 8px;\n                -webkit-appearance: none;\n                appearance: none;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                outline: none;\n                border: none;\n            }\n            .acu-setting-slider::-webkit-slider-runnable-track {\n                height: 6px;\n                background: var(--acu-border);\n                border-radius: 3px;\n            }\n            .acu-setting-slider::-webkit-slider-thumb {\n                -webkit-appearance: none;\n                appearance: none;\n                width: 18px;\n                height: 18px;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 1px 4px rgba(0,0,0,0.2);\n                margin-top: -6px;\n            }\n            .acu-setting-slider::-moz-range-track {\n                height: 6px;\n                background: var(--acu-border);\n                border-radius: 3px;\n                border: none;\n            }\n            .acu-setting-slider::-moz-range-thumb {\n                width: 18px;\n                height: 18px;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 1px 4px rgba(0,0,0,0.2);\n            }\n            .acu-setting-slider:focus {\n                outline: none;\n            }\n            .acu-setting-mini-btn {\n                width: 28px;\n                height: 28px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 11px;\n                flex-shrink: 0;\n                transition: all 0.15s;\n            }\n            .acu-setting-mini-btn:hover, .acu-setting-mini-btn.active {\n                background: var(--acu-accent);\n                color: #fff;\n                border-color: var(--acu-accent);\n            }\n\n            /* ==========  ========== */\n            .acu-preset-item {\n                padding: 12px;\n                background: var(--acu-card-bg);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 10px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                gap: 12px;\n                transition: all 0.2s;\n            }\n            .acu-preset-item:hover {\n                background: var(--acu-table-hover);\n                border-color: var(--acu-accent);\n            }\n            .acu-preset-info {\n                flex: 1;\n            }\n            .acu-preset-name {\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n                margin-bottom: 4px;\n            }\n            .acu-preset-desc {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                margin-bottom: 4px;\n            }\n            .acu-preset-stats {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n            }\n            .acu-preset-actions {\n                display: flex;\n                gap: 8px;\n                flex-shrink: 0;\n                align-items: center;\n            }\n            .acu-preset-btn {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 13px;\n                transition: all 0.15s;\n            }\n            .acu-preset-btn:hover {\n                background: var(--acu-accent);\n                color: #fff;\n                border-color: var(--acu-accent);\n            }\n            .acu-preset-btn.acu-preset-delete:hover {\n                background: rgba(231, 76, 60, 0.2);\n                color: #e74c3c;\n                border-color: #e74c3c;\n            }\n            /*  */\n            .acu-preset-editor-input,\n            .acu-preset-editor-textarea {\n                background: var(--acu-input-bg) !important;\n                color: var(--acu-text-main) !important;\n                border: 1px solid var(--acu-border) !important;\n            }\n            .acu-preset-editor-input:focus,\n            .acu-preset-editor-textarea:focus {\n                outline: none !important;\n                border-color: var(--acu-accent) !important;\n                box-shadow: 0 0 0 2px rgba(var(--acu-accent-rgb, 100, 150, 200), 0.2) !important;\n            }\n            .acu-preset-editor-textarea {\n                font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;\n            }\n            /* Toggle  */\n            .acu-toggle {\n                position: relative;\n                width: 44px;\n                height: 24px;\n                flex-shrink: 0;\n            }\n            .acu-toggle input {\n                opacity: 0;\n                width: 0;\n                height: 0;\n            }\n            .acu-toggle-slider {\n                position: absolute;\n                cursor: pointer;\n                top: 0; left: 0; right: 0; bottom: 0;\n                background: rgba(120, 120, 128, 0.16);\n                border: none;\n                border-radius: 24px;\n                transition: all 0.3s ease;\n            }\n            .acu-toggle-slider:before {\n                position: absolute;\n                content: \"\";\n                height: 20px;\n                width: 20px;\n                left: 2px;\n                top: 2px;\n                background: #fff;\n                border-radius: 50%;\n                transition: all 0.3s ease;\n                box-shadow: 0 2px 4px rgba(0,0,0,0.15);\n            }\n            .acu-toggle input:checked + .acu-toggle-slider {\n                background: var(--acu-accent);\n            }\n            .acu-toggle input:checked + .acu-toggle-slider:before {\n                transform: translateX(20px);\n                box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n            }\n            /* Range Slider  */\n            .acu-range-slider {\n                -webkit-appearance: none;\n                appearance: none;\n                flex: 1;\n                height: 6px;\n                border-radius: 3px;\n                background: rgba(120, 120, 128, 0.3);\n                outline: none;\n                cursor: pointer;\n                transition: background 0.2s ease;\n            }\n            .acu-range-slider::-webkit-slider-runnable-track {\n                height: 6px;\n                border-radius: 3px;\n                background: transparent;\n            }\n            .acu-range-slider::-webkit-slider-thumb {\n                -webkit-appearance: none !important;\n                appearance: none !important;\n                width: 18px !important;\n                height: 18px !important;\n                border-radius: 50% !important;\n                background: #fff !important;\n                border: 1px solid rgba(0,0,0,0.1) !important;\n                box-shadow: 0 2px 8px rgba(0,0,0,0.25) !important;\n                cursor: pointer !important;\n                margin-top: -6px !important;\n                transition: all 0.2s ease;\n            }\n            .acu-range-slider:hover::-webkit-slider-thumb {\n                transform: scale(1.05) !important;\n                background: #e8e8e8 !important;\n                box-shadow: 0 2px 6px rgba(0,0,0,0.2) !important;\n            }\n            .acu-range-slider:active::-webkit-slider-thumb {\n                transform: scale(0.95) !important;\n                background: #d0d0d0 !important;\n                box-shadow: 0 1px 4px rgba(0,0,0,0.15) !important;\n            }\n            .acu-range-slider::-moz-range-track {\n                height: 6px;\n                border-radius: 3px;\n                background: rgba(120, 120, 128, 0.16);\n            }\n            .acu-range-slider::-moz-range-thumb {\n                width: 18px !important;\n                height: 18px !important;\n                border-radius: 50% !important;\n                background: #fff !important;\n                border: 1px solid rgba(0,0,0,0.1) !important;\n                box-shadow: 0 2px 8px rgba(0,0,0,0.25) !important;\n                cursor: pointer !important;\n                transition: all 0.2s ease;\n            }\n            .acu-range-slider:hover::-moz-range-thumb {\n                transform: scale(1.05) !important;\n                background: #e8e8e8 !important;\n                box-shadow: 0 2px 6px rgba(0,0,0,0.2) !important;\n            }\n            .acu-range-slider:active::-moz-range-thumb {\n                transform: scale(0.95) !important;\n                background: #d0d0d0 !important;\n                box-shadow: 0 1px 4px rgba(0,0,0,0.15) !important;\n            }\n            .acu-range-value {\n                min-width: 45px;\n                text-align: right;\n                font-weight: 600;\n                font-size: 13px;\n                color: var(--acu-accent, var(--SmartThemeBodyColor, #d4a574));\n            }\n            /*  */\n            .acu-crazy-btn {\n                padding: 4px 12px;\n                font-size: 12px;\n                border: 1px solid var(--acu-border, rgba(0,0,0,0.1));\n                border-radius: 4px;\n                background: var(--acu-btn-bg, rgba(0,0,0,0.05));\n                color: var(--acu-text, inherit);\n                cursor: pointer;\n                transition: all 0.2s ease;\n                font-weight: 500;\n            }\n            .acu-crazy-btn:hover {\n                background: var(--acu-btn-hover, rgba(0,0,0,0.1));\n            }\n            .acu-crazy-btn.active {\n                background: var(--acu-accent, #d4a574);\n                color: white;\n                border-color: var(--acu-accent, #d4a574);\n                box-shadow: 0 2px 4px rgba(0,0,0,0.15);\n            }\n            /* Debug -  */\n            .acu-debug-console-dialog .acu-debug-filter,\n            .acu-debug-console-dialog label input.acu-debug-filter {\n                cursor: pointer !important;\n                width: auto !important;\n                height: auto !important;\n                margin: 0 !important;\n                padding: 0 !important;\n                appearance: checkbox !important;\n                -webkit-appearance: checkbox !important;\n                -moz-appearance: checkbox !important;\n            }\n            .acu-debug-console-dialog label {\n                display: flex !important;\n                align-items: center !important;\n                gap: 4px !important;\n                cursor: pointer !important;\n                font-size: 12px !important;\n            }\n            .acu-setting-action-btn {\n                width: 100%;\n                padding: 10px 14px;\n                margin-bottom: 6px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                font-size: 13px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 8px;\n                transition: all 0.15s;\n            }\n            /* Stepper  */\n            .acu-stepper {\n                display: flex;\n                align-items: center;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                overflow: hidden;\n                background: transparent !important;\n                flex-shrink: 0;\n            }\n            .acu-stepper-btn {\n                width: 36px;\n                height: 34px;\n                border: none !important;\n                background: transparent !important;\n                background-color: transparent !important;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.15s;\n                -webkit-appearance: none !important;\n                appearance: none !important;\n            }\n            .acu-stepper-btn:hover {\n                background: var(--acu-table-hover) !important;\n                color: var(--acu-accent);\n            }\n            .acu-stepper-btn:active {\n                transform: scale(0.95);\n                background: var(--acu-accent) !important;\n                color: var(--acu-button-text);\n            }\n            .acu-stepper-value {\n                min-width: 60px;\n                height: 34px;\n                line-height: 34px;\n                text-align: center;\n                font-size: 13px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n                background: transparent !important;\n                border-left: 1px solid var(--acu-border);\n                border-right: 1px solid var(--acu-border);\n            }\n            /* ==========  ========== */\n            .acu-changes-content {\n                padding: 10px;\n                overflow-y: auto !important;\n                overflow-x: hidden !important;\n                -webkit-overflow-scrolling: touch !important;\n                touch-action: pan-y !important;\n                overscroll-behavior-y: contain;\n            }\n            /* ==========  ========== */\n            .acu-validation-error-msg {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                flex: 1;\n                min-width: 0;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n            }\n            /*  -  */\n            .acu-validation-mode-hint {\n                padding: 8px 12px;\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                background: var(--acu-table-head);\n                border-radius: 6px;\n                margin: 0 0 10px 0;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            /*  */\n            .acu-changes-content.acu-changes-horizontal {\n                display: flex !important;\n                flex-direction: row !important;\n                flex-wrap: nowrap !important;\n                align-items: flex-start !important;\n                gap: 12px;\n                overflow-x: auto !important;\n                overflow-y: visible !important;\n                touch-action: pan-x pan-y !important;\n                padding-bottom: 5px;\n                -webkit-overflow-scrolling: touch;\n                overscroll-behavior-x: contain;\n                overscroll-behavior-y: auto;\n            }\n            .acu-changes-content.acu-changes-horizontal .acu-changes-list {\n                display: flex !important;\n                flex-direction: row !important;\n                flex-wrap: nowrap !important;\n                gap: 12px;\n                align-items: flex-start;\n                min-width: max-content;\n            }\n            .acu-changes-content.acu-changes-horizontal .acu-changes-group {\n                flex: 0 0 280px;\n                min-width: 280px;\n                max-width: 280px;\n                max-height: none;\n                overflow-y: visible;\n                -webkit-overflow-scrolling: auto;\n                overscroll-behavior-y: auto;\n            }\n            @media (min-width: 769px) {\n                .acu-changes-content.acu-changes-horizontal .acu-changes-group {\n                    flex: 0 0 320px;\n                    min-width: 320px;\n                    max-width: 320px;\n                }\n            }\n            .acu-changes-list { display: flex; flex-direction: column; gap: 10px; }\n            .acu-changes-group { background: var(--acu-card-bg); border: 1px solid var(--acu-border); border-radius: 8px; overflow: hidden; }\n            .acu-changes-group-header { display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: var(--acu-table-head); font-weight: bold; font-size: 13px; color: var(--acu-text-main); }\n            .acu-changes-count { margin-left: auto; background: var(--acu-accent); color: #fff; font-size: 11px; padding: 2px 8px; border-radius: 10px; font-weight: normal; }\n            .acu-changes-group-body { padding: 6px; display: flex; flex-direction: column; gap: 4px; }\n            .acu-change-item { display: flex; align-items: center; gap: 6px; padding: 6px 8px; border-radius: 6px; font-size: 12px; background: rgba(0,0,0,0.02); flex-wrap: wrap; transition: all 0.15s; }\n            .acu-change-item:hover { background: var(--acu-table-hover); }\n            .acu-change-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: bold; flex-shrink: 0; }\n            .acu-badge-added { background: var(--acu-success-bg); color: var(--acu-success-text); }\n            .acu-badge-deleted { background: var(--acu-hl-manual-bg); color: var(--acu-hl-manual); }\n            .acu-badge-modified { background: var(--acu-hl-diff-bg); color: var(--acu-hl-diff); }\n            .acu-change-title { color: var(--acu-text-main); font-weight: 500; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            .acu-change-field { color: var(--acu-text-sub); font-size: 11px; flex-shrink: 0; max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            .acu-change-diff { display: flex; align-items: center; gap: 4px; flex: 1; min-width: 0; overflow: hidden; }\n            .acu-diff-old { color: var(--acu-hl-manual); text-decoration: line-through; opacity: 0.7; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; }\n            .acu-diff-arrow { color: var(--acu-text-sub); flex-shrink: 0; }\n            .acu-diff-new { color: var(--acu-success-text); font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; }\n            /*  */\n            .acu-change-actions { display: flex; gap: 4px; margin-left: auto; flex-shrink: 0; }\n            .acu-change-action-btn { width: 24px; height: 24px; border: 1px solid var(--acu-border); border-radius: 4px; background: var(--acu-btn-bg); color: var(--acu-text-sub); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 11px; transition: all 0.15s; padding: 0; }\n            .acu-change-action-btn:hover { background: var(--acu-btn-hover); color: var(--acu-text-main); transform: scale(1.1); }\n            .acu-action-accept:hover { background: var(--acu-success-bg); color: var(--acu-success-text); border-color: var(--acu-success-text); }\n            .acu-action-reject:hover, .acu-action-restore:hover { background: var(--acu-hl-manual-bg); color: var(--acu-hl-manual); border-color: var(--acu-hl-manual); }\n            .acu-action-edit:hover { background: var(--acu-hl-diff-bg); color: var(--acu-hl-diff); border-color: var(--acu-hl-diff); }\n            /*  -  */\n            .acu-changes-batch-btn { width: 32px; height: 32px; border: 1.5px solid rgba(255,255,255,0.4); border-radius: 6px; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.85); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 13px; transition: all 0.15s; }\n            .acu-changes-batch-btn:hover { background: rgba(255,255,255,0.2); color: #fff; border-color: rgba(255,255,255,0.6); }\n            .acu-batch-accept:hover { background: var(--acu-success-bg); color: var(--acu-success-text); border-color: var(--acu-success-text); }\n            .acu-batch-reject:hover { background: var(--acu-hl-manual-bg); color: var(--acu-hl-manual); border-color: var(--acu-hl-manual); }\n            .acu-simple-mode-toggle.active { background: var(--acu-accent); color: #fff; border-color: var(--acu-accent); }\n            .acu-simple-mode-toggle:hover { background: var(--acu-accent); color: #fff; border-color: var(--acu-accent); }\n            .acu-changes-group.collapsed .acu-collapse-icon { transform: rotate(0deg); }\n            .acu-changes-group:not(.collapsed) .acu-collapse-icon { transform: rotate(0deg); }\n            .acu-changes-group-header:hover { background: var(--acu-table-hover); }\n            /*  */\n            .acu-diff-section { margin-bottom: 12px; }\n            .acu-diff-label { font-size: 12px; font-weight: bold; color: var(--acu-text-sub); margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }\n            .acu-diff-readonly { padding: 10px 12px; background: var(--acu-table-head); border: 1px dashed var(--acu-border); border-radius: 6px; color: var(--acu-text-main); font-size: 13px; line-height: 1.5; white-space: pre-wrap; word-break: break-word; max-height: 150px; overflow-y: auto; opacity: 0.8; }\n            .acu-diff-arrow-down { text-align: center; color: var(--acu-text-sub); font-size: 14px; margin: 8px 0; opacity: 0.5; }\n            /*  */\n            .acu-diff-new-section { padding: 12px; background: var(--acu-input-bg); border: 2px solid var(--acu-accent); border-radius: 6px; box-shadow: 0 0 0 3px rgba(127, 127, 255, 0.1); }\n            .acu-diff-new-section .acu-diff-label { color: var(--acu-accent); font-weight: 600; }\n            .acu-diff-new-section textarea,\n            .acu-diff-new-section input { background: var(--acu-input-bg) !important; border-color: var(--acu-border) !important; }\n            .acu-diff-new-section textarea:focus,\n            .acu-diff-new-section input:focus { border-color: var(--acu-accent) !important; box-shadow: 0 0 0 2px rgba(127, 127, 255, 0.15); }\n            /*  */\n            .acu-edit-dialog .acu-dialog-btns {\n                display: flex;\n                gap: 10px;\n                padding: 12px 16px;\n                border-top: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n                margin: 0 -16px -16px -16px;\n                border-radius: 0 0 12px 12px;\n            }\n            .acu-edit-dialog .acu-dialog-btn {\n                flex: 1;\n                padding: 10px 12px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                font-size: 13px;\n                font-weight: 500;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n                white-space: nowrap;\n                transition: all 0.15s;\n            }\n            .acu-edit-dialog .acu-dialog-btn:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-edit-dialog .acu-btn-confirm {\n                background: var(--acu-accent);\n                border-color: var(--acu-accent);\n                color: #fff;\n            }\n            .acu-edit-dialog .acu-btn-confirm:hover {\n                opacity: 0.9;\n            }\n            @media (max-width: 768px) {\n                .acu-edit-dialog .acu-dialog-btns {\n                    flex-wrap: nowrap;\n                }\n                .acu-edit-dialog .acu-dialog-btn {\n                    padding: 10px 8px;\n                    font-size: 12px;\n                    min-width: 0;\n                }\n                .acu-edit-dialog .acu-dialog-btn i {\n                    font-size: 11px;\n                }\n            }\n            @media (max-width: 768px) {\n                .acu-change-item { padding: 8px 6px; }\n                .acu-change-diff { flex-basis: 100%; margin-top: 4px; order: 10; }\n                .acu-change-actions { order: 5; }\n                .acu-diff-old, .acu-diff-new { max-width: 100px; }\n                .acu-change-action-btn { width: 28px; height: 28px; }\n            }\n            .acu-change-field-count { font-size: 11px; color: var(--acu-text-sub); margin-left: 4px; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            /*  */\n            .acu-row-edit-field { margin-bottom: 12px; padding: 10px; background: var(--acu-table-head); border-radius: 6px; border: 1px solid transparent; }\n            .acu-row-edit-field.acu-field-changed { border-color: var(--acu-accent); background: var(--acu-bg-panel); }\n            .acu-row-edit-label { font-size: 12px; font-weight: bold; color: var(--acu-text-sub); margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }\n            .acu-changed-badge { font-size: 10px; padding: 1px 6px; background: var(--acu-accent); color: #fff; border-radius: 3px; font-weight: normal; }\n            .acu-row-edit-old { font-size: 12px; color: var(--acu-text-sub); padding: 6px 8px; background: var(--acu-table-head); border-radius: 4px; margin-bottom: 6px; text-decoration: line-through; opacity: 0.7; white-space: pre-wrap; word-break: break-word; }\n            .acu-row-edit-input { width: 100%; min-height: 36px; max-height: 200px; padding: 8px; resize: none; }\n            .acu-empty-val { opacity: 0.5; font-style: italic; }\n            /* ==========  ========== */\n            .acu-table-manager-list {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n                max-height: 300px;\n                overflow-y: auto;\n                padding: 4px;\n                -webkit-overflow-scrolling: touch;\n                overscroll-behavior-y: contain;\n                touch-action: pan-y;\n            }\n            .acu-table-manager-item {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 8px 10px;\n                background: transparent;\n                border: 1.5px solid var(--acu-accent);\n                border-radius: 6px;\n                cursor: default;\n                transition: all 0.15s;\n                user-select: none;\n                touch-action: pan-y;\n            }\n            .acu-table-manager-item:hover {\n                background: var(--acu-table-hover);\n            }\n            .acu-table-manager-item.hidden-table {\n                opacity: 0.5;\n                border-color: var(--acu-border);\n                border-style: dashed;\n            }\n            .acu-table-manager-item.hidden-table .acu-table-item-name {\n                text-decoration: line-through;\n            }\n            .acu-table-item-check {\n                width: 28px;\n                height: 28px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                cursor: pointer;\n                color: var(--acu-accent);\n                border-radius: 4px;\n                transition: all 0.15s;\n            }\n            .acu-table-item-check:hover {\n                background: var(--acu-table-hover);\n                transform: scale(1.1);\n            }\n            .acu-table-manager-item.hidden-table .acu-table-item-check {\n                color: var(--acu-text-sub);\n            }\n            .acu-table-item-icon {\n                width: 20px;\n                text-align: center;\n                color: var(--acu-accent);\n                font-size: 12px;\n            }\n            .acu-table-item-name {\n                flex: 1;\n                font-size: 13px;\n                color: var(--acu-text-main);\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            .acu-table-item-handle {\n                width: 28px;\n                height: 28px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: var(--acu-text-sub);\n                cursor: grab;\n                opacity: 0.4;\n                transition: all 0.15s;\n                border-radius: 4px;\n            }\n            .acu-table-item-handle:hover {\n                opacity: 1;\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n            }\n            .acu-table-manager-item.acu-dragging {\n                opacity: 0.9;\n                background: var(--acu-accent);\n                border-color: var(--acu-accent);\n                box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n                z-index: 100;\n            }\n            .acu-table-manager-item.acu-dragging .acu-table-item-name,\n            .acu-table-manager-item.acu-dragging .acu-table-item-check,\n            .acu-table-manager-item.acu-dragging .acu-table-item-icon,\n            .acu-table-manager-item.acu-dragging .acu-table-item-handle {\n                color: #fff;\n            }\n            .acu-table-manager-item.acu-drag-above {\n                border-top: 2px solid var(--acu-accent);\n                margin-top: -1px;\n            }\n            .acu-table-manager-item.acu-drag-below {\n                border-bottom: 2px solid var(--acu-accent);\n                margin-bottom: -1px;\n            }\n            @media (max-width: 768px) {\n                .acu-table-item-handle {\n                    opacity: 0.6;\n                }\n            }\n            /* // */\n            .acu-table-manager-item.acu-special-item {\n                background: linear-gradient(135deg, rgba(var(--acu-accent-rgb, 128, 128, 128), 0.08), transparent);\n                border-style: dashed;\n            }\n            .acu-table-manager-item.acu-special-item .acu-table-item-icon {\n                color: var(--acu-accent);\n            }\n            .acu-table-manager-item.acu-special-item .acu-table-item-name {\n                font-weight: 500;\n            }\n            /* ==========  ========== */\n            .acu-validation-rules-list {\n                display: flex;\n                flex-direction: column;\n                gap: 6px;\n                max-height: 280px;\n                overflow-y: auto;\n                padding: 2px;\n            }\n            .acu-validation-rule-item {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 8px 10px;\n                background: transparent;\n                border: 1.5px solid var(--acu-accent);\n                border-radius: 6px;\n                transition: all 0.2s ease;\n            }\n            .acu-validation-rule-item.disabled {\n                opacity: 0.5;\n            }\n            .acu-validation-rule-item:hover {\n                border-color: var(--acu-accent);\n            }\n            .acu-rule-toggle {\n                cursor: pointer;\n                font-size: 18px;\n                color: var(--text-sub);\n                transition: all 0.2s;\n                flex-shrink: 0;\n                background: none;\n                border: none;\n                border-radius: 4px;\n                padding: 4px 8px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n            .acu-rule-toggle:hover {\n                opacity: 0.8;\n            }\n            .acu-rule-toggle.active {\n                color: var(--acu-accent);\n                opacity: 1;\n            }\n            .acu-rule-info {\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-rule-name {\n                font-size: 12px;\n                font-weight: 500;\n                color: var(--acu-text-main);\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            .acu-rule-target {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                margin-top: 2px;\n            }\n            .acu-rule-type-icon {\n                width: 20px;\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                flex-shrink: 0;\n                text-align: center;\n                background: none !important;\n            }\n            .acu-rule-delete {\n                background: none;\n                border: none;\n                color: var(--text-sub);\n                cursor: pointer;\n                padding: 4px;\n                opacity: 0.6;\n                transition: all 0.2s;\n                flex-shrink: 0;\n            }\n            .acu-rule-delete:hover {\n                color: #e74c3c;\n                opacity: 1;\n            }\n            .acu-rule-edit {\n                background: none;\n                border: none;\n                color: var(--text-sub);\n                cursor: pointer;\n                padding: 4px;\n                opacity: 0.6;\n                transition: all 0.2s;\n                flex-shrink: 0;\n            }\n            .acu-rule-edit:hover {\n                color: var(--accent-color);\n                opacity: 1;\n            }\n            .acu-rule-delete:hover {\n                color: #e74c3c;\n                opacity: 1;\n            }\n            .acu-rule-intercept {\n                cursor: pointer;\n                font-size: 14px;\n                color: var(--acu-text-sub);\n                padding: 4px 6px;\n                border-radius: 4px;\n                opacity: 0.5;\n                transition: all 0.2s;\n                flex-shrink: 0;\n            }\n            .acu-rule-intercept:hover {\n                opacity: 0.8;\n                background: var(--acu-hover-bg);\n            }\n            .acu-rule-intercept.active {\n                color: var(--acu-accent);\n                opacity: 1;\n            }\n            .acu-add-rule-btn {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n                width: 100%;\n                padding: 10px;\n                margin-top: 8px;\n                background: var(--acu-btn-bg);\n                border: 1px dashed var(--acu-border);\n                border-radius: 6px;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.2s;\n            }\n            .acu-add-rule-btn:hover {\n                border-color: var(--acu-accent);\n                color: var(--acu-accent);\n                background: rgba(var(--acu-accent-rgb, 128, 128, 128), 0.1);\n            }\n            /*  */\n            .acu-validation-modal-overlay {\n                z-index: 2147483659;\n            }\n            .acu-validation-modal {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                width: 90%;\n                max-width: 420px;\n                overflow: hidden;\n                box-shadow: 0 20px 60px rgba(0,0,0,0.5);\n            }\n            .acu-validation-modal-body {\n                padding: 16px;\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n                max-height: 60vh;\n                overflow-y: auto;\n            }\n            .acu-validation-modal-body .acu-setting-row {\n                flex-wrap: wrap;\n            }\n            .acu-validation-modal-body .acu-panel-input,\n            .acu-validation-modal input[type=\"text\"],\n            .acu-validation-modal input[type=\"number\"],\n            .acu-validation-modal select {\n                background: var(--acu-input-bg, var(--acu-btn-bg)) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px !important;\n                padding: 8px 10px !important;\n                color: var(--acu-text-main) !important;\n                font-size: 12px !important;\n                box-shadow: none !important;\n                -webkit-appearance: none !important;\n            }\n            .acu-validation-modal-body .acu-panel-input:focus,\n            .acu-validation-modal input[type=\"text\"]:focus,\n            .acu-validation-modal input[type=\"number\"]:focus,\n            .acu-validation-modal select:focus {\n                outline: none !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .acu-validation-modal-body .acu-panel-input::placeholder,\n            .acu-validation-modal input[type=\"text\"]::placeholder,\n            .acu-validation-modal input[type=\"number\"]::placeholder {\n                color: var(--acu-text-sub) !important;\n                opacity: 0.7 !important;\n            }\n            .acu-validation-modal select option {\n                background: var(--acu-bg-panel) !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-validation-modal select option[value=\"\"] {\n                color: var(--acu-text-sub) !important;\n                opacity: 0.7 !important;\n            }\n            .acu-rule-config-section {\n                padding: 8px 0;\n            }\n            .acu-validation-modal-footer {\n                display: flex;\n                justify-content: center;\n                gap: 12px;\n                padding: 16px;\n                border-top: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n            }\n            .acu-validation-modal-footer .acu-btn {\n                flex: 1;\n                padding: 10px 12px !important;\n                font-size: 13px !important;\n                font-weight: 500 !important;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n            }\n            /*  */\n            .acu-smart-fix-meta {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 4px 0 !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n                flex-wrap: wrap !important;\n            }\n            .acu-smart-fix-separator {\n                color: var(--acu-border) !important;\n                opacity: 0.5 !important;\n            }\n            .acu-smart-fix-diff {\n                display: flex !important;\n                align-items: center !important;\n                gap: 8px !important;\n                padding: 6px 0 !important;\n                margin: 4px 0 !important;\n                flex-wrap: wrap !important;\n            }\n            .acu-smart-fix-diff-old-text {\n                color: var(--acu-hl-manual) !important;\n                text-decoration: line-through !important;\n                opacity: 0.7 !important;\n                font-size: 13px !important;\n                white-space: nowrap !important;\n                overflow: hidden !important;\n                text-overflow: ellipsis !important;\n                max-width: 150px !important;\n            }\n            .acu-smart-fix-diff-arrow {\n                color: var(--acu-text-sub) !important;\n                flex-shrink: 0 !important;\n            }\n            .acu-smart-fix-empty {\n                opacity: 0.5 !important;\n                font-style: italic !important;\n            }\n            .acu-smart-fix-diff-input-wrapper {\n                flex: 1 !important;\n                min-width: 120px !important;\n            }\n            .acu-smart-fix-diff-input-wrapper input,\n            .acu-smart-fix-diff-input-wrapper select {\n                width: 100% !important;\n                background: var(--acu-input-bg, var(--acu-btn-bg)) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 4px !important;\n                padding: 4px 8px !important;\n                color: var(--acu-text-main) !important;\n                font-size: 13px !important;\n                font-weight: 500 !important;\n                box-shadow: none !important;\n                -webkit-appearance: none !important;\n                -moz-appearance: none !important;\n                appearance: none !important;\n                min-height: 26px !important;\n                line-height: 1.3 !important;\n            }\n            .acu-smart-fix-diff-input-wrapper input:focus,\n            .acu-smart-fix-diff-input-wrapper select:focus {\n                outline: none !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-diff-input-wrapper select {\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%23666' d='M5 7L1 3h8z'/%3E%3C/svg%3E\") !important;\n                background-repeat: no-repeat !important;\n                background-position: right 6px center !important;\n                padding-right: 24px !important;\n            }\n            .acu-smart-fix-diff-input-wrapper select option {\n                background: var(--acu-card-bg) !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-smart-fix-suggest {\n                padding: 10px !important;\n                background: var(--acu-card-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px !important;\n                margin-top: 8px !important;\n            }\n            .acu-smart-fix-suggest-label {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                margin-bottom: 6px !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 4px !important;\n            }\n            .acu-smart-fix-suggest-label i {\n                color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-suggest-value {\n                font-size: 13px !important;\n                color: var(--acu-success-text) !important;\n                font-weight: 500 !important;\n                padding: 6px 8px !important;\n                background: var(--acu-success-bg) !important;\n                border-radius: 4px !important;\n                cursor: pointer !important;\n                transition: all 0.2s !important;\n            }\n            .acu-smart-fix-suggest-value:hover {\n                background: var(--acu-success-text) !important;\n                color: white !important;\n            }\n            .acu-smart-fix-suggest-options {\n                display: flex !important;\n                flex-wrap: wrap !important;\n                gap: 6px !important;\n            }\n            .acu-smart-fix-suggest-options-scroll {\n                max-height: 120px !important;\n                overflow-y: auto !important;\n                padding-right: 4px !important;\n            }\n            .acu-smart-fix-option {\n                display: inline-block !important;\n                font-size: 12px !important;\n                padding: 4px 10px !important;\n                background: var(--acu-btn-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 4px !important;\n                color: var(--acu-text-main) !important;\n                cursor: pointer !important;\n                transition: all 0.2s !important;\n            }\n            .acu-smart-fix-option:hover {\n                background: var(--acu-btn-hover) !important;\n                border-color: var(--acu-accent) !important;\n                color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-option-current {\n                background: var(--acu-hl-manual-bg) !important;\n                border-color: var(--acu-hl-manual) !important;\n                color: var(--acu-hl-manual) !important;\n                text-decoration: line-through !important;\n                opacity: 0.7 !important;\n            }\n            .acu-smart-fix-error-hint {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 8px !important;\n                background: var(--acu-card-bg) !important;\n                border-radius: 4px !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n            }\n            .acu-smart-fix-error-hint i {\n                color: var(--acu-accent) !important;\n                flex-shrink: 0 !important;\n            }\n            @media (max-width: 600px) {\n                .acu-smart-fix-diff {\n                    flex-direction: column !important;\n                    align-items: stretch !important;\n                }\n                .acu-smart-fix-diff-arrow {\n                    transform: rotate(90deg) !important;\n                }\n            }\n            .acu-btn {\n                padding: 8px 16px;\n                border-radius: 6px;\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.2s;\n                border: 1px solid transparent;\n            }\n            .acu-btn-secondary {\n                background: var(--acu-btn-bg);\n                border-color: var(--acu-border);\n                color: var(--acu-text-main);\n            }\n            .acu-btn-secondary:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-btn-primary {\n                background: var(--acu-accent);\n                color: white;\n            }\n            .acu-btn-primary:hover {\n                opacity: 0.9;\n            }\n            /*  */\n            .acu-smart-fix-rule-info {\n                padding: 10px 12px !important;\n                background: var(--acu-table-head) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-left: 3px solid var(--acu-accent) !important;\n                border-radius: 4px !important;\n                margin-bottom: 12px !important;\n            }\n            .acu-smart-fix-rule-header {\n                display: flex !important;\n                align-items: center !important;\n                gap: 8px !important;\n                font-size: 13px !important;\n                font-weight: 600 !important;\n                color: var(--acu-text-main) !important;\n                margin-bottom: 4px !important;\n            }\n            .acu-smart-fix-rule-header i {\n                color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-rule-desc {\n                font-size: 12px !important;\n                color: var(--acu-text-sub) !important;\n                line-height: 1.4 !important;\n            }\n            .acu-smart-fix-suggest-section {\n                margin-top: 12px !important;\n            }\n            .acu-smart-fix-suggest code {\n                background: var(--acu-table-head) !important;\n                padding: 2px 6px !important;\n                border-radius: 3px !important;\n                font-size: 11px !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-smart-fix-quick-btn {\n                display: inline-flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n                padding: 6px 12px !important;\n                background: var(--acu-accent) !important;\n                color: var(--acu-btn-active-text) !important;\n                border: 1px solid var(--acu-accent) !important;\n                border-radius: 4px !important;\n                font-size: 12px !important;\n                font-weight: 500 !important;\n                cursor: pointer !important;\n                transition: all 0.2s !important;\n            }\n            .acu-smart-fix-quick-btn:hover {\n                background: var(--acu-btn-active-bg) !important;\n                color: var(--acu-btn-active-text) !important;\n                border-color: var(--acu-btn-active-bg) !important;\n            }\n            .acu-smart-fix-table-summary {\n                padding: 12px !important;\n                background: var(--acu-card-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px !important;\n            }\n            .acu-smart-fix-stat {\n                font-size: 13px !important;\n                color: var(--acu-text-main) !important;\n                margin-bottom: 8px !important;\n            }\n            .acu-smart-fix-stat strong {\n                color: var(--acu-hl-manual) !important;\n            }\n            .acu-smart-fix-change-list {\n                max-height: 150px !important;\n                overflow-y: auto !important;\n                margin-top: 8px !important;\n            }\n            .acu-smart-fix-change-item {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 4px 8px !important;\n                background: var(--acu-table-head) !important;\n                border-radius: 3px !important;\n                margin-bottom: 4px !important;\n            }\n            .acu-smart-fix-hint {\n                font-size: 12px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 8px !important;\n                background: var(--acu-table-head) !important;\n                border-radius: 4px !important;\n                margin-top: 8px !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n            }\n            .acu-smart-fix-hint i {\n                color: var(--acu-accent) !important;\n            }\n            /* ==========  ========== */\n            .acu-crop-modal-overlay {\n                z-index: 2147483658;\n            }\n            .acu-crop-modal {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                width: 90%;\n                max-width: 360px;\n                overflow: hidden;\n                box-shadow: 0 20px 60px rgba(0,0,0,0.5);\n            }\n            .acu-crop-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 12px 16px;\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-accent);\n            }\n            .acu-crop-close {\n                background: none;\n                border: none;\n                color: var(--acu-text-sub);\n                font-size: 16px;\n                cursor: pointer;\n                padding: 4px;\n            }\n            .acu-crop-close:hover {\n                color: var(--acu-text-main);\n            }\n            .acu-crop-body {\n                padding: 20px;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 12px;\n            }\n            .acu-crop-container {\n                position: relative;\n                width: 200px;\n                height: 200px;\n                border-radius: 50%;\n                overflow: hidden;\n                touch-action: none;\n                user-select: none;\n            }\n            .acu-crop-image {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background-repeat: no-repeat;\n                cursor: grab;\n            }\n            .acu-crop-mask {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                border: 3px solid var(--acu-accent);\n                border-radius: 50%;\n                pointer-events: none;\n                box-shadow: 0 0 0 1000px rgba(0,0,0,0.3);\n            }\n            .acu-crop-hint {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                opacity: 0.7;\n            }\n            .acu-crop-footer {\n                display: flex;\n                gap: 10px;\n                padding: 12px 16px;\n                background: var(--acu-table-head);\n                border-top: 1px solid var(--acu-border);\n            }\n            .acu-crop-btn {\n                flex: 1;\n                padding: 10px 16px;\n                border-radius: 6px;\n                font-size: 13px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.15s;\n            }\n            .acu-crop-cancel {\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-main);\n            }\n            .acu-crop-cancel:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-crop-confirm {\n                background: var(--acu-accent);\n                border: 1px solid var(--acu-accent);\n                color: #fff;\n            }\n            .acu-crop-confirm:hover {\n                opacity: 0.9;\n            }\n            .acu-crop-reupload {\n                flex: 0 0 auto;\n                padding: 10px 14px;\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-main);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n            .acu-crop-reupload:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n            }\n    </style>\n    `;\n    $('head').append(styles);\n  };\n\n  const getTableData = () => {\n    const api = getCore().getDB();\n    if (!api || !api.exportTableAsJson) {\n      console.warn('[DICE] API ');\n      return null;\n    }\n    try {\n      const data = api.exportTableAsJson();\n      if (data) {\n        const sheetCount = Object.keys(data).filter(k => k.startsWith('sheet_')).length;\n        console.info(`[DICE] ${sheetCount} `);\n      }\n      return data;\n    } catch (e) {\n      console.error('[DICE]:', e);\n      return null;\n    }\n  };\n\n  const saveDataToDatabase = async (tableData, skipRender = false, commitDeletes = false) => {\n    if (isSaving) {\n      console.warn('[DICE]');\n      return; // \n    }\n    console.info('[DICE]...');\n    isSaving = true;\n    const { $ } = getCore();\n    const $saveBtn = $('#acu-btn-save-global');\n\n    // UI \n    if (!skipRender && $saveBtn.length) {\n      $saveBtn.find('i').removeClass('fa-save').addClass('fa-spinner fa-spin');\n      $saveBtn.prop('disabled', true);\n    }\n\n    try {\n      // 1.  sheet_  ( = )\n      const dataToSave = {};\n      //  mate \n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // 2.  ()\n      if (commitDeletes) {\n        const deletions = getPendingDeletions();\n        Object.keys(deletions).forEach(key => {\n          if (dataToSave[key] && dataToSave[key].content) {\n            deletions[key]\n              .sort((a, b) => b - a)\n              .forEach(idx => {\n                if (dataToSave[key].content[idx + 1]) dataToSave[key].content.splice(idx + 1, 1);\n              });\n          }\n        });\n        savePendingDeletions({});\n      }\n\n      // 3. \n      let jsonString;\n      try {\n        jsonString = JSON.stringify(dataToSave);\n        //  10MB \n        const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n        if (sizeInMB > 10) {\n          throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n        }\n        console.info(`[DICE]: ${sizeInMB.toFixed(2)}MB`);\n      } catch (stringifyError) {\n        console.error('[DICE]ACU JSON :', stringifyError);\n        throw new Error(`: ${stringifyError.message || stringifyError}`);\n      }\n\n      // 4.  API  ()\n      const api = getCore().getDB();\n      if (!api || !api.importTableAsJson) {\n        throw new Error(' API ');\n      }\n\n      try {\n        //  importTableAsJson saveChat()\n        //  saveChat()  \"Settings could not be saved\" \n        const result = await api.importTableAsJson(jsonString);\n        //  false \n        if (result === false) {\n          throw new Error(' false');\n        }\n        console.info('[DICE]');\n      } catch (apiError) {\n        console.error('[DICE]ACU API :', apiError);\n        //  \"Settings could not be saved\" \n        const errorMsg = apiError.message || String(apiError);\n        if (\n          errorMsg.includes('Settings could not be saved') ||\n          errorMsg.includes('server connection') ||\n          errorMsg.includes('data loss')\n        ) {\n          throw new Error('');\n        }\n        throw new Error(`: ${errorMsg}`);\n      }\n\n      // 5. \n      cachedRawData = dataToSave;\n      saveSnapshot(dataToSave);\n      hasUnsavedChanges = false;\n      currentDiffMap = new Set();\n      if (window.acuModifiedSet) window.acuModifiedSet.clear();\n      console.info('[DICE]');\n\n      if (!skipRender) {\n        renderInterface();\n      }\n    } catch (e) {\n      const errorMessage = e.message || '';\n      console.error('[DICE]:', {\n        error: e,\n        message: errorMessage,\n        stack: e.stack,\n      });\n      if (window.toastr) {\n        window.toastr.error(errorMessage, '', { timeOut: 5000 });\n      } else {\n        alert(`: ${errorMessage}`);\n      }\n      // \n      throw e;\n    } finally {\n      isSaving = false;\n      console.info('[DICE]');\n      if (!skipRender && $saveBtn.length) {\n        $saveBtn.find('i').removeClass('fa-spinner fa-spin').addClass('fa-save');\n        $saveBtn.prop('disabled', false);\n      }\n    }\n  };\n\n  // [] \n  const saveDataOnly = async tableData => {\n    try {\n      const dataToSave = {};\n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // \n      let jsonString;\n      try {\n        jsonString = JSON.stringify(dataToSave);\n        //  10MB \n        const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n        if (sizeInMB > 10) {\n          throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n        }\n      } catch (stringifyError) {\n        console.error('[DICE]ACU JSON :', stringifyError);\n        throw new Error(`: ${stringifyError.message || stringifyError}`);\n      }\n\n      const api = getCore().getDB();\n      if (!api || !api.importTableAsJson) {\n        throw new Error(' API ');\n      }\n\n      try {\n        //  importTableAsJson saveChat()\n        const result = await api.importTableAsJson(jsonString);\n        //  false \n        if (result === false) {\n          throw new Error(' false');\n        }\n      } catch (apiError) {\n        console.error('[DICE]ACU API :', apiError);\n        //  \"Settings could not be saved\" \n        const errorMsg = apiError.message || String(apiError);\n        if (\n          errorMsg.includes('Settings could not be saved') ||\n          errorMsg.includes('server connection') ||\n          errorMsg.includes('data loss')\n        ) {\n          throw new Error('');\n        }\n        throw new Error(`: ${errorMsg}`);\n      }\n\n      cachedRawData = dataToSave;\n      //  saveSnapshot() hasUnsavedChanges\n    } catch (e) {\n      console.error('[DICE]ACU saveDataOnly error:', e);\n      // \n      throw e;\n    }\n  };\n  const processJsonData = json => {\n    const tables = {};\n    if (!json || typeof json !== 'object') return tables;\n    for (const sheetId in json) {\n      if (json[sheetId]?.name) {\n        const sheet = json[sheetId];\n        tables[sheet.name] = {\n          key: sheetId,\n          headers: sheet.content ? sheet.content[0] || [] : [],\n          rows: sheet.content ? sheet.content.slice(1) : [],\n          rawContent: sheet.content || [],\n          exportConfig: sheet.exportConfig || {},\n          updateConfig: sheet.updateConfig || {},\n          ...sheet,\n        };\n      }\n    }\n    return tables;\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function suggestFormatValue(pattern, rowIndex, existingValues = [], tableContent = null) {\n    if (!pattern || rowIndex === undefined || rowIndex < 0) return null;\n\n    try {\n      //  \"+\"  ^AM\\d{3}$\n      // pattern  JavaScript  '^AM\\\\d{3}$' '^AM\\d{3}$'\n      //  \\d{3} /\\\\d\\{3\\}/+d\n      // ^?[]+\\d\\{\\}$?\n      const prefixMatch = pattern.match(/^\\^?([A-Za-z]+)\\\\d\\{(\\d+)\\}\\$?$/);\n\n      if (prefixMatch) {\n        const prefix = prefixMatch[1]; // \"AM\"\n        const digits = parseInt(prefixMatch[2], 10); // 3\n\n        // \n        if (tableContent && (tableContent.name === '' || tableContent.name === '')) {\n          const headers = tableContent.content?.[0] || [];\n          const rows = tableContent.content?.slice(1) || [];\n          const codeIndex = headers.indexOf('');\n\n          if (codeIndex >= 0) {\n            // \n            const existingNumbers = [];\n            rows.forEach(row => {\n              const codeValue = row?.[codeIndex];\n              if (codeValue && typeof codeValue === 'string') {\n                const match = codeValue.match(new RegExp(`^${prefix}(\\\\d+)$`));\n                if (match) {\n                  const num = parseInt(match[1], 10);\n                  if (!isNaN(num)) existingNumbers.push(num);\n                }\n              }\n            });\n\n            // \n            const maxNum = existingNumbers.length > 0 ? Math.max(...existingNumbers) : 0;\n            const nextNum = String(maxNum + 1).padStart(digits, '0');\n            return prefix + nextNum;\n          }\n        }\n\n        // \n        const nextNum = String(rowIndex + 1).padStart(digits, '0');\n        return prefix + nextNum;\n      }\n\n      //  \\d{3} \n      const numOnlyMatch = pattern.match(/^\\^?\\\\d\\{(\\d+)\\}\\$?$/);\n      if (numOnlyMatch) {\n        const digits = parseInt(numOnlyMatch[1], 10);\n        return String(rowIndex + 1).padStart(digits, '0');\n      }\n    } catch (e) {\n      console.error('[DICE]ACU :', e);\n    }\n\n    return null; // \n  }\n\n  //  OR \n  function getRelationOptions(refTable, refColumns, rawData) {\n    const options = new Set();\n    if (!refTable || !refColumns || !rawData) return Array.from(options);\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        columns.forEach(col => {\n          const colIdx = headers.indexOf(col);\n          if (colIdx >= 0) {\n            rows.forEach(row => {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                options.add(String(value).trim());\n              }\n            });\n          }\n        });\n\n        break; // \n      }\n    }\n\n    return Array.from(options).sort();\n  }\n\n  // \n  function isValueInRelationTable(value, refTable, refColumns, rawData) {\n    if (!value || !refTable || !refColumns || !rawData) return false;\n    if (String(value).trim() === '') return false;\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n    const strVal = String(value).trim();\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        for (const col of columns) {\n          const colIdx = headers.indexOf(col);\n          if (colIdx === -1) continue;\n\n          // \n          for (let i = 0; i < rows.length; i++) {\n            const cellValue = rows[i]?.[colIdx];\n            if (cellValue !== null && cellValue !== undefined && String(cellValue).trim() === strVal) {\n              return true; // \n            }\n          }\n        }\n\n        break; // \n      }\n    }\n\n    return false; // \n  }\n\n  //  required \n  function getColumnExamples(tableName, columnName, currentRowIndex, rawData, maxCount = 5) {\n    const examples = new Set();\n    if (!tableName || !columnName || !rawData) return [];\n\n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === tableName) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n        const colIdx = headers.indexOf(columnName);\n\n        if (colIdx >= 0) {\n          rows.forEach((row, idx) => {\n            if (idx !== currentRowIndex) {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                examples.add(String(value).trim());\n              }\n            }\n          });\n        }\n        break;\n      }\n    }\n\n    return Array.from(examples).slice(0, maxCount);\n  }\n\n  // \n  function getNearestValidNumber(currentValue, min, max) {\n    const num = parseFloat(currentValue);\n    if (isNaN(num)) return min !== undefined ? min : 0;\n    if (min !== undefined && num < min) return min;\n    if (max !== undefined && num > max) return max;\n    return num;\n  }\n\n  // ========================================\n  // []  - \n  // ========================================\n  const refreshRegexRulesList = () => {\n    const { $ } = getCore();\n    const dialog = $('.acu-settings-dialog');\n    if (!dialog.length) return;\n\n    const $rulesList = dialog.find('#regex-rules-list');\n    if (!$rulesList.length) return;\n\n    // HTML\n    const rules = RegexTransformationManager.getAllRules();\n    const html = rules\n      .map(rule => {\n        const scopeIcon =\n          rule.scope.type === 'global' ? 'fa-globe' : rule.scope.type === 'table' ? 'fa-table' : 'fa-columns';\n        const scopeText =\n          rule.scope.type === 'global'\n            ? ''\n            : rule.scope.type === 'table'\n              ? rule.scope.tableNames?.join(',')\n              : `${rule.scope.tableNames?.join(',')}.${rule.scope.columnNames?.join(',')}`;\n        return `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n              <div class=\"acu-rule-type-icon\" title=\": ${escapeHtml(rule.scope.type)}\">\n                  <i class=\"fa-solid ${scopeIcon}\"></i>\n              </div>\n              <div class=\"acu-rule-info\">\n                  <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                  <div class=\"acu-rule-target\" style=\"font-size:10px;\">${escapeHtml(scopeText)} | ${escapeHtml(rule.operation)}</div>\n              </div>\n              <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n              <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                  <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n              </div>\n              <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n      `;\n      })\n      .join('');\n\n    // HTML,\n    $rulesList.html(html);\n  };\n\n  // ========================================\n  // /\n  // ========================================\n  const showAddValidationRuleModal = (parentDialog: JQuery, editRuleId?: string) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const tables = processJsonData(rawData || {});\n    const tableNames = Object.keys(tables);\n\n    // \n    const isEditMode = !!editRuleId;\n    const existingRule = isEditMode ? ValidationRuleManager.getRule(editRuleId) : null;\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\" ${isEditMode ? 'style=\"opacity:0;transition:opacity 0.15s ease-in;\"' : ''}>\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-dice-cfg-header\">\n            <span><i class=\"fa-solid ${isEditMode ? 'fa-pen' : 'fa-plus'}\"></i> ${isEditMode ? '' : ''}</span>\n            <button class=\"acu-config-close\" id=\"dlg-rule-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-table\" class=\"acu-setting-select\">\n                <option value=\"\">...</option>\n                ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"row-column\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-column\" class=\"acu-setting-select\" disabled>\n                <option value=\"\">...</option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-type\" class=\"acu-setting-select\">\n                <optgroup label=\"  \">\n                  <option value=\"tableReadonly\"></option>\n                  <option value=\"rowLimit\"></option>\n                  <option value=\"sequence\"></option>\n                </optgroup>\n                <optgroup label=\"  \">\n                  <option value=\"required\"></option>\n                  <option value=\"format\"></option>\n                  <option value=\"enum\"></option>\n                  <option value=\"numeric\"></option>\n                  <option value=\"relation\"></option>\n                  <option value=\"keyValue\"></option>\n                </optgroup>\n              </select>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-tableReadonly\">\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ,\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-rowLimit\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-max\" class=\"acu-panel-input\" placeholder=\"\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-sequence\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-sequence-prefix\" class=\"acu-panel-input\" placeholder=\"AM\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-sequence-start\" class=\"acu-panel-input\" placeholder=\"1\" value=\"1\" style=\"width:120px;\">\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-sequence-paired-table\" class=\"acu-setting-select\" style=\"flex:1;\">\n                  <option value=\"\"></option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> \"+\"(AM0001, AM0002, AM0003...),<br>\n                <i class=\"fa-solid fa-link\" style=\"margin-top:4px;display:block;color:var(--acu-warning-icon);margin-right:6px;\"></i> ,,\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-required\" style=\"display:none;\">\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-format\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-pattern\" class=\"acu-panel-input\" placeholder=\"^AM\\\\d{3}$\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-enum\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-values\" class=\"acu-panel-input\" placeholder=\",,\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-numeric\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-relation\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-table\" class=\"acu-setting-select\">\n                  <option value=\"\">...</option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-column\" class=\"acu-setting-select\" multiple style=\"flex:1;min-height:80px;\">\n                  <option value=\"\">...</option>\n                </select>\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ,(OR ) Ctrl/Cmd \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-keyValue\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-keyvalue-type\" class=\"acu-setting-select\">\n                  <option value=\"text\"></option>\n                  <option value=\"numeric\"></option>\n                </select>\n              </div>\n              <div class=\"acu-setting-row\" id=\"row-keyvalue-range\" style=\"display:none;\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-keyvalue-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n              <div style=\"font-size:12px;color:var(--acu-warning-text);padding:10px 12px;background:var(--acu-warning-bg);border-left:3px solid var(--acu-warning-icon);border-radius:6px;line-height:1.5;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\" style=\"color:var(--acu-warning-icon);margin-right:6px;\"></i> ::;:(,)\n              </div>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-error-msg\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n          </div>\n          <div class=\"acu-dice-cfg-actions\">\n            <button id=\"dlg-rule-cancel\"></button>\n            <button id=\"dlg-rule-save\">${isEditMode ? '' : ''}</button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // select\n    const updateSelectColor = $select => {\n      const val = $select.val();\n      if (!val || val === '') {\n        $select.css('color', 'var(--acu-text-sub)');\n        $select.css('opacity', '0.7');\n      } else {\n        $select.css('color', 'var(--acu-text-main)');\n        $select.css('opacity', '1');\n      }\n    };\n\n    // select\n    dialog.find('select').each(function () {\n      updateSelectColor($(this));\n      $(this).on('change', function () {\n        updateSelectColor($(this));\n      });\n    });\n\n    // \n    dialog.find('#rule-table').on('change', function () {\n      const tableName = $(this).val();\n      const $colSelect = dialog.find('#rule-column');\n      const $pairedTableSelect = dialog.find('#cfg-sequence-paired-table');\n      updateSelectColor($(this));\n\n      // \n      if ($pairedTableSelect.length > 0) {\n        const currentPairedValue = $pairedTableSelect.val();\n        $pairedTableSelect.empty();\n        $pairedTableSelect.append('<option value=\"\"></option>');\n        tableNames\n          .filter(name => name !== tableName)\n          .forEach(name => {\n            $pairedTableSelect.append(`<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`);\n          });\n        // \n        if (currentPairedValue && currentPairedValue !== tableName) {\n          $pairedTableSelect.val(currentPairedValue);\n        }\n        updateSelectColor($pairedTableSelect);\n      }\n\n      if (!tableName || !tables[tableName]) {\n        $colSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($colSelect);\n        return;\n      }\n\n      const headers = tables[tableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $colSelect.html('<option value=\"\">...</option>' + options).prop('disabled', false);\n      updateSelectColor($colSelect);\n    });\n\n    // \n    dialog.find('#cfg-ref-table').on('change', function () {\n      const refTableName = $(this).val();\n      const $refColSelect = dialog.find('#cfg-ref-column');\n      updateSelectColor($(this));\n\n      if (!refTableName || !tables[refTableName]) {\n        $refColSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        updateSelectColor($refColSelect);\n        return;\n      }\n\n      const headers = tables[refTableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $refColSelect.html(options).prop('disabled', false);\n      updateSelectColor($refColSelect);\n    });\n\n    // \n    dialog.find('#rule-type').on('change', function () {\n      const type = $(this).val();\n      const typeInfo = RULE_TYPE_INFO[type];\n      const isTableRule = typeInfo?.scope === 'table';\n      updateSelectColor($(this));\n\n      // \n      dialog.find('.acu-rule-config-section').hide();\n      dialog.find('#config-' + type).show();\n\n      // sequence\n      if (isTableRule && type !== 'sequence') {\n        dialog.find('#row-column').hide();\n        dialog.find('#rule-column').val('').prop('disabled', true);\n      } else {\n        dialog.find('#row-column').show();\n        // \n        if (dialog.find('#rule-table').val()) {\n          dialog.find('#rule-column').prop('disabled', false);\n        }\n      }\n    });\n\n    // /\n    dialog.find('#cfg-keyvalue-type').on('change', function () {\n      const valueType = $(this).val();\n      if (valueType === 'numeric') {\n        dialog.find('#row-keyvalue-range').show();\n      } else {\n        dialog.find('#row-keyvalue-range').hide();\n      }\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#dlg-rule-close, #dlg-rule-cancel', function (e) {\n      e.stopPropagation(); // \n      closeDialog();\n    });\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) {\n        e.stopPropagation(); // \n        closeDialog();\n      }\n    });\n\n    // \n    dialog.find('#dlg-rule-save').on('click', function () {\n      const name = dialog.find('#rule-name').val()?.trim();\n      const targetTable = dialog.find('#rule-table').val();\n      const targetColumn = dialog.find('#rule-column').val();\n      const ruleType = dialog.find('#rule-type').val();\n      const errorMessage = dialog.find('#rule-error-msg').val()?.trim();\n      const typeInfo = RULE_TYPE_INFO[ruleType];\n      const isTableRule = typeInfo?.scope === 'table';\n\n      // \n      if (!name) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!targetTable) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      // sequence\n      if ((!isTableRule || ruleType === 'sequence') && !targetColumn) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      const ruleConfig = {};\n      if (ruleType === 'tableReadonly') {\n        // \n      } else if (ruleType === 'rowLimit') {\n        const min = dialog.find('#cfg-row-min').val();\n        const max = dialog.find('#cfg-row-max').val();\n        if (min !== '') ruleConfig.min = parseInt(min, 10);\n        if (max !== '') ruleConfig.max = parseInt(max, 10);\n      } else if (ruleType === 'required') {\n        // \n      } else if (ruleType === 'format') {\n        const pattern = dialog.find('#cfg-pattern').val()?.trim();\n        if (!pattern) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        // \n        try {\n          new RegExp(pattern);\n        } catch (e) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n        ruleConfig.pattern = pattern;\n      } else if (ruleType === 'enum') {\n        const valuesStr = dialog.find('#cfg-values').val()?.trim();\n        if (!valuesStr) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        ruleConfig.values = valuesStr\n          .split(',')\n          .map(v => v.trim())\n          .filter(v => v);\n      } else if (ruleType === 'numeric') {\n        const min = dialog.find('#cfg-min').val();\n        const max = dialog.find('#cfg-max').val();\n        if (min !== '') ruleConfig.min = parseFloat(min);\n        if (max !== '') ruleConfig.max = parseFloat(max);\n      } else if (ruleType === 'relation') {\n        const refTable = dialog.find('#cfg-ref-table').val();\n        const refColumns = dialog.find('#cfg-ref-column').val(); // \n\n        if (!refTable) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        const selectedColumns = Array.isArray(refColumns) ? refColumns : refColumns ? [refColumns] : [];\n        if (selectedColumns.length === 0 || (selectedColumns.length === 1 && !selectedColumns[0])) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        ruleConfig.refTable = refTable;\n        // \n        ruleConfig.refColumn = selectedColumns.length === 1 ? selectedColumns[0] : selectedColumns;\n      } else if (ruleType === 'keyValue') {\n        const valueType = dialog.find('#cfg-keyvalue-type').val();\n        ruleConfig.valueType = valueType || 'text';\n\n        if (valueType === 'numeric') {\n          const min = dialog.find('#cfg-keyvalue-min').val();\n          const max = dialog.find('#cfg-keyvalue-max').val();\n          if (min !== '') ruleConfig.valueMin = parseFloat(min);\n          if (max !== '') ruleConfig.valueMax = parseFloat(max);\n        }\n      } else if (ruleType === 'sequence') {\n        const prefix = dialog.find('#cfg-sequence-prefix').val()?.trim() || '';\n        const startFrom = dialog.find('#cfg-sequence-start').val();\n        const pairedTable = dialog.find('#cfg-sequence-paired-table').val()?.trim() || null;\n        ruleConfig.prefix = prefix;\n        ruleConfig.startFrom = startFrom !== '' ? parseInt(startFrom, 10) : 1;\n        if (isNaN(ruleConfig.startFrom)) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        if (pairedTable) {\n          ruleConfig.pairedTable = pairedTable;\n        }\n      }\n\n      // IDID\n      const finalRuleId = isEditMode\n        ? editRuleId\n        : 'custom_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);\n\n      // \n      const ruleData = {\n        id: finalRuleId,\n        name: name,\n        description: existingRule?.description || '',\n        targetTable: targetTable,\n        targetColumn: isTableRule && ruleType !== 'sequence' ? '' : targetColumn, //  targetColumnsequence\n        ruleType: ruleType,\n        config: ruleConfig,\n        errorMessage: errorMessage || typeInfo?.desc || '',\n        intercept: existingRule?.intercept ?? false, // \n        enabled: existingRule?.enabled ?? true, // \n      };\n\n      let success = false;\n      if (isEditMode) {\n        // \n        success = ValidationRuleManager.updateCustomRule(editRuleId, ruleData);\n      } else {\n        // \n        success = ValidationRuleManager.addCustomRule(ruleData);\n      }\n\n      if (success) {\n        closeDialog();\n\n        // \n        ValidationRuleManager.clearCache();\n\n        // \n        const $rulesList = parentDialog.find('#validation-rules-list');\n\n        if (isEditMode) {\n          // \n          const $existingItem = $rulesList.find(`.acu-validation-rule-item[data-rule-id=\"${escapeHtml(editRuleId)}\"]`);\n          if ($existingItem.length) {\n            const hasIntercept = ruleData.intercept;\n            const isEnabled = ruleData.enabled;\n            $existingItem.find('.acu-rule-name').text(name);\n            $existingItem\n              .find('.acu-rule-target')\n              .text(`${targetTable}${isTableRule && ruleType !== 'sequence' ? ' ()' : '.' + targetColumn}`);\n            $existingItem\n              .find('.acu-rule-type-icon')\n              .attr('title', `${typeInfo?.name || ruleType}${isTableRule ? ' ()' : ''}`)\n              .find('i')\n              .attr('class', `fa-solid ${typeInfo?.icon || 'fa-question'}`);\n            $existingItem.toggleClass('disabled', !isEnabled);\n          }\n        } else {\n          // \n          const ruleHtml = `\n          <div class=\"acu-validation-rule-item\" data-rule-id=\"${escapeHtml(finalRuleId)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo?.name || ruleType)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo?.icon || 'fa-question'}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(targetTable)}${isTableRule && ruleType !== 'sequence' ? ' ()' : '.' + escapeHtml(targetColumn)}</div>\n            </div>\n            <div class=\"acu-rule-intercept\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n            <div class=\"acu-rule-toggle active\" title=\"/\">\n              <i class=\"fa-solid fa-toggle-on\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(finalRuleId)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n        `;\n          $rulesList.append(ruleHtml);\n        }\n        // \n      } else {\n        if (window.toastr) window.toastr.error(isEditMode ? '' : '');\n      }\n    });\n\n    // \n    if (isEditMode && existingRule) {\n      dialog.find('#rule-name').val(existingRule.name || '');\n      dialog.find('#rule-error-msg').val(existingRule.errorMessage || '');\n\n      //  change \n      dialog\n        .find('#rule-table')\n        .val(existingRule.targetTable || '')\n        .trigger('change');\n\n      //  change \n      dialog\n        .find('#rule-type')\n        .val(existingRule.ruleType || 'required')\n        .trigger('change');\n\n      // / change \n      setTimeout(() => {\n        // \n        if (existingRule.targetColumn) {\n          dialog.find('#rule-column').val(existingRule.targetColumn);\n          updateSelectColor(dialog.find('#rule-column'));\n        }\n\n        // \n        const cfg = existingRule.config || {};\n        const ruleType = existingRule.ruleType;\n\n        if (ruleType === 'rowLimit') {\n          if (cfg.min !== undefined) dialog.find('#cfg-row-min').val(cfg.min);\n          if (cfg.max !== undefined) dialog.find('#cfg-row-max').val(cfg.max);\n        } else if (ruleType === 'sequence') {\n          dialog.find('#cfg-sequence-prefix').val(cfg.prefix || '');\n          dialog.find('#cfg-sequence-start').val(cfg.startFrom ?? 1);\n          if (cfg.pairedTable) {\n            dialog.find('#cfg-sequence-paired-table').val(cfg.pairedTable);\n            updateSelectColor(dialog.find('#cfg-sequence-paired-table'));\n          }\n        } else if (ruleType === 'format') {\n          dialog.find('#cfg-pattern').val(cfg.pattern || '');\n        } else if (ruleType === 'enum') {\n          dialog.find('#cfg-values').val((cfg.values || []).join(','));\n        } else if (ruleType === 'numeric') {\n          if (cfg.min !== undefined) dialog.find('#cfg-min').val(cfg.min);\n          if (cfg.max !== undefined) dialog.find('#cfg-max').val(cfg.max);\n        } else if (ruleType === 'relation') {\n          if (cfg.refTable) {\n            dialog.find('#cfg-ref-table').val(cfg.refTable).trigger('change');\n            // \n            setTimeout(() => {\n              const refColumns = Array.isArray(cfg.refColumn) ? cfg.refColumn : cfg.refColumn ? [cfg.refColumn] : [];\n              dialog.find('#cfg-ref-column').val(refColumns);\n              updateSelectColor(dialog.find('#cfg-ref-column'));\n              // \n              dialog.css('opacity', '1');\n            }, 100);\n            return; // relation  setTimeout \n          }\n        } else if (ruleType === 'keyValue') {\n          dialog\n            .find('#cfg-keyvalue-type')\n            .val(cfg.valueType || 'text')\n            .trigger('change');\n          if (cfg.valueMin !== undefined) dialog.find('#cfg-keyvalue-min').val(cfg.valueMin);\n          if (cfg.valueMax !== undefined) dialog.find('#cfg-keyvalue-max').val(cfg.valueMax);\n        }\n\n        // \n        dialog.css('opacity', '1');\n      }, 100);\n    }\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showSmartFixModal = error => {\n    if (!error || !error.rule) {\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const rule = error.rule;\n    const ruleType = error.ruleType || rule.ruleType;\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n    const isTableRule = typeInfo?.scope === 'table';\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const snapshot = loadSnapshot();\n\n    //  rowTitle\n    if (!error.rowTitle && error.rowIndex >= 0 && rawData && error.tableName) {\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          const row = rawData[sheetId].content?.[error.rowIndex + 1];\n          if (row) {\n            error.rowTitle = row[1] || row[0] || ` ${error.rowIndex + 1}`;\n          }\n          break;\n        }\n      }\n    }\n\n    // \n    let snapshotValue = '';\n    if (!isTableRule && snapshot && error.tableName && error.columnName !== undefined) {\n      for (const sheetId in snapshot) {\n        if (snapshot[sheetId]?.name === error.tableName) {\n          const headers = snapshot[sheetId].content?.[0] || [];\n          const colIdx = headers.indexOf(error.columnName);\n          const rowIdx = error.rowIndex + 1;\n          if (colIdx >= 0 && snapshot[sheetId].content?.[rowIdx]) {\n            snapshotValue = snapshot[sheetId].content[rowIdx][colIdx] ?? '';\n          }\n          break;\n        }\n      }\n    }\n\n    const hasSnapshotValue = snapshotValue !== '' && String(snapshotValue) !== String(error.currentValue || '');\n\n    // ========================================\n    // \n    // ========================================\n    if (isTableRule) {\n      showTableRuleFixModal(error, rule, ruleType, rawData, snapshot, currentThemeClass);\n      return;\n    }\n\n    // ========================================\n    // \n    // ========================================\n\n    // UI\n    let inputHtml = '';\n\n    if (ruleType === 'enum' && rule.config?.values) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'numeric') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'keyValue') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else {\n      // \n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    }\n\n    // \n    let smartSuggestHtml = '';\n\n    if (ruleType === 'required') {\n      // \n      const examples = getColumnExamples(error.tableName, error.columnName, error.rowIndex, rawData, 5);\n      if (examples.length > 0) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            <div class=\"acu-smart-fix-suggest-label\">\n              <i class=\"fa-solid fa-lightbulb\"></i> :\n            </div>\n            <div class=\"acu-smart-fix-suggest-options\">\n              ${examples\n                .map(\n                  val => `\n                <span class=\"acu-smart-fix-option\" data-value=\"${escapeHtml(val)}\" title=\"\">\n                  ${escapeHtml(val.length > 20 ? val.substring(0, 20) + '...' : val)}\n                </span>\n              `,\n                )\n                .join('')}\n            </div>\n          </div>\n        `;\n      }\n    } else if (ruleType === 'enum' && rule.config?.values) {\n      // \n      const validValues = rule.config.values;\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-list\"></i>  ():\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\">\n            ${validValues\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        </div>\n      `;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      // \n      // \n      let tableContent = null;\n      if (rawData && error.tableName) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            tableContent = rawData[sheetId];\n            break;\n          }\n        }\n      }\n      const suggestedValue = suggestFormatValue(rule.config.pattern, error.rowIndex, [], tableContent);\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-font\"></i> : <code>${escapeHtml(rule.config.pattern)}</code>\n          </div>\n          ${\n            suggestedValue\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:4px;display:block;\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </span>\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(suggestedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> ${escapeHtml(suggestedValue)}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'numeric') {\n      // \n      const min = rule.config?.min;\n      const max = rule.config?.max;\n      const currentNum = parseFloat(error.currentValue);\n      const isOutOfRange =\n        !isNaN(currentNum) && ((min !== undefined && currentNum < min) || (max !== undefined && currentNum > max));\n      const nearestValid = isOutOfRange ? getNearestValidNumber(error.currentValue, min, max) : null;\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-hashtag\"></i> : ${min !== undefined ? min : '-'} ~ ${max !== undefined ? max : '+'}\n          </div>\n          ${\n            isOutOfRange && nearestValid !== null\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${nearestValid}\">\n                <i class=\"fa-solid fa-arrow-right\"></i>  ${nearestValid}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      // \n      const options = getRelationOptions(rule.config.refTable, rule.config.refColumn, rawData);\n      const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n      const hasMultipleColumns = refColumns.length > 1;\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      const valueExists = isValueInRelationTable(\n        currentInvalidValue,\n        rule.config.refTable,\n        rule.config.refColumn,\n        rawData,\n      );\n\n      // HTML\n      let optionsHtml = '';\n      if (options.length > 0) {\n        optionsHtml = `\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-link\"></i>  \"${escapeHtml(rule.config.refTable)}\"  (${options.length}):\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\" id=\"smart-fix-options-container\">\n            ${options\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      // \n      let reverseWriteHtml = '';\n      if (currentInvalidValue && !valueExists) {\n        if (hasMultipleColumns) {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <select id=\"smart-fix-reverse-column\" class=\"acu-edit-select\" style=\"width:100%;margin-bottom:8px;\">\n                  ${refColumns.map(col => `<option value=\"${escapeHtml(col)}\">${escapeHtml(col)}</option>`).join('')}\n                </select>\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}\"\n                </button>\n              </div>\n            </div>\n          `;\n        } else {\n          // \n          reverseWriteHtml = `\n            <div class=\"acu-smart-fix-reverse-write\" style=\"margin-top:15px;padding-top:15px;border-top:1px solid var(--acu-border);\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-arrow-left\"></i> :\n              </div>\n              <div style=\"margin-top:8px;\">\n                <button class=\"acu-smart-fix-quick-btn\" id=\"smart-fix-reverse-write-btn\" data-column=\"${escapeHtml(refColumns[0])}\" style=\"width:100%;\">\n                  <i class=\"fa-solid fa-plus\"></i>  \"${escapeHtml(currentInvalidValue.length > 30 ? currentInvalidValue.substring(0, 30) + '...' : currentInvalidValue)}\"  \"${escapeHtml(rule.config.refTable)}.${escapeHtml(refColumns[0])}\"\n                </button>\n              </div>\n            </div>\n          `;\n        }\n      }\n\n      if (optionsHtml || reverseWriteHtml) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            ${optionsHtml}\n            ${reverseWriteHtml}\n          </div>\n        `;\n      }\n    } else if (ruleType === 'keyValue') {\n      // \n      const valueType = rule.config?.valueType || 'text';\n      const valueMin = rule.config?.valueMin;\n      const valueMax = rule.config?.valueMax;\n\n      // \n      let processedValue = String(error.currentValue || '');\n      processedValue = processedValue.replace(//g, ':').replace(//g, ';').replace(//g, ';').replace(/\\s+/g, '');\n\n      // \n      const pairs = processedValue.split(';').filter(p => p.trim());\n      const issues = [];\n      const fixedPairs = [];\n\n      for (const pair of pairs) {\n        const colonIndex = pair.indexOf(':');\n        if (colonIndex === -1 || colonIndex === 0 || colonIndex === pair.length - 1) {\n          issues.push({ pair, error: '/' });\n          continue;\n        }\n\n        const key = pair.substring(0, colonIndex);\n        const val = pair.substring(colonIndex + 1);\n\n        if (!key || !val) {\n          issues.push({ pair, error: '' });\n          continue;\n        }\n\n        let fixedVal = val;\n        let hasIssue = false;\n\n        if (valueType === 'numeric') {\n          const numVal = parseFloat(val);\n          if (isNaN(numVal)) {\n            issues.push({ pair, error: `\"${val}\" ` });\n            hasIssue = true;\n          } else {\n            if (valueMin !== undefined && valueMin !== null && numVal < valueMin) {\n              fixedVal = String(valueMin);\n              issues.push({ pair, error: ` ${numVal}  ${valueMin}` });\n              hasIssue = true;\n            } else if (valueMax !== undefined && valueMax !== null && numVal > valueMax) {\n              fixedVal = String(valueMax);\n              issues.push({ pair, error: ` ${numVal}  ${valueMax}` });\n              hasIssue = true;\n            }\n          }\n        }\n\n        fixedPairs.push({ key, val: fixedVal, originalVal: val, hasIssue });\n      }\n\n      // \n      const fixedValue = fixedPairs.map(p => `${p.key}:${p.val}`).join(';');\n      const hasIssues = issues.length > 0 || fixedPairs.some(p => p.hasIssue);\n\n      let issuesHtml = '';\n      if (hasIssues) {\n        issuesHtml = `\n          <div class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:8px;\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i> :\n          </div>\n          <div style=\"margin-bottom:8px;\">\n            ${issues\n              .map(\n                issue => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(issue.pair)} - ${escapeHtml(issue.error)}\n              </div>\n            `,\n              )\n              .join('')}\n            ${fixedPairs\n              .filter(p => p.hasIssue)\n              .map(\n                p => `\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:4px 8px;background:var(--acu-card-bg);border-radius:4px;margin-bottom:4px;\">\n                <span style=\"color:var(--acu-hl-manual);\"></span> ${escapeHtml(p.key)}:${escapeHtml(p.originalVal)}  ${escapeHtml(p.val)}\n              </div>\n            `,\n              )\n              .join('')}\n          </div>\n        `;\n      }\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-key\"></i> : :;:\n          </div>\n          ${\n            valueType === 'numeric'\n              ? `\n            <div class=\"acu-smart-fix-suggest-label\" style=\"margin-top:8px;\">\n              <i class=\"fa-solid fa-hashtag\"></i> : ${valueMin !== undefined ? valueMin : '-'} ~ ${valueMax !== undefined ? valueMax : '+'}\n            </div>\n          `\n              : ''\n          }\n          ${issuesHtml}\n          ${\n            hasIssues\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(fixedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> \n              </span>\n            </div>\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-card-bg);border-radius:4px;font-size:11px;color:var(--acu-text-sub);\">\n              <div style=\"margin-bottom:4px;\"><strong>:</strong></div>\n              <code style=\"color:var(--acu-success-text);\">${escapeHtml(fixedValue)}</code>\n            </div>\n          `\n              : `\n            <div style=\"margin-top:8px;padding:8px;background:var(--acu-success-bg);border-radius:4px;font-size:11px;color:var(--acu-success-text);\">\n              <i class=\"fa-solid fa-check-circle\"></i> \n            </div>\n          `\n          }\n        </div>\n      `;\n    }\n\n    // HTML\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} - ${escapeHtml(error.columnName || '')}</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            <!--  -->\n            <div class=\"acu-smart-fix-rule-info\">\n              <div class=\"acu-smart-fix-rule-header\">\n                <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                <span>${escapeHtml(error.ruleName || rule.name || '')}</span>\n              </div>\n              <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || typeInfo.desc || '')}</div>\n            </div>\n\n            <!--  -->\n            ${\n              hasSnapshotValue\n                ? `\n              <div class=\"acu-diff-section acu-diff-old-section\">\n                <div class=\"acu-diff-label\">\n                  <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                </div>\n                <div class=\"acu-diff-readonly\">${escapeHtml(snapshotValue)}</div>\n              </div>\n              <div class=\"acu-diff-arrow-down\"><i class=\"fa-solid fa-arrow-down\"></i></div>\n            `\n                : ''\n            }\n\n            <!--  -->\n            <div class=\"acu-diff-section acu-diff-new-section\">\n              ${\n                error.rowTitle && error.rowIndex >= 0\n                  ? `<div style=\"font-size:12px;color:var(--acu-text-sub);margin-bottom:8px;padding:4px 8px;background:var(--acu-bg-sub);border-radius:4px;\">\n                <i class=\"fa-solid fa-tag\" style=\"margin-right:4px;\"></i>${escapeHtml(error.rowTitle)}\n              </div>`\n                  : ''\n              }\n              <div class=\"acu-diff-label\">\n                <i class=\"fa-solid fa-pen\"></i> \n              </div>\n              ${inputHtml}\n            </div>\n\n            <!--  -->\n            ${\n              smartSuggestHtml\n                ? `\n              <div class=\"acu-smart-fix-suggest-section\">\n                ${smartSuggestHtml}\n              </div>\n            `\n                : ''\n            }\n          </div>\n          <div class=\"acu-dialog-btns\">\n            <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n            ${hasSnapshotValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n            <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    dialog.on('click', '.acu-smart-fix-option, .acu-smart-fix-quick-btn', function () {\n      // \n      if ($(this).attr('id') === 'smart-fix-reverse-write-btn') return;\n      if ($(this).hasClass('acu-smart-fix-option-current')) return;\n      const optionValue = $(this).data('value') || $(this).text().trim();\n      dialog.find('#smart-fix-value').val(optionValue).trigger('input');\n    });\n\n    // \n    dialog.on('click', '#smart-fix-reverse-write-btn', async function () {\n      const currentInvalidValue = String(error.currentValue || '').trim();\n      if (!currentInvalidValue) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      let targetColumn;\n      if (ruleType === 'relation' && rule.config?.refColumn) {\n        const refColumns = Array.isArray(rule.config.refColumn) ? rule.config.refColumn : [rule.config.refColumn];\n        if (refColumns.length > 1) {\n          // \n          targetColumn = dialog.find('#smart-fix-reverse-column').val();\n        } else {\n          // data\n          targetColumn = $(this).data('column') || refColumns[0];\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      if (!targetColumn || !rule.config?.refTable) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      try {\n        const rawData = cachedRawData || getTableData();\n        let refSheet = null;\n        let refSheetId = null;\n\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === rule.config.refTable) {\n            refSheet = rawData[sheetId];\n            refSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!refSheet || !refSheet.content) {\n          if (window.toastr) window.toastr.error(` \"${rule.config.refTable}\"`);\n          return;\n        }\n\n        const headers = refSheet.content[0] || [];\n        const targetColIdx = headers.indexOf(targetColumn);\n\n        if (targetColIdx === -1) {\n          if (window.toastr) window.toastr.error(` \"${targetColumn}\"`);\n          return;\n        }\n\n        // \n        const newRow = new Array(headers.length).fill('');\n        newRow[targetColIdx] = currentInvalidValue;\n\n        // \n        refSheet.content.push(newRow);\n\n        // \n        await saveDataToDatabase(rawData, false, false);\n\n        // \n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-revert', function () {\n      dialog.find('#smart-fix-value').val(snapshotValue);\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-close, #smart-fix-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#smart-fix-confirm').on('click', async function () {\n      const newValue = dialog.find('#smart-fix-value').val()?.trim() || '';\n\n      if (newValue === '' && ruleType === 'required') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      try {\n        const rawData = cachedRawData || getTableData();\n        let updated = false;\n\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            const sheet = rawData[sheetId];\n            const headers = sheet.content?.[0] || [];\n\n            if (error.rowIndex >= 0 && error.columnName) {\n              const colIdx = headers.indexOf(error.columnName);\n              const rowIdx = error.rowIndex + 1;\n\n              if (colIdx >= 0 && sheet.content && sheet.content[rowIdx]) {\n                sheet.content[rowIdx][colIdx] = newValue;\n                updated = true;\n                break;\n              }\n            }\n          }\n        }\n\n        if (updated) {\n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function extractCodesFromTable(sheet, columnName, prefix) {\n    if (!sheet || !sheet.content || sheet.content.length < 2) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const headers = sheet.content[0] || [];\n    const rows = sheet.content.slice(1) || [];\n    const colIndex = headers.indexOf(columnName);\n\n    if (colIndex < 0) {\n      return { codes: new Map(), allCodes: new Set(), codeToRows: new Map() };\n    }\n\n    const codes = new Map(); // Map<, >\n    const allCodes = new Set(); // Set<>\n    const codeToRows = new Map(); // Map<, >\n\n    for (let i = 0; i < rows.length; i++) {\n      const value = rows[i]?.[colIndex];\n      if (value === null || value === undefined || value === '') continue;\n\n      const strValue = String(value).trim();\n      if (!strValue) continue;\n\n      // \n      let isValid = false;\n      if (prefix) {\n        const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          isValid = true;\n        }\n      } else {\n        const num = parseInt(strValue, 10);\n        if (!isNaN(num)) {\n          isValid = true;\n        }\n      }\n\n      if (isValid) {\n        allCodes.add(strValue);\n        if (!codeToRows.has(strValue)) {\n          codeToRows.set(strValue, []);\n        }\n        codeToRows.get(strValue).push(i);\n      }\n    }\n\n    return { codes, allCodes, codeToRows };\n  }\n\n  //   \n  function buildCodeMapping(codes1, codes2, prefix, startFrom) {\n    // \n    const allUniqueCodes = new Set([...codes1, ...codes2]);\n\n    // \n    const codeNumbers = [];\n    for (const code of allUniqueCodes) {\n      let num = null;\n      if (prefix) {\n        const match = code.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n        if (match) {\n          num = parseInt(match[1], 10);\n        }\n      } else {\n        num = parseInt(code, 10);\n      }\n\n      if (!isNaN(num)) {\n        codeNumbers.push({ code, num });\n      }\n    }\n\n    // \n    codeNumbers.sort((a, b) => a.num - b.num);\n\n    //   \n    const mapping = new Map();\n    for (let i = 0; i < codeNumbers.length; i++) {\n      const oldCode = codeNumbers[i].code;\n      const newNum = startFrom + i;\n      const newCode = prefix + String(newNum).padStart(4, '0');\n      mapping.set(oldCode, newCode);\n    }\n\n    return mapping;\n  }\n\n  // \n  // \n  // 1. \n  // 2. \n  // 3. \n  function alignAndFixPairedTables(\n    table1Sheet,\n    table1SheetId,\n    table2Sheet,\n    table2SheetId,\n    columnName,\n    mapping,\n    prefix,\n    startFrom,\n    rawData,\n  ) {\n    if (!table1Sheet || !table2Sheet) return { fixedCount1: 0, fixedCount2: 0 };\n\n    const headers1 = table1Sheet.content[0] || [];\n    const rows1 = table1Sheet.content.slice(1) || [];\n    const colIndex1 = headers1.indexOf(columnName);\n\n    const headers2 = table2Sheet.content[0] || [];\n    const rows2 = table2Sheet.content.slice(1) || [];\n    const colIndex2 = headers2.indexOf(columnName);\n\n    if (colIndex1 < 0 || colIndex2 < 0) return { fixedCount1: 0, fixedCount2: 0 };\n\n    let fixedCount1 = 0;\n    let fixedCount2 = 0;\n\n    //  -> \n    const reverseMapping = new Map();\n    for (const [oldCode, newCode] of mapping.entries()) {\n      reverseMapping.set(newCode, oldCode);\n    }\n\n    // \n    const sortedNewCodes = Array.from(mapping.values()).sort((a, b) => {\n      const numA = parseInt(a.replace(prefix, ''), 10);\n      const numB = parseInt(b.replace(prefix, ''), 10);\n      return numA - numB;\n    });\n\n    // \n    const analyzeTable = (rows, colIndex) => {\n      const codeRows = []; // {rowIndex, oldCode, row}\n      const emptyRows = []; // {rowIndex, row, prevOldCode, nextOldCode}\n\n      for (let i = 0; i < rows.length; i++) {\n        const value = rows[i]?.[colIndex];\n        const strValue = value === null || value === undefined ? '' : String(value).trim();\n\n        // \n        let isValid = false;\n        if (strValue && prefix) {\n          const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          if (match) isValid = true;\n        } else if (strValue) {\n          const num = parseInt(strValue, 10);\n          if (!isNaN(num)) isValid = true;\n        }\n\n        if (isValid) {\n          codeRows.push({ rowIndex: i, oldCode: strValue, row: rows[i] });\n        } else {\n          emptyRows.push({ rowIndex: i, row: rows[i], prevOldCode: null, nextOldCode: null });\n        }\n      }\n\n      // \n      for (const emptyRow of emptyRows) {\n        let prevCode = null;\n        let nextCode = null;\n\n        for (const codeRow of codeRows) {\n          if (codeRow.rowIndex < emptyRow.rowIndex) {\n            prevCode = codeRow.oldCode;\n          }\n          if (codeRow.rowIndex > emptyRow.rowIndex && nextCode === null) {\n            nextCode = codeRow.oldCode;\n            break;\n          }\n        }\n\n        emptyRow.prevOldCode = prevCode;\n        emptyRow.nextOldCode = nextCode;\n      }\n\n      return { codeRows, emptyRows };\n    };\n\n    const analysis1 = analyzeTable(rows1, colIndex1);\n    const analysis2 = analyzeTable(rows2, colIndex2);\n\n    // \n    const buildNewRows = (analysis, headers, colIndex, allOldCodes) => {\n      const newRows = [];\n      const codeRowMap = new Map(); // oldCode -> row data\n\n      // \n      for (const cr of analysis.codeRows) {\n        codeRowMap.set(cr.oldCode, cr.row);\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n\n        if (codeRowMap.has(oldCode)) {\n          // \n          const oldRow = codeRowMap.get(oldCode);\n          const newRow = oldRow.map(cell => cell);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true });\n        } else {\n          // \n          const newRow = new Array(headers.length).fill(null);\n          newRow[colIndex] = newCode;\n          newRows.push({ newCode, row: newRow, isCodeRow: true, isInserted: true });\n        }\n      }\n\n      // \n      //  prevOldCode  nextOldCode \n      const result = [];\n      let codeRowIndex = 0;\n\n      // \n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode === null && emptyRow.nextOldCode !== null) {\n          // \n          const nextNewCode = mapping.get(emptyRow.nextOldCode);\n          // \n          while (codeRowIndex < newRows.length && newRows[codeRowIndex].newCode !== nextNewCode) {\n            result.push(newRows[codeRowIndex].row);\n            codeRowIndex++;\n          }\n          result.push(emptyRow.row);\n        } else if (emptyRow.prevOldCode === null && emptyRow.nextOldCode === null) {\n          // \n          result.push(emptyRow.row);\n        }\n      }\n\n      // \n      for (; codeRowIndex < newRows.length; codeRowIndex++) {\n        result.push(newRows[codeRowIndex].row);\n        const currentNewCode = newRows[codeRowIndex].newCode;\n        const currentOldCode = reverseMapping.get(currentNewCode);\n\n        // \n        for (const emptyRow of analysis.emptyRows) {\n          if (emptyRow.prevOldCode === currentOldCode) {\n            result.push(emptyRow.row);\n          }\n        }\n      }\n\n      // prevOldCode nextOldCode  null\n      for (const emptyRow of analysis.emptyRows) {\n        if (emptyRow.prevOldCode !== null && emptyRow.nextOldCode === null) {\n          // \n        }\n      }\n\n      return result;\n    };\n\n    // \n    const newRows1 = buildNewRows(analysis1, headers1, colIndex1, new Set(analysis1.codeRows.map(r => r.oldCode)));\n    const newRows2 = buildNewRows(analysis2, headers2, colIndex2, new Set(analysis2.codeRows.map(r => r.oldCode)));\n\n    // \n    const countCodeChanges = (oldAnalysis, newRows, colIndex) => {\n      let count = 0;\n      // \n      const oldCodes = new Set(oldAnalysis.codeRows.map(r => r.oldCode));\n      const newCodes = new Set();\n\n      for (const row of newRows) {\n        const code = row[colIndex];\n        if (code) newCodes.add(code);\n      }\n\n      // \n      for (const [oldCode, newCode] of mapping.entries()) {\n        if (oldCodes.has(oldCode) && oldCode !== newCode) {\n          count++; // \n        }\n      }\n\n      // \n      for (const newCode of sortedNewCodes) {\n        const oldCode = reverseMapping.get(newCode);\n        if (!oldCodes.has(oldCode)) {\n          count++; // \n        }\n      }\n\n      return count;\n    };\n\n    fixedCount1 = countCodeChanges(analysis1, newRows1, colIndex1);\n    fixedCount2 = countCodeChanges(analysis2, newRows2, colIndex2);\n\n    // \n    table1Sheet.content = [headers1, ...newRows1];\n    table2Sheet.content = [headers2, ...newRows2];\n\n    return { fixedCount1, fixedCount2 };\n  }\n\n  // \n  // ========================================\n  const showTableRuleFixModal = (error, rule, ruleType, rawData, snapshot, currentThemeClass) => {\n    const { $ } = getCore();\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n\n    let contentHtml = '';\n    let actionBtns = '';\n\n    if (ruleType === 'tableReadonly') {\n      // \n      let changeCount = 0;\n      let changeDetails = [];\n\n      if (snapshot && rawData) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            const newRows = rawData[sheetId].content?.slice(1) || [];\n            const oldRows = snapshot[sheetId].content?.slice(1) || [];\n\n            // \n            newRows.forEach((row, idx) => {\n              const oldRow = oldRows[idx];\n              if (!oldRow) {\n                changeDetails.push(`${idx + 1}: `);\n                changeCount++;\n              } else {\n                for (let c = 0; c < row.length; c++) {\n                  if (String(row[c] || '') !== String(oldRow[c] || '')) {\n                    changeDetails.push(`${idx + 1}: `);\n                    changeCount++;\n                    break;\n                  }\n                }\n              }\n            });\n\n            // \n            if (oldRows.length > newRows.length) {\n              for (let i = newRows.length; i < oldRows.length; i++) {\n                changeDetails.push(`${i + 1}: `);\n                changeCount++;\n              }\n            }\n            break;\n          }\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-lock\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\"></div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${changeCount}</strong> \n          </div>\n          ${\n            changeDetails.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\">\n              ${changeDetails\n                .slice(0, 10)\n                .map(d => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(d)}</div>`)\n                .join('')}\n              ${changeDetails.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${changeDetails.length - 10} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n      actionBtns = `\n        <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n        <button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-restore-table\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n      `;\n    } else if (ruleType === 'rowLimit') {\n      // \n      const minRows = rule.config?.min;\n      const maxRows = rule.config?.max;\n      let currentRowCount = 0;\n      let excessRows = [];\n\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          currentRowCount = (rawData[sheetId].content?.length || 1) - 1; // \n          break;\n        }\n      }\n\n      const isTooMany = maxRows !== undefined && currentRowCount > maxRows;\n      const isTooFew = minRows !== undefined && currentRowCount < minRows;\n\n      if (isTooMany) {\n        for (let i = maxRows + 1; i <= currentRowCount; i++) {\n          excessRows.push(i);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-arrows-up-down\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            : <strong>${currentRowCount}</strong> \n            ${minRows !== undefined || maxRows !== undefined ? ` | : ${minRows !== undefined ? minRows : 0} ~ ${maxRows !== undefined ? maxRows : ''} ` : ''}\n          </div>\n          ${\n            isTooMany && excessRows.length > 0\n              ? `\n            <div class=\"acu-smart-fix-excess-rows\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-trash\"></i>  ( ${excessRows[0]} ):\n              </div>\n              <div class=\"acu-smart-fix-change-list\">\n                ${excessRows\n                  .slice(0, 10)\n                  .map(r => `<div class=\"acu-smart-fix-change-item\"> ${r} </div>`)\n                  .join('')}\n                ${excessRows.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${excessRows.length} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n          ${\n            isTooFew\n              ? `\n            <div class=\"acu-smart-fix-hint\">\n              <i class=\"fa-solid fa-info-circle\"></i>  ${minRows - currentRowCount} \n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (isTooMany && excessRows.length > 0) {\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-delete-rows\" data-start=\"${maxRows}\" data-table=\"${escapeHtml(error.tableName)}\">\n            <i class=\"fa-solid fa-trash\"></i>  ${excessRows.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    } else if (ruleType === 'sequence' && rule.targetColumn) {\n      // \n      const prefix = rule.config?.prefix || '';\n      const startFrom = rule.config?.startFrom !== undefined ? rule.config?.startFrom : 1;\n      let targetSheet = null;\n      let issues = [];\n      let fixSuggestions = [];\n\n      // \n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (targetSheet && targetSheet.content && targetSheet.content.length > 1) {\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = headers.indexOf(rule.targetColumn);\n\n        if (colIndex >= 0) {\n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num, originalRowIndex: i + 2 }); // +2 +1\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          const numCountMap = new Map(); // \n          const duplicates = [];\n          const gaps = [];\n          const outOfOrder = [];\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const actualNum = numbers[i].num;\n            if (!numCountMap.has(actualNum)) {\n              numCountMap.set(actualNum, []);\n            }\n            numCountMap.get(actualNum).push(i);\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n\n            // \n            const occurrences = numCountMap.get(actualNum) || [];\n            if (occurrences.length > 1) {\n              // \n              if (occurrences[0] === i) {\n                duplicates.push({\n                  rowNum,\n                  value: numbers[i].value,\n                  num: actualNum,\n                  expectedNum,\n                  count: occurrences.length,\n                });\n              }\n            }\n\n            // \n            if (actualNum !== expectedNum) {\n              if (actualNum < expectedNum) {\n                // \n                outOfOrder.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              } else {\n                // \n                gaps.push({ rowNum, value: numbers[i].value, num: actualNum, expectedNum });\n              }\n            }\n          }\n\n          // \n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowNum = numbers[i].originalRowIndex;\n            const currentValue = numbers[i].value;\n            const fixedValue = prefix + String(expectedNum).padStart(4, '0');\n\n            if (actualNum !== expectedNum || duplicates.some(d => d.num === actualNum && d.rowNum === rowNum)) {\n              fixSuggestions.push({\n                rowNum,\n                currentValue,\n                fixedValue,\n                reason: actualNum < expectedNum ? '' : actualNum > expectedNum ? '' : '',\n              });\n            }\n          }\n\n          // \n          const issueSet = new Set();\n          duplicates.forEach(d => {\n            issueSet.add(`${d.rowNum}: \"${d.value}\"  (${d.count})`);\n          });\n          gaps.forEach(g => {\n            issueSet.add(\n              `${g.rowNum}: \"${g.value}\"  \"${prefix}${String(g.expectedNum).padStart(4, '0')}\" ()`,\n            );\n          });\n          outOfOrder.forEach(o => {\n            issueSet.add(\n              `${o.rowNum}: \"${o.value}\"  \"${prefix}${String(o.expectedNum).padStart(4, '0')}\" ()`,\n            );\n          });\n          issues = Array.from(issueSet);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-sort-numeric-up\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${issues.length}</strong> \n          </div>\n          ${\n            issues.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n              ${issues\n                .slice(0, 20)\n                .map(issue => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(issue)}</div>`)\n                .join('')}\n              ${issues.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${issues.length - 20} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n          ${\n            fixSuggestions.length > 0\n              ? `\n            <div class=\"acu-smart-fix-suggest\" style=\"margin-top:12px;\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </div>\n              <div class=\"acu-smart-fix-change-list\" style=\"max-height:200px;overflow-y:auto;margin-top:8px;\">\n                ${fixSuggestions\n                  .slice(0, 20)\n                  .map(\n                    fix => `\n                  <div class=\"acu-smart-fix-change-item\">\n                    <span style=\"color:var(--acu-text-sub);\">${fix.rowNum}:</span>\n                    <span style=\"color:var(--acu-hl-manual);\">${escapeHtml(fix.currentValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);\">  </span>\n                    <span style=\"color:var(--acu-hl-auto);\">${escapeHtml(fix.fixedValue)}</span>\n                    <span style=\"color:var(--acu-text-sub);font-size:11px;\"> (${escapeHtml(fix.reason)})</span>\n                  </div>\n                `,\n                  )\n                  .join('')}\n                ${fixSuggestions.length > 20 ? `<div class=\"acu-smart-fix-change-item\">...  ${fixSuggestions.length - 20} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (fixSuggestions.length > 0) {\n        // \n        const pairedTable =\n          rule.config?.pairedTable ||\n          (error.tableName === '' ? '' : error.tableName === '' ? '' : null);\n        const pairedTableAttr = pairedTable ? `data-paired-table=\"${escapeHtml(pairedTable)}\"` : '';\n\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-fix-sequence\" data-table=\"${escapeHtml(error.tableName)}\" data-column=\"${escapeHtml(rule.targetColumn)}\" data-prefix=\"${escapeHtml(prefix)}\" data-start=\"${startFrom}\" ${pairedTableAttr}>\n            <i class=\"fa-solid fa-magic\"></i>  ${fixSuggestions.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    }\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} ()</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            ${contentHtml}\n          </div>\n          <div class=\"acu-dialog-btns\">\n            ${actionBtns}\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.on('click', '#smart-fix-restore-table', async function () {\n      if (!snapshot) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      try {\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            rawData[sheetId] = JSON.parse(JSON.stringify(snapshot[sheetId]));\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-fix-sequence', async function () {\n      const $btn = $(this);\n      const tableName = $btn.data('table');\n      const columnName = $btn.data('column');\n      const prefix = $btn.data('prefix') || '';\n      const startFrom = parseInt($btn.data('start') || '1', 10);\n      const pairedTableName = $btn.data('paired-table') || null;\n\n      try {\n        $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n\n        // \n        let targetSheet = null;\n        let targetSheetId = null;\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            targetSheet = rawData[sheetId];\n            targetSheetId = sheetId;\n            break;\n          }\n        }\n\n        if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        const headers = targetSheet.content[0] || [];\n        const rows = targetSheet.content.slice(1) || [];\n        const colIndex = headers.indexOf(columnName);\n\n        if (colIndex < 0) {\n          if (window.toastr) window.toastr.warning('');\n          $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n          return;\n        }\n\n        // \n        if (pairedTableName) {\n          // \n          let pairedSheet = null;\n          let pairedSheetId = null;\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === pairedTableName) {\n              pairedSheet = rawData[sheetId];\n              pairedSheetId = sheetId;\n              break;\n            }\n          }\n\n          if (!pairedSheet || !pairedSheet.content || pairedSheet.content.length < 1) {\n            if (window.toastr) window.toastr.warning(`: ${pairedTableName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          const pairedHeaders = pairedSheet.content[0] || [];\n          const pairedColIndex = pairedHeaders.indexOf(columnName);\n\n          if (pairedColIndex < 0) {\n            if (window.toastr) window.toastr.warning(`: ${columnName}`);\n            $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n            return;\n          }\n\n          // \n          const extract1 = extractCodesFromTable(targetSheet, columnName, prefix);\n          const extract2 = extractCodesFromTable(pairedSheet, columnName, prefix);\n\n          // \n          const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n          // \n          const { fixedCount1, fixedCount2 } = alignAndFixPairedTables(\n            targetSheet,\n            targetSheetId,\n            pairedSheet,\n            pairedSheetId,\n            columnName,\n            mapping,\n            prefix,\n            startFrom,\n            rawData,\n          );\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          // \n          // \n          const numbers = [];\n          for (let i = 0; i < rows.length; i++) {\n            const value = rows[i]?.[colIndex];\n            if (value === null || value === undefined || value === '') continue;\n\n            const strValue = String(value).trim();\n            if (!strValue) continue;\n\n            let num = null;\n            if (prefix) {\n              const match = strValue.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n              if (match) {\n                num = parseInt(match[1], 10);\n              }\n            } else {\n              num = parseInt(strValue, 10);\n            }\n\n            if (!isNaN(num)) {\n              numbers.push({ rowIndex: i, value: strValue, num });\n            }\n          }\n\n          // \n          numbers.sort((a, b) => a.rowIndex - b.rowIndex);\n\n          // \n          let fixedCount = 0;\n          for (let i = 0; i < numbers.length; i++) {\n            const expectedNum = startFrom + i;\n            const actualNum = numbers[i].num;\n            const rowIndex = numbers[i].rowIndex;\n\n            if (actualNum !== expectedNum) {\n              const fixedValue = prefix + String(expectedNum).padStart(4, '0');\n              rows[rowIndex][colIndex] = fixedValue;\n              fixedCount++;\n            }\n          }\n\n          // \n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        }\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n        $btn.prop('disabled', false).html('<i class=\"fa-solid fa-magic\"></i> ');\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-delete-rows', async function () {\n      const startRow = parseInt($(this).data('start'), 10);\n      const tableName = $(this).data('table');\n\n      try {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            // (index 0) startRow (index 1  startRow)\n            rawData[sheetId].content = rawData[sheetId].content.slice(0, startRow + 1);\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[DICE]ACU :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const showBlacklistManagerModal = () => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const theme = getThemeColors();\n    const t = theme;\n\n    $('.acu-blacklist-manager-overlay').remove();\n\n    const blacklist = BlacklistManager.getBlacklist();\n\n    const modalHtml = `\n      <div class=\"acu-blacklist-manager-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width: 600px; width: 90%;\">\n          <div class=\"acu-edit-title\" style=\"position: relative;\">\n            <i class=\"fa-solid fa-filter\"></i> \n            <button class=\"acu-close-btn\" style=\"position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: ${t.textMain}; cursor: pointer; font-size: 18px; z-index: 10;\">\n              <i class=\"fa-solid fa-times\"></i>\n            </button>\n          </div>\n          <div class=\"acu-settings-content\" style=\"flex: 1; overflow-y: auto; padding: 20px;\">\n            <div style=\"margin-bottom: 15px;\">\n              <div style=\"margin-bottom: 8px; font-size: 12px; color: ${t.textSub};\">\n                \n              </div>\n              <textarea id=\"blacklist-textarea\" style=\"width: 100%; min-height: 120px; max-height: 300px; padding: 10px !important; border: 1px solid ${t.border} !important; border-radius: 4px !important; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-size: 13px !important; box-sizing: border-box !important; resize: vertical; font-family: monospace; line-height: 1.5;\" placeholder=\"\"></textarea>\n              <div style=\"display: flex; gap: 8px; margin-top: 8px; flex-wrap: nowrap;\">\n                <input type=\"text\" id=\"blacklist-input\" placeholder=\"...\" style=\"flex: 1; min-width: 0; padding: 8px !important; border: 1px solid ${t.border} !important; border-radius: 4px !important; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-size: 13px !important; box-sizing: border-box !important;\">\n                <button id=\"blacklist-add-btn\" style=\"padding: 8px 16px; background: ${t.accent}; color: ${t.buttonTextOnAccent || t.textMain || '#6B4A5A'}; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; white-space: nowrap; flex-shrink: 0;\">\n                  <i class=\"fa-solid fa-plus\"></i> \n                </button>\n              </div>\n            </div>\n            <div style=\"display: flex; gap: 8px; margin-top: 15px;\">\n              <button id=\"blacklist-reset-btn\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; color: ${t.textMain}; border: 1px solid ${t.border}; border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-undo\"></i> \n              </button>\n              <button id=\"blacklist-close-btn\" style=\"flex: 1; padding: 10px; background: ${t.accent}; color: ${t.buttonTextOnAccent || t.textMain || '#6B4A5A'}; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;\">\n                <i class=\"fa-solid fa-check\"></i> \n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '2147483655',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    // textarea\n    const updateTextarea = () => {\n      const blacklist = BlacklistManager.getBlacklist();\n      const $textarea = $modal.find('#blacklist-textarea');\n      $textarea.val(blacklist.join(''));\n    };\n\n    // textareaBlacklistManager\n    const syncFromTextarea = () => {\n      const $textarea = $modal.find('#blacklist-textarea');\n      const text = $textarea.val().trim();\n      if (!text) {\n        BlacklistManager.setBlacklist([]);\n        return;\n      }\n      // \n      const items = text\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n      // \n      const uniqueItems = [...new Set(items)];\n      BlacklistManager.setBlacklist(uniqueItems);\n      // textarea\n      if (uniqueItems.length !== items.length) {\n        updateTextarea();\n      }\n    };\n\n    // textarea\n    updateTextarea();\n\n    // textarea\n    $modal.find('#blacklist-textarea').on('input', function () {\n      syncFromTextarea();\n    });\n\n    // \n    $modal.find('#blacklist-add-btn').click(function () {\n      const input = $modal.find('#blacklist-input');\n      const value = input.val().trim();\n      if (!value) return;\n\n      // \n      const newItems = value\n        .split(/[,]/)\n        .map(s => s.trim())\n        .filter(s => s.length > 0);\n\n      if (newItems.length === 0) return;\n\n      const blacklist = BlacklistManager.getBlacklist();\n      const existingSet = new Set(blacklist);\n      const addedItems = [];\n\n      newItems.forEach(item => {\n        if (!existingSet.has(item)) {\n          blacklist.push(item);\n          existingSet.add(item);\n          addedItems.push(item);\n        }\n      });\n\n      if (addedItems.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      BlacklistManager.setBlacklist(blacklist);\n      input.val('');\n      updateTextarea();\n    });\n\n    $modal.find('#blacklist-input').on('keypress', function (e) {\n      if (e.which === 13) {\n        $modal.find('#blacklist-add-btn').click();\n      }\n    });\n\n    $modal.find('#blacklist-reset-btn').click(function () {\n      if (confirm('')) {\n        BlacklistManager.resetToDefault();\n        updateTextarea();\n      }\n    });\n\n    const closeModal = () => {\n      $modal.remove();\n      // \n      renderInterface();\n    };\n\n    $modal.find('#blacklist-close-btn, .acu-close-btn').click(closeModal);\n    $modal.on('click', function (e) {\n      if ($(e.target).hasClass('acu-blacklist-manager-overlay')) closeModal();\n    });\n  };\n\n  const showAttributePresetManager = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const presets = AttributePresetManager.getAllPresets();\n    const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n\n    // HTMLactiveIdnull\n    const isDefaultActive = activeId === null;\n    const defaultPresetHtml = `\n      <div class=\"acu-preset-item\" data-id=\"__default__\">\n        <div class=\"acu-preset-info\">\n          <div class=\"acu-preset-name\">\n            \n            <span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>\n          </div>\n          <div class=\"acu-preset-desc\">5-95</div>\n          <div class=\"acu-preset-stats\">\n            : 6 | : 0\n          </div>\n        </div>\n        <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n          <label class=\"acu-toggle\" style=\"margin: 0;\">\n            <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"__default__\" ${isDefaultActive ? 'checked' : ''}>\n            <span class=\"acu-toggle-slider\"></span>\n          </label>\n        </div>\n      </div>\n    `;\n\n    // HTML\n    const presetsHtml = presets\n      .map(preset => {\n        const isActive = preset.id === activeId;\n        const isBuiltin = preset.builtin;\n\n        return `\n        <div class=\"acu-preset-item\" data-id=\"${preset.id}\">\n          <div class=\"acu-preset-info\">\n            <div class=\"acu-preset-name\">\n              ${escapeHtml(preset.name)}\n              ${isBuiltin ? `<span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>` : ''}\n            </div>\n            ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n            <div class=\"acu-preset-stats\">\n              : ${preset.baseAttributes.length} | : ${preset.specialAttributes?.length || 0}\n            </div>\n          </div>\n          <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n            <label class=\"acu-toggle\" style=\"margin: 0;\">\n              <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"${preset.id}\" ${isActive ? 'checked' : ''}>\n              <span class=\"acu-toggle-slider\"></span>\n            </label>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>` : ''}\n            <button class=\"acu-preset-btn acu-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: #e74c3c;\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n          </div>\n        </div>\n      `;\n      })\n      .join('');\n\n    // \n    const allPresetsHtml = defaultPresetHtml + presetsHtml;\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 80vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-dice-d20\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div id=\"acu-presets-list\">\n              ${allPresetsHtml || `<div style=\"text-align: center; padding: 40px; color: ${t.textSub};\"></div>`}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"acu-preset-new\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-preset-import\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-preset-back\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n\n          <input type=\"file\" id=\"acu-preset-file-input\" accept=\".json\" style=\"display: none;\" />\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn, #acu-preset-back').on('click', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n\n    // Toggle\n    overlay.on('change', '.acu-preset-toggle', function () {\n      const $toggle = $(this);\n      const id = $toggle.data('id');\n      const isChecked = $toggle.is(':checked');\n\n      if (isChecked) {\n        // id\"__default__\"null\n        const finalId = id === '__default__' ? null : id;\n        AttributePresetManager.setActivePreset(finalId);\n\n        // toggle\n        overlay.find('.acu-preset-toggle').each(function () {\n          const $thisToggle = $(this);\n          const thisId = $thisToggle.data('id');\n          if (thisId !== id) {\n            $thisToggle.prop('checked', false);\n          }\n        });\n      } else {\n        // null\n        AttributePresetManager.setActivePreset(null);\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showAttributePresetEditor(id);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-export', function () {\n      const id = $(this).data('id');\n      const json = AttributePresetManager.exportPreset(id);\n      if (!json) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      const preset = presets.find(p => p.id === id);\n      const filename = `acu_preset_${preset?.name || id}_${Date.now()}.json`;\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        const success = AttributePresetManager.deletePreset(id);\n        if (success) {\n          overlay.remove();\n          showAttributePresetManager();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      }\n    });\n\n    // \n    overlay.find('#acu-preset-new').on('click', () => {\n      overlay.remove();\n      showAttributePresetEditor();\n    });\n\n    // \n    overlay.find('#acu-preset-import').on('click', () => {\n      overlay.find('#acu-preset-file-input').click();\n    });\n\n    overlay.find('#acu-preset-file-input').on('change', function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      const reader = new FileReader();\n      reader.onload = evt => {\n        try {\n          const jsonStr = evt.target.result as string;\n          if (!jsonStr?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(jsonStr.trim());\n          } catch {\n            if (window.toastr) window.toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.name || '';\n          const existingPresets = AttributePresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = jsonStr.trim();\n            if (newName) {\n              parsedData.name = newName;\n              // IDID\n              parsedData.id = `attr_preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset && !existingPreset.builtin) {\n                AttributePresetManager.deletePreset(existingPreset.id);\n              }\n            }\n\n            const imported = AttributePresetManager.importPreset(finalJson);\n            if (imported) {\n              overlay.remove();\n              showAttributePresetManager();\n            } else {\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      };\n      reader.readAsText(file);\n\n      // \n      $(this).val('');\n    });\n\n    // \n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        overlay.remove();\n        showSettingsModal();\n      }\n    });\n  };\n\n  // \n  const showAttributePresetEditor = (presetId = null) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? AttributePresetManager.getAllPresets().find(p => p.id === presetId) : null;\n\n    // \n    const defaultData = {\n      name: existingPreset?.name || '',\n      description: existingPreset?.description || '',\n      baseAttributes: existingPreset?.baseAttributes || [\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n      ],\n      specialAttributes: existingPreset?.specialAttributes || [],\n    };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 650px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-pen\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 8px;\">\n                JSON <span style=\"font-size: 10px; color: ${t.textSub};\">()</span>\n              </label>\n              <textarea id=\"preset-json\" class=\"acu-preset-editor-textarea\" style=\"width: 100%; height: 320px; padding: 10px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-family: 'Consolas', 'Monaco', monospace !important; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: ${t.textSub}; padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n               baseAttributes:  nameformularangemodifier()<br/>\n               specialAttributes:  nameformularange()<br/>\n               : 3d6, 4d6kh3, (/2), (+-*/)\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"preset-save\" style=\"flex: 1; padding: 10px; background: ${t.buttonBg || t.accent}; border: none; border-radius: 6px; color: ${t.buttonText}; cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"preset-cancel\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#preset-json');\n\n    // JSON\n    const updateJSON = () => {\n      const data = {\n        baseAttributes: defaultData.baseAttributes,\n        specialAttributes: defaultData.specialAttributes,\n      };\n      $jsonTextarea.val(JSON.stringify(data, null, 2));\n    };\n    updateJSON();\n\n    // \n    overlay.find('.acu-close-btn, #preset-cancel').on('click', () => {\n      overlay.remove();\n      showAttributePresetManager();\n    });\n\n    // \n    overlay.find('#preset-save').on('click', () => {\n      try {\n        const name = overlay.find('#preset-name').val().trim();\n        const description = overlay.find('#preset-desc').val().trim();\n        const jsonStr = $jsonTextarea.val().trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const jsonData = JSON.parse(jsonStr);\n\n        // \n        if (\n          !jsonData.baseAttributes ||\n          !Array.isArray(jsonData.baseAttributes) ||\n          jsonData.baseAttributes.length === 0\n        ) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n\n        // \n        const preset = {\n          format: 'acu_attr_preset_v1',\n          version: 1,\n          id: presetId || `custom_${Date.now()}`,\n          name,\n          description,\n          baseAttributes: jsonData.baseAttributes,\n          specialAttributes: jsonData.specialAttributes || [],\n        };\n\n        // \n        if (isEdit) {\n          AttributePresetManager.updatePreset(presetId, preset);\n        } else {\n          AttributePresetManager.createPreset(preset);\n        }\n\n        overlay.remove();\n        showAttributePresetManager();\n      } catch (err) {\n        console.error('[DICE]ACU :', err);\n        if (window.toastr) window.toastr.error('' + (err.message || 'JSON'));\n      }\n    });\n\n    // \n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        overlay.remove();\n        showAttributePresetManager();\n      }\n    });\n  };\n\n  // ========================================\n  // Debug\n  // ========================================\n  const showDebugConsoleModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-debug-console-dialog)').remove();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const t = getThemeColors();\n\n    // localStorage\n    const savedFilters = Store.get('acu_debug_filters', { log: true, info: true, warn: true, error: true });\n    ConsoleCaptureManager.setFilters(savedFilters);\n\n    const renderLogs = () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      const $logContainer = dialog.find('.acu-debug-log-container');\n      $logContainer.empty();\n\n      if (filteredLogs.length === 0) {\n        $logContainer.html(\n          '<div style=\"text-align:center;padding:40px;color:var(--acu-text-sub);\"><i class=\"fa-solid fa-inbox\"></i><br/></div>',\n        );\n        return;\n      }\n\n      filteredLogs.forEach(log => {\n        const typeColors = {\n          error: '#e74c3c',\n          warn: '#f39c12',\n          info: '#3498db',\n          log: '#95a5a6',\n        };\n        const typeIcons = {\n          error: 'fa-exclamation-circle',\n          warn: 'fa-exclamation-triangle',\n          info: 'fa-info-circle',\n          log: 'fa-circle',\n        };\n        const color = typeColors[log.type] || typeColors.log;\n        const icon = typeIcons[log.type] || typeIcons.log;\n\n        const logItem = $(`\n          <div class=\"acu-debug-log-item\" data-type=\"${log.type}\" style=\"padding:8px 12px;border-bottom:1px solid var(--acu-border);font-family:monospace;font-size:12px;line-height:1.5;\">\n            <div style=\"display:flex;align-items:flex-start;gap:8px;\">\n              <span style=\"color:${color};min-width:60px;font-size:11px;\">\n                <i class=\"fa-solid ${icon}\"></i> [${log.timeStr}]\n              </span>\n              <span style=\"color:${color};min-width:50px;font-size:11px;text-transform:uppercase;\">[${log.type}]</span>\n              <span style=\"flex:1;color:var(--acu-text-main);word-break:break-word;white-space:pre-wrap;\">${escapeHtml(log.content)}</span>\n            </div>\n            ${log.stack ? `<div style=\"margin-top:4px;margin-left:128px;color:var(--acu-text-sub);font-size:11px;white-space:pre-wrap;font-family:monospace;\">${escapeHtml(log.stack)}</div>` : ''}\n          </div>\n        `);\n        $logContainer.append(logItem);\n      });\n    };\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-debug-console-dialog ${currentThemeClass}\" style=\"max-width:90vw;max-height:90vh;width:800px;height:600px;display:flex;flex-direction:column;\">\n          <div class=\"acu-settings-header\" style=\"flex-shrink:0;\">\n            <div class=\"acu-settings-title\"><i class=\"fa-solid fa-bug\"></i> Debug</div>\n            <button class=\"acu-close-btn\" id=\"debug-console-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex:1;display:flex;flex-direction:column;overflow:hidden;\">\n            <!--  -->\n            <div style=\"padding:12px;border-bottom:1px solid var(--acu-border);flex-shrink:0;display:flex;flex-direction:column;gap:8px;\">\n              <!-- Console -->\n              <div style=\"display:flex;align-items:center;gap:8px;padding-bottom:8px;border-bottom:1px solid var(--acu-border);\">\n                <span style=\"font-size:12px;color:var(--acu-text-sub);flex:1;\">Console:</span>\n                <label class=\"acu-toggle\">\n                  <input type=\"checkbox\" id=\"debug-console-capture-toggle\" ${ConsoleCaptureManager.enabled ? 'checked' : ''}>\n                  <span class=\"acu-toggle-slider\"></span>\n                </label>\n                <span id=\"debug-console-capture-status\" style=\"font-size:11px;color:var(--acu-text-sub);\">${ConsoleCaptureManager.enabled ? '' : ''}</span>\n              </div>\n              <!--  -->\n              <div style=\"display:flex;flex-wrap:wrap;gap:8px;align-items:center;\">\n                <div style=\"display:flex;gap:8px;align-items:center;flex:1;\">\n                  <span style=\"font-size:12px;color:var(--acu-text-sub);\">:</span>\n                  <button class=\"acu-btn ${savedFilters.log ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"log\" style=\"padding:4px 10px;font-size:12px;${savedFilters.log ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Log</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.info ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"info\" style=\"padding:4px 10px;font-size:12px;${savedFilters.info ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Info</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.warn ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"warn\" style=\"padding:4px 10px;font-size:12px;${savedFilters.warn ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Warn</span>\n                  </button>\n                  <button class=\"acu-btn ${savedFilters.error ? 'acu-btn-primary' : 'acu-btn-secondary'}\" data-filter-type=\"error\" style=\"padding:4px 10px;font-size:12px;${savedFilters.error ? '' : 'opacity:0.5;'}\">\n                    <span style=\"color:var(--acu-text-main);\">Error</span>\n                  </button>\n                </div>\n                <div style=\"display:flex;gap:6px;\">\n                  <button class=\"acu-btn acu-btn-secondary\" id=\"debug-console-clear\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-trash\"></i> \n                  </button>\n                  <button class=\"acu-btn acu-btn-secondary\" id=\"debug-console-copy\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-copy\"></i> \n                  </button>\n                  <button class=\"acu-btn acu-btn-primary\" id=\"debug-console-export\" style=\"padding:6px 12px;font-size:12px;\">\n                    <i class=\"fa-solid fa-download\"></i> \n                  </button>\n                </div>\n              </div>\n            </div>\n\n            <!--  -->\n            <div class=\"acu-debug-log-scroll\" style=\"flex:1;overflow-y:auto;overflow-x:hidden;background:var(--acu-card-bg);\">\n              <div class=\"acu-debug-log-container\"></div>\n            </div>\n\n            <!--  -->\n            <div style=\"padding:8px 12px;border-top:1px solid var(--acu-border);flex-shrink:0;font-size:11px;color:var(--acu-text-sub);display:flex;justify-content:space-between;\">\n              <span>: <span id=\"debug-total-count\">0</span> | : <span id=\"debug-filtered-count\">0</span></span>\n            </div>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const updateCounts = () => {\n      const total = ConsoleCaptureManager.logs.length;\n      const filtered = ConsoleCaptureManager.getFilteredLogs().length;\n      dialog.find('#debug-total-count').text(total);\n      dialog.find('#debug-filtered-count').text(filtered);\n    };\n\n    // \n    renderLogs();\n    updateCounts();\n\n    // Console\n    dialog.find('#debug-console-capture-toggle').on('change', function () {\n      const checked = $(this).is(':checked');\n      const $status = dialog.find('#debug-console-capture-status');\n      if (checked) {\n        ConsoleCaptureManager.enable();\n        $status.text('');\n        // \n        console.log('[DICE]Debug');\n      } else {\n        ConsoleCaptureManager.disable();\n        $status.text('');\n      }\n    });\n\n    // \n    dialog.find('[data-filter-type]').on('click', function () {\n      const type = $(this).data('filter-type');\n      const isActive = $(this).hasClass('acu-btn-primary');\n      const newState = !isActive;\n\n      // \n      if (newState) {\n        $(this).removeClass('acu-btn-secondary').addClass('acu-btn-primary');\n        $(this).css('opacity', '1');\n      } else {\n        $(this).removeClass('acu-btn-primary').addClass('acu-btn-secondary');\n        $(this).css('opacity', '0.5');\n      }\n\n      // \n      ConsoleCaptureManager.setFilters({ [type]: newState });\n      Store.set('acu_debug_filters', ConsoleCaptureManager.filters);\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-clear').on('click', () => {\n      ConsoleCaptureManager.clear();\n      renderLogs();\n      updateCounts();\n    });\n\n    // \n    dialog.find('#debug-console-copy').on('click', async () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n');\n\n      try {\n        // \n        if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n          const safeContent = text.replace(/\\\"/g, '\\\\\"').replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          return;\n        }\n        // API\n        if (navigator.clipboard && window.isSecureContext) {\n          await navigator.clipboard.writeText(text);\n        } else {\n          // execCommand\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n          document.body.appendChild(textArea);\n          textArea.select();\n          textArea.setSelectionRange(0, 99999);\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n          if (!successful) {\n            throw new Error('execCommand failed');\n          }\n        }\n      } catch (err) {\n        console.error('[DICE]DebugConsole :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // \n    dialog.find('#debug-console-export').on('click', () => {\n      const filteredLogs = ConsoleCaptureManager.getFilteredLogs();\n      if (filteredLogs.length === 0) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      const text = filteredLogs\n        .map(log => {\n          let line = `[${log.timeStr}] [${log.type.toUpperCase()}] ${log.content}`;\n          if (log.stack) {\n            line += '\\n' + log.stack;\n          }\n          return line;\n        })\n        .join('\\n\\n');\n\n      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `debug-console-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    });\n\n    // \n    dialog.find('#debug-console-close, .acu-edit-overlay').on('click', function (e) {\n      if (e.target === this || $(e.target).closest('.acu-close-btn').length) {\n        dialog.remove();\n      }\n    });\n\n    // \n    // [] \n    const refreshInterval = setInterval(() => {\n      if (dialog.length && dialog.is(':visible')) {\n        renderLogs();\n        updateCounts();\n      }\n    }, 500);\n\n    // \n    dialog.on('remove', () => {\n      clearInterval(refreshInterval);\n    });\n  };\n\n  // ========================================\n  // showAddRegexRuleModal - / (Phase 4.2)\n  // ========================================\n  const showAddRegexRuleModal = (editRuleId?: string) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // ()\n    const editRule = editRuleId ? RegexTransformationManager.getRule(editRuleId) : null;\n\n    // \n    const tableData = cachedRawData || getTableData();\n    const tableNames = Object.keys(tableData || {})\n      .filter(k => k.startsWith('sheet_'))\n      .map(k => tableData[k]?.name || k)\n      .sort();\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-dice-cfg-header\">\n            <span><i class=\"fa-solid fa-magic\"></i> ${editRule ? '' : ''}</span>\n            <button class=\"acu-config-close\" id=\"acu-close-regex-rule\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.name) : ''}\" placeholder=\": \" style=\"flex:1;\" required>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <textarea id=\"rule-description\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1; resize: none; overflow-wrap: break-word; overflow-y: hidden; min-height: 34px; height: 34px; line-height: 1.4;\">${editRule ? escapeHtml(editRule.description || '') : ''}</textarea>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <input type=\"text\" id=\"rule-pattern\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.pattern) : ''}\" placeholder=\": \\\\s+  /test/g\" style=\"flex:1; font-family: monospace;\" required>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-replacement\" class=\"acu-panel-input\" value=\"${editRule ? escapeHtml(editRule.replacement || '') : ''}\" placeholder=\", $1, $2 \" style=\"flex:1; font-family: monospace;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> *</span></div>\n              <select id=\"rule-scope-type\" class=\"acu-setting-select\" style=\"width:120px;\">\n                <option value=\"global\" ${editRule?.scope?.type === 'global' ? 'selected' : ''}></option>\n                <option value=\"table\" ${editRule?.scope?.type === 'table' ? 'selected' : ''}></option>\n                <option value=\"column\" ${editRule?.scope?.type === 'column' ? 'selected' : ''}></option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"field-table-names\" style=\"display: ${editRule?.scope?.type === 'global' ? 'none' : 'flex'};\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> ()</span></div>\n              <input type=\"text\" id=\"rule-table-names\" class=\"acu-panel-input\" value=\"${editRule?.scope?.tableNames?.join(',') || ''}\" placeholder=\": ,\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\" id=\"field-column-names\" style=\"display: ${editRule?.scope?.type === 'column' ? 'flex' : 'none'};\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"> ()</span></div>\n              <input type=\"text\" id=\"rule-column-names\" class=\"acu-panel-input\" value=\"${editRule?.scope?.columnNames?.join(',') || ''}\" placeholder=\": ,\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"number\" id=\"rule-priority\" class=\"acu-panel-input\" value=\"${editRule?.priority || 50}\" min=\"1\" max=\"100\" style=\"width:80px;\">\n            </div>\n\n          </div>\n          <div class=\"acu-dice-cfg-actions\">\n            <button id=\"acu-regex-rule-cancel\"></button>\n            <button id=\"acu-regex-rule-confirm\"></button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    // /\n    const updateScopeFields = () => {\n      const scopeType = dialog.find('#rule-scope-type').val();\n      if (scopeType === 'global') {\n        dialog.find('#field-table-names, #field-column-names').hide();\n      } else if (scopeType === 'table') {\n        dialog.find('#field-table-names').css('display', 'flex').show();\n        dialog.find('#field-column-names').hide();\n      } else if (scopeType === 'column') {\n        dialog.find('#field-table-names, #field-column-names').css('display', 'flex').show();\n      }\n    };\n\n    dialog.find('#rule-scope-type').on('change', updateScopeFields);\n\n    // Textarea\n    const $textarea = dialog.find('#rule-description');\n    const autoResizeTextarea = () => {\n      // scrollHeight\n      $textarea.css('height', '34px');\n      // ,1\n      const scrollHeight = $textarea[0].scrollHeight;\n      $textarea.css('height', Math.max(34, scrollHeight) + 'px');\n    };\n    // \n    $textarea.on('input', autoResizeTextarea);\n\n    // ()\n    dialog.find('#acu-regex-rule-confirm').on('click', async function () {\n      const name = dialog.find('#rule-name').val();\n      const pattern = dialog.find('#rule-pattern').val();\n      const scopeType = dialog.find('#rule-scope-type').val();\n\n      if (!name || !pattern) {\n        toastr.error('');\n        return;\n      }\n\n      //  scope \n      const scope: RegexScopeConfig = { type: scopeType as RegexScopeType };\n      if (scopeType !== 'global') {\n        const tableNames = dialog.find('#rule-table-names').val();\n        if (tableNames)\n          scope.tableNames = String(tableNames)\n            .split(',')\n            .map(s => s.trim())\n            .filter(s => s);\n      }\n      if (scopeType === 'column') {\n        const columnNames = dialog.find('#rule-column-names').val();\n        if (columnNames)\n          scope.columnNames = String(columnNames)\n            .split(',')\n            .map(s => s.trim())\n            .filter(s => s);\n      }\n\n      //  pattern  flags\n      const patternStr = String(pattern);\n      const { flags: extractedFlags, patternWithoutFlags } = RegexTransformationEngine._extractFlags(patternStr);\n\n      //  UI  flags\n      const $flagGlobal = dialog.find('#flag-global');\n      const $flagIgnoreCase = dialog.find('#flag-ignorecase');\n      const $flagMultiline = dialog.find('#flag-multiline');\n\n      const uiFlags = {\n        global: $flagGlobal.length > 0 ? $flagGlobal.is(':checked') : false,\n        caseInsensitive: $flagIgnoreCase.length > 0 ? $flagIgnoreCase.is(':checked') : false,\n        multiline: $flagMultiline.length > 0 ? $flagMultiline.is(':checked') : false,\n      };\n\n      //  pattern  flags pattern  flags\n      const finalPattern = patternWithoutFlags !== patternStr ? patternWithoutFlags : patternStr;\n      const finalFlags =\n        patternWithoutFlags !== patternStr\n          ? { ...uiFlags, ...extractedFlags } //  flags  UI flags\n          : uiFlags; //  flags UI flags\n\n      const ruleData = {\n        name: String(name),\n        description: dialog.find('#rule-description').val(),\n        operation: 'replace', // \n        pattern: finalPattern, //  pattern flags\n        flags: finalFlags, //  flags\n        replacement: dialog.find('#rule-replacement').val(),\n        scope,\n        enabled: true, // \n        priority: parseInt(dialog.find('#rule-priority').val(), 10),\n        executeMode: 'auto', // \n      };\n\n      // \n      if (editRuleId) {\n        // \n        RegexTransformationManager.updateRule(editRuleId, ruleData);\n      } else {\n        // \n        const newRule = RegexTransformationManager.addCustomRule(ruleData);\n        if (newRule) {\n          editRuleId = newRule.id;\n        }\n      }\n\n      // [] \n      isSettingsOpen = false; // ,\n      dialog.remove();\n      $(document).off('keydown.regex-rule-modal'); // ESC\n      renderInterface(); // \n    });\n\n    //  isSettingsOpen\n    const closeDialog = () => {\n      dialog.remove();\n      $(document).off('keydown.regex-rule-modal'); // ESC\n    };\n\n    // \n    dialog.find('#acu-regex-rule-cancel, #acu-close-regex-rule').on('click', function (e) {\n      e.stopPropagation();\n      closeDialog();\n    });\n\n    // \n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        closeDialog();\n      }\n    });\n\n    // ESC \n    $(document).on('keydown.regex-rule-modal', function (e) {\n      if (e.key === 'Escape' && dialog.length && dialog.is(':visible')) {\n        e.preventDefault();\n        closeDialog();\n        $(document).off('keydown.regex-rule-modal'); // \n      }\n    });\n\n    $('body').append(dialog);\n\n    // DOMtextarea\n    requestAnimationFrame(() => {\n      const $textarea = dialog.find('#rule-description');\n      if ($textarea.length && $textarea[0].scrollHeight > 34) {\n        $textarea.css('height', $textarea[0].scrollHeight + 'px');\n      }\n    });\n  };\n\n  // \n  window.showAddRegexRuleModal = showAddRegexRuleModal;\n\n  // \n  window.showDebugConsoleModal = showDebugConsoleModal;\n\n  const showSettingsModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-settings-dialog)').remove();\n    isSettingsOpen = true;\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const t = getThemeColors();\n\n    // \n    const expandedGroups = Store.get('acu_settings_expanded', ['appearance']);\n\n    const isGroupExpanded = groupId => expandedGroups.includes(groupId);\n    // HTMLMVU\n    const SPECIAL_BUTTONS_CONFIG = [\n      { key: '__dice__', name: '', icon: 'fa-dice-d20' },\n      { key: '__changes__', name: '', icon: 'fa-code-compare' },\n      { key: '__mvu__', name: 'MVU', icon: 'fa-code-branch' },\n    ];\n\n    const tableManagerHtml = (() => {\n      const rawData = cachedRawData || getTableData();\n      const tables = processJsonData(rawData || {});\n      const savedOrder = getSavedTableOrder() || [];\n      const hiddenList = getHiddenTables();\n\n      //  + \n      let allItems = [];\n\n      // \n      SPECIAL_BUTTONS_CONFIG.forEach(btn => {\n        // MVU \n        allItems.push({ key: btn.key, name: btn.name, icon: btn.icon, isSpecial: true });\n      });\n\n      // \n      Object.keys(tables).forEach(name => {\n        allItems.push({ key: name, name: name, icon: getIconForTableName(name), isSpecial: false });\n      });\n\n      // \n      if (savedOrder.length > 0) {\n        const orderMap = new Map(savedOrder.map((k, i) => [k, i]));\n        allItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      return allItems\n        .map(item => {\n          const isHidden = hiddenList.includes(item.key);\n          const specialClass = item.isSpecial ? ' acu-special-item' : '';\n          const displayName = item.name;\n          return (\n            '<div class=\"acu-table-manager-item' +\n            specialClass +\n            (isHidden ? ' hidden-table' : '') +\n            '\" data-table-name=\"' +\n            escapeHtml(item.key) +\n            '\" draggable=\"false\">' +\n            '<div class=\"acu-table-item-check\" title=\"/\">' +\n            '<i class=\"fa-solid ' +\n            (isHidden ? 'fa-eye-slash' : 'fa-eye') +\n            '\"></i>' +\n            '</div>' +\n            '<div class=\"acu-table-item-icon\"><i class=\"fa-solid ' +\n            item.icon +\n            '\"></i></div>' +\n            '<div class=\"acu-table-item-name\">' +\n            escapeHtml(displayName) +\n            '</div>' +\n            '<div class=\"acu-table-item-handle\" title=\"\">' +\n            '<i class=\"fa-solid fa-grip-vertical\"></i>' +\n            '</div>' +\n            '</div>'\n          );\n        })\n        .join('');\n    })();\n    const chevron = groupId => (isGroupExpanded(groupId) ? 'fa-chevron-down' : 'fa-chevron-right');\n\n    const dialog = $(`\n        <div class=\"acu-edit-overlay\">\n            <div class=\"acu-edit-dialog acu-settings-dialog ${currentThemeClass}\">\n                <div class=\"acu-settings-header\">\n                    <div class=\"acu-settings-title\">\n                        <span class=\"acu-settings-text\">\n                            <i class=\"fa-solid fa-cog\"></i> \n                            <span class=\"acu-version-badge\">${SCRIPT_VERSION}</span>\n                        </span>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-help-btn\" id=\"acu-help-btn\" title=\"\"><i class=\"fa-solid fa-question-circle\"></i></button>\n                        <button class=\"acu-close-btn\" id=\"dlg-close-x\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n\n                <div class=\"acu-settings-body\">\n                <!--  -->\n                <div class=\"acu-settings-group ${isGroupExpanded('appearance') ? '' : 'collapsed'}\" data-group=\"appearance\">                    <div class=\"acu-settings-group-title\">\n                        <i class=\"fa-solid ${chevron('appearance')} acu-group-chevron\"></i>\n                        <i class=\"fa-solid fa-palette\"></i> \n                    </div>\n                    <div class=\"acu-settings-group-body\">\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-theme\" class=\"acu-setting-select\">\n                                ${THEMES.map(t => `<option value=\"${t.id}\" ${t.id === config.theme ? 'selected' : ''}>${t.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-font-family\" class=\"acu-setting-select\">\n                                ${FONTS.map(f => `<option value=\"${f.id}\" ${f.id === config.fontFamily ? 'selected' : ''}>${f.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-main\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.fontSize}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-opt\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.optionFontSize || 12}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row acu-setting-row-toggle\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <label class=\"acu-toggle\">\n                                <input type=\"checkbox\" id=\"cfg-new\" ${config.highlightNew ? 'checked' : ''}>\n                                <span class=\"acu-toggle-slider\"></span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('layout') ? '' : 'collapsed'}\" data-group=\"layout\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('layout')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-th-large\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-width\" data-min=\"200\" data-max=\"500\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.cardWidth}px</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-layout\" class=\"acu-setting-select\">\n                                    <option value=\"horizontal\" ${config.layout !== 'vertical' ? 'selected' : ''}></option>\n                                    <option value=\"vertical\" ${config.layout === 'vertical' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                    <span class=\"acu-setting-hint\"></span>\n                                </div>\n                                <select id=\"cfg-grid-cols\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"2\" ${config.gridColumns == 2 ? 'selected' : ''}>2</option>\n                                    <option value=\"3\" ${config.gridColumns == 3 ? 'selected' : ''}>3</option>\n                                    <option value=\"4\" ${config.gridColumns == 4 ? 'selected' : ''}>4</option>\n                                    <option value=\"auto\" ${config.gridColumns === 'auto' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-per-page\" data-min=\"10\" data-max=\"200\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.itemsPerPage}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('position') ? '' : 'collapsed'}\" data-group=\"position\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('position')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-arrows-alt\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-position\" class=\"acu-setting-select\">\n                                    <option value=\"fixed\" ${config.positionMode !== 'embedded' ? 'selected' : ''}></option>\n                                    <option value=\"embedded\" ${config.positionMode === 'embedded' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-action-pos\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bottom\" ${config.actionsPosition !== 'top' ? 'selected' : ''}></option>\n                                    <option value=\"top\" ${config.actionsPosition === 'top' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-style\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bar\" ${config.collapseStyle === 'bar' ? 'selected' : ''}></option>\n                                    <option value=\"pill\" ${config.collapseStyle === 'pill' ? 'selected' : ''}></option>\n                                    <option value=\"mini\" ${config.collapseStyle === 'mini' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-align\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"right\" ${config.collapseAlign !== 'left' ? 'selected' : ''}></option>\n                                    <option value=\"left\" ${config.collapseAlign === 'left' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('options') ? '' : 'collapsed'}\" data-group=\"options\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('options')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-gamepad\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row acu-setting-row-toggle\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-show-opt\" ${config.showOptionPanel !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                            <div class=\"acu-setting-row acu-setting-row-toggle\" id=\"row-auto-send\" style=\"${config.showOptionPanel !== false ? '' : 'display:none;'}\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-auto-send\" ${config.clickOptionToAutoSend !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('tables') ? '' : 'collapsed'}\" data-group=\"tables\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('tables')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-table\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-table-manager-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <div class=\"acu-table-manager-list\" id=\"table-manager-list\">\n                                ${tableManagerHtml}\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('validation') ? '' : 'collapsed'}\" data-group=\"validation\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('validation')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-clipboard-check\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${PresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === PresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}${p.builtin ? ' ()' : ''}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-reset\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> <i class=\"fa-solid fa-shield-halved\"></i> \n                            </div>\n                            <div class=\"acu-validation-rules-list\" id=\"validation-rules-list\">\n                                ${ValidationRuleManager.getAllRules()\n                                  .map(rule => {\n                                    const typeInfo = RULE_TYPE_INFO[rule.ruleType] || {\n                                      name: rule.ruleType,\n                                      icon: 'fa-question',\n                                    };\n                                    const isTableRule = typeInfo.scope === 'table';\n                                    const hasIntercept = rule.intercept;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n                                            <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n                                        </div>\n                                        <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n                                        <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <button class=\"acu-add-rule-btn\" id=\"btn-add-validation-rule\">\n                                <i class=\"fa-solid fa-plus\"></i> \n                            </button>\n                        </div>\n                    </div>\n\n                    <!--  - Phase 4.1 -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('regex') ? '' : 'collapsed'}\" data-group=\"regex\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('regex')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-wand-magic-sparkles\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"regex-preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${RegexPresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === RegexPresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-regex-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-execute-regex-now\" title=\"\" style=\"flex:1;height:28px;background:var(--acu-btn-accent, #4a9eff);color:white;\"><i class=\"fa-solid fa-play\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <!--  -->\n                            <div class=\"acu-validation-rules-list\" id=\"regex-rules-list\">\n                                ${RegexTransformationManager.getAllRules()\n                                  .map(rule => {\n                                    const scopeIcon =\n                                      rule.scope.type === 'global'\n                                        ? 'fa-globe'\n                                        : rule.scope.type === 'table'\n                                          ? 'fa-table'\n                                          : 'fa-columns';\n                                    const scopeText =\n                                      rule.scope.type === 'global'\n                                        ? ''\n                                        : rule.scope.type === 'table'\n                                          ? rule.scope.tableNames?.join(',')\n                                          : `${rule.scope.tableNames?.join(',')}.${rule.scope.columnNames?.join(',')}`;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\": ${escapeHtml(rule.scope.type)}\">\n                                            <i class=\"fa-solid ${scopeIcon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\" style=\"font-size:10px;\">${escapeHtml(scopeText)} | ${escapeHtml(rule.operation)}</div>\n                                        </div>\n                                        <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <div style=\"display:flex;gap:8px;margin-top:8px;\">\n                                <button class=\"acu-add-rule-btn\" id=\"btn-add-regex-rule\" style=\"flex:1;\">\n                                    <i class=\"fa-solid fa-plus\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('advanced') ? '' : 'collapsed'}\" data-group=\"advanced\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('advanced')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-sliders-h\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-fire\"></i> </span>\n                                </div>\n                                <select id=\"cfg-crazy-mode\" class=\"acu-setting-select\" style=\"width: 90px; min-width: 90px;\">\n                                    <option value=\"0\"></option>\n                                    <option value=\"25\"></option>\n                                    <option value=\"50\"></option>\n                                    <option value=\"75\"></option>\n                                    <option value=\"100\"></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-dice-d20\"></i> </span>\n                                </div>\n                                <button id=\"cfg-attr-preset-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-filter\"></i> </span>\n                                </div>\n                                <button id=\"cfg-blacklist-manage\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"><i class=\"fa-solid fa-bug\"></i> Debug</span>\n                                </div>\n                                <button id=\"btn-open-debug-console\" class=\"acu-setting-action-btn\" style=\"width: 90px; padding: 6px 12px; font-size: 12px; margin-bottom: 0;\">\n                                    <i class=\"fa-solid fa-terminal\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                </div><!--  .acu-settings-body -->\n            </div>\n        </div>\n    `);\n    $('body').append(dialog);\n\n    // ===  ===\n    dialog.find('.acu-settings-group-title').on('click', function () {\n      const $group = $(this).closest('.acu-settings-group');\n      const $body = $group.find('.acu-settings-group-body');\n\n      // \n      if ($body.hasClass('acu-animating')) return;\n\n      const groupId = $group.data('group');\n      const $chevron = $(this).find('.acu-group-chevron');\n      let expanded = Store.get('acu_settings_expanded', ['appearance']);\n\n      if ($group.hasClass('collapsed')) {\n        // \n        $group.removeClass('collapsed');\n        $chevron.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n        if (!expanded.includes(groupId)) expanded.push(groupId);\n\n        $body.addClass('acu-animating').show();\n        const targetHeight = $body.prop('scrollHeight');\n        $body.css('height', 0).animate({ height: targetHeight }, 180, function () {\n          $(this).css('height', '').removeClass('acu-animating');\n        });\n      } else {\n        // \n        $group.addClass('collapsed');\n        $chevron.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n        expanded = expanded.filter(id => id !== groupId);\n\n        const currentHeight = $body.outerHeight();\n        $body\n          .addClass('acu-animating')\n          .css('height', currentHeight)\n          .animate({ height: 0 }, 180, function () {\n            $(this).hide().css('height', '').removeClass('acu-animating');\n          });\n      }\n\n      Store.set('acu_settings_expanded', expanded);\n    });\n\n    // ===  ===\n    // \n    dialog.find('#cfg-theme').on('change', function () {\n      const newTheme = $(this).val();\n      saveConfig({ theme: newTheme });\n      dialog\n        .find('.acu-edit-dialog')\n        .removeClass(THEMES.map(t => `acu-theme-${t.id}`).join(' '))\n        .addClass(`acu-theme-${newTheme}`);\n\n      // \n      const t = getThemeColors();\n      dialog.find('#cfg-attr-preset-manage').css({\n        background: t.btnBg,\n        borderColor: t.border,\n        color: t.textMain,\n      });\n    });\n\n    // \n    dialog.find('#cfg-font-family').on('change', function () {\n      saveConfig({ fontFamily: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-attr-preset-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showAttributePresetManager();\n    });\n\n    // \n    const initCrazyModeUI = () => {\n      const crazyConfig = getCrazyModeConfig();\n      // enabledcrazyLevel\n      const selectValue = crazyConfig.enabled ? crazyConfig.crazyLevel : 0;\n      dialog.find('#cfg-crazy-mode').val(selectValue);\n\n      // \n      dialog.find('#cfg-crazy-mode').on('change', function () {\n        const value = parseInt($(this).val() as string, 10);\n        if (value === 0) {\n          saveCrazyModeConfig({ enabled: false, crazyLevel: 50 });\n          toastr.info('');\n        } else {\n          saveCrazyModeConfig({ enabled: true, crazyLevel: value });\n        }\n      });\n    };\n    initCrazyModeUI();\n\n    // \n    dialog.find('#cfg-blacklist-manage').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      showBlacklistManagerModal();\n    });\n\n    // \n    dialog.find('#cfg-layout').on('change', function () {\n      saveConfig({ layout: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-grid-cols').on('change', function () {\n      saveConfig({ gridColumns: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-position').on('change', function () {\n      saveConfig({ positionMode: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-action-pos').on('change', function () {\n      saveConfig({ actionsPosition: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-style').on('change', function () {\n      saveConfig({ collapseStyle: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-align').on('change', function () {\n      saveConfig({ collapseAlign: $(this).val() });\n      renderInterface();\n    });\n\n    // \n    dialog.find('#cfg-show-opt').on('change', function () {\n      const checked = $(this).is(':checked');\n      saveConfig({ showOptionPanel: checked });\n      if (checked) dialog.find('#row-auto-send').slideDown(200);\n      else dialog.find('#row-auto-send').slideUp(200);\n      renderInterface();\n    });\n    dialog.find('#cfg-auto-send').on('change', function () {\n      saveConfig({ clickOptionToAutoSend: $(this).is(':checked') });\n    });\n    dialog.find('#cfg-new').on('change', function () {\n      saveConfig({ highlightNew: $(this).is(':checked') });\n      renderInterface();\n    });\n\n    // === / ===\n    dialog.find('.acu-table-item-check').on('click', function (e) {\n      e.stopPropagation();\n      const $item = $(this).closest('.acu-table-manager-item');\n      const tableName = $item.data('table-name');\n      let hiddenList = getHiddenTables();\n      const $icon = $(this).find('i');\n\n      if (hiddenList.includes(tableName)) {\n        // \n        hiddenList = hiddenList.filter(n => n !== tableName);\n        $item.removeClass('hidden-table');\n        $icon.removeClass('fa-eye-slash').addClass('fa-eye');\n      } else {\n        // \n        hiddenList.push(tableName);\n        $item.addClass('hidden-table');\n        $icon.removeClass('fa-eye').addClass('fa-eye-slash');\n      }\n\n      saveHiddenTables(hiddenList);\n      renderInterface();\n    });\n\n    // ===  ===\n    const $list = dialog.find('#table-manager-list');\n    let dragState = {\n      isDragging: false,\n      element: null,\n      timer: null,\n      startY: 0,\n    };\n\n    const clearDragState = () => {\n      if (dragState.timer) {\n        clearTimeout(dragState.timer);\n        dragState.timer = null;\n      }\n      if (dragState.element) {\n        $(dragState.element).removeClass('acu-dragging');\n      }\n      $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n      dragState.isDragging = false;\n      dragState.element = null;\n    };\n\n    const startDrag = $item => {\n      dragState.isDragging = true;\n      dragState.element = $item[0];\n      $item.addClass('acu-dragging');\n    };\n\n    const finishDrag = () => {\n      if (!dragState.isDragging || !dragState.element) {\n        clearDragState();\n        return;\n      }\n\n      const $dragged = $(dragState.element);\n      const $target = $list.find('.acu-drag-above, .acu-drag-below').first();\n\n      if ($target.length && $target[0] !== dragState.element) {\n        if ($target.hasClass('acu-drag-above')) {\n          $dragged.insertBefore($target);\n        } else {\n          $dragged.insertAfter($target);\n        }\n\n        // \n        const newOrder = [];\n        $list.find('.acu-table-manager-item').each(function () {\n          newOrder.push($(this).data('table-name'));\n        });\n        saveTableOrder(newOrder);\n      }\n\n      clearDragState();\n    };\n\n    // \n    $list[0].addEventListener(\n      'pointerdown',\n      function (e) {\n        const handle = e.target.closest('.acu-table-item-handle');\n        if (!handle) return;\n\n        e.preventDefault();\n        const $item = $(handle).closest('.acu-table-manager-item');\n        dragState.startY = e.clientY;\n        startDrag($item);\n        handle.setPointerCapture(e.pointerId);\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerdown', function (e) {\n      const item = e.target.closest('.acu-table-manager-item');\n      if (!item) return;\n      // \n      if (e.target.closest('.acu-table-item-check, .acu-table-item-handle')) return;\n\n      dragState.startY = e.clientY;\n      const $item = $(item);\n\n      dragState.timer = setTimeout(() => {\n        startDrag($item);\n      }, 350);\n    });\n\n    // \n    $list[0].addEventListener(\n      'pointermove',\n      function (e) {\n        // \n        if (dragState.timer && Math.abs(e.clientY - dragState.startY) > 8) {\n          clearTimeout(dragState.timer);\n          dragState.timer = null;\n        }\n\n        if (!dragState.isDragging || !dragState.element) return;\n        e.preventDefault();\n\n        // \n        const items = $list.find('.acu-table-manager-item').not('.acu-dragging');\n        let targetItem = null;\n        let insertBefore = true;\n\n        items.each(function () {\n          const rect = this.getBoundingClientRect();\n          const midY = rect.top + rect.height / 2;\n\n          if (e.clientY < midY && !targetItem) {\n            targetItem = this;\n            insertBefore = true;\n          } else if (e.clientY >= rect.top && e.clientY <= rect.bottom) {\n            targetItem = this;\n            insertBefore = e.clientY < midY;\n          }\n        });\n\n        // \n        $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n        if (targetItem && targetItem !== dragState.element) {\n          $(targetItem).addClass(insertBefore ? 'acu-drag-above' : 'acu-drag-below');\n        }\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerup', finishDrag);\n    $list[0].addEventListener('pointercancel', clearDragState);\n\n    // \n    $list[0].addEventListener(\n      'touchmove',\n      function (e) {\n        if (dragState.isDragging) {\n          e.preventDefault();\n        }\n      },\n      { passive: false },\n    );\n\n    // === Stepper  ===\n    dialog.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        const unit = id === 'cfg-per-page' ? '' : 'px';\n        $value.text(newVal + unit);\n\n        // \n        if (id === 'cfg-width') {\n          $('.acu-wrapper').css('--acu-card-width', newVal + 'px');\n          saveConfig({ cardWidth: newVal });\n        } else if (id === 'cfg-font-main') {\n          $('.acu-wrapper').css('--acu-font-size', newVal + 'px');\n          saveConfig({ fontSize: newVal });\n        } else if (id === 'cfg-font-opt') {\n          $('.acu-wrapper, .acu-embedded-options-container').css('--acu-opt-font-size', newVal + 'px');\n          saveConfig({ optionFontSize: newVal });\n        } else if (id === 'cfg-per-page') {\n          saveConfig({ itemsPerPage: newVal });\n        }\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    // === /===\n    dialog.on('click', '.acu-rule-toggle', function (e) {\n      e.stopPropagation();\n      const $toggle = $(this);\n      const $item = $toggle.closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const $icon = $toggle.find('i');\n      const isCurrentlyActive = $toggle.hasClass('active');\n\n      // \n      ValidationRuleManager.toggleRuleEnabled(ruleId, !isCurrentlyActive);\n\n      //  UI\n      if (isCurrentlyActive) {\n        $toggle.removeClass('active');\n        $icon.removeClass('fa-toggle-on').addClass('fa-toggle-off');\n        $item.addClass('disabled');\n      } else {\n        $toggle.addClass('active');\n        $icon.removeClass('fa-toggle-off').addClass('fa-toggle-on');\n        $item.removeClass('disabled');\n      }\n    });\n\n    // ===  ===\n    dialog.on('click', '#validation-rules-list .acu-rule-edit', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const rule = ValidationRuleManager.getRule(ruleId);\n      if (!rule) return;\n\n      // \n      showAddValidationRuleModal(dialog, ruleId);\n    });\n\n    // === ===\n    dialog.on('click', '#validation-rules-list .acu-rule-delete', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const $item = $(this).closest('.acu-validation-rule-item');\n\n      if (confirm('')) {\n        if (ValidationRuleManager.removeCustomRule(ruleId)) {\n          $item.fadeOut(200, function () {\n            $(this).remove();\n          });\n        }\n      }\n    });\n\n    // === ===\n    dialog.on('click', '.acu-rule-intercept', function (e) {\n      e.stopPropagation();\n      const $btn = $(this);\n      const ruleId = $btn.data('rule-id');\n      const isCurrentlyActive = $btn.hasClass('active');\n\n      if (ValidationRuleManager.toggleRuleIntercept(ruleId, !isCurrentlyActive)) {\n        if (isCurrentlyActive) {\n          $btn.removeClass('active').attr('title', '');\n        } else {\n          $btn.addClass('active').attr('title', '');\n        }\n      }\n    });\n\n    // ===  ===\n    const refreshPresetUI = () => {\n      ValidationRuleManager.clearCache();\n      const rules = ValidationRuleManager.getAllRules();\n      let html = '';\n      rules.forEach(rule => {\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType] || { name: rule.ruleType, icon: 'fa-question' };\n        const isTableRule = typeInfo.scope === 'table';\n        const hasIntercept = rule.intercept;\n        html += `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo.icon}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n            </div>\n            <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <button class=\"acu-rule-edit\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\" style=\"background:none;border:none;color:var(--text-sub);cursor:pointer;padding:4px;opacity:0.6;transition:all 0.2s;flex-shrink:0;\"><i class=\"fa-solid fa-pen\"></i></button>\n            <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n              <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>`;\n      });\n      dialog.find('#validation-rules-list').html(html);\n    };\n\n    // \n    dialog.find('#preset-select').on('change', function () {\n      if (PresetManager.setActivePreset($(this).val())) {\n        refreshPresetUI();\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-dup').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const newPreset = PresetManager.duplicatePreset(preset.id);\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-new').on('click', function () {\n      const name = prompt(':', '');\n      if (!name?.trim()) return;\n      const newPreset = PresetManager.createPreset(name.trim());\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-del').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      if (preset.id === 'default') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!confirm(`\"${preset.name}\"`)) return;\n      if (PresetManager.deletePreset(preset.id)) {\n        dialog.find(`#preset-select option[value=\"${preset.id}\"]`).remove();\n        dialog.find('#preset-select').val('default').trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-export').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const json = PresetManager.exportPreset(preset.id);\n      if (json) {\n        // \n        try {\n          const filename = `acu_validation_preset_${preset.name || preset.id}_${Date.now()}.json`;\n          const blob = new Blob([json], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = filename;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n        } catch (e) {\n          //  Blob /\n          navigator.clipboard\n            .writeText(json)\n            .then(() => {})\n            .catch(() => {\n              prompt(':', json);\n            });\n        }\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-import').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const json = await file.text();\n          if (!json?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(json.trim());\n          } catch {\n            if (window.toastr) window.toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.preset?.name || '';\n          const existingPresets = PresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = json.trim();\n            if (newName && parsedData?.preset) {\n              parsedData.preset.name = newName;\n              // IDID\n              parsedData.preset.id = `preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset && existingPreset.id !== 'default') {\n                PresetManager.deletePreset(existingPreset.id);\n                dialog.find(`#preset-select option[value=\"${existingPreset.id}\"]`).remove();\n              }\n            }\n\n            const result = PresetManager.importPreset(finalJson, false);\n            if (result && result.preset) {\n              const newPreset = result.preset;\n              dialog\n                .find('#preset-select')\n                .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n              dialog.find('#preset-select').val(newPreset.id).trigger('change');\n\n              // \n              if (result.needsMerge) {\n                if (\n                  confirm(\n                    '\\n\\n',\n                  )\n                ) {\n                  if (PresetManager.mergePresetWithDefaults(newPreset.id)) {\n                    refreshPresetUI();\n                  } else {\n                    if (window.toastr) window.toastr.error('');\n                  }\n                }\n              }\n            } else {\n              if (window.toastr) window.toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          console.error('[DICE]PresetManager :', err);\n          if (window.toastr) window.toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // \n    dialog.find('#btn-preset-reset').on('click', function () {\n      if (!confirm('\\n')) return;\n      if (PresetManager.resetDefaultPreset()) {\n        // \n        if (PresetManager.getActivePreset()?.id === 'default') {\n          refreshPresetUI();\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // === :/ ===\n    dialog.on('click', '#regex-rules-list .acu-rule-toggle', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const currentState = RegexTransformationManager.getAllRules().find(r => r.id === ruleId)?.enabled;\n      const newState = !currentState;\n      const rule = RegexTransformationManager.getRule(ruleId);\n\n      RegexTransformationManager.toggleRuleEnabled(ruleId, newState);\n\n      if (newState) {\n      } else {\n        toastr.info('');\n      }\n\n      refreshRegexRulesList(); // [] ,\n    });\n\n    // ===  ===\n    dialog.on('click', '#regex-rules-list .acu-rule-edit', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const rule = RegexTransformationManager.getRule(ruleId);\n      if (!rule) return;\n\n      // \n      showAddRegexRuleModal(ruleId);\n    });\n\n    // === : ===\n    dialog.on('click', '#regex-rules-list .acu-rule-delete', function () {\n      const $item = $(this).closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const rule = RegexTransformationManager.getRule(ruleId);\n      if (!rule) return;\n\n      if (confirm(`\"${rule.name}\"`)) {\n        RegexTransformationManager.removeRule(ruleId);\n        refreshRegexRulesList(); // [] ,\n      }\n    });\n\n    // === : ===\n    dialog.find('#regex-preset-select').on('change', function () {\n      const presetId = $(this).val();\n      RegexPresetManager.setActivePreset(String(presetId));\n\n      refreshRegexRulesList(); // [] ,\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-dup').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      const name = prompt(':', `${currentPreset.name} ()`);\n      if (!name) return;\n\n      const newPreset = RegexPresetManager.createPreset(name, currentPreset.id);\n      if (newPreset) {\n        // [] \n        const $presetSelect = dialog.find('#regex-preset-select');\n        $presetSelect.append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        $presetSelect.val(newPreset.id);\n\n        refreshRegexRulesList(); // \n      } else {\n        toastr.error('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-new').on('click', function () {\n      const name = prompt(':');\n      if (!name) return;\n\n      const newPreset = RegexPresetManager.createPreset(name, null);\n      if (newPreset) {\n        RegexPresetManager.setActivePreset(newPreset.id);\n\n        // [] \n        const $presetSelect = dialog.find('#regex-preset-select');\n        $presetSelect.append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        $presetSelect.val(newPreset.id);\n\n        refreshRegexRulesList(); // \n      } else {\n        toastr.error('');\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-regex-preset-del').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      if (confirm(`\"${currentPreset.name}\"`)) {\n        const success = RegexPresetManager.deletePreset(currentPreset.id);\n        if (success) {\n          // [] \n          const $presetSelect = dialog.find('#regex-preset-select');\n          $presetSelect.find(`option[value=\"${currentPreset.id}\"]`).remove();\n\n          // \n          const defaultPresetId = RegexPresetManager.getActivePreset()?.id;\n          if (defaultPresetId) {\n            $presetSelect.val(defaultPresetId);\n          }\n\n          refreshRegexRulesList(); // \n        } else {\n          toastr.error('');\n        }\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-export').on('click', function () {\n      const currentPreset = RegexPresetManager.getActivePreset();\n      if (!currentPreset) return;\n\n      const json = RegexPresetManager.exportPreset(currentPreset.id);\n      if (json) {\n        const blob = new Blob([json], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `regex-preset-${currentPreset.name}-${Date.now()}.json`;\n        a.click();\n        URL.revokeObjectURL(url);\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-regex-preset-import').on('click', function () {\n      const input = document.createElement('input');\n      input.type = 'file';\n      input.accept = '.json,application/json';\n      input.onchange = async e => {\n        const file = (e.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        try {\n          const text = await file.text();\n          if (!text?.trim()) return;\n\n          // JSON\n          let parsedData;\n          try {\n            parsedData = JSON.parse(text.trim());\n          } catch {\n            toastr.error('JSON');\n            return;\n          }\n\n          const importingName = parsedData?.name || '';\n          const existingPresets = RegexPresetManager.getAllPresets();\n          const existingNames = existingPresets.map(p => p.name);\n          const hasConflict = existingNames.includes(importingName);\n\n          // \n          const doImport = (overwrite: boolean, newName?: string) => {\n            // JSON\n            let finalJson = text.trim();\n            if (newName) {\n              parsedData.name = newName;\n              // IDID\n              parsedData.id = `regex_preset_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n              finalJson = JSON.stringify(parsedData);\n            }\n\n            // \n            if (overwrite && hasConflict) {\n              const existingPreset = existingPresets.find(p => p.name === importingName);\n              if (existingPreset) {\n                // \n                if (existingPresets.length > 1) {\n                  RegexPresetManager.deletePreset(existingPreset.id);\n                  dialog.find(`#regex-preset-select option[value=\"${existingPreset.id}\"]`).remove();\n                }\n              }\n            }\n\n            const preset = RegexPresetManager.importPreset(finalJson);\n            if (preset) {\n              // [] \n              const $presetSelect = dialog.find('#regex-preset-select');\n              $presetSelect.append(`<option value=\"${escapeHtml(preset.id)}\">${escapeHtml(preset.name)}</option>`);\n              $presetSelect.val(preset.id);\n\n              refreshRegexRulesList(); // \n            } else {\n              toastr.error('');\n            }\n          };\n\n          // \n          if (hasConflict) {\n            showPresetConflictDialog({\n              presetName: importingName,\n              presetType: '',\n              existingNames,\n              onOverwrite: () => doImport(true),\n              onRename: newName => doImport(false, newName),\n              onCancel: () => {},\n            });\n          } else {\n            // \n            doImport(false);\n          }\n        } catch (err) {\n          toastr.error(': ' + (err as Error).message);\n        }\n      };\n      input.click();\n    });\n\n    // === : ===\n    dialog.find('#btn-add-regex-rule').on('click', function () {\n      showAddRegexRuleModal();\n    });\n\n    // === [] : ===\n    dialog.find('#btn-execute-regex-now').on('click', async function () {\n      const $btn = $(this);\n      const originalHtml = $btn.html();\n\n      try {\n        // \n        $btn.prop('disabled', true).html('<i class=\"fa-solid fa-spinner fa-spin\"></i> ...');\n\n        // \n        let tableData = cachedRawData || getTableData();\n\n        if (!tableData) {\n          toastr.error('');\n          return;\n        }\n\n        // \n        if (typeof tableData !== 'object' || Array.isArray(tableData)) {\n          toastr.error('');\n          console.error('[DICE]:', typeof tableData, Array.isArray(tableData));\n          return;\n        }\n\n        // \n        const enabledRules = RegexTransformationManager.getEnabledRules();\n\n        if (enabledRules.length === 0) {\n          toastr.warning('');\n          return;\n        }\n\n        console.info(`[DICE] ${enabledRules.length} ...`);\n\n        // \n        const { totalApplied, errors } = RegexTransformationEngine.applyToTable(tableData, enabledRules);\n\n        // \n        cachedRawData = tableData;\n\n        // \n        await saveDataToDatabase(tableData, false, false);\n\n        if (errors.length > 0) {\n          toastr.warning(` ${totalApplied} ${errors.length} `);\n          console.warn('[DICE]:', errors);\n        } else {\n        }\n\n        console.info('[DICE]');\n      } catch (e) {\n        const errorMsg = e instanceof Error ? e.message : String(e);\n        console.error('[DICE]:', e);\n        toastr.error(`: ${errorMsg}`);\n      } finally {\n        // \n        $btn.prop('disabled', false).html(originalHtml);\n      }\n    });\n\n    // === : ===\n    dialog.find('#btn-add-validation-rule').on('click', function () {\n      showAddValidationRuleModal(dialog);\n    });\n\n    // === Debug ===\n    dialog.find('#btn-open-debug-console').on('click', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      dialog.remove();\n      isSettingsOpen = false;\n      showDebugConsoleModal();\n    });\n\n    // ===  ===\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n      renderInterface();\n    };\n    dialog.on('click', '#dlg-close-x, .acu-settings-header .acu-close-btn', closeDialog);\n\n    // \n    dialog.on('click', '#acu-help-btn', function (e) {\n      e.stopPropagation();\n      window.open('https://jerryzmtz.github.io/DiceSystemManual//', '_blank');\n    });\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n  };\n\n  // [] \n  let renderInterfaceTimer = null;\n  let renderInterfacePending = false;\n\n  const renderInterface = () => {\n    // \n    if (isSettingsOpen) {\n      if (!renderInterfacePending) {\n        console.info('[DICE]');\n        renderInterfacePending = true;\n      }\n      return;\n    }\n\n    // \n    if (renderInterfaceTimer) {\n      clearTimeout(renderInterfaceTimer);\n    }\n\n    // 50ms\n    renderInterfaceTimer = setTimeout(() => {\n      renderInterfaceTimer = null;\n      renderInterfacePending = false;\n      _renderInterfaceImpl();\n    }, 50);\n  };\n\n  // \n  const _renderInterfaceImpl = () => {\n    console.info('[DICE]...');\n    const { $ } = getCore();\n\n    // [] Observer  ()\n    if (!observer && $('#chat').length) {\n      const $chat = $('#chat');\n      let mutationLock = false;\n      const handleMutation = () => {\n        if (mutationLock) return;\n        mutationLock = true;\n        requestAnimationFrame(() => {\n          const config = getConfig();\n          if (config.positionMode === 'embedded') {\n            mutationLock = false;\n            return;\n          }\n          const children = $chat.children();\n          const lastChild = children.last()[0];\n          const wrapper = $('.acu-wrapper')[0];\n          if (wrapper && lastChild && lastChild !== wrapper) {\n            if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n              $chat.append(wrapper);\n            }\n          }\n\n          // [] \n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            // 1\n            const children = $chat.children();\n            const lastChild = children.last();\n            if (lastChild.hasClass('mes') || lastChild.hasClass('message-body')) {\n              lastChild.addClass('acu-dice-result-revealing');\n            }\n\n            // 2RAF\n            requestAnimationFrame(() => {\n              hideDiceResultsInUserMessages();\n\n              // 3\n              requestAnimationFrame(() => {\n                lastChild.removeClass('acu-dice-result-revealing').addClass('acu-dice-result-revealed');\n                // \n                setTimeout(() => {\n                  lastChild.removeClass('acu-dice-result-revealed');\n                }, 200);\n              });\n            });\n          }\n\n          mutationLock = false;\n        });\n      };\n      observer = new MutationObserver(handleMutation);\n      observer.observe($chat[0], { childList: true });\n    }\n    let rawData;\n    let isDataFromDatabase = false; // \n    if (hasUnsavedChanges && cachedRawData) {\n      rawData = cachedRawData;\n    } else {\n      rawData = getTableData();\n      isDataFromDatabase = true; // \n\n      // [] \n      if (rawData) {\n        let anyLockApplied = false;\n        for (const sheetId in rawData) {\n          if (!sheetId.startsWith('sheet_')) continue;\n          const sheet = rawData[sheetId];\n          if (!sheet || !sheet.name || !sheet.content) continue;\n\n          const result = LockManager.applyLocks(sheet.name, sheet.content);\n          if (result.modified) {\n            anyLockApplied = true;\n          }\n          if (result.restored.length > 0) {\n          }\n        }\n        if (anyLockApplied) {\n        }\n      }\n\n      // [] auto\n      // \n      // \n      if (rawData && !isAutoTransforming && isDataFromDatabase) {\n        try {\n          const enabledRules = RegexTransformationManager.getEnabledRules();\n\n          if (enabledRules.length > 0) {\n            console.info(`[DICE] ${enabledRules.length} ...`);\n\n            isAutoTransforming = true; // \n            const transformResult = RegexTransformationEngine.applyToTable(rawData, enabledRules);\n            if (transformResult.totalApplied > 0) {\n              console.info(`[DICE] ${transformResult.totalApplied} `);\n\n              // \n              //  saveDataOnly \n              // saveDataOnly  UpdateController.handleUpdate() isAutoTransforming \n              // \n              saveDataOnly(rawData).catch(err => {\n                console.warn('[DICE]:', err);\n              });\n            }\n            if (transformResult.errors.length > 0) {\n              console.warn(`[DICE] ${transformResult.errors.length} :`, transformResult.errors);\n            } else if (transformResult.totalApplied === 0) {\n              console.info('[DICE]');\n            }\n            isAutoTransforming = false; // \n          } else {\n            isAutoTransforming = false; // \n          }\n        } catch (transformError) {\n          isAutoTransforming = false; // \n          const errorMsg = transformError instanceof Error ? transformError.message : String(transformError);\n          console.error('[DICE]:', transformError);\n        }\n      }\n\n      if (rawData) {\n        cachedRawData =\n          typeof structuredClone === 'function' ? structuredClone(rawData) : JSON.parse(JSON.stringify(rawData));\n\n        const existingSnapshot = loadSnapshot();\n        const currentCtx = getCurrentContextFingerprint();\n\n        // \n        const hasValidSnapshotData =\n          existingSnapshot && Object.keys(existingSnapshot).some(k => k.startsWith('sheet_'));\n\n        if (!existingSnapshot || !hasValidSnapshotData) {\n          // 1    \n          saveSnapshot({ ...cachedRawData, _contextId: currentCtx });\n        } else if (!existingSnapshot._contextId) {\n          // 2 ID \n          saveSnapshot({ ...existingSnapshot, _contextId: currentCtx });\n        } else if (existingSnapshot._contextId !== currentCtx) {\n          // 3  \n          cachedRawData._contextId = currentCtx;\n          saveSnapshot(cachedRawData);\n        }\n        // 4  \n      }\n    }\n\n    const $searchInput = $('.acu-search-input');\n    if ($('.acu-wrapper').length && $searchInput.is(':focus')) {\n      if (rawData) {\n        if (!isSaving) currentDiffMap = generateDiffMap(rawData);\n        const tables = processJsonData(rawData);\n        const activeTab = getActiveTabState();\n        const currentTabName = activeTab && tables[activeTab] ? activeTab : null;\n\n        if (currentTabName && tables[currentTabName]) {\n          const newHtml = renderTableContent(tables[currentTabName], currentTabName);\n          const $virtualDom = $('<div>').html(newHtml);\n          $('.acu-card-grid').replaceWith($virtualDom.find('.acu-card-grid'));\n          $('.acu-panel-title').html($virtualDom.find('.acu-panel-title').html());\n          // [] \n          bindEvents(tables);\n          bindOptionEvents(); // <--- \n          return;\n        }\n      }\n    }\n\n    let lastScrollX = 0;\n    let lastScrollY = 0;\n\n    const $oldContent = $('.acu-panel-content');\n    if ($oldContent.length) {\n      lastScrollX = $oldContent.scrollLeft();\n      lastScrollY = $oldContent.scrollTop();\n    }\n\n    $('.acu-wrapper').remove();\n    const tables = processJsonData(rawData || {});\n\n    if (isSaving) {\n      currentDiffMap = new Set();\n    } else {\n      currentDiffMap = generateDiffMap(rawData);\n    }\n\n    const savedOrder = getSavedTableOrder();\n    let orderedNames = Object.keys(tables);\n    if (savedOrder)\n      orderedNames = savedOrder.filter(n => tables[n]).concat(orderedNames.filter(n => !savedOrder.includes(n)));\n\n    const hiddenList = getHiddenTables();\n    orderedNames = orderedNames.filter(n => !hiddenList.includes(n));\n\n    const activeTab = getActiveTabState();\n    let currentTabName = activeTab && tables[activeTab] && !hiddenList.includes(activeTab) ? activeTab : null;\n\n    const config = getConfig();\n    const isCollapsed = getCollapsedState();\n\n    const layoutClass = config.layout === 'vertical' ? 'acu-layout-vertical' : '';\n    // []  (/)\n    const positionClass = `acu-mode-${config.positionMode || 'fixed'}`;\n\n    // []  () \n    let finalGridCols = config.gridColumns;\n    if (finalGridCols === 'auto') {\n      const n = orderedNames.length;\n\n      if (n <= 4) {\n        finalGridCols = n < 2 ? 2 : n;\n      } else {\n        const empty3 = Math.ceil(n / 3) * 3 - n;\n        const empty4 = Math.ceil(n / 4) * 4 - n;\n        finalGridCols = empty4 <= empty3 ? 4 : 3;\n      }\n    }\n\n    // --- []  +  ---\n    let optionHtml = '';\n    let currentOptionHash = null; // \n\n    if (config.showOptionPanel !== false) {\n      const optionTables = [];\n      Object.keys(tables).forEach(k => {\n        if (k.includes('')) optionTables.push(tables[k]);\n      });\n\n      // []  - \n      if (optionTables.length > 0) {\n        const isOptionsCollapsed = getOptionsCollapsedState();\n        const collapseIcon = isOptionsCollapsed ? 'fa-chevron-right' : 'fa-chevron-down';\n        const collapseText = isOptionsCollapsed ? '' : '';\n        const collapsedClass = isOptionsCollapsed ? 'collapsed' : '';\n\n        let optionCount = 0;\n        let hasBtns = false;\n        // []\n        let optionValues = []; // \n\n        // \n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  optionCount++;\n                }\n              });\n            });\n          }\n        });\n\n        // \n        let buttonsHtml = `\n                    <div class=\"acu-opt-header\" data-action=\"toggle-options\">\n                        <span>\n                            <i class=\"fa-solid ${collapseIcon}\" style=\"margin-right:6px;font-size:10px;\"></i>\n                             (${optionCount})\n                        </span>\n                    </div>`;\n\n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  const cellStr = String(cell).trim();\n                  buttonsHtml += `<button class=\"acu-opt-btn\" data-val=\"${encodeURIComponent(cellStr)}\">${escapeHtml(cellStr)}</button>`;\n                  optionValues.push(cellStr);\n                  hasBtns = true;\n                }\n              });\n            });\n          }\n        });\n\n        if (hasBtns) {\n          optionHtml = `<div class=\"acu-option-panel ${collapsedClass}\">${buttonsHtml}</div>`;\n          //  ()\n          // [] \n          currentOptionHash = optionValues.join('|||') + (isOptionsCollapsed ? '_collapsed' : '_expanded');\n        }\n      }\n    }\n\n    // [] \n    const optionChanged = currentOptionHash !== lastOptionHash;\n    if (optionChanged && currentOptionHash !== null) {\n      // \n      optionPanelVisible = true;\n    }\n    lastOptionHash = currentOptionHash; // \n\n    let html = `<div class=\"acu-wrapper ${positionClass} acu-theme-${config.theme} ${layoutClass}\" style=\"--acu-card-width:${config.cardWidth}px; --acu-font-size:${config.fontSize}px; --acu-opt-font-size:${config.optionFontSize || 12}px; --acu-grid-cols:${finalGridCols}\">`;\n\n    // []  DOM  column-reverse\n    // []  optionPanelVisible \n    if (config.positionMode === 'embedded' && optionHtml && optionPanelVisible) {\n      html += optionHtml;\n    }\n\n    if (isCollapsed) {\n      const colStyleClass = `acu-col-${config.collapseStyle || 'bar'}`;\n      const alignClass = `acu-align-${config.collapseAlign || 'right'}`;\n      html += `\n                <div class=\"acu-expand-trigger ${colStyleClass} ${alignClass}\" id=\"acu-btn-expand\">\n                    <i class=\"fa-solid fa-table\"></i> <span> (${Object.keys(tables).length})</span>\n                </div>\n            `;\n    } else {\n      // [] \n      const savedHeight = currentTabName ? getTableHeights()[currentTabName] : null;\n      // [] \n      const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n      const isChangesPanelActive = Store.get('acu_changes_panel_active', false);\n      const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n      const mvuSavedHeight = isMvuActive ? getTableHeights()[MvuModule.MODULE_ID] : null;\n      const finalSavedHeight = mvuSavedHeight || savedHeight;\n      const shouldShowPanel = isDashboardActive || isChangesPanelActive || isMvuActive || currentTabName;\n\n      html += `\n                <div class=\"acu-data-display ${shouldShowPanel ? 'visible' : ''} ${finalSavedHeight ? 'acu-manual-mode' : ''}\" id=\"acu-data-area\" style=\"${finalSavedHeight ? 'height:' + finalSavedHeight + 'px;' : ''}\">\n                    ${\n                      isChangesPanelActive\n                        ? renderChangesPanel(rawData)\n                        : isDashboardActive\n                          ? renderDashboard(tables)\n                          : isMvuActive\n                            ? '<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>'\n                            : currentTabName\n                              ? renderTableContent(tables[currentTabName], currentTabName)\n                              : ''\n                    }\n                </div>\n                `;\n\n      // [] \n      // PC(>768px) CSS display:flex !important grid \n      const gridFixStyle = `grid-template-columns: repeat(${finalGridCols}, 1fr);`;\n\n      html += `\n                <div class=\"acu-nav-container ${config.actionsPosition === 'top' ? 'acu-pos-top' : ''}\" id=\"acu-nav-bar\" style=\"${gridFixStyle}\">\n                    <div class=\"acu-order-controls\" id=\"acu-order-hint\"><i class=\"fa-solid fa-arrows-alt\"></i> </div>\n            `;\n\n      // ===  +  ===\n      const isChangesActive = Store.get('acu_changes_panel_active', false);\n      const isSimpleModeNav = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n      let changesCount = 0;\n      let validationErrorCount = 0;\n      if (rawData) {\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          for (const sheetId in rawData) {\n            if (!sheetId.startsWith('sheet_')) continue;\n            const newSheet = rawData[sheetId];\n            const oldSheet = snapshot[sheetId];\n            if (!newSheet?.content) continue;\n            const newRows = newSheet.content.slice(1);\n            const oldRows = oldSheet?.content?.slice(1) || [];\n            newRows.forEach((row, rowIdx) => {\n              const oldRow = oldRows[rowIdx];\n              if (!oldRow) {\n                changesCount++;\n                return;\n              }\n              row.forEach((cell, colIdx) => {\n                if (colIdx === 0) return;\n                if (String(cell ?? '') !== String(oldRow[colIdx] ?? '')) changesCount++;\n              });\n            });\n            if (oldRows.length > newRows.length) changesCount += oldRows.length - newRows.length;\n          }\n          for (const sheetId in snapshot) {\n            if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n          }\n        }\n        // \n        validationErrorCount = ValidationEngine.getErrorCount(rawData);\n      }\n      // \n      const isValidationMode = isSimpleModeNav;\n      const displayCount = isValidationMode ? validationErrorCount : changesCount;\n      // \n      const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n      // ===  ===\n      const navHiddenList = getHiddenTables();\n      const navSavedOrder = getSavedTableOrder() || [];\n\n      //  + \n      const SPECIAL_NAV_ITEMS = [\n        { key: '__dice__', icon: 'fa-dice-d20', label: '', id: 'acu-btn-dice-nav', extraClass: 'acu-dice-nav-btn' },\n        {\n          key: '__changes__',\n          icon: 'fa-code-compare',\n          label: `${displayCount > 0 ? '(' + displayCount + ')' : ''}`,\n          id: 'acu-btn-changes',\n          extraClass: `acu-changes-btn${showWarningIcon ? ' has-validation-errors' : ''}`,\n          isActive: isChangesActive,\n          warningIcon: showWarningIcon,\n        },\n        {\n          key: '__mvu__',\n          icon: 'fa-code-branch',\n          label: '',\n          id: 'acu-btn-mvu',\n          extraClass: 'acu-mvu-btn',\n          isActive: getActiveTabState() === MvuModule.MODULE_ID,\n        },\n      ];\n\n      // \n      let allNavItems = [];\n\n      // \n      SPECIAL_NAV_ITEMS.forEach(item => {\n        // \n        if (navHiddenList.includes(item.key)) return;\n\n        // MVU\n        if (item.key === '__mvu__') {\n          allNavItems.push({ ...item, isSpecial: true });\n          return;\n        }\n\n        // checkAvailable\n        if (item.checkAvailable && !item.checkAvailable()) return;\n        allNavItems.push({ ...item, isSpecial: true });\n      });\n\n      // \n      orderedNames.forEach(name => {\n        allNavItems.push({\n          key: name,\n          icon: getIconForTableName(name),\n          label: name,\n          isSpecial: false,\n          isActive: !isDashboardActive && !isChangesActive && currentTabName === name,\n        });\n      });\n\n      // \n      if (navSavedOrder.length > 0) {\n        const orderMap = new Map(navSavedOrder.map((k, i) => [k, i]));\n        allNavItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      // [] /\n      // order  1  Grid \n      html += `<button class=\"acu-nav-btn acu-dashboard-btn ${isDashboardActive ? 'active' : ''}\" id=\"acu-btn-dashboard\" style=\"order: 1;\">\n                <i class=\"fa-solid fa-chart-line\"></i><span></span>\n            </button>`;\n\n      // order  2 \n      allNavItems.forEach((item, idx) => {\n        const activeClass = item.isActive ? 'active' : '';\n        const extraClass = item.extraClass || '';\n        const orderVal = idx + 2; //  2  1\n\n        if (item.isSpecial) {\n          // \n          const warningIconHtml = item.warningIcon\n            ? '<i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>'\n            : '';\n          html += `<button class=\"acu-nav-btn ${extraClass} ${activeClass}\" id=\"${item.id}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>${warningIconHtml}\n                    </button>`;\n        } else {\n          // \n          html += `<button class=\"acu-nav-btn ${activeClass}\" data-table=\"${escapeHtml(item.key)}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>\n                    </button>`;\n        }\n      });\n      // order \n      html += `<div class=\"acu-actions-group\" id=\"acu-active-actions\" style=\"order: 9999;\">`;\n      ACTION_BUTTONS.forEach(btn => {\n        html += `<button class=\"acu-action-btn\" id=\"${btn.id}\" title=\"${btn.title}\"><i class=\"fa-solid ${btn.icon}\"></i></button>`;\n      });\n      html += `</div>`;\n\n      html += `</div>`; //  acu-nav-container\n    }\n\n    html += `</div>`; //  acu-wrapper\n\n    const $existing = $('.acu-wrapper');\n    if ($existing.length) {\n      $existing.replaceWith(html);\n    } else {\n      insertHtmlToPage(html);\n    }\n\n    // --- []  ---\n    if (config.positionMode !== 'embedded' && optionHtml && optionPanelVisible) {\n      if (optionChanged) {\n        //  AI \n        injectIndependentOptions(optionHtml);\n      } else {\n        // \n        const $existing = $('.acu-embedded-options-container');\n        if ($existing.length === 0) {\n          // \n          injectIndependentOptions(optionHtml);\n        }\n        // \n      }\n    } else if (config.positionMode !== 'embedded') {\n      // \n      $('.acu-embedded-options-container').remove();\n    } else {\n      // [] \n      $('.acu-embedded-options-container').remove();\n    }\n\n    bindEvents(tables);\n    bindOptionEvents();\n    updateSaveButtonState();\n    // [] \n    if (Store.get('acu_changes_panel_active', false)) {\n      bindChangesEvents();\n    }\n    // [] \n    if (getActiveTabState() === MvuModule.MODULE_ID) {\n      const $panel = $('#acu-data-area');\n      if ($panel.length) {\n        // \n        // \n        // \n        $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n        MvuModule.bindEvents($panel);\n\n        // \n        MvuModule.getDataWithRetry(5, 800)\n          .then(mvuData => {\n            // \n            if (mvuData) {\n              $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n              MvuModule.bindEvents($panel);\n            }\n          })\n          .catch(err => {\n            console.error('[DICE]MvuModule Error getting data:', err);\n            // \n            $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n            MvuModule.bindEvents($panel);\n          });\n      }\n    }\n\n    setTimeout(() => {\n      const $newContent = $('.acu-panel-content');\n      const activeTab = getActiveTabState();\n      const savedState = tableScrollStates[activeTab];\n\n      if ($newContent.length) {\n        // 1. \n        //  savedState () lastScrollY ()\n        if (savedState) {\n          $newContent.scrollTop(savedState.top);\n          $newContent.scrollLeft(savedState.left);\n        } else {\n          if (lastScrollY > 0) $newContent.scrollTop(lastScrollY);\n          if (lastScrollX > 0) $newContent.scrollLeft(lastScrollX);\n        }\n\n        // 2.  ()\n        if (savedState && savedState.inner) {\n          Object.keys(savedState.inner).forEach(key => {\n            const scrollTop = savedState.inner[key];\n            // \n            const $targetTitle = $newContent.find(`.acu-editable-title[data-row=\"${key}\"]`);\n            if ($targetTitle.length) {\n              const $card = $targetTitle.closest('.acu-data-card');\n              //  ( overflow on card)\n              $card.scrollTop(scrollTop);\n              //  body  ( overflow on body)\n              $card.find('.acu-card-body').scrollTop(scrollTop);\n            }\n          });\n        }\n      }\n    }, 0);\n    console.info('[DICE]');\n  };\n\n  // [] \n  const injectIndependentOptions = htmlContent => {\n    const { $ } = getCore();\n    $('.acu-embedded-options-container').remove();\n\n    //  AI \n    const getTargetContainer = () => {\n      const $allMes = $('#chat .mes');\n      const $aiMes = $allMes.filter(function () {\n        const $this = $(this);\n        if ($this.attr('is_user') === 'true' || $this.attr('is_system') === 'true' || $this.hasClass('sys_mes'))\n          return false;\n        //  data-is-system \n        if ($this.find('.name_text').text().trim() === 'System' || $this.attr('data-is-system') === 'true')\n          return false;\n        // [] \n        if ($this.find('.mes_text').length === 0) return false;\n        if ($this.css('display') === 'none') return false;\n        return true;\n      });\n      if ($aiMes.length === 0) return null;\n\n      const $targetMes = $aiMes.last();\n      // []  .mes_text  .mes_block\n      const $targetText = $targetMes.find('.mes_text');\n      return $targetText.length ? $targetText : $targetMes;\n    };\n\n    const $target = getTargetContainer();\n    if ($target && $target.length) {\n      const optConfig = getConfig();\n      const $container = $(\n        `<div class=\"acu-embedded-options-container acu-theme-${optConfig.theme}\" style=\"--acu-opt-font-size:${optConfig.optionFontSize || 12}px;\"></div>`,\n      );\n      $container.html(htmlContent);\n      $target.append($container);\n    }\n  };\n\n  // []  ( + )\n  const bindOptionEvents = () => {\n    const { $ } = getCore();\n    //  Body \n    $('body')\n      .off('click.acu_opt')\n      .on('click.acu_opt', '.acu-opt-btn', async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const config = getConfig();\n        const val = decodeURIComponent($(this).data('val'));\n\n        // 1:  -> \n        if (!config.clickOptionToAutoSend) {\n          smartInsertToTextarea(val, 'action');\n          $('#send_textarea').focus();\n          return;\n        }\n\n        // 2: \n        // A: TavernHelper ( refresh: 'affected' )\n        if (window.TavernHelper) {\n          try {\n            // 1.  createChatMessages \n            if (window.TavernHelper.createChatMessages) {\n              await window.TavernHelper.createChatMessages(\n                [\n                  {\n                    role: 'user',\n                    message: val,\n                  },\n                ],\n                {\n                  //  TavernHelper \n                  refresh: 'affected',\n                },\n              );\n\n              // 2. \n              if (window.TavernHelper.triggerSlash) {\n                await window.TavernHelper.triggerSlash('/trigger');\n              }\n              return;\n            }\n          } catch (err) {\n            console.warn('[DICE]ACU TavernHelper ', err);\n          }\n        }\n\n        // B: SillyTavern  (Slash Command)\n        const ST = window.SillyTavern || window.parent?.SillyTavern;\n        if (ST && ST.executeSlashCommandsWithOptions) {\n          try {\n            //  raw=true  ( slash_command.txt)\n            const safeVal = val.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n            const cmd = `/send raw=true \"${safeVal}\"`;\n\n            const sendResult = await ST.executeSlashCommandsWithOptions(cmd);\n\n            if (!sendResult.isError && !sendResult.isAborted) {\n              await ST.executeSlashCommandsWithOptions('/trigger');\n              return;\n            }\n            console.warn('[DICE]ACU ST send :', sendResult);\n          } catch (err) {\n            console.warn('[DICE]ACU ST', err);\n          }\n        }\n\n        // C:  +  ()\n        const ta = $('#send_textarea');\n        if (ta.length) {\n          ta.val(val);\n          ta.trigger('input').trigger('change');\n          //  React \n          await new Promise(r => setTimeout(r, 50));\n          const sendBtn = $('#send_but').filter(':visible');\n          if (sendBtn.length) {\n            sendBtn[0].click();\n          } else {\n            // \n            const enterEvent = $.Event('keydown', { keyCode: 13, which: 13, bubbles: true });\n            ta.trigger(enterEvent);\n          }\n        }\n      });\n  };\n\n  const insertHtmlToPage = html => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // ---  ---\n\n    // 1.  (Embedded) v19 \n    if (config.positionMode === 'embedded') {\n      $('.acu-wrapper').remove(); // \n\n      const getTargetContainer = () => {\n        const $allMes = $('#chat .mes');\n        const $aiMes = $allMes.filter(function () {\n          const $this = $(this);\n          if ($this.attr('is_user') === 'true') return false;\n          if ($this.attr('is_system') === 'true') return false;\n          if ($this.hasClass('sys_mes')) return false;\n          const name = $this.find('.name_text').text().trim();\n          if (name === 'System') return false;\n          if ($this.css('display') === 'none') return false;\n          const $textDiv = $this.find('.mes_text');\n          if ($textDiv.length === 0) return false;\n          const textContent = $textDiv.text().trim();\n          const hasImage = $textDiv.find('img').length > 0;\n          if (textContent.length === 0 && !hasImage) return false;\n          return true;\n        });\n        //  AI  chat\n        if ($aiMes.length === 0) return $('#chat');\n\n        // \n\n        let targetIndex = $aiMes.length - 1;\n        const $targetMes = $aiMes.eq(targetIndex);\n        const $targetBlock = $targetMes.find('.mes_block');\n        return $targetBlock.length ? $targetBlock : $targetMes;\n      };\n\n      const $target = getTargetContainer();\n      if ($target.length) {\n        if ($target.hasClass('mes_block') || $target.hasClass('mes')) {\n          if ($target.find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          } else {\n            $target.find('.acu-wrapper').replaceWith(html);\n          }\n        } else {\n          // Fallback\n          if ($('#chat').find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          }\n        }\n      } else {\n        $('body').append(html);\n      }\n      return;\n    }\n\n    // 2.  (Fixed) B \n    // \n    const $chat = $('#chat');\n    const $oldWrapper = $('.acu-wrapper');\n\n    if ($oldWrapper.length) {\n      $oldWrapper.replaceWith(html);\n    } else {\n      if ($chat.length) {\n        $chat.append(html);\n      } else {\n        $('body').append(html);\n      }\n    }\n  };\n  // [] \n  const renderChangesPanel = rawData => {\n    const snapshot = loadSnapshot();\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // \n    const validationErrors = rawData ? ValidationEngine.validateAllData(rawData) : [];\n\n    if (!snapshot || !rawData) {\n      // \n      if (validationErrors.length === 0) {\n        return `\n                <div class=\"acu-panel-header\">\n                    <div class=\"acu-panel-title\">\n                        <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-compare\"></i> <span class=\"acu-title-text\"></span></div>\n                        <div class=\"acu-title-sub\"></div>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-panel-content\" style=\"display:flex;align-items:center;justify-content:center;\">\n                    <div class=\"acu-empty-hint\"></div>\n                </div>`;\n      }\n    }\n\n    // \n    const changes = [];\n\n    for (const sheetId in rawData) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      const newSheet = rawData[sheetId];\n      const oldSheet = snapshot[sheetId];\n      if (!newSheet?.name || !newSheet?.content) continue;\n\n      const tableName = newSheet.name;\n      const headers = newSheet.content[0] || [];\n      const newRows = newSheet.content.slice(1);\n      const oldRows = oldSheet?.content?.slice(1) || [];\n\n      // \n      newRows.forEach((row, rowIdx) => {\n        const oldRow = oldRows[rowIdx];\n\n        if (!oldRow) {\n          // \n          changes.push({\n            type: 'row_added',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: rowIdx,\n            headers,\n            row,\n            title: row[1] || ` ${rowIdx + 1}`,\n          });\n        } else {\n          // \n          const rowChanges = [];\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return; // \n            const oldVal = String(oldRow[colIdx] ?? '');\n            const newVal = String(cell ?? '');\n            if (oldVal !== newVal) {\n              rowChanges.push({\n                colIndex: colIdx,\n                header: headers[colIdx] || `${colIdx}`,\n                oldValue: oldVal,\n                newValue: newVal,\n              });\n            }\n          });\n\n          if (rowChanges.length === 1) {\n            // \n            const c = rowChanges[0];\n            changes.push({\n              type: 'cell_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              colIndex: c.colIndex,\n              header: c.header,\n              oldValue: c.oldValue,\n              newValue: c.newValue,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          } else if (rowChanges.length > 1) {\n            // \n            changes.push({\n              type: 'row_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              headers,\n              row,\n              oldRow,\n              changedFields: rowChanges,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          }\n        }\n      });\n\n      // \n      if (oldRows.length > newRows.length) {\n        for (let i = newRows.length; i < oldRows.length; i++) {\n          const oldRow = oldRows[i];\n          changes.push({\n            type: 'row_deleted',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: i,\n            headers,\n            row: oldRow,\n            title: oldRow[1] || ` ${i + 1}`,\n          });\n        }\n      }\n    }\n\n    // \n    for (const sheetId in snapshot) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      if (!rawData[sheetId]) {\n        const oldSheet = snapshot[sheetId];\n        changes.push({\n          type: 'table_deleted',\n          tableName: oldSheet?.name || sheetId,\n          tableKey: sheetId,\n        });\n      }\n    }\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n\n    // \n    const panelTitle = isValidationMode ? '' : '';\n    const panelIcon = isValidationMode ? 'fa-shield-halved' : 'fa-code-compare';\n    const toggleTitle = isValidationMode ? '' : '';\n\n    //  HTML\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n                    <div class=\"acu-title-main\"><i class=\"fa-solid ${panelIcon}\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                </div>\n                <div class=\"acu-header-actions\">\n                    ${!isValidationMode ? '<button class=\"acu-changes-batch-btn acu-batch-accept\" title=\"\"><i class=\"fa-solid fa-check-double\"></i></button>' : ''}\n                    <button class=\"acu-changes-batch-btn acu-batch-reject\" title=\"${isValidationMode ? '' : ''}\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                    <button class=\"acu-changes-batch-btn acu-simple-mode-toggle ${isValidationMode ? 'active' : ''}\" title=\"${toggleTitle}\">\n                        <i class=\"fa-solid ${isValidationMode ? 'fa-filter-circle-xmark' : 'fa-filter'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                    </div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>`;\n\n    // ===  ===\n    if (isValidationMode) {\n      html += `<div class=\"acu-validation-mode-hint\">\n        <i class=\"fa-solid fa-info-circle\"></i>\n      </div>`;\n    }\n\n    html += `<div class=\"acu-panel-content acu-changes-content ${config.layout === 'horizontal' ? 'acu-changes-horizontal' : ''}\">`;\n\n    // ===  ===\n    if (isValidationMode) {\n      if (validationErrors.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedErrors = ValidationEngine.groupErrorsByTable(validationErrors);\n        const collapsedGroups = Store.get('acu_validation_collapsed_groups', []);\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        for (const tableName in groupedErrors) {\n          const tableErrors = groupedErrors[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header acu-validation-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\" style=\"background:${t.errorText};\">${tableErrors.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableErrors.forEach(error => {\n            const ruleData = error.rule\n              ? escapeHtml(\n                  JSON.stringify({\n                    ruleId: error.ruleId,\n                    ruleType: error.ruleType,\n                    tableName: error.tableName,\n                    rowIndex: error.rowIndex,\n                    columnName: error.columnName || '',\n                    currentValue: error.currentValue || '',\n                    rowTitle: error.rowTitle || '', //  rowTitle  ruleData\n                    rule: error.rule,\n                  }),\n                )\n              : '';\n\n            html += `<div class=\"acu-change-item acu-validation-error-item\"\n                         data-table=\"${escapeHtml(error.tableName)}\"\n                         data-row=\"${error.rowIndex}\"\n                         data-column=\"${escapeHtml(error.columnName || '')}\"\n                         data-rule-id=\"${escapeHtml(error.ruleId || '')}\"\n                         data-rule-type=\"${escapeHtml(error.ruleType || '')}\"\n                         data-rule-data=\"${ruleData}\">\n                        <span class=\"acu-change-badge\" style=\"background:var(--acu-hl-manual-bg);color:var(--acu-hl-manual);\">!</span>\n                        ${error.rowTitle && error.rowIndex >= 0 ? `<div class=\"acu-validation-row-title\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:2px;\">${escapeHtml(error.rowTitle)}</div>` : ''}\n                        <span class=\"acu-change-title\">${escapeHtml(error.columnName || '')}${error.currentValue ? `: ${escapeHtml(error.currentValue.length > 15 ? error.currentValue.substring(0, 15) + '...' : error.currentValue)}` : ''}</span>\n                        <span class=\"acu-validation-error-msg\">${escapeHtml(error.errorMessage.length > 25 ? error.errorMessage.substring(0, 25) + '...' : error.errorMessage)}</span>\n                        <div class=\"acu-change-actions\">\n                            <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                        </div>\n                    </div>`;\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    } else {\n      // ===  ===\n      if (changes.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedChanges = {};\n        changes.forEach(c => {\n          const key = c.tableName;\n          if (!groupedChanges[key]) groupedChanges[key] = [];\n          groupedChanges[key].push(c);\n        });\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        const collapsedGroups = Store.get('acu_changes_collapsed_groups', []);\n\n        for (const tableName in groupedChanges) {\n          const tableChanges = groupedChanges[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\">${tableChanges.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableChanges.forEach(change => {\n            if (change.type === 'row_added') {\n              html += `<div class=\"acu-change-item acu-change-added\"\n                            data-change-type=\"row_added\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-added\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"row_deleted\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'cell_modified') {\n              const oldShort = change.oldValue.length > 15 ? change.oldValue.substring(0, 15) + '...' : change.oldValue;\n              const newShort = change.newValue.length > 15 ? change.newValue.substring(0, 15) + '...' : change.newValue;\n\n              const isOptionTable = change.tableName && change.tableName.includes('');\n              let fieldDisplay;\n              if (isOptionTable) {\n                fieldDisplay = `${escapeHtml(change.tableName)}.${escapeHtml(change.header)}`;\n              } else {\n                fieldDisplay = `${escapeHtml(change.rowTitle)}.${escapeHtml(change.header)}`;\n              }\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"cell_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\"\n                            data-col-index=\"${change.colIndex}\"\n                            data-old-value=\"${encodeURIComponent(change.oldValue)}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-field\">${fieldDisplay}</span>\n                            <span class=\"acu-change-diff\">\n                                <span class=\"acu-diff-old\">${escapeHtml(oldShort || '()')}</span>\n                                <span class=\"acu-diff-arrow\"></span>\n                                <span class=\"acu-diff-new\">${escapeHtml(newShort || '()')}</span>\n                            </span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_modified') {\n              // \n              const fieldCount = change.changedFields.length;\n              const fieldNames = change.changedFields\n                .slice(0, 2)\n                .map(f => f.header)\n                .join('');\n              const moreText = fieldCount > 2 ? ` ${fieldCount}` : '';\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"row_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.rowTitle)}</span>\n                            <span class=\"acu-change-field-count\">${escapeHtml(fieldNames)}${moreText}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'table_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"table_deleted\"\n                            data-table-key=\"${change.tableKey}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\"></span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            }\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    }\n\n    html += `</div>`;\n    return html;\n  };\n  // [] \n  const bindChangesEvents = () => {\n    const { $ } = getCore();\n\n    // \n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-close-btn')\n      .off('click')\n      .on('click', function () {\n        Store.set('acu_changes_panel_active', false);\n        $('#acu-data-area').removeClass('visible');\n        $('.acu-nav-btn').removeClass('active');\n      });\n\n    // === ===\n    const TOUCH_MOVE_THRESHOLD = 10; // 10px\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const tableName = $item.data('table');\n        const rowIndex = parseInt($item.data('row'), 10);\n        const columnName = $item.data('column');\n\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        try {\n          const rawData = cachedRawData || getTableData();\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === tableName && snapshot[sheetId]) {\n              const headers = rawData[sheetId].content?.[0] || [];\n              const colIdx = headers.indexOf(columnName);\n              if (colIdx >= 0 && snapshot[sheetId].content?.[rowIndex + 1]) {\n                const snapshotValue = snapshot[sheetId].content[rowIndex + 1][colIdx];\n                rawData[sheetId].content[rowIndex + 1][colIdx] = snapshotValue;\n                await saveDataToDatabase(rawData, false, false);\n                renderInterface();\n                return;\n              }\n              break;\n            }\n          }\n          if (window.toastr) window.toastr.warning('');\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const ruleData = $item.data('rule-data');\n        if (!ruleData) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        try {\n          const parsed = typeof ruleData === 'string' ? JSON.parse(ruleData) : ruleData;\n          const error = {\n            ruleId: parsed.ruleId,\n            ruleType: parsed.ruleType,\n            rule: parsed.rule,\n            tableName: $item.data('table') || parsed.tableName || '',\n            rowIndex: parseInt($item.data('row'), 10) || parsed.rowIndex || 0,\n            columnName: $item.data('column') || parsed.columnName || '',\n            currentValue: parsed.currentValue || '',\n            rowTitle: parsed.rowTitle || '', //  rowTitle \n            ruleName: parsed.ruleName || parsed.rule?.name || '',\n            errorMessage: parsed.errorMessage || parsed.rule?.errorMessage || '',\n          };\n          showSmartFixModal(error);\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    let validationItemTouchStartPos: { x: number; y: number } | null = null;\n\n    $('.acu-validation-error-item')\n      .off('click touchstart touchend touchmove')\n      .on('touchstart', function (e) {\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        validationItemTouchStartPos = { x: touch.clientX, y: touch.clientY };\n      })\n      .on('touchmove', function (e) {\n        if (!validationItemTouchStartPos) return;\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        const deltaX = Math.abs(touch.clientX - validationItemTouchStartPos.x);\n        const deltaY = Math.abs(touch.clientY - validationItemTouchStartPos.y);\n        // \n        if (deltaX > TOUCH_MOVE_THRESHOLD || deltaY > TOUCH_MOVE_THRESHOLD) {\n          validationItemTouchStartPos = null;\n        }\n      })\n      .on('touchend', function (e) {\n        // \n        if (!validationItemTouchStartPos) return;\n        validationItemTouchStartPos = null;\n\n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      })\n      .on('click', function (e) {\n        //  click \n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        //  touchend \n        if ('ontouchstart' in window) return;\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      });\n\n    // /\n    $('.acu-changes-group-header')\n      .off('click')\n      .on('click', function (e) {\n        if ($(e.target).closest('.acu-change-item').length) return;\n\n        const tableName = $(this).data('table');\n        const $group = $(this).closest('.acu-changes-group');\n        const $body = $group.find('.acu-changes-group-body');\n        const $icon = $(this).find('.acu-collapse-icon');\n\n        // \n        const isValidationMode = $(this).hasClass('acu-validation-group-header');\n        const storageKey = isValidationMode ? 'acu_validation_collapsed_groups' : 'acu_changes_collapsed_groups';\n        let collapsedGroups = Store.get(storageKey, []);\n\n        if ($group.hasClass('collapsed')) {\n          $group.removeClass('collapsed');\n          $body.slideDown(200);\n          $icon.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n          collapsedGroups = collapsedGroups.filter(n => n !== tableName);\n        } else {\n          $group.addClass('collapsed');\n          $body.slideUp(200);\n          $icon.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n          if (!collapsedGroups.includes(tableName)) {\n            collapsedGroups.push(tableName);\n          }\n        }\n\n        Store.set(storageKey, collapsedGroups);\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-accept')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n\n        const snapshot = loadSnapshot();\n        const rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = rawData[tableKey].content[rowIndex + 1][colIndex];\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            if (!snapshot[tableKey]) {\n              snapshot[tableKey] = JSON.parse(JSON.stringify(rawData[tableKey]));\n            } else {\n              snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n            }\n          }\n        } else if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          delete snapshot[tableKey];\n        }\n\n        saveSnapshot(snapshot);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n        const oldValue = decodeURIComponent($item.data('old-value') || '');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content[rowIndex + 1][colIndex] = oldValue;\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content) {\n            rawData[tableKey].content[rowIndex + 1] = [...snapshot[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === /===\n    $('.acu-action-restore')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            const restoredRow = [...snapshot[tableKey].content[rowIndex + 1]];\n            if (!rawData[tableKey]) {\n              rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n              rawData[tableKey].content = [snapshot[tableKey].content[0]];\n            }\n            // \n            rawData[tableKey].content.splice(rowIndex + 1, 0, restoredRow);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          if (snapshot[tableKey]) {\n            rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item:not(.acu-validation-error-item) .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const changeType = $item.data('change-type');\n\n        if (!tableKey || rowIndex === undefined) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const sheet = rawData[tableKey];\n        const headers = sheet.content ? sheet.content[0] : [];\n        const row = sheet.content ? sheet.content[rowIndex + 1] : null;\n\n        if (!row) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        if (changeType === 'row_modified') {\n          // \n          showRowCompareEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        } else if (changeType === 'cell_modified') {\n          const colIndex = $item.data('col-index');\n          const headerName = headers[colIndex] || `${colIndex}`;\n          const cellValue = row[colIndex] || '';\n          showChangeSingleFieldModal(cellValue, headerName, sheet.name, rowIndex, colIndex, tableKey);\n        } else {\n          showChangeEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        }\n      });\n\n    // ===  ===\n    $('.acu-batch-accept')\n      .off('click')\n      .on('click', async function () {\n        const rawData = cachedRawData || getTableData();\n        if (!rawData) return;\n\n        // \n        saveSnapshot(JSON.parse(JSON.stringify(rawData)));\n        currentDiffMap = new Set();\n\n        // \n        refreshChangesPanel();\n      });\n\n    // ===  ===\n    $('.acu-batch-reject')\n      .off('click')\n      .on('click', async function () {\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const restoredData = JSON.parse(JSON.stringify(snapshot));\n        cachedRawData = restoredData;\n        await saveDataToDatabase(restoredData, false, false);\n      });\n\n    // ===  ===\n    $('.acu-simple-mode-toggle')\n      .off('click')\n      .on('click', function () {\n        const currentMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        const newMode = !currentMode;\n        Store.set(STORAGE_KEY_VALIDATION_MODE, newMode);\n\n        // \n        const rawData = cachedRawData || getTableData();\n        $('#acu-data-area').html(renderChangesPanel(rawData));\n        bindChangesEvents();\n\n        // \n        updateChangesCount(rawData);\n      });\n\n    // ===  ===\n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          // \n          const finalHeight = $panel.height();\n          const heights = getTableHeights();\n          heights[tableName] = finalHeight;\n          saveTableHeights(heights);\n        };\n      })\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const $panel = $('#acu-data-area');\n        $panel.css('height', ''); // \n        // \n        const heights = getTableHeights();\n        delete heights[tableName];\n        saveTableHeights(heights);\n      });\n\n    // ===  ===\n    const $horizontalScroller = $('.acu-changes-content.acu-changes-horizontal');\n    if ($horizontalScroller.length) {\n      $horizontalScroller[0].addEventListener(\n        'touchstart',\n        function (e) {\n          this._touchStartX = e.touches[0].clientX;\n          this._touchStartY = e.touches[0].clientY;\n          this._scrollDirection = null; // \n        },\n        { passive: true },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchmove',\n        function (e) {\n          if (!this._touchStartX) return;\n\n          const deltaX = Math.abs(e.touches[0].clientX - this._touchStartX);\n          const deltaY = Math.abs(e.touches[0].clientY - this._touchStartY);\n\n          // \n          if (!this._scrollDirection && (deltaX > 5 || deltaY > 5)) {\n            this._scrollDirection = deltaX > deltaY ? 'horizontal' : 'vertical';\n          }\n\n          // \n          // \n          if (this._scrollDirection === 'horizontal' && deltaX > 10) {\n            e.stopPropagation();\n          }\n        },\n        { passive: false },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchend',\n        function () {\n          this._touchStartX = null;\n          this._touchStartY = null;\n          this._scrollDirection = null;\n        },\n        { passive: true },\n      );\n    }\n  };\n\n  // [] \n  const refreshChangesPanel = () => {\n    const { $ } = getCore();\n    const rawData = cachedRawData || getTableData();\n    currentDiffMap = generateDiffMap(rawData);\n\n    const $panel = $('#acu-data-area');\n    if ($panel.length && Store.get('acu_changes_panel_active', false)) {\n      $panel.html(renderChangesPanel(rawData));\n      bindChangesEvents();\n\n      // \n      updateChangesCount(rawData);\n    }\n  };\n\n  // []  + \n  const updateChangesCount = rawData => {\n    const { $ } = getCore();\n    const snapshot = loadSnapshot();\n    let changesCount = 0;\n\n    if (snapshot && rawData) {\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const newSheet = rawData[sheetId];\n        const oldSheet = snapshot[sheetId];\n        if (!newSheet?.content) continue;\n        const newRows = newSheet.content.slice(1);\n        const oldRows = oldSheet?.content?.slice(1) || [];\n        newRows.forEach((row, rowIdx) => {\n          const oldRow = oldRows[rowIdx];\n          if (!oldRow) {\n            changesCount++;\n            return;\n          }\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return;\n            if (String(cell ?? '') !== String(oldRow[colIdx] ?? '')) changesCount++;\n          });\n        });\n        if (oldRows.length > newRows.length) changesCount += oldRows.length - newRows.length;\n      }\n      for (const sheetId in snapshot) {\n        if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n      }\n    }\n\n    // \n    const validationErrorCount = rawData ? ValidationEngine.getErrorCount(rawData) : 0;\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n    const displayCount = isValidationMode ? validationErrorCount : changesCount;\n    // \n    const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n    const $btn = $('#acu-btn-changes');\n    const $span = $btn.find('span');\n    $span.html(displayCount > 0 ? `(${displayCount})` : '');\n\n    // \n    if (showWarningIcon) {\n      if (!$btn.find('.acu-nav-warning-icon').length) {\n        $span.append(' <i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>');\n      }\n      $btn.addClass('has-validation-errors');\n    } else {\n      $btn.find('.acu-nav-warning-icon').remove();\n      $btn.removeClass('has-validation-errors');\n    }\n  };\n  // [] \n  const showChangeEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const inputsHtml = row\n      .map((cell, idx) => {\n        if (idx === 0) return '';\n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        return `\n                <div class=\"acu-card-edit-field\" style=\"margin-bottom: 10px;\">\n                    <label style=\"display:block;font-size:12px;color:var(--acu-accent);font-weight:bold;margin-bottom:4px;\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\"\n                                                        style=\"width:100%;min-height:40px;max-height:500px;padding:10px;resize:none;overflow-y:hidden;\">${escapeHtml(val)}</textarea>                            </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${inputsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-change-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-change-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // [] \n    const adjustHeight = el => {\n      //  auto  0px scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n    };\n    dialog.find('#dlg-change-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    dialog.find('#dlg-change-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n\n        if (hasChanges) {\n          // 1. \n          try {\n            const api = getCore().getDB();\n            if (!api || !api.importTableAsJson) {\n              throw new Error(' API ');\n            }\n\n            const dataToSave = { mate: rawData.mate || { type: 'chatSheets', version: 1 } };\n            Object.keys(rawData).forEach(k => {\n              if (k.startsWith('sheet_')) dataToSave[k] = rawData[k];\n            });\n\n            // \n            let jsonString;\n            try {\n              jsonString = JSON.stringify(dataToSave);\n              //  10MB \n              const sizeInMB = new Blob([jsonString]).size / (1024 * 1024);\n              if (sizeInMB > 10) {\n                throw new Error(` (${sizeInMB.toFixed(2)}MB) 10MB `);\n              }\n            } catch (stringifyError) {\n              console.error('[DICE]ACU JSON :', stringifyError);\n              throw new Error(`: ${stringifyError.message || stringifyError}`);\n            }\n\n            //  importTableAsJson saveChat()\n            const result = await api.importTableAsJson(jsonString);\n            //  false \n            if (result === false) {\n              throw new Error(' false');\n            }\n            cachedRawData = rawData;\n          } catch (e) {\n            console.error('[DICE]ACU :', e);\n            let errorMessage = e.message || '';\n            //  \"Settings could not be saved\" \n            const errorMsg = String(e);\n            if (\n              errorMsg.includes('Settings could not be saved') ||\n              errorMsg.includes('server connection') ||\n              errorMsg.includes('data loss')\n            ) {\n              errorMessage = '';\n            }\n            if (window.toastr) {\n              window.toastr.error(errorMessage, '', { timeOut: 7000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n            // \n            return;\n          }\n\n          // 2. \n          const snapshot = loadSnapshot();\n          if (snapshot && snapshot[tableKey] && snapshot[tableKey].content) {\n            snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n            saveSnapshot(snapshot);\n          }\n\n          // 3.  diffMap \n          currentDiffMap = generateDiffMap(rawData);\n\n          // 4. \n          const $panel = $('#acu-data-area');\n          $panel.html(renderChangesPanel(rawData));\n          bindChangesEvents();\n        }\n      }\n      closeDialog();\n    });\n  };\n  // [] \n  const showChangeSingleFieldModal = (value, headerName, tableName, rowIndex, colIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldValue = snapshot?.[tableKey]?.content?.[rowIndex + 1]?.[colIndex] ?? '';\n    const hasOldValue = oldValue !== '' && String(oldValue) !== String(value);\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:450px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(headerName)}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${\n                          hasOldValue\n                            ? `\n                        <div class=\"acu-diff-section acu-diff-old-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                            </div>\n                            <div class=\"acu-diff-readonly\">${escapeHtml(oldValue)}</div>\n                        </div>\n                        <div class=\"acu-diff-arrow-down\">\n                            <i class=\"fa-solid fa-arrow-down\"></i>\n                        </div>\n                        `\n                            : ''\n                        }\n                        <div class=\"acu-diff-section acu-diff-new-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-pen\"></i> ${hasOldValue ? '' : ''}\n                            </div>\n                            <textarea class=\"acu-change-single-input acu-edit-textarea\" spellcheck=\"false\"\n                                style=\"width:100%;min-height:60px;max-height:300px;padding:12px;resize:none;\">${escapeHtml(value)}</textarea>\n                        </div>\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-single-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        ${hasOldValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"dlg-single-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-single-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const $textarea = dialog.find('.acu-change-single-input');\n    const adjustHeight = () => {\n      $textarea[0].style.height = 'auto';\n      const h = Math.max(60, Math.min($textarea[0].scrollHeight + 2, 300));\n      $textarea[0].style.height = h + 'px';\n    };\n    setTimeout(adjustHeight, 0);\n    $textarea.on('input', adjustHeight);\n    $textarea.focus();\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-single-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    // [] \n    dialog.find('#dlg-single-revert').click(function () {\n      $textarea.val(oldValue).trigger('input');\n    });\n\n    dialog.find('#dlg-single-save').click(async () => {\n      const newVal = $textarea.val();\n      let rawData = cachedRawData || getTableData();\n\n      if (rawData && rawData[tableKey] && rawData[tableKey].content) {\n        const currentRow = rawData[tableKey].content[rowIndex + 1];\n        if (currentRow && String(currentRow[colIndex]) !== String(newVal)) {\n          currentRow[colIndex] = newVal;\n\n          // \n          await saveDataOnly(rawData);\n\n          // \n          const snapshot = loadSnapshot();\n          if (\n            snapshot &&\n            snapshot[tableKey] &&\n            snapshot[tableKey].content &&\n            snapshot[tableKey].content[rowIndex + 1]\n          ) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = newVal;\n            saveSnapshot(snapshot);\n          }\n\n          // \n          currentDiffMap = generateDiffMap(rawData);\n          refreshChangesPanel();\n        }\n      }\n      closeDialog();\n    });\n  };\n\n  // [] \n  const showRowCompareEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldRow = snapshot?.[tableKey]?.content?.[rowIndex + 1] || [];\n\n    // \n    let fieldsHtml = '';\n    for (let idx = 1; idx < headers.length; idx++) {\n      const headerName = headers[idx] || ` ${idx}`;\n      const oldVal = oldRow[idx] ?? '';\n      const newVal = row[idx] ?? '';\n      const isChanged = String(oldVal) !== String(newVal);\n\n      fieldsHtml += `\n                <div class=\"acu-row-edit-field ${isChanged ? 'acu-field-changed' : ''}\">\n                    <div class=\"acu-row-edit-label\">${escapeHtml(headerName)} ${isChanged ? '<span class=\"acu-changed-badge\"></span>' : ''}</div>\n                    ${isChanged ? `<div class=\"acu-row-edit-old\">${escapeHtml(oldVal) || '<span class=\"acu-empty-val\">()</span>'}</div>` : ''}\n                    <textarea class=\"acu-row-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\">${escapeHtml(newVal)}</textarea>\n                </div>\n            `;\n    }\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:550px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(row[1] || ' ' + (rowIndex + 1))}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px; max-height:60vh;\">\n                        ${fieldsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-row-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = Math.min(el.scrollHeight + 2, 200) + 'px';\n    };\n    dialog.find('textarea').each(function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-row-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#dlg-row-revert').click(function () {\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        $(this)\n          .val(oldRow[colIdx] ?? '')\n          .trigger('input');\n      });\n    });\n\n    // \n    dialog.find('#dlg-row-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (!rawData?.[tableKey]?.content?.[rowIndex + 1]) {\n        closeDialog();\n        return;\n      }\n\n      const currentRow = rawData[tableKey].content[rowIndex + 1];\n      let hasChanges = false;\n\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        const newVal = $(this).val();\n        if (String(currentRow[colIdx]) !== String(newVal)) {\n          hasChanges = true;\n          currentRow[colIdx] = newVal;\n        }\n      });\n\n      if (hasChanges) {\n        await saveDataOnly(rawData);\n\n        // \n        const snapshot = loadSnapshot();\n        if (snapshot?.[tableKey]?.content) {\n          snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n          saveSnapshot(snapshot);\n        }\n\n        currentDiffMap = generateDiffMap(rawData);\n        refreshChangesPanel();\n      }\n      closeDialog();\n    });\n  };\n  const renderDashboard = allTables => {\n    console.info('[DICE]...');\n    const config = getConfig();\n\n    // [] \n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const questResult = DashboardDataParser.findTable(allTables, 'quest');\n    const bagResult = DashboardDataParser.findTable(allTables, 'bag');\n    const skillResult = DashboardDataParser.findTable(allTables, 'skill');\n    const equipResult = DashboardDataParser.findTable(allTables, 'equip');\n\n    // []  - \n    let player = { name: '', status: '', position: '', attrs: '', money: '0' };\n    const playerParsed = DashboardDataParser.parseRows(playerResult, 'player');\n\n    if (playerParsed.length > 0) {\n      const p = playerParsed[0];\n      player.name = p.name || '';\n      player.status = p.status || '';\n      player.position = p.position || '';\n      player.money = p.money || '';\n      player.resources = '';\n\n      // [] \n      if (playerResult?.data?.headers && playerResult?.data?.rows?.[0]) {\n        const headers = playerResult.data.headers;\n        const row = playerResult.data.rows[0];\n        let allAttrsStr = '';\n        headers.forEach((h, idx) => {\n          if (h && h.includes('')) {\n            const val = row[idx];\n            if (val) allAttrsStr += (allAttrsStr ? '; ' : '') + val;\n          }\n        });\n        player.attrs = allAttrsStr;\n\n        // \n        headers.forEach((h, idx) => {\n          if (h && (h.includes('') || h.includes(''))) {\n            const val = row[idx];\n            if (val) player.resources = val;\n          }\n        });\n      }\n    }\n\n    // [] HTML\n    const playerRows = playerResult?.data?.rows || [];\n    const playerHeaders = playerResult?.data?.headers || [];\n\n    // []  - \n    let globalDetailLocation = ''; // \n    let globalLocation = ''; // \n\n    if (globalResult?.data?.rows?.length > 0) {\n      const headers = globalResult.data.headers || [];\n      const row = globalResult.data.rows[0];\n\n      // \n      const detailIdx = DashboardDataParser.findColumnIndex(headers, 'detailLocation', globalResult.config);\n      if (detailIdx >= 0 && row[detailIdx]) {\n        globalDetailLocation = row[detailIdx];\n      }\n\n      // \n      const locIdx = DashboardDataParser.findColumnIndex(headers, 'currentLocation', globalResult.config);\n      globalLocation = locIdx >= 0 && row[locIdx] ? row[locIdx] : row[2] || '';\n    }\n\n    // currentPlaceName \n    let currentPlaceName =\n      globalDetailLocation ||\n      globalLocation ||\n      (player.position.includes('-') ? player.position.split('-')[0].trim() : player.position);\n\n    // [] NPC - \n    const npcTableName = npcResult?.name || '';\n    const npcTableKey = npcResult?.key || '';\n\n    const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n\n    // NPC\n    let inSceneNPCs = [];\n    let offSceneNPCs = [];\n    npcParsed.forEach(npc => {\n      const inSceneVal = String(npc.inScene || '').toLowerCase();\n      const npcData = {\n        name: npc.name || '',\n        status: npc.status || '',\n        position: npc.position || '',\n        index: npc._rowIndex,\n      };\n      if (inSceneVal === 'true' || inSceneVal === '') {\n        inSceneNPCs.push(npcData);\n      } else {\n        offSceneNPCs.push(npcData);\n      }\n    });\n    // \n    let allNPCs = [...inSceneNPCs, ...offSceneNPCs];\n\n    // []  -  + \n    const questTableName = questResult?.name || '';\n    const questParsed = DashboardDataParser.parseRows(questResult, 'quest');\n    const activeQuestParsed = DashboardDataParser.applyFilter(questParsed, 'active', 'quest');\n\n    //  >  >  > \n    const questTypeOrder = type => {\n      const t = String(type || '').toLowerCase();\n      if (t.includes('')) return 0;\n      if (t.includes('')) return 1;\n      if (t.includes('')) return 2;\n      return 3;\n    };\n    let activeTasks = activeQuestParsed\n      .map(q => ({\n        name: q.name || '',\n        type: q.type || '',\n        progress: q.progress || '',\n        _rowIndex: q._rowIndex,\n      }))\n      .sort((a, b) => questTypeOrder(a.type) - questTypeOrder(b.type))\n      .slice(0, 5);\n    // []  - \n    const bagTableName = bagResult?.name || '';\n\n    const bagParsed = DashboardDataParser.parseRows(bagResult, 'bag');\n    let bagItems = bagParsed.slice(0, 6).map(item => ({\n      name: item.name || '',\n      count: item.count || '1',\n      type: item.type || '',\n    }));\n\n    // []  - \n    const skillTableName = skillResult?.name || '';\n\n    const skillParsed = DashboardDataParser.parseRows(skillResult, 'skill');\n    let skills = skillParsed.slice(0, 6).map(s => ({\n      name: s.name || '',\n      level: s.level || '',\n      type: s.type || '',\n    }));\n\n    // []  -  + \n    const equipTableName = equipResult?.name || '';\n\n    const equipParsed = DashboardDataParser.parseRows(equipResult, 'equip');\n    const equippedParsed = DashboardDataParser.applyFilter(equipParsed, 'equipped', 'equip');\n\n    let equippedItems = equippedParsed.slice(0, 4).map(e => ({\n      name: e.name || '',\n      type: e.type || '',\n      part: e.part || '',\n    }));\n    // []  - \n    const locationTableName = locationResult?.name || '';\n    const locationTableKey = locationResult?.key || '';\n\n    const locationParsed = DashboardDataParser.parseRows(locationResult, 'location');\n\n    // HTML\n    let html = `\n        <div class=\"acu-panel-header\">\n            <div class=\"acu-panel-title\">\n                <div class=\"acu-title-main\"><i class=\"fa-solid fa-chart-line\"></i> <span class=\"acu-title-text\"></span></div>\n                <div class=\"acu-title-sub\"></div>\n            </div>\n            <div class=\"acu-header-actions\">\n                <div class=\"acu-height-control\">\n                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                </div>\n                <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n        </div>\n        <div class=\"acu-panel-content acu-dashboard-content\">\n            <div class=\"acu-dash-body ${config.layout === 'horizontal' ? 'acu-dash-horizontal' : ''}\">\n            <!--  +  -->\n                <div class=\"acu-dash-player\">\n                    <h3 class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                        data-table-key=\"${playerResult?.key || ''}\"\n                        data-row-index=\"0\"\n                        data-preview-type=\"player\"\n                        style=\"cursor:pointer;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-user-circle\"></i> ${escapeHtml(replaceUserPlaceholders(player.name))}</span>\n                        <span style=\"font-size:11px;font-weight:normal;color:var(--acu-text-main);background:var(--acu-badge-bg);padding:2px 8px;border-radius:10px;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;\" title=\"${escapeHtml(player.status)}\">${escapeHtml(player.status.length > 6 ? player.status.substring(0, 6) + '..' : player.status)}</span>\n                    </h3>\n                    <div class=\"acu-player-status\" style=\"margin-bottom:8px;\">\n                        ${(() => {\n                          // \n                          const resourcesStr = player.resources || player.money || '';\n                          const parsedResources = parseAttributeString(resourcesStr);\n                          if (parsedResources.length > 0) {\n                            return `<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:52px;overflow-y:auto;margin-bottom:6px;padding-bottom:6px;border-bottom:1px dashed var(--acu-border);\">\n                                    ${parsedResources\n                                      .slice(0, 4)\n                                      .map(\n                                        res => `\n                                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;\">\n                                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(res.name)}\">${escapeHtml(res.name.substring(0, 3))}</span>\n                                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                                <span style=\"color:var(--acu-accent);font-size:11px;font-weight:bold;\">${res.value}</span>\n                                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${res.value}\" data-name=\"${escapeHtml(res.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${res.name}(${res.value})\"></i>\n                                            </div>\n                                        </div>\n                                    `,\n                                      )\n                                      .join('')}\n                                </div>`;\n                          }\n                          return '';\n                        })()}\n        ${(() => {\n          // \n          let allAttrs = [];\n          if (playerRows.length > 0 && playerHeaders.length > 0) {\n            const row = playerRows[0];\n            playerHeaders.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!allAttrs.some(a => a.name === attr.name)) {\n                    allAttrs.push(attr);\n                  }\n                });\n              }\n            });\n          }\n\n          if (allAttrs.length > 0) {\n            // 378px\n            return `<div style=\"display:grid;grid-template-columns:repeat(3,1fr);gap:2px 6px;max-height:78px;overflow-y:auto;overflow-x:hidden;\">\n                    ${allAttrs\n                      .map(\n                        attr => `\n                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;\">\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(attr.name)}\">${escapeHtml(attr.name.substring(0, 2))}</span>\n                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                <span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${attr.value}</span>\n                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${attr.value}\" data-name=\"${escapeHtml(attr.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${attr.name}(${attr.value})\"></i>\n                            </div>\n                        </div>\n                    `,\n                      )\n                      .join('')}\n                </div>`;\n          }\n          return '';\n        })()}\n                    </div>\n\n                    <h4 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(skillTableName)}\" style=\"font-size:12px;color:var(--acu-accent);margin:10px 0 6px 0;\"><i class=\"fa-solid fa-bolt\"></i>  (${skillParsed.length})</h4>\n                    <div style=\"display:grid;grid-template-columns:repeat(2,1fr);gap:2px 6px;max-height:78px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      skills.length > 0\n                        ? skills\n                            .map((skill, idx) => {\n                              const skillValue = extractNumericValue(skill.level);\n                              const hasNumeric = skillValue > 0;\n                              const skillRowIndex = skillParsed.findIndex(s => s.name === skill.name);\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${skillResult?.key || ''}\"\n                            data-row-index=\"${skillRowIndex >= 0 ? skillRowIndex : idx}\"\n                            data-preview-type=\"skill\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;cursor:pointer;\">\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(skill.name)}\">${escapeHtml(skill.name.length > 5 ? skill.name.substring(0, 5) + '..' : skill.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                ${\n                                  hasNumeric\n                                    ? `<span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${skillValue}</span>\n                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${skillValue}\" data-name=\"${escapeHtml(skill.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${skill.name}(${skillValue})\"></i>`\n                                    : `<span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(skill.level || '-')}</span>`\n                                }\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div style=\"grid-column:1/-1;text-align:center;color:var(--acu-text-sub);padding:8px;font-size:11px;\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  + NPC -->\n                <div class=\"acu-dash-locations\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(locationTableName)}\" style=\"display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-map\"></i>  (${locationParsed.length})</span>\n                        <i class=\"fa-solid fa-map acu-dash-map-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:100px;overflow-y:auto;overflow-x:hidden;margin-bottom:10px;\">\n                    ${\n                      locationParsed.length > 0\n                        ? locationParsed\n                            .map((loc, idx) => {\n                              const areaName = loc.name || '';\n                              const isCurrent =\n                                currentPlaceName &&\n                                (areaName.includes(currentPlaceName) || currentPlaceName.includes(areaName));\n                              return `<div class=\"acu-location-item acu-dash-clickable acu-dash-preview-trigger ${isCurrent ? 'acu-current-location' : ''}\"\n                            data-table-key=\"${escapeHtml(locationTableKey)}\"\n                            data-row-index=\"${loc._rowIndex}\"\n                            data-preview-type=\"location\">\n                            <span>\n                                ${isCurrent ? '<i class=\"fa-solid fa-location-dot\"></i>' : '<i class=\"fa-solid fa-map-pin\" style=\"font-size:9px;opacity:0.4;\"></i>'}\n                                <span title=\"${escapeHtml(areaName)}\">${escapeHtml(areaName)}</span>\n                            </span>\n                            ${!isCurrent ? `<i class=\"fa-solid fa-walking acu-dash-goto-btn\" data-location=\"${escapeHtml(areaName)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;flex-shrink:0;\" title=\"${areaName}\"></i>` : '<i class=\"fa-solid fa-street-view\" style=\"flex-shrink:0;\" title=\"\"></i>'}\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(npcTableName)}\" style=\"margin-top:10px;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-users\"></i>  (${allNPCs.length})</span>\n                        <span style=\"display:flex;gap:8px;\">\n                            <i class=\"fa-solid fa-project-diagram acu-dash-relation-graph-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                            <i class=\"fa-solid fa-user-circle acu-dash-avatar-manager-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                        </span>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:150px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      allNPCs.length > 0\n                        ? allNPCs\n                            .slice(0, 12)\n                            .map((npc, npcIdx) => {\n                              const isInScene = inSceneNPCs.some(n => n.name === npc.name);\n                              const isLastNpc = npcIdx === Math.min(allNPCs.length, 12) - 1;\n                              const npcAvatar = AvatarManager.get(npc.name);\n                              const avatarOffsetX = AvatarManager.getOffsetX(npc.name);\n                              const avatarOffsetY = AvatarManager.getOffsetY(npc.name);\n                              const avatarScale = AvatarManager.getScale(npc.name);\n                              const avatarStyle = npcAvatar\n                                ? `background-image:url('${npcAvatar}');background-size:${avatarScale}%;background-position:${avatarOffsetX}% ${avatarOffsetY}%;`\n                                : '';\n                              const offSceneFilter = isInScene\n                                ? ''\n                                : 'filter:grayscale(80%) brightness(0.7);opacity:0.5;';\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${escapeHtml(npcTableKey)}\"\n                            data-row-index=\"${npc.index}\"\n                            data-preview-type=\"npc\"\n                            style=\"padding:6px 4px;${!isLastNpc ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <span class=\"acu-task-name\" style=\"font-size:12px;display:flex;align-items:center;gap:6px;\">\n                                    <span class=\"acu-dash-npc-avatar\" style=\"width:22px;height:22px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border:1.5px solid ${isInScene ? 'var(--acu-accent)' : 'var(--acu-border)'};${avatarStyle}${offSceneFilter}\" title=\"${isInScene ? '' : ''}\">\n                                        ${!npcAvatar ? `<span style=\"font-size:10px;font-weight:bold;color:var(--acu-text-sub);${offSceneFilter}\">${escapeHtml(npc.name.charAt(0))}</span>` : ''}\n                                    </span>\n                                    <span title=\"${escapeHtml(npc.name)}\" style=\"${isInScene ? '' : 'opacity:0.6;'}\">${escapeHtml(npc.name.length > 4 ? npc.name.substring(0, 4) + '..' : npc.name)}</span>\n                                </span>\n                                <div style=\"display:flex;align-items:center;\">\n                                    <i class=\"fa-solid fa-people-arrows acu-dash-contest-btn\" data-npc=\"${escapeHtml(npc.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${npc.name}\"></i>\n                                </div>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  +  +  -->\n                <div class=\"acu-dash-intel\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(bagTableName)}\"><i class=\"fa-solid fa-bag-shopping\"></i>  (${bagParsed.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      bagItems.length > 0\n                        ? bagItems\n                            .map((item, idx) => {\n                              const isLastBag = idx === bagItems.length - 1;\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${bagResult?.key || ''}\"\n                            data-row-index=\"${idx}\"\n                            data-preview-type=\"bag\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLastBag ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);flex:1;white-space:nowrap;\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name.length > 4 ? item.name.substring(0, 4) + '..' : item.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:6px;\">\n                                <i class=\"fa-solid fa-hand-pointer acu-dash-use-item-btn\" data-item=\"${escapeHtml(item.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${item.name}\"></i>\n                                <span style=\"color:var(--acu-accent);font-weight:bold;\">${escapeHtml(item.count)}</span>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(equipTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-shield-halved\"></i>  (${equippedItems.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      equippedItems.length > 0\n                        ? equippedItems\n                            .map((item, idx) => {\n                              const isLast = idx === equippedItems.length - 1;\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${equipResult?.key || ''}\"\n                            data-row-index=\"${equipParsed.findIndex(r => r.name === item.name)}\"\n                            data-preview-type=\"equipment\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLast ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name.length > 5 ? item.name.substring(0, 5) + '..' : item.name)}</span>\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(item.part || item.type)}</span>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(questTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-clipboard-list\"></i>  (${activeTasks.length})</h3>\n                    ${\n                      activeTasks.length > 0\n                        ? activeTasks\n                            .map((t, idx) => {\n                              const isMain = String(t.type || '').includes('');\n                              // \n                              let progressPercent = null;\n                              const progressMatch = String(t.progress || '').match(/(\\d+)\\s*%/);\n                              if (progressMatch) {\n                                progressPercent = Math.min(100, Math.max(0, parseInt(progressMatch[1], 10)));\n                              }\n                              const progressBar =\n                                progressPercent !== null\n                                  ? `<div style=\"width:40px;height:4px;background:var(--acu-border);border-radius:2px;overflow:hidden;\"><div style=\"width:${progressPercent}%;height:100%;background:var(--acu-accent);\"></div></div>`\n                                  : '';\n                              return `<div class=\"acu-task-item acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${questResult?.key || ''}\"\n                            data-row-index=\"${t._rowIndex !== undefined ? t._rowIndex : questParsed.findIndex(q => q.name === t.name)}\"\n                            data-preview-type=\"quest\"\n                            style=\"padding:4px 8px;margin-bottom:3px;cursor:pointer;\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <div class=\"acu-task-name\" style=\"font-size:11px;${isMain ? 'font-weight:600;' : ''}\">${escapeHtml(t.name)}</div>\n                                ${progressBar}\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                </div>\n            </div>\n    `;\n\n    // \n    const loadedModules = [\n      globalResult ? '' : null,\n      playerResult ? '' : null,\n      locationResult ? '' : null,\n      npcResult ? 'NPC' : null,\n      questResult ? '' : null,\n      bagResult ? '' : null,\n      skillResult ? '' : null,\n      equipResult ? '' : null,\n    ].filter(Boolean);\n\n    console.info(`[DICE]${loadedModules.length}: ${loadedModules.join(', ')}`);\n    return html;\n  };\n\n  const renderTableContent = (tableData, tableName) => {\n    if (!tableData || !tableData.rows.length)\n      return `\n            <div class=\"acu-panel-header\"><div class=\"acu-panel-title\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${tableName}</div><button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button></div>\n            <div class=\"acu-panel-content\"><div style=\"text-align:center;color:var(--acu-text-sub);padding:20px;\"></div></div>`;\n\n    const config = getConfig();\n    const pendingDeletions = getPendingDeletions()[tableData.key] || [];\n    const headers = (tableData.headers || []).slice(1);\n\n    //  ( list)\n    const currentStyle = (getTableStyles() || {})[tableName] || 'list';\n    const isGridMode = currentStyle === 'grid';\n\n    let titleColIndex = 1;\n    if (tableData.headers.length === 1) {\n      titleColIndex = 0;\n    } else if (tableName.includes('') || tableName.includes('')) {\n      const idx = tableData.headers.findIndex(\n        h => h && (h.includes('') || h.includes('') || h.includes('')),\n      );\n      if (idx > 0) titleColIndex = idx;\n    }\n\n    // ---  ---\n    let processedRows = tableData.rows.map((row, index) => {\n      const rowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n      const isBookmarked = rowKey && BookmarkManager.isBookmarked(tableName, rowKey);\n      return { data: row, originalIndex: index, rowKey, isBookmarked };\n    });\n    const searchTerm = (tableSearchStates[tableName] || '').toLowerCase().trim();\n\n    // \n    const isReversed = isTableReversed(tableName);\n\n    if (searchTerm) {\n      processedRows = processedRows.filter(item =>\n        item.data.some(cell => String(cell).toLowerCase().includes(searchTerm)),\n      );\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        const titleA = String(a.data[titleColIndex] || '').toLowerCase();\n        const titleB = String(b.data[titleColIndex] || '').toLowerCase();\n        const aHitTitle = titleA.includes(searchTerm);\n        const bHitTitle = titleB.includes(searchTerm);\n        if (titleA === searchTerm && titleB !== searchTerm) return -1;\n        if (titleA !== searchTerm && titleB === searchTerm) return 1;\n        if (aHitTitle && !bHitTitle) return -1;\n        if (!aHitTitle && bHitTitle) return 1;\n        return a.originalIndex - b.originalIndex;\n      });\n    } else {\n      // \n      // bookmark\n      processedRows.sort((a, b) => {\n        // bookmarkbookmark\n        if (a.isBookmarked && !b.isBookmarked) return -1;\n        if (!a.isBookmarked && b.isBookmarked) return 1;\n        // bookmarkbookmark\n        if (isReversed) {\n          return b.originalIndex - a.originalIndex;\n        } else {\n          return a.originalIndex - b.originalIndex;\n        }\n      });\n    }\n\n    const itemsPerPage = config.itemsPerPage || 50;\n    const totalItems = processedRows.length;\n    const totalPages = Math.ceil(totalItems / itemsPerPage) || 1;\n    let currentPage = tablePageStates[tableName] || 1;\n    if (currentPage > totalPages) currentPage = totalPages;\n    if (currentPage < 1) currentPage = 1;\n    tablePageStates[tableName] = currentPage;\n\n    const startIdx = (currentPage - 1) * itemsPerPage;\n    const endIdx = startIdx + itemsPerPage;\n    const rowsToRender = processedRows.slice(startIdx, endIdx);\n    // []    \n    // \n    const showReverseBtn = shouldShowReverseButton(tableName);\n    const reverseBtnHtml = showReverseBtn\n      ? `\n            <button class=\"acu-view-btn acu-reverse-btn\" data-table=\"${escapeHtml(tableName)}\" title=\"${isReversed ? '' : ''}\">\n                <i class=\"fa-solid ${isReversed ? 'fa-sort-amount-up' : 'fa-sort-amount-down'}\"></i>\n            </button>\n        `\n      : '';\n\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n    <div class=\"acu-title-main\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> <span class=\"acu-title-text\">${escapeHtml(tableName)}</span></div>\n    <div class=\"acu-title-sub\">(${startIdx + 1}-${Math.min(endIdx, totalItems)} / ${totalItems})${isReversed ? ' <span style=\"color:var(--acu-accent);\"></span>' : ''}</div>\n</div>\n                <div class=\"acu-header-actions\">\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn\" id=\"acu-btn-relation-graph\" data-table=\"${escapeHtml(tableName)}\" title=\"\"><i class=\"fa-solid fa-project-diagram\"></i></button>` : ''}\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn acu-table-map-btn\" title=\"\"><i class=\"fa-solid fa-map\"></i></button>` : ''}\n                    ${reverseBtnHtml}\n                    <button class=\"acu-view-btn\" id=\"acu-btn-switch-style\" data-table=\"${escapeHtml(tableName)}\" title=\"  (: ${isGridMode ? '' : ''})\">\n                        <i class=\"fa-solid ${isGridMode ? 'fa-th-large' : 'fa-list'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${escapeHtml(tableName)}\" title=\"  | \"></i>\n                    </div>\n\n                    <div class=\"acu-search-wrapper\"><i class=\"fa-solid fa-search acu-search-icon\"></i><input type=\"text\" class=\"acu-search-input\" placeholder=\"...\" value=\"${(tableSearchStates[tableName] || '').replace(/\"/g, '&quot;')}\" /></div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>\n            <div class=\"acu-panel-content\"><div class=\"acu-card-grid\">`;\n\n    html += rowsToRender\n      .map(item => {\n        const realRowIdx = item.originalIndex;\n        const row = item.data;\n        const isPending = pendingDeletions.includes(realRowIdx);\n        const cardTitle = row[titleColIndex] || '';\n        const showDefaultIndex = titleColIndex === 1;\n        const titleCellId = `${tableData.key}-${realRowIdx}-${titleColIndex}`;\n        const isTitleModified = window.acuModifiedSet && window.acuModifiedSet.has(titleCellId);\n        const isRowNew = currentDiffMap.has(`${tableName}-row-${realRowIdx}`);\n        let rowClass = '';\n        if (config.highlightNew) {\n          if (isTitleModified) rowClass = 'acu-highlight-manual';\n          else if (isRowNew) rowClass = 'acu-highlight-diff';\n        }\n\n        // \n        const validColIndices = row.map((_, i) => i).filter(i => i > 0 && i !== titleColIndex);\n        const isOddValidCount = validColIndices.length % 2 === 1;\n\n        const cardBody = row\n          .map((cell, cIdx) => {\n            if (cIdx <= 0 || cIdx === titleColIndex) return '';\n            // [] \"\"\n            const currentHeader = headers[cIdx - 1] || '';\n            if (currentHeader.includes('')) return '';\n            const isLastValidCol = cIdx === validColIndices[validColIndices.length - 1];\n            const spanFullRow = isLastValidCol && isOddValidCount;\n            // /\n            const rawHeaderName = headers[cIdx - 1] || '' + cIdx;\n\n            // [] \n            const lockRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n            const isThisFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, headers[cIdx - 1]);\n            const inlineLockIcon = isThisFieldLocked\n              ? '<i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:10px;opacity:0.7;margin-left:4px;\" title=\"\"></i>'\n              : '';\n\n            const headerName = rawHeaderName.replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n            const safeStr = str =>\n              String(str)\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#039;');\n            const rawStrOriginal = String(cell).trim();\n            const rawStr = replaceUserPlaceholders(rawStrOriginal);\n            const invalidPlaceholders = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n            if (invalidPlaceholders.includes(rawStr.toLowerCase())) {\n              return ''; // \n            }\n\n            let contentHtml = '';\n            let hideLabel = false; // \n            const splitRegex = /[;]/;\n\n            // [] \n            const isIdentityField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return lowerHeader.includes('');\n            };\n\n            const isAttributeField = headerName => {\n              if (!headerName) return false;\n              const lowerHeader = String(headerName).toLowerCase();\n              return (\n                lowerHeader.includes('') || lowerHeader.includes('') || lowerHeader.includes('')\n              );\n            };\n\n            //  ( \":92\"  \":92, :88\")\n            // [] \n            const parsedAttrs = isIdentityField(rawHeaderName) ? [] : parseAttributeString(rawStr);\n            // [] \n            if (isIdentityField(rawHeaderName)) {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            } else if (isRelationshipCell(rawStr, headerName)) {\n              // [] \n              const relations = parseRelationshipString(rawStr);\n              // [] \n              const validRelations = relations.filter(rel => {\n                if (!rel.relation) return true; // \n                return !invalidPlaceholders.includes(rel.relation.toLowerCase());\n              });\n\n              if (validRelations.length > 1) {\n                hideLabel = true;\n                let relHtml = '';\n                for (let i = 0; i < validRelations.length; i++) {\n                  const rel = validRelations[i];\n                  const borderStyle =\n                    i < validRelations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                  relHtml += '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;' + borderStyle + '\">';\n                  relHtml +=\n                    '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' +\n                    safeStr(rel.name) +\n                    inlineLockIcon +\n                    '</span>';\n                  if (rel.relation) {\n                    relHtml +=\n                      '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                      safeStr(rel.relation) +\n                      '</span>';\n                  }\n                  relHtml += '</div>';\n                }\n                contentHtml = '<div class=\"acu-relation-container\">' + relHtml + '</div>';\n              } else if (validRelations.length === 1) {\n                hideLabel = true;\n                const rel = validRelations[0];\n                contentHtml = '<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;\">';\n                contentHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' +\n                  safeStr(rel.name) +\n                  inlineLockIcon +\n                  '</span>';\n                if (rel.relation) {\n                  contentHtml +=\n                    '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                    safeStr(rel.relation) +\n                    '</span>';\n                }\n                contentHtml += '</div>';\n              }\n            } else if (parsedAttrs.length > 1) {\n              // 2\n              hideLabel = true;\n              let attrsHtml = '';\n              for (let i = 0; i < parsedAttrs.length; i++) {\n                const attr = parsedAttrs[i];\n                const showDice = !BlacklistManager.isBlacklisted(attr.name);\n                attrsHtml +=\n                  '<div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 0;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.9em;white-space:nowrap;\" title=\"' +\n                  safeStr(attr.name) +\n                  '\">' +\n                  safeStr(attr.name.length > 3 ? attr.name.substring(0, 5) : attr.name) +\n                  inlineLockIcon +\n                  '</span>';\n                attrsHtml += '<div style=\"display:flex;align-items:center;gap:4px;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-main);font-weight:bold;font-size:0.95em;\">' +\n                  attr.value +\n                  '</span>';\n                if (showDice) {\n                  attrsHtml +=\n                    '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                    safeStr(attr.name) +\n                    '\" data-attr-value=\"' +\n                    attr.value +\n                    '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:10px;\" title=\"\"></i>';\n                }\n                attrsHtml += '</div></div>';\n              }\n              contentHtml = '<div class=\"acu-multi-attr-container\">' + attrsHtml + '</div>';\n            } else if (parsedAttrs.length === 1) {\n              //  ( \":92\") - \n              hideLabel = true;\n              const attr = parsedAttrs[0];\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml +=\n                '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' +\n                safeStr(attr.name) +\n                inlineLockIcon +\n                '</span>';\n              contentHtml += '<div style=\"display:flex;align-items:center;gap:6px;\">';\n              contentHtml += '<span style=\"color:var(--acu-text-main);font-weight:bold;\">' + attr.value + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(attr.name) +\n                  '\" data-attr-value=\"' +\n                  attr.value +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div></div>';\n            } else if (rawStr.length > 0 && splitRegex.test(rawStr) && !rawStr.includes('http')) {\n              // [] \n              const invalidTagValues = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n              const parts = rawStr\n                .split(splitRegex)\n                .map(s => s.trim())\n                .filter(s => s && !invalidTagValues.includes(s.toLowerCase()));\n              const allShort = parts.length > 1 && parts.every(p => p.length <= 6);\n              if (allShort) {\n                const tagsHtml = parts\n                  .map(part => {\n                    const subStyle = getBadgeStyle(part) || 'acu-badge-neutral';\n                    return '<span class=\"acu-badge ' + subStyle + '\">' + safeStr(part) + '</span>';\n                  })\n                  .join('');\n                contentHtml = '<div class=\"acu-tag-container\">' + tagsHtml + '</div>';\n              } else if (parts.length > 0) {\n                // \n                contentHtml = safeStr(parts.join('; '));\n              } else {\n                // \n                contentHtml = '';\n              }\n            } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n              // \n              const numVal = extractNumericValue(rawStr);\n              const showDice = !BlacklistManager.isBlacklisted(headerName);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml += '<span>' + safeStr(rawStr) + '</span>';\n              if (showDice) {\n                contentHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(headerName) +\n                  '\" data-attr-value=\"' +\n                  numVal +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              }\n              contentHtml += '</div>';\n            } else {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            }\n\n            const isDiffChanged = currentDiffMap.has(tableName + '-' + realRowIdx + '-' + cIdx);\n            const cellId = tableData.key + '-' + realRowIdx + '-' + cIdx;\n            const isUserModified = window.acuModifiedSet && window.acuModifiedSet.has(cellId);\n            let cellHighlight = '';\n            if (config.highlightNew) {\n              if (isUserModified) cellHighlight = 'acu-highlight-manual';\n              else if (isDiffChanged) cellHighlight = 'acu-highlight-diff';\n            }\n\n            //  class\n            //  ()\n\n            const rowClass =\n              'acu-card-row acu-cell' +\n              (spanFullRow ? ' acu-grid-span-full' : '') +\n              (hideLabel ? ' acu-hide-label' : '');\n\n            return (\n              '<div class=\"' +\n              rowClass +\n              '\" data-key=\"' +\n              escapeHtml(tableData.key) +\n              '\" data-tname=\"' +\n              escapeHtml(tableName) +\n              '\" data-row=\"' +\n              realRowIdx +\n              '\" data-col=\"' +\n              cIdx +\n              '\" data-val=\"' +\n              encodeURIComponent(cell ?? '') +\n              '\"><div class=\"acu-card-label\">' +\n              headerName +\n              inlineLockIcon +\n              '</div><div class=\"acu-card-value ' +\n              cellHighlight +\n              '\">' +\n              contentHtml +\n              '</div></div>'\n            );\n          })\n          .join('');\n\n        // []  acu-card-body  view-grid  view-list \n        // [] HTML\n        let tableActions = getActionsForTable(tableName);\n        let actionsHtml = '';\n\n        // [] \"\"\n        const interactColIdx = headers.findIndex(h => h && h.includes(''));\n        if (interactColIdx >= 0 && row[interactColIdx + 1]) {\n          // -nullnoneN/A \n          const invalidValues = ['-', 'null', 'none', '', '', 'n/a', 'undefined', '/'];\n          const interactOptions = String(row[interactColIdx + 1])\n            .split(/[,;]/)\n            .map(s => s.trim())\n            .filter(s => s && !invalidValues.includes(s.toLowerCase()));\n          if (interactOptions.length > 0) {\n            // \n            const existingLabels = tableActions.map(a => a.label.toLowerCase());\n            // \n            const iconMap = {\n              : 'fa-hand-fist',\n              : 'fa-hand-fist',\n              : 'fa-comments',\n              : 'fa-comments',\n              : 'fa-eye',\n              : 'fa-eye',\n              : 'fa-hand-pointer',\n              : 'fa-gift',\n              : 'fa-gift',\n              : 'fa-trash',\n              : 'fa-shield-halved',\n              : 'fa-calendar-check',\n              : 'fa-hand',\n              : 'fa-heart',\n              : 'fa-music',\n            };\n            // \n            const newActions = interactOptions\n              .filter(opt => !existingLabels.includes(opt.toLowerCase()))\n              .map(opt => ({\n                label: opt,\n                icon: iconMap[opt] || 'fa-hand-pointer',\n                type: 'prompt',\n                template: `<user>${opt}{Name}`,\n                auto_send: true,\n              }));\n            //  + \n            tableActions = [...tableActions, ...newActions];\n          }\n        }\n\n        if (tableActions.length > 0) {\n          const cardTitle = row[titleColIndex] || '';\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardLockRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n        const isCardRowLocked = cardLockRowKey && LockManager.isRowLocked(tableName, cardLockRowKey);\n        const cardLockIcon = isCardRowLocked\n          ? ' <i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:11px;opacity:0.8;\" title=\"\"></i>'\n          : '';\n\n        // bookmark\n        const cardBookmarkRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n        const isBookmarked = cardBookmarkRowKey && BookmarkManager.isBookmarked(tableName, cardBookmarkRowKey);\n        const bookmarkIcon = cardBookmarkRowKey\n          ? `<i class=\"${isBookmarked ? 'fa-solid' : 'fa-regular'} fa-bookmark acu-bookmark-icon ${isBookmarked ? 'bookmarked' : ''}\" data-table=\"${escapeHtml(tableName)}\" data-row-key=\"${escapeHtml(cardBookmarkRowKey)}\" title=\"${isBookmarked ? '' : ''}\"></i>`\n          : '';\n\n        return `<div class=\"acu-data-card ${isPending ? 'pending-deletion' : ''}\"><div class=\"acu-card-header\"><span class=\"acu-card-index\">${showDefaultIndex ? '#' + (realRowIdx + 1) : ''}</span><span class=\"acu-cell acu-editable-title ${rowClass}\" data-key=\"${escapeHtml(tableData.key)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(cardTitle ?? '')}\" title=\"\">${escapeHtml(cardTitle)}${cardLockIcon}</span>${bookmarkIcon}</div><div class=\"acu-card-body ${isGridMode ? 'view-grid' : 'view-list'}\">${cardBody}</div>${actionsHtml}</div>`;\n      })\n      .join('');\n    html += `</div></div>`;\n\n    if (totalPages > 1) {\n      html += `<div class=\"acu-panel-footer\"><button class=\"acu-page-btn ${currentPage === 1 ? 'disabled' : ''}\" data-page=\"${currentPage - 1}\" ${currentPage === 1 ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-left\"></i></button>`;\n      const range = [];\n      if (totalPages <= 7) {\n        for (let i = 1; i <= totalPages; i++) range.push(i);\n      } else {\n        if (currentPage <= 4) range.push(1, 2, 3, 4, 5, '...', totalPages);\n        else if (currentPage >= totalPages - 3)\n          range.push(1, '...', totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1, totalPages);\n        else range.push(1, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages);\n      }\n      range.forEach(p => {\n        if (p === '...') html += `<span class=\"acu-page-info\">...</span>`;\n        else html += `<button class=\"acu-page-btn ${p === currentPage ? 'active' : ''}\" data-page=\"${p}\">${p}</button>`;\n      });\n      html += `<button class=\"acu-page-btn ${currentPage === totalPages ? 'disabled' : ''}\" data-page=\"${currentPage + 1}\" ${currentPage === totalPages ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-right\"></i></button></div>`;\n    }\n    return html;\n  };\n\n  // []  ( + )\n  const saveCurrentTabState = () => {\n    const { $ } = getCore();\n    const activeTab = getActiveTabState();\n    const $content = $('.acu-panel-content');\n\n    if (activeTab && $content.length) {\n      const innerScrolls = {};\n      // \n      $content.find('.acu-data-card, .acu-card-body, .acu-edit-textarea').each(function () {\n        if (this.scrollTop > 0) {\n          //  (Row Index)\n          const $card = $(this).closest('.acu-data-card');\n          const rIdx = $card.find('.acu-editable-title').data('row');\n          // \n          const isEdit = $(this).hasClass('acu-edit-textarea');\n\n          if (rIdx !== undefined) {\n            const key = isEdit ? `edit-${rIdx}` : rIdx;\n            innerScrolls[key] = this.scrollTop;\n          }\n        }\n      });\n\n      // \n      tableScrollStates[activeTab] = {\n        left: $content.scrollLeft(),\n        top: $content.scrollTop(),\n        inner: innerScrolls,\n        timestamp: Date.now(), // \n      };\n    }\n  };\n\n  const closePanel = () => {\n    const { $ } = getCore();\n    saveCurrentTabState(); // <--- \n\n    $('#acu-data-area').removeClass('visible');\n    $('.acu-nav-btn').removeClass('active');\n    saveActiveTabState(null);\n    // [] \n    // $('.acu-embedded-options-container').remove();\n  };\n\n  /**\n   *  - \n   * CSS opacity + visibility \n   * @param {Function} updateContentFn -  $panel \n   */\n  const switchPanel = updateContentFn => {\n    const { $ } = getCore();\n    const $panel = $('#acu-data-area');\n    const isVisible = $panel.hasClass('visible');\n\n    if (!isVisible) {\n      // \n      updateContentFn($panel);\n      $panel.addClass('visible');\n    } else {\n      // CSS transition \n      updateContentFn($panel);\n    }\n  };\n\n  const bindEvents = tables => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    // [] -\n    $wrapper.on('click', '.acu-dash-relation-graph-btn', function (e) {\n      e.stopPropagation();\n      const allTables = processJsonData(cachedRawData || getTableData());\n      const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n      if (npcResult && npcResult.data) {\n        showRelationshipGraph(npcResult.data);\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-map-btn', function (e) {\n      e.stopPropagation();\n      showMapVisualization();\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-avatar-manager-btn', function (e) {\n      e.stopPropagation();\n\n      try {\n        // \n        let allTables;\n        try {\n          const rawData = cachedRawData || getTableData();\n          allTables = processJsonData(rawData);\n        } catch (dataError) {\n          console.error(':', dataError);\n          throw new Error('');\n        }\n\n        if (!allTables || allTables.length === 0) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n        const playerResult = DashboardDataParser.findTable(allTables, 'player');\n\n        const nodeArr = [];\n\n        // \n        if (playerResult?.data?.rows?.[0]) {\n          const playerName = playerResult.data.rows[0][1];\n          if (playerName && typeof playerName === 'string' && playerName.trim()) {\n            nodeArr.push({ name: playerName.trim(), isPlayer: true });\n          }\n        }\n\n        // NPC\n        if (npcResult?.data?.rows && Array.isArray(npcResult.data.rows)) {\n          npcResult.data.rows.forEach((row, idx) => {\n            if (Array.isArray(row) && row[1]) {\n              const npcName = row[1];\n              if (typeof npcName === 'string' && npcName.trim()) {\n                nodeArr.push({ name: npcName.trim(), isPlayer: false, rowIndex: idx });\n              }\n            }\n          });\n        }\n\n        // \n        if (nodeArr.length === 0) {\n          if (window.toastr) {\n            window.toastr.warning('NPC');\n          }\n          return;\n        }\n\n        // \n        try {\n          showAvatarManager(nodeArr, () => renderInterface());\n        } catch (managerError) {\n          console.error('showAvatarManager :', managerError);\n          throw new Error('');\n        }\n      } catch (error) {\n        // \n        console.error(':', error);\n\n        // \n        const errorMsg = error instanceof Error ? error.message : '';\n        if (window.toastr) {\n          window.toastr.error(`: ${errorMsg}`);\n        }\n      }\n    });\n    // \n    $wrapper.on('click', '.acu-dash-table-link', function (e) {\n      e.stopPropagation();\n      const tableName = $(this).data('table');\n      if (tableName) {\n        Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        saveActiveTabState(tableName);\n        renderInterface();\n      }\n    });\n\n    // []  SillyTavern\"\"\n    $('.acu-panel-content')\n      .off('touchstart.acu_swipe touchmove.acu_swipe')\n      .on('touchstart.acu_swipe', function (e) {\n        this._touchStartX = e.originalEvent.touches[0].clientX;\n        this._touchStartY = e.originalEvent.touches[0].clientY;\n      })\n      .on('touchmove.acu_swipe', function (e) {\n        if (!this._touchStartX) return;\n        const deltaX = Math.abs(e.originalEvent.touches[0].clientX - this._touchStartX);\n        const deltaY = Math.abs(e.originalEvent.touches[0].clientY - this._touchStartY);\n        // 45\n        if (deltaX > deltaY && deltaX > 10) {\n          e.stopPropagation();\n        }\n      });\n\n    $('body')\n      .off('click.acu_nav_toggle')\n      .on('click.acu_nav_toggle', '.acu-nav-toggle-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        const currentState = getCollapsedState();\n        saveCollapsedState(!currentState);\n        renderInterface();\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_opt_toggle')\n      .on('click.acu_opt_toggle', '.acu-opt-header[data-action=\"toggle-options\"]', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const currentState = getOptionsCollapsedState();\n        saveOptionsCollapsedState(!currentState);\n        renderInterface();\n      });\n\n    const $panel = $('.acu-panel-content');\n    if ($panel.length) {\n      // [] \n      let scrollTimer = null;\n      $panel.off('scroll.acu_save').on('scroll.acu_save', function () {\n        const $this = $(this);\n        if (scrollTimer) clearTimeout(scrollTimer);\n        scrollTimer = setTimeout(() => {\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            if (!tableScrollStates[activeTab]) tableScrollStates[activeTab] = { top: 0, left: 0, inner: {} };\n            tableScrollStates[activeTab].top = $this.scrollTop();\n            tableScrollStates[activeTab].left = $this.scrollLeft();\n            // \n          }\n        }, 200);\n      });\n    }\n\n    $('body')\n      .off('click.acu_delegate')\n      .on('click.acu_delegate', '.acu-wrapper', function (e) {\n        if (isEditingOrder) return;\n        const $target = $(e.target);\n\n        // []  - \n        const $settingsBtn = $target.closest('#acu-btn-settings');\n        if ($settingsBtn.length) {\n          e.stopPropagation();\n          e.preventDefault();\n          showSettingsModal();\n          return;\n        }\n\n        const $navBtn = $target.closest('.acu-nav-btn');\n        if ($navBtn.length) {\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-dashboard') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isDashboardActive && isPanelVisible) {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, true);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                const rawData = cachedRawData || getTableData();\n                const tables = processJsonData(rawData || {});\n                $panel.html(renderDashboard(tables));\n                bindEvents(tables);\n              });\n            }\n            return false;\n          }\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-changes') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isChangesActive = Store.get('acu_changes_panel_active', false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isChangesActive && isPanelVisible) {\n              // \n              Store.set('acu_changes_panel_active', false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set('acu_changes_panel_active', true);\n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                const rawData = cachedRawData || getTableData();\n                $panel.html(renderChangesPanel(rawData));\n                bindChangesEvents();\n              });\n            }\n            return false;\n          }\n          // [] MVU\n          if ($navBtn.attr('id') === 'acu-btn-mvu') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isMvuActive && isPanelVisible) {\n              // \n              saveActiveTabState(null);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              Store.set('acu_changes_panel_active', false);\n              saveActiveTabState(MvuModule.MODULE_ID);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n\n              //  switchPanel \n              switchPanel($panel => {\n                try {\n                  const panelHtml = MvuModule.renderPanel();\n                  // \n                  const mvuSavedHeight = getTableHeights()[MvuModule.MODULE_ID];\n                  if (mvuSavedHeight) {\n                    $panel.css('height', mvuSavedHeight + 'px').addClass('acu-manual-mode');\n                  } else {\n                    $panel.css('height', '').removeClass('acu-manual-mode');\n                  }\n                  $panel.html('<div class=\"acu-mvu-panel\">' + panelHtml + '</div>');\n                  MvuModule.bindEvents($panel);\n                } catch (error) {\n                  console.error('[MVU] Error rendering panel:', error);\n                }\n\n                // \n                MvuModule.getDataWithRetry(5, 800)\n                  .then(mvuData => {\n                    // \n                    if (mvuData) {\n                      $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                      MvuModule.bindEvents($panel);\n                    }\n                  })\n                  .catch(err => {\n                    console.error('[DICE]MvuModule Error getting data:', err);\n                    // \n                    $panel.html('<div class=\"acu-mvu-panel\">' + MvuModule.renderPanel() + '</div>');\n                    MvuModule.bindEvents($panel);\n                  });\n              });\n            }\n            return false;\n          }\n          e.stopPropagation();\n          // [] \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          Store.set('acu_changes_panel_active', false);\n          const tableName = $navBtn.data('table');\n          const currentActiveTab = getActiveTabState();\n          if (currentActiveTab === tableName && $('#acu-data-area').hasClass('visible')) {\n            closePanel();\n            return;\n          }\n          $('.acu-nav-btn').removeClass('active');\n          $navBtn.addClass('active');\n          if ($('.acu-panel-content').length && currentActiveTab) {\n            saveCurrentTabState();\n          }\n          saveActiveTabState(tableName);\n          setTimeout(() => renderInterface(), 0);\n          return;\n        }\n        const $cell = $target.closest('.acu-cell');\n        if ($cell.length) {\n          e.stopPropagation();\n          showCellMenu(e, $cell[0]);\n          return;\n        }\n        const $pageBtn = $target.closest('.acu-page-btn');\n        if ($pageBtn.length) {\n          e.stopPropagation();\n          if ($pageBtn.hasClass('disabled') || $pageBtn.hasClass('active')) return;\n          const newPage = parseInt($pageBtn.data('page'));\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tablePageStates[activeTab] = newPage;\n            renderInterface();\n            requestAnimationFrame(() => {\n              $('.acu-panel-content').scrollTop(0);\n            });\n          }\n          return;\n        }\n        return;\n      });\n\n    $('#acu-btn-expand')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(false);\n        renderInterface();\n      });\n    // [] \n    $('#acu-btn-collapse')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(true);\n        renderInterface();\n      });\n\n    // []  =  (Instant Revert)\n    $('#acu-btn-refresh')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n\n        // [] \n        if (isEditingOrder) return;\n\n        // 1. \n        if (isSaving) {\n          if (window.toastr) window.toastr.warning(' ...');\n          return;\n        }\n\n        const $btn = $(e.currentTarget);\n        const $icon = $btn.find('i');\n        // $icon.addClass('fa-spin'); // \n\n        // 2.  ()\n        // (1) \n        savePendingDeletions({});\n\n        // (2)  -> \n        cachedRawData = null;\n\n        // (3) \n        hasUnsavedChanges = false;\n        currentDiffMap.clear();\n        if (window.acuModifiedSet) window.acuModifiedSet.clear();\n\n        // (4)  ()\n        const $saveBtn = $('#acu-btn-save-global');\n        $saveBtn.find('i').removeClass('acu-icon-breathe');\n        $saveBtn.attr('title', '').css('color', '');\n\n        // 3.  300ms \n        // await new Promise(r => setTimeout(r, 300)); // <--- \n\n        // Last SnapshotAPI\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          cachedRawData = snapshot; // \n        }\n\n        // 4. \n        // \n        $('.acu-edit-overlay, .acu-cell-menu, .acu-menu-backdrop').remove();\n\n        // \n        renderInterface();\n\n        // $icon.removeClass('fa-spin');\n      });\n\n    // [] \n    $('#acu-btn-force-update')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          if (window.toastr) {\n            window.toastr.warning('  manualUpdate ', '', {\n              timeOut: 5000,\n            });\n          }\n        }\n      });\n    $('body')\n      .off('click.acu_settings')\n      .on('click.acu_settings', '#acu-btn-settings', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        showSettingsModal();\n      });\n    // [] \n    $('#acu-btn-dice-nav')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        showDicePanel({\n          targetValue: null,\n          targetName: '',\n          //  diceType\n        });\n      });\n\n    /* // \n    $('#acu-btn-open-editor').off('click').on('click', (e) => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.openVisualizer === 'function') {\n            api.openVisualizer();\n        } else if (window.toastr) {\n            window.toastr.warning('()');\n        }\n    });\n    */\n\n    // \n    $('#acu-btn-refill')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            console.log('[DICE]ACU ');\n            //  manualUpdate \n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[DICE]ACU :', err);\n            const errorMessage = err.message || '';\n            if (window.toastr) {\n              window.toastr.error(`: ${errorMessage}`, '', { timeOut: 5000 });\n            } else {\n              alert(`: ${errorMessage}`);\n            }\n          }\n        } else {\n          console.warn('[DICE]ACU manualUpdate API ');\n          if (window.toastr) {\n            window.toastr.warning(' manualUpdate ', '', { timeOut: 3000 });\n          }\n        }\n      });\n    $('#acu-btn-save-global')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        let dataToSave = null;\n        if (hasUnsavedChanges && cachedRawData) {\n          dataToSave = cachedRawData;\n        } else {\n          dataToSave = getTableData();\n        }\n\n        if (dataToSave) {\n          // 1.  false  true\n          await saveDataToDatabase(dataToSave, true, true);\n\n          // 2. \n          // \n          $('.acu-highlight-manual').removeClass('acu-highlight-manual');\n\n          // 3. \n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          hasUnsavedChanges = false;\n\n          // 4. \n          const $btn = $(this);\n          const $icon = $btn.find('i');\n          $icon.removeClass('acu-icon-breathe fa-spinner fa-spin').addClass('fa-save');\n          $btn.attr('title', '').css('color', '');\n          $btn.prop('disabled', false);\n\n          // 5. \n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    const $searchInput = $('.acu-search-input');\n    if ($searchInput.length) {\n      let searchTimeout;\n      let isComposing = false;\n      $searchInput\n        .off('compositionstart compositionend input')\n        .on('compositionstart', () => {\n          isComposing = true;\n        })\n        .on('compositionend', function () {\n          isComposing = false;\n          const val = $(this).val();\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tableSearchStates[activeTab] = val;\n            tablePageStates[activeTab] = 1;\n            renderInterface();\n            setTimeout(() => {\n              $('.acu-search-input').focus();\n            }, 0);\n          }\n        })\n        .on('input', function () {\n          if (isComposing) return;\n          const val = $(this).val();\n          const selectionStart = this.selectionStart;\n          const selectionEnd = this.selectionEnd;\n          clearTimeout(searchTimeout);\n          searchTimeout = setTimeout(() => {\n            const activeTab = getActiveTabState();\n            if (activeTab) {\n              tableSearchStates[activeTab] = val;\n              tablePageStates[activeTab] = 1;\n              const isFocus = document.activeElement && document.activeElement.classList.contains('acu-search-input');\n              renderInterface();\n              if (isFocus) {\n                const $newInput = $('.acu-search-input');\n                $newInput.focus();\n                if ($newInput.length && $newInput[0].setSelectionRange) {\n                  try {\n                    $newInput[0].setSelectionRange(selectionStart, selectionEnd);\n                  } catch (e) {}\n                }\n              }\n            }\n          }, 300);\n        });\n    }\n    // \n    $('#acu-btn-relation-graph')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const rawData = cachedRawData || getTableData();\n        if (rawData) {\n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (sheet?.name === tableName) {\n              const tableData = {\n                headers: sheet.content?.[0] || [],\n                rows: sheet.content?.slice(1) || [],\n                key: key,\n              };\n              showRelationshipGraph(tableData);\n              return;\n            }\n          }\n        }\n        if (window.toastr) window.toastr.warning('');\n      });\n    // \n    $('.acu-table-map-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        showMapVisualization();\n      });\n    // --- []  ---\n\n    // 1. \n    $('#acu-btn-switch-style')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const styles = getTableStyles();\n        const current = styles[tableName] || 'list';\n        styles[tableName] = current === 'grid' ? 'list' : 'grid'; // \n        saveTableStyles(styles);\n        renderInterface(); // \n      });\n\n    // 2. \n    $('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          if (tableName) {\n            const heights = getTableHeights();\n            heights[tableName] = parseInt($panel.css('height'));\n            saveTableHeights(heights);\n            $panel.addClass('acu-manual-mode');\n          }\n        };\n      });\n\n    // 3.  - \n    $('.acu-height-drag-handle')\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    // [] \n    $wrapper.on('click', '.acu-reverse-btn', function (e) {\n      e.stopPropagation();\n      const tName = $(this).data('table');\n      if (!tName) return;\n\n      toggleTableReverse(tName);\n\n      // \n      renderInterface();\n    });\n    // [] \n    $('.acu-panel-header')\n      .off('dblclick.acu')\n      .on('dblclick.acu', function (e) {\n        if ($(e.target).closest('.acu-search-input, .acu-close-btn, .acu-view-btn').length) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = getActiveTabState();\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    $('.acu-close-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $input = $('.acu-search-input');\n\n        // \n        if ($input.length && $input.val()) {\n          $input.val('').trigger('input').focus();\n          return;\n        }\n\n        // \n        const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        if (isDashboardActive) {\n          // \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n        if (isMvuActive) {\n          // \n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        closePanel();\n      });\n    // [] bookmark\n    $('body')\n      .off('click.acu_bookmark')\n      .on('click.acu_bookmark', '.acu-bookmark-icon', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $icon = $(this);\n        const tableName = $icon.data('table');\n        const rowKey = $icon.data('row-key');\n\n        if (!tableName || !rowKey) return;\n\n        // bookmark\n        BookmarkManager.toggleBookmark(tableName, rowKey);\n\n        // \n        if (typeof renderInterface === 'function') {\n          renderInterface();\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_action')\n      .on('click.acu_action', '.acu-action-item', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $btn = $(this);\n        const rowIdx = parseInt($btn.data('row'), 10);\n        const actionIdx = parseInt($btn.data('action-idx'), 10);\n\n        // \n        const $card = $btn.closest('.acu-data-card');\n        const $title = $card.find('.acu-editable-title');\n        const tableKey = $title.data('key');\n        const tableName = $title.data('tname') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const headers = rawData[tableKey].content[0] || [];\n        const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n\n        // \n        const invalidValues = ['-', 'null', 'none', '', '', 'n/a', 'undefined', '/'];\n\n        // \n        let actions = getActionsForTable(tableName);\n\n        // \"\"\n        const interactColIdx = headers.findIndex(h => h && String(h).includes(''));\n        if (interactColIdx >= 0 && rowData[interactColIdx]) {\n          const cellValue = String(rowData[interactColIdx]).trim();\n          if (cellValue && !invalidValues.includes(cellValue.toLowerCase())) {\n            const interactOptions = cellValue\n              .split(/[,;]/)\n              .map(s => s.trim())\n              .filter(s => s && !invalidValues.includes(s.toLowerCase()));\n            if (interactOptions.length > 0) {\n              // \n              const existingLabels = actions.map(a => a.label.toLowerCase());\n              // \n              const newActions = interactOptions\n                .filter(opt => !existingLabels.includes(opt.toLowerCase()))\n                .map(opt => ({\n                  label: opt,\n                  icon: 'fa-hand-pointer',\n                  type: 'prompt',\n                  template: `<user>{Name}${opt}`,\n                  auto_send: true,\n                }));\n              //  + \n              actions = [...actions, ...newActions];\n            }\n          }\n        }\n\n        const action = actions[actionIdx];\n\n        // [] \n        if (action && action.type === 'skill_check') {\n          const skillName = rowData[1] || '';\n\n          // \n          let checkValue = null;\n          const attrValIdx = headers.findIndex(h => h && h.includes(''));\n          const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n          // \n          if (attrValIdx > 0 && rowData[attrValIdx]) {\n            const val = extractNumericValue(rowData[attrValIdx]);\n            if (val > 0) checkValue = val;\n          }\n          // \n          if (checkValue === null && profIdx > 0 && rowData[profIdx]) {\n            const val = extractNumericValue(rowData[profIdx]);\n            if (val > 0) checkValue = val;\n          }\n\n          // \n          const promptText = processTemplate(action.template, rowData, headers);\n          smartInsertToTextarea(promptText, 'action');\n\n          // \n          if (checkValue !== null && checkValue > 0) {\n            showDicePanel({\n              targetValue: checkValue,\n              targetName: skillName,\n              initiatorName: '<user>',\n            });\n          } else {\n            $('#send_textarea').focus();\n          }\n          return;\n        }\n\n        if (action && action.template) {\n          // \n          const rawData = cachedRawData || getTableData();\n          if (rawData && rawData[tableKey]) {\n            const headers = rawData[tableKey].content[0] || [];\n            const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n            const npcName = rowData[1] || '';\n\n            // \"\"\n            if (action.label === '') {\n              const config = getConfig();\n              $('.acu-msg-overlay').remove();\n\n              const t = getThemeColors();\n\n              const overlay = $(`\n                        <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2147483647;display:flex;justify-content:center;align-items:center;\">\n                            <div style=\"background:${t.bgPanel};border:1px solid ${t.border};border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                                <div style=\"font-size:14px;font-weight:bold;color:${t.accent};margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                                    <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                                </div>\n                                <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:6px;color:${t.textMain} !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                                <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                                    <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:6px;color:${t.textMain};cursor:pointer;\"></button>\n                                    <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:${t.btnActiveBg};border:none;border-radius:6px;color:${t.btnActiveText};cursor:pointer;font-weight:bold;\"></button>\n                                </div>\n                            </div>\n                        </div>\n                    `);\n\n              $('body').append(overlay);\n              // []  JS  overlay \n              const overlayEl = overlay[0];\n              overlayEl.style.setProperty('position', 'fixed', 'important');\n              overlayEl.style.setProperty('top', '0', 'important');\n              overlayEl.style.setProperty('left', '0', 'important');\n              overlayEl.style.setProperty('right', '0', 'important');\n              overlayEl.style.setProperty('bottom', '0', 'important');\n              overlayEl.style.setProperty('width', '100vw', 'important');\n              overlayEl.style.setProperty('height', '100vh', 'important');\n              overlayEl.style.setProperty('display', 'flex', 'important');\n              overlayEl.style.setProperty('justify-content', 'center', 'important');\n              overlayEl.style.setProperty('align-items', 'center', 'important');\n              overlayEl.style.setProperty('z-index', '2147483650', 'important');\n              setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n              const sendMessage = () => {\n                const msg = overlay.find('#acu-msg-input').val().trim();\n                if (msg) {\n                  const promptText = `<user>${npcName}\"${msg}\"`;\n                  smartInsertToTextarea(promptText, 'action');\n                  $('#send_textarea').focus();\n                }\n                overlay.remove();\n              };\n\n              overlay.find('#acu-msg-send').click(sendMessage);\n              overlay.find('#acu-msg-input').on('keydown', function (ev) {\n                if (ev.key === 'Enter') {\n                  ev.preventDefault();\n                  sendMessage();\n                }\n              });\n              overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n              overlay.on('click', function (ev) {\n                if ($(ev.target).hasClass('acu-msg-overlay')) overlay.remove();\n              });\n              return;\n            }\n\n            //  processTemplate \n            const promptText = processTemplate(action.template, rowData, headers);\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_global_dice')\n      .on('click.acu_global_dice', '#acu-btn-dice', function (e) {\n        e.stopPropagation();\n        showDicePanel({\n          targetValue: 50,\n          targetName: '',\n          diceType: '1d100',\n        });\n      });\n    // ========== [] ==========\n    // /\n    $('body')\n      .off('click.acu_location_toggle')\n      .on('click.acu_location_toggle', '.acu-location-header', function (e) {\n        e.stopPropagation();\n        const $group = $(this).closest('.acu-location-group');\n        $group.toggleClass('expanded');\n      });\n\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_jump')\n      .on('click.acu_dash_jump', '.acu-dash-jump-link, .acu-dash-loc-item', function (e) {\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const searchTerm = $(this).data('search') || '';\n\n        if (tableName) {\n          // 1. \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n\n          // 2. \n          saveActiveTabState(tableName);\n\n          // 3. \n          if (searchTerm) {\n            tableSearchStates[tableName] = searchTerm;\n            tablePageStates[tableName] = 1;\n          }\n\n          // 4. \n          renderInterface();\n\n          // 5. \n          if (searchTerm) {\n            setTimeout(() => {\n              const $input = $('.acu-search-input');\n              if ($input.length) $input.focus();\n            }, 100);\n          }\n        }\n      });\n    // ========== [] ==========\n    // [] \n    $('body')\n      .off('click.acu_inline_dice')\n      .on('click.acu_inline_dice', '.acu-inline-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        //  .attr()  jQuery \n        const attrName = $(this).attr('data-attr-name') || '';\n        const attrValue = parseInt($(this).attr('data-attr-value'), 10) || 50;\n\n        // NPC\n        const $card = $(this).closest('.acu-data-card');\n        const cardTitle = $card.find('.acu-editable-title').text().trim();\n\n        // <user>\n        const tableName = $card.find('.acu-editable-title').data('tname') || '';\n        const isPlayerTable = tableName.includes('');\n        const initiatorName = isPlayerTable ? '<user>' : cardTitle;\n\n        showDicePanel({\n          attrValue: attrValue,\n          targetValue: null, // showDicePanel\n          targetName: attrName,\n          initiatorName: initiatorName,\n          //  diceType\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_dice')\n      .on('click.acu_dash_dice', '.acu-dash-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const targetValue = parseInt($(this).data('target'), 10) || 50;\n        const targetName = $(this).data('name') || '';\n        const npcName = $(this).data('npc') || '';\n\n        // NPC\n        if (npcName) {\n          // \n          const playerAttrValue = getAttributeValue('<user>', targetName) || 50;\n          showContestPanel({\n            initiatorName: '<user>',\n            initiatorValue: playerAttrValue,\n            opponentName: npcName,\n            opponentValue: targetValue,\n          });\n        } else {\n          showDicePanel({\n            targetValue: targetValue,\n            targetName: targetName,\n            initiatorName: '<user>',\n          });\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_goto')\n      .on('click.acu_dash_goto', '.acu-dash-goto-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const locationName = $(this).data('location') || '';\n        const promptText = `<user>${locationName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_use_item')\n      .on('click.acu_dash_use_item', '.acu-dash-use-item-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const itemName = $(this).data('item') || '';\n        const promptText = `<user>${itemName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\" - \n    $('body')\n      .off('click.acu_dash_use_skill')\n      .on('click.acu_dash_use_skill', '.acu-dash-use-skill-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const skillName = $(this).data('skill') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        let checkValue = null;\n\n        if (rawData) {\n          // \n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n            if (sheet.name.includes('') || sheet.name.includes('')) {\n              const headers = sheet.content[0] || [];\n              // \n              const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n              const attrValIdx = headers.findIndex(h => h && h.includes(''));\n              const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n              for (let i = 1; i < sheet.content.length; i++) {\n                const row = sheet.content[i];\n                if (row && row[nameIdx === -1 ? 1 : nameIdx] === skillName) {\n                  // \n                  if (attrValIdx > 0 && row[attrValIdx]) {\n                    const val = extractNumericValue(row[attrValIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  // \n                  if (profIdx > 0 && row[profIdx]) {\n                    const val = extractNumericValue(row[profIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n              if (checkValue !== null) break;\n            }\n          }\n        }\n\n        // \n        const promptText = `<user>${skillName}`;\n        smartInsertToTextarea(promptText, 'action');\n\n        // \n        if (checkValue !== null && checkValue > 0) {\n          showDicePanel({\n            targetValue: checkValue,\n            targetName: skillName,\n            initiatorName: '<user>',\n          });\n        } else {\n          // \n          $('#send_textarea').focus();\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_track_task')\n      .on('click.acu_dash_track_task', '.acu-dash-track-task-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const taskName = $(this).data('task') || '';\n        const promptText = `<user>${taskName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_msg')\n      .on('click.acu_dash_msg', '.acu-dash-msg-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n        const config = getConfig();\n\n        // \n        $('.acu-msg-overlay').remove();\n\n        // \n        const t = getThemeColors();\n\n        const overlay = $(`\n            <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2147483647;display:flex;justify-content:center;align-items:center;\">\n                <div class=\"acu-msg-dialog\" style=\"background:${t.bgPanel};border:1px solid ${t.border};border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                    <div style=\"font-size:14px;font-weight:bold;color:${t.accent};margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                        <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                    </div>\n                    <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:6px;color:${t.textMain} !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                    <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                        <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:6px;color:${t.textMain};cursor:pointer;\"></button>\n                        <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:${t.btnActiveBg};border:none;border-radius:6px;color:${t.btnActiveText};cursor:pointer;font-weight:bold;\"></button>\n                    </div>\n                </div>\n            </div>\n        `);\n\n        $('body').append(overlay);\n        const overlayEl = overlay[0];\n        overlayEl.style.setProperty('position', 'fixed', 'important');\n        overlayEl.style.setProperty('top', '0', 'important');\n        overlayEl.style.setProperty('left', '0', 'important');\n        overlayEl.style.setProperty('right', '0', 'important');\n        overlayEl.style.setProperty('bottom', '0', 'important');\n        overlayEl.style.setProperty('width', '100vw', 'important');\n        overlayEl.style.setProperty('height', '100vh', 'important');\n        overlayEl.style.setProperty('display', 'flex', 'important');\n        overlayEl.style.setProperty('justify-content', 'center', 'important');\n        overlayEl.style.setProperty('align-items', 'center', 'important');\n        overlayEl.style.setProperty('z-index', '2147483650', 'important');\n        setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n        const sendMessage = () => {\n          const msg = overlay.find('#acu-msg-input').val().trim();\n          if (msg) {\n            const promptText = `<user>${npcName}\"${msg}\"`;\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n          overlay.remove();\n        };\n\n        // \n        overlay.find('#acu-msg-send').click(sendMessage);\n\n        // \n        overlay.find('#acu-msg-input').on('keydown', function (ev) {\n          if (ev.key === 'Enter') {\n            ev.preventDefault();\n            sendMessage();\n          }\n        });\n\n        // \n        overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n        overlay.on('click', function (ev) {\n          if ($(ev.target).hasClass('acu-msg-overlay')) overlay.remove();\n        });\n      });\n    // [] NPC\n    $('body')\n      .off('click.acu_dash_contest')\n      .on('click.acu_dash_contest', '.acu-dash-contest-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n\n        const rawData = cachedRawData || getTableData();\n\n        var playerAttrValue = 50;\n        var npcAttrValue = 50;\n        var foundPlayer = false;\n        var foundNPC = false;\n\n        if (rawData) {\n          for (var key in rawData) {\n            var sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n\n            // \n            if (sheet.name === '') {\n              if (sheet.content[1]) {\n                var attrStr = sheet.content[1][7] || '';\n                var parts = attrStr.split(/[,;\\s]+/);\n                for (var i = 0; i < parts.length; i++) {\n                  var match = parts[i].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                  if (match) {\n                    playerAttrValue = parseInt(match[2], 10);\n                    foundPlayer = true;\n                    break;\n                  }\n                }\n              }\n            }\n\n            // \n            if (sheet.name === '' && npcName) {\n              for (var j = 1; j < sheet.content.length; j++) {\n                var row = sheet.content[j];\n                if (row && row[1] === npcName) {\n                  var npcAttrStr = row[9] || '';\n                  var npcParts = npcAttrStr.split(/[,;\\s]+/);\n                  for (var k = 0; k < npcParts.length; k++) {\n                    var npcMatch = npcParts[k].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                    if (npcMatch) {\n                      npcAttrValue = parseInt(npcMatch[2], 10);\n                      foundNPC = true;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n            }\n          }\n        }\n\n        showContestPanel({\n          initiatorName: '<user>',\n          initiatorValue: playerAttrValue,\n          opponentName: npcName,\n          opponentValue: npcAttrValue,\n          diceType: '1d100',\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_preview')\n      .on('click.acu_dash_preview', '.acu-dash-preview-trigger', function (e) {\n        e.stopPropagation();\n\n        const tableKey = $(this).data('table-key');\n        const rowIndex = parseInt($(this).data('row-index'), 10);\n\n        if (!tableKey || isNaN(rowIndex)) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const table = rawData[tableKey];\n        const tableName = table.name || '';\n        const headers = table.content[0] || [];\n        const rowData = table.content[rowIndex + 1];\n\n        if (!rowData) return;\n\n        const config = getConfig();\n        const title = rowData[1] || '';\n\n        //  renderTableContent \n        const titleColIndex = 1;\n        const realRowIdx = rowIndex;\n\n        // \n        let cardBody = '';\n        rowData.forEach((cell, cIdx) => {\n          if (cIdx <= 0 || cIdx === titleColIndex) return;\n          const currentHeader = headers[cIdx] || '';\n          if (currentHeader.includes('')) return; // \n\n          const rawHeaderName = headers[cIdx] || '' + cIdx;\n          // /\n          const headerName = rawHeaderName.replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n          const rawStr = String(cell || '').trim();\n          if (!rawStr) return;\n\n          // [] \n          const lockRowKey = LockManager.getRowKey(tableName, rowData, headers);\n          const isThisFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, headerName);\n          const inlineLockIcon = isThisFieldLocked\n            ? '<i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:10px;opacity:0.7;margin-left:4px;\" title=\"\"></i>'\n            : '';\n\n          let contentHtml = '';\n          let hideLabel = false;\n\n          const parsedAttrs = parseAttributeString(rawStr);\n          // []  - \n          if (isRelationshipCell(rawStr, headerName)) {\n            const relations = parseRelationshipString(rawStr);\n            if (relations.length > 1) {\n              hideLabel = true;\n              let relHtml = '';\n              relations.forEach((rel, i) => {\n                const borderStyle = i < relations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                relHtml += `<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;${borderStyle}\">\n                              <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(rel.name)}${inlineLockIcon}</span>\n                              ${rel.relation ? `<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>` : ''}\n                          </div>`;\n              });\n              contentHtml = `<div class=\"acu-relation-container\">${relHtml}</div>`;\n            } else if (relations.length === 1) {\n              hideLabel = true;\n              const rel = relations[0];\n              contentHtml = `<div style=\"display:flex;align-items:center;gap:8px;padding:3px 0;\">\n                          <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(rel.name)}${inlineLockIcon}</span>\n                          ${rel.relation ? `<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>` : ''}\n                      </div>`;\n            }\n          } else if (parsedAttrs.length > 1) {\n            hideLabel = true;\n            let attrsHtml = '';\n            parsedAttrs.forEach((attr, i) => {\n              const showDice = !BlacklistManager.isBlacklisted(attr.name);\n              const borderStyle = i < parsedAttrs.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n              attrsHtml += `<div style=\"display:flex;justify-content:space-between;align-items:center;padding:3px 0;${borderStyle}\">\n                          <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(attr.name)}${inlineLockIcon}</span>\n                          <div style=\"display:flex;align-items:center;gap:6px;\">\n                              <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                              ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                          </div></div>`;\n            });\n            contentHtml = `<div class=\"acu-multi-attr-container\">${attrsHtml}</div>`;\n          } else if (parsedAttrs.length === 1) {\n            hideLabel = true;\n            const attr = parsedAttrs[0];\n            const showDice = !BlacklistManager.isBlacklisted(attr.name);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                      <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(attr.name)}${inlineLockIcon}</span>\n                      <div style=\"display:flex;align-items:center;gap:6px;\">\n                          <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                          ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>` : ''}\n                      </div></div>`;\n          } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n            const numVal = extractNumericValue(rawStr);\n            const showDice = !BlacklistManager.isBlacklisted(headerName);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                      <span>${escapeHtml(rawStr)}</span>\n                      ${showDice ? `<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(headerName)}\" data-attr-value=\"${numVal}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;margin-left:6px;\" title=\"\"></i>` : ''}\n                  </div>`;\n          } else {\n            const badgeStyle = getBadgeStyle(rawStr);\n            contentHtml = badgeStyle\n              ? `<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(rawStr)}</span>`\n              : escapeHtml(rawStr);\n          }\n\n          const rowClass = 'acu-card-row acu-cell' + (hideLabel ? ' acu-hide-label' : '');\n          cardBody += `<div class=\"${rowClass}\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${cIdx}\" data-val=\"${encodeURIComponent(cell ?? '')}\">\n                <div class=\"acu-card-label\">${escapeHtml(headerName)}</div>\n                <div class=\"acu-card-value\">${contentHtml}</div>\n            </div>`;\n        });\n\n        // \n        let actionsHtml = '';\n        let tableActions = getActionsForTable(tableName);\n        const interactColIdx = headers.findIndex(h => h && String(h).includes(''));\n        if (interactColIdx > 0 && rowData[interactColIdx]) {\n          const interactOptions = String(rowData[interactColIdx])\n            .split(/[,;]/)\n            .map(s => s.trim())\n            .filter(s => s);\n          if (interactOptions.length > 0) {\n            tableActions = interactOptions.map(opt => ({\n              label: opt,\n              icon: 'fa-hand-pointer',\n              type: 'prompt',\n              template: `<user>{Name}${opt}`,\n              auto_send: true,\n            }));\n          }\n        }\n        if (tableActions.length > 0) {\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardHtml = `\n            <div class=\"acu-preview-overlay acu-theme-${config.theme}\" style=\"--acu-card-width:${config.cardWidth}px;--acu-font-size:${config.fontSize}px;\">\n                <div class=\"acu-data-card\" style=\"width:90vw;max-width:420px;max-height:85vh;overflow-y:auto;\">\n                    <div class=\"acu-card-header\">\n                        <span class=\"acu-card-index\">#${realRowIdx + 1}</span>\n                        <span class=\"acu-cell acu-editable-title\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(title)}\">${escapeHtml(title)}</span>\n                        <button class=\"acu-preview-close\" style=\"margin-left:auto;background:none;border:none;color:var(--acu-text-sub);cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-card-body view-list\">${cardBody}</div>\n                    ${actionsHtml}\n                </div>\n            </div>\n        `;\n\n        $('.acu-preview-overlay').remove();\n        $('body').append(cardHtml);\n\n        // \n        const overlayEl = $('.acu-preview-overlay')[0];\n        if (overlayEl) {\n          overlayEl.style.setProperty('position', 'fixed', 'important');\n          overlayEl.style.setProperty('top', '0', 'important');\n          overlayEl.style.setProperty('left', '0', 'important');\n          overlayEl.style.setProperty('right', '0', 'important');\n          overlayEl.style.setProperty('bottom', '0', 'important');\n          overlayEl.style.setProperty('width', '100vw', 'important');\n          overlayEl.style.setProperty('height', '100vh', 'important');\n          overlayEl.style.setProperty('display', 'flex', 'important');\n          overlayEl.style.setProperty('justify-content', 'center', 'important');\n          overlayEl.style.setProperty('align-items', 'center', 'important');\n          overlayEl.style.setProperty('z-index', '2147483650', 'important');\n        }\n\n        // \n        $('.acu-preview-overlay').on('click', function (ev) {\n          if ($(ev.target).hasClass('acu-preview-overlay') || $(ev.target).closest('.acu-preview-close').length) {\n            $(this).remove();\n          }\n        });\n      });\n\n    // === []  ST  swipe regenerate ===\n    (function () {\n      const $doc = $(document);\n      let touchStartX = 0;\n      let touchStartY = 0;\n\n      //  data-area\n      $doc.on('touchstart.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length === 1) {\n          touchStartX = e.originalEvent.touches[0].clientX;\n          touchStartY = e.originalEvent.touches[0].clientY;\n        }\n      });\n\n      $doc.on('touchmove.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length !== 1) return;\n\n        const touch = e.originalEvent.touches[0];\n        const deltaX = Math.abs(touch.clientX - touchStartX);\n        const deltaY = Math.abs(touch.clientY - touchStartY);\n\n        // X > Y * 1.5\n        if (deltaX > deltaY * 1.5 && deltaX > 10) {\n          e.stopPropagation();\n          console.log('[DICE]ACU  ST swipe');\n        }\n      });\n    })();\n  };\n\n  let selectedSwapSource = null;\n  const toggleOrderEditMode = () => {\n    const { $ } = getCore();\n    isEditingOrder = !isEditingOrder;\n\n    const $container = $('#acu-nav-bar');\n    const $hint = $('#acu-order-hint');\n    const $pool = $('#acu-action-pool');\n\n    // \n    if (!$container.length) {\n      console.error('[DICE]ACU ');\n      isEditingOrder = false;\n      return;\n    }\n\n    selectedSwapSource = null;\n    $('.acu-swap-selected').removeClass('acu-swap-selected');\n\n    if (isEditingOrder) {\n      // \n      $container.addClass('editing-order');\n      if ($pool.length) $pool.addClass('visible');\n\n      if ($hint.length) {\n        $hint\n          .html(\n            `\n                    <div style=\"display:flex; justify-content:space-between; align-items:center; width:100%; flex-wrap:wrap; gap:8px;\">\n                        <div style=\"display:flex; align-items:center; gap:10px; flex:1; min-width:200px;\">\n                            <span><i class=\"fa-solid fa-layer-group\"></i> </span>\n                            <span style=\"font-size:11px; opacity:0.9; font-weight:normal;\"></span>\n                        </div>\n                        <button id=\"acu-btn-finish-sort\" style=\"background:rgba(255,255,255,0.2); color:#fff; border:1px solid rgba(255,255,255,0.4); padding:4px 14px; border-radius:4px; cursor:pointer; font-size:12px; transition:all 0.2s; white-space:nowrap;\">\n                            <i class=\"fa-solid fa-check\"></i> \n                        </button>\n                    </div>\n                `,\n          )\n          .addClass('visible')\n          .css('display', 'flex');\n\n        $('#acu-btn-finish-sort').hover(\n          function () {\n            $(this).css({ background: '#fff', color: 'var(--acu-accent)' });\n          },\n          function () {\n            $(this).css({ background: 'rgba(255,255,255,0.2)', color: '#fff' });\n          },\n        );\n\n        $('#acu-btn-finish-sort')\n          .off('click')\n          .on('click', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            toggleOrderEditMode();\n          });\n      }\n\n      // \n      $('#acu-data-area').removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn').not('#acu-btn-dashboard, #acu-btn-dice-nav').attr('draggable', 'true');\n      $container.find('.acu-action-btn').attr('draggable', 'true');\n\n      // \n      initSortable();\n    } else {\n      // \n      $container.removeClass('editing-order');\n      if ($hint.length) $hint.removeClass('visible').hide();\n      if ($pool.length) $pool.removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn, .acu-action-btn').attr('draggable', 'false');\n      $('.acu-nav-btn, .acu-action-btn').off('.sort');\n      $('#acu-action-pool, #acu-active-actions').off('.sort');\n\n      // \n      const newTableOrder = [];\n      $container.find('.acu-nav-btn[data-table]').each(function () {\n        const tableName = $(this).data('table');\n        if (tableName) {\n          newTableOrder.push(tableName);\n        }\n      });\n      if (newTableOrder.length > 0) {\n        saveTableOrder(newTableOrder);\n      }\n\n      // \n      const newActionOrder = [];\n      $('#acu-active-actions .acu-action-btn').each(function () {\n        const btnId = $(this).attr('id');\n        if (btnId) {\n          newActionOrder.push(btnId);\n        }\n      });\n\n      // \n      if (!newActionOrder.includes('acu-btn-settings')) {\n        newActionOrder.push('acu-btn-settings');\n      }\n\n      Store.set(STORAGE_KEY_ACTION_ORDER, newActionOrder);\n\n      // \n      renderInterface();\n    }\n  };\n\n  const initSortable = () => {\n    const { $ } = getCore();\n    let $dragSrcEl = null;\n\n    // \n    $('.acu-nav-btn, .acu-action-btn, #acu-action-pool, #acu-active-actions').off('.sort');\n\n    // --- 1.  () ---\n    const $items = $('.acu-nav-btn, .acu-action-btn');\n\n    $items.on('dragstart.sort', function (e) {\n      $dragSrcEl = $(this);\n      $(this).css('opacity', '0.4');\n      e.originalEvent.dataTransfer.effectAllowed = 'move';\n    });\n\n    $items.on('dragend.sort', function (e) {\n      $(this).css('opacity', '1');\n      $('.acu-drag-over').removeClass('acu-drag-over');\n      $('.acu-actions-group, .acu-unused-pool').removeClass('dragging-over');\n    });\n\n    $items.on('dragover.sort', function (e) {\n      e.preventDefault();\n      return false;\n    });\n    $items.on('dragenter.sort', function () {\n      if ($dragSrcEl && this !== $dragSrcEl[0]) $(this).addClass('acu-drag-over');\n    });\n    $items.on('dragleave.sort', function () {\n      $(this).removeClass('acu-drag-over');\n    });\n\n    $items.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('acu-drag-over');\n      if (!$dragSrcEl || $dragSrcEl[0] === this) return false;\n\n      const isSrcAction = $dragSrcEl.hasClass('acu-action-btn');\n      const isTgtAction = $(this).hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) return false;\n\n      if (isSrcAction) {\n        const targetPoolId = $(this).parent().attr('id');\n        const srcPoolId = $dragSrcEl.parent().attr('id');\n\n        if (srcPoolId === 'acu-action-pool' && targetPoolId === 'acu-active-actions') {\n          if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n            if (window.toastr) window.toastr.warning('6');\n            return false;\n          }\n        }\n\n        if (srcPoolId !== targetPoolId) {\n          $(this).before($dragSrcEl);\n          return false;\n        }\n      }\n\n      const $temp = $('<span>').hide();\n      $dragSrcEl.before($temp);\n      $(this).before($dragSrcEl);\n      $temp.replaceWith($(this));\n      return false;\n    });\n\n    // --- 2.  (/) ---\n    const $containers = $('#acu-action-pool, #acu-active-actions');\n\n    $containers.on('dragover.sort', function (e) {\n      e.preventDefault();\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        $(this).addClass('dragging-over');\n      }\n    });\n\n    $containers.on('dragleave.sort', function (e) {\n      $(this).removeClass('dragging-over');\n    });\n\n    $containers.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('dragging-over');\n\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        const currentParentId = $dragSrcEl.parent().attr('id');\n        const targetId = $(this).attr('id');\n        const btnId = $dragSrcEl.attr('id');\n\n        if (currentParentId !== targetId) {\n          if (targetId === 'acu-action-pool') {\n            if (btnId === 'acu-btn-settings') {\n              if (window.toastr) window.toastr.warning('');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          } else if (targetId === 'acu-active-actions') {\n            if ($(this).children().length >= 6) {\n              if (window.toastr) window.toastr.warning('6');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          }\n        }\n      }\n      return false;\n    });\n\n    // --- 3.  -  ---\n    $containers.on('click.sort', function (e) {\n      e.stopPropagation();\n\n      // \n      if ($(e.target).closest('.acu-action-btn, .acu-nav-btn').length > 0) return;\n\n      // \n      if (!selectedSwapSource) return;\n\n      const $src = $(selectedSwapSource);\n\n      // \n      if (!$src.hasClass('acu-action-btn')) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const targetId = $(this).attr('id');\n      const btnId = $src.attr('id');\n\n      // \n      if (srcPoolId === targetId) {\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      //   \n      if (targetId === 'acu-action-pool') {\n        if (btnId === 'acu-btn-settings') {\n          if (window.toastr) window.toastr.warning('');\n          $src.removeClass('acu-swap-selected');\n          selectedSwapSource = null;\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n      //   \n      else if (targetId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n    });\n\n    // --- 4.  (Click-to-Swap) -  ---\n    $items.on('click.sort', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (selectedSwapSource && selectedSwapSource === this) {\n        $(this).removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      if (!selectedSwapSource) {\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const $src = $(selectedSwapSource);\n      const $tgt = $(this);\n\n      const isSrcAction = $src.hasClass('acu-action-btn');\n      const isTgtAction = $tgt.hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const tgtPoolId = $tgt.parent().attr('id');\n\n      if (isSrcAction && srcPoolId === 'acu-action-pool' && tgtPoolId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n      }\n\n      if (srcPoolId !== tgtPoolId) {\n        $tgt.before($src);\n      } else {\n        const $temp = $('<span>').hide();\n        $src.before($temp);\n        $tgt.before($src);\n        $temp.replaceWith($tgt);\n      }\n\n      $src.removeClass('acu-swap-selected');\n      selectedSwapSource = null;\n    });\n  };\n\n  const showCellMenu = (e, cell) => {\n    const { $ } = getCore();\n    $('.acu-cell-menu, .acu-menu-backdrop').remove();\n    const backdrop = $('<div class=\"acu-menu-backdrop\"></div>');\n    $('body').append(backdrop);\n\n    const rowIdx = parseInt($(cell).data('row'), 10);\n    const colIdx = parseInt($(cell).data('col'), 10);\n    if (isNaN(rowIdx) || isNaN(colIdx)) {\n      console.warn('[DICE]ACU /');\n      backdrop.remove();\n      return;\n    }\n    const tableKey = $(cell).data('key');\n    // v19.x  tname\n    const tableName = $(cell).data('tname') || $(cell).closest('.acu-data-card').find('.acu-editable-title').text();\n    const content = decodeURIComponent($(cell).data('val'));\n    const config = getConfig();\n\n    //  ID\n    const cellId = `${tableKey}-${rowIdx}-${colIdx}`;\n    if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n\n    // \n    const isModified = window.acuModifiedSet.has(cellId);\n\n    // \n    const pendingDeletionsMap = getPendingDeletions();\n    const tableDeletions = pendingDeletionsMap[tableKey] || [];\n    const isPending = tableDeletions.includes(rowIdx);\n\n    // \n    const headers = cachedRawData?.[tableKey]?.content?.[0] || [];\n    const rowData = cachedRawData?.[tableKey]?.content?.[rowIdx + 1] || [];\n    const lockRowKey = LockManager.getRowKey(tableName, rowData, headers);\n    const currentHeader = headers[colIdx] || '';\n\n    const isFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, currentHeader);\n    const hasAnyLockInRow = lockRowKey && LockManager.hasAnyLock(tableName, lockRowKey);\n\n    // \n    let lockMenuHtml = '';\n    if (lockRowKey) {\n      lockMenuHtml = '<div style=\"border-top:1px dashed var(--acu-border); margin:4px 0;\"></div>';\n\n      // \"\"\"\"\n      if (isFieldLocked) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-field\" style=\"color:#27ae60;\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-field\" style=\"color:#f39c12;\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n\n      // \"\"\"\"\n      if (hasAnyLockInRow) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-row\" style=\"color:#27ae60;\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-row\" style=\"color:#f39c12;\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n    }\n\n    const menu = $(`\n            <div class=\"acu-cell-menu acu-theme-${config.theme}\">\n                <div class=\"acu-cell-menu-item\" id=\"act-edit\"><i class=\"fa-solid fa-pen\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-edit-card\" style=\"color:#9b59b6\"><i class=\"fa-solid fa-edit\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-insert\" style=\"color:#2980b9\"><i class=\"fa-solid fa-plus\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-copy\"><i class=\"fa-solid fa-copy\"></i> </div>\n                ${lockMenuHtml}\n                ${isModified ? '<div class=\"acu-cell-menu-item\" id=\"act-undo\" style=\"color:#e67e22; border-top:1px solid #eee;\"><i class=\"fa-solid fa-undo\"></i> </div>' : ''}\n                ${isPending ? '<div class=\"acu-cell-menu-item\" id=\"act-restore\" style=\"color:#27ae60\"><i class=\"fa-solid fa-undo\"></i> </div>' : '<div class=\"acu-cell-menu-item\" id=\"act-delete\" style=\"color:#e74c3c\"><i class=\"fa-solid fa-trash\"></i> </div>'}\n                <div class=\"acu-cell-menu-item\" id=\"act-close\"><i class=\"fa-solid fa-times\"></i> </div>\n            </div>\n        `);\n    $('body').append(menu);\n\n    // \n    const winWidth = $(window).width();\n    const winHeight = $(window).height();\n    const mWidth = menu.outerWidth() || 150;\n    const mHeight = menu.outerHeight() || 150;\n    let clientX = e.clientX;\n    let clientY = e.clientY;\n    if (!clientX && e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length) {\n      clientX = e.originalEvent.touches[0].clientX;\n      clientY = e.originalEvent.touches[0].clientY;\n    } else if (!clientX && e.changedTouches && e.changedTouches.length) {\n      clientX = e.changedTouches[0].clientX;\n      clientY = e.changedTouches[0].clientY;\n    }\n\n    // \n    if (clientX === undefined) clientX = winWidth / 2;\n    if (clientY === undefined) clientY = winHeight / 2;\n\n    let left = clientX + 5;\n    let top = clientY + 5;\n    if (left + mWidth > winWidth) left = clientX - mWidth - 5;\n    if (top + mHeight > winHeight) top = clientY - mHeight - 5;\n\n    // \n    if (left < 5) left = 5;\n    if (top < 5) top = 5;\n\n    menu.css({ top: top + 'px', left: left + 'px' });\n\n    const closeAll = () => {\n      menu.remove();\n      backdrop.remove();\n    };\n    backdrop.on('click', closeAll);\n    menu.find('#act-close').click(closeAll);\n    // \n    menu.find('#act-lock-field').click(() => {\n      if (lockRowKey && currentHeader) {\n        LockManager.lockField(tableName, lockRowKey, currentHeader, content);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-field').click(() => {\n      if (lockRowKey && currentHeader) {\n        LockManager.unlockField(tableName, lockRowKey, currentHeader);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-lock-row').click(() => {\n      if (lockRowKey) {\n        LockManager.lockRow(tableName, lockRowKey, rowData, headers);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-row').click(() => {\n      if (lockRowKey) {\n        LockManager.unlockRow(tableName, lockRowKey);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    //  (v7.9 )\n    menu.find('#act-copy').click(async e => {\n      e.stopPropagation();\n\n      //  v7.7  (/PWA )\n      // : slash_command.txt /clipboard-set\n      if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n        try {\n          // \n          const safeContent = content\n            .replace(/\\\\/g, '\\\\\\\\')\n            .replace(/\"/g, '\\\\\"')\n            .replace(/\\n/g, '\\\\n')\n            .replace(/\\{/g, '\\\\{')\n            .replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          closeAll();\n          return; // \n        } catch (err) {\n          console.warn('[DICE]ACU ', err);\n        }\n      }\n\n      //  (v7.8 )\n      const doCopy = text => {\n        // A:  API ( HTTPS  localhost )\n        if (navigator.clipboard && window.isSecureContext) {\n          navigator.clipboard\n            .writeText(text)\n            .then(() => {})\n            .catch(() => {\n              fallbackCopy(text);\n            });\n        } else {\n          // B:  execCommand ( HTTP)\n          fallbackCopy(text);\n        }\n      };\n\n      const fallbackCopy = text => {\n        try {\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n\n          // \n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n\n          document.body.appendChild(textArea);\n\n          textArea.select();\n          textArea.setSelectionRange(0, 99999); //  iOS Safari\n\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n\n          if (successful) {\n          } else {\n            throw new Error('execCommand failed');\n          }\n        } catch (err) {\n          console.error('[DICE]ACU :', err);\n          prompt(':', text);\n        }\n      };\n\n      doCopy(content);\n      closeAll();\n    });\n\n    // \n    menu.find('#act-undo').click(() => {\n      const snapshot = loadSnapshot();\n      let originalValue = null;\n      if (snapshot && snapshot[tableKey]?.content[rowIdx + 1]) {\n        originalValue = snapshot[tableKey].content[rowIdx + 1][colIdx];\n      }\n\n      if (originalValue !== null) {\n        if (!cachedRawData) cachedRawData = getTableData();\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = originalValue;\n        }\n\n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(originalValue));\n        $cell.data('val', encodeURIComponent(originalValue));\n\n        // [1]  Label\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length > 0) {\n          $displayTarget = $cell.find('.acu-card-value');\n        } else if ($cell.hasClass('acu-grid-item')) {\n          $displayTarget = $cell.find('.acu-grid-value');\n        } else if ($cell.hasClass('acu-full-item')) {\n          $displayTarget = $cell.find('.acu-full-value');\n        }\n\n        const badgeStyle = getBadgeStyle(originalValue);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${originalValue}</span>`);\n        } else {\n          $displayTarget.text(originalValue);\n        }\n\n        // [] \n        $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n        if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n        window.acuModifiedSet.delete(cellId);\n\n        if (window.acuModifiedSet.size === 0) {\n          hasUnsavedChanges = false;\n          updateSaveButtonState();\n        }\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n      closeAll();\n    });\n\n    // []  ( & )\n    menu.find('#act-delete').click(async () => {\n      closeAll();\n\n      let actOrd = Store.get(STORAGE_KEY_ACTION_ORDER);\n      if (!actOrd || !Array.isArray(actOrd))\n        actOrd = ['acu-btn-save-global', 'acu-btn-collapse', 'acu-btn-refresh', 'acu-btn-settings'];\n      const isInstantMode = !actOrd.includes('acu-btn-save-global');\n\n      if (isInstantMode) {\n        // ---  DOM ---\n        const $card = $(cell).closest('.acu-data-card');\n        $card.css('transition', 'all 0.2s ease').css('opacity', '0').css('transform', 'scale(0.9)');\n        setTimeout(() => $card.slideUp(200, () => $card.remove()), 200);\n\n        // ---  ---\n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n        if (cachedRawData && cachedRawData[tableKey]?.content) {\n          cachedRawData[tableKey].content.splice(rowIdx + 1, 1);\n\n          //  skipRender=true ()\n          saveSnapshot(cachedRawData);\n          await saveDataToDatabase(cachedRawData, true, true);\n        }\n      } else {\n        // ---  () ---\n        const dels = getPendingDeletions();\n        if (!dels[tableKey]) dels[tableKey] = [];\n        if (!dels[tableKey].includes(rowIdx)) {\n          dels[tableKey].push(rowIdx);\n          savePendingDeletions(dels);\n        }\n\n        // \n        $(cell).closest('.acu-data-card').addClass('pending-deletion');\n\n        // \n        updateSaveButtonState();\n      }\n    });\n\n    // \n    menu.find('#act-restore').click(() => {\n      const dels = getPendingDeletions();\n      if (dels[tableKey]) {\n        dels[tableKey] = dels[tableKey].filter(i => i !== rowIdx);\n        if (dels[tableKey].length === 0) delete dels[tableKey];\n        savePendingDeletions(dels);\n      }\n\n      $(cell).closest('.acu-data-card').removeClass('pending-deletion');\n      updateSaveButtonState();\n      closeAll();\n    });\n\n    // []  ()\n    menu.find('#act-insert').click(async () => {\n      closeAll();\n      // 1.  ()\n      if (!cachedRawData) cachedRawData = getTableData();\n      if (!cachedRawData) cachedRawData = loadSnapshot();\n\n      if (cachedRawData && cachedRawData[tableKey]?.content) {\n        const sheet = cachedRawData[tableKey];\n        // 2.  ()\n        const colCount = sheet.content[0] ? sheet.content[0].length : 2;\n        const newRow = new Array(colCount).fill('');\n        //  ()\n        if (colCount > 0) newRow[0] = String(sheet.content.length);\n\n        // 3.  (rowIdx+2  content )\n        sheet.content.splice(rowIdx + 2, 0, newRow);\n\n        // 4. \n        // \n        await saveDataToDatabase(cachedRawData, false, true);\n\n        // \n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $panel = $('.acu-panel-content');\n          // \n          if ($panel.length && $panel[0].scrollHeight > $panel.height()) {\n            $panel.scrollTop($panel.scrollTop() + 10);\n          }\n        }, 100);\n      }\n    });\n\n    // [] \n    menu.find('#act-edit-card').click(() => {\n      closeAll();\n      const rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const headers = rawData[tableKey].content[0];\n        const row = rawData[tableKey].content[rowIdx + 1];\n        if (row) {\n          showCardEditModal(row, headers, tableName, rowIdx, tableKey);\n        }\n      }\n    });\n\n    menu.find('#act-edit').click(() => {\n      closeAll();\n      showEditDialog(content, async newVal => {\n        // 1. \n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = newVal;\n        } else {\n          alert('');\n          return;\n        }\n\n        // 2.  UI \n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(newVal)).data('val', encodeURIComponent(newVal));\n\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length) $displayTarget = $cell.find('.acu-card-value');\n        else if ($cell.hasClass('acu-grid-item')) $displayTarget = $cell.find('.acu-grid-value');\n        else if ($cell.hasClass('acu-editable-title')) $displayTarget = $cell;\n\n        // 3.  UI / ()\n        const badgeStyle = getBadgeStyle(newVal);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(newVal)}</span>`);\n        } else {\n          $displayTarget.text(newVal);\n        }\n\n        // 4.  vs \n        let actOrd = Store.get(STORAGE_KEY_ACTION_ORDER);\n        if (!actOrd || !Array.isArray(actOrd))\n          actOrd = ['acu-btn-save-global', 'acu-btn-collapse', 'acu-btn-refresh', 'acu-btn-settings'];\n        const isInstantMode = !actOrd.includes('acu-btn-save-global');\n\n        if (isInstantMode) {\n          // --- A.  ---\n          //  ()\n          $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n          if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n          //  ()\n          saveSnapshot(cachedRawData);\n          await saveDataToDatabase(cachedRawData, true, true);\n        } else {\n          // --- B.  () ---\n          // \n          $displayTarget.removeClass('acu-highlight-diff').addClass('acu-highlight-manual');\n          if ($cell.hasClass('acu-editable-title'))\n            $cell.removeClass('acu-highlight-diff').addClass('acu-highlight-manual');\n\n          // \n          if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n          window.acuModifiedSet.add(cellId);\n          hasUnsavedChanges = true;\n          updateSaveButtonState();\n        }\n      });\n    });\n  };\n\n  const showEditDialog = (content, onSave) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <!-- 2. []  acu-theme-${config.theme} -->\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"></div>\n                    <textarea class=\"acu-edit-textarea\" spellcheck=\"false\">${escapeHtml(content)}</textarea>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = el.scrollHeight + 2 + 'px';\n    };\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    dialog.find('#dlg-cancel').click(() => dialog.remove());\n    // \n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) dialog.remove();\n    });\n\n    dialog.find('#dlg-save').click(() => {\n      onSave(dialog.find('textarea').val());\n      dialog.remove();\n    });\n  };\n\n  // ==========================================\n  // []  (Observer )\n  // ==========================================\n  // \n  const detectVisualizerConflict = () => {\n    const { $ } = getCore();\n    if (!$) return false;\n\n    // 1:  DOM \n    //  .acu-wrapper\n    const $wrapper = $('.acu-wrapper');\n    if ($wrapper.length > 0) {\n      //  wrapper \n      //  v12.60  'acu_visualizer_ui_v20_pagination'  SCRIPT_ID\n      // \n      const hasVisualizerNav = $wrapper.find('.acu-nav-container').length > 0;\n      const hasVisualizerDataDisplay = $wrapper.find('.acu-data-display').length > 0;\n\n      //  wrapper \n      //  wrapper  data  id\n      const wrapperId = $wrapper.attr('id') || '';\n      const wrapperClass = $wrapper.attr('class') || '';\n\n      // \n      if (hasVisualizerNav && hasVisualizerDataDisplay) {\n        // \n        const hasDiceFeatures = $wrapper.find('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceFeatures) {\n          return true; // \n        }\n      }\n    }\n\n    // 2: \n    try {\n      const scripts = document.querySelectorAll('script');\n      for (const script of scripts) {\n        const content = script.textContent || script.innerHTML || '';\n        //  v12.60 \n        if (content.includes('acu_visualizer_ui_v20_pagination') && content.includes('acu_ui_config_v18')) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // \n    }\n\n    // 3:  localStorage\n    //  localStorage \n    try {\n      const visualizerConfig = localStorage.getItem('acu_ui_config_v18');\n      const diceConfig = localStorage.getItem('acu_ui_config_v19');\n\n      //  DOM \n      if (visualizerConfig && !diceConfig) {\n        //  DOM\n        const hasDiceInDOM = $('[id*=\"dice\"], [class*=\"dice\"]').length > 0;\n        if (!hasDiceInDOM) {\n          return true;\n        }\n      }\n    } catch (e) {\n      // localStorage \n    }\n\n    return false;\n  };\n\n  // \n  const showConflictDialog = () => {\n    const { $ } = getCore();\n    if (!$) return;\n\n    // \n    $('.dice-conflict-dialog-overlay').remove();\n\n    const dialogHtml = `\n      <div class=\"dice-conflict-dialog-overlay\" style=\"\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0, 0, 0, 0.75);\n        backdrop-filter: blur(4px);\n        z-index: 2147483647;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 20px;\n        box-sizing: border-box;\n      \">\n        <div class=\"dice-conflict-dialog\" style=\"\n          background: #fff;\n          border-radius: 16px;\n          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n          max-width: 500px;\n          width: 100%;\n          padding: 30px;\n          box-sizing: border-box;\n          animation: diceDialogPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n        \">\n          <div style=\"\n            text-align: center;\n            margin-bottom: 20px;\n          \">\n            <div style=\"\n              font-size: 48px;\n              color: #e74c3c;\n              margin-bottom: 15px;\n            \"></div>\n            <h2 style=\"\n              font-size: 24px;\n              font-weight: bold;\n              color: #333;\n              margin: 0 0 10px 0;\n            \"></h2>\n            <p style=\"\n              font-size: 16px;\n              color: #666;\n              line-height: 1.6;\n              margin: 0;\n            \">\"\"</p>\n          </div>\n          <div style=\"\n            background: #fff3cd;\n            border: 1px solid #ffc107;\n            border-radius: 8px;\n            padding: 15px;\n            margin-bottom: 20px;\n          \">\n            <p style=\"\n              font-size: 14px;\n              color: #856404;\n              line-height: 1.6;\n              margin: 0;\n            \">\n              <strong></strong><br>\n              <strong></strong>\n            </p>\n          </div>\n          <div style=\"\n            display: flex;\n            gap: 10px;\n            justify-content: center;\n            flex-wrap: wrap;\n          \">\n            <button id=\"dice-conflict-close\" style=\"\n              background: #6c757d;\n              color: #fff;\n              border: none;\n              border-radius: 8px;\n              padding: 12px 24px;\n              font-size: 16px;\n              font-weight: bold;\n              cursor: pointer;\n              transition: all 0.2s;\n              min-width: 120px;\n            \"></button>\n          </div>\n        </div>\n      </div>\n      <style>\n        @keyframes diceDialogPop {\n          from {\n            opacity: 0;\n            transform: translateY(20px) scale(0.95);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0) scale(1);\n          }\n        }\n        .dice-conflict-dialog button:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        }\n        .dice-conflict-dialog button:active {\n          transform: translateY(0);\n        }\n        @media (max-width: 768px) {\n          .dice-conflict-dialog {\n            padding: 20px !important;\n            margin: 10px !important;\n            max-width: calc(100% - 20px) !important;\n          }\n          .dice-conflict-dialog h2 {\n            font-size: 20px !important;\n          }\n          .dice-conflict-dialog p {\n            font-size: 14px !important;\n          }\n        }\n      </style>\n    `;\n\n    $('body').append(dialogHtml);\n\n    // \n    $('#dice-conflict-close').on('click', function () {\n      $('.dice-conflict-dialog-overlay').fadeOut(200, function () {\n        $(this).remove();\n      });\n    });\n\n    // \n    $('.dice-conflict-dialog-overlay').on('click', function (e) {\n      if ($(e.target).hasClass('dice-conflict-dialog-overlay')) {\n        $(this).fadeOut(200, function () {\n          $(this).remove();\n        });\n      }\n    });\n\n    //  toastr \n    if (window.toastr) {\n      window.toastr.error('', '', {\n        timeOut: 0,\n        extendedTimeOut: 0,\n        closeButton: true,\n        preventDuplicates: true,\n      });\n    }\n  };\n\n  const init = () => {\n    if (isInitialized) return;\n\n    console.log('[DICE]...');\n\n    //  ConsoleCaptureManager  localStorage\n    try {\n      ConsoleCaptureManager.restore();\n      console.info('[DICE]ConsoleCaptureManager ');\n    } catch (e) {\n      console.error('[DICE] ConsoleCaptureManager :', e);\n    }\n\n    // \n    try {\n      ErrorHandler.checkAndRestore();\n      console.info('[DICE]');\n    } catch (e) {\n      console.error('[DICE]:', e);\n    }\n\n    // \n    if (detectVisualizerConflict()) {\n      showConflictDialog();\n      console.error('[DICE] ');\n      return; // \n    }\n\n    console.info('[DICE] MVU ...');\n    MvuModule.injectStyles();\n\n    //  Observer\n    if (observer) {\n      observer.disconnect();\n      observer = null;\n      console.info('[DICE] MutationObserver');\n    }\n    addStyles();\n    // 2.  SillyTavern \n    if (window.SillyTavern && window.SillyTavern.eventSource) {\n      console.info('[DICE] SillyTavern ...');\n      const events = window.SillyTavern.eventTypes;\n      const source = window.SillyTavern.eventSource;\n      const triggers = [events.CHAT_CHANGED, events.MESSAGE_SWIPED, events.MESSAGE_DELETED, events.MESSAGE_UPDATED];\n\n      // \n      if (!_boundRenderHandler) {\n        _boundRenderHandler = () => {\n          if (!isEditingOrder) {\n            console.info('[DICE]');\n            setTimeout(renderInterface, 500);\n          } else {\n            console.info('[DICE]');\n          }\n        };\n      }\n\n      // \n      if (!window._acuBoundChatChangeHandler) {\n        window._acuBoundChatChangeHandler = () => {\n          console.info('[DICE]');\n          cachedRawData = null;\n          tablePageStates = {};\n          tableSearchStates = {};\n          tableScrollStates = {};\n          hasUnsavedChanges = false;\n          currentDiffMap.clear();\n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          setTimeout(renderInterface, 500);\n        };\n      }\n      const _boundChatChangeHandler = window._acuBoundChatChangeHandler;\n\n      triggers.forEach(evt => {\n        if (evt) {\n          source.removeListener(evt, _boundRenderHandler);\n          source.removeListener(evt, _boundChatChangeHandler); // \n          if (evt === events.CHAT_CHANGED) {\n            source.on(evt, _boundChatChangeHandler);\n          } else {\n            source.on(evt, _boundRenderHandler);\n          }\n        }\n      });\n      console.info(`[DICE] ${triggers.length} `);\n    } else {\n      console.warn('[DICE]SillyTavern ');\n    }\n\n    // 3.  API \n    const loop = () => {\n      const api = getCore().getDB();\n      if (api?.exportTableAsJson) {\n        isInitialized = true;\n        console.log('[DICE]');\n        console.info('[DICE] API ');\n\n        // --- [Fix]  API  #chat  () ---\n        const $chat = $('#chat');\n        if ($chat.length && !observer) {\n          console.info('[DICE] MutationObserver');\n          let mutationLock = false;\n          const handleMutation = () => {\n            if (mutationLock) return;\n            mutationLock = true;\n            requestAnimationFrame(() => {\n              const config = getConfig();\n              if (config.positionMode === 'embedded') {\n                mutationLock = false;\n                return;\n              }\n\n              const children = $chat.children();\n              const lastChild = children.last()[0];\n              const wrapper = $('.acu-wrapper')[0];\n\n              if (wrapper && lastChild && lastChild !== wrapper) {\n                if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n                  $chat.append(wrapper);\n                }\n              }\n\n              // [] \n              const diceCfg = getDiceConfig();\n              if (diceCfg && diceCfg.hideDiceResultInChat) {\n                // 1\n                const children = $chat.children();\n                const lastChild = children.last();\n                if (lastChild.hasClass('mes') || lastChild.hasClass('message-body')) {\n                  lastChild.addClass('acu-dice-result-revealing');\n                }\n\n                // 2RAF\n                requestAnimationFrame(() => {\n                  hideDiceResultsInUserMessages();\n\n                  // 3\n                  requestAnimationFrame(() => {\n                    lastChild.removeClass('acu-dice-result-revealing').addClass('acu-dice-result-revealed');\n                    // \n                    setTimeout(() => {\n                      lastChild.removeClass('acu-dice-result-revealed');\n                    }, 200);\n                  });\n                });\n              }\n\n              mutationLock = false;\n            });\n          };\n          observer = new MutationObserver(handleMutation);\n          observer.observe($chat[0], { childList: true });\n        } else if (!$chat.length) {\n          console.warn('[DICE] (#chat)  MutationObserver ');\n        }\n        // --------------------------------------------------\n\n        console.info('[DICE]...');\n        renderInterface(); // \n        // [] \n        setTimeout(() => {\n          hideDiceResultsInUserMessages();\n        }, 500);\n        // \n        if (api.registerTableUpdateCallback) {\n          api.registerTableUpdateCallback(UpdateController.handleUpdate);\n          console.info('[DICE]');\n\n          // \n          if (api.registerTableFillStartCallback) {\n            api.registerTableFillStartCallback(() => {\n              const current = api.exportTableAsJson();\n              if (current) saveSnapshot(current);\n            });\n            console.info('[DICE]');\n          }\n        } else {\n          console.warn('[DICE] API ');\n        }\n      } else {\n        //  ( 60)\n        if (!isInitialized) {\n          window._acuInitRetries = (window._acuInitRetries || 0) + 1;\n          if (window._acuInitRetries < 60) {\n            if (window._acuInitRetries % 10 === 0) {\n              console.info(`[DICE] API ... (${window._acuInitRetries}/60)`);\n            }\n            setTimeout(loop, 1000);\n          } else {\n            console.error('[DICE] API');\n          }\n        }\n      }\n    };\n    loop();\n\n    // []  - \n    const setupOptionHideListener = () => {\n      const { $ } = getCore();\n      const hideOptionPanel = () => {\n        optionPanelVisible = false;\n        $('.acu-option-panel, .acu-embedded-options-container').fadeOut(200, function () {\n          $(this).remove();\n        });\n      };\n\n      const pendingCrazyAppend = new Map<number, { result: string; createdAt: number }>();\n      const CRAZY_APPEND_TTL_MS = 12000;\n      let lastCrazyPreSendAt = 0;\n\n      const normalizeMessageId = (messageId: number | string) => {\n        const id = typeof messageId === 'string' ? Number(messageId) : messageId;\n        return Number.isFinite(id) ? id : null;\n      };\n\n      const hasDiceResultInText = (text: string) => {\n        if (!text) return false;\n        const contestRegex =\n          /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n        const normalRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n        return contestRegex.test(text) || normalRegex.test(text);\n      };\n\n      const insertDiceIntoUserInputBlock = (text: string, diceResult: string) => {\n        if (!text || !diceResult) return '';\n        const blockRegex = /(<>)([\\s\\S]*?)(<\\/>)/;\n        const blockMatch = text.match(blockRegex);\n        if (!blockMatch) return '';\n        const inner = blockMatch[2];\n        if (inner.includes(diceResult)) return '';\n        const prefix = inner.startsWith('\\n') ? '\\n' : '';\n        const suffix = inner.endsWith('\\n') ? '\\n' : '';\n        const trimmedInner = inner.trim();\n        const newInner = trimmedInner ? `${trimmedInner} ${diceResult}` : diceResult;\n        const textWithoutDice = text.includes(diceResult) ? text.replace(diceResult, '').trim() : text;\n        return textWithoutDice.replace(blockRegex, `${blockMatch[1]}${prefix}${newInner}${suffix}${blockMatch[3]}`);\n      };\n\n      const applyCrazyModeToPrompt = (type: string, params: unknown, dryRun: boolean) => {\n        if (dryRun) return;\n        const safeParams = params && typeof params === 'object' ? (params as Record<string, unknown>) : {};\n        const quietPrompt = typeof safeParams.quiet_prompt === 'string' ? safeParams.quiet_prompt : '';\n        const automaticTrigger = safeParams.automatic_trigger === true;\n        const alreadyApplied = safeParams._acu_crazy_applied === true;\n        if (alreadyApplied || automaticTrigger) return;\n        if (type === 'quiet' || quietPrompt.trim().length > 0) return;\n\n        const now = Date.now();\n        if (now - lastCrazyPreSendAt < 300) return;\n\n        const originalPrompt = typeof safeParams.prompt === 'string' ? safeParams.prompt : '';\n        if (!originalPrompt || !originalPrompt.trim()) return;\n        if (hasDiceResultInText(originalPrompt)) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        let finalPrompt = '';\n        if (originalPrompt.includes('<>')) {\n          const inserted = insertDiceIntoUserInputBlock(originalPrompt, crazyRollResult);\n          finalPrompt =\n            inserted && inserted !== originalPrompt ? inserted : `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n        } else {\n          finalPrompt = `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n        }\n\n        safeParams.prompt = finalPrompt;\n        safeParams._acu_crazy_applied = true;\n        lastCrazyPreSendAt = now;\n      };\n\n      const triggerCrazyModeBeforeSend = () => {\n        const now = Date.now();\n        if (now - lastCrazyPreSendAt < 300) return;\n\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        const content = ($ta.val() || '').toString().trim();\n        if (!content) return;\n        if (hasDiceResultInText(content)) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        smartInsertToTextarea(crazyRollResult, 'dice');\n        const updatedValue = ($ta.val() || '').toString();\n        if (updatedValue) {\n          const textarea = $ta[0] as HTMLTextAreaElement;\n          textarea.value = updatedValue;\n          textarea.dispatchEvent(new Event('input', { bubbles: true }));\n          textarea.dispatchEvent(new Event('change', { bubbles: true }));\n        }\n        lastCrazyPreSendAt = now;\n      };\n\n      const queueCrazyAppend = (messageId: number | string) => {\n        const id = normalizeMessageId(messageId);\n        if (id === null) return;\n        if (!shouldTriggerCrazyMode()) return;\n\n        const crazyRollResult = generateCrazyRoll();\n        if (!crazyRollResult) return;\n\n        pendingCrazyAppend.set(id, { result: crazyRollResult, createdAt: Date.now() });\n        void applyCrazyAppend(id);\n      };\n\n      const applyCrazyAppend = async (messageId: number | string) => {\n        const id = normalizeMessageId(messageId);\n        if (id === null) return;\n\n        const pending = pendingCrazyAppend.get(id);\n        if (!pending) return;\n\n        if (Date.now() - pending.createdAt > CRAZY_APPEND_TTL_MS) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        const stChat = ST?.chat || window.parent?.SillyTavern?.chat;\n        const stMsg = stChat && typeof id === 'number' ? stChat[id] : null;\n        const msg = getChatMessages(id)[0];\n        if (!msg || msg.role !== 'user') {\n          if (!stMsg || !stMsg.is_user) {\n            pendingCrazyAppend.delete(id);\n            return;\n          }\n        }\n\n        const originalText = String(stMsg?.mes ?? msg?.message ?? '');\n        if (hasDiceResultInText(originalText)) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        const extra = msg?.extra || stMsg?.extra || {};\n        if ((extra as { acuCrazyModeApplied?: boolean }).acuCrazyModeApplied) {\n          pendingCrazyAppend.delete(id);\n          return;\n        }\n\n        let newMessage = '';\n        if (originalText.includes('<>')) {\n          const inserted = insertDiceIntoUserInputBlock(originalText, pending.result);\n          newMessage = inserted && inserted !== originalText ? inserted : `${originalText} ${pending.result}`.trim();\n        } else {\n          newMessage = originalText ? `${originalText} ${pending.result}` : pending.result;\n        }\n        pendingCrazyAppend.delete(id);\n\n        if (stMsg && stMsg.is_user) {\n          stMsg.mes = newMessage;\n        }\n\n        try {\n          await setChatMessages(\n            [{ message_id: id, message: newMessage, extra: { ...extra, acuCrazyModeApplied: true } }],\n            { refresh: 'affected' },\n          );\n        } catch (e) {\n          console.warn('[DICE]: ', e);\n        }\n\n        const { $ } = getCore();\n        const $ta = $('#send_textarea');\n        if ($ta.length) {\n          const currentVal = ($ta.val() || '').toString();\n          if (currentVal === newMessage) {\n            $ta.val('').trigger('input').trigger('change');\n          }\n        }\n      };\n\n      // [] \n      const setupSendButtonListener = () => {\n        // []  value \n        interceptTextareaValue();\n\n        // [] \n        const sendButton = document.getElementById('send_but');\n        if (sendButton) {\n          const onSendCapture = () => {\n            // \n            triggerCrazyModeBeforeSend();\n            // \n            restoreDiceResultBeforeSend();\n          };\n          sendButton.addEventListener('click', onSendCapture, true);\n          sendButton.addEventListener('pointerup', onSendCapture, true);\n          sendButton.addEventListener('touchend', onSendCapture, true);\n        }\n\n        // jQuery\n        $(document)\n          .off('click.acu_restore_dice', '#send_but')\n          .on('click.acu_restore_dice', '#send_but', function (e) {\n            // \n            triggerCrazyModeBeforeSend();\n            // \n            restoreDiceResultBeforeSend();\n          });\n\n        // \n        const textarea = document.getElementById('send_textarea');\n        if (textarea) {\n          textarea.addEventListener(\n            'keydown',\n            function (e) {\n              //  ShiftShift+Enter \n              if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n                // \n                triggerCrazyModeBeforeSend();\n                // \n                restoreDiceResultBeforeSend();\n              }\n            },\n            true, // \n          );\n          textarea.addEventListener(\n            'keyup',\n            function (e) {\n              if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n                triggerCrazyModeBeforeSend();\n                restoreDiceResultBeforeSend();\n              }\n            },\n            true,\n          );\n        }\n\n        $('#send_textarea')\n          .off('keydown.acu_restore_dice')\n          .on('keydown.acu_restore_dice', function (e) {\n            //  ShiftShift+Enter \n            if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n              // \n              triggerCrazyModeBeforeSend();\n              // \n              restoreDiceResultBeforeSend();\n            }\n          })\n          .off('keyup.acu_restore_dice')\n          .on('keyup.acu_restore_dice', function (e) {\n            if (e.key === 'Enter' || e.key === 'NumpadEnter') {\n              triggerCrazyModeBeforeSend();\n              restoreDiceResultBeforeSend();\n            }\n          });\n\n        // [] /\n        const observer = new MutationObserver(() => {\n          const $ta = $('#send_textarea');\n          if ($ta.length && !$ta[0]._acuValueIntercepted) {\n            interceptTextareaValue();\n          }\n        });\n        observer.observe(document.body, { childList: true, subtree: true });\n      };\n\n      const installCrazyGenerateHook = () => {\n        const rootWindow = window as Window & {\n          __acuCrazyGenerateHookInstalled?: boolean;\n          __acuCrazyGenerateOriginal?: (...args: unknown[]) => unknown;\n        };\n        if (rootWindow.__acuCrazyGenerateHookInstalled) return;\n        if (!rootWindow.TavernHelper || typeof rootWindow.TavernHelper.generate !== 'function') return;\n\n        rootWindow.__acuCrazyGenerateOriginal = rootWindow.TavernHelper.generate;\n        rootWindow.TavernHelper.generate = async function (...args: unknown[]) {\n          const options =\n            args.length > 0 && args[0] && typeof args[0] === 'object' ? (args[0] as Record<string, unknown>) : null;\n\n          if (options) {\n            const quietPrompt = typeof options.quiet_prompt === 'string' ? options.quiet_prompt : '';\n            const automaticTrigger = options.automatic_trigger === true;\n            const alreadyApplied = options._acu_crazy_applied === true;\n            if (!alreadyApplied && !automaticTrigger && quietPrompt.trim().length === 0) {\n              let originalPrompt = '';\n              const injects = options.injects;\n              if (Array.isArray(injects) && injects.length > 0) {\n                const first = injects[0];\n                if (first && typeof first === 'object') {\n                  const content = (first as Record<string, unknown>).content;\n                  if (typeof content === 'string') originalPrompt = content;\n                }\n              }\n              if (!originalPrompt && typeof options.prompt === 'string') {\n                originalPrompt = options.prompt;\n              }\n              if (!originalPrompt && typeof options.user_input === 'string') {\n                originalPrompt = options.user_input;\n              }\n\n              if (originalPrompt && !hasDiceResultInText(originalPrompt) && shouldTriggerCrazyMode()) {\n                const crazyRollResult = generateCrazyRoll();\n                if (crazyRollResult) {\n                  const mergedPrompt = `${originalPrompt.trim()} ${crazyRollResult}`.trim();\n                  if (Array.isArray(injects) && injects.length > 0) {\n                    const first = injects[0];\n                    if (first && typeof first === 'object') {\n                      (first as Record<string, unknown>).content = mergedPrompt;\n                    }\n                  } else if (typeof options.prompt === 'string') {\n                    options.prompt = mergedPrompt;\n                  } else {\n                    options.user_input = mergedPrompt;\n                  }\n                  options._acu_crazy_applied = true;\n                  lastCrazyPreSendAt = Date.now();\n                  console.info('[DICE]: ');\n                }\n              }\n            }\n          }\n\n          return (rootWindow.__acuCrazyGenerateOriginal as (...args: unknown[]) => unknown).apply(this, args);\n        };\n        rootWindow.__acuCrazyGenerateHookInstalled = true;\n      };\n\n      // []  ( ST  -> )\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      // \n      const evtName =\n        ST?.eventTypes?.MESSAGE_SENT || (window.tavern_events ? window.tavern_events.MESSAGE_SENT : 'message_sent');\n\n      // 1.  ST.eventSource ()\n      if (ST?.eventSource) {\n        ST.eventSource.on(evtName, hideOptionPanel);\n        // [] \n        ST.eventSource.on(evtName, messageId => {\n          // \n          queueCrazyAppend(messageId);\n\n          // DOM\n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            setTimeout(() => {\n              hideDiceResultsInUserMessages();\n            }, 300);\n          }\n        });\n\n        // []  GENERATION_AFTER_COMMANDS \n        const afterCommandsEvtName =\n          ST?.eventTypes?.GENERATION_AFTER_COMMANDS ||\n          (window.tavern_events ? window.tavern_events.GENERATION_AFTER_COMMANDS : 'GENERATION_AFTER_COMMANDS');\n        if (afterCommandsEvtName) {\n          ST.eventSource.on(afterCommandsEvtName, (type, params, dryRun) => {\n            applyCrazyModeToPrompt(type, params, dryRun);\n          });\n        }\n\n        installCrazyGenerateHook();\n        setupSendButtonListener();\n        return;\n      }\n\n      // 2.  eventOn (TavernHelper )\n      if (typeof window.eventOn === 'function') {\n        window.eventOn(evtName, hideOptionPanel);\n        // [] \n        window.eventOn(evtName, messageId => {\n          // \n          queueCrazyAppend(messageId);\n\n          // DOM\n          const diceCfg = getDiceConfig();\n          if (diceCfg && diceCfg.hideDiceResultInChat) {\n            setTimeout(() => {\n              hideDiceResultsInUserMessages();\n            }, 300);\n          }\n        });\n\n        // []  GENERATION_AFTER_COMMANDS \n        const afterCommandsEvtName = window.tavern_events\n          ? window.tavern_events.GENERATION_AFTER_COMMANDS\n          : 'GENERATION_AFTER_COMMANDS';\n        window.eventOn(afterCommandsEvtName, (type, params, dryRun) => {\n          applyCrazyModeToPrompt(type, params, dryRun);\n        });\n\n        installCrazyGenerateHook();\n        setupSendButtonListener();\n        return;\n      }\n    };\n\n    // \n    setTimeout(setupOptionHideListener, 2000);\n\n    // [] \n    setTimeout(() => {\n      interceptTextareaValue();\n    }, 500);\n\n    // [] ERA\n    const eventOn = window.eventOn || window.parent?.eventOn;\n    if (typeof eventOn === 'function') {\n      eventOn('era:writeDone', detail => {\n        //  ERA \n        if (typeof MvuModule === 'object' && typeof MvuModule.clearCache === 'function') {\n          MvuModule.clearCache();\n        }\n\n        // ERA\n        const mode = MvuModule.detectMode();\n        if (mode === 'era' && getActiveTabState() === MvuModule.MODULE_ID) {\n          console.log('[DICE]ERA');\n          renderInterface();\n        }\n      });\n    } else {\n      console.warn('[DICE] ERA eventOn ');\n    }\n\n    // [] \n    $(window)\n      .off('beforeunload.acu pagehide.acu')\n      .on('beforeunload.acu pagehide.acu', () => {\n        try {\n          localStorage.setItem(STORAGE_KEY_SCROLL, JSON.stringify(tableScrollStates));\n          if (observer) {\n            observer.disconnect();\n            observer = null;\n          }\n        } catch (e) {}\n      });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  // window.testPairedTableFix()\n  window.testPairedTableFix = function () {\n    // \n    const prefix = 'AM';\n    const startFrom = 1;\n    const columnName = '';\n\n    // 1AM0001, AM0002, (), AM0030, ()\n    // AM0001, AM0002, AM0030\n    const table1Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        ['AM0001', '1', '1'],\n        ['AM0002', '2', '2'],\n        [null, '3-', '3-'], // \n        ['AM0030', '4', '4'],\n        [null, '5-', '5-'], // \n      ],\n    };\n\n    // 2(), AM0002, AM0030, AM0040, AM0050\n    // AM0002, AM0030, AM0040, AM0050\n    const table2Sheet = {\n      name: '',\n      content: [\n        ['', '', ''],\n        [null, 'A-', 'A-'], // \n        ['AM0002', 'B', 'B'],\n        ['AM0030', 'C', 'C'],\n        ['AM0040', 'D', 'D'],\n        ['AM0050', 'E', 'E'],\n      ],\n    };\n\n    // \n    const extract1 = extractCodesFromTable(table1Sheet, columnName, prefix);\n    const extract2 = extractCodesFromTable(table2Sheet, columnName, prefix);\n\n    // \n    const mapping = buildCodeMapping(extract1.allCodes, extract2.allCodes, prefix, startFrom);\n\n    // \n    const rawData = {};\n    const result = alignAndFixPairedTables(\n      table1Sheet,\n      'sheet1',\n      table2Sheet,\n      'sheet2',\n      columnName,\n      mapping,\n      prefix,\n      startFrom,\n      rawData,\n    );\n\n    // \n    const getValidCodes = sheet =>\n      sheet.content\n        .slice(1)\n        .map(r => r[0])\n        .filter(c => c && String(c).match(new RegExp(`^${prefix}\\\\d+$`)));\n\n    const codes1 = getValidCodes(table1Sheet);\n    const codes2 = getValidCodes(table2Sheet);\n\n    // \n    const emptyRows1 = table1Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix}\\\\d+$`)));\n    const emptyRows2 = table2Sheet.content\n      .slice(1)\n      .filter(r => !r[0] || !String(r[0]).match(new RegExp(`^${prefix}\\\\d+$`)));\n\n    // \n    const validateSequence = (codes, prefix, startFrom) => {\n      const numbers = codes\n        .map(c => {\n          if (!c) return null;\n          const match = c.match(new RegExp(`^${prefix.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}(\\\\d+)$`));\n          return match ? parseInt(match[1], 10) : null;\n        })\n        .filter(n => n !== null);\n\n      for (let i = 0; i < numbers.length; i++) {\n        if (numbers[i] !== startFrom + i) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    const isValid1 = validateSequence(codes1, prefix, startFrom);\n    const isValid2 = validateSequence(codes2, prefix, startFrom);\n\n    // \n    const set1 = new Set(codes1);\n    const set2 = new Set(codes2);\n    const setsEqual = set1.size === set2.size && [...set1].every(c => set2.has(c));\n\n    // \n    const emptyRowsPreserved1 = emptyRows1.some(r => r[1] && r[1].includes(''));\n    const emptyRowsPreserved2 = emptyRows2.some(r => r[1] && r[1].includes(''));\n\n    return {\n      table1Sheet,\n      table2Sheet,\n      result,\n      codes1,\n      codes2,\n      emptyRows1,\n      emptyRows2,\n      isValid1,\n      isValid2,\n      setsEqual,\n      emptyRowsPreserved1,\n      emptyRowsPreserved2,\n      //  +  + \n      isValid: isValid1 && isValid2 && setsEqual && emptyRowsPreserved1 && emptyRowsPreserved2,\n    };\n  };\n\n  // \n  window.diagnoseDiceVariables = async function () {\n    if (typeof MvuModule !== 'undefined' && typeof MvuModule.diagnoseVariableFramework === 'function') {\n      return await MvuModule.diagnoseVariableFramework();\n    } else {\n      console.error('[DICE]MvuModule ');\n      return null;\n    }\n  };\n\n  const { $ } = getCore();\n  if ($) $(document).ready(init);\n  else window.addEventListener('load', init);\n})();\n"],"names":["EMOJI_MAP","LOCATION_EMOJI_MAP","ELEMENT_EMOJI_MAP","SCRIPT_ID","LockManager","STORAGE_KEY_PREFIX","MAX_CONTEXTS","PRIMARY_KEYS","_cache","_currentContextId","_getStorageKey","ctxId","this","getCurrentContextFingerprint","_cleanupOldContexts","prefix","allKeys","i","localStorage","length","key","startsWith","push","keyWithTime","map","data","JSON","parse","getItem","time","_lastAccess","sort","a","b","toDelete","slice","forEach","item","removeItem","console","log","e","warn","_load","stored","_save","dataToSave","Date","now","setItem","stringify","getRowKey","tableName","row","headers","pkField","fieldIndex","idx","indexOf","lockField","rowKey","fieldName","value","_fullRow","_fields","_snapshot","lockRow","rowData","snapshot","h","unlockField","lock","Object","keys","unlockRow","isFieldLocked","hasOwnProperty","isRowLocked","applyLocks","tableContent","tableLocks","modified","restored","rowIndex","entries","undefined","newRow","_rebuildRow","fields","field","colIdx","Array","fill","hasAnyLock","getLockedFields","clearCurrentContext","BookmarkManager","isBookmarked","toggleBookmark","getBookmarks","escapeHtml","s","String","replace","showPresetConflictDialog","options","getCore","$","remove","getThemeColors","config","getConfig","suggestedName","baseName","existingNames","includes","counter","newName","generateUniqueName","presetName","dialogHtml","theme","presetType","$dialog","append","style","cssText","closeDialog","find","click","onCancel","on","target","hasClass","mode","val","onOverwrite","onRename","smartInsertToTextarea","newContent","contentType","$ta","currentVal","trim","normalDiceRegex","contestDiceRegex","actionRegex","placeholderRegex","diceCfg","getDiceConfig","contentToInsert","shouldSaveOriginal","hideDiceResultFromUser","trigger","textarea","_acuOriginalDiceText","_acuHasDiceData","workingText","existingAction","existingDice","existingDiceOriginal","test","originalText","contestMatches","match","normalMatches","actionMatches","userInput","parts","finalVal","join","restoreDiceResultBeforeSend","restoredVal","removeData","interceptTextareaValue","_acuValueIntercepted","originalDescriptor","getOwnPropertyDescriptor","HTMLTextAreaElement","prototype","originalValue","defineProperty","get","call","_value","set","configurable","STORAGE_KEY_TABLE_ORDER","STORAGE_KEY_ACTION_ORDER","STORAGE_KEY_PENDING_DELETIONS","STORAGE_KEY_ACTIVE_TAB","STORAGE_KEY_UI_CONFIG","STORAGE_KEY_LAST_SNAPSHOT","STORAGE_KEY_IS_COLLAPSED","STORAGE_KEY_OPTIONS_COLLAPSED","STORAGE_KEY_DASHBOARD_ACTIVE","STORAGE_KEY_TABLE_HEIGHTS","STORAGE_KEY_TABLE_STYLES","STORAGE_KEY_HIDDEN_TABLES","STORAGE_KEY_REVERSE_TABLES","MIN_PANEL_HEIGHT","MAX_PANEL_HEIGHT","STORAGE_KEY_DICE_CONFIG","STORAGE_KEY_ATTRIBUTE_PRESETS","STORAGE_KEY_ACTIVE_ATTR_PRESET","STORAGE_KEY_CRAZY_MODE","DEFAULT_CRAZY_MODE_CONFIG","enabled","crazyLevel","playerWeight","inSceneNpcWeight","offSceneNpcWeight","PRESET_FORMAT_VERSION","compareVersion","v1","v2","normalizeVersion","v","nv1","nv2","parts1","split","Number","parts2","Math","max","p1","p2","STORAGE_KEY_AVATAR_MAP","STORAGE_KEY_MAP_FOCUS","ConsoleCaptureManager","logs","maxLogs","filters","info","error","originalMethods","isIntercepted","restore","enable","intercept","disable","emergencyBtn","document","getElementById","display","type","self","args","apply","capture","timestamp","timeStr","toLocaleTimeString","hour12","content","arg","stack","Error","logEntry","id","random","rawArgs","shift","clear","getFilteredLogs","filter","setFilters","ErrorHandler","errorCount","errorThreshold","lastErrorTime","errorWindow","fatalErrorDetected","isFatalError","source","lineno","colno","thirdPartyPatterns","errorInfo","errorSource","pattern","corePatterns","isCoreError","handleError","triggerFatalError","showEmergencyButton","btn","createElement","innerHTML","onmouseenter","background","transform","onmouseleave","onclick","window","showDebugConsoleModal","alert","body","appendChild","checkAndRestore","onerror","message","addEventListener","event","reason","STORAGE_KEY_REGEX_RULES","STORAGE_KEY_REGEX_PRESETS","STORAGE_KEY_REGEX_ACTIVE_PRESET","STORAGE_KEY_REGEX_ENABLED","STORAGE_KEY_VALIDATION_ENABLED","STORAGE_KEY_VALIDATION_MODE","RULE_TYPE_INFO","tableReadonly","name","scope","icon","desc","rowLimit","sequence","required","format","enum","numeric","relation","keyValue","BUILTIN_VALIDATION_RULES","description","builtin","targetTable","targetColumn","ruleType","startFrom","errorMessage","values","min","refTable","refColumn","valueType","valueMin","valueMax","STORAGE_KEY_BLACKLIST","STORAGE_KEY_BLACKLIST_VERSION","DEFAULT_BLACKLIST","BlacklistManager","getBlacklist","Store","storedVersion","isArray","Set","defaultItems","mergedItems","has","setBlacklist","list","resetToDefault","isBlacklisted","blacklist","lastPart","some","STORAGE_KEY_PRESETS","STORAGE_KEY_ACTIVE_PRESET","PresetManager","getAllPresets","_initDefaultPreset","needsSave","preset","version","_compareVersion","customRules","rules","r","builtinRuleIds","mergedRules","rule","ValidationRuleManager","clearCache","getActivePreset","presets","activeId","p","setActivePreset","createPreset","newPreset","createdAt","toISOString","duplicatePreset","deletePreset","filtered","updatePresetRules","exportPreset","mergePresetWithDefaults","presetId","builtinRuleMap","Map","processedCustomIds","newRule","existingRule","add","importPreset","json","autoMerge","importedVersion","needsMerge","_getBuiltinRulesVersion","rulesStr","hash","charCodeAt","toString","currentVersion","defaultPreset","_builtinVersion","oldCustom","resetDefaultPreset","_enabledCache","getAllRules","enabledStates","getEnabledStates","allRules","toggleRuleEnabled","ruleId","states","toggleRuleIntercept","getEnabledRules","addCustomRule","removeCustomRule","index","findIndex","splice","updateCustomRule","updates","getRule","getRulesByTable","RegexTransformationManager","_generateId","substr","_saveEnabledStates","getApplicableRules","columnName","tableNames","columnNames","priority","operation","flags","replacement","executeMode","testCases","security","maxMatchTime","maxMatches","maxInputLength","updatedAt","removeRule","updateRule","RegexPresetManager","sourcePresetId","sourcePreset","jsonString","RegexTransformationEngine","_regexCache","_buildFlags","result","caseInsensitive","global","multiline","unicode","sticky","_getRegex","hasLookbehind","hasLookahead","flagsStr","cacheKey","regex","lastIndex","RegExp","_scoreRegexComplexity","score","captureGroups","_getTimeoutForRule","complexity","baseTimeout","_safeReplace","oldValue","success","newValue","matched","timeout","startTime","elapsed","applyToValue","strValue","extracted","_extractFlags","patternWithoutFlags","patternStr","inlineFlagMatch","flagStr","applyToTable","tableData","totalApplied","errors","isSimpleFormat","sheetMap","simpleTable","sheet","sheetKey","contentRowIndex","dataObj","size","tableInfo","rows","colIndex","debug","tableError","errorMsg","applyToCell","applicableRules","currentValue","wasMatched","applyToRow","cell","previewBatchTransform","results","affectedCells","totalAffected","columnIndex","clearRegexCache","ValidationEngine","validateFormat","validateEnum","allowedValues","validateNumeric","strVal","numVal","endsWith","parseFloat","isNaN","validateRelation","rawData","refSheet","sheetId","columns","col","refColIndex","validateRequired","validateKeyValue","ruleConfig","processedValue","pairs","pair","colonIndex","substring","validateTableReadonly","oldContent","validateRowLimit","rowCount","validateSequence","numbers","allRowValues","rawValue","num","parseInt","n","expectedNum","checkTableRules","newData","violations","typeInfo","oldSheet","newSheet","padStart","rowIdx","validateValue","validateRow","rowTitle","ruleName","severity","validateAllData","allErrors","tableRules","fieldRules","rowErrors","validateTable","targetSheet","groupErrorsByTable","grouped","getErrorCount","LocalAvatarDB","DB_NAME","STORE_NAME","DB_VERSION","_db","_urlCache","init","Promise","resolve","reject","request","indexedDB","open","onsuccess","onupgradeneeded","db","objectStoreNames","contains","createObjectStore","keyPath","save","blob","store","transaction","objectStore","URL","revokeObjectURL","delete","put","url","createObjectURL","getKey","getAllNames","getAllKeys","getStats","getAll","items","totalSize","reduce","sum","count","totalSizeMB","toFixed","clearAll","getPlayerName","cachedRawData","getTableData","getPersonaName","w","parent","SillyTavern","getContext","ctx","name1","jQuery","$persona","first","text","getDisplayPlayerName","replaceUserPlaceholders","displayName","AvatarManager","load","raw","offsetX","offsetY","scale","aliases","getAsync","playerName","isPlayer","localUrl","userLocalUrl","primaryName","getPrimaryName","aliasLocalUrl","hasLocalAvatar","async","getOffsetX","_resolveByAlias","getOffsetY","getScale","setPosition","setScale","setAliases","exportData","exportTime","avatars","importData","jsonData","overwriteConflicts","current","stats","added","updated","skipped","imported","analyzeImport","valid","total","newItems","conflicts","getEmojiCandidates","candidates","emoji","getElementEmoji","MvuModule","MODULE_ID","cachedEraData","detectMode","_source","eventEmit","eventOn","Mvu","getMvuData","getEraData","timeoutId","setTimeout","eventOff","onResult","detail","clearTimeout","statData","statWithoutMeta","stat_data","delta_data","schema","isAvailable","getData","allVars","message_id","display_data","getMvuDataWithRetry","maxRetries","retryDelay","race","waitGlobalInitialized","_","attempt","isVWD","isSimpleArray","every","countChildren","k","extractNumericDisplayValue","str","rangeMatch","slashNumericMatch","commaDescMatch","numericDescMatch","extractFirstNumericValue","displayValue","renderRow","path","deltaData","changeIndicator","part","oldVal","newVal","getChangeIndicator","changedClass","valueClass","diceIconHtml","isNumericCell","numericValue","attrName","pathParts","renderCard","depth","defaultExpanded","isHorizontal","childCount","collapsedClass","bodyHtml","hasNestedCards","nestedCardCount","childKey","childValue","childPath","itemPath","countText","bodyClass","nestedCardsNeedWidth","getDataWithRetry","detection","eraData","mvuData","detectModeWithData","diagnoseVariableFramework","era","available","dataAvailable","mvu","apiExists","getDataExists","cache","hasCache","cacheKeys","recommendation","injectStyles","targetDoc","styleEl","textContent","head","renderNavButton","isActive","renderPanel","isEraMode","isNumericMode","layoutMode","panelTitle","numericHtml","visibleLevels","saved","numericItems","collectNumericItems","obj","levelNames","itemValue","numValue","newLevelNames","topKeys","filteredNumericItems","lastLevelKey","nonArrayLevels","level","allLevelNames","levelNamesArray","from","levelTogglesHtml","buttonTextColor","buttonTextOnAccent","textMain","levelButtonsHtml","levelName","isVisible","activeStyle","itemsHtml","pathLevels","hierarchyLevels","allLevelsVisible","pathDisplay","finalAttrName","displayStyle","levelsJson","renderNumericMode","cardsHtml","bindEvents","$container","$panel","off","stopPropagation","$card","closest","$body","is","hide","removeClass","addClass","slideDown","slideUp","refresh","newMode","saveActiveTabState","currentTab","getActiveTabState","renderInterface","toastr","toggleClass","$button","css","color","borderColor","opacity","attr","each","$item","levels","newPathDisplay","$value","showEditDialog","setValue","preventDefault","$icon","attrValue","showDicePanel","targetValue","targetName","initiatorName","fromMvu","parsedInfo","initiator","filteredParts","parseMvuPathForDice","mvuPath","mvuParsedInfo","$doc","touchStartX","touchStartY","isHorizontalSwipe","originalEvent","touches","clientX","clientY","touch","deltaX","abs","deltaY","stopImmediatePropagation","$input","focus","button","handle","setPointerCapture","pointerId","startHeight","height","startY","onpointermove","moveE","dy","newHeight","onpointerup","upE","releasePointerCapture","getTableHeights","saveTableHeights","heights","onSave","html","$overlay","select","ctrlKey","parsedValue","onWriteDone","setEraValue","setMvuVariable","is_recursive","replaceMvuData","isModuleTab","$refreshBtn","then","actualData","warning","catch","err","DEFAULT_DICE_CONFIG","critSuccessMax","hardSuccessDiv","difficultSuccessDiv","critFailMin","lastDiceType","dndCritSuccess","dndCritFail","contestTieRule","hideDiceResultInChat","saveDiceConfig","cfg","oldCfg","newCfg","changedKeys","hideDiceResultsInUserMessages","hideInput","hideChat","textareaVal","modifiedText","contestRegex","normalRegex","lastMessageId","getLastMessageId","userMessages","getChatMessages","role","hiddenCount","msg","$msgElement","retrieveDisplayedMessage","$mesText","currentDomText","currentHtml","modifiedHtml","contestPattern","normalPattern","restoredCount","BUILTIN_ATTRIBUTE_PRESETS","baseAttributes","formula","range","modifier","specialAttributes","AttributePresetManager","presetVersion","finalId","updatePreset","exported","jsonStr","autoUpdate","needsUpdate","getCrazyModeConfig","saveCrazyModeConfig","shouldTriggerCrazyMode","selectCrazyParticipant","allTables","processJsonData","playerResult","DashboardDataParser","findTable","npcResult","playerAttrs","getFullAttributesForCharacter","attrs","inScene","weight","parseRows","npc","inSceneVal","toLowerCase","isInScene","npcAttrs","totalWeight","weightedRandomSelect","selectCrazyAttribute","participant","randomAttr","floor","activePreset","allPresetAttrs","randomPresetAttr","defaultValue","skillPool","getRandomSkillPool","crazyRollD100","judgeCrazyRollResult","roll","generateCrazyRoll","contestChance","selectCrazyRollType","participant1","participant2","candidate","attr1","attr2","roll1","roll2","result1","result2","margin1","margin2","winner","rollDiceExpression","expr","NaN","countStr","sidesStr","keepDrop","sides","rolls","rollDice","kd","generateAttributeValue","context","varNames","Function","round","evaluateFormula","DASHBOARD_TABLE_CONFIG","tableKeywords","detailLocation","keywords","fallbackIndex","currentLocation","player","status","position","isMultiple","money","resources","location","quest","progress","active","column","excludeColumn","excludes","bag","skill","equip","isEquipped","equipped","moduleKey","keyword","findColumnIndex","columnKey","moduleConfig","colConfig","kw","getValue","getColumnMap","colKey","tableResult","colMap","parsed","_rowIndex","_raw","applyFilter","parsedRows","filterKey","matchInclude","inc","excludeValue","matchExclude","exc","DEFAULT_GM_CONFIG","diceSystem","showDiceIcon","autoSendPrompt","action_groups","table_keywords","actions","label","template","auto_send","THEME_COLORS","retro","bgPanel","border","textSub","btnBg","btnHover","accent","tableHead","successText","successBg","inputBg","inputText","placeholderText","btnActiveBg","btnActiveText","failureText","failureBg","warningText","warningBg","critSuccessText","critSuccessBg","critFailureText","critFailureBg","extremeSuccessText","extremeSuccessBg","overlayBg","overlayBgLight","shadowBg","lightBg","veryLightBg","buttonText","grayBg","errorText","errorBg","errorBorder","warningIcon","dark","modern","forest","ocean","cyber","buttonBg","buttonBgActive","presetButtonBg","presetButtonBgActive","nightowl","sakura","minepink","purple","wechat","educational","galgame","vaporwave","classicpackaging","terminal","dreamcore","chouten","isLightTheme","getResultBadgeStyle","resultType","t","styles","critSuccess","bg","extremeSuccess","failure","critFailure","padding","getActionsForTable","lowerName","group","extractNumericValue","matches","parseAttributeString","rawStr","jsonObj","parseRelationshipString","trimmed","colonMatch","parenMatch","isRelationshipCell","headerName","lowerHeader","processTemplate","cardData","header","ACTION_BUTTONS","title","isInitialized","isSaving","isEditingOrder","isSettingsOpen","currentDiffMap","observer","_boundRenderHandler","hasUnsavedChanges","isAutoTransforming","tablePageStates","tableSearchStates","lastOptionHash","optionPanelVisible","STORAGE_KEY_SCROLL","tableScrollStates","UpdateController","_lastValidationCount","_isRollingBack","handleUpdate","loadSnapshot","api","getDB","fillTable","timeOut","positionClass","fillError","newCount","updateValidationIndicator","$indicator","show","getCurrentChatId","chatId","DEFAULT_CONFIG","layout","collapseStyle","collapseAlign","fontFamily","cardWidth","fontSize","highlightNew","itemsPerPage","actionsPosition","gridColumns","positionMode","showOptionPanel","clickOptionToAutoSend","optionFontSize","FONTS","THEMES","_coreCache","core","AutoCardUpdaterAPI","clipboard","navigator","ST","top","updateSaveButtonState","$btn","deletions","getPendingDeletions","hasDeletions","getIconForTableName","getBadgeStyle","def","retryErr","_acuQuotaAlerted","savePendingDeletions","getSavedTableOrder","saveTableOrder","getCollapsedState","saveCollapsedState","getOptionsCollapsedState","currentCtx","_contextId","saveSnapshot","getTableStyles","getHiddenTables","getReverseTables","toggleTableReverse","getAttributesForCharacter","characterName","isUser","sheetName","nameColIdx","getAttributeValue","found","STANDARD_ATTRS","getStandardAttrs","allAttrs","allPresets","RANDOM_SKILL_POOL","generateRPGAttributes","isDNDOrPreset","isDND","generate3d6","generateValue","base","adjust","special","baseResult","specialResult","clearPresetAttributesForCharacter","charName","targetRowIndex","targetColIndex","existingStr","existingAttrs","standardAttrs","presetAttrNames","newAttrString","saveDataOnly","attrString","writeAttributesToCharacter","newAttrs","existingMap","standardCount","isComplete","customAttrs","resultParts","writtenAttrs","wasComplete","initCustomDropdown","themeColors","inputId","wrap","$dropdown","after","renderItems","lowerFilter","opt","hideDropdown","addClearButton","inputSelector","$clearBtn","showDiceSettingsPanel","ruleTitle","resetText","defaults","critFail","hardDiv","extremeDiv","currentCritSuccess","currentCritFail","currentHardDiv","currentExtremeDiv","tieRule","cocExtraHtml","panelHtml","left","right","bottom","width","hover","closePanel","$stepper","step","updateValue","getCurrentValue","getStepperValue","critSuccessVal","critFailVal","hardDivVal","extremeDivVal","resetStepper","savedDiceType","rawDataForList","diceCharacterList","diceAttrList","diceType","successCriteria","initialAttrValue","initialTargetValue","inputTextColor","inputStyle","overlay","defaultCriteria","panel","buildAttrButtons","$parentSection","prop","originalHtml","originalHandler","generated","baseAttrs","specialAttrs","confirm","shortName","buildCharButtons","randomSkill","newAttrList","convertTargetForDice","currentTarget","fromDice","toDice","getMaxRoll","dice","fromMax","toMax","ratio","updateRuleMode","$targetInput","$difficultyWrapper","$row3","currentDiceType","newDice","suggestedCriteria","currentTargetVal","convertedVal","newMax","customDice","performDiceRoll","mod","modStr","isFinite","remaining","dicePattern","exec","diceResult","numberPattern","numMatch","parseModifier","criteria","difficulty","targetInputVal","attrInputVal","isAutoTarget","getDefaultTarget","formulaStr","maxRoll","finalValue","requiredTarget","difficultyLabel","difficultyDiv","isCritSuccess","isCritFailure","isSuccess","outcomeText","outcomeClass","extremeTarget","hardTarget","criteriaSymbol","displayOutcomeText","badgeStyle","badgeStyleStr","$rollBtn","judgeExpr","formulaText","attrValueInput","currentDice","initiatorNameVal","showContestPanel","initiatorValue","currentCriteria","opponentName","passedInitiatorName","passedInitiatorValue","passedOpponentValue","opponentValue","opponentAttrs","characterList","contestAttrList","attrStr","targetType","buildCharBtns","containerId","rebuildAttrBtns","aname","refreshedAttrs","initAttrs","oppAttrs","fullAttrs","getSuccessLevel","performContestRoll","initValue","initName","initAttrName","getHalfMax","m","initValueInput","initTarget","initTargetInput","oppValue","oppName","oppAttrName","oppValueInput","oppTarget","oppTargetInput","winnerColor","initResult","oppResult","initSuccess","oppSuccess","displayInitValue","displayOppValue","displayInitSuccessName","displayOppSuccessName","displayWinner","getResultTypeFromSuccess","initResultType","oppResultType","initBadgeStyle","oppBadgeStyle","winnerBadgeStyle","initBadgeStyleStr","oppBadgeStyleStr","winnerBadgeStyleStr","$resultDisplay","$resultInit","$resultOpp","$contestBtn","contestResultText","currentInitName","parseInSceneStatus","buildMapViewModel","globalResult","locationResult","elementResult","globalHeaders","globalRow","globalConfig","detailIdx","regionIdx","currentRegion","locations","locationHeaders","locationRows","locationNameIdx","locationRegionIdx","locationTypeIdx","locationDescIdx","locationImportanceIdx","locationExploreIdx","allLocationNames","emojiMap","names","candidatesMap","sortedNames","localeCompare","usedEmojis","resolveBatchLocationEmojis","region","locationType","importance","exploreStatus","tableKey","elements","elementHeaders","elementRows","elementNameIdx","elementTypeIdx","elementLocationIdx","elementDescIdx","elementStatusIdx","elementInteractIdx","locationName","rawInteractions","interactions","Boolean","typeValue","element","addElement","characters","addCharacter","character","avatarUrl","full","avatarOffsetX","avatarOffsetY","avatarScale","playerLocation","playerConfig","playerHeaders","playerRow","playerNameIdx","playerPosIdx","playerNameRaw","playerPosRaw","npcConfig","npcHeaders","npcRows","npcNameIdx","npcPosIdx","npcInSceneIdx","npcName","inSceneValue","inSceneHeader","firstLocation","next","allRegions","l","otherIndex","focusLocation","fallbackRegion","regionLocations","regionName","scoreA","getHotLocationsInRegion","isMapOpening","showMapVisualization","viewModel","tabSelectionCache","selectedRegion","targetLocation","overlayEl","setProperty","$focusArea","$thumbnails","renderElementChip","refreshPanel","model","leftChars","ceil","rightChars","leftElems","rightElems","renderAvatarHtml","char","avatarStyle","charAt","leftAvatarsHtml","rightAvatarsHtml","leftElemsHtml","rightElemsHtml","emojiHtml","renderFocusArea","thumbnails","totalCount","badgeHtml","renderThumbnailLocation","regions","newRegion","cachedLocation","hotLocations","fallbackFocus","targetRegion","showRelationshipGraph","npcTable","nameIdx","relationIdx","npcTableKey","nodes","edges","resolveName","personaName","isExplicitUserVariant","isPersonaName","isPlayerName","resolveUserPlaceholder","resolvedPlayerName","playerTableKey","x","y","inSceneColIdx","rawNpcName","relationStr","rel","resolvedRelName","relRowIndex","relIsInScene","ri","cleanedLabels","rawRel","commonRelations","specialSuffixMatch","lastChars","cleanRelation","existingEdge","combined","labelsFromSource","labelsFromTarget","nodeArr","connectionCount","node","edge","isMobileView","innerWidth","baseRadius","maxRadius","playerBaseRadius","radiusPerConnection","nodeSizeMultiplier","filterInScene","filterDirectOnly","getNodeRadius","nodeName","sqrt","radius","getLayoutCacheKey","loadLayoutCache","cached","layoutData","allNodesFound","vx","vy","runForceDirectedLayout","angle","PI","dist","cos","sin","nodeMap","iter","u","j","dx","distSq","force","fx","fy","maxSpeed","vMag","saveLayoutCache","panX","panY","$svg","$transform","$edgesGroup","$nodesGroup","$zoomDisplay","$nodeSizeDisplay","$wrapper","updateTransform","updateNodeSizeDisplay","zoomTo","newScale","centerX","centerY","oldScale","scaleChange","render","filteredNodes","directNodes","passInScene","passDirectOnly","getFilteredNodes","filteredNodeNames","filteredEdges","edgesHtml","edgeIdx","len","nx","ny","px","py","hasFromSource","hasFromTarget","sourceRadius","targetRadius","x1","y1","x2","y2","srcLabels","tgtLabels","srcSet","tgtSet","commonLabels","srcUnique","tgtUnique","markerStart","markerEnd","midX","midY","lineLen","lbl","offsetDir","offsetDist","safeOffset","relationEmojiMap","addRelationEmoji","truncateLabel","maxLen","truncated","labelsToShow","labelBaseX","labelBaseY","perpOffset","nodesHtml","nodeAvatar","indicatorRadius","indicatorOffset","inSceneIndicator","nodeDisplayName","scaleVal","foSize","shadowWidth","foOffset","highlightNode","connectedNodes","otherNode","connectedEdgeIndices","clearHighlight","matchMedia","currentHighlightedNode","$node","startX","hasMoved","longPressTriggered","longPressTimer","vibrate","table","rowName","tempNode","isPanning","panStartX","panStartY","panStartPanX","panStartPanY","lastPinchDist","activePointerId","wrapperEl","svgEl","onpointerdown","cursor","rect","getBoundingClientRect","onpointercancel","onwheel","delta","hypot","passive","newDist","$nodeSizeSlider","$sliderSizeDisplay","$sliderContainer","$nodeSizeDisplayTrigger","sliderVisible","sliderHideTimer","hideSlider","resetSliderHideTimer","triggerRect","wrapperRect","showSlider","$filterInSceneBtn","$filterDirectOnlyBtn","updateFilterToggleStyles","$nodeSizeStepper","updateNodeSizeValue","newPercent","getCurrentPercent","clearLayoutCache","showAvatarManager","closeGraph","showAvatarCropModal","imageSource","existing","modalHtml","$modal","$image","containerEl","imageEl","updateImageStyle","backgroundSize","backgroundPosition","isDragging","startOffsetX","startOffsetY","sensitivity","pinchStartScale","pinchRatio","file","files","saveLocalAvatar","newUrl","onUpdate","resolveUserPlaceholderForAvatar","buildList","listHtml","userNode","otherNodes","userNodeForDisplay","currentUrl","hasLocal","displayUrl","sourceLabel","hasAvatar","managerHtml","$manager","bindAvatarEvents","refreshItem","$preview","aliasesStr","deleteLocalAvatar","Blob","href","download","removeChild","reader","FileReader","onload","evt","analysis","showImportConfirmDialog","readAsText","closeManager","onComplete","hasConflicts","conflictListHtml","overwrite","showCardEditModal","displayRow","inputsHtml","dialog","adjustHeight","el","contentHeight","scrollHeight","overflowY","requestAnimationFrame","currentRow","hasChanges","saveDataToDatabase","_configCache","saveConfig","applyConfigStyles","generateDiffMap","currentData","lastData","diffSet","rIdx","newRows","oldRows","oldRow","cIdx","oldCell","fontVal","f","$styleTag","fontImport","cssVars","cls","$optContainer","addStyles","_acuStylesInjected","exportTableAsJson","sheetCount","skipRender","commitDeletes","$saveBtn","mate","sizeInMB","stringifyError","importTableAsJson","apiError","acuModifiedSet","tables","rawContent","exportConfig","updateConfig","refreshRegexRulesList","$rulesList","scopeIcon","scopeText","showAddValidationRuleModal","parentDialog","editRuleId","currentThemeClass","isEditMode","updateSelectColor","$select","$colSelect","$pairedTableSelect","currentPairedValue","empty","refTableName","$refColSelect","isTableRule","valuesStr","refColumns","selectedColumns","pairedTable","finalRuleId","ruleData","$existingItem","isEnabled","ruleHtml","showSmartFixModal","snapshotValue","hasSnapshotValue","showTableRuleFixModal","inputHtml","smartSuggestHtml","examples","currentRowIndex","maxCount","getColumnExamples","suggestedValue","existingValues","prefixMatch","digits","codeIndex","existingNumbers","codeValue","maxNum","nextNum","numOnlyMatch","suggestFormatValue","currentNum","isOutOfRange","nearestValid","getNearestValidNumber","getRelationOptions","hasMultipleColumns","currentInvalidValue","valueExists","cellValue","isValueInRelationTable","optionsHtml","reverseWriteHtml","issues","fixedPairs","fixedVal","hasIssue","originalVal","fixedValue","hasIssues","issuesHtml","issue","optionValue","refSheetId","targetColIdx","extractCodesFromTable","codes","allCodes","codeToRows","isValid","buildCodeMapping","codes1","codes2","allUniqueCodes","codeNumbers","code","mapping","oldCode","newCode","alignAndFixPairedTables","table1Sheet","table1SheetId","table2Sheet","table2SheetId","fixedCount1","fixedCount2","headers1","rows1","colIndex1","headers2","rows2","colIndex2","reverseMapping","sortedNewCodes","analyzeTable","codeRows","emptyRows","prevOldCode","nextOldCode","emptyRow","prevCode","nextCode","codeRow","analysis1","analysis2","buildNewRows","allOldCodes","codeRowMap","cr","isCodeRow","isInserted","codeRowIndex","nextNewCode","currentNewCode","currentOldCode","newRows1","newRows2","countCodeChanges","oldAnalysis","oldCodes","newCodes","contentHtml","actionBtns","changeCount","changeDetails","c","d","minRows","maxRows","currentRowCount","excessRows","isTooMany","isTooFew","fixSuggestions","originalRowIndex","numCountMap","duplicates","gaps","outOfOrder","actualNum","rowNum","occurrences","issueSet","g","o","fix","pairedTableAttr","pairedTableName","targetSheetId","pairedSheet","pairedSheetId","pairedHeaders","extract1","extract2","fixedCount","startRow","showBlacklistManagerModal","updateTextarea","uniqueItems","syncFromTextarea","input","existingSet","addedItems","which","closeModal","showAttributePresetManager","isDefaultActive","allPresetsHtml","isBuiltin","showSettingsModal","$toggle","$thisToggle","showAttributePresetEditor","filename","parsedData","importingName","existingPresets","hasConflict","doImport","finalJson","existingPreset","isEdit","defaultData","$jsonTextarea","updateJSON","not","savedFilters","renderLogs","filteredLogs","$logContainer","typeColors","typeIcons","logItem","updateCounts","checked","$status","newState","line","toUpperCase","TavernHelper","triggerSlash","safeContent","isSecureContext","writeText","textArea","setAttribute","setSelectionRange","successful","execCommand","refreshInterval","setInterval","clearInterval","showAddRegexRuleModal","editRule","scopeType","$textarea","extractedFlags","$flagGlobal","$flagIgnoreCase","$flagMultiline","uiFlags","finalPattern","finalFlags","expandedGroups","isGroupExpanded","groupId","SPECIAL_BUTTONS_CONFIG","tableManagerHtml","savedOrder","hiddenList","allItems","isSpecial","orderMap","isHidden","specialClass","chevron","hasIntercept","$group","$chevron","expanded","targetHeight","animate","currentHeight","outerHeight","newTheme","crazyConfig","selectValue","initCrazyModeUI","$list","dragState","timer","clearDragState","startDrag","targetItem","insertBefore","$dragged","$target","insertAfter","newOrder","unit","isCurrentlyActive","fadeOut","refreshPresetUI","prompt","accept","onchange","currentState","currentPreset","$presetSelect","defaultPresetId","enabledRules","renderInterfaceTimer","renderInterfacePending","_renderInterfaceImpl","$chat","mutationLock","MutationObserver","lastChild","children","last","wrapper","observe","childList","isDataFromDatabase","anyLockApplied","transformResult","transformError","structuredClone","existingSnapshot","hasValidSnapshotData","$searchInput","activeTab","currentTabName","newHtml","renderTableContent","$virtualDom","replaceWith","bindOptionEvents","lastScrollX","lastScrollY","$oldContent","scrollLeft","scrollTop","orderedNames","concat","isCollapsed","layoutClass","finalGridCols","empty3","optionHtml","currentOptionHash","optionTables","isOptionsCollapsed","collapseIcon","optionCount","hasBtns","optionValues","buttonsHtml","cellStr","encodeURIComponent","optionChanged","colStyleClass","alignClass","savedHeight","isDashboardActive","isChangesPanelActive","isMvuActive","finalSavedHeight","renderChangesPanel","renderDashboard","gridFixStyle","isChangesActive","isSimpleModeNav","changesCount","validationErrorCount","displayCount","showWarningIcon","navHiddenList","navSavedOrder","SPECIAL_NAV_ITEMS","extraClass","allNavItems","checkAvailable","activeClass","orderVal","warningIconHtml","$existing","insertHtmlToPage","injectIndependentOptions","bindChangesEvents","$newContent","savedState","inner","$targetTitle","htmlContent","$aiMes","$this","$targetMes","$targetText","getTargetContainer","optConfig","decodeURIComponent","createChatMessages","executeSlashCommandsWithOptions","cmd","sendResult","isError","isAborted","ta","sendBtn","enterEvent","Event","keyCode","bubbles","$textDiv","hasImage","targetIndex","eq","$targetBlock","$oldWrapper","validationErrors","changes","rowChanges","changedFields","isValidationMode","groupedErrors","collapsedGroups","tableErrors","groupedChanges","tableChanges","change","oldShort","newShort","fieldDisplay","fieldCount","fieldNames","moreText","validationItemTouchStartPos","$targetCard","scrollIntoView","behavior","block","storageKey","changeType","refreshChangesPanel","restoredRow","showRowCompareEditModal","showChangeSingleFieldModal","showChangeEditModal","restoredData","updateChangesCount","finalHeight","$horizontalScroller","_touchStartX","_touchStartY","_scrollDirection","$span","hasOldValue","fieldsHtml","isChanged","questResult","bagResult","skillResult","equipResult","playerParsed","allAttrsStr","playerRows","globalDetailLocation","globalLocation","locIdx","currentPlaceName","npcTableName","npcParsed","inSceneNPCs","offSceneNPCs","npcData","allNPCs","questTableName","questParsed","activeQuestParsed","questTypeOrder","activeTasks","q","bagTableName","bagParsed","bagItems","skillTableName","skillParsed","skills","equipTableName","equipParsed","equippedItems","locationTableName","locationTableKey","locationParsed","resourcesStr","parsedResources","res","skillValue","hasNumeric","skillRowIndex","loc","areaName","isCurrent","npcIdx","isLastNpc","npcAvatar","offSceneFilter","isLastBag","isLast","isMain","progressPercent","progressMatch","progressBar","loadedModules","pendingDeletions","isGridMode","titleColIndex","processedRows","originalIndex","searchTerm","isReversed","isTableReversed","titleA","titleB","aHitTitle","bHitTitle","totalItems","totalPages","currentPage","startIdx","endIdx","rowsToRender","showReverseBtn","shouldShowReverseButton","reverseBtnHtml","realRowIdx","isPending","cardTitle","showDefaultIndex","titleCellId","isTitleModified","isRowNew","rowClass","validColIndices","isOddValidCount","cardBody","spanFullRow","rawHeaderName","lockRowKey","inlineLockIcon","safeStr","rawStrOriginal","invalidPlaceholders","hideLabel","splitRegex","isIdentityField","parsedAttrs","displayCell","validRelations","relHtml","attrsHtml","showDice","invalidTagValues","isDiffChanged","cellId","isUserModified","cellHighlight","tableActions","actionsHtml","interactColIdx","invalidValues","interactOptions","existingLabels","iconMap","newActions","act","actIdx","cardLockRowKey","cardLockIcon","cardBookmarkRowKey","bookmarkIcon","saveCurrentTabState","$content","innerScrolls","switchPanel","updateContentFn","dataError","managerError","scrollTimer","$navBtn","isPanelVisible","mvuSavedHeight","currentActiveTab","$cell","showCellMenu","$pageBtn","newPage","manualUpdate","searchTimeout","isComposing","selectionStart","selectionEnd","isFocus","activeElement","classList","$newInput","tName","actionIdx","$title","action","skillName","checkValue","attrValIdx","profIdx","promptText","sendMessage","ev","isPlayerTable","playerAttrValue","itemName","taskName","npcAttrValue","npcParts","npcMatch","relations","borderStyle","cardHtml","backdrop","isModified","currentHeader","hasAnyLockInRow","lockMenuHtml","menu","winWidth","winHeight","mWidth","outerWidth","mHeight","changedTouches","closeAll","fallbackCopy","$displayTarget","actOrd","dels","colCount","showConflictDialog","extendedTimeOut","closeButton","preventDuplicates","hasVisualizerNav","hasVisualizerDataDisplay","scripts","querySelectorAll","script","visualizerConfig","diceConfig","detectVisualizerConflict","disconnect","eventSource","events","eventTypes","triggers","CHAT_CHANGED","MESSAGE_SWIPED","MESSAGE_DELETED","MESSAGE_UPDATED","_acuBoundChatChangeHandler","_boundChatChangeHandler","removeListener","loop","registerTableUpdateCallback","registerTableFillStartCallback","_acuInitRetries","hideOptionPanel","pendingCrazyAppend","lastCrazyPreSendAt","normalizeMessageId","messageId","hasDiceResultInText","insertDiceIntoUserInputBlock","blockRegex","blockMatch","suffix","trimmedInner","newInner","applyCrazyModeToPrompt","params","dryRun","safeParams","quietPrompt","quiet_prompt","automaticTrigger","automatic_trigger","_acu_crazy_applied","originalPrompt","crazyRollResult","finalPrompt","inserted","triggerCrazyModeBeforeSend","updatedValue","dispatchEvent","queueCrazyAppend","applyCrazyAppend","pending","stChat","chat","stMsg","is_user","mes","extra","acuCrazyModeApplied","newMessage","setChatMessages","setupSendButtonListener","sendButton","onSendCapture","subtree","installCrazyGenerateHook","rootWindow","__acuCrazyGenerateHookInstalled","generate","__acuCrazyGenerateOriginal","injects","user_input","mergedPrompt","evtName","MESSAGE_SENT","tavern_events","afterCommandsEvtName","GENERATION_AFTER_COMMANDS","testPairedTableFix","getValidCodes","emptyRows1","emptyRows2","isValid1","isValid2","set1","set2","setsEqual","emptyRowsPreserved1","emptyRowsPreserved2","diagnoseDiceVariables","ready"],"ignoreList":[],"sourceRoot":""}